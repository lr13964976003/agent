// LLM Parallel Strategy Deployment DAG
digraph {
	nodesep=0.5 rankdir=TB ranksep=0.8 splines=ortho
	node [fillcolor=lightblue shape=rectangle style=filled]
	edge [arrowhead=normal arrowsize=0.7]
	input [label="Input\nBatch Size: 128\nSeq Length: 10240\nToken Dim: 512" fillcolor=lightgreen shape=ellipse]
	input_sp0 [label="Input SP0\nSeq Split 0/4" fillcolor=lightyellow shape=parallelogram]
	input -> input_sp0
	input_sp1 [label="Input SP1\nSeq Split 1/4" fillcolor=lightyellow shape=parallelogram]
	input -> input_sp1
	input_sp2 [label="Input SP2\nSeq Split 2/4" fillcolor=lightyellow shape=parallelogram]
	input -> input_sp2
	input_sp3 [label="Input SP3\nSeq Split 3/4" fillcolor=lightyellow shape=parallelogram]
	input -> input_sp3
	layer_0_norm_sp0_pp0 [label="LayerNorm L0 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	input_sp0 -> layer_0_norm_sp0_pp0
	input_sp1 -> layer_0_norm_sp0_pp0
	input_sp2 -> layer_0_norm_sp0_pp0
	input_sp3 -> layer_0_norm_sp0_pp0
	layer_0_qkv_sp0_tp0_pp0 [label="QKV Proj L0 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp0_pp0 -> layer_0_qkv_sp0_tp0_pp0
	layer_0_attn_sp0_tp0_pp0 [label="Attention L0 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp0_tp0_pp0 -> layer_0_attn_sp0_tp0_pp0
	layer_0_attn_out_sp0_tp0_pp0 [label="Attn Out Proj L0 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp0_tp0_pp0 -> layer_0_attn_out_sp0_tp0_pp0
	layer_0_qkv_sp0_tp1_pp0 [label="QKV Proj L0 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp0_pp0 -> layer_0_qkv_sp0_tp1_pp0
	layer_0_attn_sp0_tp1_pp0 [label="Attention L0 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp0_tp1_pp0 -> layer_0_attn_sp0_tp1_pp0
	layer_0_attn_out_sp0_tp1_pp0 [label="Attn Out Proj L0 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp0_tp1_pp0 -> layer_0_attn_out_sp0_tp1_pp0
	layer_0_qkv_sp0_tp2_pp0 [label="QKV Proj L0 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp0_pp0 -> layer_0_qkv_sp0_tp2_pp0
	layer_0_attn_sp0_tp2_pp0 [label="Attention L0 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp0_tp2_pp0 -> layer_0_attn_sp0_tp2_pp0
	layer_0_attn_out_sp0_tp2_pp0 [label="Attn Out Proj L0 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp0_tp2_pp0 -> layer_0_attn_out_sp0_tp2_pp0
	layer_0_qkv_sp0_tp3_pp0 [label="QKV Proj L0 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp0_pp0 -> layer_0_qkv_sp0_tp3_pp0
	layer_0_attn_sp0_tp3_pp0 [label="Attention L0 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp0_tp3_pp0 -> layer_0_attn_sp0_tp3_pp0
	layer_0_attn_out_sp0_tp3_pp0 [label="Attn Out Proj L0 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp0_tp3_pp0 -> layer_0_attn_out_sp0_tp3_pp0
	layer_0_attn_ar_sp0_pp0 [label="Attention All-Reduce L0 SP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_attn_out_sp0_tp0_pp0 -> layer_0_attn_ar_sp0_pp0
	layer_0_attn_out_sp0_tp1_pp0 -> layer_0_attn_ar_sp0_pp0
	layer_0_attn_out_sp0_tp2_pp0 -> layer_0_attn_ar_sp0_pp0
	layer_0_attn_out_sp0_tp3_pp0 -> layer_0_attn_ar_sp0_pp0
	layer_0_attn_res_sp0_pp0 [label="Attention Residual L0 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_attn_ar_sp0_pp0 -> layer_0_attn_res_sp0_pp0
	layer_0_norm_sp0_pp0 -> layer_0_attn_res_sp0_pp0 [style=dashed]
	layer_0_post_norm_sp0_pp0 [label="Post-Attn Norm L0 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_attn_res_sp0_pp0 -> layer_0_post_norm_sp0_pp0
	layer_0_router_sp0_pp0 [label="MoE Router L0 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_0_post_norm_sp0_pp0 -> layer_0_router_sp0_pp0
	layer_0_dispatch_sp0_ep0_pp0 [label="Token Dispatch L0 SP0 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep0_pp0 [style=dashed]
	layer_0_expert_sp0_ep0_tp0_pp0 [label="Expert L0 SP0 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep0_pp0 -> layer_0_expert_sp0_ep0_tp0_pp0
	layer_0_expert_out_sp0_ep0_tp0_pp0 [label="Expert Out L0 SP0 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep0_tp0_pp0 -> layer_0_expert_out_sp0_ep0_tp0_pp0
	layer_0_expert_sp0_ep0_tp1_pp0 [label="Expert L0 SP0 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep0_pp0 -> layer_0_expert_sp0_ep0_tp1_pp0
	layer_0_expert_out_sp0_ep0_tp1_pp0 [label="Expert Out L0 SP0 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep0_tp1_pp0 -> layer_0_expert_out_sp0_ep0_tp1_pp0
	layer_0_expert_sp0_ep0_tp2_pp0 [label="Expert L0 SP0 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep0_pp0 -> layer_0_expert_sp0_ep0_tp2_pp0
	layer_0_expert_out_sp0_ep0_tp2_pp0 [label="Expert Out L0 SP0 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep0_tp2_pp0 -> layer_0_expert_out_sp0_ep0_tp2_pp0
	layer_0_expert_sp0_ep0_tp3_pp0 [label="Expert L0 SP0 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep0_pp0 -> layer_0_expert_sp0_ep0_tp3_pp0
	layer_0_expert_out_sp0_ep0_tp3_pp0 [label="Expert Out L0 SP0 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep0_tp3_pp0 -> layer_0_expert_out_sp0_ep0_tp3_pp0
	layer_0_expert_ar_sp0_ep0_pp0 [label="Expert All-Reduce L0 SP0 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep0_tp0_pp0 -> layer_0_expert_ar_sp0_ep0_pp0
	layer_0_expert_out_sp0_ep0_tp1_pp0 -> layer_0_expert_ar_sp0_ep0_pp0
	layer_0_expert_out_sp0_ep0_tp2_pp0 -> layer_0_expert_ar_sp0_ep0_pp0
	layer_0_expert_out_sp0_ep0_tp3_pp0 -> layer_0_expert_ar_sp0_ep0_pp0
	layer_0_combine_sp0_ep0_pp0 [label="Token Combine L0 SP0 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep0_pp0 -> layer_0_combine_sp0_ep0_pp0
	layer_0_dispatch_sp0_ep1_pp0 [label="Token Dispatch L0 SP0 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep1_pp0 [style=dashed]
	layer_0_expert_sp0_ep1_tp0_pp0 [label="Expert L0 SP0 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep1_pp0 -> layer_0_expert_sp0_ep1_tp0_pp0
	layer_0_expert_out_sp0_ep1_tp0_pp0 [label="Expert Out L0 SP0 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep1_tp0_pp0 -> layer_0_expert_out_sp0_ep1_tp0_pp0
	layer_0_expert_sp0_ep1_tp1_pp0 [label="Expert L0 SP0 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep1_pp0 -> layer_0_expert_sp0_ep1_tp1_pp0
	layer_0_expert_out_sp0_ep1_tp1_pp0 [label="Expert Out L0 SP0 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep1_tp1_pp0 -> layer_0_expert_out_sp0_ep1_tp1_pp0
	layer_0_expert_sp0_ep1_tp2_pp0 [label="Expert L0 SP0 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep1_pp0 -> layer_0_expert_sp0_ep1_tp2_pp0
	layer_0_expert_out_sp0_ep1_tp2_pp0 [label="Expert Out L0 SP0 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep1_tp2_pp0 -> layer_0_expert_out_sp0_ep1_tp2_pp0
	layer_0_expert_sp0_ep1_tp3_pp0 [label="Expert L0 SP0 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep1_pp0 -> layer_0_expert_sp0_ep1_tp3_pp0
	layer_0_expert_out_sp0_ep1_tp3_pp0 [label="Expert Out L0 SP0 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep1_tp3_pp0 -> layer_0_expert_out_sp0_ep1_tp3_pp0
	layer_0_expert_ar_sp0_ep1_pp0 [label="Expert All-Reduce L0 SP0 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep1_tp0_pp0 -> layer_0_expert_ar_sp0_ep1_pp0
	layer_0_expert_out_sp0_ep1_tp1_pp0 -> layer_0_expert_ar_sp0_ep1_pp0
	layer_0_expert_out_sp0_ep1_tp2_pp0 -> layer_0_expert_ar_sp0_ep1_pp0
	layer_0_expert_out_sp0_ep1_tp3_pp0 -> layer_0_expert_ar_sp0_ep1_pp0
	layer_0_combine_sp0_ep1_pp0 [label="Token Combine L0 SP0 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep1_pp0 -> layer_0_combine_sp0_ep1_pp0
	layer_0_dispatch_sp0_ep2_pp0 [label="Token Dispatch L0 SP0 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep2_pp0 [style=dashed]
	layer_0_expert_sp0_ep2_tp0_pp0 [label="Expert L0 SP0 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep2_pp0 -> layer_0_expert_sp0_ep2_tp0_pp0
	layer_0_expert_out_sp0_ep2_tp0_pp0 [label="Expert Out L0 SP0 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep2_tp0_pp0 -> layer_0_expert_out_sp0_ep2_tp0_pp0
	layer_0_expert_sp0_ep2_tp1_pp0 [label="Expert L0 SP0 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep2_pp0 -> layer_0_expert_sp0_ep2_tp1_pp0
	layer_0_expert_out_sp0_ep2_tp1_pp0 [label="Expert Out L0 SP0 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep2_tp1_pp0 -> layer_0_expert_out_sp0_ep2_tp1_pp0
	layer_0_expert_sp0_ep2_tp2_pp0 [label="Expert L0 SP0 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep2_pp0 -> layer_0_expert_sp0_ep2_tp2_pp0
	layer_0_expert_out_sp0_ep2_tp2_pp0 [label="Expert Out L0 SP0 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep2_tp2_pp0 -> layer_0_expert_out_sp0_ep2_tp2_pp0
	layer_0_expert_sp0_ep2_tp3_pp0 [label="Expert L0 SP0 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep2_pp0 -> layer_0_expert_sp0_ep2_tp3_pp0
	layer_0_expert_out_sp0_ep2_tp3_pp0 [label="Expert Out L0 SP0 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep2_tp3_pp0 -> layer_0_expert_out_sp0_ep2_tp3_pp0
	layer_0_expert_ar_sp0_ep2_pp0 [label="Expert All-Reduce L0 SP0 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep2_tp0_pp0 -> layer_0_expert_ar_sp0_ep2_pp0
	layer_0_expert_out_sp0_ep2_tp1_pp0 -> layer_0_expert_ar_sp0_ep2_pp0
	layer_0_expert_out_sp0_ep2_tp2_pp0 -> layer_0_expert_ar_sp0_ep2_pp0
	layer_0_expert_out_sp0_ep2_tp3_pp0 -> layer_0_expert_ar_sp0_ep2_pp0
	layer_0_combine_sp0_ep2_pp0 [label="Token Combine L0 SP0 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep2_pp0 -> layer_0_combine_sp0_ep2_pp0
	layer_0_dispatch_sp0_ep3_pp0 [label="Token Dispatch L0 SP0 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep3_pp0 [style=dashed]
	layer_0_expert_sp0_ep3_tp0_pp0 [label="Expert L0 SP0 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep3_pp0 -> layer_0_expert_sp0_ep3_tp0_pp0
	layer_0_expert_out_sp0_ep3_tp0_pp0 [label="Expert Out L0 SP0 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep3_tp0_pp0 -> layer_0_expert_out_sp0_ep3_tp0_pp0
	layer_0_expert_sp0_ep3_tp1_pp0 [label="Expert L0 SP0 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep3_pp0 -> layer_0_expert_sp0_ep3_tp1_pp0
	layer_0_expert_out_sp0_ep3_tp1_pp0 [label="Expert Out L0 SP0 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep3_tp1_pp0 -> layer_0_expert_out_sp0_ep3_tp1_pp0
	layer_0_expert_sp0_ep3_tp2_pp0 [label="Expert L0 SP0 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep3_pp0 -> layer_0_expert_sp0_ep3_tp2_pp0
	layer_0_expert_out_sp0_ep3_tp2_pp0 [label="Expert Out L0 SP0 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep3_tp2_pp0 -> layer_0_expert_out_sp0_ep3_tp2_pp0
	layer_0_expert_sp0_ep3_tp3_pp0 [label="Expert L0 SP0 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep3_pp0 -> layer_0_expert_sp0_ep3_tp3_pp0
	layer_0_expert_out_sp0_ep3_tp3_pp0 [label="Expert Out L0 SP0 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep3_tp3_pp0 -> layer_0_expert_out_sp0_ep3_tp3_pp0
	layer_0_expert_ar_sp0_ep3_pp0 [label="Expert All-Reduce L0 SP0 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep3_tp0_pp0 -> layer_0_expert_ar_sp0_ep3_pp0
	layer_0_expert_out_sp0_ep3_tp1_pp0 -> layer_0_expert_ar_sp0_ep3_pp0
	layer_0_expert_out_sp0_ep3_tp2_pp0 -> layer_0_expert_ar_sp0_ep3_pp0
	layer_0_expert_out_sp0_ep3_tp3_pp0 -> layer_0_expert_ar_sp0_ep3_pp0
	layer_0_combine_sp0_ep3_pp0 [label="Token Combine L0 SP0 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep3_pp0 -> layer_0_combine_sp0_ep3_pp0
	layer_0_dispatch_sp0_ep4_pp0 [label="Token Dispatch L0 SP0 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep4_pp0 [style=dashed]
	layer_0_expert_sp0_ep4_tp0_pp0 [label="Expert L0 SP0 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep4_pp0 -> layer_0_expert_sp0_ep4_tp0_pp0
	layer_0_expert_out_sp0_ep4_tp0_pp0 [label="Expert Out L0 SP0 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep4_tp0_pp0 -> layer_0_expert_out_sp0_ep4_tp0_pp0
	layer_0_expert_sp0_ep4_tp1_pp0 [label="Expert L0 SP0 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep4_pp0 -> layer_0_expert_sp0_ep4_tp1_pp0
	layer_0_expert_out_sp0_ep4_tp1_pp0 [label="Expert Out L0 SP0 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep4_tp1_pp0 -> layer_0_expert_out_sp0_ep4_tp1_pp0
	layer_0_expert_sp0_ep4_tp2_pp0 [label="Expert L0 SP0 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep4_pp0 -> layer_0_expert_sp0_ep4_tp2_pp0
	layer_0_expert_out_sp0_ep4_tp2_pp0 [label="Expert Out L0 SP0 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep4_tp2_pp0 -> layer_0_expert_out_sp0_ep4_tp2_pp0
	layer_0_expert_sp0_ep4_tp3_pp0 [label="Expert L0 SP0 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep4_pp0 -> layer_0_expert_sp0_ep4_tp3_pp0
	layer_0_expert_out_sp0_ep4_tp3_pp0 [label="Expert Out L0 SP0 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep4_tp3_pp0 -> layer_0_expert_out_sp0_ep4_tp3_pp0
	layer_0_expert_ar_sp0_ep4_pp0 [label="Expert All-Reduce L0 SP0 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep4_tp0_pp0 -> layer_0_expert_ar_sp0_ep4_pp0
	layer_0_expert_out_sp0_ep4_tp1_pp0 -> layer_0_expert_ar_sp0_ep4_pp0
	layer_0_expert_out_sp0_ep4_tp2_pp0 -> layer_0_expert_ar_sp0_ep4_pp0
	layer_0_expert_out_sp0_ep4_tp3_pp0 -> layer_0_expert_ar_sp0_ep4_pp0
	layer_0_combine_sp0_ep4_pp0 [label="Token Combine L0 SP0 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep4_pp0 -> layer_0_combine_sp0_ep4_pp0
	layer_0_dispatch_sp0_ep5_pp0 [label="Token Dispatch L0 SP0 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep5_pp0 [style=dashed]
	layer_0_expert_sp0_ep5_tp0_pp0 [label="Expert L0 SP0 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep5_pp0 -> layer_0_expert_sp0_ep5_tp0_pp0
	layer_0_expert_out_sp0_ep5_tp0_pp0 [label="Expert Out L0 SP0 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep5_tp0_pp0 -> layer_0_expert_out_sp0_ep5_tp0_pp0
	layer_0_expert_sp0_ep5_tp1_pp0 [label="Expert L0 SP0 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep5_pp0 -> layer_0_expert_sp0_ep5_tp1_pp0
	layer_0_expert_out_sp0_ep5_tp1_pp0 [label="Expert Out L0 SP0 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep5_tp1_pp0 -> layer_0_expert_out_sp0_ep5_tp1_pp0
	layer_0_expert_sp0_ep5_tp2_pp0 [label="Expert L0 SP0 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep5_pp0 -> layer_0_expert_sp0_ep5_tp2_pp0
	layer_0_expert_out_sp0_ep5_tp2_pp0 [label="Expert Out L0 SP0 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep5_tp2_pp0 -> layer_0_expert_out_sp0_ep5_tp2_pp0
	layer_0_expert_sp0_ep5_tp3_pp0 [label="Expert L0 SP0 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep5_pp0 -> layer_0_expert_sp0_ep5_tp3_pp0
	layer_0_expert_out_sp0_ep5_tp3_pp0 [label="Expert Out L0 SP0 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep5_tp3_pp0 -> layer_0_expert_out_sp0_ep5_tp3_pp0
	layer_0_expert_ar_sp0_ep5_pp0 [label="Expert All-Reduce L0 SP0 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep5_tp0_pp0 -> layer_0_expert_ar_sp0_ep5_pp0
	layer_0_expert_out_sp0_ep5_tp1_pp0 -> layer_0_expert_ar_sp0_ep5_pp0
	layer_0_expert_out_sp0_ep5_tp2_pp0 -> layer_0_expert_ar_sp0_ep5_pp0
	layer_0_expert_out_sp0_ep5_tp3_pp0 -> layer_0_expert_ar_sp0_ep5_pp0
	layer_0_combine_sp0_ep5_pp0 [label="Token Combine L0 SP0 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep5_pp0 -> layer_0_combine_sp0_ep5_pp0
	layer_0_dispatch_sp0_ep6_pp0 [label="Token Dispatch L0 SP0 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep6_pp0 [style=dashed]
	layer_0_expert_sp0_ep6_tp0_pp0 [label="Expert L0 SP0 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep6_pp0 -> layer_0_expert_sp0_ep6_tp0_pp0
	layer_0_expert_out_sp0_ep6_tp0_pp0 [label="Expert Out L0 SP0 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep6_tp0_pp0 -> layer_0_expert_out_sp0_ep6_tp0_pp0
	layer_0_expert_sp0_ep6_tp1_pp0 [label="Expert L0 SP0 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep6_pp0 -> layer_0_expert_sp0_ep6_tp1_pp0
	layer_0_expert_out_sp0_ep6_tp1_pp0 [label="Expert Out L0 SP0 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep6_tp1_pp0 -> layer_0_expert_out_sp0_ep6_tp1_pp0
	layer_0_expert_sp0_ep6_tp2_pp0 [label="Expert L0 SP0 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep6_pp0 -> layer_0_expert_sp0_ep6_tp2_pp0
	layer_0_expert_out_sp0_ep6_tp2_pp0 [label="Expert Out L0 SP0 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep6_tp2_pp0 -> layer_0_expert_out_sp0_ep6_tp2_pp0
	layer_0_expert_sp0_ep6_tp3_pp0 [label="Expert L0 SP0 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep6_pp0 -> layer_0_expert_sp0_ep6_tp3_pp0
	layer_0_expert_out_sp0_ep6_tp3_pp0 [label="Expert Out L0 SP0 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep6_tp3_pp0 -> layer_0_expert_out_sp0_ep6_tp3_pp0
	layer_0_expert_ar_sp0_ep6_pp0 [label="Expert All-Reduce L0 SP0 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep6_tp0_pp0 -> layer_0_expert_ar_sp0_ep6_pp0
	layer_0_expert_out_sp0_ep6_tp1_pp0 -> layer_0_expert_ar_sp0_ep6_pp0
	layer_0_expert_out_sp0_ep6_tp2_pp0 -> layer_0_expert_ar_sp0_ep6_pp0
	layer_0_expert_out_sp0_ep6_tp3_pp0 -> layer_0_expert_ar_sp0_ep6_pp0
	layer_0_combine_sp0_ep6_pp0 [label="Token Combine L0 SP0 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep6_pp0 -> layer_0_combine_sp0_ep6_pp0
	layer_0_dispatch_sp0_ep7_pp0 [label="Token Dispatch L0 SP0 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep7_pp0 [style=dashed]
	layer_0_expert_sp0_ep7_tp0_pp0 [label="Expert L0 SP0 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep7_pp0 -> layer_0_expert_sp0_ep7_tp0_pp0
	layer_0_expert_out_sp0_ep7_tp0_pp0 [label="Expert Out L0 SP0 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep7_tp0_pp0 -> layer_0_expert_out_sp0_ep7_tp0_pp0
	layer_0_expert_sp0_ep7_tp1_pp0 [label="Expert L0 SP0 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep7_pp0 -> layer_0_expert_sp0_ep7_tp1_pp0
	layer_0_expert_out_sp0_ep7_tp1_pp0 [label="Expert Out L0 SP0 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep7_tp1_pp0 -> layer_0_expert_out_sp0_ep7_tp1_pp0
	layer_0_expert_sp0_ep7_tp2_pp0 [label="Expert L0 SP0 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep7_pp0 -> layer_0_expert_sp0_ep7_tp2_pp0
	layer_0_expert_out_sp0_ep7_tp2_pp0 [label="Expert Out L0 SP0 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep7_tp2_pp0 -> layer_0_expert_out_sp0_ep7_tp2_pp0
	layer_0_expert_sp0_ep7_tp3_pp0 [label="Expert L0 SP0 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep7_pp0 -> layer_0_expert_sp0_ep7_tp3_pp0
	layer_0_expert_out_sp0_ep7_tp3_pp0 [label="Expert Out L0 SP0 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep7_tp3_pp0 -> layer_0_expert_out_sp0_ep7_tp3_pp0
	layer_0_expert_ar_sp0_ep7_pp0 [label="Expert All-Reduce L0 SP0 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep7_tp0_pp0 -> layer_0_expert_ar_sp0_ep7_pp0
	layer_0_expert_out_sp0_ep7_tp1_pp0 -> layer_0_expert_ar_sp0_ep7_pp0
	layer_0_expert_out_sp0_ep7_tp2_pp0 -> layer_0_expert_ar_sp0_ep7_pp0
	layer_0_expert_out_sp0_ep7_tp3_pp0 -> layer_0_expert_ar_sp0_ep7_pp0
	layer_0_combine_sp0_ep7_pp0 [label="Token Combine L0 SP0 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep7_pp0 -> layer_0_combine_sp0_ep7_pp0
	layer_0_dispatch_sp0_ep8_pp0 [label="Token Dispatch L0 SP0 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep8_pp0 [style=dashed]
	layer_0_expert_sp0_ep8_tp0_pp0 [label="Expert L0 SP0 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep8_pp0 -> layer_0_expert_sp0_ep8_tp0_pp0
	layer_0_expert_out_sp0_ep8_tp0_pp0 [label="Expert Out L0 SP0 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep8_tp0_pp0 -> layer_0_expert_out_sp0_ep8_tp0_pp0
	layer_0_expert_sp0_ep8_tp1_pp0 [label="Expert L0 SP0 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep8_pp0 -> layer_0_expert_sp0_ep8_tp1_pp0
	layer_0_expert_out_sp0_ep8_tp1_pp0 [label="Expert Out L0 SP0 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep8_tp1_pp0 -> layer_0_expert_out_sp0_ep8_tp1_pp0
	layer_0_expert_sp0_ep8_tp2_pp0 [label="Expert L0 SP0 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep8_pp0 -> layer_0_expert_sp0_ep8_tp2_pp0
	layer_0_expert_out_sp0_ep8_tp2_pp0 [label="Expert Out L0 SP0 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep8_tp2_pp0 -> layer_0_expert_out_sp0_ep8_tp2_pp0
	layer_0_expert_sp0_ep8_tp3_pp0 [label="Expert L0 SP0 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep8_pp0 -> layer_0_expert_sp0_ep8_tp3_pp0
	layer_0_expert_out_sp0_ep8_tp3_pp0 [label="Expert Out L0 SP0 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep8_tp3_pp0 -> layer_0_expert_out_sp0_ep8_tp3_pp0
	layer_0_expert_ar_sp0_ep8_pp0 [label="Expert All-Reduce L0 SP0 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep8_tp0_pp0 -> layer_0_expert_ar_sp0_ep8_pp0
	layer_0_expert_out_sp0_ep8_tp1_pp0 -> layer_0_expert_ar_sp0_ep8_pp0
	layer_0_expert_out_sp0_ep8_tp2_pp0 -> layer_0_expert_ar_sp0_ep8_pp0
	layer_0_expert_out_sp0_ep8_tp3_pp0 -> layer_0_expert_ar_sp0_ep8_pp0
	layer_0_combine_sp0_ep8_pp0 [label="Token Combine L0 SP0 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep8_pp0 -> layer_0_combine_sp0_ep8_pp0
	layer_0_dispatch_sp0_ep9_pp0 [label="Token Dispatch L0 SP0 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep9_pp0 [style=dashed]
	layer_0_expert_sp0_ep9_tp0_pp0 [label="Expert L0 SP0 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep9_pp0 -> layer_0_expert_sp0_ep9_tp0_pp0
	layer_0_expert_out_sp0_ep9_tp0_pp0 [label="Expert Out L0 SP0 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep9_tp0_pp0 -> layer_0_expert_out_sp0_ep9_tp0_pp0
	layer_0_expert_sp0_ep9_tp1_pp0 [label="Expert L0 SP0 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep9_pp0 -> layer_0_expert_sp0_ep9_tp1_pp0
	layer_0_expert_out_sp0_ep9_tp1_pp0 [label="Expert Out L0 SP0 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep9_tp1_pp0 -> layer_0_expert_out_sp0_ep9_tp1_pp0
	layer_0_expert_sp0_ep9_tp2_pp0 [label="Expert L0 SP0 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep9_pp0 -> layer_0_expert_sp0_ep9_tp2_pp0
	layer_0_expert_out_sp0_ep9_tp2_pp0 [label="Expert Out L0 SP0 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep9_tp2_pp0 -> layer_0_expert_out_sp0_ep9_tp2_pp0
	layer_0_expert_sp0_ep9_tp3_pp0 [label="Expert L0 SP0 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep9_pp0 -> layer_0_expert_sp0_ep9_tp3_pp0
	layer_0_expert_out_sp0_ep9_tp3_pp0 [label="Expert Out L0 SP0 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep9_tp3_pp0 -> layer_0_expert_out_sp0_ep9_tp3_pp0
	layer_0_expert_ar_sp0_ep9_pp0 [label="Expert All-Reduce L0 SP0 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep9_tp0_pp0 -> layer_0_expert_ar_sp0_ep9_pp0
	layer_0_expert_out_sp0_ep9_tp1_pp0 -> layer_0_expert_ar_sp0_ep9_pp0
	layer_0_expert_out_sp0_ep9_tp2_pp0 -> layer_0_expert_ar_sp0_ep9_pp0
	layer_0_expert_out_sp0_ep9_tp3_pp0 -> layer_0_expert_ar_sp0_ep9_pp0
	layer_0_combine_sp0_ep9_pp0 [label="Token Combine L0 SP0 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep9_pp0 -> layer_0_combine_sp0_ep9_pp0
	layer_0_dispatch_sp0_ep10_pp0 [label="Token Dispatch L0 SP0 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep10_pp0 [style=dashed]
	layer_0_expert_sp0_ep10_tp0_pp0 [label="Expert L0 SP0 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep10_pp0 -> layer_0_expert_sp0_ep10_tp0_pp0
	layer_0_expert_out_sp0_ep10_tp0_pp0 [label="Expert Out L0 SP0 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep10_tp0_pp0 -> layer_0_expert_out_sp0_ep10_tp0_pp0
	layer_0_expert_sp0_ep10_tp1_pp0 [label="Expert L0 SP0 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep10_pp0 -> layer_0_expert_sp0_ep10_tp1_pp0
	layer_0_expert_out_sp0_ep10_tp1_pp0 [label="Expert Out L0 SP0 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep10_tp1_pp0 -> layer_0_expert_out_sp0_ep10_tp1_pp0
	layer_0_expert_sp0_ep10_tp2_pp0 [label="Expert L0 SP0 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep10_pp0 -> layer_0_expert_sp0_ep10_tp2_pp0
	layer_0_expert_out_sp0_ep10_tp2_pp0 [label="Expert Out L0 SP0 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep10_tp2_pp0 -> layer_0_expert_out_sp0_ep10_tp2_pp0
	layer_0_expert_sp0_ep10_tp3_pp0 [label="Expert L0 SP0 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep10_pp0 -> layer_0_expert_sp0_ep10_tp3_pp0
	layer_0_expert_out_sp0_ep10_tp3_pp0 [label="Expert Out L0 SP0 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep10_tp3_pp0 -> layer_0_expert_out_sp0_ep10_tp3_pp0
	layer_0_expert_ar_sp0_ep10_pp0 [label="Expert All-Reduce L0 SP0 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep10_tp0_pp0 -> layer_0_expert_ar_sp0_ep10_pp0
	layer_0_expert_out_sp0_ep10_tp1_pp0 -> layer_0_expert_ar_sp0_ep10_pp0
	layer_0_expert_out_sp0_ep10_tp2_pp0 -> layer_0_expert_ar_sp0_ep10_pp0
	layer_0_expert_out_sp0_ep10_tp3_pp0 -> layer_0_expert_ar_sp0_ep10_pp0
	layer_0_combine_sp0_ep10_pp0 [label="Token Combine L0 SP0 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep10_pp0 -> layer_0_combine_sp0_ep10_pp0
	layer_0_dispatch_sp0_ep11_pp0 [label="Token Dispatch L0 SP0 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep11_pp0 [style=dashed]
	layer_0_expert_sp0_ep11_tp0_pp0 [label="Expert L0 SP0 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep11_pp0 -> layer_0_expert_sp0_ep11_tp0_pp0
	layer_0_expert_out_sp0_ep11_tp0_pp0 [label="Expert Out L0 SP0 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep11_tp0_pp0 -> layer_0_expert_out_sp0_ep11_tp0_pp0
	layer_0_expert_sp0_ep11_tp1_pp0 [label="Expert L0 SP0 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep11_pp0 -> layer_0_expert_sp0_ep11_tp1_pp0
	layer_0_expert_out_sp0_ep11_tp1_pp0 [label="Expert Out L0 SP0 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep11_tp1_pp0 -> layer_0_expert_out_sp0_ep11_tp1_pp0
	layer_0_expert_sp0_ep11_tp2_pp0 [label="Expert L0 SP0 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep11_pp0 -> layer_0_expert_sp0_ep11_tp2_pp0
	layer_0_expert_out_sp0_ep11_tp2_pp0 [label="Expert Out L0 SP0 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep11_tp2_pp0 -> layer_0_expert_out_sp0_ep11_tp2_pp0
	layer_0_expert_sp0_ep11_tp3_pp0 [label="Expert L0 SP0 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep11_pp0 -> layer_0_expert_sp0_ep11_tp3_pp0
	layer_0_expert_out_sp0_ep11_tp3_pp0 [label="Expert Out L0 SP0 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep11_tp3_pp0 -> layer_0_expert_out_sp0_ep11_tp3_pp0
	layer_0_expert_ar_sp0_ep11_pp0 [label="Expert All-Reduce L0 SP0 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep11_tp0_pp0 -> layer_0_expert_ar_sp0_ep11_pp0
	layer_0_expert_out_sp0_ep11_tp1_pp0 -> layer_0_expert_ar_sp0_ep11_pp0
	layer_0_expert_out_sp0_ep11_tp2_pp0 -> layer_0_expert_ar_sp0_ep11_pp0
	layer_0_expert_out_sp0_ep11_tp3_pp0 -> layer_0_expert_ar_sp0_ep11_pp0
	layer_0_combine_sp0_ep11_pp0 [label="Token Combine L0 SP0 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep11_pp0 -> layer_0_combine_sp0_ep11_pp0
	layer_0_dispatch_sp0_ep12_pp0 [label="Token Dispatch L0 SP0 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep12_pp0 [style=dashed]
	layer_0_expert_sp0_ep12_tp0_pp0 [label="Expert L0 SP0 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep12_pp0 -> layer_0_expert_sp0_ep12_tp0_pp0
	layer_0_expert_out_sp0_ep12_tp0_pp0 [label="Expert Out L0 SP0 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep12_tp0_pp0 -> layer_0_expert_out_sp0_ep12_tp0_pp0
	layer_0_expert_sp0_ep12_tp1_pp0 [label="Expert L0 SP0 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep12_pp0 -> layer_0_expert_sp0_ep12_tp1_pp0
	layer_0_expert_out_sp0_ep12_tp1_pp0 [label="Expert Out L0 SP0 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep12_tp1_pp0 -> layer_0_expert_out_sp0_ep12_tp1_pp0
	layer_0_expert_sp0_ep12_tp2_pp0 [label="Expert L0 SP0 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep12_pp0 -> layer_0_expert_sp0_ep12_tp2_pp0
	layer_0_expert_out_sp0_ep12_tp2_pp0 [label="Expert Out L0 SP0 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep12_tp2_pp0 -> layer_0_expert_out_sp0_ep12_tp2_pp0
	layer_0_expert_sp0_ep12_tp3_pp0 [label="Expert L0 SP0 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep12_pp0 -> layer_0_expert_sp0_ep12_tp3_pp0
	layer_0_expert_out_sp0_ep12_tp3_pp0 [label="Expert Out L0 SP0 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep12_tp3_pp0 -> layer_0_expert_out_sp0_ep12_tp3_pp0
	layer_0_expert_ar_sp0_ep12_pp0 [label="Expert All-Reduce L0 SP0 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep12_tp0_pp0 -> layer_0_expert_ar_sp0_ep12_pp0
	layer_0_expert_out_sp0_ep12_tp1_pp0 -> layer_0_expert_ar_sp0_ep12_pp0
	layer_0_expert_out_sp0_ep12_tp2_pp0 -> layer_0_expert_ar_sp0_ep12_pp0
	layer_0_expert_out_sp0_ep12_tp3_pp0 -> layer_0_expert_ar_sp0_ep12_pp0
	layer_0_combine_sp0_ep12_pp0 [label="Token Combine L0 SP0 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep12_pp0 -> layer_0_combine_sp0_ep12_pp0
	layer_0_dispatch_sp0_ep13_pp0 [label="Token Dispatch L0 SP0 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep13_pp0 [style=dashed]
	layer_0_expert_sp0_ep13_tp0_pp0 [label="Expert L0 SP0 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep13_pp0 -> layer_0_expert_sp0_ep13_tp0_pp0
	layer_0_expert_out_sp0_ep13_tp0_pp0 [label="Expert Out L0 SP0 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep13_tp0_pp0 -> layer_0_expert_out_sp0_ep13_tp0_pp0
	layer_0_expert_sp0_ep13_tp1_pp0 [label="Expert L0 SP0 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep13_pp0 -> layer_0_expert_sp0_ep13_tp1_pp0
	layer_0_expert_out_sp0_ep13_tp1_pp0 [label="Expert Out L0 SP0 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep13_tp1_pp0 -> layer_0_expert_out_sp0_ep13_tp1_pp0
	layer_0_expert_sp0_ep13_tp2_pp0 [label="Expert L0 SP0 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep13_pp0 -> layer_0_expert_sp0_ep13_tp2_pp0
	layer_0_expert_out_sp0_ep13_tp2_pp0 [label="Expert Out L0 SP0 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep13_tp2_pp0 -> layer_0_expert_out_sp0_ep13_tp2_pp0
	layer_0_expert_sp0_ep13_tp3_pp0 [label="Expert L0 SP0 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep13_pp0 -> layer_0_expert_sp0_ep13_tp3_pp0
	layer_0_expert_out_sp0_ep13_tp3_pp0 [label="Expert Out L0 SP0 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep13_tp3_pp0 -> layer_0_expert_out_sp0_ep13_tp3_pp0
	layer_0_expert_ar_sp0_ep13_pp0 [label="Expert All-Reduce L0 SP0 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep13_tp0_pp0 -> layer_0_expert_ar_sp0_ep13_pp0
	layer_0_expert_out_sp0_ep13_tp1_pp0 -> layer_0_expert_ar_sp0_ep13_pp0
	layer_0_expert_out_sp0_ep13_tp2_pp0 -> layer_0_expert_ar_sp0_ep13_pp0
	layer_0_expert_out_sp0_ep13_tp3_pp0 -> layer_0_expert_ar_sp0_ep13_pp0
	layer_0_combine_sp0_ep13_pp0 [label="Token Combine L0 SP0 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep13_pp0 -> layer_0_combine_sp0_ep13_pp0
	layer_0_dispatch_sp0_ep14_pp0 [label="Token Dispatch L0 SP0 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep14_pp0 [style=dashed]
	layer_0_expert_sp0_ep14_tp0_pp0 [label="Expert L0 SP0 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep14_pp0 -> layer_0_expert_sp0_ep14_tp0_pp0
	layer_0_expert_out_sp0_ep14_tp0_pp0 [label="Expert Out L0 SP0 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep14_tp0_pp0 -> layer_0_expert_out_sp0_ep14_tp0_pp0
	layer_0_expert_sp0_ep14_tp1_pp0 [label="Expert L0 SP0 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep14_pp0 -> layer_0_expert_sp0_ep14_tp1_pp0
	layer_0_expert_out_sp0_ep14_tp1_pp0 [label="Expert Out L0 SP0 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep14_tp1_pp0 -> layer_0_expert_out_sp0_ep14_tp1_pp0
	layer_0_expert_sp0_ep14_tp2_pp0 [label="Expert L0 SP0 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep14_pp0 -> layer_0_expert_sp0_ep14_tp2_pp0
	layer_0_expert_out_sp0_ep14_tp2_pp0 [label="Expert Out L0 SP0 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep14_tp2_pp0 -> layer_0_expert_out_sp0_ep14_tp2_pp0
	layer_0_expert_sp0_ep14_tp3_pp0 [label="Expert L0 SP0 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep14_pp0 -> layer_0_expert_sp0_ep14_tp3_pp0
	layer_0_expert_out_sp0_ep14_tp3_pp0 [label="Expert Out L0 SP0 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep14_tp3_pp0 -> layer_0_expert_out_sp0_ep14_tp3_pp0
	layer_0_expert_ar_sp0_ep14_pp0 [label="Expert All-Reduce L0 SP0 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep14_tp0_pp0 -> layer_0_expert_ar_sp0_ep14_pp0
	layer_0_expert_out_sp0_ep14_tp1_pp0 -> layer_0_expert_ar_sp0_ep14_pp0
	layer_0_expert_out_sp0_ep14_tp2_pp0 -> layer_0_expert_ar_sp0_ep14_pp0
	layer_0_expert_out_sp0_ep14_tp3_pp0 -> layer_0_expert_ar_sp0_ep14_pp0
	layer_0_combine_sp0_ep14_pp0 [label="Token Combine L0 SP0 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep14_pp0 -> layer_0_combine_sp0_ep14_pp0
	layer_0_dispatch_sp0_ep15_pp0 [label="Token Dispatch L0 SP0 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp0_pp0 -> layer_0_dispatch_sp0_ep15_pp0 [style=dashed]
	layer_0_expert_sp0_ep15_tp0_pp0 [label="Expert L0 SP0 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep15_pp0 -> layer_0_expert_sp0_ep15_tp0_pp0
	layer_0_expert_out_sp0_ep15_tp0_pp0 [label="Expert Out L0 SP0 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep15_tp0_pp0 -> layer_0_expert_out_sp0_ep15_tp0_pp0
	layer_0_expert_sp0_ep15_tp1_pp0 [label="Expert L0 SP0 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep15_pp0 -> layer_0_expert_sp0_ep15_tp1_pp0
	layer_0_expert_out_sp0_ep15_tp1_pp0 [label="Expert Out L0 SP0 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep15_tp1_pp0 -> layer_0_expert_out_sp0_ep15_tp1_pp0
	layer_0_expert_sp0_ep15_tp2_pp0 [label="Expert L0 SP0 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep15_pp0 -> layer_0_expert_sp0_ep15_tp2_pp0
	layer_0_expert_out_sp0_ep15_tp2_pp0 [label="Expert Out L0 SP0 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep15_tp2_pp0 -> layer_0_expert_out_sp0_ep15_tp2_pp0
	layer_0_expert_sp0_ep15_tp3_pp0 [label="Expert L0 SP0 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp0_ep15_pp0 -> layer_0_expert_sp0_ep15_tp3_pp0
	layer_0_expert_out_sp0_ep15_tp3_pp0 [label="Expert Out L0 SP0 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp0_ep15_tp3_pp0 -> layer_0_expert_out_sp0_ep15_tp3_pp0
	layer_0_expert_ar_sp0_ep15_pp0 [label="Expert All-Reduce L0 SP0 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp0_ep15_tp0_pp0 -> layer_0_expert_ar_sp0_ep15_pp0
	layer_0_expert_out_sp0_ep15_tp1_pp0 -> layer_0_expert_ar_sp0_ep15_pp0
	layer_0_expert_out_sp0_ep15_tp2_pp0 -> layer_0_expert_ar_sp0_ep15_pp0
	layer_0_expert_out_sp0_ep15_tp3_pp0 -> layer_0_expert_ar_sp0_ep15_pp0
	layer_0_combine_sp0_ep15_pp0 [label="Token Combine L0 SP0 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp0_ep15_pp0 -> layer_0_combine_sp0_ep15_pp0
	layer_0_moe_all2all_sp0_pp0 [label="MoE All-to-All L0 SP0\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_0_combine_sp0_ep0_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep1_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep2_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep3_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep4_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep5_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep6_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep7_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep8_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep9_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep10_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep11_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep12_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep13_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep14_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_combine_sp0_ep15_pp0 -> layer_0_moe_all2all_sp0_pp0
	layer_0_mlp_out_sp0_pp0 [label="MoE Output L0 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_moe_all2all_sp0_pp0 -> layer_0_mlp_out_sp0_pp0
	layer_0_mlp_res_sp0_pp0 [label="MLP Residual L0 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_mlp_out_sp0_pp0 -> layer_0_mlp_res_sp0_pp0
	layer_0_attn_res_sp0_pp0 -> layer_0_mlp_res_sp0_pp0 [style=dashed]
	layer_0_norm_sp1_pp0 [label="LayerNorm L0 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	input_sp0 -> layer_0_norm_sp1_pp0
	input_sp1 -> layer_0_norm_sp1_pp0
	input_sp2 -> layer_0_norm_sp1_pp0
	input_sp3 -> layer_0_norm_sp1_pp0
	layer_0_qkv_sp1_tp0_pp0 [label="QKV Proj L0 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp1_pp0 -> layer_0_qkv_sp1_tp0_pp0
	layer_0_attn_sp1_tp0_pp0 [label="Attention L0 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp1_tp0_pp0 -> layer_0_attn_sp1_tp0_pp0
	layer_0_attn_out_sp1_tp0_pp0 [label="Attn Out Proj L0 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp1_tp0_pp0 -> layer_0_attn_out_sp1_tp0_pp0
	layer_0_qkv_sp1_tp1_pp0 [label="QKV Proj L0 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp1_pp0 -> layer_0_qkv_sp1_tp1_pp0
	layer_0_attn_sp1_tp1_pp0 [label="Attention L0 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp1_tp1_pp0 -> layer_0_attn_sp1_tp1_pp0
	layer_0_attn_out_sp1_tp1_pp0 [label="Attn Out Proj L0 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp1_tp1_pp0 -> layer_0_attn_out_sp1_tp1_pp0
	layer_0_qkv_sp1_tp2_pp0 [label="QKV Proj L0 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp1_pp0 -> layer_0_qkv_sp1_tp2_pp0
	layer_0_attn_sp1_tp2_pp0 [label="Attention L0 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp1_tp2_pp0 -> layer_0_attn_sp1_tp2_pp0
	layer_0_attn_out_sp1_tp2_pp0 [label="Attn Out Proj L0 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp1_tp2_pp0 -> layer_0_attn_out_sp1_tp2_pp0
	layer_0_qkv_sp1_tp3_pp0 [label="QKV Proj L0 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp1_pp0 -> layer_0_qkv_sp1_tp3_pp0
	layer_0_attn_sp1_tp3_pp0 [label="Attention L0 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp1_tp3_pp0 -> layer_0_attn_sp1_tp3_pp0
	layer_0_attn_out_sp1_tp3_pp0 [label="Attn Out Proj L0 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp1_tp3_pp0 -> layer_0_attn_out_sp1_tp3_pp0
	layer_0_attn_ar_sp1_pp0 [label="Attention All-Reduce L0 SP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_attn_out_sp1_tp0_pp0 -> layer_0_attn_ar_sp1_pp0
	layer_0_attn_out_sp1_tp1_pp0 -> layer_0_attn_ar_sp1_pp0
	layer_0_attn_out_sp1_tp2_pp0 -> layer_0_attn_ar_sp1_pp0
	layer_0_attn_out_sp1_tp3_pp0 -> layer_0_attn_ar_sp1_pp0
	layer_0_attn_res_sp1_pp0 [label="Attention Residual L0 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_attn_ar_sp1_pp0 -> layer_0_attn_res_sp1_pp0
	layer_0_norm_sp1_pp0 -> layer_0_attn_res_sp1_pp0 [style=dashed]
	layer_0_post_norm_sp1_pp0 [label="Post-Attn Norm L0 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_attn_res_sp1_pp0 -> layer_0_post_norm_sp1_pp0
	layer_0_router_sp1_pp0 [label="MoE Router L0 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_0_post_norm_sp1_pp0 -> layer_0_router_sp1_pp0
	layer_0_dispatch_sp1_ep0_pp0 [label="Token Dispatch L0 SP1 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep0_pp0 [style=dashed]
	layer_0_expert_sp1_ep0_tp0_pp0 [label="Expert L0 SP1 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep0_pp0 -> layer_0_expert_sp1_ep0_tp0_pp0
	layer_0_expert_out_sp1_ep0_tp0_pp0 [label="Expert Out L0 SP1 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep0_tp0_pp0 -> layer_0_expert_out_sp1_ep0_tp0_pp0
	layer_0_expert_sp1_ep0_tp1_pp0 [label="Expert L0 SP1 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep0_pp0 -> layer_0_expert_sp1_ep0_tp1_pp0
	layer_0_expert_out_sp1_ep0_tp1_pp0 [label="Expert Out L0 SP1 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep0_tp1_pp0 -> layer_0_expert_out_sp1_ep0_tp1_pp0
	layer_0_expert_sp1_ep0_tp2_pp0 [label="Expert L0 SP1 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep0_pp0 -> layer_0_expert_sp1_ep0_tp2_pp0
	layer_0_expert_out_sp1_ep0_tp2_pp0 [label="Expert Out L0 SP1 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep0_tp2_pp0 -> layer_0_expert_out_sp1_ep0_tp2_pp0
	layer_0_expert_sp1_ep0_tp3_pp0 [label="Expert L0 SP1 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep0_pp0 -> layer_0_expert_sp1_ep0_tp3_pp0
	layer_0_expert_out_sp1_ep0_tp3_pp0 [label="Expert Out L0 SP1 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep0_tp3_pp0 -> layer_0_expert_out_sp1_ep0_tp3_pp0
	layer_0_expert_ar_sp1_ep0_pp0 [label="Expert All-Reduce L0 SP1 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep0_tp0_pp0 -> layer_0_expert_ar_sp1_ep0_pp0
	layer_0_expert_out_sp1_ep0_tp1_pp0 -> layer_0_expert_ar_sp1_ep0_pp0
	layer_0_expert_out_sp1_ep0_tp2_pp0 -> layer_0_expert_ar_sp1_ep0_pp0
	layer_0_expert_out_sp1_ep0_tp3_pp0 -> layer_0_expert_ar_sp1_ep0_pp0
	layer_0_combine_sp1_ep0_pp0 [label="Token Combine L0 SP1 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep0_pp0 -> layer_0_combine_sp1_ep0_pp0
	layer_0_dispatch_sp1_ep1_pp0 [label="Token Dispatch L0 SP1 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep1_pp0 [style=dashed]
	layer_0_expert_sp1_ep1_tp0_pp0 [label="Expert L0 SP1 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep1_pp0 -> layer_0_expert_sp1_ep1_tp0_pp0
	layer_0_expert_out_sp1_ep1_tp0_pp0 [label="Expert Out L0 SP1 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep1_tp0_pp0 -> layer_0_expert_out_sp1_ep1_tp0_pp0
	layer_0_expert_sp1_ep1_tp1_pp0 [label="Expert L0 SP1 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep1_pp0 -> layer_0_expert_sp1_ep1_tp1_pp0
	layer_0_expert_out_sp1_ep1_tp1_pp0 [label="Expert Out L0 SP1 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep1_tp1_pp0 -> layer_0_expert_out_sp1_ep1_tp1_pp0
	layer_0_expert_sp1_ep1_tp2_pp0 [label="Expert L0 SP1 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep1_pp0 -> layer_0_expert_sp1_ep1_tp2_pp0
	layer_0_expert_out_sp1_ep1_tp2_pp0 [label="Expert Out L0 SP1 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep1_tp2_pp0 -> layer_0_expert_out_sp1_ep1_tp2_pp0
	layer_0_expert_sp1_ep1_tp3_pp0 [label="Expert L0 SP1 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep1_pp0 -> layer_0_expert_sp1_ep1_tp3_pp0
	layer_0_expert_out_sp1_ep1_tp3_pp0 [label="Expert Out L0 SP1 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep1_tp3_pp0 -> layer_0_expert_out_sp1_ep1_tp3_pp0
	layer_0_expert_ar_sp1_ep1_pp0 [label="Expert All-Reduce L0 SP1 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep1_tp0_pp0 -> layer_0_expert_ar_sp1_ep1_pp0
	layer_0_expert_out_sp1_ep1_tp1_pp0 -> layer_0_expert_ar_sp1_ep1_pp0
	layer_0_expert_out_sp1_ep1_tp2_pp0 -> layer_0_expert_ar_sp1_ep1_pp0
	layer_0_expert_out_sp1_ep1_tp3_pp0 -> layer_0_expert_ar_sp1_ep1_pp0
	layer_0_combine_sp1_ep1_pp0 [label="Token Combine L0 SP1 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep1_pp0 -> layer_0_combine_sp1_ep1_pp0
	layer_0_dispatch_sp1_ep2_pp0 [label="Token Dispatch L0 SP1 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep2_pp0 [style=dashed]
	layer_0_expert_sp1_ep2_tp0_pp0 [label="Expert L0 SP1 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep2_pp0 -> layer_0_expert_sp1_ep2_tp0_pp0
	layer_0_expert_out_sp1_ep2_tp0_pp0 [label="Expert Out L0 SP1 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep2_tp0_pp0 -> layer_0_expert_out_sp1_ep2_tp0_pp0
	layer_0_expert_sp1_ep2_tp1_pp0 [label="Expert L0 SP1 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep2_pp0 -> layer_0_expert_sp1_ep2_tp1_pp0
	layer_0_expert_out_sp1_ep2_tp1_pp0 [label="Expert Out L0 SP1 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep2_tp1_pp0 -> layer_0_expert_out_sp1_ep2_tp1_pp0
	layer_0_expert_sp1_ep2_tp2_pp0 [label="Expert L0 SP1 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep2_pp0 -> layer_0_expert_sp1_ep2_tp2_pp0
	layer_0_expert_out_sp1_ep2_tp2_pp0 [label="Expert Out L0 SP1 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep2_tp2_pp0 -> layer_0_expert_out_sp1_ep2_tp2_pp0
	layer_0_expert_sp1_ep2_tp3_pp0 [label="Expert L0 SP1 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep2_pp0 -> layer_0_expert_sp1_ep2_tp3_pp0
	layer_0_expert_out_sp1_ep2_tp3_pp0 [label="Expert Out L0 SP1 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep2_tp3_pp0 -> layer_0_expert_out_sp1_ep2_tp3_pp0
	layer_0_expert_ar_sp1_ep2_pp0 [label="Expert All-Reduce L0 SP1 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep2_tp0_pp0 -> layer_0_expert_ar_sp1_ep2_pp0
	layer_0_expert_out_sp1_ep2_tp1_pp0 -> layer_0_expert_ar_sp1_ep2_pp0
	layer_0_expert_out_sp1_ep2_tp2_pp0 -> layer_0_expert_ar_sp1_ep2_pp0
	layer_0_expert_out_sp1_ep2_tp3_pp0 -> layer_0_expert_ar_sp1_ep2_pp0
	layer_0_combine_sp1_ep2_pp0 [label="Token Combine L0 SP1 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep2_pp0 -> layer_0_combine_sp1_ep2_pp0
	layer_0_dispatch_sp1_ep3_pp0 [label="Token Dispatch L0 SP1 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep3_pp0 [style=dashed]
	layer_0_expert_sp1_ep3_tp0_pp0 [label="Expert L0 SP1 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep3_pp0 -> layer_0_expert_sp1_ep3_tp0_pp0
	layer_0_expert_out_sp1_ep3_tp0_pp0 [label="Expert Out L0 SP1 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep3_tp0_pp0 -> layer_0_expert_out_sp1_ep3_tp0_pp0
	layer_0_expert_sp1_ep3_tp1_pp0 [label="Expert L0 SP1 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep3_pp0 -> layer_0_expert_sp1_ep3_tp1_pp0
	layer_0_expert_out_sp1_ep3_tp1_pp0 [label="Expert Out L0 SP1 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep3_tp1_pp0 -> layer_0_expert_out_sp1_ep3_tp1_pp0
	layer_0_expert_sp1_ep3_tp2_pp0 [label="Expert L0 SP1 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep3_pp0 -> layer_0_expert_sp1_ep3_tp2_pp0
	layer_0_expert_out_sp1_ep3_tp2_pp0 [label="Expert Out L0 SP1 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep3_tp2_pp0 -> layer_0_expert_out_sp1_ep3_tp2_pp0
	layer_0_expert_sp1_ep3_tp3_pp0 [label="Expert L0 SP1 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep3_pp0 -> layer_0_expert_sp1_ep3_tp3_pp0
	layer_0_expert_out_sp1_ep3_tp3_pp0 [label="Expert Out L0 SP1 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep3_tp3_pp0 -> layer_0_expert_out_sp1_ep3_tp3_pp0
	layer_0_expert_ar_sp1_ep3_pp0 [label="Expert All-Reduce L0 SP1 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep3_tp0_pp0 -> layer_0_expert_ar_sp1_ep3_pp0
	layer_0_expert_out_sp1_ep3_tp1_pp0 -> layer_0_expert_ar_sp1_ep3_pp0
	layer_0_expert_out_sp1_ep3_tp2_pp0 -> layer_0_expert_ar_sp1_ep3_pp0
	layer_0_expert_out_sp1_ep3_tp3_pp0 -> layer_0_expert_ar_sp1_ep3_pp0
	layer_0_combine_sp1_ep3_pp0 [label="Token Combine L0 SP1 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep3_pp0 -> layer_0_combine_sp1_ep3_pp0
	layer_0_dispatch_sp1_ep4_pp0 [label="Token Dispatch L0 SP1 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep4_pp0 [style=dashed]
	layer_0_expert_sp1_ep4_tp0_pp0 [label="Expert L0 SP1 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep4_pp0 -> layer_0_expert_sp1_ep4_tp0_pp0
	layer_0_expert_out_sp1_ep4_tp0_pp0 [label="Expert Out L0 SP1 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep4_tp0_pp0 -> layer_0_expert_out_sp1_ep4_tp0_pp0
	layer_0_expert_sp1_ep4_tp1_pp0 [label="Expert L0 SP1 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep4_pp0 -> layer_0_expert_sp1_ep4_tp1_pp0
	layer_0_expert_out_sp1_ep4_tp1_pp0 [label="Expert Out L0 SP1 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep4_tp1_pp0 -> layer_0_expert_out_sp1_ep4_tp1_pp0
	layer_0_expert_sp1_ep4_tp2_pp0 [label="Expert L0 SP1 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep4_pp0 -> layer_0_expert_sp1_ep4_tp2_pp0
	layer_0_expert_out_sp1_ep4_tp2_pp0 [label="Expert Out L0 SP1 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep4_tp2_pp0 -> layer_0_expert_out_sp1_ep4_tp2_pp0
	layer_0_expert_sp1_ep4_tp3_pp0 [label="Expert L0 SP1 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep4_pp0 -> layer_0_expert_sp1_ep4_tp3_pp0
	layer_0_expert_out_sp1_ep4_tp3_pp0 [label="Expert Out L0 SP1 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep4_tp3_pp0 -> layer_0_expert_out_sp1_ep4_tp3_pp0
	layer_0_expert_ar_sp1_ep4_pp0 [label="Expert All-Reduce L0 SP1 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep4_tp0_pp0 -> layer_0_expert_ar_sp1_ep4_pp0
	layer_0_expert_out_sp1_ep4_tp1_pp0 -> layer_0_expert_ar_sp1_ep4_pp0
	layer_0_expert_out_sp1_ep4_tp2_pp0 -> layer_0_expert_ar_sp1_ep4_pp0
	layer_0_expert_out_sp1_ep4_tp3_pp0 -> layer_0_expert_ar_sp1_ep4_pp0
	layer_0_combine_sp1_ep4_pp0 [label="Token Combine L0 SP1 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep4_pp0 -> layer_0_combine_sp1_ep4_pp0
	layer_0_dispatch_sp1_ep5_pp0 [label="Token Dispatch L0 SP1 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep5_pp0 [style=dashed]
	layer_0_expert_sp1_ep5_tp0_pp0 [label="Expert L0 SP1 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep5_pp0 -> layer_0_expert_sp1_ep5_tp0_pp0
	layer_0_expert_out_sp1_ep5_tp0_pp0 [label="Expert Out L0 SP1 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep5_tp0_pp0 -> layer_0_expert_out_sp1_ep5_tp0_pp0
	layer_0_expert_sp1_ep5_tp1_pp0 [label="Expert L0 SP1 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep5_pp0 -> layer_0_expert_sp1_ep5_tp1_pp0
	layer_0_expert_out_sp1_ep5_tp1_pp0 [label="Expert Out L0 SP1 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep5_tp1_pp0 -> layer_0_expert_out_sp1_ep5_tp1_pp0
	layer_0_expert_sp1_ep5_tp2_pp0 [label="Expert L0 SP1 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep5_pp0 -> layer_0_expert_sp1_ep5_tp2_pp0
	layer_0_expert_out_sp1_ep5_tp2_pp0 [label="Expert Out L0 SP1 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep5_tp2_pp0 -> layer_0_expert_out_sp1_ep5_tp2_pp0
	layer_0_expert_sp1_ep5_tp3_pp0 [label="Expert L0 SP1 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep5_pp0 -> layer_0_expert_sp1_ep5_tp3_pp0
	layer_0_expert_out_sp1_ep5_tp3_pp0 [label="Expert Out L0 SP1 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep5_tp3_pp0 -> layer_0_expert_out_sp1_ep5_tp3_pp0
	layer_0_expert_ar_sp1_ep5_pp0 [label="Expert All-Reduce L0 SP1 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep5_tp0_pp0 -> layer_0_expert_ar_sp1_ep5_pp0
	layer_0_expert_out_sp1_ep5_tp1_pp0 -> layer_0_expert_ar_sp1_ep5_pp0
	layer_0_expert_out_sp1_ep5_tp2_pp0 -> layer_0_expert_ar_sp1_ep5_pp0
	layer_0_expert_out_sp1_ep5_tp3_pp0 -> layer_0_expert_ar_sp1_ep5_pp0
	layer_0_combine_sp1_ep5_pp0 [label="Token Combine L0 SP1 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep5_pp0 -> layer_0_combine_sp1_ep5_pp0
	layer_0_dispatch_sp1_ep6_pp0 [label="Token Dispatch L0 SP1 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep6_pp0 [style=dashed]
	layer_0_expert_sp1_ep6_tp0_pp0 [label="Expert L0 SP1 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep6_pp0 -> layer_0_expert_sp1_ep6_tp0_pp0
	layer_0_expert_out_sp1_ep6_tp0_pp0 [label="Expert Out L0 SP1 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep6_tp0_pp0 -> layer_0_expert_out_sp1_ep6_tp0_pp0
	layer_0_expert_sp1_ep6_tp1_pp0 [label="Expert L0 SP1 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep6_pp0 -> layer_0_expert_sp1_ep6_tp1_pp0
	layer_0_expert_out_sp1_ep6_tp1_pp0 [label="Expert Out L0 SP1 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep6_tp1_pp0 -> layer_0_expert_out_sp1_ep6_tp1_pp0
	layer_0_expert_sp1_ep6_tp2_pp0 [label="Expert L0 SP1 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep6_pp0 -> layer_0_expert_sp1_ep6_tp2_pp0
	layer_0_expert_out_sp1_ep6_tp2_pp0 [label="Expert Out L0 SP1 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep6_tp2_pp0 -> layer_0_expert_out_sp1_ep6_tp2_pp0
	layer_0_expert_sp1_ep6_tp3_pp0 [label="Expert L0 SP1 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep6_pp0 -> layer_0_expert_sp1_ep6_tp3_pp0
	layer_0_expert_out_sp1_ep6_tp3_pp0 [label="Expert Out L0 SP1 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep6_tp3_pp0 -> layer_0_expert_out_sp1_ep6_tp3_pp0
	layer_0_expert_ar_sp1_ep6_pp0 [label="Expert All-Reduce L0 SP1 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep6_tp0_pp0 -> layer_0_expert_ar_sp1_ep6_pp0
	layer_0_expert_out_sp1_ep6_tp1_pp0 -> layer_0_expert_ar_sp1_ep6_pp0
	layer_0_expert_out_sp1_ep6_tp2_pp0 -> layer_0_expert_ar_sp1_ep6_pp0
	layer_0_expert_out_sp1_ep6_tp3_pp0 -> layer_0_expert_ar_sp1_ep6_pp0
	layer_0_combine_sp1_ep6_pp0 [label="Token Combine L0 SP1 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep6_pp0 -> layer_0_combine_sp1_ep6_pp0
	layer_0_dispatch_sp1_ep7_pp0 [label="Token Dispatch L0 SP1 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep7_pp0 [style=dashed]
	layer_0_expert_sp1_ep7_tp0_pp0 [label="Expert L0 SP1 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep7_pp0 -> layer_0_expert_sp1_ep7_tp0_pp0
	layer_0_expert_out_sp1_ep7_tp0_pp0 [label="Expert Out L0 SP1 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep7_tp0_pp0 -> layer_0_expert_out_sp1_ep7_tp0_pp0
	layer_0_expert_sp1_ep7_tp1_pp0 [label="Expert L0 SP1 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep7_pp0 -> layer_0_expert_sp1_ep7_tp1_pp0
	layer_0_expert_out_sp1_ep7_tp1_pp0 [label="Expert Out L0 SP1 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep7_tp1_pp0 -> layer_0_expert_out_sp1_ep7_tp1_pp0
	layer_0_expert_sp1_ep7_tp2_pp0 [label="Expert L0 SP1 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep7_pp0 -> layer_0_expert_sp1_ep7_tp2_pp0
	layer_0_expert_out_sp1_ep7_tp2_pp0 [label="Expert Out L0 SP1 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep7_tp2_pp0 -> layer_0_expert_out_sp1_ep7_tp2_pp0
	layer_0_expert_sp1_ep7_tp3_pp0 [label="Expert L0 SP1 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep7_pp0 -> layer_0_expert_sp1_ep7_tp3_pp0
	layer_0_expert_out_sp1_ep7_tp3_pp0 [label="Expert Out L0 SP1 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep7_tp3_pp0 -> layer_0_expert_out_sp1_ep7_tp3_pp0
	layer_0_expert_ar_sp1_ep7_pp0 [label="Expert All-Reduce L0 SP1 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep7_tp0_pp0 -> layer_0_expert_ar_sp1_ep7_pp0
	layer_0_expert_out_sp1_ep7_tp1_pp0 -> layer_0_expert_ar_sp1_ep7_pp0
	layer_0_expert_out_sp1_ep7_tp2_pp0 -> layer_0_expert_ar_sp1_ep7_pp0
	layer_0_expert_out_sp1_ep7_tp3_pp0 -> layer_0_expert_ar_sp1_ep7_pp0
	layer_0_combine_sp1_ep7_pp0 [label="Token Combine L0 SP1 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep7_pp0 -> layer_0_combine_sp1_ep7_pp0
	layer_0_dispatch_sp1_ep8_pp0 [label="Token Dispatch L0 SP1 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep8_pp0 [style=dashed]
	layer_0_expert_sp1_ep8_tp0_pp0 [label="Expert L0 SP1 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep8_pp0 -> layer_0_expert_sp1_ep8_tp0_pp0
	layer_0_expert_out_sp1_ep8_tp0_pp0 [label="Expert Out L0 SP1 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep8_tp0_pp0 -> layer_0_expert_out_sp1_ep8_tp0_pp0
	layer_0_expert_sp1_ep8_tp1_pp0 [label="Expert L0 SP1 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep8_pp0 -> layer_0_expert_sp1_ep8_tp1_pp0
	layer_0_expert_out_sp1_ep8_tp1_pp0 [label="Expert Out L0 SP1 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep8_tp1_pp0 -> layer_0_expert_out_sp1_ep8_tp1_pp0
	layer_0_expert_sp1_ep8_tp2_pp0 [label="Expert L0 SP1 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep8_pp0 -> layer_0_expert_sp1_ep8_tp2_pp0
	layer_0_expert_out_sp1_ep8_tp2_pp0 [label="Expert Out L0 SP1 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep8_tp2_pp0 -> layer_0_expert_out_sp1_ep8_tp2_pp0
	layer_0_expert_sp1_ep8_tp3_pp0 [label="Expert L0 SP1 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep8_pp0 -> layer_0_expert_sp1_ep8_tp3_pp0
	layer_0_expert_out_sp1_ep8_tp3_pp0 [label="Expert Out L0 SP1 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep8_tp3_pp0 -> layer_0_expert_out_sp1_ep8_tp3_pp0
	layer_0_expert_ar_sp1_ep8_pp0 [label="Expert All-Reduce L0 SP1 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep8_tp0_pp0 -> layer_0_expert_ar_sp1_ep8_pp0
	layer_0_expert_out_sp1_ep8_tp1_pp0 -> layer_0_expert_ar_sp1_ep8_pp0
	layer_0_expert_out_sp1_ep8_tp2_pp0 -> layer_0_expert_ar_sp1_ep8_pp0
	layer_0_expert_out_sp1_ep8_tp3_pp0 -> layer_0_expert_ar_sp1_ep8_pp0
	layer_0_combine_sp1_ep8_pp0 [label="Token Combine L0 SP1 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep8_pp0 -> layer_0_combine_sp1_ep8_pp0
	layer_0_dispatch_sp1_ep9_pp0 [label="Token Dispatch L0 SP1 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep9_pp0 [style=dashed]
	layer_0_expert_sp1_ep9_tp0_pp0 [label="Expert L0 SP1 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep9_pp0 -> layer_0_expert_sp1_ep9_tp0_pp0
	layer_0_expert_out_sp1_ep9_tp0_pp0 [label="Expert Out L0 SP1 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep9_tp0_pp0 -> layer_0_expert_out_sp1_ep9_tp0_pp0
	layer_0_expert_sp1_ep9_tp1_pp0 [label="Expert L0 SP1 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep9_pp0 -> layer_0_expert_sp1_ep9_tp1_pp0
	layer_0_expert_out_sp1_ep9_tp1_pp0 [label="Expert Out L0 SP1 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep9_tp1_pp0 -> layer_0_expert_out_sp1_ep9_tp1_pp0
	layer_0_expert_sp1_ep9_tp2_pp0 [label="Expert L0 SP1 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep9_pp0 -> layer_0_expert_sp1_ep9_tp2_pp0
	layer_0_expert_out_sp1_ep9_tp2_pp0 [label="Expert Out L0 SP1 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep9_tp2_pp0 -> layer_0_expert_out_sp1_ep9_tp2_pp0
	layer_0_expert_sp1_ep9_tp3_pp0 [label="Expert L0 SP1 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep9_pp0 -> layer_0_expert_sp1_ep9_tp3_pp0
	layer_0_expert_out_sp1_ep9_tp3_pp0 [label="Expert Out L0 SP1 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep9_tp3_pp0 -> layer_0_expert_out_sp1_ep9_tp3_pp0
	layer_0_expert_ar_sp1_ep9_pp0 [label="Expert All-Reduce L0 SP1 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep9_tp0_pp0 -> layer_0_expert_ar_sp1_ep9_pp0
	layer_0_expert_out_sp1_ep9_tp1_pp0 -> layer_0_expert_ar_sp1_ep9_pp0
	layer_0_expert_out_sp1_ep9_tp2_pp0 -> layer_0_expert_ar_sp1_ep9_pp0
	layer_0_expert_out_sp1_ep9_tp3_pp0 -> layer_0_expert_ar_sp1_ep9_pp0
	layer_0_combine_sp1_ep9_pp0 [label="Token Combine L0 SP1 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep9_pp0 -> layer_0_combine_sp1_ep9_pp0
	layer_0_dispatch_sp1_ep10_pp0 [label="Token Dispatch L0 SP1 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep10_pp0 [style=dashed]
	layer_0_expert_sp1_ep10_tp0_pp0 [label="Expert L0 SP1 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep10_pp0 -> layer_0_expert_sp1_ep10_tp0_pp0
	layer_0_expert_out_sp1_ep10_tp0_pp0 [label="Expert Out L0 SP1 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep10_tp0_pp0 -> layer_0_expert_out_sp1_ep10_tp0_pp0
	layer_0_expert_sp1_ep10_tp1_pp0 [label="Expert L0 SP1 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep10_pp0 -> layer_0_expert_sp1_ep10_tp1_pp0
	layer_0_expert_out_sp1_ep10_tp1_pp0 [label="Expert Out L0 SP1 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep10_tp1_pp0 -> layer_0_expert_out_sp1_ep10_tp1_pp0
	layer_0_expert_sp1_ep10_tp2_pp0 [label="Expert L0 SP1 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep10_pp0 -> layer_0_expert_sp1_ep10_tp2_pp0
	layer_0_expert_out_sp1_ep10_tp2_pp0 [label="Expert Out L0 SP1 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep10_tp2_pp0 -> layer_0_expert_out_sp1_ep10_tp2_pp0
	layer_0_expert_sp1_ep10_tp3_pp0 [label="Expert L0 SP1 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep10_pp0 -> layer_0_expert_sp1_ep10_tp3_pp0
	layer_0_expert_out_sp1_ep10_tp3_pp0 [label="Expert Out L0 SP1 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep10_tp3_pp0 -> layer_0_expert_out_sp1_ep10_tp3_pp0
	layer_0_expert_ar_sp1_ep10_pp0 [label="Expert All-Reduce L0 SP1 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep10_tp0_pp0 -> layer_0_expert_ar_sp1_ep10_pp0
	layer_0_expert_out_sp1_ep10_tp1_pp0 -> layer_0_expert_ar_sp1_ep10_pp0
	layer_0_expert_out_sp1_ep10_tp2_pp0 -> layer_0_expert_ar_sp1_ep10_pp0
	layer_0_expert_out_sp1_ep10_tp3_pp0 -> layer_0_expert_ar_sp1_ep10_pp0
	layer_0_combine_sp1_ep10_pp0 [label="Token Combine L0 SP1 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep10_pp0 -> layer_0_combine_sp1_ep10_pp0
	layer_0_dispatch_sp1_ep11_pp0 [label="Token Dispatch L0 SP1 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep11_pp0 [style=dashed]
	layer_0_expert_sp1_ep11_tp0_pp0 [label="Expert L0 SP1 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep11_pp0 -> layer_0_expert_sp1_ep11_tp0_pp0
	layer_0_expert_out_sp1_ep11_tp0_pp0 [label="Expert Out L0 SP1 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep11_tp0_pp0 -> layer_0_expert_out_sp1_ep11_tp0_pp0
	layer_0_expert_sp1_ep11_tp1_pp0 [label="Expert L0 SP1 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep11_pp0 -> layer_0_expert_sp1_ep11_tp1_pp0
	layer_0_expert_out_sp1_ep11_tp1_pp0 [label="Expert Out L0 SP1 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep11_tp1_pp0 -> layer_0_expert_out_sp1_ep11_tp1_pp0
	layer_0_expert_sp1_ep11_tp2_pp0 [label="Expert L0 SP1 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep11_pp0 -> layer_0_expert_sp1_ep11_tp2_pp0
	layer_0_expert_out_sp1_ep11_tp2_pp0 [label="Expert Out L0 SP1 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep11_tp2_pp0 -> layer_0_expert_out_sp1_ep11_tp2_pp0
	layer_0_expert_sp1_ep11_tp3_pp0 [label="Expert L0 SP1 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep11_pp0 -> layer_0_expert_sp1_ep11_tp3_pp0
	layer_0_expert_out_sp1_ep11_tp3_pp0 [label="Expert Out L0 SP1 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep11_tp3_pp0 -> layer_0_expert_out_sp1_ep11_tp3_pp0
	layer_0_expert_ar_sp1_ep11_pp0 [label="Expert All-Reduce L0 SP1 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep11_tp0_pp0 -> layer_0_expert_ar_sp1_ep11_pp0
	layer_0_expert_out_sp1_ep11_tp1_pp0 -> layer_0_expert_ar_sp1_ep11_pp0
	layer_0_expert_out_sp1_ep11_tp2_pp0 -> layer_0_expert_ar_sp1_ep11_pp0
	layer_0_expert_out_sp1_ep11_tp3_pp0 -> layer_0_expert_ar_sp1_ep11_pp0
	layer_0_combine_sp1_ep11_pp0 [label="Token Combine L0 SP1 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep11_pp0 -> layer_0_combine_sp1_ep11_pp0
	layer_0_dispatch_sp1_ep12_pp0 [label="Token Dispatch L0 SP1 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep12_pp0 [style=dashed]
	layer_0_expert_sp1_ep12_tp0_pp0 [label="Expert L0 SP1 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep12_pp0 -> layer_0_expert_sp1_ep12_tp0_pp0
	layer_0_expert_out_sp1_ep12_tp0_pp0 [label="Expert Out L0 SP1 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep12_tp0_pp0 -> layer_0_expert_out_sp1_ep12_tp0_pp0
	layer_0_expert_sp1_ep12_tp1_pp0 [label="Expert L0 SP1 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep12_pp0 -> layer_0_expert_sp1_ep12_tp1_pp0
	layer_0_expert_out_sp1_ep12_tp1_pp0 [label="Expert Out L0 SP1 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep12_tp1_pp0 -> layer_0_expert_out_sp1_ep12_tp1_pp0
	layer_0_expert_sp1_ep12_tp2_pp0 [label="Expert L0 SP1 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep12_pp0 -> layer_0_expert_sp1_ep12_tp2_pp0
	layer_0_expert_out_sp1_ep12_tp2_pp0 [label="Expert Out L0 SP1 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep12_tp2_pp0 -> layer_0_expert_out_sp1_ep12_tp2_pp0
	layer_0_expert_sp1_ep12_tp3_pp0 [label="Expert L0 SP1 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep12_pp0 -> layer_0_expert_sp1_ep12_tp3_pp0
	layer_0_expert_out_sp1_ep12_tp3_pp0 [label="Expert Out L0 SP1 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep12_tp3_pp0 -> layer_0_expert_out_sp1_ep12_tp3_pp0
	layer_0_expert_ar_sp1_ep12_pp0 [label="Expert All-Reduce L0 SP1 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep12_tp0_pp0 -> layer_0_expert_ar_sp1_ep12_pp0
	layer_0_expert_out_sp1_ep12_tp1_pp0 -> layer_0_expert_ar_sp1_ep12_pp0
	layer_0_expert_out_sp1_ep12_tp2_pp0 -> layer_0_expert_ar_sp1_ep12_pp0
	layer_0_expert_out_sp1_ep12_tp3_pp0 -> layer_0_expert_ar_sp1_ep12_pp0
	layer_0_combine_sp1_ep12_pp0 [label="Token Combine L0 SP1 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep12_pp0 -> layer_0_combine_sp1_ep12_pp0
	layer_0_dispatch_sp1_ep13_pp0 [label="Token Dispatch L0 SP1 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep13_pp0 [style=dashed]
	layer_0_expert_sp1_ep13_tp0_pp0 [label="Expert L0 SP1 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep13_pp0 -> layer_0_expert_sp1_ep13_tp0_pp0
	layer_0_expert_out_sp1_ep13_tp0_pp0 [label="Expert Out L0 SP1 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep13_tp0_pp0 -> layer_0_expert_out_sp1_ep13_tp0_pp0
	layer_0_expert_sp1_ep13_tp1_pp0 [label="Expert L0 SP1 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep13_pp0 -> layer_0_expert_sp1_ep13_tp1_pp0
	layer_0_expert_out_sp1_ep13_tp1_pp0 [label="Expert Out L0 SP1 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep13_tp1_pp0 -> layer_0_expert_out_sp1_ep13_tp1_pp0
	layer_0_expert_sp1_ep13_tp2_pp0 [label="Expert L0 SP1 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep13_pp0 -> layer_0_expert_sp1_ep13_tp2_pp0
	layer_0_expert_out_sp1_ep13_tp2_pp0 [label="Expert Out L0 SP1 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep13_tp2_pp0 -> layer_0_expert_out_sp1_ep13_tp2_pp0
	layer_0_expert_sp1_ep13_tp3_pp0 [label="Expert L0 SP1 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep13_pp0 -> layer_0_expert_sp1_ep13_tp3_pp0
	layer_0_expert_out_sp1_ep13_tp3_pp0 [label="Expert Out L0 SP1 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep13_tp3_pp0 -> layer_0_expert_out_sp1_ep13_tp3_pp0
	layer_0_expert_ar_sp1_ep13_pp0 [label="Expert All-Reduce L0 SP1 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep13_tp0_pp0 -> layer_0_expert_ar_sp1_ep13_pp0
	layer_0_expert_out_sp1_ep13_tp1_pp0 -> layer_0_expert_ar_sp1_ep13_pp0
	layer_0_expert_out_sp1_ep13_tp2_pp0 -> layer_0_expert_ar_sp1_ep13_pp0
	layer_0_expert_out_sp1_ep13_tp3_pp0 -> layer_0_expert_ar_sp1_ep13_pp0
	layer_0_combine_sp1_ep13_pp0 [label="Token Combine L0 SP1 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep13_pp0 -> layer_0_combine_sp1_ep13_pp0
	layer_0_dispatch_sp1_ep14_pp0 [label="Token Dispatch L0 SP1 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep14_pp0 [style=dashed]
	layer_0_expert_sp1_ep14_tp0_pp0 [label="Expert L0 SP1 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep14_pp0 -> layer_0_expert_sp1_ep14_tp0_pp0
	layer_0_expert_out_sp1_ep14_tp0_pp0 [label="Expert Out L0 SP1 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep14_tp0_pp0 -> layer_0_expert_out_sp1_ep14_tp0_pp0
	layer_0_expert_sp1_ep14_tp1_pp0 [label="Expert L0 SP1 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep14_pp0 -> layer_0_expert_sp1_ep14_tp1_pp0
	layer_0_expert_out_sp1_ep14_tp1_pp0 [label="Expert Out L0 SP1 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep14_tp1_pp0 -> layer_0_expert_out_sp1_ep14_tp1_pp0
	layer_0_expert_sp1_ep14_tp2_pp0 [label="Expert L0 SP1 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep14_pp0 -> layer_0_expert_sp1_ep14_tp2_pp0
	layer_0_expert_out_sp1_ep14_tp2_pp0 [label="Expert Out L0 SP1 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep14_tp2_pp0 -> layer_0_expert_out_sp1_ep14_tp2_pp0
	layer_0_expert_sp1_ep14_tp3_pp0 [label="Expert L0 SP1 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep14_pp0 -> layer_0_expert_sp1_ep14_tp3_pp0
	layer_0_expert_out_sp1_ep14_tp3_pp0 [label="Expert Out L0 SP1 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep14_tp3_pp0 -> layer_0_expert_out_sp1_ep14_tp3_pp0
	layer_0_expert_ar_sp1_ep14_pp0 [label="Expert All-Reduce L0 SP1 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep14_tp0_pp0 -> layer_0_expert_ar_sp1_ep14_pp0
	layer_0_expert_out_sp1_ep14_tp1_pp0 -> layer_0_expert_ar_sp1_ep14_pp0
	layer_0_expert_out_sp1_ep14_tp2_pp0 -> layer_0_expert_ar_sp1_ep14_pp0
	layer_0_expert_out_sp1_ep14_tp3_pp0 -> layer_0_expert_ar_sp1_ep14_pp0
	layer_0_combine_sp1_ep14_pp0 [label="Token Combine L0 SP1 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep14_pp0 -> layer_0_combine_sp1_ep14_pp0
	layer_0_dispatch_sp1_ep15_pp0 [label="Token Dispatch L0 SP1 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp1_pp0 -> layer_0_dispatch_sp1_ep15_pp0 [style=dashed]
	layer_0_expert_sp1_ep15_tp0_pp0 [label="Expert L0 SP1 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep15_pp0 -> layer_0_expert_sp1_ep15_tp0_pp0
	layer_0_expert_out_sp1_ep15_tp0_pp0 [label="Expert Out L0 SP1 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep15_tp0_pp0 -> layer_0_expert_out_sp1_ep15_tp0_pp0
	layer_0_expert_sp1_ep15_tp1_pp0 [label="Expert L0 SP1 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep15_pp0 -> layer_0_expert_sp1_ep15_tp1_pp0
	layer_0_expert_out_sp1_ep15_tp1_pp0 [label="Expert Out L0 SP1 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep15_tp1_pp0 -> layer_0_expert_out_sp1_ep15_tp1_pp0
	layer_0_expert_sp1_ep15_tp2_pp0 [label="Expert L0 SP1 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep15_pp0 -> layer_0_expert_sp1_ep15_tp2_pp0
	layer_0_expert_out_sp1_ep15_tp2_pp0 [label="Expert Out L0 SP1 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep15_tp2_pp0 -> layer_0_expert_out_sp1_ep15_tp2_pp0
	layer_0_expert_sp1_ep15_tp3_pp0 [label="Expert L0 SP1 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp1_ep15_pp0 -> layer_0_expert_sp1_ep15_tp3_pp0
	layer_0_expert_out_sp1_ep15_tp3_pp0 [label="Expert Out L0 SP1 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp1_ep15_tp3_pp0 -> layer_0_expert_out_sp1_ep15_tp3_pp0
	layer_0_expert_ar_sp1_ep15_pp0 [label="Expert All-Reduce L0 SP1 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp1_ep15_tp0_pp0 -> layer_0_expert_ar_sp1_ep15_pp0
	layer_0_expert_out_sp1_ep15_tp1_pp0 -> layer_0_expert_ar_sp1_ep15_pp0
	layer_0_expert_out_sp1_ep15_tp2_pp0 -> layer_0_expert_ar_sp1_ep15_pp0
	layer_0_expert_out_sp1_ep15_tp3_pp0 -> layer_0_expert_ar_sp1_ep15_pp0
	layer_0_combine_sp1_ep15_pp0 [label="Token Combine L0 SP1 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp1_ep15_pp0 -> layer_0_combine_sp1_ep15_pp0
	layer_0_moe_all2all_sp1_pp0 [label="MoE All-to-All L0 SP1\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_0_combine_sp1_ep0_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep1_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep2_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep3_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep4_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep5_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep6_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep7_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep8_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep9_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep10_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep11_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep12_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep13_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep14_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_combine_sp1_ep15_pp0 -> layer_0_moe_all2all_sp1_pp0
	layer_0_mlp_out_sp1_pp0 [label="MoE Output L0 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_moe_all2all_sp1_pp0 -> layer_0_mlp_out_sp1_pp0
	layer_0_mlp_res_sp1_pp0 [label="MLP Residual L0 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_mlp_out_sp1_pp0 -> layer_0_mlp_res_sp1_pp0
	layer_0_attn_res_sp1_pp0 -> layer_0_mlp_res_sp1_pp0 [style=dashed]
	layer_0_norm_sp2_pp0 [label="LayerNorm L0 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	input_sp0 -> layer_0_norm_sp2_pp0
	input_sp1 -> layer_0_norm_sp2_pp0
	input_sp2 -> layer_0_norm_sp2_pp0
	input_sp3 -> layer_0_norm_sp2_pp0
	layer_0_qkv_sp2_tp0_pp0 [label="QKV Proj L0 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp2_pp0 -> layer_0_qkv_sp2_tp0_pp0
	layer_0_attn_sp2_tp0_pp0 [label="Attention L0 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp2_tp0_pp0 -> layer_0_attn_sp2_tp0_pp0
	layer_0_attn_out_sp2_tp0_pp0 [label="Attn Out Proj L0 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp2_tp0_pp0 -> layer_0_attn_out_sp2_tp0_pp0
	layer_0_qkv_sp2_tp1_pp0 [label="QKV Proj L0 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp2_pp0 -> layer_0_qkv_sp2_tp1_pp0
	layer_0_attn_sp2_tp1_pp0 [label="Attention L0 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp2_tp1_pp0 -> layer_0_attn_sp2_tp1_pp0
	layer_0_attn_out_sp2_tp1_pp0 [label="Attn Out Proj L0 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp2_tp1_pp0 -> layer_0_attn_out_sp2_tp1_pp0
	layer_0_qkv_sp2_tp2_pp0 [label="QKV Proj L0 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp2_pp0 -> layer_0_qkv_sp2_tp2_pp0
	layer_0_attn_sp2_tp2_pp0 [label="Attention L0 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp2_tp2_pp0 -> layer_0_attn_sp2_tp2_pp0
	layer_0_attn_out_sp2_tp2_pp0 [label="Attn Out Proj L0 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp2_tp2_pp0 -> layer_0_attn_out_sp2_tp2_pp0
	layer_0_qkv_sp2_tp3_pp0 [label="QKV Proj L0 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp2_pp0 -> layer_0_qkv_sp2_tp3_pp0
	layer_0_attn_sp2_tp3_pp0 [label="Attention L0 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp2_tp3_pp0 -> layer_0_attn_sp2_tp3_pp0
	layer_0_attn_out_sp2_tp3_pp0 [label="Attn Out Proj L0 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp2_tp3_pp0 -> layer_0_attn_out_sp2_tp3_pp0
	layer_0_attn_ar_sp2_pp0 [label="Attention All-Reduce L0 SP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_attn_out_sp2_tp0_pp0 -> layer_0_attn_ar_sp2_pp0
	layer_0_attn_out_sp2_tp1_pp0 -> layer_0_attn_ar_sp2_pp0
	layer_0_attn_out_sp2_tp2_pp0 -> layer_0_attn_ar_sp2_pp0
	layer_0_attn_out_sp2_tp3_pp0 -> layer_0_attn_ar_sp2_pp0
	layer_0_attn_res_sp2_pp0 [label="Attention Residual L0 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_attn_ar_sp2_pp0 -> layer_0_attn_res_sp2_pp0
	layer_0_norm_sp2_pp0 -> layer_0_attn_res_sp2_pp0 [style=dashed]
	layer_0_post_norm_sp2_pp0 [label="Post-Attn Norm L0 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_attn_res_sp2_pp0 -> layer_0_post_norm_sp2_pp0
	layer_0_router_sp2_pp0 [label="MoE Router L0 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_0_post_norm_sp2_pp0 -> layer_0_router_sp2_pp0
	layer_0_dispatch_sp2_ep0_pp0 [label="Token Dispatch L0 SP2 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep0_pp0 [style=dashed]
	layer_0_expert_sp2_ep0_tp0_pp0 [label="Expert L0 SP2 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep0_pp0 -> layer_0_expert_sp2_ep0_tp0_pp0
	layer_0_expert_out_sp2_ep0_tp0_pp0 [label="Expert Out L0 SP2 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep0_tp0_pp0 -> layer_0_expert_out_sp2_ep0_tp0_pp0
	layer_0_expert_sp2_ep0_tp1_pp0 [label="Expert L0 SP2 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep0_pp0 -> layer_0_expert_sp2_ep0_tp1_pp0
	layer_0_expert_out_sp2_ep0_tp1_pp0 [label="Expert Out L0 SP2 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep0_tp1_pp0 -> layer_0_expert_out_sp2_ep0_tp1_pp0
	layer_0_expert_sp2_ep0_tp2_pp0 [label="Expert L0 SP2 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep0_pp0 -> layer_0_expert_sp2_ep0_tp2_pp0
	layer_0_expert_out_sp2_ep0_tp2_pp0 [label="Expert Out L0 SP2 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep0_tp2_pp0 -> layer_0_expert_out_sp2_ep0_tp2_pp0
	layer_0_expert_sp2_ep0_tp3_pp0 [label="Expert L0 SP2 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep0_pp0 -> layer_0_expert_sp2_ep0_tp3_pp0
	layer_0_expert_out_sp2_ep0_tp3_pp0 [label="Expert Out L0 SP2 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep0_tp3_pp0 -> layer_0_expert_out_sp2_ep0_tp3_pp0
	layer_0_expert_ar_sp2_ep0_pp0 [label="Expert All-Reduce L0 SP2 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep0_tp0_pp0 -> layer_0_expert_ar_sp2_ep0_pp0
	layer_0_expert_out_sp2_ep0_tp1_pp0 -> layer_0_expert_ar_sp2_ep0_pp0
	layer_0_expert_out_sp2_ep0_tp2_pp0 -> layer_0_expert_ar_sp2_ep0_pp0
	layer_0_expert_out_sp2_ep0_tp3_pp0 -> layer_0_expert_ar_sp2_ep0_pp0
	layer_0_combine_sp2_ep0_pp0 [label="Token Combine L0 SP2 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep0_pp0 -> layer_0_combine_sp2_ep0_pp0
	layer_0_dispatch_sp2_ep1_pp0 [label="Token Dispatch L0 SP2 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep1_pp0 [style=dashed]
	layer_0_expert_sp2_ep1_tp0_pp0 [label="Expert L0 SP2 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep1_pp0 -> layer_0_expert_sp2_ep1_tp0_pp0
	layer_0_expert_out_sp2_ep1_tp0_pp0 [label="Expert Out L0 SP2 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep1_tp0_pp0 -> layer_0_expert_out_sp2_ep1_tp0_pp0
	layer_0_expert_sp2_ep1_tp1_pp0 [label="Expert L0 SP2 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep1_pp0 -> layer_0_expert_sp2_ep1_tp1_pp0
	layer_0_expert_out_sp2_ep1_tp1_pp0 [label="Expert Out L0 SP2 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep1_tp1_pp0 -> layer_0_expert_out_sp2_ep1_tp1_pp0
	layer_0_expert_sp2_ep1_tp2_pp0 [label="Expert L0 SP2 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep1_pp0 -> layer_0_expert_sp2_ep1_tp2_pp0
	layer_0_expert_out_sp2_ep1_tp2_pp0 [label="Expert Out L0 SP2 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep1_tp2_pp0 -> layer_0_expert_out_sp2_ep1_tp2_pp0
	layer_0_expert_sp2_ep1_tp3_pp0 [label="Expert L0 SP2 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep1_pp0 -> layer_0_expert_sp2_ep1_tp3_pp0
	layer_0_expert_out_sp2_ep1_tp3_pp0 [label="Expert Out L0 SP2 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep1_tp3_pp0 -> layer_0_expert_out_sp2_ep1_tp3_pp0
	layer_0_expert_ar_sp2_ep1_pp0 [label="Expert All-Reduce L0 SP2 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep1_tp0_pp0 -> layer_0_expert_ar_sp2_ep1_pp0
	layer_0_expert_out_sp2_ep1_tp1_pp0 -> layer_0_expert_ar_sp2_ep1_pp0
	layer_0_expert_out_sp2_ep1_tp2_pp0 -> layer_0_expert_ar_sp2_ep1_pp0
	layer_0_expert_out_sp2_ep1_tp3_pp0 -> layer_0_expert_ar_sp2_ep1_pp0
	layer_0_combine_sp2_ep1_pp0 [label="Token Combine L0 SP2 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep1_pp0 -> layer_0_combine_sp2_ep1_pp0
	layer_0_dispatch_sp2_ep2_pp0 [label="Token Dispatch L0 SP2 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep2_pp0 [style=dashed]
	layer_0_expert_sp2_ep2_tp0_pp0 [label="Expert L0 SP2 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep2_pp0 -> layer_0_expert_sp2_ep2_tp0_pp0
	layer_0_expert_out_sp2_ep2_tp0_pp0 [label="Expert Out L0 SP2 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep2_tp0_pp0 -> layer_0_expert_out_sp2_ep2_tp0_pp0
	layer_0_expert_sp2_ep2_tp1_pp0 [label="Expert L0 SP2 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep2_pp0 -> layer_0_expert_sp2_ep2_tp1_pp0
	layer_0_expert_out_sp2_ep2_tp1_pp0 [label="Expert Out L0 SP2 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep2_tp1_pp0 -> layer_0_expert_out_sp2_ep2_tp1_pp0
	layer_0_expert_sp2_ep2_tp2_pp0 [label="Expert L0 SP2 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep2_pp0 -> layer_0_expert_sp2_ep2_tp2_pp0
	layer_0_expert_out_sp2_ep2_tp2_pp0 [label="Expert Out L0 SP2 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep2_tp2_pp0 -> layer_0_expert_out_sp2_ep2_tp2_pp0
	layer_0_expert_sp2_ep2_tp3_pp0 [label="Expert L0 SP2 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep2_pp0 -> layer_0_expert_sp2_ep2_tp3_pp0
	layer_0_expert_out_sp2_ep2_tp3_pp0 [label="Expert Out L0 SP2 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep2_tp3_pp0 -> layer_0_expert_out_sp2_ep2_tp3_pp0
	layer_0_expert_ar_sp2_ep2_pp0 [label="Expert All-Reduce L0 SP2 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep2_tp0_pp0 -> layer_0_expert_ar_sp2_ep2_pp0
	layer_0_expert_out_sp2_ep2_tp1_pp0 -> layer_0_expert_ar_sp2_ep2_pp0
	layer_0_expert_out_sp2_ep2_tp2_pp0 -> layer_0_expert_ar_sp2_ep2_pp0
	layer_0_expert_out_sp2_ep2_tp3_pp0 -> layer_0_expert_ar_sp2_ep2_pp0
	layer_0_combine_sp2_ep2_pp0 [label="Token Combine L0 SP2 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep2_pp0 -> layer_0_combine_sp2_ep2_pp0
	layer_0_dispatch_sp2_ep3_pp0 [label="Token Dispatch L0 SP2 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep3_pp0 [style=dashed]
	layer_0_expert_sp2_ep3_tp0_pp0 [label="Expert L0 SP2 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep3_pp0 -> layer_0_expert_sp2_ep3_tp0_pp0
	layer_0_expert_out_sp2_ep3_tp0_pp0 [label="Expert Out L0 SP2 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep3_tp0_pp0 -> layer_0_expert_out_sp2_ep3_tp0_pp0
	layer_0_expert_sp2_ep3_tp1_pp0 [label="Expert L0 SP2 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep3_pp0 -> layer_0_expert_sp2_ep3_tp1_pp0
	layer_0_expert_out_sp2_ep3_tp1_pp0 [label="Expert Out L0 SP2 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep3_tp1_pp0 -> layer_0_expert_out_sp2_ep3_tp1_pp0
	layer_0_expert_sp2_ep3_tp2_pp0 [label="Expert L0 SP2 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep3_pp0 -> layer_0_expert_sp2_ep3_tp2_pp0
	layer_0_expert_out_sp2_ep3_tp2_pp0 [label="Expert Out L0 SP2 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep3_tp2_pp0 -> layer_0_expert_out_sp2_ep3_tp2_pp0
	layer_0_expert_sp2_ep3_tp3_pp0 [label="Expert L0 SP2 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep3_pp0 -> layer_0_expert_sp2_ep3_tp3_pp0
	layer_0_expert_out_sp2_ep3_tp3_pp0 [label="Expert Out L0 SP2 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep3_tp3_pp0 -> layer_0_expert_out_sp2_ep3_tp3_pp0
	layer_0_expert_ar_sp2_ep3_pp0 [label="Expert All-Reduce L0 SP2 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep3_tp0_pp0 -> layer_0_expert_ar_sp2_ep3_pp0
	layer_0_expert_out_sp2_ep3_tp1_pp0 -> layer_0_expert_ar_sp2_ep3_pp0
	layer_0_expert_out_sp2_ep3_tp2_pp0 -> layer_0_expert_ar_sp2_ep3_pp0
	layer_0_expert_out_sp2_ep3_tp3_pp0 -> layer_0_expert_ar_sp2_ep3_pp0
	layer_0_combine_sp2_ep3_pp0 [label="Token Combine L0 SP2 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep3_pp0 -> layer_0_combine_sp2_ep3_pp0
	layer_0_dispatch_sp2_ep4_pp0 [label="Token Dispatch L0 SP2 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep4_pp0 [style=dashed]
	layer_0_expert_sp2_ep4_tp0_pp0 [label="Expert L0 SP2 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep4_pp0 -> layer_0_expert_sp2_ep4_tp0_pp0
	layer_0_expert_out_sp2_ep4_tp0_pp0 [label="Expert Out L0 SP2 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep4_tp0_pp0 -> layer_0_expert_out_sp2_ep4_tp0_pp0
	layer_0_expert_sp2_ep4_tp1_pp0 [label="Expert L0 SP2 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep4_pp0 -> layer_0_expert_sp2_ep4_tp1_pp0
	layer_0_expert_out_sp2_ep4_tp1_pp0 [label="Expert Out L0 SP2 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep4_tp1_pp0 -> layer_0_expert_out_sp2_ep4_tp1_pp0
	layer_0_expert_sp2_ep4_tp2_pp0 [label="Expert L0 SP2 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep4_pp0 -> layer_0_expert_sp2_ep4_tp2_pp0
	layer_0_expert_out_sp2_ep4_tp2_pp0 [label="Expert Out L0 SP2 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep4_tp2_pp0 -> layer_0_expert_out_sp2_ep4_tp2_pp0
	layer_0_expert_sp2_ep4_tp3_pp0 [label="Expert L0 SP2 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep4_pp0 -> layer_0_expert_sp2_ep4_tp3_pp0
	layer_0_expert_out_sp2_ep4_tp3_pp0 [label="Expert Out L0 SP2 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep4_tp3_pp0 -> layer_0_expert_out_sp2_ep4_tp3_pp0
	layer_0_expert_ar_sp2_ep4_pp0 [label="Expert All-Reduce L0 SP2 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep4_tp0_pp0 -> layer_0_expert_ar_sp2_ep4_pp0
	layer_0_expert_out_sp2_ep4_tp1_pp0 -> layer_0_expert_ar_sp2_ep4_pp0
	layer_0_expert_out_sp2_ep4_tp2_pp0 -> layer_0_expert_ar_sp2_ep4_pp0
	layer_0_expert_out_sp2_ep4_tp3_pp0 -> layer_0_expert_ar_sp2_ep4_pp0
	layer_0_combine_sp2_ep4_pp0 [label="Token Combine L0 SP2 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep4_pp0 -> layer_0_combine_sp2_ep4_pp0
	layer_0_dispatch_sp2_ep5_pp0 [label="Token Dispatch L0 SP2 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep5_pp0 [style=dashed]
	layer_0_expert_sp2_ep5_tp0_pp0 [label="Expert L0 SP2 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep5_pp0 -> layer_0_expert_sp2_ep5_tp0_pp0
	layer_0_expert_out_sp2_ep5_tp0_pp0 [label="Expert Out L0 SP2 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep5_tp0_pp0 -> layer_0_expert_out_sp2_ep5_tp0_pp0
	layer_0_expert_sp2_ep5_tp1_pp0 [label="Expert L0 SP2 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep5_pp0 -> layer_0_expert_sp2_ep5_tp1_pp0
	layer_0_expert_out_sp2_ep5_tp1_pp0 [label="Expert Out L0 SP2 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep5_tp1_pp0 -> layer_0_expert_out_sp2_ep5_tp1_pp0
	layer_0_expert_sp2_ep5_tp2_pp0 [label="Expert L0 SP2 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep5_pp0 -> layer_0_expert_sp2_ep5_tp2_pp0
	layer_0_expert_out_sp2_ep5_tp2_pp0 [label="Expert Out L0 SP2 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep5_tp2_pp0 -> layer_0_expert_out_sp2_ep5_tp2_pp0
	layer_0_expert_sp2_ep5_tp3_pp0 [label="Expert L0 SP2 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep5_pp0 -> layer_0_expert_sp2_ep5_tp3_pp0
	layer_0_expert_out_sp2_ep5_tp3_pp0 [label="Expert Out L0 SP2 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep5_tp3_pp0 -> layer_0_expert_out_sp2_ep5_tp3_pp0
	layer_0_expert_ar_sp2_ep5_pp0 [label="Expert All-Reduce L0 SP2 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep5_tp0_pp0 -> layer_0_expert_ar_sp2_ep5_pp0
	layer_0_expert_out_sp2_ep5_tp1_pp0 -> layer_0_expert_ar_sp2_ep5_pp0
	layer_0_expert_out_sp2_ep5_tp2_pp0 -> layer_0_expert_ar_sp2_ep5_pp0
	layer_0_expert_out_sp2_ep5_tp3_pp0 -> layer_0_expert_ar_sp2_ep5_pp0
	layer_0_combine_sp2_ep5_pp0 [label="Token Combine L0 SP2 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep5_pp0 -> layer_0_combine_sp2_ep5_pp0
	layer_0_dispatch_sp2_ep6_pp0 [label="Token Dispatch L0 SP2 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep6_pp0 [style=dashed]
	layer_0_expert_sp2_ep6_tp0_pp0 [label="Expert L0 SP2 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep6_pp0 -> layer_0_expert_sp2_ep6_tp0_pp0
	layer_0_expert_out_sp2_ep6_tp0_pp0 [label="Expert Out L0 SP2 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep6_tp0_pp0 -> layer_0_expert_out_sp2_ep6_tp0_pp0
	layer_0_expert_sp2_ep6_tp1_pp0 [label="Expert L0 SP2 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep6_pp0 -> layer_0_expert_sp2_ep6_tp1_pp0
	layer_0_expert_out_sp2_ep6_tp1_pp0 [label="Expert Out L0 SP2 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep6_tp1_pp0 -> layer_0_expert_out_sp2_ep6_tp1_pp0
	layer_0_expert_sp2_ep6_tp2_pp0 [label="Expert L0 SP2 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep6_pp0 -> layer_0_expert_sp2_ep6_tp2_pp0
	layer_0_expert_out_sp2_ep6_tp2_pp0 [label="Expert Out L0 SP2 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep6_tp2_pp0 -> layer_0_expert_out_sp2_ep6_tp2_pp0
	layer_0_expert_sp2_ep6_tp3_pp0 [label="Expert L0 SP2 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep6_pp0 -> layer_0_expert_sp2_ep6_tp3_pp0
	layer_0_expert_out_sp2_ep6_tp3_pp0 [label="Expert Out L0 SP2 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep6_tp3_pp0 -> layer_0_expert_out_sp2_ep6_tp3_pp0
	layer_0_expert_ar_sp2_ep6_pp0 [label="Expert All-Reduce L0 SP2 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep6_tp0_pp0 -> layer_0_expert_ar_sp2_ep6_pp0
	layer_0_expert_out_sp2_ep6_tp1_pp0 -> layer_0_expert_ar_sp2_ep6_pp0
	layer_0_expert_out_sp2_ep6_tp2_pp0 -> layer_0_expert_ar_sp2_ep6_pp0
	layer_0_expert_out_sp2_ep6_tp3_pp0 -> layer_0_expert_ar_sp2_ep6_pp0
	layer_0_combine_sp2_ep6_pp0 [label="Token Combine L0 SP2 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep6_pp0 -> layer_0_combine_sp2_ep6_pp0
	layer_0_dispatch_sp2_ep7_pp0 [label="Token Dispatch L0 SP2 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep7_pp0 [style=dashed]
	layer_0_expert_sp2_ep7_tp0_pp0 [label="Expert L0 SP2 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep7_pp0 -> layer_0_expert_sp2_ep7_tp0_pp0
	layer_0_expert_out_sp2_ep7_tp0_pp0 [label="Expert Out L0 SP2 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep7_tp0_pp0 -> layer_0_expert_out_sp2_ep7_tp0_pp0
	layer_0_expert_sp2_ep7_tp1_pp0 [label="Expert L0 SP2 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep7_pp0 -> layer_0_expert_sp2_ep7_tp1_pp0
	layer_0_expert_out_sp2_ep7_tp1_pp0 [label="Expert Out L0 SP2 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep7_tp1_pp0 -> layer_0_expert_out_sp2_ep7_tp1_pp0
	layer_0_expert_sp2_ep7_tp2_pp0 [label="Expert L0 SP2 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep7_pp0 -> layer_0_expert_sp2_ep7_tp2_pp0
	layer_0_expert_out_sp2_ep7_tp2_pp0 [label="Expert Out L0 SP2 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep7_tp2_pp0 -> layer_0_expert_out_sp2_ep7_tp2_pp0
	layer_0_expert_sp2_ep7_tp3_pp0 [label="Expert L0 SP2 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep7_pp0 -> layer_0_expert_sp2_ep7_tp3_pp0
	layer_0_expert_out_sp2_ep7_tp3_pp0 [label="Expert Out L0 SP2 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep7_tp3_pp0 -> layer_0_expert_out_sp2_ep7_tp3_pp0
	layer_0_expert_ar_sp2_ep7_pp0 [label="Expert All-Reduce L0 SP2 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep7_tp0_pp0 -> layer_0_expert_ar_sp2_ep7_pp0
	layer_0_expert_out_sp2_ep7_tp1_pp0 -> layer_0_expert_ar_sp2_ep7_pp0
	layer_0_expert_out_sp2_ep7_tp2_pp0 -> layer_0_expert_ar_sp2_ep7_pp0
	layer_0_expert_out_sp2_ep7_tp3_pp0 -> layer_0_expert_ar_sp2_ep7_pp0
	layer_0_combine_sp2_ep7_pp0 [label="Token Combine L0 SP2 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep7_pp0 -> layer_0_combine_sp2_ep7_pp0
	layer_0_dispatch_sp2_ep8_pp0 [label="Token Dispatch L0 SP2 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep8_pp0 [style=dashed]
	layer_0_expert_sp2_ep8_tp0_pp0 [label="Expert L0 SP2 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep8_pp0 -> layer_0_expert_sp2_ep8_tp0_pp0
	layer_0_expert_out_sp2_ep8_tp0_pp0 [label="Expert Out L0 SP2 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep8_tp0_pp0 -> layer_0_expert_out_sp2_ep8_tp0_pp0
	layer_0_expert_sp2_ep8_tp1_pp0 [label="Expert L0 SP2 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep8_pp0 -> layer_0_expert_sp2_ep8_tp1_pp0
	layer_0_expert_out_sp2_ep8_tp1_pp0 [label="Expert Out L0 SP2 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep8_tp1_pp0 -> layer_0_expert_out_sp2_ep8_tp1_pp0
	layer_0_expert_sp2_ep8_tp2_pp0 [label="Expert L0 SP2 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep8_pp0 -> layer_0_expert_sp2_ep8_tp2_pp0
	layer_0_expert_out_sp2_ep8_tp2_pp0 [label="Expert Out L0 SP2 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep8_tp2_pp0 -> layer_0_expert_out_sp2_ep8_tp2_pp0
	layer_0_expert_sp2_ep8_tp3_pp0 [label="Expert L0 SP2 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep8_pp0 -> layer_0_expert_sp2_ep8_tp3_pp0
	layer_0_expert_out_sp2_ep8_tp3_pp0 [label="Expert Out L0 SP2 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep8_tp3_pp0 -> layer_0_expert_out_sp2_ep8_tp3_pp0
	layer_0_expert_ar_sp2_ep8_pp0 [label="Expert All-Reduce L0 SP2 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep8_tp0_pp0 -> layer_0_expert_ar_sp2_ep8_pp0
	layer_0_expert_out_sp2_ep8_tp1_pp0 -> layer_0_expert_ar_sp2_ep8_pp0
	layer_0_expert_out_sp2_ep8_tp2_pp0 -> layer_0_expert_ar_sp2_ep8_pp0
	layer_0_expert_out_sp2_ep8_tp3_pp0 -> layer_0_expert_ar_sp2_ep8_pp0
	layer_0_combine_sp2_ep8_pp0 [label="Token Combine L0 SP2 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep8_pp0 -> layer_0_combine_sp2_ep8_pp0
	layer_0_dispatch_sp2_ep9_pp0 [label="Token Dispatch L0 SP2 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep9_pp0 [style=dashed]
	layer_0_expert_sp2_ep9_tp0_pp0 [label="Expert L0 SP2 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep9_pp0 -> layer_0_expert_sp2_ep9_tp0_pp0
	layer_0_expert_out_sp2_ep9_tp0_pp0 [label="Expert Out L0 SP2 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep9_tp0_pp0 -> layer_0_expert_out_sp2_ep9_tp0_pp0
	layer_0_expert_sp2_ep9_tp1_pp0 [label="Expert L0 SP2 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep9_pp0 -> layer_0_expert_sp2_ep9_tp1_pp0
	layer_0_expert_out_sp2_ep9_tp1_pp0 [label="Expert Out L0 SP2 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep9_tp1_pp0 -> layer_0_expert_out_sp2_ep9_tp1_pp0
	layer_0_expert_sp2_ep9_tp2_pp0 [label="Expert L0 SP2 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep9_pp0 -> layer_0_expert_sp2_ep9_tp2_pp0
	layer_0_expert_out_sp2_ep9_tp2_pp0 [label="Expert Out L0 SP2 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep9_tp2_pp0 -> layer_0_expert_out_sp2_ep9_tp2_pp0
	layer_0_expert_sp2_ep9_tp3_pp0 [label="Expert L0 SP2 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep9_pp0 -> layer_0_expert_sp2_ep9_tp3_pp0
	layer_0_expert_out_sp2_ep9_tp3_pp0 [label="Expert Out L0 SP2 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep9_tp3_pp0 -> layer_0_expert_out_sp2_ep9_tp3_pp0
	layer_0_expert_ar_sp2_ep9_pp0 [label="Expert All-Reduce L0 SP2 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep9_tp0_pp0 -> layer_0_expert_ar_sp2_ep9_pp0
	layer_0_expert_out_sp2_ep9_tp1_pp0 -> layer_0_expert_ar_sp2_ep9_pp0
	layer_0_expert_out_sp2_ep9_tp2_pp0 -> layer_0_expert_ar_sp2_ep9_pp0
	layer_0_expert_out_sp2_ep9_tp3_pp0 -> layer_0_expert_ar_sp2_ep9_pp0
	layer_0_combine_sp2_ep9_pp0 [label="Token Combine L0 SP2 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep9_pp0 -> layer_0_combine_sp2_ep9_pp0
	layer_0_dispatch_sp2_ep10_pp0 [label="Token Dispatch L0 SP2 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep10_pp0 [style=dashed]
	layer_0_expert_sp2_ep10_tp0_pp0 [label="Expert L0 SP2 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep10_pp0 -> layer_0_expert_sp2_ep10_tp0_pp0
	layer_0_expert_out_sp2_ep10_tp0_pp0 [label="Expert Out L0 SP2 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep10_tp0_pp0 -> layer_0_expert_out_sp2_ep10_tp0_pp0
	layer_0_expert_sp2_ep10_tp1_pp0 [label="Expert L0 SP2 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep10_pp0 -> layer_0_expert_sp2_ep10_tp1_pp0
	layer_0_expert_out_sp2_ep10_tp1_pp0 [label="Expert Out L0 SP2 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep10_tp1_pp0 -> layer_0_expert_out_sp2_ep10_tp1_pp0
	layer_0_expert_sp2_ep10_tp2_pp0 [label="Expert L0 SP2 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep10_pp0 -> layer_0_expert_sp2_ep10_tp2_pp0
	layer_0_expert_out_sp2_ep10_tp2_pp0 [label="Expert Out L0 SP2 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep10_tp2_pp0 -> layer_0_expert_out_sp2_ep10_tp2_pp0
	layer_0_expert_sp2_ep10_tp3_pp0 [label="Expert L0 SP2 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep10_pp0 -> layer_0_expert_sp2_ep10_tp3_pp0
	layer_0_expert_out_sp2_ep10_tp3_pp0 [label="Expert Out L0 SP2 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep10_tp3_pp0 -> layer_0_expert_out_sp2_ep10_tp3_pp0
	layer_0_expert_ar_sp2_ep10_pp0 [label="Expert All-Reduce L0 SP2 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep10_tp0_pp0 -> layer_0_expert_ar_sp2_ep10_pp0
	layer_0_expert_out_sp2_ep10_tp1_pp0 -> layer_0_expert_ar_sp2_ep10_pp0
	layer_0_expert_out_sp2_ep10_tp2_pp0 -> layer_0_expert_ar_sp2_ep10_pp0
	layer_0_expert_out_sp2_ep10_tp3_pp0 -> layer_0_expert_ar_sp2_ep10_pp0
	layer_0_combine_sp2_ep10_pp0 [label="Token Combine L0 SP2 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep10_pp0 -> layer_0_combine_sp2_ep10_pp0
	layer_0_dispatch_sp2_ep11_pp0 [label="Token Dispatch L0 SP2 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep11_pp0 [style=dashed]
	layer_0_expert_sp2_ep11_tp0_pp0 [label="Expert L0 SP2 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep11_pp0 -> layer_0_expert_sp2_ep11_tp0_pp0
	layer_0_expert_out_sp2_ep11_tp0_pp0 [label="Expert Out L0 SP2 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep11_tp0_pp0 -> layer_0_expert_out_sp2_ep11_tp0_pp0
	layer_0_expert_sp2_ep11_tp1_pp0 [label="Expert L0 SP2 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep11_pp0 -> layer_0_expert_sp2_ep11_tp1_pp0
	layer_0_expert_out_sp2_ep11_tp1_pp0 [label="Expert Out L0 SP2 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep11_tp1_pp0 -> layer_0_expert_out_sp2_ep11_tp1_pp0
	layer_0_expert_sp2_ep11_tp2_pp0 [label="Expert L0 SP2 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep11_pp0 -> layer_0_expert_sp2_ep11_tp2_pp0
	layer_0_expert_out_sp2_ep11_tp2_pp0 [label="Expert Out L0 SP2 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep11_tp2_pp0 -> layer_0_expert_out_sp2_ep11_tp2_pp0
	layer_0_expert_sp2_ep11_tp3_pp0 [label="Expert L0 SP2 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep11_pp0 -> layer_0_expert_sp2_ep11_tp3_pp0
	layer_0_expert_out_sp2_ep11_tp3_pp0 [label="Expert Out L0 SP2 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep11_tp3_pp0 -> layer_0_expert_out_sp2_ep11_tp3_pp0
	layer_0_expert_ar_sp2_ep11_pp0 [label="Expert All-Reduce L0 SP2 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep11_tp0_pp0 -> layer_0_expert_ar_sp2_ep11_pp0
	layer_0_expert_out_sp2_ep11_tp1_pp0 -> layer_0_expert_ar_sp2_ep11_pp0
	layer_0_expert_out_sp2_ep11_tp2_pp0 -> layer_0_expert_ar_sp2_ep11_pp0
	layer_0_expert_out_sp2_ep11_tp3_pp0 -> layer_0_expert_ar_sp2_ep11_pp0
	layer_0_combine_sp2_ep11_pp0 [label="Token Combine L0 SP2 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep11_pp0 -> layer_0_combine_sp2_ep11_pp0
	layer_0_dispatch_sp2_ep12_pp0 [label="Token Dispatch L0 SP2 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep12_pp0 [style=dashed]
	layer_0_expert_sp2_ep12_tp0_pp0 [label="Expert L0 SP2 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep12_pp0 -> layer_0_expert_sp2_ep12_tp0_pp0
	layer_0_expert_out_sp2_ep12_tp0_pp0 [label="Expert Out L0 SP2 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep12_tp0_pp0 -> layer_0_expert_out_sp2_ep12_tp0_pp0
	layer_0_expert_sp2_ep12_tp1_pp0 [label="Expert L0 SP2 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep12_pp0 -> layer_0_expert_sp2_ep12_tp1_pp0
	layer_0_expert_out_sp2_ep12_tp1_pp0 [label="Expert Out L0 SP2 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep12_tp1_pp0 -> layer_0_expert_out_sp2_ep12_tp1_pp0
	layer_0_expert_sp2_ep12_tp2_pp0 [label="Expert L0 SP2 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep12_pp0 -> layer_0_expert_sp2_ep12_tp2_pp0
	layer_0_expert_out_sp2_ep12_tp2_pp0 [label="Expert Out L0 SP2 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep12_tp2_pp0 -> layer_0_expert_out_sp2_ep12_tp2_pp0
	layer_0_expert_sp2_ep12_tp3_pp0 [label="Expert L0 SP2 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep12_pp0 -> layer_0_expert_sp2_ep12_tp3_pp0
	layer_0_expert_out_sp2_ep12_tp3_pp0 [label="Expert Out L0 SP2 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep12_tp3_pp0 -> layer_0_expert_out_sp2_ep12_tp3_pp0
	layer_0_expert_ar_sp2_ep12_pp0 [label="Expert All-Reduce L0 SP2 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep12_tp0_pp0 -> layer_0_expert_ar_sp2_ep12_pp0
	layer_0_expert_out_sp2_ep12_tp1_pp0 -> layer_0_expert_ar_sp2_ep12_pp0
	layer_0_expert_out_sp2_ep12_tp2_pp0 -> layer_0_expert_ar_sp2_ep12_pp0
	layer_0_expert_out_sp2_ep12_tp3_pp0 -> layer_0_expert_ar_sp2_ep12_pp0
	layer_0_combine_sp2_ep12_pp0 [label="Token Combine L0 SP2 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep12_pp0 -> layer_0_combine_sp2_ep12_pp0
	layer_0_dispatch_sp2_ep13_pp0 [label="Token Dispatch L0 SP2 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep13_pp0 [style=dashed]
	layer_0_expert_sp2_ep13_tp0_pp0 [label="Expert L0 SP2 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep13_pp0 -> layer_0_expert_sp2_ep13_tp0_pp0
	layer_0_expert_out_sp2_ep13_tp0_pp0 [label="Expert Out L0 SP2 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep13_tp0_pp0 -> layer_0_expert_out_sp2_ep13_tp0_pp0
	layer_0_expert_sp2_ep13_tp1_pp0 [label="Expert L0 SP2 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep13_pp0 -> layer_0_expert_sp2_ep13_tp1_pp0
	layer_0_expert_out_sp2_ep13_tp1_pp0 [label="Expert Out L0 SP2 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep13_tp1_pp0 -> layer_0_expert_out_sp2_ep13_tp1_pp0
	layer_0_expert_sp2_ep13_tp2_pp0 [label="Expert L0 SP2 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep13_pp0 -> layer_0_expert_sp2_ep13_tp2_pp0
	layer_0_expert_out_sp2_ep13_tp2_pp0 [label="Expert Out L0 SP2 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep13_tp2_pp0 -> layer_0_expert_out_sp2_ep13_tp2_pp0
	layer_0_expert_sp2_ep13_tp3_pp0 [label="Expert L0 SP2 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep13_pp0 -> layer_0_expert_sp2_ep13_tp3_pp0
	layer_0_expert_out_sp2_ep13_tp3_pp0 [label="Expert Out L0 SP2 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep13_tp3_pp0 -> layer_0_expert_out_sp2_ep13_tp3_pp0
	layer_0_expert_ar_sp2_ep13_pp0 [label="Expert All-Reduce L0 SP2 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep13_tp0_pp0 -> layer_0_expert_ar_sp2_ep13_pp0
	layer_0_expert_out_sp2_ep13_tp1_pp0 -> layer_0_expert_ar_sp2_ep13_pp0
	layer_0_expert_out_sp2_ep13_tp2_pp0 -> layer_0_expert_ar_sp2_ep13_pp0
	layer_0_expert_out_sp2_ep13_tp3_pp0 -> layer_0_expert_ar_sp2_ep13_pp0
	layer_0_combine_sp2_ep13_pp0 [label="Token Combine L0 SP2 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep13_pp0 -> layer_0_combine_sp2_ep13_pp0
	layer_0_dispatch_sp2_ep14_pp0 [label="Token Dispatch L0 SP2 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep14_pp0 [style=dashed]
	layer_0_expert_sp2_ep14_tp0_pp0 [label="Expert L0 SP2 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep14_pp0 -> layer_0_expert_sp2_ep14_tp0_pp0
	layer_0_expert_out_sp2_ep14_tp0_pp0 [label="Expert Out L0 SP2 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep14_tp0_pp0 -> layer_0_expert_out_sp2_ep14_tp0_pp0
	layer_0_expert_sp2_ep14_tp1_pp0 [label="Expert L0 SP2 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep14_pp0 -> layer_0_expert_sp2_ep14_tp1_pp0
	layer_0_expert_out_sp2_ep14_tp1_pp0 [label="Expert Out L0 SP2 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep14_tp1_pp0 -> layer_0_expert_out_sp2_ep14_tp1_pp0
	layer_0_expert_sp2_ep14_tp2_pp0 [label="Expert L0 SP2 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep14_pp0 -> layer_0_expert_sp2_ep14_tp2_pp0
	layer_0_expert_out_sp2_ep14_tp2_pp0 [label="Expert Out L0 SP2 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep14_tp2_pp0 -> layer_0_expert_out_sp2_ep14_tp2_pp0
	layer_0_expert_sp2_ep14_tp3_pp0 [label="Expert L0 SP2 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep14_pp0 -> layer_0_expert_sp2_ep14_tp3_pp0
	layer_0_expert_out_sp2_ep14_tp3_pp0 [label="Expert Out L0 SP2 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep14_tp3_pp0 -> layer_0_expert_out_sp2_ep14_tp3_pp0
	layer_0_expert_ar_sp2_ep14_pp0 [label="Expert All-Reduce L0 SP2 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep14_tp0_pp0 -> layer_0_expert_ar_sp2_ep14_pp0
	layer_0_expert_out_sp2_ep14_tp1_pp0 -> layer_0_expert_ar_sp2_ep14_pp0
	layer_0_expert_out_sp2_ep14_tp2_pp0 -> layer_0_expert_ar_sp2_ep14_pp0
	layer_0_expert_out_sp2_ep14_tp3_pp0 -> layer_0_expert_ar_sp2_ep14_pp0
	layer_0_combine_sp2_ep14_pp0 [label="Token Combine L0 SP2 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep14_pp0 -> layer_0_combine_sp2_ep14_pp0
	layer_0_dispatch_sp2_ep15_pp0 [label="Token Dispatch L0 SP2 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp2_pp0 -> layer_0_dispatch_sp2_ep15_pp0 [style=dashed]
	layer_0_expert_sp2_ep15_tp0_pp0 [label="Expert L0 SP2 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep15_pp0 -> layer_0_expert_sp2_ep15_tp0_pp0
	layer_0_expert_out_sp2_ep15_tp0_pp0 [label="Expert Out L0 SP2 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep15_tp0_pp0 -> layer_0_expert_out_sp2_ep15_tp0_pp0
	layer_0_expert_sp2_ep15_tp1_pp0 [label="Expert L0 SP2 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep15_pp0 -> layer_0_expert_sp2_ep15_tp1_pp0
	layer_0_expert_out_sp2_ep15_tp1_pp0 [label="Expert Out L0 SP2 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep15_tp1_pp0 -> layer_0_expert_out_sp2_ep15_tp1_pp0
	layer_0_expert_sp2_ep15_tp2_pp0 [label="Expert L0 SP2 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep15_pp0 -> layer_0_expert_sp2_ep15_tp2_pp0
	layer_0_expert_out_sp2_ep15_tp2_pp0 [label="Expert Out L0 SP2 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep15_tp2_pp0 -> layer_0_expert_out_sp2_ep15_tp2_pp0
	layer_0_expert_sp2_ep15_tp3_pp0 [label="Expert L0 SP2 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp2_ep15_pp0 -> layer_0_expert_sp2_ep15_tp3_pp0
	layer_0_expert_out_sp2_ep15_tp3_pp0 [label="Expert Out L0 SP2 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp2_ep15_tp3_pp0 -> layer_0_expert_out_sp2_ep15_tp3_pp0
	layer_0_expert_ar_sp2_ep15_pp0 [label="Expert All-Reduce L0 SP2 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp2_ep15_tp0_pp0 -> layer_0_expert_ar_sp2_ep15_pp0
	layer_0_expert_out_sp2_ep15_tp1_pp0 -> layer_0_expert_ar_sp2_ep15_pp0
	layer_0_expert_out_sp2_ep15_tp2_pp0 -> layer_0_expert_ar_sp2_ep15_pp0
	layer_0_expert_out_sp2_ep15_tp3_pp0 -> layer_0_expert_ar_sp2_ep15_pp0
	layer_0_combine_sp2_ep15_pp0 [label="Token Combine L0 SP2 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp2_ep15_pp0 -> layer_0_combine_sp2_ep15_pp0
	layer_0_moe_all2all_sp2_pp0 [label="MoE All-to-All L0 SP2\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_0_combine_sp2_ep0_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep1_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep2_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep3_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep4_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep5_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep6_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep7_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep8_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep9_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep10_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep11_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep12_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep13_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep14_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_combine_sp2_ep15_pp0 -> layer_0_moe_all2all_sp2_pp0
	layer_0_mlp_out_sp2_pp0 [label="MoE Output L0 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_moe_all2all_sp2_pp0 -> layer_0_mlp_out_sp2_pp0
	layer_0_mlp_res_sp2_pp0 [label="MLP Residual L0 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_mlp_out_sp2_pp0 -> layer_0_mlp_res_sp2_pp0
	layer_0_attn_res_sp2_pp0 -> layer_0_mlp_res_sp2_pp0 [style=dashed]
	layer_0_norm_sp3_pp0 [label="LayerNorm L0 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	input_sp0 -> layer_0_norm_sp3_pp0
	input_sp1 -> layer_0_norm_sp3_pp0
	input_sp2 -> layer_0_norm_sp3_pp0
	input_sp3 -> layer_0_norm_sp3_pp0
	layer_0_qkv_sp3_tp0_pp0 [label="QKV Proj L0 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp3_pp0 -> layer_0_qkv_sp3_tp0_pp0
	layer_0_attn_sp3_tp0_pp0 [label="Attention L0 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp3_tp0_pp0 -> layer_0_attn_sp3_tp0_pp0
	layer_0_attn_out_sp3_tp0_pp0 [label="Attn Out Proj L0 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp3_tp0_pp0 -> layer_0_attn_out_sp3_tp0_pp0
	layer_0_qkv_sp3_tp1_pp0 [label="QKV Proj L0 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp3_pp0 -> layer_0_qkv_sp3_tp1_pp0
	layer_0_attn_sp3_tp1_pp0 [label="Attention L0 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp3_tp1_pp0 -> layer_0_attn_sp3_tp1_pp0
	layer_0_attn_out_sp3_tp1_pp0 [label="Attn Out Proj L0 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp3_tp1_pp0 -> layer_0_attn_out_sp3_tp1_pp0
	layer_0_qkv_sp3_tp2_pp0 [label="QKV Proj L0 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp3_pp0 -> layer_0_qkv_sp3_tp2_pp0
	layer_0_attn_sp3_tp2_pp0 [label="Attention L0 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp3_tp2_pp0 -> layer_0_attn_sp3_tp2_pp0
	layer_0_attn_out_sp3_tp2_pp0 [label="Attn Out Proj L0 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp3_tp2_pp0 -> layer_0_attn_out_sp3_tp2_pp0
	layer_0_qkv_sp3_tp3_pp0 [label="QKV Proj L0 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_norm_sp3_pp0 -> layer_0_qkv_sp3_tp3_pp0
	layer_0_attn_sp3_tp3_pp0 [label="Attention L0 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_qkv_sp3_tp3_pp0 -> layer_0_attn_sp3_tp3_pp0
	layer_0_attn_out_sp3_tp3_pp0 [label="Attn Out Proj L0 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_0_attn_sp3_tp3_pp0 -> layer_0_attn_out_sp3_tp3_pp0
	layer_0_attn_ar_sp3_pp0 [label="Attention All-Reduce L0 SP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_attn_out_sp3_tp0_pp0 -> layer_0_attn_ar_sp3_pp0
	layer_0_attn_out_sp3_tp1_pp0 -> layer_0_attn_ar_sp3_pp0
	layer_0_attn_out_sp3_tp2_pp0 -> layer_0_attn_ar_sp3_pp0
	layer_0_attn_out_sp3_tp3_pp0 -> layer_0_attn_ar_sp3_pp0
	layer_0_attn_res_sp3_pp0 [label="Attention Residual L0 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_attn_ar_sp3_pp0 -> layer_0_attn_res_sp3_pp0
	layer_0_norm_sp3_pp0 -> layer_0_attn_res_sp3_pp0 [style=dashed]
	layer_0_post_norm_sp3_pp0 [label="Post-Attn Norm L0 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_attn_res_sp3_pp0 -> layer_0_post_norm_sp3_pp0
	layer_0_router_sp3_pp0 [label="MoE Router L0 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_0_post_norm_sp3_pp0 -> layer_0_router_sp3_pp0
	layer_0_dispatch_sp3_ep0_pp0 [label="Token Dispatch L0 SP3 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep0_pp0 [style=dashed]
	layer_0_expert_sp3_ep0_tp0_pp0 [label="Expert L0 SP3 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep0_pp0 -> layer_0_expert_sp3_ep0_tp0_pp0
	layer_0_expert_out_sp3_ep0_tp0_pp0 [label="Expert Out L0 SP3 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep0_tp0_pp0 -> layer_0_expert_out_sp3_ep0_tp0_pp0
	layer_0_expert_sp3_ep0_tp1_pp0 [label="Expert L0 SP3 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep0_pp0 -> layer_0_expert_sp3_ep0_tp1_pp0
	layer_0_expert_out_sp3_ep0_tp1_pp0 [label="Expert Out L0 SP3 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep0_tp1_pp0 -> layer_0_expert_out_sp3_ep0_tp1_pp0
	layer_0_expert_sp3_ep0_tp2_pp0 [label="Expert L0 SP3 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep0_pp0 -> layer_0_expert_sp3_ep0_tp2_pp0
	layer_0_expert_out_sp3_ep0_tp2_pp0 [label="Expert Out L0 SP3 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep0_tp2_pp0 -> layer_0_expert_out_sp3_ep0_tp2_pp0
	layer_0_expert_sp3_ep0_tp3_pp0 [label="Expert L0 SP3 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep0_pp0 -> layer_0_expert_sp3_ep0_tp3_pp0
	layer_0_expert_out_sp3_ep0_tp3_pp0 [label="Expert Out L0 SP3 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep0_tp3_pp0 -> layer_0_expert_out_sp3_ep0_tp3_pp0
	layer_0_expert_ar_sp3_ep0_pp0 [label="Expert All-Reduce L0 SP3 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep0_tp0_pp0 -> layer_0_expert_ar_sp3_ep0_pp0
	layer_0_expert_out_sp3_ep0_tp1_pp0 -> layer_0_expert_ar_sp3_ep0_pp0
	layer_0_expert_out_sp3_ep0_tp2_pp0 -> layer_0_expert_ar_sp3_ep0_pp0
	layer_0_expert_out_sp3_ep0_tp3_pp0 -> layer_0_expert_ar_sp3_ep0_pp0
	layer_0_combine_sp3_ep0_pp0 [label="Token Combine L0 SP3 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep0_pp0 -> layer_0_combine_sp3_ep0_pp0
	layer_0_dispatch_sp3_ep1_pp0 [label="Token Dispatch L0 SP3 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep1_pp0 [style=dashed]
	layer_0_expert_sp3_ep1_tp0_pp0 [label="Expert L0 SP3 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep1_pp0 -> layer_0_expert_sp3_ep1_tp0_pp0
	layer_0_expert_out_sp3_ep1_tp0_pp0 [label="Expert Out L0 SP3 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep1_tp0_pp0 -> layer_0_expert_out_sp3_ep1_tp0_pp0
	layer_0_expert_sp3_ep1_tp1_pp0 [label="Expert L0 SP3 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep1_pp0 -> layer_0_expert_sp3_ep1_tp1_pp0
	layer_0_expert_out_sp3_ep1_tp1_pp0 [label="Expert Out L0 SP3 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep1_tp1_pp0 -> layer_0_expert_out_sp3_ep1_tp1_pp0
	layer_0_expert_sp3_ep1_tp2_pp0 [label="Expert L0 SP3 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep1_pp0 -> layer_0_expert_sp3_ep1_tp2_pp0
	layer_0_expert_out_sp3_ep1_tp2_pp0 [label="Expert Out L0 SP3 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep1_tp2_pp0 -> layer_0_expert_out_sp3_ep1_tp2_pp0
	layer_0_expert_sp3_ep1_tp3_pp0 [label="Expert L0 SP3 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep1_pp0 -> layer_0_expert_sp3_ep1_tp3_pp0
	layer_0_expert_out_sp3_ep1_tp3_pp0 [label="Expert Out L0 SP3 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep1_tp3_pp0 -> layer_0_expert_out_sp3_ep1_tp3_pp0
	layer_0_expert_ar_sp3_ep1_pp0 [label="Expert All-Reduce L0 SP3 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep1_tp0_pp0 -> layer_0_expert_ar_sp3_ep1_pp0
	layer_0_expert_out_sp3_ep1_tp1_pp0 -> layer_0_expert_ar_sp3_ep1_pp0
	layer_0_expert_out_sp3_ep1_tp2_pp0 -> layer_0_expert_ar_sp3_ep1_pp0
	layer_0_expert_out_sp3_ep1_tp3_pp0 -> layer_0_expert_ar_sp3_ep1_pp0
	layer_0_combine_sp3_ep1_pp0 [label="Token Combine L0 SP3 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep1_pp0 -> layer_0_combine_sp3_ep1_pp0
	layer_0_dispatch_sp3_ep2_pp0 [label="Token Dispatch L0 SP3 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep2_pp0 [style=dashed]
	layer_0_expert_sp3_ep2_tp0_pp0 [label="Expert L0 SP3 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep2_pp0 -> layer_0_expert_sp3_ep2_tp0_pp0
	layer_0_expert_out_sp3_ep2_tp0_pp0 [label="Expert Out L0 SP3 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep2_tp0_pp0 -> layer_0_expert_out_sp3_ep2_tp0_pp0
	layer_0_expert_sp3_ep2_tp1_pp0 [label="Expert L0 SP3 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep2_pp0 -> layer_0_expert_sp3_ep2_tp1_pp0
	layer_0_expert_out_sp3_ep2_tp1_pp0 [label="Expert Out L0 SP3 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep2_tp1_pp0 -> layer_0_expert_out_sp3_ep2_tp1_pp0
	layer_0_expert_sp3_ep2_tp2_pp0 [label="Expert L0 SP3 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep2_pp0 -> layer_0_expert_sp3_ep2_tp2_pp0
	layer_0_expert_out_sp3_ep2_tp2_pp0 [label="Expert Out L0 SP3 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep2_tp2_pp0 -> layer_0_expert_out_sp3_ep2_tp2_pp0
	layer_0_expert_sp3_ep2_tp3_pp0 [label="Expert L0 SP3 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep2_pp0 -> layer_0_expert_sp3_ep2_tp3_pp0
	layer_0_expert_out_sp3_ep2_tp3_pp0 [label="Expert Out L0 SP3 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep2_tp3_pp0 -> layer_0_expert_out_sp3_ep2_tp3_pp0
	layer_0_expert_ar_sp3_ep2_pp0 [label="Expert All-Reduce L0 SP3 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep2_tp0_pp0 -> layer_0_expert_ar_sp3_ep2_pp0
	layer_0_expert_out_sp3_ep2_tp1_pp0 -> layer_0_expert_ar_sp3_ep2_pp0
	layer_0_expert_out_sp3_ep2_tp2_pp0 -> layer_0_expert_ar_sp3_ep2_pp0
	layer_0_expert_out_sp3_ep2_tp3_pp0 -> layer_0_expert_ar_sp3_ep2_pp0
	layer_0_combine_sp3_ep2_pp0 [label="Token Combine L0 SP3 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep2_pp0 -> layer_0_combine_sp3_ep2_pp0
	layer_0_dispatch_sp3_ep3_pp0 [label="Token Dispatch L0 SP3 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep3_pp0 [style=dashed]
	layer_0_expert_sp3_ep3_tp0_pp0 [label="Expert L0 SP3 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep3_pp0 -> layer_0_expert_sp3_ep3_tp0_pp0
	layer_0_expert_out_sp3_ep3_tp0_pp0 [label="Expert Out L0 SP3 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep3_tp0_pp0 -> layer_0_expert_out_sp3_ep3_tp0_pp0
	layer_0_expert_sp3_ep3_tp1_pp0 [label="Expert L0 SP3 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep3_pp0 -> layer_0_expert_sp3_ep3_tp1_pp0
	layer_0_expert_out_sp3_ep3_tp1_pp0 [label="Expert Out L0 SP3 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep3_tp1_pp0 -> layer_0_expert_out_sp3_ep3_tp1_pp0
	layer_0_expert_sp3_ep3_tp2_pp0 [label="Expert L0 SP3 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep3_pp0 -> layer_0_expert_sp3_ep3_tp2_pp0
	layer_0_expert_out_sp3_ep3_tp2_pp0 [label="Expert Out L0 SP3 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep3_tp2_pp0 -> layer_0_expert_out_sp3_ep3_tp2_pp0
	layer_0_expert_sp3_ep3_tp3_pp0 [label="Expert L0 SP3 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep3_pp0 -> layer_0_expert_sp3_ep3_tp3_pp0
	layer_0_expert_out_sp3_ep3_tp3_pp0 [label="Expert Out L0 SP3 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep3_tp3_pp0 -> layer_0_expert_out_sp3_ep3_tp3_pp0
	layer_0_expert_ar_sp3_ep3_pp0 [label="Expert All-Reduce L0 SP3 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep3_tp0_pp0 -> layer_0_expert_ar_sp3_ep3_pp0
	layer_0_expert_out_sp3_ep3_tp1_pp0 -> layer_0_expert_ar_sp3_ep3_pp0
	layer_0_expert_out_sp3_ep3_tp2_pp0 -> layer_0_expert_ar_sp3_ep3_pp0
	layer_0_expert_out_sp3_ep3_tp3_pp0 -> layer_0_expert_ar_sp3_ep3_pp0
	layer_0_combine_sp3_ep3_pp0 [label="Token Combine L0 SP3 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep3_pp0 -> layer_0_combine_sp3_ep3_pp0
	layer_0_dispatch_sp3_ep4_pp0 [label="Token Dispatch L0 SP3 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep4_pp0 [style=dashed]
	layer_0_expert_sp3_ep4_tp0_pp0 [label="Expert L0 SP3 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep4_pp0 -> layer_0_expert_sp3_ep4_tp0_pp0
	layer_0_expert_out_sp3_ep4_tp0_pp0 [label="Expert Out L0 SP3 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep4_tp0_pp0 -> layer_0_expert_out_sp3_ep4_tp0_pp0
	layer_0_expert_sp3_ep4_tp1_pp0 [label="Expert L0 SP3 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep4_pp0 -> layer_0_expert_sp3_ep4_tp1_pp0
	layer_0_expert_out_sp3_ep4_tp1_pp0 [label="Expert Out L0 SP3 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep4_tp1_pp0 -> layer_0_expert_out_sp3_ep4_tp1_pp0
	layer_0_expert_sp3_ep4_tp2_pp0 [label="Expert L0 SP3 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep4_pp0 -> layer_0_expert_sp3_ep4_tp2_pp0
	layer_0_expert_out_sp3_ep4_tp2_pp0 [label="Expert Out L0 SP3 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep4_tp2_pp0 -> layer_0_expert_out_sp3_ep4_tp2_pp0
	layer_0_expert_sp3_ep4_tp3_pp0 [label="Expert L0 SP3 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep4_pp0 -> layer_0_expert_sp3_ep4_tp3_pp0
	layer_0_expert_out_sp3_ep4_tp3_pp0 [label="Expert Out L0 SP3 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep4_tp3_pp0 -> layer_0_expert_out_sp3_ep4_tp3_pp0
	layer_0_expert_ar_sp3_ep4_pp0 [label="Expert All-Reduce L0 SP3 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep4_tp0_pp0 -> layer_0_expert_ar_sp3_ep4_pp0
	layer_0_expert_out_sp3_ep4_tp1_pp0 -> layer_0_expert_ar_sp3_ep4_pp0
	layer_0_expert_out_sp3_ep4_tp2_pp0 -> layer_0_expert_ar_sp3_ep4_pp0
	layer_0_expert_out_sp3_ep4_tp3_pp0 -> layer_0_expert_ar_sp3_ep4_pp0
	layer_0_combine_sp3_ep4_pp0 [label="Token Combine L0 SP3 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep4_pp0 -> layer_0_combine_sp3_ep4_pp0
	layer_0_dispatch_sp3_ep5_pp0 [label="Token Dispatch L0 SP3 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep5_pp0 [style=dashed]
	layer_0_expert_sp3_ep5_tp0_pp0 [label="Expert L0 SP3 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep5_pp0 -> layer_0_expert_sp3_ep5_tp0_pp0
	layer_0_expert_out_sp3_ep5_tp0_pp0 [label="Expert Out L0 SP3 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep5_tp0_pp0 -> layer_0_expert_out_sp3_ep5_tp0_pp0
	layer_0_expert_sp3_ep5_tp1_pp0 [label="Expert L0 SP3 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep5_pp0 -> layer_0_expert_sp3_ep5_tp1_pp0
	layer_0_expert_out_sp3_ep5_tp1_pp0 [label="Expert Out L0 SP3 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep5_tp1_pp0 -> layer_0_expert_out_sp3_ep5_tp1_pp0
	layer_0_expert_sp3_ep5_tp2_pp0 [label="Expert L0 SP3 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep5_pp0 -> layer_0_expert_sp3_ep5_tp2_pp0
	layer_0_expert_out_sp3_ep5_tp2_pp0 [label="Expert Out L0 SP3 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep5_tp2_pp0 -> layer_0_expert_out_sp3_ep5_tp2_pp0
	layer_0_expert_sp3_ep5_tp3_pp0 [label="Expert L0 SP3 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep5_pp0 -> layer_0_expert_sp3_ep5_tp3_pp0
	layer_0_expert_out_sp3_ep5_tp3_pp0 [label="Expert Out L0 SP3 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep5_tp3_pp0 -> layer_0_expert_out_sp3_ep5_tp3_pp0
	layer_0_expert_ar_sp3_ep5_pp0 [label="Expert All-Reduce L0 SP3 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep5_tp0_pp0 -> layer_0_expert_ar_sp3_ep5_pp0
	layer_0_expert_out_sp3_ep5_tp1_pp0 -> layer_0_expert_ar_sp3_ep5_pp0
	layer_0_expert_out_sp3_ep5_tp2_pp0 -> layer_0_expert_ar_sp3_ep5_pp0
	layer_0_expert_out_sp3_ep5_tp3_pp0 -> layer_0_expert_ar_sp3_ep5_pp0
	layer_0_combine_sp3_ep5_pp0 [label="Token Combine L0 SP3 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep5_pp0 -> layer_0_combine_sp3_ep5_pp0
	layer_0_dispatch_sp3_ep6_pp0 [label="Token Dispatch L0 SP3 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep6_pp0 [style=dashed]
	layer_0_expert_sp3_ep6_tp0_pp0 [label="Expert L0 SP3 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep6_pp0 -> layer_0_expert_sp3_ep6_tp0_pp0
	layer_0_expert_out_sp3_ep6_tp0_pp0 [label="Expert Out L0 SP3 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep6_tp0_pp0 -> layer_0_expert_out_sp3_ep6_tp0_pp0
	layer_0_expert_sp3_ep6_tp1_pp0 [label="Expert L0 SP3 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep6_pp0 -> layer_0_expert_sp3_ep6_tp1_pp0
	layer_0_expert_out_sp3_ep6_tp1_pp0 [label="Expert Out L0 SP3 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep6_tp1_pp0 -> layer_0_expert_out_sp3_ep6_tp1_pp0
	layer_0_expert_sp3_ep6_tp2_pp0 [label="Expert L0 SP3 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep6_pp0 -> layer_0_expert_sp3_ep6_tp2_pp0
	layer_0_expert_out_sp3_ep6_tp2_pp0 [label="Expert Out L0 SP3 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep6_tp2_pp0 -> layer_0_expert_out_sp3_ep6_tp2_pp0
	layer_0_expert_sp3_ep6_tp3_pp0 [label="Expert L0 SP3 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep6_pp0 -> layer_0_expert_sp3_ep6_tp3_pp0
	layer_0_expert_out_sp3_ep6_tp3_pp0 [label="Expert Out L0 SP3 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep6_tp3_pp0 -> layer_0_expert_out_sp3_ep6_tp3_pp0
	layer_0_expert_ar_sp3_ep6_pp0 [label="Expert All-Reduce L0 SP3 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep6_tp0_pp0 -> layer_0_expert_ar_sp3_ep6_pp0
	layer_0_expert_out_sp3_ep6_tp1_pp0 -> layer_0_expert_ar_sp3_ep6_pp0
	layer_0_expert_out_sp3_ep6_tp2_pp0 -> layer_0_expert_ar_sp3_ep6_pp0
	layer_0_expert_out_sp3_ep6_tp3_pp0 -> layer_0_expert_ar_sp3_ep6_pp0
	layer_0_combine_sp3_ep6_pp0 [label="Token Combine L0 SP3 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep6_pp0 -> layer_0_combine_sp3_ep6_pp0
	layer_0_dispatch_sp3_ep7_pp0 [label="Token Dispatch L0 SP3 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep7_pp0 [style=dashed]
	layer_0_expert_sp3_ep7_tp0_pp0 [label="Expert L0 SP3 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep7_pp0 -> layer_0_expert_sp3_ep7_tp0_pp0
	layer_0_expert_out_sp3_ep7_tp0_pp0 [label="Expert Out L0 SP3 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep7_tp0_pp0 -> layer_0_expert_out_sp3_ep7_tp0_pp0
	layer_0_expert_sp3_ep7_tp1_pp0 [label="Expert L0 SP3 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep7_pp0 -> layer_0_expert_sp3_ep7_tp1_pp0
	layer_0_expert_out_sp3_ep7_tp1_pp0 [label="Expert Out L0 SP3 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep7_tp1_pp0 -> layer_0_expert_out_sp3_ep7_tp1_pp0
	layer_0_expert_sp3_ep7_tp2_pp0 [label="Expert L0 SP3 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep7_pp0 -> layer_0_expert_sp3_ep7_tp2_pp0
	layer_0_expert_out_sp3_ep7_tp2_pp0 [label="Expert Out L0 SP3 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep7_tp2_pp0 -> layer_0_expert_out_sp3_ep7_tp2_pp0
	layer_0_expert_sp3_ep7_tp3_pp0 [label="Expert L0 SP3 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep7_pp0 -> layer_0_expert_sp3_ep7_tp3_pp0
	layer_0_expert_out_sp3_ep7_tp3_pp0 [label="Expert Out L0 SP3 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep7_tp3_pp0 -> layer_0_expert_out_sp3_ep7_tp3_pp0
	layer_0_expert_ar_sp3_ep7_pp0 [label="Expert All-Reduce L0 SP3 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep7_tp0_pp0 -> layer_0_expert_ar_sp3_ep7_pp0
	layer_0_expert_out_sp3_ep7_tp1_pp0 -> layer_0_expert_ar_sp3_ep7_pp0
	layer_0_expert_out_sp3_ep7_tp2_pp0 -> layer_0_expert_ar_sp3_ep7_pp0
	layer_0_expert_out_sp3_ep7_tp3_pp0 -> layer_0_expert_ar_sp3_ep7_pp0
	layer_0_combine_sp3_ep7_pp0 [label="Token Combine L0 SP3 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep7_pp0 -> layer_0_combine_sp3_ep7_pp0
	layer_0_dispatch_sp3_ep8_pp0 [label="Token Dispatch L0 SP3 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep8_pp0 [style=dashed]
	layer_0_expert_sp3_ep8_tp0_pp0 [label="Expert L0 SP3 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep8_pp0 -> layer_0_expert_sp3_ep8_tp0_pp0
	layer_0_expert_out_sp3_ep8_tp0_pp0 [label="Expert Out L0 SP3 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep8_tp0_pp0 -> layer_0_expert_out_sp3_ep8_tp0_pp0
	layer_0_expert_sp3_ep8_tp1_pp0 [label="Expert L0 SP3 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep8_pp0 -> layer_0_expert_sp3_ep8_tp1_pp0
	layer_0_expert_out_sp3_ep8_tp1_pp0 [label="Expert Out L0 SP3 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep8_tp1_pp0 -> layer_0_expert_out_sp3_ep8_tp1_pp0
	layer_0_expert_sp3_ep8_tp2_pp0 [label="Expert L0 SP3 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep8_pp0 -> layer_0_expert_sp3_ep8_tp2_pp0
	layer_0_expert_out_sp3_ep8_tp2_pp0 [label="Expert Out L0 SP3 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep8_tp2_pp0 -> layer_0_expert_out_sp3_ep8_tp2_pp0
	layer_0_expert_sp3_ep8_tp3_pp0 [label="Expert L0 SP3 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep8_pp0 -> layer_0_expert_sp3_ep8_tp3_pp0
	layer_0_expert_out_sp3_ep8_tp3_pp0 [label="Expert Out L0 SP3 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep8_tp3_pp0 -> layer_0_expert_out_sp3_ep8_tp3_pp0
	layer_0_expert_ar_sp3_ep8_pp0 [label="Expert All-Reduce L0 SP3 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep8_tp0_pp0 -> layer_0_expert_ar_sp3_ep8_pp0
	layer_0_expert_out_sp3_ep8_tp1_pp0 -> layer_0_expert_ar_sp3_ep8_pp0
	layer_0_expert_out_sp3_ep8_tp2_pp0 -> layer_0_expert_ar_sp3_ep8_pp0
	layer_0_expert_out_sp3_ep8_tp3_pp0 -> layer_0_expert_ar_sp3_ep8_pp0
	layer_0_combine_sp3_ep8_pp0 [label="Token Combine L0 SP3 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep8_pp0 -> layer_0_combine_sp3_ep8_pp0
	layer_0_dispatch_sp3_ep9_pp0 [label="Token Dispatch L0 SP3 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep9_pp0 [style=dashed]
	layer_0_expert_sp3_ep9_tp0_pp0 [label="Expert L0 SP3 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep9_pp0 -> layer_0_expert_sp3_ep9_tp0_pp0
	layer_0_expert_out_sp3_ep9_tp0_pp0 [label="Expert Out L0 SP3 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep9_tp0_pp0 -> layer_0_expert_out_sp3_ep9_tp0_pp0
	layer_0_expert_sp3_ep9_tp1_pp0 [label="Expert L0 SP3 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep9_pp0 -> layer_0_expert_sp3_ep9_tp1_pp0
	layer_0_expert_out_sp3_ep9_tp1_pp0 [label="Expert Out L0 SP3 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep9_tp1_pp0 -> layer_0_expert_out_sp3_ep9_tp1_pp0
	layer_0_expert_sp3_ep9_tp2_pp0 [label="Expert L0 SP3 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep9_pp0 -> layer_0_expert_sp3_ep9_tp2_pp0
	layer_0_expert_out_sp3_ep9_tp2_pp0 [label="Expert Out L0 SP3 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep9_tp2_pp0 -> layer_0_expert_out_sp3_ep9_tp2_pp0
	layer_0_expert_sp3_ep9_tp3_pp0 [label="Expert L0 SP3 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep9_pp0 -> layer_0_expert_sp3_ep9_tp3_pp0
	layer_0_expert_out_sp3_ep9_tp3_pp0 [label="Expert Out L0 SP3 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep9_tp3_pp0 -> layer_0_expert_out_sp3_ep9_tp3_pp0
	layer_0_expert_ar_sp3_ep9_pp0 [label="Expert All-Reduce L0 SP3 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep9_tp0_pp0 -> layer_0_expert_ar_sp3_ep9_pp0
	layer_0_expert_out_sp3_ep9_tp1_pp0 -> layer_0_expert_ar_sp3_ep9_pp0
	layer_0_expert_out_sp3_ep9_tp2_pp0 -> layer_0_expert_ar_sp3_ep9_pp0
	layer_0_expert_out_sp3_ep9_tp3_pp0 -> layer_0_expert_ar_sp3_ep9_pp0
	layer_0_combine_sp3_ep9_pp0 [label="Token Combine L0 SP3 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep9_pp0 -> layer_0_combine_sp3_ep9_pp0
	layer_0_dispatch_sp3_ep10_pp0 [label="Token Dispatch L0 SP3 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep10_pp0 [style=dashed]
	layer_0_expert_sp3_ep10_tp0_pp0 [label="Expert L0 SP3 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep10_pp0 -> layer_0_expert_sp3_ep10_tp0_pp0
	layer_0_expert_out_sp3_ep10_tp0_pp0 [label="Expert Out L0 SP3 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep10_tp0_pp0 -> layer_0_expert_out_sp3_ep10_tp0_pp0
	layer_0_expert_sp3_ep10_tp1_pp0 [label="Expert L0 SP3 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep10_pp0 -> layer_0_expert_sp3_ep10_tp1_pp0
	layer_0_expert_out_sp3_ep10_tp1_pp0 [label="Expert Out L0 SP3 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep10_tp1_pp0 -> layer_0_expert_out_sp3_ep10_tp1_pp0
	layer_0_expert_sp3_ep10_tp2_pp0 [label="Expert L0 SP3 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep10_pp0 -> layer_0_expert_sp3_ep10_tp2_pp0
	layer_0_expert_out_sp3_ep10_tp2_pp0 [label="Expert Out L0 SP3 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep10_tp2_pp0 -> layer_0_expert_out_sp3_ep10_tp2_pp0
	layer_0_expert_sp3_ep10_tp3_pp0 [label="Expert L0 SP3 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep10_pp0 -> layer_0_expert_sp3_ep10_tp3_pp0
	layer_0_expert_out_sp3_ep10_tp3_pp0 [label="Expert Out L0 SP3 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep10_tp3_pp0 -> layer_0_expert_out_sp3_ep10_tp3_pp0
	layer_0_expert_ar_sp3_ep10_pp0 [label="Expert All-Reduce L0 SP3 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep10_tp0_pp0 -> layer_0_expert_ar_sp3_ep10_pp0
	layer_0_expert_out_sp3_ep10_tp1_pp0 -> layer_0_expert_ar_sp3_ep10_pp0
	layer_0_expert_out_sp3_ep10_tp2_pp0 -> layer_0_expert_ar_sp3_ep10_pp0
	layer_0_expert_out_sp3_ep10_tp3_pp0 -> layer_0_expert_ar_sp3_ep10_pp0
	layer_0_combine_sp3_ep10_pp0 [label="Token Combine L0 SP3 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep10_pp0 -> layer_0_combine_sp3_ep10_pp0
	layer_0_dispatch_sp3_ep11_pp0 [label="Token Dispatch L0 SP3 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep11_pp0 [style=dashed]
	layer_0_expert_sp3_ep11_tp0_pp0 [label="Expert L0 SP3 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep11_pp0 -> layer_0_expert_sp3_ep11_tp0_pp0
	layer_0_expert_out_sp3_ep11_tp0_pp0 [label="Expert Out L0 SP3 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep11_tp0_pp0 -> layer_0_expert_out_sp3_ep11_tp0_pp0
	layer_0_expert_sp3_ep11_tp1_pp0 [label="Expert L0 SP3 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep11_pp0 -> layer_0_expert_sp3_ep11_tp1_pp0
	layer_0_expert_out_sp3_ep11_tp1_pp0 [label="Expert Out L0 SP3 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep11_tp1_pp0 -> layer_0_expert_out_sp3_ep11_tp1_pp0
	layer_0_expert_sp3_ep11_tp2_pp0 [label="Expert L0 SP3 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep11_pp0 -> layer_0_expert_sp3_ep11_tp2_pp0
	layer_0_expert_out_sp3_ep11_tp2_pp0 [label="Expert Out L0 SP3 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep11_tp2_pp0 -> layer_0_expert_out_sp3_ep11_tp2_pp0
	layer_0_expert_sp3_ep11_tp3_pp0 [label="Expert L0 SP3 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep11_pp0 -> layer_0_expert_sp3_ep11_tp3_pp0
	layer_0_expert_out_sp3_ep11_tp3_pp0 [label="Expert Out L0 SP3 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep11_tp3_pp0 -> layer_0_expert_out_sp3_ep11_tp3_pp0
	layer_0_expert_ar_sp3_ep11_pp0 [label="Expert All-Reduce L0 SP3 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep11_tp0_pp0 -> layer_0_expert_ar_sp3_ep11_pp0
	layer_0_expert_out_sp3_ep11_tp1_pp0 -> layer_0_expert_ar_sp3_ep11_pp0
	layer_0_expert_out_sp3_ep11_tp2_pp0 -> layer_0_expert_ar_sp3_ep11_pp0
	layer_0_expert_out_sp3_ep11_tp3_pp0 -> layer_0_expert_ar_sp3_ep11_pp0
	layer_0_combine_sp3_ep11_pp0 [label="Token Combine L0 SP3 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep11_pp0 -> layer_0_combine_sp3_ep11_pp0
	layer_0_dispatch_sp3_ep12_pp0 [label="Token Dispatch L0 SP3 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep12_pp0 [style=dashed]
	layer_0_expert_sp3_ep12_tp0_pp0 [label="Expert L0 SP3 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep12_pp0 -> layer_0_expert_sp3_ep12_tp0_pp0
	layer_0_expert_out_sp3_ep12_tp0_pp0 [label="Expert Out L0 SP3 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep12_tp0_pp0 -> layer_0_expert_out_sp3_ep12_tp0_pp0
	layer_0_expert_sp3_ep12_tp1_pp0 [label="Expert L0 SP3 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep12_pp0 -> layer_0_expert_sp3_ep12_tp1_pp0
	layer_0_expert_out_sp3_ep12_tp1_pp0 [label="Expert Out L0 SP3 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep12_tp1_pp0 -> layer_0_expert_out_sp3_ep12_tp1_pp0
	layer_0_expert_sp3_ep12_tp2_pp0 [label="Expert L0 SP3 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep12_pp0 -> layer_0_expert_sp3_ep12_tp2_pp0
	layer_0_expert_out_sp3_ep12_tp2_pp0 [label="Expert Out L0 SP3 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep12_tp2_pp0 -> layer_0_expert_out_sp3_ep12_tp2_pp0
	layer_0_expert_sp3_ep12_tp3_pp0 [label="Expert L0 SP3 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep12_pp0 -> layer_0_expert_sp3_ep12_tp3_pp0
	layer_0_expert_out_sp3_ep12_tp3_pp0 [label="Expert Out L0 SP3 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep12_tp3_pp0 -> layer_0_expert_out_sp3_ep12_tp3_pp0
	layer_0_expert_ar_sp3_ep12_pp0 [label="Expert All-Reduce L0 SP3 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep12_tp0_pp0 -> layer_0_expert_ar_sp3_ep12_pp0
	layer_0_expert_out_sp3_ep12_tp1_pp0 -> layer_0_expert_ar_sp3_ep12_pp0
	layer_0_expert_out_sp3_ep12_tp2_pp0 -> layer_0_expert_ar_sp3_ep12_pp0
	layer_0_expert_out_sp3_ep12_tp3_pp0 -> layer_0_expert_ar_sp3_ep12_pp0
	layer_0_combine_sp3_ep12_pp0 [label="Token Combine L0 SP3 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep12_pp0 -> layer_0_combine_sp3_ep12_pp0
	layer_0_dispatch_sp3_ep13_pp0 [label="Token Dispatch L0 SP3 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep13_pp0 [style=dashed]
	layer_0_expert_sp3_ep13_tp0_pp0 [label="Expert L0 SP3 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep13_pp0 -> layer_0_expert_sp3_ep13_tp0_pp0
	layer_0_expert_out_sp3_ep13_tp0_pp0 [label="Expert Out L0 SP3 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep13_tp0_pp0 -> layer_0_expert_out_sp3_ep13_tp0_pp0
	layer_0_expert_sp3_ep13_tp1_pp0 [label="Expert L0 SP3 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep13_pp0 -> layer_0_expert_sp3_ep13_tp1_pp0
	layer_0_expert_out_sp3_ep13_tp1_pp0 [label="Expert Out L0 SP3 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep13_tp1_pp0 -> layer_0_expert_out_sp3_ep13_tp1_pp0
	layer_0_expert_sp3_ep13_tp2_pp0 [label="Expert L0 SP3 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep13_pp0 -> layer_0_expert_sp3_ep13_tp2_pp0
	layer_0_expert_out_sp3_ep13_tp2_pp0 [label="Expert Out L0 SP3 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep13_tp2_pp0 -> layer_0_expert_out_sp3_ep13_tp2_pp0
	layer_0_expert_sp3_ep13_tp3_pp0 [label="Expert L0 SP3 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep13_pp0 -> layer_0_expert_sp3_ep13_tp3_pp0
	layer_0_expert_out_sp3_ep13_tp3_pp0 [label="Expert Out L0 SP3 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep13_tp3_pp0 -> layer_0_expert_out_sp3_ep13_tp3_pp0
	layer_0_expert_ar_sp3_ep13_pp0 [label="Expert All-Reduce L0 SP3 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep13_tp0_pp0 -> layer_0_expert_ar_sp3_ep13_pp0
	layer_0_expert_out_sp3_ep13_tp1_pp0 -> layer_0_expert_ar_sp3_ep13_pp0
	layer_0_expert_out_sp3_ep13_tp2_pp0 -> layer_0_expert_ar_sp3_ep13_pp0
	layer_0_expert_out_sp3_ep13_tp3_pp0 -> layer_0_expert_ar_sp3_ep13_pp0
	layer_0_combine_sp3_ep13_pp0 [label="Token Combine L0 SP3 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep13_pp0 -> layer_0_combine_sp3_ep13_pp0
	layer_0_dispatch_sp3_ep14_pp0 [label="Token Dispatch L0 SP3 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep14_pp0 [style=dashed]
	layer_0_expert_sp3_ep14_tp0_pp0 [label="Expert L0 SP3 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep14_pp0 -> layer_0_expert_sp3_ep14_tp0_pp0
	layer_0_expert_out_sp3_ep14_tp0_pp0 [label="Expert Out L0 SP3 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep14_tp0_pp0 -> layer_0_expert_out_sp3_ep14_tp0_pp0
	layer_0_expert_sp3_ep14_tp1_pp0 [label="Expert L0 SP3 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep14_pp0 -> layer_0_expert_sp3_ep14_tp1_pp0
	layer_0_expert_out_sp3_ep14_tp1_pp0 [label="Expert Out L0 SP3 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep14_tp1_pp0 -> layer_0_expert_out_sp3_ep14_tp1_pp0
	layer_0_expert_sp3_ep14_tp2_pp0 [label="Expert L0 SP3 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep14_pp0 -> layer_0_expert_sp3_ep14_tp2_pp0
	layer_0_expert_out_sp3_ep14_tp2_pp0 [label="Expert Out L0 SP3 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep14_tp2_pp0 -> layer_0_expert_out_sp3_ep14_tp2_pp0
	layer_0_expert_sp3_ep14_tp3_pp0 [label="Expert L0 SP3 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep14_pp0 -> layer_0_expert_sp3_ep14_tp3_pp0
	layer_0_expert_out_sp3_ep14_tp3_pp0 [label="Expert Out L0 SP3 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep14_tp3_pp0 -> layer_0_expert_out_sp3_ep14_tp3_pp0
	layer_0_expert_ar_sp3_ep14_pp0 [label="Expert All-Reduce L0 SP3 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep14_tp0_pp0 -> layer_0_expert_ar_sp3_ep14_pp0
	layer_0_expert_out_sp3_ep14_tp1_pp0 -> layer_0_expert_ar_sp3_ep14_pp0
	layer_0_expert_out_sp3_ep14_tp2_pp0 -> layer_0_expert_ar_sp3_ep14_pp0
	layer_0_expert_out_sp3_ep14_tp3_pp0 -> layer_0_expert_ar_sp3_ep14_pp0
	layer_0_combine_sp3_ep14_pp0 [label="Token Combine L0 SP3 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep14_pp0 -> layer_0_combine_sp3_ep14_pp0
	layer_0_dispatch_sp3_ep15_pp0 [label="Token Dispatch L0 SP3 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_0_router_sp3_pp0 -> layer_0_dispatch_sp3_ep15_pp0 [style=dashed]
	layer_0_expert_sp3_ep15_tp0_pp0 [label="Expert L0 SP3 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep15_pp0 -> layer_0_expert_sp3_ep15_tp0_pp0
	layer_0_expert_out_sp3_ep15_tp0_pp0 [label="Expert Out L0 SP3 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep15_tp0_pp0 -> layer_0_expert_out_sp3_ep15_tp0_pp0
	layer_0_expert_sp3_ep15_tp1_pp0 [label="Expert L0 SP3 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep15_pp0 -> layer_0_expert_sp3_ep15_tp1_pp0
	layer_0_expert_out_sp3_ep15_tp1_pp0 [label="Expert Out L0 SP3 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep15_tp1_pp0 -> layer_0_expert_out_sp3_ep15_tp1_pp0
	layer_0_expert_sp3_ep15_tp2_pp0 [label="Expert L0 SP3 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep15_pp0 -> layer_0_expert_sp3_ep15_tp2_pp0
	layer_0_expert_out_sp3_ep15_tp2_pp0 [label="Expert Out L0 SP3 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep15_tp2_pp0 -> layer_0_expert_out_sp3_ep15_tp2_pp0
	layer_0_expert_sp3_ep15_tp3_pp0 [label="Expert L0 SP3 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_dispatch_sp3_ep15_pp0 -> layer_0_expert_sp3_ep15_tp3_pp0
	layer_0_expert_out_sp3_ep15_tp3_pp0 [label="Expert Out L0 SP3 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_0_expert_sp3_ep15_tp3_pp0 -> layer_0_expert_out_sp3_ep15_tp3_pp0
	layer_0_expert_ar_sp3_ep15_pp0 [label="Expert All-Reduce L0 SP3 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_0_expert_out_sp3_ep15_tp0_pp0 -> layer_0_expert_ar_sp3_ep15_pp0
	layer_0_expert_out_sp3_ep15_tp1_pp0 -> layer_0_expert_ar_sp3_ep15_pp0
	layer_0_expert_out_sp3_ep15_tp2_pp0 -> layer_0_expert_ar_sp3_ep15_pp0
	layer_0_expert_out_sp3_ep15_tp3_pp0 -> layer_0_expert_ar_sp3_ep15_pp0
	layer_0_combine_sp3_ep15_pp0 [label="Token Combine L0 SP3 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_0_expert_ar_sp3_ep15_pp0 -> layer_0_combine_sp3_ep15_pp0
	layer_0_moe_all2all_sp3_pp0 [label="MoE All-to-All L0 SP3\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_0_combine_sp3_ep0_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep1_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep2_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep3_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep4_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep5_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep6_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep7_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep8_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep9_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep10_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep11_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep12_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep13_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep14_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_combine_sp3_ep15_pp0 -> layer_0_moe_all2all_sp3_pp0
	layer_0_mlp_out_sp3_pp0 [label="MoE Output L0 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_moe_all2all_sp3_pp0 -> layer_0_mlp_out_sp3_pp0
	layer_0_mlp_res_sp3_pp0 [label="MLP Residual L0 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_mlp_out_sp3_pp0 -> layer_0_mlp_res_sp3_pp0
	layer_0_attn_res_sp3_pp0 -> layer_0_mlp_res_sp3_pp0 [style=dashed]
	layer_1_norm_sp0_pp0 [label="LayerNorm L1 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_mlp_out_sp0_pp0 -> layer_1_norm_sp0_pp0
	layer_1_qkv_sp0_tp0_pp0 [label="QKV Proj L1 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp0_pp0 -> layer_1_qkv_sp0_tp0_pp0
	layer_1_attn_sp0_tp0_pp0 [label="Attention L1 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp0_tp0_pp0 -> layer_1_attn_sp0_tp0_pp0
	layer_1_attn_out_sp0_tp0_pp0 [label="Attn Out Proj L1 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp0_tp0_pp0 -> layer_1_attn_out_sp0_tp0_pp0
	layer_1_qkv_sp0_tp1_pp0 [label="QKV Proj L1 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp0_pp0 -> layer_1_qkv_sp0_tp1_pp0
	layer_1_attn_sp0_tp1_pp0 [label="Attention L1 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp0_tp1_pp0 -> layer_1_attn_sp0_tp1_pp0
	layer_1_attn_out_sp0_tp1_pp0 [label="Attn Out Proj L1 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp0_tp1_pp0 -> layer_1_attn_out_sp0_tp1_pp0
	layer_1_qkv_sp0_tp2_pp0 [label="QKV Proj L1 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp0_pp0 -> layer_1_qkv_sp0_tp2_pp0
	layer_1_attn_sp0_tp2_pp0 [label="Attention L1 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp0_tp2_pp0 -> layer_1_attn_sp0_tp2_pp0
	layer_1_attn_out_sp0_tp2_pp0 [label="Attn Out Proj L1 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp0_tp2_pp0 -> layer_1_attn_out_sp0_tp2_pp0
	layer_1_qkv_sp0_tp3_pp0 [label="QKV Proj L1 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp0_pp0 -> layer_1_qkv_sp0_tp3_pp0
	layer_1_attn_sp0_tp3_pp0 [label="Attention L1 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp0_tp3_pp0 -> layer_1_attn_sp0_tp3_pp0
	layer_1_attn_out_sp0_tp3_pp0 [label="Attn Out Proj L1 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp0_tp3_pp0 -> layer_1_attn_out_sp0_tp3_pp0
	layer_1_attn_ar_sp0_pp0 [label="Attention All-Reduce L1 SP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_attn_out_sp0_tp0_pp0 -> layer_1_attn_ar_sp0_pp0
	layer_1_attn_out_sp0_tp1_pp0 -> layer_1_attn_ar_sp0_pp0
	layer_1_attn_out_sp0_tp2_pp0 -> layer_1_attn_ar_sp0_pp0
	layer_1_attn_out_sp0_tp3_pp0 -> layer_1_attn_ar_sp0_pp0
	layer_1_attn_res_sp0_pp0 [label="Attention Residual L1 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_attn_ar_sp0_pp0 -> layer_1_attn_res_sp0_pp0
	layer_1_norm_sp0_pp0 -> layer_1_attn_res_sp0_pp0 [style=dashed]
	layer_1_post_norm_sp0_pp0 [label="Post-Attn Norm L1 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_attn_res_sp0_pp0 -> layer_1_post_norm_sp0_pp0
	layer_1_router_sp0_pp0 [label="MoE Router L1 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_1_post_norm_sp0_pp0 -> layer_1_router_sp0_pp0
	layer_1_dispatch_sp0_ep0_pp0 [label="Token Dispatch L1 SP0 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep0_pp0 [style=dashed]
	layer_1_expert_sp0_ep0_tp0_pp0 [label="Expert L1 SP0 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep0_pp0 -> layer_1_expert_sp0_ep0_tp0_pp0
	layer_1_expert_out_sp0_ep0_tp0_pp0 [label="Expert Out L1 SP0 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep0_tp0_pp0 -> layer_1_expert_out_sp0_ep0_tp0_pp0
	layer_1_expert_sp0_ep0_tp1_pp0 [label="Expert L1 SP0 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep0_pp0 -> layer_1_expert_sp0_ep0_tp1_pp0
	layer_1_expert_out_sp0_ep0_tp1_pp0 [label="Expert Out L1 SP0 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep0_tp1_pp0 -> layer_1_expert_out_sp0_ep0_tp1_pp0
	layer_1_expert_sp0_ep0_tp2_pp0 [label="Expert L1 SP0 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep0_pp0 -> layer_1_expert_sp0_ep0_tp2_pp0
	layer_1_expert_out_sp0_ep0_tp2_pp0 [label="Expert Out L1 SP0 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep0_tp2_pp0 -> layer_1_expert_out_sp0_ep0_tp2_pp0
	layer_1_expert_sp0_ep0_tp3_pp0 [label="Expert L1 SP0 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep0_pp0 -> layer_1_expert_sp0_ep0_tp3_pp0
	layer_1_expert_out_sp0_ep0_tp3_pp0 [label="Expert Out L1 SP0 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep0_tp3_pp0 -> layer_1_expert_out_sp0_ep0_tp3_pp0
	layer_1_expert_ar_sp0_ep0_pp0 [label="Expert All-Reduce L1 SP0 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep0_tp0_pp0 -> layer_1_expert_ar_sp0_ep0_pp0
	layer_1_expert_out_sp0_ep0_tp1_pp0 -> layer_1_expert_ar_sp0_ep0_pp0
	layer_1_expert_out_sp0_ep0_tp2_pp0 -> layer_1_expert_ar_sp0_ep0_pp0
	layer_1_expert_out_sp0_ep0_tp3_pp0 -> layer_1_expert_ar_sp0_ep0_pp0
	layer_1_combine_sp0_ep0_pp0 [label="Token Combine L1 SP0 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep0_pp0 -> layer_1_combine_sp0_ep0_pp0
	layer_1_dispatch_sp0_ep1_pp0 [label="Token Dispatch L1 SP0 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep1_pp0 [style=dashed]
	layer_1_expert_sp0_ep1_tp0_pp0 [label="Expert L1 SP0 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep1_pp0 -> layer_1_expert_sp0_ep1_tp0_pp0
	layer_1_expert_out_sp0_ep1_tp0_pp0 [label="Expert Out L1 SP0 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep1_tp0_pp0 -> layer_1_expert_out_sp0_ep1_tp0_pp0
	layer_1_expert_sp0_ep1_tp1_pp0 [label="Expert L1 SP0 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep1_pp0 -> layer_1_expert_sp0_ep1_tp1_pp0
	layer_1_expert_out_sp0_ep1_tp1_pp0 [label="Expert Out L1 SP0 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep1_tp1_pp0 -> layer_1_expert_out_sp0_ep1_tp1_pp0
	layer_1_expert_sp0_ep1_tp2_pp0 [label="Expert L1 SP0 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep1_pp0 -> layer_1_expert_sp0_ep1_tp2_pp0
	layer_1_expert_out_sp0_ep1_tp2_pp0 [label="Expert Out L1 SP0 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep1_tp2_pp0 -> layer_1_expert_out_sp0_ep1_tp2_pp0
	layer_1_expert_sp0_ep1_tp3_pp0 [label="Expert L1 SP0 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep1_pp0 -> layer_1_expert_sp0_ep1_tp3_pp0
	layer_1_expert_out_sp0_ep1_tp3_pp0 [label="Expert Out L1 SP0 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep1_tp3_pp0 -> layer_1_expert_out_sp0_ep1_tp3_pp0
	layer_1_expert_ar_sp0_ep1_pp0 [label="Expert All-Reduce L1 SP0 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep1_tp0_pp0 -> layer_1_expert_ar_sp0_ep1_pp0
	layer_1_expert_out_sp0_ep1_tp1_pp0 -> layer_1_expert_ar_sp0_ep1_pp0
	layer_1_expert_out_sp0_ep1_tp2_pp0 -> layer_1_expert_ar_sp0_ep1_pp0
	layer_1_expert_out_sp0_ep1_tp3_pp0 -> layer_1_expert_ar_sp0_ep1_pp0
	layer_1_combine_sp0_ep1_pp0 [label="Token Combine L1 SP0 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep1_pp0 -> layer_1_combine_sp0_ep1_pp0
	layer_1_dispatch_sp0_ep2_pp0 [label="Token Dispatch L1 SP0 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep2_pp0 [style=dashed]
	layer_1_expert_sp0_ep2_tp0_pp0 [label="Expert L1 SP0 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep2_pp0 -> layer_1_expert_sp0_ep2_tp0_pp0
	layer_1_expert_out_sp0_ep2_tp0_pp0 [label="Expert Out L1 SP0 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep2_tp0_pp0 -> layer_1_expert_out_sp0_ep2_tp0_pp0
	layer_1_expert_sp0_ep2_tp1_pp0 [label="Expert L1 SP0 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep2_pp0 -> layer_1_expert_sp0_ep2_tp1_pp0
	layer_1_expert_out_sp0_ep2_tp1_pp0 [label="Expert Out L1 SP0 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep2_tp1_pp0 -> layer_1_expert_out_sp0_ep2_tp1_pp0
	layer_1_expert_sp0_ep2_tp2_pp0 [label="Expert L1 SP0 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep2_pp0 -> layer_1_expert_sp0_ep2_tp2_pp0
	layer_1_expert_out_sp0_ep2_tp2_pp0 [label="Expert Out L1 SP0 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep2_tp2_pp0 -> layer_1_expert_out_sp0_ep2_tp2_pp0
	layer_1_expert_sp0_ep2_tp3_pp0 [label="Expert L1 SP0 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep2_pp0 -> layer_1_expert_sp0_ep2_tp3_pp0
	layer_1_expert_out_sp0_ep2_tp3_pp0 [label="Expert Out L1 SP0 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep2_tp3_pp0 -> layer_1_expert_out_sp0_ep2_tp3_pp0
	layer_1_expert_ar_sp0_ep2_pp0 [label="Expert All-Reduce L1 SP0 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep2_tp0_pp0 -> layer_1_expert_ar_sp0_ep2_pp0
	layer_1_expert_out_sp0_ep2_tp1_pp0 -> layer_1_expert_ar_sp0_ep2_pp0
	layer_1_expert_out_sp0_ep2_tp2_pp0 -> layer_1_expert_ar_sp0_ep2_pp0
	layer_1_expert_out_sp0_ep2_tp3_pp0 -> layer_1_expert_ar_sp0_ep2_pp0
	layer_1_combine_sp0_ep2_pp0 [label="Token Combine L1 SP0 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep2_pp0 -> layer_1_combine_sp0_ep2_pp0
	layer_1_dispatch_sp0_ep3_pp0 [label="Token Dispatch L1 SP0 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep3_pp0 [style=dashed]
	layer_1_expert_sp0_ep3_tp0_pp0 [label="Expert L1 SP0 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep3_pp0 -> layer_1_expert_sp0_ep3_tp0_pp0
	layer_1_expert_out_sp0_ep3_tp0_pp0 [label="Expert Out L1 SP0 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep3_tp0_pp0 -> layer_1_expert_out_sp0_ep3_tp0_pp0
	layer_1_expert_sp0_ep3_tp1_pp0 [label="Expert L1 SP0 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep3_pp0 -> layer_1_expert_sp0_ep3_tp1_pp0
	layer_1_expert_out_sp0_ep3_tp1_pp0 [label="Expert Out L1 SP0 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep3_tp1_pp0 -> layer_1_expert_out_sp0_ep3_tp1_pp0
	layer_1_expert_sp0_ep3_tp2_pp0 [label="Expert L1 SP0 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep3_pp0 -> layer_1_expert_sp0_ep3_tp2_pp0
	layer_1_expert_out_sp0_ep3_tp2_pp0 [label="Expert Out L1 SP0 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep3_tp2_pp0 -> layer_1_expert_out_sp0_ep3_tp2_pp0
	layer_1_expert_sp0_ep3_tp3_pp0 [label="Expert L1 SP0 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep3_pp0 -> layer_1_expert_sp0_ep3_tp3_pp0
	layer_1_expert_out_sp0_ep3_tp3_pp0 [label="Expert Out L1 SP0 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep3_tp3_pp0 -> layer_1_expert_out_sp0_ep3_tp3_pp0
	layer_1_expert_ar_sp0_ep3_pp0 [label="Expert All-Reduce L1 SP0 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep3_tp0_pp0 -> layer_1_expert_ar_sp0_ep3_pp0
	layer_1_expert_out_sp0_ep3_tp1_pp0 -> layer_1_expert_ar_sp0_ep3_pp0
	layer_1_expert_out_sp0_ep3_tp2_pp0 -> layer_1_expert_ar_sp0_ep3_pp0
	layer_1_expert_out_sp0_ep3_tp3_pp0 -> layer_1_expert_ar_sp0_ep3_pp0
	layer_1_combine_sp0_ep3_pp0 [label="Token Combine L1 SP0 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep3_pp0 -> layer_1_combine_sp0_ep3_pp0
	layer_1_dispatch_sp0_ep4_pp0 [label="Token Dispatch L1 SP0 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep4_pp0 [style=dashed]
	layer_1_expert_sp0_ep4_tp0_pp0 [label="Expert L1 SP0 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep4_pp0 -> layer_1_expert_sp0_ep4_tp0_pp0
	layer_1_expert_out_sp0_ep4_tp0_pp0 [label="Expert Out L1 SP0 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep4_tp0_pp0 -> layer_1_expert_out_sp0_ep4_tp0_pp0
	layer_1_expert_sp0_ep4_tp1_pp0 [label="Expert L1 SP0 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep4_pp0 -> layer_1_expert_sp0_ep4_tp1_pp0
	layer_1_expert_out_sp0_ep4_tp1_pp0 [label="Expert Out L1 SP0 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep4_tp1_pp0 -> layer_1_expert_out_sp0_ep4_tp1_pp0
	layer_1_expert_sp0_ep4_tp2_pp0 [label="Expert L1 SP0 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep4_pp0 -> layer_1_expert_sp0_ep4_tp2_pp0
	layer_1_expert_out_sp0_ep4_tp2_pp0 [label="Expert Out L1 SP0 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep4_tp2_pp0 -> layer_1_expert_out_sp0_ep4_tp2_pp0
	layer_1_expert_sp0_ep4_tp3_pp0 [label="Expert L1 SP0 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep4_pp0 -> layer_1_expert_sp0_ep4_tp3_pp0
	layer_1_expert_out_sp0_ep4_tp3_pp0 [label="Expert Out L1 SP0 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep4_tp3_pp0 -> layer_1_expert_out_sp0_ep4_tp3_pp0
	layer_1_expert_ar_sp0_ep4_pp0 [label="Expert All-Reduce L1 SP0 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep4_tp0_pp0 -> layer_1_expert_ar_sp0_ep4_pp0
	layer_1_expert_out_sp0_ep4_tp1_pp0 -> layer_1_expert_ar_sp0_ep4_pp0
	layer_1_expert_out_sp0_ep4_tp2_pp0 -> layer_1_expert_ar_sp0_ep4_pp0
	layer_1_expert_out_sp0_ep4_tp3_pp0 -> layer_1_expert_ar_sp0_ep4_pp0
	layer_1_combine_sp0_ep4_pp0 [label="Token Combine L1 SP0 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep4_pp0 -> layer_1_combine_sp0_ep4_pp0
	layer_1_dispatch_sp0_ep5_pp0 [label="Token Dispatch L1 SP0 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep5_pp0 [style=dashed]
	layer_1_expert_sp0_ep5_tp0_pp0 [label="Expert L1 SP0 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep5_pp0 -> layer_1_expert_sp0_ep5_tp0_pp0
	layer_1_expert_out_sp0_ep5_tp0_pp0 [label="Expert Out L1 SP0 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep5_tp0_pp0 -> layer_1_expert_out_sp0_ep5_tp0_pp0
	layer_1_expert_sp0_ep5_tp1_pp0 [label="Expert L1 SP0 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep5_pp0 -> layer_1_expert_sp0_ep5_tp1_pp0
	layer_1_expert_out_sp0_ep5_tp1_pp0 [label="Expert Out L1 SP0 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep5_tp1_pp0 -> layer_1_expert_out_sp0_ep5_tp1_pp0
	layer_1_expert_sp0_ep5_tp2_pp0 [label="Expert L1 SP0 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep5_pp0 -> layer_1_expert_sp0_ep5_tp2_pp0
	layer_1_expert_out_sp0_ep5_tp2_pp0 [label="Expert Out L1 SP0 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep5_tp2_pp0 -> layer_1_expert_out_sp0_ep5_tp2_pp0
	layer_1_expert_sp0_ep5_tp3_pp0 [label="Expert L1 SP0 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep5_pp0 -> layer_1_expert_sp0_ep5_tp3_pp0
	layer_1_expert_out_sp0_ep5_tp3_pp0 [label="Expert Out L1 SP0 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep5_tp3_pp0 -> layer_1_expert_out_sp0_ep5_tp3_pp0
	layer_1_expert_ar_sp0_ep5_pp0 [label="Expert All-Reduce L1 SP0 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep5_tp0_pp0 -> layer_1_expert_ar_sp0_ep5_pp0
	layer_1_expert_out_sp0_ep5_tp1_pp0 -> layer_1_expert_ar_sp0_ep5_pp0
	layer_1_expert_out_sp0_ep5_tp2_pp0 -> layer_1_expert_ar_sp0_ep5_pp0
	layer_1_expert_out_sp0_ep5_tp3_pp0 -> layer_1_expert_ar_sp0_ep5_pp0
	layer_1_combine_sp0_ep5_pp0 [label="Token Combine L1 SP0 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep5_pp0 -> layer_1_combine_sp0_ep5_pp0
	layer_1_dispatch_sp0_ep6_pp0 [label="Token Dispatch L1 SP0 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep6_pp0 [style=dashed]
	layer_1_expert_sp0_ep6_tp0_pp0 [label="Expert L1 SP0 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep6_pp0 -> layer_1_expert_sp0_ep6_tp0_pp0
	layer_1_expert_out_sp0_ep6_tp0_pp0 [label="Expert Out L1 SP0 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep6_tp0_pp0 -> layer_1_expert_out_sp0_ep6_tp0_pp0
	layer_1_expert_sp0_ep6_tp1_pp0 [label="Expert L1 SP0 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep6_pp0 -> layer_1_expert_sp0_ep6_tp1_pp0
	layer_1_expert_out_sp0_ep6_tp1_pp0 [label="Expert Out L1 SP0 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep6_tp1_pp0 -> layer_1_expert_out_sp0_ep6_tp1_pp0
	layer_1_expert_sp0_ep6_tp2_pp0 [label="Expert L1 SP0 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep6_pp0 -> layer_1_expert_sp0_ep6_tp2_pp0
	layer_1_expert_out_sp0_ep6_tp2_pp0 [label="Expert Out L1 SP0 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep6_tp2_pp0 -> layer_1_expert_out_sp0_ep6_tp2_pp0
	layer_1_expert_sp0_ep6_tp3_pp0 [label="Expert L1 SP0 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep6_pp0 -> layer_1_expert_sp0_ep6_tp3_pp0
	layer_1_expert_out_sp0_ep6_tp3_pp0 [label="Expert Out L1 SP0 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep6_tp3_pp0 -> layer_1_expert_out_sp0_ep6_tp3_pp0
	layer_1_expert_ar_sp0_ep6_pp0 [label="Expert All-Reduce L1 SP0 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep6_tp0_pp0 -> layer_1_expert_ar_sp0_ep6_pp0
	layer_1_expert_out_sp0_ep6_tp1_pp0 -> layer_1_expert_ar_sp0_ep6_pp0
	layer_1_expert_out_sp0_ep6_tp2_pp0 -> layer_1_expert_ar_sp0_ep6_pp0
	layer_1_expert_out_sp0_ep6_tp3_pp0 -> layer_1_expert_ar_sp0_ep6_pp0
	layer_1_combine_sp0_ep6_pp0 [label="Token Combine L1 SP0 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep6_pp0 -> layer_1_combine_sp0_ep6_pp0
	layer_1_dispatch_sp0_ep7_pp0 [label="Token Dispatch L1 SP0 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep7_pp0 [style=dashed]
	layer_1_expert_sp0_ep7_tp0_pp0 [label="Expert L1 SP0 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep7_pp0 -> layer_1_expert_sp0_ep7_tp0_pp0
	layer_1_expert_out_sp0_ep7_tp0_pp0 [label="Expert Out L1 SP0 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep7_tp0_pp0 -> layer_1_expert_out_sp0_ep7_tp0_pp0
	layer_1_expert_sp0_ep7_tp1_pp0 [label="Expert L1 SP0 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep7_pp0 -> layer_1_expert_sp0_ep7_tp1_pp0
	layer_1_expert_out_sp0_ep7_tp1_pp0 [label="Expert Out L1 SP0 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep7_tp1_pp0 -> layer_1_expert_out_sp0_ep7_tp1_pp0
	layer_1_expert_sp0_ep7_tp2_pp0 [label="Expert L1 SP0 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep7_pp0 -> layer_1_expert_sp0_ep7_tp2_pp0
	layer_1_expert_out_sp0_ep7_tp2_pp0 [label="Expert Out L1 SP0 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep7_tp2_pp0 -> layer_1_expert_out_sp0_ep7_tp2_pp0
	layer_1_expert_sp0_ep7_tp3_pp0 [label="Expert L1 SP0 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep7_pp0 -> layer_1_expert_sp0_ep7_tp3_pp0
	layer_1_expert_out_sp0_ep7_tp3_pp0 [label="Expert Out L1 SP0 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep7_tp3_pp0 -> layer_1_expert_out_sp0_ep7_tp3_pp0
	layer_1_expert_ar_sp0_ep7_pp0 [label="Expert All-Reduce L1 SP0 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep7_tp0_pp0 -> layer_1_expert_ar_sp0_ep7_pp0
	layer_1_expert_out_sp0_ep7_tp1_pp0 -> layer_1_expert_ar_sp0_ep7_pp0
	layer_1_expert_out_sp0_ep7_tp2_pp0 -> layer_1_expert_ar_sp0_ep7_pp0
	layer_1_expert_out_sp0_ep7_tp3_pp0 -> layer_1_expert_ar_sp0_ep7_pp0
	layer_1_combine_sp0_ep7_pp0 [label="Token Combine L1 SP0 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep7_pp0 -> layer_1_combine_sp0_ep7_pp0
	layer_1_dispatch_sp0_ep8_pp0 [label="Token Dispatch L1 SP0 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep8_pp0 [style=dashed]
	layer_1_expert_sp0_ep8_tp0_pp0 [label="Expert L1 SP0 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep8_pp0 -> layer_1_expert_sp0_ep8_tp0_pp0
	layer_1_expert_out_sp0_ep8_tp0_pp0 [label="Expert Out L1 SP0 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep8_tp0_pp0 -> layer_1_expert_out_sp0_ep8_tp0_pp0
	layer_1_expert_sp0_ep8_tp1_pp0 [label="Expert L1 SP0 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep8_pp0 -> layer_1_expert_sp0_ep8_tp1_pp0
	layer_1_expert_out_sp0_ep8_tp1_pp0 [label="Expert Out L1 SP0 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep8_tp1_pp0 -> layer_1_expert_out_sp0_ep8_tp1_pp0
	layer_1_expert_sp0_ep8_tp2_pp0 [label="Expert L1 SP0 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep8_pp0 -> layer_1_expert_sp0_ep8_tp2_pp0
	layer_1_expert_out_sp0_ep8_tp2_pp0 [label="Expert Out L1 SP0 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep8_tp2_pp0 -> layer_1_expert_out_sp0_ep8_tp2_pp0
	layer_1_expert_sp0_ep8_tp3_pp0 [label="Expert L1 SP0 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep8_pp0 -> layer_1_expert_sp0_ep8_tp3_pp0
	layer_1_expert_out_sp0_ep8_tp3_pp0 [label="Expert Out L1 SP0 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep8_tp3_pp0 -> layer_1_expert_out_sp0_ep8_tp3_pp0
	layer_1_expert_ar_sp0_ep8_pp0 [label="Expert All-Reduce L1 SP0 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep8_tp0_pp0 -> layer_1_expert_ar_sp0_ep8_pp0
	layer_1_expert_out_sp0_ep8_tp1_pp0 -> layer_1_expert_ar_sp0_ep8_pp0
	layer_1_expert_out_sp0_ep8_tp2_pp0 -> layer_1_expert_ar_sp0_ep8_pp0
	layer_1_expert_out_sp0_ep8_tp3_pp0 -> layer_1_expert_ar_sp0_ep8_pp0
	layer_1_combine_sp0_ep8_pp0 [label="Token Combine L1 SP0 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep8_pp0 -> layer_1_combine_sp0_ep8_pp0
	layer_1_dispatch_sp0_ep9_pp0 [label="Token Dispatch L1 SP0 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep9_pp0 [style=dashed]
	layer_1_expert_sp0_ep9_tp0_pp0 [label="Expert L1 SP0 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep9_pp0 -> layer_1_expert_sp0_ep9_tp0_pp0
	layer_1_expert_out_sp0_ep9_tp0_pp0 [label="Expert Out L1 SP0 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep9_tp0_pp0 -> layer_1_expert_out_sp0_ep9_tp0_pp0
	layer_1_expert_sp0_ep9_tp1_pp0 [label="Expert L1 SP0 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep9_pp0 -> layer_1_expert_sp0_ep9_tp1_pp0
	layer_1_expert_out_sp0_ep9_tp1_pp0 [label="Expert Out L1 SP0 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep9_tp1_pp0 -> layer_1_expert_out_sp0_ep9_tp1_pp0
	layer_1_expert_sp0_ep9_tp2_pp0 [label="Expert L1 SP0 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep9_pp0 -> layer_1_expert_sp0_ep9_tp2_pp0
	layer_1_expert_out_sp0_ep9_tp2_pp0 [label="Expert Out L1 SP0 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep9_tp2_pp0 -> layer_1_expert_out_sp0_ep9_tp2_pp0
	layer_1_expert_sp0_ep9_tp3_pp0 [label="Expert L1 SP0 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep9_pp0 -> layer_1_expert_sp0_ep9_tp3_pp0
	layer_1_expert_out_sp0_ep9_tp3_pp0 [label="Expert Out L1 SP0 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep9_tp3_pp0 -> layer_1_expert_out_sp0_ep9_tp3_pp0
	layer_1_expert_ar_sp0_ep9_pp0 [label="Expert All-Reduce L1 SP0 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep9_tp0_pp0 -> layer_1_expert_ar_sp0_ep9_pp0
	layer_1_expert_out_sp0_ep9_tp1_pp0 -> layer_1_expert_ar_sp0_ep9_pp0
	layer_1_expert_out_sp0_ep9_tp2_pp0 -> layer_1_expert_ar_sp0_ep9_pp0
	layer_1_expert_out_sp0_ep9_tp3_pp0 -> layer_1_expert_ar_sp0_ep9_pp0
	layer_1_combine_sp0_ep9_pp0 [label="Token Combine L1 SP0 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep9_pp0 -> layer_1_combine_sp0_ep9_pp0
	layer_1_dispatch_sp0_ep10_pp0 [label="Token Dispatch L1 SP0 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep10_pp0 [style=dashed]
	layer_1_expert_sp0_ep10_tp0_pp0 [label="Expert L1 SP0 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep10_pp0 -> layer_1_expert_sp0_ep10_tp0_pp0
	layer_1_expert_out_sp0_ep10_tp0_pp0 [label="Expert Out L1 SP0 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep10_tp0_pp0 -> layer_1_expert_out_sp0_ep10_tp0_pp0
	layer_1_expert_sp0_ep10_tp1_pp0 [label="Expert L1 SP0 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep10_pp0 -> layer_1_expert_sp0_ep10_tp1_pp0
	layer_1_expert_out_sp0_ep10_tp1_pp0 [label="Expert Out L1 SP0 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep10_tp1_pp0 -> layer_1_expert_out_sp0_ep10_tp1_pp0
	layer_1_expert_sp0_ep10_tp2_pp0 [label="Expert L1 SP0 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep10_pp0 -> layer_1_expert_sp0_ep10_tp2_pp0
	layer_1_expert_out_sp0_ep10_tp2_pp0 [label="Expert Out L1 SP0 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep10_tp2_pp0 -> layer_1_expert_out_sp0_ep10_tp2_pp0
	layer_1_expert_sp0_ep10_tp3_pp0 [label="Expert L1 SP0 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep10_pp0 -> layer_1_expert_sp0_ep10_tp3_pp0
	layer_1_expert_out_sp0_ep10_tp3_pp0 [label="Expert Out L1 SP0 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep10_tp3_pp0 -> layer_1_expert_out_sp0_ep10_tp3_pp0
	layer_1_expert_ar_sp0_ep10_pp0 [label="Expert All-Reduce L1 SP0 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep10_tp0_pp0 -> layer_1_expert_ar_sp0_ep10_pp0
	layer_1_expert_out_sp0_ep10_tp1_pp0 -> layer_1_expert_ar_sp0_ep10_pp0
	layer_1_expert_out_sp0_ep10_tp2_pp0 -> layer_1_expert_ar_sp0_ep10_pp0
	layer_1_expert_out_sp0_ep10_tp3_pp0 -> layer_1_expert_ar_sp0_ep10_pp0
	layer_1_combine_sp0_ep10_pp0 [label="Token Combine L1 SP0 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep10_pp0 -> layer_1_combine_sp0_ep10_pp0
	layer_1_dispatch_sp0_ep11_pp0 [label="Token Dispatch L1 SP0 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep11_pp0 [style=dashed]
	layer_1_expert_sp0_ep11_tp0_pp0 [label="Expert L1 SP0 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep11_pp0 -> layer_1_expert_sp0_ep11_tp0_pp0
	layer_1_expert_out_sp0_ep11_tp0_pp0 [label="Expert Out L1 SP0 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep11_tp0_pp0 -> layer_1_expert_out_sp0_ep11_tp0_pp0
	layer_1_expert_sp0_ep11_tp1_pp0 [label="Expert L1 SP0 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep11_pp0 -> layer_1_expert_sp0_ep11_tp1_pp0
	layer_1_expert_out_sp0_ep11_tp1_pp0 [label="Expert Out L1 SP0 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep11_tp1_pp0 -> layer_1_expert_out_sp0_ep11_tp1_pp0
	layer_1_expert_sp0_ep11_tp2_pp0 [label="Expert L1 SP0 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep11_pp0 -> layer_1_expert_sp0_ep11_tp2_pp0
	layer_1_expert_out_sp0_ep11_tp2_pp0 [label="Expert Out L1 SP0 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep11_tp2_pp0 -> layer_1_expert_out_sp0_ep11_tp2_pp0
	layer_1_expert_sp0_ep11_tp3_pp0 [label="Expert L1 SP0 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep11_pp0 -> layer_1_expert_sp0_ep11_tp3_pp0
	layer_1_expert_out_sp0_ep11_tp3_pp0 [label="Expert Out L1 SP0 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep11_tp3_pp0 -> layer_1_expert_out_sp0_ep11_tp3_pp0
	layer_1_expert_ar_sp0_ep11_pp0 [label="Expert All-Reduce L1 SP0 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep11_tp0_pp0 -> layer_1_expert_ar_sp0_ep11_pp0
	layer_1_expert_out_sp0_ep11_tp1_pp0 -> layer_1_expert_ar_sp0_ep11_pp0
	layer_1_expert_out_sp0_ep11_tp2_pp0 -> layer_1_expert_ar_sp0_ep11_pp0
	layer_1_expert_out_sp0_ep11_tp3_pp0 -> layer_1_expert_ar_sp0_ep11_pp0
	layer_1_combine_sp0_ep11_pp0 [label="Token Combine L1 SP0 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep11_pp0 -> layer_1_combine_sp0_ep11_pp0
	layer_1_dispatch_sp0_ep12_pp0 [label="Token Dispatch L1 SP0 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep12_pp0 [style=dashed]
	layer_1_expert_sp0_ep12_tp0_pp0 [label="Expert L1 SP0 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep12_pp0 -> layer_1_expert_sp0_ep12_tp0_pp0
	layer_1_expert_out_sp0_ep12_tp0_pp0 [label="Expert Out L1 SP0 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep12_tp0_pp0 -> layer_1_expert_out_sp0_ep12_tp0_pp0
	layer_1_expert_sp0_ep12_tp1_pp0 [label="Expert L1 SP0 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep12_pp0 -> layer_1_expert_sp0_ep12_tp1_pp0
	layer_1_expert_out_sp0_ep12_tp1_pp0 [label="Expert Out L1 SP0 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep12_tp1_pp0 -> layer_1_expert_out_sp0_ep12_tp1_pp0
	layer_1_expert_sp0_ep12_tp2_pp0 [label="Expert L1 SP0 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep12_pp0 -> layer_1_expert_sp0_ep12_tp2_pp0
	layer_1_expert_out_sp0_ep12_tp2_pp0 [label="Expert Out L1 SP0 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep12_tp2_pp0 -> layer_1_expert_out_sp0_ep12_tp2_pp0
	layer_1_expert_sp0_ep12_tp3_pp0 [label="Expert L1 SP0 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep12_pp0 -> layer_1_expert_sp0_ep12_tp3_pp0
	layer_1_expert_out_sp0_ep12_tp3_pp0 [label="Expert Out L1 SP0 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep12_tp3_pp0 -> layer_1_expert_out_sp0_ep12_tp3_pp0
	layer_1_expert_ar_sp0_ep12_pp0 [label="Expert All-Reduce L1 SP0 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep12_tp0_pp0 -> layer_1_expert_ar_sp0_ep12_pp0
	layer_1_expert_out_sp0_ep12_tp1_pp0 -> layer_1_expert_ar_sp0_ep12_pp0
	layer_1_expert_out_sp0_ep12_tp2_pp0 -> layer_1_expert_ar_sp0_ep12_pp0
	layer_1_expert_out_sp0_ep12_tp3_pp0 -> layer_1_expert_ar_sp0_ep12_pp0
	layer_1_combine_sp0_ep12_pp0 [label="Token Combine L1 SP0 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep12_pp0 -> layer_1_combine_sp0_ep12_pp0
	layer_1_dispatch_sp0_ep13_pp0 [label="Token Dispatch L1 SP0 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep13_pp0 [style=dashed]
	layer_1_expert_sp0_ep13_tp0_pp0 [label="Expert L1 SP0 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep13_pp0 -> layer_1_expert_sp0_ep13_tp0_pp0
	layer_1_expert_out_sp0_ep13_tp0_pp0 [label="Expert Out L1 SP0 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep13_tp0_pp0 -> layer_1_expert_out_sp0_ep13_tp0_pp0
	layer_1_expert_sp0_ep13_tp1_pp0 [label="Expert L1 SP0 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep13_pp0 -> layer_1_expert_sp0_ep13_tp1_pp0
	layer_1_expert_out_sp0_ep13_tp1_pp0 [label="Expert Out L1 SP0 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep13_tp1_pp0 -> layer_1_expert_out_sp0_ep13_tp1_pp0
	layer_1_expert_sp0_ep13_tp2_pp0 [label="Expert L1 SP0 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep13_pp0 -> layer_1_expert_sp0_ep13_tp2_pp0
	layer_1_expert_out_sp0_ep13_tp2_pp0 [label="Expert Out L1 SP0 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep13_tp2_pp0 -> layer_1_expert_out_sp0_ep13_tp2_pp0
	layer_1_expert_sp0_ep13_tp3_pp0 [label="Expert L1 SP0 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep13_pp0 -> layer_1_expert_sp0_ep13_tp3_pp0
	layer_1_expert_out_sp0_ep13_tp3_pp0 [label="Expert Out L1 SP0 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep13_tp3_pp0 -> layer_1_expert_out_sp0_ep13_tp3_pp0
	layer_1_expert_ar_sp0_ep13_pp0 [label="Expert All-Reduce L1 SP0 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep13_tp0_pp0 -> layer_1_expert_ar_sp0_ep13_pp0
	layer_1_expert_out_sp0_ep13_tp1_pp0 -> layer_1_expert_ar_sp0_ep13_pp0
	layer_1_expert_out_sp0_ep13_tp2_pp0 -> layer_1_expert_ar_sp0_ep13_pp0
	layer_1_expert_out_sp0_ep13_tp3_pp0 -> layer_1_expert_ar_sp0_ep13_pp0
	layer_1_combine_sp0_ep13_pp0 [label="Token Combine L1 SP0 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep13_pp0 -> layer_1_combine_sp0_ep13_pp0
	layer_1_dispatch_sp0_ep14_pp0 [label="Token Dispatch L1 SP0 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep14_pp0 [style=dashed]
	layer_1_expert_sp0_ep14_tp0_pp0 [label="Expert L1 SP0 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep14_pp0 -> layer_1_expert_sp0_ep14_tp0_pp0
	layer_1_expert_out_sp0_ep14_tp0_pp0 [label="Expert Out L1 SP0 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep14_tp0_pp0 -> layer_1_expert_out_sp0_ep14_tp0_pp0
	layer_1_expert_sp0_ep14_tp1_pp0 [label="Expert L1 SP0 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep14_pp0 -> layer_1_expert_sp0_ep14_tp1_pp0
	layer_1_expert_out_sp0_ep14_tp1_pp0 [label="Expert Out L1 SP0 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep14_tp1_pp0 -> layer_1_expert_out_sp0_ep14_tp1_pp0
	layer_1_expert_sp0_ep14_tp2_pp0 [label="Expert L1 SP0 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep14_pp0 -> layer_1_expert_sp0_ep14_tp2_pp0
	layer_1_expert_out_sp0_ep14_tp2_pp0 [label="Expert Out L1 SP0 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep14_tp2_pp0 -> layer_1_expert_out_sp0_ep14_tp2_pp0
	layer_1_expert_sp0_ep14_tp3_pp0 [label="Expert L1 SP0 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep14_pp0 -> layer_1_expert_sp0_ep14_tp3_pp0
	layer_1_expert_out_sp0_ep14_tp3_pp0 [label="Expert Out L1 SP0 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep14_tp3_pp0 -> layer_1_expert_out_sp0_ep14_tp3_pp0
	layer_1_expert_ar_sp0_ep14_pp0 [label="Expert All-Reduce L1 SP0 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep14_tp0_pp0 -> layer_1_expert_ar_sp0_ep14_pp0
	layer_1_expert_out_sp0_ep14_tp1_pp0 -> layer_1_expert_ar_sp0_ep14_pp0
	layer_1_expert_out_sp0_ep14_tp2_pp0 -> layer_1_expert_ar_sp0_ep14_pp0
	layer_1_expert_out_sp0_ep14_tp3_pp0 -> layer_1_expert_ar_sp0_ep14_pp0
	layer_1_combine_sp0_ep14_pp0 [label="Token Combine L1 SP0 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep14_pp0 -> layer_1_combine_sp0_ep14_pp0
	layer_1_dispatch_sp0_ep15_pp0 [label="Token Dispatch L1 SP0 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp0_pp0 -> layer_1_dispatch_sp0_ep15_pp0 [style=dashed]
	layer_1_expert_sp0_ep15_tp0_pp0 [label="Expert L1 SP0 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep15_pp0 -> layer_1_expert_sp0_ep15_tp0_pp0
	layer_1_expert_out_sp0_ep15_tp0_pp0 [label="Expert Out L1 SP0 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep15_tp0_pp0 -> layer_1_expert_out_sp0_ep15_tp0_pp0
	layer_1_expert_sp0_ep15_tp1_pp0 [label="Expert L1 SP0 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep15_pp0 -> layer_1_expert_sp0_ep15_tp1_pp0
	layer_1_expert_out_sp0_ep15_tp1_pp0 [label="Expert Out L1 SP0 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep15_tp1_pp0 -> layer_1_expert_out_sp0_ep15_tp1_pp0
	layer_1_expert_sp0_ep15_tp2_pp0 [label="Expert L1 SP0 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep15_pp0 -> layer_1_expert_sp0_ep15_tp2_pp0
	layer_1_expert_out_sp0_ep15_tp2_pp0 [label="Expert Out L1 SP0 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep15_tp2_pp0 -> layer_1_expert_out_sp0_ep15_tp2_pp0
	layer_1_expert_sp0_ep15_tp3_pp0 [label="Expert L1 SP0 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp0_ep15_pp0 -> layer_1_expert_sp0_ep15_tp3_pp0
	layer_1_expert_out_sp0_ep15_tp3_pp0 [label="Expert Out L1 SP0 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp0_ep15_tp3_pp0 -> layer_1_expert_out_sp0_ep15_tp3_pp0
	layer_1_expert_ar_sp0_ep15_pp0 [label="Expert All-Reduce L1 SP0 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp0_ep15_tp0_pp0 -> layer_1_expert_ar_sp0_ep15_pp0
	layer_1_expert_out_sp0_ep15_tp1_pp0 -> layer_1_expert_ar_sp0_ep15_pp0
	layer_1_expert_out_sp0_ep15_tp2_pp0 -> layer_1_expert_ar_sp0_ep15_pp0
	layer_1_expert_out_sp0_ep15_tp3_pp0 -> layer_1_expert_ar_sp0_ep15_pp0
	layer_1_combine_sp0_ep15_pp0 [label="Token Combine L1 SP0 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp0_ep15_pp0 -> layer_1_combine_sp0_ep15_pp0
	layer_1_moe_all2all_sp0_pp0 [label="MoE All-to-All L1 SP0\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_1_combine_sp0_ep0_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep1_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep2_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep3_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep4_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep5_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep6_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep7_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep8_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep9_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep10_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep11_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep12_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep13_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep14_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_combine_sp0_ep15_pp0 -> layer_1_moe_all2all_sp0_pp0
	layer_1_mlp_out_sp0_pp0 [label="MoE Output L1 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_moe_all2all_sp0_pp0 -> layer_1_mlp_out_sp0_pp0
	layer_1_mlp_res_sp0_pp0 [label="MLP Residual L1 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_mlp_out_sp0_pp0 -> layer_1_mlp_res_sp0_pp0
	layer_1_attn_res_sp0_pp0 -> layer_1_mlp_res_sp0_pp0 [style=dashed]
	layer_1_norm_sp1_pp0 [label="LayerNorm L1 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_mlp_out_sp1_pp0 -> layer_1_norm_sp1_pp0
	layer_1_qkv_sp1_tp0_pp0 [label="QKV Proj L1 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp1_pp0 -> layer_1_qkv_sp1_tp0_pp0
	layer_1_attn_sp1_tp0_pp0 [label="Attention L1 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp1_tp0_pp0 -> layer_1_attn_sp1_tp0_pp0
	layer_1_attn_out_sp1_tp0_pp0 [label="Attn Out Proj L1 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp1_tp0_pp0 -> layer_1_attn_out_sp1_tp0_pp0
	layer_1_qkv_sp1_tp1_pp0 [label="QKV Proj L1 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp1_pp0 -> layer_1_qkv_sp1_tp1_pp0
	layer_1_attn_sp1_tp1_pp0 [label="Attention L1 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp1_tp1_pp0 -> layer_1_attn_sp1_tp1_pp0
	layer_1_attn_out_sp1_tp1_pp0 [label="Attn Out Proj L1 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp1_tp1_pp0 -> layer_1_attn_out_sp1_tp1_pp0
	layer_1_qkv_sp1_tp2_pp0 [label="QKV Proj L1 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp1_pp0 -> layer_1_qkv_sp1_tp2_pp0
	layer_1_attn_sp1_tp2_pp0 [label="Attention L1 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp1_tp2_pp0 -> layer_1_attn_sp1_tp2_pp0
	layer_1_attn_out_sp1_tp2_pp0 [label="Attn Out Proj L1 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp1_tp2_pp0 -> layer_1_attn_out_sp1_tp2_pp0
	layer_1_qkv_sp1_tp3_pp0 [label="QKV Proj L1 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp1_pp0 -> layer_1_qkv_sp1_tp3_pp0
	layer_1_attn_sp1_tp3_pp0 [label="Attention L1 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp1_tp3_pp0 -> layer_1_attn_sp1_tp3_pp0
	layer_1_attn_out_sp1_tp3_pp0 [label="Attn Out Proj L1 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp1_tp3_pp0 -> layer_1_attn_out_sp1_tp3_pp0
	layer_1_attn_ar_sp1_pp0 [label="Attention All-Reduce L1 SP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_attn_out_sp1_tp0_pp0 -> layer_1_attn_ar_sp1_pp0
	layer_1_attn_out_sp1_tp1_pp0 -> layer_1_attn_ar_sp1_pp0
	layer_1_attn_out_sp1_tp2_pp0 -> layer_1_attn_ar_sp1_pp0
	layer_1_attn_out_sp1_tp3_pp0 -> layer_1_attn_ar_sp1_pp0
	layer_1_attn_res_sp1_pp0 [label="Attention Residual L1 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_attn_ar_sp1_pp0 -> layer_1_attn_res_sp1_pp0
	layer_1_norm_sp1_pp0 -> layer_1_attn_res_sp1_pp0 [style=dashed]
	layer_1_post_norm_sp1_pp0 [label="Post-Attn Norm L1 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_attn_res_sp1_pp0 -> layer_1_post_norm_sp1_pp0
	layer_1_router_sp1_pp0 [label="MoE Router L1 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_1_post_norm_sp1_pp0 -> layer_1_router_sp1_pp0
	layer_1_dispatch_sp1_ep0_pp0 [label="Token Dispatch L1 SP1 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep0_pp0 [style=dashed]
	layer_1_expert_sp1_ep0_tp0_pp0 [label="Expert L1 SP1 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep0_pp0 -> layer_1_expert_sp1_ep0_tp0_pp0
	layer_1_expert_out_sp1_ep0_tp0_pp0 [label="Expert Out L1 SP1 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep0_tp0_pp0 -> layer_1_expert_out_sp1_ep0_tp0_pp0
	layer_1_expert_sp1_ep0_tp1_pp0 [label="Expert L1 SP1 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep0_pp0 -> layer_1_expert_sp1_ep0_tp1_pp0
	layer_1_expert_out_sp1_ep0_tp1_pp0 [label="Expert Out L1 SP1 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep0_tp1_pp0 -> layer_1_expert_out_sp1_ep0_tp1_pp0
	layer_1_expert_sp1_ep0_tp2_pp0 [label="Expert L1 SP1 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep0_pp0 -> layer_1_expert_sp1_ep0_tp2_pp0
	layer_1_expert_out_sp1_ep0_tp2_pp0 [label="Expert Out L1 SP1 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep0_tp2_pp0 -> layer_1_expert_out_sp1_ep0_tp2_pp0
	layer_1_expert_sp1_ep0_tp3_pp0 [label="Expert L1 SP1 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep0_pp0 -> layer_1_expert_sp1_ep0_tp3_pp0
	layer_1_expert_out_sp1_ep0_tp3_pp0 [label="Expert Out L1 SP1 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep0_tp3_pp0 -> layer_1_expert_out_sp1_ep0_tp3_pp0
	layer_1_expert_ar_sp1_ep0_pp0 [label="Expert All-Reduce L1 SP1 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep0_tp0_pp0 -> layer_1_expert_ar_sp1_ep0_pp0
	layer_1_expert_out_sp1_ep0_tp1_pp0 -> layer_1_expert_ar_sp1_ep0_pp0
	layer_1_expert_out_sp1_ep0_tp2_pp0 -> layer_1_expert_ar_sp1_ep0_pp0
	layer_1_expert_out_sp1_ep0_tp3_pp0 -> layer_1_expert_ar_sp1_ep0_pp0
	layer_1_combine_sp1_ep0_pp0 [label="Token Combine L1 SP1 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep0_pp0 -> layer_1_combine_sp1_ep0_pp0
	layer_1_dispatch_sp1_ep1_pp0 [label="Token Dispatch L1 SP1 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep1_pp0 [style=dashed]
	layer_1_expert_sp1_ep1_tp0_pp0 [label="Expert L1 SP1 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep1_pp0 -> layer_1_expert_sp1_ep1_tp0_pp0
	layer_1_expert_out_sp1_ep1_tp0_pp0 [label="Expert Out L1 SP1 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep1_tp0_pp0 -> layer_1_expert_out_sp1_ep1_tp0_pp0
	layer_1_expert_sp1_ep1_tp1_pp0 [label="Expert L1 SP1 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep1_pp0 -> layer_1_expert_sp1_ep1_tp1_pp0
	layer_1_expert_out_sp1_ep1_tp1_pp0 [label="Expert Out L1 SP1 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep1_tp1_pp0 -> layer_1_expert_out_sp1_ep1_tp1_pp0
	layer_1_expert_sp1_ep1_tp2_pp0 [label="Expert L1 SP1 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep1_pp0 -> layer_1_expert_sp1_ep1_tp2_pp0
	layer_1_expert_out_sp1_ep1_tp2_pp0 [label="Expert Out L1 SP1 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep1_tp2_pp0 -> layer_1_expert_out_sp1_ep1_tp2_pp0
	layer_1_expert_sp1_ep1_tp3_pp0 [label="Expert L1 SP1 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep1_pp0 -> layer_1_expert_sp1_ep1_tp3_pp0
	layer_1_expert_out_sp1_ep1_tp3_pp0 [label="Expert Out L1 SP1 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep1_tp3_pp0 -> layer_1_expert_out_sp1_ep1_tp3_pp0
	layer_1_expert_ar_sp1_ep1_pp0 [label="Expert All-Reduce L1 SP1 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep1_tp0_pp0 -> layer_1_expert_ar_sp1_ep1_pp0
	layer_1_expert_out_sp1_ep1_tp1_pp0 -> layer_1_expert_ar_sp1_ep1_pp0
	layer_1_expert_out_sp1_ep1_tp2_pp0 -> layer_1_expert_ar_sp1_ep1_pp0
	layer_1_expert_out_sp1_ep1_tp3_pp0 -> layer_1_expert_ar_sp1_ep1_pp0
	layer_1_combine_sp1_ep1_pp0 [label="Token Combine L1 SP1 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep1_pp0 -> layer_1_combine_sp1_ep1_pp0
	layer_1_dispatch_sp1_ep2_pp0 [label="Token Dispatch L1 SP1 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep2_pp0 [style=dashed]
	layer_1_expert_sp1_ep2_tp0_pp0 [label="Expert L1 SP1 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep2_pp0 -> layer_1_expert_sp1_ep2_tp0_pp0
	layer_1_expert_out_sp1_ep2_tp0_pp0 [label="Expert Out L1 SP1 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep2_tp0_pp0 -> layer_1_expert_out_sp1_ep2_tp0_pp0
	layer_1_expert_sp1_ep2_tp1_pp0 [label="Expert L1 SP1 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep2_pp0 -> layer_1_expert_sp1_ep2_tp1_pp0
	layer_1_expert_out_sp1_ep2_tp1_pp0 [label="Expert Out L1 SP1 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep2_tp1_pp0 -> layer_1_expert_out_sp1_ep2_tp1_pp0
	layer_1_expert_sp1_ep2_tp2_pp0 [label="Expert L1 SP1 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep2_pp0 -> layer_1_expert_sp1_ep2_tp2_pp0
	layer_1_expert_out_sp1_ep2_tp2_pp0 [label="Expert Out L1 SP1 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep2_tp2_pp0 -> layer_1_expert_out_sp1_ep2_tp2_pp0
	layer_1_expert_sp1_ep2_tp3_pp0 [label="Expert L1 SP1 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep2_pp0 -> layer_1_expert_sp1_ep2_tp3_pp0
	layer_1_expert_out_sp1_ep2_tp3_pp0 [label="Expert Out L1 SP1 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep2_tp3_pp0 -> layer_1_expert_out_sp1_ep2_tp3_pp0
	layer_1_expert_ar_sp1_ep2_pp0 [label="Expert All-Reduce L1 SP1 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep2_tp0_pp0 -> layer_1_expert_ar_sp1_ep2_pp0
	layer_1_expert_out_sp1_ep2_tp1_pp0 -> layer_1_expert_ar_sp1_ep2_pp0
	layer_1_expert_out_sp1_ep2_tp2_pp0 -> layer_1_expert_ar_sp1_ep2_pp0
	layer_1_expert_out_sp1_ep2_tp3_pp0 -> layer_1_expert_ar_sp1_ep2_pp0
	layer_1_combine_sp1_ep2_pp0 [label="Token Combine L1 SP1 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep2_pp0 -> layer_1_combine_sp1_ep2_pp0
	layer_1_dispatch_sp1_ep3_pp0 [label="Token Dispatch L1 SP1 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep3_pp0 [style=dashed]
	layer_1_expert_sp1_ep3_tp0_pp0 [label="Expert L1 SP1 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep3_pp0 -> layer_1_expert_sp1_ep3_tp0_pp0
	layer_1_expert_out_sp1_ep3_tp0_pp0 [label="Expert Out L1 SP1 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep3_tp0_pp0 -> layer_1_expert_out_sp1_ep3_tp0_pp0
	layer_1_expert_sp1_ep3_tp1_pp0 [label="Expert L1 SP1 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep3_pp0 -> layer_1_expert_sp1_ep3_tp1_pp0
	layer_1_expert_out_sp1_ep3_tp1_pp0 [label="Expert Out L1 SP1 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep3_tp1_pp0 -> layer_1_expert_out_sp1_ep3_tp1_pp0
	layer_1_expert_sp1_ep3_tp2_pp0 [label="Expert L1 SP1 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep3_pp0 -> layer_1_expert_sp1_ep3_tp2_pp0
	layer_1_expert_out_sp1_ep3_tp2_pp0 [label="Expert Out L1 SP1 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep3_tp2_pp0 -> layer_1_expert_out_sp1_ep3_tp2_pp0
	layer_1_expert_sp1_ep3_tp3_pp0 [label="Expert L1 SP1 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep3_pp0 -> layer_1_expert_sp1_ep3_tp3_pp0
	layer_1_expert_out_sp1_ep3_tp3_pp0 [label="Expert Out L1 SP1 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep3_tp3_pp0 -> layer_1_expert_out_sp1_ep3_tp3_pp0
	layer_1_expert_ar_sp1_ep3_pp0 [label="Expert All-Reduce L1 SP1 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep3_tp0_pp0 -> layer_1_expert_ar_sp1_ep3_pp0
	layer_1_expert_out_sp1_ep3_tp1_pp0 -> layer_1_expert_ar_sp1_ep3_pp0
	layer_1_expert_out_sp1_ep3_tp2_pp0 -> layer_1_expert_ar_sp1_ep3_pp0
	layer_1_expert_out_sp1_ep3_tp3_pp0 -> layer_1_expert_ar_sp1_ep3_pp0
	layer_1_combine_sp1_ep3_pp0 [label="Token Combine L1 SP1 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep3_pp0 -> layer_1_combine_sp1_ep3_pp0
	layer_1_dispatch_sp1_ep4_pp0 [label="Token Dispatch L1 SP1 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep4_pp0 [style=dashed]
	layer_1_expert_sp1_ep4_tp0_pp0 [label="Expert L1 SP1 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep4_pp0 -> layer_1_expert_sp1_ep4_tp0_pp0
	layer_1_expert_out_sp1_ep4_tp0_pp0 [label="Expert Out L1 SP1 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep4_tp0_pp0 -> layer_1_expert_out_sp1_ep4_tp0_pp0
	layer_1_expert_sp1_ep4_tp1_pp0 [label="Expert L1 SP1 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep4_pp0 -> layer_1_expert_sp1_ep4_tp1_pp0
	layer_1_expert_out_sp1_ep4_tp1_pp0 [label="Expert Out L1 SP1 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep4_tp1_pp0 -> layer_1_expert_out_sp1_ep4_tp1_pp0
	layer_1_expert_sp1_ep4_tp2_pp0 [label="Expert L1 SP1 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep4_pp0 -> layer_1_expert_sp1_ep4_tp2_pp0
	layer_1_expert_out_sp1_ep4_tp2_pp0 [label="Expert Out L1 SP1 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep4_tp2_pp0 -> layer_1_expert_out_sp1_ep4_tp2_pp0
	layer_1_expert_sp1_ep4_tp3_pp0 [label="Expert L1 SP1 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep4_pp0 -> layer_1_expert_sp1_ep4_tp3_pp0
	layer_1_expert_out_sp1_ep4_tp3_pp0 [label="Expert Out L1 SP1 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep4_tp3_pp0 -> layer_1_expert_out_sp1_ep4_tp3_pp0
	layer_1_expert_ar_sp1_ep4_pp0 [label="Expert All-Reduce L1 SP1 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep4_tp0_pp0 -> layer_1_expert_ar_sp1_ep4_pp0
	layer_1_expert_out_sp1_ep4_tp1_pp0 -> layer_1_expert_ar_sp1_ep4_pp0
	layer_1_expert_out_sp1_ep4_tp2_pp0 -> layer_1_expert_ar_sp1_ep4_pp0
	layer_1_expert_out_sp1_ep4_tp3_pp0 -> layer_1_expert_ar_sp1_ep4_pp0
	layer_1_combine_sp1_ep4_pp0 [label="Token Combine L1 SP1 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep4_pp0 -> layer_1_combine_sp1_ep4_pp0
	layer_1_dispatch_sp1_ep5_pp0 [label="Token Dispatch L1 SP1 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep5_pp0 [style=dashed]
	layer_1_expert_sp1_ep5_tp0_pp0 [label="Expert L1 SP1 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep5_pp0 -> layer_1_expert_sp1_ep5_tp0_pp0
	layer_1_expert_out_sp1_ep5_tp0_pp0 [label="Expert Out L1 SP1 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep5_tp0_pp0 -> layer_1_expert_out_sp1_ep5_tp0_pp0
	layer_1_expert_sp1_ep5_tp1_pp0 [label="Expert L1 SP1 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep5_pp0 -> layer_1_expert_sp1_ep5_tp1_pp0
	layer_1_expert_out_sp1_ep5_tp1_pp0 [label="Expert Out L1 SP1 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep5_tp1_pp0 -> layer_1_expert_out_sp1_ep5_tp1_pp0
	layer_1_expert_sp1_ep5_tp2_pp0 [label="Expert L1 SP1 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep5_pp0 -> layer_1_expert_sp1_ep5_tp2_pp0
	layer_1_expert_out_sp1_ep5_tp2_pp0 [label="Expert Out L1 SP1 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep5_tp2_pp0 -> layer_1_expert_out_sp1_ep5_tp2_pp0
	layer_1_expert_sp1_ep5_tp3_pp0 [label="Expert L1 SP1 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep5_pp0 -> layer_1_expert_sp1_ep5_tp3_pp0
	layer_1_expert_out_sp1_ep5_tp3_pp0 [label="Expert Out L1 SP1 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep5_tp3_pp0 -> layer_1_expert_out_sp1_ep5_tp3_pp0
	layer_1_expert_ar_sp1_ep5_pp0 [label="Expert All-Reduce L1 SP1 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep5_tp0_pp0 -> layer_1_expert_ar_sp1_ep5_pp0
	layer_1_expert_out_sp1_ep5_tp1_pp0 -> layer_1_expert_ar_sp1_ep5_pp0
	layer_1_expert_out_sp1_ep5_tp2_pp0 -> layer_1_expert_ar_sp1_ep5_pp0
	layer_1_expert_out_sp1_ep5_tp3_pp0 -> layer_1_expert_ar_sp1_ep5_pp0
	layer_1_combine_sp1_ep5_pp0 [label="Token Combine L1 SP1 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep5_pp0 -> layer_1_combine_sp1_ep5_pp0
	layer_1_dispatch_sp1_ep6_pp0 [label="Token Dispatch L1 SP1 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep6_pp0 [style=dashed]
	layer_1_expert_sp1_ep6_tp0_pp0 [label="Expert L1 SP1 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep6_pp0 -> layer_1_expert_sp1_ep6_tp0_pp0
	layer_1_expert_out_sp1_ep6_tp0_pp0 [label="Expert Out L1 SP1 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep6_tp0_pp0 -> layer_1_expert_out_sp1_ep6_tp0_pp0
	layer_1_expert_sp1_ep6_tp1_pp0 [label="Expert L1 SP1 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep6_pp0 -> layer_1_expert_sp1_ep6_tp1_pp0
	layer_1_expert_out_sp1_ep6_tp1_pp0 [label="Expert Out L1 SP1 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep6_tp1_pp0 -> layer_1_expert_out_sp1_ep6_tp1_pp0
	layer_1_expert_sp1_ep6_tp2_pp0 [label="Expert L1 SP1 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep6_pp0 -> layer_1_expert_sp1_ep6_tp2_pp0
	layer_1_expert_out_sp1_ep6_tp2_pp0 [label="Expert Out L1 SP1 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep6_tp2_pp0 -> layer_1_expert_out_sp1_ep6_tp2_pp0
	layer_1_expert_sp1_ep6_tp3_pp0 [label="Expert L1 SP1 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep6_pp0 -> layer_1_expert_sp1_ep6_tp3_pp0
	layer_1_expert_out_sp1_ep6_tp3_pp0 [label="Expert Out L1 SP1 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep6_tp3_pp0 -> layer_1_expert_out_sp1_ep6_tp3_pp0
	layer_1_expert_ar_sp1_ep6_pp0 [label="Expert All-Reduce L1 SP1 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep6_tp0_pp0 -> layer_1_expert_ar_sp1_ep6_pp0
	layer_1_expert_out_sp1_ep6_tp1_pp0 -> layer_1_expert_ar_sp1_ep6_pp0
	layer_1_expert_out_sp1_ep6_tp2_pp0 -> layer_1_expert_ar_sp1_ep6_pp0
	layer_1_expert_out_sp1_ep6_tp3_pp0 -> layer_1_expert_ar_sp1_ep6_pp0
	layer_1_combine_sp1_ep6_pp0 [label="Token Combine L1 SP1 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep6_pp0 -> layer_1_combine_sp1_ep6_pp0
	layer_1_dispatch_sp1_ep7_pp0 [label="Token Dispatch L1 SP1 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep7_pp0 [style=dashed]
	layer_1_expert_sp1_ep7_tp0_pp0 [label="Expert L1 SP1 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep7_pp0 -> layer_1_expert_sp1_ep7_tp0_pp0
	layer_1_expert_out_sp1_ep7_tp0_pp0 [label="Expert Out L1 SP1 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep7_tp0_pp0 -> layer_1_expert_out_sp1_ep7_tp0_pp0
	layer_1_expert_sp1_ep7_tp1_pp0 [label="Expert L1 SP1 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep7_pp0 -> layer_1_expert_sp1_ep7_tp1_pp0
	layer_1_expert_out_sp1_ep7_tp1_pp0 [label="Expert Out L1 SP1 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep7_tp1_pp0 -> layer_1_expert_out_sp1_ep7_tp1_pp0
	layer_1_expert_sp1_ep7_tp2_pp0 [label="Expert L1 SP1 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep7_pp0 -> layer_1_expert_sp1_ep7_tp2_pp0
	layer_1_expert_out_sp1_ep7_tp2_pp0 [label="Expert Out L1 SP1 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep7_tp2_pp0 -> layer_1_expert_out_sp1_ep7_tp2_pp0
	layer_1_expert_sp1_ep7_tp3_pp0 [label="Expert L1 SP1 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep7_pp0 -> layer_1_expert_sp1_ep7_tp3_pp0
	layer_1_expert_out_sp1_ep7_tp3_pp0 [label="Expert Out L1 SP1 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep7_tp3_pp0 -> layer_1_expert_out_sp1_ep7_tp3_pp0
	layer_1_expert_ar_sp1_ep7_pp0 [label="Expert All-Reduce L1 SP1 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep7_tp0_pp0 -> layer_1_expert_ar_sp1_ep7_pp0
	layer_1_expert_out_sp1_ep7_tp1_pp0 -> layer_1_expert_ar_sp1_ep7_pp0
	layer_1_expert_out_sp1_ep7_tp2_pp0 -> layer_1_expert_ar_sp1_ep7_pp0
	layer_1_expert_out_sp1_ep7_tp3_pp0 -> layer_1_expert_ar_sp1_ep7_pp0
	layer_1_combine_sp1_ep7_pp0 [label="Token Combine L1 SP1 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep7_pp0 -> layer_1_combine_sp1_ep7_pp0
	layer_1_dispatch_sp1_ep8_pp0 [label="Token Dispatch L1 SP1 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep8_pp0 [style=dashed]
	layer_1_expert_sp1_ep8_tp0_pp0 [label="Expert L1 SP1 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep8_pp0 -> layer_1_expert_sp1_ep8_tp0_pp0
	layer_1_expert_out_sp1_ep8_tp0_pp0 [label="Expert Out L1 SP1 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep8_tp0_pp0 -> layer_1_expert_out_sp1_ep8_tp0_pp0
	layer_1_expert_sp1_ep8_tp1_pp0 [label="Expert L1 SP1 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep8_pp0 -> layer_1_expert_sp1_ep8_tp1_pp0
	layer_1_expert_out_sp1_ep8_tp1_pp0 [label="Expert Out L1 SP1 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep8_tp1_pp0 -> layer_1_expert_out_sp1_ep8_tp1_pp0
	layer_1_expert_sp1_ep8_tp2_pp0 [label="Expert L1 SP1 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep8_pp0 -> layer_1_expert_sp1_ep8_tp2_pp0
	layer_1_expert_out_sp1_ep8_tp2_pp0 [label="Expert Out L1 SP1 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep8_tp2_pp0 -> layer_1_expert_out_sp1_ep8_tp2_pp0
	layer_1_expert_sp1_ep8_tp3_pp0 [label="Expert L1 SP1 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep8_pp0 -> layer_1_expert_sp1_ep8_tp3_pp0
	layer_1_expert_out_sp1_ep8_tp3_pp0 [label="Expert Out L1 SP1 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep8_tp3_pp0 -> layer_1_expert_out_sp1_ep8_tp3_pp0
	layer_1_expert_ar_sp1_ep8_pp0 [label="Expert All-Reduce L1 SP1 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep8_tp0_pp0 -> layer_1_expert_ar_sp1_ep8_pp0
	layer_1_expert_out_sp1_ep8_tp1_pp0 -> layer_1_expert_ar_sp1_ep8_pp0
	layer_1_expert_out_sp1_ep8_tp2_pp0 -> layer_1_expert_ar_sp1_ep8_pp0
	layer_1_expert_out_sp1_ep8_tp3_pp0 -> layer_1_expert_ar_sp1_ep8_pp0
	layer_1_combine_sp1_ep8_pp0 [label="Token Combine L1 SP1 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep8_pp0 -> layer_1_combine_sp1_ep8_pp0
	layer_1_dispatch_sp1_ep9_pp0 [label="Token Dispatch L1 SP1 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep9_pp0 [style=dashed]
	layer_1_expert_sp1_ep9_tp0_pp0 [label="Expert L1 SP1 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep9_pp0 -> layer_1_expert_sp1_ep9_tp0_pp0
	layer_1_expert_out_sp1_ep9_tp0_pp0 [label="Expert Out L1 SP1 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep9_tp0_pp0 -> layer_1_expert_out_sp1_ep9_tp0_pp0
	layer_1_expert_sp1_ep9_tp1_pp0 [label="Expert L1 SP1 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep9_pp0 -> layer_1_expert_sp1_ep9_tp1_pp0
	layer_1_expert_out_sp1_ep9_tp1_pp0 [label="Expert Out L1 SP1 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep9_tp1_pp0 -> layer_1_expert_out_sp1_ep9_tp1_pp0
	layer_1_expert_sp1_ep9_tp2_pp0 [label="Expert L1 SP1 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep9_pp0 -> layer_1_expert_sp1_ep9_tp2_pp0
	layer_1_expert_out_sp1_ep9_tp2_pp0 [label="Expert Out L1 SP1 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep9_tp2_pp0 -> layer_1_expert_out_sp1_ep9_tp2_pp0
	layer_1_expert_sp1_ep9_tp3_pp0 [label="Expert L1 SP1 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep9_pp0 -> layer_1_expert_sp1_ep9_tp3_pp0
	layer_1_expert_out_sp1_ep9_tp3_pp0 [label="Expert Out L1 SP1 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep9_tp3_pp0 -> layer_1_expert_out_sp1_ep9_tp3_pp0
	layer_1_expert_ar_sp1_ep9_pp0 [label="Expert All-Reduce L1 SP1 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep9_tp0_pp0 -> layer_1_expert_ar_sp1_ep9_pp0
	layer_1_expert_out_sp1_ep9_tp1_pp0 -> layer_1_expert_ar_sp1_ep9_pp0
	layer_1_expert_out_sp1_ep9_tp2_pp0 -> layer_1_expert_ar_sp1_ep9_pp0
	layer_1_expert_out_sp1_ep9_tp3_pp0 -> layer_1_expert_ar_sp1_ep9_pp0
	layer_1_combine_sp1_ep9_pp0 [label="Token Combine L1 SP1 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep9_pp0 -> layer_1_combine_sp1_ep9_pp0
	layer_1_dispatch_sp1_ep10_pp0 [label="Token Dispatch L1 SP1 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep10_pp0 [style=dashed]
	layer_1_expert_sp1_ep10_tp0_pp0 [label="Expert L1 SP1 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep10_pp0 -> layer_1_expert_sp1_ep10_tp0_pp0
	layer_1_expert_out_sp1_ep10_tp0_pp0 [label="Expert Out L1 SP1 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep10_tp0_pp0 -> layer_1_expert_out_sp1_ep10_tp0_pp0
	layer_1_expert_sp1_ep10_tp1_pp0 [label="Expert L1 SP1 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep10_pp0 -> layer_1_expert_sp1_ep10_tp1_pp0
	layer_1_expert_out_sp1_ep10_tp1_pp0 [label="Expert Out L1 SP1 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep10_tp1_pp0 -> layer_1_expert_out_sp1_ep10_tp1_pp0
	layer_1_expert_sp1_ep10_tp2_pp0 [label="Expert L1 SP1 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep10_pp0 -> layer_1_expert_sp1_ep10_tp2_pp0
	layer_1_expert_out_sp1_ep10_tp2_pp0 [label="Expert Out L1 SP1 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep10_tp2_pp0 -> layer_1_expert_out_sp1_ep10_tp2_pp0
	layer_1_expert_sp1_ep10_tp3_pp0 [label="Expert L1 SP1 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep10_pp0 -> layer_1_expert_sp1_ep10_tp3_pp0
	layer_1_expert_out_sp1_ep10_tp3_pp0 [label="Expert Out L1 SP1 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep10_tp3_pp0 -> layer_1_expert_out_sp1_ep10_tp3_pp0
	layer_1_expert_ar_sp1_ep10_pp0 [label="Expert All-Reduce L1 SP1 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep10_tp0_pp0 -> layer_1_expert_ar_sp1_ep10_pp0
	layer_1_expert_out_sp1_ep10_tp1_pp0 -> layer_1_expert_ar_sp1_ep10_pp0
	layer_1_expert_out_sp1_ep10_tp2_pp0 -> layer_1_expert_ar_sp1_ep10_pp0
	layer_1_expert_out_sp1_ep10_tp3_pp0 -> layer_1_expert_ar_sp1_ep10_pp0
	layer_1_combine_sp1_ep10_pp0 [label="Token Combine L1 SP1 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep10_pp0 -> layer_1_combine_sp1_ep10_pp0
	layer_1_dispatch_sp1_ep11_pp0 [label="Token Dispatch L1 SP1 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep11_pp0 [style=dashed]
	layer_1_expert_sp1_ep11_tp0_pp0 [label="Expert L1 SP1 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep11_pp0 -> layer_1_expert_sp1_ep11_tp0_pp0
	layer_1_expert_out_sp1_ep11_tp0_pp0 [label="Expert Out L1 SP1 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep11_tp0_pp0 -> layer_1_expert_out_sp1_ep11_tp0_pp0
	layer_1_expert_sp1_ep11_tp1_pp0 [label="Expert L1 SP1 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep11_pp0 -> layer_1_expert_sp1_ep11_tp1_pp0
	layer_1_expert_out_sp1_ep11_tp1_pp0 [label="Expert Out L1 SP1 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep11_tp1_pp0 -> layer_1_expert_out_sp1_ep11_tp1_pp0
	layer_1_expert_sp1_ep11_tp2_pp0 [label="Expert L1 SP1 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep11_pp0 -> layer_1_expert_sp1_ep11_tp2_pp0
	layer_1_expert_out_sp1_ep11_tp2_pp0 [label="Expert Out L1 SP1 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep11_tp2_pp0 -> layer_1_expert_out_sp1_ep11_tp2_pp0
	layer_1_expert_sp1_ep11_tp3_pp0 [label="Expert L1 SP1 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep11_pp0 -> layer_1_expert_sp1_ep11_tp3_pp0
	layer_1_expert_out_sp1_ep11_tp3_pp0 [label="Expert Out L1 SP1 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep11_tp3_pp0 -> layer_1_expert_out_sp1_ep11_tp3_pp0
	layer_1_expert_ar_sp1_ep11_pp0 [label="Expert All-Reduce L1 SP1 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep11_tp0_pp0 -> layer_1_expert_ar_sp1_ep11_pp0
	layer_1_expert_out_sp1_ep11_tp1_pp0 -> layer_1_expert_ar_sp1_ep11_pp0
	layer_1_expert_out_sp1_ep11_tp2_pp0 -> layer_1_expert_ar_sp1_ep11_pp0
	layer_1_expert_out_sp1_ep11_tp3_pp0 -> layer_1_expert_ar_sp1_ep11_pp0
	layer_1_combine_sp1_ep11_pp0 [label="Token Combine L1 SP1 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep11_pp0 -> layer_1_combine_sp1_ep11_pp0
	layer_1_dispatch_sp1_ep12_pp0 [label="Token Dispatch L1 SP1 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep12_pp0 [style=dashed]
	layer_1_expert_sp1_ep12_tp0_pp0 [label="Expert L1 SP1 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep12_pp0 -> layer_1_expert_sp1_ep12_tp0_pp0
	layer_1_expert_out_sp1_ep12_tp0_pp0 [label="Expert Out L1 SP1 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep12_tp0_pp0 -> layer_1_expert_out_sp1_ep12_tp0_pp0
	layer_1_expert_sp1_ep12_tp1_pp0 [label="Expert L1 SP1 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep12_pp0 -> layer_1_expert_sp1_ep12_tp1_pp0
	layer_1_expert_out_sp1_ep12_tp1_pp0 [label="Expert Out L1 SP1 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep12_tp1_pp0 -> layer_1_expert_out_sp1_ep12_tp1_pp0
	layer_1_expert_sp1_ep12_tp2_pp0 [label="Expert L1 SP1 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep12_pp0 -> layer_1_expert_sp1_ep12_tp2_pp0
	layer_1_expert_out_sp1_ep12_tp2_pp0 [label="Expert Out L1 SP1 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep12_tp2_pp0 -> layer_1_expert_out_sp1_ep12_tp2_pp0
	layer_1_expert_sp1_ep12_tp3_pp0 [label="Expert L1 SP1 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep12_pp0 -> layer_1_expert_sp1_ep12_tp3_pp0
	layer_1_expert_out_sp1_ep12_tp3_pp0 [label="Expert Out L1 SP1 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep12_tp3_pp0 -> layer_1_expert_out_sp1_ep12_tp3_pp0
	layer_1_expert_ar_sp1_ep12_pp0 [label="Expert All-Reduce L1 SP1 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep12_tp0_pp0 -> layer_1_expert_ar_sp1_ep12_pp0
	layer_1_expert_out_sp1_ep12_tp1_pp0 -> layer_1_expert_ar_sp1_ep12_pp0
	layer_1_expert_out_sp1_ep12_tp2_pp0 -> layer_1_expert_ar_sp1_ep12_pp0
	layer_1_expert_out_sp1_ep12_tp3_pp0 -> layer_1_expert_ar_sp1_ep12_pp0
	layer_1_combine_sp1_ep12_pp0 [label="Token Combine L1 SP1 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep12_pp0 -> layer_1_combine_sp1_ep12_pp0
	layer_1_dispatch_sp1_ep13_pp0 [label="Token Dispatch L1 SP1 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep13_pp0 [style=dashed]
	layer_1_expert_sp1_ep13_tp0_pp0 [label="Expert L1 SP1 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep13_pp0 -> layer_1_expert_sp1_ep13_tp0_pp0
	layer_1_expert_out_sp1_ep13_tp0_pp0 [label="Expert Out L1 SP1 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep13_tp0_pp0 -> layer_1_expert_out_sp1_ep13_tp0_pp0
	layer_1_expert_sp1_ep13_tp1_pp0 [label="Expert L1 SP1 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep13_pp0 -> layer_1_expert_sp1_ep13_tp1_pp0
	layer_1_expert_out_sp1_ep13_tp1_pp0 [label="Expert Out L1 SP1 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep13_tp1_pp0 -> layer_1_expert_out_sp1_ep13_tp1_pp0
	layer_1_expert_sp1_ep13_tp2_pp0 [label="Expert L1 SP1 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep13_pp0 -> layer_1_expert_sp1_ep13_tp2_pp0
	layer_1_expert_out_sp1_ep13_tp2_pp0 [label="Expert Out L1 SP1 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep13_tp2_pp0 -> layer_1_expert_out_sp1_ep13_tp2_pp0
	layer_1_expert_sp1_ep13_tp3_pp0 [label="Expert L1 SP1 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep13_pp0 -> layer_1_expert_sp1_ep13_tp3_pp0
	layer_1_expert_out_sp1_ep13_tp3_pp0 [label="Expert Out L1 SP1 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep13_tp3_pp0 -> layer_1_expert_out_sp1_ep13_tp3_pp0
	layer_1_expert_ar_sp1_ep13_pp0 [label="Expert All-Reduce L1 SP1 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep13_tp0_pp0 -> layer_1_expert_ar_sp1_ep13_pp0
	layer_1_expert_out_sp1_ep13_tp1_pp0 -> layer_1_expert_ar_sp1_ep13_pp0
	layer_1_expert_out_sp1_ep13_tp2_pp0 -> layer_1_expert_ar_sp1_ep13_pp0
	layer_1_expert_out_sp1_ep13_tp3_pp0 -> layer_1_expert_ar_sp1_ep13_pp0
	layer_1_combine_sp1_ep13_pp0 [label="Token Combine L1 SP1 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep13_pp0 -> layer_1_combine_sp1_ep13_pp0
	layer_1_dispatch_sp1_ep14_pp0 [label="Token Dispatch L1 SP1 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep14_pp0 [style=dashed]
	layer_1_expert_sp1_ep14_tp0_pp0 [label="Expert L1 SP1 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep14_pp0 -> layer_1_expert_sp1_ep14_tp0_pp0
	layer_1_expert_out_sp1_ep14_tp0_pp0 [label="Expert Out L1 SP1 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep14_tp0_pp0 -> layer_1_expert_out_sp1_ep14_tp0_pp0
	layer_1_expert_sp1_ep14_tp1_pp0 [label="Expert L1 SP1 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep14_pp0 -> layer_1_expert_sp1_ep14_tp1_pp0
	layer_1_expert_out_sp1_ep14_tp1_pp0 [label="Expert Out L1 SP1 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep14_tp1_pp0 -> layer_1_expert_out_sp1_ep14_tp1_pp0
	layer_1_expert_sp1_ep14_tp2_pp0 [label="Expert L1 SP1 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep14_pp0 -> layer_1_expert_sp1_ep14_tp2_pp0
	layer_1_expert_out_sp1_ep14_tp2_pp0 [label="Expert Out L1 SP1 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep14_tp2_pp0 -> layer_1_expert_out_sp1_ep14_tp2_pp0
	layer_1_expert_sp1_ep14_tp3_pp0 [label="Expert L1 SP1 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep14_pp0 -> layer_1_expert_sp1_ep14_tp3_pp0
	layer_1_expert_out_sp1_ep14_tp3_pp0 [label="Expert Out L1 SP1 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep14_tp3_pp0 -> layer_1_expert_out_sp1_ep14_tp3_pp0
	layer_1_expert_ar_sp1_ep14_pp0 [label="Expert All-Reduce L1 SP1 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep14_tp0_pp0 -> layer_1_expert_ar_sp1_ep14_pp0
	layer_1_expert_out_sp1_ep14_tp1_pp0 -> layer_1_expert_ar_sp1_ep14_pp0
	layer_1_expert_out_sp1_ep14_tp2_pp0 -> layer_1_expert_ar_sp1_ep14_pp0
	layer_1_expert_out_sp1_ep14_tp3_pp0 -> layer_1_expert_ar_sp1_ep14_pp0
	layer_1_combine_sp1_ep14_pp0 [label="Token Combine L1 SP1 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep14_pp0 -> layer_1_combine_sp1_ep14_pp0
	layer_1_dispatch_sp1_ep15_pp0 [label="Token Dispatch L1 SP1 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp1_pp0 -> layer_1_dispatch_sp1_ep15_pp0 [style=dashed]
	layer_1_expert_sp1_ep15_tp0_pp0 [label="Expert L1 SP1 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep15_pp0 -> layer_1_expert_sp1_ep15_tp0_pp0
	layer_1_expert_out_sp1_ep15_tp0_pp0 [label="Expert Out L1 SP1 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep15_tp0_pp0 -> layer_1_expert_out_sp1_ep15_tp0_pp0
	layer_1_expert_sp1_ep15_tp1_pp0 [label="Expert L1 SP1 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep15_pp0 -> layer_1_expert_sp1_ep15_tp1_pp0
	layer_1_expert_out_sp1_ep15_tp1_pp0 [label="Expert Out L1 SP1 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep15_tp1_pp0 -> layer_1_expert_out_sp1_ep15_tp1_pp0
	layer_1_expert_sp1_ep15_tp2_pp0 [label="Expert L1 SP1 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep15_pp0 -> layer_1_expert_sp1_ep15_tp2_pp0
	layer_1_expert_out_sp1_ep15_tp2_pp0 [label="Expert Out L1 SP1 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep15_tp2_pp0 -> layer_1_expert_out_sp1_ep15_tp2_pp0
	layer_1_expert_sp1_ep15_tp3_pp0 [label="Expert L1 SP1 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp1_ep15_pp0 -> layer_1_expert_sp1_ep15_tp3_pp0
	layer_1_expert_out_sp1_ep15_tp3_pp0 [label="Expert Out L1 SP1 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp1_ep15_tp3_pp0 -> layer_1_expert_out_sp1_ep15_tp3_pp0
	layer_1_expert_ar_sp1_ep15_pp0 [label="Expert All-Reduce L1 SP1 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp1_ep15_tp0_pp0 -> layer_1_expert_ar_sp1_ep15_pp0
	layer_1_expert_out_sp1_ep15_tp1_pp0 -> layer_1_expert_ar_sp1_ep15_pp0
	layer_1_expert_out_sp1_ep15_tp2_pp0 -> layer_1_expert_ar_sp1_ep15_pp0
	layer_1_expert_out_sp1_ep15_tp3_pp0 -> layer_1_expert_ar_sp1_ep15_pp0
	layer_1_combine_sp1_ep15_pp0 [label="Token Combine L1 SP1 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp1_ep15_pp0 -> layer_1_combine_sp1_ep15_pp0
	layer_1_moe_all2all_sp1_pp0 [label="MoE All-to-All L1 SP1\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_1_combine_sp1_ep0_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep1_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep2_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep3_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep4_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep5_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep6_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep7_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep8_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep9_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep10_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep11_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep12_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep13_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep14_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_combine_sp1_ep15_pp0 -> layer_1_moe_all2all_sp1_pp0
	layer_1_mlp_out_sp1_pp0 [label="MoE Output L1 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_moe_all2all_sp1_pp0 -> layer_1_mlp_out_sp1_pp0
	layer_1_mlp_res_sp1_pp0 [label="MLP Residual L1 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_mlp_out_sp1_pp0 -> layer_1_mlp_res_sp1_pp0
	layer_1_attn_res_sp1_pp0 -> layer_1_mlp_res_sp1_pp0 [style=dashed]
	layer_1_norm_sp2_pp0 [label="LayerNorm L1 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_mlp_out_sp2_pp0 -> layer_1_norm_sp2_pp0
	layer_1_qkv_sp2_tp0_pp0 [label="QKV Proj L1 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp2_pp0 -> layer_1_qkv_sp2_tp0_pp0
	layer_1_attn_sp2_tp0_pp0 [label="Attention L1 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp2_tp0_pp0 -> layer_1_attn_sp2_tp0_pp0
	layer_1_attn_out_sp2_tp0_pp0 [label="Attn Out Proj L1 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp2_tp0_pp0 -> layer_1_attn_out_sp2_tp0_pp0
	layer_1_qkv_sp2_tp1_pp0 [label="QKV Proj L1 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp2_pp0 -> layer_1_qkv_sp2_tp1_pp0
	layer_1_attn_sp2_tp1_pp0 [label="Attention L1 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp2_tp1_pp0 -> layer_1_attn_sp2_tp1_pp0
	layer_1_attn_out_sp2_tp1_pp0 [label="Attn Out Proj L1 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp2_tp1_pp0 -> layer_1_attn_out_sp2_tp1_pp0
	layer_1_qkv_sp2_tp2_pp0 [label="QKV Proj L1 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp2_pp0 -> layer_1_qkv_sp2_tp2_pp0
	layer_1_attn_sp2_tp2_pp0 [label="Attention L1 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp2_tp2_pp0 -> layer_1_attn_sp2_tp2_pp0
	layer_1_attn_out_sp2_tp2_pp0 [label="Attn Out Proj L1 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp2_tp2_pp0 -> layer_1_attn_out_sp2_tp2_pp0
	layer_1_qkv_sp2_tp3_pp0 [label="QKV Proj L1 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp2_pp0 -> layer_1_qkv_sp2_tp3_pp0
	layer_1_attn_sp2_tp3_pp0 [label="Attention L1 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp2_tp3_pp0 -> layer_1_attn_sp2_tp3_pp0
	layer_1_attn_out_sp2_tp3_pp0 [label="Attn Out Proj L1 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp2_tp3_pp0 -> layer_1_attn_out_sp2_tp3_pp0
	layer_1_attn_ar_sp2_pp0 [label="Attention All-Reduce L1 SP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_attn_out_sp2_tp0_pp0 -> layer_1_attn_ar_sp2_pp0
	layer_1_attn_out_sp2_tp1_pp0 -> layer_1_attn_ar_sp2_pp0
	layer_1_attn_out_sp2_tp2_pp0 -> layer_1_attn_ar_sp2_pp0
	layer_1_attn_out_sp2_tp3_pp0 -> layer_1_attn_ar_sp2_pp0
	layer_1_attn_res_sp2_pp0 [label="Attention Residual L1 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_attn_ar_sp2_pp0 -> layer_1_attn_res_sp2_pp0
	layer_1_norm_sp2_pp0 -> layer_1_attn_res_sp2_pp0 [style=dashed]
	layer_1_post_norm_sp2_pp0 [label="Post-Attn Norm L1 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_attn_res_sp2_pp0 -> layer_1_post_norm_sp2_pp0
	layer_1_router_sp2_pp0 [label="MoE Router L1 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_1_post_norm_sp2_pp0 -> layer_1_router_sp2_pp0
	layer_1_dispatch_sp2_ep0_pp0 [label="Token Dispatch L1 SP2 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep0_pp0 [style=dashed]
	layer_1_expert_sp2_ep0_tp0_pp0 [label="Expert L1 SP2 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep0_pp0 -> layer_1_expert_sp2_ep0_tp0_pp0
	layer_1_expert_out_sp2_ep0_tp0_pp0 [label="Expert Out L1 SP2 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep0_tp0_pp0 -> layer_1_expert_out_sp2_ep0_tp0_pp0
	layer_1_expert_sp2_ep0_tp1_pp0 [label="Expert L1 SP2 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep0_pp0 -> layer_1_expert_sp2_ep0_tp1_pp0
	layer_1_expert_out_sp2_ep0_tp1_pp0 [label="Expert Out L1 SP2 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep0_tp1_pp0 -> layer_1_expert_out_sp2_ep0_tp1_pp0
	layer_1_expert_sp2_ep0_tp2_pp0 [label="Expert L1 SP2 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep0_pp0 -> layer_1_expert_sp2_ep0_tp2_pp0
	layer_1_expert_out_sp2_ep0_tp2_pp0 [label="Expert Out L1 SP2 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep0_tp2_pp0 -> layer_1_expert_out_sp2_ep0_tp2_pp0
	layer_1_expert_sp2_ep0_tp3_pp0 [label="Expert L1 SP2 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep0_pp0 -> layer_1_expert_sp2_ep0_tp3_pp0
	layer_1_expert_out_sp2_ep0_tp3_pp0 [label="Expert Out L1 SP2 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep0_tp3_pp0 -> layer_1_expert_out_sp2_ep0_tp3_pp0
	layer_1_expert_ar_sp2_ep0_pp0 [label="Expert All-Reduce L1 SP2 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep0_tp0_pp0 -> layer_1_expert_ar_sp2_ep0_pp0
	layer_1_expert_out_sp2_ep0_tp1_pp0 -> layer_1_expert_ar_sp2_ep0_pp0
	layer_1_expert_out_sp2_ep0_tp2_pp0 -> layer_1_expert_ar_sp2_ep0_pp0
	layer_1_expert_out_sp2_ep0_tp3_pp0 -> layer_1_expert_ar_sp2_ep0_pp0
	layer_1_combine_sp2_ep0_pp0 [label="Token Combine L1 SP2 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep0_pp0 -> layer_1_combine_sp2_ep0_pp0
	layer_1_dispatch_sp2_ep1_pp0 [label="Token Dispatch L1 SP2 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep1_pp0 [style=dashed]
	layer_1_expert_sp2_ep1_tp0_pp0 [label="Expert L1 SP2 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep1_pp0 -> layer_1_expert_sp2_ep1_tp0_pp0
	layer_1_expert_out_sp2_ep1_tp0_pp0 [label="Expert Out L1 SP2 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep1_tp0_pp0 -> layer_1_expert_out_sp2_ep1_tp0_pp0
	layer_1_expert_sp2_ep1_tp1_pp0 [label="Expert L1 SP2 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep1_pp0 -> layer_1_expert_sp2_ep1_tp1_pp0
	layer_1_expert_out_sp2_ep1_tp1_pp0 [label="Expert Out L1 SP2 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep1_tp1_pp0 -> layer_1_expert_out_sp2_ep1_tp1_pp0
	layer_1_expert_sp2_ep1_tp2_pp0 [label="Expert L1 SP2 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep1_pp0 -> layer_1_expert_sp2_ep1_tp2_pp0
	layer_1_expert_out_sp2_ep1_tp2_pp0 [label="Expert Out L1 SP2 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep1_tp2_pp0 -> layer_1_expert_out_sp2_ep1_tp2_pp0
	layer_1_expert_sp2_ep1_tp3_pp0 [label="Expert L1 SP2 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep1_pp0 -> layer_1_expert_sp2_ep1_tp3_pp0
	layer_1_expert_out_sp2_ep1_tp3_pp0 [label="Expert Out L1 SP2 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep1_tp3_pp0 -> layer_1_expert_out_sp2_ep1_tp3_pp0
	layer_1_expert_ar_sp2_ep1_pp0 [label="Expert All-Reduce L1 SP2 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep1_tp0_pp0 -> layer_1_expert_ar_sp2_ep1_pp0
	layer_1_expert_out_sp2_ep1_tp1_pp0 -> layer_1_expert_ar_sp2_ep1_pp0
	layer_1_expert_out_sp2_ep1_tp2_pp0 -> layer_1_expert_ar_sp2_ep1_pp0
	layer_1_expert_out_sp2_ep1_tp3_pp0 -> layer_1_expert_ar_sp2_ep1_pp0
	layer_1_combine_sp2_ep1_pp0 [label="Token Combine L1 SP2 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep1_pp0 -> layer_1_combine_sp2_ep1_pp0
	layer_1_dispatch_sp2_ep2_pp0 [label="Token Dispatch L1 SP2 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep2_pp0 [style=dashed]
	layer_1_expert_sp2_ep2_tp0_pp0 [label="Expert L1 SP2 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep2_pp0 -> layer_1_expert_sp2_ep2_tp0_pp0
	layer_1_expert_out_sp2_ep2_tp0_pp0 [label="Expert Out L1 SP2 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep2_tp0_pp0 -> layer_1_expert_out_sp2_ep2_tp0_pp0
	layer_1_expert_sp2_ep2_tp1_pp0 [label="Expert L1 SP2 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep2_pp0 -> layer_1_expert_sp2_ep2_tp1_pp0
	layer_1_expert_out_sp2_ep2_tp1_pp0 [label="Expert Out L1 SP2 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep2_tp1_pp0 -> layer_1_expert_out_sp2_ep2_tp1_pp0
	layer_1_expert_sp2_ep2_tp2_pp0 [label="Expert L1 SP2 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep2_pp0 -> layer_1_expert_sp2_ep2_tp2_pp0
	layer_1_expert_out_sp2_ep2_tp2_pp0 [label="Expert Out L1 SP2 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep2_tp2_pp0 -> layer_1_expert_out_sp2_ep2_tp2_pp0
	layer_1_expert_sp2_ep2_tp3_pp0 [label="Expert L1 SP2 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep2_pp0 -> layer_1_expert_sp2_ep2_tp3_pp0
	layer_1_expert_out_sp2_ep2_tp3_pp0 [label="Expert Out L1 SP2 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep2_tp3_pp0 -> layer_1_expert_out_sp2_ep2_tp3_pp0
	layer_1_expert_ar_sp2_ep2_pp0 [label="Expert All-Reduce L1 SP2 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep2_tp0_pp0 -> layer_1_expert_ar_sp2_ep2_pp0
	layer_1_expert_out_sp2_ep2_tp1_pp0 -> layer_1_expert_ar_sp2_ep2_pp0
	layer_1_expert_out_sp2_ep2_tp2_pp0 -> layer_1_expert_ar_sp2_ep2_pp0
	layer_1_expert_out_sp2_ep2_tp3_pp0 -> layer_1_expert_ar_sp2_ep2_pp0
	layer_1_combine_sp2_ep2_pp0 [label="Token Combine L1 SP2 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep2_pp0 -> layer_1_combine_sp2_ep2_pp0
	layer_1_dispatch_sp2_ep3_pp0 [label="Token Dispatch L1 SP2 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep3_pp0 [style=dashed]
	layer_1_expert_sp2_ep3_tp0_pp0 [label="Expert L1 SP2 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep3_pp0 -> layer_1_expert_sp2_ep3_tp0_pp0
	layer_1_expert_out_sp2_ep3_tp0_pp0 [label="Expert Out L1 SP2 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep3_tp0_pp0 -> layer_1_expert_out_sp2_ep3_tp0_pp0
	layer_1_expert_sp2_ep3_tp1_pp0 [label="Expert L1 SP2 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep3_pp0 -> layer_1_expert_sp2_ep3_tp1_pp0
	layer_1_expert_out_sp2_ep3_tp1_pp0 [label="Expert Out L1 SP2 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep3_tp1_pp0 -> layer_1_expert_out_sp2_ep3_tp1_pp0
	layer_1_expert_sp2_ep3_tp2_pp0 [label="Expert L1 SP2 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep3_pp0 -> layer_1_expert_sp2_ep3_tp2_pp0
	layer_1_expert_out_sp2_ep3_tp2_pp0 [label="Expert Out L1 SP2 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep3_tp2_pp0 -> layer_1_expert_out_sp2_ep3_tp2_pp0
	layer_1_expert_sp2_ep3_tp3_pp0 [label="Expert L1 SP2 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep3_pp0 -> layer_1_expert_sp2_ep3_tp3_pp0
	layer_1_expert_out_sp2_ep3_tp3_pp0 [label="Expert Out L1 SP2 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep3_tp3_pp0 -> layer_1_expert_out_sp2_ep3_tp3_pp0
	layer_1_expert_ar_sp2_ep3_pp0 [label="Expert All-Reduce L1 SP2 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep3_tp0_pp0 -> layer_1_expert_ar_sp2_ep3_pp0
	layer_1_expert_out_sp2_ep3_tp1_pp0 -> layer_1_expert_ar_sp2_ep3_pp0
	layer_1_expert_out_sp2_ep3_tp2_pp0 -> layer_1_expert_ar_sp2_ep3_pp0
	layer_1_expert_out_sp2_ep3_tp3_pp0 -> layer_1_expert_ar_sp2_ep3_pp0
	layer_1_combine_sp2_ep3_pp0 [label="Token Combine L1 SP2 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep3_pp0 -> layer_1_combine_sp2_ep3_pp0
	layer_1_dispatch_sp2_ep4_pp0 [label="Token Dispatch L1 SP2 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep4_pp0 [style=dashed]
	layer_1_expert_sp2_ep4_tp0_pp0 [label="Expert L1 SP2 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep4_pp0 -> layer_1_expert_sp2_ep4_tp0_pp0
	layer_1_expert_out_sp2_ep4_tp0_pp0 [label="Expert Out L1 SP2 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep4_tp0_pp0 -> layer_1_expert_out_sp2_ep4_tp0_pp0
	layer_1_expert_sp2_ep4_tp1_pp0 [label="Expert L1 SP2 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep4_pp0 -> layer_1_expert_sp2_ep4_tp1_pp0
	layer_1_expert_out_sp2_ep4_tp1_pp0 [label="Expert Out L1 SP2 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep4_tp1_pp0 -> layer_1_expert_out_sp2_ep4_tp1_pp0
	layer_1_expert_sp2_ep4_tp2_pp0 [label="Expert L1 SP2 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep4_pp0 -> layer_1_expert_sp2_ep4_tp2_pp0
	layer_1_expert_out_sp2_ep4_tp2_pp0 [label="Expert Out L1 SP2 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep4_tp2_pp0 -> layer_1_expert_out_sp2_ep4_tp2_pp0
	layer_1_expert_sp2_ep4_tp3_pp0 [label="Expert L1 SP2 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep4_pp0 -> layer_1_expert_sp2_ep4_tp3_pp0
	layer_1_expert_out_sp2_ep4_tp3_pp0 [label="Expert Out L1 SP2 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep4_tp3_pp0 -> layer_1_expert_out_sp2_ep4_tp3_pp0
	layer_1_expert_ar_sp2_ep4_pp0 [label="Expert All-Reduce L1 SP2 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep4_tp0_pp0 -> layer_1_expert_ar_sp2_ep4_pp0
	layer_1_expert_out_sp2_ep4_tp1_pp0 -> layer_1_expert_ar_sp2_ep4_pp0
	layer_1_expert_out_sp2_ep4_tp2_pp0 -> layer_1_expert_ar_sp2_ep4_pp0
	layer_1_expert_out_sp2_ep4_tp3_pp0 -> layer_1_expert_ar_sp2_ep4_pp0
	layer_1_combine_sp2_ep4_pp0 [label="Token Combine L1 SP2 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep4_pp0 -> layer_1_combine_sp2_ep4_pp0
	layer_1_dispatch_sp2_ep5_pp0 [label="Token Dispatch L1 SP2 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep5_pp0 [style=dashed]
	layer_1_expert_sp2_ep5_tp0_pp0 [label="Expert L1 SP2 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep5_pp0 -> layer_1_expert_sp2_ep5_tp0_pp0
	layer_1_expert_out_sp2_ep5_tp0_pp0 [label="Expert Out L1 SP2 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep5_tp0_pp0 -> layer_1_expert_out_sp2_ep5_tp0_pp0
	layer_1_expert_sp2_ep5_tp1_pp0 [label="Expert L1 SP2 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep5_pp0 -> layer_1_expert_sp2_ep5_tp1_pp0
	layer_1_expert_out_sp2_ep5_tp1_pp0 [label="Expert Out L1 SP2 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep5_tp1_pp0 -> layer_1_expert_out_sp2_ep5_tp1_pp0
	layer_1_expert_sp2_ep5_tp2_pp0 [label="Expert L1 SP2 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep5_pp0 -> layer_1_expert_sp2_ep5_tp2_pp0
	layer_1_expert_out_sp2_ep5_tp2_pp0 [label="Expert Out L1 SP2 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep5_tp2_pp0 -> layer_1_expert_out_sp2_ep5_tp2_pp0
	layer_1_expert_sp2_ep5_tp3_pp0 [label="Expert L1 SP2 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep5_pp0 -> layer_1_expert_sp2_ep5_tp3_pp0
	layer_1_expert_out_sp2_ep5_tp3_pp0 [label="Expert Out L1 SP2 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep5_tp3_pp0 -> layer_1_expert_out_sp2_ep5_tp3_pp0
	layer_1_expert_ar_sp2_ep5_pp0 [label="Expert All-Reduce L1 SP2 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep5_tp0_pp0 -> layer_1_expert_ar_sp2_ep5_pp0
	layer_1_expert_out_sp2_ep5_tp1_pp0 -> layer_1_expert_ar_sp2_ep5_pp0
	layer_1_expert_out_sp2_ep5_tp2_pp0 -> layer_1_expert_ar_sp2_ep5_pp0
	layer_1_expert_out_sp2_ep5_tp3_pp0 -> layer_1_expert_ar_sp2_ep5_pp0
	layer_1_combine_sp2_ep5_pp0 [label="Token Combine L1 SP2 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep5_pp0 -> layer_1_combine_sp2_ep5_pp0
	layer_1_dispatch_sp2_ep6_pp0 [label="Token Dispatch L1 SP2 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep6_pp0 [style=dashed]
	layer_1_expert_sp2_ep6_tp0_pp0 [label="Expert L1 SP2 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep6_pp0 -> layer_1_expert_sp2_ep6_tp0_pp0
	layer_1_expert_out_sp2_ep6_tp0_pp0 [label="Expert Out L1 SP2 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep6_tp0_pp0 -> layer_1_expert_out_sp2_ep6_tp0_pp0
	layer_1_expert_sp2_ep6_tp1_pp0 [label="Expert L1 SP2 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep6_pp0 -> layer_1_expert_sp2_ep6_tp1_pp0
	layer_1_expert_out_sp2_ep6_tp1_pp0 [label="Expert Out L1 SP2 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep6_tp1_pp0 -> layer_1_expert_out_sp2_ep6_tp1_pp0
	layer_1_expert_sp2_ep6_tp2_pp0 [label="Expert L1 SP2 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep6_pp0 -> layer_1_expert_sp2_ep6_tp2_pp0
	layer_1_expert_out_sp2_ep6_tp2_pp0 [label="Expert Out L1 SP2 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep6_tp2_pp0 -> layer_1_expert_out_sp2_ep6_tp2_pp0
	layer_1_expert_sp2_ep6_tp3_pp0 [label="Expert L1 SP2 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep6_pp0 -> layer_1_expert_sp2_ep6_tp3_pp0
	layer_1_expert_out_sp2_ep6_tp3_pp0 [label="Expert Out L1 SP2 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep6_tp3_pp0 -> layer_1_expert_out_sp2_ep6_tp3_pp0
	layer_1_expert_ar_sp2_ep6_pp0 [label="Expert All-Reduce L1 SP2 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep6_tp0_pp0 -> layer_1_expert_ar_sp2_ep6_pp0
	layer_1_expert_out_sp2_ep6_tp1_pp0 -> layer_1_expert_ar_sp2_ep6_pp0
	layer_1_expert_out_sp2_ep6_tp2_pp0 -> layer_1_expert_ar_sp2_ep6_pp0
	layer_1_expert_out_sp2_ep6_tp3_pp0 -> layer_1_expert_ar_sp2_ep6_pp0
	layer_1_combine_sp2_ep6_pp0 [label="Token Combine L1 SP2 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep6_pp0 -> layer_1_combine_sp2_ep6_pp0
	layer_1_dispatch_sp2_ep7_pp0 [label="Token Dispatch L1 SP2 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep7_pp0 [style=dashed]
	layer_1_expert_sp2_ep7_tp0_pp0 [label="Expert L1 SP2 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep7_pp0 -> layer_1_expert_sp2_ep7_tp0_pp0
	layer_1_expert_out_sp2_ep7_tp0_pp0 [label="Expert Out L1 SP2 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep7_tp0_pp0 -> layer_1_expert_out_sp2_ep7_tp0_pp0
	layer_1_expert_sp2_ep7_tp1_pp0 [label="Expert L1 SP2 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep7_pp0 -> layer_1_expert_sp2_ep7_tp1_pp0
	layer_1_expert_out_sp2_ep7_tp1_pp0 [label="Expert Out L1 SP2 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep7_tp1_pp0 -> layer_1_expert_out_sp2_ep7_tp1_pp0
	layer_1_expert_sp2_ep7_tp2_pp0 [label="Expert L1 SP2 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep7_pp0 -> layer_1_expert_sp2_ep7_tp2_pp0
	layer_1_expert_out_sp2_ep7_tp2_pp0 [label="Expert Out L1 SP2 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep7_tp2_pp0 -> layer_1_expert_out_sp2_ep7_tp2_pp0
	layer_1_expert_sp2_ep7_tp3_pp0 [label="Expert L1 SP2 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep7_pp0 -> layer_1_expert_sp2_ep7_tp3_pp0
	layer_1_expert_out_sp2_ep7_tp3_pp0 [label="Expert Out L1 SP2 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep7_tp3_pp0 -> layer_1_expert_out_sp2_ep7_tp3_pp0
	layer_1_expert_ar_sp2_ep7_pp0 [label="Expert All-Reduce L1 SP2 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep7_tp0_pp0 -> layer_1_expert_ar_sp2_ep7_pp0
	layer_1_expert_out_sp2_ep7_tp1_pp0 -> layer_1_expert_ar_sp2_ep7_pp0
	layer_1_expert_out_sp2_ep7_tp2_pp0 -> layer_1_expert_ar_sp2_ep7_pp0
	layer_1_expert_out_sp2_ep7_tp3_pp0 -> layer_1_expert_ar_sp2_ep7_pp0
	layer_1_combine_sp2_ep7_pp0 [label="Token Combine L1 SP2 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep7_pp0 -> layer_1_combine_sp2_ep7_pp0
	layer_1_dispatch_sp2_ep8_pp0 [label="Token Dispatch L1 SP2 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep8_pp0 [style=dashed]
	layer_1_expert_sp2_ep8_tp0_pp0 [label="Expert L1 SP2 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep8_pp0 -> layer_1_expert_sp2_ep8_tp0_pp0
	layer_1_expert_out_sp2_ep8_tp0_pp0 [label="Expert Out L1 SP2 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep8_tp0_pp0 -> layer_1_expert_out_sp2_ep8_tp0_pp0
	layer_1_expert_sp2_ep8_tp1_pp0 [label="Expert L1 SP2 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep8_pp0 -> layer_1_expert_sp2_ep8_tp1_pp0
	layer_1_expert_out_sp2_ep8_tp1_pp0 [label="Expert Out L1 SP2 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep8_tp1_pp0 -> layer_1_expert_out_sp2_ep8_tp1_pp0
	layer_1_expert_sp2_ep8_tp2_pp0 [label="Expert L1 SP2 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep8_pp0 -> layer_1_expert_sp2_ep8_tp2_pp0
	layer_1_expert_out_sp2_ep8_tp2_pp0 [label="Expert Out L1 SP2 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep8_tp2_pp0 -> layer_1_expert_out_sp2_ep8_tp2_pp0
	layer_1_expert_sp2_ep8_tp3_pp0 [label="Expert L1 SP2 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep8_pp0 -> layer_1_expert_sp2_ep8_tp3_pp0
	layer_1_expert_out_sp2_ep8_tp3_pp0 [label="Expert Out L1 SP2 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep8_tp3_pp0 -> layer_1_expert_out_sp2_ep8_tp3_pp0
	layer_1_expert_ar_sp2_ep8_pp0 [label="Expert All-Reduce L1 SP2 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep8_tp0_pp0 -> layer_1_expert_ar_sp2_ep8_pp0
	layer_1_expert_out_sp2_ep8_tp1_pp0 -> layer_1_expert_ar_sp2_ep8_pp0
	layer_1_expert_out_sp2_ep8_tp2_pp0 -> layer_1_expert_ar_sp2_ep8_pp0
	layer_1_expert_out_sp2_ep8_tp3_pp0 -> layer_1_expert_ar_sp2_ep8_pp0
	layer_1_combine_sp2_ep8_pp0 [label="Token Combine L1 SP2 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep8_pp0 -> layer_1_combine_sp2_ep8_pp0
	layer_1_dispatch_sp2_ep9_pp0 [label="Token Dispatch L1 SP2 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep9_pp0 [style=dashed]
	layer_1_expert_sp2_ep9_tp0_pp0 [label="Expert L1 SP2 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep9_pp0 -> layer_1_expert_sp2_ep9_tp0_pp0
	layer_1_expert_out_sp2_ep9_tp0_pp0 [label="Expert Out L1 SP2 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep9_tp0_pp0 -> layer_1_expert_out_sp2_ep9_tp0_pp0
	layer_1_expert_sp2_ep9_tp1_pp0 [label="Expert L1 SP2 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep9_pp0 -> layer_1_expert_sp2_ep9_tp1_pp0
	layer_1_expert_out_sp2_ep9_tp1_pp0 [label="Expert Out L1 SP2 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep9_tp1_pp0 -> layer_1_expert_out_sp2_ep9_tp1_pp0
	layer_1_expert_sp2_ep9_tp2_pp0 [label="Expert L1 SP2 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep9_pp0 -> layer_1_expert_sp2_ep9_tp2_pp0
	layer_1_expert_out_sp2_ep9_tp2_pp0 [label="Expert Out L1 SP2 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep9_tp2_pp0 -> layer_1_expert_out_sp2_ep9_tp2_pp0
	layer_1_expert_sp2_ep9_tp3_pp0 [label="Expert L1 SP2 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep9_pp0 -> layer_1_expert_sp2_ep9_tp3_pp0
	layer_1_expert_out_sp2_ep9_tp3_pp0 [label="Expert Out L1 SP2 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep9_tp3_pp0 -> layer_1_expert_out_sp2_ep9_tp3_pp0
	layer_1_expert_ar_sp2_ep9_pp0 [label="Expert All-Reduce L1 SP2 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep9_tp0_pp0 -> layer_1_expert_ar_sp2_ep9_pp0
	layer_1_expert_out_sp2_ep9_tp1_pp0 -> layer_1_expert_ar_sp2_ep9_pp0
	layer_1_expert_out_sp2_ep9_tp2_pp0 -> layer_1_expert_ar_sp2_ep9_pp0
	layer_1_expert_out_sp2_ep9_tp3_pp0 -> layer_1_expert_ar_sp2_ep9_pp0
	layer_1_combine_sp2_ep9_pp0 [label="Token Combine L1 SP2 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep9_pp0 -> layer_1_combine_sp2_ep9_pp0
	layer_1_dispatch_sp2_ep10_pp0 [label="Token Dispatch L1 SP2 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep10_pp0 [style=dashed]
	layer_1_expert_sp2_ep10_tp0_pp0 [label="Expert L1 SP2 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep10_pp0 -> layer_1_expert_sp2_ep10_tp0_pp0
	layer_1_expert_out_sp2_ep10_tp0_pp0 [label="Expert Out L1 SP2 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep10_tp0_pp0 -> layer_1_expert_out_sp2_ep10_tp0_pp0
	layer_1_expert_sp2_ep10_tp1_pp0 [label="Expert L1 SP2 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep10_pp0 -> layer_1_expert_sp2_ep10_tp1_pp0
	layer_1_expert_out_sp2_ep10_tp1_pp0 [label="Expert Out L1 SP2 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep10_tp1_pp0 -> layer_1_expert_out_sp2_ep10_tp1_pp0
	layer_1_expert_sp2_ep10_tp2_pp0 [label="Expert L1 SP2 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep10_pp0 -> layer_1_expert_sp2_ep10_tp2_pp0
	layer_1_expert_out_sp2_ep10_tp2_pp0 [label="Expert Out L1 SP2 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep10_tp2_pp0 -> layer_1_expert_out_sp2_ep10_tp2_pp0
	layer_1_expert_sp2_ep10_tp3_pp0 [label="Expert L1 SP2 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep10_pp0 -> layer_1_expert_sp2_ep10_tp3_pp0
	layer_1_expert_out_sp2_ep10_tp3_pp0 [label="Expert Out L1 SP2 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep10_tp3_pp0 -> layer_1_expert_out_sp2_ep10_tp3_pp0
	layer_1_expert_ar_sp2_ep10_pp0 [label="Expert All-Reduce L1 SP2 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep10_tp0_pp0 -> layer_1_expert_ar_sp2_ep10_pp0
	layer_1_expert_out_sp2_ep10_tp1_pp0 -> layer_1_expert_ar_sp2_ep10_pp0
	layer_1_expert_out_sp2_ep10_tp2_pp0 -> layer_1_expert_ar_sp2_ep10_pp0
	layer_1_expert_out_sp2_ep10_tp3_pp0 -> layer_1_expert_ar_sp2_ep10_pp0
	layer_1_combine_sp2_ep10_pp0 [label="Token Combine L1 SP2 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep10_pp0 -> layer_1_combine_sp2_ep10_pp0
	layer_1_dispatch_sp2_ep11_pp0 [label="Token Dispatch L1 SP2 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep11_pp0 [style=dashed]
	layer_1_expert_sp2_ep11_tp0_pp0 [label="Expert L1 SP2 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep11_pp0 -> layer_1_expert_sp2_ep11_tp0_pp0
	layer_1_expert_out_sp2_ep11_tp0_pp0 [label="Expert Out L1 SP2 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep11_tp0_pp0 -> layer_1_expert_out_sp2_ep11_tp0_pp0
	layer_1_expert_sp2_ep11_tp1_pp0 [label="Expert L1 SP2 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep11_pp0 -> layer_1_expert_sp2_ep11_tp1_pp0
	layer_1_expert_out_sp2_ep11_tp1_pp0 [label="Expert Out L1 SP2 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep11_tp1_pp0 -> layer_1_expert_out_sp2_ep11_tp1_pp0
	layer_1_expert_sp2_ep11_tp2_pp0 [label="Expert L1 SP2 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep11_pp0 -> layer_1_expert_sp2_ep11_tp2_pp0
	layer_1_expert_out_sp2_ep11_tp2_pp0 [label="Expert Out L1 SP2 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep11_tp2_pp0 -> layer_1_expert_out_sp2_ep11_tp2_pp0
	layer_1_expert_sp2_ep11_tp3_pp0 [label="Expert L1 SP2 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep11_pp0 -> layer_1_expert_sp2_ep11_tp3_pp0
	layer_1_expert_out_sp2_ep11_tp3_pp0 [label="Expert Out L1 SP2 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep11_tp3_pp0 -> layer_1_expert_out_sp2_ep11_tp3_pp0
	layer_1_expert_ar_sp2_ep11_pp0 [label="Expert All-Reduce L1 SP2 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep11_tp0_pp0 -> layer_1_expert_ar_sp2_ep11_pp0
	layer_1_expert_out_sp2_ep11_tp1_pp0 -> layer_1_expert_ar_sp2_ep11_pp0
	layer_1_expert_out_sp2_ep11_tp2_pp0 -> layer_1_expert_ar_sp2_ep11_pp0
	layer_1_expert_out_sp2_ep11_tp3_pp0 -> layer_1_expert_ar_sp2_ep11_pp0
	layer_1_combine_sp2_ep11_pp0 [label="Token Combine L1 SP2 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep11_pp0 -> layer_1_combine_sp2_ep11_pp0
	layer_1_dispatch_sp2_ep12_pp0 [label="Token Dispatch L1 SP2 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep12_pp0 [style=dashed]
	layer_1_expert_sp2_ep12_tp0_pp0 [label="Expert L1 SP2 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep12_pp0 -> layer_1_expert_sp2_ep12_tp0_pp0
	layer_1_expert_out_sp2_ep12_tp0_pp0 [label="Expert Out L1 SP2 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep12_tp0_pp0 -> layer_1_expert_out_sp2_ep12_tp0_pp0
	layer_1_expert_sp2_ep12_tp1_pp0 [label="Expert L1 SP2 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep12_pp0 -> layer_1_expert_sp2_ep12_tp1_pp0
	layer_1_expert_out_sp2_ep12_tp1_pp0 [label="Expert Out L1 SP2 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep12_tp1_pp0 -> layer_1_expert_out_sp2_ep12_tp1_pp0
	layer_1_expert_sp2_ep12_tp2_pp0 [label="Expert L1 SP2 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep12_pp0 -> layer_1_expert_sp2_ep12_tp2_pp0
	layer_1_expert_out_sp2_ep12_tp2_pp0 [label="Expert Out L1 SP2 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep12_tp2_pp0 -> layer_1_expert_out_sp2_ep12_tp2_pp0
	layer_1_expert_sp2_ep12_tp3_pp0 [label="Expert L1 SP2 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep12_pp0 -> layer_1_expert_sp2_ep12_tp3_pp0
	layer_1_expert_out_sp2_ep12_tp3_pp0 [label="Expert Out L1 SP2 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep12_tp3_pp0 -> layer_1_expert_out_sp2_ep12_tp3_pp0
	layer_1_expert_ar_sp2_ep12_pp0 [label="Expert All-Reduce L1 SP2 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep12_tp0_pp0 -> layer_1_expert_ar_sp2_ep12_pp0
	layer_1_expert_out_sp2_ep12_tp1_pp0 -> layer_1_expert_ar_sp2_ep12_pp0
	layer_1_expert_out_sp2_ep12_tp2_pp0 -> layer_1_expert_ar_sp2_ep12_pp0
	layer_1_expert_out_sp2_ep12_tp3_pp0 -> layer_1_expert_ar_sp2_ep12_pp0
	layer_1_combine_sp2_ep12_pp0 [label="Token Combine L1 SP2 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep12_pp0 -> layer_1_combine_sp2_ep12_pp0
	layer_1_dispatch_sp2_ep13_pp0 [label="Token Dispatch L1 SP2 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep13_pp0 [style=dashed]
	layer_1_expert_sp2_ep13_tp0_pp0 [label="Expert L1 SP2 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep13_pp0 -> layer_1_expert_sp2_ep13_tp0_pp0
	layer_1_expert_out_sp2_ep13_tp0_pp0 [label="Expert Out L1 SP2 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep13_tp0_pp0 -> layer_1_expert_out_sp2_ep13_tp0_pp0
	layer_1_expert_sp2_ep13_tp1_pp0 [label="Expert L1 SP2 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep13_pp0 -> layer_1_expert_sp2_ep13_tp1_pp0
	layer_1_expert_out_sp2_ep13_tp1_pp0 [label="Expert Out L1 SP2 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep13_tp1_pp0 -> layer_1_expert_out_sp2_ep13_tp1_pp0
	layer_1_expert_sp2_ep13_tp2_pp0 [label="Expert L1 SP2 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep13_pp0 -> layer_1_expert_sp2_ep13_tp2_pp0
	layer_1_expert_out_sp2_ep13_tp2_pp0 [label="Expert Out L1 SP2 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep13_tp2_pp0 -> layer_1_expert_out_sp2_ep13_tp2_pp0
	layer_1_expert_sp2_ep13_tp3_pp0 [label="Expert L1 SP2 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep13_pp0 -> layer_1_expert_sp2_ep13_tp3_pp0
	layer_1_expert_out_sp2_ep13_tp3_pp0 [label="Expert Out L1 SP2 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep13_tp3_pp0 -> layer_1_expert_out_sp2_ep13_tp3_pp0
	layer_1_expert_ar_sp2_ep13_pp0 [label="Expert All-Reduce L1 SP2 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep13_tp0_pp0 -> layer_1_expert_ar_sp2_ep13_pp0
	layer_1_expert_out_sp2_ep13_tp1_pp0 -> layer_1_expert_ar_sp2_ep13_pp0
	layer_1_expert_out_sp2_ep13_tp2_pp0 -> layer_1_expert_ar_sp2_ep13_pp0
	layer_1_expert_out_sp2_ep13_tp3_pp0 -> layer_1_expert_ar_sp2_ep13_pp0
	layer_1_combine_sp2_ep13_pp0 [label="Token Combine L1 SP2 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep13_pp0 -> layer_1_combine_sp2_ep13_pp0
	layer_1_dispatch_sp2_ep14_pp0 [label="Token Dispatch L1 SP2 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep14_pp0 [style=dashed]
	layer_1_expert_sp2_ep14_tp0_pp0 [label="Expert L1 SP2 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep14_pp0 -> layer_1_expert_sp2_ep14_tp0_pp0
	layer_1_expert_out_sp2_ep14_tp0_pp0 [label="Expert Out L1 SP2 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep14_tp0_pp0 -> layer_1_expert_out_sp2_ep14_tp0_pp0
	layer_1_expert_sp2_ep14_tp1_pp0 [label="Expert L1 SP2 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep14_pp0 -> layer_1_expert_sp2_ep14_tp1_pp0
	layer_1_expert_out_sp2_ep14_tp1_pp0 [label="Expert Out L1 SP2 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep14_tp1_pp0 -> layer_1_expert_out_sp2_ep14_tp1_pp0
	layer_1_expert_sp2_ep14_tp2_pp0 [label="Expert L1 SP2 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep14_pp0 -> layer_1_expert_sp2_ep14_tp2_pp0
	layer_1_expert_out_sp2_ep14_tp2_pp0 [label="Expert Out L1 SP2 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep14_tp2_pp0 -> layer_1_expert_out_sp2_ep14_tp2_pp0
	layer_1_expert_sp2_ep14_tp3_pp0 [label="Expert L1 SP2 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep14_pp0 -> layer_1_expert_sp2_ep14_tp3_pp0
	layer_1_expert_out_sp2_ep14_tp3_pp0 [label="Expert Out L1 SP2 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep14_tp3_pp0 -> layer_1_expert_out_sp2_ep14_tp3_pp0
	layer_1_expert_ar_sp2_ep14_pp0 [label="Expert All-Reduce L1 SP2 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep14_tp0_pp0 -> layer_1_expert_ar_sp2_ep14_pp0
	layer_1_expert_out_sp2_ep14_tp1_pp0 -> layer_1_expert_ar_sp2_ep14_pp0
	layer_1_expert_out_sp2_ep14_tp2_pp0 -> layer_1_expert_ar_sp2_ep14_pp0
	layer_1_expert_out_sp2_ep14_tp3_pp0 -> layer_1_expert_ar_sp2_ep14_pp0
	layer_1_combine_sp2_ep14_pp0 [label="Token Combine L1 SP2 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep14_pp0 -> layer_1_combine_sp2_ep14_pp0
	layer_1_dispatch_sp2_ep15_pp0 [label="Token Dispatch L1 SP2 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp2_pp0 -> layer_1_dispatch_sp2_ep15_pp0 [style=dashed]
	layer_1_expert_sp2_ep15_tp0_pp0 [label="Expert L1 SP2 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep15_pp0 -> layer_1_expert_sp2_ep15_tp0_pp0
	layer_1_expert_out_sp2_ep15_tp0_pp0 [label="Expert Out L1 SP2 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep15_tp0_pp0 -> layer_1_expert_out_sp2_ep15_tp0_pp0
	layer_1_expert_sp2_ep15_tp1_pp0 [label="Expert L1 SP2 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep15_pp0 -> layer_1_expert_sp2_ep15_tp1_pp0
	layer_1_expert_out_sp2_ep15_tp1_pp0 [label="Expert Out L1 SP2 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep15_tp1_pp0 -> layer_1_expert_out_sp2_ep15_tp1_pp0
	layer_1_expert_sp2_ep15_tp2_pp0 [label="Expert L1 SP2 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep15_pp0 -> layer_1_expert_sp2_ep15_tp2_pp0
	layer_1_expert_out_sp2_ep15_tp2_pp0 [label="Expert Out L1 SP2 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep15_tp2_pp0 -> layer_1_expert_out_sp2_ep15_tp2_pp0
	layer_1_expert_sp2_ep15_tp3_pp0 [label="Expert L1 SP2 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp2_ep15_pp0 -> layer_1_expert_sp2_ep15_tp3_pp0
	layer_1_expert_out_sp2_ep15_tp3_pp0 [label="Expert Out L1 SP2 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp2_ep15_tp3_pp0 -> layer_1_expert_out_sp2_ep15_tp3_pp0
	layer_1_expert_ar_sp2_ep15_pp0 [label="Expert All-Reduce L1 SP2 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp2_ep15_tp0_pp0 -> layer_1_expert_ar_sp2_ep15_pp0
	layer_1_expert_out_sp2_ep15_tp1_pp0 -> layer_1_expert_ar_sp2_ep15_pp0
	layer_1_expert_out_sp2_ep15_tp2_pp0 -> layer_1_expert_ar_sp2_ep15_pp0
	layer_1_expert_out_sp2_ep15_tp3_pp0 -> layer_1_expert_ar_sp2_ep15_pp0
	layer_1_combine_sp2_ep15_pp0 [label="Token Combine L1 SP2 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp2_ep15_pp0 -> layer_1_combine_sp2_ep15_pp0
	layer_1_moe_all2all_sp2_pp0 [label="MoE All-to-All L1 SP2\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_1_combine_sp2_ep0_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep1_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep2_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep3_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep4_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep5_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep6_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep7_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep8_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep9_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep10_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep11_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep12_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep13_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep14_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_combine_sp2_ep15_pp0 -> layer_1_moe_all2all_sp2_pp0
	layer_1_mlp_out_sp2_pp0 [label="MoE Output L1 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_moe_all2all_sp2_pp0 -> layer_1_mlp_out_sp2_pp0
	layer_1_mlp_res_sp2_pp0 [label="MLP Residual L1 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_mlp_out_sp2_pp0 -> layer_1_mlp_res_sp2_pp0
	layer_1_attn_res_sp2_pp0 -> layer_1_mlp_res_sp2_pp0 [style=dashed]
	layer_1_norm_sp3_pp0 [label="LayerNorm L1 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_0_mlp_out_sp3_pp0 -> layer_1_norm_sp3_pp0
	layer_1_qkv_sp3_tp0_pp0 [label="QKV Proj L1 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp3_pp0 -> layer_1_qkv_sp3_tp0_pp0
	layer_1_attn_sp3_tp0_pp0 [label="Attention L1 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp3_tp0_pp0 -> layer_1_attn_sp3_tp0_pp0
	layer_1_attn_out_sp3_tp0_pp0 [label="Attn Out Proj L1 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp3_tp0_pp0 -> layer_1_attn_out_sp3_tp0_pp0
	layer_1_qkv_sp3_tp1_pp0 [label="QKV Proj L1 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp3_pp0 -> layer_1_qkv_sp3_tp1_pp0
	layer_1_attn_sp3_tp1_pp0 [label="Attention L1 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp3_tp1_pp0 -> layer_1_attn_sp3_tp1_pp0
	layer_1_attn_out_sp3_tp1_pp0 [label="Attn Out Proj L1 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp3_tp1_pp0 -> layer_1_attn_out_sp3_tp1_pp0
	layer_1_qkv_sp3_tp2_pp0 [label="QKV Proj L1 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp3_pp0 -> layer_1_qkv_sp3_tp2_pp0
	layer_1_attn_sp3_tp2_pp0 [label="Attention L1 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp3_tp2_pp0 -> layer_1_attn_sp3_tp2_pp0
	layer_1_attn_out_sp3_tp2_pp0 [label="Attn Out Proj L1 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp3_tp2_pp0 -> layer_1_attn_out_sp3_tp2_pp0
	layer_1_qkv_sp3_tp3_pp0 [label="QKV Proj L1 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_norm_sp3_pp0 -> layer_1_qkv_sp3_tp3_pp0
	layer_1_attn_sp3_tp3_pp0 [label="Attention L1 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_qkv_sp3_tp3_pp0 -> layer_1_attn_sp3_tp3_pp0
	layer_1_attn_out_sp3_tp3_pp0 [label="Attn Out Proj L1 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_1_attn_sp3_tp3_pp0 -> layer_1_attn_out_sp3_tp3_pp0
	layer_1_attn_ar_sp3_pp0 [label="Attention All-Reduce L1 SP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_attn_out_sp3_tp0_pp0 -> layer_1_attn_ar_sp3_pp0
	layer_1_attn_out_sp3_tp1_pp0 -> layer_1_attn_ar_sp3_pp0
	layer_1_attn_out_sp3_tp2_pp0 -> layer_1_attn_ar_sp3_pp0
	layer_1_attn_out_sp3_tp3_pp0 -> layer_1_attn_ar_sp3_pp0
	layer_1_attn_res_sp3_pp0 [label="Attention Residual L1 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_attn_ar_sp3_pp0 -> layer_1_attn_res_sp3_pp0
	layer_1_norm_sp3_pp0 -> layer_1_attn_res_sp3_pp0 [style=dashed]
	layer_1_post_norm_sp3_pp0 [label="Post-Attn Norm L1 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_attn_res_sp3_pp0 -> layer_1_post_norm_sp3_pp0
	layer_1_router_sp3_pp0 [label="MoE Router L1 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_1_post_norm_sp3_pp0 -> layer_1_router_sp3_pp0
	layer_1_dispatch_sp3_ep0_pp0 [label="Token Dispatch L1 SP3 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep0_pp0 [style=dashed]
	layer_1_expert_sp3_ep0_tp0_pp0 [label="Expert L1 SP3 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep0_pp0 -> layer_1_expert_sp3_ep0_tp0_pp0
	layer_1_expert_out_sp3_ep0_tp0_pp0 [label="Expert Out L1 SP3 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep0_tp0_pp0 -> layer_1_expert_out_sp3_ep0_tp0_pp0
	layer_1_expert_sp3_ep0_tp1_pp0 [label="Expert L1 SP3 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep0_pp0 -> layer_1_expert_sp3_ep0_tp1_pp0
	layer_1_expert_out_sp3_ep0_tp1_pp0 [label="Expert Out L1 SP3 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep0_tp1_pp0 -> layer_1_expert_out_sp3_ep0_tp1_pp0
	layer_1_expert_sp3_ep0_tp2_pp0 [label="Expert L1 SP3 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep0_pp0 -> layer_1_expert_sp3_ep0_tp2_pp0
	layer_1_expert_out_sp3_ep0_tp2_pp0 [label="Expert Out L1 SP3 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep0_tp2_pp0 -> layer_1_expert_out_sp3_ep0_tp2_pp0
	layer_1_expert_sp3_ep0_tp3_pp0 [label="Expert L1 SP3 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep0_pp0 -> layer_1_expert_sp3_ep0_tp3_pp0
	layer_1_expert_out_sp3_ep0_tp3_pp0 [label="Expert Out L1 SP3 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep0_tp3_pp0 -> layer_1_expert_out_sp3_ep0_tp3_pp0
	layer_1_expert_ar_sp3_ep0_pp0 [label="Expert All-Reduce L1 SP3 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep0_tp0_pp0 -> layer_1_expert_ar_sp3_ep0_pp0
	layer_1_expert_out_sp3_ep0_tp1_pp0 -> layer_1_expert_ar_sp3_ep0_pp0
	layer_1_expert_out_sp3_ep0_tp2_pp0 -> layer_1_expert_ar_sp3_ep0_pp0
	layer_1_expert_out_sp3_ep0_tp3_pp0 -> layer_1_expert_ar_sp3_ep0_pp0
	layer_1_combine_sp3_ep0_pp0 [label="Token Combine L1 SP3 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep0_pp0 -> layer_1_combine_sp3_ep0_pp0
	layer_1_dispatch_sp3_ep1_pp0 [label="Token Dispatch L1 SP3 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep1_pp0 [style=dashed]
	layer_1_expert_sp3_ep1_tp0_pp0 [label="Expert L1 SP3 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep1_pp0 -> layer_1_expert_sp3_ep1_tp0_pp0
	layer_1_expert_out_sp3_ep1_tp0_pp0 [label="Expert Out L1 SP3 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep1_tp0_pp0 -> layer_1_expert_out_sp3_ep1_tp0_pp0
	layer_1_expert_sp3_ep1_tp1_pp0 [label="Expert L1 SP3 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep1_pp0 -> layer_1_expert_sp3_ep1_tp1_pp0
	layer_1_expert_out_sp3_ep1_tp1_pp0 [label="Expert Out L1 SP3 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep1_tp1_pp0 -> layer_1_expert_out_sp3_ep1_tp1_pp0
	layer_1_expert_sp3_ep1_tp2_pp0 [label="Expert L1 SP3 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep1_pp0 -> layer_1_expert_sp3_ep1_tp2_pp0
	layer_1_expert_out_sp3_ep1_tp2_pp0 [label="Expert Out L1 SP3 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep1_tp2_pp0 -> layer_1_expert_out_sp3_ep1_tp2_pp0
	layer_1_expert_sp3_ep1_tp3_pp0 [label="Expert L1 SP3 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep1_pp0 -> layer_1_expert_sp3_ep1_tp3_pp0
	layer_1_expert_out_sp3_ep1_tp3_pp0 [label="Expert Out L1 SP3 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep1_tp3_pp0 -> layer_1_expert_out_sp3_ep1_tp3_pp0
	layer_1_expert_ar_sp3_ep1_pp0 [label="Expert All-Reduce L1 SP3 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep1_tp0_pp0 -> layer_1_expert_ar_sp3_ep1_pp0
	layer_1_expert_out_sp3_ep1_tp1_pp0 -> layer_1_expert_ar_sp3_ep1_pp0
	layer_1_expert_out_sp3_ep1_tp2_pp0 -> layer_1_expert_ar_sp3_ep1_pp0
	layer_1_expert_out_sp3_ep1_tp3_pp0 -> layer_1_expert_ar_sp3_ep1_pp0
	layer_1_combine_sp3_ep1_pp0 [label="Token Combine L1 SP3 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep1_pp0 -> layer_1_combine_sp3_ep1_pp0
	layer_1_dispatch_sp3_ep2_pp0 [label="Token Dispatch L1 SP3 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep2_pp0 [style=dashed]
	layer_1_expert_sp3_ep2_tp0_pp0 [label="Expert L1 SP3 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep2_pp0 -> layer_1_expert_sp3_ep2_tp0_pp0
	layer_1_expert_out_sp3_ep2_tp0_pp0 [label="Expert Out L1 SP3 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep2_tp0_pp0 -> layer_1_expert_out_sp3_ep2_tp0_pp0
	layer_1_expert_sp3_ep2_tp1_pp0 [label="Expert L1 SP3 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep2_pp0 -> layer_1_expert_sp3_ep2_tp1_pp0
	layer_1_expert_out_sp3_ep2_tp1_pp0 [label="Expert Out L1 SP3 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep2_tp1_pp0 -> layer_1_expert_out_sp3_ep2_tp1_pp0
	layer_1_expert_sp3_ep2_tp2_pp0 [label="Expert L1 SP3 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep2_pp0 -> layer_1_expert_sp3_ep2_tp2_pp0
	layer_1_expert_out_sp3_ep2_tp2_pp0 [label="Expert Out L1 SP3 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep2_tp2_pp0 -> layer_1_expert_out_sp3_ep2_tp2_pp0
	layer_1_expert_sp3_ep2_tp3_pp0 [label="Expert L1 SP3 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep2_pp0 -> layer_1_expert_sp3_ep2_tp3_pp0
	layer_1_expert_out_sp3_ep2_tp3_pp0 [label="Expert Out L1 SP3 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep2_tp3_pp0 -> layer_1_expert_out_sp3_ep2_tp3_pp0
	layer_1_expert_ar_sp3_ep2_pp0 [label="Expert All-Reduce L1 SP3 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep2_tp0_pp0 -> layer_1_expert_ar_sp3_ep2_pp0
	layer_1_expert_out_sp3_ep2_tp1_pp0 -> layer_1_expert_ar_sp3_ep2_pp0
	layer_1_expert_out_sp3_ep2_tp2_pp0 -> layer_1_expert_ar_sp3_ep2_pp0
	layer_1_expert_out_sp3_ep2_tp3_pp0 -> layer_1_expert_ar_sp3_ep2_pp0
	layer_1_combine_sp3_ep2_pp0 [label="Token Combine L1 SP3 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep2_pp0 -> layer_1_combine_sp3_ep2_pp0
	layer_1_dispatch_sp3_ep3_pp0 [label="Token Dispatch L1 SP3 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep3_pp0 [style=dashed]
	layer_1_expert_sp3_ep3_tp0_pp0 [label="Expert L1 SP3 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep3_pp0 -> layer_1_expert_sp3_ep3_tp0_pp0
	layer_1_expert_out_sp3_ep3_tp0_pp0 [label="Expert Out L1 SP3 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep3_tp0_pp0 -> layer_1_expert_out_sp3_ep3_tp0_pp0
	layer_1_expert_sp3_ep3_tp1_pp0 [label="Expert L1 SP3 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep3_pp0 -> layer_1_expert_sp3_ep3_tp1_pp0
	layer_1_expert_out_sp3_ep3_tp1_pp0 [label="Expert Out L1 SP3 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep3_tp1_pp0 -> layer_1_expert_out_sp3_ep3_tp1_pp0
	layer_1_expert_sp3_ep3_tp2_pp0 [label="Expert L1 SP3 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep3_pp0 -> layer_1_expert_sp3_ep3_tp2_pp0
	layer_1_expert_out_sp3_ep3_tp2_pp0 [label="Expert Out L1 SP3 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep3_tp2_pp0 -> layer_1_expert_out_sp3_ep3_tp2_pp0
	layer_1_expert_sp3_ep3_tp3_pp0 [label="Expert L1 SP3 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep3_pp0 -> layer_1_expert_sp3_ep3_tp3_pp0
	layer_1_expert_out_sp3_ep3_tp3_pp0 [label="Expert Out L1 SP3 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep3_tp3_pp0 -> layer_1_expert_out_sp3_ep3_tp3_pp0
	layer_1_expert_ar_sp3_ep3_pp0 [label="Expert All-Reduce L1 SP3 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep3_tp0_pp0 -> layer_1_expert_ar_sp3_ep3_pp0
	layer_1_expert_out_sp3_ep3_tp1_pp0 -> layer_1_expert_ar_sp3_ep3_pp0
	layer_1_expert_out_sp3_ep3_tp2_pp0 -> layer_1_expert_ar_sp3_ep3_pp0
	layer_1_expert_out_sp3_ep3_tp3_pp0 -> layer_1_expert_ar_sp3_ep3_pp0
	layer_1_combine_sp3_ep3_pp0 [label="Token Combine L1 SP3 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep3_pp0 -> layer_1_combine_sp3_ep3_pp0
	layer_1_dispatch_sp3_ep4_pp0 [label="Token Dispatch L1 SP3 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep4_pp0 [style=dashed]
	layer_1_expert_sp3_ep4_tp0_pp0 [label="Expert L1 SP3 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep4_pp0 -> layer_1_expert_sp3_ep4_tp0_pp0
	layer_1_expert_out_sp3_ep4_tp0_pp0 [label="Expert Out L1 SP3 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep4_tp0_pp0 -> layer_1_expert_out_sp3_ep4_tp0_pp0
	layer_1_expert_sp3_ep4_tp1_pp0 [label="Expert L1 SP3 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep4_pp0 -> layer_1_expert_sp3_ep4_tp1_pp0
	layer_1_expert_out_sp3_ep4_tp1_pp0 [label="Expert Out L1 SP3 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep4_tp1_pp0 -> layer_1_expert_out_sp3_ep4_tp1_pp0
	layer_1_expert_sp3_ep4_tp2_pp0 [label="Expert L1 SP3 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep4_pp0 -> layer_1_expert_sp3_ep4_tp2_pp0
	layer_1_expert_out_sp3_ep4_tp2_pp0 [label="Expert Out L1 SP3 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep4_tp2_pp0 -> layer_1_expert_out_sp3_ep4_tp2_pp0
	layer_1_expert_sp3_ep4_tp3_pp0 [label="Expert L1 SP3 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep4_pp0 -> layer_1_expert_sp3_ep4_tp3_pp0
	layer_1_expert_out_sp3_ep4_tp3_pp0 [label="Expert Out L1 SP3 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep4_tp3_pp0 -> layer_1_expert_out_sp3_ep4_tp3_pp0
	layer_1_expert_ar_sp3_ep4_pp0 [label="Expert All-Reduce L1 SP3 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep4_tp0_pp0 -> layer_1_expert_ar_sp3_ep4_pp0
	layer_1_expert_out_sp3_ep4_tp1_pp0 -> layer_1_expert_ar_sp3_ep4_pp0
	layer_1_expert_out_sp3_ep4_tp2_pp0 -> layer_1_expert_ar_sp3_ep4_pp0
	layer_1_expert_out_sp3_ep4_tp3_pp0 -> layer_1_expert_ar_sp3_ep4_pp0
	layer_1_combine_sp3_ep4_pp0 [label="Token Combine L1 SP3 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep4_pp0 -> layer_1_combine_sp3_ep4_pp0
	layer_1_dispatch_sp3_ep5_pp0 [label="Token Dispatch L1 SP3 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep5_pp0 [style=dashed]
	layer_1_expert_sp3_ep5_tp0_pp0 [label="Expert L1 SP3 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep5_pp0 -> layer_1_expert_sp3_ep5_tp0_pp0
	layer_1_expert_out_sp3_ep5_tp0_pp0 [label="Expert Out L1 SP3 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep5_tp0_pp0 -> layer_1_expert_out_sp3_ep5_tp0_pp0
	layer_1_expert_sp3_ep5_tp1_pp0 [label="Expert L1 SP3 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep5_pp0 -> layer_1_expert_sp3_ep5_tp1_pp0
	layer_1_expert_out_sp3_ep5_tp1_pp0 [label="Expert Out L1 SP3 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep5_tp1_pp0 -> layer_1_expert_out_sp3_ep5_tp1_pp0
	layer_1_expert_sp3_ep5_tp2_pp0 [label="Expert L1 SP3 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep5_pp0 -> layer_1_expert_sp3_ep5_tp2_pp0
	layer_1_expert_out_sp3_ep5_tp2_pp0 [label="Expert Out L1 SP3 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep5_tp2_pp0 -> layer_1_expert_out_sp3_ep5_tp2_pp0
	layer_1_expert_sp3_ep5_tp3_pp0 [label="Expert L1 SP3 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep5_pp0 -> layer_1_expert_sp3_ep5_tp3_pp0
	layer_1_expert_out_sp3_ep5_tp3_pp0 [label="Expert Out L1 SP3 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep5_tp3_pp0 -> layer_1_expert_out_sp3_ep5_tp3_pp0
	layer_1_expert_ar_sp3_ep5_pp0 [label="Expert All-Reduce L1 SP3 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep5_tp0_pp0 -> layer_1_expert_ar_sp3_ep5_pp0
	layer_1_expert_out_sp3_ep5_tp1_pp0 -> layer_1_expert_ar_sp3_ep5_pp0
	layer_1_expert_out_sp3_ep5_tp2_pp0 -> layer_1_expert_ar_sp3_ep5_pp0
	layer_1_expert_out_sp3_ep5_tp3_pp0 -> layer_1_expert_ar_sp3_ep5_pp0
	layer_1_combine_sp3_ep5_pp0 [label="Token Combine L1 SP3 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep5_pp0 -> layer_1_combine_sp3_ep5_pp0
	layer_1_dispatch_sp3_ep6_pp0 [label="Token Dispatch L1 SP3 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep6_pp0 [style=dashed]
	layer_1_expert_sp3_ep6_tp0_pp0 [label="Expert L1 SP3 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep6_pp0 -> layer_1_expert_sp3_ep6_tp0_pp0
	layer_1_expert_out_sp3_ep6_tp0_pp0 [label="Expert Out L1 SP3 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep6_tp0_pp0 -> layer_1_expert_out_sp3_ep6_tp0_pp0
	layer_1_expert_sp3_ep6_tp1_pp0 [label="Expert L1 SP3 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep6_pp0 -> layer_1_expert_sp3_ep6_tp1_pp0
	layer_1_expert_out_sp3_ep6_tp1_pp0 [label="Expert Out L1 SP3 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep6_tp1_pp0 -> layer_1_expert_out_sp3_ep6_tp1_pp0
	layer_1_expert_sp3_ep6_tp2_pp0 [label="Expert L1 SP3 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep6_pp0 -> layer_1_expert_sp3_ep6_tp2_pp0
	layer_1_expert_out_sp3_ep6_tp2_pp0 [label="Expert Out L1 SP3 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep6_tp2_pp0 -> layer_1_expert_out_sp3_ep6_tp2_pp0
	layer_1_expert_sp3_ep6_tp3_pp0 [label="Expert L1 SP3 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep6_pp0 -> layer_1_expert_sp3_ep6_tp3_pp0
	layer_1_expert_out_sp3_ep6_tp3_pp0 [label="Expert Out L1 SP3 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep6_tp3_pp0 -> layer_1_expert_out_sp3_ep6_tp3_pp0
	layer_1_expert_ar_sp3_ep6_pp0 [label="Expert All-Reduce L1 SP3 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep6_tp0_pp0 -> layer_1_expert_ar_sp3_ep6_pp0
	layer_1_expert_out_sp3_ep6_tp1_pp0 -> layer_1_expert_ar_sp3_ep6_pp0
	layer_1_expert_out_sp3_ep6_tp2_pp0 -> layer_1_expert_ar_sp3_ep6_pp0
	layer_1_expert_out_sp3_ep6_tp3_pp0 -> layer_1_expert_ar_sp3_ep6_pp0
	layer_1_combine_sp3_ep6_pp0 [label="Token Combine L1 SP3 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep6_pp0 -> layer_1_combine_sp3_ep6_pp0
	layer_1_dispatch_sp3_ep7_pp0 [label="Token Dispatch L1 SP3 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep7_pp0 [style=dashed]
	layer_1_expert_sp3_ep7_tp0_pp0 [label="Expert L1 SP3 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep7_pp0 -> layer_1_expert_sp3_ep7_tp0_pp0
	layer_1_expert_out_sp3_ep7_tp0_pp0 [label="Expert Out L1 SP3 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep7_tp0_pp0 -> layer_1_expert_out_sp3_ep7_tp0_pp0
	layer_1_expert_sp3_ep7_tp1_pp0 [label="Expert L1 SP3 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep7_pp0 -> layer_1_expert_sp3_ep7_tp1_pp0
	layer_1_expert_out_sp3_ep7_tp1_pp0 [label="Expert Out L1 SP3 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep7_tp1_pp0 -> layer_1_expert_out_sp3_ep7_tp1_pp0
	layer_1_expert_sp3_ep7_tp2_pp0 [label="Expert L1 SP3 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep7_pp0 -> layer_1_expert_sp3_ep7_tp2_pp0
	layer_1_expert_out_sp3_ep7_tp2_pp0 [label="Expert Out L1 SP3 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep7_tp2_pp0 -> layer_1_expert_out_sp3_ep7_tp2_pp0
	layer_1_expert_sp3_ep7_tp3_pp0 [label="Expert L1 SP3 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep7_pp0 -> layer_1_expert_sp3_ep7_tp3_pp0
	layer_1_expert_out_sp3_ep7_tp3_pp0 [label="Expert Out L1 SP3 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep7_tp3_pp0 -> layer_1_expert_out_sp3_ep7_tp3_pp0
	layer_1_expert_ar_sp3_ep7_pp0 [label="Expert All-Reduce L1 SP3 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep7_tp0_pp0 -> layer_1_expert_ar_sp3_ep7_pp0
	layer_1_expert_out_sp3_ep7_tp1_pp0 -> layer_1_expert_ar_sp3_ep7_pp0
	layer_1_expert_out_sp3_ep7_tp2_pp0 -> layer_1_expert_ar_sp3_ep7_pp0
	layer_1_expert_out_sp3_ep7_tp3_pp0 -> layer_1_expert_ar_sp3_ep7_pp0
	layer_1_combine_sp3_ep7_pp0 [label="Token Combine L1 SP3 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep7_pp0 -> layer_1_combine_sp3_ep7_pp0
	layer_1_dispatch_sp3_ep8_pp0 [label="Token Dispatch L1 SP3 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep8_pp0 [style=dashed]
	layer_1_expert_sp3_ep8_tp0_pp0 [label="Expert L1 SP3 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep8_pp0 -> layer_1_expert_sp3_ep8_tp0_pp0
	layer_1_expert_out_sp3_ep8_tp0_pp0 [label="Expert Out L1 SP3 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep8_tp0_pp0 -> layer_1_expert_out_sp3_ep8_tp0_pp0
	layer_1_expert_sp3_ep8_tp1_pp0 [label="Expert L1 SP3 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep8_pp0 -> layer_1_expert_sp3_ep8_tp1_pp0
	layer_1_expert_out_sp3_ep8_tp1_pp0 [label="Expert Out L1 SP3 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep8_tp1_pp0 -> layer_1_expert_out_sp3_ep8_tp1_pp0
	layer_1_expert_sp3_ep8_tp2_pp0 [label="Expert L1 SP3 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep8_pp0 -> layer_1_expert_sp3_ep8_tp2_pp0
	layer_1_expert_out_sp3_ep8_tp2_pp0 [label="Expert Out L1 SP3 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep8_tp2_pp0 -> layer_1_expert_out_sp3_ep8_tp2_pp0
	layer_1_expert_sp3_ep8_tp3_pp0 [label="Expert L1 SP3 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep8_pp0 -> layer_1_expert_sp3_ep8_tp3_pp0
	layer_1_expert_out_sp3_ep8_tp3_pp0 [label="Expert Out L1 SP3 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep8_tp3_pp0 -> layer_1_expert_out_sp3_ep8_tp3_pp0
	layer_1_expert_ar_sp3_ep8_pp0 [label="Expert All-Reduce L1 SP3 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep8_tp0_pp0 -> layer_1_expert_ar_sp3_ep8_pp0
	layer_1_expert_out_sp3_ep8_tp1_pp0 -> layer_1_expert_ar_sp3_ep8_pp0
	layer_1_expert_out_sp3_ep8_tp2_pp0 -> layer_1_expert_ar_sp3_ep8_pp0
	layer_1_expert_out_sp3_ep8_tp3_pp0 -> layer_1_expert_ar_sp3_ep8_pp0
	layer_1_combine_sp3_ep8_pp0 [label="Token Combine L1 SP3 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep8_pp0 -> layer_1_combine_sp3_ep8_pp0
	layer_1_dispatch_sp3_ep9_pp0 [label="Token Dispatch L1 SP3 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep9_pp0 [style=dashed]
	layer_1_expert_sp3_ep9_tp0_pp0 [label="Expert L1 SP3 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep9_pp0 -> layer_1_expert_sp3_ep9_tp0_pp0
	layer_1_expert_out_sp3_ep9_tp0_pp0 [label="Expert Out L1 SP3 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep9_tp0_pp0 -> layer_1_expert_out_sp3_ep9_tp0_pp0
	layer_1_expert_sp3_ep9_tp1_pp0 [label="Expert L1 SP3 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep9_pp0 -> layer_1_expert_sp3_ep9_tp1_pp0
	layer_1_expert_out_sp3_ep9_tp1_pp0 [label="Expert Out L1 SP3 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep9_tp1_pp0 -> layer_1_expert_out_sp3_ep9_tp1_pp0
	layer_1_expert_sp3_ep9_tp2_pp0 [label="Expert L1 SP3 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep9_pp0 -> layer_1_expert_sp3_ep9_tp2_pp0
	layer_1_expert_out_sp3_ep9_tp2_pp0 [label="Expert Out L1 SP3 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep9_tp2_pp0 -> layer_1_expert_out_sp3_ep9_tp2_pp0
	layer_1_expert_sp3_ep9_tp3_pp0 [label="Expert L1 SP3 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep9_pp0 -> layer_1_expert_sp3_ep9_tp3_pp0
	layer_1_expert_out_sp3_ep9_tp3_pp0 [label="Expert Out L1 SP3 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep9_tp3_pp0 -> layer_1_expert_out_sp3_ep9_tp3_pp0
	layer_1_expert_ar_sp3_ep9_pp0 [label="Expert All-Reduce L1 SP3 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep9_tp0_pp0 -> layer_1_expert_ar_sp3_ep9_pp0
	layer_1_expert_out_sp3_ep9_tp1_pp0 -> layer_1_expert_ar_sp3_ep9_pp0
	layer_1_expert_out_sp3_ep9_tp2_pp0 -> layer_1_expert_ar_sp3_ep9_pp0
	layer_1_expert_out_sp3_ep9_tp3_pp0 -> layer_1_expert_ar_sp3_ep9_pp0
	layer_1_combine_sp3_ep9_pp0 [label="Token Combine L1 SP3 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep9_pp0 -> layer_1_combine_sp3_ep9_pp0
	layer_1_dispatch_sp3_ep10_pp0 [label="Token Dispatch L1 SP3 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep10_pp0 [style=dashed]
	layer_1_expert_sp3_ep10_tp0_pp0 [label="Expert L1 SP3 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep10_pp0 -> layer_1_expert_sp3_ep10_tp0_pp0
	layer_1_expert_out_sp3_ep10_tp0_pp0 [label="Expert Out L1 SP3 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep10_tp0_pp0 -> layer_1_expert_out_sp3_ep10_tp0_pp0
	layer_1_expert_sp3_ep10_tp1_pp0 [label="Expert L1 SP3 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep10_pp0 -> layer_1_expert_sp3_ep10_tp1_pp0
	layer_1_expert_out_sp3_ep10_tp1_pp0 [label="Expert Out L1 SP3 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep10_tp1_pp0 -> layer_1_expert_out_sp3_ep10_tp1_pp0
	layer_1_expert_sp3_ep10_tp2_pp0 [label="Expert L1 SP3 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep10_pp0 -> layer_1_expert_sp3_ep10_tp2_pp0
	layer_1_expert_out_sp3_ep10_tp2_pp0 [label="Expert Out L1 SP3 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep10_tp2_pp0 -> layer_1_expert_out_sp3_ep10_tp2_pp0
	layer_1_expert_sp3_ep10_tp3_pp0 [label="Expert L1 SP3 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep10_pp0 -> layer_1_expert_sp3_ep10_tp3_pp0
	layer_1_expert_out_sp3_ep10_tp3_pp0 [label="Expert Out L1 SP3 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep10_tp3_pp0 -> layer_1_expert_out_sp3_ep10_tp3_pp0
	layer_1_expert_ar_sp3_ep10_pp0 [label="Expert All-Reduce L1 SP3 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep10_tp0_pp0 -> layer_1_expert_ar_sp3_ep10_pp0
	layer_1_expert_out_sp3_ep10_tp1_pp0 -> layer_1_expert_ar_sp3_ep10_pp0
	layer_1_expert_out_sp3_ep10_tp2_pp0 -> layer_1_expert_ar_sp3_ep10_pp0
	layer_1_expert_out_sp3_ep10_tp3_pp0 -> layer_1_expert_ar_sp3_ep10_pp0
	layer_1_combine_sp3_ep10_pp0 [label="Token Combine L1 SP3 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep10_pp0 -> layer_1_combine_sp3_ep10_pp0
	layer_1_dispatch_sp3_ep11_pp0 [label="Token Dispatch L1 SP3 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep11_pp0 [style=dashed]
	layer_1_expert_sp3_ep11_tp0_pp0 [label="Expert L1 SP3 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep11_pp0 -> layer_1_expert_sp3_ep11_tp0_pp0
	layer_1_expert_out_sp3_ep11_tp0_pp0 [label="Expert Out L1 SP3 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep11_tp0_pp0 -> layer_1_expert_out_sp3_ep11_tp0_pp0
	layer_1_expert_sp3_ep11_tp1_pp0 [label="Expert L1 SP3 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep11_pp0 -> layer_1_expert_sp3_ep11_tp1_pp0
	layer_1_expert_out_sp3_ep11_tp1_pp0 [label="Expert Out L1 SP3 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep11_tp1_pp0 -> layer_1_expert_out_sp3_ep11_tp1_pp0
	layer_1_expert_sp3_ep11_tp2_pp0 [label="Expert L1 SP3 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep11_pp0 -> layer_1_expert_sp3_ep11_tp2_pp0
	layer_1_expert_out_sp3_ep11_tp2_pp0 [label="Expert Out L1 SP3 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep11_tp2_pp0 -> layer_1_expert_out_sp3_ep11_tp2_pp0
	layer_1_expert_sp3_ep11_tp3_pp0 [label="Expert L1 SP3 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep11_pp0 -> layer_1_expert_sp3_ep11_tp3_pp0
	layer_1_expert_out_sp3_ep11_tp3_pp0 [label="Expert Out L1 SP3 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep11_tp3_pp0 -> layer_1_expert_out_sp3_ep11_tp3_pp0
	layer_1_expert_ar_sp3_ep11_pp0 [label="Expert All-Reduce L1 SP3 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep11_tp0_pp0 -> layer_1_expert_ar_sp3_ep11_pp0
	layer_1_expert_out_sp3_ep11_tp1_pp0 -> layer_1_expert_ar_sp3_ep11_pp0
	layer_1_expert_out_sp3_ep11_tp2_pp0 -> layer_1_expert_ar_sp3_ep11_pp0
	layer_1_expert_out_sp3_ep11_tp3_pp0 -> layer_1_expert_ar_sp3_ep11_pp0
	layer_1_combine_sp3_ep11_pp0 [label="Token Combine L1 SP3 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep11_pp0 -> layer_1_combine_sp3_ep11_pp0
	layer_1_dispatch_sp3_ep12_pp0 [label="Token Dispatch L1 SP3 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep12_pp0 [style=dashed]
	layer_1_expert_sp3_ep12_tp0_pp0 [label="Expert L1 SP3 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep12_pp0 -> layer_1_expert_sp3_ep12_tp0_pp0
	layer_1_expert_out_sp3_ep12_tp0_pp0 [label="Expert Out L1 SP3 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep12_tp0_pp0 -> layer_1_expert_out_sp3_ep12_tp0_pp0
	layer_1_expert_sp3_ep12_tp1_pp0 [label="Expert L1 SP3 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep12_pp0 -> layer_1_expert_sp3_ep12_tp1_pp0
	layer_1_expert_out_sp3_ep12_tp1_pp0 [label="Expert Out L1 SP3 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep12_tp1_pp0 -> layer_1_expert_out_sp3_ep12_tp1_pp0
	layer_1_expert_sp3_ep12_tp2_pp0 [label="Expert L1 SP3 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep12_pp0 -> layer_1_expert_sp3_ep12_tp2_pp0
	layer_1_expert_out_sp3_ep12_tp2_pp0 [label="Expert Out L1 SP3 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep12_tp2_pp0 -> layer_1_expert_out_sp3_ep12_tp2_pp0
	layer_1_expert_sp3_ep12_tp3_pp0 [label="Expert L1 SP3 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep12_pp0 -> layer_1_expert_sp3_ep12_tp3_pp0
	layer_1_expert_out_sp3_ep12_tp3_pp0 [label="Expert Out L1 SP3 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep12_tp3_pp0 -> layer_1_expert_out_sp3_ep12_tp3_pp0
	layer_1_expert_ar_sp3_ep12_pp0 [label="Expert All-Reduce L1 SP3 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep12_tp0_pp0 -> layer_1_expert_ar_sp3_ep12_pp0
	layer_1_expert_out_sp3_ep12_tp1_pp0 -> layer_1_expert_ar_sp3_ep12_pp0
	layer_1_expert_out_sp3_ep12_tp2_pp0 -> layer_1_expert_ar_sp3_ep12_pp0
	layer_1_expert_out_sp3_ep12_tp3_pp0 -> layer_1_expert_ar_sp3_ep12_pp0
	layer_1_combine_sp3_ep12_pp0 [label="Token Combine L1 SP3 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep12_pp0 -> layer_1_combine_sp3_ep12_pp0
	layer_1_dispatch_sp3_ep13_pp0 [label="Token Dispatch L1 SP3 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep13_pp0 [style=dashed]
	layer_1_expert_sp3_ep13_tp0_pp0 [label="Expert L1 SP3 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep13_pp0 -> layer_1_expert_sp3_ep13_tp0_pp0
	layer_1_expert_out_sp3_ep13_tp0_pp0 [label="Expert Out L1 SP3 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep13_tp0_pp0 -> layer_1_expert_out_sp3_ep13_tp0_pp0
	layer_1_expert_sp3_ep13_tp1_pp0 [label="Expert L1 SP3 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep13_pp0 -> layer_1_expert_sp3_ep13_tp1_pp0
	layer_1_expert_out_sp3_ep13_tp1_pp0 [label="Expert Out L1 SP3 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep13_tp1_pp0 -> layer_1_expert_out_sp3_ep13_tp1_pp0
	layer_1_expert_sp3_ep13_tp2_pp0 [label="Expert L1 SP3 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep13_pp0 -> layer_1_expert_sp3_ep13_tp2_pp0
	layer_1_expert_out_sp3_ep13_tp2_pp0 [label="Expert Out L1 SP3 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep13_tp2_pp0 -> layer_1_expert_out_sp3_ep13_tp2_pp0
	layer_1_expert_sp3_ep13_tp3_pp0 [label="Expert L1 SP3 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep13_pp0 -> layer_1_expert_sp3_ep13_tp3_pp0
	layer_1_expert_out_sp3_ep13_tp3_pp0 [label="Expert Out L1 SP3 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep13_tp3_pp0 -> layer_1_expert_out_sp3_ep13_tp3_pp0
	layer_1_expert_ar_sp3_ep13_pp0 [label="Expert All-Reduce L1 SP3 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep13_tp0_pp0 -> layer_1_expert_ar_sp3_ep13_pp0
	layer_1_expert_out_sp3_ep13_tp1_pp0 -> layer_1_expert_ar_sp3_ep13_pp0
	layer_1_expert_out_sp3_ep13_tp2_pp0 -> layer_1_expert_ar_sp3_ep13_pp0
	layer_1_expert_out_sp3_ep13_tp3_pp0 -> layer_1_expert_ar_sp3_ep13_pp0
	layer_1_combine_sp3_ep13_pp0 [label="Token Combine L1 SP3 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep13_pp0 -> layer_1_combine_sp3_ep13_pp0
	layer_1_dispatch_sp3_ep14_pp0 [label="Token Dispatch L1 SP3 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep14_pp0 [style=dashed]
	layer_1_expert_sp3_ep14_tp0_pp0 [label="Expert L1 SP3 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep14_pp0 -> layer_1_expert_sp3_ep14_tp0_pp0
	layer_1_expert_out_sp3_ep14_tp0_pp0 [label="Expert Out L1 SP3 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep14_tp0_pp0 -> layer_1_expert_out_sp3_ep14_tp0_pp0
	layer_1_expert_sp3_ep14_tp1_pp0 [label="Expert L1 SP3 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep14_pp0 -> layer_1_expert_sp3_ep14_tp1_pp0
	layer_1_expert_out_sp3_ep14_tp1_pp0 [label="Expert Out L1 SP3 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep14_tp1_pp0 -> layer_1_expert_out_sp3_ep14_tp1_pp0
	layer_1_expert_sp3_ep14_tp2_pp0 [label="Expert L1 SP3 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep14_pp0 -> layer_1_expert_sp3_ep14_tp2_pp0
	layer_1_expert_out_sp3_ep14_tp2_pp0 [label="Expert Out L1 SP3 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep14_tp2_pp0 -> layer_1_expert_out_sp3_ep14_tp2_pp0
	layer_1_expert_sp3_ep14_tp3_pp0 [label="Expert L1 SP3 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep14_pp0 -> layer_1_expert_sp3_ep14_tp3_pp0
	layer_1_expert_out_sp3_ep14_tp3_pp0 [label="Expert Out L1 SP3 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep14_tp3_pp0 -> layer_1_expert_out_sp3_ep14_tp3_pp0
	layer_1_expert_ar_sp3_ep14_pp0 [label="Expert All-Reduce L1 SP3 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep14_tp0_pp0 -> layer_1_expert_ar_sp3_ep14_pp0
	layer_1_expert_out_sp3_ep14_tp1_pp0 -> layer_1_expert_ar_sp3_ep14_pp0
	layer_1_expert_out_sp3_ep14_tp2_pp0 -> layer_1_expert_ar_sp3_ep14_pp0
	layer_1_expert_out_sp3_ep14_tp3_pp0 -> layer_1_expert_ar_sp3_ep14_pp0
	layer_1_combine_sp3_ep14_pp0 [label="Token Combine L1 SP3 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep14_pp0 -> layer_1_combine_sp3_ep14_pp0
	layer_1_dispatch_sp3_ep15_pp0 [label="Token Dispatch L1 SP3 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_1_router_sp3_pp0 -> layer_1_dispatch_sp3_ep15_pp0 [style=dashed]
	layer_1_expert_sp3_ep15_tp0_pp0 [label="Expert L1 SP3 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep15_pp0 -> layer_1_expert_sp3_ep15_tp0_pp0
	layer_1_expert_out_sp3_ep15_tp0_pp0 [label="Expert Out L1 SP3 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep15_tp0_pp0 -> layer_1_expert_out_sp3_ep15_tp0_pp0
	layer_1_expert_sp3_ep15_tp1_pp0 [label="Expert L1 SP3 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep15_pp0 -> layer_1_expert_sp3_ep15_tp1_pp0
	layer_1_expert_out_sp3_ep15_tp1_pp0 [label="Expert Out L1 SP3 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep15_tp1_pp0 -> layer_1_expert_out_sp3_ep15_tp1_pp0
	layer_1_expert_sp3_ep15_tp2_pp0 [label="Expert L1 SP3 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep15_pp0 -> layer_1_expert_sp3_ep15_tp2_pp0
	layer_1_expert_out_sp3_ep15_tp2_pp0 [label="Expert Out L1 SP3 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep15_tp2_pp0 -> layer_1_expert_out_sp3_ep15_tp2_pp0
	layer_1_expert_sp3_ep15_tp3_pp0 [label="Expert L1 SP3 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_dispatch_sp3_ep15_pp0 -> layer_1_expert_sp3_ep15_tp3_pp0
	layer_1_expert_out_sp3_ep15_tp3_pp0 [label="Expert Out L1 SP3 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_1_expert_sp3_ep15_tp3_pp0 -> layer_1_expert_out_sp3_ep15_tp3_pp0
	layer_1_expert_ar_sp3_ep15_pp0 [label="Expert All-Reduce L1 SP3 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_1_expert_out_sp3_ep15_tp0_pp0 -> layer_1_expert_ar_sp3_ep15_pp0
	layer_1_expert_out_sp3_ep15_tp1_pp0 -> layer_1_expert_ar_sp3_ep15_pp0
	layer_1_expert_out_sp3_ep15_tp2_pp0 -> layer_1_expert_ar_sp3_ep15_pp0
	layer_1_expert_out_sp3_ep15_tp3_pp0 -> layer_1_expert_ar_sp3_ep15_pp0
	layer_1_combine_sp3_ep15_pp0 [label="Token Combine L1 SP3 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_1_expert_ar_sp3_ep15_pp0 -> layer_1_combine_sp3_ep15_pp0
	layer_1_moe_all2all_sp3_pp0 [label="MoE All-to-All L1 SP3\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_1_combine_sp3_ep0_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep1_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep2_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep3_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep4_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep5_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep6_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep7_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep8_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep9_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep10_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep11_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep12_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep13_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep14_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_combine_sp3_ep15_pp0 -> layer_1_moe_all2all_sp3_pp0
	layer_1_mlp_out_sp3_pp0 [label="MoE Output L1 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_moe_all2all_sp3_pp0 -> layer_1_mlp_out_sp3_pp0
	layer_1_mlp_res_sp3_pp0 [label="MLP Residual L1 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_mlp_out_sp3_pp0 -> layer_1_mlp_res_sp3_pp0
	layer_1_attn_res_sp3_pp0 -> layer_1_mlp_res_sp3_pp0 [style=dashed]
	layer_2_norm_sp0_pp0 [label="LayerNorm L2 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_mlp_out_sp0_pp0 -> layer_2_norm_sp0_pp0
	layer_2_qkv_sp0_tp0_pp0 [label="QKV Proj L2 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp0_pp0 -> layer_2_qkv_sp0_tp0_pp0
	layer_2_attn_sp0_tp0_pp0 [label="Attention L2 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp0_tp0_pp0 -> layer_2_attn_sp0_tp0_pp0
	layer_2_attn_out_sp0_tp0_pp0 [label="Attn Out Proj L2 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp0_tp0_pp0 -> layer_2_attn_out_sp0_tp0_pp0
	layer_2_qkv_sp0_tp1_pp0 [label="QKV Proj L2 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp0_pp0 -> layer_2_qkv_sp0_tp1_pp0
	layer_2_attn_sp0_tp1_pp0 [label="Attention L2 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp0_tp1_pp0 -> layer_2_attn_sp0_tp1_pp0
	layer_2_attn_out_sp0_tp1_pp0 [label="Attn Out Proj L2 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp0_tp1_pp0 -> layer_2_attn_out_sp0_tp1_pp0
	layer_2_qkv_sp0_tp2_pp0 [label="QKV Proj L2 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp0_pp0 -> layer_2_qkv_sp0_tp2_pp0
	layer_2_attn_sp0_tp2_pp0 [label="Attention L2 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp0_tp2_pp0 -> layer_2_attn_sp0_tp2_pp0
	layer_2_attn_out_sp0_tp2_pp0 [label="Attn Out Proj L2 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp0_tp2_pp0 -> layer_2_attn_out_sp0_tp2_pp0
	layer_2_qkv_sp0_tp3_pp0 [label="QKV Proj L2 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp0_pp0 -> layer_2_qkv_sp0_tp3_pp0
	layer_2_attn_sp0_tp3_pp0 [label="Attention L2 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp0_tp3_pp0 -> layer_2_attn_sp0_tp3_pp0
	layer_2_attn_out_sp0_tp3_pp0 [label="Attn Out Proj L2 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp0_tp3_pp0 -> layer_2_attn_out_sp0_tp3_pp0
	layer_2_attn_ar_sp0_pp0 [label="Attention All-Reduce L2 SP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_attn_out_sp0_tp0_pp0 -> layer_2_attn_ar_sp0_pp0
	layer_2_attn_out_sp0_tp1_pp0 -> layer_2_attn_ar_sp0_pp0
	layer_2_attn_out_sp0_tp2_pp0 -> layer_2_attn_ar_sp0_pp0
	layer_2_attn_out_sp0_tp3_pp0 -> layer_2_attn_ar_sp0_pp0
	layer_2_attn_res_sp0_pp0 [label="Attention Residual L2 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_attn_ar_sp0_pp0 -> layer_2_attn_res_sp0_pp0
	layer_2_norm_sp0_pp0 -> layer_2_attn_res_sp0_pp0 [style=dashed]
	layer_2_post_norm_sp0_pp0 [label="Post-Attn Norm L2 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_attn_res_sp0_pp0 -> layer_2_post_norm_sp0_pp0
	layer_2_router_sp0_pp0 [label="MoE Router L2 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_2_post_norm_sp0_pp0 -> layer_2_router_sp0_pp0
	layer_2_dispatch_sp0_ep0_pp0 [label="Token Dispatch L2 SP0 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep0_pp0 [style=dashed]
	layer_2_expert_sp0_ep0_tp0_pp0 [label="Expert L2 SP0 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep0_pp0 -> layer_2_expert_sp0_ep0_tp0_pp0
	layer_2_expert_out_sp0_ep0_tp0_pp0 [label="Expert Out L2 SP0 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep0_tp0_pp0 -> layer_2_expert_out_sp0_ep0_tp0_pp0
	layer_2_expert_sp0_ep0_tp1_pp0 [label="Expert L2 SP0 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep0_pp0 -> layer_2_expert_sp0_ep0_tp1_pp0
	layer_2_expert_out_sp0_ep0_tp1_pp0 [label="Expert Out L2 SP0 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep0_tp1_pp0 -> layer_2_expert_out_sp0_ep0_tp1_pp0
	layer_2_expert_sp0_ep0_tp2_pp0 [label="Expert L2 SP0 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep0_pp0 -> layer_2_expert_sp0_ep0_tp2_pp0
	layer_2_expert_out_sp0_ep0_tp2_pp0 [label="Expert Out L2 SP0 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep0_tp2_pp0 -> layer_2_expert_out_sp0_ep0_tp2_pp0
	layer_2_expert_sp0_ep0_tp3_pp0 [label="Expert L2 SP0 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep0_pp0 -> layer_2_expert_sp0_ep0_tp3_pp0
	layer_2_expert_out_sp0_ep0_tp3_pp0 [label="Expert Out L2 SP0 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep0_tp3_pp0 -> layer_2_expert_out_sp0_ep0_tp3_pp0
	layer_2_expert_ar_sp0_ep0_pp0 [label="Expert All-Reduce L2 SP0 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep0_tp0_pp0 -> layer_2_expert_ar_sp0_ep0_pp0
	layer_2_expert_out_sp0_ep0_tp1_pp0 -> layer_2_expert_ar_sp0_ep0_pp0
	layer_2_expert_out_sp0_ep0_tp2_pp0 -> layer_2_expert_ar_sp0_ep0_pp0
	layer_2_expert_out_sp0_ep0_tp3_pp0 -> layer_2_expert_ar_sp0_ep0_pp0
	layer_2_combine_sp0_ep0_pp0 [label="Token Combine L2 SP0 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep0_pp0 -> layer_2_combine_sp0_ep0_pp0
	layer_2_dispatch_sp0_ep1_pp0 [label="Token Dispatch L2 SP0 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep1_pp0 [style=dashed]
	layer_2_expert_sp0_ep1_tp0_pp0 [label="Expert L2 SP0 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep1_pp0 -> layer_2_expert_sp0_ep1_tp0_pp0
	layer_2_expert_out_sp0_ep1_tp0_pp0 [label="Expert Out L2 SP0 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep1_tp0_pp0 -> layer_2_expert_out_sp0_ep1_tp0_pp0
	layer_2_expert_sp0_ep1_tp1_pp0 [label="Expert L2 SP0 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep1_pp0 -> layer_2_expert_sp0_ep1_tp1_pp0
	layer_2_expert_out_sp0_ep1_tp1_pp0 [label="Expert Out L2 SP0 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep1_tp1_pp0 -> layer_2_expert_out_sp0_ep1_tp1_pp0
	layer_2_expert_sp0_ep1_tp2_pp0 [label="Expert L2 SP0 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep1_pp0 -> layer_2_expert_sp0_ep1_tp2_pp0
	layer_2_expert_out_sp0_ep1_tp2_pp0 [label="Expert Out L2 SP0 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep1_tp2_pp0 -> layer_2_expert_out_sp0_ep1_tp2_pp0
	layer_2_expert_sp0_ep1_tp3_pp0 [label="Expert L2 SP0 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep1_pp0 -> layer_2_expert_sp0_ep1_tp3_pp0
	layer_2_expert_out_sp0_ep1_tp3_pp0 [label="Expert Out L2 SP0 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep1_tp3_pp0 -> layer_2_expert_out_sp0_ep1_tp3_pp0
	layer_2_expert_ar_sp0_ep1_pp0 [label="Expert All-Reduce L2 SP0 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep1_tp0_pp0 -> layer_2_expert_ar_sp0_ep1_pp0
	layer_2_expert_out_sp0_ep1_tp1_pp0 -> layer_2_expert_ar_sp0_ep1_pp0
	layer_2_expert_out_sp0_ep1_tp2_pp0 -> layer_2_expert_ar_sp0_ep1_pp0
	layer_2_expert_out_sp0_ep1_tp3_pp0 -> layer_2_expert_ar_sp0_ep1_pp0
	layer_2_combine_sp0_ep1_pp0 [label="Token Combine L2 SP0 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep1_pp0 -> layer_2_combine_sp0_ep1_pp0
	layer_2_dispatch_sp0_ep2_pp0 [label="Token Dispatch L2 SP0 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep2_pp0 [style=dashed]
	layer_2_expert_sp0_ep2_tp0_pp0 [label="Expert L2 SP0 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep2_pp0 -> layer_2_expert_sp0_ep2_tp0_pp0
	layer_2_expert_out_sp0_ep2_tp0_pp0 [label="Expert Out L2 SP0 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep2_tp0_pp0 -> layer_2_expert_out_sp0_ep2_tp0_pp0
	layer_2_expert_sp0_ep2_tp1_pp0 [label="Expert L2 SP0 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep2_pp0 -> layer_2_expert_sp0_ep2_tp1_pp0
	layer_2_expert_out_sp0_ep2_tp1_pp0 [label="Expert Out L2 SP0 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep2_tp1_pp0 -> layer_2_expert_out_sp0_ep2_tp1_pp0
	layer_2_expert_sp0_ep2_tp2_pp0 [label="Expert L2 SP0 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep2_pp0 -> layer_2_expert_sp0_ep2_tp2_pp0
	layer_2_expert_out_sp0_ep2_tp2_pp0 [label="Expert Out L2 SP0 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep2_tp2_pp0 -> layer_2_expert_out_sp0_ep2_tp2_pp0
	layer_2_expert_sp0_ep2_tp3_pp0 [label="Expert L2 SP0 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep2_pp0 -> layer_2_expert_sp0_ep2_tp3_pp0
	layer_2_expert_out_sp0_ep2_tp3_pp0 [label="Expert Out L2 SP0 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep2_tp3_pp0 -> layer_2_expert_out_sp0_ep2_tp3_pp0
	layer_2_expert_ar_sp0_ep2_pp0 [label="Expert All-Reduce L2 SP0 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep2_tp0_pp0 -> layer_2_expert_ar_sp0_ep2_pp0
	layer_2_expert_out_sp0_ep2_tp1_pp0 -> layer_2_expert_ar_sp0_ep2_pp0
	layer_2_expert_out_sp0_ep2_tp2_pp0 -> layer_2_expert_ar_sp0_ep2_pp0
	layer_2_expert_out_sp0_ep2_tp3_pp0 -> layer_2_expert_ar_sp0_ep2_pp0
	layer_2_combine_sp0_ep2_pp0 [label="Token Combine L2 SP0 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep2_pp0 -> layer_2_combine_sp0_ep2_pp0
	layer_2_dispatch_sp0_ep3_pp0 [label="Token Dispatch L2 SP0 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep3_pp0 [style=dashed]
	layer_2_expert_sp0_ep3_tp0_pp0 [label="Expert L2 SP0 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep3_pp0 -> layer_2_expert_sp0_ep3_tp0_pp0
	layer_2_expert_out_sp0_ep3_tp0_pp0 [label="Expert Out L2 SP0 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep3_tp0_pp0 -> layer_2_expert_out_sp0_ep3_tp0_pp0
	layer_2_expert_sp0_ep3_tp1_pp0 [label="Expert L2 SP0 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep3_pp0 -> layer_2_expert_sp0_ep3_tp1_pp0
	layer_2_expert_out_sp0_ep3_tp1_pp0 [label="Expert Out L2 SP0 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep3_tp1_pp0 -> layer_2_expert_out_sp0_ep3_tp1_pp0
	layer_2_expert_sp0_ep3_tp2_pp0 [label="Expert L2 SP0 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep3_pp0 -> layer_2_expert_sp0_ep3_tp2_pp0
	layer_2_expert_out_sp0_ep3_tp2_pp0 [label="Expert Out L2 SP0 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep3_tp2_pp0 -> layer_2_expert_out_sp0_ep3_tp2_pp0
	layer_2_expert_sp0_ep3_tp3_pp0 [label="Expert L2 SP0 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep3_pp0 -> layer_2_expert_sp0_ep3_tp3_pp0
	layer_2_expert_out_sp0_ep3_tp3_pp0 [label="Expert Out L2 SP0 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep3_tp3_pp0 -> layer_2_expert_out_sp0_ep3_tp3_pp0
	layer_2_expert_ar_sp0_ep3_pp0 [label="Expert All-Reduce L2 SP0 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep3_tp0_pp0 -> layer_2_expert_ar_sp0_ep3_pp0
	layer_2_expert_out_sp0_ep3_tp1_pp0 -> layer_2_expert_ar_sp0_ep3_pp0
	layer_2_expert_out_sp0_ep3_tp2_pp0 -> layer_2_expert_ar_sp0_ep3_pp0
	layer_2_expert_out_sp0_ep3_tp3_pp0 -> layer_2_expert_ar_sp0_ep3_pp0
	layer_2_combine_sp0_ep3_pp0 [label="Token Combine L2 SP0 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep3_pp0 -> layer_2_combine_sp0_ep3_pp0
	layer_2_dispatch_sp0_ep4_pp0 [label="Token Dispatch L2 SP0 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep4_pp0 [style=dashed]
	layer_2_expert_sp0_ep4_tp0_pp0 [label="Expert L2 SP0 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep4_pp0 -> layer_2_expert_sp0_ep4_tp0_pp0
	layer_2_expert_out_sp0_ep4_tp0_pp0 [label="Expert Out L2 SP0 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep4_tp0_pp0 -> layer_2_expert_out_sp0_ep4_tp0_pp0
	layer_2_expert_sp0_ep4_tp1_pp0 [label="Expert L2 SP0 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep4_pp0 -> layer_2_expert_sp0_ep4_tp1_pp0
	layer_2_expert_out_sp0_ep4_tp1_pp0 [label="Expert Out L2 SP0 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep4_tp1_pp0 -> layer_2_expert_out_sp0_ep4_tp1_pp0
	layer_2_expert_sp0_ep4_tp2_pp0 [label="Expert L2 SP0 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep4_pp0 -> layer_2_expert_sp0_ep4_tp2_pp0
	layer_2_expert_out_sp0_ep4_tp2_pp0 [label="Expert Out L2 SP0 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep4_tp2_pp0 -> layer_2_expert_out_sp0_ep4_tp2_pp0
	layer_2_expert_sp0_ep4_tp3_pp0 [label="Expert L2 SP0 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep4_pp0 -> layer_2_expert_sp0_ep4_tp3_pp0
	layer_2_expert_out_sp0_ep4_tp3_pp0 [label="Expert Out L2 SP0 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep4_tp3_pp0 -> layer_2_expert_out_sp0_ep4_tp3_pp0
	layer_2_expert_ar_sp0_ep4_pp0 [label="Expert All-Reduce L2 SP0 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep4_tp0_pp0 -> layer_2_expert_ar_sp0_ep4_pp0
	layer_2_expert_out_sp0_ep4_tp1_pp0 -> layer_2_expert_ar_sp0_ep4_pp0
	layer_2_expert_out_sp0_ep4_tp2_pp0 -> layer_2_expert_ar_sp0_ep4_pp0
	layer_2_expert_out_sp0_ep4_tp3_pp0 -> layer_2_expert_ar_sp0_ep4_pp0
	layer_2_combine_sp0_ep4_pp0 [label="Token Combine L2 SP0 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep4_pp0 -> layer_2_combine_sp0_ep4_pp0
	layer_2_dispatch_sp0_ep5_pp0 [label="Token Dispatch L2 SP0 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep5_pp0 [style=dashed]
	layer_2_expert_sp0_ep5_tp0_pp0 [label="Expert L2 SP0 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep5_pp0 -> layer_2_expert_sp0_ep5_tp0_pp0
	layer_2_expert_out_sp0_ep5_tp0_pp0 [label="Expert Out L2 SP0 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep5_tp0_pp0 -> layer_2_expert_out_sp0_ep5_tp0_pp0
	layer_2_expert_sp0_ep5_tp1_pp0 [label="Expert L2 SP0 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep5_pp0 -> layer_2_expert_sp0_ep5_tp1_pp0
	layer_2_expert_out_sp0_ep5_tp1_pp0 [label="Expert Out L2 SP0 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep5_tp1_pp0 -> layer_2_expert_out_sp0_ep5_tp1_pp0
	layer_2_expert_sp0_ep5_tp2_pp0 [label="Expert L2 SP0 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep5_pp0 -> layer_2_expert_sp0_ep5_tp2_pp0
	layer_2_expert_out_sp0_ep5_tp2_pp0 [label="Expert Out L2 SP0 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep5_tp2_pp0 -> layer_2_expert_out_sp0_ep5_tp2_pp0
	layer_2_expert_sp0_ep5_tp3_pp0 [label="Expert L2 SP0 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep5_pp0 -> layer_2_expert_sp0_ep5_tp3_pp0
	layer_2_expert_out_sp0_ep5_tp3_pp0 [label="Expert Out L2 SP0 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep5_tp3_pp0 -> layer_2_expert_out_sp0_ep5_tp3_pp0
	layer_2_expert_ar_sp0_ep5_pp0 [label="Expert All-Reduce L2 SP0 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep5_tp0_pp0 -> layer_2_expert_ar_sp0_ep5_pp0
	layer_2_expert_out_sp0_ep5_tp1_pp0 -> layer_2_expert_ar_sp0_ep5_pp0
	layer_2_expert_out_sp0_ep5_tp2_pp0 -> layer_2_expert_ar_sp0_ep5_pp0
	layer_2_expert_out_sp0_ep5_tp3_pp0 -> layer_2_expert_ar_sp0_ep5_pp0
	layer_2_combine_sp0_ep5_pp0 [label="Token Combine L2 SP0 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep5_pp0 -> layer_2_combine_sp0_ep5_pp0
	layer_2_dispatch_sp0_ep6_pp0 [label="Token Dispatch L2 SP0 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep6_pp0 [style=dashed]
	layer_2_expert_sp0_ep6_tp0_pp0 [label="Expert L2 SP0 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep6_pp0 -> layer_2_expert_sp0_ep6_tp0_pp0
	layer_2_expert_out_sp0_ep6_tp0_pp0 [label="Expert Out L2 SP0 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep6_tp0_pp0 -> layer_2_expert_out_sp0_ep6_tp0_pp0
	layer_2_expert_sp0_ep6_tp1_pp0 [label="Expert L2 SP0 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep6_pp0 -> layer_2_expert_sp0_ep6_tp1_pp0
	layer_2_expert_out_sp0_ep6_tp1_pp0 [label="Expert Out L2 SP0 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep6_tp1_pp0 -> layer_2_expert_out_sp0_ep6_tp1_pp0
	layer_2_expert_sp0_ep6_tp2_pp0 [label="Expert L2 SP0 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep6_pp0 -> layer_2_expert_sp0_ep6_tp2_pp0
	layer_2_expert_out_sp0_ep6_tp2_pp0 [label="Expert Out L2 SP0 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep6_tp2_pp0 -> layer_2_expert_out_sp0_ep6_tp2_pp0
	layer_2_expert_sp0_ep6_tp3_pp0 [label="Expert L2 SP0 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep6_pp0 -> layer_2_expert_sp0_ep6_tp3_pp0
	layer_2_expert_out_sp0_ep6_tp3_pp0 [label="Expert Out L2 SP0 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep6_tp3_pp0 -> layer_2_expert_out_sp0_ep6_tp3_pp0
	layer_2_expert_ar_sp0_ep6_pp0 [label="Expert All-Reduce L2 SP0 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep6_tp0_pp0 -> layer_2_expert_ar_sp0_ep6_pp0
	layer_2_expert_out_sp0_ep6_tp1_pp0 -> layer_2_expert_ar_sp0_ep6_pp0
	layer_2_expert_out_sp0_ep6_tp2_pp0 -> layer_2_expert_ar_sp0_ep6_pp0
	layer_2_expert_out_sp0_ep6_tp3_pp0 -> layer_2_expert_ar_sp0_ep6_pp0
	layer_2_combine_sp0_ep6_pp0 [label="Token Combine L2 SP0 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep6_pp0 -> layer_2_combine_sp0_ep6_pp0
	layer_2_dispatch_sp0_ep7_pp0 [label="Token Dispatch L2 SP0 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep7_pp0 [style=dashed]
	layer_2_expert_sp0_ep7_tp0_pp0 [label="Expert L2 SP0 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep7_pp0 -> layer_2_expert_sp0_ep7_tp0_pp0
	layer_2_expert_out_sp0_ep7_tp0_pp0 [label="Expert Out L2 SP0 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep7_tp0_pp0 -> layer_2_expert_out_sp0_ep7_tp0_pp0
	layer_2_expert_sp0_ep7_tp1_pp0 [label="Expert L2 SP0 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep7_pp0 -> layer_2_expert_sp0_ep7_tp1_pp0
	layer_2_expert_out_sp0_ep7_tp1_pp0 [label="Expert Out L2 SP0 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep7_tp1_pp0 -> layer_2_expert_out_sp0_ep7_tp1_pp0
	layer_2_expert_sp0_ep7_tp2_pp0 [label="Expert L2 SP0 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep7_pp0 -> layer_2_expert_sp0_ep7_tp2_pp0
	layer_2_expert_out_sp0_ep7_tp2_pp0 [label="Expert Out L2 SP0 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep7_tp2_pp0 -> layer_2_expert_out_sp0_ep7_tp2_pp0
	layer_2_expert_sp0_ep7_tp3_pp0 [label="Expert L2 SP0 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep7_pp0 -> layer_2_expert_sp0_ep7_tp3_pp0
	layer_2_expert_out_sp0_ep7_tp3_pp0 [label="Expert Out L2 SP0 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep7_tp3_pp0 -> layer_2_expert_out_sp0_ep7_tp3_pp0
	layer_2_expert_ar_sp0_ep7_pp0 [label="Expert All-Reduce L2 SP0 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep7_tp0_pp0 -> layer_2_expert_ar_sp0_ep7_pp0
	layer_2_expert_out_sp0_ep7_tp1_pp0 -> layer_2_expert_ar_sp0_ep7_pp0
	layer_2_expert_out_sp0_ep7_tp2_pp0 -> layer_2_expert_ar_sp0_ep7_pp0
	layer_2_expert_out_sp0_ep7_tp3_pp0 -> layer_2_expert_ar_sp0_ep7_pp0
	layer_2_combine_sp0_ep7_pp0 [label="Token Combine L2 SP0 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep7_pp0 -> layer_2_combine_sp0_ep7_pp0
	layer_2_dispatch_sp0_ep8_pp0 [label="Token Dispatch L2 SP0 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep8_pp0 [style=dashed]
	layer_2_expert_sp0_ep8_tp0_pp0 [label="Expert L2 SP0 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep8_pp0 -> layer_2_expert_sp0_ep8_tp0_pp0
	layer_2_expert_out_sp0_ep8_tp0_pp0 [label="Expert Out L2 SP0 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep8_tp0_pp0 -> layer_2_expert_out_sp0_ep8_tp0_pp0
	layer_2_expert_sp0_ep8_tp1_pp0 [label="Expert L2 SP0 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep8_pp0 -> layer_2_expert_sp0_ep8_tp1_pp0
	layer_2_expert_out_sp0_ep8_tp1_pp0 [label="Expert Out L2 SP0 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep8_tp1_pp0 -> layer_2_expert_out_sp0_ep8_tp1_pp0
	layer_2_expert_sp0_ep8_tp2_pp0 [label="Expert L2 SP0 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep8_pp0 -> layer_2_expert_sp0_ep8_tp2_pp0
	layer_2_expert_out_sp0_ep8_tp2_pp0 [label="Expert Out L2 SP0 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep8_tp2_pp0 -> layer_2_expert_out_sp0_ep8_tp2_pp0
	layer_2_expert_sp0_ep8_tp3_pp0 [label="Expert L2 SP0 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep8_pp0 -> layer_2_expert_sp0_ep8_tp3_pp0
	layer_2_expert_out_sp0_ep8_tp3_pp0 [label="Expert Out L2 SP0 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep8_tp3_pp0 -> layer_2_expert_out_sp0_ep8_tp3_pp0
	layer_2_expert_ar_sp0_ep8_pp0 [label="Expert All-Reduce L2 SP0 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep8_tp0_pp0 -> layer_2_expert_ar_sp0_ep8_pp0
	layer_2_expert_out_sp0_ep8_tp1_pp0 -> layer_2_expert_ar_sp0_ep8_pp0
	layer_2_expert_out_sp0_ep8_tp2_pp0 -> layer_2_expert_ar_sp0_ep8_pp0
	layer_2_expert_out_sp0_ep8_tp3_pp0 -> layer_2_expert_ar_sp0_ep8_pp0
	layer_2_combine_sp0_ep8_pp0 [label="Token Combine L2 SP0 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep8_pp0 -> layer_2_combine_sp0_ep8_pp0
	layer_2_dispatch_sp0_ep9_pp0 [label="Token Dispatch L2 SP0 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep9_pp0 [style=dashed]
	layer_2_expert_sp0_ep9_tp0_pp0 [label="Expert L2 SP0 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep9_pp0 -> layer_2_expert_sp0_ep9_tp0_pp0
	layer_2_expert_out_sp0_ep9_tp0_pp0 [label="Expert Out L2 SP0 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep9_tp0_pp0 -> layer_2_expert_out_sp0_ep9_tp0_pp0
	layer_2_expert_sp0_ep9_tp1_pp0 [label="Expert L2 SP0 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep9_pp0 -> layer_2_expert_sp0_ep9_tp1_pp0
	layer_2_expert_out_sp0_ep9_tp1_pp0 [label="Expert Out L2 SP0 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep9_tp1_pp0 -> layer_2_expert_out_sp0_ep9_tp1_pp0
	layer_2_expert_sp0_ep9_tp2_pp0 [label="Expert L2 SP0 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep9_pp0 -> layer_2_expert_sp0_ep9_tp2_pp0
	layer_2_expert_out_sp0_ep9_tp2_pp0 [label="Expert Out L2 SP0 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep9_tp2_pp0 -> layer_2_expert_out_sp0_ep9_tp2_pp0
	layer_2_expert_sp0_ep9_tp3_pp0 [label="Expert L2 SP0 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep9_pp0 -> layer_2_expert_sp0_ep9_tp3_pp0
	layer_2_expert_out_sp0_ep9_tp3_pp0 [label="Expert Out L2 SP0 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep9_tp3_pp0 -> layer_2_expert_out_sp0_ep9_tp3_pp0
	layer_2_expert_ar_sp0_ep9_pp0 [label="Expert All-Reduce L2 SP0 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep9_tp0_pp0 -> layer_2_expert_ar_sp0_ep9_pp0
	layer_2_expert_out_sp0_ep9_tp1_pp0 -> layer_2_expert_ar_sp0_ep9_pp0
	layer_2_expert_out_sp0_ep9_tp2_pp0 -> layer_2_expert_ar_sp0_ep9_pp0
	layer_2_expert_out_sp0_ep9_tp3_pp0 -> layer_2_expert_ar_sp0_ep9_pp0
	layer_2_combine_sp0_ep9_pp0 [label="Token Combine L2 SP0 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep9_pp0 -> layer_2_combine_sp0_ep9_pp0
	layer_2_dispatch_sp0_ep10_pp0 [label="Token Dispatch L2 SP0 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep10_pp0 [style=dashed]
	layer_2_expert_sp0_ep10_tp0_pp0 [label="Expert L2 SP0 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep10_pp0 -> layer_2_expert_sp0_ep10_tp0_pp0
	layer_2_expert_out_sp0_ep10_tp0_pp0 [label="Expert Out L2 SP0 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep10_tp0_pp0 -> layer_2_expert_out_sp0_ep10_tp0_pp0
	layer_2_expert_sp0_ep10_tp1_pp0 [label="Expert L2 SP0 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep10_pp0 -> layer_2_expert_sp0_ep10_tp1_pp0
	layer_2_expert_out_sp0_ep10_tp1_pp0 [label="Expert Out L2 SP0 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep10_tp1_pp0 -> layer_2_expert_out_sp0_ep10_tp1_pp0
	layer_2_expert_sp0_ep10_tp2_pp0 [label="Expert L2 SP0 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep10_pp0 -> layer_2_expert_sp0_ep10_tp2_pp0
	layer_2_expert_out_sp0_ep10_tp2_pp0 [label="Expert Out L2 SP0 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep10_tp2_pp0 -> layer_2_expert_out_sp0_ep10_tp2_pp0
	layer_2_expert_sp0_ep10_tp3_pp0 [label="Expert L2 SP0 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep10_pp0 -> layer_2_expert_sp0_ep10_tp3_pp0
	layer_2_expert_out_sp0_ep10_tp3_pp0 [label="Expert Out L2 SP0 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep10_tp3_pp0 -> layer_2_expert_out_sp0_ep10_tp3_pp0
	layer_2_expert_ar_sp0_ep10_pp0 [label="Expert All-Reduce L2 SP0 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep10_tp0_pp0 -> layer_2_expert_ar_sp0_ep10_pp0
	layer_2_expert_out_sp0_ep10_tp1_pp0 -> layer_2_expert_ar_sp0_ep10_pp0
	layer_2_expert_out_sp0_ep10_tp2_pp0 -> layer_2_expert_ar_sp0_ep10_pp0
	layer_2_expert_out_sp0_ep10_tp3_pp0 -> layer_2_expert_ar_sp0_ep10_pp0
	layer_2_combine_sp0_ep10_pp0 [label="Token Combine L2 SP0 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep10_pp0 -> layer_2_combine_sp0_ep10_pp0
	layer_2_dispatch_sp0_ep11_pp0 [label="Token Dispatch L2 SP0 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep11_pp0 [style=dashed]
	layer_2_expert_sp0_ep11_tp0_pp0 [label="Expert L2 SP0 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep11_pp0 -> layer_2_expert_sp0_ep11_tp0_pp0
	layer_2_expert_out_sp0_ep11_tp0_pp0 [label="Expert Out L2 SP0 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep11_tp0_pp0 -> layer_2_expert_out_sp0_ep11_tp0_pp0
	layer_2_expert_sp0_ep11_tp1_pp0 [label="Expert L2 SP0 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep11_pp0 -> layer_2_expert_sp0_ep11_tp1_pp0
	layer_2_expert_out_sp0_ep11_tp1_pp0 [label="Expert Out L2 SP0 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep11_tp1_pp0 -> layer_2_expert_out_sp0_ep11_tp1_pp0
	layer_2_expert_sp0_ep11_tp2_pp0 [label="Expert L2 SP0 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep11_pp0 -> layer_2_expert_sp0_ep11_tp2_pp0
	layer_2_expert_out_sp0_ep11_tp2_pp0 [label="Expert Out L2 SP0 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep11_tp2_pp0 -> layer_2_expert_out_sp0_ep11_tp2_pp0
	layer_2_expert_sp0_ep11_tp3_pp0 [label="Expert L2 SP0 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep11_pp0 -> layer_2_expert_sp0_ep11_tp3_pp0
	layer_2_expert_out_sp0_ep11_tp3_pp0 [label="Expert Out L2 SP0 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep11_tp3_pp0 -> layer_2_expert_out_sp0_ep11_tp3_pp0
	layer_2_expert_ar_sp0_ep11_pp0 [label="Expert All-Reduce L2 SP0 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep11_tp0_pp0 -> layer_2_expert_ar_sp0_ep11_pp0
	layer_2_expert_out_sp0_ep11_tp1_pp0 -> layer_2_expert_ar_sp0_ep11_pp0
	layer_2_expert_out_sp0_ep11_tp2_pp0 -> layer_2_expert_ar_sp0_ep11_pp0
	layer_2_expert_out_sp0_ep11_tp3_pp0 -> layer_2_expert_ar_sp0_ep11_pp0
	layer_2_combine_sp0_ep11_pp0 [label="Token Combine L2 SP0 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep11_pp0 -> layer_2_combine_sp0_ep11_pp0
	layer_2_dispatch_sp0_ep12_pp0 [label="Token Dispatch L2 SP0 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep12_pp0 [style=dashed]
	layer_2_expert_sp0_ep12_tp0_pp0 [label="Expert L2 SP0 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep12_pp0 -> layer_2_expert_sp0_ep12_tp0_pp0
	layer_2_expert_out_sp0_ep12_tp0_pp0 [label="Expert Out L2 SP0 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep12_tp0_pp0 -> layer_2_expert_out_sp0_ep12_tp0_pp0
	layer_2_expert_sp0_ep12_tp1_pp0 [label="Expert L2 SP0 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep12_pp0 -> layer_2_expert_sp0_ep12_tp1_pp0
	layer_2_expert_out_sp0_ep12_tp1_pp0 [label="Expert Out L2 SP0 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep12_tp1_pp0 -> layer_2_expert_out_sp0_ep12_tp1_pp0
	layer_2_expert_sp0_ep12_tp2_pp0 [label="Expert L2 SP0 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep12_pp0 -> layer_2_expert_sp0_ep12_tp2_pp0
	layer_2_expert_out_sp0_ep12_tp2_pp0 [label="Expert Out L2 SP0 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep12_tp2_pp0 -> layer_2_expert_out_sp0_ep12_tp2_pp0
	layer_2_expert_sp0_ep12_tp3_pp0 [label="Expert L2 SP0 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep12_pp0 -> layer_2_expert_sp0_ep12_tp3_pp0
	layer_2_expert_out_sp0_ep12_tp3_pp0 [label="Expert Out L2 SP0 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep12_tp3_pp0 -> layer_2_expert_out_sp0_ep12_tp3_pp0
	layer_2_expert_ar_sp0_ep12_pp0 [label="Expert All-Reduce L2 SP0 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep12_tp0_pp0 -> layer_2_expert_ar_sp0_ep12_pp0
	layer_2_expert_out_sp0_ep12_tp1_pp0 -> layer_2_expert_ar_sp0_ep12_pp0
	layer_2_expert_out_sp0_ep12_tp2_pp0 -> layer_2_expert_ar_sp0_ep12_pp0
	layer_2_expert_out_sp0_ep12_tp3_pp0 -> layer_2_expert_ar_sp0_ep12_pp0
	layer_2_combine_sp0_ep12_pp0 [label="Token Combine L2 SP0 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep12_pp0 -> layer_2_combine_sp0_ep12_pp0
	layer_2_dispatch_sp0_ep13_pp0 [label="Token Dispatch L2 SP0 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep13_pp0 [style=dashed]
	layer_2_expert_sp0_ep13_tp0_pp0 [label="Expert L2 SP0 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep13_pp0 -> layer_2_expert_sp0_ep13_tp0_pp0
	layer_2_expert_out_sp0_ep13_tp0_pp0 [label="Expert Out L2 SP0 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep13_tp0_pp0 -> layer_2_expert_out_sp0_ep13_tp0_pp0
	layer_2_expert_sp0_ep13_tp1_pp0 [label="Expert L2 SP0 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep13_pp0 -> layer_2_expert_sp0_ep13_tp1_pp0
	layer_2_expert_out_sp0_ep13_tp1_pp0 [label="Expert Out L2 SP0 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep13_tp1_pp0 -> layer_2_expert_out_sp0_ep13_tp1_pp0
	layer_2_expert_sp0_ep13_tp2_pp0 [label="Expert L2 SP0 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep13_pp0 -> layer_2_expert_sp0_ep13_tp2_pp0
	layer_2_expert_out_sp0_ep13_tp2_pp0 [label="Expert Out L2 SP0 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep13_tp2_pp0 -> layer_2_expert_out_sp0_ep13_tp2_pp0
	layer_2_expert_sp0_ep13_tp3_pp0 [label="Expert L2 SP0 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep13_pp0 -> layer_2_expert_sp0_ep13_tp3_pp0
	layer_2_expert_out_sp0_ep13_tp3_pp0 [label="Expert Out L2 SP0 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep13_tp3_pp0 -> layer_2_expert_out_sp0_ep13_tp3_pp0
	layer_2_expert_ar_sp0_ep13_pp0 [label="Expert All-Reduce L2 SP0 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep13_tp0_pp0 -> layer_2_expert_ar_sp0_ep13_pp0
	layer_2_expert_out_sp0_ep13_tp1_pp0 -> layer_2_expert_ar_sp0_ep13_pp0
	layer_2_expert_out_sp0_ep13_tp2_pp0 -> layer_2_expert_ar_sp0_ep13_pp0
	layer_2_expert_out_sp0_ep13_tp3_pp0 -> layer_2_expert_ar_sp0_ep13_pp0
	layer_2_combine_sp0_ep13_pp0 [label="Token Combine L2 SP0 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep13_pp0 -> layer_2_combine_sp0_ep13_pp0
	layer_2_dispatch_sp0_ep14_pp0 [label="Token Dispatch L2 SP0 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep14_pp0 [style=dashed]
	layer_2_expert_sp0_ep14_tp0_pp0 [label="Expert L2 SP0 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep14_pp0 -> layer_2_expert_sp0_ep14_tp0_pp0
	layer_2_expert_out_sp0_ep14_tp0_pp0 [label="Expert Out L2 SP0 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep14_tp0_pp0 -> layer_2_expert_out_sp0_ep14_tp0_pp0
	layer_2_expert_sp0_ep14_tp1_pp0 [label="Expert L2 SP0 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep14_pp0 -> layer_2_expert_sp0_ep14_tp1_pp0
	layer_2_expert_out_sp0_ep14_tp1_pp0 [label="Expert Out L2 SP0 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep14_tp1_pp0 -> layer_2_expert_out_sp0_ep14_tp1_pp0
	layer_2_expert_sp0_ep14_tp2_pp0 [label="Expert L2 SP0 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep14_pp0 -> layer_2_expert_sp0_ep14_tp2_pp0
	layer_2_expert_out_sp0_ep14_tp2_pp0 [label="Expert Out L2 SP0 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep14_tp2_pp0 -> layer_2_expert_out_sp0_ep14_tp2_pp0
	layer_2_expert_sp0_ep14_tp3_pp0 [label="Expert L2 SP0 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep14_pp0 -> layer_2_expert_sp0_ep14_tp3_pp0
	layer_2_expert_out_sp0_ep14_tp3_pp0 [label="Expert Out L2 SP0 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep14_tp3_pp0 -> layer_2_expert_out_sp0_ep14_tp3_pp0
	layer_2_expert_ar_sp0_ep14_pp0 [label="Expert All-Reduce L2 SP0 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep14_tp0_pp0 -> layer_2_expert_ar_sp0_ep14_pp0
	layer_2_expert_out_sp0_ep14_tp1_pp0 -> layer_2_expert_ar_sp0_ep14_pp0
	layer_2_expert_out_sp0_ep14_tp2_pp0 -> layer_2_expert_ar_sp0_ep14_pp0
	layer_2_expert_out_sp0_ep14_tp3_pp0 -> layer_2_expert_ar_sp0_ep14_pp0
	layer_2_combine_sp0_ep14_pp0 [label="Token Combine L2 SP0 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep14_pp0 -> layer_2_combine_sp0_ep14_pp0
	layer_2_dispatch_sp0_ep15_pp0 [label="Token Dispatch L2 SP0 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp0_pp0 -> layer_2_dispatch_sp0_ep15_pp0 [style=dashed]
	layer_2_expert_sp0_ep15_tp0_pp0 [label="Expert L2 SP0 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep15_pp0 -> layer_2_expert_sp0_ep15_tp0_pp0
	layer_2_expert_out_sp0_ep15_tp0_pp0 [label="Expert Out L2 SP0 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep15_tp0_pp0 -> layer_2_expert_out_sp0_ep15_tp0_pp0
	layer_2_expert_sp0_ep15_tp1_pp0 [label="Expert L2 SP0 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep15_pp0 -> layer_2_expert_sp0_ep15_tp1_pp0
	layer_2_expert_out_sp0_ep15_tp1_pp0 [label="Expert Out L2 SP0 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep15_tp1_pp0 -> layer_2_expert_out_sp0_ep15_tp1_pp0
	layer_2_expert_sp0_ep15_tp2_pp0 [label="Expert L2 SP0 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep15_pp0 -> layer_2_expert_sp0_ep15_tp2_pp0
	layer_2_expert_out_sp0_ep15_tp2_pp0 [label="Expert Out L2 SP0 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep15_tp2_pp0 -> layer_2_expert_out_sp0_ep15_tp2_pp0
	layer_2_expert_sp0_ep15_tp3_pp0 [label="Expert L2 SP0 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp0_ep15_pp0 -> layer_2_expert_sp0_ep15_tp3_pp0
	layer_2_expert_out_sp0_ep15_tp3_pp0 [label="Expert Out L2 SP0 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp0_ep15_tp3_pp0 -> layer_2_expert_out_sp0_ep15_tp3_pp0
	layer_2_expert_ar_sp0_ep15_pp0 [label="Expert All-Reduce L2 SP0 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp0_ep15_tp0_pp0 -> layer_2_expert_ar_sp0_ep15_pp0
	layer_2_expert_out_sp0_ep15_tp1_pp0 -> layer_2_expert_ar_sp0_ep15_pp0
	layer_2_expert_out_sp0_ep15_tp2_pp0 -> layer_2_expert_ar_sp0_ep15_pp0
	layer_2_expert_out_sp0_ep15_tp3_pp0 -> layer_2_expert_ar_sp0_ep15_pp0
	layer_2_combine_sp0_ep15_pp0 [label="Token Combine L2 SP0 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp0_ep15_pp0 -> layer_2_combine_sp0_ep15_pp0
	layer_2_moe_all2all_sp0_pp0 [label="MoE All-to-All L2 SP0\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_2_combine_sp0_ep0_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep1_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep2_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep3_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep4_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep5_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep6_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep7_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep8_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep9_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep10_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep11_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep12_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep13_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep14_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_combine_sp0_ep15_pp0 -> layer_2_moe_all2all_sp0_pp0
	layer_2_mlp_out_sp0_pp0 [label="MoE Output L2 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_moe_all2all_sp0_pp0 -> layer_2_mlp_out_sp0_pp0
	layer_2_mlp_res_sp0_pp0 [label="MLP Residual L2 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_mlp_out_sp0_pp0 -> layer_2_mlp_res_sp0_pp0
	layer_2_attn_res_sp0_pp0 -> layer_2_mlp_res_sp0_pp0 [style=dashed]
	layer_2_norm_sp1_pp0 [label="LayerNorm L2 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_mlp_out_sp1_pp0 -> layer_2_norm_sp1_pp0
	layer_2_qkv_sp1_tp0_pp0 [label="QKV Proj L2 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp1_pp0 -> layer_2_qkv_sp1_tp0_pp0
	layer_2_attn_sp1_tp0_pp0 [label="Attention L2 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp1_tp0_pp0 -> layer_2_attn_sp1_tp0_pp0
	layer_2_attn_out_sp1_tp0_pp0 [label="Attn Out Proj L2 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp1_tp0_pp0 -> layer_2_attn_out_sp1_tp0_pp0
	layer_2_qkv_sp1_tp1_pp0 [label="QKV Proj L2 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp1_pp0 -> layer_2_qkv_sp1_tp1_pp0
	layer_2_attn_sp1_tp1_pp0 [label="Attention L2 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp1_tp1_pp0 -> layer_2_attn_sp1_tp1_pp0
	layer_2_attn_out_sp1_tp1_pp0 [label="Attn Out Proj L2 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp1_tp1_pp0 -> layer_2_attn_out_sp1_tp1_pp0
	layer_2_qkv_sp1_tp2_pp0 [label="QKV Proj L2 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp1_pp0 -> layer_2_qkv_sp1_tp2_pp0
	layer_2_attn_sp1_tp2_pp0 [label="Attention L2 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp1_tp2_pp0 -> layer_2_attn_sp1_tp2_pp0
	layer_2_attn_out_sp1_tp2_pp0 [label="Attn Out Proj L2 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp1_tp2_pp0 -> layer_2_attn_out_sp1_tp2_pp0
	layer_2_qkv_sp1_tp3_pp0 [label="QKV Proj L2 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp1_pp0 -> layer_2_qkv_sp1_tp3_pp0
	layer_2_attn_sp1_tp3_pp0 [label="Attention L2 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp1_tp3_pp0 -> layer_2_attn_sp1_tp3_pp0
	layer_2_attn_out_sp1_tp3_pp0 [label="Attn Out Proj L2 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp1_tp3_pp0 -> layer_2_attn_out_sp1_tp3_pp0
	layer_2_attn_ar_sp1_pp0 [label="Attention All-Reduce L2 SP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_attn_out_sp1_tp0_pp0 -> layer_2_attn_ar_sp1_pp0
	layer_2_attn_out_sp1_tp1_pp0 -> layer_2_attn_ar_sp1_pp0
	layer_2_attn_out_sp1_tp2_pp0 -> layer_2_attn_ar_sp1_pp0
	layer_2_attn_out_sp1_tp3_pp0 -> layer_2_attn_ar_sp1_pp0
	layer_2_attn_res_sp1_pp0 [label="Attention Residual L2 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_attn_ar_sp1_pp0 -> layer_2_attn_res_sp1_pp0
	layer_2_norm_sp1_pp0 -> layer_2_attn_res_sp1_pp0 [style=dashed]
	layer_2_post_norm_sp1_pp0 [label="Post-Attn Norm L2 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_attn_res_sp1_pp0 -> layer_2_post_norm_sp1_pp0
	layer_2_router_sp1_pp0 [label="MoE Router L2 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_2_post_norm_sp1_pp0 -> layer_2_router_sp1_pp0
	layer_2_dispatch_sp1_ep0_pp0 [label="Token Dispatch L2 SP1 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep0_pp0 [style=dashed]
	layer_2_expert_sp1_ep0_tp0_pp0 [label="Expert L2 SP1 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep0_pp0 -> layer_2_expert_sp1_ep0_tp0_pp0
	layer_2_expert_out_sp1_ep0_tp0_pp0 [label="Expert Out L2 SP1 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep0_tp0_pp0 -> layer_2_expert_out_sp1_ep0_tp0_pp0
	layer_2_expert_sp1_ep0_tp1_pp0 [label="Expert L2 SP1 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep0_pp0 -> layer_2_expert_sp1_ep0_tp1_pp0
	layer_2_expert_out_sp1_ep0_tp1_pp0 [label="Expert Out L2 SP1 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep0_tp1_pp0 -> layer_2_expert_out_sp1_ep0_tp1_pp0
	layer_2_expert_sp1_ep0_tp2_pp0 [label="Expert L2 SP1 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep0_pp0 -> layer_2_expert_sp1_ep0_tp2_pp0
	layer_2_expert_out_sp1_ep0_tp2_pp0 [label="Expert Out L2 SP1 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep0_tp2_pp0 -> layer_2_expert_out_sp1_ep0_tp2_pp0
	layer_2_expert_sp1_ep0_tp3_pp0 [label="Expert L2 SP1 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep0_pp0 -> layer_2_expert_sp1_ep0_tp3_pp0
	layer_2_expert_out_sp1_ep0_tp3_pp0 [label="Expert Out L2 SP1 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep0_tp3_pp0 -> layer_2_expert_out_sp1_ep0_tp3_pp0
	layer_2_expert_ar_sp1_ep0_pp0 [label="Expert All-Reduce L2 SP1 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep0_tp0_pp0 -> layer_2_expert_ar_sp1_ep0_pp0
	layer_2_expert_out_sp1_ep0_tp1_pp0 -> layer_2_expert_ar_sp1_ep0_pp0
	layer_2_expert_out_sp1_ep0_tp2_pp0 -> layer_2_expert_ar_sp1_ep0_pp0
	layer_2_expert_out_sp1_ep0_tp3_pp0 -> layer_2_expert_ar_sp1_ep0_pp0
	layer_2_combine_sp1_ep0_pp0 [label="Token Combine L2 SP1 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep0_pp0 -> layer_2_combine_sp1_ep0_pp0
	layer_2_dispatch_sp1_ep1_pp0 [label="Token Dispatch L2 SP1 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep1_pp0 [style=dashed]
	layer_2_expert_sp1_ep1_tp0_pp0 [label="Expert L2 SP1 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep1_pp0 -> layer_2_expert_sp1_ep1_tp0_pp0
	layer_2_expert_out_sp1_ep1_tp0_pp0 [label="Expert Out L2 SP1 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep1_tp0_pp0 -> layer_2_expert_out_sp1_ep1_tp0_pp0
	layer_2_expert_sp1_ep1_tp1_pp0 [label="Expert L2 SP1 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep1_pp0 -> layer_2_expert_sp1_ep1_tp1_pp0
	layer_2_expert_out_sp1_ep1_tp1_pp0 [label="Expert Out L2 SP1 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep1_tp1_pp0 -> layer_2_expert_out_sp1_ep1_tp1_pp0
	layer_2_expert_sp1_ep1_tp2_pp0 [label="Expert L2 SP1 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep1_pp0 -> layer_2_expert_sp1_ep1_tp2_pp0
	layer_2_expert_out_sp1_ep1_tp2_pp0 [label="Expert Out L2 SP1 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep1_tp2_pp0 -> layer_2_expert_out_sp1_ep1_tp2_pp0
	layer_2_expert_sp1_ep1_tp3_pp0 [label="Expert L2 SP1 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep1_pp0 -> layer_2_expert_sp1_ep1_tp3_pp0
	layer_2_expert_out_sp1_ep1_tp3_pp0 [label="Expert Out L2 SP1 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep1_tp3_pp0 -> layer_2_expert_out_sp1_ep1_tp3_pp0
	layer_2_expert_ar_sp1_ep1_pp0 [label="Expert All-Reduce L2 SP1 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep1_tp0_pp0 -> layer_2_expert_ar_sp1_ep1_pp0
	layer_2_expert_out_sp1_ep1_tp1_pp0 -> layer_2_expert_ar_sp1_ep1_pp0
	layer_2_expert_out_sp1_ep1_tp2_pp0 -> layer_2_expert_ar_sp1_ep1_pp0
	layer_2_expert_out_sp1_ep1_tp3_pp0 -> layer_2_expert_ar_sp1_ep1_pp0
	layer_2_combine_sp1_ep1_pp0 [label="Token Combine L2 SP1 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep1_pp0 -> layer_2_combine_sp1_ep1_pp0
	layer_2_dispatch_sp1_ep2_pp0 [label="Token Dispatch L2 SP1 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep2_pp0 [style=dashed]
	layer_2_expert_sp1_ep2_tp0_pp0 [label="Expert L2 SP1 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep2_pp0 -> layer_2_expert_sp1_ep2_tp0_pp0
	layer_2_expert_out_sp1_ep2_tp0_pp0 [label="Expert Out L2 SP1 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep2_tp0_pp0 -> layer_2_expert_out_sp1_ep2_tp0_pp0
	layer_2_expert_sp1_ep2_tp1_pp0 [label="Expert L2 SP1 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep2_pp0 -> layer_2_expert_sp1_ep2_tp1_pp0
	layer_2_expert_out_sp1_ep2_tp1_pp0 [label="Expert Out L2 SP1 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep2_tp1_pp0 -> layer_2_expert_out_sp1_ep2_tp1_pp0
	layer_2_expert_sp1_ep2_tp2_pp0 [label="Expert L2 SP1 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep2_pp0 -> layer_2_expert_sp1_ep2_tp2_pp0
	layer_2_expert_out_sp1_ep2_tp2_pp0 [label="Expert Out L2 SP1 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep2_tp2_pp0 -> layer_2_expert_out_sp1_ep2_tp2_pp0
	layer_2_expert_sp1_ep2_tp3_pp0 [label="Expert L2 SP1 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep2_pp0 -> layer_2_expert_sp1_ep2_tp3_pp0
	layer_2_expert_out_sp1_ep2_tp3_pp0 [label="Expert Out L2 SP1 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep2_tp3_pp0 -> layer_2_expert_out_sp1_ep2_tp3_pp0
	layer_2_expert_ar_sp1_ep2_pp0 [label="Expert All-Reduce L2 SP1 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep2_tp0_pp0 -> layer_2_expert_ar_sp1_ep2_pp0
	layer_2_expert_out_sp1_ep2_tp1_pp0 -> layer_2_expert_ar_sp1_ep2_pp0
	layer_2_expert_out_sp1_ep2_tp2_pp0 -> layer_2_expert_ar_sp1_ep2_pp0
	layer_2_expert_out_sp1_ep2_tp3_pp0 -> layer_2_expert_ar_sp1_ep2_pp0
	layer_2_combine_sp1_ep2_pp0 [label="Token Combine L2 SP1 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep2_pp0 -> layer_2_combine_sp1_ep2_pp0
	layer_2_dispatch_sp1_ep3_pp0 [label="Token Dispatch L2 SP1 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep3_pp0 [style=dashed]
	layer_2_expert_sp1_ep3_tp0_pp0 [label="Expert L2 SP1 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep3_pp0 -> layer_2_expert_sp1_ep3_tp0_pp0
	layer_2_expert_out_sp1_ep3_tp0_pp0 [label="Expert Out L2 SP1 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep3_tp0_pp0 -> layer_2_expert_out_sp1_ep3_tp0_pp0
	layer_2_expert_sp1_ep3_tp1_pp0 [label="Expert L2 SP1 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep3_pp0 -> layer_2_expert_sp1_ep3_tp1_pp0
	layer_2_expert_out_sp1_ep3_tp1_pp0 [label="Expert Out L2 SP1 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep3_tp1_pp0 -> layer_2_expert_out_sp1_ep3_tp1_pp0
	layer_2_expert_sp1_ep3_tp2_pp0 [label="Expert L2 SP1 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep3_pp0 -> layer_2_expert_sp1_ep3_tp2_pp0
	layer_2_expert_out_sp1_ep3_tp2_pp0 [label="Expert Out L2 SP1 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep3_tp2_pp0 -> layer_2_expert_out_sp1_ep3_tp2_pp0
	layer_2_expert_sp1_ep3_tp3_pp0 [label="Expert L2 SP1 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep3_pp0 -> layer_2_expert_sp1_ep3_tp3_pp0
	layer_2_expert_out_sp1_ep3_tp3_pp0 [label="Expert Out L2 SP1 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep3_tp3_pp0 -> layer_2_expert_out_sp1_ep3_tp3_pp0
	layer_2_expert_ar_sp1_ep3_pp0 [label="Expert All-Reduce L2 SP1 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep3_tp0_pp0 -> layer_2_expert_ar_sp1_ep3_pp0
	layer_2_expert_out_sp1_ep3_tp1_pp0 -> layer_2_expert_ar_sp1_ep3_pp0
	layer_2_expert_out_sp1_ep3_tp2_pp0 -> layer_2_expert_ar_sp1_ep3_pp0
	layer_2_expert_out_sp1_ep3_tp3_pp0 -> layer_2_expert_ar_sp1_ep3_pp0
	layer_2_combine_sp1_ep3_pp0 [label="Token Combine L2 SP1 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep3_pp0 -> layer_2_combine_sp1_ep3_pp0
	layer_2_dispatch_sp1_ep4_pp0 [label="Token Dispatch L2 SP1 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep4_pp0 [style=dashed]
	layer_2_expert_sp1_ep4_tp0_pp0 [label="Expert L2 SP1 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep4_pp0 -> layer_2_expert_sp1_ep4_tp0_pp0
	layer_2_expert_out_sp1_ep4_tp0_pp0 [label="Expert Out L2 SP1 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep4_tp0_pp0 -> layer_2_expert_out_sp1_ep4_tp0_pp0
	layer_2_expert_sp1_ep4_tp1_pp0 [label="Expert L2 SP1 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep4_pp0 -> layer_2_expert_sp1_ep4_tp1_pp0
	layer_2_expert_out_sp1_ep4_tp1_pp0 [label="Expert Out L2 SP1 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep4_tp1_pp0 -> layer_2_expert_out_sp1_ep4_tp1_pp0
	layer_2_expert_sp1_ep4_tp2_pp0 [label="Expert L2 SP1 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep4_pp0 -> layer_2_expert_sp1_ep4_tp2_pp0
	layer_2_expert_out_sp1_ep4_tp2_pp0 [label="Expert Out L2 SP1 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep4_tp2_pp0 -> layer_2_expert_out_sp1_ep4_tp2_pp0
	layer_2_expert_sp1_ep4_tp3_pp0 [label="Expert L2 SP1 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep4_pp0 -> layer_2_expert_sp1_ep4_tp3_pp0
	layer_2_expert_out_sp1_ep4_tp3_pp0 [label="Expert Out L2 SP1 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep4_tp3_pp0 -> layer_2_expert_out_sp1_ep4_tp3_pp0
	layer_2_expert_ar_sp1_ep4_pp0 [label="Expert All-Reduce L2 SP1 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep4_tp0_pp0 -> layer_2_expert_ar_sp1_ep4_pp0
	layer_2_expert_out_sp1_ep4_tp1_pp0 -> layer_2_expert_ar_sp1_ep4_pp0
	layer_2_expert_out_sp1_ep4_tp2_pp0 -> layer_2_expert_ar_sp1_ep4_pp0
	layer_2_expert_out_sp1_ep4_tp3_pp0 -> layer_2_expert_ar_sp1_ep4_pp0
	layer_2_combine_sp1_ep4_pp0 [label="Token Combine L2 SP1 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep4_pp0 -> layer_2_combine_sp1_ep4_pp0
	layer_2_dispatch_sp1_ep5_pp0 [label="Token Dispatch L2 SP1 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep5_pp0 [style=dashed]
	layer_2_expert_sp1_ep5_tp0_pp0 [label="Expert L2 SP1 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep5_pp0 -> layer_2_expert_sp1_ep5_tp0_pp0
	layer_2_expert_out_sp1_ep5_tp0_pp0 [label="Expert Out L2 SP1 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep5_tp0_pp0 -> layer_2_expert_out_sp1_ep5_tp0_pp0
	layer_2_expert_sp1_ep5_tp1_pp0 [label="Expert L2 SP1 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep5_pp0 -> layer_2_expert_sp1_ep5_tp1_pp0
	layer_2_expert_out_sp1_ep5_tp1_pp0 [label="Expert Out L2 SP1 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep5_tp1_pp0 -> layer_2_expert_out_sp1_ep5_tp1_pp0
	layer_2_expert_sp1_ep5_tp2_pp0 [label="Expert L2 SP1 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep5_pp0 -> layer_2_expert_sp1_ep5_tp2_pp0
	layer_2_expert_out_sp1_ep5_tp2_pp0 [label="Expert Out L2 SP1 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep5_tp2_pp0 -> layer_2_expert_out_sp1_ep5_tp2_pp0
	layer_2_expert_sp1_ep5_tp3_pp0 [label="Expert L2 SP1 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep5_pp0 -> layer_2_expert_sp1_ep5_tp3_pp0
	layer_2_expert_out_sp1_ep5_tp3_pp0 [label="Expert Out L2 SP1 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep5_tp3_pp0 -> layer_2_expert_out_sp1_ep5_tp3_pp0
	layer_2_expert_ar_sp1_ep5_pp0 [label="Expert All-Reduce L2 SP1 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep5_tp0_pp0 -> layer_2_expert_ar_sp1_ep5_pp0
	layer_2_expert_out_sp1_ep5_tp1_pp0 -> layer_2_expert_ar_sp1_ep5_pp0
	layer_2_expert_out_sp1_ep5_tp2_pp0 -> layer_2_expert_ar_sp1_ep5_pp0
	layer_2_expert_out_sp1_ep5_tp3_pp0 -> layer_2_expert_ar_sp1_ep5_pp0
	layer_2_combine_sp1_ep5_pp0 [label="Token Combine L2 SP1 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep5_pp0 -> layer_2_combine_sp1_ep5_pp0
	layer_2_dispatch_sp1_ep6_pp0 [label="Token Dispatch L2 SP1 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep6_pp0 [style=dashed]
	layer_2_expert_sp1_ep6_tp0_pp0 [label="Expert L2 SP1 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep6_pp0 -> layer_2_expert_sp1_ep6_tp0_pp0
	layer_2_expert_out_sp1_ep6_tp0_pp0 [label="Expert Out L2 SP1 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep6_tp0_pp0 -> layer_2_expert_out_sp1_ep6_tp0_pp0
	layer_2_expert_sp1_ep6_tp1_pp0 [label="Expert L2 SP1 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep6_pp0 -> layer_2_expert_sp1_ep6_tp1_pp0
	layer_2_expert_out_sp1_ep6_tp1_pp0 [label="Expert Out L2 SP1 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep6_tp1_pp0 -> layer_2_expert_out_sp1_ep6_tp1_pp0
	layer_2_expert_sp1_ep6_tp2_pp0 [label="Expert L2 SP1 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep6_pp0 -> layer_2_expert_sp1_ep6_tp2_pp0
	layer_2_expert_out_sp1_ep6_tp2_pp0 [label="Expert Out L2 SP1 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep6_tp2_pp0 -> layer_2_expert_out_sp1_ep6_tp2_pp0
	layer_2_expert_sp1_ep6_tp3_pp0 [label="Expert L2 SP1 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep6_pp0 -> layer_2_expert_sp1_ep6_tp3_pp0
	layer_2_expert_out_sp1_ep6_tp3_pp0 [label="Expert Out L2 SP1 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep6_tp3_pp0 -> layer_2_expert_out_sp1_ep6_tp3_pp0
	layer_2_expert_ar_sp1_ep6_pp0 [label="Expert All-Reduce L2 SP1 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep6_tp0_pp0 -> layer_2_expert_ar_sp1_ep6_pp0
	layer_2_expert_out_sp1_ep6_tp1_pp0 -> layer_2_expert_ar_sp1_ep6_pp0
	layer_2_expert_out_sp1_ep6_tp2_pp0 -> layer_2_expert_ar_sp1_ep6_pp0
	layer_2_expert_out_sp1_ep6_tp3_pp0 -> layer_2_expert_ar_sp1_ep6_pp0
	layer_2_combine_sp1_ep6_pp0 [label="Token Combine L2 SP1 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep6_pp0 -> layer_2_combine_sp1_ep6_pp0
	layer_2_dispatch_sp1_ep7_pp0 [label="Token Dispatch L2 SP1 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep7_pp0 [style=dashed]
	layer_2_expert_sp1_ep7_tp0_pp0 [label="Expert L2 SP1 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep7_pp0 -> layer_2_expert_sp1_ep7_tp0_pp0
	layer_2_expert_out_sp1_ep7_tp0_pp0 [label="Expert Out L2 SP1 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep7_tp0_pp0 -> layer_2_expert_out_sp1_ep7_tp0_pp0
	layer_2_expert_sp1_ep7_tp1_pp0 [label="Expert L2 SP1 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep7_pp0 -> layer_2_expert_sp1_ep7_tp1_pp0
	layer_2_expert_out_sp1_ep7_tp1_pp0 [label="Expert Out L2 SP1 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep7_tp1_pp0 -> layer_2_expert_out_sp1_ep7_tp1_pp0
	layer_2_expert_sp1_ep7_tp2_pp0 [label="Expert L2 SP1 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep7_pp0 -> layer_2_expert_sp1_ep7_tp2_pp0
	layer_2_expert_out_sp1_ep7_tp2_pp0 [label="Expert Out L2 SP1 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep7_tp2_pp0 -> layer_2_expert_out_sp1_ep7_tp2_pp0
	layer_2_expert_sp1_ep7_tp3_pp0 [label="Expert L2 SP1 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep7_pp0 -> layer_2_expert_sp1_ep7_tp3_pp0
	layer_2_expert_out_sp1_ep7_tp3_pp0 [label="Expert Out L2 SP1 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep7_tp3_pp0 -> layer_2_expert_out_sp1_ep7_tp3_pp0
	layer_2_expert_ar_sp1_ep7_pp0 [label="Expert All-Reduce L2 SP1 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep7_tp0_pp0 -> layer_2_expert_ar_sp1_ep7_pp0
	layer_2_expert_out_sp1_ep7_tp1_pp0 -> layer_2_expert_ar_sp1_ep7_pp0
	layer_2_expert_out_sp1_ep7_tp2_pp0 -> layer_2_expert_ar_sp1_ep7_pp0
	layer_2_expert_out_sp1_ep7_tp3_pp0 -> layer_2_expert_ar_sp1_ep7_pp0
	layer_2_combine_sp1_ep7_pp0 [label="Token Combine L2 SP1 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep7_pp0 -> layer_2_combine_sp1_ep7_pp0
	layer_2_dispatch_sp1_ep8_pp0 [label="Token Dispatch L2 SP1 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep8_pp0 [style=dashed]
	layer_2_expert_sp1_ep8_tp0_pp0 [label="Expert L2 SP1 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep8_pp0 -> layer_2_expert_sp1_ep8_tp0_pp0
	layer_2_expert_out_sp1_ep8_tp0_pp0 [label="Expert Out L2 SP1 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep8_tp0_pp0 -> layer_2_expert_out_sp1_ep8_tp0_pp0
	layer_2_expert_sp1_ep8_tp1_pp0 [label="Expert L2 SP1 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep8_pp0 -> layer_2_expert_sp1_ep8_tp1_pp0
	layer_2_expert_out_sp1_ep8_tp1_pp0 [label="Expert Out L2 SP1 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep8_tp1_pp0 -> layer_2_expert_out_sp1_ep8_tp1_pp0
	layer_2_expert_sp1_ep8_tp2_pp0 [label="Expert L2 SP1 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep8_pp0 -> layer_2_expert_sp1_ep8_tp2_pp0
	layer_2_expert_out_sp1_ep8_tp2_pp0 [label="Expert Out L2 SP1 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep8_tp2_pp0 -> layer_2_expert_out_sp1_ep8_tp2_pp0
	layer_2_expert_sp1_ep8_tp3_pp0 [label="Expert L2 SP1 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep8_pp0 -> layer_2_expert_sp1_ep8_tp3_pp0
	layer_2_expert_out_sp1_ep8_tp3_pp0 [label="Expert Out L2 SP1 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep8_tp3_pp0 -> layer_2_expert_out_sp1_ep8_tp3_pp0
	layer_2_expert_ar_sp1_ep8_pp0 [label="Expert All-Reduce L2 SP1 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep8_tp0_pp0 -> layer_2_expert_ar_sp1_ep8_pp0
	layer_2_expert_out_sp1_ep8_tp1_pp0 -> layer_2_expert_ar_sp1_ep8_pp0
	layer_2_expert_out_sp1_ep8_tp2_pp0 -> layer_2_expert_ar_sp1_ep8_pp0
	layer_2_expert_out_sp1_ep8_tp3_pp0 -> layer_2_expert_ar_sp1_ep8_pp0
	layer_2_combine_sp1_ep8_pp0 [label="Token Combine L2 SP1 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep8_pp0 -> layer_2_combine_sp1_ep8_pp0
	layer_2_dispatch_sp1_ep9_pp0 [label="Token Dispatch L2 SP1 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep9_pp0 [style=dashed]
	layer_2_expert_sp1_ep9_tp0_pp0 [label="Expert L2 SP1 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep9_pp0 -> layer_2_expert_sp1_ep9_tp0_pp0
	layer_2_expert_out_sp1_ep9_tp0_pp0 [label="Expert Out L2 SP1 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep9_tp0_pp0 -> layer_2_expert_out_sp1_ep9_tp0_pp0
	layer_2_expert_sp1_ep9_tp1_pp0 [label="Expert L2 SP1 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep9_pp0 -> layer_2_expert_sp1_ep9_tp1_pp0
	layer_2_expert_out_sp1_ep9_tp1_pp0 [label="Expert Out L2 SP1 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep9_tp1_pp0 -> layer_2_expert_out_sp1_ep9_tp1_pp0
	layer_2_expert_sp1_ep9_tp2_pp0 [label="Expert L2 SP1 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep9_pp0 -> layer_2_expert_sp1_ep9_tp2_pp0
	layer_2_expert_out_sp1_ep9_tp2_pp0 [label="Expert Out L2 SP1 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep9_tp2_pp0 -> layer_2_expert_out_sp1_ep9_tp2_pp0
	layer_2_expert_sp1_ep9_tp3_pp0 [label="Expert L2 SP1 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep9_pp0 -> layer_2_expert_sp1_ep9_tp3_pp0
	layer_2_expert_out_sp1_ep9_tp3_pp0 [label="Expert Out L2 SP1 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep9_tp3_pp0 -> layer_2_expert_out_sp1_ep9_tp3_pp0
	layer_2_expert_ar_sp1_ep9_pp0 [label="Expert All-Reduce L2 SP1 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep9_tp0_pp0 -> layer_2_expert_ar_sp1_ep9_pp0
	layer_2_expert_out_sp1_ep9_tp1_pp0 -> layer_2_expert_ar_sp1_ep9_pp0
	layer_2_expert_out_sp1_ep9_tp2_pp0 -> layer_2_expert_ar_sp1_ep9_pp0
	layer_2_expert_out_sp1_ep9_tp3_pp0 -> layer_2_expert_ar_sp1_ep9_pp0
	layer_2_combine_sp1_ep9_pp0 [label="Token Combine L2 SP1 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep9_pp0 -> layer_2_combine_sp1_ep9_pp0
	layer_2_dispatch_sp1_ep10_pp0 [label="Token Dispatch L2 SP1 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep10_pp0 [style=dashed]
	layer_2_expert_sp1_ep10_tp0_pp0 [label="Expert L2 SP1 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep10_pp0 -> layer_2_expert_sp1_ep10_tp0_pp0
	layer_2_expert_out_sp1_ep10_tp0_pp0 [label="Expert Out L2 SP1 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep10_tp0_pp0 -> layer_2_expert_out_sp1_ep10_tp0_pp0
	layer_2_expert_sp1_ep10_tp1_pp0 [label="Expert L2 SP1 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep10_pp0 -> layer_2_expert_sp1_ep10_tp1_pp0
	layer_2_expert_out_sp1_ep10_tp1_pp0 [label="Expert Out L2 SP1 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep10_tp1_pp0 -> layer_2_expert_out_sp1_ep10_tp1_pp0
	layer_2_expert_sp1_ep10_tp2_pp0 [label="Expert L2 SP1 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep10_pp0 -> layer_2_expert_sp1_ep10_tp2_pp0
	layer_2_expert_out_sp1_ep10_tp2_pp0 [label="Expert Out L2 SP1 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep10_tp2_pp0 -> layer_2_expert_out_sp1_ep10_tp2_pp0
	layer_2_expert_sp1_ep10_tp3_pp0 [label="Expert L2 SP1 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep10_pp0 -> layer_2_expert_sp1_ep10_tp3_pp0
	layer_2_expert_out_sp1_ep10_tp3_pp0 [label="Expert Out L2 SP1 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep10_tp3_pp0 -> layer_2_expert_out_sp1_ep10_tp3_pp0
	layer_2_expert_ar_sp1_ep10_pp0 [label="Expert All-Reduce L2 SP1 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep10_tp0_pp0 -> layer_2_expert_ar_sp1_ep10_pp0
	layer_2_expert_out_sp1_ep10_tp1_pp0 -> layer_2_expert_ar_sp1_ep10_pp0
	layer_2_expert_out_sp1_ep10_tp2_pp0 -> layer_2_expert_ar_sp1_ep10_pp0
	layer_2_expert_out_sp1_ep10_tp3_pp0 -> layer_2_expert_ar_sp1_ep10_pp0
	layer_2_combine_sp1_ep10_pp0 [label="Token Combine L2 SP1 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep10_pp0 -> layer_2_combine_sp1_ep10_pp0
	layer_2_dispatch_sp1_ep11_pp0 [label="Token Dispatch L2 SP1 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep11_pp0 [style=dashed]
	layer_2_expert_sp1_ep11_tp0_pp0 [label="Expert L2 SP1 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep11_pp0 -> layer_2_expert_sp1_ep11_tp0_pp0
	layer_2_expert_out_sp1_ep11_tp0_pp0 [label="Expert Out L2 SP1 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep11_tp0_pp0 -> layer_2_expert_out_sp1_ep11_tp0_pp0
	layer_2_expert_sp1_ep11_tp1_pp0 [label="Expert L2 SP1 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep11_pp0 -> layer_2_expert_sp1_ep11_tp1_pp0
	layer_2_expert_out_sp1_ep11_tp1_pp0 [label="Expert Out L2 SP1 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep11_tp1_pp0 -> layer_2_expert_out_sp1_ep11_tp1_pp0
	layer_2_expert_sp1_ep11_tp2_pp0 [label="Expert L2 SP1 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep11_pp0 -> layer_2_expert_sp1_ep11_tp2_pp0
	layer_2_expert_out_sp1_ep11_tp2_pp0 [label="Expert Out L2 SP1 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep11_tp2_pp0 -> layer_2_expert_out_sp1_ep11_tp2_pp0
	layer_2_expert_sp1_ep11_tp3_pp0 [label="Expert L2 SP1 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep11_pp0 -> layer_2_expert_sp1_ep11_tp3_pp0
	layer_2_expert_out_sp1_ep11_tp3_pp0 [label="Expert Out L2 SP1 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep11_tp3_pp0 -> layer_2_expert_out_sp1_ep11_tp3_pp0
	layer_2_expert_ar_sp1_ep11_pp0 [label="Expert All-Reduce L2 SP1 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep11_tp0_pp0 -> layer_2_expert_ar_sp1_ep11_pp0
	layer_2_expert_out_sp1_ep11_tp1_pp0 -> layer_2_expert_ar_sp1_ep11_pp0
	layer_2_expert_out_sp1_ep11_tp2_pp0 -> layer_2_expert_ar_sp1_ep11_pp0
	layer_2_expert_out_sp1_ep11_tp3_pp0 -> layer_2_expert_ar_sp1_ep11_pp0
	layer_2_combine_sp1_ep11_pp0 [label="Token Combine L2 SP1 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep11_pp0 -> layer_2_combine_sp1_ep11_pp0
	layer_2_dispatch_sp1_ep12_pp0 [label="Token Dispatch L2 SP1 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep12_pp0 [style=dashed]
	layer_2_expert_sp1_ep12_tp0_pp0 [label="Expert L2 SP1 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep12_pp0 -> layer_2_expert_sp1_ep12_tp0_pp0
	layer_2_expert_out_sp1_ep12_tp0_pp0 [label="Expert Out L2 SP1 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep12_tp0_pp0 -> layer_2_expert_out_sp1_ep12_tp0_pp0
	layer_2_expert_sp1_ep12_tp1_pp0 [label="Expert L2 SP1 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep12_pp0 -> layer_2_expert_sp1_ep12_tp1_pp0
	layer_2_expert_out_sp1_ep12_tp1_pp0 [label="Expert Out L2 SP1 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep12_tp1_pp0 -> layer_2_expert_out_sp1_ep12_tp1_pp0
	layer_2_expert_sp1_ep12_tp2_pp0 [label="Expert L2 SP1 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep12_pp0 -> layer_2_expert_sp1_ep12_tp2_pp0
	layer_2_expert_out_sp1_ep12_tp2_pp0 [label="Expert Out L2 SP1 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep12_tp2_pp0 -> layer_2_expert_out_sp1_ep12_tp2_pp0
	layer_2_expert_sp1_ep12_tp3_pp0 [label="Expert L2 SP1 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep12_pp0 -> layer_2_expert_sp1_ep12_tp3_pp0
	layer_2_expert_out_sp1_ep12_tp3_pp0 [label="Expert Out L2 SP1 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep12_tp3_pp0 -> layer_2_expert_out_sp1_ep12_tp3_pp0
	layer_2_expert_ar_sp1_ep12_pp0 [label="Expert All-Reduce L2 SP1 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep12_tp0_pp0 -> layer_2_expert_ar_sp1_ep12_pp0
	layer_2_expert_out_sp1_ep12_tp1_pp0 -> layer_2_expert_ar_sp1_ep12_pp0
	layer_2_expert_out_sp1_ep12_tp2_pp0 -> layer_2_expert_ar_sp1_ep12_pp0
	layer_2_expert_out_sp1_ep12_tp3_pp0 -> layer_2_expert_ar_sp1_ep12_pp0
	layer_2_combine_sp1_ep12_pp0 [label="Token Combine L2 SP1 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep12_pp0 -> layer_2_combine_sp1_ep12_pp0
	layer_2_dispatch_sp1_ep13_pp0 [label="Token Dispatch L2 SP1 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep13_pp0 [style=dashed]
	layer_2_expert_sp1_ep13_tp0_pp0 [label="Expert L2 SP1 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep13_pp0 -> layer_2_expert_sp1_ep13_tp0_pp0
	layer_2_expert_out_sp1_ep13_tp0_pp0 [label="Expert Out L2 SP1 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep13_tp0_pp0 -> layer_2_expert_out_sp1_ep13_tp0_pp0
	layer_2_expert_sp1_ep13_tp1_pp0 [label="Expert L2 SP1 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep13_pp0 -> layer_2_expert_sp1_ep13_tp1_pp0
	layer_2_expert_out_sp1_ep13_tp1_pp0 [label="Expert Out L2 SP1 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep13_tp1_pp0 -> layer_2_expert_out_sp1_ep13_tp1_pp0
	layer_2_expert_sp1_ep13_tp2_pp0 [label="Expert L2 SP1 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep13_pp0 -> layer_2_expert_sp1_ep13_tp2_pp0
	layer_2_expert_out_sp1_ep13_tp2_pp0 [label="Expert Out L2 SP1 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep13_tp2_pp0 -> layer_2_expert_out_sp1_ep13_tp2_pp0
	layer_2_expert_sp1_ep13_tp3_pp0 [label="Expert L2 SP1 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep13_pp0 -> layer_2_expert_sp1_ep13_tp3_pp0
	layer_2_expert_out_sp1_ep13_tp3_pp0 [label="Expert Out L2 SP1 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep13_tp3_pp0 -> layer_2_expert_out_sp1_ep13_tp3_pp0
	layer_2_expert_ar_sp1_ep13_pp0 [label="Expert All-Reduce L2 SP1 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep13_tp0_pp0 -> layer_2_expert_ar_sp1_ep13_pp0
	layer_2_expert_out_sp1_ep13_tp1_pp0 -> layer_2_expert_ar_sp1_ep13_pp0
	layer_2_expert_out_sp1_ep13_tp2_pp0 -> layer_2_expert_ar_sp1_ep13_pp0
	layer_2_expert_out_sp1_ep13_tp3_pp0 -> layer_2_expert_ar_sp1_ep13_pp0
	layer_2_combine_sp1_ep13_pp0 [label="Token Combine L2 SP1 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep13_pp0 -> layer_2_combine_sp1_ep13_pp0
	layer_2_dispatch_sp1_ep14_pp0 [label="Token Dispatch L2 SP1 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep14_pp0 [style=dashed]
	layer_2_expert_sp1_ep14_tp0_pp0 [label="Expert L2 SP1 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep14_pp0 -> layer_2_expert_sp1_ep14_tp0_pp0
	layer_2_expert_out_sp1_ep14_tp0_pp0 [label="Expert Out L2 SP1 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep14_tp0_pp0 -> layer_2_expert_out_sp1_ep14_tp0_pp0
	layer_2_expert_sp1_ep14_tp1_pp0 [label="Expert L2 SP1 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep14_pp0 -> layer_2_expert_sp1_ep14_tp1_pp0
	layer_2_expert_out_sp1_ep14_tp1_pp0 [label="Expert Out L2 SP1 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep14_tp1_pp0 -> layer_2_expert_out_sp1_ep14_tp1_pp0
	layer_2_expert_sp1_ep14_tp2_pp0 [label="Expert L2 SP1 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep14_pp0 -> layer_2_expert_sp1_ep14_tp2_pp0
	layer_2_expert_out_sp1_ep14_tp2_pp0 [label="Expert Out L2 SP1 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep14_tp2_pp0 -> layer_2_expert_out_sp1_ep14_tp2_pp0
	layer_2_expert_sp1_ep14_tp3_pp0 [label="Expert L2 SP1 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep14_pp0 -> layer_2_expert_sp1_ep14_tp3_pp0
	layer_2_expert_out_sp1_ep14_tp3_pp0 [label="Expert Out L2 SP1 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep14_tp3_pp0 -> layer_2_expert_out_sp1_ep14_tp3_pp0
	layer_2_expert_ar_sp1_ep14_pp0 [label="Expert All-Reduce L2 SP1 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep14_tp0_pp0 -> layer_2_expert_ar_sp1_ep14_pp0
	layer_2_expert_out_sp1_ep14_tp1_pp0 -> layer_2_expert_ar_sp1_ep14_pp0
	layer_2_expert_out_sp1_ep14_tp2_pp0 -> layer_2_expert_ar_sp1_ep14_pp0
	layer_2_expert_out_sp1_ep14_tp3_pp0 -> layer_2_expert_ar_sp1_ep14_pp0
	layer_2_combine_sp1_ep14_pp0 [label="Token Combine L2 SP1 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep14_pp0 -> layer_2_combine_sp1_ep14_pp0
	layer_2_dispatch_sp1_ep15_pp0 [label="Token Dispatch L2 SP1 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp1_pp0 -> layer_2_dispatch_sp1_ep15_pp0 [style=dashed]
	layer_2_expert_sp1_ep15_tp0_pp0 [label="Expert L2 SP1 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep15_pp0 -> layer_2_expert_sp1_ep15_tp0_pp0
	layer_2_expert_out_sp1_ep15_tp0_pp0 [label="Expert Out L2 SP1 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep15_tp0_pp0 -> layer_2_expert_out_sp1_ep15_tp0_pp0
	layer_2_expert_sp1_ep15_tp1_pp0 [label="Expert L2 SP1 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep15_pp0 -> layer_2_expert_sp1_ep15_tp1_pp0
	layer_2_expert_out_sp1_ep15_tp1_pp0 [label="Expert Out L2 SP1 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep15_tp1_pp0 -> layer_2_expert_out_sp1_ep15_tp1_pp0
	layer_2_expert_sp1_ep15_tp2_pp0 [label="Expert L2 SP1 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep15_pp0 -> layer_2_expert_sp1_ep15_tp2_pp0
	layer_2_expert_out_sp1_ep15_tp2_pp0 [label="Expert Out L2 SP1 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep15_tp2_pp0 -> layer_2_expert_out_sp1_ep15_tp2_pp0
	layer_2_expert_sp1_ep15_tp3_pp0 [label="Expert L2 SP1 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp1_ep15_pp0 -> layer_2_expert_sp1_ep15_tp3_pp0
	layer_2_expert_out_sp1_ep15_tp3_pp0 [label="Expert Out L2 SP1 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp1_ep15_tp3_pp0 -> layer_2_expert_out_sp1_ep15_tp3_pp0
	layer_2_expert_ar_sp1_ep15_pp0 [label="Expert All-Reduce L2 SP1 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp1_ep15_tp0_pp0 -> layer_2_expert_ar_sp1_ep15_pp0
	layer_2_expert_out_sp1_ep15_tp1_pp0 -> layer_2_expert_ar_sp1_ep15_pp0
	layer_2_expert_out_sp1_ep15_tp2_pp0 -> layer_2_expert_ar_sp1_ep15_pp0
	layer_2_expert_out_sp1_ep15_tp3_pp0 -> layer_2_expert_ar_sp1_ep15_pp0
	layer_2_combine_sp1_ep15_pp0 [label="Token Combine L2 SP1 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp1_ep15_pp0 -> layer_2_combine_sp1_ep15_pp0
	layer_2_moe_all2all_sp1_pp0 [label="MoE All-to-All L2 SP1\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_2_combine_sp1_ep0_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep1_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep2_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep3_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep4_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep5_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep6_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep7_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep8_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep9_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep10_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep11_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep12_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep13_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep14_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_combine_sp1_ep15_pp0 -> layer_2_moe_all2all_sp1_pp0
	layer_2_mlp_out_sp1_pp0 [label="MoE Output L2 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_moe_all2all_sp1_pp0 -> layer_2_mlp_out_sp1_pp0
	layer_2_mlp_res_sp1_pp0 [label="MLP Residual L2 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_mlp_out_sp1_pp0 -> layer_2_mlp_res_sp1_pp0
	layer_2_attn_res_sp1_pp0 -> layer_2_mlp_res_sp1_pp0 [style=dashed]
	layer_2_norm_sp2_pp0 [label="LayerNorm L2 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_mlp_out_sp2_pp0 -> layer_2_norm_sp2_pp0
	layer_2_qkv_sp2_tp0_pp0 [label="QKV Proj L2 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp2_pp0 -> layer_2_qkv_sp2_tp0_pp0
	layer_2_attn_sp2_tp0_pp0 [label="Attention L2 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp2_tp0_pp0 -> layer_2_attn_sp2_tp0_pp0
	layer_2_attn_out_sp2_tp0_pp0 [label="Attn Out Proj L2 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp2_tp0_pp0 -> layer_2_attn_out_sp2_tp0_pp0
	layer_2_qkv_sp2_tp1_pp0 [label="QKV Proj L2 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp2_pp0 -> layer_2_qkv_sp2_tp1_pp0
	layer_2_attn_sp2_tp1_pp0 [label="Attention L2 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp2_tp1_pp0 -> layer_2_attn_sp2_tp1_pp0
	layer_2_attn_out_sp2_tp1_pp0 [label="Attn Out Proj L2 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp2_tp1_pp0 -> layer_2_attn_out_sp2_tp1_pp0
	layer_2_qkv_sp2_tp2_pp0 [label="QKV Proj L2 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp2_pp0 -> layer_2_qkv_sp2_tp2_pp0
	layer_2_attn_sp2_tp2_pp0 [label="Attention L2 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp2_tp2_pp0 -> layer_2_attn_sp2_tp2_pp0
	layer_2_attn_out_sp2_tp2_pp0 [label="Attn Out Proj L2 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp2_tp2_pp0 -> layer_2_attn_out_sp2_tp2_pp0
	layer_2_qkv_sp2_tp3_pp0 [label="QKV Proj L2 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp2_pp0 -> layer_2_qkv_sp2_tp3_pp0
	layer_2_attn_sp2_tp3_pp0 [label="Attention L2 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp2_tp3_pp0 -> layer_2_attn_sp2_tp3_pp0
	layer_2_attn_out_sp2_tp3_pp0 [label="Attn Out Proj L2 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp2_tp3_pp0 -> layer_2_attn_out_sp2_tp3_pp0
	layer_2_attn_ar_sp2_pp0 [label="Attention All-Reduce L2 SP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_attn_out_sp2_tp0_pp0 -> layer_2_attn_ar_sp2_pp0
	layer_2_attn_out_sp2_tp1_pp0 -> layer_2_attn_ar_sp2_pp0
	layer_2_attn_out_sp2_tp2_pp0 -> layer_2_attn_ar_sp2_pp0
	layer_2_attn_out_sp2_tp3_pp0 -> layer_2_attn_ar_sp2_pp0
	layer_2_attn_res_sp2_pp0 [label="Attention Residual L2 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_attn_ar_sp2_pp0 -> layer_2_attn_res_sp2_pp0
	layer_2_norm_sp2_pp0 -> layer_2_attn_res_sp2_pp0 [style=dashed]
	layer_2_post_norm_sp2_pp0 [label="Post-Attn Norm L2 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_attn_res_sp2_pp0 -> layer_2_post_norm_sp2_pp0
	layer_2_router_sp2_pp0 [label="MoE Router L2 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_2_post_norm_sp2_pp0 -> layer_2_router_sp2_pp0
	layer_2_dispatch_sp2_ep0_pp0 [label="Token Dispatch L2 SP2 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep0_pp0 [style=dashed]
	layer_2_expert_sp2_ep0_tp0_pp0 [label="Expert L2 SP2 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep0_pp0 -> layer_2_expert_sp2_ep0_tp0_pp0
	layer_2_expert_out_sp2_ep0_tp0_pp0 [label="Expert Out L2 SP2 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep0_tp0_pp0 -> layer_2_expert_out_sp2_ep0_tp0_pp0
	layer_2_expert_sp2_ep0_tp1_pp0 [label="Expert L2 SP2 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep0_pp0 -> layer_2_expert_sp2_ep0_tp1_pp0
	layer_2_expert_out_sp2_ep0_tp1_pp0 [label="Expert Out L2 SP2 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep0_tp1_pp0 -> layer_2_expert_out_sp2_ep0_tp1_pp0
	layer_2_expert_sp2_ep0_tp2_pp0 [label="Expert L2 SP2 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep0_pp0 -> layer_2_expert_sp2_ep0_tp2_pp0
	layer_2_expert_out_sp2_ep0_tp2_pp0 [label="Expert Out L2 SP2 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep0_tp2_pp0 -> layer_2_expert_out_sp2_ep0_tp2_pp0
	layer_2_expert_sp2_ep0_tp3_pp0 [label="Expert L2 SP2 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep0_pp0 -> layer_2_expert_sp2_ep0_tp3_pp0
	layer_2_expert_out_sp2_ep0_tp3_pp0 [label="Expert Out L2 SP2 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep0_tp3_pp0 -> layer_2_expert_out_sp2_ep0_tp3_pp0
	layer_2_expert_ar_sp2_ep0_pp0 [label="Expert All-Reduce L2 SP2 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep0_tp0_pp0 -> layer_2_expert_ar_sp2_ep0_pp0
	layer_2_expert_out_sp2_ep0_tp1_pp0 -> layer_2_expert_ar_sp2_ep0_pp0
	layer_2_expert_out_sp2_ep0_tp2_pp0 -> layer_2_expert_ar_sp2_ep0_pp0
	layer_2_expert_out_sp2_ep0_tp3_pp0 -> layer_2_expert_ar_sp2_ep0_pp0
	layer_2_combine_sp2_ep0_pp0 [label="Token Combine L2 SP2 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep0_pp0 -> layer_2_combine_sp2_ep0_pp0
	layer_2_dispatch_sp2_ep1_pp0 [label="Token Dispatch L2 SP2 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep1_pp0 [style=dashed]
	layer_2_expert_sp2_ep1_tp0_pp0 [label="Expert L2 SP2 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep1_pp0 -> layer_2_expert_sp2_ep1_tp0_pp0
	layer_2_expert_out_sp2_ep1_tp0_pp0 [label="Expert Out L2 SP2 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep1_tp0_pp0 -> layer_2_expert_out_sp2_ep1_tp0_pp0
	layer_2_expert_sp2_ep1_tp1_pp0 [label="Expert L2 SP2 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep1_pp0 -> layer_2_expert_sp2_ep1_tp1_pp0
	layer_2_expert_out_sp2_ep1_tp1_pp0 [label="Expert Out L2 SP2 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep1_tp1_pp0 -> layer_2_expert_out_sp2_ep1_tp1_pp0
	layer_2_expert_sp2_ep1_tp2_pp0 [label="Expert L2 SP2 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep1_pp0 -> layer_2_expert_sp2_ep1_tp2_pp0
	layer_2_expert_out_sp2_ep1_tp2_pp0 [label="Expert Out L2 SP2 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep1_tp2_pp0 -> layer_2_expert_out_sp2_ep1_tp2_pp0
	layer_2_expert_sp2_ep1_tp3_pp0 [label="Expert L2 SP2 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep1_pp0 -> layer_2_expert_sp2_ep1_tp3_pp0
	layer_2_expert_out_sp2_ep1_tp3_pp0 [label="Expert Out L2 SP2 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep1_tp3_pp0 -> layer_2_expert_out_sp2_ep1_tp3_pp0
	layer_2_expert_ar_sp2_ep1_pp0 [label="Expert All-Reduce L2 SP2 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep1_tp0_pp0 -> layer_2_expert_ar_sp2_ep1_pp0
	layer_2_expert_out_sp2_ep1_tp1_pp0 -> layer_2_expert_ar_sp2_ep1_pp0
	layer_2_expert_out_sp2_ep1_tp2_pp0 -> layer_2_expert_ar_sp2_ep1_pp0
	layer_2_expert_out_sp2_ep1_tp3_pp0 -> layer_2_expert_ar_sp2_ep1_pp0
	layer_2_combine_sp2_ep1_pp0 [label="Token Combine L2 SP2 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep1_pp0 -> layer_2_combine_sp2_ep1_pp0
	layer_2_dispatch_sp2_ep2_pp0 [label="Token Dispatch L2 SP2 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep2_pp0 [style=dashed]
	layer_2_expert_sp2_ep2_tp0_pp0 [label="Expert L2 SP2 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep2_pp0 -> layer_2_expert_sp2_ep2_tp0_pp0
	layer_2_expert_out_sp2_ep2_tp0_pp0 [label="Expert Out L2 SP2 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep2_tp0_pp0 -> layer_2_expert_out_sp2_ep2_tp0_pp0
	layer_2_expert_sp2_ep2_tp1_pp0 [label="Expert L2 SP2 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep2_pp0 -> layer_2_expert_sp2_ep2_tp1_pp0
	layer_2_expert_out_sp2_ep2_tp1_pp0 [label="Expert Out L2 SP2 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep2_tp1_pp0 -> layer_2_expert_out_sp2_ep2_tp1_pp0
	layer_2_expert_sp2_ep2_tp2_pp0 [label="Expert L2 SP2 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep2_pp0 -> layer_2_expert_sp2_ep2_tp2_pp0
	layer_2_expert_out_sp2_ep2_tp2_pp0 [label="Expert Out L2 SP2 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep2_tp2_pp0 -> layer_2_expert_out_sp2_ep2_tp2_pp0
	layer_2_expert_sp2_ep2_tp3_pp0 [label="Expert L2 SP2 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep2_pp0 -> layer_2_expert_sp2_ep2_tp3_pp0
	layer_2_expert_out_sp2_ep2_tp3_pp0 [label="Expert Out L2 SP2 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep2_tp3_pp0 -> layer_2_expert_out_sp2_ep2_tp3_pp0
	layer_2_expert_ar_sp2_ep2_pp0 [label="Expert All-Reduce L2 SP2 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep2_tp0_pp0 -> layer_2_expert_ar_sp2_ep2_pp0
	layer_2_expert_out_sp2_ep2_tp1_pp0 -> layer_2_expert_ar_sp2_ep2_pp0
	layer_2_expert_out_sp2_ep2_tp2_pp0 -> layer_2_expert_ar_sp2_ep2_pp0
	layer_2_expert_out_sp2_ep2_tp3_pp0 -> layer_2_expert_ar_sp2_ep2_pp0
	layer_2_combine_sp2_ep2_pp0 [label="Token Combine L2 SP2 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep2_pp0 -> layer_2_combine_sp2_ep2_pp0
	layer_2_dispatch_sp2_ep3_pp0 [label="Token Dispatch L2 SP2 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep3_pp0 [style=dashed]
	layer_2_expert_sp2_ep3_tp0_pp0 [label="Expert L2 SP2 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep3_pp0 -> layer_2_expert_sp2_ep3_tp0_pp0
	layer_2_expert_out_sp2_ep3_tp0_pp0 [label="Expert Out L2 SP2 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep3_tp0_pp0 -> layer_2_expert_out_sp2_ep3_tp0_pp0
	layer_2_expert_sp2_ep3_tp1_pp0 [label="Expert L2 SP2 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep3_pp0 -> layer_2_expert_sp2_ep3_tp1_pp0
	layer_2_expert_out_sp2_ep3_tp1_pp0 [label="Expert Out L2 SP2 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep3_tp1_pp0 -> layer_2_expert_out_sp2_ep3_tp1_pp0
	layer_2_expert_sp2_ep3_tp2_pp0 [label="Expert L2 SP2 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep3_pp0 -> layer_2_expert_sp2_ep3_tp2_pp0
	layer_2_expert_out_sp2_ep3_tp2_pp0 [label="Expert Out L2 SP2 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep3_tp2_pp0 -> layer_2_expert_out_sp2_ep3_tp2_pp0
	layer_2_expert_sp2_ep3_tp3_pp0 [label="Expert L2 SP2 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep3_pp0 -> layer_2_expert_sp2_ep3_tp3_pp0
	layer_2_expert_out_sp2_ep3_tp3_pp0 [label="Expert Out L2 SP2 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep3_tp3_pp0 -> layer_2_expert_out_sp2_ep3_tp3_pp0
	layer_2_expert_ar_sp2_ep3_pp0 [label="Expert All-Reduce L2 SP2 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep3_tp0_pp0 -> layer_2_expert_ar_sp2_ep3_pp0
	layer_2_expert_out_sp2_ep3_tp1_pp0 -> layer_2_expert_ar_sp2_ep3_pp0
	layer_2_expert_out_sp2_ep3_tp2_pp0 -> layer_2_expert_ar_sp2_ep3_pp0
	layer_2_expert_out_sp2_ep3_tp3_pp0 -> layer_2_expert_ar_sp2_ep3_pp0
	layer_2_combine_sp2_ep3_pp0 [label="Token Combine L2 SP2 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep3_pp0 -> layer_2_combine_sp2_ep3_pp0
	layer_2_dispatch_sp2_ep4_pp0 [label="Token Dispatch L2 SP2 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep4_pp0 [style=dashed]
	layer_2_expert_sp2_ep4_tp0_pp0 [label="Expert L2 SP2 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep4_pp0 -> layer_2_expert_sp2_ep4_tp0_pp0
	layer_2_expert_out_sp2_ep4_tp0_pp0 [label="Expert Out L2 SP2 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep4_tp0_pp0 -> layer_2_expert_out_sp2_ep4_tp0_pp0
	layer_2_expert_sp2_ep4_tp1_pp0 [label="Expert L2 SP2 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep4_pp0 -> layer_2_expert_sp2_ep4_tp1_pp0
	layer_2_expert_out_sp2_ep4_tp1_pp0 [label="Expert Out L2 SP2 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep4_tp1_pp0 -> layer_2_expert_out_sp2_ep4_tp1_pp0
	layer_2_expert_sp2_ep4_tp2_pp0 [label="Expert L2 SP2 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep4_pp0 -> layer_2_expert_sp2_ep4_tp2_pp0
	layer_2_expert_out_sp2_ep4_tp2_pp0 [label="Expert Out L2 SP2 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep4_tp2_pp0 -> layer_2_expert_out_sp2_ep4_tp2_pp0
	layer_2_expert_sp2_ep4_tp3_pp0 [label="Expert L2 SP2 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep4_pp0 -> layer_2_expert_sp2_ep4_tp3_pp0
	layer_2_expert_out_sp2_ep4_tp3_pp0 [label="Expert Out L2 SP2 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep4_tp3_pp0 -> layer_2_expert_out_sp2_ep4_tp3_pp0
	layer_2_expert_ar_sp2_ep4_pp0 [label="Expert All-Reduce L2 SP2 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep4_tp0_pp0 -> layer_2_expert_ar_sp2_ep4_pp0
	layer_2_expert_out_sp2_ep4_tp1_pp0 -> layer_2_expert_ar_sp2_ep4_pp0
	layer_2_expert_out_sp2_ep4_tp2_pp0 -> layer_2_expert_ar_sp2_ep4_pp0
	layer_2_expert_out_sp2_ep4_tp3_pp0 -> layer_2_expert_ar_sp2_ep4_pp0
	layer_2_combine_sp2_ep4_pp0 [label="Token Combine L2 SP2 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep4_pp0 -> layer_2_combine_sp2_ep4_pp0
	layer_2_dispatch_sp2_ep5_pp0 [label="Token Dispatch L2 SP2 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep5_pp0 [style=dashed]
	layer_2_expert_sp2_ep5_tp0_pp0 [label="Expert L2 SP2 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep5_pp0 -> layer_2_expert_sp2_ep5_tp0_pp0
	layer_2_expert_out_sp2_ep5_tp0_pp0 [label="Expert Out L2 SP2 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep5_tp0_pp0 -> layer_2_expert_out_sp2_ep5_tp0_pp0
	layer_2_expert_sp2_ep5_tp1_pp0 [label="Expert L2 SP2 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep5_pp0 -> layer_2_expert_sp2_ep5_tp1_pp0
	layer_2_expert_out_sp2_ep5_tp1_pp0 [label="Expert Out L2 SP2 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep5_tp1_pp0 -> layer_2_expert_out_sp2_ep5_tp1_pp0
	layer_2_expert_sp2_ep5_tp2_pp0 [label="Expert L2 SP2 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep5_pp0 -> layer_2_expert_sp2_ep5_tp2_pp0
	layer_2_expert_out_sp2_ep5_tp2_pp0 [label="Expert Out L2 SP2 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep5_tp2_pp0 -> layer_2_expert_out_sp2_ep5_tp2_pp0
	layer_2_expert_sp2_ep5_tp3_pp0 [label="Expert L2 SP2 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep5_pp0 -> layer_2_expert_sp2_ep5_tp3_pp0
	layer_2_expert_out_sp2_ep5_tp3_pp0 [label="Expert Out L2 SP2 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep5_tp3_pp0 -> layer_2_expert_out_sp2_ep5_tp3_pp0
	layer_2_expert_ar_sp2_ep5_pp0 [label="Expert All-Reduce L2 SP2 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep5_tp0_pp0 -> layer_2_expert_ar_sp2_ep5_pp0
	layer_2_expert_out_sp2_ep5_tp1_pp0 -> layer_2_expert_ar_sp2_ep5_pp0
	layer_2_expert_out_sp2_ep5_tp2_pp0 -> layer_2_expert_ar_sp2_ep5_pp0
	layer_2_expert_out_sp2_ep5_tp3_pp0 -> layer_2_expert_ar_sp2_ep5_pp0
	layer_2_combine_sp2_ep5_pp0 [label="Token Combine L2 SP2 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep5_pp0 -> layer_2_combine_sp2_ep5_pp0
	layer_2_dispatch_sp2_ep6_pp0 [label="Token Dispatch L2 SP2 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep6_pp0 [style=dashed]
	layer_2_expert_sp2_ep6_tp0_pp0 [label="Expert L2 SP2 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep6_pp0 -> layer_2_expert_sp2_ep6_tp0_pp0
	layer_2_expert_out_sp2_ep6_tp0_pp0 [label="Expert Out L2 SP2 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep6_tp0_pp0 -> layer_2_expert_out_sp2_ep6_tp0_pp0
	layer_2_expert_sp2_ep6_tp1_pp0 [label="Expert L2 SP2 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep6_pp0 -> layer_2_expert_sp2_ep6_tp1_pp0
	layer_2_expert_out_sp2_ep6_tp1_pp0 [label="Expert Out L2 SP2 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep6_tp1_pp0 -> layer_2_expert_out_sp2_ep6_tp1_pp0
	layer_2_expert_sp2_ep6_tp2_pp0 [label="Expert L2 SP2 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep6_pp0 -> layer_2_expert_sp2_ep6_tp2_pp0
	layer_2_expert_out_sp2_ep6_tp2_pp0 [label="Expert Out L2 SP2 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep6_tp2_pp0 -> layer_2_expert_out_sp2_ep6_tp2_pp0
	layer_2_expert_sp2_ep6_tp3_pp0 [label="Expert L2 SP2 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep6_pp0 -> layer_2_expert_sp2_ep6_tp3_pp0
	layer_2_expert_out_sp2_ep6_tp3_pp0 [label="Expert Out L2 SP2 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep6_tp3_pp0 -> layer_2_expert_out_sp2_ep6_tp3_pp0
	layer_2_expert_ar_sp2_ep6_pp0 [label="Expert All-Reduce L2 SP2 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep6_tp0_pp0 -> layer_2_expert_ar_sp2_ep6_pp0
	layer_2_expert_out_sp2_ep6_tp1_pp0 -> layer_2_expert_ar_sp2_ep6_pp0
	layer_2_expert_out_sp2_ep6_tp2_pp0 -> layer_2_expert_ar_sp2_ep6_pp0
	layer_2_expert_out_sp2_ep6_tp3_pp0 -> layer_2_expert_ar_sp2_ep6_pp0
	layer_2_combine_sp2_ep6_pp0 [label="Token Combine L2 SP2 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep6_pp0 -> layer_2_combine_sp2_ep6_pp0
	layer_2_dispatch_sp2_ep7_pp0 [label="Token Dispatch L2 SP2 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep7_pp0 [style=dashed]
	layer_2_expert_sp2_ep7_tp0_pp0 [label="Expert L2 SP2 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep7_pp0 -> layer_2_expert_sp2_ep7_tp0_pp0
	layer_2_expert_out_sp2_ep7_tp0_pp0 [label="Expert Out L2 SP2 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep7_tp0_pp0 -> layer_2_expert_out_sp2_ep7_tp0_pp0
	layer_2_expert_sp2_ep7_tp1_pp0 [label="Expert L2 SP2 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep7_pp0 -> layer_2_expert_sp2_ep7_tp1_pp0
	layer_2_expert_out_sp2_ep7_tp1_pp0 [label="Expert Out L2 SP2 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep7_tp1_pp0 -> layer_2_expert_out_sp2_ep7_tp1_pp0
	layer_2_expert_sp2_ep7_tp2_pp0 [label="Expert L2 SP2 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep7_pp0 -> layer_2_expert_sp2_ep7_tp2_pp0
	layer_2_expert_out_sp2_ep7_tp2_pp0 [label="Expert Out L2 SP2 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep7_tp2_pp0 -> layer_2_expert_out_sp2_ep7_tp2_pp0
	layer_2_expert_sp2_ep7_tp3_pp0 [label="Expert L2 SP2 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep7_pp0 -> layer_2_expert_sp2_ep7_tp3_pp0
	layer_2_expert_out_sp2_ep7_tp3_pp0 [label="Expert Out L2 SP2 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep7_tp3_pp0 -> layer_2_expert_out_sp2_ep7_tp3_pp0
	layer_2_expert_ar_sp2_ep7_pp0 [label="Expert All-Reduce L2 SP2 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep7_tp0_pp0 -> layer_2_expert_ar_sp2_ep7_pp0
	layer_2_expert_out_sp2_ep7_tp1_pp0 -> layer_2_expert_ar_sp2_ep7_pp0
	layer_2_expert_out_sp2_ep7_tp2_pp0 -> layer_2_expert_ar_sp2_ep7_pp0
	layer_2_expert_out_sp2_ep7_tp3_pp0 -> layer_2_expert_ar_sp2_ep7_pp0
	layer_2_combine_sp2_ep7_pp0 [label="Token Combine L2 SP2 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep7_pp0 -> layer_2_combine_sp2_ep7_pp0
	layer_2_dispatch_sp2_ep8_pp0 [label="Token Dispatch L2 SP2 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep8_pp0 [style=dashed]
	layer_2_expert_sp2_ep8_tp0_pp0 [label="Expert L2 SP2 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep8_pp0 -> layer_2_expert_sp2_ep8_tp0_pp0
	layer_2_expert_out_sp2_ep8_tp0_pp0 [label="Expert Out L2 SP2 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep8_tp0_pp0 -> layer_2_expert_out_sp2_ep8_tp0_pp0
	layer_2_expert_sp2_ep8_tp1_pp0 [label="Expert L2 SP2 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep8_pp0 -> layer_2_expert_sp2_ep8_tp1_pp0
	layer_2_expert_out_sp2_ep8_tp1_pp0 [label="Expert Out L2 SP2 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep8_tp1_pp0 -> layer_2_expert_out_sp2_ep8_tp1_pp0
	layer_2_expert_sp2_ep8_tp2_pp0 [label="Expert L2 SP2 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep8_pp0 -> layer_2_expert_sp2_ep8_tp2_pp0
	layer_2_expert_out_sp2_ep8_tp2_pp0 [label="Expert Out L2 SP2 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep8_tp2_pp0 -> layer_2_expert_out_sp2_ep8_tp2_pp0
	layer_2_expert_sp2_ep8_tp3_pp0 [label="Expert L2 SP2 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep8_pp0 -> layer_2_expert_sp2_ep8_tp3_pp0
	layer_2_expert_out_sp2_ep8_tp3_pp0 [label="Expert Out L2 SP2 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep8_tp3_pp0 -> layer_2_expert_out_sp2_ep8_tp3_pp0
	layer_2_expert_ar_sp2_ep8_pp0 [label="Expert All-Reduce L2 SP2 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep8_tp0_pp0 -> layer_2_expert_ar_sp2_ep8_pp0
	layer_2_expert_out_sp2_ep8_tp1_pp0 -> layer_2_expert_ar_sp2_ep8_pp0
	layer_2_expert_out_sp2_ep8_tp2_pp0 -> layer_2_expert_ar_sp2_ep8_pp0
	layer_2_expert_out_sp2_ep8_tp3_pp0 -> layer_2_expert_ar_sp2_ep8_pp0
	layer_2_combine_sp2_ep8_pp0 [label="Token Combine L2 SP2 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep8_pp0 -> layer_2_combine_sp2_ep8_pp0
	layer_2_dispatch_sp2_ep9_pp0 [label="Token Dispatch L2 SP2 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep9_pp0 [style=dashed]
	layer_2_expert_sp2_ep9_tp0_pp0 [label="Expert L2 SP2 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep9_pp0 -> layer_2_expert_sp2_ep9_tp0_pp0
	layer_2_expert_out_sp2_ep9_tp0_pp0 [label="Expert Out L2 SP2 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep9_tp0_pp0 -> layer_2_expert_out_sp2_ep9_tp0_pp0
	layer_2_expert_sp2_ep9_tp1_pp0 [label="Expert L2 SP2 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep9_pp0 -> layer_2_expert_sp2_ep9_tp1_pp0
	layer_2_expert_out_sp2_ep9_tp1_pp0 [label="Expert Out L2 SP2 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep9_tp1_pp0 -> layer_2_expert_out_sp2_ep9_tp1_pp0
	layer_2_expert_sp2_ep9_tp2_pp0 [label="Expert L2 SP2 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep9_pp0 -> layer_2_expert_sp2_ep9_tp2_pp0
	layer_2_expert_out_sp2_ep9_tp2_pp0 [label="Expert Out L2 SP2 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep9_tp2_pp0 -> layer_2_expert_out_sp2_ep9_tp2_pp0
	layer_2_expert_sp2_ep9_tp3_pp0 [label="Expert L2 SP2 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep9_pp0 -> layer_2_expert_sp2_ep9_tp3_pp0
	layer_2_expert_out_sp2_ep9_tp3_pp0 [label="Expert Out L2 SP2 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep9_tp3_pp0 -> layer_2_expert_out_sp2_ep9_tp3_pp0
	layer_2_expert_ar_sp2_ep9_pp0 [label="Expert All-Reduce L2 SP2 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep9_tp0_pp0 -> layer_2_expert_ar_sp2_ep9_pp0
	layer_2_expert_out_sp2_ep9_tp1_pp0 -> layer_2_expert_ar_sp2_ep9_pp0
	layer_2_expert_out_sp2_ep9_tp2_pp0 -> layer_2_expert_ar_sp2_ep9_pp0
	layer_2_expert_out_sp2_ep9_tp3_pp0 -> layer_2_expert_ar_sp2_ep9_pp0
	layer_2_combine_sp2_ep9_pp0 [label="Token Combine L2 SP2 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep9_pp0 -> layer_2_combine_sp2_ep9_pp0
	layer_2_dispatch_sp2_ep10_pp0 [label="Token Dispatch L2 SP2 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep10_pp0 [style=dashed]
	layer_2_expert_sp2_ep10_tp0_pp0 [label="Expert L2 SP2 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep10_pp0 -> layer_2_expert_sp2_ep10_tp0_pp0
	layer_2_expert_out_sp2_ep10_tp0_pp0 [label="Expert Out L2 SP2 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep10_tp0_pp0 -> layer_2_expert_out_sp2_ep10_tp0_pp0
	layer_2_expert_sp2_ep10_tp1_pp0 [label="Expert L2 SP2 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep10_pp0 -> layer_2_expert_sp2_ep10_tp1_pp0
	layer_2_expert_out_sp2_ep10_tp1_pp0 [label="Expert Out L2 SP2 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep10_tp1_pp0 -> layer_2_expert_out_sp2_ep10_tp1_pp0
	layer_2_expert_sp2_ep10_tp2_pp0 [label="Expert L2 SP2 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep10_pp0 -> layer_2_expert_sp2_ep10_tp2_pp0
	layer_2_expert_out_sp2_ep10_tp2_pp0 [label="Expert Out L2 SP2 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep10_tp2_pp0 -> layer_2_expert_out_sp2_ep10_tp2_pp0
	layer_2_expert_sp2_ep10_tp3_pp0 [label="Expert L2 SP2 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep10_pp0 -> layer_2_expert_sp2_ep10_tp3_pp0
	layer_2_expert_out_sp2_ep10_tp3_pp0 [label="Expert Out L2 SP2 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep10_tp3_pp0 -> layer_2_expert_out_sp2_ep10_tp3_pp0
	layer_2_expert_ar_sp2_ep10_pp0 [label="Expert All-Reduce L2 SP2 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep10_tp0_pp0 -> layer_2_expert_ar_sp2_ep10_pp0
	layer_2_expert_out_sp2_ep10_tp1_pp0 -> layer_2_expert_ar_sp2_ep10_pp0
	layer_2_expert_out_sp2_ep10_tp2_pp0 -> layer_2_expert_ar_sp2_ep10_pp0
	layer_2_expert_out_sp2_ep10_tp3_pp0 -> layer_2_expert_ar_sp2_ep10_pp0
	layer_2_combine_sp2_ep10_pp0 [label="Token Combine L2 SP2 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep10_pp0 -> layer_2_combine_sp2_ep10_pp0
	layer_2_dispatch_sp2_ep11_pp0 [label="Token Dispatch L2 SP2 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep11_pp0 [style=dashed]
	layer_2_expert_sp2_ep11_tp0_pp0 [label="Expert L2 SP2 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep11_pp0 -> layer_2_expert_sp2_ep11_tp0_pp0
	layer_2_expert_out_sp2_ep11_tp0_pp0 [label="Expert Out L2 SP2 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep11_tp0_pp0 -> layer_2_expert_out_sp2_ep11_tp0_pp0
	layer_2_expert_sp2_ep11_tp1_pp0 [label="Expert L2 SP2 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep11_pp0 -> layer_2_expert_sp2_ep11_tp1_pp0
	layer_2_expert_out_sp2_ep11_tp1_pp0 [label="Expert Out L2 SP2 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep11_tp1_pp0 -> layer_2_expert_out_sp2_ep11_tp1_pp0
	layer_2_expert_sp2_ep11_tp2_pp0 [label="Expert L2 SP2 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep11_pp0 -> layer_2_expert_sp2_ep11_tp2_pp0
	layer_2_expert_out_sp2_ep11_tp2_pp0 [label="Expert Out L2 SP2 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep11_tp2_pp0 -> layer_2_expert_out_sp2_ep11_tp2_pp0
	layer_2_expert_sp2_ep11_tp3_pp0 [label="Expert L2 SP2 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep11_pp0 -> layer_2_expert_sp2_ep11_tp3_pp0
	layer_2_expert_out_sp2_ep11_tp3_pp0 [label="Expert Out L2 SP2 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep11_tp3_pp0 -> layer_2_expert_out_sp2_ep11_tp3_pp0
	layer_2_expert_ar_sp2_ep11_pp0 [label="Expert All-Reduce L2 SP2 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep11_tp0_pp0 -> layer_2_expert_ar_sp2_ep11_pp0
	layer_2_expert_out_sp2_ep11_tp1_pp0 -> layer_2_expert_ar_sp2_ep11_pp0
	layer_2_expert_out_sp2_ep11_tp2_pp0 -> layer_2_expert_ar_sp2_ep11_pp0
	layer_2_expert_out_sp2_ep11_tp3_pp0 -> layer_2_expert_ar_sp2_ep11_pp0
	layer_2_combine_sp2_ep11_pp0 [label="Token Combine L2 SP2 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep11_pp0 -> layer_2_combine_sp2_ep11_pp0
	layer_2_dispatch_sp2_ep12_pp0 [label="Token Dispatch L2 SP2 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep12_pp0 [style=dashed]
	layer_2_expert_sp2_ep12_tp0_pp0 [label="Expert L2 SP2 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep12_pp0 -> layer_2_expert_sp2_ep12_tp0_pp0
	layer_2_expert_out_sp2_ep12_tp0_pp0 [label="Expert Out L2 SP2 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep12_tp0_pp0 -> layer_2_expert_out_sp2_ep12_tp0_pp0
	layer_2_expert_sp2_ep12_tp1_pp0 [label="Expert L2 SP2 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep12_pp0 -> layer_2_expert_sp2_ep12_tp1_pp0
	layer_2_expert_out_sp2_ep12_tp1_pp0 [label="Expert Out L2 SP2 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep12_tp1_pp0 -> layer_2_expert_out_sp2_ep12_tp1_pp0
	layer_2_expert_sp2_ep12_tp2_pp0 [label="Expert L2 SP2 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep12_pp0 -> layer_2_expert_sp2_ep12_tp2_pp0
	layer_2_expert_out_sp2_ep12_tp2_pp0 [label="Expert Out L2 SP2 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep12_tp2_pp0 -> layer_2_expert_out_sp2_ep12_tp2_pp0
	layer_2_expert_sp2_ep12_tp3_pp0 [label="Expert L2 SP2 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep12_pp0 -> layer_2_expert_sp2_ep12_tp3_pp0
	layer_2_expert_out_sp2_ep12_tp3_pp0 [label="Expert Out L2 SP2 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep12_tp3_pp0 -> layer_2_expert_out_sp2_ep12_tp3_pp0
	layer_2_expert_ar_sp2_ep12_pp0 [label="Expert All-Reduce L2 SP2 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep12_tp0_pp0 -> layer_2_expert_ar_sp2_ep12_pp0
	layer_2_expert_out_sp2_ep12_tp1_pp0 -> layer_2_expert_ar_sp2_ep12_pp0
	layer_2_expert_out_sp2_ep12_tp2_pp0 -> layer_2_expert_ar_sp2_ep12_pp0
	layer_2_expert_out_sp2_ep12_tp3_pp0 -> layer_2_expert_ar_sp2_ep12_pp0
	layer_2_combine_sp2_ep12_pp0 [label="Token Combine L2 SP2 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep12_pp0 -> layer_2_combine_sp2_ep12_pp0
	layer_2_dispatch_sp2_ep13_pp0 [label="Token Dispatch L2 SP2 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep13_pp0 [style=dashed]
	layer_2_expert_sp2_ep13_tp0_pp0 [label="Expert L2 SP2 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep13_pp0 -> layer_2_expert_sp2_ep13_tp0_pp0
	layer_2_expert_out_sp2_ep13_tp0_pp0 [label="Expert Out L2 SP2 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep13_tp0_pp0 -> layer_2_expert_out_sp2_ep13_tp0_pp0
	layer_2_expert_sp2_ep13_tp1_pp0 [label="Expert L2 SP2 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep13_pp0 -> layer_2_expert_sp2_ep13_tp1_pp0
	layer_2_expert_out_sp2_ep13_tp1_pp0 [label="Expert Out L2 SP2 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep13_tp1_pp0 -> layer_2_expert_out_sp2_ep13_tp1_pp0
	layer_2_expert_sp2_ep13_tp2_pp0 [label="Expert L2 SP2 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep13_pp0 -> layer_2_expert_sp2_ep13_tp2_pp0
	layer_2_expert_out_sp2_ep13_tp2_pp0 [label="Expert Out L2 SP2 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep13_tp2_pp0 -> layer_2_expert_out_sp2_ep13_tp2_pp0
	layer_2_expert_sp2_ep13_tp3_pp0 [label="Expert L2 SP2 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep13_pp0 -> layer_2_expert_sp2_ep13_tp3_pp0
	layer_2_expert_out_sp2_ep13_tp3_pp0 [label="Expert Out L2 SP2 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep13_tp3_pp0 -> layer_2_expert_out_sp2_ep13_tp3_pp0
	layer_2_expert_ar_sp2_ep13_pp0 [label="Expert All-Reduce L2 SP2 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep13_tp0_pp0 -> layer_2_expert_ar_sp2_ep13_pp0
	layer_2_expert_out_sp2_ep13_tp1_pp0 -> layer_2_expert_ar_sp2_ep13_pp0
	layer_2_expert_out_sp2_ep13_tp2_pp0 -> layer_2_expert_ar_sp2_ep13_pp0
	layer_2_expert_out_sp2_ep13_tp3_pp0 -> layer_2_expert_ar_sp2_ep13_pp0
	layer_2_combine_sp2_ep13_pp0 [label="Token Combine L2 SP2 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep13_pp0 -> layer_2_combine_sp2_ep13_pp0
	layer_2_dispatch_sp2_ep14_pp0 [label="Token Dispatch L2 SP2 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep14_pp0 [style=dashed]
	layer_2_expert_sp2_ep14_tp0_pp0 [label="Expert L2 SP2 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep14_pp0 -> layer_2_expert_sp2_ep14_tp0_pp0
	layer_2_expert_out_sp2_ep14_tp0_pp0 [label="Expert Out L2 SP2 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep14_tp0_pp0 -> layer_2_expert_out_sp2_ep14_tp0_pp0
	layer_2_expert_sp2_ep14_tp1_pp0 [label="Expert L2 SP2 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep14_pp0 -> layer_2_expert_sp2_ep14_tp1_pp0
	layer_2_expert_out_sp2_ep14_tp1_pp0 [label="Expert Out L2 SP2 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep14_tp1_pp0 -> layer_2_expert_out_sp2_ep14_tp1_pp0
	layer_2_expert_sp2_ep14_tp2_pp0 [label="Expert L2 SP2 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep14_pp0 -> layer_2_expert_sp2_ep14_tp2_pp0
	layer_2_expert_out_sp2_ep14_tp2_pp0 [label="Expert Out L2 SP2 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep14_tp2_pp0 -> layer_2_expert_out_sp2_ep14_tp2_pp0
	layer_2_expert_sp2_ep14_tp3_pp0 [label="Expert L2 SP2 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep14_pp0 -> layer_2_expert_sp2_ep14_tp3_pp0
	layer_2_expert_out_sp2_ep14_tp3_pp0 [label="Expert Out L2 SP2 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep14_tp3_pp0 -> layer_2_expert_out_sp2_ep14_tp3_pp0
	layer_2_expert_ar_sp2_ep14_pp0 [label="Expert All-Reduce L2 SP2 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep14_tp0_pp0 -> layer_2_expert_ar_sp2_ep14_pp0
	layer_2_expert_out_sp2_ep14_tp1_pp0 -> layer_2_expert_ar_sp2_ep14_pp0
	layer_2_expert_out_sp2_ep14_tp2_pp0 -> layer_2_expert_ar_sp2_ep14_pp0
	layer_2_expert_out_sp2_ep14_tp3_pp0 -> layer_2_expert_ar_sp2_ep14_pp0
	layer_2_combine_sp2_ep14_pp0 [label="Token Combine L2 SP2 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep14_pp0 -> layer_2_combine_sp2_ep14_pp0
	layer_2_dispatch_sp2_ep15_pp0 [label="Token Dispatch L2 SP2 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp2_pp0 -> layer_2_dispatch_sp2_ep15_pp0 [style=dashed]
	layer_2_expert_sp2_ep15_tp0_pp0 [label="Expert L2 SP2 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep15_pp0 -> layer_2_expert_sp2_ep15_tp0_pp0
	layer_2_expert_out_sp2_ep15_tp0_pp0 [label="Expert Out L2 SP2 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep15_tp0_pp0 -> layer_2_expert_out_sp2_ep15_tp0_pp0
	layer_2_expert_sp2_ep15_tp1_pp0 [label="Expert L2 SP2 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep15_pp0 -> layer_2_expert_sp2_ep15_tp1_pp0
	layer_2_expert_out_sp2_ep15_tp1_pp0 [label="Expert Out L2 SP2 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep15_tp1_pp0 -> layer_2_expert_out_sp2_ep15_tp1_pp0
	layer_2_expert_sp2_ep15_tp2_pp0 [label="Expert L2 SP2 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep15_pp0 -> layer_2_expert_sp2_ep15_tp2_pp0
	layer_2_expert_out_sp2_ep15_tp2_pp0 [label="Expert Out L2 SP2 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep15_tp2_pp0 -> layer_2_expert_out_sp2_ep15_tp2_pp0
	layer_2_expert_sp2_ep15_tp3_pp0 [label="Expert L2 SP2 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp2_ep15_pp0 -> layer_2_expert_sp2_ep15_tp3_pp0
	layer_2_expert_out_sp2_ep15_tp3_pp0 [label="Expert Out L2 SP2 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp2_ep15_tp3_pp0 -> layer_2_expert_out_sp2_ep15_tp3_pp0
	layer_2_expert_ar_sp2_ep15_pp0 [label="Expert All-Reduce L2 SP2 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp2_ep15_tp0_pp0 -> layer_2_expert_ar_sp2_ep15_pp0
	layer_2_expert_out_sp2_ep15_tp1_pp0 -> layer_2_expert_ar_sp2_ep15_pp0
	layer_2_expert_out_sp2_ep15_tp2_pp0 -> layer_2_expert_ar_sp2_ep15_pp0
	layer_2_expert_out_sp2_ep15_tp3_pp0 -> layer_2_expert_ar_sp2_ep15_pp0
	layer_2_combine_sp2_ep15_pp0 [label="Token Combine L2 SP2 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp2_ep15_pp0 -> layer_2_combine_sp2_ep15_pp0
	layer_2_moe_all2all_sp2_pp0 [label="MoE All-to-All L2 SP2\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_2_combine_sp2_ep0_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep1_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep2_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep3_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep4_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep5_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep6_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep7_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep8_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep9_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep10_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep11_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep12_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep13_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep14_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_combine_sp2_ep15_pp0 -> layer_2_moe_all2all_sp2_pp0
	layer_2_mlp_out_sp2_pp0 [label="MoE Output L2 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_moe_all2all_sp2_pp0 -> layer_2_mlp_out_sp2_pp0
	layer_2_mlp_res_sp2_pp0 [label="MLP Residual L2 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_mlp_out_sp2_pp0 -> layer_2_mlp_res_sp2_pp0
	layer_2_attn_res_sp2_pp0 -> layer_2_mlp_res_sp2_pp0 [style=dashed]
	layer_2_norm_sp3_pp0 [label="LayerNorm L2 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_1_mlp_out_sp3_pp0 -> layer_2_norm_sp3_pp0
	layer_2_qkv_sp3_tp0_pp0 [label="QKV Proj L2 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp3_pp0 -> layer_2_qkv_sp3_tp0_pp0
	layer_2_attn_sp3_tp0_pp0 [label="Attention L2 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp3_tp0_pp0 -> layer_2_attn_sp3_tp0_pp0
	layer_2_attn_out_sp3_tp0_pp0 [label="Attn Out Proj L2 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp3_tp0_pp0 -> layer_2_attn_out_sp3_tp0_pp0
	layer_2_qkv_sp3_tp1_pp0 [label="QKV Proj L2 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp3_pp0 -> layer_2_qkv_sp3_tp1_pp0
	layer_2_attn_sp3_tp1_pp0 [label="Attention L2 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp3_tp1_pp0 -> layer_2_attn_sp3_tp1_pp0
	layer_2_attn_out_sp3_tp1_pp0 [label="Attn Out Proj L2 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp3_tp1_pp0 -> layer_2_attn_out_sp3_tp1_pp0
	layer_2_qkv_sp3_tp2_pp0 [label="QKV Proj L2 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp3_pp0 -> layer_2_qkv_sp3_tp2_pp0
	layer_2_attn_sp3_tp2_pp0 [label="Attention L2 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp3_tp2_pp0 -> layer_2_attn_sp3_tp2_pp0
	layer_2_attn_out_sp3_tp2_pp0 [label="Attn Out Proj L2 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp3_tp2_pp0 -> layer_2_attn_out_sp3_tp2_pp0
	layer_2_qkv_sp3_tp3_pp0 [label="QKV Proj L2 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_norm_sp3_pp0 -> layer_2_qkv_sp3_tp3_pp0
	layer_2_attn_sp3_tp3_pp0 [label="Attention L2 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_qkv_sp3_tp3_pp0 -> layer_2_attn_sp3_tp3_pp0
	layer_2_attn_out_sp3_tp3_pp0 [label="Attn Out Proj L2 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_2_attn_sp3_tp3_pp0 -> layer_2_attn_out_sp3_tp3_pp0
	layer_2_attn_ar_sp3_pp0 [label="Attention All-Reduce L2 SP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_attn_out_sp3_tp0_pp0 -> layer_2_attn_ar_sp3_pp0
	layer_2_attn_out_sp3_tp1_pp0 -> layer_2_attn_ar_sp3_pp0
	layer_2_attn_out_sp3_tp2_pp0 -> layer_2_attn_ar_sp3_pp0
	layer_2_attn_out_sp3_tp3_pp0 -> layer_2_attn_ar_sp3_pp0
	layer_2_attn_res_sp3_pp0 [label="Attention Residual L2 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_attn_ar_sp3_pp0 -> layer_2_attn_res_sp3_pp0
	layer_2_norm_sp3_pp0 -> layer_2_attn_res_sp3_pp0 [style=dashed]
	layer_2_post_norm_sp3_pp0 [label="Post-Attn Norm L2 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_attn_res_sp3_pp0 -> layer_2_post_norm_sp3_pp0
	layer_2_router_sp3_pp0 [label="MoE Router L2 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_2_post_norm_sp3_pp0 -> layer_2_router_sp3_pp0
	layer_2_dispatch_sp3_ep0_pp0 [label="Token Dispatch L2 SP3 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep0_pp0 [style=dashed]
	layer_2_expert_sp3_ep0_tp0_pp0 [label="Expert L2 SP3 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep0_pp0 -> layer_2_expert_sp3_ep0_tp0_pp0
	layer_2_expert_out_sp3_ep0_tp0_pp0 [label="Expert Out L2 SP3 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep0_tp0_pp0 -> layer_2_expert_out_sp3_ep0_tp0_pp0
	layer_2_expert_sp3_ep0_tp1_pp0 [label="Expert L2 SP3 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep0_pp0 -> layer_2_expert_sp3_ep0_tp1_pp0
	layer_2_expert_out_sp3_ep0_tp1_pp0 [label="Expert Out L2 SP3 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep0_tp1_pp0 -> layer_2_expert_out_sp3_ep0_tp1_pp0
	layer_2_expert_sp3_ep0_tp2_pp0 [label="Expert L2 SP3 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep0_pp0 -> layer_2_expert_sp3_ep0_tp2_pp0
	layer_2_expert_out_sp3_ep0_tp2_pp0 [label="Expert Out L2 SP3 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep0_tp2_pp0 -> layer_2_expert_out_sp3_ep0_tp2_pp0
	layer_2_expert_sp3_ep0_tp3_pp0 [label="Expert L2 SP3 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep0_pp0 -> layer_2_expert_sp3_ep0_tp3_pp0
	layer_2_expert_out_sp3_ep0_tp3_pp0 [label="Expert Out L2 SP3 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep0_tp3_pp0 -> layer_2_expert_out_sp3_ep0_tp3_pp0
	layer_2_expert_ar_sp3_ep0_pp0 [label="Expert All-Reduce L2 SP3 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep0_tp0_pp0 -> layer_2_expert_ar_sp3_ep0_pp0
	layer_2_expert_out_sp3_ep0_tp1_pp0 -> layer_2_expert_ar_sp3_ep0_pp0
	layer_2_expert_out_sp3_ep0_tp2_pp0 -> layer_2_expert_ar_sp3_ep0_pp0
	layer_2_expert_out_sp3_ep0_tp3_pp0 -> layer_2_expert_ar_sp3_ep0_pp0
	layer_2_combine_sp3_ep0_pp0 [label="Token Combine L2 SP3 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep0_pp0 -> layer_2_combine_sp3_ep0_pp0
	layer_2_dispatch_sp3_ep1_pp0 [label="Token Dispatch L2 SP3 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep1_pp0 [style=dashed]
	layer_2_expert_sp3_ep1_tp0_pp0 [label="Expert L2 SP3 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep1_pp0 -> layer_2_expert_sp3_ep1_tp0_pp0
	layer_2_expert_out_sp3_ep1_tp0_pp0 [label="Expert Out L2 SP3 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep1_tp0_pp0 -> layer_2_expert_out_sp3_ep1_tp0_pp0
	layer_2_expert_sp3_ep1_tp1_pp0 [label="Expert L2 SP3 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep1_pp0 -> layer_2_expert_sp3_ep1_tp1_pp0
	layer_2_expert_out_sp3_ep1_tp1_pp0 [label="Expert Out L2 SP3 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep1_tp1_pp0 -> layer_2_expert_out_sp3_ep1_tp1_pp0
	layer_2_expert_sp3_ep1_tp2_pp0 [label="Expert L2 SP3 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep1_pp0 -> layer_2_expert_sp3_ep1_tp2_pp0
	layer_2_expert_out_sp3_ep1_tp2_pp0 [label="Expert Out L2 SP3 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep1_tp2_pp0 -> layer_2_expert_out_sp3_ep1_tp2_pp0
	layer_2_expert_sp3_ep1_tp3_pp0 [label="Expert L2 SP3 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep1_pp0 -> layer_2_expert_sp3_ep1_tp3_pp0
	layer_2_expert_out_sp3_ep1_tp3_pp0 [label="Expert Out L2 SP3 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep1_tp3_pp0 -> layer_2_expert_out_sp3_ep1_tp3_pp0
	layer_2_expert_ar_sp3_ep1_pp0 [label="Expert All-Reduce L2 SP3 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep1_tp0_pp0 -> layer_2_expert_ar_sp3_ep1_pp0
	layer_2_expert_out_sp3_ep1_tp1_pp0 -> layer_2_expert_ar_sp3_ep1_pp0
	layer_2_expert_out_sp3_ep1_tp2_pp0 -> layer_2_expert_ar_sp3_ep1_pp0
	layer_2_expert_out_sp3_ep1_tp3_pp0 -> layer_2_expert_ar_sp3_ep1_pp0
	layer_2_combine_sp3_ep1_pp0 [label="Token Combine L2 SP3 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep1_pp0 -> layer_2_combine_sp3_ep1_pp0
	layer_2_dispatch_sp3_ep2_pp0 [label="Token Dispatch L2 SP3 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep2_pp0 [style=dashed]
	layer_2_expert_sp3_ep2_tp0_pp0 [label="Expert L2 SP3 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep2_pp0 -> layer_2_expert_sp3_ep2_tp0_pp0
	layer_2_expert_out_sp3_ep2_tp0_pp0 [label="Expert Out L2 SP3 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep2_tp0_pp0 -> layer_2_expert_out_sp3_ep2_tp0_pp0
	layer_2_expert_sp3_ep2_tp1_pp0 [label="Expert L2 SP3 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep2_pp0 -> layer_2_expert_sp3_ep2_tp1_pp0
	layer_2_expert_out_sp3_ep2_tp1_pp0 [label="Expert Out L2 SP3 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep2_tp1_pp0 -> layer_2_expert_out_sp3_ep2_tp1_pp0
	layer_2_expert_sp3_ep2_tp2_pp0 [label="Expert L2 SP3 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep2_pp0 -> layer_2_expert_sp3_ep2_tp2_pp0
	layer_2_expert_out_sp3_ep2_tp2_pp0 [label="Expert Out L2 SP3 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep2_tp2_pp0 -> layer_2_expert_out_sp3_ep2_tp2_pp0
	layer_2_expert_sp3_ep2_tp3_pp0 [label="Expert L2 SP3 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep2_pp0 -> layer_2_expert_sp3_ep2_tp3_pp0
	layer_2_expert_out_sp3_ep2_tp3_pp0 [label="Expert Out L2 SP3 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep2_tp3_pp0 -> layer_2_expert_out_sp3_ep2_tp3_pp0
	layer_2_expert_ar_sp3_ep2_pp0 [label="Expert All-Reduce L2 SP3 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep2_tp0_pp0 -> layer_2_expert_ar_sp3_ep2_pp0
	layer_2_expert_out_sp3_ep2_tp1_pp0 -> layer_2_expert_ar_sp3_ep2_pp0
	layer_2_expert_out_sp3_ep2_tp2_pp0 -> layer_2_expert_ar_sp3_ep2_pp0
	layer_2_expert_out_sp3_ep2_tp3_pp0 -> layer_2_expert_ar_sp3_ep2_pp0
	layer_2_combine_sp3_ep2_pp0 [label="Token Combine L2 SP3 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep2_pp0 -> layer_2_combine_sp3_ep2_pp0
	layer_2_dispatch_sp3_ep3_pp0 [label="Token Dispatch L2 SP3 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep3_pp0 [style=dashed]
	layer_2_expert_sp3_ep3_tp0_pp0 [label="Expert L2 SP3 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep3_pp0 -> layer_2_expert_sp3_ep3_tp0_pp0
	layer_2_expert_out_sp3_ep3_tp0_pp0 [label="Expert Out L2 SP3 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep3_tp0_pp0 -> layer_2_expert_out_sp3_ep3_tp0_pp0
	layer_2_expert_sp3_ep3_tp1_pp0 [label="Expert L2 SP3 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep3_pp0 -> layer_2_expert_sp3_ep3_tp1_pp0
	layer_2_expert_out_sp3_ep3_tp1_pp0 [label="Expert Out L2 SP3 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep3_tp1_pp0 -> layer_2_expert_out_sp3_ep3_tp1_pp0
	layer_2_expert_sp3_ep3_tp2_pp0 [label="Expert L2 SP3 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep3_pp0 -> layer_2_expert_sp3_ep3_tp2_pp0
	layer_2_expert_out_sp3_ep3_tp2_pp0 [label="Expert Out L2 SP3 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep3_tp2_pp0 -> layer_2_expert_out_sp3_ep3_tp2_pp0
	layer_2_expert_sp3_ep3_tp3_pp0 [label="Expert L2 SP3 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep3_pp0 -> layer_2_expert_sp3_ep3_tp3_pp0
	layer_2_expert_out_sp3_ep3_tp3_pp0 [label="Expert Out L2 SP3 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep3_tp3_pp0 -> layer_2_expert_out_sp3_ep3_tp3_pp0
	layer_2_expert_ar_sp3_ep3_pp0 [label="Expert All-Reduce L2 SP3 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep3_tp0_pp0 -> layer_2_expert_ar_sp3_ep3_pp0
	layer_2_expert_out_sp3_ep3_tp1_pp0 -> layer_2_expert_ar_sp3_ep3_pp0
	layer_2_expert_out_sp3_ep3_tp2_pp0 -> layer_2_expert_ar_sp3_ep3_pp0
	layer_2_expert_out_sp3_ep3_tp3_pp0 -> layer_2_expert_ar_sp3_ep3_pp0
	layer_2_combine_sp3_ep3_pp0 [label="Token Combine L2 SP3 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep3_pp0 -> layer_2_combine_sp3_ep3_pp0
	layer_2_dispatch_sp3_ep4_pp0 [label="Token Dispatch L2 SP3 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep4_pp0 [style=dashed]
	layer_2_expert_sp3_ep4_tp0_pp0 [label="Expert L2 SP3 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep4_pp0 -> layer_2_expert_sp3_ep4_tp0_pp0
	layer_2_expert_out_sp3_ep4_tp0_pp0 [label="Expert Out L2 SP3 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep4_tp0_pp0 -> layer_2_expert_out_sp3_ep4_tp0_pp0
	layer_2_expert_sp3_ep4_tp1_pp0 [label="Expert L2 SP3 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep4_pp0 -> layer_2_expert_sp3_ep4_tp1_pp0
	layer_2_expert_out_sp3_ep4_tp1_pp0 [label="Expert Out L2 SP3 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep4_tp1_pp0 -> layer_2_expert_out_sp3_ep4_tp1_pp0
	layer_2_expert_sp3_ep4_tp2_pp0 [label="Expert L2 SP3 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep4_pp0 -> layer_2_expert_sp3_ep4_tp2_pp0
	layer_2_expert_out_sp3_ep4_tp2_pp0 [label="Expert Out L2 SP3 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep4_tp2_pp0 -> layer_2_expert_out_sp3_ep4_tp2_pp0
	layer_2_expert_sp3_ep4_tp3_pp0 [label="Expert L2 SP3 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep4_pp0 -> layer_2_expert_sp3_ep4_tp3_pp0
	layer_2_expert_out_sp3_ep4_tp3_pp0 [label="Expert Out L2 SP3 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep4_tp3_pp0 -> layer_2_expert_out_sp3_ep4_tp3_pp0
	layer_2_expert_ar_sp3_ep4_pp0 [label="Expert All-Reduce L2 SP3 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep4_tp0_pp0 -> layer_2_expert_ar_sp3_ep4_pp0
	layer_2_expert_out_sp3_ep4_tp1_pp0 -> layer_2_expert_ar_sp3_ep4_pp0
	layer_2_expert_out_sp3_ep4_tp2_pp0 -> layer_2_expert_ar_sp3_ep4_pp0
	layer_2_expert_out_sp3_ep4_tp3_pp0 -> layer_2_expert_ar_sp3_ep4_pp0
	layer_2_combine_sp3_ep4_pp0 [label="Token Combine L2 SP3 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep4_pp0 -> layer_2_combine_sp3_ep4_pp0
	layer_2_dispatch_sp3_ep5_pp0 [label="Token Dispatch L2 SP3 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep5_pp0 [style=dashed]
	layer_2_expert_sp3_ep5_tp0_pp0 [label="Expert L2 SP3 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep5_pp0 -> layer_2_expert_sp3_ep5_tp0_pp0
	layer_2_expert_out_sp3_ep5_tp0_pp0 [label="Expert Out L2 SP3 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep5_tp0_pp0 -> layer_2_expert_out_sp3_ep5_tp0_pp0
	layer_2_expert_sp3_ep5_tp1_pp0 [label="Expert L2 SP3 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep5_pp0 -> layer_2_expert_sp3_ep5_tp1_pp0
	layer_2_expert_out_sp3_ep5_tp1_pp0 [label="Expert Out L2 SP3 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep5_tp1_pp0 -> layer_2_expert_out_sp3_ep5_tp1_pp0
	layer_2_expert_sp3_ep5_tp2_pp0 [label="Expert L2 SP3 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep5_pp0 -> layer_2_expert_sp3_ep5_tp2_pp0
	layer_2_expert_out_sp3_ep5_tp2_pp0 [label="Expert Out L2 SP3 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep5_tp2_pp0 -> layer_2_expert_out_sp3_ep5_tp2_pp0
	layer_2_expert_sp3_ep5_tp3_pp0 [label="Expert L2 SP3 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep5_pp0 -> layer_2_expert_sp3_ep5_tp3_pp0
	layer_2_expert_out_sp3_ep5_tp3_pp0 [label="Expert Out L2 SP3 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep5_tp3_pp0 -> layer_2_expert_out_sp3_ep5_tp3_pp0
	layer_2_expert_ar_sp3_ep5_pp0 [label="Expert All-Reduce L2 SP3 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep5_tp0_pp0 -> layer_2_expert_ar_sp3_ep5_pp0
	layer_2_expert_out_sp3_ep5_tp1_pp0 -> layer_2_expert_ar_sp3_ep5_pp0
	layer_2_expert_out_sp3_ep5_tp2_pp0 -> layer_2_expert_ar_sp3_ep5_pp0
	layer_2_expert_out_sp3_ep5_tp3_pp0 -> layer_2_expert_ar_sp3_ep5_pp0
	layer_2_combine_sp3_ep5_pp0 [label="Token Combine L2 SP3 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep5_pp0 -> layer_2_combine_sp3_ep5_pp0
	layer_2_dispatch_sp3_ep6_pp0 [label="Token Dispatch L2 SP3 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep6_pp0 [style=dashed]
	layer_2_expert_sp3_ep6_tp0_pp0 [label="Expert L2 SP3 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep6_pp0 -> layer_2_expert_sp3_ep6_tp0_pp0
	layer_2_expert_out_sp3_ep6_tp0_pp0 [label="Expert Out L2 SP3 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep6_tp0_pp0 -> layer_2_expert_out_sp3_ep6_tp0_pp0
	layer_2_expert_sp3_ep6_tp1_pp0 [label="Expert L2 SP3 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep6_pp0 -> layer_2_expert_sp3_ep6_tp1_pp0
	layer_2_expert_out_sp3_ep6_tp1_pp0 [label="Expert Out L2 SP3 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep6_tp1_pp0 -> layer_2_expert_out_sp3_ep6_tp1_pp0
	layer_2_expert_sp3_ep6_tp2_pp0 [label="Expert L2 SP3 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep6_pp0 -> layer_2_expert_sp3_ep6_tp2_pp0
	layer_2_expert_out_sp3_ep6_tp2_pp0 [label="Expert Out L2 SP3 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep6_tp2_pp0 -> layer_2_expert_out_sp3_ep6_tp2_pp0
	layer_2_expert_sp3_ep6_tp3_pp0 [label="Expert L2 SP3 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep6_pp0 -> layer_2_expert_sp3_ep6_tp3_pp0
	layer_2_expert_out_sp3_ep6_tp3_pp0 [label="Expert Out L2 SP3 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep6_tp3_pp0 -> layer_2_expert_out_sp3_ep6_tp3_pp0
	layer_2_expert_ar_sp3_ep6_pp0 [label="Expert All-Reduce L2 SP3 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep6_tp0_pp0 -> layer_2_expert_ar_sp3_ep6_pp0
	layer_2_expert_out_sp3_ep6_tp1_pp0 -> layer_2_expert_ar_sp3_ep6_pp0
	layer_2_expert_out_sp3_ep6_tp2_pp0 -> layer_2_expert_ar_sp3_ep6_pp0
	layer_2_expert_out_sp3_ep6_tp3_pp0 -> layer_2_expert_ar_sp3_ep6_pp0
	layer_2_combine_sp3_ep6_pp0 [label="Token Combine L2 SP3 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep6_pp0 -> layer_2_combine_sp3_ep6_pp0
	layer_2_dispatch_sp3_ep7_pp0 [label="Token Dispatch L2 SP3 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep7_pp0 [style=dashed]
	layer_2_expert_sp3_ep7_tp0_pp0 [label="Expert L2 SP3 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep7_pp0 -> layer_2_expert_sp3_ep7_tp0_pp0
	layer_2_expert_out_sp3_ep7_tp0_pp0 [label="Expert Out L2 SP3 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep7_tp0_pp0 -> layer_2_expert_out_sp3_ep7_tp0_pp0
	layer_2_expert_sp3_ep7_tp1_pp0 [label="Expert L2 SP3 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep7_pp0 -> layer_2_expert_sp3_ep7_tp1_pp0
	layer_2_expert_out_sp3_ep7_tp1_pp0 [label="Expert Out L2 SP3 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep7_tp1_pp0 -> layer_2_expert_out_sp3_ep7_tp1_pp0
	layer_2_expert_sp3_ep7_tp2_pp0 [label="Expert L2 SP3 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep7_pp0 -> layer_2_expert_sp3_ep7_tp2_pp0
	layer_2_expert_out_sp3_ep7_tp2_pp0 [label="Expert Out L2 SP3 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep7_tp2_pp0 -> layer_2_expert_out_sp3_ep7_tp2_pp0
	layer_2_expert_sp3_ep7_tp3_pp0 [label="Expert L2 SP3 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep7_pp0 -> layer_2_expert_sp3_ep7_tp3_pp0
	layer_2_expert_out_sp3_ep7_tp3_pp0 [label="Expert Out L2 SP3 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep7_tp3_pp0 -> layer_2_expert_out_sp3_ep7_tp3_pp0
	layer_2_expert_ar_sp3_ep7_pp0 [label="Expert All-Reduce L2 SP3 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep7_tp0_pp0 -> layer_2_expert_ar_sp3_ep7_pp0
	layer_2_expert_out_sp3_ep7_tp1_pp0 -> layer_2_expert_ar_sp3_ep7_pp0
	layer_2_expert_out_sp3_ep7_tp2_pp0 -> layer_2_expert_ar_sp3_ep7_pp0
	layer_2_expert_out_sp3_ep7_tp3_pp0 -> layer_2_expert_ar_sp3_ep7_pp0
	layer_2_combine_sp3_ep7_pp0 [label="Token Combine L2 SP3 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep7_pp0 -> layer_2_combine_sp3_ep7_pp0
	layer_2_dispatch_sp3_ep8_pp0 [label="Token Dispatch L2 SP3 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep8_pp0 [style=dashed]
	layer_2_expert_sp3_ep8_tp0_pp0 [label="Expert L2 SP3 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep8_pp0 -> layer_2_expert_sp3_ep8_tp0_pp0
	layer_2_expert_out_sp3_ep8_tp0_pp0 [label="Expert Out L2 SP3 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep8_tp0_pp0 -> layer_2_expert_out_sp3_ep8_tp0_pp0
	layer_2_expert_sp3_ep8_tp1_pp0 [label="Expert L2 SP3 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep8_pp0 -> layer_2_expert_sp3_ep8_tp1_pp0
	layer_2_expert_out_sp3_ep8_tp1_pp0 [label="Expert Out L2 SP3 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep8_tp1_pp0 -> layer_2_expert_out_sp3_ep8_tp1_pp0
	layer_2_expert_sp3_ep8_tp2_pp0 [label="Expert L2 SP3 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep8_pp0 -> layer_2_expert_sp3_ep8_tp2_pp0
	layer_2_expert_out_sp3_ep8_tp2_pp0 [label="Expert Out L2 SP3 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep8_tp2_pp0 -> layer_2_expert_out_sp3_ep8_tp2_pp0
	layer_2_expert_sp3_ep8_tp3_pp0 [label="Expert L2 SP3 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep8_pp0 -> layer_2_expert_sp3_ep8_tp3_pp0
	layer_2_expert_out_sp3_ep8_tp3_pp0 [label="Expert Out L2 SP3 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep8_tp3_pp0 -> layer_2_expert_out_sp3_ep8_tp3_pp0
	layer_2_expert_ar_sp3_ep8_pp0 [label="Expert All-Reduce L2 SP3 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep8_tp0_pp0 -> layer_2_expert_ar_sp3_ep8_pp0
	layer_2_expert_out_sp3_ep8_tp1_pp0 -> layer_2_expert_ar_sp3_ep8_pp0
	layer_2_expert_out_sp3_ep8_tp2_pp0 -> layer_2_expert_ar_sp3_ep8_pp0
	layer_2_expert_out_sp3_ep8_tp3_pp0 -> layer_2_expert_ar_sp3_ep8_pp0
	layer_2_combine_sp3_ep8_pp0 [label="Token Combine L2 SP3 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep8_pp0 -> layer_2_combine_sp3_ep8_pp0
	layer_2_dispatch_sp3_ep9_pp0 [label="Token Dispatch L2 SP3 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep9_pp0 [style=dashed]
	layer_2_expert_sp3_ep9_tp0_pp0 [label="Expert L2 SP3 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep9_pp0 -> layer_2_expert_sp3_ep9_tp0_pp0
	layer_2_expert_out_sp3_ep9_tp0_pp0 [label="Expert Out L2 SP3 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep9_tp0_pp0 -> layer_2_expert_out_sp3_ep9_tp0_pp0
	layer_2_expert_sp3_ep9_tp1_pp0 [label="Expert L2 SP3 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep9_pp0 -> layer_2_expert_sp3_ep9_tp1_pp0
	layer_2_expert_out_sp3_ep9_tp1_pp0 [label="Expert Out L2 SP3 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep9_tp1_pp0 -> layer_2_expert_out_sp3_ep9_tp1_pp0
	layer_2_expert_sp3_ep9_tp2_pp0 [label="Expert L2 SP3 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep9_pp0 -> layer_2_expert_sp3_ep9_tp2_pp0
	layer_2_expert_out_sp3_ep9_tp2_pp0 [label="Expert Out L2 SP3 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep9_tp2_pp0 -> layer_2_expert_out_sp3_ep9_tp2_pp0
	layer_2_expert_sp3_ep9_tp3_pp0 [label="Expert L2 SP3 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep9_pp0 -> layer_2_expert_sp3_ep9_tp3_pp0
	layer_2_expert_out_sp3_ep9_tp3_pp0 [label="Expert Out L2 SP3 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep9_tp3_pp0 -> layer_2_expert_out_sp3_ep9_tp3_pp0
	layer_2_expert_ar_sp3_ep9_pp0 [label="Expert All-Reduce L2 SP3 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep9_tp0_pp0 -> layer_2_expert_ar_sp3_ep9_pp0
	layer_2_expert_out_sp3_ep9_tp1_pp0 -> layer_2_expert_ar_sp3_ep9_pp0
	layer_2_expert_out_sp3_ep9_tp2_pp0 -> layer_2_expert_ar_sp3_ep9_pp0
	layer_2_expert_out_sp3_ep9_tp3_pp0 -> layer_2_expert_ar_sp3_ep9_pp0
	layer_2_combine_sp3_ep9_pp0 [label="Token Combine L2 SP3 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep9_pp0 -> layer_2_combine_sp3_ep9_pp0
	layer_2_dispatch_sp3_ep10_pp0 [label="Token Dispatch L2 SP3 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep10_pp0 [style=dashed]
	layer_2_expert_sp3_ep10_tp0_pp0 [label="Expert L2 SP3 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep10_pp0 -> layer_2_expert_sp3_ep10_tp0_pp0
	layer_2_expert_out_sp3_ep10_tp0_pp0 [label="Expert Out L2 SP3 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep10_tp0_pp0 -> layer_2_expert_out_sp3_ep10_tp0_pp0
	layer_2_expert_sp3_ep10_tp1_pp0 [label="Expert L2 SP3 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep10_pp0 -> layer_2_expert_sp3_ep10_tp1_pp0
	layer_2_expert_out_sp3_ep10_tp1_pp0 [label="Expert Out L2 SP3 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep10_tp1_pp0 -> layer_2_expert_out_sp3_ep10_tp1_pp0
	layer_2_expert_sp3_ep10_tp2_pp0 [label="Expert L2 SP3 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep10_pp0 -> layer_2_expert_sp3_ep10_tp2_pp0
	layer_2_expert_out_sp3_ep10_tp2_pp0 [label="Expert Out L2 SP3 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep10_tp2_pp0 -> layer_2_expert_out_sp3_ep10_tp2_pp0
	layer_2_expert_sp3_ep10_tp3_pp0 [label="Expert L2 SP3 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep10_pp0 -> layer_2_expert_sp3_ep10_tp3_pp0
	layer_2_expert_out_sp3_ep10_tp3_pp0 [label="Expert Out L2 SP3 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep10_tp3_pp0 -> layer_2_expert_out_sp3_ep10_tp3_pp0
	layer_2_expert_ar_sp3_ep10_pp0 [label="Expert All-Reduce L2 SP3 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep10_tp0_pp0 -> layer_2_expert_ar_sp3_ep10_pp0
	layer_2_expert_out_sp3_ep10_tp1_pp0 -> layer_2_expert_ar_sp3_ep10_pp0
	layer_2_expert_out_sp3_ep10_tp2_pp0 -> layer_2_expert_ar_sp3_ep10_pp0
	layer_2_expert_out_sp3_ep10_tp3_pp0 -> layer_2_expert_ar_sp3_ep10_pp0
	layer_2_combine_sp3_ep10_pp0 [label="Token Combine L2 SP3 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep10_pp0 -> layer_2_combine_sp3_ep10_pp0
	layer_2_dispatch_sp3_ep11_pp0 [label="Token Dispatch L2 SP3 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep11_pp0 [style=dashed]
	layer_2_expert_sp3_ep11_tp0_pp0 [label="Expert L2 SP3 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep11_pp0 -> layer_2_expert_sp3_ep11_tp0_pp0
	layer_2_expert_out_sp3_ep11_tp0_pp0 [label="Expert Out L2 SP3 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep11_tp0_pp0 -> layer_2_expert_out_sp3_ep11_tp0_pp0
	layer_2_expert_sp3_ep11_tp1_pp0 [label="Expert L2 SP3 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep11_pp0 -> layer_2_expert_sp3_ep11_tp1_pp0
	layer_2_expert_out_sp3_ep11_tp1_pp0 [label="Expert Out L2 SP3 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep11_tp1_pp0 -> layer_2_expert_out_sp3_ep11_tp1_pp0
	layer_2_expert_sp3_ep11_tp2_pp0 [label="Expert L2 SP3 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep11_pp0 -> layer_2_expert_sp3_ep11_tp2_pp0
	layer_2_expert_out_sp3_ep11_tp2_pp0 [label="Expert Out L2 SP3 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep11_tp2_pp0 -> layer_2_expert_out_sp3_ep11_tp2_pp0
	layer_2_expert_sp3_ep11_tp3_pp0 [label="Expert L2 SP3 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep11_pp0 -> layer_2_expert_sp3_ep11_tp3_pp0
	layer_2_expert_out_sp3_ep11_tp3_pp0 [label="Expert Out L2 SP3 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep11_tp3_pp0 -> layer_2_expert_out_sp3_ep11_tp3_pp0
	layer_2_expert_ar_sp3_ep11_pp0 [label="Expert All-Reduce L2 SP3 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep11_tp0_pp0 -> layer_2_expert_ar_sp3_ep11_pp0
	layer_2_expert_out_sp3_ep11_tp1_pp0 -> layer_2_expert_ar_sp3_ep11_pp0
	layer_2_expert_out_sp3_ep11_tp2_pp0 -> layer_2_expert_ar_sp3_ep11_pp0
	layer_2_expert_out_sp3_ep11_tp3_pp0 -> layer_2_expert_ar_sp3_ep11_pp0
	layer_2_combine_sp3_ep11_pp0 [label="Token Combine L2 SP3 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep11_pp0 -> layer_2_combine_sp3_ep11_pp0
	layer_2_dispatch_sp3_ep12_pp0 [label="Token Dispatch L2 SP3 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep12_pp0 [style=dashed]
	layer_2_expert_sp3_ep12_tp0_pp0 [label="Expert L2 SP3 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep12_pp0 -> layer_2_expert_sp3_ep12_tp0_pp0
	layer_2_expert_out_sp3_ep12_tp0_pp0 [label="Expert Out L2 SP3 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep12_tp0_pp0 -> layer_2_expert_out_sp3_ep12_tp0_pp0
	layer_2_expert_sp3_ep12_tp1_pp0 [label="Expert L2 SP3 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep12_pp0 -> layer_2_expert_sp3_ep12_tp1_pp0
	layer_2_expert_out_sp3_ep12_tp1_pp0 [label="Expert Out L2 SP3 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep12_tp1_pp0 -> layer_2_expert_out_sp3_ep12_tp1_pp0
	layer_2_expert_sp3_ep12_tp2_pp0 [label="Expert L2 SP3 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep12_pp0 -> layer_2_expert_sp3_ep12_tp2_pp0
	layer_2_expert_out_sp3_ep12_tp2_pp0 [label="Expert Out L2 SP3 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep12_tp2_pp0 -> layer_2_expert_out_sp3_ep12_tp2_pp0
	layer_2_expert_sp3_ep12_tp3_pp0 [label="Expert L2 SP3 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep12_pp0 -> layer_2_expert_sp3_ep12_tp3_pp0
	layer_2_expert_out_sp3_ep12_tp3_pp0 [label="Expert Out L2 SP3 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep12_tp3_pp0 -> layer_2_expert_out_sp3_ep12_tp3_pp0
	layer_2_expert_ar_sp3_ep12_pp0 [label="Expert All-Reduce L2 SP3 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep12_tp0_pp0 -> layer_2_expert_ar_sp3_ep12_pp0
	layer_2_expert_out_sp3_ep12_tp1_pp0 -> layer_2_expert_ar_sp3_ep12_pp0
	layer_2_expert_out_sp3_ep12_tp2_pp0 -> layer_2_expert_ar_sp3_ep12_pp0
	layer_2_expert_out_sp3_ep12_tp3_pp0 -> layer_2_expert_ar_sp3_ep12_pp0
	layer_2_combine_sp3_ep12_pp0 [label="Token Combine L2 SP3 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep12_pp0 -> layer_2_combine_sp3_ep12_pp0
	layer_2_dispatch_sp3_ep13_pp0 [label="Token Dispatch L2 SP3 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep13_pp0 [style=dashed]
	layer_2_expert_sp3_ep13_tp0_pp0 [label="Expert L2 SP3 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep13_pp0 -> layer_2_expert_sp3_ep13_tp0_pp0
	layer_2_expert_out_sp3_ep13_tp0_pp0 [label="Expert Out L2 SP3 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep13_tp0_pp0 -> layer_2_expert_out_sp3_ep13_tp0_pp0
	layer_2_expert_sp3_ep13_tp1_pp0 [label="Expert L2 SP3 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep13_pp0 -> layer_2_expert_sp3_ep13_tp1_pp0
	layer_2_expert_out_sp3_ep13_tp1_pp0 [label="Expert Out L2 SP3 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep13_tp1_pp0 -> layer_2_expert_out_sp3_ep13_tp1_pp0
	layer_2_expert_sp3_ep13_tp2_pp0 [label="Expert L2 SP3 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep13_pp0 -> layer_2_expert_sp3_ep13_tp2_pp0
	layer_2_expert_out_sp3_ep13_tp2_pp0 [label="Expert Out L2 SP3 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep13_tp2_pp0 -> layer_2_expert_out_sp3_ep13_tp2_pp0
	layer_2_expert_sp3_ep13_tp3_pp0 [label="Expert L2 SP3 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep13_pp0 -> layer_2_expert_sp3_ep13_tp3_pp0
	layer_2_expert_out_sp3_ep13_tp3_pp0 [label="Expert Out L2 SP3 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep13_tp3_pp0 -> layer_2_expert_out_sp3_ep13_tp3_pp0
	layer_2_expert_ar_sp3_ep13_pp0 [label="Expert All-Reduce L2 SP3 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep13_tp0_pp0 -> layer_2_expert_ar_sp3_ep13_pp0
	layer_2_expert_out_sp3_ep13_tp1_pp0 -> layer_2_expert_ar_sp3_ep13_pp0
	layer_2_expert_out_sp3_ep13_tp2_pp0 -> layer_2_expert_ar_sp3_ep13_pp0
	layer_2_expert_out_sp3_ep13_tp3_pp0 -> layer_2_expert_ar_sp3_ep13_pp0
	layer_2_combine_sp3_ep13_pp0 [label="Token Combine L2 SP3 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep13_pp0 -> layer_2_combine_sp3_ep13_pp0
	layer_2_dispatch_sp3_ep14_pp0 [label="Token Dispatch L2 SP3 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep14_pp0 [style=dashed]
	layer_2_expert_sp3_ep14_tp0_pp0 [label="Expert L2 SP3 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep14_pp0 -> layer_2_expert_sp3_ep14_tp0_pp0
	layer_2_expert_out_sp3_ep14_tp0_pp0 [label="Expert Out L2 SP3 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep14_tp0_pp0 -> layer_2_expert_out_sp3_ep14_tp0_pp0
	layer_2_expert_sp3_ep14_tp1_pp0 [label="Expert L2 SP3 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep14_pp0 -> layer_2_expert_sp3_ep14_tp1_pp0
	layer_2_expert_out_sp3_ep14_tp1_pp0 [label="Expert Out L2 SP3 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep14_tp1_pp0 -> layer_2_expert_out_sp3_ep14_tp1_pp0
	layer_2_expert_sp3_ep14_tp2_pp0 [label="Expert L2 SP3 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep14_pp0 -> layer_2_expert_sp3_ep14_tp2_pp0
	layer_2_expert_out_sp3_ep14_tp2_pp0 [label="Expert Out L2 SP3 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep14_tp2_pp0 -> layer_2_expert_out_sp3_ep14_tp2_pp0
	layer_2_expert_sp3_ep14_tp3_pp0 [label="Expert L2 SP3 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep14_pp0 -> layer_2_expert_sp3_ep14_tp3_pp0
	layer_2_expert_out_sp3_ep14_tp3_pp0 [label="Expert Out L2 SP3 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep14_tp3_pp0 -> layer_2_expert_out_sp3_ep14_tp3_pp0
	layer_2_expert_ar_sp3_ep14_pp0 [label="Expert All-Reduce L2 SP3 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep14_tp0_pp0 -> layer_2_expert_ar_sp3_ep14_pp0
	layer_2_expert_out_sp3_ep14_tp1_pp0 -> layer_2_expert_ar_sp3_ep14_pp0
	layer_2_expert_out_sp3_ep14_tp2_pp0 -> layer_2_expert_ar_sp3_ep14_pp0
	layer_2_expert_out_sp3_ep14_tp3_pp0 -> layer_2_expert_ar_sp3_ep14_pp0
	layer_2_combine_sp3_ep14_pp0 [label="Token Combine L2 SP3 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep14_pp0 -> layer_2_combine_sp3_ep14_pp0
	layer_2_dispatch_sp3_ep15_pp0 [label="Token Dispatch L2 SP3 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_2_router_sp3_pp0 -> layer_2_dispatch_sp3_ep15_pp0 [style=dashed]
	layer_2_expert_sp3_ep15_tp0_pp0 [label="Expert L2 SP3 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep15_pp0 -> layer_2_expert_sp3_ep15_tp0_pp0
	layer_2_expert_out_sp3_ep15_tp0_pp0 [label="Expert Out L2 SP3 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep15_tp0_pp0 -> layer_2_expert_out_sp3_ep15_tp0_pp0
	layer_2_expert_sp3_ep15_tp1_pp0 [label="Expert L2 SP3 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep15_pp0 -> layer_2_expert_sp3_ep15_tp1_pp0
	layer_2_expert_out_sp3_ep15_tp1_pp0 [label="Expert Out L2 SP3 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep15_tp1_pp0 -> layer_2_expert_out_sp3_ep15_tp1_pp0
	layer_2_expert_sp3_ep15_tp2_pp0 [label="Expert L2 SP3 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep15_pp0 -> layer_2_expert_sp3_ep15_tp2_pp0
	layer_2_expert_out_sp3_ep15_tp2_pp0 [label="Expert Out L2 SP3 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep15_tp2_pp0 -> layer_2_expert_out_sp3_ep15_tp2_pp0
	layer_2_expert_sp3_ep15_tp3_pp0 [label="Expert L2 SP3 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_dispatch_sp3_ep15_pp0 -> layer_2_expert_sp3_ep15_tp3_pp0
	layer_2_expert_out_sp3_ep15_tp3_pp0 [label="Expert Out L2 SP3 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_2_expert_sp3_ep15_tp3_pp0 -> layer_2_expert_out_sp3_ep15_tp3_pp0
	layer_2_expert_ar_sp3_ep15_pp0 [label="Expert All-Reduce L2 SP3 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_2_expert_out_sp3_ep15_tp0_pp0 -> layer_2_expert_ar_sp3_ep15_pp0
	layer_2_expert_out_sp3_ep15_tp1_pp0 -> layer_2_expert_ar_sp3_ep15_pp0
	layer_2_expert_out_sp3_ep15_tp2_pp0 -> layer_2_expert_ar_sp3_ep15_pp0
	layer_2_expert_out_sp3_ep15_tp3_pp0 -> layer_2_expert_ar_sp3_ep15_pp0
	layer_2_combine_sp3_ep15_pp0 [label="Token Combine L2 SP3 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_2_expert_ar_sp3_ep15_pp0 -> layer_2_combine_sp3_ep15_pp0
	layer_2_moe_all2all_sp3_pp0 [label="MoE All-to-All L2 SP3\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_2_combine_sp3_ep0_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep1_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep2_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep3_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep4_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep5_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep6_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep7_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep8_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep9_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep10_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep11_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep12_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep13_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep14_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_combine_sp3_ep15_pp0 -> layer_2_moe_all2all_sp3_pp0
	layer_2_mlp_out_sp3_pp0 [label="MoE Output L2 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_moe_all2all_sp3_pp0 -> layer_2_mlp_out_sp3_pp0
	layer_2_mlp_res_sp3_pp0 [label="MLP Residual L2 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_mlp_out_sp3_pp0 -> layer_2_mlp_res_sp3_pp0
	layer_2_attn_res_sp3_pp0 -> layer_2_mlp_res_sp3_pp0 [style=dashed]
	layer_3_norm_sp0_pp0 [label="LayerNorm L3 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_mlp_out_sp0_pp0 -> layer_3_norm_sp0_pp0
	layer_3_qkv_sp0_tp0_pp0 [label="QKV Proj L3 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp0_pp0 -> layer_3_qkv_sp0_tp0_pp0
	layer_3_attn_sp0_tp0_pp0 [label="Attention L3 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp0_tp0_pp0 -> layer_3_attn_sp0_tp0_pp0
	layer_3_attn_out_sp0_tp0_pp0 [label="Attn Out Proj L3 SP0 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp0_tp0_pp0 -> layer_3_attn_out_sp0_tp0_pp0
	layer_3_qkv_sp0_tp1_pp0 [label="QKV Proj L3 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp0_pp0 -> layer_3_qkv_sp0_tp1_pp0
	layer_3_attn_sp0_tp1_pp0 [label="Attention L3 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp0_tp1_pp0 -> layer_3_attn_sp0_tp1_pp0
	layer_3_attn_out_sp0_tp1_pp0 [label="Attn Out Proj L3 SP0 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp0_tp1_pp0 -> layer_3_attn_out_sp0_tp1_pp0
	layer_3_qkv_sp0_tp2_pp0 [label="QKV Proj L3 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp0_pp0 -> layer_3_qkv_sp0_tp2_pp0
	layer_3_attn_sp0_tp2_pp0 [label="Attention L3 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp0_tp2_pp0 -> layer_3_attn_sp0_tp2_pp0
	layer_3_attn_out_sp0_tp2_pp0 [label="Attn Out Proj L3 SP0 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp0_tp2_pp0 -> layer_3_attn_out_sp0_tp2_pp0
	layer_3_qkv_sp0_tp3_pp0 [label="QKV Proj L3 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp0_pp0 -> layer_3_qkv_sp0_tp3_pp0
	layer_3_attn_sp0_tp3_pp0 [label="Attention L3 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp0_tp3_pp0 -> layer_3_attn_sp0_tp3_pp0
	layer_3_attn_out_sp0_tp3_pp0 [label="Attn Out Proj L3 SP0 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp0_tp3_pp0 -> layer_3_attn_out_sp0_tp3_pp0
	layer_3_attn_ar_sp0_pp0 [label="Attention All-Reduce L3 SP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_attn_out_sp0_tp0_pp0 -> layer_3_attn_ar_sp0_pp0
	layer_3_attn_out_sp0_tp1_pp0 -> layer_3_attn_ar_sp0_pp0
	layer_3_attn_out_sp0_tp2_pp0 -> layer_3_attn_ar_sp0_pp0
	layer_3_attn_out_sp0_tp3_pp0 -> layer_3_attn_ar_sp0_pp0
	layer_3_attn_res_sp0_pp0 [label="Attention Residual L3 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_attn_ar_sp0_pp0 -> layer_3_attn_res_sp0_pp0
	layer_3_norm_sp0_pp0 -> layer_3_attn_res_sp0_pp0 [style=dashed]
	layer_3_post_norm_sp0_pp0 [label="Post-Attn Norm L3 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_attn_res_sp0_pp0 -> layer_3_post_norm_sp0_pp0
	layer_3_router_sp0_pp0 [label="MoE Router L3 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_3_post_norm_sp0_pp0 -> layer_3_router_sp0_pp0
	layer_3_dispatch_sp0_ep0_pp0 [label="Token Dispatch L3 SP0 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep0_pp0 [style=dashed]
	layer_3_expert_sp0_ep0_tp0_pp0 [label="Expert L3 SP0 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep0_pp0 -> layer_3_expert_sp0_ep0_tp0_pp0
	layer_3_expert_out_sp0_ep0_tp0_pp0 [label="Expert Out L3 SP0 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep0_tp0_pp0 -> layer_3_expert_out_sp0_ep0_tp0_pp0
	layer_3_expert_sp0_ep0_tp1_pp0 [label="Expert L3 SP0 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep0_pp0 -> layer_3_expert_sp0_ep0_tp1_pp0
	layer_3_expert_out_sp0_ep0_tp1_pp0 [label="Expert Out L3 SP0 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep0_tp1_pp0 -> layer_3_expert_out_sp0_ep0_tp1_pp0
	layer_3_expert_sp0_ep0_tp2_pp0 [label="Expert L3 SP0 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep0_pp0 -> layer_3_expert_sp0_ep0_tp2_pp0
	layer_3_expert_out_sp0_ep0_tp2_pp0 [label="Expert Out L3 SP0 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep0_tp2_pp0 -> layer_3_expert_out_sp0_ep0_tp2_pp0
	layer_3_expert_sp0_ep0_tp3_pp0 [label="Expert L3 SP0 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep0_pp0 -> layer_3_expert_sp0_ep0_tp3_pp0
	layer_3_expert_out_sp0_ep0_tp3_pp0 [label="Expert Out L3 SP0 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep0_tp3_pp0 -> layer_3_expert_out_sp0_ep0_tp3_pp0
	layer_3_expert_ar_sp0_ep0_pp0 [label="Expert All-Reduce L3 SP0 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep0_tp0_pp0 -> layer_3_expert_ar_sp0_ep0_pp0
	layer_3_expert_out_sp0_ep0_tp1_pp0 -> layer_3_expert_ar_sp0_ep0_pp0
	layer_3_expert_out_sp0_ep0_tp2_pp0 -> layer_3_expert_ar_sp0_ep0_pp0
	layer_3_expert_out_sp0_ep0_tp3_pp0 -> layer_3_expert_ar_sp0_ep0_pp0
	layer_3_combine_sp0_ep0_pp0 [label="Token Combine L3 SP0 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep0_pp0 -> layer_3_combine_sp0_ep0_pp0
	layer_3_dispatch_sp0_ep1_pp0 [label="Token Dispatch L3 SP0 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep1_pp0 [style=dashed]
	layer_3_expert_sp0_ep1_tp0_pp0 [label="Expert L3 SP0 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep1_pp0 -> layer_3_expert_sp0_ep1_tp0_pp0
	layer_3_expert_out_sp0_ep1_tp0_pp0 [label="Expert Out L3 SP0 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep1_tp0_pp0 -> layer_3_expert_out_sp0_ep1_tp0_pp0
	layer_3_expert_sp0_ep1_tp1_pp0 [label="Expert L3 SP0 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep1_pp0 -> layer_3_expert_sp0_ep1_tp1_pp0
	layer_3_expert_out_sp0_ep1_tp1_pp0 [label="Expert Out L3 SP0 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep1_tp1_pp0 -> layer_3_expert_out_sp0_ep1_tp1_pp0
	layer_3_expert_sp0_ep1_tp2_pp0 [label="Expert L3 SP0 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep1_pp0 -> layer_3_expert_sp0_ep1_tp2_pp0
	layer_3_expert_out_sp0_ep1_tp2_pp0 [label="Expert Out L3 SP0 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep1_tp2_pp0 -> layer_3_expert_out_sp0_ep1_tp2_pp0
	layer_3_expert_sp0_ep1_tp3_pp0 [label="Expert L3 SP0 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep1_pp0 -> layer_3_expert_sp0_ep1_tp3_pp0
	layer_3_expert_out_sp0_ep1_tp3_pp0 [label="Expert Out L3 SP0 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep1_tp3_pp0 -> layer_3_expert_out_sp0_ep1_tp3_pp0
	layer_3_expert_ar_sp0_ep1_pp0 [label="Expert All-Reduce L3 SP0 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep1_tp0_pp0 -> layer_3_expert_ar_sp0_ep1_pp0
	layer_3_expert_out_sp0_ep1_tp1_pp0 -> layer_3_expert_ar_sp0_ep1_pp0
	layer_3_expert_out_sp0_ep1_tp2_pp0 -> layer_3_expert_ar_sp0_ep1_pp0
	layer_3_expert_out_sp0_ep1_tp3_pp0 -> layer_3_expert_ar_sp0_ep1_pp0
	layer_3_combine_sp0_ep1_pp0 [label="Token Combine L3 SP0 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep1_pp0 -> layer_3_combine_sp0_ep1_pp0
	layer_3_dispatch_sp0_ep2_pp0 [label="Token Dispatch L3 SP0 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep2_pp0 [style=dashed]
	layer_3_expert_sp0_ep2_tp0_pp0 [label="Expert L3 SP0 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep2_pp0 -> layer_3_expert_sp0_ep2_tp0_pp0
	layer_3_expert_out_sp0_ep2_tp0_pp0 [label="Expert Out L3 SP0 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep2_tp0_pp0 -> layer_3_expert_out_sp0_ep2_tp0_pp0
	layer_3_expert_sp0_ep2_tp1_pp0 [label="Expert L3 SP0 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep2_pp0 -> layer_3_expert_sp0_ep2_tp1_pp0
	layer_3_expert_out_sp0_ep2_tp1_pp0 [label="Expert Out L3 SP0 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep2_tp1_pp0 -> layer_3_expert_out_sp0_ep2_tp1_pp0
	layer_3_expert_sp0_ep2_tp2_pp0 [label="Expert L3 SP0 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep2_pp0 -> layer_3_expert_sp0_ep2_tp2_pp0
	layer_3_expert_out_sp0_ep2_tp2_pp0 [label="Expert Out L3 SP0 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep2_tp2_pp0 -> layer_3_expert_out_sp0_ep2_tp2_pp0
	layer_3_expert_sp0_ep2_tp3_pp0 [label="Expert L3 SP0 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep2_pp0 -> layer_3_expert_sp0_ep2_tp3_pp0
	layer_3_expert_out_sp0_ep2_tp3_pp0 [label="Expert Out L3 SP0 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep2_tp3_pp0 -> layer_3_expert_out_sp0_ep2_tp3_pp0
	layer_3_expert_ar_sp0_ep2_pp0 [label="Expert All-Reduce L3 SP0 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep2_tp0_pp0 -> layer_3_expert_ar_sp0_ep2_pp0
	layer_3_expert_out_sp0_ep2_tp1_pp0 -> layer_3_expert_ar_sp0_ep2_pp0
	layer_3_expert_out_sp0_ep2_tp2_pp0 -> layer_3_expert_ar_sp0_ep2_pp0
	layer_3_expert_out_sp0_ep2_tp3_pp0 -> layer_3_expert_ar_sp0_ep2_pp0
	layer_3_combine_sp0_ep2_pp0 [label="Token Combine L3 SP0 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep2_pp0 -> layer_3_combine_sp0_ep2_pp0
	layer_3_dispatch_sp0_ep3_pp0 [label="Token Dispatch L3 SP0 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep3_pp0 [style=dashed]
	layer_3_expert_sp0_ep3_tp0_pp0 [label="Expert L3 SP0 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep3_pp0 -> layer_3_expert_sp0_ep3_tp0_pp0
	layer_3_expert_out_sp0_ep3_tp0_pp0 [label="Expert Out L3 SP0 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep3_tp0_pp0 -> layer_3_expert_out_sp0_ep3_tp0_pp0
	layer_3_expert_sp0_ep3_tp1_pp0 [label="Expert L3 SP0 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep3_pp0 -> layer_3_expert_sp0_ep3_tp1_pp0
	layer_3_expert_out_sp0_ep3_tp1_pp0 [label="Expert Out L3 SP0 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep3_tp1_pp0 -> layer_3_expert_out_sp0_ep3_tp1_pp0
	layer_3_expert_sp0_ep3_tp2_pp0 [label="Expert L3 SP0 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep3_pp0 -> layer_3_expert_sp0_ep3_tp2_pp0
	layer_3_expert_out_sp0_ep3_tp2_pp0 [label="Expert Out L3 SP0 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep3_tp2_pp0 -> layer_3_expert_out_sp0_ep3_tp2_pp0
	layer_3_expert_sp0_ep3_tp3_pp0 [label="Expert L3 SP0 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep3_pp0 -> layer_3_expert_sp0_ep3_tp3_pp0
	layer_3_expert_out_sp0_ep3_tp3_pp0 [label="Expert Out L3 SP0 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep3_tp3_pp0 -> layer_3_expert_out_sp0_ep3_tp3_pp0
	layer_3_expert_ar_sp0_ep3_pp0 [label="Expert All-Reduce L3 SP0 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep3_tp0_pp0 -> layer_3_expert_ar_sp0_ep3_pp0
	layer_3_expert_out_sp0_ep3_tp1_pp0 -> layer_3_expert_ar_sp0_ep3_pp0
	layer_3_expert_out_sp0_ep3_tp2_pp0 -> layer_3_expert_ar_sp0_ep3_pp0
	layer_3_expert_out_sp0_ep3_tp3_pp0 -> layer_3_expert_ar_sp0_ep3_pp0
	layer_3_combine_sp0_ep3_pp0 [label="Token Combine L3 SP0 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep3_pp0 -> layer_3_combine_sp0_ep3_pp0
	layer_3_dispatch_sp0_ep4_pp0 [label="Token Dispatch L3 SP0 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep4_pp0 [style=dashed]
	layer_3_expert_sp0_ep4_tp0_pp0 [label="Expert L3 SP0 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep4_pp0 -> layer_3_expert_sp0_ep4_tp0_pp0
	layer_3_expert_out_sp0_ep4_tp0_pp0 [label="Expert Out L3 SP0 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep4_tp0_pp0 -> layer_3_expert_out_sp0_ep4_tp0_pp0
	layer_3_expert_sp0_ep4_tp1_pp0 [label="Expert L3 SP0 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep4_pp0 -> layer_3_expert_sp0_ep4_tp1_pp0
	layer_3_expert_out_sp0_ep4_tp1_pp0 [label="Expert Out L3 SP0 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep4_tp1_pp0 -> layer_3_expert_out_sp0_ep4_tp1_pp0
	layer_3_expert_sp0_ep4_tp2_pp0 [label="Expert L3 SP0 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep4_pp0 -> layer_3_expert_sp0_ep4_tp2_pp0
	layer_3_expert_out_sp0_ep4_tp2_pp0 [label="Expert Out L3 SP0 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep4_tp2_pp0 -> layer_3_expert_out_sp0_ep4_tp2_pp0
	layer_3_expert_sp0_ep4_tp3_pp0 [label="Expert L3 SP0 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep4_pp0 -> layer_3_expert_sp0_ep4_tp3_pp0
	layer_3_expert_out_sp0_ep4_tp3_pp0 [label="Expert Out L3 SP0 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep4_tp3_pp0 -> layer_3_expert_out_sp0_ep4_tp3_pp0
	layer_3_expert_ar_sp0_ep4_pp0 [label="Expert All-Reduce L3 SP0 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep4_tp0_pp0 -> layer_3_expert_ar_sp0_ep4_pp0
	layer_3_expert_out_sp0_ep4_tp1_pp0 -> layer_3_expert_ar_sp0_ep4_pp0
	layer_3_expert_out_sp0_ep4_tp2_pp0 -> layer_3_expert_ar_sp0_ep4_pp0
	layer_3_expert_out_sp0_ep4_tp3_pp0 -> layer_3_expert_ar_sp0_ep4_pp0
	layer_3_combine_sp0_ep4_pp0 [label="Token Combine L3 SP0 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep4_pp0 -> layer_3_combine_sp0_ep4_pp0
	layer_3_dispatch_sp0_ep5_pp0 [label="Token Dispatch L3 SP0 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep5_pp0 [style=dashed]
	layer_3_expert_sp0_ep5_tp0_pp0 [label="Expert L3 SP0 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep5_pp0 -> layer_3_expert_sp0_ep5_tp0_pp0
	layer_3_expert_out_sp0_ep5_tp0_pp0 [label="Expert Out L3 SP0 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep5_tp0_pp0 -> layer_3_expert_out_sp0_ep5_tp0_pp0
	layer_3_expert_sp0_ep5_tp1_pp0 [label="Expert L3 SP0 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep5_pp0 -> layer_3_expert_sp0_ep5_tp1_pp0
	layer_3_expert_out_sp0_ep5_tp1_pp0 [label="Expert Out L3 SP0 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep5_tp1_pp0 -> layer_3_expert_out_sp0_ep5_tp1_pp0
	layer_3_expert_sp0_ep5_tp2_pp0 [label="Expert L3 SP0 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep5_pp0 -> layer_3_expert_sp0_ep5_tp2_pp0
	layer_3_expert_out_sp0_ep5_tp2_pp0 [label="Expert Out L3 SP0 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep5_tp2_pp0 -> layer_3_expert_out_sp0_ep5_tp2_pp0
	layer_3_expert_sp0_ep5_tp3_pp0 [label="Expert L3 SP0 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep5_pp0 -> layer_3_expert_sp0_ep5_tp3_pp0
	layer_3_expert_out_sp0_ep5_tp3_pp0 [label="Expert Out L3 SP0 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep5_tp3_pp0 -> layer_3_expert_out_sp0_ep5_tp3_pp0
	layer_3_expert_ar_sp0_ep5_pp0 [label="Expert All-Reduce L3 SP0 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep5_tp0_pp0 -> layer_3_expert_ar_sp0_ep5_pp0
	layer_3_expert_out_sp0_ep5_tp1_pp0 -> layer_3_expert_ar_sp0_ep5_pp0
	layer_3_expert_out_sp0_ep5_tp2_pp0 -> layer_3_expert_ar_sp0_ep5_pp0
	layer_3_expert_out_sp0_ep5_tp3_pp0 -> layer_3_expert_ar_sp0_ep5_pp0
	layer_3_combine_sp0_ep5_pp0 [label="Token Combine L3 SP0 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep5_pp0 -> layer_3_combine_sp0_ep5_pp0
	layer_3_dispatch_sp0_ep6_pp0 [label="Token Dispatch L3 SP0 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep6_pp0 [style=dashed]
	layer_3_expert_sp0_ep6_tp0_pp0 [label="Expert L3 SP0 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep6_pp0 -> layer_3_expert_sp0_ep6_tp0_pp0
	layer_3_expert_out_sp0_ep6_tp0_pp0 [label="Expert Out L3 SP0 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep6_tp0_pp0 -> layer_3_expert_out_sp0_ep6_tp0_pp0
	layer_3_expert_sp0_ep6_tp1_pp0 [label="Expert L3 SP0 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep6_pp0 -> layer_3_expert_sp0_ep6_tp1_pp0
	layer_3_expert_out_sp0_ep6_tp1_pp0 [label="Expert Out L3 SP0 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep6_tp1_pp0 -> layer_3_expert_out_sp0_ep6_tp1_pp0
	layer_3_expert_sp0_ep6_tp2_pp0 [label="Expert L3 SP0 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep6_pp0 -> layer_3_expert_sp0_ep6_tp2_pp0
	layer_3_expert_out_sp0_ep6_tp2_pp0 [label="Expert Out L3 SP0 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep6_tp2_pp0 -> layer_3_expert_out_sp0_ep6_tp2_pp0
	layer_3_expert_sp0_ep6_tp3_pp0 [label="Expert L3 SP0 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep6_pp0 -> layer_3_expert_sp0_ep6_tp3_pp0
	layer_3_expert_out_sp0_ep6_tp3_pp0 [label="Expert Out L3 SP0 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep6_tp3_pp0 -> layer_3_expert_out_sp0_ep6_tp3_pp0
	layer_3_expert_ar_sp0_ep6_pp0 [label="Expert All-Reduce L3 SP0 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep6_tp0_pp0 -> layer_3_expert_ar_sp0_ep6_pp0
	layer_3_expert_out_sp0_ep6_tp1_pp0 -> layer_3_expert_ar_sp0_ep6_pp0
	layer_3_expert_out_sp0_ep6_tp2_pp0 -> layer_3_expert_ar_sp0_ep6_pp0
	layer_3_expert_out_sp0_ep6_tp3_pp0 -> layer_3_expert_ar_sp0_ep6_pp0
	layer_3_combine_sp0_ep6_pp0 [label="Token Combine L3 SP0 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep6_pp0 -> layer_3_combine_sp0_ep6_pp0
	layer_3_dispatch_sp0_ep7_pp0 [label="Token Dispatch L3 SP0 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep7_pp0 [style=dashed]
	layer_3_expert_sp0_ep7_tp0_pp0 [label="Expert L3 SP0 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep7_pp0 -> layer_3_expert_sp0_ep7_tp0_pp0
	layer_3_expert_out_sp0_ep7_tp0_pp0 [label="Expert Out L3 SP0 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep7_tp0_pp0 -> layer_3_expert_out_sp0_ep7_tp0_pp0
	layer_3_expert_sp0_ep7_tp1_pp0 [label="Expert L3 SP0 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep7_pp0 -> layer_3_expert_sp0_ep7_tp1_pp0
	layer_3_expert_out_sp0_ep7_tp1_pp0 [label="Expert Out L3 SP0 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep7_tp1_pp0 -> layer_3_expert_out_sp0_ep7_tp1_pp0
	layer_3_expert_sp0_ep7_tp2_pp0 [label="Expert L3 SP0 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep7_pp0 -> layer_3_expert_sp0_ep7_tp2_pp0
	layer_3_expert_out_sp0_ep7_tp2_pp0 [label="Expert Out L3 SP0 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep7_tp2_pp0 -> layer_3_expert_out_sp0_ep7_tp2_pp0
	layer_3_expert_sp0_ep7_tp3_pp0 [label="Expert L3 SP0 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep7_pp0 -> layer_3_expert_sp0_ep7_tp3_pp0
	layer_3_expert_out_sp0_ep7_tp3_pp0 [label="Expert Out L3 SP0 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep7_tp3_pp0 -> layer_3_expert_out_sp0_ep7_tp3_pp0
	layer_3_expert_ar_sp0_ep7_pp0 [label="Expert All-Reduce L3 SP0 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep7_tp0_pp0 -> layer_3_expert_ar_sp0_ep7_pp0
	layer_3_expert_out_sp0_ep7_tp1_pp0 -> layer_3_expert_ar_sp0_ep7_pp0
	layer_3_expert_out_sp0_ep7_tp2_pp0 -> layer_3_expert_ar_sp0_ep7_pp0
	layer_3_expert_out_sp0_ep7_tp3_pp0 -> layer_3_expert_ar_sp0_ep7_pp0
	layer_3_combine_sp0_ep7_pp0 [label="Token Combine L3 SP0 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep7_pp0 -> layer_3_combine_sp0_ep7_pp0
	layer_3_dispatch_sp0_ep8_pp0 [label="Token Dispatch L3 SP0 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep8_pp0 [style=dashed]
	layer_3_expert_sp0_ep8_tp0_pp0 [label="Expert L3 SP0 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep8_pp0 -> layer_3_expert_sp0_ep8_tp0_pp0
	layer_3_expert_out_sp0_ep8_tp0_pp0 [label="Expert Out L3 SP0 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep8_tp0_pp0 -> layer_3_expert_out_sp0_ep8_tp0_pp0
	layer_3_expert_sp0_ep8_tp1_pp0 [label="Expert L3 SP0 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep8_pp0 -> layer_3_expert_sp0_ep8_tp1_pp0
	layer_3_expert_out_sp0_ep8_tp1_pp0 [label="Expert Out L3 SP0 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep8_tp1_pp0 -> layer_3_expert_out_sp0_ep8_tp1_pp0
	layer_3_expert_sp0_ep8_tp2_pp0 [label="Expert L3 SP0 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep8_pp0 -> layer_3_expert_sp0_ep8_tp2_pp0
	layer_3_expert_out_sp0_ep8_tp2_pp0 [label="Expert Out L3 SP0 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep8_tp2_pp0 -> layer_3_expert_out_sp0_ep8_tp2_pp0
	layer_3_expert_sp0_ep8_tp3_pp0 [label="Expert L3 SP0 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep8_pp0 -> layer_3_expert_sp0_ep8_tp3_pp0
	layer_3_expert_out_sp0_ep8_tp3_pp0 [label="Expert Out L3 SP0 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep8_tp3_pp0 -> layer_3_expert_out_sp0_ep8_tp3_pp0
	layer_3_expert_ar_sp0_ep8_pp0 [label="Expert All-Reduce L3 SP0 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep8_tp0_pp0 -> layer_3_expert_ar_sp0_ep8_pp0
	layer_3_expert_out_sp0_ep8_tp1_pp0 -> layer_3_expert_ar_sp0_ep8_pp0
	layer_3_expert_out_sp0_ep8_tp2_pp0 -> layer_3_expert_ar_sp0_ep8_pp0
	layer_3_expert_out_sp0_ep8_tp3_pp0 -> layer_3_expert_ar_sp0_ep8_pp0
	layer_3_combine_sp0_ep8_pp0 [label="Token Combine L3 SP0 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep8_pp0 -> layer_3_combine_sp0_ep8_pp0
	layer_3_dispatch_sp0_ep9_pp0 [label="Token Dispatch L3 SP0 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep9_pp0 [style=dashed]
	layer_3_expert_sp0_ep9_tp0_pp0 [label="Expert L3 SP0 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep9_pp0 -> layer_3_expert_sp0_ep9_tp0_pp0
	layer_3_expert_out_sp0_ep9_tp0_pp0 [label="Expert Out L3 SP0 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep9_tp0_pp0 -> layer_3_expert_out_sp0_ep9_tp0_pp0
	layer_3_expert_sp0_ep9_tp1_pp0 [label="Expert L3 SP0 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep9_pp0 -> layer_3_expert_sp0_ep9_tp1_pp0
	layer_3_expert_out_sp0_ep9_tp1_pp0 [label="Expert Out L3 SP0 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep9_tp1_pp0 -> layer_3_expert_out_sp0_ep9_tp1_pp0
	layer_3_expert_sp0_ep9_tp2_pp0 [label="Expert L3 SP0 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep9_pp0 -> layer_3_expert_sp0_ep9_tp2_pp0
	layer_3_expert_out_sp0_ep9_tp2_pp0 [label="Expert Out L3 SP0 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep9_tp2_pp0 -> layer_3_expert_out_sp0_ep9_tp2_pp0
	layer_3_expert_sp0_ep9_tp3_pp0 [label="Expert L3 SP0 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep9_pp0 -> layer_3_expert_sp0_ep9_tp3_pp0
	layer_3_expert_out_sp0_ep9_tp3_pp0 [label="Expert Out L3 SP0 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep9_tp3_pp0 -> layer_3_expert_out_sp0_ep9_tp3_pp0
	layer_3_expert_ar_sp0_ep9_pp0 [label="Expert All-Reduce L3 SP0 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep9_tp0_pp0 -> layer_3_expert_ar_sp0_ep9_pp0
	layer_3_expert_out_sp0_ep9_tp1_pp0 -> layer_3_expert_ar_sp0_ep9_pp0
	layer_3_expert_out_sp0_ep9_tp2_pp0 -> layer_3_expert_ar_sp0_ep9_pp0
	layer_3_expert_out_sp0_ep9_tp3_pp0 -> layer_3_expert_ar_sp0_ep9_pp0
	layer_3_combine_sp0_ep9_pp0 [label="Token Combine L3 SP0 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep9_pp0 -> layer_3_combine_sp0_ep9_pp0
	layer_3_dispatch_sp0_ep10_pp0 [label="Token Dispatch L3 SP0 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep10_pp0 [style=dashed]
	layer_3_expert_sp0_ep10_tp0_pp0 [label="Expert L3 SP0 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep10_pp0 -> layer_3_expert_sp0_ep10_tp0_pp0
	layer_3_expert_out_sp0_ep10_tp0_pp0 [label="Expert Out L3 SP0 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep10_tp0_pp0 -> layer_3_expert_out_sp0_ep10_tp0_pp0
	layer_3_expert_sp0_ep10_tp1_pp0 [label="Expert L3 SP0 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep10_pp0 -> layer_3_expert_sp0_ep10_tp1_pp0
	layer_3_expert_out_sp0_ep10_tp1_pp0 [label="Expert Out L3 SP0 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep10_tp1_pp0 -> layer_3_expert_out_sp0_ep10_tp1_pp0
	layer_3_expert_sp0_ep10_tp2_pp0 [label="Expert L3 SP0 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep10_pp0 -> layer_3_expert_sp0_ep10_tp2_pp0
	layer_3_expert_out_sp0_ep10_tp2_pp0 [label="Expert Out L3 SP0 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep10_tp2_pp0 -> layer_3_expert_out_sp0_ep10_tp2_pp0
	layer_3_expert_sp0_ep10_tp3_pp0 [label="Expert L3 SP0 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep10_pp0 -> layer_3_expert_sp0_ep10_tp3_pp0
	layer_3_expert_out_sp0_ep10_tp3_pp0 [label="Expert Out L3 SP0 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep10_tp3_pp0 -> layer_3_expert_out_sp0_ep10_tp3_pp0
	layer_3_expert_ar_sp0_ep10_pp0 [label="Expert All-Reduce L3 SP0 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep10_tp0_pp0 -> layer_3_expert_ar_sp0_ep10_pp0
	layer_3_expert_out_sp0_ep10_tp1_pp0 -> layer_3_expert_ar_sp0_ep10_pp0
	layer_3_expert_out_sp0_ep10_tp2_pp0 -> layer_3_expert_ar_sp0_ep10_pp0
	layer_3_expert_out_sp0_ep10_tp3_pp0 -> layer_3_expert_ar_sp0_ep10_pp0
	layer_3_combine_sp0_ep10_pp0 [label="Token Combine L3 SP0 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep10_pp0 -> layer_3_combine_sp0_ep10_pp0
	layer_3_dispatch_sp0_ep11_pp0 [label="Token Dispatch L3 SP0 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep11_pp0 [style=dashed]
	layer_3_expert_sp0_ep11_tp0_pp0 [label="Expert L3 SP0 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep11_pp0 -> layer_3_expert_sp0_ep11_tp0_pp0
	layer_3_expert_out_sp0_ep11_tp0_pp0 [label="Expert Out L3 SP0 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep11_tp0_pp0 -> layer_3_expert_out_sp0_ep11_tp0_pp0
	layer_3_expert_sp0_ep11_tp1_pp0 [label="Expert L3 SP0 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep11_pp0 -> layer_3_expert_sp0_ep11_tp1_pp0
	layer_3_expert_out_sp0_ep11_tp1_pp0 [label="Expert Out L3 SP0 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep11_tp1_pp0 -> layer_3_expert_out_sp0_ep11_tp1_pp0
	layer_3_expert_sp0_ep11_tp2_pp0 [label="Expert L3 SP0 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep11_pp0 -> layer_3_expert_sp0_ep11_tp2_pp0
	layer_3_expert_out_sp0_ep11_tp2_pp0 [label="Expert Out L3 SP0 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep11_tp2_pp0 -> layer_3_expert_out_sp0_ep11_tp2_pp0
	layer_3_expert_sp0_ep11_tp3_pp0 [label="Expert L3 SP0 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep11_pp0 -> layer_3_expert_sp0_ep11_tp3_pp0
	layer_3_expert_out_sp0_ep11_tp3_pp0 [label="Expert Out L3 SP0 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep11_tp3_pp0 -> layer_3_expert_out_sp0_ep11_tp3_pp0
	layer_3_expert_ar_sp0_ep11_pp0 [label="Expert All-Reduce L3 SP0 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep11_tp0_pp0 -> layer_3_expert_ar_sp0_ep11_pp0
	layer_3_expert_out_sp0_ep11_tp1_pp0 -> layer_3_expert_ar_sp0_ep11_pp0
	layer_3_expert_out_sp0_ep11_tp2_pp0 -> layer_3_expert_ar_sp0_ep11_pp0
	layer_3_expert_out_sp0_ep11_tp3_pp0 -> layer_3_expert_ar_sp0_ep11_pp0
	layer_3_combine_sp0_ep11_pp0 [label="Token Combine L3 SP0 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep11_pp0 -> layer_3_combine_sp0_ep11_pp0
	layer_3_dispatch_sp0_ep12_pp0 [label="Token Dispatch L3 SP0 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep12_pp0 [style=dashed]
	layer_3_expert_sp0_ep12_tp0_pp0 [label="Expert L3 SP0 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep12_pp0 -> layer_3_expert_sp0_ep12_tp0_pp0
	layer_3_expert_out_sp0_ep12_tp0_pp0 [label="Expert Out L3 SP0 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep12_tp0_pp0 -> layer_3_expert_out_sp0_ep12_tp0_pp0
	layer_3_expert_sp0_ep12_tp1_pp0 [label="Expert L3 SP0 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep12_pp0 -> layer_3_expert_sp0_ep12_tp1_pp0
	layer_3_expert_out_sp0_ep12_tp1_pp0 [label="Expert Out L3 SP0 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep12_tp1_pp0 -> layer_3_expert_out_sp0_ep12_tp1_pp0
	layer_3_expert_sp0_ep12_tp2_pp0 [label="Expert L3 SP0 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep12_pp0 -> layer_3_expert_sp0_ep12_tp2_pp0
	layer_3_expert_out_sp0_ep12_tp2_pp0 [label="Expert Out L3 SP0 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep12_tp2_pp0 -> layer_3_expert_out_sp0_ep12_tp2_pp0
	layer_3_expert_sp0_ep12_tp3_pp0 [label="Expert L3 SP0 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep12_pp0 -> layer_3_expert_sp0_ep12_tp3_pp0
	layer_3_expert_out_sp0_ep12_tp3_pp0 [label="Expert Out L3 SP0 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep12_tp3_pp0 -> layer_3_expert_out_sp0_ep12_tp3_pp0
	layer_3_expert_ar_sp0_ep12_pp0 [label="Expert All-Reduce L3 SP0 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep12_tp0_pp0 -> layer_3_expert_ar_sp0_ep12_pp0
	layer_3_expert_out_sp0_ep12_tp1_pp0 -> layer_3_expert_ar_sp0_ep12_pp0
	layer_3_expert_out_sp0_ep12_tp2_pp0 -> layer_3_expert_ar_sp0_ep12_pp0
	layer_3_expert_out_sp0_ep12_tp3_pp0 -> layer_3_expert_ar_sp0_ep12_pp0
	layer_3_combine_sp0_ep12_pp0 [label="Token Combine L3 SP0 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep12_pp0 -> layer_3_combine_sp0_ep12_pp0
	layer_3_dispatch_sp0_ep13_pp0 [label="Token Dispatch L3 SP0 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep13_pp0 [style=dashed]
	layer_3_expert_sp0_ep13_tp0_pp0 [label="Expert L3 SP0 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep13_pp0 -> layer_3_expert_sp0_ep13_tp0_pp0
	layer_3_expert_out_sp0_ep13_tp0_pp0 [label="Expert Out L3 SP0 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep13_tp0_pp0 -> layer_3_expert_out_sp0_ep13_tp0_pp0
	layer_3_expert_sp0_ep13_tp1_pp0 [label="Expert L3 SP0 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep13_pp0 -> layer_3_expert_sp0_ep13_tp1_pp0
	layer_3_expert_out_sp0_ep13_tp1_pp0 [label="Expert Out L3 SP0 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep13_tp1_pp0 -> layer_3_expert_out_sp0_ep13_tp1_pp0
	layer_3_expert_sp0_ep13_tp2_pp0 [label="Expert L3 SP0 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep13_pp0 -> layer_3_expert_sp0_ep13_tp2_pp0
	layer_3_expert_out_sp0_ep13_tp2_pp0 [label="Expert Out L3 SP0 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep13_tp2_pp0 -> layer_3_expert_out_sp0_ep13_tp2_pp0
	layer_3_expert_sp0_ep13_tp3_pp0 [label="Expert L3 SP0 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep13_pp0 -> layer_3_expert_sp0_ep13_tp3_pp0
	layer_3_expert_out_sp0_ep13_tp3_pp0 [label="Expert Out L3 SP0 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep13_tp3_pp0 -> layer_3_expert_out_sp0_ep13_tp3_pp0
	layer_3_expert_ar_sp0_ep13_pp0 [label="Expert All-Reduce L3 SP0 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep13_tp0_pp0 -> layer_3_expert_ar_sp0_ep13_pp0
	layer_3_expert_out_sp0_ep13_tp1_pp0 -> layer_3_expert_ar_sp0_ep13_pp0
	layer_3_expert_out_sp0_ep13_tp2_pp0 -> layer_3_expert_ar_sp0_ep13_pp0
	layer_3_expert_out_sp0_ep13_tp3_pp0 -> layer_3_expert_ar_sp0_ep13_pp0
	layer_3_combine_sp0_ep13_pp0 [label="Token Combine L3 SP0 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep13_pp0 -> layer_3_combine_sp0_ep13_pp0
	layer_3_dispatch_sp0_ep14_pp0 [label="Token Dispatch L3 SP0 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep14_pp0 [style=dashed]
	layer_3_expert_sp0_ep14_tp0_pp0 [label="Expert L3 SP0 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep14_pp0 -> layer_3_expert_sp0_ep14_tp0_pp0
	layer_3_expert_out_sp0_ep14_tp0_pp0 [label="Expert Out L3 SP0 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep14_tp0_pp0 -> layer_3_expert_out_sp0_ep14_tp0_pp0
	layer_3_expert_sp0_ep14_tp1_pp0 [label="Expert L3 SP0 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep14_pp0 -> layer_3_expert_sp0_ep14_tp1_pp0
	layer_3_expert_out_sp0_ep14_tp1_pp0 [label="Expert Out L3 SP0 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep14_tp1_pp0 -> layer_3_expert_out_sp0_ep14_tp1_pp0
	layer_3_expert_sp0_ep14_tp2_pp0 [label="Expert L3 SP0 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep14_pp0 -> layer_3_expert_sp0_ep14_tp2_pp0
	layer_3_expert_out_sp0_ep14_tp2_pp0 [label="Expert Out L3 SP0 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep14_tp2_pp0 -> layer_3_expert_out_sp0_ep14_tp2_pp0
	layer_3_expert_sp0_ep14_tp3_pp0 [label="Expert L3 SP0 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep14_pp0 -> layer_3_expert_sp0_ep14_tp3_pp0
	layer_3_expert_out_sp0_ep14_tp3_pp0 [label="Expert Out L3 SP0 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep14_tp3_pp0 -> layer_3_expert_out_sp0_ep14_tp3_pp0
	layer_3_expert_ar_sp0_ep14_pp0 [label="Expert All-Reduce L3 SP0 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep14_tp0_pp0 -> layer_3_expert_ar_sp0_ep14_pp0
	layer_3_expert_out_sp0_ep14_tp1_pp0 -> layer_3_expert_ar_sp0_ep14_pp0
	layer_3_expert_out_sp0_ep14_tp2_pp0 -> layer_3_expert_ar_sp0_ep14_pp0
	layer_3_expert_out_sp0_ep14_tp3_pp0 -> layer_3_expert_ar_sp0_ep14_pp0
	layer_3_combine_sp0_ep14_pp0 [label="Token Combine L3 SP0 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep14_pp0 -> layer_3_combine_sp0_ep14_pp0
	layer_3_dispatch_sp0_ep15_pp0 [label="Token Dispatch L3 SP0 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp0_pp0 -> layer_3_dispatch_sp0_ep15_pp0 [style=dashed]
	layer_3_expert_sp0_ep15_tp0_pp0 [label="Expert L3 SP0 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep15_pp0 -> layer_3_expert_sp0_ep15_tp0_pp0
	layer_3_expert_out_sp0_ep15_tp0_pp0 [label="Expert Out L3 SP0 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep15_tp0_pp0 -> layer_3_expert_out_sp0_ep15_tp0_pp0
	layer_3_expert_sp0_ep15_tp1_pp0 [label="Expert L3 SP0 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep15_pp0 -> layer_3_expert_sp0_ep15_tp1_pp0
	layer_3_expert_out_sp0_ep15_tp1_pp0 [label="Expert Out L3 SP0 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep15_tp1_pp0 -> layer_3_expert_out_sp0_ep15_tp1_pp0
	layer_3_expert_sp0_ep15_tp2_pp0 [label="Expert L3 SP0 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep15_pp0 -> layer_3_expert_sp0_ep15_tp2_pp0
	layer_3_expert_out_sp0_ep15_tp2_pp0 [label="Expert Out L3 SP0 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep15_tp2_pp0 -> layer_3_expert_out_sp0_ep15_tp2_pp0
	layer_3_expert_sp0_ep15_tp3_pp0 [label="Expert L3 SP0 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp0_ep15_pp0 -> layer_3_expert_sp0_ep15_tp3_pp0
	layer_3_expert_out_sp0_ep15_tp3_pp0 [label="Expert Out L3 SP0 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp0_ep15_tp3_pp0 -> layer_3_expert_out_sp0_ep15_tp3_pp0
	layer_3_expert_ar_sp0_ep15_pp0 [label="Expert All-Reduce L3 SP0 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp0_ep15_tp0_pp0 -> layer_3_expert_ar_sp0_ep15_pp0
	layer_3_expert_out_sp0_ep15_tp1_pp0 -> layer_3_expert_ar_sp0_ep15_pp0
	layer_3_expert_out_sp0_ep15_tp2_pp0 -> layer_3_expert_ar_sp0_ep15_pp0
	layer_3_expert_out_sp0_ep15_tp3_pp0 -> layer_3_expert_ar_sp0_ep15_pp0
	layer_3_combine_sp0_ep15_pp0 [label="Token Combine L3 SP0 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp0_ep15_pp0 -> layer_3_combine_sp0_ep15_pp0
	layer_3_moe_all2all_sp0_pp0 [label="MoE All-to-All L3 SP0\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_3_combine_sp0_ep0_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep1_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep2_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep3_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep4_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep5_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep6_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep7_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep8_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep9_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep10_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep11_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep12_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep13_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep14_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_combine_sp0_ep15_pp0 -> layer_3_moe_all2all_sp0_pp0
	layer_3_mlp_out_sp0_pp0 [label="MoE Output L3 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_moe_all2all_sp0_pp0 -> layer_3_mlp_out_sp0_pp0
	layer_3_mlp_res_sp0_pp0 [label="MLP Residual L3 SP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_mlp_out_sp0_pp0 -> layer_3_mlp_res_sp0_pp0
	layer_3_attn_res_sp0_pp0 -> layer_3_mlp_res_sp0_pp0 [style=dashed]
	layer_3_norm_sp1_pp0 [label="LayerNorm L3 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_mlp_out_sp1_pp0 -> layer_3_norm_sp1_pp0
	layer_3_qkv_sp1_tp0_pp0 [label="QKV Proj L3 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp1_pp0 -> layer_3_qkv_sp1_tp0_pp0
	layer_3_attn_sp1_tp0_pp0 [label="Attention L3 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp1_tp0_pp0 -> layer_3_attn_sp1_tp0_pp0
	layer_3_attn_out_sp1_tp0_pp0 [label="Attn Out Proj L3 SP1 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp1_tp0_pp0 -> layer_3_attn_out_sp1_tp0_pp0
	layer_3_qkv_sp1_tp1_pp0 [label="QKV Proj L3 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp1_pp0 -> layer_3_qkv_sp1_tp1_pp0
	layer_3_attn_sp1_tp1_pp0 [label="Attention L3 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp1_tp1_pp0 -> layer_3_attn_sp1_tp1_pp0
	layer_3_attn_out_sp1_tp1_pp0 [label="Attn Out Proj L3 SP1 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp1_tp1_pp0 -> layer_3_attn_out_sp1_tp1_pp0
	layer_3_qkv_sp1_tp2_pp0 [label="QKV Proj L3 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp1_pp0 -> layer_3_qkv_sp1_tp2_pp0
	layer_3_attn_sp1_tp2_pp0 [label="Attention L3 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp1_tp2_pp0 -> layer_3_attn_sp1_tp2_pp0
	layer_3_attn_out_sp1_tp2_pp0 [label="Attn Out Proj L3 SP1 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp1_tp2_pp0 -> layer_3_attn_out_sp1_tp2_pp0
	layer_3_qkv_sp1_tp3_pp0 [label="QKV Proj L3 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp1_pp0 -> layer_3_qkv_sp1_tp3_pp0
	layer_3_attn_sp1_tp3_pp0 [label="Attention L3 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp1_tp3_pp0 -> layer_3_attn_sp1_tp3_pp0
	layer_3_attn_out_sp1_tp3_pp0 [label="Attn Out Proj L3 SP1 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp1_tp3_pp0 -> layer_3_attn_out_sp1_tp3_pp0
	layer_3_attn_ar_sp1_pp0 [label="Attention All-Reduce L3 SP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_attn_out_sp1_tp0_pp0 -> layer_3_attn_ar_sp1_pp0
	layer_3_attn_out_sp1_tp1_pp0 -> layer_3_attn_ar_sp1_pp0
	layer_3_attn_out_sp1_tp2_pp0 -> layer_3_attn_ar_sp1_pp0
	layer_3_attn_out_sp1_tp3_pp0 -> layer_3_attn_ar_sp1_pp0
	layer_3_attn_res_sp1_pp0 [label="Attention Residual L3 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_attn_ar_sp1_pp0 -> layer_3_attn_res_sp1_pp0
	layer_3_norm_sp1_pp0 -> layer_3_attn_res_sp1_pp0 [style=dashed]
	layer_3_post_norm_sp1_pp0 [label="Post-Attn Norm L3 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_attn_res_sp1_pp0 -> layer_3_post_norm_sp1_pp0
	layer_3_router_sp1_pp0 [label="MoE Router L3 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_3_post_norm_sp1_pp0 -> layer_3_router_sp1_pp0
	layer_3_dispatch_sp1_ep0_pp0 [label="Token Dispatch L3 SP1 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep0_pp0 [style=dashed]
	layer_3_expert_sp1_ep0_tp0_pp0 [label="Expert L3 SP1 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep0_pp0 -> layer_3_expert_sp1_ep0_tp0_pp0
	layer_3_expert_out_sp1_ep0_tp0_pp0 [label="Expert Out L3 SP1 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep0_tp0_pp0 -> layer_3_expert_out_sp1_ep0_tp0_pp0
	layer_3_expert_sp1_ep0_tp1_pp0 [label="Expert L3 SP1 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep0_pp0 -> layer_3_expert_sp1_ep0_tp1_pp0
	layer_3_expert_out_sp1_ep0_tp1_pp0 [label="Expert Out L3 SP1 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep0_tp1_pp0 -> layer_3_expert_out_sp1_ep0_tp1_pp0
	layer_3_expert_sp1_ep0_tp2_pp0 [label="Expert L3 SP1 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep0_pp0 -> layer_3_expert_sp1_ep0_tp2_pp0
	layer_3_expert_out_sp1_ep0_tp2_pp0 [label="Expert Out L3 SP1 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep0_tp2_pp0 -> layer_3_expert_out_sp1_ep0_tp2_pp0
	layer_3_expert_sp1_ep0_tp3_pp0 [label="Expert L3 SP1 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep0_pp0 -> layer_3_expert_sp1_ep0_tp3_pp0
	layer_3_expert_out_sp1_ep0_tp3_pp0 [label="Expert Out L3 SP1 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep0_tp3_pp0 -> layer_3_expert_out_sp1_ep0_tp3_pp0
	layer_3_expert_ar_sp1_ep0_pp0 [label="Expert All-Reduce L3 SP1 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep0_tp0_pp0 -> layer_3_expert_ar_sp1_ep0_pp0
	layer_3_expert_out_sp1_ep0_tp1_pp0 -> layer_3_expert_ar_sp1_ep0_pp0
	layer_3_expert_out_sp1_ep0_tp2_pp0 -> layer_3_expert_ar_sp1_ep0_pp0
	layer_3_expert_out_sp1_ep0_tp3_pp0 -> layer_3_expert_ar_sp1_ep0_pp0
	layer_3_combine_sp1_ep0_pp0 [label="Token Combine L3 SP1 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep0_pp0 -> layer_3_combine_sp1_ep0_pp0
	layer_3_dispatch_sp1_ep1_pp0 [label="Token Dispatch L3 SP1 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep1_pp0 [style=dashed]
	layer_3_expert_sp1_ep1_tp0_pp0 [label="Expert L3 SP1 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep1_pp0 -> layer_3_expert_sp1_ep1_tp0_pp0
	layer_3_expert_out_sp1_ep1_tp0_pp0 [label="Expert Out L3 SP1 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep1_tp0_pp0 -> layer_3_expert_out_sp1_ep1_tp0_pp0
	layer_3_expert_sp1_ep1_tp1_pp0 [label="Expert L3 SP1 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep1_pp0 -> layer_3_expert_sp1_ep1_tp1_pp0
	layer_3_expert_out_sp1_ep1_tp1_pp0 [label="Expert Out L3 SP1 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep1_tp1_pp0 -> layer_3_expert_out_sp1_ep1_tp1_pp0
	layer_3_expert_sp1_ep1_tp2_pp0 [label="Expert L3 SP1 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep1_pp0 -> layer_3_expert_sp1_ep1_tp2_pp0
	layer_3_expert_out_sp1_ep1_tp2_pp0 [label="Expert Out L3 SP1 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep1_tp2_pp0 -> layer_3_expert_out_sp1_ep1_tp2_pp0
	layer_3_expert_sp1_ep1_tp3_pp0 [label="Expert L3 SP1 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep1_pp0 -> layer_3_expert_sp1_ep1_tp3_pp0
	layer_3_expert_out_sp1_ep1_tp3_pp0 [label="Expert Out L3 SP1 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep1_tp3_pp0 -> layer_3_expert_out_sp1_ep1_tp3_pp0
	layer_3_expert_ar_sp1_ep1_pp0 [label="Expert All-Reduce L3 SP1 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep1_tp0_pp0 -> layer_3_expert_ar_sp1_ep1_pp0
	layer_3_expert_out_sp1_ep1_tp1_pp0 -> layer_3_expert_ar_sp1_ep1_pp0
	layer_3_expert_out_sp1_ep1_tp2_pp0 -> layer_3_expert_ar_sp1_ep1_pp0
	layer_3_expert_out_sp1_ep1_tp3_pp0 -> layer_3_expert_ar_sp1_ep1_pp0
	layer_3_combine_sp1_ep1_pp0 [label="Token Combine L3 SP1 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep1_pp0 -> layer_3_combine_sp1_ep1_pp0
	layer_3_dispatch_sp1_ep2_pp0 [label="Token Dispatch L3 SP1 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep2_pp0 [style=dashed]
	layer_3_expert_sp1_ep2_tp0_pp0 [label="Expert L3 SP1 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep2_pp0 -> layer_3_expert_sp1_ep2_tp0_pp0
	layer_3_expert_out_sp1_ep2_tp0_pp0 [label="Expert Out L3 SP1 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep2_tp0_pp0 -> layer_3_expert_out_sp1_ep2_tp0_pp0
	layer_3_expert_sp1_ep2_tp1_pp0 [label="Expert L3 SP1 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep2_pp0 -> layer_3_expert_sp1_ep2_tp1_pp0
	layer_3_expert_out_sp1_ep2_tp1_pp0 [label="Expert Out L3 SP1 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep2_tp1_pp0 -> layer_3_expert_out_sp1_ep2_tp1_pp0
	layer_3_expert_sp1_ep2_tp2_pp0 [label="Expert L3 SP1 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep2_pp0 -> layer_3_expert_sp1_ep2_tp2_pp0
	layer_3_expert_out_sp1_ep2_tp2_pp0 [label="Expert Out L3 SP1 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep2_tp2_pp0 -> layer_3_expert_out_sp1_ep2_tp2_pp0
	layer_3_expert_sp1_ep2_tp3_pp0 [label="Expert L3 SP1 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep2_pp0 -> layer_3_expert_sp1_ep2_tp3_pp0
	layer_3_expert_out_sp1_ep2_tp3_pp0 [label="Expert Out L3 SP1 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep2_tp3_pp0 -> layer_3_expert_out_sp1_ep2_tp3_pp0
	layer_3_expert_ar_sp1_ep2_pp0 [label="Expert All-Reduce L3 SP1 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep2_tp0_pp0 -> layer_3_expert_ar_sp1_ep2_pp0
	layer_3_expert_out_sp1_ep2_tp1_pp0 -> layer_3_expert_ar_sp1_ep2_pp0
	layer_3_expert_out_sp1_ep2_tp2_pp0 -> layer_3_expert_ar_sp1_ep2_pp0
	layer_3_expert_out_sp1_ep2_tp3_pp0 -> layer_3_expert_ar_sp1_ep2_pp0
	layer_3_combine_sp1_ep2_pp0 [label="Token Combine L3 SP1 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep2_pp0 -> layer_3_combine_sp1_ep2_pp0
	layer_3_dispatch_sp1_ep3_pp0 [label="Token Dispatch L3 SP1 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep3_pp0 [style=dashed]
	layer_3_expert_sp1_ep3_tp0_pp0 [label="Expert L3 SP1 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep3_pp0 -> layer_3_expert_sp1_ep3_tp0_pp0
	layer_3_expert_out_sp1_ep3_tp0_pp0 [label="Expert Out L3 SP1 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep3_tp0_pp0 -> layer_3_expert_out_sp1_ep3_tp0_pp0
	layer_3_expert_sp1_ep3_tp1_pp0 [label="Expert L3 SP1 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep3_pp0 -> layer_3_expert_sp1_ep3_tp1_pp0
	layer_3_expert_out_sp1_ep3_tp1_pp0 [label="Expert Out L3 SP1 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep3_tp1_pp0 -> layer_3_expert_out_sp1_ep3_tp1_pp0
	layer_3_expert_sp1_ep3_tp2_pp0 [label="Expert L3 SP1 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep3_pp0 -> layer_3_expert_sp1_ep3_tp2_pp0
	layer_3_expert_out_sp1_ep3_tp2_pp0 [label="Expert Out L3 SP1 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep3_tp2_pp0 -> layer_3_expert_out_sp1_ep3_tp2_pp0
	layer_3_expert_sp1_ep3_tp3_pp0 [label="Expert L3 SP1 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep3_pp0 -> layer_3_expert_sp1_ep3_tp3_pp0
	layer_3_expert_out_sp1_ep3_tp3_pp0 [label="Expert Out L3 SP1 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep3_tp3_pp0 -> layer_3_expert_out_sp1_ep3_tp3_pp0
	layer_3_expert_ar_sp1_ep3_pp0 [label="Expert All-Reduce L3 SP1 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep3_tp0_pp0 -> layer_3_expert_ar_sp1_ep3_pp0
	layer_3_expert_out_sp1_ep3_tp1_pp0 -> layer_3_expert_ar_sp1_ep3_pp0
	layer_3_expert_out_sp1_ep3_tp2_pp0 -> layer_3_expert_ar_sp1_ep3_pp0
	layer_3_expert_out_sp1_ep3_tp3_pp0 -> layer_3_expert_ar_sp1_ep3_pp0
	layer_3_combine_sp1_ep3_pp0 [label="Token Combine L3 SP1 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep3_pp0 -> layer_3_combine_sp1_ep3_pp0
	layer_3_dispatch_sp1_ep4_pp0 [label="Token Dispatch L3 SP1 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep4_pp0 [style=dashed]
	layer_3_expert_sp1_ep4_tp0_pp0 [label="Expert L3 SP1 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep4_pp0 -> layer_3_expert_sp1_ep4_tp0_pp0
	layer_3_expert_out_sp1_ep4_tp0_pp0 [label="Expert Out L3 SP1 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep4_tp0_pp0 -> layer_3_expert_out_sp1_ep4_tp0_pp0
	layer_3_expert_sp1_ep4_tp1_pp0 [label="Expert L3 SP1 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep4_pp0 -> layer_3_expert_sp1_ep4_tp1_pp0
	layer_3_expert_out_sp1_ep4_tp1_pp0 [label="Expert Out L3 SP1 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep4_tp1_pp0 -> layer_3_expert_out_sp1_ep4_tp1_pp0
	layer_3_expert_sp1_ep4_tp2_pp0 [label="Expert L3 SP1 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep4_pp0 -> layer_3_expert_sp1_ep4_tp2_pp0
	layer_3_expert_out_sp1_ep4_tp2_pp0 [label="Expert Out L3 SP1 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep4_tp2_pp0 -> layer_3_expert_out_sp1_ep4_tp2_pp0
	layer_3_expert_sp1_ep4_tp3_pp0 [label="Expert L3 SP1 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep4_pp0 -> layer_3_expert_sp1_ep4_tp3_pp0
	layer_3_expert_out_sp1_ep4_tp3_pp0 [label="Expert Out L3 SP1 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep4_tp3_pp0 -> layer_3_expert_out_sp1_ep4_tp3_pp0
	layer_3_expert_ar_sp1_ep4_pp0 [label="Expert All-Reduce L3 SP1 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep4_tp0_pp0 -> layer_3_expert_ar_sp1_ep4_pp0
	layer_3_expert_out_sp1_ep4_tp1_pp0 -> layer_3_expert_ar_sp1_ep4_pp0
	layer_3_expert_out_sp1_ep4_tp2_pp0 -> layer_3_expert_ar_sp1_ep4_pp0
	layer_3_expert_out_sp1_ep4_tp3_pp0 -> layer_3_expert_ar_sp1_ep4_pp0
	layer_3_combine_sp1_ep4_pp0 [label="Token Combine L3 SP1 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep4_pp0 -> layer_3_combine_sp1_ep4_pp0
	layer_3_dispatch_sp1_ep5_pp0 [label="Token Dispatch L3 SP1 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep5_pp0 [style=dashed]
	layer_3_expert_sp1_ep5_tp0_pp0 [label="Expert L3 SP1 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep5_pp0 -> layer_3_expert_sp1_ep5_tp0_pp0
	layer_3_expert_out_sp1_ep5_tp0_pp0 [label="Expert Out L3 SP1 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep5_tp0_pp0 -> layer_3_expert_out_sp1_ep5_tp0_pp0
	layer_3_expert_sp1_ep5_tp1_pp0 [label="Expert L3 SP1 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep5_pp0 -> layer_3_expert_sp1_ep5_tp1_pp0
	layer_3_expert_out_sp1_ep5_tp1_pp0 [label="Expert Out L3 SP1 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep5_tp1_pp0 -> layer_3_expert_out_sp1_ep5_tp1_pp0
	layer_3_expert_sp1_ep5_tp2_pp0 [label="Expert L3 SP1 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep5_pp0 -> layer_3_expert_sp1_ep5_tp2_pp0
	layer_3_expert_out_sp1_ep5_tp2_pp0 [label="Expert Out L3 SP1 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep5_tp2_pp0 -> layer_3_expert_out_sp1_ep5_tp2_pp0
	layer_3_expert_sp1_ep5_tp3_pp0 [label="Expert L3 SP1 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep5_pp0 -> layer_3_expert_sp1_ep5_tp3_pp0
	layer_3_expert_out_sp1_ep5_tp3_pp0 [label="Expert Out L3 SP1 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep5_tp3_pp0 -> layer_3_expert_out_sp1_ep5_tp3_pp0
	layer_3_expert_ar_sp1_ep5_pp0 [label="Expert All-Reduce L3 SP1 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep5_tp0_pp0 -> layer_3_expert_ar_sp1_ep5_pp0
	layer_3_expert_out_sp1_ep5_tp1_pp0 -> layer_3_expert_ar_sp1_ep5_pp0
	layer_3_expert_out_sp1_ep5_tp2_pp0 -> layer_3_expert_ar_sp1_ep5_pp0
	layer_3_expert_out_sp1_ep5_tp3_pp0 -> layer_3_expert_ar_sp1_ep5_pp0
	layer_3_combine_sp1_ep5_pp0 [label="Token Combine L3 SP1 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep5_pp0 -> layer_3_combine_sp1_ep5_pp0
	layer_3_dispatch_sp1_ep6_pp0 [label="Token Dispatch L3 SP1 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep6_pp0 [style=dashed]
	layer_3_expert_sp1_ep6_tp0_pp0 [label="Expert L3 SP1 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep6_pp0 -> layer_3_expert_sp1_ep6_tp0_pp0
	layer_3_expert_out_sp1_ep6_tp0_pp0 [label="Expert Out L3 SP1 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep6_tp0_pp0 -> layer_3_expert_out_sp1_ep6_tp0_pp0
	layer_3_expert_sp1_ep6_tp1_pp0 [label="Expert L3 SP1 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep6_pp0 -> layer_3_expert_sp1_ep6_tp1_pp0
	layer_3_expert_out_sp1_ep6_tp1_pp0 [label="Expert Out L3 SP1 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep6_tp1_pp0 -> layer_3_expert_out_sp1_ep6_tp1_pp0
	layer_3_expert_sp1_ep6_tp2_pp0 [label="Expert L3 SP1 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep6_pp0 -> layer_3_expert_sp1_ep6_tp2_pp0
	layer_3_expert_out_sp1_ep6_tp2_pp0 [label="Expert Out L3 SP1 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep6_tp2_pp0 -> layer_3_expert_out_sp1_ep6_tp2_pp0
	layer_3_expert_sp1_ep6_tp3_pp0 [label="Expert L3 SP1 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep6_pp0 -> layer_3_expert_sp1_ep6_tp3_pp0
	layer_3_expert_out_sp1_ep6_tp3_pp0 [label="Expert Out L3 SP1 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep6_tp3_pp0 -> layer_3_expert_out_sp1_ep6_tp3_pp0
	layer_3_expert_ar_sp1_ep6_pp0 [label="Expert All-Reduce L3 SP1 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep6_tp0_pp0 -> layer_3_expert_ar_sp1_ep6_pp0
	layer_3_expert_out_sp1_ep6_tp1_pp0 -> layer_3_expert_ar_sp1_ep6_pp0
	layer_3_expert_out_sp1_ep6_tp2_pp0 -> layer_3_expert_ar_sp1_ep6_pp0
	layer_3_expert_out_sp1_ep6_tp3_pp0 -> layer_3_expert_ar_sp1_ep6_pp0
	layer_3_combine_sp1_ep6_pp0 [label="Token Combine L3 SP1 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep6_pp0 -> layer_3_combine_sp1_ep6_pp0
	layer_3_dispatch_sp1_ep7_pp0 [label="Token Dispatch L3 SP1 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep7_pp0 [style=dashed]
	layer_3_expert_sp1_ep7_tp0_pp0 [label="Expert L3 SP1 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep7_pp0 -> layer_3_expert_sp1_ep7_tp0_pp0
	layer_3_expert_out_sp1_ep7_tp0_pp0 [label="Expert Out L3 SP1 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep7_tp0_pp0 -> layer_3_expert_out_sp1_ep7_tp0_pp0
	layer_3_expert_sp1_ep7_tp1_pp0 [label="Expert L3 SP1 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep7_pp0 -> layer_3_expert_sp1_ep7_tp1_pp0
	layer_3_expert_out_sp1_ep7_tp1_pp0 [label="Expert Out L3 SP1 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep7_tp1_pp0 -> layer_3_expert_out_sp1_ep7_tp1_pp0
	layer_3_expert_sp1_ep7_tp2_pp0 [label="Expert L3 SP1 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep7_pp0 -> layer_3_expert_sp1_ep7_tp2_pp0
	layer_3_expert_out_sp1_ep7_tp2_pp0 [label="Expert Out L3 SP1 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep7_tp2_pp0 -> layer_3_expert_out_sp1_ep7_tp2_pp0
	layer_3_expert_sp1_ep7_tp3_pp0 [label="Expert L3 SP1 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep7_pp0 -> layer_3_expert_sp1_ep7_tp3_pp0
	layer_3_expert_out_sp1_ep7_tp3_pp0 [label="Expert Out L3 SP1 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep7_tp3_pp0 -> layer_3_expert_out_sp1_ep7_tp3_pp0
	layer_3_expert_ar_sp1_ep7_pp0 [label="Expert All-Reduce L3 SP1 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep7_tp0_pp0 -> layer_3_expert_ar_sp1_ep7_pp0
	layer_3_expert_out_sp1_ep7_tp1_pp0 -> layer_3_expert_ar_sp1_ep7_pp0
	layer_3_expert_out_sp1_ep7_tp2_pp0 -> layer_3_expert_ar_sp1_ep7_pp0
	layer_3_expert_out_sp1_ep7_tp3_pp0 -> layer_3_expert_ar_sp1_ep7_pp0
	layer_3_combine_sp1_ep7_pp0 [label="Token Combine L3 SP1 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep7_pp0 -> layer_3_combine_sp1_ep7_pp0
	layer_3_dispatch_sp1_ep8_pp0 [label="Token Dispatch L3 SP1 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep8_pp0 [style=dashed]
	layer_3_expert_sp1_ep8_tp0_pp0 [label="Expert L3 SP1 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep8_pp0 -> layer_3_expert_sp1_ep8_tp0_pp0
	layer_3_expert_out_sp1_ep8_tp0_pp0 [label="Expert Out L3 SP1 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep8_tp0_pp0 -> layer_3_expert_out_sp1_ep8_tp0_pp0
	layer_3_expert_sp1_ep8_tp1_pp0 [label="Expert L3 SP1 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep8_pp0 -> layer_3_expert_sp1_ep8_tp1_pp0
	layer_3_expert_out_sp1_ep8_tp1_pp0 [label="Expert Out L3 SP1 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep8_tp1_pp0 -> layer_3_expert_out_sp1_ep8_tp1_pp0
	layer_3_expert_sp1_ep8_tp2_pp0 [label="Expert L3 SP1 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep8_pp0 -> layer_3_expert_sp1_ep8_tp2_pp0
	layer_3_expert_out_sp1_ep8_tp2_pp0 [label="Expert Out L3 SP1 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep8_tp2_pp0 -> layer_3_expert_out_sp1_ep8_tp2_pp0
	layer_3_expert_sp1_ep8_tp3_pp0 [label="Expert L3 SP1 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep8_pp0 -> layer_3_expert_sp1_ep8_tp3_pp0
	layer_3_expert_out_sp1_ep8_tp3_pp0 [label="Expert Out L3 SP1 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep8_tp3_pp0 -> layer_3_expert_out_sp1_ep8_tp3_pp0
	layer_3_expert_ar_sp1_ep8_pp0 [label="Expert All-Reduce L3 SP1 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep8_tp0_pp0 -> layer_3_expert_ar_sp1_ep8_pp0
	layer_3_expert_out_sp1_ep8_tp1_pp0 -> layer_3_expert_ar_sp1_ep8_pp0
	layer_3_expert_out_sp1_ep8_tp2_pp0 -> layer_3_expert_ar_sp1_ep8_pp0
	layer_3_expert_out_sp1_ep8_tp3_pp0 -> layer_3_expert_ar_sp1_ep8_pp0
	layer_3_combine_sp1_ep8_pp0 [label="Token Combine L3 SP1 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep8_pp0 -> layer_3_combine_sp1_ep8_pp0
	layer_3_dispatch_sp1_ep9_pp0 [label="Token Dispatch L3 SP1 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep9_pp0 [style=dashed]
	layer_3_expert_sp1_ep9_tp0_pp0 [label="Expert L3 SP1 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep9_pp0 -> layer_3_expert_sp1_ep9_tp0_pp0
	layer_3_expert_out_sp1_ep9_tp0_pp0 [label="Expert Out L3 SP1 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep9_tp0_pp0 -> layer_3_expert_out_sp1_ep9_tp0_pp0
	layer_3_expert_sp1_ep9_tp1_pp0 [label="Expert L3 SP1 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep9_pp0 -> layer_3_expert_sp1_ep9_tp1_pp0
	layer_3_expert_out_sp1_ep9_tp1_pp0 [label="Expert Out L3 SP1 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep9_tp1_pp0 -> layer_3_expert_out_sp1_ep9_tp1_pp0
	layer_3_expert_sp1_ep9_tp2_pp0 [label="Expert L3 SP1 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep9_pp0 -> layer_3_expert_sp1_ep9_tp2_pp0
	layer_3_expert_out_sp1_ep9_tp2_pp0 [label="Expert Out L3 SP1 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep9_tp2_pp0 -> layer_3_expert_out_sp1_ep9_tp2_pp0
	layer_3_expert_sp1_ep9_tp3_pp0 [label="Expert L3 SP1 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep9_pp0 -> layer_3_expert_sp1_ep9_tp3_pp0
	layer_3_expert_out_sp1_ep9_tp3_pp0 [label="Expert Out L3 SP1 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep9_tp3_pp0 -> layer_3_expert_out_sp1_ep9_tp3_pp0
	layer_3_expert_ar_sp1_ep9_pp0 [label="Expert All-Reduce L3 SP1 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep9_tp0_pp0 -> layer_3_expert_ar_sp1_ep9_pp0
	layer_3_expert_out_sp1_ep9_tp1_pp0 -> layer_3_expert_ar_sp1_ep9_pp0
	layer_3_expert_out_sp1_ep9_tp2_pp0 -> layer_3_expert_ar_sp1_ep9_pp0
	layer_3_expert_out_sp1_ep9_tp3_pp0 -> layer_3_expert_ar_sp1_ep9_pp0
	layer_3_combine_sp1_ep9_pp0 [label="Token Combine L3 SP1 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep9_pp0 -> layer_3_combine_sp1_ep9_pp0
	layer_3_dispatch_sp1_ep10_pp0 [label="Token Dispatch L3 SP1 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep10_pp0 [style=dashed]
	layer_3_expert_sp1_ep10_tp0_pp0 [label="Expert L3 SP1 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep10_pp0 -> layer_3_expert_sp1_ep10_tp0_pp0
	layer_3_expert_out_sp1_ep10_tp0_pp0 [label="Expert Out L3 SP1 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep10_tp0_pp0 -> layer_3_expert_out_sp1_ep10_tp0_pp0
	layer_3_expert_sp1_ep10_tp1_pp0 [label="Expert L3 SP1 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep10_pp0 -> layer_3_expert_sp1_ep10_tp1_pp0
	layer_3_expert_out_sp1_ep10_tp1_pp0 [label="Expert Out L3 SP1 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep10_tp1_pp0 -> layer_3_expert_out_sp1_ep10_tp1_pp0
	layer_3_expert_sp1_ep10_tp2_pp0 [label="Expert L3 SP1 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep10_pp0 -> layer_3_expert_sp1_ep10_tp2_pp0
	layer_3_expert_out_sp1_ep10_tp2_pp0 [label="Expert Out L3 SP1 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep10_tp2_pp0 -> layer_3_expert_out_sp1_ep10_tp2_pp0
	layer_3_expert_sp1_ep10_tp3_pp0 [label="Expert L3 SP1 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep10_pp0 -> layer_3_expert_sp1_ep10_tp3_pp0
	layer_3_expert_out_sp1_ep10_tp3_pp0 [label="Expert Out L3 SP1 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep10_tp3_pp0 -> layer_3_expert_out_sp1_ep10_tp3_pp0
	layer_3_expert_ar_sp1_ep10_pp0 [label="Expert All-Reduce L3 SP1 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep10_tp0_pp0 -> layer_3_expert_ar_sp1_ep10_pp0
	layer_3_expert_out_sp1_ep10_tp1_pp0 -> layer_3_expert_ar_sp1_ep10_pp0
	layer_3_expert_out_sp1_ep10_tp2_pp0 -> layer_3_expert_ar_sp1_ep10_pp0
	layer_3_expert_out_sp1_ep10_tp3_pp0 -> layer_3_expert_ar_sp1_ep10_pp0
	layer_3_combine_sp1_ep10_pp0 [label="Token Combine L3 SP1 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep10_pp0 -> layer_3_combine_sp1_ep10_pp0
	layer_3_dispatch_sp1_ep11_pp0 [label="Token Dispatch L3 SP1 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep11_pp0 [style=dashed]
	layer_3_expert_sp1_ep11_tp0_pp0 [label="Expert L3 SP1 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep11_pp0 -> layer_3_expert_sp1_ep11_tp0_pp0
	layer_3_expert_out_sp1_ep11_tp0_pp0 [label="Expert Out L3 SP1 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep11_tp0_pp0 -> layer_3_expert_out_sp1_ep11_tp0_pp0
	layer_3_expert_sp1_ep11_tp1_pp0 [label="Expert L3 SP1 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep11_pp0 -> layer_3_expert_sp1_ep11_tp1_pp0
	layer_3_expert_out_sp1_ep11_tp1_pp0 [label="Expert Out L3 SP1 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep11_tp1_pp0 -> layer_3_expert_out_sp1_ep11_tp1_pp0
	layer_3_expert_sp1_ep11_tp2_pp0 [label="Expert L3 SP1 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep11_pp0 -> layer_3_expert_sp1_ep11_tp2_pp0
	layer_3_expert_out_sp1_ep11_tp2_pp0 [label="Expert Out L3 SP1 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep11_tp2_pp0 -> layer_3_expert_out_sp1_ep11_tp2_pp0
	layer_3_expert_sp1_ep11_tp3_pp0 [label="Expert L3 SP1 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep11_pp0 -> layer_3_expert_sp1_ep11_tp3_pp0
	layer_3_expert_out_sp1_ep11_tp3_pp0 [label="Expert Out L3 SP1 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep11_tp3_pp0 -> layer_3_expert_out_sp1_ep11_tp3_pp0
	layer_3_expert_ar_sp1_ep11_pp0 [label="Expert All-Reduce L3 SP1 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep11_tp0_pp0 -> layer_3_expert_ar_sp1_ep11_pp0
	layer_3_expert_out_sp1_ep11_tp1_pp0 -> layer_3_expert_ar_sp1_ep11_pp0
	layer_3_expert_out_sp1_ep11_tp2_pp0 -> layer_3_expert_ar_sp1_ep11_pp0
	layer_3_expert_out_sp1_ep11_tp3_pp0 -> layer_3_expert_ar_sp1_ep11_pp0
	layer_3_combine_sp1_ep11_pp0 [label="Token Combine L3 SP1 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep11_pp0 -> layer_3_combine_sp1_ep11_pp0
	layer_3_dispatch_sp1_ep12_pp0 [label="Token Dispatch L3 SP1 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep12_pp0 [style=dashed]
	layer_3_expert_sp1_ep12_tp0_pp0 [label="Expert L3 SP1 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep12_pp0 -> layer_3_expert_sp1_ep12_tp0_pp0
	layer_3_expert_out_sp1_ep12_tp0_pp0 [label="Expert Out L3 SP1 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep12_tp0_pp0 -> layer_3_expert_out_sp1_ep12_tp0_pp0
	layer_3_expert_sp1_ep12_tp1_pp0 [label="Expert L3 SP1 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep12_pp0 -> layer_3_expert_sp1_ep12_tp1_pp0
	layer_3_expert_out_sp1_ep12_tp1_pp0 [label="Expert Out L3 SP1 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep12_tp1_pp0 -> layer_3_expert_out_sp1_ep12_tp1_pp0
	layer_3_expert_sp1_ep12_tp2_pp0 [label="Expert L3 SP1 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep12_pp0 -> layer_3_expert_sp1_ep12_tp2_pp0
	layer_3_expert_out_sp1_ep12_tp2_pp0 [label="Expert Out L3 SP1 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep12_tp2_pp0 -> layer_3_expert_out_sp1_ep12_tp2_pp0
	layer_3_expert_sp1_ep12_tp3_pp0 [label="Expert L3 SP1 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep12_pp0 -> layer_3_expert_sp1_ep12_tp3_pp0
	layer_3_expert_out_sp1_ep12_tp3_pp0 [label="Expert Out L3 SP1 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep12_tp3_pp0 -> layer_3_expert_out_sp1_ep12_tp3_pp0
	layer_3_expert_ar_sp1_ep12_pp0 [label="Expert All-Reduce L3 SP1 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep12_tp0_pp0 -> layer_3_expert_ar_sp1_ep12_pp0
	layer_3_expert_out_sp1_ep12_tp1_pp0 -> layer_3_expert_ar_sp1_ep12_pp0
	layer_3_expert_out_sp1_ep12_tp2_pp0 -> layer_3_expert_ar_sp1_ep12_pp0
	layer_3_expert_out_sp1_ep12_tp3_pp0 -> layer_3_expert_ar_sp1_ep12_pp0
	layer_3_combine_sp1_ep12_pp0 [label="Token Combine L3 SP1 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep12_pp0 -> layer_3_combine_sp1_ep12_pp0
	layer_3_dispatch_sp1_ep13_pp0 [label="Token Dispatch L3 SP1 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep13_pp0 [style=dashed]
	layer_3_expert_sp1_ep13_tp0_pp0 [label="Expert L3 SP1 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep13_pp0 -> layer_3_expert_sp1_ep13_tp0_pp0
	layer_3_expert_out_sp1_ep13_tp0_pp0 [label="Expert Out L3 SP1 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep13_tp0_pp0 -> layer_3_expert_out_sp1_ep13_tp0_pp0
	layer_3_expert_sp1_ep13_tp1_pp0 [label="Expert L3 SP1 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep13_pp0 -> layer_3_expert_sp1_ep13_tp1_pp0
	layer_3_expert_out_sp1_ep13_tp1_pp0 [label="Expert Out L3 SP1 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep13_tp1_pp0 -> layer_3_expert_out_sp1_ep13_tp1_pp0
	layer_3_expert_sp1_ep13_tp2_pp0 [label="Expert L3 SP1 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep13_pp0 -> layer_3_expert_sp1_ep13_tp2_pp0
	layer_3_expert_out_sp1_ep13_tp2_pp0 [label="Expert Out L3 SP1 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep13_tp2_pp0 -> layer_3_expert_out_sp1_ep13_tp2_pp0
	layer_3_expert_sp1_ep13_tp3_pp0 [label="Expert L3 SP1 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep13_pp0 -> layer_3_expert_sp1_ep13_tp3_pp0
	layer_3_expert_out_sp1_ep13_tp3_pp0 [label="Expert Out L3 SP1 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep13_tp3_pp0 -> layer_3_expert_out_sp1_ep13_tp3_pp0
	layer_3_expert_ar_sp1_ep13_pp0 [label="Expert All-Reduce L3 SP1 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep13_tp0_pp0 -> layer_3_expert_ar_sp1_ep13_pp0
	layer_3_expert_out_sp1_ep13_tp1_pp0 -> layer_3_expert_ar_sp1_ep13_pp0
	layer_3_expert_out_sp1_ep13_tp2_pp0 -> layer_3_expert_ar_sp1_ep13_pp0
	layer_3_expert_out_sp1_ep13_tp3_pp0 -> layer_3_expert_ar_sp1_ep13_pp0
	layer_3_combine_sp1_ep13_pp0 [label="Token Combine L3 SP1 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep13_pp0 -> layer_3_combine_sp1_ep13_pp0
	layer_3_dispatch_sp1_ep14_pp0 [label="Token Dispatch L3 SP1 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep14_pp0 [style=dashed]
	layer_3_expert_sp1_ep14_tp0_pp0 [label="Expert L3 SP1 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep14_pp0 -> layer_3_expert_sp1_ep14_tp0_pp0
	layer_3_expert_out_sp1_ep14_tp0_pp0 [label="Expert Out L3 SP1 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep14_tp0_pp0 -> layer_3_expert_out_sp1_ep14_tp0_pp0
	layer_3_expert_sp1_ep14_tp1_pp0 [label="Expert L3 SP1 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep14_pp0 -> layer_3_expert_sp1_ep14_tp1_pp0
	layer_3_expert_out_sp1_ep14_tp1_pp0 [label="Expert Out L3 SP1 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep14_tp1_pp0 -> layer_3_expert_out_sp1_ep14_tp1_pp0
	layer_3_expert_sp1_ep14_tp2_pp0 [label="Expert L3 SP1 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep14_pp0 -> layer_3_expert_sp1_ep14_tp2_pp0
	layer_3_expert_out_sp1_ep14_tp2_pp0 [label="Expert Out L3 SP1 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep14_tp2_pp0 -> layer_3_expert_out_sp1_ep14_tp2_pp0
	layer_3_expert_sp1_ep14_tp3_pp0 [label="Expert L3 SP1 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep14_pp0 -> layer_3_expert_sp1_ep14_tp3_pp0
	layer_3_expert_out_sp1_ep14_tp3_pp0 [label="Expert Out L3 SP1 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep14_tp3_pp0 -> layer_3_expert_out_sp1_ep14_tp3_pp0
	layer_3_expert_ar_sp1_ep14_pp0 [label="Expert All-Reduce L3 SP1 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep14_tp0_pp0 -> layer_3_expert_ar_sp1_ep14_pp0
	layer_3_expert_out_sp1_ep14_tp1_pp0 -> layer_3_expert_ar_sp1_ep14_pp0
	layer_3_expert_out_sp1_ep14_tp2_pp0 -> layer_3_expert_ar_sp1_ep14_pp0
	layer_3_expert_out_sp1_ep14_tp3_pp0 -> layer_3_expert_ar_sp1_ep14_pp0
	layer_3_combine_sp1_ep14_pp0 [label="Token Combine L3 SP1 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep14_pp0 -> layer_3_combine_sp1_ep14_pp0
	layer_3_dispatch_sp1_ep15_pp0 [label="Token Dispatch L3 SP1 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp1_pp0 -> layer_3_dispatch_sp1_ep15_pp0 [style=dashed]
	layer_3_expert_sp1_ep15_tp0_pp0 [label="Expert L3 SP1 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep15_pp0 -> layer_3_expert_sp1_ep15_tp0_pp0
	layer_3_expert_out_sp1_ep15_tp0_pp0 [label="Expert Out L3 SP1 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep15_tp0_pp0 -> layer_3_expert_out_sp1_ep15_tp0_pp0
	layer_3_expert_sp1_ep15_tp1_pp0 [label="Expert L3 SP1 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep15_pp0 -> layer_3_expert_sp1_ep15_tp1_pp0
	layer_3_expert_out_sp1_ep15_tp1_pp0 [label="Expert Out L3 SP1 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep15_tp1_pp0 -> layer_3_expert_out_sp1_ep15_tp1_pp0
	layer_3_expert_sp1_ep15_tp2_pp0 [label="Expert L3 SP1 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep15_pp0 -> layer_3_expert_sp1_ep15_tp2_pp0
	layer_3_expert_out_sp1_ep15_tp2_pp0 [label="Expert Out L3 SP1 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep15_tp2_pp0 -> layer_3_expert_out_sp1_ep15_tp2_pp0
	layer_3_expert_sp1_ep15_tp3_pp0 [label="Expert L3 SP1 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp1_ep15_pp0 -> layer_3_expert_sp1_ep15_tp3_pp0
	layer_3_expert_out_sp1_ep15_tp3_pp0 [label="Expert Out L3 SP1 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp1_ep15_tp3_pp0 -> layer_3_expert_out_sp1_ep15_tp3_pp0
	layer_3_expert_ar_sp1_ep15_pp0 [label="Expert All-Reduce L3 SP1 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp1_ep15_tp0_pp0 -> layer_3_expert_ar_sp1_ep15_pp0
	layer_3_expert_out_sp1_ep15_tp1_pp0 -> layer_3_expert_ar_sp1_ep15_pp0
	layer_3_expert_out_sp1_ep15_tp2_pp0 -> layer_3_expert_ar_sp1_ep15_pp0
	layer_3_expert_out_sp1_ep15_tp3_pp0 -> layer_3_expert_ar_sp1_ep15_pp0
	layer_3_combine_sp1_ep15_pp0 [label="Token Combine L3 SP1 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp1_ep15_pp0 -> layer_3_combine_sp1_ep15_pp0
	layer_3_moe_all2all_sp1_pp0 [label="MoE All-to-All L3 SP1\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_3_combine_sp1_ep0_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep1_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep2_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep3_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep4_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep5_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep6_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep7_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep8_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep9_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep10_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep11_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep12_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep13_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep14_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_combine_sp1_ep15_pp0 -> layer_3_moe_all2all_sp1_pp0
	layer_3_mlp_out_sp1_pp0 [label="MoE Output L3 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_moe_all2all_sp1_pp0 -> layer_3_mlp_out_sp1_pp0
	layer_3_mlp_res_sp1_pp0 [label="MLP Residual L3 SP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_mlp_out_sp1_pp0 -> layer_3_mlp_res_sp1_pp0
	layer_3_attn_res_sp1_pp0 -> layer_3_mlp_res_sp1_pp0 [style=dashed]
	layer_3_norm_sp2_pp0 [label="LayerNorm L3 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_mlp_out_sp2_pp0 -> layer_3_norm_sp2_pp0
	layer_3_qkv_sp2_tp0_pp0 [label="QKV Proj L3 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp2_pp0 -> layer_3_qkv_sp2_tp0_pp0
	layer_3_attn_sp2_tp0_pp0 [label="Attention L3 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp2_tp0_pp0 -> layer_3_attn_sp2_tp0_pp0
	layer_3_attn_out_sp2_tp0_pp0 [label="Attn Out Proj L3 SP2 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp2_tp0_pp0 -> layer_3_attn_out_sp2_tp0_pp0
	layer_3_qkv_sp2_tp1_pp0 [label="QKV Proj L3 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp2_pp0 -> layer_3_qkv_sp2_tp1_pp0
	layer_3_attn_sp2_tp1_pp0 [label="Attention L3 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp2_tp1_pp0 -> layer_3_attn_sp2_tp1_pp0
	layer_3_attn_out_sp2_tp1_pp0 [label="Attn Out Proj L3 SP2 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp2_tp1_pp0 -> layer_3_attn_out_sp2_tp1_pp0
	layer_3_qkv_sp2_tp2_pp0 [label="QKV Proj L3 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp2_pp0 -> layer_3_qkv_sp2_tp2_pp0
	layer_3_attn_sp2_tp2_pp0 [label="Attention L3 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp2_tp2_pp0 -> layer_3_attn_sp2_tp2_pp0
	layer_3_attn_out_sp2_tp2_pp0 [label="Attn Out Proj L3 SP2 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp2_tp2_pp0 -> layer_3_attn_out_sp2_tp2_pp0
	layer_3_qkv_sp2_tp3_pp0 [label="QKV Proj L3 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp2_pp0 -> layer_3_qkv_sp2_tp3_pp0
	layer_3_attn_sp2_tp3_pp0 [label="Attention L3 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp2_tp3_pp0 -> layer_3_attn_sp2_tp3_pp0
	layer_3_attn_out_sp2_tp3_pp0 [label="Attn Out Proj L3 SP2 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp2_tp3_pp0 -> layer_3_attn_out_sp2_tp3_pp0
	layer_3_attn_ar_sp2_pp0 [label="Attention All-Reduce L3 SP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_attn_out_sp2_tp0_pp0 -> layer_3_attn_ar_sp2_pp0
	layer_3_attn_out_sp2_tp1_pp0 -> layer_3_attn_ar_sp2_pp0
	layer_3_attn_out_sp2_tp2_pp0 -> layer_3_attn_ar_sp2_pp0
	layer_3_attn_out_sp2_tp3_pp0 -> layer_3_attn_ar_sp2_pp0
	layer_3_attn_res_sp2_pp0 [label="Attention Residual L3 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_attn_ar_sp2_pp0 -> layer_3_attn_res_sp2_pp0
	layer_3_norm_sp2_pp0 -> layer_3_attn_res_sp2_pp0 [style=dashed]
	layer_3_post_norm_sp2_pp0 [label="Post-Attn Norm L3 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_attn_res_sp2_pp0 -> layer_3_post_norm_sp2_pp0
	layer_3_router_sp2_pp0 [label="MoE Router L3 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_3_post_norm_sp2_pp0 -> layer_3_router_sp2_pp0
	layer_3_dispatch_sp2_ep0_pp0 [label="Token Dispatch L3 SP2 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep0_pp0 [style=dashed]
	layer_3_expert_sp2_ep0_tp0_pp0 [label="Expert L3 SP2 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep0_pp0 -> layer_3_expert_sp2_ep0_tp0_pp0
	layer_3_expert_out_sp2_ep0_tp0_pp0 [label="Expert Out L3 SP2 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep0_tp0_pp0 -> layer_3_expert_out_sp2_ep0_tp0_pp0
	layer_3_expert_sp2_ep0_tp1_pp0 [label="Expert L3 SP2 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep0_pp0 -> layer_3_expert_sp2_ep0_tp1_pp0
	layer_3_expert_out_sp2_ep0_tp1_pp0 [label="Expert Out L3 SP2 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep0_tp1_pp0 -> layer_3_expert_out_sp2_ep0_tp1_pp0
	layer_3_expert_sp2_ep0_tp2_pp0 [label="Expert L3 SP2 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep0_pp0 -> layer_3_expert_sp2_ep0_tp2_pp0
	layer_3_expert_out_sp2_ep0_tp2_pp0 [label="Expert Out L3 SP2 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep0_tp2_pp0 -> layer_3_expert_out_sp2_ep0_tp2_pp0
	layer_3_expert_sp2_ep0_tp3_pp0 [label="Expert L3 SP2 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep0_pp0 -> layer_3_expert_sp2_ep0_tp3_pp0
	layer_3_expert_out_sp2_ep0_tp3_pp0 [label="Expert Out L3 SP2 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep0_tp3_pp0 -> layer_3_expert_out_sp2_ep0_tp3_pp0
	layer_3_expert_ar_sp2_ep0_pp0 [label="Expert All-Reduce L3 SP2 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep0_tp0_pp0 -> layer_3_expert_ar_sp2_ep0_pp0
	layer_3_expert_out_sp2_ep0_tp1_pp0 -> layer_3_expert_ar_sp2_ep0_pp0
	layer_3_expert_out_sp2_ep0_tp2_pp0 -> layer_3_expert_ar_sp2_ep0_pp0
	layer_3_expert_out_sp2_ep0_tp3_pp0 -> layer_3_expert_ar_sp2_ep0_pp0
	layer_3_combine_sp2_ep0_pp0 [label="Token Combine L3 SP2 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep0_pp0 -> layer_3_combine_sp2_ep0_pp0
	layer_3_dispatch_sp2_ep1_pp0 [label="Token Dispatch L3 SP2 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep1_pp0 [style=dashed]
	layer_3_expert_sp2_ep1_tp0_pp0 [label="Expert L3 SP2 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep1_pp0 -> layer_3_expert_sp2_ep1_tp0_pp0
	layer_3_expert_out_sp2_ep1_tp0_pp0 [label="Expert Out L3 SP2 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep1_tp0_pp0 -> layer_3_expert_out_sp2_ep1_tp0_pp0
	layer_3_expert_sp2_ep1_tp1_pp0 [label="Expert L3 SP2 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep1_pp0 -> layer_3_expert_sp2_ep1_tp1_pp0
	layer_3_expert_out_sp2_ep1_tp1_pp0 [label="Expert Out L3 SP2 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep1_tp1_pp0 -> layer_3_expert_out_sp2_ep1_tp1_pp0
	layer_3_expert_sp2_ep1_tp2_pp0 [label="Expert L3 SP2 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep1_pp0 -> layer_3_expert_sp2_ep1_tp2_pp0
	layer_3_expert_out_sp2_ep1_tp2_pp0 [label="Expert Out L3 SP2 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep1_tp2_pp0 -> layer_3_expert_out_sp2_ep1_tp2_pp0
	layer_3_expert_sp2_ep1_tp3_pp0 [label="Expert L3 SP2 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep1_pp0 -> layer_3_expert_sp2_ep1_tp3_pp0
	layer_3_expert_out_sp2_ep1_tp3_pp0 [label="Expert Out L3 SP2 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep1_tp3_pp0 -> layer_3_expert_out_sp2_ep1_tp3_pp0
	layer_3_expert_ar_sp2_ep1_pp0 [label="Expert All-Reduce L3 SP2 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep1_tp0_pp0 -> layer_3_expert_ar_sp2_ep1_pp0
	layer_3_expert_out_sp2_ep1_tp1_pp0 -> layer_3_expert_ar_sp2_ep1_pp0
	layer_3_expert_out_sp2_ep1_tp2_pp0 -> layer_3_expert_ar_sp2_ep1_pp0
	layer_3_expert_out_sp2_ep1_tp3_pp0 -> layer_3_expert_ar_sp2_ep1_pp0
	layer_3_combine_sp2_ep1_pp0 [label="Token Combine L3 SP2 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep1_pp0 -> layer_3_combine_sp2_ep1_pp0
	layer_3_dispatch_sp2_ep2_pp0 [label="Token Dispatch L3 SP2 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep2_pp0 [style=dashed]
	layer_3_expert_sp2_ep2_tp0_pp0 [label="Expert L3 SP2 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep2_pp0 -> layer_3_expert_sp2_ep2_tp0_pp0
	layer_3_expert_out_sp2_ep2_tp0_pp0 [label="Expert Out L3 SP2 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep2_tp0_pp0 -> layer_3_expert_out_sp2_ep2_tp0_pp0
	layer_3_expert_sp2_ep2_tp1_pp0 [label="Expert L3 SP2 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep2_pp0 -> layer_3_expert_sp2_ep2_tp1_pp0
	layer_3_expert_out_sp2_ep2_tp1_pp0 [label="Expert Out L3 SP2 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep2_tp1_pp0 -> layer_3_expert_out_sp2_ep2_tp1_pp0
	layer_3_expert_sp2_ep2_tp2_pp0 [label="Expert L3 SP2 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep2_pp0 -> layer_3_expert_sp2_ep2_tp2_pp0
	layer_3_expert_out_sp2_ep2_tp2_pp0 [label="Expert Out L3 SP2 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep2_tp2_pp0 -> layer_3_expert_out_sp2_ep2_tp2_pp0
	layer_3_expert_sp2_ep2_tp3_pp0 [label="Expert L3 SP2 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep2_pp0 -> layer_3_expert_sp2_ep2_tp3_pp0
	layer_3_expert_out_sp2_ep2_tp3_pp0 [label="Expert Out L3 SP2 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep2_tp3_pp0 -> layer_3_expert_out_sp2_ep2_tp3_pp0
	layer_3_expert_ar_sp2_ep2_pp0 [label="Expert All-Reduce L3 SP2 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep2_tp0_pp0 -> layer_3_expert_ar_sp2_ep2_pp0
	layer_3_expert_out_sp2_ep2_tp1_pp0 -> layer_3_expert_ar_sp2_ep2_pp0
	layer_3_expert_out_sp2_ep2_tp2_pp0 -> layer_3_expert_ar_sp2_ep2_pp0
	layer_3_expert_out_sp2_ep2_tp3_pp0 -> layer_3_expert_ar_sp2_ep2_pp0
	layer_3_combine_sp2_ep2_pp0 [label="Token Combine L3 SP2 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep2_pp0 -> layer_3_combine_sp2_ep2_pp0
	layer_3_dispatch_sp2_ep3_pp0 [label="Token Dispatch L3 SP2 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep3_pp0 [style=dashed]
	layer_3_expert_sp2_ep3_tp0_pp0 [label="Expert L3 SP2 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep3_pp0 -> layer_3_expert_sp2_ep3_tp0_pp0
	layer_3_expert_out_sp2_ep3_tp0_pp0 [label="Expert Out L3 SP2 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep3_tp0_pp0 -> layer_3_expert_out_sp2_ep3_tp0_pp0
	layer_3_expert_sp2_ep3_tp1_pp0 [label="Expert L3 SP2 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep3_pp0 -> layer_3_expert_sp2_ep3_tp1_pp0
	layer_3_expert_out_sp2_ep3_tp1_pp0 [label="Expert Out L3 SP2 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep3_tp1_pp0 -> layer_3_expert_out_sp2_ep3_tp1_pp0
	layer_3_expert_sp2_ep3_tp2_pp0 [label="Expert L3 SP2 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep3_pp0 -> layer_3_expert_sp2_ep3_tp2_pp0
	layer_3_expert_out_sp2_ep3_tp2_pp0 [label="Expert Out L3 SP2 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep3_tp2_pp0 -> layer_3_expert_out_sp2_ep3_tp2_pp0
	layer_3_expert_sp2_ep3_tp3_pp0 [label="Expert L3 SP2 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep3_pp0 -> layer_3_expert_sp2_ep3_tp3_pp0
	layer_3_expert_out_sp2_ep3_tp3_pp0 [label="Expert Out L3 SP2 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep3_tp3_pp0 -> layer_3_expert_out_sp2_ep3_tp3_pp0
	layer_3_expert_ar_sp2_ep3_pp0 [label="Expert All-Reduce L3 SP2 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep3_tp0_pp0 -> layer_3_expert_ar_sp2_ep3_pp0
	layer_3_expert_out_sp2_ep3_tp1_pp0 -> layer_3_expert_ar_sp2_ep3_pp0
	layer_3_expert_out_sp2_ep3_tp2_pp0 -> layer_3_expert_ar_sp2_ep3_pp0
	layer_3_expert_out_sp2_ep3_tp3_pp0 -> layer_3_expert_ar_sp2_ep3_pp0
	layer_3_combine_sp2_ep3_pp0 [label="Token Combine L3 SP2 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep3_pp0 -> layer_3_combine_sp2_ep3_pp0
	layer_3_dispatch_sp2_ep4_pp0 [label="Token Dispatch L3 SP2 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep4_pp0 [style=dashed]
	layer_3_expert_sp2_ep4_tp0_pp0 [label="Expert L3 SP2 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep4_pp0 -> layer_3_expert_sp2_ep4_tp0_pp0
	layer_3_expert_out_sp2_ep4_tp0_pp0 [label="Expert Out L3 SP2 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep4_tp0_pp0 -> layer_3_expert_out_sp2_ep4_tp0_pp0
	layer_3_expert_sp2_ep4_tp1_pp0 [label="Expert L3 SP2 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep4_pp0 -> layer_3_expert_sp2_ep4_tp1_pp0
	layer_3_expert_out_sp2_ep4_tp1_pp0 [label="Expert Out L3 SP2 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep4_tp1_pp0 -> layer_3_expert_out_sp2_ep4_tp1_pp0
	layer_3_expert_sp2_ep4_tp2_pp0 [label="Expert L3 SP2 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep4_pp0 -> layer_3_expert_sp2_ep4_tp2_pp0
	layer_3_expert_out_sp2_ep4_tp2_pp0 [label="Expert Out L3 SP2 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep4_tp2_pp0 -> layer_3_expert_out_sp2_ep4_tp2_pp0
	layer_3_expert_sp2_ep4_tp3_pp0 [label="Expert L3 SP2 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep4_pp0 -> layer_3_expert_sp2_ep4_tp3_pp0
	layer_3_expert_out_sp2_ep4_tp3_pp0 [label="Expert Out L3 SP2 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep4_tp3_pp0 -> layer_3_expert_out_sp2_ep4_tp3_pp0
	layer_3_expert_ar_sp2_ep4_pp0 [label="Expert All-Reduce L3 SP2 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep4_tp0_pp0 -> layer_3_expert_ar_sp2_ep4_pp0
	layer_3_expert_out_sp2_ep4_tp1_pp0 -> layer_3_expert_ar_sp2_ep4_pp0
	layer_3_expert_out_sp2_ep4_tp2_pp0 -> layer_3_expert_ar_sp2_ep4_pp0
	layer_3_expert_out_sp2_ep4_tp3_pp0 -> layer_3_expert_ar_sp2_ep4_pp0
	layer_3_combine_sp2_ep4_pp0 [label="Token Combine L3 SP2 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep4_pp0 -> layer_3_combine_sp2_ep4_pp0
	layer_3_dispatch_sp2_ep5_pp0 [label="Token Dispatch L3 SP2 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep5_pp0 [style=dashed]
	layer_3_expert_sp2_ep5_tp0_pp0 [label="Expert L3 SP2 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep5_pp0 -> layer_3_expert_sp2_ep5_tp0_pp0
	layer_3_expert_out_sp2_ep5_tp0_pp0 [label="Expert Out L3 SP2 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep5_tp0_pp0 -> layer_3_expert_out_sp2_ep5_tp0_pp0
	layer_3_expert_sp2_ep5_tp1_pp0 [label="Expert L3 SP2 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep5_pp0 -> layer_3_expert_sp2_ep5_tp1_pp0
	layer_3_expert_out_sp2_ep5_tp1_pp0 [label="Expert Out L3 SP2 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep5_tp1_pp0 -> layer_3_expert_out_sp2_ep5_tp1_pp0
	layer_3_expert_sp2_ep5_tp2_pp0 [label="Expert L3 SP2 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep5_pp0 -> layer_3_expert_sp2_ep5_tp2_pp0
	layer_3_expert_out_sp2_ep5_tp2_pp0 [label="Expert Out L3 SP2 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep5_tp2_pp0 -> layer_3_expert_out_sp2_ep5_tp2_pp0
	layer_3_expert_sp2_ep5_tp3_pp0 [label="Expert L3 SP2 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep5_pp0 -> layer_3_expert_sp2_ep5_tp3_pp0
	layer_3_expert_out_sp2_ep5_tp3_pp0 [label="Expert Out L3 SP2 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep5_tp3_pp0 -> layer_3_expert_out_sp2_ep5_tp3_pp0
	layer_3_expert_ar_sp2_ep5_pp0 [label="Expert All-Reduce L3 SP2 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep5_tp0_pp0 -> layer_3_expert_ar_sp2_ep5_pp0
	layer_3_expert_out_sp2_ep5_tp1_pp0 -> layer_3_expert_ar_sp2_ep5_pp0
	layer_3_expert_out_sp2_ep5_tp2_pp0 -> layer_3_expert_ar_sp2_ep5_pp0
	layer_3_expert_out_sp2_ep5_tp3_pp0 -> layer_3_expert_ar_sp2_ep5_pp0
	layer_3_combine_sp2_ep5_pp0 [label="Token Combine L3 SP2 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep5_pp0 -> layer_3_combine_sp2_ep5_pp0
	layer_3_dispatch_sp2_ep6_pp0 [label="Token Dispatch L3 SP2 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep6_pp0 [style=dashed]
	layer_3_expert_sp2_ep6_tp0_pp0 [label="Expert L3 SP2 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep6_pp0 -> layer_3_expert_sp2_ep6_tp0_pp0
	layer_3_expert_out_sp2_ep6_tp0_pp0 [label="Expert Out L3 SP2 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep6_tp0_pp0 -> layer_3_expert_out_sp2_ep6_tp0_pp0
	layer_3_expert_sp2_ep6_tp1_pp0 [label="Expert L3 SP2 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep6_pp0 -> layer_3_expert_sp2_ep6_tp1_pp0
	layer_3_expert_out_sp2_ep6_tp1_pp0 [label="Expert Out L3 SP2 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep6_tp1_pp0 -> layer_3_expert_out_sp2_ep6_tp1_pp0
	layer_3_expert_sp2_ep6_tp2_pp0 [label="Expert L3 SP2 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep6_pp0 -> layer_3_expert_sp2_ep6_tp2_pp0
	layer_3_expert_out_sp2_ep6_tp2_pp0 [label="Expert Out L3 SP2 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep6_tp2_pp0 -> layer_3_expert_out_sp2_ep6_tp2_pp0
	layer_3_expert_sp2_ep6_tp3_pp0 [label="Expert L3 SP2 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep6_pp0 -> layer_3_expert_sp2_ep6_tp3_pp0
	layer_3_expert_out_sp2_ep6_tp3_pp0 [label="Expert Out L3 SP2 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep6_tp3_pp0 -> layer_3_expert_out_sp2_ep6_tp3_pp0
	layer_3_expert_ar_sp2_ep6_pp0 [label="Expert All-Reduce L3 SP2 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep6_tp0_pp0 -> layer_3_expert_ar_sp2_ep6_pp0
	layer_3_expert_out_sp2_ep6_tp1_pp0 -> layer_3_expert_ar_sp2_ep6_pp0
	layer_3_expert_out_sp2_ep6_tp2_pp0 -> layer_3_expert_ar_sp2_ep6_pp0
	layer_3_expert_out_sp2_ep6_tp3_pp0 -> layer_3_expert_ar_sp2_ep6_pp0
	layer_3_combine_sp2_ep6_pp0 [label="Token Combine L3 SP2 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep6_pp0 -> layer_3_combine_sp2_ep6_pp0
	layer_3_dispatch_sp2_ep7_pp0 [label="Token Dispatch L3 SP2 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep7_pp0 [style=dashed]
	layer_3_expert_sp2_ep7_tp0_pp0 [label="Expert L3 SP2 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep7_pp0 -> layer_3_expert_sp2_ep7_tp0_pp0
	layer_3_expert_out_sp2_ep7_tp0_pp0 [label="Expert Out L3 SP2 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep7_tp0_pp0 -> layer_3_expert_out_sp2_ep7_tp0_pp0
	layer_3_expert_sp2_ep7_tp1_pp0 [label="Expert L3 SP2 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep7_pp0 -> layer_3_expert_sp2_ep7_tp1_pp0
	layer_3_expert_out_sp2_ep7_tp1_pp0 [label="Expert Out L3 SP2 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep7_tp1_pp0 -> layer_3_expert_out_sp2_ep7_tp1_pp0
	layer_3_expert_sp2_ep7_tp2_pp0 [label="Expert L3 SP2 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep7_pp0 -> layer_3_expert_sp2_ep7_tp2_pp0
	layer_3_expert_out_sp2_ep7_tp2_pp0 [label="Expert Out L3 SP2 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep7_tp2_pp0 -> layer_3_expert_out_sp2_ep7_tp2_pp0
	layer_3_expert_sp2_ep7_tp3_pp0 [label="Expert L3 SP2 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep7_pp0 -> layer_3_expert_sp2_ep7_tp3_pp0
	layer_3_expert_out_sp2_ep7_tp3_pp0 [label="Expert Out L3 SP2 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep7_tp3_pp0 -> layer_3_expert_out_sp2_ep7_tp3_pp0
	layer_3_expert_ar_sp2_ep7_pp0 [label="Expert All-Reduce L3 SP2 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep7_tp0_pp0 -> layer_3_expert_ar_sp2_ep7_pp0
	layer_3_expert_out_sp2_ep7_tp1_pp0 -> layer_3_expert_ar_sp2_ep7_pp0
	layer_3_expert_out_sp2_ep7_tp2_pp0 -> layer_3_expert_ar_sp2_ep7_pp0
	layer_3_expert_out_sp2_ep7_tp3_pp0 -> layer_3_expert_ar_sp2_ep7_pp0
	layer_3_combine_sp2_ep7_pp0 [label="Token Combine L3 SP2 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep7_pp0 -> layer_3_combine_sp2_ep7_pp0
	layer_3_dispatch_sp2_ep8_pp0 [label="Token Dispatch L3 SP2 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep8_pp0 [style=dashed]
	layer_3_expert_sp2_ep8_tp0_pp0 [label="Expert L3 SP2 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep8_pp0 -> layer_3_expert_sp2_ep8_tp0_pp0
	layer_3_expert_out_sp2_ep8_tp0_pp0 [label="Expert Out L3 SP2 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep8_tp0_pp0 -> layer_3_expert_out_sp2_ep8_tp0_pp0
	layer_3_expert_sp2_ep8_tp1_pp0 [label="Expert L3 SP2 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep8_pp0 -> layer_3_expert_sp2_ep8_tp1_pp0
	layer_3_expert_out_sp2_ep8_tp1_pp0 [label="Expert Out L3 SP2 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep8_tp1_pp0 -> layer_3_expert_out_sp2_ep8_tp1_pp0
	layer_3_expert_sp2_ep8_tp2_pp0 [label="Expert L3 SP2 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep8_pp0 -> layer_3_expert_sp2_ep8_tp2_pp0
	layer_3_expert_out_sp2_ep8_tp2_pp0 [label="Expert Out L3 SP2 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep8_tp2_pp0 -> layer_3_expert_out_sp2_ep8_tp2_pp0
	layer_3_expert_sp2_ep8_tp3_pp0 [label="Expert L3 SP2 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep8_pp0 -> layer_3_expert_sp2_ep8_tp3_pp0
	layer_3_expert_out_sp2_ep8_tp3_pp0 [label="Expert Out L3 SP2 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep8_tp3_pp0 -> layer_3_expert_out_sp2_ep8_tp3_pp0
	layer_3_expert_ar_sp2_ep8_pp0 [label="Expert All-Reduce L3 SP2 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep8_tp0_pp0 -> layer_3_expert_ar_sp2_ep8_pp0
	layer_3_expert_out_sp2_ep8_tp1_pp0 -> layer_3_expert_ar_sp2_ep8_pp0
	layer_3_expert_out_sp2_ep8_tp2_pp0 -> layer_3_expert_ar_sp2_ep8_pp0
	layer_3_expert_out_sp2_ep8_tp3_pp0 -> layer_3_expert_ar_sp2_ep8_pp0
	layer_3_combine_sp2_ep8_pp0 [label="Token Combine L3 SP2 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep8_pp0 -> layer_3_combine_sp2_ep8_pp0
	layer_3_dispatch_sp2_ep9_pp0 [label="Token Dispatch L3 SP2 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep9_pp0 [style=dashed]
	layer_3_expert_sp2_ep9_tp0_pp0 [label="Expert L3 SP2 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep9_pp0 -> layer_3_expert_sp2_ep9_tp0_pp0
	layer_3_expert_out_sp2_ep9_tp0_pp0 [label="Expert Out L3 SP2 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep9_tp0_pp0 -> layer_3_expert_out_sp2_ep9_tp0_pp0
	layer_3_expert_sp2_ep9_tp1_pp0 [label="Expert L3 SP2 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep9_pp0 -> layer_3_expert_sp2_ep9_tp1_pp0
	layer_3_expert_out_sp2_ep9_tp1_pp0 [label="Expert Out L3 SP2 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep9_tp1_pp0 -> layer_3_expert_out_sp2_ep9_tp1_pp0
	layer_3_expert_sp2_ep9_tp2_pp0 [label="Expert L3 SP2 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep9_pp0 -> layer_3_expert_sp2_ep9_tp2_pp0
	layer_3_expert_out_sp2_ep9_tp2_pp0 [label="Expert Out L3 SP2 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep9_tp2_pp0 -> layer_3_expert_out_sp2_ep9_tp2_pp0
	layer_3_expert_sp2_ep9_tp3_pp0 [label="Expert L3 SP2 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep9_pp0 -> layer_3_expert_sp2_ep9_tp3_pp0
	layer_3_expert_out_sp2_ep9_tp3_pp0 [label="Expert Out L3 SP2 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep9_tp3_pp0 -> layer_3_expert_out_sp2_ep9_tp3_pp0
	layer_3_expert_ar_sp2_ep9_pp0 [label="Expert All-Reduce L3 SP2 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep9_tp0_pp0 -> layer_3_expert_ar_sp2_ep9_pp0
	layer_3_expert_out_sp2_ep9_tp1_pp0 -> layer_3_expert_ar_sp2_ep9_pp0
	layer_3_expert_out_sp2_ep9_tp2_pp0 -> layer_3_expert_ar_sp2_ep9_pp0
	layer_3_expert_out_sp2_ep9_tp3_pp0 -> layer_3_expert_ar_sp2_ep9_pp0
	layer_3_combine_sp2_ep9_pp0 [label="Token Combine L3 SP2 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep9_pp0 -> layer_3_combine_sp2_ep9_pp0
	layer_3_dispatch_sp2_ep10_pp0 [label="Token Dispatch L3 SP2 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep10_pp0 [style=dashed]
	layer_3_expert_sp2_ep10_tp0_pp0 [label="Expert L3 SP2 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep10_pp0 -> layer_3_expert_sp2_ep10_tp0_pp0
	layer_3_expert_out_sp2_ep10_tp0_pp0 [label="Expert Out L3 SP2 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep10_tp0_pp0 -> layer_3_expert_out_sp2_ep10_tp0_pp0
	layer_3_expert_sp2_ep10_tp1_pp0 [label="Expert L3 SP2 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep10_pp0 -> layer_3_expert_sp2_ep10_tp1_pp0
	layer_3_expert_out_sp2_ep10_tp1_pp0 [label="Expert Out L3 SP2 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep10_tp1_pp0 -> layer_3_expert_out_sp2_ep10_tp1_pp0
	layer_3_expert_sp2_ep10_tp2_pp0 [label="Expert L3 SP2 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep10_pp0 -> layer_3_expert_sp2_ep10_tp2_pp0
	layer_3_expert_out_sp2_ep10_tp2_pp0 [label="Expert Out L3 SP2 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep10_tp2_pp0 -> layer_3_expert_out_sp2_ep10_tp2_pp0
	layer_3_expert_sp2_ep10_tp3_pp0 [label="Expert L3 SP2 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep10_pp0 -> layer_3_expert_sp2_ep10_tp3_pp0
	layer_3_expert_out_sp2_ep10_tp3_pp0 [label="Expert Out L3 SP2 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep10_tp3_pp0 -> layer_3_expert_out_sp2_ep10_tp3_pp0
	layer_3_expert_ar_sp2_ep10_pp0 [label="Expert All-Reduce L3 SP2 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep10_tp0_pp0 -> layer_3_expert_ar_sp2_ep10_pp0
	layer_3_expert_out_sp2_ep10_tp1_pp0 -> layer_3_expert_ar_sp2_ep10_pp0
	layer_3_expert_out_sp2_ep10_tp2_pp0 -> layer_3_expert_ar_sp2_ep10_pp0
	layer_3_expert_out_sp2_ep10_tp3_pp0 -> layer_3_expert_ar_sp2_ep10_pp0
	layer_3_combine_sp2_ep10_pp0 [label="Token Combine L3 SP2 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep10_pp0 -> layer_3_combine_sp2_ep10_pp0
	layer_3_dispatch_sp2_ep11_pp0 [label="Token Dispatch L3 SP2 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep11_pp0 [style=dashed]
	layer_3_expert_sp2_ep11_tp0_pp0 [label="Expert L3 SP2 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep11_pp0 -> layer_3_expert_sp2_ep11_tp0_pp0
	layer_3_expert_out_sp2_ep11_tp0_pp0 [label="Expert Out L3 SP2 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep11_tp0_pp0 -> layer_3_expert_out_sp2_ep11_tp0_pp0
	layer_3_expert_sp2_ep11_tp1_pp0 [label="Expert L3 SP2 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep11_pp0 -> layer_3_expert_sp2_ep11_tp1_pp0
	layer_3_expert_out_sp2_ep11_tp1_pp0 [label="Expert Out L3 SP2 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep11_tp1_pp0 -> layer_3_expert_out_sp2_ep11_tp1_pp0
	layer_3_expert_sp2_ep11_tp2_pp0 [label="Expert L3 SP2 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep11_pp0 -> layer_3_expert_sp2_ep11_tp2_pp0
	layer_3_expert_out_sp2_ep11_tp2_pp0 [label="Expert Out L3 SP2 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep11_tp2_pp0 -> layer_3_expert_out_sp2_ep11_tp2_pp0
	layer_3_expert_sp2_ep11_tp3_pp0 [label="Expert L3 SP2 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep11_pp0 -> layer_3_expert_sp2_ep11_tp3_pp0
	layer_3_expert_out_sp2_ep11_tp3_pp0 [label="Expert Out L3 SP2 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep11_tp3_pp0 -> layer_3_expert_out_sp2_ep11_tp3_pp0
	layer_3_expert_ar_sp2_ep11_pp0 [label="Expert All-Reduce L3 SP2 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep11_tp0_pp0 -> layer_3_expert_ar_sp2_ep11_pp0
	layer_3_expert_out_sp2_ep11_tp1_pp0 -> layer_3_expert_ar_sp2_ep11_pp0
	layer_3_expert_out_sp2_ep11_tp2_pp0 -> layer_3_expert_ar_sp2_ep11_pp0
	layer_3_expert_out_sp2_ep11_tp3_pp0 -> layer_3_expert_ar_sp2_ep11_pp0
	layer_3_combine_sp2_ep11_pp0 [label="Token Combine L3 SP2 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep11_pp0 -> layer_3_combine_sp2_ep11_pp0
	layer_3_dispatch_sp2_ep12_pp0 [label="Token Dispatch L3 SP2 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep12_pp0 [style=dashed]
	layer_3_expert_sp2_ep12_tp0_pp0 [label="Expert L3 SP2 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep12_pp0 -> layer_3_expert_sp2_ep12_tp0_pp0
	layer_3_expert_out_sp2_ep12_tp0_pp0 [label="Expert Out L3 SP2 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep12_tp0_pp0 -> layer_3_expert_out_sp2_ep12_tp0_pp0
	layer_3_expert_sp2_ep12_tp1_pp0 [label="Expert L3 SP2 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep12_pp0 -> layer_3_expert_sp2_ep12_tp1_pp0
	layer_3_expert_out_sp2_ep12_tp1_pp0 [label="Expert Out L3 SP2 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep12_tp1_pp0 -> layer_3_expert_out_sp2_ep12_tp1_pp0
	layer_3_expert_sp2_ep12_tp2_pp0 [label="Expert L3 SP2 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep12_pp0 -> layer_3_expert_sp2_ep12_tp2_pp0
	layer_3_expert_out_sp2_ep12_tp2_pp0 [label="Expert Out L3 SP2 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep12_tp2_pp0 -> layer_3_expert_out_sp2_ep12_tp2_pp0
	layer_3_expert_sp2_ep12_tp3_pp0 [label="Expert L3 SP2 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep12_pp0 -> layer_3_expert_sp2_ep12_tp3_pp0
	layer_3_expert_out_sp2_ep12_tp3_pp0 [label="Expert Out L3 SP2 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep12_tp3_pp0 -> layer_3_expert_out_sp2_ep12_tp3_pp0
	layer_3_expert_ar_sp2_ep12_pp0 [label="Expert All-Reduce L3 SP2 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep12_tp0_pp0 -> layer_3_expert_ar_sp2_ep12_pp0
	layer_3_expert_out_sp2_ep12_tp1_pp0 -> layer_3_expert_ar_sp2_ep12_pp0
	layer_3_expert_out_sp2_ep12_tp2_pp0 -> layer_3_expert_ar_sp2_ep12_pp0
	layer_3_expert_out_sp2_ep12_tp3_pp0 -> layer_3_expert_ar_sp2_ep12_pp0
	layer_3_combine_sp2_ep12_pp0 [label="Token Combine L3 SP2 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep12_pp0 -> layer_3_combine_sp2_ep12_pp0
	layer_3_dispatch_sp2_ep13_pp0 [label="Token Dispatch L3 SP2 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep13_pp0 [style=dashed]
	layer_3_expert_sp2_ep13_tp0_pp0 [label="Expert L3 SP2 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep13_pp0 -> layer_3_expert_sp2_ep13_tp0_pp0
	layer_3_expert_out_sp2_ep13_tp0_pp0 [label="Expert Out L3 SP2 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep13_tp0_pp0 -> layer_3_expert_out_sp2_ep13_tp0_pp0
	layer_3_expert_sp2_ep13_tp1_pp0 [label="Expert L3 SP2 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep13_pp0 -> layer_3_expert_sp2_ep13_tp1_pp0
	layer_3_expert_out_sp2_ep13_tp1_pp0 [label="Expert Out L3 SP2 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep13_tp1_pp0 -> layer_3_expert_out_sp2_ep13_tp1_pp0
	layer_3_expert_sp2_ep13_tp2_pp0 [label="Expert L3 SP2 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep13_pp0 -> layer_3_expert_sp2_ep13_tp2_pp0
	layer_3_expert_out_sp2_ep13_tp2_pp0 [label="Expert Out L3 SP2 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep13_tp2_pp0 -> layer_3_expert_out_sp2_ep13_tp2_pp0
	layer_3_expert_sp2_ep13_tp3_pp0 [label="Expert L3 SP2 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep13_pp0 -> layer_3_expert_sp2_ep13_tp3_pp0
	layer_3_expert_out_sp2_ep13_tp3_pp0 [label="Expert Out L3 SP2 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep13_tp3_pp0 -> layer_3_expert_out_sp2_ep13_tp3_pp0
	layer_3_expert_ar_sp2_ep13_pp0 [label="Expert All-Reduce L3 SP2 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep13_tp0_pp0 -> layer_3_expert_ar_sp2_ep13_pp0
	layer_3_expert_out_sp2_ep13_tp1_pp0 -> layer_3_expert_ar_sp2_ep13_pp0
	layer_3_expert_out_sp2_ep13_tp2_pp0 -> layer_3_expert_ar_sp2_ep13_pp0
	layer_3_expert_out_sp2_ep13_tp3_pp0 -> layer_3_expert_ar_sp2_ep13_pp0
	layer_3_combine_sp2_ep13_pp0 [label="Token Combine L3 SP2 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep13_pp0 -> layer_3_combine_sp2_ep13_pp0
	layer_3_dispatch_sp2_ep14_pp0 [label="Token Dispatch L3 SP2 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep14_pp0 [style=dashed]
	layer_3_expert_sp2_ep14_tp0_pp0 [label="Expert L3 SP2 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep14_pp0 -> layer_3_expert_sp2_ep14_tp0_pp0
	layer_3_expert_out_sp2_ep14_tp0_pp0 [label="Expert Out L3 SP2 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep14_tp0_pp0 -> layer_3_expert_out_sp2_ep14_tp0_pp0
	layer_3_expert_sp2_ep14_tp1_pp0 [label="Expert L3 SP2 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep14_pp0 -> layer_3_expert_sp2_ep14_tp1_pp0
	layer_3_expert_out_sp2_ep14_tp1_pp0 [label="Expert Out L3 SP2 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep14_tp1_pp0 -> layer_3_expert_out_sp2_ep14_tp1_pp0
	layer_3_expert_sp2_ep14_tp2_pp0 [label="Expert L3 SP2 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep14_pp0 -> layer_3_expert_sp2_ep14_tp2_pp0
	layer_3_expert_out_sp2_ep14_tp2_pp0 [label="Expert Out L3 SP2 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep14_tp2_pp0 -> layer_3_expert_out_sp2_ep14_tp2_pp0
	layer_3_expert_sp2_ep14_tp3_pp0 [label="Expert L3 SP2 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep14_pp0 -> layer_3_expert_sp2_ep14_tp3_pp0
	layer_3_expert_out_sp2_ep14_tp3_pp0 [label="Expert Out L3 SP2 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep14_tp3_pp0 -> layer_3_expert_out_sp2_ep14_tp3_pp0
	layer_3_expert_ar_sp2_ep14_pp0 [label="Expert All-Reduce L3 SP2 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep14_tp0_pp0 -> layer_3_expert_ar_sp2_ep14_pp0
	layer_3_expert_out_sp2_ep14_tp1_pp0 -> layer_3_expert_ar_sp2_ep14_pp0
	layer_3_expert_out_sp2_ep14_tp2_pp0 -> layer_3_expert_ar_sp2_ep14_pp0
	layer_3_expert_out_sp2_ep14_tp3_pp0 -> layer_3_expert_ar_sp2_ep14_pp0
	layer_3_combine_sp2_ep14_pp0 [label="Token Combine L3 SP2 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep14_pp0 -> layer_3_combine_sp2_ep14_pp0
	layer_3_dispatch_sp2_ep15_pp0 [label="Token Dispatch L3 SP2 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp2_pp0 -> layer_3_dispatch_sp2_ep15_pp0 [style=dashed]
	layer_3_expert_sp2_ep15_tp0_pp0 [label="Expert L3 SP2 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep15_pp0 -> layer_3_expert_sp2_ep15_tp0_pp0
	layer_3_expert_out_sp2_ep15_tp0_pp0 [label="Expert Out L3 SP2 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep15_tp0_pp0 -> layer_3_expert_out_sp2_ep15_tp0_pp0
	layer_3_expert_sp2_ep15_tp1_pp0 [label="Expert L3 SP2 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep15_pp0 -> layer_3_expert_sp2_ep15_tp1_pp0
	layer_3_expert_out_sp2_ep15_tp1_pp0 [label="Expert Out L3 SP2 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep15_tp1_pp0 -> layer_3_expert_out_sp2_ep15_tp1_pp0
	layer_3_expert_sp2_ep15_tp2_pp0 [label="Expert L3 SP2 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep15_pp0 -> layer_3_expert_sp2_ep15_tp2_pp0
	layer_3_expert_out_sp2_ep15_tp2_pp0 [label="Expert Out L3 SP2 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep15_tp2_pp0 -> layer_3_expert_out_sp2_ep15_tp2_pp0
	layer_3_expert_sp2_ep15_tp3_pp0 [label="Expert L3 SP2 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp2_ep15_pp0 -> layer_3_expert_sp2_ep15_tp3_pp0
	layer_3_expert_out_sp2_ep15_tp3_pp0 [label="Expert Out L3 SP2 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp2_ep15_tp3_pp0 -> layer_3_expert_out_sp2_ep15_tp3_pp0
	layer_3_expert_ar_sp2_ep15_pp0 [label="Expert All-Reduce L3 SP2 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp2_ep15_tp0_pp0 -> layer_3_expert_ar_sp2_ep15_pp0
	layer_3_expert_out_sp2_ep15_tp1_pp0 -> layer_3_expert_ar_sp2_ep15_pp0
	layer_3_expert_out_sp2_ep15_tp2_pp0 -> layer_3_expert_ar_sp2_ep15_pp0
	layer_3_expert_out_sp2_ep15_tp3_pp0 -> layer_3_expert_ar_sp2_ep15_pp0
	layer_3_combine_sp2_ep15_pp0 [label="Token Combine L3 SP2 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp2_ep15_pp0 -> layer_3_combine_sp2_ep15_pp0
	layer_3_moe_all2all_sp2_pp0 [label="MoE All-to-All L3 SP2\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_3_combine_sp2_ep0_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep1_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep2_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep3_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep4_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep5_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep6_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep7_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep8_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep9_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep10_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep11_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep12_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep13_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep14_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_combine_sp2_ep15_pp0 -> layer_3_moe_all2all_sp2_pp0
	layer_3_mlp_out_sp2_pp0 [label="MoE Output L3 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_moe_all2all_sp2_pp0 -> layer_3_mlp_out_sp2_pp0
	layer_3_mlp_res_sp2_pp0 [label="MLP Residual L3 SP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_mlp_out_sp2_pp0 -> layer_3_mlp_res_sp2_pp0
	layer_3_attn_res_sp2_pp0 -> layer_3_mlp_res_sp2_pp0 [style=dashed]
	layer_3_norm_sp3_pp0 [label="LayerNorm L3 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_2_mlp_out_sp3_pp0 -> layer_3_norm_sp3_pp0
	layer_3_qkv_sp3_tp0_pp0 [label="QKV Proj L3 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp3_pp0 -> layer_3_qkv_sp3_tp0_pp0
	layer_3_attn_sp3_tp0_pp0 [label="Attention L3 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp3_tp0_pp0 -> layer_3_attn_sp3_tp0_pp0
	layer_3_attn_out_sp3_tp0_pp0 [label="Attn Out Proj L3 SP3 TP0\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp3_tp0_pp0 -> layer_3_attn_out_sp3_tp0_pp0
	layer_3_qkv_sp3_tp1_pp0 [label="QKV Proj L3 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp3_pp0 -> layer_3_qkv_sp3_tp1_pp0
	layer_3_attn_sp3_tp1_pp0 [label="Attention L3 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp3_tp1_pp0 -> layer_3_attn_sp3_tp1_pp0
	layer_3_attn_out_sp3_tp1_pp0 [label="Attn Out Proj L3 SP3 TP1\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp3_tp1_pp0 -> layer_3_attn_out_sp3_tp1_pp0
	layer_3_qkv_sp3_tp2_pp0 [label="QKV Proj L3 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp3_pp0 -> layer_3_qkv_sp3_tp2_pp0
	layer_3_attn_sp3_tp2_pp0 [label="Attention L3 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp3_tp2_pp0 -> layer_3_attn_sp3_tp2_pp0
	layer_3_attn_out_sp3_tp2_pp0 [label="Attn Out Proj L3 SP3 TP2\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp3_tp2_pp0 -> layer_3_attn_out_sp3_tp2_pp0
	layer_3_qkv_sp3_tp3_pp0 [label="QKV Proj L3 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_norm_sp3_pp0 -> layer_3_qkv_sp3_tp3_pp0
	layer_3_attn_sp3_tp3_pp0 [label="Attention L3 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_qkv_sp3_tp3_pp0 -> layer_3_attn_sp3_tp3_pp0
	layer_3_attn_out_sp3_tp3_pp0 [label="Attn Out Proj L3 SP3 TP3\nPP Stage 0\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_3_attn_sp3_tp3_pp0 -> layer_3_attn_out_sp3_tp3_pp0
	layer_3_attn_ar_sp3_pp0 [label="Attention All-Reduce L3 SP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_attn_out_sp3_tp0_pp0 -> layer_3_attn_ar_sp3_pp0
	layer_3_attn_out_sp3_tp1_pp0 -> layer_3_attn_ar_sp3_pp0
	layer_3_attn_out_sp3_tp2_pp0 -> layer_3_attn_ar_sp3_pp0
	layer_3_attn_out_sp3_tp3_pp0 -> layer_3_attn_ar_sp3_pp0
	layer_3_attn_res_sp3_pp0 [label="Attention Residual L3 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_attn_ar_sp3_pp0 -> layer_3_attn_res_sp3_pp0
	layer_3_norm_sp3_pp0 -> layer_3_attn_res_sp3_pp0 [style=dashed]
	layer_3_post_norm_sp3_pp0 [label="Post-Attn Norm L3 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_attn_res_sp3_pp0 -> layer_3_post_norm_sp3_pp0
	layer_3_router_sp3_pp0 [label="MoE Router L3 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_3_post_norm_sp3_pp0 -> layer_3_router_sp3_pp0
	layer_3_dispatch_sp3_ep0_pp0 [label="Token Dispatch L3 SP3 EP0\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep0_pp0 [style=dashed]
	layer_3_expert_sp3_ep0_tp0_pp0 [label="Expert L3 SP3 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep0_pp0 -> layer_3_expert_sp3_ep0_tp0_pp0
	layer_3_expert_out_sp3_ep0_tp0_pp0 [label="Expert Out L3 SP3 EP0 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep0_tp0_pp0 -> layer_3_expert_out_sp3_ep0_tp0_pp0
	layer_3_expert_sp3_ep0_tp1_pp0 [label="Expert L3 SP3 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep0_pp0 -> layer_3_expert_sp3_ep0_tp1_pp0
	layer_3_expert_out_sp3_ep0_tp1_pp0 [label="Expert Out L3 SP3 EP0 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep0_tp1_pp0 -> layer_3_expert_out_sp3_ep0_tp1_pp0
	layer_3_expert_sp3_ep0_tp2_pp0 [label="Expert L3 SP3 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep0_pp0 -> layer_3_expert_sp3_ep0_tp2_pp0
	layer_3_expert_out_sp3_ep0_tp2_pp0 [label="Expert Out L3 SP3 EP0 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep0_tp2_pp0 -> layer_3_expert_out_sp3_ep0_tp2_pp0
	layer_3_expert_sp3_ep0_tp3_pp0 [label="Expert L3 SP3 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep0_pp0 -> layer_3_expert_sp3_ep0_tp3_pp0
	layer_3_expert_out_sp3_ep0_tp3_pp0 [label="Expert Out L3 SP3 EP0 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep0_tp3_pp0 -> layer_3_expert_out_sp3_ep0_tp3_pp0
	layer_3_expert_ar_sp3_ep0_pp0 [label="Expert All-Reduce L3 SP3 EP0\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep0_tp0_pp0 -> layer_3_expert_ar_sp3_ep0_pp0
	layer_3_expert_out_sp3_ep0_tp1_pp0 -> layer_3_expert_ar_sp3_ep0_pp0
	layer_3_expert_out_sp3_ep0_tp2_pp0 -> layer_3_expert_ar_sp3_ep0_pp0
	layer_3_expert_out_sp3_ep0_tp3_pp0 -> layer_3_expert_ar_sp3_ep0_pp0
	layer_3_combine_sp3_ep0_pp0 [label="Token Combine L3 SP3 EP0\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep0_pp0 -> layer_3_combine_sp3_ep0_pp0
	layer_3_dispatch_sp3_ep1_pp0 [label="Token Dispatch L3 SP3 EP1\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep1_pp0 [style=dashed]
	layer_3_expert_sp3_ep1_tp0_pp0 [label="Expert L3 SP3 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep1_pp0 -> layer_3_expert_sp3_ep1_tp0_pp0
	layer_3_expert_out_sp3_ep1_tp0_pp0 [label="Expert Out L3 SP3 EP1 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep1_tp0_pp0 -> layer_3_expert_out_sp3_ep1_tp0_pp0
	layer_3_expert_sp3_ep1_tp1_pp0 [label="Expert L3 SP3 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep1_pp0 -> layer_3_expert_sp3_ep1_tp1_pp0
	layer_3_expert_out_sp3_ep1_tp1_pp0 [label="Expert Out L3 SP3 EP1 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep1_tp1_pp0 -> layer_3_expert_out_sp3_ep1_tp1_pp0
	layer_3_expert_sp3_ep1_tp2_pp0 [label="Expert L3 SP3 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep1_pp0 -> layer_3_expert_sp3_ep1_tp2_pp0
	layer_3_expert_out_sp3_ep1_tp2_pp0 [label="Expert Out L3 SP3 EP1 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep1_tp2_pp0 -> layer_3_expert_out_sp3_ep1_tp2_pp0
	layer_3_expert_sp3_ep1_tp3_pp0 [label="Expert L3 SP3 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep1_pp0 -> layer_3_expert_sp3_ep1_tp3_pp0
	layer_3_expert_out_sp3_ep1_tp3_pp0 [label="Expert Out L3 SP3 EP1 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep1_tp3_pp0 -> layer_3_expert_out_sp3_ep1_tp3_pp0
	layer_3_expert_ar_sp3_ep1_pp0 [label="Expert All-Reduce L3 SP3 EP1\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep1_tp0_pp0 -> layer_3_expert_ar_sp3_ep1_pp0
	layer_3_expert_out_sp3_ep1_tp1_pp0 -> layer_3_expert_ar_sp3_ep1_pp0
	layer_3_expert_out_sp3_ep1_tp2_pp0 -> layer_3_expert_ar_sp3_ep1_pp0
	layer_3_expert_out_sp3_ep1_tp3_pp0 -> layer_3_expert_ar_sp3_ep1_pp0
	layer_3_combine_sp3_ep1_pp0 [label="Token Combine L3 SP3 EP1\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep1_pp0 -> layer_3_combine_sp3_ep1_pp0
	layer_3_dispatch_sp3_ep2_pp0 [label="Token Dispatch L3 SP3 EP2\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep2_pp0 [style=dashed]
	layer_3_expert_sp3_ep2_tp0_pp0 [label="Expert L3 SP3 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep2_pp0 -> layer_3_expert_sp3_ep2_tp0_pp0
	layer_3_expert_out_sp3_ep2_tp0_pp0 [label="Expert Out L3 SP3 EP2 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep2_tp0_pp0 -> layer_3_expert_out_sp3_ep2_tp0_pp0
	layer_3_expert_sp3_ep2_tp1_pp0 [label="Expert L3 SP3 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep2_pp0 -> layer_3_expert_sp3_ep2_tp1_pp0
	layer_3_expert_out_sp3_ep2_tp1_pp0 [label="Expert Out L3 SP3 EP2 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep2_tp1_pp0 -> layer_3_expert_out_sp3_ep2_tp1_pp0
	layer_3_expert_sp3_ep2_tp2_pp0 [label="Expert L3 SP3 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep2_pp0 -> layer_3_expert_sp3_ep2_tp2_pp0
	layer_3_expert_out_sp3_ep2_tp2_pp0 [label="Expert Out L3 SP3 EP2 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep2_tp2_pp0 -> layer_3_expert_out_sp3_ep2_tp2_pp0
	layer_3_expert_sp3_ep2_tp3_pp0 [label="Expert L3 SP3 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep2_pp0 -> layer_3_expert_sp3_ep2_tp3_pp0
	layer_3_expert_out_sp3_ep2_tp3_pp0 [label="Expert Out L3 SP3 EP2 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep2_tp3_pp0 -> layer_3_expert_out_sp3_ep2_tp3_pp0
	layer_3_expert_ar_sp3_ep2_pp0 [label="Expert All-Reduce L3 SP3 EP2\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep2_tp0_pp0 -> layer_3_expert_ar_sp3_ep2_pp0
	layer_3_expert_out_sp3_ep2_tp1_pp0 -> layer_3_expert_ar_sp3_ep2_pp0
	layer_3_expert_out_sp3_ep2_tp2_pp0 -> layer_3_expert_ar_sp3_ep2_pp0
	layer_3_expert_out_sp3_ep2_tp3_pp0 -> layer_3_expert_ar_sp3_ep2_pp0
	layer_3_combine_sp3_ep2_pp0 [label="Token Combine L3 SP3 EP2\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep2_pp0 -> layer_3_combine_sp3_ep2_pp0
	layer_3_dispatch_sp3_ep3_pp0 [label="Token Dispatch L3 SP3 EP3\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep3_pp0 [style=dashed]
	layer_3_expert_sp3_ep3_tp0_pp0 [label="Expert L3 SP3 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep3_pp0 -> layer_3_expert_sp3_ep3_tp0_pp0
	layer_3_expert_out_sp3_ep3_tp0_pp0 [label="Expert Out L3 SP3 EP3 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep3_tp0_pp0 -> layer_3_expert_out_sp3_ep3_tp0_pp0
	layer_3_expert_sp3_ep3_tp1_pp0 [label="Expert L3 SP3 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep3_pp0 -> layer_3_expert_sp3_ep3_tp1_pp0
	layer_3_expert_out_sp3_ep3_tp1_pp0 [label="Expert Out L3 SP3 EP3 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep3_tp1_pp0 -> layer_3_expert_out_sp3_ep3_tp1_pp0
	layer_3_expert_sp3_ep3_tp2_pp0 [label="Expert L3 SP3 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep3_pp0 -> layer_3_expert_sp3_ep3_tp2_pp0
	layer_3_expert_out_sp3_ep3_tp2_pp0 [label="Expert Out L3 SP3 EP3 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep3_tp2_pp0 -> layer_3_expert_out_sp3_ep3_tp2_pp0
	layer_3_expert_sp3_ep3_tp3_pp0 [label="Expert L3 SP3 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep3_pp0 -> layer_3_expert_sp3_ep3_tp3_pp0
	layer_3_expert_out_sp3_ep3_tp3_pp0 [label="Expert Out L3 SP3 EP3 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep3_tp3_pp0 -> layer_3_expert_out_sp3_ep3_tp3_pp0
	layer_3_expert_ar_sp3_ep3_pp0 [label="Expert All-Reduce L3 SP3 EP3\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep3_tp0_pp0 -> layer_3_expert_ar_sp3_ep3_pp0
	layer_3_expert_out_sp3_ep3_tp1_pp0 -> layer_3_expert_ar_sp3_ep3_pp0
	layer_3_expert_out_sp3_ep3_tp2_pp0 -> layer_3_expert_ar_sp3_ep3_pp0
	layer_3_expert_out_sp3_ep3_tp3_pp0 -> layer_3_expert_ar_sp3_ep3_pp0
	layer_3_combine_sp3_ep3_pp0 [label="Token Combine L3 SP3 EP3\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep3_pp0 -> layer_3_combine_sp3_ep3_pp0
	layer_3_dispatch_sp3_ep4_pp0 [label="Token Dispatch L3 SP3 EP4\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep4_pp0 [style=dashed]
	layer_3_expert_sp3_ep4_tp0_pp0 [label="Expert L3 SP3 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep4_pp0 -> layer_3_expert_sp3_ep4_tp0_pp0
	layer_3_expert_out_sp3_ep4_tp0_pp0 [label="Expert Out L3 SP3 EP4 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep4_tp0_pp0 -> layer_3_expert_out_sp3_ep4_tp0_pp0
	layer_3_expert_sp3_ep4_tp1_pp0 [label="Expert L3 SP3 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep4_pp0 -> layer_3_expert_sp3_ep4_tp1_pp0
	layer_3_expert_out_sp3_ep4_tp1_pp0 [label="Expert Out L3 SP3 EP4 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep4_tp1_pp0 -> layer_3_expert_out_sp3_ep4_tp1_pp0
	layer_3_expert_sp3_ep4_tp2_pp0 [label="Expert L3 SP3 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep4_pp0 -> layer_3_expert_sp3_ep4_tp2_pp0
	layer_3_expert_out_sp3_ep4_tp2_pp0 [label="Expert Out L3 SP3 EP4 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep4_tp2_pp0 -> layer_3_expert_out_sp3_ep4_tp2_pp0
	layer_3_expert_sp3_ep4_tp3_pp0 [label="Expert L3 SP3 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep4_pp0 -> layer_3_expert_sp3_ep4_tp3_pp0
	layer_3_expert_out_sp3_ep4_tp3_pp0 [label="Expert Out L3 SP3 EP4 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep4_tp3_pp0 -> layer_3_expert_out_sp3_ep4_tp3_pp0
	layer_3_expert_ar_sp3_ep4_pp0 [label="Expert All-Reduce L3 SP3 EP4\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep4_tp0_pp0 -> layer_3_expert_ar_sp3_ep4_pp0
	layer_3_expert_out_sp3_ep4_tp1_pp0 -> layer_3_expert_ar_sp3_ep4_pp0
	layer_3_expert_out_sp3_ep4_tp2_pp0 -> layer_3_expert_ar_sp3_ep4_pp0
	layer_3_expert_out_sp3_ep4_tp3_pp0 -> layer_3_expert_ar_sp3_ep4_pp0
	layer_3_combine_sp3_ep4_pp0 [label="Token Combine L3 SP3 EP4\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep4_pp0 -> layer_3_combine_sp3_ep4_pp0
	layer_3_dispatch_sp3_ep5_pp0 [label="Token Dispatch L3 SP3 EP5\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep5_pp0 [style=dashed]
	layer_3_expert_sp3_ep5_tp0_pp0 [label="Expert L3 SP3 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep5_pp0 -> layer_3_expert_sp3_ep5_tp0_pp0
	layer_3_expert_out_sp3_ep5_tp0_pp0 [label="Expert Out L3 SP3 EP5 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep5_tp0_pp0 -> layer_3_expert_out_sp3_ep5_tp0_pp0
	layer_3_expert_sp3_ep5_tp1_pp0 [label="Expert L3 SP3 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep5_pp0 -> layer_3_expert_sp3_ep5_tp1_pp0
	layer_3_expert_out_sp3_ep5_tp1_pp0 [label="Expert Out L3 SP3 EP5 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep5_tp1_pp0 -> layer_3_expert_out_sp3_ep5_tp1_pp0
	layer_3_expert_sp3_ep5_tp2_pp0 [label="Expert L3 SP3 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep5_pp0 -> layer_3_expert_sp3_ep5_tp2_pp0
	layer_3_expert_out_sp3_ep5_tp2_pp0 [label="Expert Out L3 SP3 EP5 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep5_tp2_pp0 -> layer_3_expert_out_sp3_ep5_tp2_pp0
	layer_3_expert_sp3_ep5_tp3_pp0 [label="Expert L3 SP3 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep5_pp0 -> layer_3_expert_sp3_ep5_tp3_pp0
	layer_3_expert_out_sp3_ep5_tp3_pp0 [label="Expert Out L3 SP3 EP5 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep5_tp3_pp0 -> layer_3_expert_out_sp3_ep5_tp3_pp0
	layer_3_expert_ar_sp3_ep5_pp0 [label="Expert All-Reduce L3 SP3 EP5\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep5_tp0_pp0 -> layer_3_expert_ar_sp3_ep5_pp0
	layer_3_expert_out_sp3_ep5_tp1_pp0 -> layer_3_expert_ar_sp3_ep5_pp0
	layer_3_expert_out_sp3_ep5_tp2_pp0 -> layer_3_expert_ar_sp3_ep5_pp0
	layer_3_expert_out_sp3_ep5_tp3_pp0 -> layer_3_expert_ar_sp3_ep5_pp0
	layer_3_combine_sp3_ep5_pp0 [label="Token Combine L3 SP3 EP5\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep5_pp0 -> layer_3_combine_sp3_ep5_pp0
	layer_3_dispatch_sp3_ep6_pp0 [label="Token Dispatch L3 SP3 EP6\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep6_pp0 [style=dashed]
	layer_3_expert_sp3_ep6_tp0_pp0 [label="Expert L3 SP3 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep6_pp0 -> layer_3_expert_sp3_ep6_tp0_pp0
	layer_3_expert_out_sp3_ep6_tp0_pp0 [label="Expert Out L3 SP3 EP6 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep6_tp0_pp0 -> layer_3_expert_out_sp3_ep6_tp0_pp0
	layer_3_expert_sp3_ep6_tp1_pp0 [label="Expert L3 SP3 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep6_pp0 -> layer_3_expert_sp3_ep6_tp1_pp0
	layer_3_expert_out_sp3_ep6_tp1_pp0 [label="Expert Out L3 SP3 EP6 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep6_tp1_pp0 -> layer_3_expert_out_sp3_ep6_tp1_pp0
	layer_3_expert_sp3_ep6_tp2_pp0 [label="Expert L3 SP3 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep6_pp0 -> layer_3_expert_sp3_ep6_tp2_pp0
	layer_3_expert_out_sp3_ep6_tp2_pp0 [label="Expert Out L3 SP3 EP6 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep6_tp2_pp0 -> layer_3_expert_out_sp3_ep6_tp2_pp0
	layer_3_expert_sp3_ep6_tp3_pp0 [label="Expert L3 SP3 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep6_pp0 -> layer_3_expert_sp3_ep6_tp3_pp0
	layer_3_expert_out_sp3_ep6_tp3_pp0 [label="Expert Out L3 SP3 EP6 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep6_tp3_pp0 -> layer_3_expert_out_sp3_ep6_tp3_pp0
	layer_3_expert_ar_sp3_ep6_pp0 [label="Expert All-Reduce L3 SP3 EP6\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep6_tp0_pp0 -> layer_3_expert_ar_sp3_ep6_pp0
	layer_3_expert_out_sp3_ep6_tp1_pp0 -> layer_3_expert_ar_sp3_ep6_pp0
	layer_3_expert_out_sp3_ep6_tp2_pp0 -> layer_3_expert_ar_sp3_ep6_pp0
	layer_3_expert_out_sp3_ep6_tp3_pp0 -> layer_3_expert_ar_sp3_ep6_pp0
	layer_3_combine_sp3_ep6_pp0 [label="Token Combine L3 SP3 EP6\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep6_pp0 -> layer_3_combine_sp3_ep6_pp0
	layer_3_dispatch_sp3_ep7_pp0 [label="Token Dispatch L3 SP3 EP7\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep7_pp0 [style=dashed]
	layer_3_expert_sp3_ep7_tp0_pp0 [label="Expert L3 SP3 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep7_pp0 -> layer_3_expert_sp3_ep7_tp0_pp0
	layer_3_expert_out_sp3_ep7_tp0_pp0 [label="Expert Out L3 SP3 EP7 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep7_tp0_pp0 -> layer_3_expert_out_sp3_ep7_tp0_pp0
	layer_3_expert_sp3_ep7_tp1_pp0 [label="Expert L3 SP3 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep7_pp0 -> layer_3_expert_sp3_ep7_tp1_pp0
	layer_3_expert_out_sp3_ep7_tp1_pp0 [label="Expert Out L3 SP3 EP7 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep7_tp1_pp0 -> layer_3_expert_out_sp3_ep7_tp1_pp0
	layer_3_expert_sp3_ep7_tp2_pp0 [label="Expert L3 SP3 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep7_pp0 -> layer_3_expert_sp3_ep7_tp2_pp0
	layer_3_expert_out_sp3_ep7_tp2_pp0 [label="Expert Out L3 SP3 EP7 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep7_tp2_pp0 -> layer_3_expert_out_sp3_ep7_tp2_pp0
	layer_3_expert_sp3_ep7_tp3_pp0 [label="Expert L3 SP3 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep7_pp0 -> layer_3_expert_sp3_ep7_tp3_pp0
	layer_3_expert_out_sp3_ep7_tp3_pp0 [label="Expert Out L3 SP3 EP7 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep7_tp3_pp0 -> layer_3_expert_out_sp3_ep7_tp3_pp0
	layer_3_expert_ar_sp3_ep7_pp0 [label="Expert All-Reduce L3 SP3 EP7\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep7_tp0_pp0 -> layer_3_expert_ar_sp3_ep7_pp0
	layer_3_expert_out_sp3_ep7_tp1_pp0 -> layer_3_expert_ar_sp3_ep7_pp0
	layer_3_expert_out_sp3_ep7_tp2_pp0 -> layer_3_expert_ar_sp3_ep7_pp0
	layer_3_expert_out_sp3_ep7_tp3_pp0 -> layer_3_expert_ar_sp3_ep7_pp0
	layer_3_combine_sp3_ep7_pp0 [label="Token Combine L3 SP3 EP7\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep7_pp0 -> layer_3_combine_sp3_ep7_pp0
	layer_3_dispatch_sp3_ep8_pp0 [label="Token Dispatch L3 SP3 EP8\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep8_pp0 [style=dashed]
	layer_3_expert_sp3_ep8_tp0_pp0 [label="Expert L3 SP3 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep8_pp0 -> layer_3_expert_sp3_ep8_tp0_pp0
	layer_3_expert_out_sp3_ep8_tp0_pp0 [label="Expert Out L3 SP3 EP8 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep8_tp0_pp0 -> layer_3_expert_out_sp3_ep8_tp0_pp0
	layer_3_expert_sp3_ep8_tp1_pp0 [label="Expert L3 SP3 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep8_pp0 -> layer_3_expert_sp3_ep8_tp1_pp0
	layer_3_expert_out_sp3_ep8_tp1_pp0 [label="Expert Out L3 SP3 EP8 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep8_tp1_pp0 -> layer_3_expert_out_sp3_ep8_tp1_pp0
	layer_3_expert_sp3_ep8_tp2_pp0 [label="Expert L3 SP3 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep8_pp0 -> layer_3_expert_sp3_ep8_tp2_pp0
	layer_3_expert_out_sp3_ep8_tp2_pp0 [label="Expert Out L3 SP3 EP8 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep8_tp2_pp0 -> layer_3_expert_out_sp3_ep8_tp2_pp0
	layer_3_expert_sp3_ep8_tp3_pp0 [label="Expert L3 SP3 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep8_pp0 -> layer_3_expert_sp3_ep8_tp3_pp0
	layer_3_expert_out_sp3_ep8_tp3_pp0 [label="Expert Out L3 SP3 EP8 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep8_tp3_pp0 -> layer_3_expert_out_sp3_ep8_tp3_pp0
	layer_3_expert_ar_sp3_ep8_pp0 [label="Expert All-Reduce L3 SP3 EP8\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep8_tp0_pp0 -> layer_3_expert_ar_sp3_ep8_pp0
	layer_3_expert_out_sp3_ep8_tp1_pp0 -> layer_3_expert_ar_sp3_ep8_pp0
	layer_3_expert_out_sp3_ep8_tp2_pp0 -> layer_3_expert_ar_sp3_ep8_pp0
	layer_3_expert_out_sp3_ep8_tp3_pp0 -> layer_3_expert_ar_sp3_ep8_pp0
	layer_3_combine_sp3_ep8_pp0 [label="Token Combine L3 SP3 EP8\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep8_pp0 -> layer_3_combine_sp3_ep8_pp0
	layer_3_dispatch_sp3_ep9_pp0 [label="Token Dispatch L3 SP3 EP9\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep9_pp0 [style=dashed]
	layer_3_expert_sp3_ep9_tp0_pp0 [label="Expert L3 SP3 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep9_pp0 -> layer_3_expert_sp3_ep9_tp0_pp0
	layer_3_expert_out_sp3_ep9_tp0_pp0 [label="Expert Out L3 SP3 EP9 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep9_tp0_pp0 -> layer_3_expert_out_sp3_ep9_tp0_pp0
	layer_3_expert_sp3_ep9_tp1_pp0 [label="Expert L3 SP3 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep9_pp0 -> layer_3_expert_sp3_ep9_tp1_pp0
	layer_3_expert_out_sp3_ep9_tp1_pp0 [label="Expert Out L3 SP3 EP9 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep9_tp1_pp0 -> layer_3_expert_out_sp3_ep9_tp1_pp0
	layer_3_expert_sp3_ep9_tp2_pp0 [label="Expert L3 SP3 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep9_pp0 -> layer_3_expert_sp3_ep9_tp2_pp0
	layer_3_expert_out_sp3_ep9_tp2_pp0 [label="Expert Out L3 SP3 EP9 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep9_tp2_pp0 -> layer_3_expert_out_sp3_ep9_tp2_pp0
	layer_3_expert_sp3_ep9_tp3_pp0 [label="Expert L3 SP3 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep9_pp0 -> layer_3_expert_sp3_ep9_tp3_pp0
	layer_3_expert_out_sp3_ep9_tp3_pp0 [label="Expert Out L3 SP3 EP9 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep9_tp3_pp0 -> layer_3_expert_out_sp3_ep9_tp3_pp0
	layer_3_expert_ar_sp3_ep9_pp0 [label="Expert All-Reduce L3 SP3 EP9\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep9_tp0_pp0 -> layer_3_expert_ar_sp3_ep9_pp0
	layer_3_expert_out_sp3_ep9_tp1_pp0 -> layer_3_expert_ar_sp3_ep9_pp0
	layer_3_expert_out_sp3_ep9_tp2_pp0 -> layer_3_expert_ar_sp3_ep9_pp0
	layer_3_expert_out_sp3_ep9_tp3_pp0 -> layer_3_expert_ar_sp3_ep9_pp0
	layer_3_combine_sp3_ep9_pp0 [label="Token Combine L3 SP3 EP9\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep9_pp0 -> layer_3_combine_sp3_ep9_pp0
	layer_3_dispatch_sp3_ep10_pp0 [label="Token Dispatch L3 SP3 EP10\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep10_pp0 [style=dashed]
	layer_3_expert_sp3_ep10_tp0_pp0 [label="Expert L3 SP3 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep10_pp0 -> layer_3_expert_sp3_ep10_tp0_pp0
	layer_3_expert_out_sp3_ep10_tp0_pp0 [label="Expert Out L3 SP3 EP10 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep10_tp0_pp0 -> layer_3_expert_out_sp3_ep10_tp0_pp0
	layer_3_expert_sp3_ep10_tp1_pp0 [label="Expert L3 SP3 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep10_pp0 -> layer_3_expert_sp3_ep10_tp1_pp0
	layer_3_expert_out_sp3_ep10_tp1_pp0 [label="Expert Out L3 SP3 EP10 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep10_tp1_pp0 -> layer_3_expert_out_sp3_ep10_tp1_pp0
	layer_3_expert_sp3_ep10_tp2_pp0 [label="Expert L3 SP3 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep10_pp0 -> layer_3_expert_sp3_ep10_tp2_pp0
	layer_3_expert_out_sp3_ep10_tp2_pp0 [label="Expert Out L3 SP3 EP10 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep10_tp2_pp0 -> layer_3_expert_out_sp3_ep10_tp2_pp0
	layer_3_expert_sp3_ep10_tp3_pp0 [label="Expert L3 SP3 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep10_pp0 -> layer_3_expert_sp3_ep10_tp3_pp0
	layer_3_expert_out_sp3_ep10_tp3_pp0 [label="Expert Out L3 SP3 EP10 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep10_tp3_pp0 -> layer_3_expert_out_sp3_ep10_tp3_pp0
	layer_3_expert_ar_sp3_ep10_pp0 [label="Expert All-Reduce L3 SP3 EP10\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep10_tp0_pp0 -> layer_3_expert_ar_sp3_ep10_pp0
	layer_3_expert_out_sp3_ep10_tp1_pp0 -> layer_3_expert_ar_sp3_ep10_pp0
	layer_3_expert_out_sp3_ep10_tp2_pp0 -> layer_3_expert_ar_sp3_ep10_pp0
	layer_3_expert_out_sp3_ep10_tp3_pp0 -> layer_3_expert_ar_sp3_ep10_pp0
	layer_3_combine_sp3_ep10_pp0 [label="Token Combine L3 SP3 EP10\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep10_pp0 -> layer_3_combine_sp3_ep10_pp0
	layer_3_dispatch_sp3_ep11_pp0 [label="Token Dispatch L3 SP3 EP11\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep11_pp0 [style=dashed]
	layer_3_expert_sp3_ep11_tp0_pp0 [label="Expert L3 SP3 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep11_pp0 -> layer_3_expert_sp3_ep11_tp0_pp0
	layer_3_expert_out_sp3_ep11_tp0_pp0 [label="Expert Out L3 SP3 EP11 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep11_tp0_pp0 -> layer_3_expert_out_sp3_ep11_tp0_pp0
	layer_3_expert_sp3_ep11_tp1_pp0 [label="Expert L3 SP3 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep11_pp0 -> layer_3_expert_sp3_ep11_tp1_pp0
	layer_3_expert_out_sp3_ep11_tp1_pp0 [label="Expert Out L3 SP3 EP11 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep11_tp1_pp0 -> layer_3_expert_out_sp3_ep11_tp1_pp0
	layer_3_expert_sp3_ep11_tp2_pp0 [label="Expert L3 SP3 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep11_pp0 -> layer_3_expert_sp3_ep11_tp2_pp0
	layer_3_expert_out_sp3_ep11_tp2_pp0 [label="Expert Out L3 SP3 EP11 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep11_tp2_pp0 -> layer_3_expert_out_sp3_ep11_tp2_pp0
	layer_3_expert_sp3_ep11_tp3_pp0 [label="Expert L3 SP3 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep11_pp0 -> layer_3_expert_sp3_ep11_tp3_pp0
	layer_3_expert_out_sp3_ep11_tp3_pp0 [label="Expert Out L3 SP3 EP11 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep11_tp3_pp0 -> layer_3_expert_out_sp3_ep11_tp3_pp0
	layer_3_expert_ar_sp3_ep11_pp0 [label="Expert All-Reduce L3 SP3 EP11\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep11_tp0_pp0 -> layer_3_expert_ar_sp3_ep11_pp0
	layer_3_expert_out_sp3_ep11_tp1_pp0 -> layer_3_expert_ar_sp3_ep11_pp0
	layer_3_expert_out_sp3_ep11_tp2_pp0 -> layer_3_expert_ar_sp3_ep11_pp0
	layer_3_expert_out_sp3_ep11_tp3_pp0 -> layer_3_expert_ar_sp3_ep11_pp0
	layer_3_combine_sp3_ep11_pp0 [label="Token Combine L3 SP3 EP11\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep11_pp0 -> layer_3_combine_sp3_ep11_pp0
	layer_3_dispatch_sp3_ep12_pp0 [label="Token Dispatch L3 SP3 EP12\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep12_pp0 [style=dashed]
	layer_3_expert_sp3_ep12_tp0_pp0 [label="Expert L3 SP3 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep12_pp0 -> layer_3_expert_sp3_ep12_tp0_pp0
	layer_3_expert_out_sp3_ep12_tp0_pp0 [label="Expert Out L3 SP3 EP12 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep12_tp0_pp0 -> layer_3_expert_out_sp3_ep12_tp0_pp0
	layer_3_expert_sp3_ep12_tp1_pp0 [label="Expert L3 SP3 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep12_pp0 -> layer_3_expert_sp3_ep12_tp1_pp0
	layer_3_expert_out_sp3_ep12_tp1_pp0 [label="Expert Out L3 SP3 EP12 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep12_tp1_pp0 -> layer_3_expert_out_sp3_ep12_tp1_pp0
	layer_3_expert_sp3_ep12_tp2_pp0 [label="Expert L3 SP3 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep12_pp0 -> layer_3_expert_sp3_ep12_tp2_pp0
	layer_3_expert_out_sp3_ep12_tp2_pp0 [label="Expert Out L3 SP3 EP12 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep12_tp2_pp0 -> layer_3_expert_out_sp3_ep12_tp2_pp0
	layer_3_expert_sp3_ep12_tp3_pp0 [label="Expert L3 SP3 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep12_pp0 -> layer_3_expert_sp3_ep12_tp3_pp0
	layer_3_expert_out_sp3_ep12_tp3_pp0 [label="Expert Out L3 SP3 EP12 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep12_tp3_pp0 -> layer_3_expert_out_sp3_ep12_tp3_pp0
	layer_3_expert_ar_sp3_ep12_pp0 [label="Expert All-Reduce L3 SP3 EP12\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep12_tp0_pp0 -> layer_3_expert_ar_sp3_ep12_pp0
	layer_3_expert_out_sp3_ep12_tp1_pp0 -> layer_3_expert_ar_sp3_ep12_pp0
	layer_3_expert_out_sp3_ep12_tp2_pp0 -> layer_3_expert_ar_sp3_ep12_pp0
	layer_3_expert_out_sp3_ep12_tp3_pp0 -> layer_3_expert_ar_sp3_ep12_pp0
	layer_3_combine_sp3_ep12_pp0 [label="Token Combine L3 SP3 EP12\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep12_pp0 -> layer_3_combine_sp3_ep12_pp0
	layer_3_dispatch_sp3_ep13_pp0 [label="Token Dispatch L3 SP3 EP13\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep13_pp0 [style=dashed]
	layer_3_expert_sp3_ep13_tp0_pp0 [label="Expert L3 SP3 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep13_pp0 -> layer_3_expert_sp3_ep13_tp0_pp0
	layer_3_expert_out_sp3_ep13_tp0_pp0 [label="Expert Out L3 SP3 EP13 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep13_tp0_pp0 -> layer_3_expert_out_sp3_ep13_tp0_pp0
	layer_3_expert_sp3_ep13_tp1_pp0 [label="Expert L3 SP3 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep13_pp0 -> layer_3_expert_sp3_ep13_tp1_pp0
	layer_3_expert_out_sp3_ep13_tp1_pp0 [label="Expert Out L3 SP3 EP13 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep13_tp1_pp0 -> layer_3_expert_out_sp3_ep13_tp1_pp0
	layer_3_expert_sp3_ep13_tp2_pp0 [label="Expert L3 SP3 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep13_pp0 -> layer_3_expert_sp3_ep13_tp2_pp0
	layer_3_expert_out_sp3_ep13_tp2_pp0 [label="Expert Out L3 SP3 EP13 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep13_tp2_pp0 -> layer_3_expert_out_sp3_ep13_tp2_pp0
	layer_3_expert_sp3_ep13_tp3_pp0 [label="Expert L3 SP3 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep13_pp0 -> layer_3_expert_sp3_ep13_tp3_pp0
	layer_3_expert_out_sp3_ep13_tp3_pp0 [label="Expert Out L3 SP3 EP13 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep13_tp3_pp0 -> layer_3_expert_out_sp3_ep13_tp3_pp0
	layer_3_expert_ar_sp3_ep13_pp0 [label="Expert All-Reduce L3 SP3 EP13\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep13_tp0_pp0 -> layer_3_expert_ar_sp3_ep13_pp0
	layer_3_expert_out_sp3_ep13_tp1_pp0 -> layer_3_expert_ar_sp3_ep13_pp0
	layer_3_expert_out_sp3_ep13_tp2_pp0 -> layer_3_expert_ar_sp3_ep13_pp0
	layer_3_expert_out_sp3_ep13_tp3_pp0 -> layer_3_expert_ar_sp3_ep13_pp0
	layer_3_combine_sp3_ep13_pp0 [label="Token Combine L3 SP3 EP13\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep13_pp0 -> layer_3_combine_sp3_ep13_pp0
	layer_3_dispatch_sp3_ep14_pp0 [label="Token Dispatch L3 SP3 EP14\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep14_pp0 [style=dashed]
	layer_3_expert_sp3_ep14_tp0_pp0 [label="Expert L3 SP3 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep14_pp0 -> layer_3_expert_sp3_ep14_tp0_pp0
	layer_3_expert_out_sp3_ep14_tp0_pp0 [label="Expert Out L3 SP3 EP14 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep14_tp0_pp0 -> layer_3_expert_out_sp3_ep14_tp0_pp0
	layer_3_expert_sp3_ep14_tp1_pp0 [label="Expert L3 SP3 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep14_pp0 -> layer_3_expert_sp3_ep14_tp1_pp0
	layer_3_expert_out_sp3_ep14_tp1_pp0 [label="Expert Out L3 SP3 EP14 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep14_tp1_pp0 -> layer_3_expert_out_sp3_ep14_tp1_pp0
	layer_3_expert_sp3_ep14_tp2_pp0 [label="Expert L3 SP3 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep14_pp0 -> layer_3_expert_sp3_ep14_tp2_pp0
	layer_3_expert_out_sp3_ep14_tp2_pp0 [label="Expert Out L3 SP3 EP14 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep14_tp2_pp0 -> layer_3_expert_out_sp3_ep14_tp2_pp0
	layer_3_expert_sp3_ep14_tp3_pp0 [label="Expert L3 SP3 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep14_pp0 -> layer_3_expert_sp3_ep14_tp3_pp0
	layer_3_expert_out_sp3_ep14_tp3_pp0 [label="Expert Out L3 SP3 EP14 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep14_tp3_pp0 -> layer_3_expert_out_sp3_ep14_tp3_pp0
	layer_3_expert_ar_sp3_ep14_pp0 [label="Expert All-Reduce L3 SP3 EP14\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep14_tp0_pp0 -> layer_3_expert_ar_sp3_ep14_pp0
	layer_3_expert_out_sp3_ep14_tp1_pp0 -> layer_3_expert_ar_sp3_ep14_pp0
	layer_3_expert_out_sp3_ep14_tp2_pp0 -> layer_3_expert_ar_sp3_ep14_pp0
	layer_3_expert_out_sp3_ep14_tp3_pp0 -> layer_3_expert_ar_sp3_ep14_pp0
	layer_3_combine_sp3_ep14_pp0 [label="Token Combine L3 SP3 EP14\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep14_pp0 -> layer_3_combine_sp3_ep14_pp0
	layer_3_dispatch_sp3_ep15_pp0 [label="Token Dispatch L3 SP3 EP15\nPP Stage 0\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_3_router_sp3_pp0 -> layer_3_dispatch_sp3_ep15_pp0 [style=dashed]
	layer_3_expert_sp3_ep15_tp0_pp0 [label="Expert L3 SP3 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep15_pp0 -> layer_3_expert_sp3_ep15_tp0_pp0
	layer_3_expert_out_sp3_ep15_tp0_pp0 [label="Expert Out L3 SP3 EP15 TP0\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep15_tp0_pp0 -> layer_3_expert_out_sp3_ep15_tp0_pp0
	layer_3_expert_sp3_ep15_tp1_pp0 [label="Expert L3 SP3 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep15_pp0 -> layer_3_expert_sp3_ep15_tp1_pp0
	layer_3_expert_out_sp3_ep15_tp1_pp0 [label="Expert Out L3 SP3 EP15 TP1\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep15_tp1_pp0 -> layer_3_expert_out_sp3_ep15_tp1_pp0
	layer_3_expert_sp3_ep15_tp2_pp0 [label="Expert L3 SP3 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep15_pp0 -> layer_3_expert_sp3_ep15_tp2_pp0
	layer_3_expert_out_sp3_ep15_tp2_pp0 [label="Expert Out L3 SP3 EP15 TP2\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep15_tp2_pp0 -> layer_3_expert_out_sp3_ep15_tp2_pp0
	layer_3_expert_sp3_ep15_tp3_pp0 [label="Expert L3 SP3 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_dispatch_sp3_ep15_pp0 -> layer_3_expert_sp3_ep15_tp3_pp0
	layer_3_expert_out_sp3_ep15_tp3_pp0 [label="Expert Out L3 SP3 EP15 TP3\nPP Stage 0\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_3_expert_sp3_ep15_tp3_pp0 -> layer_3_expert_out_sp3_ep15_tp3_pp0
	layer_3_expert_ar_sp3_ep15_pp0 [label="Expert All-Reduce L3 SP3 EP15\nPP Stage 0\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_expert_out_sp3_ep15_tp0_pp0 -> layer_3_expert_ar_sp3_ep15_pp0
	layer_3_expert_out_sp3_ep15_tp1_pp0 -> layer_3_expert_ar_sp3_ep15_pp0
	layer_3_expert_out_sp3_ep15_tp2_pp0 -> layer_3_expert_ar_sp3_ep15_pp0
	layer_3_expert_out_sp3_ep15_tp3_pp0 -> layer_3_expert_ar_sp3_ep15_pp0
	layer_3_combine_sp3_ep15_pp0 [label="Token Combine L3 SP3 EP15\nPP Stage 0\nCombined Output" fillcolor=orange shape=ellipse]
	layer_3_expert_ar_sp3_ep15_pp0 -> layer_3_combine_sp3_ep15_pp0
	layer_3_moe_all2all_sp3_pp0 [label="MoE All-to-All L3 SP3\nPP Stage 0\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_3_combine_sp3_ep0_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep1_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep2_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep3_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep4_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep5_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep6_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep7_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep8_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep9_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep10_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep11_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep12_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep13_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep14_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_combine_sp3_ep15_pp0 -> layer_3_moe_all2all_sp3_pp0
	layer_3_mlp_out_sp3_pp0 [label="MoE Output L3 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_moe_all2all_sp3_pp0 -> layer_3_mlp_out_sp3_pp0
	layer_3_mlp_res_sp3_pp0 [label="MLP Residual L3 SP3\nPP Stage 0\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_mlp_out_sp3_pp0 -> layer_3_mlp_res_sp3_pp0
	layer_3_attn_res_sp3_pp0 -> layer_3_mlp_res_sp3_pp0 [style=dashed]
	layer_4_norm_sp0_pp1 [label="LayerNorm L4 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_mlp_out_sp0_pp0 -> layer_4_norm_sp0_pp1 [style=dashed]
	layer_3_mlp_out_sp1_pp0 -> layer_4_norm_sp0_pp1 [style=dashed]
	layer_3_mlp_out_sp2_pp0 -> layer_4_norm_sp0_pp1 [style=dashed]
	layer_3_mlp_out_sp3_pp0 -> layer_4_norm_sp0_pp1 [style=dashed]
	layer_4_qkv_sp0_tp0_pp1 [label="QKV Proj L4 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp0_pp1 -> layer_4_qkv_sp0_tp0_pp1
	layer_4_attn_sp0_tp0_pp1 [label="Attention L4 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp0_tp0_pp1 -> layer_4_attn_sp0_tp0_pp1
	layer_4_attn_out_sp0_tp0_pp1 [label="Attn Out Proj L4 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp0_tp0_pp1 -> layer_4_attn_out_sp0_tp0_pp1
	layer_4_qkv_sp0_tp1_pp1 [label="QKV Proj L4 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp0_pp1 -> layer_4_qkv_sp0_tp1_pp1
	layer_4_attn_sp0_tp1_pp1 [label="Attention L4 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp0_tp1_pp1 -> layer_4_attn_sp0_tp1_pp1
	layer_4_attn_out_sp0_tp1_pp1 [label="Attn Out Proj L4 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp0_tp1_pp1 -> layer_4_attn_out_sp0_tp1_pp1
	layer_4_qkv_sp0_tp2_pp1 [label="QKV Proj L4 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp0_pp1 -> layer_4_qkv_sp0_tp2_pp1
	layer_4_attn_sp0_tp2_pp1 [label="Attention L4 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp0_tp2_pp1 -> layer_4_attn_sp0_tp2_pp1
	layer_4_attn_out_sp0_tp2_pp1 [label="Attn Out Proj L4 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp0_tp2_pp1 -> layer_4_attn_out_sp0_tp2_pp1
	layer_4_qkv_sp0_tp3_pp1 [label="QKV Proj L4 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp0_pp1 -> layer_4_qkv_sp0_tp3_pp1
	layer_4_attn_sp0_tp3_pp1 [label="Attention L4 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp0_tp3_pp1 -> layer_4_attn_sp0_tp3_pp1
	layer_4_attn_out_sp0_tp3_pp1 [label="Attn Out Proj L4 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp0_tp3_pp1 -> layer_4_attn_out_sp0_tp3_pp1
	layer_4_attn_ar_sp0_pp1 [label="Attention All-Reduce L4 SP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_attn_out_sp0_tp0_pp1 -> layer_4_attn_ar_sp0_pp1
	layer_4_attn_out_sp0_tp1_pp1 -> layer_4_attn_ar_sp0_pp1
	layer_4_attn_out_sp0_tp2_pp1 -> layer_4_attn_ar_sp0_pp1
	layer_4_attn_out_sp0_tp3_pp1 -> layer_4_attn_ar_sp0_pp1
	layer_4_attn_res_sp0_pp1 [label="Attention Residual L4 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_attn_ar_sp0_pp1 -> layer_4_attn_res_sp0_pp1
	layer_4_norm_sp0_pp1 -> layer_4_attn_res_sp0_pp1 [style=dashed]
	layer_4_post_norm_sp0_pp1 [label="Post-Attn Norm L4 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_attn_res_sp0_pp1 -> layer_4_post_norm_sp0_pp1
	layer_4_router_sp0_pp1 [label="MoE Router L4 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_4_post_norm_sp0_pp1 -> layer_4_router_sp0_pp1
	layer_4_dispatch_sp0_ep0_pp1 [label="Token Dispatch L4 SP0 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep0_pp1 [style=dashed]
	layer_4_expert_sp0_ep0_tp0_pp1 [label="Expert L4 SP0 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep0_pp1 -> layer_4_expert_sp0_ep0_tp0_pp1
	layer_4_expert_out_sp0_ep0_tp0_pp1 [label="Expert Out L4 SP0 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep0_tp0_pp1 -> layer_4_expert_out_sp0_ep0_tp0_pp1
	layer_4_expert_sp0_ep0_tp1_pp1 [label="Expert L4 SP0 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep0_pp1 -> layer_4_expert_sp0_ep0_tp1_pp1
	layer_4_expert_out_sp0_ep0_tp1_pp1 [label="Expert Out L4 SP0 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep0_tp1_pp1 -> layer_4_expert_out_sp0_ep0_tp1_pp1
	layer_4_expert_sp0_ep0_tp2_pp1 [label="Expert L4 SP0 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep0_pp1 -> layer_4_expert_sp0_ep0_tp2_pp1
	layer_4_expert_out_sp0_ep0_tp2_pp1 [label="Expert Out L4 SP0 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep0_tp2_pp1 -> layer_4_expert_out_sp0_ep0_tp2_pp1
	layer_4_expert_sp0_ep0_tp3_pp1 [label="Expert L4 SP0 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep0_pp1 -> layer_4_expert_sp0_ep0_tp3_pp1
	layer_4_expert_out_sp0_ep0_tp3_pp1 [label="Expert Out L4 SP0 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep0_tp3_pp1 -> layer_4_expert_out_sp0_ep0_tp3_pp1
	layer_4_expert_ar_sp0_ep0_pp1 [label="Expert All-Reduce L4 SP0 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep0_tp0_pp1 -> layer_4_expert_ar_sp0_ep0_pp1
	layer_4_expert_out_sp0_ep0_tp1_pp1 -> layer_4_expert_ar_sp0_ep0_pp1
	layer_4_expert_out_sp0_ep0_tp2_pp1 -> layer_4_expert_ar_sp0_ep0_pp1
	layer_4_expert_out_sp0_ep0_tp3_pp1 -> layer_4_expert_ar_sp0_ep0_pp1
	layer_4_combine_sp0_ep0_pp1 [label="Token Combine L4 SP0 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep0_pp1 -> layer_4_combine_sp0_ep0_pp1
	layer_4_dispatch_sp0_ep1_pp1 [label="Token Dispatch L4 SP0 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep1_pp1 [style=dashed]
	layer_4_expert_sp0_ep1_tp0_pp1 [label="Expert L4 SP0 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep1_pp1 -> layer_4_expert_sp0_ep1_tp0_pp1
	layer_4_expert_out_sp0_ep1_tp0_pp1 [label="Expert Out L4 SP0 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep1_tp0_pp1 -> layer_4_expert_out_sp0_ep1_tp0_pp1
	layer_4_expert_sp0_ep1_tp1_pp1 [label="Expert L4 SP0 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep1_pp1 -> layer_4_expert_sp0_ep1_tp1_pp1
	layer_4_expert_out_sp0_ep1_tp1_pp1 [label="Expert Out L4 SP0 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep1_tp1_pp1 -> layer_4_expert_out_sp0_ep1_tp1_pp1
	layer_4_expert_sp0_ep1_tp2_pp1 [label="Expert L4 SP0 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep1_pp1 -> layer_4_expert_sp0_ep1_tp2_pp1
	layer_4_expert_out_sp0_ep1_tp2_pp1 [label="Expert Out L4 SP0 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep1_tp2_pp1 -> layer_4_expert_out_sp0_ep1_tp2_pp1
	layer_4_expert_sp0_ep1_tp3_pp1 [label="Expert L4 SP0 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep1_pp1 -> layer_4_expert_sp0_ep1_tp3_pp1
	layer_4_expert_out_sp0_ep1_tp3_pp1 [label="Expert Out L4 SP0 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep1_tp3_pp1 -> layer_4_expert_out_sp0_ep1_tp3_pp1
	layer_4_expert_ar_sp0_ep1_pp1 [label="Expert All-Reduce L4 SP0 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep1_tp0_pp1 -> layer_4_expert_ar_sp0_ep1_pp1
	layer_4_expert_out_sp0_ep1_tp1_pp1 -> layer_4_expert_ar_sp0_ep1_pp1
	layer_4_expert_out_sp0_ep1_tp2_pp1 -> layer_4_expert_ar_sp0_ep1_pp1
	layer_4_expert_out_sp0_ep1_tp3_pp1 -> layer_4_expert_ar_sp0_ep1_pp1
	layer_4_combine_sp0_ep1_pp1 [label="Token Combine L4 SP0 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep1_pp1 -> layer_4_combine_sp0_ep1_pp1
	layer_4_dispatch_sp0_ep2_pp1 [label="Token Dispatch L4 SP0 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep2_pp1 [style=dashed]
	layer_4_expert_sp0_ep2_tp0_pp1 [label="Expert L4 SP0 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep2_pp1 -> layer_4_expert_sp0_ep2_tp0_pp1
	layer_4_expert_out_sp0_ep2_tp0_pp1 [label="Expert Out L4 SP0 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep2_tp0_pp1 -> layer_4_expert_out_sp0_ep2_tp0_pp1
	layer_4_expert_sp0_ep2_tp1_pp1 [label="Expert L4 SP0 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep2_pp1 -> layer_4_expert_sp0_ep2_tp1_pp1
	layer_4_expert_out_sp0_ep2_tp1_pp1 [label="Expert Out L4 SP0 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep2_tp1_pp1 -> layer_4_expert_out_sp0_ep2_tp1_pp1
	layer_4_expert_sp0_ep2_tp2_pp1 [label="Expert L4 SP0 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep2_pp1 -> layer_4_expert_sp0_ep2_tp2_pp1
	layer_4_expert_out_sp0_ep2_tp2_pp1 [label="Expert Out L4 SP0 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep2_tp2_pp1 -> layer_4_expert_out_sp0_ep2_tp2_pp1
	layer_4_expert_sp0_ep2_tp3_pp1 [label="Expert L4 SP0 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep2_pp1 -> layer_4_expert_sp0_ep2_tp3_pp1
	layer_4_expert_out_sp0_ep2_tp3_pp1 [label="Expert Out L4 SP0 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep2_tp3_pp1 -> layer_4_expert_out_sp0_ep2_tp3_pp1
	layer_4_expert_ar_sp0_ep2_pp1 [label="Expert All-Reduce L4 SP0 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep2_tp0_pp1 -> layer_4_expert_ar_sp0_ep2_pp1
	layer_4_expert_out_sp0_ep2_tp1_pp1 -> layer_4_expert_ar_sp0_ep2_pp1
	layer_4_expert_out_sp0_ep2_tp2_pp1 -> layer_4_expert_ar_sp0_ep2_pp1
	layer_4_expert_out_sp0_ep2_tp3_pp1 -> layer_4_expert_ar_sp0_ep2_pp1
	layer_4_combine_sp0_ep2_pp1 [label="Token Combine L4 SP0 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep2_pp1 -> layer_4_combine_sp0_ep2_pp1
	layer_4_dispatch_sp0_ep3_pp1 [label="Token Dispatch L4 SP0 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep3_pp1 [style=dashed]
	layer_4_expert_sp0_ep3_tp0_pp1 [label="Expert L4 SP0 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep3_pp1 -> layer_4_expert_sp0_ep3_tp0_pp1
	layer_4_expert_out_sp0_ep3_tp0_pp1 [label="Expert Out L4 SP0 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep3_tp0_pp1 -> layer_4_expert_out_sp0_ep3_tp0_pp1
	layer_4_expert_sp0_ep3_tp1_pp1 [label="Expert L4 SP0 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep3_pp1 -> layer_4_expert_sp0_ep3_tp1_pp1
	layer_4_expert_out_sp0_ep3_tp1_pp1 [label="Expert Out L4 SP0 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep3_tp1_pp1 -> layer_4_expert_out_sp0_ep3_tp1_pp1
	layer_4_expert_sp0_ep3_tp2_pp1 [label="Expert L4 SP0 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep3_pp1 -> layer_4_expert_sp0_ep3_tp2_pp1
	layer_4_expert_out_sp0_ep3_tp2_pp1 [label="Expert Out L4 SP0 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep3_tp2_pp1 -> layer_4_expert_out_sp0_ep3_tp2_pp1
	layer_4_expert_sp0_ep3_tp3_pp1 [label="Expert L4 SP0 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep3_pp1 -> layer_4_expert_sp0_ep3_tp3_pp1
	layer_4_expert_out_sp0_ep3_tp3_pp1 [label="Expert Out L4 SP0 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep3_tp3_pp1 -> layer_4_expert_out_sp0_ep3_tp3_pp1
	layer_4_expert_ar_sp0_ep3_pp1 [label="Expert All-Reduce L4 SP0 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep3_tp0_pp1 -> layer_4_expert_ar_sp0_ep3_pp1
	layer_4_expert_out_sp0_ep3_tp1_pp1 -> layer_4_expert_ar_sp0_ep3_pp1
	layer_4_expert_out_sp0_ep3_tp2_pp1 -> layer_4_expert_ar_sp0_ep3_pp1
	layer_4_expert_out_sp0_ep3_tp3_pp1 -> layer_4_expert_ar_sp0_ep3_pp1
	layer_4_combine_sp0_ep3_pp1 [label="Token Combine L4 SP0 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep3_pp1 -> layer_4_combine_sp0_ep3_pp1
	layer_4_dispatch_sp0_ep4_pp1 [label="Token Dispatch L4 SP0 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep4_pp1 [style=dashed]
	layer_4_expert_sp0_ep4_tp0_pp1 [label="Expert L4 SP0 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep4_pp1 -> layer_4_expert_sp0_ep4_tp0_pp1
	layer_4_expert_out_sp0_ep4_tp0_pp1 [label="Expert Out L4 SP0 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep4_tp0_pp1 -> layer_4_expert_out_sp0_ep4_tp0_pp1
	layer_4_expert_sp0_ep4_tp1_pp1 [label="Expert L4 SP0 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep4_pp1 -> layer_4_expert_sp0_ep4_tp1_pp1
	layer_4_expert_out_sp0_ep4_tp1_pp1 [label="Expert Out L4 SP0 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep4_tp1_pp1 -> layer_4_expert_out_sp0_ep4_tp1_pp1
	layer_4_expert_sp0_ep4_tp2_pp1 [label="Expert L4 SP0 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep4_pp1 -> layer_4_expert_sp0_ep4_tp2_pp1
	layer_4_expert_out_sp0_ep4_tp2_pp1 [label="Expert Out L4 SP0 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep4_tp2_pp1 -> layer_4_expert_out_sp0_ep4_tp2_pp1
	layer_4_expert_sp0_ep4_tp3_pp1 [label="Expert L4 SP0 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep4_pp1 -> layer_4_expert_sp0_ep4_tp3_pp1
	layer_4_expert_out_sp0_ep4_tp3_pp1 [label="Expert Out L4 SP0 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep4_tp3_pp1 -> layer_4_expert_out_sp0_ep4_tp3_pp1
	layer_4_expert_ar_sp0_ep4_pp1 [label="Expert All-Reduce L4 SP0 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep4_tp0_pp1 -> layer_4_expert_ar_sp0_ep4_pp1
	layer_4_expert_out_sp0_ep4_tp1_pp1 -> layer_4_expert_ar_sp0_ep4_pp1
	layer_4_expert_out_sp0_ep4_tp2_pp1 -> layer_4_expert_ar_sp0_ep4_pp1
	layer_4_expert_out_sp0_ep4_tp3_pp1 -> layer_4_expert_ar_sp0_ep4_pp1
	layer_4_combine_sp0_ep4_pp1 [label="Token Combine L4 SP0 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep4_pp1 -> layer_4_combine_sp0_ep4_pp1
	layer_4_dispatch_sp0_ep5_pp1 [label="Token Dispatch L4 SP0 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep5_pp1 [style=dashed]
	layer_4_expert_sp0_ep5_tp0_pp1 [label="Expert L4 SP0 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep5_pp1 -> layer_4_expert_sp0_ep5_tp0_pp1
	layer_4_expert_out_sp0_ep5_tp0_pp1 [label="Expert Out L4 SP0 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep5_tp0_pp1 -> layer_4_expert_out_sp0_ep5_tp0_pp1
	layer_4_expert_sp0_ep5_tp1_pp1 [label="Expert L4 SP0 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep5_pp1 -> layer_4_expert_sp0_ep5_tp1_pp1
	layer_4_expert_out_sp0_ep5_tp1_pp1 [label="Expert Out L4 SP0 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep5_tp1_pp1 -> layer_4_expert_out_sp0_ep5_tp1_pp1
	layer_4_expert_sp0_ep5_tp2_pp1 [label="Expert L4 SP0 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep5_pp1 -> layer_4_expert_sp0_ep5_tp2_pp1
	layer_4_expert_out_sp0_ep5_tp2_pp1 [label="Expert Out L4 SP0 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep5_tp2_pp1 -> layer_4_expert_out_sp0_ep5_tp2_pp1
	layer_4_expert_sp0_ep5_tp3_pp1 [label="Expert L4 SP0 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep5_pp1 -> layer_4_expert_sp0_ep5_tp3_pp1
	layer_4_expert_out_sp0_ep5_tp3_pp1 [label="Expert Out L4 SP0 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep5_tp3_pp1 -> layer_4_expert_out_sp0_ep5_tp3_pp1
	layer_4_expert_ar_sp0_ep5_pp1 [label="Expert All-Reduce L4 SP0 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep5_tp0_pp1 -> layer_4_expert_ar_sp0_ep5_pp1
	layer_4_expert_out_sp0_ep5_tp1_pp1 -> layer_4_expert_ar_sp0_ep5_pp1
	layer_4_expert_out_sp0_ep5_tp2_pp1 -> layer_4_expert_ar_sp0_ep5_pp1
	layer_4_expert_out_sp0_ep5_tp3_pp1 -> layer_4_expert_ar_sp0_ep5_pp1
	layer_4_combine_sp0_ep5_pp1 [label="Token Combine L4 SP0 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep5_pp1 -> layer_4_combine_sp0_ep5_pp1
	layer_4_dispatch_sp0_ep6_pp1 [label="Token Dispatch L4 SP0 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep6_pp1 [style=dashed]
	layer_4_expert_sp0_ep6_tp0_pp1 [label="Expert L4 SP0 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep6_pp1 -> layer_4_expert_sp0_ep6_tp0_pp1
	layer_4_expert_out_sp0_ep6_tp0_pp1 [label="Expert Out L4 SP0 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep6_tp0_pp1 -> layer_4_expert_out_sp0_ep6_tp0_pp1
	layer_4_expert_sp0_ep6_tp1_pp1 [label="Expert L4 SP0 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep6_pp1 -> layer_4_expert_sp0_ep6_tp1_pp1
	layer_4_expert_out_sp0_ep6_tp1_pp1 [label="Expert Out L4 SP0 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep6_tp1_pp1 -> layer_4_expert_out_sp0_ep6_tp1_pp1
	layer_4_expert_sp0_ep6_tp2_pp1 [label="Expert L4 SP0 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep6_pp1 -> layer_4_expert_sp0_ep6_tp2_pp1
	layer_4_expert_out_sp0_ep6_tp2_pp1 [label="Expert Out L4 SP0 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep6_tp2_pp1 -> layer_4_expert_out_sp0_ep6_tp2_pp1
	layer_4_expert_sp0_ep6_tp3_pp1 [label="Expert L4 SP0 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep6_pp1 -> layer_4_expert_sp0_ep6_tp3_pp1
	layer_4_expert_out_sp0_ep6_tp3_pp1 [label="Expert Out L4 SP0 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep6_tp3_pp1 -> layer_4_expert_out_sp0_ep6_tp3_pp1
	layer_4_expert_ar_sp0_ep6_pp1 [label="Expert All-Reduce L4 SP0 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep6_tp0_pp1 -> layer_4_expert_ar_sp0_ep6_pp1
	layer_4_expert_out_sp0_ep6_tp1_pp1 -> layer_4_expert_ar_sp0_ep6_pp1
	layer_4_expert_out_sp0_ep6_tp2_pp1 -> layer_4_expert_ar_sp0_ep6_pp1
	layer_4_expert_out_sp0_ep6_tp3_pp1 -> layer_4_expert_ar_sp0_ep6_pp1
	layer_4_combine_sp0_ep6_pp1 [label="Token Combine L4 SP0 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep6_pp1 -> layer_4_combine_sp0_ep6_pp1
	layer_4_dispatch_sp0_ep7_pp1 [label="Token Dispatch L4 SP0 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep7_pp1 [style=dashed]
	layer_4_expert_sp0_ep7_tp0_pp1 [label="Expert L4 SP0 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep7_pp1 -> layer_4_expert_sp0_ep7_tp0_pp1
	layer_4_expert_out_sp0_ep7_tp0_pp1 [label="Expert Out L4 SP0 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep7_tp0_pp1 -> layer_4_expert_out_sp0_ep7_tp0_pp1
	layer_4_expert_sp0_ep7_tp1_pp1 [label="Expert L4 SP0 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep7_pp1 -> layer_4_expert_sp0_ep7_tp1_pp1
	layer_4_expert_out_sp0_ep7_tp1_pp1 [label="Expert Out L4 SP0 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep7_tp1_pp1 -> layer_4_expert_out_sp0_ep7_tp1_pp1
	layer_4_expert_sp0_ep7_tp2_pp1 [label="Expert L4 SP0 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep7_pp1 -> layer_4_expert_sp0_ep7_tp2_pp1
	layer_4_expert_out_sp0_ep7_tp2_pp1 [label="Expert Out L4 SP0 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep7_tp2_pp1 -> layer_4_expert_out_sp0_ep7_tp2_pp1
	layer_4_expert_sp0_ep7_tp3_pp1 [label="Expert L4 SP0 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep7_pp1 -> layer_4_expert_sp0_ep7_tp3_pp1
	layer_4_expert_out_sp0_ep7_tp3_pp1 [label="Expert Out L4 SP0 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep7_tp3_pp1 -> layer_4_expert_out_sp0_ep7_tp3_pp1
	layer_4_expert_ar_sp0_ep7_pp1 [label="Expert All-Reduce L4 SP0 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep7_tp0_pp1 -> layer_4_expert_ar_sp0_ep7_pp1
	layer_4_expert_out_sp0_ep7_tp1_pp1 -> layer_4_expert_ar_sp0_ep7_pp1
	layer_4_expert_out_sp0_ep7_tp2_pp1 -> layer_4_expert_ar_sp0_ep7_pp1
	layer_4_expert_out_sp0_ep7_tp3_pp1 -> layer_4_expert_ar_sp0_ep7_pp1
	layer_4_combine_sp0_ep7_pp1 [label="Token Combine L4 SP0 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep7_pp1 -> layer_4_combine_sp0_ep7_pp1
	layer_4_dispatch_sp0_ep8_pp1 [label="Token Dispatch L4 SP0 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep8_pp1 [style=dashed]
	layer_4_expert_sp0_ep8_tp0_pp1 [label="Expert L4 SP0 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep8_pp1 -> layer_4_expert_sp0_ep8_tp0_pp1
	layer_4_expert_out_sp0_ep8_tp0_pp1 [label="Expert Out L4 SP0 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep8_tp0_pp1 -> layer_4_expert_out_sp0_ep8_tp0_pp1
	layer_4_expert_sp0_ep8_tp1_pp1 [label="Expert L4 SP0 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep8_pp1 -> layer_4_expert_sp0_ep8_tp1_pp1
	layer_4_expert_out_sp0_ep8_tp1_pp1 [label="Expert Out L4 SP0 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep8_tp1_pp1 -> layer_4_expert_out_sp0_ep8_tp1_pp1
	layer_4_expert_sp0_ep8_tp2_pp1 [label="Expert L4 SP0 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep8_pp1 -> layer_4_expert_sp0_ep8_tp2_pp1
	layer_4_expert_out_sp0_ep8_tp2_pp1 [label="Expert Out L4 SP0 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep8_tp2_pp1 -> layer_4_expert_out_sp0_ep8_tp2_pp1
	layer_4_expert_sp0_ep8_tp3_pp1 [label="Expert L4 SP0 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep8_pp1 -> layer_4_expert_sp0_ep8_tp3_pp1
	layer_4_expert_out_sp0_ep8_tp3_pp1 [label="Expert Out L4 SP0 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep8_tp3_pp1 -> layer_4_expert_out_sp0_ep8_tp3_pp1
	layer_4_expert_ar_sp0_ep8_pp1 [label="Expert All-Reduce L4 SP0 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep8_tp0_pp1 -> layer_4_expert_ar_sp0_ep8_pp1
	layer_4_expert_out_sp0_ep8_tp1_pp1 -> layer_4_expert_ar_sp0_ep8_pp1
	layer_4_expert_out_sp0_ep8_tp2_pp1 -> layer_4_expert_ar_sp0_ep8_pp1
	layer_4_expert_out_sp0_ep8_tp3_pp1 -> layer_4_expert_ar_sp0_ep8_pp1
	layer_4_combine_sp0_ep8_pp1 [label="Token Combine L4 SP0 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep8_pp1 -> layer_4_combine_sp0_ep8_pp1
	layer_4_dispatch_sp0_ep9_pp1 [label="Token Dispatch L4 SP0 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep9_pp1 [style=dashed]
	layer_4_expert_sp0_ep9_tp0_pp1 [label="Expert L4 SP0 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep9_pp1 -> layer_4_expert_sp0_ep9_tp0_pp1
	layer_4_expert_out_sp0_ep9_tp0_pp1 [label="Expert Out L4 SP0 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep9_tp0_pp1 -> layer_4_expert_out_sp0_ep9_tp0_pp1
	layer_4_expert_sp0_ep9_tp1_pp1 [label="Expert L4 SP0 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep9_pp1 -> layer_4_expert_sp0_ep9_tp1_pp1
	layer_4_expert_out_sp0_ep9_tp1_pp1 [label="Expert Out L4 SP0 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep9_tp1_pp1 -> layer_4_expert_out_sp0_ep9_tp1_pp1
	layer_4_expert_sp0_ep9_tp2_pp1 [label="Expert L4 SP0 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep9_pp1 -> layer_4_expert_sp0_ep9_tp2_pp1
	layer_4_expert_out_sp0_ep9_tp2_pp1 [label="Expert Out L4 SP0 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep9_tp2_pp1 -> layer_4_expert_out_sp0_ep9_tp2_pp1
	layer_4_expert_sp0_ep9_tp3_pp1 [label="Expert L4 SP0 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep9_pp1 -> layer_4_expert_sp0_ep9_tp3_pp1
	layer_4_expert_out_sp0_ep9_tp3_pp1 [label="Expert Out L4 SP0 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep9_tp3_pp1 -> layer_4_expert_out_sp0_ep9_tp3_pp1
	layer_4_expert_ar_sp0_ep9_pp1 [label="Expert All-Reduce L4 SP0 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep9_tp0_pp1 -> layer_4_expert_ar_sp0_ep9_pp1
	layer_4_expert_out_sp0_ep9_tp1_pp1 -> layer_4_expert_ar_sp0_ep9_pp1
	layer_4_expert_out_sp0_ep9_tp2_pp1 -> layer_4_expert_ar_sp0_ep9_pp1
	layer_4_expert_out_sp0_ep9_tp3_pp1 -> layer_4_expert_ar_sp0_ep9_pp1
	layer_4_combine_sp0_ep9_pp1 [label="Token Combine L4 SP0 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep9_pp1 -> layer_4_combine_sp0_ep9_pp1
	layer_4_dispatch_sp0_ep10_pp1 [label="Token Dispatch L4 SP0 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep10_pp1 [style=dashed]
	layer_4_expert_sp0_ep10_tp0_pp1 [label="Expert L4 SP0 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep10_pp1 -> layer_4_expert_sp0_ep10_tp0_pp1
	layer_4_expert_out_sp0_ep10_tp0_pp1 [label="Expert Out L4 SP0 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep10_tp0_pp1 -> layer_4_expert_out_sp0_ep10_tp0_pp1
	layer_4_expert_sp0_ep10_tp1_pp1 [label="Expert L4 SP0 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep10_pp1 -> layer_4_expert_sp0_ep10_tp1_pp1
	layer_4_expert_out_sp0_ep10_tp1_pp1 [label="Expert Out L4 SP0 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep10_tp1_pp1 -> layer_4_expert_out_sp0_ep10_tp1_pp1
	layer_4_expert_sp0_ep10_tp2_pp1 [label="Expert L4 SP0 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep10_pp1 -> layer_4_expert_sp0_ep10_tp2_pp1
	layer_4_expert_out_sp0_ep10_tp2_pp1 [label="Expert Out L4 SP0 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep10_tp2_pp1 -> layer_4_expert_out_sp0_ep10_tp2_pp1
	layer_4_expert_sp0_ep10_tp3_pp1 [label="Expert L4 SP0 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep10_pp1 -> layer_4_expert_sp0_ep10_tp3_pp1
	layer_4_expert_out_sp0_ep10_tp3_pp1 [label="Expert Out L4 SP0 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep10_tp3_pp1 -> layer_4_expert_out_sp0_ep10_tp3_pp1
	layer_4_expert_ar_sp0_ep10_pp1 [label="Expert All-Reduce L4 SP0 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep10_tp0_pp1 -> layer_4_expert_ar_sp0_ep10_pp1
	layer_4_expert_out_sp0_ep10_tp1_pp1 -> layer_4_expert_ar_sp0_ep10_pp1
	layer_4_expert_out_sp0_ep10_tp2_pp1 -> layer_4_expert_ar_sp0_ep10_pp1
	layer_4_expert_out_sp0_ep10_tp3_pp1 -> layer_4_expert_ar_sp0_ep10_pp1
	layer_4_combine_sp0_ep10_pp1 [label="Token Combine L4 SP0 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep10_pp1 -> layer_4_combine_sp0_ep10_pp1
	layer_4_dispatch_sp0_ep11_pp1 [label="Token Dispatch L4 SP0 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep11_pp1 [style=dashed]
	layer_4_expert_sp0_ep11_tp0_pp1 [label="Expert L4 SP0 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep11_pp1 -> layer_4_expert_sp0_ep11_tp0_pp1
	layer_4_expert_out_sp0_ep11_tp0_pp1 [label="Expert Out L4 SP0 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep11_tp0_pp1 -> layer_4_expert_out_sp0_ep11_tp0_pp1
	layer_4_expert_sp0_ep11_tp1_pp1 [label="Expert L4 SP0 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep11_pp1 -> layer_4_expert_sp0_ep11_tp1_pp1
	layer_4_expert_out_sp0_ep11_tp1_pp1 [label="Expert Out L4 SP0 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep11_tp1_pp1 -> layer_4_expert_out_sp0_ep11_tp1_pp1
	layer_4_expert_sp0_ep11_tp2_pp1 [label="Expert L4 SP0 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep11_pp1 -> layer_4_expert_sp0_ep11_tp2_pp1
	layer_4_expert_out_sp0_ep11_tp2_pp1 [label="Expert Out L4 SP0 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep11_tp2_pp1 -> layer_4_expert_out_sp0_ep11_tp2_pp1
	layer_4_expert_sp0_ep11_tp3_pp1 [label="Expert L4 SP0 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep11_pp1 -> layer_4_expert_sp0_ep11_tp3_pp1
	layer_4_expert_out_sp0_ep11_tp3_pp1 [label="Expert Out L4 SP0 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep11_tp3_pp1 -> layer_4_expert_out_sp0_ep11_tp3_pp1
	layer_4_expert_ar_sp0_ep11_pp1 [label="Expert All-Reduce L4 SP0 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep11_tp0_pp1 -> layer_4_expert_ar_sp0_ep11_pp1
	layer_4_expert_out_sp0_ep11_tp1_pp1 -> layer_4_expert_ar_sp0_ep11_pp1
	layer_4_expert_out_sp0_ep11_tp2_pp1 -> layer_4_expert_ar_sp0_ep11_pp1
	layer_4_expert_out_sp0_ep11_tp3_pp1 -> layer_4_expert_ar_sp0_ep11_pp1
	layer_4_combine_sp0_ep11_pp1 [label="Token Combine L4 SP0 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep11_pp1 -> layer_4_combine_sp0_ep11_pp1
	layer_4_dispatch_sp0_ep12_pp1 [label="Token Dispatch L4 SP0 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep12_pp1 [style=dashed]
	layer_4_expert_sp0_ep12_tp0_pp1 [label="Expert L4 SP0 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep12_pp1 -> layer_4_expert_sp0_ep12_tp0_pp1
	layer_4_expert_out_sp0_ep12_tp0_pp1 [label="Expert Out L4 SP0 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep12_tp0_pp1 -> layer_4_expert_out_sp0_ep12_tp0_pp1
	layer_4_expert_sp0_ep12_tp1_pp1 [label="Expert L4 SP0 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep12_pp1 -> layer_4_expert_sp0_ep12_tp1_pp1
	layer_4_expert_out_sp0_ep12_tp1_pp1 [label="Expert Out L4 SP0 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep12_tp1_pp1 -> layer_4_expert_out_sp0_ep12_tp1_pp1
	layer_4_expert_sp0_ep12_tp2_pp1 [label="Expert L4 SP0 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep12_pp1 -> layer_4_expert_sp0_ep12_tp2_pp1
	layer_4_expert_out_sp0_ep12_tp2_pp1 [label="Expert Out L4 SP0 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep12_tp2_pp1 -> layer_4_expert_out_sp0_ep12_tp2_pp1
	layer_4_expert_sp0_ep12_tp3_pp1 [label="Expert L4 SP0 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep12_pp1 -> layer_4_expert_sp0_ep12_tp3_pp1
	layer_4_expert_out_sp0_ep12_tp3_pp1 [label="Expert Out L4 SP0 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep12_tp3_pp1 -> layer_4_expert_out_sp0_ep12_tp3_pp1
	layer_4_expert_ar_sp0_ep12_pp1 [label="Expert All-Reduce L4 SP0 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep12_tp0_pp1 -> layer_4_expert_ar_sp0_ep12_pp1
	layer_4_expert_out_sp0_ep12_tp1_pp1 -> layer_4_expert_ar_sp0_ep12_pp1
	layer_4_expert_out_sp0_ep12_tp2_pp1 -> layer_4_expert_ar_sp0_ep12_pp1
	layer_4_expert_out_sp0_ep12_tp3_pp1 -> layer_4_expert_ar_sp0_ep12_pp1
	layer_4_combine_sp0_ep12_pp1 [label="Token Combine L4 SP0 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep12_pp1 -> layer_4_combine_sp0_ep12_pp1
	layer_4_dispatch_sp0_ep13_pp1 [label="Token Dispatch L4 SP0 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep13_pp1 [style=dashed]
	layer_4_expert_sp0_ep13_tp0_pp1 [label="Expert L4 SP0 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep13_pp1 -> layer_4_expert_sp0_ep13_tp0_pp1
	layer_4_expert_out_sp0_ep13_tp0_pp1 [label="Expert Out L4 SP0 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep13_tp0_pp1 -> layer_4_expert_out_sp0_ep13_tp0_pp1
	layer_4_expert_sp0_ep13_tp1_pp1 [label="Expert L4 SP0 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep13_pp1 -> layer_4_expert_sp0_ep13_tp1_pp1
	layer_4_expert_out_sp0_ep13_tp1_pp1 [label="Expert Out L4 SP0 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep13_tp1_pp1 -> layer_4_expert_out_sp0_ep13_tp1_pp1
	layer_4_expert_sp0_ep13_tp2_pp1 [label="Expert L4 SP0 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep13_pp1 -> layer_4_expert_sp0_ep13_tp2_pp1
	layer_4_expert_out_sp0_ep13_tp2_pp1 [label="Expert Out L4 SP0 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep13_tp2_pp1 -> layer_4_expert_out_sp0_ep13_tp2_pp1
	layer_4_expert_sp0_ep13_tp3_pp1 [label="Expert L4 SP0 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep13_pp1 -> layer_4_expert_sp0_ep13_tp3_pp1
	layer_4_expert_out_sp0_ep13_tp3_pp1 [label="Expert Out L4 SP0 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep13_tp3_pp1 -> layer_4_expert_out_sp0_ep13_tp3_pp1
	layer_4_expert_ar_sp0_ep13_pp1 [label="Expert All-Reduce L4 SP0 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep13_tp0_pp1 -> layer_4_expert_ar_sp0_ep13_pp1
	layer_4_expert_out_sp0_ep13_tp1_pp1 -> layer_4_expert_ar_sp0_ep13_pp1
	layer_4_expert_out_sp0_ep13_tp2_pp1 -> layer_4_expert_ar_sp0_ep13_pp1
	layer_4_expert_out_sp0_ep13_tp3_pp1 -> layer_4_expert_ar_sp0_ep13_pp1
	layer_4_combine_sp0_ep13_pp1 [label="Token Combine L4 SP0 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep13_pp1 -> layer_4_combine_sp0_ep13_pp1
	layer_4_dispatch_sp0_ep14_pp1 [label="Token Dispatch L4 SP0 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep14_pp1 [style=dashed]
	layer_4_expert_sp0_ep14_tp0_pp1 [label="Expert L4 SP0 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep14_pp1 -> layer_4_expert_sp0_ep14_tp0_pp1
	layer_4_expert_out_sp0_ep14_tp0_pp1 [label="Expert Out L4 SP0 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep14_tp0_pp1 -> layer_4_expert_out_sp0_ep14_tp0_pp1
	layer_4_expert_sp0_ep14_tp1_pp1 [label="Expert L4 SP0 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep14_pp1 -> layer_4_expert_sp0_ep14_tp1_pp1
	layer_4_expert_out_sp0_ep14_tp1_pp1 [label="Expert Out L4 SP0 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep14_tp1_pp1 -> layer_4_expert_out_sp0_ep14_tp1_pp1
	layer_4_expert_sp0_ep14_tp2_pp1 [label="Expert L4 SP0 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep14_pp1 -> layer_4_expert_sp0_ep14_tp2_pp1
	layer_4_expert_out_sp0_ep14_tp2_pp1 [label="Expert Out L4 SP0 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep14_tp2_pp1 -> layer_4_expert_out_sp0_ep14_tp2_pp1
	layer_4_expert_sp0_ep14_tp3_pp1 [label="Expert L4 SP0 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep14_pp1 -> layer_4_expert_sp0_ep14_tp3_pp1
	layer_4_expert_out_sp0_ep14_tp3_pp1 [label="Expert Out L4 SP0 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep14_tp3_pp1 -> layer_4_expert_out_sp0_ep14_tp3_pp1
	layer_4_expert_ar_sp0_ep14_pp1 [label="Expert All-Reduce L4 SP0 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep14_tp0_pp1 -> layer_4_expert_ar_sp0_ep14_pp1
	layer_4_expert_out_sp0_ep14_tp1_pp1 -> layer_4_expert_ar_sp0_ep14_pp1
	layer_4_expert_out_sp0_ep14_tp2_pp1 -> layer_4_expert_ar_sp0_ep14_pp1
	layer_4_expert_out_sp0_ep14_tp3_pp1 -> layer_4_expert_ar_sp0_ep14_pp1
	layer_4_combine_sp0_ep14_pp1 [label="Token Combine L4 SP0 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep14_pp1 -> layer_4_combine_sp0_ep14_pp1
	layer_4_dispatch_sp0_ep15_pp1 [label="Token Dispatch L4 SP0 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp0_pp1 -> layer_4_dispatch_sp0_ep15_pp1 [style=dashed]
	layer_4_expert_sp0_ep15_tp0_pp1 [label="Expert L4 SP0 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep15_pp1 -> layer_4_expert_sp0_ep15_tp0_pp1
	layer_4_expert_out_sp0_ep15_tp0_pp1 [label="Expert Out L4 SP0 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep15_tp0_pp1 -> layer_4_expert_out_sp0_ep15_tp0_pp1
	layer_4_expert_sp0_ep15_tp1_pp1 [label="Expert L4 SP0 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep15_pp1 -> layer_4_expert_sp0_ep15_tp1_pp1
	layer_4_expert_out_sp0_ep15_tp1_pp1 [label="Expert Out L4 SP0 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep15_tp1_pp1 -> layer_4_expert_out_sp0_ep15_tp1_pp1
	layer_4_expert_sp0_ep15_tp2_pp1 [label="Expert L4 SP0 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep15_pp1 -> layer_4_expert_sp0_ep15_tp2_pp1
	layer_4_expert_out_sp0_ep15_tp2_pp1 [label="Expert Out L4 SP0 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep15_tp2_pp1 -> layer_4_expert_out_sp0_ep15_tp2_pp1
	layer_4_expert_sp0_ep15_tp3_pp1 [label="Expert L4 SP0 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp0_ep15_pp1 -> layer_4_expert_sp0_ep15_tp3_pp1
	layer_4_expert_out_sp0_ep15_tp3_pp1 [label="Expert Out L4 SP0 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp0_ep15_tp3_pp1 -> layer_4_expert_out_sp0_ep15_tp3_pp1
	layer_4_expert_ar_sp0_ep15_pp1 [label="Expert All-Reduce L4 SP0 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp0_ep15_tp0_pp1 -> layer_4_expert_ar_sp0_ep15_pp1
	layer_4_expert_out_sp0_ep15_tp1_pp1 -> layer_4_expert_ar_sp0_ep15_pp1
	layer_4_expert_out_sp0_ep15_tp2_pp1 -> layer_4_expert_ar_sp0_ep15_pp1
	layer_4_expert_out_sp0_ep15_tp3_pp1 -> layer_4_expert_ar_sp0_ep15_pp1
	layer_4_combine_sp0_ep15_pp1 [label="Token Combine L4 SP0 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp0_ep15_pp1 -> layer_4_combine_sp0_ep15_pp1
	layer_4_moe_all2all_sp0_pp1 [label="MoE All-to-All L4 SP0\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_4_combine_sp0_ep0_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep1_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep2_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep3_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep4_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep5_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep6_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep7_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep8_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep9_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep10_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep11_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep12_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep13_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep14_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_combine_sp0_ep15_pp1 -> layer_4_moe_all2all_sp0_pp1
	layer_4_mlp_out_sp0_pp1 [label="MoE Output L4 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_moe_all2all_sp0_pp1 -> layer_4_mlp_out_sp0_pp1
	layer_4_mlp_res_sp0_pp1 [label="MLP Residual L4 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_mlp_out_sp0_pp1 -> layer_4_mlp_res_sp0_pp1
	layer_4_attn_res_sp0_pp1 -> layer_4_mlp_res_sp0_pp1 [style=dashed]
	layer_4_norm_sp1_pp1 [label="LayerNorm L4 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_mlp_out_sp0_pp0 -> layer_4_norm_sp1_pp1 [style=dashed]
	layer_3_mlp_out_sp1_pp0 -> layer_4_norm_sp1_pp1 [style=dashed]
	layer_3_mlp_out_sp2_pp0 -> layer_4_norm_sp1_pp1 [style=dashed]
	layer_3_mlp_out_sp3_pp0 -> layer_4_norm_sp1_pp1 [style=dashed]
	layer_4_qkv_sp1_tp0_pp1 [label="QKV Proj L4 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp1_pp1 -> layer_4_qkv_sp1_tp0_pp1
	layer_4_attn_sp1_tp0_pp1 [label="Attention L4 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp1_tp0_pp1 -> layer_4_attn_sp1_tp0_pp1
	layer_4_attn_out_sp1_tp0_pp1 [label="Attn Out Proj L4 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp1_tp0_pp1 -> layer_4_attn_out_sp1_tp0_pp1
	layer_4_qkv_sp1_tp1_pp1 [label="QKV Proj L4 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp1_pp1 -> layer_4_qkv_sp1_tp1_pp1
	layer_4_attn_sp1_tp1_pp1 [label="Attention L4 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp1_tp1_pp1 -> layer_4_attn_sp1_tp1_pp1
	layer_4_attn_out_sp1_tp1_pp1 [label="Attn Out Proj L4 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp1_tp1_pp1 -> layer_4_attn_out_sp1_tp1_pp1
	layer_4_qkv_sp1_tp2_pp1 [label="QKV Proj L4 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp1_pp1 -> layer_4_qkv_sp1_tp2_pp1
	layer_4_attn_sp1_tp2_pp1 [label="Attention L4 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp1_tp2_pp1 -> layer_4_attn_sp1_tp2_pp1
	layer_4_attn_out_sp1_tp2_pp1 [label="Attn Out Proj L4 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp1_tp2_pp1 -> layer_4_attn_out_sp1_tp2_pp1
	layer_4_qkv_sp1_tp3_pp1 [label="QKV Proj L4 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp1_pp1 -> layer_4_qkv_sp1_tp3_pp1
	layer_4_attn_sp1_tp3_pp1 [label="Attention L4 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp1_tp3_pp1 -> layer_4_attn_sp1_tp3_pp1
	layer_4_attn_out_sp1_tp3_pp1 [label="Attn Out Proj L4 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp1_tp3_pp1 -> layer_4_attn_out_sp1_tp3_pp1
	layer_4_attn_ar_sp1_pp1 [label="Attention All-Reduce L4 SP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_attn_out_sp1_tp0_pp1 -> layer_4_attn_ar_sp1_pp1
	layer_4_attn_out_sp1_tp1_pp1 -> layer_4_attn_ar_sp1_pp1
	layer_4_attn_out_sp1_tp2_pp1 -> layer_4_attn_ar_sp1_pp1
	layer_4_attn_out_sp1_tp3_pp1 -> layer_4_attn_ar_sp1_pp1
	layer_4_attn_res_sp1_pp1 [label="Attention Residual L4 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_attn_ar_sp1_pp1 -> layer_4_attn_res_sp1_pp1
	layer_4_norm_sp1_pp1 -> layer_4_attn_res_sp1_pp1 [style=dashed]
	layer_4_post_norm_sp1_pp1 [label="Post-Attn Norm L4 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_attn_res_sp1_pp1 -> layer_4_post_norm_sp1_pp1
	layer_4_router_sp1_pp1 [label="MoE Router L4 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_4_post_norm_sp1_pp1 -> layer_4_router_sp1_pp1
	layer_4_dispatch_sp1_ep0_pp1 [label="Token Dispatch L4 SP1 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep0_pp1 [style=dashed]
	layer_4_expert_sp1_ep0_tp0_pp1 [label="Expert L4 SP1 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep0_pp1 -> layer_4_expert_sp1_ep0_tp0_pp1
	layer_4_expert_out_sp1_ep0_tp0_pp1 [label="Expert Out L4 SP1 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep0_tp0_pp1 -> layer_4_expert_out_sp1_ep0_tp0_pp1
	layer_4_expert_sp1_ep0_tp1_pp1 [label="Expert L4 SP1 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep0_pp1 -> layer_4_expert_sp1_ep0_tp1_pp1
	layer_4_expert_out_sp1_ep0_tp1_pp1 [label="Expert Out L4 SP1 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep0_tp1_pp1 -> layer_4_expert_out_sp1_ep0_tp1_pp1
	layer_4_expert_sp1_ep0_tp2_pp1 [label="Expert L4 SP1 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep0_pp1 -> layer_4_expert_sp1_ep0_tp2_pp1
	layer_4_expert_out_sp1_ep0_tp2_pp1 [label="Expert Out L4 SP1 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep0_tp2_pp1 -> layer_4_expert_out_sp1_ep0_tp2_pp1
	layer_4_expert_sp1_ep0_tp3_pp1 [label="Expert L4 SP1 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep0_pp1 -> layer_4_expert_sp1_ep0_tp3_pp1
	layer_4_expert_out_sp1_ep0_tp3_pp1 [label="Expert Out L4 SP1 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep0_tp3_pp1 -> layer_4_expert_out_sp1_ep0_tp3_pp1
	layer_4_expert_ar_sp1_ep0_pp1 [label="Expert All-Reduce L4 SP1 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep0_tp0_pp1 -> layer_4_expert_ar_sp1_ep0_pp1
	layer_4_expert_out_sp1_ep0_tp1_pp1 -> layer_4_expert_ar_sp1_ep0_pp1
	layer_4_expert_out_sp1_ep0_tp2_pp1 -> layer_4_expert_ar_sp1_ep0_pp1
	layer_4_expert_out_sp1_ep0_tp3_pp1 -> layer_4_expert_ar_sp1_ep0_pp1
	layer_4_combine_sp1_ep0_pp1 [label="Token Combine L4 SP1 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep0_pp1 -> layer_4_combine_sp1_ep0_pp1
	layer_4_dispatch_sp1_ep1_pp1 [label="Token Dispatch L4 SP1 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep1_pp1 [style=dashed]
	layer_4_expert_sp1_ep1_tp0_pp1 [label="Expert L4 SP1 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep1_pp1 -> layer_4_expert_sp1_ep1_tp0_pp1
	layer_4_expert_out_sp1_ep1_tp0_pp1 [label="Expert Out L4 SP1 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep1_tp0_pp1 -> layer_4_expert_out_sp1_ep1_tp0_pp1
	layer_4_expert_sp1_ep1_tp1_pp1 [label="Expert L4 SP1 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep1_pp1 -> layer_4_expert_sp1_ep1_tp1_pp1
	layer_4_expert_out_sp1_ep1_tp1_pp1 [label="Expert Out L4 SP1 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep1_tp1_pp1 -> layer_4_expert_out_sp1_ep1_tp1_pp1
	layer_4_expert_sp1_ep1_tp2_pp1 [label="Expert L4 SP1 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep1_pp1 -> layer_4_expert_sp1_ep1_tp2_pp1
	layer_4_expert_out_sp1_ep1_tp2_pp1 [label="Expert Out L4 SP1 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep1_tp2_pp1 -> layer_4_expert_out_sp1_ep1_tp2_pp1
	layer_4_expert_sp1_ep1_tp3_pp1 [label="Expert L4 SP1 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep1_pp1 -> layer_4_expert_sp1_ep1_tp3_pp1
	layer_4_expert_out_sp1_ep1_tp3_pp1 [label="Expert Out L4 SP1 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep1_tp3_pp1 -> layer_4_expert_out_sp1_ep1_tp3_pp1
	layer_4_expert_ar_sp1_ep1_pp1 [label="Expert All-Reduce L4 SP1 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep1_tp0_pp1 -> layer_4_expert_ar_sp1_ep1_pp1
	layer_4_expert_out_sp1_ep1_tp1_pp1 -> layer_4_expert_ar_sp1_ep1_pp1
	layer_4_expert_out_sp1_ep1_tp2_pp1 -> layer_4_expert_ar_sp1_ep1_pp1
	layer_4_expert_out_sp1_ep1_tp3_pp1 -> layer_4_expert_ar_sp1_ep1_pp1
	layer_4_combine_sp1_ep1_pp1 [label="Token Combine L4 SP1 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep1_pp1 -> layer_4_combine_sp1_ep1_pp1
	layer_4_dispatch_sp1_ep2_pp1 [label="Token Dispatch L4 SP1 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep2_pp1 [style=dashed]
	layer_4_expert_sp1_ep2_tp0_pp1 [label="Expert L4 SP1 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep2_pp1 -> layer_4_expert_sp1_ep2_tp0_pp1
	layer_4_expert_out_sp1_ep2_tp0_pp1 [label="Expert Out L4 SP1 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep2_tp0_pp1 -> layer_4_expert_out_sp1_ep2_tp0_pp1
	layer_4_expert_sp1_ep2_tp1_pp1 [label="Expert L4 SP1 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep2_pp1 -> layer_4_expert_sp1_ep2_tp1_pp1
	layer_4_expert_out_sp1_ep2_tp1_pp1 [label="Expert Out L4 SP1 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep2_tp1_pp1 -> layer_4_expert_out_sp1_ep2_tp1_pp1
	layer_4_expert_sp1_ep2_tp2_pp1 [label="Expert L4 SP1 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep2_pp1 -> layer_4_expert_sp1_ep2_tp2_pp1
	layer_4_expert_out_sp1_ep2_tp2_pp1 [label="Expert Out L4 SP1 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep2_tp2_pp1 -> layer_4_expert_out_sp1_ep2_tp2_pp1
	layer_4_expert_sp1_ep2_tp3_pp1 [label="Expert L4 SP1 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep2_pp1 -> layer_4_expert_sp1_ep2_tp3_pp1
	layer_4_expert_out_sp1_ep2_tp3_pp1 [label="Expert Out L4 SP1 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep2_tp3_pp1 -> layer_4_expert_out_sp1_ep2_tp3_pp1
	layer_4_expert_ar_sp1_ep2_pp1 [label="Expert All-Reduce L4 SP1 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep2_tp0_pp1 -> layer_4_expert_ar_sp1_ep2_pp1
	layer_4_expert_out_sp1_ep2_tp1_pp1 -> layer_4_expert_ar_sp1_ep2_pp1
	layer_4_expert_out_sp1_ep2_tp2_pp1 -> layer_4_expert_ar_sp1_ep2_pp1
	layer_4_expert_out_sp1_ep2_tp3_pp1 -> layer_4_expert_ar_sp1_ep2_pp1
	layer_4_combine_sp1_ep2_pp1 [label="Token Combine L4 SP1 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep2_pp1 -> layer_4_combine_sp1_ep2_pp1
	layer_4_dispatch_sp1_ep3_pp1 [label="Token Dispatch L4 SP1 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep3_pp1 [style=dashed]
	layer_4_expert_sp1_ep3_tp0_pp1 [label="Expert L4 SP1 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep3_pp1 -> layer_4_expert_sp1_ep3_tp0_pp1
	layer_4_expert_out_sp1_ep3_tp0_pp1 [label="Expert Out L4 SP1 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep3_tp0_pp1 -> layer_4_expert_out_sp1_ep3_tp0_pp1
	layer_4_expert_sp1_ep3_tp1_pp1 [label="Expert L4 SP1 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep3_pp1 -> layer_4_expert_sp1_ep3_tp1_pp1
	layer_4_expert_out_sp1_ep3_tp1_pp1 [label="Expert Out L4 SP1 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep3_tp1_pp1 -> layer_4_expert_out_sp1_ep3_tp1_pp1
	layer_4_expert_sp1_ep3_tp2_pp1 [label="Expert L4 SP1 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep3_pp1 -> layer_4_expert_sp1_ep3_tp2_pp1
	layer_4_expert_out_sp1_ep3_tp2_pp1 [label="Expert Out L4 SP1 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep3_tp2_pp1 -> layer_4_expert_out_sp1_ep3_tp2_pp1
	layer_4_expert_sp1_ep3_tp3_pp1 [label="Expert L4 SP1 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep3_pp1 -> layer_4_expert_sp1_ep3_tp3_pp1
	layer_4_expert_out_sp1_ep3_tp3_pp1 [label="Expert Out L4 SP1 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep3_tp3_pp1 -> layer_4_expert_out_sp1_ep3_tp3_pp1
	layer_4_expert_ar_sp1_ep3_pp1 [label="Expert All-Reduce L4 SP1 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep3_tp0_pp1 -> layer_4_expert_ar_sp1_ep3_pp1
	layer_4_expert_out_sp1_ep3_tp1_pp1 -> layer_4_expert_ar_sp1_ep3_pp1
	layer_4_expert_out_sp1_ep3_tp2_pp1 -> layer_4_expert_ar_sp1_ep3_pp1
	layer_4_expert_out_sp1_ep3_tp3_pp1 -> layer_4_expert_ar_sp1_ep3_pp1
	layer_4_combine_sp1_ep3_pp1 [label="Token Combine L4 SP1 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep3_pp1 -> layer_4_combine_sp1_ep3_pp1
	layer_4_dispatch_sp1_ep4_pp1 [label="Token Dispatch L4 SP1 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep4_pp1 [style=dashed]
	layer_4_expert_sp1_ep4_tp0_pp1 [label="Expert L4 SP1 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep4_pp1 -> layer_4_expert_sp1_ep4_tp0_pp1
	layer_4_expert_out_sp1_ep4_tp0_pp1 [label="Expert Out L4 SP1 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep4_tp0_pp1 -> layer_4_expert_out_sp1_ep4_tp0_pp1
	layer_4_expert_sp1_ep4_tp1_pp1 [label="Expert L4 SP1 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep4_pp1 -> layer_4_expert_sp1_ep4_tp1_pp1
	layer_4_expert_out_sp1_ep4_tp1_pp1 [label="Expert Out L4 SP1 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep4_tp1_pp1 -> layer_4_expert_out_sp1_ep4_tp1_pp1
	layer_4_expert_sp1_ep4_tp2_pp1 [label="Expert L4 SP1 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep4_pp1 -> layer_4_expert_sp1_ep4_tp2_pp1
	layer_4_expert_out_sp1_ep4_tp2_pp1 [label="Expert Out L4 SP1 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep4_tp2_pp1 -> layer_4_expert_out_sp1_ep4_tp2_pp1
	layer_4_expert_sp1_ep4_tp3_pp1 [label="Expert L4 SP1 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep4_pp1 -> layer_4_expert_sp1_ep4_tp3_pp1
	layer_4_expert_out_sp1_ep4_tp3_pp1 [label="Expert Out L4 SP1 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep4_tp3_pp1 -> layer_4_expert_out_sp1_ep4_tp3_pp1
	layer_4_expert_ar_sp1_ep4_pp1 [label="Expert All-Reduce L4 SP1 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep4_tp0_pp1 -> layer_4_expert_ar_sp1_ep4_pp1
	layer_4_expert_out_sp1_ep4_tp1_pp1 -> layer_4_expert_ar_sp1_ep4_pp1
	layer_4_expert_out_sp1_ep4_tp2_pp1 -> layer_4_expert_ar_sp1_ep4_pp1
	layer_4_expert_out_sp1_ep4_tp3_pp1 -> layer_4_expert_ar_sp1_ep4_pp1
	layer_4_combine_sp1_ep4_pp1 [label="Token Combine L4 SP1 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep4_pp1 -> layer_4_combine_sp1_ep4_pp1
	layer_4_dispatch_sp1_ep5_pp1 [label="Token Dispatch L4 SP1 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep5_pp1 [style=dashed]
	layer_4_expert_sp1_ep5_tp0_pp1 [label="Expert L4 SP1 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep5_pp1 -> layer_4_expert_sp1_ep5_tp0_pp1
	layer_4_expert_out_sp1_ep5_tp0_pp1 [label="Expert Out L4 SP1 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep5_tp0_pp1 -> layer_4_expert_out_sp1_ep5_tp0_pp1
	layer_4_expert_sp1_ep5_tp1_pp1 [label="Expert L4 SP1 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep5_pp1 -> layer_4_expert_sp1_ep5_tp1_pp1
	layer_4_expert_out_sp1_ep5_tp1_pp1 [label="Expert Out L4 SP1 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep5_tp1_pp1 -> layer_4_expert_out_sp1_ep5_tp1_pp1
	layer_4_expert_sp1_ep5_tp2_pp1 [label="Expert L4 SP1 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep5_pp1 -> layer_4_expert_sp1_ep5_tp2_pp1
	layer_4_expert_out_sp1_ep5_tp2_pp1 [label="Expert Out L4 SP1 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep5_tp2_pp1 -> layer_4_expert_out_sp1_ep5_tp2_pp1
	layer_4_expert_sp1_ep5_tp3_pp1 [label="Expert L4 SP1 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep5_pp1 -> layer_4_expert_sp1_ep5_tp3_pp1
	layer_4_expert_out_sp1_ep5_tp3_pp1 [label="Expert Out L4 SP1 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep5_tp3_pp1 -> layer_4_expert_out_sp1_ep5_tp3_pp1
	layer_4_expert_ar_sp1_ep5_pp1 [label="Expert All-Reduce L4 SP1 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep5_tp0_pp1 -> layer_4_expert_ar_sp1_ep5_pp1
	layer_4_expert_out_sp1_ep5_tp1_pp1 -> layer_4_expert_ar_sp1_ep5_pp1
	layer_4_expert_out_sp1_ep5_tp2_pp1 -> layer_4_expert_ar_sp1_ep5_pp1
	layer_4_expert_out_sp1_ep5_tp3_pp1 -> layer_4_expert_ar_sp1_ep5_pp1
	layer_4_combine_sp1_ep5_pp1 [label="Token Combine L4 SP1 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep5_pp1 -> layer_4_combine_sp1_ep5_pp1
	layer_4_dispatch_sp1_ep6_pp1 [label="Token Dispatch L4 SP1 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep6_pp1 [style=dashed]
	layer_4_expert_sp1_ep6_tp0_pp1 [label="Expert L4 SP1 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep6_pp1 -> layer_4_expert_sp1_ep6_tp0_pp1
	layer_4_expert_out_sp1_ep6_tp0_pp1 [label="Expert Out L4 SP1 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep6_tp0_pp1 -> layer_4_expert_out_sp1_ep6_tp0_pp1
	layer_4_expert_sp1_ep6_tp1_pp1 [label="Expert L4 SP1 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep6_pp1 -> layer_4_expert_sp1_ep6_tp1_pp1
	layer_4_expert_out_sp1_ep6_tp1_pp1 [label="Expert Out L4 SP1 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep6_tp1_pp1 -> layer_4_expert_out_sp1_ep6_tp1_pp1
	layer_4_expert_sp1_ep6_tp2_pp1 [label="Expert L4 SP1 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep6_pp1 -> layer_4_expert_sp1_ep6_tp2_pp1
	layer_4_expert_out_sp1_ep6_tp2_pp1 [label="Expert Out L4 SP1 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep6_tp2_pp1 -> layer_4_expert_out_sp1_ep6_tp2_pp1
	layer_4_expert_sp1_ep6_tp3_pp1 [label="Expert L4 SP1 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep6_pp1 -> layer_4_expert_sp1_ep6_tp3_pp1
	layer_4_expert_out_sp1_ep6_tp3_pp1 [label="Expert Out L4 SP1 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep6_tp3_pp1 -> layer_4_expert_out_sp1_ep6_tp3_pp1
	layer_4_expert_ar_sp1_ep6_pp1 [label="Expert All-Reduce L4 SP1 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep6_tp0_pp1 -> layer_4_expert_ar_sp1_ep6_pp1
	layer_4_expert_out_sp1_ep6_tp1_pp1 -> layer_4_expert_ar_sp1_ep6_pp1
	layer_4_expert_out_sp1_ep6_tp2_pp1 -> layer_4_expert_ar_sp1_ep6_pp1
	layer_4_expert_out_sp1_ep6_tp3_pp1 -> layer_4_expert_ar_sp1_ep6_pp1
	layer_4_combine_sp1_ep6_pp1 [label="Token Combine L4 SP1 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep6_pp1 -> layer_4_combine_sp1_ep6_pp1
	layer_4_dispatch_sp1_ep7_pp1 [label="Token Dispatch L4 SP1 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep7_pp1 [style=dashed]
	layer_4_expert_sp1_ep7_tp0_pp1 [label="Expert L4 SP1 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep7_pp1 -> layer_4_expert_sp1_ep7_tp0_pp1
	layer_4_expert_out_sp1_ep7_tp0_pp1 [label="Expert Out L4 SP1 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep7_tp0_pp1 -> layer_4_expert_out_sp1_ep7_tp0_pp1
	layer_4_expert_sp1_ep7_tp1_pp1 [label="Expert L4 SP1 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep7_pp1 -> layer_4_expert_sp1_ep7_tp1_pp1
	layer_4_expert_out_sp1_ep7_tp1_pp1 [label="Expert Out L4 SP1 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep7_tp1_pp1 -> layer_4_expert_out_sp1_ep7_tp1_pp1
	layer_4_expert_sp1_ep7_tp2_pp1 [label="Expert L4 SP1 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep7_pp1 -> layer_4_expert_sp1_ep7_tp2_pp1
	layer_4_expert_out_sp1_ep7_tp2_pp1 [label="Expert Out L4 SP1 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep7_tp2_pp1 -> layer_4_expert_out_sp1_ep7_tp2_pp1
	layer_4_expert_sp1_ep7_tp3_pp1 [label="Expert L4 SP1 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep7_pp1 -> layer_4_expert_sp1_ep7_tp3_pp1
	layer_4_expert_out_sp1_ep7_tp3_pp1 [label="Expert Out L4 SP1 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep7_tp3_pp1 -> layer_4_expert_out_sp1_ep7_tp3_pp1
	layer_4_expert_ar_sp1_ep7_pp1 [label="Expert All-Reduce L4 SP1 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep7_tp0_pp1 -> layer_4_expert_ar_sp1_ep7_pp1
	layer_4_expert_out_sp1_ep7_tp1_pp1 -> layer_4_expert_ar_sp1_ep7_pp1
	layer_4_expert_out_sp1_ep7_tp2_pp1 -> layer_4_expert_ar_sp1_ep7_pp1
	layer_4_expert_out_sp1_ep7_tp3_pp1 -> layer_4_expert_ar_sp1_ep7_pp1
	layer_4_combine_sp1_ep7_pp1 [label="Token Combine L4 SP1 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep7_pp1 -> layer_4_combine_sp1_ep7_pp1
	layer_4_dispatch_sp1_ep8_pp1 [label="Token Dispatch L4 SP1 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep8_pp1 [style=dashed]
	layer_4_expert_sp1_ep8_tp0_pp1 [label="Expert L4 SP1 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep8_pp1 -> layer_4_expert_sp1_ep8_tp0_pp1
	layer_4_expert_out_sp1_ep8_tp0_pp1 [label="Expert Out L4 SP1 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep8_tp0_pp1 -> layer_4_expert_out_sp1_ep8_tp0_pp1
	layer_4_expert_sp1_ep8_tp1_pp1 [label="Expert L4 SP1 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep8_pp1 -> layer_4_expert_sp1_ep8_tp1_pp1
	layer_4_expert_out_sp1_ep8_tp1_pp1 [label="Expert Out L4 SP1 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep8_tp1_pp1 -> layer_4_expert_out_sp1_ep8_tp1_pp1
	layer_4_expert_sp1_ep8_tp2_pp1 [label="Expert L4 SP1 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep8_pp1 -> layer_4_expert_sp1_ep8_tp2_pp1
	layer_4_expert_out_sp1_ep8_tp2_pp1 [label="Expert Out L4 SP1 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep8_tp2_pp1 -> layer_4_expert_out_sp1_ep8_tp2_pp1
	layer_4_expert_sp1_ep8_tp3_pp1 [label="Expert L4 SP1 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep8_pp1 -> layer_4_expert_sp1_ep8_tp3_pp1
	layer_4_expert_out_sp1_ep8_tp3_pp1 [label="Expert Out L4 SP1 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep8_tp3_pp1 -> layer_4_expert_out_sp1_ep8_tp3_pp1
	layer_4_expert_ar_sp1_ep8_pp1 [label="Expert All-Reduce L4 SP1 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep8_tp0_pp1 -> layer_4_expert_ar_sp1_ep8_pp1
	layer_4_expert_out_sp1_ep8_tp1_pp1 -> layer_4_expert_ar_sp1_ep8_pp1
	layer_4_expert_out_sp1_ep8_tp2_pp1 -> layer_4_expert_ar_sp1_ep8_pp1
	layer_4_expert_out_sp1_ep8_tp3_pp1 -> layer_4_expert_ar_sp1_ep8_pp1
	layer_4_combine_sp1_ep8_pp1 [label="Token Combine L4 SP1 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep8_pp1 -> layer_4_combine_sp1_ep8_pp1
	layer_4_dispatch_sp1_ep9_pp1 [label="Token Dispatch L4 SP1 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep9_pp1 [style=dashed]
	layer_4_expert_sp1_ep9_tp0_pp1 [label="Expert L4 SP1 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep9_pp1 -> layer_4_expert_sp1_ep9_tp0_pp1
	layer_4_expert_out_sp1_ep9_tp0_pp1 [label="Expert Out L4 SP1 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep9_tp0_pp1 -> layer_4_expert_out_sp1_ep9_tp0_pp1
	layer_4_expert_sp1_ep9_tp1_pp1 [label="Expert L4 SP1 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep9_pp1 -> layer_4_expert_sp1_ep9_tp1_pp1
	layer_4_expert_out_sp1_ep9_tp1_pp1 [label="Expert Out L4 SP1 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep9_tp1_pp1 -> layer_4_expert_out_sp1_ep9_tp1_pp1
	layer_4_expert_sp1_ep9_tp2_pp1 [label="Expert L4 SP1 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep9_pp1 -> layer_4_expert_sp1_ep9_tp2_pp1
	layer_4_expert_out_sp1_ep9_tp2_pp1 [label="Expert Out L4 SP1 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep9_tp2_pp1 -> layer_4_expert_out_sp1_ep9_tp2_pp1
	layer_4_expert_sp1_ep9_tp3_pp1 [label="Expert L4 SP1 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep9_pp1 -> layer_4_expert_sp1_ep9_tp3_pp1
	layer_4_expert_out_sp1_ep9_tp3_pp1 [label="Expert Out L4 SP1 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep9_tp3_pp1 -> layer_4_expert_out_sp1_ep9_tp3_pp1
	layer_4_expert_ar_sp1_ep9_pp1 [label="Expert All-Reduce L4 SP1 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep9_tp0_pp1 -> layer_4_expert_ar_sp1_ep9_pp1
	layer_4_expert_out_sp1_ep9_tp1_pp1 -> layer_4_expert_ar_sp1_ep9_pp1
	layer_4_expert_out_sp1_ep9_tp2_pp1 -> layer_4_expert_ar_sp1_ep9_pp1
	layer_4_expert_out_sp1_ep9_tp3_pp1 -> layer_4_expert_ar_sp1_ep9_pp1
	layer_4_combine_sp1_ep9_pp1 [label="Token Combine L4 SP1 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep9_pp1 -> layer_4_combine_sp1_ep9_pp1
	layer_4_dispatch_sp1_ep10_pp1 [label="Token Dispatch L4 SP1 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep10_pp1 [style=dashed]
	layer_4_expert_sp1_ep10_tp0_pp1 [label="Expert L4 SP1 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep10_pp1 -> layer_4_expert_sp1_ep10_tp0_pp1
	layer_4_expert_out_sp1_ep10_tp0_pp1 [label="Expert Out L4 SP1 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep10_tp0_pp1 -> layer_4_expert_out_sp1_ep10_tp0_pp1
	layer_4_expert_sp1_ep10_tp1_pp1 [label="Expert L4 SP1 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep10_pp1 -> layer_4_expert_sp1_ep10_tp1_pp1
	layer_4_expert_out_sp1_ep10_tp1_pp1 [label="Expert Out L4 SP1 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep10_tp1_pp1 -> layer_4_expert_out_sp1_ep10_tp1_pp1
	layer_4_expert_sp1_ep10_tp2_pp1 [label="Expert L4 SP1 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep10_pp1 -> layer_4_expert_sp1_ep10_tp2_pp1
	layer_4_expert_out_sp1_ep10_tp2_pp1 [label="Expert Out L4 SP1 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep10_tp2_pp1 -> layer_4_expert_out_sp1_ep10_tp2_pp1
	layer_4_expert_sp1_ep10_tp3_pp1 [label="Expert L4 SP1 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep10_pp1 -> layer_4_expert_sp1_ep10_tp3_pp1
	layer_4_expert_out_sp1_ep10_tp3_pp1 [label="Expert Out L4 SP1 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep10_tp3_pp1 -> layer_4_expert_out_sp1_ep10_tp3_pp1
	layer_4_expert_ar_sp1_ep10_pp1 [label="Expert All-Reduce L4 SP1 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep10_tp0_pp1 -> layer_4_expert_ar_sp1_ep10_pp1
	layer_4_expert_out_sp1_ep10_tp1_pp1 -> layer_4_expert_ar_sp1_ep10_pp1
	layer_4_expert_out_sp1_ep10_tp2_pp1 -> layer_4_expert_ar_sp1_ep10_pp1
	layer_4_expert_out_sp1_ep10_tp3_pp1 -> layer_4_expert_ar_sp1_ep10_pp1
	layer_4_combine_sp1_ep10_pp1 [label="Token Combine L4 SP1 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep10_pp1 -> layer_4_combine_sp1_ep10_pp1
	layer_4_dispatch_sp1_ep11_pp1 [label="Token Dispatch L4 SP1 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep11_pp1 [style=dashed]
	layer_4_expert_sp1_ep11_tp0_pp1 [label="Expert L4 SP1 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep11_pp1 -> layer_4_expert_sp1_ep11_tp0_pp1
	layer_4_expert_out_sp1_ep11_tp0_pp1 [label="Expert Out L4 SP1 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep11_tp0_pp1 -> layer_4_expert_out_sp1_ep11_tp0_pp1
	layer_4_expert_sp1_ep11_tp1_pp1 [label="Expert L4 SP1 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep11_pp1 -> layer_4_expert_sp1_ep11_tp1_pp1
	layer_4_expert_out_sp1_ep11_tp1_pp1 [label="Expert Out L4 SP1 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep11_tp1_pp1 -> layer_4_expert_out_sp1_ep11_tp1_pp1
	layer_4_expert_sp1_ep11_tp2_pp1 [label="Expert L4 SP1 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep11_pp1 -> layer_4_expert_sp1_ep11_tp2_pp1
	layer_4_expert_out_sp1_ep11_tp2_pp1 [label="Expert Out L4 SP1 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep11_tp2_pp1 -> layer_4_expert_out_sp1_ep11_tp2_pp1
	layer_4_expert_sp1_ep11_tp3_pp1 [label="Expert L4 SP1 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep11_pp1 -> layer_4_expert_sp1_ep11_tp3_pp1
	layer_4_expert_out_sp1_ep11_tp3_pp1 [label="Expert Out L4 SP1 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep11_tp3_pp1 -> layer_4_expert_out_sp1_ep11_tp3_pp1
	layer_4_expert_ar_sp1_ep11_pp1 [label="Expert All-Reduce L4 SP1 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep11_tp0_pp1 -> layer_4_expert_ar_sp1_ep11_pp1
	layer_4_expert_out_sp1_ep11_tp1_pp1 -> layer_4_expert_ar_sp1_ep11_pp1
	layer_4_expert_out_sp1_ep11_tp2_pp1 -> layer_4_expert_ar_sp1_ep11_pp1
	layer_4_expert_out_sp1_ep11_tp3_pp1 -> layer_4_expert_ar_sp1_ep11_pp1
	layer_4_combine_sp1_ep11_pp1 [label="Token Combine L4 SP1 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep11_pp1 -> layer_4_combine_sp1_ep11_pp1
	layer_4_dispatch_sp1_ep12_pp1 [label="Token Dispatch L4 SP1 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep12_pp1 [style=dashed]
	layer_4_expert_sp1_ep12_tp0_pp1 [label="Expert L4 SP1 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep12_pp1 -> layer_4_expert_sp1_ep12_tp0_pp1
	layer_4_expert_out_sp1_ep12_tp0_pp1 [label="Expert Out L4 SP1 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep12_tp0_pp1 -> layer_4_expert_out_sp1_ep12_tp0_pp1
	layer_4_expert_sp1_ep12_tp1_pp1 [label="Expert L4 SP1 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep12_pp1 -> layer_4_expert_sp1_ep12_tp1_pp1
	layer_4_expert_out_sp1_ep12_tp1_pp1 [label="Expert Out L4 SP1 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep12_tp1_pp1 -> layer_4_expert_out_sp1_ep12_tp1_pp1
	layer_4_expert_sp1_ep12_tp2_pp1 [label="Expert L4 SP1 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep12_pp1 -> layer_4_expert_sp1_ep12_tp2_pp1
	layer_4_expert_out_sp1_ep12_tp2_pp1 [label="Expert Out L4 SP1 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep12_tp2_pp1 -> layer_4_expert_out_sp1_ep12_tp2_pp1
	layer_4_expert_sp1_ep12_tp3_pp1 [label="Expert L4 SP1 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep12_pp1 -> layer_4_expert_sp1_ep12_tp3_pp1
	layer_4_expert_out_sp1_ep12_tp3_pp1 [label="Expert Out L4 SP1 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep12_tp3_pp1 -> layer_4_expert_out_sp1_ep12_tp3_pp1
	layer_4_expert_ar_sp1_ep12_pp1 [label="Expert All-Reduce L4 SP1 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep12_tp0_pp1 -> layer_4_expert_ar_sp1_ep12_pp1
	layer_4_expert_out_sp1_ep12_tp1_pp1 -> layer_4_expert_ar_sp1_ep12_pp1
	layer_4_expert_out_sp1_ep12_tp2_pp1 -> layer_4_expert_ar_sp1_ep12_pp1
	layer_4_expert_out_sp1_ep12_tp3_pp1 -> layer_4_expert_ar_sp1_ep12_pp1
	layer_4_combine_sp1_ep12_pp1 [label="Token Combine L4 SP1 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep12_pp1 -> layer_4_combine_sp1_ep12_pp1
	layer_4_dispatch_sp1_ep13_pp1 [label="Token Dispatch L4 SP1 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep13_pp1 [style=dashed]
	layer_4_expert_sp1_ep13_tp0_pp1 [label="Expert L4 SP1 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep13_pp1 -> layer_4_expert_sp1_ep13_tp0_pp1
	layer_4_expert_out_sp1_ep13_tp0_pp1 [label="Expert Out L4 SP1 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep13_tp0_pp1 -> layer_4_expert_out_sp1_ep13_tp0_pp1
	layer_4_expert_sp1_ep13_tp1_pp1 [label="Expert L4 SP1 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep13_pp1 -> layer_4_expert_sp1_ep13_tp1_pp1
	layer_4_expert_out_sp1_ep13_tp1_pp1 [label="Expert Out L4 SP1 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep13_tp1_pp1 -> layer_4_expert_out_sp1_ep13_tp1_pp1
	layer_4_expert_sp1_ep13_tp2_pp1 [label="Expert L4 SP1 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep13_pp1 -> layer_4_expert_sp1_ep13_tp2_pp1
	layer_4_expert_out_sp1_ep13_tp2_pp1 [label="Expert Out L4 SP1 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep13_tp2_pp1 -> layer_4_expert_out_sp1_ep13_tp2_pp1
	layer_4_expert_sp1_ep13_tp3_pp1 [label="Expert L4 SP1 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep13_pp1 -> layer_4_expert_sp1_ep13_tp3_pp1
	layer_4_expert_out_sp1_ep13_tp3_pp1 [label="Expert Out L4 SP1 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep13_tp3_pp1 -> layer_4_expert_out_sp1_ep13_tp3_pp1
	layer_4_expert_ar_sp1_ep13_pp1 [label="Expert All-Reduce L4 SP1 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep13_tp0_pp1 -> layer_4_expert_ar_sp1_ep13_pp1
	layer_4_expert_out_sp1_ep13_tp1_pp1 -> layer_4_expert_ar_sp1_ep13_pp1
	layer_4_expert_out_sp1_ep13_tp2_pp1 -> layer_4_expert_ar_sp1_ep13_pp1
	layer_4_expert_out_sp1_ep13_tp3_pp1 -> layer_4_expert_ar_sp1_ep13_pp1
	layer_4_combine_sp1_ep13_pp1 [label="Token Combine L4 SP1 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep13_pp1 -> layer_4_combine_sp1_ep13_pp1
	layer_4_dispatch_sp1_ep14_pp1 [label="Token Dispatch L4 SP1 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep14_pp1 [style=dashed]
	layer_4_expert_sp1_ep14_tp0_pp1 [label="Expert L4 SP1 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep14_pp1 -> layer_4_expert_sp1_ep14_tp0_pp1
	layer_4_expert_out_sp1_ep14_tp0_pp1 [label="Expert Out L4 SP1 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep14_tp0_pp1 -> layer_4_expert_out_sp1_ep14_tp0_pp1
	layer_4_expert_sp1_ep14_tp1_pp1 [label="Expert L4 SP1 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep14_pp1 -> layer_4_expert_sp1_ep14_tp1_pp1
	layer_4_expert_out_sp1_ep14_tp1_pp1 [label="Expert Out L4 SP1 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep14_tp1_pp1 -> layer_4_expert_out_sp1_ep14_tp1_pp1
	layer_4_expert_sp1_ep14_tp2_pp1 [label="Expert L4 SP1 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep14_pp1 -> layer_4_expert_sp1_ep14_tp2_pp1
	layer_4_expert_out_sp1_ep14_tp2_pp1 [label="Expert Out L4 SP1 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep14_tp2_pp1 -> layer_4_expert_out_sp1_ep14_tp2_pp1
	layer_4_expert_sp1_ep14_tp3_pp1 [label="Expert L4 SP1 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep14_pp1 -> layer_4_expert_sp1_ep14_tp3_pp1
	layer_4_expert_out_sp1_ep14_tp3_pp1 [label="Expert Out L4 SP1 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep14_tp3_pp1 -> layer_4_expert_out_sp1_ep14_tp3_pp1
	layer_4_expert_ar_sp1_ep14_pp1 [label="Expert All-Reduce L4 SP1 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep14_tp0_pp1 -> layer_4_expert_ar_sp1_ep14_pp1
	layer_4_expert_out_sp1_ep14_tp1_pp1 -> layer_4_expert_ar_sp1_ep14_pp1
	layer_4_expert_out_sp1_ep14_tp2_pp1 -> layer_4_expert_ar_sp1_ep14_pp1
	layer_4_expert_out_sp1_ep14_tp3_pp1 -> layer_4_expert_ar_sp1_ep14_pp1
	layer_4_combine_sp1_ep14_pp1 [label="Token Combine L4 SP1 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep14_pp1 -> layer_4_combine_sp1_ep14_pp1
	layer_4_dispatch_sp1_ep15_pp1 [label="Token Dispatch L4 SP1 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp1_pp1 -> layer_4_dispatch_sp1_ep15_pp1 [style=dashed]
	layer_4_expert_sp1_ep15_tp0_pp1 [label="Expert L4 SP1 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep15_pp1 -> layer_4_expert_sp1_ep15_tp0_pp1
	layer_4_expert_out_sp1_ep15_tp0_pp1 [label="Expert Out L4 SP1 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep15_tp0_pp1 -> layer_4_expert_out_sp1_ep15_tp0_pp1
	layer_4_expert_sp1_ep15_tp1_pp1 [label="Expert L4 SP1 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep15_pp1 -> layer_4_expert_sp1_ep15_tp1_pp1
	layer_4_expert_out_sp1_ep15_tp1_pp1 [label="Expert Out L4 SP1 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep15_tp1_pp1 -> layer_4_expert_out_sp1_ep15_tp1_pp1
	layer_4_expert_sp1_ep15_tp2_pp1 [label="Expert L4 SP1 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep15_pp1 -> layer_4_expert_sp1_ep15_tp2_pp1
	layer_4_expert_out_sp1_ep15_tp2_pp1 [label="Expert Out L4 SP1 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep15_tp2_pp1 -> layer_4_expert_out_sp1_ep15_tp2_pp1
	layer_4_expert_sp1_ep15_tp3_pp1 [label="Expert L4 SP1 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp1_ep15_pp1 -> layer_4_expert_sp1_ep15_tp3_pp1
	layer_4_expert_out_sp1_ep15_tp3_pp1 [label="Expert Out L4 SP1 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp1_ep15_tp3_pp1 -> layer_4_expert_out_sp1_ep15_tp3_pp1
	layer_4_expert_ar_sp1_ep15_pp1 [label="Expert All-Reduce L4 SP1 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp1_ep15_tp0_pp1 -> layer_4_expert_ar_sp1_ep15_pp1
	layer_4_expert_out_sp1_ep15_tp1_pp1 -> layer_4_expert_ar_sp1_ep15_pp1
	layer_4_expert_out_sp1_ep15_tp2_pp1 -> layer_4_expert_ar_sp1_ep15_pp1
	layer_4_expert_out_sp1_ep15_tp3_pp1 -> layer_4_expert_ar_sp1_ep15_pp1
	layer_4_combine_sp1_ep15_pp1 [label="Token Combine L4 SP1 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp1_ep15_pp1 -> layer_4_combine_sp1_ep15_pp1
	layer_4_moe_all2all_sp1_pp1 [label="MoE All-to-All L4 SP1\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_4_combine_sp1_ep0_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep1_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep2_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep3_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep4_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep5_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep6_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep7_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep8_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep9_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep10_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep11_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep12_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep13_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep14_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_combine_sp1_ep15_pp1 -> layer_4_moe_all2all_sp1_pp1
	layer_4_mlp_out_sp1_pp1 [label="MoE Output L4 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_moe_all2all_sp1_pp1 -> layer_4_mlp_out_sp1_pp1
	layer_4_mlp_res_sp1_pp1 [label="MLP Residual L4 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_mlp_out_sp1_pp1 -> layer_4_mlp_res_sp1_pp1
	layer_4_attn_res_sp1_pp1 -> layer_4_mlp_res_sp1_pp1 [style=dashed]
	layer_4_norm_sp2_pp1 [label="LayerNorm L4 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_mlp_out_sp0_pp0 -> layer_4_norm_sp2_pp1 [style=dashed]
	layer_3_mlp_out_sp1_pp0 -> layer_4_norm_sp2_pp1 [style=dashed]
	layer_3_mlp_out_sp2_pp0 -> layer_4_norm_sp2_pp1 [style=dashed]
	layer_3_mlp_out_sp3_pp0 -> layer_4_norm_sp2_pp1 [style=dashed]
	layer_4_qkv_sp2_tp0_pp1 [label="QKV Proj L4 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp2_pp1 -> layer_4_qkv_sp2_tp0_pp1
	layer_4_attn_sp2_tp0_pp1 [label="Attention L4 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp2_tp0_pp1 -> layer_4_attn_sp2_tp0_pp1
	layer_4_attn_out_sp2_tp0_pp1 [label="Attn Out Proj L4 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp2_tp0_pp1 -> layer_4_attn_out_sp2_tp0_pp1
	layer_4_qkv_sp2_tp1_pp1 [label="QKV Proj L4 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp2_pp1 -> layer_4_qkv_sp2_tp1_pp1
	layer_4_attn_sp2_tp1_pp1 [label="Attention L4 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp2_tp1_pp1 -> layer_4_attn_sp2_tp1_pp1
	layer_4_attn_out_sp2_tp1_pp1 [label="Attn Out Proj L4 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp2_tp1_pp1 -> layer_4_attn_out_sp2_tp1_pp1
	layer_4_qkv_sp2_tp2_pp1 [label="QKV Proj L4 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp2_pp1 -> layer_4_qkv_sp2_tp2_pp1
	layer_4_attn_sp2_tp2_pp1 [label="Attention L4 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp2_tp2_pp1 -> layer_4_attn_sp2_tp2_pp1
	layer_4_attn_out_sp2_tp2_pp1 [label="Attn Out Proj L4 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp2_tp2_pp1 -> layer_4_attn_out_sp2_tp2_pp1
	layer_4_qkv_sp2_tp3_pp1 [label="QKV Proj L4 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp2_pp1 -> layer_4_qkv_sp2_tp3_pp1
	layer_4_attn_sp2_tp3_pp1 [label="Attention L4 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp2_tp3_pp1 -> layer_4_attn_sp2_tp3_pp1
	layer_4_attn_out_sp2_tp3_pp1 [label="Attn Out Proj L4 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp2_tp3_pp1 -> layer_4_attn_out_sp2_tp3_pp1
	layer_4_attn_ar_sp2_pp1 [label="Attention All-Reduce L4 SP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_attn_out_sp2_tp0_pp1 -> layer_4_attn_ar_sp2_pp1
	layer_4_attn_out_sp2_tp1_pp1 -> layer_4_attn_ar_sp2_pp1
	layer_4_attn_out_sp2_tp2_pp1 -> layer_4_attn_ar_sp2_pp1
	layer_4_attn_out_sp2_tp3_pp1 -> layer_4_attn_ar_sp2_pp1
	layer_4_attn_res_sp2_pp1 [label="Attention Residual L4 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_attn_ar_sp2_pp1 -> layer_4_attn_res_sp2_pp1
	layer_4_norm_sp2_pp1 -> layer_4_attn_res_sp2_pp1 [style=dashed]
	layer_4_post_norm_sp2_pp1 [label="Post-Attn Norm L4 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_attn_res_sp2_pp1 -> layer_4_post_norm_sp2_pp1
	layer_4_router_sp2_pp1 [label="MoE Router L4 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_4_post_norm_sp2_pp1 -> layer_4_router_sp2_pp1
	layer_4_dispatch_sp2_ep0_pp1 [label="Token Dispatch L4 SP2 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep0_pp1 [style=dashed]
	layer_4_expert_sp2_ep0_tp0_pp1 [label="Expert L4 SP2 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep0_pp1 -> layer_4_expert_sp2_ep0_tp0_pp1
	layer_4_expert_out_sp2_ep0_tp0_pp1 [label="Expert Out L4 SP2 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep0_tp0_pp1 -> layer_4_expert_out_sp2_ep0_tp0_pp1
	layer_4_expert_sp2_ep0_tp1_pp1 [label="Expert L4 SP2 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep0_pp1 -> layer_4_expert_sp2_ep0_tp1_pp1
	layer_4_expert_out_sp2_ep0_tp1_pp1 [label="Expert Out L4 SP2 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep0_tp1_pp1 -> layer_4_expert_out_sp2_ep0_tp1_pp1
	layer_4_expert_sp2_ep0_tp2_pp1 [label="Expert L4 SP2 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep0_pp1 -> layer_4_expert_sp2_ep0_tp2_pp1
	layer_4_expert_out_sp2_ep0_tp2_pp1 [label="Expert Out L4 SP2 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep0_tp2_pp1 -> layer_4_expert_out_sp2_ep0_tp2_pp1
	layer_4_expert_sp2_ep0_tp3_pp1 [label="Expert L4 SP2 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep0_pp1 -> layer_4_expert_sp2_ep0_tp3_pp1
	layer_4_expert_out_sp2_ep0_tp3_pp1 [label="Expert Out L4 SP2 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep0_tp3_pp1 -> layer_4_expert_out_sp2_ep0_tp3_pp1
	layer_4_expert_ar_sp2_ep0_pp1 [label="Expert All-Reduce L4 SP2 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep0_tp0_pp1 -> layer_4_expert_ar_sp2_ep0_pp1
	layer_4_expert_out_sp2_ep0_tp1_pp1 -> layer_4_expert_ar_sp2_ep0_pp1
	layer_4_expert_out_sp2_ep0_tp2_pp1 -> layer_4_expert_ar_sp2_ep0_pp1
	layer_4_expert_out_sp2_ep0_tp3_pp1 -> layer_4_expert_ar_sp2_ep0_pp1
	layer_4_combine_sp2_ep0_pp1 [label="Token Combine L4 SP2 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep0_pp1 -> layer_4_combine_sp2_ep0_pp1
	layer_4_dispatch_sp2_ep1_pp1 [label="Token Dispatch L4 SP2 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep1_pp1 [style=dashed]
	layer_4_expert_sp2_ep1_tp0_pp1 [label="Expert L4 SP2 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep1_pp1 -> layer_4_expert_sp2_ep1_tp0_pp1
	layer_4_expert_out_sp2_ep1_tp0_pp1 [label="Expert Out L4 SP2 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep1_tp0_pp1 -> layer_4_expert_out_sp2_ep1_tp0_pp1
	layer_4_expert_sp2_ep1_tp1_pp1 [label="Expert L4 SP2 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep1_pp1 -> layer_4_expert_sp2_ep1_tp1_pp1
	layer_4_expert_out_sp2_ep1_tp1_pp1 [label="Expert Out L4 SP2 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep1_tp1_pp1 -> layer_4_expert_out_sp2_ep1_tp1_pp1
	layer_4_expert_sp2_ep1_tp2_pp1 [label="Expert L4 SP2 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep1_pp1 -> layer_4_expert_sp2_ep1_tp2_pp1
	layer_4_expert_out_sp2_ep1_tp2_pp1 [label="Expert Out L4 SP2 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep1_tp2_pp1 -> layer_4_expert_out_sp2_ep1_tp2_pp1
	layer_4_expert_sp2_ep1_tp3_pp1 [label="Expert L4 SP2 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep1_pp1 -> layer_4_expert_sp2_ep1_tp3_pp1
	layer_4_expert_out_sp2_ep1_tp3_pp1 [label="Expert Out L4 SP2 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep1_tp3_pp1 -> layer_4_expert_out_sp2_ep1_tp3_pp1
	layer_4_expert_ar_sp2_ep1_pp1 [label="Expert All-Reduce L4 SP2 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep1_tp0_pp1 -> layer_4_expert_ar_sp2_ep1_pp1
	layer_4_expert_out_sp2_ep1_tp1_pp1 -> layer_4_expert_ar_sp2_ep1_pp1
	layer_4_expert_out_sp2_ep1_tp2_pp1 -> layer_4_expert_ar_sp2_ep1_pp1
	layer_4_expert_out_sp2_ep1_tp3_pp1 -> layer_4_expert_ar_sp2_ep1_pp1
	layer_4_combine_sp2_ep1_pp1 [label="Token Combine L4 SP2 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep1_pp1 -> layer_4_combine_sp2_ep1_pp1
	layer_4_dispatch_sp2_ep2_pp1 [label="Token Dispatch L4 SP2 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep2_pp1 [style=dashed]
	layer_4_expert_sp2_ep2_tp0_pp1 [label="Expert L4 SP2 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep2_pp1 -> layer_4_expert_sp2_ep2_tp0_pp1
	layer_4_expert_out_sp2_ep2_tp0_pp1 [label="Expert Out L4 SP2 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep2_tp0_pp1 -> layer_4_expert_out_sp2_ep2_tp0_pp1
	layer_4_expert_sp2_ep2_tp1_pp1 [label="Expert L4 SP2 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep2_pp1 -> layer_4_expert_sp2_ep2_tp1_pp1
	layer_4_expert_out_sp2_ep2_tp1_pp1 [label="Expert Out L4 SP2 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep2_tp1_pp1 -> layer_4_expert_out_sp2_ep2_tp1_pp1
	layer_4_expert_sp2_ep2_tp2_pp1 [label="Expert L4 SP2 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep2_pp1 -> layer_4_expert_sp2_ep2_tp2_pp1
	layer_4_expert_out_sp2_ep2_tp2_pp1 [label="Expert Out L4 SP2 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep2_tp2_pp1 -> layer_4_expert_out_sp2_ep2_tp2_pp1
	layer_4_expert_sp2_ep2_tp3_pp1 [label="Expert L4 SP2 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep2_pp1 -> layer_4_expert_sp2_ep2_tp3_pp1
	layer_4_expert_out_sp2_ep2_tp3_pp1 [label="Expert Out L4 SP2 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep2_tp3_pp1 -> layer_4_expert_out_sp2_ep2_tp3_pp1
	layer_4_expert_ar_sp2_ep2_pp1 [label="Expert All-Reduce L4 SP2 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep2_tp0_pp1 -> layer_4_expert_ar_sp2_ep2_pp1
	layer_4_expert_out_sp2_ep2_tp1_pp1 -> layer_4_expert_ar_sp2_ep2_pp1
	layer_4_expert_out_sp2_ep2_tp2_pp1 -> layer_4_expert_ar_sp2_ep2_pp1
	layer_4_expert_out_sp2_ep2_tp3_pp1 -> layer_4_expert_ar_sp2_ep2_pp1
	layer_4_combine_sp2_ep2_pp1 [label="Token Combine L4 SP2 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep2_pp1 -> layer_4_combine_sp2_ep2_pp1
	layer_4_dispatch_sp2_ep3_pp1 [label="Token Dispatch L4 SP2 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep3_pp1 [style=dashed]
	layer_4_expert_sp2_ep3_tp0_pp1 [label="Expert L4 SP2 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep3_pp1 -> layer_4_expert_sp2_ep3_tp0_pp1
	layer_4_expert_out_sp2_ep3_tp0_pp1 [label="Expert Out L4 SP2 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep3_tp0_pp1 -> layer_4_expert_out_sp2_ep3_tp0_pp1
	layer_4_expert_sp2_ep3_tp1_pp1 [label="Expert L4 SP2 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep3_pp1 -> layer_4_expert_sp2_ep3_tp1_pp1
	layer_4_expert_out_sp2_ep3_tp1_pp1 [label="Expert Out L4 SP2 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep3_tp1_pp1 -> layer_4_expert_out_sp2_ep3_tp1_pp1
	layer_4_expert_sp2_ep3_tp2_pp1 [label="Expert L4 SP2 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep3_pp1 -> layer_4_expert_sp2_ep3_tp2_pp1
	layer_4_expert_out_sp2_ep3_tp2_pp1 [label="Expert Out L4 SP2 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep3_tp2_pp1 -> layer_4_expert_out_sp2_ep3_tp2_pp1
	layer_4_expert_sp2_ep3_tp3_pp1 [label="Expert L4 SP2 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep3_pp1 -> layer_4_expert_sp2_ep3_tp3_pp1
	layer_4_expert_out_sp2_ep3_tp3_pp1 [label="Expert Out L4 SP2 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep3_tp3_pp1 -> layer_4_expert_out_sp2_ep3_tp3_pp1
	layer_4_expert_ar_sp2_ep3_pp1 [label="Expert All-Reduce L4 SP2 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep3_tp0_pp1 -> layer_4_expert_ar_sp2_ep3_pp1
	layer_4_expert_out_sp2_ep3_tp1_pp1 -> layer_4_expert_ar_sp2_ep3_pp1
	layer_4_expert_out_sp2_ep3_tp2_pp1 -> layer_4_expert_ar_sp2_ep3_pp1
	layer_4_expert_out_sp2_ep3_tp3_pp1 -> layer_4_expert_ar_sp2_ep3_pp1
	layer_4_combine_sp2_ep3_pp1 [label="Token Combine L4 SP2 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep3_pp1 -> layer_4_combine_sp2_ep3_pp1
	layer_4_dispatch_sp2_ep4_pp1 [label="Token Dispatch L4 SP2 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep4_pp1 [style=dashed]
	layer_4_expert_sp2_ep4_tp0_pp1 [label="Expert L4 SP2 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep4_pp1 -> layer_4_expert_sp2_ep4_tp0_pp1
	layer_4_expert_out_sp2_ep4_tp0_pp1 [label="Expert Out L4 SP2 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep4_tp0_pp1 -> layer_4_expert_out_sp2_ep4_tp0_pp1
	layer_4_expert_sp2_ep4_tp1_pp1 [label="Expert L4 SP2 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep4_pp1 -> layer_4_expert_sp2_ep4_tp1_pp1
	layer_4_expert_out_sp2_ep4_tp1_pp1 [label="Expert Out L4 SP2 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep4_tp1_pp1 -> layer_4_expert_out_sp2_ep4_tp1_pp1
	layer_4_expert_sp2_ep4_tp2_pp1 [label="Expert L4 SP2 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep4_pp1 -> layer_4_expert_sp2_ep4_tp2_pp1
	layer_4_expert_out_sp2_ep4_tp2_pp1 [label="Expert Out L4 SP2 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep4_tp2_pp1 -> layer_4_expert_out_sp2_ep4_tp2_pp1
	layer_4_expert_sp2_ep4_tp3_pp1 [label="Expert L4 SP2 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep4_pp1 -> layer_4_expert_sp2_ep4_tp3_pp1
	layer_4_expert_out_sp2_ep4_tp3_pp1 [label="Expert Out L4 SP2 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep4_tp3_pp1 -> layer_4_expert_out_sp2_ep4_tp3_pp1
	layer_4_expert_ar_sp2_ep4_pp1 [label="Expert All-Reduce L4 SP2 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep4_tp0_pp1 -> layer_4_expert_ar_sp2_ep4_pp1
	layer_4_expert_out_sp2_ep4_tp1_pp1 -> layer_4_expert_ar_sp2_ep4_pp1
	layer_4_expert_out_sp2_ep4_tp2_pp1 -> layer_4_expert_ar_sp2_ep4_pp1
	layer_4_expert_out_sp2_ep4_tp3_pp1 -> layer_4_expert_ar_sp2_ep4_pp1
	layer_4_combine_sp2_ep4_pp1 [label="Token Combine L4 SP2 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep4_pp1 -> layer_4_combine_sp2_ep4_pp1
	layer_4_dispatch_sp2_ep5_pp1 [label="Token Dispatch L4 SP2 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep5_pp1 [style=dashed]
	layer_4_expert_sp2_ep5_tp0_pp1 [label="Expert L4 SP2 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep5_pp1 -> layer_4_expert_sp2_ep5_tp0_pp1
	layer_4_expert_out_sp2_ep5_tp0_pp1 [label="Expert Out L4 SP2 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep5_tp0_pp1 -> layer_4_expert_out_sp2_ep5_tp0_pp1
	layer_4_expert_sp2_ep5_tp1_pp1 [label="Expert L4 SP2 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep5_pp1 -> layer_4_expert_sp2_ep5_tp1_pp1
	layer_4_expert_out_sp2_ep5_tp1_pp1 [label="Expert Out L4 SP2 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep5_tp1_pp1 -> layer_4_expert_out_sp2_ep5_tp1_pp1
	layer_4_expert_sp2_ep5_tp2_pp1 [label="Expert L4 SP2 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep5_pp1 -> layer_4_expert_sp2_ep5_tp2_pp1
	layer_4_expert_out_sp2_ep5_tp2_pp1 [label="Expert Out L4 SP2 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep5_tp2_pp1 -> layer_4_expert_out_sp2_ep5_tp2_pp1
	layer_4_expert_sp2_ep5_tp3_pp1 [label="Expert L4 SP2 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep5_pp1 -> layer_4_expert_sp2_ep5_tp3_pp1
	layer_4_expert_out_sp2_ep5_tp3_pp1 [label="Expert Out L4 SP2 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep5_tp3_pp1 -> layer_4_expert_out_sp2_ep5_tp3_pp1
	layer_4_expert_ar_sp2_ep5_pp1 [label="Expert All-Reduce L4 SP2 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep5_tp0_pp1 -> layer_4_expert_ar_sp2_ep5_pp1
	layer_4_expert_out_sp2_ep5_tp1_pp1 -> layer_4_expert_ar_sp2_ep5_pp1
	layer_4_expert_out_sp2_ep5_tp2_pp1 -> layer_4_expert_ar_sp2_ep5_pp1
	layer_4_expert_out_sp2_ep5_tp3_pp1 -> layer_4_expert_ar_sp2_ep5_pp1
	layer_4_combine_sp2_ep5_pp1 [label="Token Combine L4 SP2 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep5_pp1 -> layer_4_combine_sp2_ep5_pp1
	layer_4_dispatch_sp2_ep6_pp1 [label="Token Dispatch L4 SP2 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep6_pp1 [style=dashed]
	layer_4_expert_sp2_ep6_tp0_pp1 [label="Expert L4 SP2 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep6_pp1 -> layer_4_expert_sp2_ep6_tp0_pp1
	layer_4_expert_out_sp2_ep6_tp0_pp1 [label="Expert Out L4 SP2 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep6_tp0_pp1 -> layer_4_expert_out_sp2_ep6_tp0_pp1
	layer_4_expert_sp2_ep6_tp1_pp1 [label="Expert L4 SP2 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep6_pp1 -> layer_4_expert_sp2_ep6_tp1_pp1
	layer_4_expert_out_sp2_ep6_tp1_pp1 [label="Expert Out L4 SP2 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep6_tp1_pp1 -> layer_4_expert_out_sp2_ep6_tp1_pp1
	layer_4_expert_sp2_ep6_tp2_pp1 [label="Expert L4 SP2 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep6_pp1 -> layer_4_expert_sp2_ep6_tp2_pp1
	layer_4_expert_out_sp2_ep6_tp2_pp1 [label="Expert Out L4 SP2 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep6_tp2_pp1 -> layer_4_expert_out_sp2_ep6_tp2_pp1
	layer_4_expert_sp2_ep6_tp3_pp1 [label="Expert L4 SP2 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep6_pp1 -> layer_4_expert_sp2_ep6_tp3_pp1
	layer_4_expert_out_sp2_ep6_tp3_pp1 [label="Expert Out L4 SP2 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep6_tp3_pp1 -> layer_4_expert_out_sp2_ep6_tp3_pp1
	layer_4_expert_ar_sp2_ep6_pp1 [label="Expert All-Reduce L4 SP2 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep6_tp0_pp1 -> layer_4_expert_ar_sp2_ep6_pp1
	layer_4_expert_out_sp2_ep6_tp1_pp1 -> layer_4_expert_ar_sp2_ep6_pp1
	layer_4_expert_out_sp2_ep6_tp2_pp1 -> layer_4_expert_ar_sp2_ep6_pp1
	layer_4_expert_out_sp2_ep6_tp3_pp1 -> layer_4_expert_ar_sp2_ep6_pp1
	layer_4_combine_sp2_ep6_pp1 [label="Token Combine L4 SP2 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep6_pp1 -> layer_4_combine_sp2_ep6_pp1
	layer_4_dispatch_sp2_ep7_pp1 [label="Token Dispatch L4 SP2 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep7_pp1 [style=dashed]
	layer_4_expert_sp2_ep7_tp0_pp1 [label="Expert L4 SP2 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep7_pp1 -> layer_4_expert_sp2_ep7_tp0_pp1
	layer_4_expert_out_sp2_ep7_tp0_pp1 [label="Expert Out L4 SP2 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep7_tp0_pp1 -> layer_4_expert_out_sp2_ep7_tp0_pp1
	layer_4_expert_sp2_ep7_tp1_pp1 [label="Expert L4 SP2 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep7_pp1 -> layer_4_expert_sp2_ep7_tp1_pp1
	layer_4_expert_out_sp2_ep7_tp1_pp1 [label="Expert Out L4 SP2 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep7_tp1_pp1 -> layer_4_expert_out_sp2_ep7_tp1_pp1
	layer_4_expert_sp2_ep7_tp2_pp1 [label="Expert L4 SP2 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep7_pp1 -> layer_4_expert_sp2_ep7_tp2_pp1
	layer_4_expert_out_sp2_ep7_tp2_pp1 [label="Expert Out L4 SP2 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep7_tp2_pp1 -> layer_4_expert_out_sp2_ep7_tp2_pp1
	layer_4_expert_sp2_ep7_tp3_pp1 [label="Expert L4 SP2 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep7_pp1 -> layer_4_expert_sp2_ep7_tp3_pp1
	layer_4_expert_out_sp2_ep7_tp3_pp1 [label="Expert Out L4 SP2 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep7_tp3_pp1 -> layer_4_expert_out_sp2_ep7_tp3_pp1
	layer_4_expert_ar_sp2_ep7_pp1 [label="Expert All-Reduce L4 SP2 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep7_tp0_pp1 -> layer_4_expert_ar_sp2_ep7_pp1
	layer_4_expert_out_sp2_ep7_tp1_pp1 -> layer_4_expert_ar_sp2_ep7_pp1
	layer_4_expert_out_sp2_ep7_tp2_pp1 -> layer_4_expert_ar_sp2_ep7_pp1
	layer_4_expert_out_sp2_ep7_tp3_pp1 -> layer_4_expert_ar_sp2_ep7_pp1
	layer_4_combine_sp2_ep7_pp1 [label="Token Combine L4 SP2 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep7_pp1 -> layer_4_combine_sp2_ep7_pp1
	layer_4_dispatch_sp2_ep8_pp1 [label="Token Dispatch L4 SP2 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep8_pp1 [style=dashed]
	layer_4_expert_sp2_ep8_tp0_pp1 [label="Expert L4 SP2 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep8_pp1 -> layer_4_expert_sp2_ep8_tp0_pp1
	layer_4_expert_out_sp2_ep8_tp0_pp1 [label="Expert Out L4 SP2 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep8_tp0_pp1 -> layer_4_expert_out_sp2_ep8_tp0_pp1
	layer_4_expert_sp2_ep8_tp1_pp1 [label="Expert L4 SP2 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep8_pp1 -> layer_4_expert_sp2_ep8_tp1_pp1
	layer_4_expert_out_sp2_ep8_tp1_pp1 [label="Expert Out L4 SP2 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep8_tp1_pp1 -> layer_4_expert_out_sp2_ep8_tp1_pp1
	layer_4_expert_sp2_ep8_tp2_pp1 [label="Expert L4 SP2 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep8_pp1 -> layer_4_expert_sp2_ep8_tp2_pp1
	layer_4_expert_out_sp2_ep8_tp2_pp1 [label="Expert Out L4 SP2 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep8_tp2_pp1 -> layer_4_expert_out_sp2_ep8_tp2_pp1
	layer_4_expert_sp2_ep8_tp3_pp1 [label="Expert L4 SP2 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep8_pp1 -> layer_4_expert_sp2_ep8_tp3_pp1
	layer_4_expert_out_sp2_ep8_tp3_pp1 [label="Expert Out L4 SP2 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep8_tp3_pp1 -> layer_4_expert_out_sp2_ep8_tp3_pp1
	layer_4_expert_ar_sp2_ep8_pp1 [label="Expert All-Reduce L4 SP2 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep8_tp0_pp1 -> layer_4_expert_ar_sp2_ep8_pp1
	layer_4_expert_out_sp2_ep8_tp1_pp1 -> layer_4_expert_ar_sp2_ep8_pp1
	layer_4_expert_out_sp2_ep8_tp2_pp1 -> layer_4_expert_ar_sp2_ep8_pp1
	layer_4_expert_out_sp2_ep8_tp3_pp1 -> layer_4_expert_ar_sp2_ep8_pp1
	layer_4_combine_sp2_ep8_pp1 [label="Token Combine L4 SP2 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep8_pp1 -> layer_4_combine_sp2_ep8_pp1
	layer_4_dispatch_sp2_ep9_pp1 [label="Token Dispatch L4 SP2 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep9_pp1 [style=dashed]
	layer_4_expert_sp2_ep9_tp0_pp1 [label="Expert L4 SP2 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep9_pp1 -> layer_4_expert_sp2_ep9_tp0_pp1
	layer_4_expert_out_sp2_ep9_tp0_pp1 [label="Expert Out L4 SP2 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep9_tp0_pp1 -> layer_4_expert_out_sp2_ep9_tp0_pp1
	layer_4_expert_sp2_ep9_tp1_pp1 [label="Expert L4 SP2 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep9_pp1 -> layer_4_expert_sp2_ep9_tp1_pp1
	layer_4_expert_out_sp2_ep9_tp1_pp1 [label="Expert Out L4 SP2 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep9_tp1_pp1 -> layer_4_expert_out_sp2_ep9_tp1_pp1
	layer_4_expert_sp2_ep9_tp2_pp1 [label="Expert L4 SP2 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep9_pp1 -> layer_4_expert_sp2_ep9_tp2_pp1
	layer_4_expert_out_sp2_ep9_tp2_pp1 [label="Expert Out L4 SP2 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep9_tp2_pp1 -> layer_4_expert_out_sp2_ep9_tp2_pp1
	layer_4_expert_sp2_ep9_tp3_pp1 [label="Expert L4 SP2 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep9_pp1 -> layer_4_expert_sp2_ep9_tp3_pp1
	layer_4_expert_out_sp2_ep9_tp3_pp1 [label="Expert Out L4 SP2 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep9_tp3_pp1 -> layer_4_expert_out_sp2_ep9_tp3_pp1
	layer_4_expert_ar_sp2_ep9_pp1 [label="Expert All-Reduce L4 SP2 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep9_tp0_pp1 -> layer_4_expert_ar_sp2_ep9_pp1
	layer_4_expert_out_sp2_ep9_tp1_pp1 -> layer_4_expert_ar_sp2_ep9_pp1
	layer_4_expert_out_sp2_ep9_tp2_pp1 -> layer_4_expert_ar_sp2_ep9_pp1
	layer_4_expert_out_sp2_ep9_tp3_pp1 -> layer_4_expert_ar_sp2_ep9_pp1
	layer_4_combine_sp2_ep9_pp1 [label="Token Combine L4 SP2 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep9_pp1 -> layer_4_combine_sp2_ep9_pp1
	layer_4_dispatch_sp2_ep10_pp1 [label="Token Dispatch L4 SP2 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep10_pp1 [style=dashed]
	layer_4_expert_sp2_ep10_tp0_pp1 [label="Expert L4 SP2 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep10_pp1 -> layer_4_expert_sp2_ep10_tp0_pp1
	layer_4_expert_out_sp2_ep10_tp0_pp1 [label="Expert Out L4 SP2 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep10_tp0_pp1 -> layer_4_expert_out_sp2_ep10_tp0_pp1
	layer_4_expert_sp2_ep10_tp1_pp1 [label="Expert L4 SP2 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep10_pp1 -> layer_4_expert_sp2_ep10_tp1_pp1
	layer_4_expert_out_sp2_ep10_tp1_pp1 [label="Expert Out L4 SP2 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep10_tp1_pp1 -> layer_4_expert_out_sp2_ep10_tp1_pp1
	layer_4_expert_sp2_ep10_tp2_pp1 [label="Expert L4 SP2 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep10_pp1 -> layer_4_expert_sp2_ep10_tp2_pp1
	layer_4_expert_out_sp2_ep10_tp2_pp1 [label="Expert Out L4 SP2 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep10_tp2_pp1 -> layer_4_expert_out_sp2_ep10_tp2_pp1
	layer_4_expert_sp2_ep10_tp3_pp1 [label="Expert L4 SP2 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep10_pp1 -> layer_4_expert_sp2_ep10_tp3_pp1
	layer_4_expert_out_sp2_ep10_tp3_pp1 [label="Expert Out L4 SP2 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep10_tp3_pp1 -> layer_4_expert_out_sp2_ep10_tp3_pp1
	layer_4_expert_ar_sp2_ep10_pp1 [label="Expert All-Reduce L4 SP2 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep10_tp0_pp1 -> layer_4_expert_ar_sp2_ep10_pp1
	layer_4_expert_out_sp2_ep10_tp1_pp1 -> layer_4_expert_ar_sp2_ep10_pp1
	layer_4_expert_out_sp2_ep10_tp2_pp1 -> layer_4_expert_ar_sp2_ep10_pp1
	layer_4_expert_out_sp2_ep10_tp3_pp1 -> layer_4_expert_ar_sp2_ep10_pp1
	layer_4_combine_sp2_ep10_pp1 [label="Token Combine L4 SP2 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep10_pp1 -> layer_4_combine_sp2_ep10_pp1
	layer_4_dispatch_sp2_ep11_pp1 [label="Token Dispatch L4 SP2 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep11_pp1 [style=dashed]
	layer_4_expert_sp2_ep11_tp0_pp1 [label="Expert L4 SP2 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep11_pp1 -> layer_4_expert_sp2_ep11_tp0_pp1
	layer_4_expert_out_sp2_ep11_tp0_pp1 [label="Expert Out L4 SP2 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep11_tp0_pp1 -> layer_4_expert_out_sp2_ep11_tp0_pp1
	layer_4_expert_sp2_ep11_tp1_pp1 [label="Expert L4 SP2 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep11_pp1 -> layer_4_expert_sp2_ep11_tp1_pp1
	layer_4_expert_out_sp2_ep11_tp1_pp1 [label="Expert Out L4 SP2 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep11_tp1_pp1 -> layer_4_expert_out_sp2_ep11_tp1_pp1
	layer_4_expert_sp2_ep11_tp2_pp1 [label="Expert L4 SP2 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep11_pp1 -> layer_4_expert_sp2_ep11_tp2_pp1
	layer_4_expert_out_sp2_ep11_tp2_pp1 [label="Expert Out L4 SP2 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep11_tp2_pp1 -> layer_4_expert_out_sp2_ep11_tp2_pp1
	layer_4_expert_sp2_ep11_tp3_pp1 [label="Expert L4 SP2 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep11_pp1 -> layer_4_expert_sp2_ep11_tp3_pp1
	layer_4_expert_out_sp2_ep11_tp3_pp1 [label="Expert Out L4 SP2 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep11_tp3_pp1 -> layer_4_expert_out_sp2_ep11_tp3_pp1
	layer_4_expert_ar_sp2_ep11_pp1 [label="Expert All-Reduce L4 SP2 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep11_tp0_pp1 -> layer_4_expert_ar_sp2_ep11_pp1
	layer_4_expert_out_sp2_ep11_tp1_pp1 -> layer_4_expert_ar_sp2_ep11_pp1
	layer_4_expert_out_sp2_ep11_tp2_pp1 -> layer_4_expert_ar_sp2_ep11_pp1
	layer_4_expert_out_sp2_ep11_tp3_pp1 -> layer_4_expert_ar_sp2_ep11_pp1
	layer_4_combine_sp2_ep11_pp1 [label="Token Combine L4 SP2 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep11_pp1 -> layer_4_combine_sp2_ep11_pp1
	layer_4_dispatch_sp2_ep12_pp1 [label="Token Dispatch L4 SP2 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep12_pp1 [style=dashed]
	layer_4_expert_sp2_ep12_tp0_pp1 [label="Expert L4 SP2 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep12_pp1 -> layer_4_expert_sp2_ep12_tp0_pp1
	layer_4_expert_out_sp2_ep12_tp0_pp1 [label="Expert Out L4 SP2 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep12_tp0_pp1 -> layer_4_expert_out_sp2_ep12_tp0_pp1
	layer_4_expert_sp2_ep12_tp1_pp1 [label="Expert L4 SP2 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep12_pp1 -> layer_4_expert_sp2_ep12_tp1_pp1
	layer_4_expert_out_sp2_ep12_tp1_pp1 [label="Expert Out L4 SP2 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep12_tp1_pp1 -> layer_4_expert_out_sp2_ep12_tp1_pp1
	layer_4_expert_sp2_ep12_tp2_pp1 [label="Expert L4 SP2 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep12_pp1 -> layer_4_expert_sp2_ep12_tp2_pp1
	layer_4_expert_out_sp2_ep12_tp2_pp1 [label="Expert Out L4 SP2 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep12_tp2_pp1 -> layer_4_expert_out_sp2_ep12_tp2_pp1
	layer_4_expert_sp2_ep12_tp3_pp1 [label="Expert L4 SP2 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep12_pp1 -> layer_4_expert_sp2_ep12_tp3_pp1
	layer_4_expert_out_sp2_ep12_tp3_pp1 [label="Expert Out L4 SP2 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep12_tp3_pp1 -> layer_4_expert_out_sp2_ep12_tp3_pp1
	layer_4_expert_ar_sp2_ep12_pp1 [label="Expert All-Reduce L4 SP2 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep12_tp0_pp1 -> layer_4_expert_ar_sp2_ep12_pp1
	layer_4_expert_out_sp2_ep12_tp1_pp1 -> layer_4_expert_ar_sp2_ep12_pp1
	layer_4_expert_out_sp2_ep12_tp2_pp1 -> layer_4_expert_ar_sp2_ep12_pp1
	layer_4_expert_out_sp2_ep12_tp3_pp1 -> layer_4_expert_ar_sp2_ep12_pp1
	layer_4_combine_sp2_ep12_pp1 [label="Token Combine L4 SP2 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep12_pp1 -> layer_4_combine_sp2_ep12_pp1
	layer_4_dispatch_sp2_ep13_pp1 [label="Token Dispatch L4 SP2 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep13_pp1 [style=dashed]
	layer_4_expert_sp2_ep13_tp0_pp1 [label="Expert L4 SP2 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep13_pp1 -> layer_4_expert_sp2_ep13_tp0_pp1
	layer_4_expert_out_sp2_ep13_tp0_pp1 [label="Expert Out L4 SP2 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep13_tp0_pp1 -> layer_4_expert_out_sp2_ep13_tp0_pp1
	layer_4_expert_sp2_ep13_tp1_pp1 [label="Expert L4 SP2 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep13_pp1 -> layer_4_expert_sp2_ep13_tp1_pp1
	layer_4_expert_out_sp2_ep13_tp1_pp1 [label="Expert Out L4 SP2 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep13_tp1_pp1 -> layer_4_expert_out_sp2_ep13_tp1_pp1
	layer_4_expert_sp2_ep13_tp2_pp1 [label="Expert L4 SP2 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep13_pp1 -> layer_4_expert_sp2_ep13_tp2_pp1
	layer_4_expert_out_sp2_ep13_tp2_pp1 [label="Expert Out L4 SP2 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep13_tp2_pp1 -> layer_4_expert_out_sp2_ep13_tp2_pp1
	layer_4_expert_sp2_ep13_tp3_pp1 [label="Expert L4 SP2 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep13_pp1 -> layer_4_expert_sp2_ep13_tp3_pp1
	layer_4_expert_out_sp2_ep13_tp3_pp1 [label="Expert Out L4 SP2 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep13_tp3_pp1 -> layer_4_expert_out_sp2_ep13_tp3_pp1
	layer_4_expert_ar_sp2_ep13_pp1 [label="Expert All-Reduce L4 SP2 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep13_tp0_pp1 -> layer_4_expert_ar_sp2_ep13_pp1
	layer_4_expert_out_sp2_ep13_tp1_pp1 -> layer_4_expert_ar_sp2_ep13_pp1
	layer_4_expert_out_sp2_ep13_tp2_pp1 -> layer_4_expert_ar_sp2_ep13_pp1
	layer_4_expert_out_sp2_ep13_tp3_pp1 -> layer_4_expert_ar_sp2_ep13_pp1
	layer_4_combine_sp2_ep13_pp1 [label="Token Combine L4 SP2 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep13_pp1 -> layer_4_combine_sp2_ep13_pp1
	layer_4_dispatch_sp2_ep14_pp1 [label="Token Dispatch L4 SP2 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep14_pp1 [style=dashed]
	layer_4_expert_sp2_ep14_tp0_pp1 [label="Expert L4 SP2 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep14_pp1 -> layer_4_expert_sp2_ep14_tp0_pp1
	layer_4_expert_out_sp2_ep14_tp0_pp1 [label="Expert Out L4 SP2 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep14_tp0_pp1 -> layer_4_expert_out_sp2_ep14_tp0_pp1
	layer_4_expert_sp2_ep14_tp1_pp1 [label="Expert L4 SP2 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep14_pp1 -> layer_4_expert_sp2_ep14_tp1_pp1
	layer_4_expert_out_sp2_ep14_tp1_pp1 [label="Expert Out L4 SP2 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep14_tp1_pp1 -> layer_4_expert_out_sp2_ep14_tp1_pp1
	layer_4_expert_sp2_ep14_tp2_pp1 [label="Expert L4 SP2 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep14_pp1 -> layer_4_expert_sp2_ep14_tp2_pp1
	layer_4_expert_out_sp2_ep14_tp2_pp1 [label="Expert Out L4 SP2 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep14_tp2_pp1 -> layer_4_expert_out_sp2_ep14_tp2_pp1
	layer_4_expert_sp2_ep14_tp3_pp1 [label="Expert L4 SP2 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep14_pp1 -> layer_4_expert_sp2_ep14_tp3_pp1
	layer_4_expert_out_sp2_ep14_tp3_pp1 [label="Expert Out L4 SP2 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep14_tp3_pp1 -> layer_4_expert_out_sp2_ep14_tp3_pp1
	layer_4_expert_ar_sp2_ep14_pp1 [label="Expert All-Reduce L4 SP2 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep14_tp0_pp1 -> layer_4_expert_ar_sp2_ep14_pp1
	layer_4_expert_out_sp2_ep14_tp1_pp1 -> layer_4_expert_ar_sp2_ep14_pp1
	layer_4_expert_out_sp2_ep14_tp2_pp1 -> layer_4_expert_ar_sp2_ep14_pp1
	layer_4_expert_out_sp2_ep14_tp3_pp1 -> layer_4_expert_ar_sp2_ep14_pp1
	layer_4_combine_sp2_ep14_pp1 [label="Token Combine L4 SP2 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep14_pp1 -> layer_4_combine_sp2_ep14_pp1
	layer_4_dispatch_sp2_ep15_pp1 [label="Token Dispatch L4 SP2 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp2_pp1 -> layer_4_dispatch_sp2_ep15_pp1 [style=dashed]
	layer_4_expert_sp2_ep15_tp0_pp1 [label="Expert L4 SP2 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep15_pp1 -> layer_4_expert_sp2_ep15_tp0_pp1
	layer_4_expert_out_sp2_ep15_tp0_pp1 [label="Expert Out L4 SP2 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep15_tp0_pp1 -> layer_4_expert_out_sp2_ep15_tp0_pp1
	layer_4_expert_sp2_ep15_tp1_pp1 [label="Expert L4 SP2 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep15_pp1 -> layer_4_expert_sp2_ep15_tp1_pp1
	layer_4_expert_out_sp2_ep15_tp1_pp1 [label="Expert Out L4 SP2 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep15_tp1_pp1 -> layer_4_expert_out_sp2_ep15_tp1_pp1
	layer_4_expert_sp2_ep15_tp2_pp1 [label="Expert L4 SP2 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep15_pp1 -> layer_4_expert_sp2_ep15_tp2_pp1
	layer_4_expert_out_sp2_ep15_tp2_pp1 [label="Expert Out L4 SP2 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep15_tp2_pp1 -> layer_4_expert_out_sp2_ep15_tp2_pp1
	layer_4_expert_sp2_ep15_tp3_pp1 [label="Expert L4 SP2 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp2_ep15_pp1 -> layer_4_expert_sp2_ep15_tp3_pp1
	layer_4_expert_out_sp2_ep15_tp3_pp1 [label="Expert Out L4 SP2 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp2_ep15_tp3_pp1 -> layer_4_expert_out_sp2_ep15_tp3_pp1
	layer_4_expert_ar_sp2_ep15_pp1 [label="Expert All-Reduce L4 SP2 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp2_ep15_tp0_pp1 -> layer_4_expert_ar_sp2_ep15_pp1
	layer_4_expert_out_sp2_ep15_tp1_pp1 -> layer_4_expert_ar_sp2_ep15_pp1
	layer_4_expert_out_sp2_ep15_tp2_pp1 -> layer_4_expert_ar_sp2_ep15_pp1
	layer_4_expert_out_sp2_ep15_tp3_pp1 -> layer_4_expert_ar_sp2_ep15_pp1
	layer_4_combine_sp2_ep15_pp1 [label="Token Combine L4 SP2 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp2_ep15_pp1 -> layer_4_combine_sp2_ep15_pp1
	layer_4_moe_all2all_sp2_pp1 [label="MoE All-to-All L4 SP2\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_4_combine_sp2_ep0_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep1_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep2_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep3_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep4_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep5_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep6_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep7_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep8_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep9_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep10_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep11_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep12_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep13_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep14_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_combine_sp2_ep15_pp1 -> layer_4_moe_all2all_sp2_pp1
	layer_4_mlp_out_sp2_pp1 [label="MoE Output L4 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_moe_all2all_sp2_pp1 -> layer_4_mlp_out_sp2_pp1
	layer_4_mlp_res_sp2_pp1 [label="MLP Residual L4 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_mlp_out_sp2_pp1 -> layer_4_mlp_res_sp2_pp1
	layer_4_attn_res_sp2_pp1 -> layer_4_mlp_res_sp2_pp1 [style=dashed]
	layer_4_norm_sp3_pp1 [label="LayerNorm L4 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_3_mlp_out_sp0_pp0 -> layer_4_norm_sp3_pp1 [style=dashed]
	layer_3_mlp_out_sp1_pp0 -> layer_4_norm_sp3_pp1 [style=dashed]
	layer_3_mlp_out_sp2_pp0 -> layer_4_norm_sp3_pp1 [style=dashed]
	layer_3_mlp_out_sp3_pp0 -> layer_4_norm_sp3_pp1 [style=dashed]
	layer_4_qkv_sp3_tp0_pp1 [label="QKV Proj L4 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp3_pp1 -> layer_4_qkv_sp3_tp0_pp1
	layer_4_attn_sp3_tp0_pp1 [label="Attention L4 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp3_tp0_pp1 -> layer_4_attn_sp3_tp0_pp1
	layer_4_attn_out_sp3_tp0_pp1 [label="Attn Out Proj L4 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp3_tp0_pp1 -> layer_4_attn_out_sp3_tp0_pp1
	layer_4_qkv_sp3_tp1_pp1 [label="QKV Proj L4 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp3_pp1 -> layer_4_qkv_sp3_tp1_pp1
	layer_4_attn_sp3_tp1_pp1 [label="Attention L4 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp3_tp1_pp1 -> layer_4_attn_sp3_tp1_pp1
	layer_4_attn_out_sp3_tp1_pp1 [label="Attn Out Proj L4 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp3_tp1_pp1 -> layer_4_attn_out_sp3_tp1_pp1
	layer_4_qkv_sp3_tp2_pp1 [label="QKV Proj L4 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp3_pp1 -> layer_4_qkv_sp3_tp2_pp1
	layer_4_attn_sp3_tp2_pp1 [label="Attention L4 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp3_tp2_pp1 -> layer_4_attn_sp3_tp2_pp1
	layer_4_attn_out_sp3_tp2_pp1 [label="Attn Out Proj L4 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp3_tp2_pp1 -> layer_4_attn_out_sp3_tp2_pp1
	layer_4_qkv_sp3_tp3_pp1 [label="QKV Proj L4 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_norm_sp3_pp1 -> layer_4_qkv_sp3_tp3_pp1
	layer_4_attn_sp3_tp3_pp1 [label="Attention L4 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_qkv_sp3_tp3_pp1 -> layer_4_attn_sp3_tp3_pp1
	layer_4_attn_out_sp3_tp3_pp1 [label="Attn Out Proj L4 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_4_attn_sp3_tp3_pp1 -> layer_4_attn_out_sp3_tp3_pp1
	layer_4_attn_ar_sp3_pp1 [label="Attention All-Reduce L4 SP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_attn_out_sp3_tp0_pp1 -> layer_4_attn_ar_sp3_pp1
	layer_4_attn_out_sp3_tp1_pp1 -> layer_4_attn_ar_sp3_pp1
	layer_4_attn_out_sp3_tp2_pp1 -> layer_4_attn_ar_sp3_pp1
	layer_4_attn_out_sp3_tp3_pp1 -> layer_4_attn_ar_sp3_pp1
	layer_4_attn_res_sp3_pp1 [label="Attention Residual L4 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_attn_ar_sp3_pp1 -> layer_4_attn_res_sp3_pp1
	layer_4_norm_sp3_pp1 -> layer_4_attn_res_sp3_pp1 [style=dashed]
	layer_4_post_norm_sp3_pp1 [label="Post-Attn Norm L4 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_attn_res_sp3_pp1 -> layer_4_post_norm_sp3_pp1
	layer_4_router_sp3_pp1 [label="MoE Router L4 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_4_post_norm_sp3_pp1 -> layer_4_router_sp3_pp1
	layer_4_dispatch_sp3_ep0_pp1 [label="Token Dispatch L4 SP3 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep0_pp1 [style=dashed]
	layer_4_expert_sp3_ep0_tp0_pp1 [label="Expert L4 SP3 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep0_pp1 -> layer_4_expert_sp3_ep0_tp0_pp1
	layer_4_expert_out_sp3_ep0_tp0_pp1 [label="Expert Out L4 SP3 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep0_tp0_pp1 -> layer_4_expert_out_sp3_ep0_tp0_pp1
	layer_4_expert_sp3_ep0_tp1_pp1 [label="Expert L4 SP3 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep0_pp1 -> layer_4_expert_sp3_ep0_tp1_pp1
	layer_4_expert_out_sp3_ep0_tp1_pp1 [label="Expert Out L4 SP3 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep0_tp1_pp1 -> layer_4_expert_out_sp3_ep0_tp1_pp1
	layer_4_expert_sp3_ep0_tp2_pp1 [label="Expert L4 SP3 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep0_pp1 -> layer_4_expert_sp3_ep0_tp2_pp1
	layer_4_expert_out_sp3_ep0_tp2_pp1 [label="Expert Out L4 SP3 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep0_tp2_pp1 -> layer_4_expert_out_sp3_ep0_tp2_pp1
	layer_4_expert_sp3_ep0_tp3_pp1 [label="Expert L4 SP3 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep0_pp1 -> layer_4_expert_sp3_ep0_tp3_pp1
	layer_4_expert_out_sp3_ep0_tp3_pp1 [label="Expert Out L4 SP3 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep0_tp3_pp1 -> layer_4_expert_out_sp3_ep0_tp3_pp1
	layer_4_expert_ar_sp3_ep0_pp1 [label="Expert All-Reduce L4 SP3 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep0_tp0_pp1 -> layer_4_expert_ar_sp3_ep0_pp1
	layer_4_expert_out_sp3_ep0_tp1_pp1 -> layer_4_expert_ar_sp3_ep0_pp1
	layer_4_expert_out_sp3_ep0_tp2_pp1 -> layer_4_expert_ar_sp3_ep0_pp1
	layer_4_expert_out_sp3_ep0_tp3_pp1 -> layer_4_expert_ar_sp3_ep0_pp1
	layer_4_combine_sp3_ep0_pp1 [label="Token Combine L4 SP3 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep0_pp1 -> layer_4_combine_sp3_ep0_pp1
	layer_4_dispatch_sp3_ep1_pp1 [label="Token Dispatch L4 SP3 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep1_pp1 [style=dashed]
	layer_4_expert_sp3_ep1_tp0_pp1 [label="Expert L4 SP3 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep1_pp1 -> layer_4_expert_sp3_ep1_tp0_pp1
	layer_4_expert_out_sp3_ep1_tp0_pp1 [label="Expert Out L4 SP3 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep1_tp0_pp1 -> layer_4_expert_out_sp3_ep1_tp0_pp1
	layer_4_expert_sp3_ep1_tp1_pp1 [label="Expert L4 SP3 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep1_pp1 -> layer_4_expert_sp3_ep1_tp1_pp1
	layer_4_expert_out_sp3_ep1_tp1_pp1 [label="Expert Out L4 SP3 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep1_tp1_pp1 -> layer_4_expert_out_sp3_ep1_tp1_pp1
	layer_4_expert_sp3_ep1_tp2_pp1 [label="Expert L4 SP3 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep1_pp1 -> layer_4_expert_sp3_ep1_tp2_pp1
	layer_4_expert_out_sp3_ep1_tp2_pp1 [label="Expert Out L4 SP3 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep1_tp2_pp1 -> layer_4_expert_out_sp3_ep1_tp2_pp1
	layer_4_expert_sp3_ep1_tp3_pp1 [label="Expert L4 SP3 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep1_pp1 -> layer_4_expert_sp3_ep1_tp3_pp1
	layer_4_expert_out_sp3_ep1_tp3_pp1 [label="Expert Out L4 SP3 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep1_tp3_pp1 -> layer_4_expert_out_sp3_ep1_tp3_pp1
	layer_4_expert_ar_sp3_ep1_pp1 [label="Expert All-Reduce L4 SP3 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep1_tp0_pp1 -> layer_4_expert_ar_sp3_ep1_pp1
	layer_4_expert_out_sp3_ep1_tp1_pp1 -> layer_4_expert_ar_sp3_ep1_pp1
	layer_4_expert_out_sp3_ep1_tp2_pp1 -> layer_4_expert_ar_sp3_ep1_pp1
	layer_4_expert_out_sp3_ep1_tp3_pp1 -> layer_4_expert_ar_sp3_ep1_pp1
	layer_4_combine_sp3_ep1_pp1 [label="Token Combine L4 SP3 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep1_pp1 -> layer_4_combine_sp3_ep1_pp1
	layer_4_dispatch_sp3_ep2_pp1 [label="Token Dispatch L4 SP3 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep2_pp1 [style=dashed]
	layer_4_expert_sp3_ep2_tp0_pp1 [label="Expert L4 SP3 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep2_pp1 -> layer_4_expert_sp3_ep2_tp0_pp1
	layer_4_expert_out_sp3_ep2_tp0_pp1 [label="Expert Out L4 SP3 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep2_tp0_pp1 -> layer_4_expert_out_sp3_ep2_tp0_pp1
	layer_4_expert_sp3_ep2_tp1_pp1 [label="Expert L4 SP3 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep2_pp1 -> layer_4_expert_sp3_ep2_tp1_pp1
	layer_4_expert_out_sp3_ep2_tp1_pp1 [label="Expert Out L4 SP3 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep2_tp1_pp1 -> layer_4_expert_out_sp3_ep2_tp1_pp1
	layer_4_expert_sp3_ep2_tp2_pp1 [label="Expert L4 SP3 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep2_pp1 -> layer_4_expert_sp3_ep2_tp2_pp1
	layer_4_expert_out_sp3_ep2_tp2_pp1 [label="Expert Out L4 SP3 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep2_tp2_pp1 -> layer_4_expert_out_sp3_ep2_tp2_pp1
	layer_4_expert_sp3_ep2_tp3_pp1 [label="Expert L4 SP3 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep2_pp1 -> layer_4_expert_sp3_ep2_tp3_pp1
	layer_4_expert_out_sp3_ep2_tp3_pp1 [label="Expert Out L4 SP3 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep2_tp3_pp1 -> layer_4_expert_out_sp3_ep2_tp3_pp1
	layer_4_expert_ar_sp3_ep2_pp1 [label="Expert All-Reduce L4 SP3 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep2_tp0_pp1 -> layer_4_expert_ar_sp3_ep2_pp1
	layer_4_expert_out_sp3_ep2_tp1_pp1 -> layer_4_expert_ar_sp3_ep2_pp1
	layer_4_expert_out_sp3_ep2_tp2_pp1 -> layer_4_expert_ar_sp3_ep2_pp1
	layer_4_expert_out_sp3_ep2_tp3_pp1 -> layer_4_expert_ar_sp3_ep2_pp1
	layer_4_combine_sp3_ep2_pp1 [label="Token Combine L4 SP3 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep2_pp1 -> layer_4_combine_sp3_ep2_pp1
	layer_4_dispatch_sp3_ep3_pp1 [label="Token Dispatch L4 SP3 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep3_pp1 [style=dashed]
	layer_4_expert_sp3_ep3_tp0_pp1 [label="Expert L4 SP3 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep3_pp1 -> layer_4_expert_sp3_ep3_tp0_pp1
	layer_4_expert_out_sp3_ep3_tp0_pp1 [label="Expert Out L4 SP3 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep3_tp0_pp1 -> layer_4_expert_out_sp3_ep3_tp0_pp1
	layer_4_expert_sp3_ep3_tp1_pp1 [label="Expert L4 SP3 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep3_pp1 -> layer_4_expert_sp3_ep3_tp1_pp1
	layer_4_expert_out_sp3_ep3_tp1_pp1 [label="Expert Out L4 SP3 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep3_tp1_pp1 -> layer_4_expert_out_sp3_ep3_tp1_pp1
	layer_4_expert_sp3_ep3_tp2_pp1 [label="Expert L4 SP3 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep3_pp1 -> layer_4_expert_sp3_ep3_tp2_pp1
	layer_4_expert_out_sp3_ep3_tp2_pp1 [label="Expert Out L4 SP3 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep3_tp2_pp1 -> layer_4_expert_out_sp3_ep3_tp2_pp1
	layer_4_expert_sp3_ep3_tp3_pp1 [label="Expert L4 SP3 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep3_pp1 -> layer_4_expert_sp3_ep3_tp3_pp1
	layer_4_expert_out_sp3_ep3_tp3_pp1 [label="Expert Out L4 SP3 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep3_tp3_pp1 -> layer_4_expert_out_sp3_ep3_tp3_pp1
	layer_4_expert_ar_sp3_ep3_pp1 [label="Expert All-Reduce L4 SP3 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep3_tp0_pp1 -> layer_4_expert_ar_sp3_ep3_pp1
	layer_4_expert_out_sp3_ep3_tp1_pp1 -> layer_4_expert_ar_sp3_ep3_pp1
	layer_4_expert_out_sp3_ep3_tp2_pp1 -> layer_4_expert_ar_sp3_ep3_pp1
	layer_4_expert_out_sp3_ep3_tp3_pp1 -> layer_4_expert_ar_sp3_ep3_pp1
	layer_4_combine_sp3_ep3_pp1 [label="Token Combine L4 SP3 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep3_pp1 -> layer_4_combine_sp3_ep3_pp1
	layer_4_dispatch_sp3_ep4_pp1 [label="Token Dispatch L4 SP3 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep4_pp1 [style=dashed]
	layer_4_expert_sp3_ep4_tp0_pp1 [label="Expert L4 SP3 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep4_pp1 -> layer_4_expert_sp3_ep4_tp0_pp1
	layer_4_expert_out_sp3_ep4_tp0_pp1 [label="Expert Out L4 SP3 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep4_tp0_pp1 -> layer_4_expert_out_sp3_ep4_tp0_pp1
	layer_4_expert_sp3_ep4_tp1_pp1 [label="Expert L4 SP3 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep4_pp1 -> layer_4_expert_sp3_ep4_tp1_pp1
	layer_4_expert_out_sp3_ep4_tp1_pp1 [label="Expert Out L4 SP3 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep4_tp1_pp1 -> layer_4_expert_out_sp3_ep4_tp1_pp1
	layer_4_expert_sp3_ep4_tp2_pp1 [label="Expert L4 SP3 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep4_pp1 -> layer_4_expert_sp3_ep4_tp2_pp1
	layer_4_expert_out_sp3_ep4_tp2_pp1 [label="Expert Out L4 SP3 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep4_tp2_pp1 -> layer_4_expert_out_sp3_ep4_tp2_pp1
	layer_4_expert_sp3_ep4_tp3_pp1 [label="Expert L4 SP3 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep4_pp1 -> layer_4_expert_sp3_ep4_tp3_pp1
	layer_4_expert_out_sp3_ep4_tp3_pp1 [label="Expert Out L4 SP3 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep4_tp3_pp1 -> layer_4_expert_out_sp3_ep4_tp3_pp1
	layer_4_expert_ar_sp3_ep4_pp1 [label="Expert All-Reduce L4 SP3 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep4_tp0_pp1 -> layer_4_expert_ar_sp3_ep4_pp1
	layer_4_expert_out_sp3_ep4_tp1_pp1 -> layer_4_expert_ar_sp3_ep4_pp1
	layer_4_expert_out_sp3_ep4_tp2_pp1 -> layer_4_expert_ar_sp3_ep4_pp1
	layer_4_expert_out_sp3_ep4_tp3_pp1 -> layer_4_expert_ar_sp3_ep4_pp1
	layer_4_combine_sp3_ep4_pp1 [label="Token Combine L4 SP3 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep4_pp1 -> layer_4_combine_sp3_ep4_pp1
	layer_4_dispatch_sp3_ep5_pp1 [label="Token Dispatch L4 SP3 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep5_pp1 [style=dashed]
	layer_4_expert_sp3_ep5_tp0_pp1 [label="Expert L4 SP3 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep5_pp1 -> layer_4_expert_sp3_ep5_tp0_pp1
	layer_4_expert_out_sp3_ep5_tp0_pp1 [label="Expert Out L4 SP3 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep5_tp0_pp1 -> layer_4_expert_out_sp3_ep5_tp0_pp1
	layer_4_expert_sp3_ep5_tp1_pp1 [label="Expert L4 SP3 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep5_pp1 -> layer_4_expert_sp3_ep5_tp1_pp1
	layer_4_expert_out_sp3_ep5_tp1_pp1 [label="Expert Out L4 SP3 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep5_tp1_pp1 -> layer_4_expert_out_sp3_ep5_tp1_pp1
	layer_4_expert_sp3_ep5_tp2_pp1 [label="Expert L4 SP3 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep5_pp1 -> layer_4_expert_sp3_ep5_tp2_pp1
	layer_4_expert_out_sp3_ep5_tp2_pp1 [label="Expert Out L4 SP3 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep5_tp2_pp1 -> layer_4_expert_out_sp3_ep5_tp2_pp1
	layer_4_expert_sp3_ep5_tp3_pp1 [label="Expert L4 SP3 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep5_pp1 -> layer_4_expert_sp3_ep5_tp3_pp1
	layer_4_expert_out_sp3_ep5_tp3_pp1 [label="Expert Out L4 SP3 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep5_tp3_pp1 -> layer_4_expert_out_sp3_ep5_tp3_pp1
	layer_4_expert_ar_sp3_ep5_pp1 [label="Expert All-Reduce L4 SP3 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep5_tp0_pp1 -> layer_4_expert_ar_sp3_ep5_pp1
	layer_4_expert_out_sp3_ep5_tp1_pp1 -> layer_4_expert_ar_sp3_ep5_pp1
	layer_4_expert_out_sp3_ep5_tp2_pp1 -> layer_4_expert_ar_sp3_ep5_pp1
	layer_4_expert_out_sp3_ep5_tp3_pp1 -> layer_4_expert_ar_sp3_ep5_pp1
	layer_4_combine_sp3_ep5_pp1 [label="Token Combine L4 SP3 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep5_pp1 -> layer_4_combine_sp3_ep5_pp1
	layer_4_dispatch_sp3_ep6_pp1 [label="Token Dispatch L4 SP3 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep6_pp1 [style=dashed]
	layer_4_expert_sp3_ep6_tp0_pp1 [label="Expert L4 SP3 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep6_pp1 -> layer_4_expert_sp3_ep6_tp0_pp1
	layer_4_expert_out_sp3_ep6_tp0_pp1 [label="Expert Out L4 SP3 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep6_tp0_pp1 -> layer_4_expert_out_sp3_ep6_tp0_pp1
	layer_4_expert_sp3_ep6_tp1_pp1 [label="Expert L4 SP3 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep6_pp1 -> layer_4_expert_sp3_ep6_tp1_pp1
	layer_4_expert_out_sp3_ep6_tp1_pp1 [label="Expert Out L4 SP3 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep6_tp1_pp1 -> layer_4_expert_out_sp3_ep6_tp1_pp1
	layer_4_expert_sp3_ep6_tp2_pp1 [label="Expert L4 SP3 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep6_pp1 -> layer_4_expert_sp3_ep6_tp2_pp1
	layer_4_expert_out_sp3_ep6_tp2_pp1 [label="Expert Out L4 SP3 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep6_tp2_pp1 -> layer_4_expert_out_sp3_ep6_tp2_pp1
	layer_4_expert_sp3_ep6_tp3_pp1 [label="Expert L4 SP3 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep6_pp1 -> layer_4_expert_sp3_ep6_tp3_pp1
	layer_4_expert_out_sp3_ep6_tp3_pp1 [label="Expert Out L4 SP3 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep6_tp3_pp1 -> layer_4_expert_out_sp3_ep6_tp3_pp1
	layer_4_expert_ar_sp3_ep6_pp1 [label="Expert All-Reduce L4 SP3 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep6_tp0_pp1 -> layer_4_expert_ar_sp3_ep6_pp1
	layer_4_expert_out_sp3_ep6_tp1_pp1 -> layer_4_expert_ar_sp3_ep6_pp1
	layer_4_expert_out_sp3_ep6_tp2_pp1 -> layer_4_expert_ar_sp3_ep6_pp1
	layer_4_expert_out_sp3_ep6_tp3_pp1 -> layer_4_expert_ar_sp3_ep6_pp1
	layer_4_combine_sp3_ep6_pp1 [label="Token Combine L4 SP3 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep6_pp1 -> layer_4_combine_sp3_ep6_pp1
	layer_4_dispatch_sp3_ep7_pp1 [label="Token Dispatch L4 SP3 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep7_pp1 [style=dashed]
	layer_4_expert_sp3_ep7_tp0_pp1 [label="Expert L4 SP3 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep7_pp1 -> layer_4_expert_sp3_ep7_tp0_pp1
	layer_4_expert_out_sp3_ep7_tp0_pp1 [label="Expert Out L4 SP3 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep7_tp0_pp1 -> layer_4_expert_out_sp3_ep7_tp0_pp1
	layer_4_expert_sp3_ep7_tp1_pp1 [label="Expert L4 SP3 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep7_pp1 -> layer_4_expert_sp3_ep7_tp1_pp1
	layer_4_expert_out_sp3_ep7_tp1_pp1 [label="Expert Out L4 SP3 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep7_tp1_pp1 -> layer_4_expert_out_sp3_ep7_tp1_pp1
	layer_4_expert_sp3_ep7_tp2_pp1 [label="Expert L4 SP3 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep7_pp1 -> layer_4_expert_sp3_ep7_tp2_pp1
	layer_4_expert_out_sp3_ep7_tp2_pp1 [label="Expert Out L4 SP3 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep7_tp2_pp1 -> layer_4_expert_out_sp3_ep7_tp2_pp1
	layer_4_expert_sp3_ep7_tp3_pp1 [label="Expert L4 SP3 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep7_pp1 -> layer_4_expert_sp3_ep7_tp3_pp1
	layer_4_expert_out_sp3_ep7_tp3_pp1 [label="Expert Out L4 SP3 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep7_tp3_pp1 -> layer_4_expert_out_sp3_ep7_tp3_pp1
	layer_4_expert_ar_sp3_ep7_pp1 [label="Expert All-Reduce L4 SP3 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep7_tp0_pp1 -> layer_4_expert_ar_sp3_ep7_pp1
	layer_4_expert_out_sp3_ep7_tp1_pp1 -> layer_4_expert_ar_sp3_ep7_pp1
	layer_4_expert_out_sp3_ep7_tp2_pp1 -> layer_4_expert_ar_sp3_ep7_pp1
	layer_4_expert_out_sp3_ep7_tp3_pp1 -> layer_4_expert_ar_sp3_ep7_pp1
	layer_4_combine_sp3_ep7_pp1 [label="Token Combine L4 SP3 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep7_pp1 -> layer_4_combine_sp3_ep7_pp1
	layer_4_dispatch_sp3_ep8_pp1 [label="Token Dispatch L4 SP3 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep8_pp1 [style=dashed]
	layer_4_expert_sp3_ep8_tp0_pp1 [label="Expert L4 SP3 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep8_pp1 -> layer_4_expert_sp3_ep8_tp0_pp1
	layer_4_expert_out_sp3_ep8_tp0_pp1 [label="Expert Out L4 SP3 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep8_tp0_pp1 -> layer_4_expert_out_sp3_ep8_tp0_pp1
	layer_4_expert_sp3_ep8_tp1_pp1 [label="Expert L4 SP3 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep8_pp1 -> layer_4_expert_sp3_ep8_tp1_pp1
	layer_4_expert_out_sp3_ep8_tp1_pp1 [label="Expert Out L4 SP3 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep8_tp1_pp1 -> layer_4_expert_out_sp3_ep8_tp1_pp1
	layer_4_expert_sp3_ep8_tp2_pp1 [label="Expert L4 SP3 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep8_pp1 -> layer_4_expert_sp3_ep8_tp2_pp1
	layer_4_expert_out_sp3_ep8_tp2_pp1 [label="Expert Out L4 SP3 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep8_tp2_pp1 -> layer_4_expert_out_sp3_ep8_tp2_pp1
	layer_4_expert_sp3_ep8_tp3_pp1 [label="Expert L4 SP3 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep8_pp1 -> layer_4_expert_sp3_ep8_tp3_pp1
	layer_4_expert_out_sp3_ep8_tp3_pp1 [label="Expert Out L4 SP3 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep8_tp3_pp1 -> layer_4_expert_out_sp3_ep8_tp3_pp1
	layer_4_expert_ar_sp3_ep8_pp1 [label="Expert All-Reduce L4 SP3 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep8_tp0_pp1 -> layer_4_expert_ar_sp3_ep8_pp1
	layer_4_expert_out_sp3_ep8_tp1_pp1 -> layer_4_expert_ar_sp3_ep8_pp1
	layer_4_expert_out_sp3_ep8_tp2_pp1 -> layer_4_expert_ar_sp3_ep8_pp1
	layer_4_expert_out_sp3_ep8_tp3_pp1 -> layer_4_expert_ar_sp3_ep8_pp1
	layer_4_combine_sp3_ep8_pp1 [label="Token Combine L4 SP3 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep8_pp1 -> layer_4_combine_sp3_ep8_pp1
	layer_4_dispatch_sp3_ep9_pp1 [label="Token Dispatch L4 SP3 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep9_pp1 [style=dashed]
	layer_4_expert_sp3_ep9_tp0_pp1 [label="Expert L4 SP3 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep9_pp1 -> layer_4_expert_sp3_ep9_tp0_pp1
	layer_4_expert_out_sp3_ep9_tp0_pp1 [label="Expert Out L4 SP3 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep9_tp0_pp1 -> layer_4_expert_out_sp3_ep9_tp0_pp1
	layer_4_expert_sp3_ep9_tp1_pp1 [label="Expert L4 SP3 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep9_pp1 -> layer_4_expert_sp3_ep9_tp1_pp1
	layer_4_expert_out_sp3_ep9_tp1_pp1 [label="Expert Out L4 SP3 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep9_tp1_pp1 -> layer_4_expert_out_sp3_ep9_tp1_pp1
	layer_4_expert_sp3_ep9_tp2_pp1 [label="Expert L4 SP3 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep9_pp1 -> layer_4_expert_sp3_ep9_tp2_pp1
	layer_4_expert_out_sp3_ep9_tp2_pp1 [label="Expert Out L4 SP3 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep9_tp2_pp1 -> layer_4_expert_out_sp3_ep9_tp2_pp1
	layer_4_expert_sp3_ep9_tp3_pp1 [label="Expert L4 SP3 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep9_pp1 -> layer_4_expert_sp3_ep9_tp3_pp1
	layer_4_expert_out_sp3_ep9_tp3_pp1 [label="Expert Out L4 SP3 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep9_tp3_pp1 -> layer_4_expert_out_sp3_ep9_tp3_pp1
	layer_4_expert_ar_sp3_ep9_pp1 [label="Expert All-Reduce L4 SP3 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep9_tp0_pp1 -> layer_4_expert_ar_sp3_ep9_pp1
	layer_4_expert_out_sp3_ep9_tp1_pp1 -> layer_4_expert_ar_sp3_ep9_pp1
	layer_4_expert_out_sp3_ep9_tp2_pp1 -> layer_4_expert_ar_sp3_ep9_pp1
	layer_4_expert_out_sp3_ep9_tp3_pp1 -> layer_4_expert_ar_sp3_ep9_pp1
	layer_4_combine_sp3_ep9_pp1 [label="Token Combine L4 SP3 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep9_pp1 -> layer_4_combine_sp3_ep9_pp1
	layer_4_dispatch_sp3_ep10_pp1 [label="Token Dispatch L4 SP3 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep10_pp1 [style=dashed]
	layer_4_expert_sp3_ep10_tp0_pp1 [label="Expert L4 SP3 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep10_pp1 -> layer_4_expert_sp3_ep10_tp0_pp1
	layer_4_expert_out_sp3_ep10_tp0_pp1 [label="Expert Out L4 SP3 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep10_tp0_pp1 -> layer_4_expert_out_sp3_ep10_tp0_pp1
	layer_4_expert_sp3_ep10_tp1_pp1 [label="Expert L4 SP3 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep10_pp1 -> layer_4_expert_sp3_ep10_tp1_pp1
	layer_4_expert_out_sp3_ep10_tp1_pp1 [label="Expert Out L4 SP3 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep10_tp1_pp1 -> layer_4_expert_out_sp3_ep10_tp1_pp1
	layer_4_expert_sp3_ep10_tp2_pp1 [label="Expert L4 SP3 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep10_pp1 -> layer_4_expert_sp3_ep10_tp2_pp1
	layer_4_expert_out_sp3_ep10_tp2_pp1 [label="Expert Out L4 SP3 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep10_tp2_pp1 -> layer_4_expert_out_sp3_ep10_tp2_pp1
	layer_4_expert_sp3_ep10_tp3_pp1 [label="Expert L4 SP3 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep10_pp1 -> layer_4_expert_sp3_ep10_tp3_pp1
	layer_4_expert_out_sp3_ep10_tp3_pp1 [label="Expert Out L4 SP3 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep10_tp3_pp1 -> layer_4_expert_out_sp3_ep10_tp3_pp1
	layer_4_expert_ar_sp3_ep10_pp1 [label="Expert All-Reduce L4 SP3 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep10_tp0_pp1 -> layer_4_expert_ar_sp3_ep10_pp1
	layer_4_expert_out_sp3_ep10_tp1_pp1 -> layer_4_expert_ar_sp3_ep10_pp1
	layer_4_expert_out_sp3_ep10_tp2_pp1 -> layer_4_expert_ar_sp3_ep10_pp1
	layer_4_expert_out_sp3_ep10_tp3_pp1 -> layer_4_expert_ar_sp3_ep10_pp1
	layer_4_combine_sp3_ep10_pp1 [label="Token Combine L4 SP3 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep10_pp1 -> layer_4_combine_sp3_ep10_pp1
	layer_4_dispatch_sp3_ep11_pp1 [label="Token Dispatch L4 SP3 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep11_pp1 [style=dashed]
	layer_4_expert_sp3_ep11_tp0_pp1 [label="Expert L4 SP3 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep11_pp1 -> layer_4_expert_sp3_ep11_tp0_pp1
	layer_4_expert_out_sp3_ep11_tp0_pp1 [label="Expert Out L4 SP3 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep11_tp0_pp1 -> layer_4_expert_out_sp3_ep11_tp0_pp1
	layer_4_expert_sp3_ep11_tp1_pp1 [label="Expert L4 SP3 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep11_pp1 -> layer_4_expert_sp3_ep11_tp1_pp1
	layer_4_expert_out_sp3_ep11_tp1_pp1 [label="Expert Out L4 SP3 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep11_tp1_pp1 -> layer_4_expert_out_sp3_ep11_tp1_pp1
	layer_4_expert_sp3_ep11_tp2_pp1 [label="Expert L4 SP3 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep11_pp1 -> layer_4_expert_sp3_ep11_tp2_pp1
	layer_4_expert_out_sp3_ep11_tp2_pp1 [label="Expert Out L4 SP3 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep11_tp2_pp1 -> layer_4_expert_out_sp3_ep11_tp2_pp1
	layer_4_expert_sp3_ep11_tp3_pp1 [label="Expert L4 SP3 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep11_pp1 -> layer_4_expert_sp3_ep11_tp3_pp1
	layer_4_expert_out_sp3_ep11_tp3_pp1 [label="Expert Out L4 SP3 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep11_tp3_pp1 -> layer_4_expert_out_sp3_ep11_tp3_pp1
	layer_4_expert_ar_sp3_ep11_pp1 [label="Expert All-Reduce L4 SP3 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep11_tp0_pp1 -> layer_4_expert_ar_sp3_ep11_pp1
	layer_4_expert_out_sp3_ep11_tp1_pp1 -> layer_4_expert_ar_sp3_ep11_pp1
	layer_4_expert_out_sp3_ep11_tp2_pp1 -> layer_4_expert_ar_sp3_ep11_pp1
	layer_4_expert_out_sp3_ep11_tp3_pp1 -> layer_4_expert_ar_sp3_ep11_pp1
	layer_4_combine_sp3_ep11_pp1 [label="Token Combine L4 SP3 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep11_pp1 -> layer_4_combine_sp3_ep11_pp1
	layer_4_dispatch_sp3_ep12_pp1 [label="Token Dispatch L4 SP3 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep12_pp1 [style=dashed]
	layer_4_expert_sp3_ep12_tp0_pp1 [label="Expert L4 SP3 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep12_pp1 -> layer_4_expert_sp3_ep12_tp0_pp1
	layer_4_expert_out_sp3_ep12_tp0_pp1 [label="Expert Out L4 SP3 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep12_tp0_pp1 -> layer_4_expert_out_sp3_ep12_tp0_pp1
	layer_4_expert_sp3_ep12_tp1_pp1 [label="Expert L4 SP3 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep12_pp1 -> layer_4_expert_sp3_ep12_tp1_pp1
	layer_4_expert_out_sp3_ep12_tp1_pp1 [label="Expert Out L4 SP3 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep12_tp1_pp1 -> layer_4_expert_out_sp3_ep12_tp1_pp1
	layer_4_expert_sp3_ep12_tp2_pp1 [label="Expert L4 SP3 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep12_pp1 -> layer_4_expert_sp3_ep12_tp2_pp1
	layer_4_expert_out_sp3_ep12_tp2_pp1 [label="Expert Out L4 SP3 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep12_tp2_pp1 -> layer_4_expert_out_sp3_ep12_tp2_pp1
	layer_4_expert_sp3_ep12_tp3_pp1 [label="Expert L4 SP3 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep12_pp1 -> layer_4_expert_sp3_ep12_tp3_pp1
	layer_4_expert_out_sp3_ep12_tp3_pp1 [label="Expert Out L4 SP3 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep12_tp3_pp1 -> layer_4_expert_out_sp3_ep12_tp3_pp1
	layer_4_expert_ar_sp3_ep12_pp1 [label="Expert All-Reduce L4 SP3 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep12_tp0_pp1 -> layer_4_expert_ar_sp3_ep12_pp1
	layer_4_expert_out_sp3_ep12_tp1_pp1 -> layer_4_expert_ar_sp3_ep12_pp1
	layer_4_expert_out_sp3_ep12_tp2_pp1 -> layer_4_expert_ar_sp3_ep12_pp1
	layer_4_expert_out_sp3_ep12_tp3_pp1 -> layer_4_expert_ar_sp3_ep12_pp1
	layer_4_combine_sp3_ep12_pp1 [label="Token Combine L4 SP3 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep12_pp1 -> layer_4_combine_sp3_ep12_pp1
	layer_4_dispatch_sp3_ep13_pp1 [label="Token Dispatch L4 SP3 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep13_pp1 [style=dashed]
	layer_4_expert_sp3_ep13_tp0_pp1 [label="Expert L4 SP3 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep13_pp1 -> layer_4_expert_sp3_ep13_tp0_pp1
	layer_4_expert_out_sp3_ep13_tp0_pp1 [label="Expert Out L4 SP3 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep13_tp0_pp1 -> layer_4_expert_out_sp3_ep13_tp0_pp1
	layer_4_expert_sp3_ep13_tp1_pp1 [label="Expert L4 SP3 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep13_pp1 -> layer_4_expert_sp3_ep13_tp1_pp1
	layer_4_expert_out_sp3_ep13_tp1_pp1 [label="Expert Out L4 SP3 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep13_tp1_pp1 -> layer_4_expert_out_sp3_ep13_tp1_pp1
	layer_4_expert_sp3_ep13_tp2_pp1 [label="Expert L4 SP3 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep13_pp1 -> layer_4_expert_sp3_ep13_tp2_pp1
	layer_4_expert_out_sp3_ep13_tp2_pp1 [label="Expert Out L4 SP3 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep13_tp2_pp1 -> layer_4_expert_out_sp3_ep13_tp2_pp1
	layer_4_expert_sp3_ep13_tp3_pp1 [label="Expert L4 SP3 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep13_pp1 -> layer_4_expert_sp3_ep13_tp3_pp1
	layer_4_expert_out_sp3_ep13_tp3_pp1 [label="Expert Out L4 SP3 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep13_tp3_pp1 -> layer_4_expert_out_sp3_ep13_tp3_pp1
	layer_4_expert_ar_sp3_ep13_pp1 [label="Expert All-Reduce L4 SP3 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep13_tp0_pp1 -> layer_4_expert_ar_sp3_ep13_pp1
	layer_4_expert_out_sp3_ep13_tp1_pp1 -> layer_4_expert_ar_sp3_ep13_pp1
	layer_4_expert_out_sp3_ep13_tp2_pp1 -> layer_4_expert_ar_sp3_ep13_pp1
	layer_4_expert_out_sp3_ep13_tp3_pp1 -> layer_4_expert_ar_sp3_ep13_pp1
	layer_4_combine_sp3_ep13_pp1 [label="Token Combine L4 SP3 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep13_pp1 -> layer_4_combine_sp3_ep13_pp1
	layer_4_dispatch_sp3_ep14_pp1 [label="Token Dispatch L4 SP3 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep14_pp1 [style=dashed]
	layer_4_expert_sp3_ep14_tp0_pp1 [label="Expert L4 SP3 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep14_pp1 -> layer_4_expert_sp3_ep14_tp0_pp1
	layer_4_expert_out_sp3_ep14_tp0_pp1 [label="Expert Out L4 SP3 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep14_tp0_pp1 -> layer_4_expert_out_sp3_ep14_tp0_pp1
	layer_4_expert_sp3_ep14_tp1_pp1 [label="Expert L4 SP3 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep14_pp1 -> layer_4_expert_sp3_ep14_tp1_pp1
	layer_4_expert_out_sp3_ep14_tp1_pp1 [label="Expert Out L4 SP3 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep14_tp1_pp1 -> layer_4_expert_out_sp3_ep14_tp1_pp1
	layer_4_expert_sp3_ep14_tp2_pp1 [label="Expert L4 SP3 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep14_pp1 -> layer_4_expert_sp3_ep14_tp2_pp1
	layer_4_expert_out_sp3_ep14_tp2_pp1 [label="Expert Out L4 SP3 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep14_tp2_pp1 -> layer_4_expert_out_sp3_ep14_tp2_pp1
	layer_4_expert_sp3_ep14_tp3_pp1 [label="Expert L4 SP3 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep14_pp1 -> layer_4_expert_sp3_ep14_tp3_pp1
	layer_4_expert_out_sp3_ep14_tp3_pp1 [label="Expert Out L4 SP3 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep14_tp3_pp1 -> layer_4_expert_out_sp3_ep14_tp3_pp1
	layer_4_expert_ar_sp3_ep14_pp1 [label="Expert All-Reduce L4 SP3 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep14_tp0_pp1 -> layer_4_expert_ar_sp3_ep14_pp1
	layer_4_expert_out_sp3_ep14_tp1_pp1 -> layer_4_expert_ar_sp3_ep14_pp1
	layer_4_expert_out_sp3_ep14_tp2_pp1 -> layer_4_expert_ar_sp3_ep14_pp1
	layer_4_expert_out_sp3_ep14_tp3_pp1 -> layer_4_expert_ar_sp3_ep14_pp1
	layer_4_combine_sp3_ep14_pp1 [label="Token Combine L4 SP3 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep14_pp1 -> layer_4_combine_sp3_ep14_pp1
	layer_4_dispatch_sp3_ep15_pp1 [label="Token Dispatch L4 SP3 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_4_router_sp3_pp1 -> layer_4_dispatch_sp3_ep15_pp1 [style=dashed]
	layer_4_expert_sp3_ep15_tp0_pp1 [label="Expert L4 SP3 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep15_pp1 -> layer_4_expert_sp3_ep15_tp0_pp1
	layer_4_expert_out_sp3_ep15_tp0_pp1 [label="Expert Out L4 SP3 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep15_tp0_pp1 -> layer_4_expert_out_sp3_ep15_tp0_pp1
	layer_4_expert_sp3_ep15_tp1_pp1 [label="Expert L4 SP3 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep15_pp1 -> layer_4_expert_sp3_ep15_tp1_pp1
	layer_4_expert_out_sp3_ep15_tp1_pp1 [label="Expert Out L4 SP3 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep15_tp1_pp1 -> layer_4_expert_out_sp3_ep15_tp1_pp1
	layer_4_expert_sp3_ep15_tp2_pp1 [label="Expert L4 SP3 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep15_pp1 -> layer_4_expert_sp3_ep15_tp2_pp1
	layer_4_expert_out_sp3_ep15_tp2_pp1 [label="Expert Out L4 SP3 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep15_tp2_pp1 -> layer_4_expert_out_sp3_ep15_tp2_pp1
	layer_4_expert_sp3_ep15_tp3_pp1 [label="Expert L4 SP3 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_dispatch_sp3_ep15_pp1 -> layer_4_expert_sp3_ep15_tp3_pp1
	layer_4_expert_out_sp3_ep15_tp3_pp1 [label="Expert Out L4 SP3 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_4_expert_sp3_ep15_tp3_pp1 -> layer_4_expert_out_sp3_ep15_tp3_pp1
	layer_4_expert_ar_sp3_ep15_pp1 [label="Expert All-Reduce L4 SP3 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_4_expert_out_sp3_ep15_tp0_pp1 -> layer_4_expert_ar_sp3_ep15_pp1
	layer_4_expert_out_sp3_ep15_tp1_pp1 -> layer_4_expert_ar_sp3_ep15_pp1
	layer_4_expert_out_sp3_ep15_tp2_pp1 -> layer_4_expert_ar_sp3_ep15_pp1
	layer_4_expert_out_sp3_ep15_tp3_pp1 -> layer_4_expert_ar_sp3_ep15_pp1
	layer_4_combine_sp3_ep15_pp1 [label="Token Combine L4 SP3 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_4_expert_ar_sp3_ep15_pp1 -> layer_4_combine_sp3_ep15_pp1
	layer_4_moe_all2all_sp3_pp1 [label="MoE All-to-All L4 SP3\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_4_combine_sp3_ep0_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep1_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep2_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep3_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep4_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep5_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep6_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep7_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep8_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep9_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep10_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep11_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep12_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep13_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep14_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_combine_sp3_ep15_pp1 -> layer_4_moe_all2all_sp3_pp1
	layer_4_mlp_out_sp3_pp1 [label="MoE Output L4 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_moe_all2all_sp3_pp1 -> layer_4_mlp_out_sp3_pp1
	layer_4_mlp_res_sp3_pp1 [label="MLP Residual L4 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_mlp_out_sp3_pp1 -> layer_4_mlp_res_sp3_pp1
	layer_4_attn_res_sp3_pp1 -> layer_4_mlp_res_sp3_pp1 [style=dashed]
	layer_5_norm_sp0_pp1 [label="LayerNorm L5 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_mlp_out_sp0_pp1 -> layer_5_norm_sp0_pp1
	layer_5_qkv_sp0_tp0_pp1 [label="QKV Proj L5 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp0_pp1 -> layer_5_qkv_sp0_tp0_pp1
	layer_5_attn_sp0_tp0_pp1 [label="Attention L5 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp0_tp0_pp1 -> layer_5_attn_sp0_tp0_pp1
	layer_5_attn_out_sp0_tp0_pp1 [label="Attn Out Proj L5 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp0_tp0_pp1 -> layer_5_attn_out_sp0_tp0_pp1
	layer_5_qkv_sp0_tp1_pp1 [label="QKV Proj L5 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp0_pp1 -> layer_5_qkv_sp0_tp1_pp1
	layer_5_attn_sp0_tp1_pp1 [label="Attention L5 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp0_tp1_pp1 -> layer_5_attn_sp0_tp1_pp1
	layer_5_attn_out_sp0_tp1_pp1 [label="Attn Out Proj L5 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp0_tp1_pp1 -> layer_5_attn_out_sp0_tp1_pp1
	layer_5_qkv_sp0_tp2_pp1 [label="QKV Proj L5 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp0_pp1 -> layer_5_qkv_sp0_tp2_pp1
	layer_5_attn_sp0_tp2_pp1 [label="Attention L5 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp0_tp2_pp1 -> layer_5_attn_sp0_tp2_pp1
	layer_5_attn_out_sp0_tp2_pp1 [label="Attn Out Proj L5 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp0_tp2_pp1 -> layer_5_attn_out_sp0_tp2_pp1
	layer_5_qkv_sp0_tp3_pp1 [label="QKV Proj L5 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp0_pp1 -> layer_5_qkv_sp0_tp3_pp1
	layer_5_attn_sp0_tp3_pp1 [label="Attention L5 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp0_tp3_pp1 -> layer_5_attn_sp0_tp3_pp1
	layer_5_attn_out_sp0_tp3_pp1 [label="Attn Out Proj L5 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp0_tp3_pp1 -> layer_5_attn_out_sp0_tp3_pp1
	layer_5_attn_ar_sp0_pp1 [label="Attention All-Reduce L5 SP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_attn_out_sp0_tp0_pp1 -> layer_5_attn_ar_sp0_pp1
	layer_5_attn_out_sp0_tp1_pp1 -> layer_5_attn_ar_sp0_pp1
	layer_5_attn_out_sp0_tp2_pp1 -> layer_5_attn_ar_sp0_pp1
	layer_5_attn_out_sp0_tp3_pp1 -> layer_5_attn_ar_sp0_pp1
	layer_5_attn_res_sp0_pp1 [label="Attention Residual L5 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_attn_ar_sp0_pp1 -> layer_5_attn_res_sp0_pp1
	layer_5_norm_sp0_pp1 -> layer_5_attn_res_sp0_pp1 [style=dashed]
	layer_5_post_norm_sp0_pp1 [label="Post-Attn Norm L5 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_attn_res_sp0_pp1 -> layer_5_post_norm_sp0_pp1
	layer_5_router_sp0_pp1 [label="MoE Router L5 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_5_post_norm_sp0_pp1 -> layer_5_router_sp0_pp1
	layer_5_dispatch_sp0_ep0_pp1 [label="Token Dispatch L5 SP0 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep0_pp1 [style=dashed]
	layer_5_expert_sp0_ep0_tp0_pp1 [label="Expert L5 SP0 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep0_pp1 -> layer_5_expert_sp0_ep0_tp0_pp1
	layer_5_expert_out_sp0_ep0_tp0_pp1 [label="Expert Out L5 SP0 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep0_tp0_pp1 -> layer_5_expert_out_sp0_ep0_tp0_pp1
	layer_5_expert_sp0_ep0_tp1_pp1 [label="Expert L5 SP0 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep0_pp1 -> layer_5_expert_sp0_ep0_tp1_pp1
	layer_5_expert_out_sp0_ep0_tp1_pp1 [label="Expert Out L5 SP0 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep0_tp1_pp1 -> layer_5_expert_out_sp0_ep0_tp1_pp1
	layer_5_expert_sp0_ep0_tp2_pp1 [label="Expert L5 SP0 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep0_pp1 -> layer_5_expert_sp0_ep0_tp2_pp1
	layer_5_expert_out_sp0_ep0_tp2_pp1 [label="Expert Out L5 SP0 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep0_tp2_pp1 -> layer_5_expert_out_sp0_ep0_tp2_pp1
	layer_5_expert_sp0_ep0_tp3_pp1 [label="Expert L5 SP0 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep0_pp1 -> layer_5_expert_sp0_ep0_tp3_pp1
	layer_5_expert_out_sp0_ep0_tp3_pp1 [label="Expert Out L5 SP0 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep0_tp3_pp1 -> layer_5_expert_out_sp0_ep0_tp3_pp1
	layer_5_expert_ar_sp0_ep0_pp1 [label="Expert All-Reduce L5 SP0 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep0_tp0_pp1 -> layer_5_expert_ar_sp0_ep0_pp1
	layer_5_expert_out_sp0_ep0_tp1_pp1 -> layer_5_expert_ar_sp0_ep0_pp1
	layer_5_expert_out_sp0_ep0_tp2_pp1 -> layer_5_expert_ar_sp0_ep0_pp1
	layer_5_expert_out_sp0_ep0_tp3_pp1 -> layer_5_expert_ar_sp0_ep0_pp1
	layer_5_combine_sp0_ep0_pp1 [label="Token Combine L5 SP0 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep0_pp1 -> layer_5_combine_sp0_ep0_pp1
	layer_5_dispatch_sp0_ep1_pp1 [label="Token Dispatch L5 SP0 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep1_pp1 [style=dashed]
	layer_5_expert_sp0_ep1_tp0_pp1 [label="Expert L5 SP0 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep1_pp1 -> layer_5_expert_sp0_ep1_tp0_pp1
	layer_5_expert_out_sp0_ep1_tp0_pp1 [label="Expert Out L5 SP0 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep1_tp0_pp1 -> layer_5_expert_out_sp0_ep1_tp0_pp1
	layer_5_expert_sp0_ep1_tp1_pp1 [label="Expert L5 SP0 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep1_pp1 -> layer_5_expert_sp0_ep1_tp1_pp1
	layer_5_expert_out_sp0_ep1_tp1_pp1 [label="Expert Out L5 SP0 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep1_tp1_pp1 -> layer_5_expert_out_sp0_ep1_tp1_pp1
	layer_5_expert_sp0_ep1_tp2_pp1 [label="Expert L5 SP0 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep1_pp1 -> layer_5_expert_sp0_ep1_tp2_pp1
	layer_5_expert_out_sp0_ep1_tp2_pp1 [label="Expert Out L5 SP0 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep1_tp2_pp1 -> layer_5_expert_out_sp0_ep1_tp2_pp1
	layer_5_expert_sp0_ep1_tp3_pp1 [label="Expert L5 SP0 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep1_pp1 -> layer_5_expert_sp0_ep1_tp3_pp1
	layer_5_expert_out_sp0_ep1_tp3_pp1 [label="Expert Out L5 SP0 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep1_tp3_pp1 -> layer_5_expert_out_sp0_ep1_tp3_pp1
	layer_5_expert_ar_sp0_ep1_pp1 [label="Expert All-Reduce L5 SP0 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep1_tp0_pp1 -> layer_5_expert_ar_sp0_ep1_pp1
	layer_5_expert_out_sp0_ep1_tp1_pp1 -> layer_5_expert_ar_sp0_ep1_pp1
	layer_5_expert_out_sp0_ep1_tp2_pp1 -> layer_5_expert_ar_sp0_ep1_pp1
	layer_5_expert_out_sp0_ep1_tp3_pp1 -> layer_5_expert_ar_sp0_ep1_pp1
	layer_5_combine_sp0_ep1_pp1 [label="Token Combine L5 SP0 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep1_pp1 -> layer_5_combine_sp0_ep1_pp1
	layer_5_dispatch_sp0_ep2_pp1 [label="Token Dispatch L5 SP0 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep2_pp1 [style=dashed]
	layer_5_expert_sp0_ep2_tp0_pp1 [label="Expert L5 SP0 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep2_pp1 -> layer_5_expert_sp0_ep2_tp0_pp1
	layer_5_expert_out_sp0_ep2_tp0_pp1 [label="Expert Out L5 SP0 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep2_tp0_pp1 -> layer_5_expert_out_sp0_ep2_tp0_pp1
	layer_5_expert_sp0_ep2_tp1_pp1 [label="Expert L5 SP0 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep2_pp1 -> layer_5_expert_sp0_ep2_tp1_pp1
	layer_5_expert_out_sp0_ep2_tp1_pp1 [label="Expert Out L5 SP0 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep2_tp1_pp1 -> layer_5_expert_out_sp0_ep2_tp1_pp1
	layer_5_expert_sp0_ep2_tp2_pp1 [label="Expert L5 SP0 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep2_pp1 -> layer_5_expert_sp0_ep2_tp2_pp1
	layer_5_expert_out_sp0_ep2_tp2_pp1 [label="Expert Out L5 SP0 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep2_tp2_pp1 -> layer_5_expert_out_sp0_ep2_tp2_pp1
	layer_5_expert_sp0_ep2_tp3_pp1 [label="Expert L5 SP0 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep2_pp1 -> layer_5_expert_sp0_ep2_tp3_pp1
	layer_5_expert_out_sp0_ep2_tp3_pp1 [label="Expert Out L5 SP0 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep2_tp3_pp1 -> layer_5_expert_out_sp0_ep2_tp3_pp1
	layer_5_expert_ar_sp0_ep2_pp1 [label="Expert All-Reduce L5 SP0 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep2_tp0_pp1 -> layer_5_expert_ar_sp0_ep2_pp1
	layer_5_expert_out_sp0_ep2_tp1_pp1 -> layer_5_expert_ar_sp0_ep2_pp1
	layer_5_expert_out_sp0_ep2_tp2_pp1 -> layer_5_expert_ar_sp0_ep2_pp1
	layer_5_expert_out_sp0_ep2_tp3_pp1 -> layer_5_expert_ar_sp0_ep2_pp1
	layer_5_combine_sp0_ep2_pp1 [label="Token Combine L5 SP0 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep2_pp1 -> layer_5_combine_sp0_ep2_pp1
	layer_5_dispatch_sp0_ep3_pp1 [label="Token Dispatch L5 SP0 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep3_pp1 [style=dashed]
	layer_5_expert_sp0_ep3_tp0_pp1 [label="Expert L5 SP0 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep3_pp1 -> layer_5_expert_sp0_ep3_tp0_pp1
	layer_5_expert_out_sp0_ep3_tp0_pp1 [label="Expert Out L5 SP0 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep3_tp0_pp1 -> layer_5_expert_out_sp0_ep3_tp0_pp1
	layer_5_expert_sp0_ep3_tp1_pp1 [label="Expert L5 SP0 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep3_pp1 -> layer_5_expert_sp0_ep3_tp1_pp1
	layer_5_expert_out_sp0_ep3_tp1_pp1 [label="Expert Out L5 SP0 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep3_tp1_pp1 -> layer_5_expert_out_sp0_ep3_tp1_pp1
	layer_5_expert_sp0_ep3_tp2_pp1 [label="Expert L5 SP0 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep3_pp1 -> layer_5_expert_sp0_ep3_tp2_pp1
	layer_5_expert_out_sp0_ep3_tp2_pp1 [label="Expert Out L5 SP0 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep3_tp2_pp1 -> layer_5_expert_out_sp0_ep3_tp2_pp1
	layer_5_expert_sp0_ep3_tp3_pp1 [label="Expert L5 SP0 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep3_pp1 -> layer_5_expert_sp0_ep3_tp3_pp1
	layer_5_expert_out_sp0_ep3_tp3_pp1 [label="Expert Out L5 SP0 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep3_tp3_pp1 -> layer_5_expert_out_sp0_ep3_tp3_pp1
	layer_5_expert_ar_sp0_ep3_pp1 [label="Expert All-Reduce L5 SP0 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep3_tp0_pp1 -> layer_5_expert_ar_sp0_ep3_pp1
	layer_5_expert_out_sp0_ep3_tp1_pp1 -> layer_5_expert_ar_sp0_ep3_pp1
	layer_5_expert_out_sp0_ep3_tp2_pp1 -> layer_5_expert_ar_sp0_ep3_pp1
	layer_5_expert_out_sp0_ep3_tp3_pp1 -> layer_5_expert_ar_sp0_ep3_pp1
	layer_5_combine_sp0_ep3_pp1 [label="Token Combine L5 SP0 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep3_pp1 -> layer_5_combine_sp0_ep3_pp1
	layer_5_dispatch_sp0_ep4_pp1 [label="Token Dispatch L5 SP0 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep4_pp1 [style=dashed]
	layer_5_expert_sp0_ep4_tp0_pp1 [label="Expert L5 SP0 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep4_pp1 -> layer_5_expert_sp0_ep4_tp0_pp1
	layer_5_expert_out_sp0_ep4_tp0_pp1 [label="Expert Out L5 SP0 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep4_tp0_pp1 -> layer_5_expert_out_sp0_ep4_tp0_pp1
	layer_5_expert_sp0_ep4_tp1_pp1 [label="Expert L5 SP0 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep4_pp1 -> layer_5_expert_sp0_ep4_tp1_pp1
	layer_5_expert_out_sp0_ep4_tp1_pp1 [label="Expert Out L5 SP0 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep4_tp1_pp1 -> layer_5_expert_out_sp0_ep4_tp1_pp1
	layer_5_expert_sp0_ep4_tp2_pp1 [label="Expert L5 SP0 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep4_pp1 -> layer_5_expert_sp0_ep4_tp2_pp1
	layer_5_expert_out_sp0_ep4_tp2_pp1 [label="Expert Out L5 SP0 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep4_tp2_pp1 -> layer_5_expert_out_sp0_ep4_tp2_pp1
	layer_5_expert_sp0_ep4_tp3_pp1 [label="Expert L5 SP0 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep4_pp1 -> layer_5_expert_sp0_ep4_tp3_pp1
	layer_5_expert_out_sp0_ep4_tp3_pp1 [label="Expert Out L5 SP0 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep4_tp3_pp1 -> layer_5_expert_out_sp0_ep4_tp3_pp1
	layer_5_expert_ar_sp0_ep4_pp1 [label="Expert All-Reduce L5 SP0 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep4_tp0_pp1 -> layer_5_expert_ar_sp0_ep4_pp1
	layer_5_expert_out_sp0_ep4_tp1_pp1 -> layer_5_expert_ar_sp0_ep4_pp1
	layer_5_expert_out_sp0_ep4_tp2_pp1 -> layer_5_expert_ar_sp0_ep4_pp1
	layer_5_expert_out_sp0_ep4_tp3_pp1 -> layer_5_expert_ar_sp0_ep4_pp1
	layer_5_combine_sp0_ep4_pp1 [label="Token Combine L5 SP0 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep4_pp1 -> layer_5_combine_sp0_ep4_pp1
	layer_5_dispatch_sp0_ep5_pp1 [label="Token Dispatch L5 SP0 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep5_pp1 [style=dashed]
	layer_5_expert_sp0_ep5_tp0_pp1 [label="Expert L5 SP0 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep5_pp1 -> layer_5_expert_sp0_ep5_tp0_pp1
	layer_5_expert_out_sp0_ep5_tp0_pp1 [label="Expert Out L5 SP0 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep5_tp0_pp1 -> layer_5_expert_out_sp0_ep5_tp0_pp1
	layer_5_expert_sp0_ep5_tp1_pp1 [label="Expert L5 SP0 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep5_pp1 -> layer_5_expert_sp0_ep5_tp1_pp1
	layer_5_expert_out_sp0_ep5_tp1_pp1 [label="Expert Out L5 SP0 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep5_tp1_pp1 -> layer_5_expert_out_sp0_ep5_tp1_pp1
	layer_5_expert_sp0_ep5_tp2_pp1 [label="Expert L5 SP0 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep5_pp1 -> layer_5_expert_sp0_ep5_tp2_pp1
	layer_5_expert_out_sp0_ep5_tp2_pp1 [label="Expert Out L5 SP0 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep5_tp2_pp1 -> layer_5_expert_out_sp0_ep5_tp2_pp1
	layer_5_expert_sp0_ep5_tp3_pp1 [label="Expert L5 SP0 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep5_pp1 -> layer_5_expert_sp0_ep5_tp3_pp1
	layer_5_expert_out_sp0_ep5_tp3_pp1 [label="Expert Out L5 SP0 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep5_tp3_pp1 -> layer_5_expert_out_sp0_ep5_tp3_pp1
	layer_5_expert_ar_sp0_ep5_pp1 [label="Expert All-Reduce L5 SP0 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep5_tp0_pp1 -> layer_5_expert_ar_sp0_ep5_pp1
	layer_5_expert_out_sp0_ep5_tp1_pp1 -> layer_5_expert_ar_sp0_ep5_pp1
	layer_5_expert_out_sp0_ep5_tp2_pp1 -> layer_5_expert_ar_sp0_ep5_pp1
	layer_5_expert_out_sp0_ep5_tp3_pp1 -> layer_5_expert_ar_sp0_ep5_pp1
	layer_5_combine_sp0_ep5_pp1 [label="Token Combine L5 SP0 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep5_pp1 -> layer_5_combine_sp0_ep5_pp1
	layer_5_dispatch_sp0_ep6_pp1 [label="Token Dispatch L5 SP0 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep6_pp1 [style=dashed]
	layer_5_expert_sp0_ep6_tp0_pp1 [label="Expert L5 SP0 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep6_pp1 -> layer_5_expert_sp0_ep6_tp0_pp1
	layer_5_expert_out_sp0_ep6_tp0_pp1 [label="Expert Out L5 SP0 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep6_tp0_pp1 -> layer_5_expert_out_sp0_ep6_tp0_pp1
	layer_5_expert_sp0_ep6_tp1_pp1 [label="Expert L5 SP0 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep6_pp1 -> layer_5_expert_sp0_ep6_tp1_pp1
	layer_5_expert_out_sp0_ep6_tp1_pp1 [label="Expert Out L5 SP0 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep6_tp1_pp1 -> layer_5_expert_out_sp0_ep6_tp1_pp1
	layer_5_expert_sp0_ep6_tp2_pp1 [label="Expert L5 SP0 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep6_pp1 -> layer_5_expert_sp0_ep6_tp2_pp1
	layer_5_expert_out_sp0_ep6_tp2_pp1 [label="Expert Out L5 SP0 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep6_tp2_pp1 -> layer_5_expert_out_sp0_ep6_tp2_pp1
	layer_5_expert_sp0_ep6_tp3_pp1 [label="Expert L5 SP0 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep6_pp1 -> layer_5_expert_sp0_ep6_tp3_pp1
	layer_5_expert_out_sp0_ep6_tp3_pp1 [label="Expert Out L5 SP0 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep6_tp3_pp1 -> layer_5_expert_out_sp0_ep6_tp3_pp1
	layer_5_expert_ar_sp0_ep6_pp1 [label="Expert All-Reduce L5 SP0 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep6_tp0_pp1 -> layer_5_expert_ar_sp0_ep6_pp1
	layer_5_expert_out_sp0_ep6_tp1_pp1 -> layer_5_expert_ar_sp0_ep6_pp1
	layer_5_expert_out_sp0_ep6_tp2_pp1 -> layer_5_expert_ar_sp0_ep6_pp1
	layer_5_expert_out_sp0_ep6_tp3_pp1 -> layer_5_expert_ar_sp0_ep6_pp1
	layer_5_combine_sp0_ep6_pp1 [label="Token Combine L5 SP0 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep6_pp1 -> layer_5_combine_sp0_ep6_pp1
	layer_5_dispatch_sp0_ep7_pp1 [label="Token Dispatch L5 SP0 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep7_pp1 [style=dashed]
	layer_5_expert_sp0_ep7_tp0_pp1 [label="Expert L5 SP0 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep7_pp1 -> layer_5_expert_sp0_ep7_tp0_pp1
	layer_5_expert_out_sp0_ep7_tp0_pp1 [label="Expert Out L5 SP0 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep7_tp0_pp1 -> layer_5_expert_out_sp0_ep7_tp0_pp1
	layer_5_expert_sp0_ep7_tp1_pp1 [label="Expert L5 SP0 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep7_pp1 -> layer_5_expert_sp0_ep7_tp1_pp1
	layer_5_expert_out_sp0_ep7_tp1_pp1 [label="Expert Out L5 SP0 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep7_tp1_pp1 -> layer_5_expert_out_sp0_ep7_tp1_pp1
	layer_5_expert_sp0_ep7_tp2_pp1 [label="Expert L5 SP0 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep7_pp1 -> layer_5_expert_sp0_ep7_tp2_pp1
	layer_5_expert_out_sp0_ep7_tp2_pp1 [label="Expert Out L5 SP0 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep7_tp2_pp1 -> layer_5_expert_out_sp0_ep7_tp2_pp1
	layer_5_expert_sp0_ep7_tp3_pp1 [label="Expert L5 SP0 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep7_pp1 -> layer_5_expert_sp0_ep7_tp3_pp1
	layer_5_expert_out_sp0_ep7_tp3_pp1 [label="Expert Out L5 SP0 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep7_tp3_pp1 -> layer_5_expert_out_sp0_ep7_tp3_pp1
	layer_5_expert_ar_sp0_ep7_pp1 [label="Expert All-Reduce L5 SP0 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep7_tp0_pp1 -> layer_5_expert_ar_sp0_ep7_pp1
	layer_5_expert_out_sp0_ep7_tp1_pp1 -> layer_5_expert_ar_sp0_ep7_pp1
	layer_5_expert_out_sp0_ep7_tp2_pp1 -> layer_5_expert_ar_sp0_ep7_pp1
	layer_5_expert_out_sp0_ep7_tp3_pp1 -> layer_5_expert_ar_sp0_ep7_pp1
	layer_5_combine_sp0_ep7_pp1 [label="Token Combine L5 SP0 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep7_pp1 -> layer_5_combine_sp0_ep7_pp1
	layer_5_dispatch_sp0_ep8_pp1 [label="Token Dispatch L5 SP0 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep8_pp1 [style=dashed]
	layer_5_expert_sp0_ep8_tp0_pp1 [label="Expert L5 SP0 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep8_pp1 -> layer_5_expert_sp0_ep8_tp0_pp1
	layer_5_expert_out_sp0_ep8_tp0_pp1 [label="Expert Out L5 SP0 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep8_tp0_pp1 -> layer_5_expert_out_sp0_ep8_tp0_pp1
	layer_5_expert_sp0_ep8_tp1_pp1 [label="Expert L5 SP0 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep8_pp1 -> layer_5_expert_sp0_ep8_tp1_pp1
	layer_5_expert_out_sp0_ep8_tp1_pp1 [label="Expert Out L5 SP0 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep8_tp1_pp1 -> layer_5_expert_out_sp0_ep8_tp1_pp1
	layer_5_expert_sp0_ep8_tp2_pp1 [label="Expert L5 SP0 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep8_pp1 -> layer_5_expert_sp0_ep8_tp2_pp1
	layer_5_expert_out_sp0_ep8_tp2_pp1 [label="Expert Out L5 SP0 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep8_tp2_pp1 -> layer_5_expert_out_sp0_ep8_tp2_pp1
	layer_5_expert_sp0_ep8_tp3_pp1 [label="Expert L5 SP0 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep8_pp1 -> layer_5_expert_sp0_ep8_tp3_pp1
	layer_5_expert_out_sp0_ep8_tp3_pp1 [label="Expert Out L5 SP0 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep8_tp3_pp1 -> layer_5_expert_out_sp0_ep8_tp3_pp1
	layer_5_expert_ar_sp0_ep8_pp1 [label="Expert All-Reduce L5 SP0 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep8_tp0_pp1 -> layer_5_expert_ar_sp0_ep8_pp1
	layer_5_expert_out_sp0_ep8_tp1_pp1 -> layer_5_expert_ar_sp0_ep8_pp1
	layer_5_expert_out_sp0_ep8_tp2_pp1 -> layer_5_expert_ar_sp0_ep8_pp1
	layer_5_expert_out_sp0_ep8_tp3_pp1 -> layer_5_expert_ar_sp0_ep8_pp1
	layer_5_combine_sp0_ep8_pp1 [label="Token Combine L5 SP0 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep8_pp1 -> layer_5_combine_sp0_ep8_pp1
	layer_5_dispatch_sp0_ep9_pp1 [label="Token Dispatch L5 SP0 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep9_pp1 [style=dashed]
	layer_5_expert_sp0_ep9_tp0_pp1 [label="Expert L5 SP0 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep9_pp1 -> layer_5_expert_sp0_ep9_tp0_pp1
	layer_5_expert_out_sp0_ep9_tp0_pp1 [label="Expert Out L5 SP0 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep9_tp0_pp1 -> layer_5_expert_out_sp0_ep9_tp0_pp1
	layer_5_expert_sp0_ep9_tp1_pp1 [label="Expert L5 SP0 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep9_pp1 -> layer_5_expert_sp0_ep9_tp1_pp1
	layer_5_expert_out_sp0_ep9_tp1_pp1 [label="Expert Out L5 SP0 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep9_tp1_pp1 -> layer_5_expert_out_sp0_ep9_tp1_pp1
	layer_5_expert_sp0_ep9_tp2_pp1 [label="Expert L5 SP0 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep9_pp1 -> layer_5_expert_sp0_ep9_tp2_pp1
	layer_5_expert_out_sp0_ep9_tp2_pp1 [label="Expert Out L5 SP0 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep9_tp2_pp1 -> layer_5_expert_out_sp0_ep9_tp2_pp1
	layer_5_expert_sp0_ep9_tp3_pp1 [label="Expert L5 SP0 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep9_pp1 -> layer_5_expert_sp0_ep9_tp3_pp1
	layer_5_expert_out_sp0_ep9_tp3_pp1 [label="Expert Out L5 SP0 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep9_tp3_pp1 -> layer_5_expert_out_sp0_ep9_tp3_pp1
	layer_5_expert_ar_sp0_ep9_pp1 [label="Expert All-Reduce L5 SP0 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep9_tp0_pp1 -> layer_5_expert_ar_sp0_ep9_pp1
	layer_5_expert_out_sp0_ep9_tp1_pp1 -> layer_5_expert_ar_sp0_ep9_pp1
	layer_5_expert_out_sp0_ep9_tp2_pp1 -> layer_5_expert_ar_sp0_ep9_pp1
	layer_5_expert_out_sp0_ep9_tp3_pp1 -> layer_5_expert_ar_sp0_ep9_pp1
	layer_5_combine_sp0_ep9_pp1 [label="Token Combine L5 SP0 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep9_pp1 -> layer_5_combine_sp0_ep9_pp1
	layer_5_dispatch_sp0_ep10_pp1 [label="Token Dispatch L5 SP0 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep10_pp1 [style=dashed]
	layer_5_expert_sp0_ep10_tp0_pp1 [label="Expert L5 SP0 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep10_pp1 -> layer_5_expert_sp0_ep10_tp0_pp1
	layer_5_expert_out_sp0_ep10_tp0_pp1 [label="Expert Out L5 SP0 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep10_tp0_pp1 -> layer_5_expert_out_sp0_ep10_tp0_pp1
	layer_5_expert_sp0_ep10_tp1_pp1 [label="Expert L5 SP0 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep10_pp1 -> layer_5_expert_sp0_ep10_tp1_pp1
	layer_5_expert_out_sp0_ep10_tp1_pp1 [label="Expert Out L5 SP0 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep10_tp1_pp1 -> layer_5_expert_out_sp0_ep10_tp1_pp1
	layer_5_expert_sp0_ep10_tp2_pp1 [label="Expert L5 SP0 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep10_pp1 -> layer_5_expert_sp0_ep10_tp2_pp1
	layer_5_expert_out_sp0_ep10_tp2_pp1 [label="Expert Out L5 SP0 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep10_tp2_pp1 -> layer_5_expert_out_sp0_ep10_tp2_pp1
	layer_5_expert_sp0_ep10_tp3_pp1 [label="Expert L5 SP0 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep10_pp1 -> layer_5_expert_sp0_ep10_tp3_pp1
	layer_5_expert_out_sp0_ep10_tp3_pp1 [label="Expert Out L5 SP0 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep10_tp3_pp1 -> layer_5_expert_out_sp0_ep10_tp3_pp1
	layer_5_expert_ar_sp0_ep10_pp1 [label="Expert All-Reduce L5 SP0 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep10_tp0_pp1 -> layer_5_expert_ar_sp0_ep10_pp1
	layer_5_expert_out_sp0_ep10_tp1_pp1 -> layer_5_expert_ar_sp0_ep10_pp1
	layer_5_expert_out_sp0_ep10_tp2_pp1 -> layer_5_expert_ar_sp0_ep10_pp1
	layer_5_expert_out_sp0_ep10_tp3_pp1 -> layer_5_expert_ar_sp0_ep10_pp1
	layer_5_combine_sp0_ep10_pp1 [label="Token Combine L5 SP0 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep10_pp1 -> layer_5_combine_sp0_ep10_pp1
	layer_5_dispatch_sp0_ep11_pp1 [label="Token Dispatch L5 SP0 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep11_pp1 [style=dashed]
	layer_5_expert_sp0_ep11_tp0_pp1 [label="Expert L5 SP0 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep11_pp1 -> layer_5_expert_sp0_ep11_tp0_pp1
	layer_5_expert_out_sp0_ep11_tp0_pp1 [label="Expert Out L5 SP0 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep11_tp0_pp1 -> layer_5_expert_out_sp0_ep11_tp0_pp1
	layer_5_expert_sp0_ep11_tp1_pp1 [label="Expert L5 SP0 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep11_pp1 -> layer_5_expert_sp0_ep11_tp1_pp1
	layer_5_expert_out_sp0_ep11_tp1_pp1 [label="Expert Out L5 SP0 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep11_tp1_pp1 -> layer_5_expert_out_sp0_ep11_tp1_pp1
	layer_5_expert_sp0_ep11_tp2_pp1 [label="Expert L5 SP0 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep11_pp1 -> layer_5_expert_sp0_ep11_tp2_pp1
	layer_5_expert_out_sp0_ep11_tp2_pp1 [label="Expert Out L5 SP0 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep11_tp2_pp1 -> layer_5_expert_out_sp0_ep11_tp2_pp1
	layer_5_expert_sp0_ep11_tp3_pp1 [label="Expert L5 SP0 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep11_pp1 -> layer_5_expert_sp0_ep11_tp3_pp1
	layer_5_expert_out_sp0_ep11_tp3_pp1 [label="Expert Out L5 SP0 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep11_tp3_pp1 -> layer_5_expert_out_sp0_ep11_tp3_pp1
	layer_5_expert_ar_sp0_ep11_pp1 [label="Expert All-Reduce L5 SP0 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep11_tp0_pp1 -> layer_5_expert_ar_sp0_ep11_pp1
	layer_5_expert_out_sp0_ep11_tp1_pp1 -> layer_5_expert_ar_sp0_ep11_pp1
	layer_5_expert_out_sp0_ep11_tp2_pp1 -> layer_5_expert_ar_sp0_ep11_pp1
	layer_5_expert_out_sp0_ep11_tp3_pp1 -> layer_5_expert_ar_sp0_ep11_pp1
	layer_5_combine_sp0_ep11_pp1 [label="Token Combine L5 SP0 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep11_pp1 -> layer_5_combine_sp0_ep11_pp1
	layer_5_dispatch_sp0_ep12_pp1 [label="Token Dispatch L5 SP0 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep12_pp1 [style=dashed]
	layer_5_expert_sp0_ep12_tp0_pp1 [label="Expert L5 SP0 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep12_pp1 -> layer_5_expert_sp0_ep12_tp0_pp1
	layer_5_expert_out_sp0_ep12_tp0_pp1 [label="Expert Out L5 SP0 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep12_tp0_pp1 -> layer_5_expert_out_sp0_ep12_tp0_pp1
	layer_5_expert_sp0_ep12_tp1_pp1 [label="Expert L5 SP0 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep12_pp1 -> layer_5_expert_sp0_ep12_tp1_pp1
	layer_5_expert_out_sp0_ep12_tp1_pp1 [label="Expert Out L5 SP0 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep12_tp1_pp1 -> layer_5_expert_out_sp0_ep12_tp1_pp1
	layer_5_expert_sp0_ep12_tp2_pp1 [label="Expert L5 SP0 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep12_pp1 -> layer_5_expert_sp0_ep12_tp2_pp1
	layer_5_expert_out_sp0_ep12_tp2_pp1 [label="Expert Out L5 SP0 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep12_tp2_pp1 -> layer_5_expert_out_sp0_ep12_tp2_pp1
	layer_5_expert_sp0_ep12_tp3_pp1 [label="Expert L5 SP0 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep12_pp1 -> layer_5_expert_sp0_ep12_tp3_pp1
	layer_5_expert_out_sp0_ep12_tp3_pp1 [label="Expert Out L5 SP0 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep12_tp3_pp1 -> layer_5_expert_out_sp0_ep12_tp3_pp1
	layer_5_expert_ar_sp0_ep12_pp1 [label="Expert All-Reduce L5 SP0 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep12_tp0_pp1 -> layer_5_expert_ar_sp0_ep12_pp1
	layer_5_expert_out_sp0_ep12_tp1_pp1 -> layer_5_expert_ar_sp0_ep12_pp1
	layer_5_expert_out_sp0_ep12_tp2_pp1 -> layer_5_expert_ar_sp0_ep12_pp1
	layer_5_expert_out_sp0_ep12_tp3_pp1 -> layer_5_expert_ar_sp0_ep12_pp1
	layer_5_combine_sp0_ep12_pp1 [label="Token Combine L5 SP0 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep12_pp1 -> layer_5_combine_sp0_ep12_pp1
	layer_5_dispatch_sp0_ep13_pp1 [label="Token Dispatch L5 SP0 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep13_pp1 [style=dashed]
	layer_5_expert_sp0_ep13_tp0_pp1 [label="Expert L5 SP0 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep13_pp1 -> layer_5_expert_sp0_ep13_tp0_pp1
	layer_5_expert_out_sp0_ep13_tp0_pp1 [label="Expert Out L5 SP0 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep13_tp0_pp1 -> layer_5_expert_out_sp0_ep13_tp0_pp1
	layer_5_expert_sp0_ep13_tp1_pp1 [label="Expert L5 SP0 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep13_pp1 -> layer_5_expert_sp0_ep13_tp1_pp1
	layer_5_expert_out_sp0_ep13_tp1_pp1 [label="Expert Out L5 SP0 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep13_tp1_pp1 -> layer_5_expert_out_sp0_ep13_tp1_pp1
	layer_5_expert_sp0_ep13_tp2_pp1 [label="Expert L5 SP0 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep13_pp1 -> layer_5_expert_sp0_ep13_tp2_pp1
	layer_5_expert_out_sp0_ep13_tp2_pp1 [label="Expert Out L5 SP0 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep13_tp2_pp1 -> layer_5_expert_out_sp0_ep13_tp2_pp1
	layer_5_expert_sp0_ep13_tp3_pp1 [label="Expert L5 SP0 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep13_pp1 -> layer_5_expert_sp0_ep13_tp3_pp1
	layer_5_expert_out_sp0_ep13_tp3_pp1 [label="Expert Out L5 SP0 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep13_tp3_pp1 -> layer_5_expert_out_sp0_ep13_tp3_pp1
	layer_5_expert_ar_sp0_ep13_pp1 [label="Expert All-Reduce L5 SP0 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep13_tp0_pp1 -> layer_5_expert_ar_sp0_ep13_pp1
	layer_5_expert_out_sp0_ep13_tp1_pp1 -> layer_5_expert_ar_sp0_ep13_pp1
	layer_5_expert_out_sp0_ep13_tp2_pp1 -> layer_5_expert_ar_sp0_ep13_pp1
	layer_5_expert_out_sp0_ep13_tp3_pp1 -> layer_5_expert_ar_sp0_ep13_pp1
	layer_5_combine_sp0_ep13_pp1 [label="Token Combine L5 SP0 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep13_pp1 -> layer_5_combine_sp0_ep13_pp1
	layer_5_dispatch_sp0_ep14_pp1 [label="Token Dispatch L5 SP0 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep14_pp1 [style=dashed]
	layer_5_expert_sp0_ep14_tp0_pp1 [label="Expert L5 SP0 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep14_pp1 -> layer_5_expert_sp0_ep14_tp0_pp1
	layer_5_expert_out_sp0_ep14_tp0_pp1 [label="Expert Out L5 SP0 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep14_tp0_pp1 -> layer_5_expert_out_sp0_ep14_tp0_pp1
	layer_5_expert_sp0_ep14_tp1_pp1 [label="Expert L5 SP0 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep14_pp1 -> layer_5_expert_sp0_ep14_tp1_pp1
	layer_5_expert_out_sp0_ep14_tp1_pp1 [label="Expert Out L5 SP0 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep14_tp1_pp1 -> layer_5_expert_out_sp0_ep14_tp1_pp1
	layer_5_expert_sp0_ep14_tp2_pp1 [label="Expert L5 SP0 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep14_pp1 -> layer_5_expert_sp0_ep14_tp2_pp1
	layer_5_expert_out_sp0_ep14_tp2_pp1 [label="Expert Out L5 SP0 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep14_tp2_pp1 -> layer_5_expert_out_sp0_ep14_tp2_pp1
	layer_5_expert_sp0_ep14_tp3_pp1 [label="Expert L5 SP0 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep14_pp1 -> layer_5_expert_sp0_ep14_tp3_pp1
	layer_5_expert_out_sp0_ep14_tp3_pp1 [label="Expert Out L5 SP0 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep14_tp3_pp1 -> layer_5_expert_out_sp0_ep14_tp3_pp1
	layer_5_expert_ar_sp0_ep14_pp1 [label="Expert All-Reduce L5 SP0 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep14_tp0_pp1 -> layer_5_expert_ar_sp0_ep14_pp1
	layer_5_expert_out_sp0_ep14_tp1_pp1 -> layer_5_expert_ar_sp0_ep14_pp1
	layer_5_expert_out_sp0_ep14_tp2_pp1 -> layer_5_expert_ar_sp0_ep14_pp1
	layer_5_expert_out_sp0_ep14_tp3_pp1 -> layer_5_expert_ar_sp0_ep14_pp1
	layer_5_combine_sp0_ep14_pp1 [label="Token Combine L5 SP0 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep14_pp1 -> layer_5_combine_sp0_ep14_pp1
	layer_5_dispatch_sp0_ep15_pp1 [label="Token Dispatch L5 SP0 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp0_pp1 -> layer_5_dispatch_sp0_ep15_pp1 [style=dashed]
	layer_5_expert_sp0_ep15_tp0_pp1 [label="Expert L5 SP0 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep15_pp1 -> layer_5_expert_sp0_ep15_tp0_pp1
	layer_5_expert_out_sp0_ep15_tp0_pp1 [label="Expert Out L5 SP0 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep15_tp0_pp1 -> layer_5_expert_out_sp0_ep15_tp0_pp1
	layer_5_expert_sp0_ep15_tp1_pp1 [label="Expert L5 SP0 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep15_pp1 -> layer_5_expert_sp0_ep15_tp1_pp1
	layer_5_expert_out_sp0_ep15_tp1_pp1 [label="Expert Out L5 SP0 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep15_tp1_pp1 -> layer_5_expert_out_sp0_ep15_tp1_pp1
	layer_5_expert_sp0_ep15_tp2_pp1 [label="Expert L5 SP0 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep15_pp1 -> layer_5_expert_sp0_ep15_tp2_pp1
	layer_5_expert_out_sp0_ep15_tp2_pp1 [label="Expert Out L5 SP0 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep15_tp2_pp1 -> layer_5_expert_out_sp0_ep15_tp2_pp1
	layer_5_expert_sp0_ep15_tp3_pp1 [label="Expert L5 SP0 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp0_ep15_pp1 -> layer_5_expert_sp0_ep15_tp3_pp1
	layer_5_expert_out_sp0_ep15_tp3_pp1 [label="Expert Out L5 SP0 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp0_ep15_tp3_pp1 -> layer_5_expert_out_sp0_ep15_tp3_pp1
	layer_5_expert_ar_sp0_ep15_pp1 [label="Expert All-Reduce L5 SP0 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp0_ep15_tp0_pp1 -> layer_5_expert_ar_sp0_ep15_pp1
	layer_5_expert_out_sp0_ep15_tp1_pp1 -> layer_5_expert_ar_sp0_ep15_pp1
	layer_5_expert_out_sp0_ep15_tp2_pp1 -> layer_5_expert_ar_sp0_ep15_pp1
	layer_5_expert_out_sp0_ep15_tp3_pp1 -> layer_5_expert_ar_sp0_ep15_pp1
	layer_5_combine_sp0_ep15_pp1 [label="Token Combine L5 SP0 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp0_ep15_pp1 -> layer_5_combine_sp0_ep15_pp1
	layer_5_moe_all2all_sp0_pp1 [label="MoE All-to-All L5 SP0\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_5_combine_sp0_ep0_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep1_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep2_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep3_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep4_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep5_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep6_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep7_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep8_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep9_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep10_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep11_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep12_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep13_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep14_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_combine_sp0_ep15_pp1 -> layer_5_moe_all2all_sp0_pp1
	layer_5_mlp_out_sp0_pp1 [label="MoE Output L5 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_moe_all2all_sp0_pp1 -> layer_5_mlp_out_sp0_pp1
	layer_5_mlp_res_sp0_pp1 [label="MLP Residual L5 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_mlp_out_sp0_pp1 -> layer_5_mlp_res_sp0_pp1
	layer_5_attn_res_sp0_pp1 -> layer_5_mlp_res_sp0_pp1 [style=dashed]
	layer_5_norm_sp1_pp1 [label="LayerNorm L5 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_mlp_out_sp1_pp1 -> layer_5_norm_sp1_pp1
	layer_5_qkv_sp1_tp0_pp1 [label="QKV Proj L5 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp1_pp1 -> layer_5_qkv_sp1_tp0_pp1
	layer_5_attn_sp1_tp0_pp1 [label="Attention L5 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp1_tp0_pp1 -> layer_5_attn_sp1_tp0_pp1
	layer_5_attn_out_sp1_tp0_pp1 [label="Attn Out Proj L5 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp1_tp0_pp1 -> layer_5_attn_out_sp1_tp0_pp1
	layer_5_qkv_sp1_tp1_pp1 [label="QKV Proj L5 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp1_pp1 -> layer_5_qkv_sp1_tp1_pp1
	layer_5_attn_sp1_tp1_pp1 [label="Attention L5 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp1_tp1_pp1 -> layer_5_attn_sp1_tp1_pp1
	layer_5_attn_out_sp1_tp1_pp1 [label="Attn Out Proj L5 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp1_tp1_pp1 -> layer_5_attn_out_sp1_tp1_pp1
	layer_5_qkv_sp1_tp2_pp1 [label="QKV Proj L5 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp1_pp1 -> layer_5_qkv_sp1_tp2_pp1
	layer_5_attn_sp1_tp2_pp1 [label="Attention L5 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp1_tp2_pp1 -> layer_5_attn_sp1_tp2_pp1
	layer_5_attn_out_sp1_tp2_pp1 [label="Attn Out Proj L5 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp1_tp2_pp1 -> layer_5_attn_out_sp1_tp2_pp1
	layer_5_qkv_sp1_tp3_pp1 [label="QKV Proj L5 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp1_pp1 -> layer_5_qkv_sp1_tp3_pp1
	layer_5_attn_sp1_tp3_pp1 [label="Attention L5 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp1_tp3_pp1 -> layer_5_attn_sp1_tp3_pp1
	layer_5_attn_out_sp1_tp3_pp1 [label="Attn Out Proj L5 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp1_tp3_pp1 -> layer_5_attn_out_sp1_tp3_pp1
	layer_5_attn_ar_sp1_pp1 [label="Attention All-Reduce L5 SP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_attn_out_sp1_tp0_pp1 -> layer_5_attn_ar_sp1_pp1
	layer_5_attn_out_sp1_tp1_pp1 -> layer_5_attn_ar_sp1_pp1
	layer_5_attn_out_sp1_tp2_pp1 -> layer_5_attn_ar_sp1_pp1
	layer_5_attn_out_sp1_tp3_pp1 -> layer_5_attn_ar_sp1_pp1
	layer_5_attn_res_sp1_pp1 [label="Attention Residual L5 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_attn_ar_sp1_pp1 -> layer_5_attn_res_sp1_pp1
	layer_5_norm_sp1_pp1 -> layer_5_attn_res_sp1_pp1 [style=dashed]
	layer_5_post_norm_sp1_pp1 [label="Post-Attn Norm L5 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_attn_res_sp1_pp1 -> layer_5_post_norm_sp1_pp1
	layer_5_router_sp1_pp1 [label="MoE Router L5 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_5_post_norm_sp1_pp1 -> layer_5_router_sp1_pp1
	layer_5_dispatch_sp1_ep0_pp1 [label="Token Dispatch L5 SP1 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep0_pp1 [style=dashed]
	layer_5_expert_sp1_ep0_tp0_pp1 [label="Expert L5 SP1 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep0_pp1 -> layer_5_expert_sp1_ep0_tp0_pp1
	layer_5_expert_out_sp1_ep0_tp0_pp1 [label="Expert Out L5 SP1 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep0_tp0_pp1 -> layer_5_expert_out_sp1_ep0_tp0_pp1
	layer_5_expert_sp1_ep0_tp1_pp1 [label="Expert L5 SP1 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep0_pp1 -> layer_5_expert_sp1_ep0_tp1_pp1
	layer_5_expert_out_sp1_ep0_tp1_pp1 [label="Expert Out L5 SP1 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep0_tp1_pp1 -> layer_5_expert_out_sp1_ep0_tp1_pp1
	layer_5_expert_sp1_ep0_tp2_pp1 [label="Expert L5 SP1 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep0_pp1 -> layer_5_expert_sp1_ep0_tp2_pp1
	layer_5_expert_out_sp1_ep0_tp2_pp1 [label="Expert Out L5 SP1 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep0_tp2_pp1 -> layer_5_expert_out_sp1_ep0_tp2_pp1
	layer_5_expert_sp1_ep0_tp3_pp1 [label="Expert L5 SP1 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep0_pp1 -> layer_5_expert_sp1_ep0_tp3_pp1
	layer_5_expert_out_sp1_ep0_tp3_pp1 [label="Expert Out L5 SP1 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep0_tp3_pp1 -> layer_5_expert_out_sp1_ep0_tp3_pp1
	layer_5_expert_ar_sp1_ep0_pp1 [label="Expert All-Reduce L5 SP1 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep0_tp0_pp1 -> layer_5_expert_ar_sp1_ep0_pp1
	layer_5_expert_out_sp1_ep0_tp1_pp1 -> layer_5_expert_ar_sp1_ep0_pp1
	layer_5_expert_out_sp1_ep0_tp2_pp1 -> layer_5_expert_ar_sp1_ep0_pp1
	layer_5_expert_out_sp1_ep0_tp3_pp1 -> layer_5_expert_ar_sp1_ep0_pp1
	layer_5_combine_sp1_ep0_pp1 [label="Token Combine L5 SP1 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep0_pp1 -> layer_5_combine_sp1_ep0_pp1
	layer_5_dispatch_sp1_ep1_pp1 [label="Token Dispatch L5 SP1 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep1_pp1 [style=dashed]
	layer_5_expert_sp1_ep1_tp0_pp1 [label="Expert L5 SP1 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep1_pp1 -> layer_5_expert_sp1_ep1_tp0_pp1
	layer_5_expert_out_sp1_ep1_tp0_pp1 [label="Expert Out L5 SP1 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep1_tp0_pp1 -> layer_5_expert_out_sp1_ep1_tp0_pp1
	layer_5_expert_sp1_ep1_tp1_pp1 [label="Expert L5 SP1 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep1_pp1 -> layer_5_expert_sp1_ep1_tp1_pp1
	layer_5_expert_out_sp1_ep1_tp1_pp1 [label="Expert Out L5 SP1 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep1_tp1_pp1 -> layer_5_expert_out_sp1_ep1_tp1_pp1
	layer_5_expert_sp1_ep1_tp2_pp1 [label="Expert L5 SP1 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep1_pp1 -> layer_5_expert_sp1_ep1_tp2_pp1
	layer_5_expert_out_sp1_ep1_tp2_pp1 [label="Expert Out L5 SP1 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep1_tp2_pp1 -> layer_5_expert_out_sp1_ep1_tp2_pp1
	layer_5_expert_sp1_ep1_tp3_pp1 [label="Expert L5 SP1 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep1_pp1 -> layer_5_expert_sp1_ep1_tp3_pp1
	layer_5_expert_out_sp1_ep1_tp3_pp1 [label="Expert Out L5 SP1 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep1_tp3_pp1 -> layer_5_expert_out_sp1_ep1_tp3_pp1
	layer_5_expert_ar_sp1_ep1_pp1 [label="Expert All-Reduce L5 SP1 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep1_tp0_pp1 -> layer_5_expert_ar_sp1_ep1_pp1
	layer_5_expert_out_sp1_ep1_tp1_pp1 -> layer_5_expert_ar_sp1_ep1_pp1
	layer_5_expert_out_sp1_ep1_tp2_pp1 -> layer_5_expert_ar_sp1_ep1_pp1
	layer_5_expert_out_sp1_ep1_tp3_pp1 -> layer_5_expert_ar_sp1_ep1_pp1
	layer_5_combine_sp1_ep1_pp1 [label="Token Combine L5 SP1 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep1_pp1 -> layer_5_combine_sp1_ep1_pp1
	layer_5_dispatch_sp1_ep2_pp1 [label="Token Dispatch L5 SP1 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep2_pp1 [style=dashed]
	layer_5_expert_sp1_ep2_tp0_pp1 [label="Expert L5 SP1 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep2_pp1 -> layer_5_expert_sp1_ep2_tp0_pp1
	layer_5_expert_out_sp1_ep2_tp0_pp1 [label="Expert Out L5 SP1 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep2_tp0_pp1 -> layer_5_expert_out_sp1_ep2_tp0_pp1
	layer_5_expert_sp1_ep2_tp1_pp1 [label="Expert L5 SP1 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep2_pp1 -> layer_5_expert_sp1_ep2_tp1_pp1
	layer_5_expert_out_sp1_ep2_tp1_pp1 [label="Expert Out L5 SP1 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep2_tp1_pp1 -> layer_5_expert_out_sp1_ep2_tp1_pp1
	layer_5_expert_sp1_ep2_tp2_pp1 [label="Expert L5 SP1 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep2_pp1 -> layer_5_expert_sp1_ep2_tp2_pp1
	layer_5_expert_out_sp1_ep2_tp2_pp1 [label="Expert Out L5 SP1 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep2_tp2_pp1 -> layer_5_expert_out_sp1_ep2_tp2_pp1
	layer_5_expert_sp1_ep2_tp3_pp1 [label="Expert L5 SP1 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep2_pp1 -> layer_5_expert_sp1_ep2_tp3_pp1
	layer_5_expert_out_sp1_ep2_tp3_pp1 [label="Expert Out L5 SP1 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep2_tp3_pp1 -> layer_5_expert_out_sp1_ep2_tp3_pp1
	layer_5_expert_ar_sp1_ep2_pp1 [label="Expert All-Reduce L5 SP1 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep2_tp0_pp1 -> layer_5_expert_ar_sp1_ep2_pp1
	layer_5_expert_out_sp1_ep2_tp1_pp1 -> layer_5_expert_ar_sp1_ep2_pp1
	layer_5_expert_out_sp1_ep2_tp2_pp1 -> layer_5_expert_ar_sp1_ep2_pp1
	layer_5_expert_out_sp1_ep2_tp3_pp1 -> layer_5_expert_ar_sp1_ep2_pp1
	layer_5_combine_sp1_ep2_pp1 [label="Token Combine L5 SP1 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep2_pp1 -> layer_5_combine_sp1_ep2_pp1
	layer_5_dispatch_sp1_ep3_pp1 [label="Token Dispatch L5 SP1 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep3_pp1 [style=dashed]
	layer_5_expert_sp1_ep3_tp0_pp1 [label="Expert L5 SP1 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep3_pp1 -> layer_5_expert_sp1_ep3_tp0_pp1
	layer_5_expert_out_sp1_ep3_tp0_pp1 [label="Expert Out L5 SP1 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep3_tp0_pp1 -> layer_5_expert_out_sp1_ep3_tp0_pp1
	layer_5_expert_sp1_ep3_tp1_pp1 [label="Expert L5 SP1 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep3_pp1 -> layer_5_expert_sp1_ep3_tp1_pp1
	layer_5_expert_out_sp1_ep3_tp1_pp1 [label="Expert Out L5 SP1 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep3_tp1_pp1 -> layer_5_expert_out_sp1_ep3_tp1_pp1
	layer_5_expert_sp1_ep3_tp2_pp1 [label="Expert L5 SP1 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep3_pp1 -> layer_5_expert_sp1_ep3_tp2_pp1
	layer_5_expert_out_sp1_ep3_tp2_pp1 [label="Expert Out L5 SP1 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep3_tp2_pp1 -> layer_5_expert_out_sp1_ep3_tp2_pp1
	layer_5_expert_sp1_ep3_tp3_pp1 [label="Expert L5 SP1 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep3_pp1 -> layer_5_expert_sp1_ep3_tp3_pp1
	layer_5_expert_out_sp1_ep3_tp3_pp1 [label="Expert Out L5 SP1 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep3_tp3_pp1 -> layer_5_expert_out_sp1_ep3_tp3_pp1
	layer_5_expert_ar_sp1_ep3_pp1 [label="Expert All-Reduce L5 SP1 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep3_tp0_pp1 -> layer_5_expert_ar_sp1_ep3_pp1
	layer_5_expert_out_sp1_ep3_tp1_pp1 -> layer_5_expert_ar_sp1_ep3_pp1
	layer_5_expert_out_sp1_ep3_tp2_pp1 -> layer_5_expert_ar_sp1_ep3_pp1
	layer_5_expert_out_sp1_ep3_tp3_pp1 -> layer_5_expert_ar_sp1_ep3_pp1
	layer_5_combine_sp1_ep3_pp1 [label="Token Combine L5 SP1 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep3_pp1 -> layer_5_combine_sp1_ep3_pp1
	layer_5_dispatch_sp1_ep4_pp1 [label="Token Dispatch L5 SP1 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep4_pp1 [style=dashed]
	layer_5_expert_sp1_ep4_tp0_pp1 [label="Expert L5 SP1 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep4_pp1 -> layer_5_expert_sp1_ep4_tp0_pp1
	layer_5_expert_out_sp1_ep4_tp0_pp1 [label="Expert Out L5 SP1 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep4_tp0_pp1 -> layer_5_expert_out_sp1_ep4_tp0_pp1
	layer_5_expert_sp1_ep4_tp1_pp1 [label="Expert L5 SP1 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep4_pp1 -> layer_5_expert_sp1_ep4_tp1_pp1
	layer_5_expert_out_sp1_ep4_tp1_pp1 [label="Expert Out L5 SP1 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep4_tp1_pp1 -> layer_5_expert_out_sp1_ep4_tp1_pp1
	layer_5_expert_sp1_ep4_tp2_pp1 [label="Expert L5 SP1 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep4_pp1 -> layer_5_expert_sp1_ep4_tp2_pp1
	layer_5_expert_out_sp1_ep4_tp2_pp1 [label="Expert Out L5 SP1 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep4_tp2_pp1 -> layer_5_expert_out_sp1_ep4_tp2_pp1
	layer_5_expert_sp1_ep4_tp3_pp1 [label="Expert L5 SP1 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep4_pp1 -> layer_5_expert_sp1_ep4_tp3_pp1
	layer_5_expert_out_sp1_ep4_tp3_pp1 [label="Expert Out L5 SP1 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep4_tp3_pp1 -> layer_5_expert_out_sp1_ep4_tp3_pp1
	layer_5_expert_ar_sp1_ep4_pp1 [label="Expert All-Reduce L5 SP1 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep4_tp0_pp1 -> layer_5_expert_ar_sp1_ep4_pp1
	layer_5_expert_out_sp1_ep4_tp1_pp1 -> layer_5_expert_ar_sp1_ep4_pp1
	layer_5_expert_out_sp1_ep4_tp2_pp1 -> layer_5_expert_ar_sp1_ep4_pp1
	layer_5_expert_out_sp1_ep4_tp3_pp1 -> layer_5_expert_ar_sp1_ep4_pp1
	layer_5_combine_sp1_ep4_pp1 [label="Token Combine L5 SP1 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep4_pp1 -> layer_5_combine_sp1_ep4_pp1
	layer_5_dispatch_sp1_ep5_pp1 [label="Token Dispatch L5 SP1 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep5_pp1 [style=dashed]
	layer_5_expert_sp1_ep5_tp0_pp1 [label="Expert L5 SP1 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep5_pp1 -> layer_5_expert_sp1_ep5_tp0_pp1
	layer_5_expert_out_sp1_ep5_tp0_pp1 [label="Expert Out L5 SP1 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep5_tp0_pp1 -> layer_5_expert_out_sp1_ep5_tp0_pp1
	layer_5_expert_sp1_ep5_tp1_pp1 [label="Expert L5 SP1 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep5_pp1 -> layer_5_expert_sp1_ep5_tp1_pp1
	layer_5_expert_out_sp1_ep5_tp1_pp1 [label="Expert Out L5 SP1 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep5_tp1_pp1 -> layer_5_expert_out_sp1_ep5_tp1_pp1
	layer_5_expert_sp1_ep5_tp2_pp1 [label="Expert L5 SP1 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep5_pp1 -> layer_5_expert_sp1_ep5_tp2_pp1
	layer_5_expert_out_sp1_ep5_tp2_pp1 [label="Expert Out L5 SP1 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep5_tp2_pp1 -> layer_5_expert_out_sp1_ep5_tp2_pp1
	layer_5_expert_sp1_ep5_tp3_pp1 [label="Expert L5 SP1 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep5_pp1 -> layer_5_expert_sp1_ep5_tp3_pp1
	layer_5_expert_out_sp1_ep5_tp3_pp1 [label="Expert Out L5 SP1 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep5_tp3_pp1 -> layer_5_expert_out_sp1_ep5_tp3_pp1
	layer_5_expert_ar_sp1_ep5_pp1 [label="Expert All-Reduce L5 SP1 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep5_tp0_pp1 -> layer_5_expert_ar_sp1_ep5_pp1
	layer_5_expert_out_sp1_ep5_tp1_pp1 -> layer_5_expert_ar_sp1_ep5_pp1
	layer_5_expert_out_sp1_ep5_tp2_pp1 -> layer_5_expert_ar_sp1_ep5_pp1
	layer_5_expert_out_sp1_ep5_tp3_pp1 -> layer_5_expert_ar_sp1_ep5_pp1
	layer_5_combine_sp1_ep5_pp1 [label="Token Combine L5 SP1 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep5_pp1 -> layer_5_combine_sp1_ep5_pp1
	layer_5_dispatch_sp1_ep6_pp1 [label="Token Dispatch L5 SP1 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep6_pp1 [style=dashed]
	layer_5_expert_sp1_ep6_tp0_pp1 [label="Expert L5 SP1 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep6_pp1 -> layer_5_expert_sp1_ep6_tp0_pp1
	layer_5_expert_out_sp1_ep6_tp0_pp1 [label="Expert Out L5 SP1 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep6_tp0_pp1 -> layer_5_expert_out_sp1_ep6_tp0_pp1
	layer_5_expert_sp1_ep6_tp1_pp1 [label="Expert L5 SP1 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep6_pp1 -> layer_5_expert_sp1_ep6_tp1_pp1
	layer_5_expert_out_sp1_ep6_tp1_pp1 [label="Expert Out L5 SP1 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep6_tp1_pp1 -> layer_5_expert_out_sp1_ep6_tp1_pp1
	layer_5_expert_sp1_ep6_tp2_pp1 [label="Expert L5 SP1 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep6_pp1 -> layer_5_expert_sp1_ep6_tp2_pp1
	layer_5_expert_out_sp1_ep6_tp2_pp1 [label="Expert Out L5 SP1 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep6_tp2_pp1 -> layer_5_expert_out_sp1_ep6_tp2_pp1
	layer_5_expert_sp1_ep6_tp3_pp1 [label="Expert L5 SP1 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep6_pp1 -> layer_5_expert_sp1_ep6_tp3_pp1
	layer_5_expert_out_sp1_ep6_tp3_pp1 [label="Expert Out L5 SP1 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep6_tp3_pp1 -> layer_5_expert_out_sp1_ep6_tp3_pp1
	layer_5_expert_ar_sp1_ep6_pp1 [label="Expert All-Reduce L5 SP1 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep6_tp0_pp1 -> layer_5_expert_ar_sp1_ep6_pp1
	layer_5_expert_out_sp1_ep6_tp1_pp1 -> layer_5_expert_ar_sp1_ep6_pp1
	layer_5_expert_out_sp1_ep6_tp2_pp1 -> layer_5_expert_ar_sp1_ep6_pp1
	layer_5_expert_out_sp1_ep6_tp3_pp1 -> layer_5_expert_ar_sp1_ep6_pp1
	layer_5_combine_sp1_ep6_pp1 [label="Token Combine L5 SP1 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep6_pp1 -> layer_5_combine_sp1_ep6_pp1
	layer_5_dispatch_sp1_ep7_pp1 [label="Token Dispatch L5 SP1 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep7_pp1 [style=dashed]
	layer_5_expert_sp1_ep7_tp0_pp1 [label="Expert L5 SP1 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep7_pp1 -> layer_5_expert_sp1_ep7_tp0_pp1
	layer_5_expert_out_sp1_ep7_tp0_pp1 [label="Expert Out L5 SP1 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep7_tp0_pp1 -> layer_5_expert_out_sp1_ep7_tp0_pp1
	layer_5_expert_sp1_ep7_tp1_pp1 [label="Expert L5 SP1 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep7_pp1 -> layer_5_expert_sp1_ep7_tp1_pp1
	layer_5_expert_out_sp1_ep7_tp1_pp1 [label="Expert Out L5 SP1 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep7_tp1_pp1 -> layer_5_expert_out_sp1_ep7_tp1_pp1
	layer_5_expert_sp1_ep7_tp2_pp1 [label="Expert L5 SP1 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep7_pp1 -> layer_5_expert_sp1_ep7_tp2_pp1
	layer_5_expert_out_sp1_ep7_tp2_pp1 [label="Expert Out L5 SP1 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep7_tp2_pp1 -> layer_5_expert_out_sp1_ep7_tp2_pp1
	layer_5_expert_sp1_ep7_tp3_pp1 [label="Expert L5 SP1 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep7_pp1 -> layer_5_expert_sp1_ep7_tp3_pp1
	layer_5_expert_out_sp1_ep7_tp3_pp1 [label="Expert Out L5 SP1 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep7_tp3_pp1 -> layer_5_expert_out_sp1_ep7_tp3_pp1
	layer_5_expert_ar_sp1_ep7_pp1 [label="Expert All-Reduce L5 SP1 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep7_tp0_pp1 -> layer_5_expert_ar_sp1_ep7_pp1
	layer_5_expert_out_sp1_ep7_tp1_pp1 -> layer_5_expert_ar_sp1_ep7_pp1
	layer_5_expert_out_sp1_ep7_tp2_pp1 -> layer_5_expert_ar_sp1_ep7_pp1
	layer_5_expert_out_sp1_ep7_tp3_pp1 -> layer_5_expert_ar_sp1_ep7_pp1
	layer_5_combine_sp1_ep7_pp1 [label="Token Combine L5 SP1 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep7_pp1 -> layer_5_combine_sp1_ep7_pp1
	layer_5_dispatch_sp1_ep8_pp1 [label="Token Dispatch L5 SP1 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep8_pp1 [style=dashed]
	layer_5_expert_sp1_ep8_tp0_pp1 [label="Expert L5 SP1 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep8_pp1 -> layer_5_expert_sp1_ep8_tp0_pp1
	layer_5_expert_out_sp1_ep8_tp0_pp1 [label="Expert Out L5 SP1 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep8_tp0_pp1 -> layer_5_expert_out_sp1_ep8_tp0_pp1
	layer_5_expert_sp1_ep8_tp1_pp1 [label="Expert L5 SP1 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep8_pp1 -> layer_5_expert_sp1_ep8_tp1_pp1
	layer_5_expert_out_sp1_ep8_tp1_pp1 [label="Expert Out L5 SP1 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep8_tp1_pp1 -> layer_5_expert_out_sp1_ep8_tp1_pp1
	layer_5_expert_sp1_ep8_tp2_pp1 [label="Expert L5 SP1 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep8_pp1 -> layer_5_expert_sp1_ep8_tp2_pp1
	layer_5_expert_out_sp1_ep8_tp2_pp1 [label="Expert Out L5 SP1 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep8_tp2_pp1 -> layer_5_expert_out_sp1_ep8_tp2_pp1
	layer_5_expert_sp1_ep8_tp3_pp1 [label="Expert L5 SP1 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep8_pp1 -> layer_5_expert_sp1_ep8_tp3_pp1
	layer_5_expert_out_sp1_ep8_tp3_pp1 [label="Expert Out L5 SP1 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep8_tp3_pp1 -> layer_5_expert_out_sp1_ep8_tp3_pp1
	layer_5_expert_ar_sp1_ep8_pp1 [label="Expert All-Reduce L5 SP1 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep8_tp0_pp1 -> layer_5_expert_ar_sp1_ep8_pp1
	layer_5_expert_out_sp1_ep8_tp1_pp1 -> layer_5_expert_ar_sp1_ep8_pp1
	layer_5_expert_out_sp1_ep8_tp2_pp1 -> layer_5_expert_ar_sp1_ep8_pp1
	layer_5_expert_out_sp1_ep8_tp3_pp1 -> layer_5_expert_ar_sp1_ep8_pp1
	layer_5_combine_sp1_ep8_pp1 [label="Token Combine L5 SP1 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep8_pp1 -> layer_5_combine_sp1_ep8_pp1
	layer_5_dispatch_sp1_ep9_pp1 [label="Token Dispatch L5 SP1 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep9_pp1 [style=dashed]
	layer_5_expert_sp1_ep9_tp0_pp1 [label="Expert L5 SP1 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep9_pp1 -> layer_5_expert_sp1_ep9_tp0_pp1
	layer_5_expert_out_sp1_ep9_tp0_pp1 [label="Expert Out L5 SP1 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep9_tp0_pp1 -> layer_5_expert_out_sp1_ep9_tp0_pp1
	layer_5_expert_sp1_ep9_tp1_pp1 [label="Expert L5 SP1 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep9_pp1 -> layer_5_expert_sp1_ep9_tp1_pp1
	layer_5_expert_out_sp1_ep9_tp1_pp1 [label="Expert Out L5 SP1 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep9_tp1_pp1 -> layer_5_expert_out_sp1_ep9_tp1_pp1
	layer_5_expert_sp1_ep9_tp2_pp1 [label="Expert L5 SP1 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep9_pp1 -> layer_5_expert_sp1_ep9_tp2_pp1
	layer_5_expert_out_sp1_ep9_tp2_pp1 [label="Expert Out L5 SP1 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep9_tp2_pp1 -> layer_5_expert_out_sp1_ep9_tp2_pp1
	layer_5_expert_sp1_ep9_tp3_pp1 [label="Expert L5 SP1 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep9_pp1 -> layer_5_expert_sp1_ep9_tp3_pp1
	layer_5_expert_out_sp1_ep9_tp3_pp1 [label="Expert Out L5 SP1 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep9_tp3_pp1 -> layer_5_expert_out_sp1_ep9_tp3_pp1
	layer_5_expert_ar_sp1_ep9_pp1 [label="Expert All-Reduce L5 SP1 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep9_tp0_pp1 -> layer_5_expert_ar_sp1_ep9_pp1
	layer_5_expert_out_sp1_ep9_tp1_pp1 -> layer_5_expert_ar_sp1_ep9_pp1
	layer_5_expert_out_sp1_ep9_tp2_pp1 -> layer_5_expert_ar_sp1_ep9_pp1
	layer_5_expert_out_sp1_ep9_tp3_pp1 -> layer_5_expert_ar_sp1_ep9_pp1
	layer_5_combine_sp1_ep9_pp1 [label="Token Combine L5 SP1 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep9_pp1 -> layer_5_combine_sp1_ep9_pp1
	layer_5_dispatch_sp1_ep10_pp1 [label="Token Dispatch L5 SP1 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep10_pp1 [style=dashed]
	layer_5_expert_sp1_ep10_tp0_pp1 [label="Expert L5 SP1 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep10_pp1 -> layer_5_expert_sp1_ep10_tp0_pp1
	layer_5_expert_out_sp1_ep10_tp0_pp1 [label="Expert Out L5 SP1 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep10_tp0_pp1 -> layer_5_expert_out_sp1_ep10_tp0_pp1
	layer_5_expert_sp1_ep10_tp1_pp1 [label="Expert L5 SP1 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep10_pp1 -> layer_5_expert_sp1_ep10_tp1_pp1
	layer_5_expert_out_sp1_ep10_tp1_pp1 [label="Expert Out L5 SP1 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep10_tp1_pp1 -> layer_5_expert_out_sp1_ep10_tp1_pp1
	layer_5_expert_sp1_ep10_tp2_pp1 [label="Expert L5 SP1 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep10_pp1 -> layer_5_expert_sp1_ep10_tp2_pp1
	layer_5_expert_out_sp1_ep10_tp2_pp1 [label="Expert Out L5 SP1 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep10_tp2_pp1 -> layer_5_expert_out_sp1_ep10_tp2_pp1
	layer_5_expert_sp1_ep10_tp3_pp1 [label="Expert L5 SP1 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep10_pp1 -> layer_5_expert_sp1_ep10_tp3_pp1
	layer_5_expert_out_sp1_ep10_tp3_pp1 [label="Expert Out L5 SP1 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep10_tp3_pp1 -> layer_5_expert_out_sp1_ep10_tp3_pp1
	layer_5_expert_ar_sp1_ep10_pp1 [label="Expert All-Reduce L5 SP1 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep10_tp0_pp1 -> layer_5_expert_ar_sp1_ep10_pp1
	layer_5_expert_out_sp1_ep10_tp1_pp1 -> layer_5_expert_ar_sp1_ep10_pp1
	layer_5_expert_out_sp1_ep10_tp2_pp1 -> layer_5_expert_ar_sp1_ep10_pp1
	layer_5_expert_out_sp1_ep10_tp3_pp1 -> layer_5_expert_ar_sp1_ep10_pp1
	layer_5_combine_sp1_ep10_pp1 [label="Token Combine L5 SP1 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep10_pp1 -> layer_5_combine_sp1_ep10_pp1
	layer_5_dispatch_sp1_ep11_pp1 [label="Token Dispatch L5 SP1 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep11_pp1 [style=dashed]
	layer_5_expert_sp1_ep11_tp0_pp1 [label="Expert L5 SP1 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep11_pp1 -> layer_5_expert_sp1_ep11_tp0_pp1
	layer_5_expert_out_sp1_ep11_tp0_pp1 [label="Expert Out L5 SP1 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep11_tp0_pp1 -> layer_5_expert_out_sp1_ep11_tp0_pp1
	layer_5_expert_sp1_ep11_tp1_pp1 [label="Expert L5 SP1 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep11_pp1 -> layer_5_expert_sp1_ep11_tp1_pp1
	layer_5_expert_out_sp1_ep11_tp1_pp1 [label="Expert Out L5 SP1 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep11_tp1_pp1 -> layer_5_expert_out_sp1_ep11_tp1_pp1
	layer_5_expert_sp1_ep11_tp2_pp1 [label="Expert L5 SP1 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep11_pp1 -> layer_5_expert_sp1_ep11_tp2_pp1
	layer_5_expert_out_sp1_ep11_tp2_pp1 [label="Expert Out L5 SP1 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep11_tp2_pp1 -> layer_5_expert_out_sp1_ep11_tp2_pp1
	layer_5_expert_sp1_ep11_tp3_pp1 [label="Expert L5 SP1 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep11_pp1 -> layer_5_expert_sp1_ep11_tp3_pp1
	layer_5_expert_out_sp1_ep11_tp3_pp1 [label="Expert Out L5 SP1 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep11_tp3_pp1 -> layer_5_expert_out_sp1_ep11_tp3_pp1
	layer_5_expert_ar_sp1_ep11_pp1 [label="Expert All-Reduce L5 SP1 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep11_tp0_pp1 -> layer_5_expert_ar_sp1_ep11_pp1
	layer_5_expert_out_sp1_ep11_tp1_pp1 -> layer_5_expert_ar_sp1_ep11_pp1
	layer_5_expert_out_sp1_ep11_tp2_pp1 -> layer_5_expert_ar_sp1_ep11_pp1
	layer_5_expert_out_sp1_ep11_tp3_pp1 -> layer_5_expert_ar_sp1_ep11_pp1
	layer_5_combine_sp1_ep11_pp1 [label="Token Combine L5 SP1 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep11_pp1 -> layer_5_combine_sp1_ep11_pp1
	layer_5_dispatch_sp1_ep12_pp1 [label="Token Dispatch L5 SP1 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep12_pp1 [style=dashed]
	layer_5_expert_sp1_ep12_tp0_pp1 [label="Expert L5 SP1 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep12_pp1 -> layer_5_expert_sp1_ep12_tp0_pp1
	layer_5_expert_out_sp1_ep12_tp0_pp1 [label="Expert Out L5 SP1 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep12_tp0_pp1 -> layer_5_expert_out_sp1_ep12_tp0_pp1
	layer_5_expert_sp1_ep12_tp1_pp1 [label="Expert L5 SP1 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep12_pp1 -> layer_5_expert_sp1_ep12_tp1_pp1
	layer_5_expert_out_sp1_ep12_tp1_pp1 [label="Expert Out L5 SP1 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep12_tp1_pp1 -> layer_5_expert_out_sp1_ep12_tp1_pp1
	layer_5_expert_sp1_ep12_tp2_pp1 [label="Expert L5 SP1 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep12_pp1 -> layer_5_expert_sp1_ep12_tp2_pp1
	layer_5_expert_out_sp1_ep12_tp2_pp1 [label="Expert Out L5 SP1 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep12_tp2_pp1 -> layer_5_expert_out_sp1_ep12_tp2_pp1
	layer_5_expert_sp1_ep12_tp3_pp1 [label="Expert L5 SP1 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep12_pp1 -> layer_5_expert_sp1_ep12_tp3_pp1
	layer_5_expert_out_sp1_ep12_tp3_pp1 [label="Expert Out L5 SP1 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep12_tp3_pp1 -> layer_5_expert_out_sp1_ep12_tp3_pp1
	layer_5_expert_ar_sp1_ep12_pp1 [label="Expert All-Reduce L5 SP1 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep12_tp0_pp1 -> layer_5_expert_ar_sp1_ep12_pp1
	layer_5_expert_out_sp1_ep12_tp1_pp1 -> layer_5_expert_ar_sp1_ep12_pp1
	layer_5_expert_out_sp1_ep12_tp2_pp1 -> layer_5_expert_ar_sp1_ep12_pp1
	layer_5_expert_out_sp1_ep12_tp3_pp1 -> layer_5_expert_ar_sp1_ep12_pp1
	layer_5_combine_sp1_ep12_pp1 [label="Token Combine L5 SP1 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep12_pp1 -> layer_5_combine_sp1_ep12_pp1
	layer_5_dispatch_sp1_ep13_pp1 [label="Token Dispatch L5 SP1 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep13_pp1 [style=dashed]
	layer_5_expert_sp1_ep13_tp0_pp1 [label="Expert L5 SP1 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep13_pp1 -> layer_5_expert_sp1_ep13_tp0_pp1
	layer_5_expert_out_sp1_ep13_tp0_pp1 [label="Expert Out L5 SP1 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep13_tp0_pp1 -> layer_5_expert_out_sp1_ep13_tp0_pp1
	layer_5_expert_sp1_ep13_tp1_pp1 [label="Expert L5 SP1 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep13_pp1 -> layer_5_expert_sp1_ep13_tp1_pp1
	layer_5_expert_out_sp1_ep13_tp1_pp1 [label="Expert Out L5 SP1 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep13_tp1_pp1 -> layer_5_expert_out_sp1_ep13_tp1_pp1
	layer_5_expert_sp1_ep13_tp2_pp1 [label="Expert L5 SP1 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep13_pp1 -> layer_5_expert_sp1_ep13_tp2_pp1
	layer_5_expert_out_sp1_ep13_tp2_pp1 [label="Expert Out L5 SP1 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep13_tp2_pp1 -> layer_5_expert_out_sp1_ep13_tp2_pp1
	layer_5_expert_sp1_ep13_tp3_pp1 [label="Expert L5 SP1 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep13_pp1 -> layer_5_expert_sp1_ep13_tp3_pp1
	layer_5_expert_out_sp1_ep13_tp3_pp1 [label="Expert Out L5 SP1 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep13_tp3_pp1 -> layer_5_expert_out_sp1_ep13_tp3_pp1
	layer_5_expert_ar_sp1_ep13_pp1 [label="Expert All-Reduce L5 SP1 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep13_tp0_pp1 -> layer_5_expert_ar_sp1_ep13_pp1
	layer_5_expert_out_sp1_ep13_tp1_pp1 -> layer_5_expert_ar_sp1_ep13_pp1
	layer_5_expert_out_sp1_ep13_tp2_pp1 -> layer_5_expert_ar_sp1_ep13_pp1
	layer_5_expert_out_sp1_ep13_tp3_pp1 -> layer_5_expert_ar_sp1_ep13_pp1
	layer_5_combine_sp1_ep13_pp1 [label="Token Combine L5 SP1 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep13_pp1 -> layer_5_combine_sp1_ep13_pp1
	layer_5_dispatch_sp1_ep14_pp1 [label="Token Dispatch L5 SP1 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep14_pp1 [style=dashed]
	layer_5_expert_sp1_ep14_tp0_pp1 [label="Expert L5 SP1 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep14_pp1 -> layer_5_expert_sp1_ep14_tp0_pp1
	layer_5_expert_out_sp1_ep14_tp0_pp1 [label="Expert Out L5 SP1 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep14_tp0_pp1 -> layer_5_expert_out_sp1_ep14_tp0_pp1
	layer_5_expert_sp1_ep14_tp1_pp1 [label="Expert L5 SP1 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep14_pp1 -> layer_5_expert_sp1_ep14_tp1_pp1
	layer_5_expert_out_sp1_ep14_tp1_pp1 [label="Expert Out L5 SP1 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep14_tp1_pp1 -> layer_5_expert_out_sp1_ep14_tp1_pp1
	layer_5_expert_sp1_ep14_tp2_pp1 [label="Expert L5 SP1 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep14_pp1 -> layer_5_expert_sp1_ep14_tp2_pp1
	layer_5_expert_out_sp1_ep14_tp2_pp1 [label="Expert Out L5 SP1 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep14_tp2_pp1 -> layer_5_expert_out_sp1_ep14_tp2_pp1
	layer_5_expert_sp1_ep14_tp3_pp1 [label="Expert L5 SP1 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep14_pp1 -> layer_5_expert_sp1_ep14_tp3_pp1
	layer_5_expert_out_sp1_ep14_tp3_pp1 [label="Expert Out L5 SP1 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep14_tp3_pp1 -> layer_5_expert_out_sp1_ep14_tp3_pp1
	layer_5_expert_ar_sp1_ep14_pp1 [label="Expert All-Reduce L5 SP1 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep14_tp0_pp1 -> layer_5_expert_ar_sp1_ep14_pp1
	layer_5_expert_out_sp1_ep14_tp1_pp1 -> layer_5_expert_ar_sp1_ep14_pp1
	layer_5_expert_out_sp1_ep14_tp2_pp1 -> layer_5_expert_ar_sp1_ep14_pp1
	layer_5_expert_out_sp1_ep14_tp3_pp1 -> layer_5_expert_ar_sp1_ep14_pp1
	layer_5_combine_sp1_ep14_pp1 [label="Token Combine L5 SP1 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep14_pp1 -> layer_5_combine_sp1_ep14_pp1
	layer_5_dispatch_sp1_ep15_pp1 [label="Token Dispatch L5 SP1 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp1_pp1 -> layer_5_dispatch_sp1_ep15_pp1 [style=dashed]
	layer_5_expert_sp1_ep15_tp0_pp1 [label="Expert L5 SP1 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep15_pp1 -> layer_5_expert_sp1_ep15_tp0_pp1
	layer_5_expert_out_sp1_ep15_tp0_pp1 [label="Expert Out L5 SP1 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep15_tp0_pp1 -> layer_5_expert_out_sp1_ep15_tp0_pp1
	layer_5_expert_sp1_ep15_tp1_pp1 [label="Expert L5 SP1 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep15_pp1 -> layer_5_expert_sp1_ep15_tp1_pp1
	layer_5_expert_out_sp1_ep15_tp1_pp1 [label="Expert Out L5 SP1 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep15_tp1_pp1 -> layer_5_expert_out_sp1_ep15_tp1_pp1
	layer_5_expert_sp1_ep15_tp2_pp1 [label="Expert L5 SP1 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep15_pp1 -> layer_5_expert_sp1_ep15_tp2_pp1
	layer_5_expert_out_sp1_ep15_tp2_pp1 [label="Expert Out L5 SP1 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep15_tp2_pp1 -> layer_5_expert_out_sp1_ep15_tp2_pp1
	layer_5_expert_sp1_ep15_tp3_pp1 [label="Expert L5 SP1 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp1_ep15_pp1 -> layer_5_expert_sp1_ep15_tp3_pp1
	layer_5_expert_out_sp1_ep15_tp3_pp1 [label="Expert Out L5 SP1 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp1_ep15_tp3_pp1 -> layer_5_expert_out_sp1_ep15_tp3_pp1
	layer_5_expert_ar_sp1_ep15_pp1 [label="Expert All-Reduce L5 SP1 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp1_ep15_tp0_pp1 -> layer_5_expert_ar_sp1_ep15_pp1
	layer_5_expert_out_sp1_ep15_tp1_pp1 -> layer_5_expert_ar_sp1_ep15_pp1
	layer_5_expert_out_sp1_ep15_tp2_pp1 -> layer_5_expert_ar_sp1_ep15_pp1
	layer_5_expert_out_sp1_ep15_tp3_pp1 -> layer_5_expert_ar_sp1_ep15_pp1
	layer_5_combine_sp1_ep15_pp1 [label="Token Combine L5 SP1 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp1_ep15_pp1 -> layer_5_combine_sp1_ep15_pp1
	layer_5_moe_all2all_sp1_pp1 [label="MoE All-to-All L5 SP1\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_5_combine_sp1_ep0_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep1_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep2_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep3_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep4_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep5_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep6_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep7_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep8_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep9_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep10_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep11_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep12_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep13_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep14_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_combine_sp1_ep15_pp1 -> layer_5_moe_all2all_sp1_pp1
	layer_5_mlp_out_sp1_pp1 [label="MoE Output L5 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_moe_all2all_sp1_pp1 -> layer_5_mlp_out_sp1_pp1
	layer_5_mlp_res_sp1_pp1 [label="MLP Residual L5 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_mlp_out_sp1_pp1 -> layer_5_mlp_res_sp1_pp1
	layer_5_attn_res_sp1_pp1 -> layer_5_mlp_res_sp1_pp1 [style=dashed]
	layer_5_norm_sp2_pp1 [label="LayerNorm L5 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_mlp_out_sp2_pp1 -> layer_5_norm_sp2_pp1
	layer_5_qkv_sp2_tp0_pp1 [label="QKV Proj L5 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp2_pp1 -> layer_5_qkv_sp2_tp0_pp1
	layer_5_attn_sp2_tp0_pp1 [label="Attention L5 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp2_tp0_pp1 -> layer_5_attn_sp2_tp0_pp1
	layer_5_attn_out_sp2_tp0_pp1 [label="Attn Out Proj L5 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp2_tp0_pp1 -> layer_5_attn_out_sp2_tp0_pp1
	layer_5_qkv_sp2_tp1_pp1 [label="QKV Proj L5 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp2_pp1 -> layer_5_qkv_sp2_tp1_pp1
	layer_5_attn_sp2_tp1_pp1 [label="Attention L5 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp2_tp1_pp1 -> layer_5_attn_sp2_tp1_pp1
	layer_5_attn_out_sp2_tp1_pp1 [label="Attn Out Proj L5 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp2_tp1_pp1 -> layer_5_attn_out_sp2_tp1_pp1
	layer_5_qkv_sp2_tp2_pp1 [label="QKV Proj L5 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp2_pp1 -> layer_5_qkv_sp2_tp2_pp1
	layer_5_attn_sp2_tp2_pp1 [label="Attention L5 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp2_tp2_pp1 -> layer_5_attn_sp2_tp2_pp1
	layer_5_attn_out_sp2_tp2_pp1 [label="Attn Out Proj L5 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp2_tp2_pp1 -> layer_5_attn_out_sp2_tp2_pp1
	layer_5_qkv_sp2_tp3_pp1 [label="QKV Proj L5 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp2_pp1 -> layer_5_qkv_sp2_tp3_pp1
	layer_5_attn_sp2_tp3_pp1 [label="Attention L5 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp2_tp3_pp1 -> layer_5_attn_sp2_tp3_pp1
	layer_5_attn_out_sp2_tp3_pp1 [label="Attn Out Proj L5 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp2_tp3_pp1 -> layer_5_attn_out_sp2_tp3_pp1
	layer_5_attn_ar_sp2_pp1 [label="Attention All-Reduce L5 SP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_attn_out_sp2_tp0_pp1 -> layer_5_attn_ar_sp2_pp1
	layer_5_attn_out_sp2_tp1_pp1 -> layer_5_attn_ar_sp2_pp1
	layer_5_attn_out_sp2_tp2_pp1 -> layer_5_attn_ar_sp2_pp1
	layer_5_attn_out_sp2_tp3_pp1 -> layer_5_attn_ar_sp2_pp1
	layer_5_attn_res_sp2_pp1 [label="Attention Residual L5 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_attn_ar_sp2_pp1 -> layer_5_attn_res_sp2_pp1
	layer_5_norm_sp2_pp1 -> layer_5_attn_res_sp2_pp1 [style=dashed]
	layer_5_post_norm_sp2_pp1 [label="Post-Attn Norm L5 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_attn_res_sp2_pp1 -> layer_5_post_norm_sp2_pp1
	layer_5_router_sp2_pp1 [label="MoE Router L5 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_5_post_norm_sp2_pp1 -> layer_5_router_sp2_pp1
	layer_5_dispatch_sp2_ep0_pp1 [label="Token Dispatch L5 SP2 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep0_pp1 [style=dashed]
	layer_5_expert_sp2_ep0_tp0_pp1 [label="Expert L5 SP2 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep0_pp1 -> layer_5_expert_sp2_ep0_tp0_pp1
	layer_5_expert_out_sp2_ep0_tp0_pp1 [label="Expert Out L5 SP2 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep0_tp0_pp1 -> layer_5_expert_out_sp2_ep0_tp0_pp1
	layer_5_expert_sp2_ep0_tp1_pp1 [label="Expert L5 SP2 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep0_pp1 -> layer_5_expert_sp2_ep0_tp1_pp1
	layer_5_expert_out_sp2_ep0_tp1_pp1 [label="Expert Out L5 SP2 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep0_tp1_pp1 -> layer_5_expert_out_sp2_ep0_tp1_pp1
	layer_5_expert_sp2_ep0_tp2_pp1 [label="Expert L5 SP2 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep0_pp1 -> layer_5_expert_sp2_ep0_tp2_pp1
	layer_5_expert_out_sp2_ep0_tp2_pp1 [label="Expert Out L5 SP2 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep0_tp2_pp1 -> layer_5_expert_out_sp2_ep0_tp2_pp1
	layer_5_expert_sp2_ep0_tp3_pp1 [label="Expert L5 SP2 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep0_pp1 -> layer_5_expert_sp2_ep0_tp3_pp1
	layer_5_expert_out_sp2_ep0_tp3_pp1 [label="Expert Out L5 SP2 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep0_tp3_pp1 -> layer_5_expert_out_sp2_ep0_tp3_pp1
	layer_5_expert_ar_sp2_ep0_pp1 [label="Expert All-Reduce L5 SP2 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep0_tp0_pp1 -> layer_5_expert_ar_sp2_ep0_pp1
	layer_5_expert_out_sp2_ep0_tp1_pp1 -> layer_5_expert_ar_sp2_ep0_pp1
	layer_5_expert_out_sp2_ep0_tp2_pp1 -> layer_5_expert_ar_sp2_ep0_pp1
	layer_5_expert_out_sp2_ep0_tp3_pp1 -> layer_5_expert_ar_sp2_ep0_pp1
	layer_5_combine_sp2_ep0_pp1 [label="Token Combine L5 SP2 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep0_pp1 -> layer_5_combine_sp2_ep0_pp1
	layer_5_dispatch_sp2_ep1_pp1 [label="Token Dispatch L5 SP2 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep1_pp1 [style=dashed]
	layer_5_expert_sp2_ep1_tp0_pp1 [label="Expert L5 SP2 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep1_pp1 -> layer_5_expert_sp2_ep1_tp0_pp1
	layer_5_expert_out_sp2_ep1_tp0_pp1 [label="Expert Out L5 SP2 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep1_tp0_pp1 -> layer_5_expert_out_sp2_ep1_tp0_pp1
	layer_5_expert_sp2_ep1_tp1_pp1 [label="Expert L5 SP2 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep1_pp1 -> layer_5_expert_sp2_ep1_tp1_pp1
	layer_5_expert_out_sp2_ep1_tp1_pp1 [label="Expert Out L5 SP2 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep1_tp1_pp1 -> layer_5_expert_out_sp2_ep1_tp1_pp1
	layer_5_expert_sp2_ep1_tp2_pp1 [label="Expert L5 SP2 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep1_pp1 -> layer_5_expert_sp2_ep1_tp2_pp1
	layer_5_expert_out_sp2_ep1_tp2_pp1 [label="Expert Out L5 SP2 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep1_tp2_pp1 -> layer_5_expert_out_sp2_ep1_tp2_pp1
	layer_5_expert_sp2_ep1_tp3_pp1 [label="Expert L5 SP2 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep1_pp1 -> layer_5_expert_sp2_ep1_tp3_pp1
	layer_5_expert_out_sp2_ep1_tp3_pp1 [label="Expert Out L5 SP2 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep1_tp3_pp1 -> layer_5_expert_out_sp2_ep1_tp3_pp1
	layer_5_expert_ar_sp2_ep1_pp1 [label="Expert All-Reduce L5 SP2 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep1_tp0_pp1 -> layer_5_expert_ar_sp2_ep1_pp1
	layer_5_expert_out_sp2_ep1_tp1_pp1 -> layer_5_expert_ar_sp2_ep1_pp1
	layer_5_expert_out_sp2_ep1_tp2_pp1 -> layer_5_expert_ar_sp2_ep1_pp1
	layer_5_expert_out_sp2_ep1_tp3_pp1 -> layer_5_expert_ar_sp2_ep1_pp1
	layer_5_combine_sp2_ep1_pp1 [label="Token Combine L5 SP2 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep1_pp1 -> layer_5_combine_sp2_ep1_pp1
	layer_5_dispatch_sp2_ep2_pp1 [label="Token Dispatch L5 SP2 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep2_pp1 [style=dashed]
	layer_5_expert_sp2_ep2_tp0_pp1 [label="Expert L5 SP2 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep2_pp1 -> layer_5_expert_sp2_ep2_tp0_pp1
	layer_5_expert_out_sp2_ep2_tp0_pp1 [label="Expert Out L5 SP2 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep2_tp0_pp1 -> layer_5_expert_out_sp2_ep2_tp0_pp1
	layer_5_expert_sp2_ep2_tp1_pp1 [label="Expert L5 SP2 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep2_pp1 -> layer_5_expert_sp2_ep2_tp1_pp1
	layer_5_expert_out_sp2_ep2_tp1_pp1 [label="Expert Out L5 SP2 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep2_tp1_pp1 -> layer_5_expert_out_sp2_ep2_tp1_pp1
	layer_5_expert_sp2_ep2_tp2_pp1 [label="Expert L5 SP2 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep2_pp1 -> layer_5_expert_sp2_ep2_tp2_pp1
	layer_5_expert_out_sp2_ep2_tp2_pp1 [label="Expert Out L5 SP2 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep2_tp2_pp1 -> layer_5_expert_out_sp2_ep2_tp2_pp1
	layer_5_expert_sp2_ep2_tp3_pp1 [label="Expert L5 SP2 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep2_pp1 -> layer_5_expert_sp2_ep2_tp3_pp1
	layer_5_expert_out_sp2_ep2_tp3_pp1 [label="Expert Out L5 SP2 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep2_tp3_pp1 -> layer_5_expert_out_sp2_ep2_tp3_pp1
	layer_5_expert_ar_sp2_ep2_pp1 [label="Expert All-Reduce L5 SP2 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep2_tp0_pp1 -> layer_5_expert_ar_sp2_ep2_pp1
	layer_5_expert_out_sp2_ep2_tp1_pp1 -> layer_5_expert_ar_sp2_ep2_pp1
	layer_5_expert_out_sp2_ep2_tp2_pp1 -> layer_5_expert_ar_sp2_ep2_pp1
	layer_5_expert_out_sp2_ep2_tp3_pp1 -> layer_5_expert_ar_sp2_ep2_pp1
	layer_5_combine_sp2_ep2_pp1 [label="Token Combine L5 SP2 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep2_pp1 -> layer_5_combine_sp2_ep2_pp1
	layer_5_dispatch_sp2_ep3_pp1 [label="Token Dispatch L5 SP2 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep3_pp1 [style=dashed]
	layer_5_expert_sp2_ep3_tp0_pp1 [label="Expert L5 SP2 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep3_pp1 -> layer_5_expert_sp2_ep3_tp0_pp1
	layer_5_expert_out_sp2_ep3_tp0_pp1 [label="Expert Out L5 SP2 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep3_tp0_pp1 -> layer_5_expert_out_sp2_ep3_tp0_pp1
	layer_5_expert_sp2_ep3_tp1_pp1 [label="Expert L5 SP2 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep3_pp1 -> layer_5_expert_sp2_ep3_tp1_pp1
	layer_5_expert_out_sp2_ep3_tp1_pp1 [label="Expert Out L5 SP2 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep3_tp1_pp1 -> layer_5_expert_out_sp2_ep3_tp1_pp1
	layer_5_expert_sp2_ep3_tp2_pp1 [label="Expert L5 SP2 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep3_pp1 -> layer_5_expert_sp2_ep3_tp2_pp1
	layer_5_expert_out_sp2_ep3_tp2_pp1 [label="Expert Out L5 SP2 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep3_tp2_pp1 -> layer_5_expert_out_sp2_ep3_tp2_pp1
	layer_5_expert_sp2_ep3_tp3_pp1 [label="Expert L5 SP2 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep3_pp1 -> layer_5_expert_sp2_ep3_tp3_pp1
	layer_5_expert_out_sp2_ep3_tp3_pp1 [label="Expert Out L5 SP2 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep3_tp3_pp1 -> layer_5_expert_out_sp2_ep3_tp3_pp1
	layer_5_expert_ar_sp2_ep3_pp1 [label="Expert All-Reduce L5 SP2 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep3_tp0_pp1 -> layer_5_expert_ar_sp2_ep3_pp1
	layer_5_expert_out_sp2_ep3_tp1_pp1 -> layer_5_expert_ar_sp2_ep3_pp1
	layer_5_expert_out_sp2_ep3_tp2_pp1 -> layer_5_expert_ar_sp2_ep3_pp1
	layer_5_expert_out_sp2_ep3_tp3_pp1 -> layer_5_expert_ar_sp2_ep3_pp1
	layer_5_combine_sp2_ep3_pp1 [label="Token Combine L5 SP2 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep3_pp1 -> layer_5_combine_sp2_ep3_pp1
	layer_5_dispatch_sp2_ep4_pp1 [label="Token Dispatch L5 SP2 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep4_pp1 [style=dashed]
	layer_5_expert_sp2_ep4_tp0_pp1 [label="Expert L5 SP2 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep4_pp1 -> layer_5_expert_sp2_ep4_tp0_pp1
	layer_5_expert_out_sp2_ep4_tp0_pp1 [label="Expert Out L5 SP2 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep4_tp0_pp1 -> layer_5_expert_out_sp2_ep4_tp0_pp1
	layer_5_expert_sp2_ep4_tp1_pp1 [label="Expert L5 SP2 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep4_pp1 -> layer_5_expert_sp2_ep4_tp1_pp1
	layer_5_expert_out_sp2_ep4_tp1_pp1 [label="Expert Out L5 SP2 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep4_tp1_pp1 -> layer_5_expert_out_sp2_ep4_tp1_pp1
	layer_5_expert_sp2_ep4_tp2_pp1 [label="Expert L5 SP2 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep4_pp1 -> layer_5_expert_sp2_ep4_tp2_pp1
	layer_5_expert_out_sp2_ep4_tp2_pp1 [label="Expert Out L5 SP2 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep4_tp2_pp1 -> layer_5_expert_out_sp2_ep4_tp2_pp1
	layer_5_expert_sp2_ep4_tp3_pp1 [label="Expert L5 SP2 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep4_pp1 -> layer_5_expert_sp2_ep4_tp3_pp1
	layer_5_expert_out_sp2_ep4_tp3_pp1 [label="Expert Out L5 SP2 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep4_tp3_pp1 -> layer_5_expert_out_sp2_ep4_tp3_pp1
	layer_5_expert_ar_sp2_ep4_pp1 [label="Expert All-Reduce L5 SP2 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep4_tp0_pp1 -> layer_5_expert_ar_sp2_ep4_pp1
	layer_5_expert_out_sp2_ep4_tp1_pp1 -> layer_5_expert_ar_sp2_ep4_pp1
	layer_5_expert_out_sp2_ep4_tp2_pp1 -> layer_5_expert_ar_sp2_ep4_pp1
	layer_5_expert_out_sp2_ep4_tp3_pp1 -> layer_5_expert_ar_sp2_ep4_pp1
	layer_5_combine_sp2_ep4_pp1 [label="Token Combine L5 SP2 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep4_pp1 -> layer_5_combine_sp2_ep4_pp1
	layer_5_dispatch_sp2_ep5_pp1 [label="Token Dispatch L5 SP2 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep5_pp1 [style=dashed]
	layer_5_expert_sp2_ep5_tp0_pp1 [label="Expert L5 SP2 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep5_pp1 -> layer_5_expert_sp2_ep5_tp0_pp1
	layer_5_expert_out_sp2_ep5_tp0_pp1 [label="Expert Out L5 SP2 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep5_tp0_pp1 -> layer_5_expert_out_sp2_ep5_tp0_pp1
	layer_5_expert_sp2_ep5_tp1_pp1 [label="Expert L5 SP2 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep5_pp1 -> layer_5_expert_sp2_ep5_tp1_pp1
	layer_5_expert_out_sp2_ep5_tp1_pp1 [label="Expert Out L5 SP2 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep5_tp1_pp1 -> layer_5_expert_out_sp2_ep5_tp1_pp1
	layer_5_expert_sp2_ep5_tp2_pp1 [label="Expert L5 SP2 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep5_pp1 -> layer_5_expert_sp2_ep5_tp2_pp1
	layer_5_expert_out_sp2_ep5_tp2_pp1 [label="Expert Out L5 SP2 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep5_tp2_pp1 -> layer_5_expert_out_sp2_ep5_tp2_pp1
	layer_5_expert_sp2_ep5_tp3_pp1 [label="Expert L5 SP2 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep5_pp1 -> layer_5_expert_sp2_ep5_tp3_pp1
	layer_5_expert_out_sp2_ep5_tp3_pp1 [label="Expert Out L5 SP2 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep5_tp3_pp1 -> layer_5_expert_out_sp2_ep5_tp3_pp1
	layer_5_expert_ar_sp2_ep5_pp1 [label="Expert All-Reduce L5 SP2 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep5_tp0_pp1 -> layer_5_expert_ar_sp2_ep5_pp1
	layer_5_expert_out_sp2_ep5_tp1_pp1 -> layer_5_expert_ar_sp2_ep5_pp1
	layer_5_expert_out_sp2_ep5_tp2_pp1 -> layer_5_expert_ar_sp2_ep5_pp1
	layer_5_expert_out_sp2_ep5_tp3_pp1 -> layer_5_expert_ar_sp2_ep5_pp1
	layer_5_combine_sp2_ep5_pp1 [label="Token Combine L5 SP2 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep5_pp1 -> layer_5_combine_sp2_ep5_pp1
	layer_5_dispatch_sp2_ep6_pp1 [label="Token Dispatch L5 SP2 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep6_pp1 [style=dashed]
	layer_5_expert_sp2_ep6_tp0_pp1 [label="Expert L5 SP2 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep6_pp1 -> layer_5_expert_sp2_ep6_tp0_pp1
	layer_5_expert_out_sp2_ep6_tp0_pp1 [label="Expert Out L5 SP2 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep6_tp0_pp1 -> layer_5_expert_out_sp2_ep6_tp0_pp1
	layer_5_expert_sp2_ep6_tp1_pp1 [label="Expert L5 SP2 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep6_pp1 -> layer_5_expert_sp2_ep6_tp1_pp1
	layer_5_expert_out_sp2_ep6_tp1_pp1 [label="Expert Out L5 SP2 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep6_tp1_pp1 -> layer_5_expert_out_sp2_ep6_tp1_pp1
	layer_5_expert_sp2_ep6_tp2_pp1 [label="Expert L5 SP2 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep6_pp1 -> layer_5_expert_sp2_ep6_tp2_pp1
	layer_5_expert_out_sp2_ep6_tp2_pp1 [label="Expert Out L5 SP2 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep6_tp2_pp1 -> layer_5_expert_out_sp2_ep6_tp2_pp1
	layer_5_expert_sp2_ep6_tp3_pp1 [label="Expert L5 SP2 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep6_pp1 -> layer_5_expert_sp2_ep6_tp3_pp1
	layer_5_expert_out_sp2_ep6_tp3_pp1 [label="Expert Out L5 SP2 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep6_tp3_pp1 -> layer_5_expert_out_sp2_ep6_tp3_pp1
	layer_5_expert_ar_sp2_ep6_pp1 [label="Expert All-Reduce L5 SP2 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep6_tp0_pp1 -> layer_5_expert_ar_sp2_ep6_pp1
	layer_5_expert_out_sp2_ep6_tp1_pp1 -> layer_5_expert_ar_sp2_ep6_pp1
	layer_5_expert_out_sp2_ep6_tp2_pp1 -> layer_5_expert_ar_sp2_ep6_pp1
	layer_5_expert_out_sp2_ep6_tp3_pp1 -> layer_5_expert_ar_sp2_ep6_pp1
	layer_5_combine_sp2_ep6_pp1 [label="Token Combine L5 SP2 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep6_pp1 -> layer_5_combine_sp2_ep6_pp1
	layer_5_dispatch_sp2_ep7_pp1 [label="Token Dispatch L5 SP2 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep7_pp1 [style=dashed]
	layer_5_expert_sp2_ep7_tp0_pp1 [label="Expert L5 SP2 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep7_pp1 -> layer_5_expert_sp2_ep7_tp0_pp1
	layer_5_expert_out_sp2_ep7_tp0_pp1 [label="Expert Out L5 SP2 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep7_tp0_pp1 -> layer_5_expert_out_sp2_ep7_tp0_pp1
	layer_5_expert_sp2_ep7_tp1_pp1 [label="Expert L5 SP2 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep7_pp1 -> layer_5_expert_sp2_ep7_tp1_pp1
	layer_5_expert_out_sp2_ep7_tp1_pp1 [label="Expert Out L5 SP2 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep7_tp1_pp1 -> layer_5_expert_out_sp2_ep7_tp1_pp1
	layer_5_expert_sp2_ep7_tp2_pp1 [label="Expert L5 SP2 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep7_pp1 -> layer_5_expert_sp2_ep7_tp2_pp1
	layer_5_expert_out_sp2_ep7_tp2_pp1 [label="Expert Out L5 SP2 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep7_tp2_pp1 -> layer_5_expert_out_sp2_ep7_tp2_pp1
	layer_5_expert_sp2_ep7_tp3_pp1 [label="Expert L5 SP2 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep7_pp1 -> layer_5_expert_sp2_ep7_tp3_pp1
	layer_5_expert_out_sp2_ep7_tp3_pp1 [label="Expert Out L5 SP2 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep7_tp3_pp1 -> layer_5_expert_out_sp2_ep7_tp3_pp1
	layer_5_expert_ar_sp2_ep7_pp1 [label="Expert All-Reduce L5 SP2 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep7_tp0_pp1 -> layer_5_expert_ar_sp2_ep7_pp1
	layer_5_expert_out_sp2_ep7_tp1_pp1 -> layer_5_expert_ar_sp2_ep7_pp1
	layer_5_expert_out_sp2_ep7_tp2_pp1 -> layer_5_expert_ar_sp2_ep7_pp1
	layer_5_expert_out_sp2_ep7_tp3_pp1 -> layer_5_expert_ar_sp2_ep7_pp1
	layer_5_combine_sp2_ep7_pp1 [label="Token Combine L5 SP2 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep7_pp1 -> layer_5_combine_sp2_ep7_pp1
	layer_5_dispatch_sp2_ep8_pp1 [label="Token Dispatch L5 SP2 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep8_pp1 [style=dashed]
	layer_5_expert_sp2_ep8_tp0_pp1 [label="Expert L5 SP2 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep8_pp1 -> layer_5_expert_sp2_ep8_tp0_pp1
	layer_5_expert_out_sp2_ep8_tp0_pp1 [label="Expert Out L5 SP2 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep8_tp0_pp1 -> layer_5_expert_out_sp2_ep8_tp0_pp1
	layer_5_expert_sp2_ep8_tp1_pp1 [label="Expert L5 SP2 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep8_pp1 -> layer_5_expert_sp2_ep8_tp1_pp1
	layer_5_expert_out_sp2_ep8_tp1_pp1 [label="Expert Out L5 SP2 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep8_tp1_pp1 -> layer_5_expert_out_sp2_ep8_tp1_pp1
	layer_5_expert_sp2_ep8_tp2_pp1 [label="Expert L5 SP2 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep8_pp1 -> layer_5_expert_sp2_ep8_tp2_pp1
	layer_5_expert_out_sp2_ep8_tp2_pp1 [label="Expert Out L5 SP2 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep8_tp2_pp1 -> layer_5_expert_out_sp2_ep8_tp2_pp1
	layer_5_expert_sp2_ep8_tp3_pp1 [label="Expert L5 SP2 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep8_pp1 -> layer_5_expert_sp2_ep8_tp3_pp1
	layer_5_expert_out_sp2_ep8_tp3_pp1 [label="Expert Out L5 SP2 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep8_tp3_pp1 -> layer_5_expert_out_sp2_ep8_tp3_pp1
	layer_5_expert_ar_sp2_ep8_pp1 [label="Expert All-Reduce L5 SP2 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep8_tp0_pp1 -> layer_5_expert_ar_sp2_ep8_pp1
	layer_5_expert_out_sp2_ep8_tp1_pp1 -> layer_5_expert_ar_sp2_ep8_pp1
	layer_5_expert_out_sp2_ep8_tp2_pp1 -> layer_5_expert_ar_sp2_ep8_pp1
	layer_5_expert_out_sp2_ep8_tp3_pp1 -> layer_5_expert_ar_sp2_ep8_pp1
	layer_5_combine_sp2_ep8_pp1 [label="Token Combine L5 SP2 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep8_pp1 -> layer_5_combine_sp2_ep8_pp1
	layer_5_dispatch_sp2_ep9_pp1 [label="Token Dispatch L5 SP2 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep9_pp1 [style=dashed]
	layer_5_expert_sp2_ep9_tp0_pp1 [label="Expert L5 SP2 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep9_pp1 -> layer_5_expert_sp2_ep9_tp0_pp1
	layer_5_expert_out_sp2_ep9_tp0_pp1 [label="Expert Out L5 SP2 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep9_tp0_pp1 -> layer_5_expert_out_sp2_ep9_tp0_pp1
	layer_5_expert_sp2_ep9_tp1_pp1 [label="Expert L5 SP2 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep9_pp1 -> layer_5_expert_sp2_ep9_tp1_pp1
	layer_5_expert_out_sp2_ep9_tp1_pp1 [label="Expert Out L5 SP2 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep9_tp1_pp1 -> layer_5_expert_out_sp2_ep9_tp1_pp1
	layer_5_expert_sp2_ep9_tp2_pp1 [label="Expert L5 SP2 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep9_pp1 -> layer_5_expert_sp2_ep9_tp2_pp1
	layer_5_expert_out_sp2_ep9_tp2_pp1 [label="Expert Out L5 SP2 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep9_tp2_pp1 -> layer_5_expert_out_sp2_ep9_tp2_pp1
	layer_5_expert_sp2_ep9_tp3_pp1 [label="Expert L5 SP2 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep9_pp1 -> layer_5_expert_sp2_ep9_tp3_pp1
	layer_5_expert_out_sp2_ep9_tp3_pp1 [label="Expert Out L5 SP2 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep9_tp3_pp1 -> layer_5_expert_out_sp2_ep9_tp3_pp1
	layer_5_expert_ar_sp2_ep9_pp1 [label="Expert All-Reduce L5 SP2 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep9_tp0_pp1 -> layer_5_expert_ar_sp2_ep9_pp1
	layer_5_expert_out_sp2_ep9_tp1_pp1 -> layer_5_expert_ar_sp2_ep9_pp1
	layer_5_expert_out_sp2_ep9_tp2_pp1 -> layer_5_expert_ar_sp2_ep9_pp1
	layer_5_expert_out_sp2_ep9_tp3_pp1 -> layer_5_expert_ar_sp2_ep9_pp1
	layer_5_combine_sp2_ep9_pp1 [label="Token Combine L5 SP2 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep9_pp1 -> layer_5_combine_sp2_ep9_pp1
	layer_5_dispatch_sp2_ep10_pp1 [label="Token Dispatch L5 SP2 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep10_pp1 [style=dashed]
	layer_5_expert_sp2_ep10_tp0_pp1 [label="Expert L5 SP2 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep10_pp1 -> layer_5_expert_sp2_ep10_tp0_pp1
	layer_5_expert_out_sp2_ep10_tp0_pp1 [label="Expert Out L5 SP2 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep10_tp0_pp1 -> layer_5_expert_out_sp2_ep10_tp0_pp1
	layer_5_expert_sp2_ep10_tp1_pp1 [label="Expert L5 SP2 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep10_pp1 -> layer_5_expert_sp2_ep10_tp1_pp1
	layer_5_expert_out_sp2_ep10_tp1_pp1 [label="Expert Out L5 SP2 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep10_tp1_pp1 -> layer_5_expert_out_sp2_ep10_tp1_pp1
	layer_5_expert_sp2_ep10_tp2_pp1 [label="Expert L5 SP2 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep10_pp1 -> layer_5_expert_sp2_ep10_tp2_pp1
	layer_5_expert_out_sp2_ep10_tp2_pp1 [label="Expert Out L5 SP2 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep10_tp2_pp1 -> layer_5_expert_out_sp2_ep10_tp2_pp1
	layer_5_expert_sp2_ep10_tp3_pp1 [label="Expert L5 SP2 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep10_pp1 -> layer_5_expert_sp2_ep10_tp3_pp1
	layer_5_expert_out_sp2_ep10_tp3_pp1 [label="Expert Out L5 SP2 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep10_tp3_pp1 -> layer_5_expert_out_sp2_ep10_tp3_pp1
	layer_5_expert_ar_sp2_ep10_pp1 [label="Expert All-Reduce L5 SP2 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep10_tp0_pp1 -> layer_5_expert_ar_sp2_ep10_pp1
	layer_5_expert_out_sp2_ep10_tp1_pp1 -> layer_5_expert_ar_sp2_ep10_pp1
	layer_5_expert_out_sp2_ep10_tp2_pp1 -> layer_5_expert_ar_sp2_ep10_pp1
	layer_5_expert_out_sp2_ep10_tp3_pp1 -> layer_5_expert_ar_sp2_ep10_pp1
	layer_5_combine_sp2_ep10_pp1 [label="Token Combine L5 SP2 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep10_pp1 -> layer_5_combine_sp2_ep10_pp1
	layer_5_dispatch_sp2_ep11_pp1 [label="Token Dispatch L5 SP2 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep11_pp1 [style=dashed]
	layer_5_expert_sp2_ep11_tp0_pp1 [label="Expert L5 SP2 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep11_pp1 -> layer_5_expert_sp2_ep11_tp0_pp1
	layer_5_expert_out_sp2_ep11_tp0_pp1 [label="Expert Out L5 SP2 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep11_tp0_pp1 -> layer_5_expert_out_sp2_ep11_tp0_pp1
	layer_5_expert_sp2_ep11_tp1_pp1 [label="Expert L5 SP2 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep11_pp1 -> layer_5_expert_sp2_ep11_tp1_pp1
	layer_5_expert_out_sp2_ep11_tp1_pp1 [label="Expert Out L5 SP2 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep11_tp1_pp1 -> layer_5_expert_out_sp2_ep11_tp1_pp1
	layer_5_expert_sp2_ep11_tp2_pp1 [label="Expert L5 SP2 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep11_pp1 -> layer_5_expert_sp2_ep11_tp2_pp1
	layer_5_expert_out_sp2_ep11_tp2_pp1 [label="Expert Out L5 SP2 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep11_tp2_pp1 -> layer_5_expert_out_sp2_ep11_tp2_pp1
	layer_5_expert_sp2_ep11_tp3_pp1 [label="Expert L5 SP2 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep11_pp1 -> layer_5_expert_sp2_ep11_tp3_pp1
	layer_5_expert_out_sp2_ep11_tp3_pp1 [label="Expert Out L5 SP2 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep11_tp3_pp1 -> layer_5_expert_out_sp2_ep11_tp3_pp1
	layer_5_expert_ar_sp2_ep11_pp1 [label="Expert All-Reduce L5 SP2 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep11_tp0_pp1 -> layer_5_expert_ar_sp2_ep11_pp1
	layer_5_expert_out_sp2_ep11_tp1_pp1 -> layer_5_expert_ar_sp2_ep11_pp1
	layer_5_expert_out_sp2_ep11_tp2_pp1 -> layer_5_expert_ar_sp2_ep11_pp1
	layer_5_expert_out_sp2_ep11_tp3_pp1 -> layer_5_expert_ar_sp2_ep11_pp1
	layer_5_combine_sp2_ep11_pp1 [label="Token Combine L5 SP2 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep11_pp1 -> layer_5_combine_sp2_ep11_pp1
	layer_5_dispatch_sp2_ep12_pp1 [label="Token Dispatch L5 SP2 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep12_pp1 [style=dashed]
	layer_5_expert_sp2_ep12_tp0_pp1 [label="Expert L5 SP2 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep12_pp1 -> layer_5_expert_sp2_ep12_tp0_pp1
	layer_5_expert_out_sp2_ep12_tp0_pp1 [label="Expert Out L5 SP2 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep12_tp0_pp1 -> layer_5_expert_out_sp2_ep12_tp0_pp1
	layer_5_expert_sp2_ep12_tp1_pp1 [label="Expert L5 SP2 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep12_pp1 -> layer_5_expert_sp2_ep12_tp1_pp1
	layer_5_expert_out_sp2_ep12_tp1_pp1 [label="Expert Out L5 SP2 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep12_tp1_pp1 -> layer_5_expert_out_sp2_ep12_tp1_pp1
	layer_5_expert_sp2_ep12_tp2_pp1 [label="Expert L5 SP2 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep12_pp1 -> layer_5_expert_sp2_ep12_tp2_pp1
	layer_5_expert_out_sp2_ep12_tp2_pp1 [label="Expert Out L5 SP2 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep12_tp2_pp1 -> layer_5_expert_out_sp2_ep12_tp2_pp1
	layer_5_expert_sp2_ep12_tp3_pp1 [label="Expert L5 SP2 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep12_pp1 -> layer_5_expert_sp2_ep12_tp3_pp1
	layer_5_expert_out_sp2_ep12_tp3_pp1 [label="Expert Out L5 SP2 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep12_tp3_pp1 -> layer_5_expert_out_sp2_ep12_tp3_pp1
	layer_5_expert_ar_sp2_ep12_pp1 [label="Expert All-Reduce L5 SP2 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep12_tp0_pp1 -> layer_5_expert_ar_sp2_ep12_pp1
	layer_5_expert_out_sp2_ep12_tp1_pp1 -> layer_5_expert_ar_sp2_ep12_pp1
	layer_5_expert_out_sp2_ep12_tp2_pp1 -> layer_5_expert_ar_sp2_ep12_pp1
	layer_5_expert_out_sp2_ep12_tp3_pp1 -> layer_5_expert_ar_sp2_ep12_pp1
	layer_5_combine_sp2_ep12_pp1 [label="Token Combine L5 SP2 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep12_pp1 -> layer_5_combine_sp2_ep12_pp1
	layer_5_dispatch_sp2_ep13_pp1 [label="Token Dispatch L5 SP2 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep13_pp1 [style=dashed]
	layer_5_expert_sp2_ep13_tp0_pp1 [label="Expert L5 SP2 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep13_pp1 -> layer_5_expert_sp2_ep13_tp0_pp1
	layer_5_expert_out_sp2_ep13_tp0_pp1 [label="Expert Out L5 SP2 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep13_tp0_pp1 -> layer_5_expert_out_sp2_ep13_tp0_pp1
	layer_5_expert_sp2_ep13_tp1_pp1 [label="Expert L5 SP2 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep13_pp1 -> layer_5_expert_sp2_ep13_tp1_pp1
	layer_5_expert_out_sp2_ep13_tp1_pp1 [label="Expert Out L5 SP2 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep13_tp1_pp1 -> layer_5_expert_out_sp2_ep13_tp1_pp1
	layer_5_expert_sp2_ep13_tp2_pp1 [label="Expert L5 SP2 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep13_pp1 -> layer_5_expert_sp2_ep13_tp2_pp1
	layer_5_expert_out_sp2_ep13_tp2_pp1 [label="Expert Out L5 SP2 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep13_tp2_pp1 -> layer_5_expert_out_sp2_ep13_tp2_pp1
	layer_5_expert_sp2_ep13_tp3_pp1 [label="Expert L5 SP2 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep13_pp1 -> layer_5_expert_sp2_ep13_tp3_pp1
	layer_5_expert_out_sp2_ep13_tp3_pp1 [label="Expert Out L5 SP2 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep13_tp3_pp1 -> layer_5_expert_out_sp2_ep13_tp3_pp1
	layer_5_expert_ar_sp2_ep13_pp1 [label="Expert All-Reduce L5 SP2 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep13_tp0_pp1 -> layer_5_expert_ar_sp2_ep13_pp1
	layer_5_expert_out_sp2_ep13_tp1_pp1 -> layer_5_expert_ar_sp2_ep13_pp1
	layer_5_expert_out_sp2_ep13_tp2_pp1 -> layer_5_expert_ar_sp2_ep13_pp1
	layer_5_expert_out_sp2_ep13_tp3_pp1 -> layer_5_expert_ar_sp2_ep13_pp1
	layer_5_combine_sp2_ep13_pp1 [label="Token Combine L5 SP2 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep13_pp1 -> layer_5_combine_sp2_ep13_pp1
	layer_5_dispatch_sp2_ep14_pp1 [label="Token Dispatch L5 SP2 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep14_pp1 [style=dashed]
	layer_5_expert_sp2_ep14_tp0_pp1 [label="Expert L5 SP2 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep14_pp1 -> layer_5_expert_sp2_ep14_tp0_pp1
	layer_5_expert_out_sp2_ep14_tp0_pp1 [label="Expert Out L5 SP2 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep14_tp0_pp1 -> layer_5_expert_out_sp2_ep14_tp0_pp1
	layer_5_expert_sp2_ep14_tp1_pp1 [label="Expert L5 SP2 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep14_pp1 -> layer_5_expert_sp2_ep14_tp1_pp1
	layer_5_expert_out_sp2_ep14_tp1_pp1 [label="Expert Out L5 SP2 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep14_tp1_pp1 -> layer_5_expert_out_sp2_ep14_tp1_pp1
	layer_5_expert_sp2_ep14_tp2_pp1 [label="Expert L5 SP2 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep14_pp1 -> layer_5_expert_sp2_ep14_tp2_pp1
	layer_5_expert_out_sp2_ep14_tp2_pp1 [label="Expert Out L5 SP2 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep14_tp2_pp1 -> layer_5_expert_out_sp2_ep14_tp2_pp1
	layer_5_expert_sp2_ep14_tp3_pp1 [label="Expert L5 SP2 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep14_pp1 -> layer_5_expert_sp2_ep14_tp3_pp1
	layer_5_expert_out_sp2_ep14_tp3_pp1 [label="Expert Out L5 SP2 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep14_tp3_pp1 -> layer_5_expert_out_sp2_ep14_tp3_pp1
	layer_5_expert_ar_sp2_ep14_pp1 [label="Expert All-Reduce L5 SP2 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep14_tp0_pp1 -> layer_5_expert_ar_sp2_ep14_pp1
	layer_5_expert_out_sp2_ep14_tp1_pp1 -> layer_5_expert_ar_sp2_ep14_pp1
	layer_5_expert_out_sp2_ep14_tp2_pp1 -> layer_5_expert_ar_sp2_ep14_pp1
	layer_5_expert_out_sp2_ep14_tp3_pp1 -> layer_5_expert_ar_sp2_ep14_pp1
	layer_5_combine_sp2_ep14_pp1 [label="Token Combine L5 SP2 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep14_pp1 -> layer_5_combine_sp2_ep14_pp1
	layer_5_dispatch_sp2_ep15_pp1 [label="Token Dispatch L5 SP2 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp2_pp1 -> layer_5_dispatch_sp2_ep15_pp1 [style=dashed]
	layer_5_expert_sp2_ep15_tp0_pp1 [label="Expert L5 SP2 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep15_pp1 -> layer_5_expert_sp2_ep15_tp0_pp1
	layer_5_expert_out_sp2_ep15_tp0_pp1 [label="Expert Out L5 SP2 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep15_tp0_pp1 -> layer_5_expert_out_sp2_ep15_tp0_pp1
	layer_5_expert_sp2_ep15_tp1_pp1 [label="Expert L5 SP2 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep15_pp1 -> layer_5_expert_sp2_ep15_tp1_pp1
	layer_5_expert_out_sp2_ep15_tp1_pp1 [label="Expert Out L5 SP2 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep15_tp1_pp1 -> layer_5_expert_out_sp2_ep15_tp1_pp1
	layer_5_expert_sp2_ep15_tp2_pp1 [label="Expert L5 SP2 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep15_pp1 -> layer_5_expert_sp2_ep15_tp2_pp1
	layer_5_expert_out_sp2_ep15_tp2_pp1 [label="Expert Out L5 SP2 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep15_tp2_pp1 -> layer_5_expert_out_sp2_ep15_tp2_pp1
	layer_5_expert_sp2_ep15_tp3_pp1 [label="Expert L5 SP2 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp2_ep15_pp1 -> layer_5_expert_sp2_ep15_tp3_pp1
	layer_5_expert_out_sp2_ep15_tp3_pp1 [label="Expert Out L5 SP2 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp2_ep15_tp3_pp1 -> layer_5_expert_out_sp2_ep15_tp3_pp1
	layer_5_expert_ar_sp2_ep15_pp1 [label="Expert All-Reduce L5 SP2 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp2_ep15_tp0_pp1 -> layer_5_expert_ar_sp2_ep15_pp1
	layer_5_expert_out_sp2_ep15_tp1_pp1 -> layer_5_expert_ar_sp2_ep15_pp1
	layer_5_expert_out_sp2_ep15_tp2_pp1 -> layer_5_expert_ar_sp2_ep15_pp1
	layer_5_expert_out_sp2_ep15_tp3_pp1 -> layer_5_expert_ar_sp2_ep15_pp1
	layer_5_combine_sp2_ep15_pp1 [label="Token Combine L5 SP2 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp2_ep15_pp1 -> layer_5_combine_sp2_ep15_pp1
	layer_5_moe_all2all_sp2_pp1 [label="MoE All-to-All L5 SP2\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_5_combine_sp2_ep0_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep1_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep2_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep3_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep4_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep5_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep6_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep7_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep8_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep9_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep10_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep11_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep12_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep13_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep14_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_combine_sp2_ep15_pp1 -> layer_5_moe_all2all_sp2_pp1
	layer_5_mlp_out_sp2_pp1 [label="MoE Output L5 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_moe_all2all_sp2_pp1 -> layer_5_mlp_out_sp2_pp1
	layer_5_mlp_res_sp2_pp1 [label="MLP Residual L5 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_mlp_out_sp2_pp1 -> layer_5_mlp_res_sp2_pp1
	layer_5_attn_res_sp2_pp1 -> layer_5_mlp_res_sp2_pp1 [style=dashed]
	layer_5_norm_sp3_pp1 [label="LayerNorm L5 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_4_mlp_out_sp3_pp1 -> layer_5_norm_sp3_pp1
	layer_5_qkv_sp3_tp0_pp1 [label="QKV Proj L5 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp3_pp1 -> layer_5_qkv_sp3_tp0_pp1
	layer_5_attn_sp3_tp0_pp1 [label="Attention L5 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp3_tp0_pp1 -> layer_5_attn_sp3_tp0_pp1
	layer_5_attn_out_sp3_tp0_pp1 [label="Attn Out Proj L5 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp3_tp0_pp1 -> layer_5_attn_out_sp3_tp0_pp1
	layer_5_qkv_sp3_tp1_pp1 [label="QKV Proj L5 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp3_pp1 -> layer_5_qkv_sp3_tp1_pp1
	layer_5_attn_sp3_tp1_pp1 [label="Attention L5 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp3_tp1_pp1 -> layer_5_attn_sp3_tp1_pp1
	layer_5_attn_out_sp3_tp1_pp1 [label="Attn Out Proj L5 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp3_tp1_pp1 -> layer_5_attn_out_sp3_tp1_pp1
	layer_5_qkv_sp3_tp2_pp1 [label="QKV Proj L5 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp3_pp1 -> layer_5_qkv_sp3_tp2_pp1
	layer_5_attn_sp3_tp2_pp1 [label="Attention L5 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp3_tp2_pp1 -> layer_5_attn_sp3_tp2_pp1
	layer_5_attn_out_sp3_tp2_pp1 [label="Attn Out Proj L5 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp3_tp2_pp1 -> layer_5_attn_out_sp3_tp2_pp1
	layer_5_qkv_sp3_tp3_pp1 [label="QKV Proj L5 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_norm_sp3_pp1 -> layer_5_qkv_sp3_tp3_pp1
	layer_5_attn_sp3_tp3_pp1 [label="Attention L5 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_qkv_sp3_tp3_pp1 -> layer_5_attn_sp3_tp3_pp1
	layer_5_attn_out_sp3_tp3_pp1 [label="Attn Out Proj L5 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_5_attn_sp3_tp3_pp1 -> layer_5_attn_out_sp3_tp3_pp1
	layer_5_attn_ar_sp3_pp1 [label="Attention All-Reduce L5 SP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_attn_out_sp3_tp0_pp1 -> layer_5_attn_ar_sp3_pp1
	layer_5_attn_out_sp3_tp1_pp1 -> layer_5_attn_ar_sp3_pp1
	layer_5_attn_out_sp3_tp2_pp1 -> layer_5_attn_ar_sp3_pp1
	layer_5_attn_out_sp3_tp3_pp1 -> layer_5_attn_ar_sp3_pp1
	layer_5_attn_res_sp3_pp1 [label="Attention Residual L5 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_attn_ar_sp3_pp1 -> layer_5_attn_res_sp3_pp1
	layer_5_norm_sp3_pp1 -> layer_5_attn_res_sp3_pp1 [style=dashed]
	layer_5_post_norm_sp3_pp1 [label="Post-Attn Norm L5 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_attn_res_sp3_pp1 -> layer_5_post_norm_sp3_pp1
	layer_5_router_sp3_pp1 [label="MoE Router L5 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_5_post_norm_sp3_pp1 -> layer_5_router_sp3_pp1
	layer_5_dispatch_sp3_ep0_pp1 [label="Token Dispatch L5 SP3 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep0_pp1 [style=dashed]
	layer_5_expert_sp3_ep0_tp0_pp1 [label="Expert L5 SP3 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep0_pp1 -> layer_5_expert_sp3_ep0_tp0_pp1
	layer_5_expert_out_sp3_ep0_tp0_pp1 [label="Expert Out L5 SP3 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep0_tp0_pp1 -> layer_5_expert_out_sp3_ep0_tp0_pp1
	layer_5_expert_sp3_ep0_tp1_pp1 [label="Expert L5 SP3 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep0_pp1 -> layer_5_expert_sp3_ep0_tp1_pp1
	layer_5_expert_out_sp3_ep0_tp1_pp1 [label="Expert Out L5 SP3 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep0_tp1_pp1 -> layer_5_expert_out_sp3_ep0_tp1_pp1
	layer_5_expert_sp3_ep0_tp2_pp1 [label="Expert L5 SP3 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep0_pp1 -> layer_5_expert_sp3_ep0_tp2_pp1
	layer_5_expert_out_sp3_ep0_tp2_pp1 [label="Expert Out L5 SP3 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep0_tp2_pp1 -> layer_5_expert_out_sp3_ep0_tp2_pp1
	layer_5_expert_sp3_ep0_tp3_pp1 [label="Expert L5 SP3 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep0_pp1 -> layer_5_expert_sp3_ep0_tp3_pp1
	layer_5_expert_out_sp3_ep0_tp3_pp1 [label="Expert Out L5 SP3 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep0_tp3_pp1 -> layer_5_expert_out_sp3_ep0_tp3_pp1
	layer_5_expert_ar_sp3_ep0_pp1 [label="Expert All-Reduce L5 SP3 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep0_tp0_pp1 -> layer_5_expert_ar_sp3_ep0_pp1
	layer_5_expert_out_sp3_ep0_tp1_pp1 -> layer_5_expert_ar_sp3_ep0_pp1
	layer_5_expert_out_sp3_ep0_tp2_pp1 -> layer_5_expert_ar_sp3_ep0_pp1
	layer_5_expert_out_sp3_ep0_tp3_pp1 -> layer_5_expert_ar_sp3_ep0_pp1
	layer_5_combine_sp3_ep0_pp1 [label="Token Combine L5 SP3 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep0_pp1 -> layer_5_combine_sp3_ep0_pp1
	layer_5_dispatch_sp3_ep1_pp1 [label="Token Dispatch L5 SP3 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep1_pp1 [style=dashed]
	layer_5_expert_sp3_ep1_tp0_pp1 [label="Expert L5 SP3 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep1_pp1 -> layer_5_expert_sp3_ep1_tp0_pp1
	layer_5_expert_out_sp3_ep1_tp0_pp1 [label="Expert Out L5 SP3 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep1_tp0_pp1 -> layer_5_expert_out_sp3_ep1_tp0_pp1
	layer_5_expert_sp3_ep1_tp1_pp1 [label="Expert L5 SP3 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep1_pp1 -> layer_5_expert_sp3_ep1_tp1_pp1
	layer_5_expert_out_sp3_ep1_tp1_pp1 [label="Expert Out L5 SP3 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep1_tp1_pp1 -> layer_5_expert_out_sp3_ep1_tp1_pp1
	layer_5_expert_sp3_ep1_tp2_pp1 [label="Expert L5 SP3 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep1_pp1 -> layer_5_expert_sp3_ep1_tp2_pp1
	layer_5_expert_out_sp3_ep1_tp2_pp1 [label="Expert Out L5 SP3 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep1_tp2_pp1 -> layer_5_expert_out_sp3_ep1_tp2_pp1
	layer_5_expert_sp3_ep1_tp3_pp1 [label="Expert L5 SP3 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep1_pp1 -> layer_5_expert_sp3_ep1_tp3_pp1
	layer_5_expert_out_sp3_ep1_tp3_pp1 [label="Expert Out L5 SP3 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep1_tp3_pp1 -> layer_5_expert_out_sp3_ep1_tp3_pp1
	layer_5_expert_ar_sp3_ep1_pp1 [label="Expert All-Reduce L5 SP3 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep1_tp0_pp1 -> layer_5_expert_ar_sp3_ep1_pp1
	layer_5_expert_out_sp3_ep1_tp1_pp1 -> layer_5_expert_ar_sp3_ep1_pp1
	layer_5_expert_out_sp3_ep1_tp2_pp1 -> layer_5_expert_ar_sp3_ep1_pp1
	layer_5_expert_out_sp3_ep1_tp3_pp1 -> layer_5_expert_ar_sp3_ep1_pp1
	layer_5_combine_sp3_ep1_pp1 [label="Token Combine L5 SP3 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep1_pp1 -> layer_5_combine_sp3_ep1_pp1
	layer_5_dispatch_sp3_ep2_pp1 [label="Token Dispatch L5 SP3 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep2_pp1 [style=dashed]
	layer_5_expert_sp3_ep2_tp0_pp1 [label="Expert L5 SP3 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep2_pp1 -> layer_5_expert_sp3_ep2_tp0_pp1
	layer_5_expert_out_sp3_ep2_tp0_pp1 [label="Expert Out L5 SP3 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep2_tp0_pp1 -> layer_5_expert_out_sp3_ep2_tp0_pp1
	layer_5_expert_sp3_ep2_tp1_pp1 [label="Expert L5 SP3 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep2_pp1 -> layer_5_expert_sp3_ep2_tp1_pp1
	layer_5_expert_out_sp3_ep2_tp1_pp1 [label="Expert Out L5 SP3 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep2_tp1_pp1 -> layer_5_expert_out_sp3_ep2_tp1_pp1
	layer_5_expert_sp3_ep2_tp2_pp1 [label="Expert L5 SP3 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep2_pp1 -> layer_5_expert_sp3_ep2_tp2_pp1
	layer_5_expert_out_sp3_ep2_tp2_pp1 [label="Expert Out L5 SP3 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep2_tp2_pp1 -> layer_5_expert_out_sp3_ep2_tp2_pp1
	layer_5_expert_sp3_ep2_tp3_pp1 [label="Expert L5 SP3 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep2_pp1 -> layer_5_expert_sp3_ep2_tp3_pp1
	layer_5_expert_out_sp3_ep2_tp3_pp1 [label="Expert Out L5 SP3 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep2_tp3_pp1 -> layer_5_expert_out_sp3_ep2_tp3_pp1
	layer_5_expert_ar_sp3_ep2_pp1 [label="Expert All-Reduce L5 SP3 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep2_tp0_pp1 -> layer_5_expert_ar_sp3_ep2_pp1
	layer_5_expert_out_sp3_ep2_tp1_pp1 -> layer_5_expert_ar_sp3_ep2_pp1
	layer_5_expert_out_sp3_ep2_tp2_pp1 -> layer_5_expert_ar_sp3_ep2_pp1
	layer_5_expert_out_sp3_ep2_tp3_pp1 -> layer_5_expert_ar_sp3_ep2_pp1
	layer_5_combine_sp3_ep2_pp1 [label="Token Combine L5 SP3 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep2_pp1 -> layer_5_combine_sp3_ep2_pp1
	layer_5_dispatch_sp3_ep3_pp1 [label="Token Dispatch L5 SP3 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep3_pp1 [style=dashed]
	layer_5_expert_sp3_ep3_tp0_pp1 [label="Expert L5 SP3 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep3_pp1 -> layer_5_expert_sp3_ep3_tp0_pp1
	layer_5_expert_out_sp3_ep3_tp0_pp1 [label="Expert Out L5 SP3 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep3_tp0_pp1 -> layer_5_expert_out_sp3_ep3_tp0_pp1
	layer_5_expert_sp3_ep3_tp1_pp1 [label="Expert L5 SP3 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep3_pp1 -> layer_5_expert_sp3_ep3_tp1_pp1
	layer_5_expert_out_sp3_ep3_tp1_pp1 [label="Expert Out L5 SP3 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep3_tp1_pp1 -> layer_5_expert_out_sp3_ep3_tp1_pp1
	layer_5_expert_sp3_ep3_tp2_pp1 [label="Expert L5 SP3 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep3_pp1 -> layer_5_expert_sp3_ep3_tp2_pp1
	layer_5_expert_out_sp3_ep3_tp2_pp1 [label="Expert Out L5 SP3 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep3_tp2_pp1 -> layer_5_expert_out_sp3_ep3_tp2_pp1
	layer_5_expert_sp3_ep3_tp3_pp1 [label="Expert L5 SP3 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep3_pp1 -> layer_5_expert_sp3_ep3_tp3_pp1
	layer_5_expert_out_sp3_ep3_tp3_pp1 [label="Expert Out L5 SP3 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep3_tp3_pp1 -> layer_5_expert_out_sp3_ep3_tp3_pp1
	layer_5_expert_ar_sp3_ep3_pp1 [label="Expert All-Reduce L5 SP3 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep3_tp0_pp1 -> layer_5_expert_ar_sp3_ep3_pp1
	layer_5_expert_out_sp3_ep3_tp1_pp1 -> layer_5_expert_ar_sp3_ep3_pp1
	layer_5_expert_out_sp3_ep3_tp2_pp1 -> layer_5_expert_ar_sp3_ep3_pp1
	layer_5_expert_out_sp3_ep3_tp3_pp1 -> layer_5_expert_ar_sp3_ep3_pp1
	layer_5_combine_sp3_ep3_pp1 [label="Token Combine L5 SP3 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep3_pp1 -> layer_5_combine_sp3_ep3_pp1
	layer_5_dispatch_sp3_ep4_pp1 [label="Token Dispatch L5 SP3 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep4_pp1 [style=dashed]
	layer_5_expert_sp3_ep4_tp0_pp1 [label="Expert L5 SP3 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep4_pp1 -> layer_5_expert_sp3_ep4_tp0_pp1
	layer_5_expert_out_sp3_ep4_tp0_pp1 [label="Expert Out L5 SP3 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep4_tp0_pp1 -> layer_5_expert_out_sp3_ep4_tp0_pp1
	layer_5_expert_sp3_ep4_tp1_pp1 [label="Expert L5 SP3 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep4_pp1 -> layer_5_expert_sp3_ep4_tp1_pp1
	layer_5_expert_out_sp3_ep4_tp1_pp1 [label="Expert Out L5 SP3 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep4_tp1_pp1 -> layer_5_expert_out_sp3_ep4_tp1_pp1
	layer_5_expert_sp3_ep4_tp2_pp1 [label="Expert L5 SP3 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep4_pp1 -> layer_5_expert_sp3_ep4_tp2_pp1
	layer_5_expert_out_sp3_ep4_tp2_pp1 [label="Expert Out L5 SP3 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep4_tp2_pp1 -> layer_5_expert_out_sp3_ep4_tp2_pp1
	layer_5_expert_sp3_ep4_tp3_pp1 [label="Expert L5 SP3 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep4_pp1 -> layer_5_expert_sp3_ep4_tp3_pp1
	layer_5_expert_out_sp3_ep4_tp3_pp1 [label="Expert Out L5 SP3 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep4_tp3_pp1 -> layer_5_expert_out_sp3_ep4_tp3_pp1
	layer_5_expert_ar_sp3_ep4_pp1 [label="Expert All-Reduce L5 SP3 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep4_tp0_pp1 -> layer_5_expert_ar_sp3_ep4_pp1
	layer_5_expert_out_sp3_ep4_tp1_pp1 -> layer_5_expert_ar_sp3_ep4_pp1
	layer_5_expert_out_sp3_ep4_tp2_pp1 -> layer_5_expert_ar_sp3_ep4_pp1
	layer_5_expert_out_sp3_ep4_tp3_pp1 -> layer_5_expert_ar_sp3_ep4_pp1
	layer_5_combine_sp3_ep4_pp1 [label="Token Combine L5 SP3 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep4_pp1 -> layer_5_combine_sp3_ep4_pp1
	layer_5_dispatch_sp3_ep5_pp1 [label="Token Dispatch L5 SP3 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep5_pp1 [style=dashed]
	layer_5_expert_sp3_ep5_tp0_pp1 [label="Expert L5 SP3 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep5_pp1 -> layer_5_expert_sp3_ep5_tp0_pp1
	layer_5_expert_out_sp3_ep5_tp0_pp1 [label="Expert Out L5 SP3 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep5_tp0_pp1 -> layer_5_expert_out_sp3_ep5_tp0_pp1
	layer_5_expert_sp3_ep5_tp1_pp1 [label="Expert L5 SP3 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep5_pp1 -> layer_5_expert_sp3_ep5_tp1_pp1
	layer_5_expert_out_sp3_ep5_tp1_pp1 [label="Expert Out L5 SP3 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep5_tp1_pp1 -> layer_5_expert_out_sp3_ep5_tp1_pp1
	layer_5_expert_sp3_ep5_tp2_pp1 [label="Expert L5 SP3 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep5_pp1 -> layer_5_expert_sp3_ep5_tp2_pp1
	layer_5_expert_out_sp3_ep5_tp2_pp1 [label="Expert Out L5 SP3 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep5_tp2_pp1 -> layer_5_expert_out_sp3_ep5_tp2_pp1
	layer_5_expert_sp3_ep5_tp3_pp1 [label="Expert L5 SP3 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep5_pp1 -> layer_5_expert_sp3_ep5_tp3_pp1
	layer_5_expert_out_sp3_ep5_tp3_pp1 [label="Expert Out L5 SP3 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep5_tp3_pp1 -> layer_5_expert_out_sp3_ep5_tp3_pp1
	layer_5_expert_ar_sp3_ep5_pp1 [label="Expert All-Reduce L5 SP3 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep5_tp0_pp1 -> layer_5_expert_ar_sp3_ep5_pp1
	layer_5_expert_out_sp3_ep5_tp1_pp1 -> layer_5_expert_ar_sp3_ep5_pp1
	layer_5_expert_out_sp3_ep5_tp2_pp1 -> layer_5_expert_ar_sp3_ep5_pp1
	layer_5_expert_out_sp3_ep5_tp3_pp1 -> layer_5_expert_ar_sp3_ep5_pp1
	layer_5_combine_sp3_ep5_pp1 [label="Token Combine L5 SP3 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep5_pp1 -> layer_5_combine_sp3_ep5_pp1
	layer_5_dispatch_sp3_ep6_pp1 [label="Token Dispatch L5 SP3 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep6_pp1 [style=dashed]
	layer_5_expert_sp3_ep6_tp0_pp1 [label="Expert L5 SP3 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep6_pp1 -> layer_5_expert_sp3_ep6_tp0_pp1
	layer_5_expert_out_sp3_ep6_tp0_pp1 [label="Expert Out L5 SP3 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep6_tp0_pp1 -> layer_5_expert_out_sp3_ep6_tp0_pp1
	layer_5_expert_sp3_ep6_tp1_pp1 [label="Expert L5 SP3 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep6_pp1 -> layer_5_expert_sp3_ep6_tp1_pp1
	layer_5_expert_out_sp3_ep6_tp1_pp1 [label="Expert Out L5 SP3 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep6_tp1_pp1 -> layer_5_expert_out_sp3_ep6_tp1_pp1
	layer_5_expert_sp3_ep6_tp2_pp1 [label="Expert L5 SP3 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep6_pp1 -> layer_5_expert_sp3_ep6_tp2_pp1
	layer_5_expert_out_sp3_ep6_tp2_pp1 [label="Expert Out L5 SP3 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep6_tp2_pp1 -> layer_5_expert_out_sp3_ep6_tp2_pp1
	layer_5_expert_sp3_ep6_tp3_pp1 [label="Expert L5 SP3 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep6_pp1 -> layer_5_expert_sp3_ep6_tp3_pp1
	layer_5_expert_out_sp3_ep6_tp3_pp1 [label="Expert Out L5 SP3 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep6_tp3_pp1 -> layer_5_expert_out_sp3_ep6_tp3_pp1
	layer_5_expert_ar_sp3_ep6_pp1 [label="Expert All-Reduce L5 SP3 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep6_tp0_pp1 -> layer_5_expert_ar_sp3_ep6_pp1
	layer_5_expert_out_sp3_ep6_tp1_pp1 -> layer_5_expert_ar_sp3_ep6_pp1
	layer_5_expert_out_sp3_ep6_tp2_pp1 -> layer_5_expert_ar_sp3_ep6_pp1
	layer_5_expert_out_sp3_ep6_tp3_pp1 -> layer_5_expert_ar_sp3_ep6_pp1
	layer_5_combine_sp3_ep6_pp1 [label="Token Combine L5 SP3 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep6_pp1 -> layer_5_combine_sp3_ep6_pp1
	layer_5_dispatch_sp3_ep7_pp1 [label="Token Dispatch L5 SP3 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep7_pp1 [style=dashed]
	layer_5_expert_sp3_ep7_tp0_pp1 [label="Expert L5 SP3 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep7_pp1 -> layer_5_expert_sp3_ep7_tp0_pp1
	layer_5_expert_out_sp3_ep7_tp0_pp1 [label="Expert Out L5 SP3 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep7_tp0_pp1 -> layer_5_expert_out_sp3_ep7_tp0_pp1
	layer_5_expert_sp3_ep7_tp1_pp1 [label="Expert L5 SP3 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep7_pp1 -> layer_5_expert_sp3_ep7_tp1_pp1
	layer_5_expert_out_sp3_ep7_tp1_pp1 [label="Expert Out L5 SP3 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep7_tp1_pp1 -> layer_5_expert_out_sp3_ep7_tp1_pp1
	layer_5_expert_sp3_ep7_tp2_pp1 [label="Expert L5 SP3 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep7_pp1 -> layer_5_expert_sp3_ep7_tp2_pp1
	layer_5_expert_out_sp3_ep7_tp2_pp1 [label="Expert Out L5 SP3 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep7_tp2_pp1 -> layer_5_expert_out_sp3_ep7_tp2_pp1
	layer_5_expert_sp3_ep7_tp3_pp1 [label="Expert L5 SP3 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep7_pp1 -> layer_5_expert_sp3_ep7_tp3_pp1
	layer_5_expert_out_sp3_ep7_tp3_pp1 [label="Expert Out L5 SP3 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep7_tp3_pp1 -> layer_5_expert_out_sp3_ep7_tp3_pp1
	layer_5_expert_ar_sp3_ep7_pp1 [label="Expert All-Reduce L5 SP3 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep7_tp0_pp1 -> layer_5_expert_ar_sp3_ep7_pp1
	layer_5_expert_out_sp3_ep7_tp1_pp1 -> layer_5_expert_ar_sp3_ep7_pp1
	layer_5_expert_out_sp3_ep7_tp2_pp1 -> layer_5_expert_ar_sp3_ep7_pp1
	layer_5_expert_out_sp3_ep7_tp3_pp1 -> layer_5_expert_ar_sp3_ep7_pp1
	layer_5_combine_sp3_ep7_pp1 [label="Token Combine L5 SP3 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep7_pp1 -> layer_5_combine_sp3_ep7_pp1
	layer_5_dispatch_sp3_ep8_pp1 [label="Token Dispatch L5 SP3 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep8_pp1 [style=dashed]
	layer_5_expert_sp3_ep8_tp0_pp1 [label="Expert L5 SP3 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep8_pp1 -> layer_5_expert_sp3_ep8_tp0_pp1
	layer_5_expert_out_sp3_ep8_tp0_pp1 [label="Expert Out L5 SP3 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep8_tp0_pp1 -> layer_5_expert_out_sp3_ep8_tp0_pp1
	layer_5_expert_sp3_ep8_tp1_pp1 [label="Expert L5 SP3 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep8_pp1 -> layer_5_expert_sp3_ep8_tp1_pp1
	layer_5_expert_out_sp3_ep8_tp1_pp1 [label="Expert Out L5 SP3 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep8_tp1_pp1 -> layer_5_expert_out_sp3_ep8_tp1_pp1
	layer_5_expert_sp3_ep8_tp2_pp1 [label="Expert L5 SP3 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep8_pp1 -> layer_5_expert_sp3_ep8_tp2_pp1
	layer_5_expert_out_sp3_ep8_tp2_pp1 [label="Expert Out L5 SP3 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep8_tp2_pp1 -> layer_5_expert_out_sp3_ep8_tp2_pp1
	layer_5_expert_sp3_ep8_tp3_pp1 [label="Expert L5 SP3 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep8_pp1 -> layer_5_expert_sp3_ep8_tp3_pp1
	layer_5_expert_out_sp3_ep8_tp3_pp1 [label="Expert Out L5 SP3 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep8_tp3_pp1 -> layer_5_expert_out_sp3_ep8_tp3_pp1
	layer_5_expert_ar_sp3_ep8_pp1 [label="Expert All-Reduce L5 SP3 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep8_tp0_pp1 -> layer_5_expert_ar_sp3_ep8_pp1
	layer_5_expert_out_sp3_ep8_tp1_pp1 -> layer_5_expert_ar_sp3_ep8_pp1
	layer_5_expert_out_sp3_ep8_tp2_pp1 -> layer_5_expert_ar_sp3_ep8_pp1
	layer_5_expert_out_sp3_ep8_tp3_pp1 -> layer_5_expert_ar_sp3_ep8_pp1
	layer_5_combine_sp3_ep8_pp1 [label="Token Combine L5 SP3 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep8_pp1 -> layer_5_combine_sp3_ep8_pp1
	layer_5_dispatch_sp3_ep9_pp1 [label="Token Dispatch L5 SP3 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep9_pp1 [style=dashed]
	layer_5_expert_sp3_ep9_tp0_pp1 [label="Expert L5 SP3 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep9_pp1 -> layer_5_expert_sp3_ep9_tp0_pp1
	layer_5_expert_out_sp3_ep9_tp0_pp1 [label="Expert Out L5 SP3 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep9_tp0_pp1 -> layer_5_expert_out_sp3_ep9_tp0_pp1
	layer_5_expert_sp3_ep9_tp1_pp1 [label="Expert L5 SP3 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep9_pp1 -> layer_5_expert_sp3_ep9_tp1_pp1
	layer_5_expert_out_sp3_ep9_tp1_pp1 [label="Expert Out L5 SP3 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep9_tp1_pp1 -> layer_5_expert_out_sp3_ep9_tp1_pp1
	layer_5_expert_sp3_ep9_tp2_pp1 [label="Expert L5 SP3 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep9_pp1 -> layer_5_expert_sp3_ep9_tp2_pp1
	layer_5_expert_out_sp3_ep9_tp2_pp1 [label="Expert Out L5 SP3 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep9_tp2_pp1 -> layer_5_expert_out_sp3_ep9_tp2_pp1
	layer_5_expert_sp3_ep9_tp3_pp1 [label="Expert L5 SP3 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep9_pp1 -> layer_5_expert_sp3_ep9_tp3_pp1
	layer_5_expert_out_sp3_ep9_tp3_pp1 [label="Expert Out L5 SP3 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep9_tp3_pp1 -> layer_5_expert_out_sp3_ep9_tp3_pp1
	layer_5_expert_ar_sp3_ep9_pp1 [label="Expert All-Reduce L5 SP3 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep9_tp0_pp1 -> layer_5_expert_ar_sp3_ep9_pp1
	layer_5_expert_out_sp3_ep9_tp1_pp1 -> layer_5_expert_ar_sp3_ep9_pp1
	layer_5_expert_out_sp3_ep9_tp2_pp1 -> layer_5_expert_ar_sp3_ep9_pp1
	layer_5_expert_out_sp3_ep9_tp3_pp1 -> layer_5_expert_ar_sp3_ep9_pp1
	layer_5_combine_sp3_ep9_pp1 [label="Token Combine L5 SP3 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep9_pp1 -> layer_5_combine_sp3_ep9_pp1
	layer_5_dispatch_sp3_ep10_pp1 [label="Token Dispatch L5 SP3 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep10_pp1 [style=dashed]
	layer_5_expert_sp3_ep10_tp0_pp1 [label="Expert L5 SP3 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep10_pp1 -> layer_5_expert_sp3_ep10_tp0_pp1
	layer_5_expert_out_sp3_ep10_tp0_pp1 [label="Expert Out L5 SP3 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep10_tp0_pp1 -> layer_5_expert_out_sp3_ep10_tp0_pp1
	layer_5_expert_sp3_ep10_tp1_pp1 [label="Expert L5 SP3 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep10_pp1 -> layer_5_expert_sp3_ep10_tp1_pp1
	layer_5_expert_out_sp3_ep10_tp1_pp1 [label="Expert Out L5 SP3 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep10_tp1_pp1 -> layer_5_expert_out_sp3_ep10_tp1_pp1
	layer_5_expert_sp3_ep10_tp2_pp1 [label="Expert L5 SP3 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep10_pp1 -> layer_5_expert_sp3_ep10_tp2_pp1
	layer_5_expert_out_sp3_ep10_tp2_pp1 [label="Expert Out L5 SP3 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep10_tp2_pp1 -> layer_5_expert_out_sp3_ep10_tp2_pp1
	layer_5_expert_sp3_ep10_tp3_pp1 [label="Expert L5 SP3 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep10_pp1 -> layer_5_expert_sp3_ep10_tp3_pp1
	layer_5_expert_out_sp3_ep10_tp3_pp1 [label="Expert Out L5 SP3 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep10_tp3_pp1 -> layer_5_expert_out_sp3_ep10_tp3_pp1
	layer_5_expert_ar_sp3_ep10_pp1 [label="Expert All-Reduce L5 SP3 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep10_tp0_pp1 -> layer_5_expert_ar_sp3_ep10_pp1
	layer_5_expert_out_sp3_ep10_tp1_pp1 -> layer_5_expert_ar_sp3_ep10_pp1
	layer_5_expert_out_sp3_ep10_tp2_pp1 -> layer_5_expert_ar_sp3_ep10_pp1
	layer_5_expert_out_sp3_ep10_tp3_pp1 -> layer_5_expert_ar_sp3_ep10_pp1
	layer_5_combine_sp3_ep10_pp1 [label="Token Combine L5 SP3 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep10_pp1 -> layer_5_combine_sp3_ep10_pp1
	layer_5_dispatch_sp3_ep11_pp1 [label="Token Dispatch L5 SP3 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep11_pp1 [style=dashed]
	layer_5_expert_sp3_ep11_tp0_pp1 [label="Expert L5 SP3 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep11_pp1 -> layer_5_expert_sp3_ep11_tp0_pp1
	layer_5_expert_out_sp3_ep11_tp0_pp1 [label="Expert Out L5 SP3 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep11_tp0_pp1 -> layer_5_expert_out_sp3_ep11_tp0_pp1
	layer_5_expert_sp3_ep11_tp1_pp1 [label="Expert L5 SP3 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep11_pp1 -> layer_5_expert_sp3_ep11_tp1_pp1
	layer_5_expert_out_sp3_ep11_tp1_pp1 [label="Expert Out L5 SP3 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep11_tp1_pp1 -> layer_5_expert_out_sp3_ep11_tp1_pp1
	layer_5_expert_sp3_ep11_tp2_pp1 [label="Expert L5 SP3 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep11_pp1 -> layer_5_expert_sp3_ep11_tp2_pp1
	layer_5_expert_out_sp3_ep11_tp2_pp1 [label="Expert Out L5 SP3 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep11_tp2_pp1 -> layer_5_expert_out_sp3_ep11_tp2_pp1
	layer_5_expert_sp3_ep11_tp3_pp1 [label="Expert L5 SP3 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep11_pp1 -> layer_5_expert_sp3_ep11_tp3_pp1
	layer_5_expert_out_sp3_ep11_tp3_pp1 [label="Expert Out L5 SP3 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep11_tp3_pp1 -> layer_5_expert_out_sp3_ep11_tp3_pp1
	layer_5_expert_ar_sp3_ep11_pp1 [label="Expert All-Reduce L5 SP3 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep11_tp0_pp1 -> layer_5_expert_ar_sp3_ep11_pp1
	layer_5_expert_out_sp3_ep11_tp1_pp1 -> layer_5_expert_ar_sp3_ep11_pp1
	layer_5_expert_out_sp3_ep11_tp2_pp1 -> layer_5_expert_ar_sp3_ep11_pp1
	layer_5_expert_out_sp3_ep11_tp3_pp1 -> layer_5_expert_ar_sp3_ep11_pp1
	layer_5_combine_sp3_ep11_pp1 [label="Token Combine L5 SP3 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep11_pp1 -> layer_5_combine_sp3_ep11_pp1
	layer_5_dispatch_sp3_ep12_pp1 [label="Token Dispatch L5 SP3 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep12_pp1 [style=dashed]
	layer_5_expert_sp3_ep12_tp0_pp1 [label="Expert L5 SP3 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep12_pp1 -> layer_5_expert_sp3_ep12_tp0_pp1
	layer_5_expert_out_sp3_ep12_tp0_pp1 [label="Expert Out L5 SP3 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep12_tp0_pp1 -> layer_5_expert_out_sp3_ep12_tp0_pp1
	layer_5_expert_sp3_ep12_tp1_pp1 [label="Expert L5 SP3 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep12_pp1 -> layer_5_expert_sp3_ep12_tp1_pp1
	layer_5_expert_out_sp3_ep12_tp1_pp1 [label="Expert Out L5 SP3 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep12_tp1_pp1 -> layer_5_expert_out_sp3_ep12_tp1_pp1
	layer_5_expert_sp3_ep12_tp2_pp1 [label="Expert L5 SP3 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep12_pp1 -> layer_5_expert_sp3_ep12_tp2_pp1
	layer_5_expert_out_sp3_ep12_tp2_pp1 [label="Expert Out L5 SP3 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep12_tp2_pp1 -> layer_5_expert_out_sp3_ep12_tp2_pp1
	layer_5_expert_sp3_ep12_tp3_pp1 [label="Expert L5 SP3 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep12_pp1 -> layer_5_expert_sp3_ep12_tp3_pp1
	layer_5_expert_out_sp3_ep12_tp3_pp1 [label="Expert Out L5 SP3 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep12_tp3_pp1 -> layer_5_expert_out_sp3_ep12_tp3_pp1
	layer_5_expert_ar_sp3_ep12_pp1 [label="Expert All-Reduce L5 SP3 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep12_tp0_pp1 -> layer_5_expert_ar_sp3_ep12_pp1
	layer_5_expert_out_sp3_ep12_tp1_pp1 -> layer_5_expert_ar_sp3_ep12_pp1
	layer_5_expert_out_sp3_ep12_tp2_pp1 -> layer_5_expert_ar_sp3_ep12_pp1
	layer_5_expert_out_sp3_ep12_tp3_pp1 -> layer_5_expert_ar_sp3_ep12_pp1
	layer_5_combine_sp3_ep12_pp1 [label="Token Combine L5 SP3 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep12_pp1 -> layer_5_combine_sp3_ep12_pp1
	layer_5_dispatch_sp3_ep13_pp1 [label="Token Dispatch L5 SP3 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep13_pp1 [style=dashed]
	layer_5_expert_sp3_ep13_tp0_pp1 [label="Expert L5 SP3 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep13_pp1 -> layer_5_expert_sp3_ep13_tp0_pp1
	layer_5_expert_out_sp3_ep13_tp0_pp1 [label="Expert Out L5 SP3 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep13_tp0_pp1 -> layer_5_expert_out_sp3_ep13_tp0_pp1
	layer_5_expert_sp3_ep13_tp1_pp1 [label="Expert L5 SP3 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep13_pp1 -> layer_5_expert_sp3_ep13_tp1_pp1
	layer_5_expert_out_sp3_ep13_tp1_pp1 [label="Expert Out L5 SP3 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep13_tp1_pp1 -> layer_5_expert_out_sp3_ep13_tp1_pp1
	layer_5_expert_sp3_ep13_tp2_pp1 [label="Expert L5 SP3 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep13_pp1 -> layer_5_expert_sp3_ep13_tp2_pp1
	layer_5_expert_out_sp3_ep13_tp2_pp1 [label="Expert Out L5 SP3 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep13_tp2_pp1 -> layer_5_expert_out_sp3_ep13_tp2_pp1
	layer_5_expert_sp3_ep13_tp3_pp1 [label="Expert L5 SP3 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep13_pp1 -> layer_5_expert_sp3_ep13_tp3_pp1
	layer_5_expert_out_sp3_ep13_tp3_pp1 [label="Expert Out L5 SP3 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep13_tp3_pp1 -> layer_5_expert_out_sp3_ep13_tp3_pp1
	layer_5_expert_ar_sp3_ep13_pp1 [label="Expert All-Reduce L5 SP3 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep13_tp0_pp1 -> layer_5_expert_ar_sp3_ep13_pp1
	layer_5_expert_out_sp3_ep13_tp1_pp1 -> layer_5_expert_ar_sp3_ep13_pp1
	layer_5_expert_out_sp3_ep13_tp2_pp1 -> layer_5_expert_ar_sp3_ep13_pp1
	layer_5_expert_out_sp3_ep13_tp3_pp1 -> layer_5_expert_ar_sp3_ep13_pp1
	layer_5_combine_sp3_ep13_pp1 [label="Token Combine L5 SP3 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep13_pp1 -> layer_5_combine_sp3_ep13_pp1
	layer_5_dispatch_sp3_ep14_pp1 [label="Token Dispatch L5 SP3 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep14_pp1 [style=dashed]
	layer_5_expert_sp3_ep14_tp0_pp1 [label="Expert L5 SP3 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep14_pp1 -> layer_5_expert_sp3_ep14_tp0_pp1
	layer_5_expert_out_sp3_ep14_tp0_pp1 [label="Expert Out L5 SP3 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep14_tp0_pp1 -> layer_5_expert_out_sp3_ep14_tp0_pp1
	layer_5_expert_sp3_ep14_tp1_pp1 [label="Expert L5 SP3 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep14_pp1 -> layer_5_expert_sp3_ep14_tp1_pp1
	layer_5_expert_out_sp3_ep14_tp1_pp1 [label="Expert Out L5 SP3 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep14_tp1_pp1 -> layer_5_expert_out_sp3_ep14_tp1_pp1
	layer_5_expert_sp3_ep14_tp2_pp1 [label="Expert L5 SP3 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep14_pp1 -> layer_5_expert_sp3_ep14_tp2_pp1
	layer_5_expert_out_sp3_ep14_tp2_pp1 [label="Expert Out L5 SP3 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep14_tp2_pp1 -> layer_5_expert_out_sp3_ep14_tp2_pp1
	layer_5_expert_sp3_ep14_tp3_pp1 [label="Expert L5 SP3 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep14_pp1 -> layer_5_expert_sp3_ep14_tp3_pp1
	layer_5_expert_out_sp3_ep14_tp3_pp1 [label="Expert Out L5 SP3 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep14_tp3_pp1 -> layer_5_expert_out_sp3_ep14_tp3_pp1
	layer_5_expert_ar_sp3_ep14_pp1 [label="Expert All-Reduce L5 SP3 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep14_tp0_pp1 -> layer_5_expert_ar_sp3_ep14_pp1
	layer_5_expert_out_sp3_ep14_tp1_pp1 -> layer_5_expert_ar_sp3_ep14_pp1
	layer_5_expert_out_sp3_ep14_tp2_pp1 -> layer_5_expert_ar_sp3_ep14_pp1
	layer_5_expert_out_sp3_ep14_tp3_pp1 -> layer_5_expert_ar_sp3_ep14_pp1
	layer_5_combine_sp3_ep14_pp1 [label="Token Combine L5 SP3 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep14_pp1 -> layer_5_combine_sp3_ep14_pp1
	layer_5_dispatch_sp3_ep15_pp1 [label="Token Dispatch L5 SP3 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_5_router_sp3_pp1 -> layer_5_dispatch_sp3_ep15_pp1 [style=dashed]
	layer_5_expert_sp3_ep15_tp0_pp1 [label="Expert L5 SP3 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep15_pp1 -> layer_5_expert_sp3_ep15_tp0_pp1
	layer_5_expert_out_sp3_ep15_tp0_pp1 [label="Expert Out L5 SP3 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep15_tp0_pp1 -> layer_5_expert_out_sp3_ep15_tp0_pp1
	layer_5_expert_sp3_ep15_tp1_pp1 [label="Expert L5 SP3 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep15_pp1 -> layer_5_expert_sp3_ep15_tp1_pp1
	layer_5_expert_out_sp3_ep15_tp1_pp1 [label="Expert Out L5 SP3 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep15_tp1_pp1 -> layer_5_expert_out_sp3_ep15_tp1_pp1
	layer_5_expert_sp3_ep15_tp2_pp1 [label="Expert L5 SP3 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep15_pp1 -> layer_5_expert_sp3_ep15_tp2_pp1
	layer_5_expert_out_sp3_ep15_tp2_pp1 [label="Expert Out L5 SP3 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep15_tp2_pp1 -> layer_5_expert_out_sp3_ep15_tp2_pp1
	layer_5_expert_sp3_ep15_tp3_pp1 [label="Expert L5 SP3 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_dispatch_sp3_ep15_pp1 -> layer_5_expert_sp3_ep15_tp3_pp1
	layer_5_expert_out_sp3_ep15_tp3_pp1 [label="Expert Out L5 SP3 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_5_expert_sp3_ep15_tp3_pp1 -> layer_5_expert_out_sp3_ep15_tp3_pp1
	layer_5_expert_ar_sp3_ep15_pp1 [label="Expert All-Reduce L5 SP3 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_5_expert_out_sp3_ep15_tp0_pp1 -> layer_5_expert_ar_sp3_ep15_pp1
	layer_5_expert_out_sp3_ep15_tp1_pp1 -> layer_5_expert_ar_sp3_ep15_pp1
	layer_5_expert_out_sp3_ep15_tp2_pp1 -> layer_5_expert_ar_sp3_ep15_pp1
	layer_5_expert_out_sp3_ep15_tp3_pp1 -> layer_5_expert_ar_sp3_ep15_pp1
	layer_5_combine_sp3_ep15_pp1 [label="Token Combine L5 SP3 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_5_expert_ar_sp3_ep15_pp1 -> layer_5_combine_sp3_ep15_pp1
	layer_5_moe_all2all_sp3_pp1 [label="MoE All-to-All L5 SP3\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_5_combine_sp3_ep0_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep1_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep2_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep3_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep4_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep5_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep6_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep7_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep8_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep9_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep10_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep11_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep12_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep13_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep14_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_combine_sp3_ep15_pp1 -> layer_5_moe_all2all_sp3_pp1
	layer_5_mlp_out_sp3_pp1 [label="MoE Output L5 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_moe_all2all_sp3_pp1 -> layer_5_mlp_out_sp3_pp1
	layer_5_mlp_res_sp3_pp1 [label="MLP Residual L5 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_mlp_out_sp3_pp1 -> layer_5_mlp_res_sp3_pp1
	layer_5_attn_res_sp3_pp1 -> layer_5_mlp_res_sp3_pp1 [style=dashed]
	layer_6_norm_sp0_pp1 [label="LayerNorm L6 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_mlp_out_sp0_pp1 -> layer_6_norm_sp0_pp1
	layer_6_qkv_sp0_tp0_pp1 [label="QKV Proj L6 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp0_pp1 -> layer_6_qkv_sp0_tp0_pp1
	layer_6_attn_sp0_tp0_pp1 [label="Attention L6 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp0_tp0_pp1 -> layer_6_attn_sp0_tp0_pp1
	layer_6_attn_out_sp0_tp0_pp1 [label="Attn Out Proj L6 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp0_tp0_pp1 -> layer_6_attn_out_sp0_tp0_pp1
	layer_6_qkv_sp0_tp1_pp1 [label="QKV Proj L6 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp0_pp1 -> layer_6_qkv_sp0_tp1_pp1
	layer_6_attn_sp0_tp1_pp1 [label="Attention L6 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp0_tp1_pp1 -> layer_6_attn_sp0_tp1_pp1
	layer_6_attn_out_sp0_tp1_pp1 [label="Attn Out Proj L6 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp0_tp1_pp1 -> layer_6_attn_out_sp0_tp1_pp1
	layer_6_qkv_sp0_tp2_pp1 [label="QKV Proj L6 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp0_pp1 -> layer_6_qkv_sp0_tp2_pp1
	layer_6_attn_sp0_tp2_pp1 [label="Attention L6 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp0_tp2_pp1 -> layer_6_attn_sp0_tp2_pp1
	layer_6_attn_out_sp0_tp2_pp1 [label="Attn Out Proj L6 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp0_tp2_pp1 -> layer_6_attn_out_sp0_tp2_pp1
	layer_6_qkv_sp0_tp3_pp1 [label="QKV Proj L6 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp0_pp1 -> layer_6_qkv_sp0_tp3_pp1
	layer_6_attn_sp0_tp3_pp1 [label="Attention L6 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp0_tp3_pp1 -> layer_6_attn_sp0_tp3_pp1
	layer_6_attn_out_sp0_tp3_pp1 [label="Attn Out Proj L6 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp0_tp3_pp1 -> layer_6_attn_out_sp0_tp3_pp1
	layer_6_attn_ar_sp0_pp1 [label="Attention All-Reduce L6 SP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_attn_out_sp0_tp0_pp1 -> layer_6_attn_ar_sp0_pp1
	layer_6_attn_out_sp0_tp1_pp1 -> layer_6_attn_ar_sp0_pp1
	layer_6_attn_out_sp0_tp2_pp1 -> layer_6_attn_ar_sp0_pp1
	layer_6_attn_out_sp0_tp3_pp1 -> layer_6_attn_ar_sp0_pp1
	layer_6_attn_res_sp0_pp1 [label="Attention Residual L6 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_attn_ar_sp0_pp1 -> layer_6_attn_res_sp0_pp1
	layer_6_norm_sp0_pp1 -> layer_6_attn_res_sp0_pp1 [style=dashed]
	layer_6_post_norm_sp0_pp1 [label="Post-Attn Norm L6 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_attn_res_sp0_pp1 -> layer_6_post_norm_sp0_pp1
	layer_6_router_sp0_pp1 [label="MoE Router L6 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_6_post_norm_sp0_pp1 -> layer_6_router_sp0_pp1
	layer_6_dispatch_sp0_ep0_pp1 [label="Token Dispatch L6 SP0 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep0_pp1 [style=dashed]
	layer_6_expert_sp0_ep0_tp0_pp1 [label="Expert L6 SP0 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep0_pp1 -> layer_6_expert_sp0_ep0_tp0_pp1
	layer_6_expert_out_sp0_ep0_tp0_pp1 [label="Expert Out L6 SP0 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep0_tp0_pp1 -> layer_6_expert_out_sp0_ep0_tp0_pp1
	layer_6_expert_sp0_ep0_tp1_pp1 [label="Expert L6 SP0 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep0_pp1 -> layer_6_expert_sp0_ep0_tp1_pp1
	layer_6_expert_out_sp0_ep0_tp1_pp1 [label="Expert Out L6 SP0 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep0_tp1_pp1 -> layer_6_expert_out_sp0_ep0_tp1_pp1
	layer_6_expert_sp0_ep0_tp2_pp1 [label="Expert L6 SP0 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep0_pp1 -> layer_6_expert_sp0_ep0_tp2_pp1
	layer_6_expert_out_sp0_ep0_tp2_pp1 [label="Expert Out L6 SP0 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep0_tp2_pp1 -> layer_6_expert_out_sp0_ep0_tp2_pp1
	layer_6_expert_sp0_ep0_tp3_pp1 [label="Expert L6 SP0 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep0_pp1 -> layer_6_expert_sp0_ep0_tp3_pp1
	layer_6_expert_out_sp0_ep0_tp3_pp1 [label="Expert Out L6 SP0 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep0_tp3_pp1 -> layer_6_expert_out_sp0_ep0_tp3_pp1
	layer_6_expert_ar_sp0_ep0_pp1 [label="Expert All-Reduce L6 SP0 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep0_tp0_pp1 -> layer_6_expert_ar_sp0_ep0_pp1
	layer_6_expert_out_sp0_ep0_tp1_pp1 -> layer_6_expert_ar_sp0_ep0_pp1
	layer_6_expert_out_sp0_ep0_tp2_pp1 -> layer_6_expert_ar_sp0_ep0_pp1
	layer_6_expert_out_sp0_ep0_tp3_pp1 -> layer_6_expert_ar_sp0_ep0_pp1
	layer_6_combine_sp0_ep0_pp1 [label="Token Combine L6 SP0 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep0_pp1 -> layer_6_combine_sp0_ep0_pp1
	layer_6_dispatch_sp0_ep1_pp1 [label="Token Dispatch L6 SP0 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep1_pp1 [style=dashed]
	layer_6_expert_sp0_ep1_tp0_pp1 [label="Expert L6 SP0 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep1_pp1 -> layer_6_expert_sp0_ep1_tp0_pp1
	layer_6_expert_out_sp0_ep1_tp0_pp1 [label="Expert Out L6 SP0 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep1_tp0_pp1 -> layer_6_expert_out_sp0_ep1_tp0_pp1
	layer_6_expert_sp0_ep1_tp1_pp1 [label="Expert L6 SP0 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep1_pp1 -> layer_6_expert_sp0_ep1_tp1_pp1
	layer_6_expert_out_sp0_ep1_tp1_pp1 [label="Expert Out L6 SP0 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep1_tp1_pp1 -> layer_6_expert_out_sp0_ep1_tp1_pp1
	layer_6_expert_sp0_ep1_tp2_pp1 [label="Expert L6 SP0 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep1_pp1 -> layer_6_expert_sp0_ep1_tp2_pp1
	layer_6_expert_out_sp0_ep1_tp2_pp1 [label="Expert Out L6 SP0 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep1_tp2_pp1 -> layer_6_expert_out_sp0_ep1_tp2_pp1
	layer_6_expert_sp0_ep1_tp3_pp1 [label="Expert L6 SP0 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep1_pp1 -> layer_6_expert_sp0_ep1_tp3_pp1
	layer_6_expert_out_sp0_ep1_tp3_pp1 [label="Expert Out L6 SP0 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep1_tp3_pp1 -> layer_6_expert_out_sp0_ep1_tp3_pp1
	layer_6_expert_ar_sp0_ep1_pp1 [label="Expert All-Reduce L6 SP0 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep1_tp0_pp1 -> layer_6_expert_ar_sp0_ep1_pp1
	layer_6_expert_out_sp0_ep1_tp1_pp1 -> layer_6_expert_ar_sp0_ep1_pp1
	layer_6_expert_out_sp0_ep1_tp2_pp1 -> layer_6_expert_ar_sp0_ep1_pp1
	layer_6_expert_out_sp0_ep1_tp3_pp1 -> layer_6_expert_ar_sp0_ep1_pp1
	layer_6_combine_sp0_ep1_pp1 [label="Token Combine L6 SP0 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep1_pp1 -> layer_6_combine_sp0_ep1_pp1
	layer_6_dispatch_sp0_ep2_pp1 [label="Token Dispatch L6 SP0 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep2_pp1 [style=dashed]
	layer_6_expert_sp0_ep2_tp0_pp1 [label="Expert L6 SP0 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep2_pp1 -> layer_6_expert_sp0_ep2_tp0_pp1
	layer_6_expert_out_sp0_ep2_tp0_pp1 [label="Expert Out L6 SP0 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep2_tp0_pp1 -> layer_6_expert_out_sp0_ep2_tp0_pp1
	layer_6_expert_sp0_ep2_tp1_pp1 [label="Expert L6 SP0 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep2_pp1 -> layer_6_expert_sp0_ep2_tp1_pp1
	layer_6_expert_out_sp0_ep2_tp1_pp1 [label="Expert Out L6 SP0 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep2_tp1_pp1 -> layer_6_expert_out_sp0_ep2_tp1_pp1
	layer_6_expert_sp0_ep2_tp2_pp1 [label="Expert L6 SP0 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep2_pp1 -> layer_6_expert_sp0_ep2_tp2_pp1
	layer_6_expert_out_sp0_ep2_tp2_pp1 [label="Expert Out L6 SP0 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep2_tp2_pp1 -> layer_6_expert_out_sp0_ep2_tp2_pp1
	layer_6_expert_sp0_ep2_tp3_pp1 [label="Expert L6 SP0 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep2_pp1 -> layer_6_expert_sp0_ep2_tp3_pp1
	layer_6_expert_out_sp0_ep2_tp3_pp1 [label="Expert Out L6 SP0 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep2_tp3_pp1 -> layer_6_expert_out_sp0_ep2_tp3_pp1
	layer_6_expert_ar_sp0_ep2_pp1 [label="Expert All-Reduce L6 SP0 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep2_tp0_pp1 -> layer_6_expert_ar_sp0_ep2_pp1
	layer_6_expert_out_sp0_ep2_tp1_pp1 -> layer_6_expert_ar_sp0_ep2_pp1
	layer_6_expert_out_sp0_ep2_tp2_pp1 -> layer_6_expert_ar_sp0_ep2_pp1
	layer_6_expert_out_sp0_ep2_tp3_pp1 -> layer_6_expert_ar_sp0_ep2_pp1
	layer_6_combine_sp0_ep2_pp1 [label="Token Combine L6 SP0 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep2_pp1 -> layer_6_combine_sp0_ep2_pp1
	layer_6_dispatch_sp0_ep3_pp1 [label="Token Dispatch L6 SP0 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep3_pp1 [style=dashed]
	layer_6_expert_sp0_ep3_tp0_pp1 [label="Expert L6 SP0 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep3_pp1 -> layer_6_expert_sp0_ep3_tp0_pp1
	layer_6_expert_out_sp0_ep3_tp0_pp1 [label="Expert Out L6 SP0 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep3_tp0_pp1 -> layer_6_expert_out_sp0_ep3_tp0_pp1
	layer_6_expert_sp0_ep3_tp1_pp1 [label="Expert L6 SP0 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep3_pp1 -> layer_6_expert_sp0_ep3_tp1_pp1
	layer_6_expert_out_sp0_ep3_tp1_pp1 [label="Expert Out L6 SP0 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep3_tp1_pp1 -> layer_6_expert_out_sp0_ep3_tp1_pp1
	layer_6_expert_sp0_ep3_tp2_pp1 [label="Expert L6 SP0 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep3_pp1 -> layer_6_expert_sp0_ep3_tp2_pp1
	layer_6_expert_out_sp0_ep3_tp2_pp1 [label="Expert Out L6 SP0 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep3_tp2_pp1 -> layer_6_expert_out_sp0_ep3_tp2_pp1
	layer_6_expert_sp0_ep3_tp3_pp1 [label="Expert L6 SP0 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep3_pp1 -> layer_6_expert_sp0_ep3_tp3_pp1
	layer_6_expert_out_sp0_ep3_tp3_pp1 [label="Expert Out L6 SP0 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep3_tp3_pp1 -> layer_6_expert_out_sp0_ep3_tp3_pp1
	layer_6_expert_ar_sp0_ep3_pp1 [label="Expert All-Reduce L6 SP0 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep3_tp0_pp1 -> layer_6_expert_ar_sp0_ep3_pp1
	layer_6_expert_out_sp0_ep3_tp1_pp1 -> layer_6_expert_ar_sp0_ep3_pp1
	layer_6_expert_out_sp0_ep3_tp2_pp1 -> layer_6_expert_ar_sp0_ep3_pp1
	layer_6_expert_out_sp0_ep3_tp3_pp1 -> layer_6_expert_ar_sp0_ep3_pp1
	layer_6_combine_sp0_ep3_pp1 [label="Token Combine L6 SP0 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep3_pp1 -> layer_6_combine_sp0_ep3_pp1
	layer_6_dispatch_sp0_ep4_pp1 [label="Token Dispatch L6 SP0 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep4_pp1 [style=dashed]
	layer_6_expert_sp0_ep4_tp0_pp1 [label="Expert L6 SP0 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep4_pp1 -> layer_6_expert_sp0_ep4_tp0_pp1
	layer_6_expert_out_sp0_ep4_tp0_pp1 [label="Expert Out L6 SP0 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep4_tp0_pp1 -> layer_6_expert_out_sp0_ep4_tp0_pp1
	layer_6_expert_sp0_ep4_tp1_pp1 [label="Expert L6 SP0 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep4_pp1 -> layer_6_expert_sp0_ep4_tp1_pp1
	layer_6_expert_out_sp0_ep4_tp1_pp1 [label="Expert Out L6 SP0 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep4_tp1_pp1 -> layer_6_expert_out_sp0_ep4_tp1_pp1
	layer_6_expert_sp0_ep4_tp2_pp1 [label="Expert L6 SP0 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep4_pp1 -> layer_6_expert_sp0_ep4_tp2_pp1
	layer_6_expert_out_sp0_ep4_tp2_pp1 [label="Expert Out L6 SP0 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep4_tp2_pp1 -> layer_6_expert_out_sp0_ep4_tp2_pp1
	layer_6_expert_sp0_ep4_tp3_pp1 [label="Expert L6 SP0 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep4_pp1 -> layer_6_expert_sp0_ep4_tp3_pp1
	layer_6_expert_out_sp0_ep4_tp3_pp1 [label="Expert Out L6 SP0 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep4_tp3_pp1 -> layer_6_expert_out_sp0_ep4_tp3_pp1
	layer_6_expert_ar_sp0_ep4_pp1 [label="Expert All-Reduce L6 SP0 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep4_tp0_pp1 -> layer_6_expert_ar_sp0_ep4_pp1
	layer_6_expert_out_sp0_ep4_tp1_pp1 -> layer_6_expert_ar_sp0_ep4_pp1
	layer_6_expert_out_sp0_ep4_tp2_pp1 -> layer_6_expert_ar_sp0_ep4_pp1
	layer_6_expert_out_sp0_ep4_tp3_pp1 -> layer_6_expert_ar_sp0_ep4_pp1
	layer_6_combine_sp0_ep4_pp1 [label="Token Combine L6 SP0 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep4_pp1 -> layer_6_combine_sp0_ep4_pp1
	layer_6_dispatch_sp0_ep5_pp1 [label="Token Dispatch L6 SP0 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep5_pp1 [style=dashed]
	layer_6_expert_sp0_ep5_tp0_pp1 [label="Expert L6 SP0 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep5_pp1 -> layer_6_expert_sp0_ep5_tp0_pp1
	layer_6_expert_out_sp0_ep5_tp0_pp1 [label="Expert Out L6 SP0 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep5_tp0_pp1 -> layer_6_expert_out_sp0_ep5_tp0_pp1
	layer_6_expert_sp0_ep5_tp1_pp1 [label="Expert L6 SP0 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep5_pp1 -> layer_6_expert_sp0_ep5_tp1_pp1
	layer_6_expert_out_sp0_ep5_tp1_pp1 [label="Expert Out L6 SP0 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep5_tp1_pp1 -> layer_6_expert_out_sp0_ep5_tp1_pp1
	layer_6_expert_sp0_ep5_tp2_pp1 [label="Expert L6 SP0 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep5_pp1 -> layer_6_expert_sp0_ep5_tp2_pp1
	layer_6_expert_out_sp0_ep5_tp2_pp1 [label="Expert Out L6 SP0 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep5_tp2_pp1 -> layer_6_expert_out_sp0_ep5_tp2_pp1
	layer_6_expert_sp0_ep5_tp3_pp1 [label="Expert L6 SP0 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep5_pp1 -> layer_6_expert_sp0_ep5_tp3_pp1
	layer_6_expert_out_sp0_ep5_tp3_pp1 [label="Expert Out L6 SP0 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep5_tp3_pp1 -> layer_6_expert_out_sp0_ep5_tp3_pp1
	layer_6_expert_ar_sp0_ep5_pp1 [label="Expert All-Reduce L6 SP0 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep5_tp0_pp1 -> layer_6_expert_ar_sp0_ep5_pp1
	layer_6_expert_out_sp0_ep5_tp1_pp1 -> layer_6_expert_ar_sp0_ep5_pp1
	layer_6_expert_out_sp0_ep5_tp2_pp1 -> layer_6_expert_ar_sp0_ep5_pp1
	layer_6_expert_out_sp0_ep5_tp3_pp1 -> layer_6_expert_ar_sp0_ep5_pp1
	layer_6_combine_sp0_ep5_pp1 [label="Token Combine L6 SP0 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep5_pp1 -> layer_6_combine_sp0_ep5_pp1
	layer_6_dispatch_sp0_ep6_pp1 [label="Token Dispatch L6 SP0 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep6_pp1 [style=dashed]
	layer_6_expert_sp0_ep6_tp0_pp1 [label="Expert L6 SP0 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep6_pp1 -> layer_6_expert_sp0_ep6_tp0_pp1
	layer_6_expert_out_sp0_ep6_tp0_pp1 [label="Expert Out L6 SP0 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep6_tp0_pp1 -> layer_6_expert_out_sp0_ep6_tp0_pp1
	layer_6_expert_sp0_ep6_tp1_pp1 [label="Expert L6 SP0 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep6_pp1 -> layer_6_expert_sp0_ep6_tp1_pp1
	layer_6_expert_out_sp0_ep6_tp1_pp1 [label="Expert Out L6 SP0 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep6_tp1_pp1 -> layer_6_expert_out_sp0_ep6_tp1_pp1
	layer_6_expert_sp0_ep6_tp2_pp1 [label="Expert L6 SP0 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep6_pp1 -> layer_6_expert_sp0_ep6_tp2_pp1
	layer_6_expert_out_sp0_ep6_tp2_pp1 [label="Expert Out L6 SP0 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep6_tp2_pp1 -> layer_6_expert_out_sp0_ep6_tp2_pp1
	layer_6_expert_sp0_ep6_tp3_pp1 [label="Expert L6 SP0 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep6_pp1 -> layer_6_expert_sp0_ep6_tp3_pp1
	layer_6_expert_out_sp0_ep6_tp3_pp1 [label="Expert Out L6 SP0 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep6_tp3_pp1 -> layer_6_expert_out_sp0_ep6_tp3_pp1
	layer_6_expert_ar_sp0_ep6_pp1 [label="Expert All-Reduce L6 SP0 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep6_tp0_pp1 -> layer_6_expert_ar_sp0_ep6_pp1
	layer_6_expert_out_sp0_ep6_tp1_pp1 -> layer_6_expert_ar_sp0_ep6_pp1
	layer_6_expert_out_sp0_ep6_tp2_pp1 -> layer_6_expert_ar_sp0_ep6_pp1
	layer_6_expert_out_sp0_ep6_tp3_pp1 -> layer_6_expert_ar_sp0_ep6_pp1
	layer_6_combine_sp0_ep6_pp1 [label="Token Combine L6 SP0 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep6_pp1 -> layer_6_combine_sp0_ep6_pp1
	layer_6_dispatch_sp0_ep7_pp1 [label="Token Dispatch L6 SP0 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep7_pp1 [style=dashed]
	layer_6_expert_sp0_ep7_tp0_pp1 [label="Expert L6 SP0 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep7_pp1 -> layer_6_expert_sp0_ep7_tp0_pp1
	layer_6_expert_out_sp0_ep7_tp0_pp1 [label="Expert Out L6 SP0 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep7_tp0_pp1 -> layer_6_expert_out_sp0_ep7_tp0_pp1
	layer_6_expert_sp0_ep7_tp1_pp1 [label="Expert L6 SP0 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep7_pp1 -> layer_6_expert_sp0_ep7_tp1_pp1
	layer_6_expert_out_sp0_ep7_tp1_pp1 [label="Expert Out L6 SP0 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep7_tp1_pp1 -> layer_6_expert_out_sp0_ep7_tp1_pp1
	layer_6_expert_sp0_ep7_tp2_pp1 [label="Expert L6 SP0 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep7_pp1 -> layer_6_expert_sp0_ep7_tp2_pp1
	layer_6_expert_out_sp0_ep7_tp2_pp1 [label="Expert Out L6 SP0 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep7_tp2_pp1 -> layer_6_expert_out_sp0_ep7_tp2_pp1
	layer_6_expert_sp0_ep7_tp3_pp1 [label="Expert L6 SP0 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep7_pp1 -> layer_6_expert_sp0_ep7_tp3_pp1
	layer_6_expert_out_sp0_ep7_tp3_pp1 [label="Expert Out L6 SP0 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep7_tp3_pp1 -> layer_6_expert_out_sp0_ep7_tp3_pp1
	layer_6_expert_ar_sp0_ep7_pp1 [label="Expert All-Reduce L6 SP0 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep7_tp0_pp1 -> layer_6_expert_ar_sp0_ep7_pp1
	layer_6_expert_out_sp0_ep7_tp1_pp1 -> layer_6_expert_ar_sp0_ep7_pp1
	layer_6_expert_out_sp0_ep7_tp2_pp1 -> layer_6_expert_ar_sp0_ep7_pp1
	layer_6_expert_out_sp0_ep7_tp3_pp1 -> layer_6_expert_ar_sp0_ep7_pp1
	layer_6_combine_sp0_ep7_pp1 [label="Token Combine L6 SP0 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep7_pp1 -> layer_6_combine_sp0_ep7_pp1
	layer_6_dispatch_sp0_ep8_pp1 [label="Token Dispatch L6 SP0 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep8_pp1 [style=dashed]
	layer_6_expert_sp0_ep8_tp0_pp1 [label="Expert L6 SP0 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep8_pp1 -> layer_6_expert_sp0_ep8_tp0_pp1
	layer_6_expert_out_sp0_ep8_tp0_pp1 [label="Expert Out L6 SP0 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep8_tp0_pp1 -> layer_6_expert_out_sp0_ep8_tp0_pp1
	layer_6_expert_sp0_ep8_tp1_pp1 [label="Expert L6 SP0 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep8_pp1 -> layer_6_expert_sp0_ep8_tp1_pp1
	layer_6_expert_out_sp0_ep8_tp1_pp1 [label="Expert Out L6 SP0 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep8_tp1_pp1 -> layer_6_expert_out_sp0_ep8_tp1_pp1
	layer_6_expert_sp0_ep8_tp2_pp1 [label="Expert L6 SP0 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep8_pp1 -> layer_6_expert_sp0_ep8_tp2_pp1
	layer_6_expert_out_sp0_ep8_tp2_pp1 [label="Expert Out L6 SP0 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep8_tp2_pp1 -> layer_6_expert_out_sp0_ep8_tp2_pp1
	layer_6_expert_sp0_ep8_tp3_pp1 [label="Expert L6 SP0 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep8_pp1 -> layer_6_expert_sp0_ep8_tp3_pp1
	layer_6_expert_out_sp0_ep8_tp3_pp1 [label="Expert Out L6 SP0 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep8_tp3_pp1 -> layer_6_expert_out_sp0_ep8_tp3_pp1
	layer_6_expert_ar_sp0_ep8_pp1 [label="Expert All-Reduce L6 SP0 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep8_tp0_pp1 -> layer_6_expert_ar_sp0_ep8_pp1
	layer_6_expert_out_sp0_ep8_tp1_pp1 -> layer_6_expert_ar_sp0_ep8_pp1
	layer_6_expert_out_sp0_ep8_tp2_pp1 -> layer_6_expert_ar_sp0_ep8_pp1
	layer_6_expert_out_sp0_ep8_tp3_pp1 -> layer_6_expert_ar_sp0_ep8_pp1
	layer_6_combine_sp0_ep8_pp1 [label="Token Combine L6 SP0 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep8_pp1 -> layer_6_combine_sp0_ep8_pp1
	layer_6_dispatch_sp0_ep9_pp1 [label="Token Dispatch L6 SP0 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep9_pp1 [style=dashed]
	layer_6_expert_sp0_ep9_tp0_pp1 [label="Expert L6 SP0 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep9_pp1 -> layer_6_expert_sp0_ep9_tp0_pp1
	layer_6_expert_out_sp0_ep9_tp0_pp1 [label="Expert Out L6 SP0 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep9_tp0_pp1 -> layer_6_expert_out_sp0_ep9_tp0_pp1
	layer_6_expert_sp0_ep9_tp1_pp1 [label="Expert L6 SP0 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep9_pp1 -> layer_6_expert_sp0_ep9_tp1_pp1
	layer_6_expert_out_sp0_ep9_tp1_pp1 [label="Expert Out L6 SP0 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep9_tp1_pp1 -> layer_6_expert_out_sp0_ep9_tp1_pp1
	layer_6_expert_sp0_ep9_tp2_pp1 [label="Expert L6 SP0 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep9_pp1 -> layer_6_expert_sp0_ep9_tp2_pp1
	layer_6_expert_out_sp0_ep9_tp2_pp1 [label="Expert Out L6 SP0 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep9_tp2_pp1 -> layer_6_expert_out_sp0_ep9_tp2_pp1
	layer_6_expert_sp0_ep9_tp3_pp1 [label="Expert L6 SP0 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep9_pp1 -> layer_6_expert_sp0_ep9_tp3_pp1
	layer_6_expert_out_sp0_ep9_tp3_pp1 [label="Expert Out L6 SP0 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep9_tp3_pp1 -> layer_6_expert_out_sp0_ep9_tp3_pp1
	layer_6_expert_ar_sp0_ep9_pp1 [label="Expert All-Reduce L6 SP0 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep9_tp0_pp1 -> layer_6_expert_ar_sp0_ep9_pp1
	layer_6_expert_out_sp0_ep9_tp1_pp1 -> layer_6_expert_ar_sp0_ep9_pp1
	layer_6_expert_out_sp0_ep9_tp2_pp1 -> layer_6_expert_ar_sp0_ep9_pp1
	layer_6_expert_out_sp0_ep9_tp3_pp1 -> layer_6_expert_ar_sp0_ep9_pp1
	layer_6_combine_sp0_ep9_pp1 [label="Token Combine L6 SP0 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep9_pp1 -> layer_6_combine_sp0_ep9_pp1
	layer_6_dispatch_sp0_ep10_pp1 [label="Token Dispatch L6 SP0 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep10_pp1 [style=dashed]
	layer_6_expert_sp0_ep10_tp0_pp1 [label="Expert L6 SP0 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep10_pp1 -> layer_6_expert_sp0_ep10_tp0_pp1
	layer_6_expert_out_sp0_ep10_tp0_pp1 [label="Expert Out L6 SP0 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep10_tp0_pp1 -> layer_6_expert_out_sp0_ep10_tp0_pp1
	layer_6_expert_sp0_ep10_tp1_pp1 [label="Expert L6 SP0 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep10_pp1 -> layer_6_expert_sp0_ep10_tp1_pp1
	layer_6_expert_out_sp0_ep10_tp1_pp1 [label="Expert Out L6 SP0 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep10_tp1_pp1 -> layer_6_expert_out_sp0_ep10_tp1_pp1
	layer_6_expert_sp0_ep10_tp2_pp1 [label="Expert L6 SP0 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep10_pp1 -> layer_6_expert_sp0_ep10_tp2_pp1
	layer_6_expert_out_sp0_ep10_tp2_pp1 [label="Expert Out L6 SP0 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep10_tp2_pp1 -> layer_6_expert_out_sp0_ep10_tp2_pp1
	layer_6_expert_sp0_ep10_tp3_pp1 [label="Expert L6 SP0 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep10_pp1 -> layer_6_expert_sp0_ep10_tp3_pp1
	layer_6_expert_out_sp0_ep10_tp3_pp1 [label="Expert Out L6 SP0 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep10_tp3_pp1 -> layer_6_expert_out_sp0_ep10_tp3_pp1
	layer_6_expert_ar_sp0_ep10_pp1 [label="Expert All-Reduce L6 SP0 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep10_tp0_pp1 -> layer_6_expert_ar_sp0_ep10_pp1
	layer_6_expert_out_sp0_ep10_tp1_pp1 -> layer_6_expert_ar_sp0_ep10_pp1
	layer_6_expert_out_sp0_ep10_tp2_pp1 -> layer_6_expert_ar_sp0_ep10_pp1
	layer_6_expert_out_sp0_ep10_tp3_pp1 -> layer_6_expert_ar_sp0_ep10_pp1
	layer_6_combine_sp0_ep10_pp1 [label="Token Combine L6 SP0 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep10_pp1 -> layer_6_combine_sp0_ep10_pp1
	layer_6_dispatch_sp0_ep11_pp1 [label="Token Dispatch L6 SP0 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep11_pp1 [style=dashed]
	layer_6_expert_sp0_ep11_tp0_pp1 [label="Expert L6 SP0 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep11_pp1 -> layer_6_expert_sp0_ep11_tp0_pp1
	layer_6_expert_out_sp0_ep11_tp0_pp1 [label="Expert Out L6 SP0 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep11_tp0_pp1 -> layer_6_expert_out_sp0_ep11_tp0_pp1
	layer_6_expert_sp0_ep11_tp1_pp1 [label="Expert L6 SP0 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep11_pp1 -> layer_6_expert_sp0_ep11_tp1_pp1
	layer_6_expert_out_sp0_ep11_tp1_pp1 [label="Expert Out L6 SP0 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep11_tp1_pp1 -> layer_6_expert_out_sp0_ep11_tp1_pp1
	layer_6_expert_sp0_ep11_tp2_pp1 [label="Expert L6 SP0 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep11_pp1 -> layer_6_expert_sp0_ep11_tp2_pp1
	layer_6_expert_out_sp0_ep11_tp2_pp1 [label="Expert Out L6 SP0 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep11_tp2_pp1 -> layer_6_expert_out_sp0_ep11_tp2_pp1
	layer_6_expert_sp0_ep11_tp3_pp1 [label="Expert L6 SP0 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep11_pp1 -> layer_6_expert_sp0_ep11_tp3_pp1
	layer_6_expert_out_sp0_ep11_tp3_pp1 [label="Expert Out L6 SP0 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep11_tp3_pp1 -> layer_6_expert_out_sp0_ep11_tp3_pp1
	layer_6_expert_ar_sp0_ep11_pp1 [label="Expert All-Reduce L6 SP0 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep11_tp0_pp1 -> layer_6_expert_ar_sp0_ep11_pp1
	layer_6_expert_out_sp0_ep11_tp1_pp1 -> layer_6_expert_ar_sp0_ep11_pp1
	layer_6_expert_out_sp0_ep11_tp2_pp1 -> layer_6_expert_ar_sp0_ep11_pp1
	layer_6_expert_out_sp0_ep11_tp3_pp1 -> layer_6_expert_ar_sp0_ep11_pp1
	layer_6_combine_sp0_ep11_pp1 [label="Token Combine L6 SP0 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep11_pp1 -> layer_6_combine_sp0_ep11_pp1
	layer_6_dispatch_sp0_ep12_pp1 [label="Token Dispatch L6 SP0 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep12_pp1 [style=dashed]
	layer_6_expert_sp0_ep12_tp0_pp1 [label="Expert L6 SP0 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep12_pp1 -> layer_6_expert_sp0_ep12_tp0_pp1
	layer_6_expert_out_sp0_ep12_tp0_pp1 [label="Expert Out L6 SP0 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep12_tp0_pp1 -> layer_6_expert_out_sp0_ep12_tp0_pp1
	layer_6_expert_sp0_ep12_tp1_pp1 [label="Expert L6 SP0 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep12_pp1 -> layer_6_expert_sp0_ep12_tp1_pp1
	layer_6_expert_out_sp0_ep12_tp1_pp1 [label="Expert Out L6 SP0 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep12_tp1_pp1 -> layer_6_expert_out_sp0_ep12_tp1_pp1
	layer_6_expert_sp0_ep12_tp2_pp1 [label="Expert L6 SP0 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep12_pp1 -> layer_6_expert_sp0_ep12_tp2_pp1
	layer_6_expert_out_sp0_ep12_tp2_pp1 [label="Expert Out L6 SP0 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep12_tp2_pp1 -> layer_6_expert_out_sp0_ep12_tp2_pp1
	layer_6_expert_sp0_ep12_tp3_pp1 [label="Expert L6 SP0 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep12_pp1 -> layer_6_expert_sp0_ep12_tp3_pp1
	layer_6_expert_out_sp0_ep12_tp3_pp1 [label="Expert Out L6 SP0 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep12_tp3_pp1 -> layer_6_expert_out_sp0_ep12_tp3_pp1
	layer_6_expert_ar_sp0_ep12_pp1 [label="Expert All-Reduce L6 SP0 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep12_tp0_pp1 -> layer_6_expert_ar_sp0_ep12_pp1
	layer_6_expert_out_sp0_ep12_tp1_pp1 -> layer_6_expert_ar_sp0_ep12_pp1
	layer_6_expert_out_sp0_ep12_tp2_pp1 -> layer_6_expert_ar_sp0_ep12_pp1
	layer_6_expert_out_sp0_ep12_tp3_pp1 -> layer_6_expert_ar_sp0_ep12_pp1
	layer_6_combine_sp0_ep12_pp1 [label="Token Combine L6 SP0 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep12_pp1 -> layer_6_combine_sp0_ep12_pp1
	layer_6_dispatch_sp0_ep13_pp1 [label="Token Dispatch L6 SP0 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep13_pp1 [style=dashed]
	layer_6_expert_sp0_ep13_tp0_pp1 [label="Expert L6 SP0 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep13_pp1 -> layer_6_expert_sp0_ep13_tp0_pp1
	layer_6_expert_out_sp0_ep13_tp0_pp1 [label="Expert Out L6 SP0 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep13_tp0_pp1 -> layer_6_expert_out_sp0_ep13_tp0_pp1
	layer_6_expert_sp0_ep13_tp1_pp1 [label="Expert L6 SP0 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep13_pp1 -> layer_6_expert_sp0_ep13_tp1_pp1
	layer_6_expert_out_sp0_ep13_tp1_pp1 [label="Expert Out L6 SP0 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep13_tp1_pp1 -> layer_6_expert_out_sp0_ep13_tp1_pp1
	layer_6_expert_sp0_ep13_tp2_pp1 [label="Expert L6 SP0 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep13_pp1 -> layer_6_expert_sp0_ep13_tp2_pp1
	layer_6_expert_out_sp0_ep13_tp2_pp1 [label="Expert Out L6 SP0 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep13_tp2_pp1 -> layer_6_expert_out_sp0_ep13_tp2_pp1
	layer_6_expert_sp0_ep13_tp3_pp1 [label="Expert L6 SP0 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep13_pp1 -> layer_6_expert_sp0_ep13_tp3_pp1
	layer_6_expert_out_sp0_ep13_tp3_pp1 [label="Expert Out L6 SP0 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep13_tp3_pp1 -> layer_6_expert_out_sp0_ep13_tp3_pp1
	layer_6_expert_ar_sp0_ep13_pp1 [label="Expert All-Reduce L6 SP0 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep13_tp0_pp1 -> layer_6_expert_ar_sp0_ep13_pp1
	layer_6_expert_out_sp0_ep13_tp1_pp1 -> layer_6_expert_ar_sp0_ep13_pp1
	layer_6_expert_out_sp0_ep13_tp2_pp1 -> layer_6_expert_ar_sp0_ep13_pp1
	layer_6_expert_out_sp0_ep13_tp3_pp1 -> layer_6_expert_ar_sp0_ep13_pp1
	layer_6_combine_sp0_ep13_pp1 [label="Token Combine L6 SP0 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep13_pp1 -> layer_6_combine_sp0_ep13_pp1
	layer_6_dispatch_sp0_ep14_pp1 [label="Token Dispatch L6 SP0 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep14_pp1 [style=dashed]
	layer_6_expert_sp0_ep14_tp0_pp1 [label="Expert L6 SP0 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep14_pp1 -> layer_6_expert_sp0_ep14_tp0_pp1
	layer_6_expert_out_sp0_ep14_tp0_pp1 [label="Expert Out L6 SP0 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep14_tp0_pp1 -> layer_6_expert_out_sp0_ep14_tp0_pp1
	layer_6_expert_sp0_ep14_tp1_pp1 [label="Expert L6 SP0 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep14_pp1 -> layer_6_expert_sp0_ep14_tp1_pp1
	layer_6_expert_out_sp0_ep14_tp1_pp1 [label="Expert Out L6 SP0 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep14_tp1_pp1 -> layer_6_expert_out_sp0_ep14_tp1_pp1
	layer_6_expert_sp0_ep14_tp2_pp1 [label="Expert L6 SP0 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep14_pp1 -> layer_6_expert_sp0_ep14_tp2_pp1
	layer_6_expert_out_sp0_ep14_tp2_pp1 [label="Expert Out L6 SP0 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep14_tp2_pp1 -> layer_6_expert_out_sp0_ep14_tp2_pp1
	layer_6_expert_sp0_ep14_tp3_pp1 [label="Expert L6 SP0 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep14_pp1 -> layer_6_expert_sp0_ep14_tp3_pp1
	layer_6_expert_out_sp0_ep14_tp3_pp1 [label="Expert Out L6 SP0 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep14_tp3_pp1 -> layer_6_expert_out_sp0_ep14_tp3_pp1
	layer_6_expert_ar_sp0_ep14_pp1 [label="Expert All-Reduce L6 SP0 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep14_tp0_pp1 -> layer_6_expert_ar_sp0_ep14_pp1
	layer_6_expert_out_sp0_ep14_tp1_pp1 -> layer_6_expert_ar_sp0_ep14_pp1
	layer_6_expert_out_sp0_ep14_tp2_pp1 -> layer_6_expert_ar_sp0_ep14_pp1
	layer_6_expert_out_sp0_ep14_tp3_pp1 -> layer_6_expert_ar_sp0_ep14_pp1
	layer_6_combine_sp0_ep14_pp1 [label="Token Combine L6 SP0 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep14_pp1 -> layer_6_combine_sp0_ep14_pp1
	layer_6_dispatch_sp0_ep15_pp1 [label="Token Dispatch L6 SP0 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp0_pp1 -> layer_6_dispatch_sp0_ep15_pp1 [style=dashed]
	layer_6_expert_sp0_ep15_tp0_pp1 [label="Expert L6 SP0 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep15_pp1 -> layer_6_expert_sp0_ep15_tp0_pp1
	layer_6_expert_out_sp0_ep15_tp0_pp1 [label="Expert Out L6 SP0 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep15_tp0_pp1 -> layer_6_expert_out_sp0_ep15_tp0_pp1
	layer_6_expert_sp0_ep15_tp1_pp1 [label="Expert L6 SP0 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep15_pp1 -> layer_6_expert_sp0_ep15_tp1_pp1
	layer_6_expert_out_sp0_ep15_tp1_pp1 [label="Expert Out L6 SP0 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep15_tp1_pp1 -> layer_6_expert_out_sp0_ep15_tp1_pp1
	layer_6_expert_sp0_ep15_tp2_pp1 [label="Expert L6 SP0 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep15_pp1 -> layer_6_expert_sp0_ep15_tp2_pp1
	layer_6_expert_out_sp0_ep15_tp2_pp1 [label="Expert Out L6 SP0 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep15_tp2_pp1 -> layer_6_expert_out_sp0_ep15_tp2_pp1
	layer_6_expert_sp0_ep15_tp3_pp1 [label="Expert L6 SP0 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp0_ep15_pp1 -> layer_6_expert_sp0_ep15_tp3_pp1
	layer_6_expert_out_sp0_ep15_tp3_pp1 [label="Expert Out L6 SP0 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp0_ep15_tp3_pp1 -> layer_6_expert_out_sp0_ep15_tp3_pp1
	layer_6_expert_ar_sp0_ep15_pp1 [label="Expert All-Reduce L6 SP0 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp0_ep15_tp0_pp1 -> layer_6_expert_ar_sp0_ep15_pp1
	layer_6_expert_out_sp0_ep15_tp1_pp1 -> layer_6_expert_ar_sp0_ep15_pp1
	layer_6_expert_out_sp0_ep15_tp2_pp1 -> layer_6_expert_ar_sp0_ep15_pp1
	layer_6_expert_out_sp0_ep15_tp3_pp1 -> layer_6_expert_ar_sp0_ep15_pp1
	layer_6_combine_sp0_ep15_pp1 [label="Token Combine L6 SP0 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp0_ep15_pp1 -> layer_6_combine_sp0_ep15_pp1
	layer_6_moe_all2all_sp0_pp1 [label="MoE All-to-All L6 SP0\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_6_combine_sp0_ep0_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep1_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep2_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep3_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep4_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep5_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep6_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep7_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep8_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep9_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep10_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep11_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep12_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep13_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep14_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_combine_sp0_ep15_pp1 -> layer_6_moe_all2all_sp0_pp1
	layer_6_mlp_out_sp0_pp1 [label="MoE Output L6 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_moe_all2all_sp0_pp1 -> layer_6_mlp_out_sp0_pp1
	layer_6_mlp_res_sp0_pp1 [label="MLP Residual L6 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_mlp_out_sp0_pp1 -> layer_6_mlp_res_sp0_pp1
	layer_6_attn_res_sp0_pp1 -> layer_6_mlp_res_sp0_pp1 [style=dashed]
	layer_6_norm_sp1_pp1 [label="LayerNorm L6 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_mlp_out_sp1_pp1 -> layer_6_norm_sp1_pp1
	layer_6_qkv_sp1_tp0_pp1 [label="QKV Proj L6 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp1_pp1 -> layer_6_qkv_sp1_tp0_pp1
	layer_6_attn_sp1_tp0_pp1 [label="Attention L6 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp1_tp0_pp1 -> layer_6_attn_sp1_tp0_pp1
	layer_6_attn_out_sp1_tp0_pp1 [label="Attn Out Proj L6 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp1_tp0_pp1 -> layer_6_attn_out_sp1_tp0_pp1
	layer_6_qkv_sp1_tp1_pp1 [label="QKV Proj L6 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp1_pp1 -> layer_6_qkv_sp1_tp1_pp1
	layer_6_attn_sp1_tp1_pp1 [label="Attention L6 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp1_tp1_pp1 -> layer_6_attn_sp1_tp1_pp1
	layer_6_attn_out_sp1_tp1_pp1 [label="Attn Out Proj L6 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp1_tp1_pp1 -> layer_6_attn_out_sp1_tp1_pp1
	layer_6_qkv_sp1_tp2_pp1 [label="QKV Proj L6 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp1_pp1 -> layer_6_qkv_sp1_tp2_pp1
	layer_6_attn_sp1_tp2_pp1 [label="Attention L6 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp1_tp2_pp1 -> layer_6_attn_sp1_tp2_pp1
	layer_6_attn_out_sp1_tp2_pp1 [label="Attn Out Proj L6 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp1_tp2_pp1 -> layer_6_attn_out_sp1_tp2_pp1
	layer_6_qkv_sp1_tp3_pp1 [label="QKV Proj L6 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp1_pp1 -> layer_6_qkv_sp1_tp3_pp1
	layer_6_attn_sp1_tp3_pp1 [label="Attention L6 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp1_tp3_pp1 -> layer_6_attn_sp1_tp3_pp1
	layer_6_attn_out_sp1_tp3_pp1 [label="Attn Out Proj L6 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp1_tp3_pp1 -> layer_6_attn_out_sp1_tp3_pp1
	layer_6_attn_ar_sp1_pp1 [label="Attention All-Reduce L6 SP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_attn_out_sp1_tp0_pp1 -> layer_6_attn_ar_sp1_pp1
	layer_6_attn_out_sp1_tp1_pp1 -> layer_6_attn_ar_sp1_pp1
	layer_6_attn_out_sp1_tp2_pp1 -> layer_6_attn_ar_sp1_pp1
	layer_6_attn_out_sp1_tp3_pp1 -> layer_6_attn_ar_sp1_pp1
	layer_6_attn_res_sp1_pp1 [label="Attention Residual L6 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_attn_ar_sp1_pp1 -> layer_6_attn_res_sp1_pp1
	layer_6_norm_sp1_pp1 -> layer_6_attn_res_sp1_pp1 [style=dashed]
	layer_6_post_norm_sp1_pp1 [label="Post-Attn Norm L6 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_attn_res_sp1_pp1 -> layer_6_post_norm_sp1_pp1
	layer_6_router_sp1_pp1 [label="MoE Router L6 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_6_post_norm_sp1_pp1 -> layer_6_router_sp1_pp1
	layer_6_dispatch_sp1_ep0_pp1 [label="Token Dispatch L6 SP1 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep0_pp1 [style=dashed]
	layer_6_expert_sp1_ep0_tp0_pp1 [label="Expert L6 SP1 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep0_pp1 -> layer_6_expert_sp1_ep0_tp0_pp1
	layer_6_expert_out_sp1_ep0_tp0_pp1 [label="Expert Out L6 SP1 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep0_tp0_pp1 -> layer_6_expert_out_sp1_ep0_tp0_pp1
	layer_6_expert_sp1_ep0_tp1_pp1 [label="Expert L6 SP1 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep0_pp1 -> layer_6_expert_sp1_ep0_tp1_pp1
	layer_6_expert_out_sp1_ep0_tp1_pp1 [label="Expert Out L6 SP1 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep0_tp1_pp1 -> layer_6_expert_out_sp1_ep0_tp1_pp1
	layer_6_expert_sp1_ep0_tp2_pp1 [label="Expert L6 SP1 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep0_pp1 -> layer_6_expert_sp1_ep0_tp2_pp1
	layer_6_expert_out_sp1_ep0_tp2_pp1 [label="Expert Out L6 SP1 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep0_tp2_pp1 -> layer_6_expert_out_sp1_ep0_tp2_pp1
	layer_6_expert_sp1_ep0_tp3_pp1 [label="Expert L6 SP1 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep0_pp1 -> layer_6_expert_sp1_ep0_tp3_pp1
	layer_6_expert_out_sp1_ep0_tp3_pp1 [label="Expert Out L6 SP1 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep0_tp3_pp1 -> layer_6_expert_out_sp1_ep0_tp3_pp1
	layer_6_expert_ar_sp1_ep0_pp1 [label="Expert All-Reduce L6 SP1 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep0_tp0_pp1 -> layer_6_expert_ar_sp1_ep0_pp1
	layer_6_expert_out_sp1_ep0_tp1_pp1 -> layer_6_expert_ar_sp1_ep0_pp1
	layer_6_expert_out_sp1_ep0_tp2_pp1 -> layer_6_expert_ar_sp1_ep0_pp1
	layer_6_expert_out_sp1_ep0_tp3_pp1 -> layer_6_expert_ar_sp1_ep0_pp1
	layer_6_combine_sp1_ep0_pp1 [label="Token Combine L6 SP1 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep0_pp1 -> layer_6_combine_sp1_ep0_pp1
	layer_6_dispatch_sp1_ep1_pp1 [label="Token Dispatch L6 SP1 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep1_pp1 [style=dashed]
	layer_6_expert_sp1_ep1_tp0_pp1 [label="Expert L6 SP1 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep1_pp1 -> layer_6_expert_sp1_ep1_tp0_pp1
	layer_6_expert_out_sp1_ep1_tp0_pp1 [label="Expert Out L6 SP1 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep1_tp0_pp1 -> layer_6_expert_out_sp1_ep1_tp0_pp1
	layer_6_expert_sp1_ep1_tp1_pp1 [label="Expert L6 SP1 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep1_pp1 -> layer_6_expert_sp1_ep1_tp1_pp1
	layer_6_expert_out_sp1_ep1_tp1_pp1 [label="Expert Out L6 SP1 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep1_tp1_pp1 -> layer_6_expert_out_sp1_ep1_tp1_pp1
	layer_6_expert_sp1_ep1_tp2_pp1 [label="Expert L6 SP1 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep1_pp1 -> layer_6_expert_sp1_ep1_tp2_pp1
	layer_6_expert_out_sp1_ep1_tp2_pp1 [label="Expert Out L6 SP1 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep1_tp2_pp1 -> layer_6_expert_out_sp1_ep1_tp2_pp1
	layer_6_expert_sp1_ep1_tp3_pp1 [label="Expert L6 SP1 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep1_pp1 -> layer_6_expert_sp1_ep1_tp3_pp1
	layer_6_expert_out_sp1_ep1_tp3_pp1 [label="Expert Out L6 SP1 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep1_tp3_pp1 -> layer_6_expert_out_sp1_ep1_tp3_pp1
	layer_6_expert_ar_sp1_ep1_pp1 [label="Expert All-Reduce L6 SP1 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep1_tp0_pp1 -> layer_6_expert_ar_sp1_ep1_pp1
	layer_6_expert_out_sp1_ep1_tp1_pp1 -> layer_6_expert_ar_sp1_ep1_pp1
	layer_6_expert_out_sp1_ep1_tp2_pp1 -> layer_6_expert_ar_sp1_ep1_pp1
	layer_6_expert_out_sp1_ep1_tp3_pp1 -> layer_6_expert_ar_sp1_ep1_pp1
	layer_6_combine_sp1_ep1_pp1 [label="Token Combine L6 SP1 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep1_pp1 -> layer_6_combine_sp1_ep1_pp1
	layer_6_dispatch_sp1_ep2_pp1 [label="Token Dispatch L6 SP1 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep2_pp1 [style=dashed]
	layer_6_expert_sp1_ep2_tp0_pp1 [label="Expert L6 SP1 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep2_pp1 -> layer_6_expert_sp1_ep2_tp0_pp1
	layer_6_expert_out_sp1_ep2_tp0_pp1 [label="Expert Out L6 SP1 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep2_tp0_pp1 -> layer_6_expert_out_sp1_ep2_tp0_pp1
	layer_6_expert_sp1_ep2_tp1_pp1 [label="Expert L6 SP1 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep2_pp1 -> layer_6_expert_sp1_ep2_tp1_pp1
	layer_6_expert_out_sp1_ep2_tp1_pp1 [label="Expert Out L6 SP1 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep2_tp1_pp1 -> layer_6_expert_out_sp1_ep2_tp1_pp1
	layer_6_expert_sp1_ep2_tp2_pp1 [label="Expert L6 SP1 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep2_pp1 -> layer_6_expert_sp1_ep2_tp2_pp1
	layer_6_expert_out_sp1_ep2_tp2_pp1 [label="Expert Out L6 SP1 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep2_tp2_pp1 -> layer_6_expert_out_sp1_ep2_tp2_pp1
	layer_6_expert_sp1_ep2_tp3_pp1 [label="Expert L6 SP1 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep2_pp1 -> layer_6_expert_sp1_ep2_tp3_pp1
	layer_6_expert_out_sp1_ep2_tp3_pp1 [label="Expert Out L6 SP1 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep2_tp3_pp1 -> layer_6_expert_out_sp1_ep2_tp3_pp1
	layer_6_expert_ar_sp1_ep2_pp1 [label="Expert All-Reduce L6 SP1 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep2_tp0_pp1 -> layer_6_expert_ar_sp1_ep2_pp1
	layer_6_expert_out_sp1_ep2_tp1_pp1 -> layer_6_expert_ar_sp1_ep2_pp1
	layer_6_expert_out_sp1_ep2_tp2_pp1 -> layer_6_expert_ar_sp1_ep2_pp1
	layer_6_expert_out_sp1_ep2_tp3_pp1 -> layer_6_expert_ar_sp1_ep2_pp1
	layer_6_combine_sp1_ep2_pp1 [label="Token Combine L6 SP1 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep2_pp1 -> layer_6_combine_sp1_ep2_pp1
	layer_6_dispatch_sp1_ep3_pp1 [label="Token Dispatch L6 SP1 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep3_pp1 [style=dashed]
	layer_6_expert_sp1_ep3_tp0_pp1 [label="Expert L6 SP1 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep3_pp1 -> layer_6_expert_sp1_ep3_tp0_pp1
	layer_6_expert_out_sp1_ep3_tp0_pp1 [label="Expert Out L6 SP1 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep3_tp0_pp1 -> layer_6_expert_out_sp1_ep3_tp0_pp1
	layer_6_expert_sp1_ep3_tp1_pp1 [label="Expert L6 SP1 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep3_pp1 -> layer_6_expert_sp1_ep3_tp1_pp1
	layer_6_expert_out_sp1_ep3_tp1_pp1 [label="Expert Out L6 SP1 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep3_tp1_pp1 -> layer_6_expert_out_sp1_ep3_tp1_pp1
	layer_6_expert_sp1_ep3_tp2_pp1 [label="Expert L6 SP1 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep3_pp1 -> layer_6_expert_sp1_ep3_tp2_pp1
	layer_6_expert_out_sp1_ep3_tp2_pp1 [label="Expert Out L6 SP1 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep3_tp2_pp1 -> layer_6_expert_out_sp1_ep3_tp2_pp1
	layer_6_expert_sp1_ep3_tp3_pp1 [label="Expert L6 SP1 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep3_pp1 -> layer_6_expert_sp1_ep3_tp3_pp1
	layer_6_expert_out_sp1_ep3_tp3_pp1 [label="Expert Out L6 SP1 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep3_tp3_pp1 -> layer_6_expert_out_sp1_ep3_tp3_pp1
	layer_6_expert_ar_sp1_ep3_pp1 [label="Expert All-Reduce L6 SP1 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep3_tp0_pp1 -> layer_6_expert_ar_sp1_ep3_pp1
	layer_6_expert_out_sp1_ep3_tp1_pp1 -> layer_6_expert_ar_sp1_ep3_pp1
	layer_6_expert_out_sp1_ep3_tp2_pp1 -> layer_6_expert_ar_sp1_ep3_pp1
	layer_6_expert_out_sp1_ep3_tp3_pp1 -> layer_6_expert_ar_sp1_ep3_pp1
	layer_6_combine_sp1_ep3_pp1 [label="Token Combine L6 SP1 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep3_pp1 -> layer_6_combine_sp1_ep3_pp1
	layer_6_dispatch_sp1_ep4_pp1 [label="Token Dispatch L6 SP1 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep4_pp1 [style=dashed]
	layer_6_expert_sp1_ep4_tp0_pp1 [label="Expert L6 SP1 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep4_pp1 -> layer_6_expert_sp1_ep4_tp0_pp1
	layer_6_expert_out_sp1_ep4_tp0_pp1 [label="Expert Out L6 SP1 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep4_tp0_pp1 -> layer_6_expert_out_sp1_ep4_tp0_pp1
	layer_6_expert_sp1_ep4_tp1_pp1 [label="Expert L6 SP1 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep4_pp1 -> layer_6_expert_sp1_ep4_tp1_pp1
	layer_6_expert_out_sp1_ep4_tp1_pp1 [label="Expert Out L6 SP1 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep4_tp1_pp1 -> layer_6_expert_out_sp1_ep4_tp1_pp1
	layer_6_expert_sp1_ep4_tp2_pp1 [label="Expert L6 SP1 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep4_pp1 -> layer_6_expert_sp1_ep4_tp2_pp1
	layer_6_expert_out_sp1_ep4_tp2_pp1 [label="Expert Out L6 SP1 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep4_tp2_pp1 -> layer_6_expert_out_sp1_ep4_tp2_pp1
	layer_6_expert_sp1_ep4_tp3_pp1 [label="Expert L6 SP1 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep4_pp1 -> layer_6_expert_sp1_ep4_tp3_pp1
	layer_6_expert_out_sp1_ep4_tp3_pp1 [label="Expert Out L6 SP1 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep4_tp3_pp1 -> layer_6_expert_out_sp1_ep4_tp3_pp1
	layer_6_expert_ar_sp1_ep4_pp1 [label="Expert All-Reduce L6 SP1 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep4_tp0_pp1 -> layer_6_expert_ar_sp1_ep4_pp1
	layer_6_expert_out_sp1_ep4_tp1_pp1 -> layer_6_expert_ar_sp1_ep4_pp1
	layer_6_expert_out_sp1_ep4_tp2_pp1 -> layer_6_expert_ar_sp1_ep4_pp1
	layer_6_expert_out_sp1_ep4_tp3_pp1 -> layer_6_expert_ar_sp1_ep4_pp1
	layer_6_combine_sp1_ep4_pp1 [label="Token Combine L6 SP1 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep4_pp1 -> layer_6_combine_sp1_ep4_pp1
	layer_6_dispatch_sp1_ep5_pp1 [label="Token Dispatch L6 SP1 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep5_pp1 [style=dashed]
	layer_6_expert_sp1_ep5_tp0_pp1 [label="Expert L6 SP1 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep5_pp1 -> layer_6_expert_sp1_ep5_tp0_pp1
	layer_6_expert_out_sp1_ep5_tp0_pp1 [label="Expert Out L6 SP1 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep5_tp0_pp1 -> layer_6_expert_out_sp1_ep5_tp0_pp1
	layer_6_expert_sp1_ep5_tp1_pp1 [label="Expert L6 SP1 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep5_pp1 -> layer_6_expert_sp1_ep5_tp1_pp1
	layer_6_expert_out_sp1_ep5_tp1_pp1 [label="Expert Out L6 SP1 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep5_tp1_pp1 -> layer_6_expert_out_sp1_ep5_tp1_pp1
	layer_6_expert_sp1_ep5_tp2_pp1 [label="Expert L6 SP1 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep5_pp1 -> layer_6_expert_sp1_ep5_tp2_pp1
	layer_6_expert_out_sp1_ep5_tp2_pp1 [label="Expert Out L6 SP1 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep5_tp2_pp1 -> layer_6_expert_out_sp1_ep5_tp2_pp1
	layer_6_expert_sp1_ep5_tp3_pp1 [label="Expert L6 SP1 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep5_pp1 -> layer_6_expert_sp1_ep5_tp3_pp1
	layer_6_expert_out_sp1_ep5_tp3_pp1 [label="Expert Out L6 SP1 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep5_tp3_pp1 -> layer_6_expert_out_sp1_ep5_tp3_pp1
	layer_6_expert_ar_sp1_ep5_pp1 [label="Expert All-Reduce L6 SP1 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep5_tp0_pp1 -> layer_6_expert_ar_sp1_ep5_pp1
	layer_6_expert_out_sp1_ep5_tp1_pp1 -> layer_6_expert_ar_sp1_ep5_pp1
	layer_6_expert_out_sp1_ep5_tp2_pp1 -> layer_6_expert_ar_sp1_ep5_pp1
	layer_6_expert_out_sp1_ep5_tp3_pp1 -> layer_6_expert_ar_sp1_ep5_pp1
	layer_6_combine_sp1_ep5_pp1 [label="Token Combine L6 SP1 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep5_pp1 -> layer_6_combine_sp1_ep5_pp1
	layer_6_dispatch_sp1_ep6_pp1 [label="Token Dispatch L6 SP1 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep6_pp1 [style=dashed]
	layer_6_expert_sp1_ep6_tp0_pp1 [label="Expert L6 SP1 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep6_pp1 -> layer_6_expert_sp1_ep6_tp0_pp1
	layer_6_expert_out_sp1_ep6_tp0_pp1 [label="Expert Out L6 SP1 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep6_tp0_pp1 -> layer_6_expert_out_sp1_ep6_tp0_pp1
	layer_6_expert_sp1_ep6_tp1_pp1 [label="Expert L6 SP1 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep6_pp1 -> layer_6_expert_sp1_ep6_tp1_pp1
	layer_6_expert_out_sp1_ep6_tp1_pp1 [label="Expert Out L6 SP1 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep6_tp1_pp1 -> layer_6_expert_out_sp1_ep6_tp1_pp1
	layer_6_expert_sp1_ep6_tp2_pp1 [label="Expert L6 SP1 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep6_pp1 -> layer_6_expert_sp1_ep6_tp2_pp1
	layer_6_expert_out_sp1_ep6_tp2_pp1 [label="Expert Out L6 SP1 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep6_tp2_pp1 -> layer_6_expert_out_sp1_ep6_tp2_pp1
	layer_6_expert_sp1_ep6_tp3_pp1 [label="Expert L6 SP1 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep6_pp1 -> layer_6_expert_sp1_ep6_tp3_pp1
	layer_6_expert_out_sp1_ep6_tp3_pp1 [label="Expert Out L6 SP1 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep6_tp3_pp1 -> layer_6_expert_out_sp1_ep6_tp3_pp1
	layer_6_expert_ar_sp1_ep6_pp1 [label="Expert All-Reduce L6 SP1 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep6_tp0_pp1 -> layer_6_expert_ar_sp1_ep6_pp1
	layer_6_expert_out_sp1_ep6_tp1_pp1 -> layer_6_expert_ar_sp1_ep6_pp1
	layer_6_expert_out_sp1_ep6_tp2_pp1 -> layer_6_expert_ar_sp1_ep6_pp1
	layer_6_expert_out_sp1_ep6_tp3_pp1 -> layer_6_expert_ar_sp1_ep6_pp1
	layer_6_combine_sp1_ep6_pp1 [label="Token Combine L6 SP1 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep6_pp1 -> layer_6_combine_sp1_ep6_pp1
	layer_6_dispatch_sp1_ep7_pp1 [label="Token Dispatch L6 SP1 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep7_pp1 [style=dashed]
	layer_6_expert_sp1_ep7_tp0_pp1 [label="Expert L6 SP1 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep7_pp1 -> layer_6_expert_sp1_ep7_tp0_pp1
	layer_6_expert_out_sp1_ep7_tp0_pp1 [label="Expert Out L6 SP1 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep7_tp0_pp1 -> layer_6_expert_out_sp1_ep7_tp0_pp1
	layer_6_expert_sp1_ep7_tp1_pp1 [label="Expert L6 SP1 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep7_pp1 -> layer_6_expert_sp1_ep7_tp1_pp1
	layer_6_expert_out_sp1_ep7_tp1_pp1 [label="Expert Out L6 SP1 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep7_tp1_pp1 -> layer_6_expert_out_sp1_ep7_tp1_pp1
	layer_6_expert_sp1_ep7_tp2_pp1 [label="Expert L6 SP1 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep7_pp1 -> layer_6_expert_sp1_ep7_tp2_pp1
	layer_6_expert_out_sp1_ep7_tp2_pp1 [label="Expert Out L6 SP1 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep7_tp2_pp1 -> layer_6_expert_out_sp1_ep7_tp2_pp1
	layer_6_expert_sp1_ep7_tp3_pp1 [label="Expert L6 SP1 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep7_pp1 -> layer_6_expert_sp1_ep7_tp3_pp1
	layer_6_expert_out_sp1_ep7_tp3_pp1 [label="Expert Out L6 SP1 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep7_tp3_pp1 -> layer_6_expert_out_sp1_ep7_tp3_pp1
	layer_6_expert_ar_sp1_ep7_pp1 [label="Expert All-Reduce L6 SP1 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep7_tp0_pp1 -> layer_6_expert_ar_sp1_ep7_pp1
	layer_6_expert_out_sp1_ep7_tp1_pp1 -> layer_6_expert_ar_sp1_ep7_pp1
	layer_6_expert_out_sp1_ep7_tp2_pp1 -> layer_6_expert_ar_sp1_ep7_pp1
	layer_6_expert_out_sp1_ep7_tp3_pp1 -> layer_6_expert_ar_sp1_ep7_pp1
	layer_6_combine_sp1_ep7_pp1 [label="Token Combine L6 SP1 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep7_pp1 -> layer_6_combine_sp1_ep7_pp1
	layer_6_dispatch_sp1_ep8_pp1 [label="Token Dispatch L6 SP1 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep8_pp1 [style=dashed]
	layer_6_expert_sp1_ep8_tp0_pp1 [label="Expert L6 SP1 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep8_pp1 -> layer_6_expert_sp1_ep8_tp0_pp1
	layer_6_expert_out_sp1_ep8_tp0_pp1 [label="Expert Out L6 SP1 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep8_tp0_pp1 -> layer_6_expert_out_sp1_ep8_tp0_pp1
	layer_6_expert_sp1_ep8_tp1_pp1 [label="Expert L6 SP1 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep8_pp1 -> layer_6_expert_sp1_ep8_tp1_pp1
	layer_6_expert_out_sp1_ep8_tp1_pp1 [label="Expert Out L6 SP1 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep8_tp1_pp1 -> layer_6_expert_out_sp1_ep8_tp1_pp1
	layer_6_expert_sp1_ep8_tp2_pp1 [label="Expert L6 SP1 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep8_pp1 -> layer_6_expert_sp1_ep8_tp2_pp1
	layer_6_expert_out_sp1_ep8_tp2_pp1 [label="Expert Out L6 SP1 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep8_tp2_pp1 -> layer_6_expert_out_sp1_ep8_tp2_pp1
	layer_6_expert_sp1_ep8_tp3_pp1 [label="Expert L6 SP1 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep8_pp1 -> layer_6_expert_sp1_ep8_tp3_pp1
	layer_6_expert_out_sp1_ep8_tp3_pp1 [label="Expert Out L6 SP1 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep8_tp3_pp1 -> layer_6_expert_out_sp1_ep8_tp3_pp1
	layer_6_expert_ar_sp1_ep8_pp1 [label="Expert All-Reduce L6 SP1 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep8_tp0_pp1 -> layer_6_expert_ar_sp1_ep8_pp1
	layer_6_expert_out_sp1_ep8_tp1_pp1 -> layer_6_expert_ar_sp1_ep8_pp1
	layer_6_expert_out_sp1_ep8_tp2_pp1 -> layer_6_expert_ar_sp1_ep8_pp1
	layer_6_expert_out_sp1_ep8_tp3_pp1 -> layer_6_expert_ar_sp1_ep8_pp1
	layer_6_combine_sp1_ep8_pp1 [label="Token Combine L6 SP1 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep8_pp1 -> layer_6_combine_sp1_ep8_pp1
	layer_6_dispatch_sp1_ep9_pp1 [label="Token Dispatch L6 SP1 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep9_pp1 [style=dashed]
	layer_6_expert_sp1_ep9_tp0_pp1 [label="Expert L6 SP1 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep9_pp1 -> layer_6_expert_sp1_ep9_tp0_pp1
	layer_6_expert_out_sp1_ep9_tp0_pp1 [label="Expert Out L6 SP1 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep9_tp0_pp1 -> layer_6_expert_out_sp1_ep9_tp0_pp1
	layer_6_expert_sp1_ep9_tp1_pp1 [label="Expert L6 SP1 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep9_pp1 -> layer_6_expert_sp1_ep9_tp1_pp1
	layer_6_expert_out_sp1_ep9_tp1_pp1 [label="Expert Out L6 SP1 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep9_tp1_pp1 -> layer_6_expert_out_sp1_ep9_tp1_pp1
	layer_6_expert_sp1_ep9_tp2_pp1 [label="Expert L6 SP1 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep9_pp1 -> layer_6_expert_sp1_ep9_tp2_pp1
	layer_6_expert_out_sp1_ep9_tp2_pp1 [label="Expert Out L6 SP1 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep9_tp2_pp1 -> layer_6_expert_out_sp1_ep9_tp2_pp1
	layer_6_expert_sp1_ep9_tp3_pp1 [label="Expert L6 SP1 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep9_pp1 -> layer_6_expert_sp1_ep9_tp3_pp1
	layer_6_expert_out_sp1_ep9_tp3_pp1 [label="Expert Out L6 SP1 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep9_tp3_pp1 -> layer_6_expert_out_sp1_ep9_tp3_pp1
	layer_6_expert_ar_sp1_ep9_pp1 [label="Expert All-Reduce L6 SP1 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep9_tp0_pp1 -> layer_6_expert_ar_sp1_ep9_pp1
	layer_6_expert_out_sp1_ep9_tp1_pp1 -> layer_6_expert_ar_sp1_ep9_pp1
	layer_6_expert_out_sp1_ep9_tp2_pp1 -> layer_6_expert_ar_sp1_ep9_pp1
	layer_6_expert_out_sp1_ep9_tp3_pp1 -> layer_6_expert_ar_sp1_ep9_pp1
	layer_6_combine_sp1_ep9_pp1 [label="Token Combine L6 SP1 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep9_pp1 -> layer_6_combine_sp1_ep9_pp1
	layer_6_dispatch_sp1_ep10_pp1 [label="Token Dispatch L6 SP1 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep10_pp1 [style=dashed]
	layer_6_expert_sp1_ep10_tp0_pp1 [label="Expert L6 SP1 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep10_pp1 -> layer_6_expert_sp1_ep10_tp0_pp1
	layer_6_expert_out_sp1_ep10_tp0_pp1 [label="Expert Out L6 SP1 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep10_tp0_pp1 -> layer_6_expert_out_sp1_ep10_tp0_pp1
	layer_6_expert_sp1_ep10_tp1_pp1 [label="Expert L6 SP1 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep10_pp1 -> layer_6_expert_sp1_ep10_tp1_pp1
	layer_6_expert_out_sp1_ep10_tp1_pp1 [label="Expert Out L6 SP1 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep10_tp1_pp1 -> layer_6_expert_out_sp1_ep10_tp1_pp1
	layer_6_expert_sp1_ep10_tp2_pp1 [label="Expert L6 SP1 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep10_pp1 -> layer_6_expert_sp1_ep10_tp2_pp1
	layer_6_expert_out_sp1_ep10_tp2_pp1 [label="Expert Out L6 SP1 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep10_tp2_pp1 -> layer_6_expert_out_sp1_ep10_tp2_pp1
	layer_6_expert_sp1_ep10_tp3_pp1 [label="Expert L6 SP1 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep10_pp1 -> layer_6_expert_sp1_ep10_tp3_pp1
	layer_6_expert_out_sp1_ep10_tp3_pp1 [label="Expert Out L6 SP1 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep10_tp3_pp1 -> layer_6_expert_out_sp1_ep10_tp3_pp1
	layer_6_expert_ar_sp1_ep10_pp1 [label="Expert All-Reduce L6 SP1 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep10_tp0_pp1 -> layer_6_expert_ar_sp1_ep10_pp1
	layer_6_expert_out_sp1_ep10_tp1_pp1 -> layer_6_expert_ar_sp1_ep10_pp1
	layer_6_expert_out_sp1_ep10_tp2_pp1 -> layer_6_expert_ar_sp1_ep10_pp1
	layer_6_expert_out_sp1_ep10_tp3_pp1 -> layer_6_expert_ar_sp1_ep10_pp1
	layer_6_combine_sp1_ep10_pp1 [label="Token Combine L6 SP1 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep10_pp1 -> layer_6_combine_sp1_ep10_pp1
	layer_6_dispatch_sp1_ep11_pp1 [label="Token Dispatch L6 SP1 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep11_pp1 [style=dashed]
	layer_6_expert_sp1_ep11_tp0_pp1 [label="Expert L6 SP1 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep11_pp1 -> layer_6_expert_sp1_ep11_tp0_pp1
	layer_6_expert_out_sp1_ep11_tp0_pp1 [label="Expert Out L6 SP1 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep11_tp0_pp1 -> layer_6_expert_out_sp1_ep11_tp0_pp1
	layer_6_expert_sp1_ep11_tp1_pp1 [label="Expert L6 SP1 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep11_pp1 -> layer_6_expert_sp1_ep11_tp1_pp1
	layer_6_expert_out_sp1_ep11_tp1_pp1 [label="Expert Out L6 SP1 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep11_tp1_pp1 -> layer_6_expert_out_sp1_ep11_tp1_pp1
	layer_6_expert_sp1_ep11_tp2_pp1 [label="Expert L6 SP1 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep11_pp1 -> layer_6_expert_sp1_ep11_tp2_pp1
	layer_6_expert_out_sp1_ep11_tp2_pp1 [label="Expert Out L6 SP1 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep11_tp2_pp1 -> layer_6_expert_out_sp1_ep11_tp2_pp1
	layer_6_expert_sp1_ep11_tp3_pp1 [label="Expert L6 SP1 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep11_pp1 -> layer_6_expert_sp1_ep11_tp3_pp1
	layer_6_expert_out_sp1_ep11_tp3_pp1 [label="Expert Out L6 SP1 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep11_tp3_pp1 -> layer_6_expert_out_sp1_ep11_tp3_pp1
	layer_6_expert_ar_sp1_ep11_pp1 [label="Expert All-Reduce L6 SP1 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep11_tp0_pp1 -> layer_6_expert_ar_sp1_ep11_pp1
	layer_6_expert_out_sp1_ep11_tp1_pp1 -> layer_6_expert_ar_sp1_ep11_pp1
	layer_6_expert_out_sp1_ep11_tp2_pp1 -> layer_6_expert_ar_sp1_ep11_pp1
	layer_6_expert_out_sp1_ep11_tp3_pp1 -> layer_6_expert_ar_sp1_ep11_pp1
	layer_6_combine_sp1_ep11_pp1 [label="Token Combine L6 SP1 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep11_pp1 -> layer_6_combine_sp1_ep11_pp1
	layer_6_dispatch_sp1_ep12_pp1 [label="Token Dispatch L6 SP1 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep12_pp1 [style=dashed]
	layer_6_expert_sp1_ep12_tp0_pp1 [label="Expert L6 SP1 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep12_pp1 -> layer_6_expert_sp1_ep12_tp0_pp1
	layer_6_expert_out_sp1_ep12_tp0_pp1 [label="Expert Out L6 SP1 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep12_tp0_pp1 -> layer_6_expert_out_sp1_ep12_tp0_pp1
	layer_6_expert_sp1_ep12_tp1_pp1 [label="Expert L6 SP1 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep12_pp1 -> layer_6_expert_sp1_ep12_tp1_pp1
	layer_6_expert_out_sp1_ep12_tp1_pp1 [label="Expert Out L6 SP1 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep12_tp1_pp1 -> layer_6_expert_out_sp1_ep12_tp1_pp1
	layer_6_expert_sp1_ep12_tp2_pp1 [label="Expert L6 SP1 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep12_pp1 -> layer_6_expert_sp1_ep12_tp2_pp1
	layer_6_expert_out_sp1_ep12_tp2_pp1 [label="Expert Out L6 SP1 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep12_tp2_pp1 -> layer_6_expert_out_sp1_ep12_tp2_pp1
	layer_6_expert_sp1_ep12_tp3_pp1 [label="Expert L6 SP1 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep12_pp1 -> layer_6_expert_sp1_ep12_tp3_pp1
	layer_6_expert_out_sp1_ep12_tp3_pp1 [label="Expert Out L6 SP1 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep12_tp3_pp1 -> layer_6_expert_out_sp1_ep12_tp3_pp1
	layer_6_expert_ar_sp1_ep12_pp1 [label="Expert All-Reduce L6 SP1 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep12_tp0_pp1 -> layer_6_expert_ar_sp1_ep12_pp1
	layer_6_expert_out_sp1_ep12_tp1_pp1 -> layer_6_expert_ar_sp1_ep12_pp1
	layer_6_expert_out_sp1_ep12_tp2_pp1 -> layer_6_expert_ar_sp1_ep12_pp1
	layer_6_expert_out_sp1_ep12_tp3_pp1 -> layer_6_expert_ar_sp1_ep12_pp1
	layer_6_combine_sp1_ep12_pp1 [label="Token Combine L6 SP1 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep12_pp1 -> layer_6_combine_sp1_ep12_pp1
	layer_6_dispatch_sp1_ep13_pp1 [label="Token Dispatch L6 SP1 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep13_pp1 [style=dashed]
	layer_6_expert_sp1_ep13_tp0_pp1 [label="Expert L6 SP1 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep13_pp1 -> layer_6_expert_sp1_ep13_tp0_pp1
	layer_6_expert_out_sp1_ep13_tp0_pp1 [label="Expert Out L6 SP1 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep13_tp0_pp1 -> layer_6_expert_out_sp1_ep13_tp0_pp1
	layer_6_expert_sp1_ep13_tp1_pp1 [label="Expert L6 SP1 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep13_pp1 -> layer_6_expert_sp1_ep13_tp1_pp1
	layer_6_expert_out_sp1_ep13_tp1_pp1 [label="Expert Out L6 SP1 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep13_tp1_pp1 -> layer_6_expert_out_sp1_ep13_tp1_pp1
	layer_6_expert_sp1_ep13_tp2_pp1 [label="Expert L6 SP1 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep13_pp1 -> layer_6_expert_sp1_ep13_tp2_pp1
	layer_6_expert_out_sp1_ep13_tp2_pp1 [label="Expert Out L6 SP1 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep13_tp2_pp1 -> layer_6_expert_out_sp1_ep13_tp2_pp1
	layer_6_expert_sp1_ep13_tp3_pp1 [label="Expert L6 SP1 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep13_pp1 -> layer_6_expert_sp1_ep13_tp3_pp1
	layer_6_expert_out_sp1_ep13_tp3_pp1 [label="Expert Out L6 SP1 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep13_tp3_pp1 -> layer_6_expert_out_sp1_ep13_tp3_pp1
	layer_6_expert_ar_sp1_ep13_pp1 [label="Expert All-Reduce L6 SP1 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep13_tp0_pp1 -> layer_6_expert_ar_sp1_ep13_pp1
	layer_6_expert_out_sp1_ep13_tp1_pp1 -> layer_6_expert_ar_sp1_ep13_pp1
	layer_6_expert_out_sp1_ep13_tp2_pp1 -> layer_6_expert_ar_sp1_ep13_pp1
	layer_6_expert_out_sp1_ep13_tp3_pp1 -> layer_6_expert_ar_sp1_ep13_pp1
	layer_6_combine_sp1_ep13_pp1 [label="Token Combine L6 SP1 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep13_pp1 -> layer_6_combine_sp1_ep13_pp1
	layer_6_dispatch_sp1_ep14_pp1 [label="Token Dispatch L6 SP1 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep14_pp1 [style=dashed]
	layer_6_expert_sp1_ep14_tp0_pp1 [label="Expert L6 SP1 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep14_pp1 -> layer_6_expert_sp1_ep14_tp0_pp1
	layer_6_expert_out_sp1_ep14_tp0_pp1 [label="Expert Out L6 SP1 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep14_tp0_pp1 -> layer_6_expert_out_sp1_ep14_tp0_pp1
	layer_6_expert_sp1_ep14_tp1_pp1 [label="Expert L6 SP1 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep14_pp1 -> layer_6_expert_sp1_ep14_tp1_pp1
	layer_6_expert_out_sp1_ep14_tp1_pp1 [label="Expert Out L6 SP1 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep14_tp1_pp1 -> layer_6_expert_out_sp1_ep14_tp1_pp1
	layer_6_expert_sp1_ep14_tp2_pp1 [label="Expert L6 SP1 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep14_pp1 -> layer_6_expert_sp1_ep14_tp2_pp1
	layer_6_expert_out_sp1_ep14_tp2_pp1 [label="Expert Out L6 SP1 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep14_tp2_pp1 -> layer_6_expert_out_sp1_ep14_tp2_pp1
	layer_6_expert_sp1_ep14_tp3_pp1 [label="Expert L6 SP1 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep14_pp1 -> layer_6_expert_sp1_ep14_tp3_pp1
	layer_6_expert_out_sp1_ep14_tp3_pp1 [label="Expert Out L6 SP1 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep14_tp3_pp1 -> layer_6_expert_out_sp1_ep14_tp3_pp1
	layer_6_expert_ar_sp1_ep14_pp1 [label="Expert All-Reduce L6 SP1 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep14_tp0_pp1 -> layer_6_expert_ar_sp1_ep14_pp1
	layer_6_expert_out_sp1_ep14_tp1_pp1 -> layer_6_expert_ar_sp1_ep14_pp1
	layer_6_expert_out_sp1_ep14_tp2_pp1 -> layer_6_expert_ar_sp1_ep14_pp1
	layer_6_expert_out_sp1_ep14_tp3_pp1 -> layer_6_expert_ar_sp1_ep14_pp1
	layer_6_combine_sp1_ep14_pp1 [label="Token Combine L6 SP1 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep14_pp1 -> layer_6_combine_sp1_ep14_pp1
	layer_6_dispatch_sp1_ep15_pp1 [label="Token Dispatch L6 SP1 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp1_pp1 -> layer_6_dispatch_sp1_ep15_pp1 [style=dashed]
	layer_6_expert_sp1_ep15_tp0_pp1 [label="Expert L6 SP1 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep15_pp1 -> layer_6_expert_sp1_ep15_tp0_pp1
	layer_6_expert_out_sp1_ep15_tp0_pp1 [label="Expert Out L6 SP1 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep15_tp0_pp1 -> layer_6_expert_out_sp1_ep15_tp0_pp1
	layer_6_expert_sp1_ep15_tp1_pp1 [label="Expert L6 SP1 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep15_pp1 -> layer_6_expert_sp1_ep15_tp1_pp1
	layer_6_expert_out_sp1_ep15_tp1_pp1 [label="Expert Out L6 SP1 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep15_tp1_pp1 -> layer_6_expert_out_sp1_ep15_tp1_pp1
	layer_6_expert_sp1_ep15_tp2_pp1 [label="Expert L6 SP1 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep15_pp1 -> layer_6_expert_sp1_ep15_tp2_pp1
	layer_6_expert_out_sp1_ep15_tp2_pp1 [label="Expert Out L6 SP1 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep15_tp2_pp1 -> layer_6_expert_out_sp1_ep15_tp2_pp1
	layer_6_expert_sp1_ep15_tp3_pp1 [label="Expert L6 SP1 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp1_ep15_pp1 -> layer_6_expert_sp1_ep15_tp3_pp1
	layer_6_expert_out_sp1_ep15_tp3_pp1 [label="Expert Out L6 SP1 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp1_ep15_tp3_pp1 -> layer_6_expert_out_sp1_ep15_tp3_pp1
	layer_6_expert_ar_sp1_ep15_pp1 [label="Expert All-Reduce L6 SP1 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp1_ep15_tp0_pp1 -> layer_6_expert_ar_sp1_ep15_pp1
	layer_6_expert_out_sp1_ep15_tp1_pp1 -> layer_6_expert_ar_sp1_ep15_pp1
	layer_6_expert_out_sp1_ep15_tp2_pp1 -> layer_6_expert_ar_sp1_ep15_pp1
	layer_6_expert_out_sp1_ep15_tp3_pp1 -> layer_6_expert_ar_sp1_ep15_pp1
	layer_6_combine_sp1_ep15_pp1 [label="Token Combine L6 SP1 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp1_ep15_pp1 -> layer_6_combine_sp1_ep15_pp1
	layer_6_moe_all2all_sp1_pp1 [label="MoE All-to-All L6 SP1\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_6_combine_sp1_ep0_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep1_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep2_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep3_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep4_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep5_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep6_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep7_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep8_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep9_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep10_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep11_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep12_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep13_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep14_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_combine_sp1_ep15_pp1 -> layer_6_moe_all2all_sp1_pp1
	layer_6_mlp_out_sp1_pp1 [label="MoE Output L6 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_moe_all2all_sp1_pp1 -> layer_6_mlp_out_sp1_pp1
	layer_6_mlp_res_sp1_pp1 [label="MLP Residual L6 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_mlp_out_sp1_pp1 -> layer_6_mlp_res_sp1_pp1
	layer_6_attn_res_sp1_pp1 -> layer_6_mlp_res_sp1_pp1 [style=dashed]
	layer_6_norm_sp2_pp1 [label="LayerNorm L6 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_mlp_out_sp2_pp1 -> layer_6_norm_sp2_pp1
	layer_6_qkv_sp2_tp0_pp1 [label="QKV Proj L6 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp2_pp1 -> layer_6_qkv_sp2_tp0_pp1
	layer_6_attn_sp2_tp0_pp1 [label="Attention L6 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp2_tp0_pp1 -> layer_6_attn_sp2_tp0_pp1
	layer_6_attn_out_sp2_tp0_pp1 [label="Attn Out Proj L6 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp2_tp0_pp1 -> layer_6_attn_out_sp2_tp0_pp1
	layer_6_qkv_sp2_tp1_pp1 [label="QKV Proj L6 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp2_pp1 -> layer_6_qkv_sp2_tp1_pp1
	layer_6_attn_sp2_tp1_pp1 [label="Attention L6 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp2_tp1_pp1 -> layer_6_attn_sp2_tp1_pp1
	layer_6_attn_out_sp2_tp1_pp1 [label="Attn Out Proj L6 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp2_tp1_pp1 -> layer_6_attn_out_sp2_tp1_pp1
	layer_6_qkv_sp2_tp2_pp1 [label="QKV Proj L6 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp2_pp1 -> layer_6_qkv_sp2_tp2_pp1
	layer_6_attn_sp2_tp2_pp1 [label="Attention L6 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp2_tp2_pp1 -> layer_6_attn_sp2_tp2_pp1
	layer_6_attn_out_sp2_tp2_pp1 [label="Attn Out Proj L6 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp2_tp2_pp1 -> layer_6_attn_out_sp2_tp2_pp1
	layer_6_qkv_sp2_tp3_pp1 [label="QKV Proj L6 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp2_pp1 -> layer_6_qkv_sp2_tp3_pp1
	layer_6_attn_sp2_tp3_pp1 [label="Attention L6 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp2_tp3_pp1 -> layer_6_attn_sp2_tp3_pp1
	layer_6_attn_out_sp2_tp3_pp1 [label="Attn Out Proj L6 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp2_tp3_pp1 -> layer_6_attn_out_sp2_tp3_pp1
	layer_6_attn_ar_sp2_pp1 [label="Attention All-Reduce L6 SP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_attn_out_sp2_tp0_pp1 -> layer_6_attn_ar_sp2_pp1
	layer_6_attn_out_sp2_tp1_pp1 -> layer_6_attn_ar_sp2_pp1
	layer_6_attn_out_sp2_tp2_pp1 -> layer_6_attn_ar_sp2_pp1
	layer_6_attn_out_sp2_tp3_pp1 -> layer_6_attn_ar_sp2_pp1
	layer_6_attn_res_sp2_pp1 [label="Attention Residual L6 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_attn_ar_sp2_pp1 -> layer_6_attn_res_sp2_pp1
	layer_6_norm_sp2_pp1 -> layer_6_attn_res_sp2_pp1 [style=dashed]
	layer_6_post_norm_sp2_pp1 [label="Post-Attn Norm L6 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_attn_res_sp2_pp1 -> layer_6_post_norm_sp2_pp1
	layer_6_router_sp2_pp1 [label="MoE Router L6 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_6_post_norm_sp2_pp1 -> layer_6_router_sp2_pp1
	layer_6_dispatch_sp2_ep0_pp1 [label="Token Dispatch L6 SP2 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep0_pp1 [style=dashed]
	layer_6_expert_sp2_ep0_tp0_pp1 [label="Expert L6 SP2 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep0_pp1 -> layer_6_expert_sp2_ep0_tp0_pp1
	layer_6_expert_out_sp2_ep0_tp0_pp1 [label="Expert Out L6 SP2 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep0_tp0_pp1 -> layer_6_expert_out_sp2_ep0_tp0_pp1
	layer_6_expert_sp2_ep0_tp1_pp1 [label="Expert L6 SP2 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep0_pp1 -> layer_6_expert_sp2_ep0_tp1_pp1
	layer_6_expert_out_sp2_ep0_tp1_pp1 [label="Expert Out L6 SP2 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep0_tp1_pp1 -> layer_6_expert_out_sp2_ep0_tp1_pp1
	layer_6_expert_sp2_ep0_tp2_pp1 [label="Expert L6 SP2 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep0_pp1 -> layer_6_expert_sp2_ep0_tp2_pp1
	layer_6_expert_out_sp2_ep0_tp2_pp1 [label="Expert Out L6 SP2 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep0_tp2_pp1 -> layer_6_expert_out_sp2_ep0_tp2_pp1
	layer_6_expert_sp2_ep0_tp3_pp1 [label="Expert L6 SP2 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep0_pp1 -> layer_6_expert_sp2_ep0_tp3_pp1
	layer_6_expert_out_sp2_ep0_tp3_pp1 [label="Expert Out L6 SP2 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep0_tp3_pp1 -> layer_6_expert_out_sp2_ep0_tp3_pp1
	layer_6_expert_ar_sp2_ep0_pp1 [label="Expert All-Reduce L6 SP2 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep0_tp0_pp1 -> layer_6_expert_ar_sp2_ep0_pp1
	layer_6_expert_out_sp2_ep0_tp1_pp1 -> layer_6_expert_ar_sp2_ep0_pp1
	layer_6_expert_out_sp2_ep0_tp2_pp1 -> layer_6_expert_ar_sp2_ep0_pp1
	layer_6_expert_out_sp2_ep0_tp3_pp1 -> layer_6_expert_ar_sp2_ep0_pp1
	layer_6_combine_sp2_ep0_pp1 [label="Token Combine L6 SP2 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep0_pp1 -> layer_6_combine_sp2_ep0_pp1
	layer_6_dispatch_sp2_ep1_pp1 [label="Token Dispatch L6 SP2 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep1_pp1 [style=dashed]
	layer_6_expert_sp2_ep1_tp0_pp1 [label="Expert L6 SP2 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep1_pp1 -> layer_6_expert_sp2_ep1_tp0_pp1
	layer_6_expert_out_sp2_ep1_tp0_pp1 [label="Expert Out L6 SP2 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep1_tp0_pp1 -> layer_6_expert_out_sp2_ep1_tp0_pp1
	layer_6_expert_sp2_ep1_tp1_pp1 [label="Expert L6 SP2 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep1_pp1 -> layer_6_expert_sp2_ep1_tp1_pp1
	layer_6_expert_out_sp2_ep1_tp1_pp1 [label="Expert Out L6 SP2 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep1_tp1_pp1 -> layer_6_expert_out_sp2_ep1_tp1_pp1
	layer_6_expert_sp2_ep1_tp2_pp1 [label="Expert L6 SP2 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep1_pp1 -> layer_6_expert_sp2_ep1_tp2_pp1
	layer_6_expert_out_sp2_ep1_tp2_pp1 [label="Expert Out L6 SP2 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep1_tp2_pp1 -> layer_6_expert_out_sp2_ep1_tp2_pp1
	layer_6_expert_sp2_ep1_tp3_pp1 [label="Expert L6 SP2 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep1_pp1 -> layer_6_expert_sp2_ep1_tp3_pp1
	layer_6_expert_out_sp2_ep1_tp3_pp1 [label="Expert Out L6 SP2 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep1_tp3_pp1 -> layer_6_expert_out_sp2_ep1_tp3_pp1
	layer_6_expert_ar_sp2_ep1_pp1 [label="Expert All-Reduce L6 SP2 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep1_tp0_pp1 -> layer_6_expert_ar_sp2_ep1_pp1
	layer_6_expert_out_sp2_ep1_tp1_pp1 -> layer_6_expert_ar_sp2_ep1_pp1
	layer_6_expert_out_sp2_ep1_tp2_pp1 -> layer_6_expert_ar_sp2_ep1_pp1
	layer_6_expert_out_sp2_ep1_tp3_pp1 -> layer_6_expert_ar_sp2_ep1_pp1
	layer_6_combine_sp2_ep1_pp1 [label="Token Combine L6 SP2 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep1_pp1 -> layer_6_combine_sp2_ep1_pp1
	layer_6_dispatch_sp2_ep2_pp1 [label="Token Dispatch L6 SP2 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep2_pp1 [style=dashed]
	layer_6_expert_sp2_ep2_tp0_pp1 [label="Expert L6 SP2 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep2_pp1 -> layer_6_expert_sp2_ep2_tp0_pp1
	layer_6_expert_out_sp2_ep2_tp0_pp1 [label="Expert Out L6 SP2 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep2_tp0_pp1 -> layer_6_expert_out_sp2_ep2_tp0_pp1
	layer_6_expert_sp2_ep2_tp1_pp1 [label="Expert L6 SP2 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep2_pp1 -> layer_6_expert_sp2_ep2_tp1_pp1
	layer_6_expert_out_sp2_ep2_tp1_pp1 [label="Expert Out L6 SP2 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep2_tp1_pp1 -> layer_6_expert_out_sp2_ep2_tp1_pp1
	layer_6_expert_sp2_ep2_tp2_pp1 [label="Expert L6 SP2 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep2_pp1 -> layer_6_expert_sp2_ep2_tp2_pp1
	layer_6_expert_out_sp2_ep2_tp2_pp1 [label="Expert Out L6 SP2 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep2_tp2_pp1 -> layer_6_expert_out_sp2_ep2_tp2_pp1
	layer_6_expert_sp2_ep2_tp3_pp1 [label="Expert L6 SP2 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep2_pp1 -> layer_6_expert_sp2_ep2_tp3_pp1
	layer_6_expert_out_sp2_ep2_tp3_pp1 [label="Expert Out L6 SP2 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep2_tp3_pp1 -> layer_6_expert_out_sp2_ep2_tp3_pp1
	layer_6_expert_ar_sp2_ep2_pp1 [label="Expert All-Reduce L6 SP2 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep2_tp0_pp1 -> layer_6_expert_ar_sp2_ep2_pp1
	layer_6_expert_out_sp2_ep2_tp1_pp1 -> layer_6_expert_ar_sp2_ep2_pp1
	layer_6_expert_out_sp2_ep2_tp2_pp1 -> layer_6_expert_ar_sp2_ep2_pp1
	layer_6_expert_out_sp2_ep2_tp3_pp1 -> layer_6_expert_ar_sp2_ep2_pp1
	layer_6_combine_sp2_ep2_pp1 [label="Token Combine L6 SP2 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep2_pp1 -> layer_6_combine_sp2_ep2_pp1
	layer_6_dispatch_sp2_ep3_pp1 [label="Token Dispatch L6 SP2 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep3_pp1 [style=dashed]
	layer_6_expert_sp2_ep3_tp0_pp1 [label="Expert L6 SP2 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep3_pp1 -> layer_6_expert_sp2_ep3_tp0_pp1
	layer_6_expert_out_sp2_ep3_tp0_pp1 [label="Expert Out L6 SP2 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep3_tp0_pp1 -> layer_6_expert_out_sp2_ep3_tp0_pp1
	layer_6_expert_sp2_ep3_tp1_pp1 [label="Expert L6 SP2 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep3_pp1 -> layer_6_expert_sp2_ep3_tp1_pp1
	layer_6_expert_out_sp2_ep3_tp1_pp1 [label="Expert Out L6 SP2 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep3_tp1_pp1 -> layer_6_expert_out_sp2_ep3_tp1_pp1
	layer_6_expert_sp2_ep3_tp2_pp1 [label="Expert L6 SP2 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep3_pp1 -> layer_6_expert_sp2_ep3_tp2_pp1
	layer_6_expert_out_sp2_ep3_tp2_pp1 [label="Expert Out L6 SP2 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep3_tp2_pp1 -> layer_6_expert_out_sp2_ep3_tp2_pp1
	layer_6_expert_sp2_ep3_tp3_pp1 [label="Expert L6 SP2 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep3_pp1 -> layer_6_expert_sp2_ep3_tp3_pp1
	layer_6_expert_out_sp2_ep3_tp3_pp1 [label="Expert Out L6 SP2 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep3_tp3_pp1 -> layer_6_expert_out_sp2_ep3_tp3_pp1
	layer_6_expert_ar_sp2_ep3_pp1 [label="Expert All-Reduce L6 SP2 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep3_tp0_pp1 -> layer_6_expert_ar_sp2_ep3_pp1
	layer_6_expert_out_sp2_ep3_tp1_pp1 -> layer_6_expert_ar_sp2_ep3_pp1
	layer_6_expert_out_sp2_ep3_tp2_pp1 -> layer_6_expert_ar_sp2_ep3_pp1
	layer_6_expert_out_sp2_ep3_tp3_pp1 -> layer_6_expert_ar_sp2_ep3_pp1
	layer_6_combine_sp2_ep3_pp1 [label="Token Combine L6 SP2 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep3_pp1 -> layer_6_combine_sp2_ep3_pp1
	layer_6_dispatch_sp2_ep4_pp1 [label="Token Dispatch L6 SP2 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep4_pp1 [style=dashed]
	layer_6_expert_sp2_ep4_tp0_pp1 [label="Expert L6 SP2 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep4_pp1 -> layer_6_expert_sp2_ep4_tp0_pp1
	layer_6_expert_out_sp2_ep4_tp0_pp1 [label="Expert Out L6 SP2 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep4_tp0_pp1 -> layer_6_expert_out_sp2_ep4_tp0_pp1
	layer_6_expert_sp2_ep4_tp1_pp1 [label="Expert L6 SP2 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep4_pp1 -> layer_6_expert_sp2_ep4_tp1_pp1
	layer_6_expert_out_sp2_ep4_tp1_pp1 [label="Expert Out L6 SP2 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep4_tp1_pp1 -> layer_6_expert_out_sp2_ep4_tp1_pp1
	layer_6_expert_sp2_ep4_tp2_pp1 [label="Expert L6 SP2 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep4_pp1 -> layer_6_expert_sp2_ep4_tp2_pp1
	layer_6_expert_out_sp2_ep4_tp2_pp1 [label="Expert Out L6 SP2 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep4_tp2_pp1 -> layer_6_expert_out_sp2_ep4_tp2_pp1
	layer_6_expert_sp2_ep4_tp3_pp1 [label="Expert L6 SP2 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep4_pp1 -> layer_6_expert_sp2_ep4_tp3_pp1
	layer_6_expert_out_sp2_ep4_tp3_pp1 [label="Expert Out L6 SP2 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep4_tp3_pp1 -> layer_6_expert_out_sp2_ep4_tp3_pp1
	layer_6_expert_ar_sp2_ep4_pp1 [label="Expert All-Reduce L6 SP2 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep4_tp0_pp1 -> layer_6_expert_ar_sp2_ep4_pp1
	layer_6_expert_out_sp2_ep4_tp1_pp1 -> layer_6_expert_ar_sp2_ep4_pp1
	layer_6_expert_out_sp2_ep4_tp2_pp1 -> layer_6_expert_ar_sp2_ep4_pp1
	layer_6_expert_out_sp2_ep4_tp3_pp1 -> layer_6_expert_ar_sp2_ep4_pp1
	layer_6_combine_sp2_ep4_pp1 [label="Token Combine L6 SP2 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep4_pp1 -> layer_6_combine_sp2_ep4_pp1
	layer_6_dispatch_sp2_ep5_pp1 [label="Token Dispatch L6 SP2 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep5_pp1 [style=dashed]
	layer_6_expert_sp2_ep5_tp0_pp1 [label="Expert L6 SP2 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep5_pp1 -> layer_6_expert_sp2_ep5_tp0_pp1
	layer_6_expert_out_sp2_ep5_tp0_pp1 [label="Expert Out L6 SP2 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep5_tp0_pp1 -> layer_6_expert_out_sp2_ep5_tp0_pp1
	layer_6_expert_sp2_ep5_tp1_pp1 [label="Expert L6 SP2 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep5_pp1 -> layer_6_expert_sp2_ep5_tp1_pp1
	layer_6_expert_out_sp2_ep5_tp1_pp1 [label="Expert Out L6 SP2 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep5_tp1_pp1 -> layer_6_expert_out_sp2_ep5_tp1_pp1
	layer_6_expert_sp2_ep5_tp2_pp1 [label="Expert L6 SP2 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep5_pp1 -> layer_6_expert_sp2_ep5_tp2_pp1
	layer_6_expert_out_sp2_ep5_tp2_pp1 [label="Expert Out L6 SP2 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep5_tp2_pp1 -> layer_6_expert_out_sp2_ep5_tp2_pp1
	layer_6_expert_sp2_ep5_tp3_pp1 [label="Expert L6 SP2 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep5_pp1 -> layer_6_expert_sp2_ep5_tp3_pp1
	layer_6_expert_out_sp2_ep5_tp3_pp1 [label="Expert Out L6 SP2 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep5_tp3_pp1 -> layer_6_expert_out_sp2_ep5_tp3_pp1
	layer_6_expert_ar_sp2_ep5_pp1 [label="Expert All-Reduce L6 SP2 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep5_tp0_pp1 -> layer_6_expert_ar_sp2_ep5_pp1
	layer_6_expert_out_sp2_ep5_tp1_pp1 -> layer_6_expert_ar_sp2_ep5_pp1
	layer_6_expert_out_sp2_ep5_tp2_pp1 -> layer_6_expert_ar_sp2_ep5_pp1
	layer_6_expert_out_sp2_ep5_tp3_pp1 -> layer_6_expert_ar_sp2_ep5_pp1
	layer_6_combine_sp2_ep5_pp1 [label="Token Combine L6 SP2 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep5_pp1 -> layer_6_combine_sp2_ep5_pp1
	layer_6_dispatch_sp2_ep6_pp1 [label="Token Dispatch L6 SP2 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep6_pp1 [style=dashed]
	layer_6_expert_sp2_ep6_tp0_pp1 [label="Expert L6 SP2 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep6_pp1 -> layer_6_expert_sp2_ep6_tp0_pp1
	layer_6_expert_out_sp2_ep6_tp0_pp1 [label="Expert Out L6 SP2 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep6_tp0_pp1 -> layer_6_expert_out_sp2_ep6_tp0_pp1
	layer_6_expert_sp2_ep6_tp1_pp1 [label="Expert L6 SP2 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep6_pp1 -> layer_6_expert_sp2_ep6_tp1_pp1
	layer_6_expert_out_sp2_ep6_tp1_pp1 [label="Expert Out L6 SP2 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep6_tp1_pp1 -> layer_6_expert_out_sp2_ep6_tp1_pp1
	layer_6_expert_sp2_ep6_tp2_pp1 [label="Expert L6 SP2 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep6_pp1 -> layer_6_expert_sp2_ep6_tp2_pp1
	layer_6_expert_out_sp2_ep6_tp2_pp1 [label="Expert Out L6 SP2 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep6_tp2_pp1 -> layer_6_expert_out_sp2_ep6_tp2_pp1
	layer_6_expert_sp2_ep6_tp3_pp1 [label="Expert L6 SP2 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep6_pp1 -> layer_6_expert_sp2_ep6_tp3_pp1
	layer_6_expert_out_sp2_ep6_tp3_pp1 [label="Expert Out L6 SP2 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep6_tp3_pp1 -> layer_6_expert_out_sp2_ep6_tp3_pp1
	layer_6_expert_ar_sp2_ep6_pp1 [label="Expert All-Reduce L6 SP2 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep6_tp0_pp1 -> layer_6_expert_ar_sp2_ep6_pp1
	layer_6_expert_out_sp2_ep6_tp1_pp1 -> layer_6_expert_ar_sp2_ep6_pp1
	layer_6_expert_out_sp2_ep6_tp2_pp1 -> layer_6_expert_ar_sp2_ep6_pp1
	layer_6_expert_out_sp2_ep6_tp3_pp1 -> layer_6_expert_ar_sp2_ep6_pp1
	layer_6_combine_sp2_ep6_pp1 [label="Token Combine L6 SP2 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep6_pp1 -> layer_6_combine_sp2_ep6_pp1
	layer_6_dispatch_sp2_ep7_pp1 [label="Token Dispatch L6 SP2 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep7_pp1 [style=dashed]
	layer_6_expert_sp2_ep7_tp0_pp1 [label="Expert L6 SP2 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep7_pp1 -> layer_6_expert_sp2_ep7_tp0_pp1
	layer_6_expert_out_sp2_ep7_tp0_pp1 [label="Expert Out L6 SP2 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep7_tp0_pp1 -> layer_6_expert_out_sp2_ep7_tp0_pp1
	layer_6_expert_sp2_ep7_tp1_pp1 [label="Expert L6 SP2 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep7_pp1 -> layer_6_expert_sp2_ep7_tp1_pp1
	layer_6_expert_out_sp2_ep7_tp1_pp1 [label="Expert Out L6 SP2 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep7_tp1_pp1 -> layer_6_expert_out_sp2_ep7_tp1_pp1
	layer_6_expert_sp2_ep7_tp2_pp1 [label="Expert L6 SP2 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep7_pp1 -> layer_6_expert_sp2_ep7_tp2_pp1
	layer_6_expert_out_sp2_ep7_tp2_pp1 [label="Expert Out L6 SP2 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep7_tp2_pp1 -> layer_6_expert_out_sp2_ep7_tp2_pp1
	layer_6_expert_sp2_ep7_tp3_pp1 [label="Expert L6 SP2 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep7_pp1 -> layer_6_expert_sp2_ep7_tp3_pp1
	layer_6_expert_out_sp2_ep7_tp3_pp1 [label="Expert Out L6 SP2 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep7_tp3_pp1 -> layer_6_expert_out_sp2_ep7_tp3_pp1
	layer_6_expert_ar_sp2_ep7_pp1 [label="Expert All-Reduce L6 SP2 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep7_tp0_pp1 -> layer_6_expert_ar_sp2_ep7_pp1
	layer_6_expert_out_sp2_ep7_tp1_pp1 -> layer_6_expert_ar_sp2_ep7_pp1
	layer_6_expert_out_sp2_ep7_tp2_pp1 -> layer_6_expert_ar_sp2_ep7_pp1
	layer_6_expert_out_sp2_ep7_tp3_pp1 -> layer_6_expert_ar_sp2_ep7_pp1
	layer_6_combine_sp2_ep7_pp1 [label="Token Combine L6 SP2 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep7_pp1 -> layer_6_combine_sp2_ep7_pp1
	layer_6_dispatch_sp2_ep8_pp1 [label="Token Dispatch L6 SP2 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep8_pp1 [style=dashed]
	layer_6_expert_sp2_ep8_tp0_pp1 [label="Expert L6 SP2 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep8_pp1 -> layer_6_expert_sp2_ep8_tp0_pp1
	layer_6_expert_out_sp2_ep8_tp0_pp1 [label="Expert Out L6 SP2 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep8_tp0_pp1 -> layer_6_expert_out_sp2_ep8_tp0_pp1
	layer_6_expert_sp2_ep8_tp1_pp1 [label="Expert L6 SP2 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep8_pp1 -> layer_6_expert_sp2_ep8_tp1_pp1
	layer_6_expert_out_sp2_ep8_tp1_pp1 [label="Expert Out L6 SP2 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep8_tp1_pp1 -> layer_6_expert_out_sp2_ep8_tp1_pp1
	layer_6_expert_sp2_ep8_tp2_pp1 [label="Expert L6 SP2 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep8_pp1 -> layer_6_expert_sp2_ep8_tp2_pp1
	layer_6_expert_out_sp2_ep8_tp2_pp1 [label="Expert Out L6 SP2 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep8_tp2_pp1 -> layer_6_expert_out_sp2_ep8_tp2_pp1
	layer_6_expert_sp2_ep8_tp3_pp1 [label="Expert L6 SP2 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep8_pp1 -> layer_6_expert_sp2_ep8_tp3_pp1
	layer_6_expert_out_sp2_ep8_tp3_pp1 [label="Expert Out L6 SP2 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep8_tp3_pp1 -> layer_6_expert_out_sp2_ep8_tp3_pp1
	layer_6_expert_ar_sp2_ep8_pp1 [label="Expert All-Reduce L6 SP2 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep8_tp0_pp1 -> layer_6_expert_ar_sp2_ep8_pp1
	layer_6_expert_out_sp2_ep8_tp1_pp1 -> layer_6_expert_ar_sp2_ep8_pp1
	layer_6_expert_out_sp2_ep8_tp2_pp1 -> layer_6_expert_ar_sp2_ep8_pp1
	layer_6_expert_out_sp2_ep8_tp3_pp1 -> layer_6_expert_ar_sp2_ep8_pp1
	layer_6_combine_sp2_ep8_pp1 [label="Token Combine L6 SP2 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep8_pp1 -> layer_6_combine_sp2_ep8_pp1
	layer_6_dispatch_sp2_ep9_pp1 [label="Token Dispatch L6 SP2 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep9_pp1 [style=dashed]
	layer_6_expert_sp2_ep9_tp0_pp1 [label="Expert L6 SP2 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep9_pp1 -> layer_6_expert_sp2_ep9_tp0_pp1
	layer_6_expert_out_sp2_ep9_tp0_pp1 [label="Expert Out L6 SP2 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep9_tp0_pp1 -> layer_6_expert_out_sp2_ep9_tp0_pp1
	layer_6_expert_sp2_ep9_tp1_pp1 [label="Expert L6 SP2 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep9_pp1 -> layer_6_expert_sp2_ep9_tp1_pp1
	layer_6_expert_out_sp2_ep9_tp1_pp1 [label="Expert Out L6 SP2 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep9_tp1_pp1 -> layer_6_expert_out_sp2_ep9_tp1_pp1
	layer_6_expert_sp2_ep9_tp2_pp1 [label="Expert L6 SP2 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep9_pp1 -> layer_6_expert_sp2_ep9_tp2_pp1
	layer_6_expert_out_sp2_ep9_tp2_pp1 [label="Expert Out L6 SP2 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep9_tp2_pp1 -> layer_6_expert_out_sp2_ep9_tp2_pp1
	layer_6_expert_sp2_ep9_tp3_pp1 [label="Expert L6 SP2 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep9_pp1 -> layer_6_expert_sp2_ep9_tp3_pp1
	layer_6_expert_out_sp2_ep9_tp3_pp1 [label="Expert Out L6 SP2 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep9_tp3_pp1 -> layer_6_expert_out_sp2_ep9_tp3_pp1
	layer_6_expert_ar_sp2_ep9_pp1 [label="Expert All-Reduce L6 SP2 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep9_tp0_pp1 -> layer_6_expert_ar_sp2_ep9_pp1
	layer_6_expert_out_sp2_ep9_tp1_pp1 -> layer_6_expert_ar_sp2_ep9_pp1
	layer_6_expert_out_sp2_ep9_tp2_pp1 -> layer_6_expert_ar_sp2_ep9_pp1
	layer_6_expert_out_sp2_ep9_tp3_pp1 -> layer_6_expert_ar_sp2_ep9_pp1
	layer_6_combine_sp2_ep9_pp1 [label="Token Combine L6 SP2 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep9_pp1 -> layer_6_combine_sp2_ep9_pp1
	layer_6_dispatch_sp2_ep10_pp1 [label="Token Dispatch L6 SP2 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep10_pp1 [style=dashed]
	layer_6_expert_sp2_ep10_tp0_pp1 [label="Expert L6 SP2 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep10_pp1 -> layer_6_expert_sp2_ep10_tp0_pp1
	layer_6_expert_out_sp2_ep10_tp0_pp1 [label="Expert Out L6 SP2 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep10_tp0_pp1 -> layer_6_expert_out_sp2_ep10_tp0_pp1
	layer_6_expert_sp2_ep10_tp1_pp1 [label="Expert L6 SP2 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep10_pp1 -> layer_6_expert_sp2_ep10_tp1_pp1
	layer_6_expert_out_sp2_ep10_tp1_pp1 [label="Expert Out L6 SP2 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep10_tp1_pp1 -> layer_6_expert_out_sp2_ep10_tp1_pp1
	layer_6_expert_sp2_ep10_tp2_pp1 [label="Expert L6 SP2 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep10_pp1 -> layer_6_expert_sp2_ep10_tp2_pp1
	layer_6_expert_out_sp2_ep10_tp2_pp1 [label="Expert Out L6 SP2 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep10_tp2_pp1 -> layer_6_expert_out_sp2_ep10_tp2_pp1
	layer_6_expert_sp2_ep10_tp3_pp1 [label="Expert L6 SP2 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep10_pp1 -> layer_6_expert_sp2_ep10_tp3_pp1
	layer_6_expert_out_sp2_ep10_tp3_pp1 [label="Expert Out L6 SP2 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep10_tp3_pp1 -> layer_6_expert_out_sp2_ep10_tp3_pp1
	layer_6_expert_ar_sp2_ep10_pp1 [label="Expert All-Reduce L6 SP2 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep10_tp0_pp1 -> layer_6_expert_ar_sp2_ep10_pp1
	layer_6_expert_out_sp2_ep10_tp1_pp1 -> layer_6_expert_ar_sp2_ep10_pp1
	layer_6_expert_out_sp2_ep10_tp2_pp1 -> layer_6_expert_ar_sp2_ep10_pp1
	layer_6_expert_out_sp2_ep10_tp3_pp1 -> layer_6_expert_ar_sp2_ep10_pp1
	layer_6_combine_sp2_ep10_pp1 [label="Token Combine L6 SP2 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep10_pp1 -> layer_6_combine_sp2_ep10_pp1
	layer_6_dispatch_sp2_ep11_pp1 [label="Token Dispatch L6 SP2 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep11_pp1 [style=dashed]
	layer_6_expert_sp2_ep11_tp0_pp1 [label="Expert L6 SP2 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep11_pp1 -> layer_6_expert_sp2_ep11_tp0_pp1
	layer_6_expert_out_sp2_ep11_tp0_pp1 [label="Expert Out L6 SP2 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep11_tp0_pp1 -> layer_6_expert_out_sp2_ep11_tp0_pp1
	layer_6_expert_sp2_ep11_tp1_pp1 [label="Expert L6 SP2 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep11_pp1 -> layer_6_expert_sp2_ep11_tp1_pp1
	layer_6_expert_out_sp2_ep11_tp1_pp1 [label="Expert Out L6 SP2 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep11_tp1_pp1 -> layer_6_expert_out_sp2_ep11_tp1_pp1
	layer_6_expert_sp2_ep11_tp2_pp1 [label="Expert L6 SP2 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep11_pp1 -> layer_6_expert_sp2_ep11_tp2_pp1
	layer_6_expert_out_sp2_ep11_tp2_pp1 [label="Expert Out L6 SP2 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep11_tp2_pp1 -> layer_6_expert_out_sp2_ep11_tp2_pp1
	layer_6_expert_sp2_ep11_tp3_pp1 [label="Expert L6 SP2 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep11_pp1 -> layer_6_expert_sp2_ep11_tp3_pp1
	layer_6_expert_out_sp2_ep11_tp3_pp1 [label="Expert Out L6 SP2 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep11_tp3_pp1 -> layer_6_expert_out_sp2_ep11_tp3_pp1
	layer_6_expert_ar_sp2_ep11_pp1 [label="Expert All-Reduce L6 SP2 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep11_tp0_pp1 -> layer_6_expert_ar_sp2_ep11_pp1
	layer_6_expert_out_sp2_ep11_tp1_pp1 -> layer_6_expert_ar_sp2_ep11_pp1
	layer_6_expert_out_sp2_ep11_tp2_pp1 -> layer_6_expert_ar_sp2_ep11_pp1
	layer_6_expert_out_sp2_ep11_tp3_pp1 -> layer_6_expert_ar_sp2_ep11_pp1
	layer_6_combine_sp2_ep11_pp1 [label="Token Combine L6 SP2 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep11_pp1 -> layer_6_combine_sp2_ep11_pp1
	layer_6_dispatch_sp2_ep12_pp1 [label="Token Dispatch L6 SP2 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep12_pp1 [style=dashed]
	layer_6_expert_sp2_ep12_tp0_pp1 [label="Expert L6 SP2 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep12_pp1 -> layer_6_expert_sp2_ep12_tp0_pp1
	layer_6_expert_out_sp2_ep12_tp0_pp1 [label="Expert Out L6 SP2 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep12_tp0_pp1 -> layer_6_expert_out_sp2_ep12_tp0_pp1
	layer_6_expert_sp2_ep12_tp1_pp1 [label="Expert L6 SP2 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep12_pp1 -> layer_6_expert_sp2_ep12_tp1_pp1
	layer_6_expert_out_sp2_ep12_tp1_pp1 [label="Expert Out L6 SP2 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep12_tp1_pp1 -> layer_6_expert_out_sp2_ep12_tp1_pp1
	layer_6_expert_sp2_ep12_tp2_pp1 [label="Expert L6 SP2 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep12_pp1 -> layer_6_expert_sp2_ep12_tp2_pp1
	layer_6_expert_out_sp2_ep12_tp2_pp1 [label="Expert Out L6 SP2 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep12_tp2_pp1 -> layer_6_expert_out_sp2_ep12_tp2_pp1
	layer_6_expert_sp2_ep12_tp3_pp1 [label="Expert L6 SP2 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep12_pp1 -> layer_6_expert_sp2_ep12_tp3_pp1
	layer_6_expert_out_sp2_ep12_tp3_pp1 [label="Expert Out L6 SP2 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep12_tp3_pp1 -> layer_6_expert_out_sp2_ep12_tp3_pp1
	layer_6_expert_ar_sp2_ep12_pp1 [label="Expert All-Reduce L6 SP2 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep12_tp0_pp1 -> layer_6_expert_ar_sp2_ep12_pp1
	layer_6_expert_out_sp2_ep12_tp1_pp1 -> layer_6_expert_ar_sp2_ep12_pp1
	layer_6_expert_out_sp2_ep12_tp2_pp1 -> layer_6_expert_ar_sp2_ep12_pp1
	layer_6_expert_out_sp2_ep12_tp3_pp1 -> layer_6_expert_ar_sp2_ep12_pp1
	layer_6_combine_sp2_ep12_pp1 [label="Token Combine L6 SP2 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep12_pp1 -> layer_6_combine_sp2_ep12_pp1
	layer_6_dispatch_sp2_ep13_pp1 [label="Token Dispatch L6 SP2 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep13_pp1 [style=dashed]
	layer_6_expert_sp2_ep13_tp0_pp1 [label="Expert L6 SP2 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep13_pp1 -> layer_6_expert_sp2_ep13_tp0_pp1
	layer_6_expert_out_sp2_ep13_tp0_pp1 [label="Expert Out L6 SP2 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep13_tp0_pp1 -> layer_6_expert_out_sp2_ep13_tp0_pp1
	layer_6_expert_sp2_ep13_tp1_pp1 [label="Expert L6 SP2 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep13_pp1 -> layer_6_expert_sp2_ep13_tp1_pp1
	layer_6_expert_out_sp2_ep13_tp1_pp1 [label="Expert Out L6 SP2 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep13_tp1_pp1 -> layer_6_expert_out_sp2_ep13_tp1_pp1
	layer_6_expert_sp2_ep13_tp2_pp1 [label="Expert L6 SP2 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep13_pp1 -> layer_6_expert_sp2_ep13_tp2_pp1
	layer_6_expert_out_sp2_ep13_tp2_pp1 [label="Expert Out L6 SP2 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep13_tp2_pp1 -> layer_6_expert_out_sp2_ep13_tp2_pp1
	layer_6_expert_sp2_ep13_tp3_pp1 [label="Expert L6 SP2 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep13_pp1 -> layer_6_expert_sp2_ep13_tp3_pp1
	layer_6_expert_out_sp2_ep13_tp3_pp1 [label="Expert Out L6 SP2 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep13_tp3_pp1 -> layer_6_expert_out_sp2_ep13_tp3_pp1
	layer_6_expert_ar_sp2_ep13_pp1 [label="Expert All-Reduce L6 SP2 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep13_tp0_pp1 -> layer_6_expert_ar_sp2_ep13_pp1
	layer_6_expert_out_sp2_ep13_tp1_pp1 -> layer_6_expert_ar_sp2_ep13_pp1
	layer_6_expert_out_sp2_ep13_tp2_pp1 -> layer_6_expert_ar_sp2_ep13_pp1
	layer_6_expert_out_sp2_ep13_tp3_pp1 -> layer_6_expert_ar_sp2_ep13_pp1
	layer_6_combine_sp2_ep13_pp1 [label="Token Combine L6 SP2 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep13_pp1 -> layer_6_combine_sp2_ep13_pp1
	layer_6_dispatch_sp2_ep14_pp1 [label="Token Dispatch L6 SP2 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep14_pp1 [style=dashed]
	layer_6_expert_sp2_ep14_tp0_pp1 [label="Expert L6 SP2 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep14_pp1 -> layer_6_expert_sp2_ep14_tp0_pp1
	layer_6_expert_out_sp2_ep14_tp0_pp1 [label="Expert Out L6 SP2 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep14_tp0_pp1 -> layer_6_expert_out_sp2_ep14_tp0_pp1
	layer_6_expert_sp2_ep14_tp1_pp1 [label="Expert L6 SP2 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep14_pp1 -> layer_6_expert_sp2_ep14_tp1_pp1
	layer_6_expert_out_sp2_ep14_tp1_pp1 [label="Expert Out L6 SP2 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep14_tp1_pp1 -> layer_6_expert_out_sp2_ep14_tp1_pp1
	layer_6_expert_sp2_ep14_tp2_pp1 [label="Expert L6 SP2 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep14_pp1 -> layer_6_expert_sp2_ep14_tp2_pp1
	layer_6_expert_out_sp2_ep14_tp2_pp1 [label="Expert Out L6 SP2 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep14_tp2_pp1 -> layer_6_expert_out_sp2_ep14_tp2_pp1
	layer_6_expert_sp2_ep14_tp3_pp1 [label="Expert L6 SP2 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep14_pp1 -> layer_6_expert_sp2_ep14_tp3_pp1
	layer_6_expert_out_sp2_ep14_tp3_pp1 [label="Expert Out L6 SP2 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep14_tp3_pp1 -> layer_6_expert_out_sp2_ep14_tp3_pp1
	layer_6_expert_ar_sp2_ep14_pp1 [label="Expert All-Reduce L6 SP2 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep14_tp0_pp1 -> layer_6_expert_ar_sp2_ep14_pp1
	layer_6_expert_out_sp2_ep14_tp1_pp1 -> layer_6_expert_ar_sp2_ep14_pp1
	layer_6_expert_out_sp2_ep14_tp2_pp1 -> layer_6_expert_ar_sp2_ep14_pp1
	layer_6_expert_out_sp2_ep14_tp3_pp1 -> layer_6_expert_ar_sp2_ep14_pp1
	layer_6_combine_sp2_ep14_pp1 [label="Token Combine L6 SP2 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep14_pp1 -> layer_6_combine_sp2_ep14_pp1
	layer_6_dispatch_sp2_ep15_pp1 [label="Token Dispatch L6 SP2 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp2_pp1 -> layer_6_dispatch_sp2_ep15_pp1 [style=dashed]
	layer_6_expert_sp2_ep15_tp0_pp1 [label="Expert L6 SP2 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep15_pp1 -> layer_6_expert_sp2_ep15_tp0_pp1
	layer_6_expert_out_sp2_ep15_tp0_pp1 [label="Expert Out L6 SP2 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep15_tp0_pp1 -> layer_6_expert_out_sp2_ep15_tp0_pp1
	layer_6_expert_sp2_ep15_tp1_pp1 [label="Expert L6 SP2 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep15_pp1 -> layer_6_expert_sp2_ep15_tp1_pp1
	layer_6_expert_out_sp2_ep15_tp1_pp1 [label="Expert Out L6 SP2 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep15_tp1_pp1 -> layer_6_expert_out_sp2_ep15_tp1_pp1
	layer_6_expert_sp2_ep15_tp2_pp1 [label="Expert L6 SP2 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep15_pp1 -> layer_6_expert_sp2_ep15_tp2_pp1
	layer_6_expert_out_sp2_ep15_tp2_pp1 [label="Expert Out L6 SP2 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep15_tp2_pp1 -> layer_6_expert_out_sp2_ep15_tp2_pp1
	layer_6_expert_sp2_ep15_tp3_pp1 [label="Expert L6 SP2 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp2_ep15_pp1 -> layer_6_expert_sp2_ep15_tp3_pp1
	layer_6_expert_out_sp2_ep15_tp3_pp1 [label="Expert Out L6 SP2 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp2_ep15_tp3_pp1 -> layer_6_expert_out_sp2_ep15_tp3_pp1
	layer_6_expert_ar_sp2_ep15_pp1 [label="Expert All-Reduce L6 SP2 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp2_ep15_tp0_pp1 -> layer_6_expert_ar_sp2_ep15_pp1
	layer_6_expert_out_sp2_ep15_tp1_pp1 -> layer_6_expert_ar_sp2_ep15_pp1
	layer_6_expert_out_sp2_ep15_tp2_pp1 -> layer_6_expert_ar_sp2_ep15_pp1
	layer_6_expert_out_sp2_ep15_tp3_pp1 -> layer_6_expert_ar_sp2_ep15_pp1
	layer_6_combine_sp2_ep15_pp1 [label="Token Combine L6 SP2 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp2_ep15_pp1 -> layer_6_combine_sp2_ep15_pp1
	layer_6_moe_all2all_sp2_pp1 [label="MoE All-to-All L6 SP2\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_6_combine_sp2_ep0_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep1_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep2_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep3_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep4_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep5_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep6_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep7_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep8_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep9_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep10_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep11_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep12_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep13_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep14_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_combine_sp2_ep15_pp1 -> layer_6_moe_all2all_sp2_pp1
	layer_6_mlp_out_sp2_pp1 [label="MoE Output L6 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_moe_all2all_sp2_pp1 -> layer_6_mlp_out_sp2_pp1
	layer_6_mlp_res_sp2_pp1 [label="MLP Residual L6 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_mlp_out_sp2_pp1 -> layer_6_mlp_res_sp2_pp1
	layer_6_attn_res_sp2_pp1 -> layer_6_mlp_res_sp2_pp1 [style=dashed]
	layer_6_norm_sp3_pp1 [label="LayerNorm L6 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_5_mlp_out_sp3_pp1 -> layer_6_norm_sp3_pp1
	layer_6_qkv_sp3_tp0_pp1 [label="QKV Proj L6 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp3_pp1 -> layer_6_qkv_sp3_tp0_pp1
	layer_6_attn_sp3_tp0_pp1 [label="Attention L6 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp3_tp0_pp1 -> layer_6_attn_sp3_tp0_pp1
	layer_6_attn_out_sp3_tp0_pp1 [label="Attn Out Proj L6 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp3_tp0_pp1 -> layer_6_attn_out_sp3_tp0_pp1
	layer_6_qkv_sp3_tp1_pp1 [label="QKV Proj L6 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp3_pp1 -> layer_6_qkv_sp3_tp1_pp1
	layer_6_attn_sp3_tp1_pp1 [label="Attention L6 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp3_tp1_pp1 -> layer_6_attn_sp3_tp1_pp1
	layer_6_attn_out_sp3_tp1_pp1 [label="Attn Out Proj L6 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp3_tp1_pp1 -> layer_6_attn_out_sp3_tp1_pp1
	layer_6_qkv_sp3_tp2_pp1 [label="QKV Proj L6 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp3_pp1 -> layer_6_qkv_sp3_tp2_pp1
	layer_6_attn_sp3_tp2_pp1 [label="Attention L6 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp3_tp2_pp1 -> layer_6_attn_sp3_tp2_pp1
	layer_6_attn_out_sp3_tp2_pp1 [label="Attn Out Proj L6 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp3_tp2_pp1 -> layer_6_attn_out_sp3_tp2_pp1
	layer_6_qkv_sp3_tp3_pp1 [label="QKV Proj L6 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_norm_sp3_pp1 -> layer_6_qkv_sp3_tp3_pp1
	layer_6_attn_sp3_tp3_pp1 [label="Attention L6 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_qkv_sp3_tp3_pp1 -> layer_6_attn_sp3_tp3_pp1
	layer_6_attn_out_sp3_tp3_pp1 [label="Attn Out Proj L6 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_6_attn_sp3_tp3_pp1 -> layer_6_attn_out_sp3_tp3_pp1
	layer_6_attn_ar_sp3_pp1 [label="Attention All-Reduce L6 SP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_attn_out_sp3_tp0_pp1 -> layer_6_attn_ar_sp3_pp1
	layer_6_attn_out_sp3_tp1_pp1 -> layer_6_attn_ar_sp3_pp1
	layer_6_attn_out_sp3_tp2_pp1 -> layer_6_attn_ar_sp3_pp1
	layer_6_attn_out_sp3_tp3_pp1 -> layer_6_attn_ar_sp3_pp1
	layer_6_attn_res_sp3_pp1 [label="Attention Residual L6 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_attn_ar_sp3_pp1 -> layer_6_attn_res_sp3_pp1
	layer_6_norm_sp3_pp1 -> layer_6_attn_res_sp3_pp1 [style=dashed]
	layer_6_post_norm_sp3_pp1 [label="Post-Attn Norm L6 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_attn_res_sp3_pp1 -> layer_6_post_norm_sp3_pp1
	layer_6_router_sp3_pp1 [label="MoE Router L6 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_6_post_norm_sp3_pp1 -> layer_6_router_sp3_pp1
	layer_6_dispatch_sp3_ep0_pp1 [label="Token Dispatch L6 SP3 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep0_pp1 [style=dashed]
	layer_6_expert_sp3_ep0_tp0_pp1 [label="Expert L6 SP3 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep0_pp1 -> layer_6_expert_sp3_ep0_tp0_pp1
	layer_6_expert_out_sp3_ep0_tp0_pp1 [label="Expert Out L6 SP3 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep0_tp0_pp1 -> layer_6_expert_out_sp3_ep0_tp0_pp1
	layer_6_expert_sp3_ep0_tp1_pp1 [label="Expert L6 SP3 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep0_pp1 -> layer_6_expert_sp3_ep0_tp1_pp1
	layer_6_expert_out_sp3_ep0_tp1_pp1 [label="Expert Out L6 SP3 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep0_tp1_pp1 -> layer_6_expert_out_sp3_ep0_tp1_pp1
	layer_6_expert_sp3_ep0_tp2_pp1 [label="Expert L6 SP3 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep0_pp1 -> layer_6_expert_sp3_ep0_tp2_pp1
	layer_6_expert_out_sp3_ep0_tp2_pp1 [label="Expert Out L6 SP3 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep0_tp2_pp1 -> layer_6_expert_out_sp3_ep0_tp2_pp1
	layer_6_expert_sp3_ep0_tp3_pp1 [label="Expert L6 SP3 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep0_pp1 -> layer_6_expert_sp3_ep0_tp3_pp1
	layer_6_expert_out_sp3_ep0_tp3_pp1 [label="Expert Out L6 SP3 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep0_tp3_pp1 -> layer_6_expert_out_sp3_ep0_tp3_pp1
	layer_6_expert_ar_sp3_ep0_pp1 [label="Expert All-Reduce L6 SP3 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep0_tp0_pp1 -> layer_6_expert_ar_sp3_ep0_pp1
	layer_6_expert_out_sp3_ep0_tp1_pp1 -> layer_6_expert_ar_sp3_ep0_pp1
	layer_6_expert_out_sp3_ep0_tp2_pp1 -> layer_6_expert_ar_sp3_ep0_pp1
	layer_6_expert_out_sp3_ep0_tp3_pp1 -> layer_6_expert_ar_sp3_ep0_pp1
	layer_6_combine_sp3_ep0_pp1 [label="Token Combine L6 SP3 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep0_pp1 -> layer_6_combine_sp3_ep0_pp1
	layer_6_dispatch_sp3_ep1_pp1 [label="Token Dispatch L6 SP3 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep1_pp1 [style=dashed]
	layer_6_expert_sp3_ep1_tp0_pp1 [label="Expert L6 SP3 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep1_pp1 -> layer_6_expert_sp3_ep1_tp0_pp1
	layer_6_expert_out_sp3_ep1_tp0_pp1 [label="Expert Out L6 SP3 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep1_tp0_pp1 -> layer_6_expert_out_sp3_ep1_tp0_pp1
	layer_6_expert_sp3_ep1_tp1_pp1 [label="Expert L6 SP3 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep1_pp1 -> layer_6_expert_sp3_ep1_tp1_pp1
	layer_6_expert_out_sp3_ep1_tp1_pp1 [label="Expert Out L6 SP3 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep1_tp1_pp1 -> layer_6_expert_out_sp3_ep1_tp1_pp1
	layer_6_expert_sp3_ep1_tp2_pp1 [label="Expert L6 SP3 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep1_pp1 -> layer_6_expert_sp3_ep1_tp2_pp1
	layer_6_expert_out_sp3_ep1_tp2_pp1 [label="Expert Out L6 SP3 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep1_tp2_pp1 -> layer_6_expert_out_sp3_ep1_tp2_pp1
	layer_6_expert_sp3_ep1_tp3_pp1 [label="Expert L6 SP3 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep1_pp1 -> layer_6_expert_sp3_ep1_tp3_pp1
	layer_6_expert_out_sp3_ep1_tp3_pp1 [label="Expert Out L6 SP3 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep1_tp3_pp1 -> layer_6_expert_out_sp3_ep1_tp3_pp1
	layer_6_expert_ar_sp3_ep1_pp1 [label="Expert All-Reduce L6 SP3 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep1_tp0_pp1 -> layer_6_expert_ar_sp3_ep1_pp1
	layer_6_expert_out_sp3_ep1_tp1_pp1 -> layer_6_expert_ar_sp3_ep1_pp1
	layer_6_expert_out_sp3_ep1_tp2_pp1 -> layer_6_expert_ar_sp3_ep1_pp1
	layer_6_expert_out_sp3_ep1_tp3_pp1 -> layer_6_expert_ar_sp3_ep1_pp1
	layer_6_combine_sp3_ep1_pp1 [label="Token Combine L6 SP3 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep1_pp1 -> layer_6_combine_sp3_ep1_pp1
	layer_6_dispatch_sp3_ep2_pp1 [label="Token Dispatch L6 SP3 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep2_pp1 [style=dashed]
	layer_6_expert_sp3_ep2_tp0_pp1 [label="Expert L6 SP3 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep2_pp1 -> layer_6_expert_sp3_ep2_tp0_pp1
	layer_6_expert_out_sp3_ep2_tp0_pp1 [label="Expert Out L6 SP3 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep2_tp0_pp1 -> layer_6_expert_out_sp3_ep2_tp0_pp1
	layer_6_expert_sp3_ep2_tp1_pp1 [label="Expert L6 SP3 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep2_pp1 -> layer_6_expert_sp3_ep2_tp1_pp1
	layer_6_expert_out_sp3_ep2_tp1_pp1 [label="Expert Out L6 SP3 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep2_tp1_pp1 -> layer_6_expert_out_sp3_ep2_tp1_pp1
	layer_6_expert_sp3_ep2_tp2_pp1 [label="Expert L6 SP3 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep2_pp1 -> layer_6_expert_sp3_ep2_tp2_pp1
	layer_6_expert_out_sp3_ep2_tp2_pp1 [label="Expert Out L6 SP3 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep2_tp2_pp1 -> layer_6_expert_out_sp3_ep2_tp2_pp1
	layer_6_expert_sp3_ep2_tp3_pp1 [label="Expert L6 SP3 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep2_pp1 -> layer_6_expert_sp3_ep2_tp3_pp1
	layer_6_expert_out_sp3_ep2_tp3_pp1 [label="Expert Out L6 SP3 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep2_tp3_pp1 -> layer_6_expert_out_sp3_ep2_tp3_pp1
	layer_6_expert_ar_sp3_ep2_pp1 [label="Expert All-Reduce L6 SP3 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep2_tp0_pp1 -> layer_6_expert_ar_sp3_ep2_pp1
	layer_6_expert_out_sp3_ep2_tp1_pp1 -> layer_6_expert_ar_sp3_ep2_pp1
	layer_6_expert_out_sp3_ep2_tp2_pp1 -> layer_6_expert_ar_sp3_ep2_pp1
	layer_6_expert_out_sp3_ep2_tp3_pp1 -> layer_6_expert_ar_sp3_ep2_pp1
	layer_6_combine_sp3_ep2_pp1 [label="Token Combine L6 SP3 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep2_pp1 -> layer_6_combine_sp3_ep2_pp1
	layer_6_dispatch_sp3_ep3_pp1 [label="Token Dispatch L6 SP3 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep3_pp1 [style=dashed]
	layer_6_expert_sp3_ep3_tp0_pp1 [label="Expert L6 SP3 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep3_pp1 -> layer_6_expert_sp3_ep3_tp0_pp1
	layer_6_expert_out_sp3_ep3_tp0_pp1 [label="Expert Out L6 SP3 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep3_tp0_pp1 -> layer_6_expert_out_sp3_ep3_tp0_pp1
	layer_6_expert_sp3_ep3_tp1_pp1 [label="Expert L6 SP3 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep3_pp1 -> layer_6_expert_sp3_ep3_tp1_pp1
	layer_6_expert_out_sp3_ep3_tp1_pp1 [label="Expert Out L6 SP3 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep3_tp1_pp1 -> layer_6_expert_out_sp3_ep3_tp1_pp1
	layer_6_expert_sp3_ep3_tp2_pp1 [label="Expert L6 SP3 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep3_pp1 -> layer_6_expert_sp3_ep3_tp2_pp1
	layer_6_expert_out_sp3_ep3_tp2_pp1 [label="Expert Out L6 SP3 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep3_tp2_pp1 -> layer_6_expert_out_sp3_ep3_tp2_pp1
	layer_6_expert_sp3_ep3_tp3_pp1 [label="Expert L6 SP3 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep3_pp1 -> layer_6_expert_sp3_ep3_tp3_pp1
	layer_6_expert_out_sp3_ep3_tp3_pp1 [label="Expert Out L6 SP3 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep3_tp3_pp1 -> layer_6_expert_out_sp3_ep3_tp3_pp1
	layer_6_expert_ar_sp3_ep3_pp1 [label="Expert All-Reduce L6 SP3 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep3_tp0_pp1 -> layer_6_expert_ar_sp3_ep3_pp1
	layer_6_expert_out_sp3_ep3_tp1_pp1 -> layer_6_expert_ar_sp3_ep3_pp1
	layer_6_expert_out_sp3_ep3_tp2_pp1 -> layer_6_expert_ar_sp3_ep3_pp1
	layer_6_expert_out_sp3_ep3_tp3_pp1 -> layer_6_expert_ar_sp3_ep3_pp1
	layer_6_combine_sp3_ep3_pp1 [label="Token Combine L6 SP3 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep3_pp1 -> layer_6_combine_sp3_ep3_pp1
	layer_6_dispatch_sp3_ep4_pp1 [label="Token Dispatch L6 SP3 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep4_pp1 [style=dashed]
	layer_6_expert_sp3_ep4_tp0_pp1 [label="Expert L6 SP3 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep4_pp1 -> layer_6_expert_sp3_ep4_tp0_pp1
	layer_6_expert_out_sp3_ep4_tp0_pp1 [label="Expert Out L6 SP3 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep4_tp0_pp1 -> layer_6_expert_out_sp3_ep4_tp0_pp1
	layer_6_expert_sp3_ep4_tp1_pp1 [label="Expert L6 SP3 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep4_pp1 -> layer_6_expert_sp3_ep4_tp1_pp1
	layer_6_expert_out_sp3_ep4_tp1_pp1 [label="Expert Out L6 SP3 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep4_tp1_pp1 -> layer_6_expert_out_sp3_ep4_tp1_pp1
	layer_6_expert_sp3_ep4_tp2_pp1 [label="Expert L6 SP3 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep4_pp1 -> layer_6_expert_sp3_ep4_tp2_pp1
	layer_6_expert_out_sp3_ep4_tp2_pp1 [label="Expert Out L6 SP3 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep4_tp2_pp1 -> layer_6_expert_out_sp3_ep4_tp2_pp1
	layer_6_expert_sp3_ep4_tp3_pp1 [label="Expert L6 SP3 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep4_pp1 -> layer_6_expert_sp3_ep4_tp3_pp1
	layer_6_expert_out_sp3_ep4_tp3_pp1 [label="Expert Out L6 SP3 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep4_tp3_pp1 -> layer_6_expert_out_sp3_ep4_tp3_pp1
	layer_6_expert_ar_sp3_ep4_pp1 [label="Expert All-Reduce L6 SP3 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep4_tp0_pp1 -> layer_6_expert_ar_sp3_ep4_pp1
	layer_6_expert_out_sp3_ep4_tp1_pp1 -> layer_6_expert_ar_sp3_ep4_pp1
	layer_6_expert_out_sp3_ep4_tp2_pp1 -> layer_6_expert_ar_sp3_ep4_pp1
	layer_6_expert_out_sp3_ep4_tp3_pp1 -> layer_6_expert_ar_sp3_ep4_pp1
	layer_6_combine_sp3_ep4_pp1 [label="Token Combine L6 SP3 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep4_pp1 -> layer_6_combine_sp3_ep4_pp1
	layer_6_dispatch_sp3_ep5_pp1 [label="Token Dispatch L6 SP3 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep5_pp1 [style=dashed]
	layer_6_expert_sp3_ep5_tp0_pp1 [label="Expert L6 SP3 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep5_pp1 -> layer_6_expert_sp3_ep5_tp0_pp1
	layer_6_expert_out_sp3_ep5_tp0_pp1 [label="Expert Out L6 SP3 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep5_tp0_pp1 -> layer_6_expert_out_sp3_ep5_tp0_pp1
	layer_6_expert_sp3_ep5_tp1_pp1 [label="Expert L6 SP3 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep5_pp1 -> layer_6_expert_sp3_ep5_tp1_pp1
	layer_6_expert_out_sp3_ep5_tp1_pp1 [label="Expert Out L6 SP3 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep5_tp1_pp1 -> layer_6_expert_out_sp3_ep5_tp1_pp1
	layer_6_expert_sp3_ep5_tp2_pp1 [label="Expert L6 SP3 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep5_pp1 -> layer_6_expert_sp3_ep5_tp2_pp1
	layer_6_expert_out_sp3_ep5_tp2_pp1 [label="Expert Out L6 SP3 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep5_tp2_pp1 -> layer_6_expert_out_sp3_ep5_tp2_pp1
	layer_6_expert_sp3_ep5_tp3_pp1 [label="Expert L6 SP3 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep5_pp1 -> layer_6_expert_sp3_ep5_tp3_pp1
	layer_6_expert_out_sp3_ep5_tp3_pp1 [label="Expert Out L6 SP3 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep5_tp3_pp1 -> layer_6_expert_out_sp3_ep5_tp3_pp1
	layer_6_expert_ar_sp3_ep5_pp1 [label="Expert All-Reduce L6 SP3 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep5_tp0_pp1 -> layer_6_expert_ar_sp3_ep5_pp1
	layer_6_expert_out_sp3_ep5_tp1_pp1 -> layer_6_expert_ar_sp3_ep5_pp1
	layer_6_expert_out_sp3_ep5_tp2_pp1 -> layer_6_expert_ar_sp3_ep5_pp1
	layer_6_expert_out_sp3_ep5_tp3_pp1 -> layer_6_expert_ar_sp3_ep5_pp1
	layer_6_combine_sp3_ep5_pp1 [label="Token Combine L6 SP3 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep5_pp1 -> layer_6_combine_sp3_ep5_pp1
	layer_6_dispatch_sp3_ep6_pp1 [label="Token Dispatch L6 SP3 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep6_pp1 [style=dashed]
	layer_6_expert_sp3_ep6_tp0_pp1 [label="Expert L6 SP3 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep6_pp1 -> layer_6_expert_sp3_ep6_tp0_pp1
	layer_6_expert_out_sp3_ep6_tp0_pp1 [label="Expert Out L6 SP3 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep6_tp0_pp1 -> layer_6_expert_out_sp3_ep6_tp0_pp1
	layer_6_expert_sp3_ep6_tp1_pp1 [label="Expert L6 SP3 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep6_pp1 -> layer_6_expert_sp3_ep6_tp1_pp1
	layer_6_expert_out_sp3_ep6_tp1_pp1 [label="Expert Out L6 SP3 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep6_tp1_pp1 -> layer_6_expert_out_sp3_ep6_tp1_pp1
	layer_6_expert_sp3_ep6_tp2_pp1 [label="Expert L6 SP3 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep6_pp1 -> layer_6_expert_sp3_ep6_tp2_pp1
	layer_6_expert_out_sp3_ep6_tp2_pp1 [label="Expert Out L6 SP3 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep6_tp2_pp1 -> layer_6_expert_out_sp3_ep6_tp2_pp1
	layer_6_expert_sp3_ep6_tp3_pp1 [label="Expert L6 SP3 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep6_pp1 -> layer_6_expert_sp3_ep6_tp3_pp1
	layer_6_expert_out_sp3_ep6_tp3_pp1 [label="Expert Out L6 SP3 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep6_tp3_pp1 -> layer_6_expert_out_sp3_ep6_tp3_pp1
	layer_6_expert_ar_sp3_ep6_pp1 [label="Expert All-Reduce L6 SP3 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep6_tp0_pp1 -> layer_6_expert_ar_sp3_ep6_pp1
	layer_6_expert_out_sp3_ep6_tp1_pp1 -> layer_6_expert_ar_sp3_ep6_pp1
	layer_6_expert_out_sp3_ep6_tp2_pp1 -> layer_6_expert_ar_sp3_ep6_pp1
	layer_6_expert_out_sp3_ep6_tp3_pp1 -> layer_6_expert_ar_sp3_ep6_pp1
	layer_6_combine_sp3_ep6_pp1 [label="Token Combine L6 SP3 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep6_pp1 -> layer_6_combine_sp3_ep6_pp1
	layer_6_dispatch_sp3_ep7_pp1 [label="Token Dispatch L6 SP3 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep7_pp1 [style=dashed]
	layer_6_expert_sp3_ep7_tp0_pp1 [label="Expert L6 SP3 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep7_pp1 -> layer_6_expert_sp3_ep7_tp0_pp1
	layer_6_expert_out_sp3_ep7_tp0_pp1 [label="Expert Out L6 SP3 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep7_tp0_pp1 -> layer_6_expert_out_sp3_ep7_tp0_pp1
	layer_6_expert_sp3_ep7_tp1_pp1 [label="Expert L6 SP3 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep7_pp1 -> layer_6_expert_sp3_ep7_tp1_pp1
	layer_6_expert_out_sp3_ep7_tp1_pp1 [label="Expert Out L6 SP3 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep7_tp1_pp1 -> layer_6_expert_out_sp3_ep7_tp1_pp1
	layer_6_expert_sp3_ep7_tp2_pp1 [label="Expert L6 SP3 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep7_pp1 -> layer_6_expert_sp3_ep7_tp2_pp1
	layer_6_expert_out_sp3_ep7_tp2_pp1 [label="Expert Out L6 SP3 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep7_tp2_pp1 -> layer_6_expert_out_sp3_ep7_tp2_pp1
	layer_6_expert_sp3_ep7_tp3_pp1 [label="Expert L6 SP3 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep7_pp1 -> layer_6_expert_sp3_ep7_tp3_pp1
	layer_6_expert_out_sp3_ep7_tp3_pp1 [label="Expert Out L6 SP3 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep7_tp3_pp1 -> layer_6_expert_out_sp3_ep7_tp3_pp1
	layer_6_expert_ar_sp3_ep7_pp1 [label="Expert All-Reduce L6 SP3 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep7_tp0_pp1 -> layer_6_expert_ar_sp3_ep7_pp1
	layer_6_expert_out_sp3_ep7_tp1_pp1 -> layer_6_expert_ar_sp3_ep7_pp1
	layer_6_expert_out_sp3_ep7_tp2_pp1 -> layer_6_expert_ar_sp3_ep7_pp1
	layer_6_expert_out_sp3_ep7_tp3_pp1 -> layer_6_expert_ar_sp3_ep7_pp1
	layer_6_combine_sp3_ep7_pp1 [label="Token Combine L6 SP3 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep7_pp1 -> layer_6_combine_sp3_ep7_pp1
	layer_6_dispatch_sp3_ep8_pp1 [label="Token Dispatch L6 SP3 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep8_pp1 [style=dashed]
	layer_6_expert_sp3_ep8_tp0_pp1 [label="Expert L6 SP3 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep8_pp1 -> layer_6_expert_sp3_ep8_tp0_pp1
	layer_6_expert_out_sp3_ep8_tp0_pp1 [label="Expert Out L6 SP3 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep8_tp0_pp1 -> layer_6_expert_out_sp3_ep8_tp0_pp1
	layer_6_expert_sp3_ep8_tp1_pp1 [label="Expert L6 SP3 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep8_pp1 -> layer_6_expert_sp3_ep8_tp1_pp1
	layer_6_expert_out_sp3_ep8_tp1_pp1 [label="Expert Out L6 SP3 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep8_tp1_pp1 -> layer_6_expert_out_sp3_ep8_tp1_pp1
	layer_6_expert_sp3_ep8_tp2_pp1 [label="Expert L6 SP3 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep8_pp1 -> layer_6_expert_sp3_ep8_tp2_pp1
	layer_6_expert_out_sp3_ep8_tp2_pp1 [label="Expert Out L6 SP3 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep8_tp2_pp1 -> layer_6_expert_out_sp3_ep8_tp2_pp1
	layer_6_expert_sp3_ep8_tp3_pp1 [label="Expert L6 SP3 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep8_pp1 -> layer_6_expert_sp3_ep8_tp3_pp1
	layer_6_expert_out_sp3_ep8_tp3_pp1 [label="Expert Out L6 SP3 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep8_tp3_pp1 -> layer_6_expert_out_sp3_ep8_tp3_pp1
	layer_6_expert_ar_sp3_ep8_pp1 [label="Expert All-Reduce L6 SP3 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep8_tp0_pp1 -> layer_6_expert_ar_sp3_ep8_pp1
	layer_6_expert_out_sp3_ep8_tp1_pp1 -> layer_6_expert_ar_sp3_ep8_pp1
	layer_6_expert_out_sp3_ep8_tp2_pp1 -> layer_6_expert_ar_sp3_ep8_pp1
	layer_6_expert_out_sp3_ep8_tp3_pp1 -> layer_6_expert_ar_sp3_ep8_pp1
	layer_6_combine_sp3_ep8_pp1 [label="Token Combine L6 SP3 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep8_pp1 -> layer_6_combine_sp3_ep8_pp1
	layer_6_dispatch_sp3_ep9_pp1 [label="Token Dispatch L6 SP3 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep9_pp1 [style=dashed]
	layer_6_expert_sp3_ep9_tp0_pp1 [label="Expert L6 SP3 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep9_pp1 -> layer_6_expert_sp3_ep9_tp0_pp1
	layer_6_expert_out_sp3_ep9_tp0_pp1 [label="Expert Out L6 SP3 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep9_tp0_pp1 -> layer_6_expert_out_sp3_ep9_tp0_pp1
	layer_6_expert_sp3_ep9_tp1_pp1 [label="Expert L6 SP3 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep9_pp1 -> layer_6_expert_sp3_ep9_tp1_pp1
	layer_6_expert_out_sp3_ep9_tp1_pp1 [label="Expert Out L6 SP3 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep9_tp1_pp1 -> layer_6_expert_out_sp3_ep9_tp1_pp1
	layer_6_expert_sp3_ep9_tp2_pp1 [label="Expert L6 SP3 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep9_pp1 -> layer_6_expert_sp3_ep9_tp2_pp1
	layer_6_expert_out_sp3_ep9_tp2_pp1 [label="Expert Out L6 SP3 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep9_tp2_pp1 -> layer_6_expert_out_sp3_ep9_tp2_pp1
	layer_6_expert_sp3_ep9_tp3_pp1 [label="Expert L6 SP3 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep9_pp1 -> layer_6_expert_sp3_ep9_tp3_pp1
	layer_6_expert_out_sp3_ep9_tp3_pp1 [label="Expert Out L6 SP3 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep9_tp3_pp1 -> layer_6_expert_out_sp3_ep9_tp3_pp1
	layer_6_expert_ar_sp3_ep9_pp1 [label="Expert All-Reduce L6 SP3 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep9_tp0_pp1 -> layer_6_expert_ar_sp3_ep9_pp1
	layer_6_expert_out_sp3_ep9_tp1_pp1 -> layer_6_expert_ar_sp3_ep9_pp1
	layer_6_expert_out_sp3_ep9_tp2_pp1 -> layer_6_expert_ar_sp3_ep9_pp1
	layer_6_expert_out_sp3_ep9_tp3_pp1 -> layer_6_expert_ar_sp3_ep9_pp1
	layer_6_combine_sp3_ep9_pp1 [label="Token Combine L6 SP3 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep9_pp1 -> layer_6_combine_sp3_ep9_pp1
	layer_6_dispatch_sp3_ep10_pp1 [label="Token Dispatch L6 SP3 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep10_pp1 [style=dashed]
	layer_6_expert_sp3_ep10_tp0_pp1 [label="Expert L6 SP3 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep10_pp1 -> layer_6_expert_sp3_ep10_tp0_pp1
	layer_6_expert_out_sp3_ep10_tp0_pp1 [label="Expert Out L6 SP3 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep10_tp0_pp1 -> layer_6_expert_out_sp3_ep10_tp0_pp1
	layer_6_expert_sp3_ep10_tp1_pp1 [label="Expert L6 SP3 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep10_pp1 -> layer_6_expert_sp3_ep10_tp1_pp1
	layer_6_expert_out_sp3_ep10_tp1_pp1 [label="Expert Out L6 SP3 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep10_tp1_pp1 -> layer_6_expert_out_sp3_ep10_tp1_pp1
	layer_6_expert_sp3_ep10_tp2_pp1 [label="Expert L6 SP3 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep10_pp1 -> layer_6_expert_sp3_ep10_tp2_pp1
	layer_6_expert_out_sp3_ep10_tp2_pp1 [label="Expert Out L6 SP3 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep10_tp2_pp1 -> layer_6_expert_out_sp3_ep10_tp2_pp1
	layer_6_expert_sp3_ep10_tp3_pp1 [label="Expert L6 SP3 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep10_pp1 -> layer_6_expert_sp3_ep10_tp3_pp1
	layer_6_expert_out_sp3_ep10_tp3_pp1 [label="Expert Out L6 SP3 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep10_tp3_pp1 -> layer_6_expert_out_sp3_ep10_tp3_pp1
	layer_6_expert_ar_sp3_ep10_pp1 [label="Expert All-Reduce L6 SP3 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep10_tp0_pp1 -> layer_6_expert_ar_sp3_ep10_pp1
	layer_6_expert_out_sp3_ep10_tp1_pp1 -> layer_6_expert_ar_sp3_ep10_pp1
	layer_6_expert_out_sp3_ep10_tp2_pp1 -> layer_6_expert_ar_sp3_ep10_pp1
	layer_6_expert_out_sp3_ep10_tp3_pp1 -> layer_6_expert_ar_sp3_ep10_pp1
	layer_6_combine_sp3_ep10_pp1 [label="Token Combine L6 SP3 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep10_pp1 -> layer_6_combine_sp3_ep10_pp1
	layer_6_dispatch_sp3_ep11_pp1 [label="Token Dispatch L6 SP3 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep11_pp1 [style=dashed]
	layer_6_expert_sp3_ep11_tp0_pp1 [label="Expert L6 SP3 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep11_pp1 -> layer_6_expert_sp3_ep11_tp0_pp1
	layer_6_expert_out_sp3_ep11_tp0_pp1 [label="Expert Out L6 SP3 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep11_tp0_pp1 -> layer_6_expert_out_sp3_ep11_tp0_pp1
	layer_6_expert_sp3_ep11_tp1_pp1 [label="Expert L6 SP3 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep11_pp1 -> layer_6_expert_sp3_ep11_tp1_pp1
	layer_6_expert_out_sp3_ep11_tp1_pp1 [label="Expert Out L6 SP3 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep11_tp1_pp1 -> layer_6_expert_out_sp3_ep11_tp1_pp1
	layer_6_expert_sp3_ep11_tp2_pp1 [label="Expert L6 SP3 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep11_pp1 -> layer_6_expert_sp3_ep11_tp2_pp1
	layer_6_expert_out_sp3_ep11_tp2_pp1 [label="Expert Out L6 SP3 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep11_tp2_pp1 -> layer_6_expert_out_sp3_ep11_tp2_pp1
	layer_6_expert_sp3_ep11_tp3_pp1 [label="Expert L6 SP3 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep11_pp1 -> layer_6_expert_sp3_ep11_tp3_pp1
	layer_6_expert_out_sp3_ep11_tp3_pp1 [label="Expert Out L6 SP3 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep11_tp3_pp1 -> layer_6_expert_out_sp3_ep11_tp3_pp1
	layer_6_expert_ar_sp3_ep11_pp1 [label="Expert All-Reduce L6 SP3 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep11_tp0_pp1 -> layer_6_expert_ar_sp3_ep11_pp1
	layer_6_expert_out_sp3_ep11_tp1_pp1 -> layer_6_expert_ar_sp3_ep11_pp1
	layer_6_expert_out_sp3_ep11_tp2_pp1 -> layer_6_expert_ar_sp3_ep11_pp1
	layer_6_expert_out_sp3_ep11_tp3_pp1 -> layer_6_expert_ar_sp3_ep11_pp1
	layer_6_combine_sp3_ep11_pp1 [label="Token Combine L6 SP3 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep11_pp1 -> layer_6_combine_sp3_ep11_pp1
	layer_6_dispatch_sp3_ep12_pp1 [label="Token Dispatch L6 SP3 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep12_pp1 [style=dashed]
	layer_6_expert_sp3_ep12_tp0_pp1 [label="Expert L6 SP3 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep12_pp1 -> layer_6_expert_sp3_ep12_tp0_pp1
	layer_6_expert_out_sp3_ep12_tp0_pp1 [label="Expert Out L6 SP3 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep12_tp0_pp1 -> layer_6_expert_out_sp3_ep12_tp0_pp1
	layer_6_expert_sp3_ep12_tp1_pp1 [label="Expert L6 SP3 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep12_pp1 -> layer_6_expert_sp3_ep12_tp1_pp1
	layer_6_expert_out_sp3_ep12_tp1_pp1 [label="Expert Out L6 SP3 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep12_tp1_pp1 -> layer_6_expert_out_sp3_ep12_tp1_pp1
	layer_6_expert_sp3_ep12_tp2_pp1 [label="Expert L6 SP3 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep12_pp1 -> layer_6_expert_sp3_ep12_tp2_pp1
	layer_6_expert_out_sp3_ep12_tp2_pp1 [label="Expert Out L6 SP3 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep12_tp2_pp1 -> layer_6_expert_out_sp3_ep12_tp2_pp1
	layer_6_expert_sp3_ep12_tp3_pp1 [label="Expert L6 SP3 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep12_pp1 -> layer_6_expert_sp3_ep12_tp3_pp1
	layer_6_expert_out_sp3_ep12_tp3_pp1 [label="Expert Out L6 SP3 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep12_tp3_pp1 -> layer_6_expert_out_sp3_ep12_tp3_pp1
	layer_6_expert_ar_sp3_ep12_pp1 [label="Expert All-Reduce L6 SP3 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep12_tp0_pp1 -> layer_6_expert_ar_sp3_ep12_pp1
	layer_6_expert_out_sp3_ep12_tp1_pp1 -> layer_6_expert_ar_sp3_ep12_pp1
	layer_6_expert_out_sp3_ep12_tp2_pp1 -> layer_6_expert_ar_sp3_ep12_pp1
	layer_6_expert_out_sp3_ep12_tp3_pp1 -> layer_6_expert_ar_sp3_ep12_pp1
	layer_6_combine_sp3_ep12_pp1 [label="Token Combine L6 SP3 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep12_pp1 -> layer_6_combine_sp3_ep12_pp1
	layer_6_dispatch_sp3_ep13_pp1 [label="Token Dispatch L6 SP3 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep13_pp1 [style=dashed]
	layer_6_expert_sp3_ep13_tp0_pp1 [label="Expert L6 SP3 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep13_pp1 -> layer_6_expert_sp3_ep13_tp0_pp1
	layer_6_expert_out_sp3_ep13_tp0_pp1 [label="Expert Out L6 SP3 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep13_tp0_pp1 -> layer_6_expert_out_sp3_ep13_tp0_pp1
	layer_6_expert_sp3_ep13_tp1_pp1 [label="Expert L6 SP3 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep13_pp1 -> layer_6_expert_sp3_ep13_tp1_pp1
	layer_6_expert_out_sp3_ep13_tp1_pp1 [label="Expert Out L6 SP3 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep13_tp1_pp1 -> layer_6_expert_out_sp3_ep13_tp1_pp1
	layer_6_expert_sp3_ep13_tp2_pp1 [label="Expert L6 SP3 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep13_pp1 -> layer_6_expert_sp3_ep13_tp2_pp1
	layer_6_expert_out_sp3_ep13_tp2_pp1 [label="Expert Out L6 SP3 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep13_tp2_pp1 -> layer_6_expert_out_sp3_ep13_tp2_pp1
	layer_6_expert_sp3_ep13_tp3_pp1 [label="Expert L6 SP3 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep13_pp1 -> layer_6_expert_sp3_ep13_tp3_pp1
	layer_6_expert_out_sp3_ep13_tp3_pp1 [label="Expert Out L6 SP3 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep13_tp3_pp1 -> layer_6_expert_out_sp3_ep13_tp3_pp1
	layer_6_expert_ar_sp3_ep13_pp1 [label="Expert All-Reduce L6 SP3 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep13_tp0_pp1 -> layer_6_expert_ar_sp3_ep13_pp1
	layer_6_expert_out_sp3_ep13_tp1_pp1 -> layer_6_expert_ar_sp3_ep13_pp1
	layer_6_expert_out_sp3_ep13_tp2_pp1 -> layer_6_expert_ar_sp3_ep13_pp1
	layer_6_expert_out_sp3_ep13_tp3_pp1 -> layer_6_expert_ar_sp3_ep13_pp1
	layer_6_combine_sp3_ep13_pp1 [label="Token Combine L6 SP3 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep13_pp1 -> layer_6_combine_sp3_ep13_pp1
	layer_6_dispatch_sp3_ep14_pp1 [label="Token Dispatch L6 SP3 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep14_pp1 [style=dashed]
	layer_6_expert_sp3_ep14_tp0_pp1 [label="Expert L6 SP3 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep14_pp1 -> layer_6_expert_sp3_ep14_tp0_pp1
	layer_6_expert_out_sp3_ep14_tp0_pp1 [label="Expert Out L6 SP3 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep14_tp0_pp1 -> layer_6_expert_out_sp3_ep14_tp0_pp1
	layer_6_expert_sp3_ep14_tp1_pp1 [label="Expert L6 SP3 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep14_pp1 -> layer_6_expert_sp3_ep14_tp1_pp1
	layer_6_expert_out_sp3_ep14_tp1_pp1 [label="Expert Out L6 SP3 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep14_tp1_pp1 -> layer_6_expert_out_sp3_ep14_tp1_pp1
	layer_6_expert_sp3_ep14_tp2_pp1 [label="Expert L6 SP3 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep14_pp1 -> layer_6_expert_sp3_ep14_tp2_pp1
	layer_6_expert_out_sp3_ep14_tp2_pp1 [label="Expert Out L6 SP3 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep14_tp2_pp1 -> layer_6_expert_out_sp3_ep14_tp2_pp1
	layer_6_expert_sp3_ep14_tp3_pp1 [label="Expert L6 SP3 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep14_pp1 -> layer_6_expert_sp3_ep14_tp3_pp1
	layer_6_expert_out_sp3_ep14_tp3_pp1 [label="Expert Out L6 SP3 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep14_tp3_pp1 -> layer_6_expert_out_sp3_ep14_tp3_pp1
	layer_6_expert_ar_sp3_ep14_pp1 [label="Expert All-Reduce L6 SP3 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep14_tp0_pp1 -> layer_6_expert_ar_sp3_ep14_pp1
	layer_6_expert_out_sp3_ep14_tp1_pp1 -> layer_6_expert_ar_sp3_ep14_pp1
	layer_6_expert_out_sp3_ep14_tp2_pp1 -> layer_6_expert_ar_sp3_ep14_pp1
	layer_6_expert_out_sp3_ep14_tp3_pp1 -> layer_6_expert_ar_sp3_ep14_pp1
	layer_6_combine_sp3_ep14_pp1 [label="Token Combine L6 SP3 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep14_pp1 -> layer_6_combine_sp3_ep14_pp1
	layer_6_dispatch_sp3_ep15_pp1 [label="Token Dispatch L6 SP3 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_6_router_sp3_pp1 -> layer_6_dispatch_sp3_ep15_pp1 [style=dashed]
	layer_6_expert_sp3_ep15_tp0_pp1 [label="Expert L6 SP3 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep15_pp1 -> layer_6_expert_sp3_ep15_tp0_pp1
	layer_6_expert_out_sp3_ep15_tp0_pp1 [label="Expert Out L6 SP3 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep15_tp0_pp1 -> layer_6_expert_out_sp3_ep15_tp0_pp1
	layer_6_expert_sp3_ep15_tp1_pp1 [label="Expert L6 SP3 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep15_pp1 -> layer_6_expert_sp3_ep15_tp1_pp1
	layer_6_expert_out_sp3_ep15_tp1_pp1 [label="Expert Out L6 SP3 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep15_tp1_pp1 -> layer_6_expert_out_sp3_ep15_tp1_pp1
	layer_6_expert_sp3_ep15_tp2_pp1 [label="Expert L6 SP3 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep15_pp1 -> layer_6_expert_sp3_ep15_tp2_pp1
	layer_6_expert_out_sp3_ep15_tp2_pp1 [label="Expert Out L6 SP3 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep15_tp2_pp1 -> layer_6_expert_out_sp3_ep15_tp2_pp1
	layer_6_expert_sp3_ep15_tp3_pp1 [label="Expert L6 SP3 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_dispatch_sp3_ep15_pp1 -> layer_6_expert_sp3_ep15_tp3_pp1
	layer_6_expert_out_sp3_ep15_tp3_pp1 [label="Expert Out L6 SP3 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_6_expert_sp3_ep15_tp3_pp1 -> layer_6_expert_out_sp3_ep15_tp3_pp1
	layer_6_expert_ar_sp3_ep15_pp1 [label="Expert All-Reduce L6 SP3 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_6_expert_out_sp3_ep15_tp0_pp1 -> layer_6_expert_ar_sp3_ep15_pp1
	layer_6_expert_out_sp3_ep15_tp1_pp1 -> layer_6_expert_ar_sp3_ep15_pp1
	layer_6_expert_out_sp3_ep15_tp2_pp1 -> layer_6_expert_ar_sp3_ep15_pp1
	layer_6_expert_out_sp3_ep15_tp3_pp1 -> layer_6_expert_ar_sp3_ep15_pp1
	layer_6_combine_sp3_ep15_pp1 [label="Token Combine L6 SP3 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_6_expert_ar_sp3_ep15_pp1 -> layer_6_combine_sp3_ep15_pp1
	layer_6_moe_all2all_sp3_pp1 [label="MoE All-to-All L6 SP3\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_6_combine_sp3_ep0_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep1_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep2_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep3_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep4_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep5_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep6_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep7_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep8_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep9_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep10_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep11_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep12_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep13_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep14_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_combine_sp3_ep15_pp1 -> layer_6_moe_all2all_sp3_pp1
	layer_6_mlp_out_sp3_pp1 [label="MoE Output L6 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_moe_all2all_sp3_pp1 -> layer_6_mlp_out_sp3_pp1
	layer_6_mlp_res_sp3_pp1 [label="MLP Residual L6 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_mlp_out_sp3_pp1 -> layer_6_mlp_res_sp3_pp1
	layer_6_attn_res_sp3_pp1 -> layer_6_mlp_res_sp3_pp1 [style=dashed]
	layer_7_norm_sp0_pp1 [label="LayerNorm L7 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_mlp_out_sp0_pp1 -> layer_7_norm_sp0_pp1
	layer_7_qkv_sp0_tp0_pp1 [label="QKV Proj L7 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp0_pp1 -> layer_7_qkv_sp0_tp0_pp1
	layer_7_attn_sp0_tp0_pp1 [label="Attention L7 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp0_tp0_pp1 -> layer_7_attn_sp0_tp0_pp1
	layer_7_attn_out_sp0_tp0_pp1 [label="Attn Out Proj L7 SP0 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp0_tp0_pp1 -> layer_7_attn_out_sp0_tp0_pp1
	layer_7_qkv_sp0_tp1_pp1 [label="QKV Proj L7 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp0_pp1 -> layer_7_qkv_sp0_tp1_pp1
	layer_7_attn_sp0_tp1_pp1 [label="Attention L7 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp0_tp1_pp1 -> layer_7_attn_sp0_tp1_pp1
	layer_7_attn_out_sp0_tp1_pp1 [label="Attn Out Proj L7 SP0 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp0_tp1_pp1 -> layer_7_attn_out_sp0_tp1_pp1
	layer_7_qkv_sp0_tp2_pp1 [label="QKV Proj L7 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp0_pp1 -> layer_7_qkv_sp0_tp2_pp1
	layer_7_attn_sp0_tp2_pp1 [label="Attention L7 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp0_tp2_pp1 -> layer_7_attn_sp0_tp2_pp1
	layer_7_attn_out_sp0_tp2_pp1 [label="Attn Out Proj L7 SP0 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp0_tp2_pp1 -> layer_7_attn_out_sp0_tp2_pp1
	layer_7_qkv_sp0_tp3_pp1 [label="QKV Proj L7 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp0_pp1 -> layer_7_qkv_sp0_tp3_pp1
	layer_7_attn_sp0_tp3_pp1 [label="Attention L7 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp0_tp3_pp1 -> layer_7_attn_sp0_tp3_pp1
	layer_7_attn_out_sp0_tp3_pp1 [label="Attn Out Proj L7 SP0 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp0_tp3_pp1 -> layer_7_attn_out_sp0_tp3_pp1
	layer_7_attn_ar_sp0_pp1 [label="Attention All-Reduce L7 SP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_attn_out_sp0_tp0_pp1 -> layer_7_attn_ar_sp0_pp1
	layer_7_attn_out_sp0_tp1_pp1 -> layer_7_attn_ar_sp0_pp1
	layer_7_attn_out_sp0_tp2_pp1 -> layer_7_attn_ar_sp0_pp1
	layer_7_attn_out_sp0_tp3_pp1 -> layer_7_attn_ar_sp0_pp1
	layer_7_attn_res_sp0_pp1 [label="Attention Residual L7 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_attn_ar_sp0_pp1 -> layer_7_attn_res_sp0_pp1
	layer_7_norm_sp0_pp1 -> layer_7_attn_res_sp0_pp1 [style=dashed]
	layer_7_post_norm_sp0_pp1 [label="Post-Attn Norm L7 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_attn_res_sp0_pp1 -> layer_7_post_norm_sp0_pp1
	layer_7_router_sp0_pp1 [label="MoE Router L7 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_7_post_norm_sp0_pp1 -> layer_7_router_sp0_pp1
	layer_7_dispatch_sp0_ep0_pp1 [label="Token Dispatch L7 SP0 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep0_pp1 [style=dashed]
	layer_7_expert_sp0_ep0_tp0_pp1 [label="Expert L7 SP0 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep0_pp1 -> layer_7_expert_sp0_ep0_tp0_pp1
	layer_7_expert_out_sp0_ep0_tp0_pp1 [label="Expert Out L7 SP0 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep0_tp0_pp1 -> layer_7_expert_out_sp0_ep0_tp0_pp1
	layer_7_expert_sp0_ep0_tp1_pp1 [label="Expert L7 SP0 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep0_pp1 -> layer_7_expert_sp0_ep0_tp1_pp1
	layer_7_expert_out_sp0_ep0_tp1_pp1 [label="Expert Out L7 SP0 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep0_tp1_pp1 -> layer_7_expert_out_sp0_ep0_tp1_pp1
	layer_7_expert_sp0_ep0_tp2_pp1 [label="Expert L7 SP0 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep0_pp1 -> layer_7_expert_sp0_ep0_tp2_pp1
	layer_7_expert_out_sp0_ep0_tp2_pp1 [label="Expert Out L7 SP0 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep0_tp2_pp1 -> layer_7_expert_out_sp0_ep0_tp2_pp1
	layer_7_expert_sp0_ep0_tp3_pp1 [label="Expert L7 SP0 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep0_pp1 -> layer_7_expert_sp0_ep0_tp3_pp1
	layer_7_expert_out_sp0_ep0_tp3_pp1 [label="Expert Out L7 SP0 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep0_tp3_pp1 -> layer_7_expert_out_sp0_ep0_tp3_pp1
	layer_7_expert_ar_sp0_ep0_pp1 [label="Expert All-Reduce L7 SP0 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep0_tp0_pp1 -> layer_7_expert_ar_sp0_ep0_pp1
	layer_7_expert_out_sp0_ep0_tp1_pp1 -> layer_7_expert_ar_sp0_ep0_pp1
	layer_7_expert_out_sp0_ep0_tp2_pp1 -> layer_7_expert_ar_sp0_ep0_pp1
	layer_7_expert_out_sp0_ep0_tp3_pp1 -> layer_7_expert_ar_sp0_ep0_pp1
	layer_7_combine_sp0_ep0_pp1 [label="Token Combine L7 SP0 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep0_pp1 -> layer_7_combine_sp0_ep0_pp1
	layer_7_dispatch_sp0_ep1_pp1 [label="Token Dispatch L7 SP0 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep1_pp1 [style=dashed]
	layer_7_expert_sp0_ep1_tp0_pp1 [label="Expert L7 SP0 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep1_pp1 -> layer_7_expert_sp0_ep1_tp0_pp1
	layer_7_expert_out_sp0_ep1_tp0_pp1 [label="Expert Out L7 SP0 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep1_tp0_pp1 -> layer_7_expert_out_sp0_ep1_tp0_pp1
	layer_7_expert_sp0_ep1_tp1_pp1 [label="Expert L7 SP0 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep1_pp1 -> layer_7_expert_sp0_ep1_tp1_pp1
	layer_7_expert_out_sp0_ep1_tp1_pp1 [label="Expert Out L7 SP0 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep1_tp1_pp1 -> layer_7_expert_out_sp0_ep1_tp1_pp1
	layer_7_expert_sp0_ep1_tp2_pp1 [label="Expert L7 SP0 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep1_pp1 -> layer_7_expert_sp0_ep1_tp2_pp1
	layer_7_expert_out_sp0_ep1_tp2_pp1 [label="Expert Out L7 SP0 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep1_tp2_pp1 -> layer_7_expert_out_sp0_ep1_tp2_pp1
	layer_7_expert_sp0_ep1_tp3_pp1 [label="Expert L7 SP0 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep1_pp1 -> layer_7_expert_sp0_ep1_tp3_pp1
	layer_7_expert_out_sp0_ep1_tp3_pp1 [label="Expert Out L7 SP0 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep1_tp3_pp1 -> layer_7_expert_out_sp0_ep1_tp3_pp1
	layer_7_expert_ar_sp0_ep1_pp1 [label="Expert All-Reduce L7 SP0 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep1_tp0_pp1 -> layer_7_expert_ar_sp0_ep1_pp1
	layer_7_expert_out_sp0_ep1_tp1_pp1 -> layer_7_expert_ar_sp0_ep1_pp1
	layer_7_expert_out_sp0_ep1_tp2_pp1 -> layer_7_expert_ar_sp0_ep1_pp1
	layer_7_expert_out_sp0_ep1_tp3_pp1 -> layer_7_expert_ar_sp0_ep1_pp1
	layer_7_combine_sp0_ep1_pp1 [label="Token Combine L7 SP0 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep1_pp1 -> layer_7_combine_sp0_ep1_pp1
	layer_7_dispatch_sp0_ep2_pp1 [label="Token Dispatch L7 SP0 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep2_pp1 [style=dashed]
	layer_7_expert_sp0_ep2_tp0_pp1 [label="Expert L7 SP0 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep2_pp1 -> layer_7_expert_sp0_ep2_tp0_pp1
	layer_7_expert_out_sp0_ep2_tp0_pp1 [label="Expert Out L7 SP0 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep2_tp0_pp1 -> layer_7_expert_out_sp0_ep2_tp0_pp1
	layer_7_expert_sp0_ep2_tp1_pp1 [label="Expert L7 SP0 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep2_pp1 -> layer_7_expert_sp0_ep2_tp1_pp1
	layer_7_expert_out_sp0_ep2_tp1_pp1 [label="Expert Out L7 SP0 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep2_tp1_pp1 -> layer_7_expert_out_sp0_ep2_tp1_pp1
	layer_7_expert_sp0_ep2_tp2_pp1 [label="Expert L7 SP0 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep2_pp1 -> layer_7_expert_sp0_ep2_tp2_pp1
	layer_7_expert_out_sp0_ep2_tp2_pp1 [label="Expert Out L7 SP0 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep2_tp2_pp1 -> layer_7_expert_out_sp0_ep2_tp2_pp1
	layer_7_expert_sp0_ep2_tp3_pp1 [label="Expert L7 SP0 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep2_pp1 -> layer_7_expert_sp0_ep2_tp3_pp1
	layer_7_expert_out_sp0_ep2_tp3_pp1 [label="Expert Out L7 SP0 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep2_tp3_pp1 -> layer_7_expert_out_sp0_ep2_tp3_pp1
	layer_7_expert_ar_sp0_ep2_pp1 [label="Expert All-Reduce L7 SP0 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep2_tp0_pp1 -> layer_7_expert_ar_sp0_ep2_pp1
	layer_7_expert_out_sp0_ep2_tp1_pp1 -> layer_7_expert_ar_sp0_ep2_pp1
	layer_7_expert_out_sp0_ep2_tp2_pp1 -> layer_7_expert_ar_sp0_ep2_pp1
	layer_7_expert_out_sp0_ep2_tp3_pp1 -> layer_7_expert_ar_sp0_ep2_pp1
	layer_7_combine_sp0_ep2_pp1 [label="Token Combine L7 SP0 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep2_pp1 -> layer_7_combine_sp0_ep2_pp1
	layer_7_dispatch_sp0_ep3_pp1 [label="Token Dispatch L7 SP0 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep3_pp1 [style=dashed]
	layer_7_expert_sp0_ep3_tp0_pp1 [label="Expert L7 SP0 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep3_pp1 -> layer_7_expert_sp0_ep3_tp0_pp1
	layer_7_expert_out_sp0_ep3_tp0_pp1 [label="Expert Out L7 SP0 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep3_tp0_pp1 -> layer_7_expert_out_sp0_ep3_tp0_pp1
	layer_7_expert_sp0_ep3_tp1_pp1 [label="Expert L7 SP0 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep3_pp1 -> layer_7_expert_sp0_ep3_tp1_pp1
	layer_7_expert_out_sp0_ep3_tp1_pp1 [label="Expert Out L7 SP0 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep3_tp1_pp1 -> layer_7_expert_out_sp0_ep3_tp1_pp1
	layer_7_expert_sp0_ep3_tp2_pp1 [label="Expert L7 SP0 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep3_pp1 -> layer_7_expert_sp0_ep3_tp2_pp1
	layer_7_expert_out_sp0_ep3_tp2_pp1 [label="Expert Out L7 SP0 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep3_tp2_pp1 -> layer_7_expert_out_sp0_ep3_tp2_pp1
	layer_7_expert_sp0_ep3_tp3_pp1 [label="Expert L7 SP0 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep3_pp1 -> layer_7_expert_sp0_ep3_tp3_pp1
	layer_7_expert_out_sp0_ep3_tp3_pp1 [label="Expert Out L7 SP0 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep3_tp3_pp1 -> layer_7_expert_out_sp0_ep3_tp3_pp1
	layer_7_expert_ar_sp0_ep3_pp1 [label="Expert All-Reduce L7 SP0 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep3_tp0_pp1 -> layer_7_expert_ar_sp0_ep3_pp1
	layer_7_expert_out_sp0_ep3_tp1_pp1 -> layer_7_expert_ar_sp0_ep3_pp1
	layer_7_expert_out_sp0_ep3_tp2_pp1 -> layer_7_expert_ar_sp0_ep3_pp1
	layer_7_expert_out_sp0_ep3_tp3_pp1 -> layer_7_expert_ar_sp0_ep3_pp1
	layer_7_combine_sp0_ep3_pp1 [label="Token Combine L7 SP0 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep3_pp1 -> layer_7_combine_sp0_ep3_pp1
	layer_7_dispatch_sp0_ep4_pp1 [label="Token Dispatch L7 SP0 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep4_pp1 [style=dashed]
	layer_7_expert_sp0_ep4_tp0_pp1 [label="Expert L7 SP0 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep4_pp1 -> layer_7_expert_sp0_ep4_tp0_pp1
	layer_7_expert_out_sp0_ep4_tp0_pp1 [label="Expert Out L7 SP0 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep4_tp0_pp1 -> layer_7_expert_out_sp0_ep4_tp0_pp1
	layer_7_expert_sp0_ep4_tp1_pp1 [label="Expert L7 SP0 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep4_pp1 -> layer_7_expert_sp0_ep4_tp1_pp1
	layer_7_expert_out_sp0_ep4_tp1_pp1 [label="Expert Out L7 SP0 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep4_tp1_pp1 -> layer_7_expert_out_sp0_ep4_tp1_pp1
	layer_7_expert_sp0_ep4_tp2_pp1 [label="Expert L7 SP0 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep4_pp1 -> layer_7_expert_sp0_ep4_tp2_pp1
	layer_7_expert_out_sp0_ep4_tp2_pp1 [label="Expert Out L7 SP0 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep4_tp2_pp1 -> layer_7_expert_out_sp0_ep4_tp2_pp1
	layer_7_expert_sp0_ep4_tp3_pp1 [label="Expert L7 SP0 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep4_pp1 -> layer_7_expert_sp0_ep4_tp3_pp1
	layer_7_expert_out_sp0_ep4_tp3_pp1 [label="Expert Out L7 SP0 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep4_tp3_pp1 -> layer_7_expert_out_sp0_ep4_tp3_pp1
	layer_7_expert_ar_sp0_ep4_pp1 [label="Expert All-Reduce L7 SP0 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep4_tp0_pp1 -> layer_7_expert_ar_sp0_ep4_pp1
	layer_7_expert_out_sp0_ep4_tp1_pp1 -> layer_7_expert_ar_sp0_ep4_pp1
	layer_7_expert_out_sp0_ep4_tp2_pp1 -> layer_7_expert_ar_sp0_ep4_pp1
	layer_7_expert_out_sp0_ep4_tp3_pp1 -> layer_7_expert_ar_sp0_ep4_pp1
	layer_7_combine_sp0_ep4_pp1 [label="Token Combine L7 SP0 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep4_pp1 -> layer_7_combine_sp0_ep4_pp1
	layer_7_dispatch_sp0_ep5_pp1 [label="Token Dispatch L7 SP0 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep5_pp1 [style=dashed]
	layer_7_expert_sp0_ep5_tp0_pp1 [label="Expert L7 SP0 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep5_pp1 -> layer_7_expert_sp0_ep5_tp0_pp1
	layer_7_expert_out_sp0_ep5_tp0_pp1 [label="Expert Out L7 SP0 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep5_tp0_pp1 -> layer_7_expert_out_sp0_ep5_tp0_pp1
	layer_7_expert_sp0_ep5_tp1_pp1 [label="Expert L7 SP0 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep5_pp1 -> layer_7_expert_sp0_ep5_tp1_pp1
	layer_7_expert_out_sp0_ep5_tp1_pp1 [label="Expert Out L7 SP0 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep5_tp1_pp1 -> layer_7_expert_out_sp0_ep5_tp1_pp1
	layer_7_expert_sp0_ep5_tp2_pp1 [label="Expert L7 SP0 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep5_pp1 -> layer_7_expert_sp0_ep5_tp2_pp1
	layer_7_expert_out_sp0_ep5_tp2_pp1 [label="Expert Out L7 SP0 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep5_tp2_pp1 -> layer_7_expert_out_sp0_ep5_tp2_pp1
	layer_7_expert_sp0_ep5_tp3_pp1 [label="Expert L7 SP0 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep5_pp1 -> layer_7_expert_sp0_ep5_tp3_pp1
	layer_7_expert_out_sp0_ep5_tp3_pp1 [label="Expert Out L7 SP0 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep5_tp3_pp1 -> layer_7_expert_out_sp0_ep5_tp3_pp1
	layer_7_expert_ar_sp0_ep5_pp1 [label="Expert All-Reduce L7 SP0 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep5_tp0_pp1 -> layer_7_expert_ar_sp0_ep5_pp1
	layer_7_expert_out_sp0_ep5_tp1_pp1 -> layer_7_expert_ar_sp0_ep5_pp1
	layer_7_expert_out_sp0_ep5_tp2_pp1 -> layer_7_expert_ar_sp0_ep5_pp1
	layer_7_expert_out_sp0_ep5_tp3_pp1 -> layer_7_expert_ar_sp0_ep5_pp1
	layer_7_combine_sp0_ep5_pp1 [label="Token Combine L7 SP0 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep5_pp1 -> layer_7_combine_sp0_ep5_pp1
	layer_7_dispatch_sp0_ep6_pp1 [label="Token Dispatch L7 SP0 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep6_pp1 [style=dashed]
	layer_7_expert_sp0_ep6_tp0_pp1 [label="Expert L7 SP0 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep6_pp1 -> layer_7_expert_sp0_ep6_tp0_pp1
	layer_7_expert_out_sp0_ep6_tp0_pp1 [label="Expert Out L7 SP0 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep6_tp0_pp1 -> layer_7_expert_out_sp0_ep6_tp0_pp1
	layer_7_expert_sp0_ep6_tp1_pp1 [label="Expert L7 SP0 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep6_pp1 -> layer_7_expert_sp0_ep6_tp1_pp1
	layer_7_expert_out_sp0_ep6_tp1_pp1 [label="Expert Out L7 SP0 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep6_tp1_pp1 -> layer_7_expert_out_sp0_ep6_tp1_pp1
	layer_7_expert_sp0_ep6_tp2_pp1 [label="Expert L7 SP0 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep6_pp1 -> layer_7_expert_sp0_ep6_tp2_pp1
	layer_7_expert_out_sp0_ep6_tp2_pp1 [label="Expert Out L7 SP0 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep6_tp2_pp1 -> layer_7_expert_out_sp0_ep6_tp2_pp1
	layer_7_expert_sp0_ep6_tp3_pp1 [label="Expert L7 SP0 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep6_pp1 -> layer_7_expert_sp0_ep6_tp3_pp1
	layer_7_expert_out_sp0_ep6_tp3_pp1 [label="Expert Out L7 SP0 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep6_tp3_pp1 -> layer_7_expert_out_sp0_ep6_tp3_pp1
	layer_7_expert_ar_sp0_ep6_pp1 [label="Expert All-Reduce L7 SP0 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep6_tp0_pp1 -> layer_7_expert_ar_sp0_ep6_pp1
	layer_7_expert_out_sp0_ep6_tp1_pp1 -> layer_7_expert_ar_sp0_ep6_pp1
	layer_7_expert_out_sp0_ep6_tp2_pp1 -> layer_7_expert_ar_sp0_ep6_pp1
	layer_7_expert_out_sp0_ep6_tp3_pp1 -> layer_7_expert_ar_sp0_ep6_pp1
	layer_7_combine_sp0_ep6_pp1 [label="Token Combine L7 SP0 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep6_pp1 -> layer_7_combine_sp0_ep6_pp1
	layer_7_dispatch_sp0_ep7_pp1 [label="Token Dispatch L7 SP0 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep7_pp1 [style=dashed]
	layer_7_expert_sp0_ep7_tp0_pp1 [label="Expert L7 SP0 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep7_pp1 -> layer_7_expert_sp0_ep7_tp0_pp1
	layer_7_expert_out_sp0_ep7_tp0_pp1 [label="Expert Out L7 SP0 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep7_tp0_pp1 -> layer_7_expert_out_sp0_ep7_tp0_pp1
	layer_7_expert_sp0_ep7_tp1_pp1 [label="Expert L7 SP0 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep7_pp1 -> layer_7_expert_sp0_ep7_tp1_pp1
	layer_7_expert_out_sp0_ep7_tp1_pp1 [label="Expert Out L7 SP0 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep7_tp1_pp1 -> layer_7_expert_out_sp0_ep7_tp1_pp1
	layer_7_expert_sp0_ep7_tp2_pp1 [label="Expert L7 SP0 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep7_pp1 -> layer_7_expert_sp0_ep7_tp2_pp1
	layer_7_expert_out_sp0_ep7_tp2_pp1 [label="Expert Out L7 SP0 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep7_tp2_pp1 -> layer_7_expert_out_sp0_ep7_tp2_pp1
	layer_7_expert_sp0_ep7_tp3_pp1 [label="Expert L7 SP0 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep7_pp1 -> layer_7_expert_sp0_ep7_tp3_pp1
	layer_7_expert_out_sp0_ep7_tp3_pp1 [label="Expert Out L7 SP0 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep7_tp3_pp1 -> layer_7_expert_out_sp0_ep7_tp3_pp1
	layer_7_expert_ar_sp0_ep7_pp1 [label="Expert All-Reduce L7 SP0 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep7_tp0_pp1 -> layer_7_expert_ar_sp0_ep7_pp1
	layer_7_expert_out_sp0_ep7_tp1_pp1 -> layer_7_expert_ar_sp0_ep7_pp1
	layer_7_expert_out_sp0_ep7_tp2_pp1 -> layer_7_expert_ar_sp0_ep7_pp1
	layer_7_expert_out_sp0_ep7_tp3_pp1 -> layer_7_expert_ar_sp0_ep7_pp1
	layer_7_combine_sp0_ep7_pp1 [label="Token Combine L7 SP0 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep7_pp1 -> layer_7_combine_sp0_ep7_pp1
	layer_7_dispatch_sp0_ep8_pp1 [label="Token Dispatch L7 SP0 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep8_pp1 [style=dashed]
	layer_7_expert_sp0_ep8_tp0_pp1 [label="Expert L7 SP0 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep8_pp1 -> layer_7_expert_sp0_ep8_tp0_pp1
	layer_7_expert_out_sp0_ep8_tp0_pp1 [label="Expert Out L7 SP0 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep8_tp0_pp1 -> layer_7_expert_out_sp0_ep8_tp0_pp1
	layer_7_expert_sp0_ep8_tp1_pp1 [label="Expert L7 SP0 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep8_pp1 -> layer_7_expert_sp0_ep8_tp1_pp1
	layer_7_expert_out_sp0_ep8_tp1_pp1 [label="Expert Out L7 SP0 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep8_tp1_pp1 -> layer_7_expert_out_sp0_ep8_tp1_pp1
	layer_7_expert_sp0_ep8_tp2_pp1 [label="Expert L7 SP0 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep8_pp1 -> layer_7_expert_sp0_ep8_tp2_pp1
	layer_7_expert_out_sp0_ep8_tp2_pp1 [label="Expert Out L7 SP0 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep8_tp2_pp1 -> layer_7_expert_out_sp0_ep8_tp2_pp1
	layer_7_expert_sp0_ep8_tp3_pp1 [label="Expert L7 SP0 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep8_pp1 -> layer_7_expert_sp0_ep8_tp3_pp1
	layer_7_expert_out_sp0_ep8_tp3_pp1 [label="Expert Out L7 SP0 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep8_tp3_pp1 -> layer_7_expert_out_sp0_ep8_tp3_pp1
	layer_7_expert_ar_sp0_ep8_pp1 [label="Expert All-Reduce L7 SP0 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep8_tp0_pp1 -> layer_7_expert_ar_sp0_ep8_pp1
	layer_7_expert_out_sp0_ep8_tp1_pp1 -> layer_7_expert_ar_sp0_ep8_pp1
	layer_7_expert_out_sp0_ep8_tp2_pp1 -> layer_7_expert_ar_sp0_ep8_pp1
	layer_7_expert_out_sp0_ep8_tp3_pp1 -> layer_7_expert_ar_sp0_ep8_pp1
	layer_7_combine_sp0_ep8_pp1 [label="Token Combine L7 SP0 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep8_pp1 -> layer_7_combine_sp0_ep8_pp1
	layer_7_dispatch_sp0_ep9_pp1 [label="Token Dispatch L7 SP0 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep9_pp1 [style=dashed]
	layer_7_expert_sp0_ep9_tp0_pp1 [label="Expert L7 SP0 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep9_pp1 -> layer_7_expert_sp0_ep9_tp0_pp1
	layer_7_expert_out_sp0_ep9_tp0_pp1 [label="Expert Out L7 SP0 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep9_tp0_pp1 -> layer_7_expert_out_sp0_ep9_tp0_pp1
	layer_7_expert_sp0_ep9_tp1_pp1 [label="Expert L7 SP0 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep9_pp1 -> layer_7_expert_sp0_ep9_tp1_pp1
	layer_7_expert_out_sp0_ep9_tp1_pp1 [label="Expert Out L7 SP0 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep9_tp1_pp1 -> layer_7_expert_out_sp0_ep9_tp1_pp1
	layer_7_expert_sp0_ep9_tp2_pp1 [label="Expert L7 SP0 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep9_pp1 -> layer_7_expert_sp0_ep9_tp2_pp1
	layer_7_expert_out_sp0_ep9_tp2_pp1 [label="Expert Out L7 SP0 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep9_tp2_pp1 -> layer_7_expert_out_sp0_ep9_tp2_pp1
	layer_7_expert_sp0_ep9_tp3_pp1 [label="Expert L7 SP0 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep9_pp1 -> layer_7_expert_sp0_ep9_tp3_pp1
	layer_7_expert_out_sp0_ep9_tp3_pp1 [label="Expert Out L7 SP0 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep9_tp3_pp1 -> layer_7_expert_out_sp0_ep9_tp3_pp1
	layer_7_expert_ar_sp0_ep9_pp1 [label="Expert All-Reduce L7 SP0 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep9_tp0_pp1 -> layer_7_expert_ar_sp0_ep9_pp1
	layer_7_expert_out_sp0_ep9_tp1_pp1 -> layer_7_expert_ar_sp0_ep9_pp1
	layer_7_expert_out_sp0_ep9_tp2_pp1 -> layer_7_expert_ar_sp0_ep9_pp1
	layer_7_expert_out_sp0_ep9_tp3_pp1 -> layer_7_expert_ar_sp0_ep9_pp1
	layer_7_combine_sp0_ep9_pp1 [label="Token Combine L7 SP0 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep9_pp1 -> layer_7_combine_sp0_ep9_pp1
	layer_7_dispatch_sp0_ep10_pp1 [label="Token Dispatch L7 SP0 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep10_pp1 [style=dashed]
	layer_7_expert_sp0_ep10_tp0_pp1 [label="Expert L7 SP0 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep10_pp1 -> layer_7_expert_sp0_ep10_tp0_pp1
	layer_7_expert_out_sp0_ep10_tp0_pp1 [label="Expert Out L7 SP0 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep10_tp0_pp1 -> layer_7_expert_out_sp0_ep10_tp0_pp1
	layer_7_expert_sp0_ep10_tp1_pp1 [label="Expert L7 SP0 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep10_pp1 -> layer_7_expert_sp0_ep10_tp1_pp1
	layer_7_expert_out_sp0_ep10_tp1_pp1 [label="Expert Out L7 SP0 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep10_tp1_pp1 -> layer_7_expert_out_sp0_ep10_tp1_pp1
	layer_7_expert_sp0_ep10_tp2_pp1 [label="Expert L7 SP0 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep10_pp1 -> layer_7_expert_sp0_ep10_tp2_pp1
	layer_7_expert_out_sp0_ep10_tp2_pp1 [label="Expert Out L7 SP0 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep10_tp2_pp1 -> layer_7_expert_out_sp0_ep10_tp2_pp1
	layer_7_expert_sp0_ep10_tp3_pp1 [label="Expert L7 SP0 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep10_pp1 -> layer_7_expert_sp0_ep10_tp3_pp1
	layer_7_expert_out_sp0_ep10_tp3_pp1 [label="Expert Out L7 SP0 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep10_tp3_pp1 -> layer_7_expert_out_sp0_ep10_tp3_pp1
	layer_7_expert_ar_sp0_ep10_pp1 [label="Expert All-Reduce L7 SP0 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep10_tp0_pp1 -> layer_7_expert_ar_sp0_ep10_pp1
	layer_7_expert_out_sp0_ep10_tp1_pp1 -> layer_7_expert_ar_sp0_ep10_pp1
	layer_7_expert_out_sp0_ep10_tp2_pp1 -> layer_7_expert_ar_sp0_ep10_pp1
	layer_7_expert_out_sp0_ep10_tp3_pp1 -> layer_7_expert_ar_sp0_ep10_pp1
	layer_7_combine_sp0_ep10_pp1 [label="Token Combine L7 SP0 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep10_pp1 -> layer_7_combine_sp0_ep10_pp1
	layer_7_dispatch_sp0_ep11_pp1 [label="Token Dispatch L7 SP0 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep11_pp1 [style=dashed]
	layer_7_expert_sp0_ep11_tp0_pp1 [label="Expert L7 SP0 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep11_pp1 -> layer_7_expert_sp0_ep11_tp0_pp1
	layer_7_expert_out_sp0_ep11_tp0_pp1 [label="Expert Out L7 SP0 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep11_tp0_pp1 -> layer_7_expert_out_sp0_ep11_tp0_pp1
	layer_7_expert_sp0_ep11_tp1_pp1 [label="Expert L7 SP0 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep11_pp1 -> layer_7_expert_sp0_ep11_tp1_pp1
	layer_7_expert_out_sp0_ep11_tp1_pp1 [label="Expert Out L7 SP0 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep11_tp1_pp1 -> layer_7_expert_out_sp0_ep11_tp1_pp1
	layer_7_expert_sp0_ep11_tp2_pp1 [label="Expert L7 SP0 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep11_pp1 -> layer_7_expert_sp0_ep11_tp2_pp1
	layer_7_expert_out_sp0_ep11_tp2_pp1 [label="Expert Out L7 SP0 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep11_tp2_pp1 -> layer_7_expert_out_sp0_ep11_tp2_pp1
	layer_7_expert_sp0_ep11_tp3_pp1 [label="Expert L7 SP0 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep11_pp1 -> layer_7_expert_sp0_ep11_tp3_pp1
	layer_7_expert_out_sp0_ep11_tp3_pp1 [label="Expert Out L7 SP0 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep11_tp3_pp1 -> layer_7_expert_out_sp0_ep11_tp3_pp1
	layer_7_expert_ar_sp0_ep11_pp1 [label="Expert All-Reduce L7 SP0 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep11_tp0_pp1 -> layer_7_expert_ar_sp0_ep11_pp1
	layer_7_expert_out_sp0_ep11_tp1_pp1 -> layer_7_expert_ar_sp0_ep11_pp1
	layer_7_expert_out_sp0_ep11_tp2_pp1 -> layer_7_expert_ar_sp0_ep11_pp1
	layer_7_expert_out_sp0_ep11_tp3_pp1 -> layer_7_expert_ar_sp0_ep11_pp1
	layer_7_combine_sp0_ep11_pp1 [label="Token Combine L7 SP0 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep11_pp1 -> layer_7_combine_sp0_ep11_pp1
	layer_7_dispatch_sp0_ep12_pp1 [label="Token Dispatch L7 SP0 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep12_pp1 [style=dashed]
	layer_7_expert_sp0_ep12_tp0_pp1 [label="Expert L7 SP0 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep12_pp1 -> layer_7_expert_sp0_ep12_tp0_pp1
	layer_7_expert_out_sp0_ep12_tp0_pp1 [label="Expert Out L7 SP0 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep12_tp0_pp1 -> layer_7_expert_out_sp0_ep12_tp0_pp1
	layer_7_expert_sp0_ep12_tp1_pp1 [label="Expert L7 SP0 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep12_pp1 -> layer_7_expert_sp0_ep12_tp1_pp1
	layer_7_expert_out_sp0_ep12_tp1_pp1 [label="Expert Out L7 SP0 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep12_tp1_pp1 -> layer_7_expert_out_sp0_ep12_tp1_pp1
	layer_7_expert_sp0_ep12_tp2_pp1 [label="Expert L7 SP0 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep12_pp1 -> layer_7_expert_sp0_ep12_tp2_pp1
	layer_7_expert_out_sp0_ep12_tp2_pp1 [label="Expert Out L7 SP0 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep12_tp2_pp1 -> layer_7_expert_out_sp0_ep12_tp2_pp1
	layer_7_expert_sp0_ep12_tp3_pp1 [label="Expert L7 SP0 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep12_pp1 -> layer_7_expert_sp0_ep12_tp3_pp1
	layer_7_expert_out_sp0_ep12_tp3_pp1 [label="Expert Out L7 SP0 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep12_tp3_pp1 -> layer_7_expert_out_sp0_ep12_tp3_pp1
	layer_7_expert_ar_sp0_ep12_pp1 [label="Expert All-Reduce L7 SP0 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep12_tp0_pp1 -> layer_7_expert_ar_sp0_ep12_pp1
	layer_7_expert_out_sp0_ep12_tp1_pp1 -> layer_7_expert_ar_sp0_ep12_pp1
	layer_7_expert_out_sp0_ep12_tp2_pp1 -> layer_7_expert_ar_sp0_ep12_pp1
	layer_7_expert_out_sp0_ep12_tp3_pp1 -> layer_7_expert_ar_sp0_ep12_pp1
	layer_7_combine_sp0_ep12_pp1 [label="Token Combine L7 SP0 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep12_pp1 -> layer_7_combine_sp0_ep12_pp1
	layer_7_dispatch_sp0_ep13_pp1 [label="Token Dispatch L7 SP0 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep13_pp1 [style=dashed]
	layer_7_expert_sp0_ep13_tp0_pp1 [label="Expert L7 SP0 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep13_pp1 -> layer_7_expert_sp0_ep13_tp0_pp1
	layer_7_expert_out_sp0_ep13_tp0_pp1 [label="Expert Out L7 SP0 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep13_tp0_pp1 -> layer_7_expert_out_sp0_ep13_tp0_pp1
	layer_7_expert_sp0_ep13_tp1_pp1 [label="Expert L7 SP0 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep13_pp1 -> layer_7_expert_sp0_ep13_tp1_pp1
	layer_7_expert_out_sp0_ep13_tp1_pp1 [label="Expert Out L7 SP0 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep13_tp1_pp1 -> layer_7_expert_out_sp0_ep13_tp1_pp1
	layer_7_expert_sp0_ep13_tp2_pp1 [label="Expert L7 SP0 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep13_pp1 -> layer_7_expert_sp0_ep13_tp2_pp1
	layer_7_expert_out_sp0_ep13_tp2_pp1 [label="Expert Out L7 SP0 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep13_tp2_pp1 -> layer_7_expert_out_sp0_ep13_tp2_pp1
	layer_7_expert_sp0_ep13_tp3_pp1 [label="Expert L7 SP0 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep13_pp1 -> layer_7_expert_sp0_ep13_tp3_pp1
	layer_7_expert_out_sp0_ep13_tp3_pp1 [label="Expert Out L7 SP0 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep13_tp3_pp1 -> layer_7_expert_out_sp0_ep13_tp3_pp1
	layer_7_expert_ar_sp0_ep13_pp1 [label="Expert All-Reduce L7 SP0 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep13_tp0_pp1 -> layer_7_expert_ar_sp0_ep13_pp1
	layer_7_expert_out_sp0_ep13_tp1_pp1 -> layer_7_expert_ar_sp0_ep13_pp1
	layer_7_expert_out_sp0_ep13_tp2_pp1 -> layer_7_expert_ar_sp0_ep13_pp1
	layer_7_expert_out_sp0_ep13_tp3_pp1 -> layer_7_expert_ar_sp0_ep13_pp1
	layer_7_combine_sp0_ep13_pp1 [label="Token Combine L7 SP0 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep13_pp1 -> layer_7_combine_sp0_ep13_pp1
	layer_7_dispatch_sp0_ep14_pp1 [label="Token Dispatch L7 SP0 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep14_pp1 [style=dashed]
	layer_7_expert_sp0_ep14_tp0_pp1 [label="Expert L7 SP0 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep14_pp1 -> layer_7_expert_sp0_ep14_tp0_pp1
	layer_7_expert_out_sp0_ep14_tp0_pp1 [label="Expert Out L7 SP0 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep14_tp0_pp1 -> layer_7_expert_out_sp0_ep14_tp0_pp1
	layer_7_expert_sp0_ep14_tp1_pp1 [label="Expert L7 SP0 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep14_pp1 -> layer_7_expert_sp0_ep14_tp1_pp1
	layer_7_expert_out_sp0_ep14_tp1_pp1 [label="Expert Out L7 SP0 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep14_tp1_pp1 -> layer_7_expert_out_sp0_ep14_tp1_pp1
	layer_7_expert_sp0_ep14_tp2_pp1 [label="Expert L7 SP0 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep14_pp1 -> layer_7_expert_sp0_ep14_tp2_pp1
	layer_7_expert_out_sp0_ep14_tp2_pp1 [label="Expert Out L7 SP0 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep14_tp2_pp1 -> layer_7_expert_out_sp0_ep14_tp2_pp1
	layer_7_expert_sp0_ep14_tp3_pp1 [label="Expert L7 SP0 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep14_pp1 -> layer_7_expert_sp0_ep14_tp3_pp1
	layer_7_expert_out_sp0_ep14_tp3_pp1 [label="Expert Out L7 SP0 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep14_tp3_pp1 -> layer_7_expert_out_sp0_ep14_tp3_pp1
	layer_7_expert_ar_sp0_ep14_pp1 [label="Expert All-Reduce L7 SP0 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep14_tp0_pp1 -> layer_7_expert_ar_sp0_ep14_pp1
	layer_7_expert_out_sp0_ep14_tp1_pp1 -> layer_7_expert_ar_sp0_ep14_pp1
	layer_7_expert_out_sp0_ep14_tp2_pp1 -> layer_7_expert_ar_sp0_ep14_pp1
	layer_7_expert_out_sp0_ep14_tp3_pp1 -> layer_7_expert_ar_sp0_ep14_pp1
	layer_7_combine_sp0_ep14_pp1 [label="Token Combine L7 SP0 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep14_pp1 -> layer_7_combine_sp0_ep14_pp1
	layer_7_dispatch_sp0_ep15_pp1 [label="Token Dispatch L7 SP0 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp0_pp1 -> layer_7_dispatch_sp0_ep15_pp1 [style=dashed]
	layer_7_expert_sp0_ep15_tp0_pp1 [label="Expert L7 SP0 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep15_pp1 -> layer_7_expert_sp0_ep15_tp0_pp1
	layer_7_expert_out_sp0_ep15_tp0_pp1 [label="Expert Out L7 SP0 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep15_tp0_pp1 -> layer_7_expert_out_sp0_ep15_tp0_pp1
	layer_7_expert_sp0_ep15_tp1_pp1 [label="Expert L7 SP0 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep15_pp1 -> layer_7_expert_sp0_ep15_tp1_pp1
	layer_7_expert_out_sp0_ep15_tp1_pp1 [label="Expert Out L7 SP0 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep15_tp1_pp1 -> layer_7_expert_out_sp0_ep15_tp1_pp1
	layer_7_expert_sp0_ep15_tp2_pp1 [label="Expert L7 SP0 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep15_pp1 -> layer_7_expert_sp0_ep15_tp2_pp1
	layer_7_expert_out_sp0_ep15_tp2_pp1 [label="Expert Out L7 SP0 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep15_tp2_pp1 -> layer_7_expert_out_sp0_ep15_tp2_pp1
	layer_7_expert_sp0_ep15_tp3_pp1 [label="Expert L7 SP0 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp0_ep15_pp1 -> layer_7_expert_sp0_ep15_tp3_pp1
	layer_7_expert_out_sp0_ep15_tp3_pp1 [label="Expert Out L7 SP0 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp0_ep15_tp3_pp1 -> layer_7_expert_out_sp0_ep15_tp3_pp1
	layer_7_expert_ar_sp0_ep15_pp1 [label="Expert All-Reduce L7 SP0 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp0_ep15_tp0_pp1 -> layer_7_expert_ar_sp0_ep15_pp1
	layer_7_expert_out_sp0_ep15_tp1_pp1 -> layer_7_expert_ar_sp0_ep15_pp1
	layer_7_expert_out_sp0_ep15_tp2_pp1 -> layer_7_expert_ar_sp0_ep15_pp1
	layer_7_expert_out_sp0_ep15_tp3_pp1 -> layer_7_expert_ar_sp0_ep15_pp1
	layer_7_combine_sp0_ep15_pp1 [label="Token Combine L7 SP0 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp0_ep15_pp1 -> layer_7_combine_sp0_ep15_pp1
	layer_7_moe_all2all_sp0_pp1 [label="MoE All-to-All L7 SP0\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_7_combine_sp0_ep0_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep1_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep2_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep3_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep4_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep5_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep6_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep7_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep8_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep9_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep10_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep11_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep12_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep13_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep14_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_combine_sp0_ep15_pp1 -> layer_7_moe_all2all_sp0_pp1
	layer_7_mlp_out_sp0_pp1 [label="MoE Output L7 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_moe_all2all_sp0_pp1 -> layer_7_mlp_out_sp0_pp1
	layer_7_mlp_res_sp0_pp1 [label="MLP Residual L7 SP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_mlp_out_sp0_pp1 -> layer_7_mlp_res_sp0_pp1
	layer_7_attn_res_sp0_pp1 -> layer_7_mlp_res_sp0_pp1 [style=dashed]
	layer_7_norm_sp1_pp1 [label="LayerNorm L7 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_mlp_out_sp1_pp1 -> layer_7_norm_sp1_pp1
	layer_7_qkv_sp1_tp0_pp1 [label="QKV Proj L7 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp1_pp1 -> layer_7_qkv_sp1_tp0_pp1
	layer_7_attn_sp1_tp0_pp1 [label="Attention L7 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp1_tp0_pp1 -> layer_7_attn_sp1_tp0_pp1
	layer_7_attn_out_sp1_tp0_pp1 [label="Attn Out Proj L7 SP1 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp1_tp0_pp1 -> layer_7_attn_out_sp1_tp0_pp1
	layer_7_qkv_sp1_tp1_pp1 [label="QKV Proj L7 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp1_pp1 -> layer_7_qkv_sp1_tp1_pp1
	layer_7_attn_sp1_tp1_pp1 [label="Attention L7 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp1_tp1_pp1 -> layer_7_attn_sp1_tp1_pp1
	layer_7_attn_out_sp1_tp1_pp1 [label="Attn Out Proj L7 SP1 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp1_tp1_pp1 -> layer_7_attn_out_sp1_tp1_pp1
	layer_7_qkv_sp1_tp2_pp1 [label="QKV Proj L7 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp1_pp1 -> layer_7_qkv_sp1_tp2_pp1
	layer_7_attn_sp1_tp2_pp1 [label="Attention L7 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp1_tp2_pp1 -> layer_7_attn_sp1_tp2_pp1
	layer_7_attn_out_sp1_tp2_pp1 [label="Attn Out Proj L7 SP1 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp1_tp2_pp1 -> layer_7_attn_out_sp1_tp2_pp1
	layer_7_qkv_sp1_tp3_pp1 [label="QKV Proj L7 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp1_pp1 -> layer_7_qkv_sp1_tp3_pp1
	layer_7_attn_sp1_tp3_pp1 [label="Attention L7 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp1_tp3_pp1 -> layer_7_attn_sp1_tp3_pp1
	layer_7_attn_out_sp1_tp3_pp1 [label="Attn Out Proj L7 SP1 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp1_tp3_pp1 -> layer_7_attn_out_sp1_tp3_pp1
	layer_7_attn_ar_sp1_pp1 [label="Attention All-Reduce L7 SP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_attn_out_sp1_tp0_pp1 -> layer_7_attn_ar_sp1_pp1
	layer_7_attn_out_sp1_tp1_pp1 -> layer_7_attn_ar_sp1_pp1
	layer_7_attn_out_sp1_tp2_pp1 -> layer_7_attn_ar_sp1_pp1
	layer_7_attn_out_sp1_tp3_pp1 -> layer_7_attn_ar_sp1_pp1
	layer_7_attn_res_sp1_pp1 [label="Attention Residual L7 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_attn_ar_sp1_pp1 -> layer_7_attn_res_sp1_pp1
	layer_7_norm_sp1_pp1 -> layer_7_attn_res_sp1_pp1 [style=dashed]
	layer_7_post_norm_sp1_pp1 [label="Post-Attn Norm L7 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_attn_res_sp1_pp1 -> layer_7_post_norm_sp1_pp1
	layer_7_router_sp1_pp1 [label="MoE Router L7 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_7_post_norm_sp1_pp1 -> layer_7_router_sp1_pp1
	layer_7_dispatch_sp1_ep0_pp1 [label="Token Dispatch L7 SP1 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep0_pp1 [style=dashed]
	layer_7_expert_sp1_ep0_tp0_pp1 [label="Expert L7 SP1 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep0_pp1 -> layer_7_expert_sp1_ep0_tp0_pp1
	layer_7_expert_out_sp1_ep0_tp0_pp1 [label="Expert Out L7 SP1 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep0_tp0_pp1 -> layer_7_expert_out_sp1_ep0_tp0_pp1
	layer_7_expert_sp1_ep0_tp1_pp1 [label="Expert L7 SP1 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep0_pp1 -> layer_7_expert_sp1_ep0_tp1_pp1
	layer_7_expert_out_sp1_ep0_tp1_pp1 [label="Expert Out L7 SP1 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep0_tp1_pp1 -> layer_7_expert_out_sp1_ep0_tp1_pp1
	layer_7_expert_sp1_ep0_tp2_pp1 [label="Expert L7 SP1 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep0_pp1 -> layer_7_expert_sp1_ep0_tp2_pp1
	layer_7_expert_out_sp1_ep0_tp2_pp1 [label="Expert Out L7 SP1 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep0_tp2_pp1 -> layer_7_expert_out_sp1_ep0_tp2_pp1
	layer_7_expert_sp1_ep0_tp3_pp1 [label="Expert L7 SP1 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep0_pp1 -> layer_7_expert_sp1_ep0_tp3_pp1
	layer_7_expert_out_sp1_ep0_tp3_pp1 [label="Expert Out L7 SP1 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep0_tp3_pp1 -> layer_7_expert_out_sp1_ep0_tp3_pp1
	layer_7_expert_ar_sp1_ep0_pp1 [label="Expert All-Reduce L7 SP1 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep0_tp0_pp1 -> layer_7_expert_ar_sp1_ep0_pp1
	layer_7_expert_out_sp1_ep0_tp1_pp1 -> layer_7_expert_ar_sp1_ep0_pp1
	layer_7_expert_out_sp1_ep0_tp2_pp1 -> layer_7_expert_ar_sp1_ep0_pp1
	layer_7_expert_out_sp1_ep0_tp3_pp1 -> layer_7_expert_ar_sp1_ep0_pp1
	layer_7_combine_sp1_ep0_pp1 [label="Token Combine L7 SP1 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep0_pp1 -> layer_7_combine_sp1_ep0_pp1
	layer_7_dispatch_sp1_ep1_pp1 [label="Token Dispatch L7 SP1 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep1_pp1 [style=dashed]
	layer_7_expert_sp1_ep1_tp0_pp1 [label="Expert L7 SP1 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep1_pp1 -> layer_7_expert_sp1_ep1_tp0_pp1
	layer_7_expert_out_sp1_ep1_tp0_pp1 [label="Expert Out L7 SP1 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep1_tp0_pp1 -> layer_7_expert_out_sp1_ep1_tp0_pp1
	layer_7_expert_sp1_ep1_tp1_pp1 [label="Expert L7 SP1 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep1_pp1 -> layer_7_expert_sp1_ep1_tp1_pp1
	layer_7_expert_out_sp1_ep1_tp1_pp1 [label="Expert Out L7 SP1 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep1_tp1_pp1 -> layer_7_expert_out_sp1_ep1_tp1_pp1
	layer_7_expert_sp1_ep1_tp2_pp1 [label="Expert L7 SP1 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep1_pp1 -> layer_7_expert_sp1_ep1_tp2_pp1
	layer_7_expert_out_sp1_ep1_tp2_pp1 [label="Expert Out L7 SP1 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep1_tp2_pp1 -> layer_7_expert_out_sp1_ep1_tp2_pp1
	layer_7_expert_sp1_ep1_tp3_pp1 [label="Expert L7 SP1 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep1_pp1 -> layer_7_expert_sp1_ep1_tp3_pp1
	layer_7_expert_out_sp1_ep1_tp3_pp1 [label="Expert Out L7 SP1 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep1_tp3_pp1 -> layer_7_expert_out_sp1_ep1_tp3_pp1
	layer_7_expert_ar_sp1_ep1_pp1 [label="Expert All-Reduce L7 SP1 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep1_tp0_pp1 -> layer_7_expert_ar_sp1_ep1_pp1
	layer_7_expert_out_sp1_ep1_tp1_pp1 -> layer_7_expert_ar_sp1_ep1_pp1
	layer_7_expert_out_sp1_ep1_tp2_pp1 -> layer_7_expert_ar_sp1_ep1_pp1
	layer_7_expert_out_sp1_ep1_tp3_pp1 -> layer_7_expert_ar_sp1_ep1_pp1
	layer_7_combine_sp1_ep1_pp1 [label="Token Combine L7 SP1 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep1_pp1 -> layer_7_combine_sp1_ep1_pp1
	layer_7_dispatch_sp1_ep2_pp1 [label="Token Dispatch L7 SP1 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep2_pp1 [style=dashed]
	layer_7_expert_sp1_ep2_tp0_pp1 [label="Expert L7 SP1 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep2_pp1 -> layer_7_expert_sp1_ep2_tp0_pp1
	layer_7_expert_out_sp1_ep2_tp0_pp1 [label="Expert Out L7 SP1 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep2_tp0_pp1 -> layer_7_expert_out_sp1_ep2_tp0_pp1
	layer_7_expert_sp1_ep2_tp1_pp1 [label="Expert L7 SP1 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep2_pp1 -> layer_7_expert_sp1_ep2_tp1_pp1
	layer_7_expert_out_sp1_ep2_tp1_pp1 [label="Expert Out L7 SP1 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep2_tp1_pp1 -> layer_7_expert_out_sp1_ep2_tp1_pp1
	layer_7_expert_sp1_ep2_tp2_pp1 [label="Expert L7 SP1 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep2_pp1 -> layer_7_expert_sp1_ep2_tp2_pp1
	layer_7_expert_out_sp1_ep2_tp2_pp1 [label="Expert Out L7 SP1 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep2_tp2_pp1 -> layer_7_expert_out_sp1_ep2_tp2_pp1
	layer_7_expert_sp1_ep2_tp3_pp1 [label="Expert L7 SP1 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep2_pp1 -> layer_7_expert_sp1_ep2_tp3_pp1
	layer_7_expert_out_sp1_ep2_tp3_pp1 [label="Expert Out L7 SP1 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep2_tp3_pp1 -> layer_7_expert_out_sp1_ep2_tp3_pp1
	layer_7_expert_ar_sp1_ep2_pp1 [label="Expert All-Reduce L7 SP1 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep2_tp0_pp1 -> layer_7_expert_ar_sp1_ep2_pp1
	layer_7_expert_out_sp1_ep2_tp1_pp1 -> layer_7_expert_ar_sp1_ep2_pp1
	layer_7_expert_out_sp1_ep2_tp2_pp1 -> layer_7_expert_ar_sp1_ep2_pp1
	layer_7_expert_out_sp1_ep2_tp3_pp1 -> layer_7_expert_ar_sp1_ep2_pp1
	layer_7_combine_sp1_ep2_pp1 [label="Token Combine L7 SP1 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep2_pp1 -> layer_7_combine_sp1_ep2_pp1
	layer_7_dispatch_sp1_ep3_pp1 [label="Token Dispatch L7 SP1 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep3_pp1 [style=dashed]
	layer_7_expert_sp1_ep3_tp0_pp1 [label="Expert L7 SP1 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep3_pp1 -> layer_7_expert_sp1_ep3_tp0_pp1
	layer_7_expert_out_sp1_ep3_tp0_pp1 [label="Expert Out L7 SP1 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep3_tp0_pp1 -> layer_7_expert_out_sp1_ep3_tp0_pp1
	layer_7_expert_sp1_ep3_tp1_pp1 [label="Expert L7 SP1 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep3_pp1 -> layer_7_expert_sp1_ep3_tp1_pp1
	layer_7_expert_out_sp1_ep3_tp1_pp1 [label="Expert Out L7 SP1 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep3_tp1_pp1 -> layer_7_expert_out_sp1_ep3_tp1_pp1
	layer_7_expert_sp1_ep3_tp2_pp1 [label="Expert L7 SP1 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep3_pp1 -> layer_7_expert_sp1_ep3_tp2_pp1
	layer_7_expert_out_sp1_ep3_tp2_pp1 [label="Expert Out L7 SP1 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep3_tp2_pp1 -> layer_7_expert_out_sp1_ep3_tp2_pp1
	layer_7_expert_sp1_ep3_tp3_pp1 [label="Expert L7 SP1 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep3_pp1 -> layer_7_expert_sp1_ep3_tp3_pp1
	layer_7_expert_out_sp1_ep3_tp3_pp1 [label="Expert Out L7 SP1 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep3_tp3_pp1 -> layer_7_expert_out_sp1_ep3_tp3_pp1
	layer_7_expert_ar_sp1_ep3_pp1 [label="Expert All-Reduce L7 SP1 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep3_tp0_pp1 -> layer_7_expert_ar_sp1_ep3_pp1
	layer_7_expert_out_sp1_ep3_tp1_pp1 -> layer_7_expert_ar_sp1_ep3_pp1
	layer_7_expert_out_sp1_ep3_tp2_pp1 -> layer_7_expert_ar_sp1_ep3_pp1
	layer_7_expert_out_sp1_ep3_tp3_pp1 -> layer_7_expert_ar_sp1_ep3_pp1
	layer_7_combine_sp1_ep3_pp1 [label="Token Combine L7 SP1 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep3_pp1 -> layer_7_combine_sp1_ep3_pp1
	layer_7_dispatch_sp1_ep4_pp1 [label="Token Dispatch L7 SP1 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep4_pp1 [style=dashed]
	layer_7_expert_sp1_ep4_tp0_pp1 [label="Expert L7 SP1 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep4_pp1 -> layer_7_expert_sp1_ep4_tp0_pp1
	layer_7_expert_out_sp1_ep4_tp0_pp1 [label="Expert Out L7 SP1 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep4_tp0_pp1 -> layer_7_expert_out_sp1_ep4_tp0_pp1
	layer_7_expert_sp1_ep4_tp1_pp1 [label="Expert L7 SP1 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep4_pp1 -> layer_7_expert_sp1_ep4_tp1_pp1
	layer_7_expert_out_sp1_ep4_tp1_pp1 [label="Expert Out L7 SP1 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep4_tp1_pp1 -> layer_7_expert_out_sp1_ep4_tp1_pp1
	layer_7_expert_sp1_ep4_tp2_pp1 [label="Expert L7 SP1 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep4_pp1 -> layer_7_expert_sp1_ep4_tp2_pp1
	layer_7_expert_out_sp1_ep4_tp2_pp1 [label="Expert Out L7 SP1 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep4_tp2_pp1 -> layer_7_expert_out_sp1_ep4_tp2_pp1
	layer_7_expert_sp1_ep4_tp3_pp1 [label="Expert L7 SP1 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep4_pp1 -> layer_7_expert_sp1_ep4_tp3_pp1
	layer_7_expert_out_sp1_ep4_tp3_pp1 [label="Expert Out L7 SP1 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep4_tp3_pp1 -> layer_7_expert_out_sp1_ep4_tp3_pp1
	layer_7_expert_ar_sp1_ep4_pp1 [label="Expert All-Reduce L7 SP1 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep4_tp0_pp1 -> layer_7_expert_ar_sp1_ep4_pp1
	layer_7_expert_out_sp1_ep4_tp1_pp1 -> layer_7_expert_ar_sp1_ep4_pp1
	layer_7_expert_out_sp1_ep4_tp2_pp1 -> layer_7_expert_ar_sp1_ep4_pp1
	layer_7_expert_out_sp1_ep4_tp3_pp1 -> layer_7_expert_ar_sp1_ep4_pp1
	layer_7_combine_sp1_ep4_pp1 [label="Token Combine L7 SP1 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep4_pp1 -> layer_7_combine_sp1_ep4_pp1
	layer_7_dispatch_sp1_ep5_pp1 [label="Token Dispatch L7 SP1 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep5_pp1 [style=dashed]
	layer_7_expert_sp1_ep5_tp0_pp1 [label="Expert L7 SP1 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep5_pp1 -> layer_7_expert_sp1_ep5_tp0_pp1
	layer_7_expert_out_sp1_ep5_tp0_pp1 [label="Expert Out L7 SP1 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep5_tp0_pp1 -> layer_7_expert_out_sp1_ep5_tp0_pp1
	layer_7_expert_sp1_ep5_tp1_pp1 [label="Expert L7 SP1 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep5_pp1 -> layer_7_expert_sp1_ep5_tp1_pp1
	layer_7_expert_out_sp1_ep5_tp1_pp1 [label="Expert Out L7 SP1 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep5_tp1_pp1 -> layer_7_expert_out_sp1_ep5_tp1_pp1
	layer_7_expert_sp1_ep5_tp2_pp1 [label="Expert L7 SP1 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep5_pp1 -> layer_7_expert_sp1_ep5_tp2_pp1
	layer_7_expert_out_sp1_ep5_tp2_pp1 [label="Expert Out L7 SP1 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep5_tp2_pp1 -> layer_7_expert_out_sp1_ep5_tp2_pp1
	layer_7_expert_sp1_ep5_tp3_pp1 [label="Expert L7 SP1 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep5_pp1 -> layer_7_expert_sp1_ep5_tp3_pp1
	layer_7_expert_out_sp1_ep5_tp3_pp1 [label="Expert Out L7 SP1 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep5_tp3_pp1 -> layer_7_expert_out_sp1_ep5_tp3_pp1
	layer_7_expert_ar_sp1_ep5_pp1 [label="Expert All-Reduce L7 SP1 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep5_tp0_pp1 -> layer_7_expert_ar_sp1_ep5_pp1
	layer_7_expert_out_sp1_ep5_tp1_pp1 -> layer_7_expert_ar_sp1_ep5_pp1
	layer_7_expert_out_sp1_ep5_tp2_pp1 -> layer_7_expert_ar_sp1_ep5_pp1
	layer_7_expert_out_sp1_ep5_tp3_pp1 -> layer_7_expert_ar_sp1_ep5_pp1
	layer_7_combine_sp1_ep5_pp1 [label="Token Combine L7 SP1 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep5_pp1 -> layer_7_combine_sp1_ep5_pp1
	layer_7_dispatch_sp1_ep6_pp1 [label="Token Dispatch L7 SP1 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep6_pp1 [style=dashed]
	layer_7_expert_sp1_ep6_tp0_pp1 [label="Expert L7 SP1 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep6_pp1 -> layer_7_expert_sp1_ep6_tp0_pp1
	layer_7_expert_out_sp1_ep6_tp0_pp1 [label="Expert Out L7 SP1 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep6_tp0_pp1 -> layer_7_expert_out_sp1_ep6_tp0_pp1
	layer_7_expert_sp1_ep6_tp1_pp1 [label="Expert L7 SP1 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep6_pp1 -> layer_7_expert_sp1_ep6_tp1_pp1
	layer_7_expert_out_sp1_ep6_tp1_pp1 [label="Expert Out L7 SP1 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep6_tp1_pp1 -> layer_7_expert_out_sp1_ep6_tp1_pp1
	layer_7_expert_sp1_ep6_tp2_pp1 [label="Expert L7 SP1 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep6_pp1 -> layer_7_expert_sp1_ep6_tp2_pp1
	layer_7_expert_out_sp1_ep6_tp2_pp1 [label="Expert Out L7 SP1 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep6_tp2_pp1 -> layer_7_expert_out_sp1_ep6_tp2_pp1
	layer_7_expert_sp1_ep6_tp3_pp1 [label="Expert L7 SP1 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep6_pp1 -> layer_7_expert_sp1_ep6_tp3_pp1
	layer_7_expert_out_sp1_ep6_tp3_pp1 [label="Expert Out L7 SP1 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep6_tp3_pp1 -> layer_7_expert_out_sp1_ep6_tp3_pp1
	layer_7_expert_ar_sp1_ep6_pp1 [label="Expert All-Reduce L7 SP1 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep6_tp0_pp1 -> layer_7_expert_ar_sp1_ep6_pp1
	layer_7_expert_out_sp1_ep6_tp1_pp1 -> layer_7_expert_ar_sp1_ep6_pp1
	layer_7_expert_out_sp1_ep6_tp2_pp1 -> layer_7_expert_ar_sp1_ep6_pp1
	layer_7_expert_out_sp1_ep6_tp3_pp1 -> layer_7_expert_ar_sp1_ep6_pp1
	layer_7_combine_sp1_ep6_pp1 [label="Token Combine L7 SP1 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep6_pp1 -> layer_7_combine_sp1_ep6_pp1
	layer_7_dispatch_sp1_ep7_pp1 [label="Token Dispatch L7 SP1 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep7_pp1 [style=dashed]
	layer_7_expert_sp1_ep7_tp0_pp1 [label="Expert L7 SP1 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep7_pp1 -> layer_7_expert_sp1_ep7_tp0_pp1
	layer_7_expert_out_sp1_ep7_tp0_pp1 [label="Expert Out L7 SP1 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep7_tp0_pp1 -> layer_7_expert_out_sp1_ep7_tp0_pp1
	layer_7_expert_sp1_ep7_tp1_pp1 [label="Expert L7 SP1 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep7_pp1 -> layer_7_expert_sp1_ep7_tp1_pp1
	layer_7_expert_out_sp1_ep7_tp1_pp1 [label="Expert Out L7 SP1 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep7_tp1_pp1 -> layer_7_expert_out_sp1_ep7_tp1_pp1
	layer_7_expert_sp1_ep7_tp2_pp1 [label="Expert L7 SP1 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep7_pp1 -> layer_7_expert_sp1_ep7_tp2_pp1
	layer_7_expert_out_sp1_ep7_tp2_pp1 [label="Expert Out L7 SP1 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep7_tp2_pp1 -> layer_7_expert_out_sp1_ep7_tp2_pp1
	layer_7_expert_sp1_ep7_tp3_pp1 [label="Expert L7 SP1 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep7_pp1 -> layer_7_expert_sp1_ep7_tp3_pp1
	layer_7_expert_out_sp1_ep7_tp3_pp1 [label="Expert Out L7 SP1 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep7_tp3_pp1 -> layer_7_expert_out_sp1_ep7_tp3_pp1
	layer_7_expert_ar_sp1_ep7_pp1 [label="Expert All-Reduce L7 SP1 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep7_tp0_pp1 -> layer_7_expert_ar_sp1_ep7_pp1
	layer_7_expert_out_sp1_ep7_tp1_pp1 -> layer_7_expert_ar_sp1_ep7_pp1
	layer_7_expert_out_sp1_ep7_tp2_pp1 -> layer_7_expert_ar_sp1_ep7_pp1
	layer_7_expert_out_sp1_ep7_tp3_pp1 -> layer_7_expert_ar_sp1_ep7_pp1
	layer_7_combine_sp1_ep7_pp1 [label="Token Combine L7 SP1 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep7_pp1 -> layer_7_combine_sp1_ep7_pp1
	layer_7_dispatch_sp1_ep8_pp1 [label="Token Dispatch L7 SP1 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep8_pp1 [style=dashed]
	layer_7_expert_sp1_ep8_tp0_pp1 [label="Expert L7 SP1 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep8_pp1 -> layer_7_expert_sp1_ep8_tp0_pp1
	layer_7_expert_out_sp1_ep8_tp0_pp1 [label="Expert Out L7 SP1 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep8_tp0_pp1 -> layer_7_expert_out_sp1_ep8_tp0_pp1
	layer_7_expert_sp1_ep8_tp1_pp1 [label="Expert L7 SP1 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep8_pp1 -> layer_7_expert_sp1_ep8_tp1_pp1
	layer_7_expert_out_sp1_ep8_tp1_pp1 [label="Expert Out L7 SP1 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep8_tp1_pp1 -> layer_7_expert_out_sp1_ep8_tp1_pp1
	layer_7_expert_sp1_ep8_tp2_pp1 [label="Expert L7 SP1 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep8_pp1 -> layer_7_expert_sp1_ep8_tp2_pp1
	layer_7_expert_out_sp1_ep8_tp2_pp1 [label="Expert Out L7 SP1 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep8_tp2_pp1 -> layer_7_expert_out_sp1_ep8_tp2_pp1
	layer_7_expert_sp1_ep8_tp3_pp1 [label="Expert L7 SP1 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep8_pp1 -> layer_7_expert_sp1_ep8_tp3_pp1
	layer_7_expert_out_sp1_ep8_tp3_pp1 [label="Expert Out L7 SP1 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep8_tp3_pp1 -> layer_7_expert_out_sp1_ep8_tp3_pp1
	layer_7_expert_ar_sp1_ep8_pp1 [label="Expert All-Reduce L7 SP1 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep8_tp0_pp1 -> layer_7_expert_ar_sp1_ep8_pp1
	layer_7_expert_out_sp1_ep8_tp1_pp1 -> layer_7_expert_ar_sp1_ep8_pp1
	layer_7_expert_out_sp1_ep8_tp2_pp1 -> layer_7_expert_ar_sp1_ep8_pp1
	layer_7_expert_out_sp1_ep8_tp3_pp1 -> layer_7_expert_ar_sp1_ep8_pp1
	layer_7_combine_sp1_ep8_pp1 [label="Token Combine L7 SP1 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep8_pp1 -> layer_7_combine_sp1_ep8_pp1
	layer_7_dispatch_sp1_ep9_pp1 [label="Token Dispatch L7 SP1 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep9_pp1 [style=dashed]
	layer_7_expert_sp1_ep9_tp0_pp1 [label="Expert L7 SP1 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep9_pp1 -> layer_7_expert_sp1_ep9_tp0_pp1
	layer_7_expert_out_sp1_ep9_tp0_pp1 [label="Expert Out L7 SP1 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep9_tp0_pp1 -> layer_7_expert_out_sp1_ep9_tp0_pp1
	layer_7_expert_sp1_ep9_tp1_pp1 [label="Expert L7 SP1 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep9_pp1 -> layer_7_expert_sp1_ep9_tp1_pp1
	layer_7_expert_out_sp1_ep9_tp1_pp1 [label="Expert Out L7 SP1 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep9_tp1_pp1 -> layer_7_expert_out_sp1_ep9_tp1_pp1
	layer_7_expert_sp1_ep9_tp2_pp1 [label="Expert L7 SP1 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep9_pp1 -> layer_7_expert_sp1_ep9_tp2_pp1
	layer_7_expert_out_sp1_ep9_tp2_pp1 [label="Expert Out L7 SP1 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep9_tp2_pp1 -> layer_7_expert_out_sp1_ep9_tp2_pp1
	layer_7_expert_sp1_ep9_tp3_pp1 [label="Expert L7 SP1 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep9_pp1 -> layer_7_expert_sp1_ep9_tp3_pp1
	layer_7_expert_out_sp1_ep9_tp3_pp1 [label="Expert Out L7 SP1 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep9_tp3_pp1 -> layer_7_expert_out_sp1_ep9_tp3_pp1
	layer_7_expert_ar_sp1_ep9_pp1 [label="Expert All-Reduce L7 SP1 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep9_tp0_pp1 -> layer_7_expert_ar_sp1_ep9_pp1
	layer_7_expert_out_sp1_ep9_tp1_pp1 -> layer_7_expert_ar_sp1_ep9_pp1
	layer_7_expert_out_sp1_ep9_tp2_pp1 -> layer_7_expert_ar_sp1_ep9_pp1
	layer_7_expert_out_sp1_ep9_tp3_pp1 -> layer_7_expert_ar_sp1_ep9_pp1
	layer_7_combine_sp1_ep9_pp1 [label="Token Combine L7 SP1 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep9_pp1 -> layer_7_combine_sp1_ep9_pp1
	layer_7_dispatch_sp1_ep10_pp1 [label="Token Dispatch L7 SP1 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep10_pp1 [style=dashed]
	layer_7_expert_sp1_ep10_tp0_pp1 [label="Expert L7 SP1 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep10_pp1 -> layer_7_expert_sp1_ep10_tp0_pp1
	layer_7_expert_out_sp1_ep10_tp0_pp1 [label="Expert Out L7 SP1 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep10_tp0_pp1 -> layer_7_expert_out_sp1_ep10_tp0_pp1
	layer_7_expert_sp1_ep10_tp1_pp1 [label="Expert L7 SP1 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep10_pp1 -> layer_7_expert_sp1_ep10_tp1_pp1
	layer_7_expert_out_sp1_ep10_tp1_pp1 [label="Expert Out L7 SP1 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep10_tp1_pp1 -> layer_7_expert_out_sp1_ep10_tp1_pp1
	layer_7_expert_sp1_ep10_tp2_pp1 [label="Expert L7 SP1 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep10_pp1 -> layer_7_expert_sp1_ep10_tp2_pp1
	layer_7_expert_out_sp1_ep10_tp2_pp1 [label="Expert Out L7 SP1 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep10_tp2_pp1 -> layer_7_expert_out_sp1_ep10_tp2_pp1
	layer_7_expert_sp1_ep10_tp3_pp1 [label="Expert L7 SP1 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep10_pp1 -> layer_7_expert_sp1_ep10_tp3_pp1
	layer_7_expert_out_sp1_ep10_tp3_pp1 [label="Expert Out L7 SP1 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep10_tp3_pp1 -> layer_7_expert_out_sp1_ep10_tp3_pp1
	layer_7_expert_ar_sp1_ep10_pp1 [label="Expert All-Reduce L7 SP1 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep10_tp0_pp1 -> layer_7_expert_ar_sp1_ep10_pp1
	layer_7_expert_out_sp1_ep10_tp1_pp1 -> layer_7_expert_ar_sp1_ep10_pp1
	layer_7_expert_out_sp1_ep10_tp2_pp1 -> layer_7_expert_ar_sp1_ep10_pp1
	layer_7_expert_out_sp1_ep10_tp3_pp1 -> layer_7_expert_ar_sp1_ep10_pp1
	layer_7_combine_sp1_ep10_pp1 [label="Token Combine L7 SP1 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep10_pp1 -> layer_7_combine_sp1_ep10_pp1
	layer_7_dispatch_sp1_ep11_pp1 [label="Token Dispatch L7 SP1 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep11_pp1 [style=dashed]
	layer_7_expert_sp1_ep11_tp0_pp1 [label="Expert L7 SP1 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep11_pp1 -> layer_7_expert_sp1_ep11_tp0_pp1
	layer_7_expert_out_sp1_ep11_tp0_pp1 [label="Expert Out L7 SP1 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep11_tp0_pp1 -> layer_7_expert_out_sp1_ep11_tp0_pp1
	layer_7_expert_sp1_ep11_tp1_pp1 [label="Expert L7 SP1 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep11_pp1 -> layer_7_expert_sp1_ep11_tp1_pp1
	layer_7_expert_out_sp1_ep11_tp1_pp1 [label="Expert Out L7 SP1 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep11_tp1_pp1 -> layer_7_expert_out_sp1_ep11_tp1_pp1
	layer_7_expert_sp1_ep11_tp2_pp1 [label="Expert L7 SP1 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep11_pp1 -> layer_7_expert_sp1_ep11_tp2_pp1
	layer_7_expert_out_sp1_ep11_tp2_pp1 [label="Expert Out L7 SP1 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep11_tp2_pp1 -> layer_7_expert_out_sp1_ep11_tp2_pp1
	layer_7_expert_sp1_ep11_tp3_pp1 [label="Expert L7 SP1 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep11_pp1 -> layer_7_expert_sp1_ep11_tp3_pp1
	layer_7_expert_out_sp1_ep11_tp3_pp1 [label="Expert Out L7 SP1 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep11_tp3_pp1 -> layer_7_expert_out_sp1_ep11_tp3_pp1
	layer_7_expert_ar_sp1_ep11_pp1 [label="Expert All-Reduce L7 SP1 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep11_tp0_pp1 -> layer_7_expert_ar_sp1_ep11_pp1
	layer_7_expert_out_sp1_ep11_tp1_pp1 -> layer_7_expert_ar_sp1_ep11_pp1
	layer_7_expert_out_sp1_ep11_tp2_pp1 -> layer_7_expert_ar_sp1_ep11_pp1
	layer_7_expert_out_sp1_ep11_tp3_pp1 -> layer_7_expert_ar_sp1_ep11_pp1
	layer_7_combine_sp1_ep11_pp1 [label="Token Combine L7 SP1 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep11_pp1 -> layer_7_combine_sp1_ep11_pp1
	layer_7_dispatch_sp1_ep12_pp1 [label="Token Dispatch L7 SP1 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep12_pp1 [style=dashed]
	layer_7_expert_sp1_ep12_tp0_pp1 [label="Expert L7 SP1 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep12_pp1 -> layer_7_expert_sp1_ep12_tp0_pp1
	layer_7_expert_out_sp1_ep12_tp0_pp1 [label="Expert Out L7 SP1 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep12_tp0_pp1 -> layer_7_expert_out_sp1_ep12_tp0_pp1
	layer_7_expert_sp1_ep12_tp1_pp1 [label="Expert L7 SP1 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep12_pp1 -> layer_7_expert_sp1_ep12_tp1_pp1
	layer_7_expert_out_sp1_ep12_tp1_pp1 [label="Expert Out L7 SP1 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep12_tp1_pp1 -> layer_7_expert_out_sp1_ep12_tp1_pp1
	layer_7_expert_sp1_ep12_tp2_pp1 [label="Expert L7 SP1 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep12_pp1 -> layer_7_expert_sp1_ep12_tp2_pp1
	layer_7_expert_out_sp1_ep12_tp2_pp1 [label="Expert Out L7 SP1 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep12_tp2_pp1 -> layer_7_expert_out_sp1_ep12_tp2_pp1
	layer_7_expert_sp1_ep12_tp3_pp1 [label="Expert L7 SP1 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep12_pp1 -> layer_7_expert_sp1_ep12_tp3_pp1
	layer_7_expert_out_sp1_ep12_tp3_pp1 [label="Expert Out L7 SP1 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep12_tp3_pp1 -> layer_7_expert_out_sp1_ep12_tp3_pp1
	layer_7_expert_ar_sp1_ep12_pp1 [label="Expert All-Reduce L7 SP1 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep12_tp0_pp1 -> layer_7_expert_ar_sp1_ep12_pp1
	layer_7_expert_out_sp1_ep12_tp1_pp1 -> layer_7_expert_ar_sp1_ep12_pp1
	layer_7_expert_out_sp1_ep12_tp2_pp1 -> layer_7_expert_ar_sp1_ep12_pp1
	layer_7_expert_out_sp1_ep12_tp3_pp1 -> layer_7_expert_ar_sp1_ep12_pp1
	layer_7_combine_sp1_ep12_pp1 [label="Token Combine L7 SP1 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep12_pp1 -> layer_7_combine_sp1_ep12_pp1
	layer_7_dispatch_sp1_ep13_pp1 [label="Token Dispatch L7 SP1 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep13_pp1 [style=dashed]
	layer_7_expert_sp1_ep13_tp0_pp1 [label="Expert L7 SP1 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep13_pp1 -> layer_7_expert_sp1_ep13_tp0_pp1
	layer_7_expert_out_sp1_ep13_tp0_pp1 [label="Expert Out L7 SP1 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep13_tp0_pp1 -> layer_7_expert_out_sp1_ep13_tp0_pp1
	layer_7_expert_sp1_ep13_tp1_pp1 [label="Expert L7 SP1 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep13_pp1 -> layer_7_expert_sp1_ep13_tp1_pp1
	layer_7_expert_out_sp1_ep13_tp1_pp1 [label="Expert Out L7 SP1 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep13_tp1_pp1 -> layer_7_expert_out_sp1_ep13_tp1_pp1
	layer_7_expert_sp1_ep13_tp2_pp1 [label="Expert L7 SP1 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep13_pp1 -> layer_7_expert_sp1_ep13_tp2_pp1
	layer_7_expert_out_sp1_ep13_tp2_pp1 [label="Expert Out L7 SP1 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep13_tp2_pp1 -> layer_7_expert_out_sp1_ep13_tp2_pp1
	layer_7_expert_sp1_ep13_tp3_pp1 [label="Expert L7 SP1 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep13_pp1 -> layer_7_expert_sp1_ep13_tp3_pp1
	layer_7_expert_out_sp1_ep13_tp3_pp1 [label="Expert Out L7 SP1 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep13_tp3_pp1 -> layer_7_expert_out_sp1_ep13_tp3_pp1
	layer_7_expert_ar_sp1_ep13_pp1 [label="Expert All-Reduce L7 SP1 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep13_tp0_pp1 -> layer_7_expert_ar_sp1_ep13_pp1
	layer_7_expert_out_sp1_ep13_tp1_pp1 -> layer_7_expert_ar_sp1_ep13_pp1
	layer_7_expert_out_sp1_ep13_tp2_pp1 -> layer_7_expert_ar_sp1_ep13_pp1
	layer_7_expert_out_sp1_ep13_tp3_pp1 -> layer_7_expert_ar_sp1_ep13_pp1
	layer_7_combine_sp1_ep13_pp1 [label="Token Combine L7 SP1 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep13_pp1 -> layer_7_combine_sp1_ep13_pp1
	layer_7_dispatch_sp1_ep14_pp1 [label="Token Dispatch L7 SP1 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep14_pp1 [style=dashed]
	layer_7_expert_sp1_ep14_tp0_pp1 [label="Expert L7 SP1 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep14_pp1 -> layer_7_expert_sp1_ep14_tp0_pp1
	layer_7_expert_out_sp1_ep14_tp0_pp1 [label="Expert Out L7 SP1 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep14_tp0_pp1 -> layer_7_expert_out_sp1_ep14_tp0_pp1
	layer_7_expert_sp1_ep14_tp1_pp1 [label="Expert L7 SP1 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep14_pp1 -> layer_7_expert_sp1_ep14_tp1_pp1
	layer_7_expert_out_sp1_ep14_tp1_pp1 [label="Expert Out L7 SP1 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep14_tp1_pp1 -> layer_7_expert_out_sp1_ep14_tp1_pp1
	layer_7_expert_sp1_ep14_tp2_pp1 [label="Expert L7 SP1 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep14_pp1 -> layer_7_expert_sp1_ep14_tp2_pp1
	layer_7_expert_out_sp1_ep14_tp2_pp1 [label="Expert Out L7 SP1 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep14_tp2_pp1 -> layer_7_expert_out_sp1_ep14_tp2_pp1
	layer_7_expert_sp1_ep14_tp3_pp1 [label="Expert L7 SP1 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep14_pp1 -> layer_7_expert_sp1_ep14_tp3_pp1
	layer_7_expert_out_sp1_ep14_tp3_pp1 [label="Expert Out L7 SP1 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep14_tp3_pp1 -> layer_7_expert_out_sp1_ep14_tp3_pp1
	layer_7_expert_ar_sp1_ep14_pp1 [label="Expert All-Reduce L7 SP1 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep14_tp0_pp1 -> layer_7_expert_ar_sp1_ep14_pp1
	layer_7_expert_out_sp1_ep14_tp1_pp1 -> layer_7_expert_ar_sp1_ep14_pp1
	layer_7_expert_out_sp1_ep14_tp2_pp1 -> layer_7_expert_ar_sp1_ep14_pp1
	layer_7_expert_out_sp1_ep14_tp3_pp1 -> layer_7_expert_ar_sp1_ep14_pp1
	layer_7_combine_sp1_ep14_pp1 [label="Token Combine L7 SP1 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep14_pp1 -> layer_7_combine_sp1_ep14_pp1
	layer_7_dispatch_sp1_ep15_pp1 [label="Token Dispatch L7 SP1 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp1_pp1 -> layer_7_dispatch_sp1_ep15_pp1 [style=dashed]
	layer_7_expert_sp1_ep15_tp0_pp1 [label="Expert L7 SP1 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep15_pp1 -> layer_7_expert_sp1_ep15_tp0_pp1
	layer_7_expert_out_sp1_ep15_tp0_pp1 [label="Expert Out L7 SP1 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep15_tp0_pp1 -> layer_7_expert_out_sp1_ep15_tp0_pp1
	layer_7_expert_sp1_ep15_tp1_pp1 [label="Expert L7 SP1 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep15_pp1 -> layer_7_expert_sp1_ep15_tp1_pp1
	layer_7_expert_out_sp1_ep15_tp1_pp1 [label="Expert Out L7 SP1 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep15_tp1_pp1 -> layer_7_expert_out_sp1_ep15_tp1_pp1
	layer_7_expert_sp1_ep15_tp2_pp1 [label="Expert L7 SP1 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep15_pp1 -> layer_7_expert_sp1_ep15_tp2_pp1
	layer_7_expert_out_sp1_ep15_tp2_pp1 [label="Expert Out L7 SP1 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep15_tp2_pp1 -> layer_7_expert_out_sp1_ep15_tp2_pp1
	layer_7_expert_sp1_ep15_tp3_pp1 [label="Expert L7 SP1 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp1_ep15_pp1 -> layer_7_expert_sp1_ep15_tp3_pp1
	layer_7_expert_out_sp1_ep15_tp3_pp1 [label="Expert Out L7 SP1 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp1_ep15_tp3_pp1 -> layer_7_expert_out_sp1_ep15_tp3_pp1
	layer_7_expert_ar_sp1_ep15_pp1 [label="Expert All-Reduce L7 SP1 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp1_ep15_tp0_pp1 -> layer_7_expert_ar_sp1_ep15_pp1
	layer_7_expert_out_sp1_ep15_tp1_pp1 -> layer_7_expert_ar_sp1_ep15_pp1
	layer_7_expert_out_sp1_ep15_tp2_pp1 -> layer_7_expert_ar_sp1_ep15_pp1
	layer_7_expert_out_sp1_ep15_tp3_pp1 -> layer_7_expert_ar_sp1_ep15_pp1
	layer_7_combine_sp1_ep15_pp1 [label="Token Combine L7 SP1 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp1_ep15_pp1 -> layer_7_combine_sp1_ep15_pp1
	layer_7_moe_all2all_sp1_pp1 [label="MoE All-to-All L7 SP1\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_7_combine_sp1_ep0_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep1_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep2_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep3_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep4_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep5_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep6_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep7_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep8_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep9_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep10_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep11_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep12_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep13_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep14_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_combine_sp1_ep15_pp1 -> layer_7_moe_all2all_sp1_pp1
	layer_7_mlp_out_sp1_pp1 [label="MoE Output L7 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_moe_all2all_sp1_pp1 -> layer_7_mlp_out_sp1_pp1
	layer_7_mlp_res_sp1_pp1 [label="MLP Residual L7 SP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_mlp_out_sp1_pp1 -> layer_7_mlp_res_sp1_pp1
	layer_7_attn_res_sp1_pp1 -> layer_7_mlp_res_sp1_pp1 [style=dashed]
	layer_7_norm_sp2_pp1 [label="LayerNorm L7 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_mlp_out_sp2_pp1 -> layer_7_norm_sp2_pp1
	layer_7_qkv_sp2_tp0_pp1 [label="QKV Proj L7 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp2_pp1 -> layer_7_qkv_sp2_tp0_pp1
	layer_7_attn_sp2_tp0_pp1 [label="Attention L7 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp2_tp0_pp1 -> layer_7_attn_sp2_tp0_pp1
	layer_7_attn_out_sp2_tp0_pp1 [label="Attn Out Proj L7 SP2 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp2_tp0_pp1 -> layer_7_attn_out_sp2_tp0_pp1
	layer_7_qkv_sp2_tp1_pp1 [label="QKV Proj L7 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp2_pp1 -> layer_7_qkv_sp2_tp1_pp1
	layer_7_attn_sp2_tp1_pp1 [label="Attention L7 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp2_tp1_pp1 -> layer_7_attn_sp2_tp1_pp1
	layer_7_attn_out_sp2_tp1_pp1 [label="Attn Out Proj L7 SP2 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp2_tp1_pp1 -> layer_7_attn_out_sp2_tp1_pp1
	layer_7_qkv_sp2_tp2_pp1 [label="QKV Proj L7 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp2_pp1 -> layer_7_qkv_sp2_tp2_pp1
	layer_7_attn_sp2_tp2_pp1 [label="Attention L7 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp2_tp2_pp1 -> layer_7_attn_sp2_tp2_pp1
	layer_7_attn_out_sp2_tp2_pp1 [label="Attn Out Proj L7 SP2 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp2_tp2_pp1 -> layer_7_attn_out_sp2_tp2_pp1
	layer_7_qkv_sp2_tp3_pp1 [label="QKV Proj L7 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp2_pp1 -> layer_7_qkv_sp2_tp3_pp1
	layer_7_attn_sp2_tp3_pp1 [label="Attention L7 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp2_tp3_pp1 -> layer_7_attn_sp2_tp3_pp1
	layer_7_attn_out_sp2_tp3_pp1 [label="Attn Out Proj L7 SP2 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp2_tp3_pp1 -> layer_7_attn_out_sp2_tp3_pp1
	layer_7_attn_ar_sp2_pp1 [label="Attention All-Reduce L7 SP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_attn_out_sp2_tp0_pp1 -> layer_7_attn_ar_sp2_pp1
	layer_7_attn_out_sp2_tp1_pp1 -> layer_7_attn_ar_sp2_pp1
	layer_7_attn_out_sp2_tp2_pp1 -> layer_7_attn_ar_sp2_pp1
	layer_7_attn_out_sp2_tp3_pp1 -> layer_7_attn_ar_sp2_pp1
	layer_7_attn_res_sp2_pp1 [label="Attention Residual L7 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_attn_ar_sp2_pp1 -> layer_7_attn_res_sp2_pp1
	layer_7_norm_sp2_pp1 -> layer_7_attn_res_sp2_pp1 [style=dashed]
	layer_7_post_norm_sp2_pp1 [label="Post-Attn Norm L7 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_attn_res_sp2_pp1 -> layer_7_post_norm_sp2_pp1
	layer_7_router_sp2_pp1 [label="MoE Router L7 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_7_post_norm_sp2_pp1 -> layer_7_router_sp2_pp1
	layer_7_dispatch_sp2_ep0_pp1 [label="Token Dispatch L7 SP2 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep0_pp1 [style=dashed]
	layer_7_expert_sp2_ep0_tp0_pp1 [label="Expert L7 SP2 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep0_pp1 -> layer_7_expert_sp2_ep0_tp0_pp1
	layer_7_expert_out_sp2_ep0_tp0_pp1 [label="Expert Out L7 SP2 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep0_tp0_pp1 -> layer_7_expert_out_sp2_ep0_tp0_pp1
	layer_7_expert_sp2_ep0_tp1_pp1 [label="Expert L7 SP2 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep0_pp1 -> layer_7_expert_sp2_ep0_tp1_pp1
	layer_7_expert_out_sp2_ep0_tp1_pp1 [label="Expert Out L7 SP2 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep0_tp1_pp1 -> layer_7_expert_out_sp2_ep0_tp1_pp1
	layer_7_expert_sp2_ep0_tp2_pp1 [label="Expert L7 SP2 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep0_pp1 -> layer_7_expert_sp2_ep0_tp2_pp1
	layer_7_expert_out_sp2_ep0_tp2_pp1 [label="Expert Out L7 SP2 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep0_tp2_pp1 -> layer_7_expert_out_sp2_ep0_tp2_pp1
	layer_7_expert_sp2_ep0_tp3_pp1 [label="Expert L7 SP2 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep0_pp1 -> layer_7_expert_sp2_ep0_tp3_pp1
	layer_7_expert_out_sp2_ep0_tp3_pp1 [label="Expert Out L7 SP2 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep0_tp3_pp1 -> layer_7_expert_out_sp2_ep0_tp3_pp1
	layer_7_expert_ar_sp2_ep0_pp1 [label="Expert All-Reduce L7 SP2 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep0_tp0_pp1 -> layer_7_expert_ar_sp2_ep0_pp1
	layer_7_expert_out_sp2_ep0_tp1_pp1 -> layer_7_expert_ar_sp2_ep0_pp1
	layer_7_expert_out_sp2_ep0_tp2_pp1 -> layer_7_expert_ar_sp2_ep0_pp1
	layer_7_expert_out_sp2_ep0_tp3_pp1 -> layer_7_expert_ar_sp2_ep0_pp1
	layer_7_combine_sp2_ep0_pp1 [label="Token Combine L7 SP2 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep0_pp1 -> layer_7_combine_sp2_ep0_pp1
	layer_7_dispatch_sp2_ep1_pp1 [label="Token Dispatch L7 SP2 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep1_pp1 [style=dashed]
	layer_7_expert_sp2_ep1_tp0_pp1 [label="Expert L7 SP2 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep1_pp1 -> layer_7_expert_sp2_ep1_tp0_pp1
	layer_7_expert_out_sp2_ep1_tp0_pp1 [label="Expert Out L7 SP2 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep1_tp0_pp1 -> layer_7_expert_out_sp2_ep1_tp0_pp1
	layer_7_expert_sp2_ep1_tp1_pp1 [label="Expert L7 SP2 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep1_pp1 -> layer_7_expert_sp2_ep1_tp1_pp1
	layer_7_expert_out_sp2_ep1_tp1_pp1 [label="Expert Out L7 SP2 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep1_tp1_pp1 -> layer_7_expert_out_sp2_ep1_tp1_pp1
	layer_7_expert_sp2_ep1_tp2_pp1 [label="Expert L7 SP2 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep1_pp1 -> layer_7_expert_sp2_ep1_tp2_pp1
	layer_7_expert_out_sp2_ep1_tp2_pp1 [label="Expert Out L7 SP2 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep1_tp2_pp1 -> layer_7_expert_out_sp2_ep1_tp2_pp1
	layer_7_expert_sp2_ep1_tp3_pp1 [label="Expert L7 SP2 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep1_pp1 -> layer_7_expert_sp2_ep1_tp3_pp1
	layer_7_expert_out_sp2_ep1_tp3_pp1 [label="Expert Out L7 SP2 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep1_tp3_pp1 -> layer_7_expert_out_sp2_ep1_tp3_pp1
	layer_7_expert_ar_sp2_ep1_pp1 [label="Expert All-Reduce L7 SP2 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep1_tp0_pp1 -> layer_7_expert_ar_sp2_ep1_pp1
	layer_7_expert_out_sp2_ep1_tp1_pp1 -> layer_7_expert_ar_sp2_ep1_pp1
	layer_7_expert_out_sp2_ep1_tp2_pp1 -> layer_7_expert_ar_sp2_ep1_pp1
	layer_7_expert_out_sp2_ep1_tp3_pp1 -> layer_7_expert_ar_sp2_ep1_pp1
	layer_7_combine_sp2_ep1_pp1 [label="Token Combine L7 SP2 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep1_pp1 -> layer_7_combine_sp2_ep1_pp1
	layer_7_dispatch_sp2_ep2_pp1 [label="Token Dispatch L7 SP2 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep2_pp1 [style=dashed]
	layer_7_expert_sp2_ep2_tp0_pp1 [label="Expert L7 SP2 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep2_pp1 -> layer_7_expert_sp2_ep2_tp0_pp1
	layer_7_expert_out_sp2_ep2_tp0_pp1 [label="Expert Out L7 SP2 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep2_tp0_pp1 -> layer_7_expert_out_sp2_ep2_tp0_pp1
	layer_7_expert_sp2_ep2_tp1_pp1 [label="Expert L7 SP2 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep2_pp1 -> layer_7_expert_sp2_ep2_tp1_pp1
	layer_7_expert_out_sp2_ep2_tp1_pp1 [label="Expert Out L7 SP2 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep2_tp1_pp1 -> layer_7_expert_out_sp2_ep2_tp1_pp1
	layer_7_expert_sp2_ep2_tp2_pp1 [label="Expert L7 SP2 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep2_pp1 -> layer_7_expert_sp2_ep2_tp2_pp1
	layer_7_expert_out_sp2_ep2_tp2_pp1 [label="Expert Out L7 SP2 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep2_tp2_pp1 -> layer_7_expert_out_sp2_ep2_tp2_pp1
	layer_7_expert_sp2_ep2_tp3_pp1 [label="Expert L7 SP2 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep2_pp1 -> layer_7_expert_sp2_ep2_tp3_pp1
	layer_7_expert_out_sp2_ep2_tp3_pp1 [label="Expert Out L7 SP2 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep2_tp3_pp1 -> layer_7_expert_out_sp2_ep2_tp3_pp1
	layer_7_expert_ar_sp2_ep2_pp1 [label="Expert All-Reduce L7 SP2 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep2_tp0_pp1 -> layer_7_expert_ar_sp2_ep2_pp1
	layer_7_expert_out_sp2_ep2_tp1_pp1 -> layer_7_expert_ar_sp2_ep2_pp1
	layer_7_expert_out_sp2_ep2_tp2_pp1 -> layer_7_expert_ar_sp2_ep2_pp1
	layer_7_expert_out_sp2_ep2_tp3_pp1 -> layer_7_expert_ar_sp2_ep2_pp1
	layer_7_combine_sp2_ep2_pp1 [label="Token Combine L7 SP2 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep2_pp1 -> layer_7_combine_sp2_ep2_pp1
	layer_7_dispatch_sp2_ep3_pp1 [label="Token Dispatch L7 SP2 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep3_pp1 [style=dashed]
	layer_7_expert_sp2_ep3_tp0_pp1 [label="Expert L7 SP2 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep3_pp1 -> layer_7_expert_sp2_ep3_tp0_pp1
	layer_7_expert_out_sp2_ep3_tp0_pp1 [label="Expert Out L7 SP2 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep3_tp0_pp1 -> layer_7_expert_out_sp2_ep3_tp0_pp1
	layer_7_expert_sp2_ep3_tp1_pp1 [label="Expert L7 SP2 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep3_pp1 -> layer_7_expert_sp2_ep3_tp1_pp1
	layer_7_expert_out_sp2_ep3_tp1_pp1 [label="Expert Out L7 SP2 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep3_tp1_pp1 -> layer_7_expert_out_sp2_ep3_tp1_pp1
	layer_7_expert_sp2_ep3_tp2_pp1 [label="Expert L7 SP2 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep3_pp1 -> layer_7_expert_sp2_ep3_tp2_pp1
	layer_7_expert_out_sp2_ep3_tp2_pp1 [label="Expert Out L7 SP2 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep3_tp2_pp1 -> layer_7_expert_out_sp2_ep3_tp2_pp1
	layer_7_expert_sp2_ep3_tp3_pp1 [label="Expert L7 SP2 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep3_pp1 -> layer_7_expert_sp2_ep3_tp3_pp1
	layer_7_expert_out_sp2_ep3_tp3_pp1 [label="Expert Out L7 SP2 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep3_tp3_pp1 -> layer_7_expert_out_sp2_ep3_tp3_pp1
	layer_7_expert_ar_sp2_ep3_pp1 [label="Expert All-Reduce L7 SP2 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep3_tp0_pp1 -> layer_7_expert_ar_sp2_ep3_pp1
	layer_7_expert_out_sp2_ep3_tp1_pp1 -> layer_7_expert_ar_sp2_ep3_pp1
	layer_7_expert_out_sp2_ep3_tp2_pp1 -> layer_7_expert_ar_sp2_ep3_pp1
	layer_7_expert_out_sp2_ep3_tp3_pp1 -> layer_7_expert_ar_sp2_ep3_pp1
	layer_7_combine_sp2_ep3_pp1 [label="Token Combine L7 SP2 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep3_pp1 -> layer_7_combine_sp2_ep3_pp1
	layer_7_dispatch_sp2_ep4_pp1 [label="Token Dispatch L7 SP2 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep4_pp1 [style=dashed]
	layer_7_expert_sp2_ep4_tp0_pp1 [label="Expert L7 SP2 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep4_pp1 -> layer_7_expert_sp2_ep4_tp0_pp1
	layer_7_expert_out_sp2_ep4_tp0_pp1 [label="Expert Out L7 SP2 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep4_tp0_pp1 -> layer_7_expert_out_sp2_ep4_tp0_pp1
	layer_7_expert_sp2_ep4_tp1_pp1 [label="Expert L7 SP2 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep4_pp1 -> layer_7_expert_sp2_ep4_tp1_pp1
	layer_7_expert_out_sp2_ep4_tp1_pp1 [label="Expert Out L7 SP2 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep4_tp1_pp1 -> layer_7_expert_out_sp2_ep4_tp1_pp1
	layer_7_expert_sp2_ep4_tp2_pp1 [label="Expert L7 SP2 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep4_pp1 -> layer_7_expert_sp2_ep4_tp2_pp1
	layer_7_expert_out_sp2_ep4_tp2_pp1 [label="Expert Out L7 SP2 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep4_tp2_pp1 -> layer_7_expert_out_sp2_ep4_tp2_pp1
	layer_7_expert_sp2_ep4_tp3_pp1 [label="Expert L7 SP2 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep4_pp1 -> layer_7_expert_sp2_ep4_tp3_pp1
	layer_7_expert_out_sp2_ep4_tp3_pp1 [label="Expert Out L7 SP2 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep4_tp3_pp1 -> layer_7_expert_out_sp2_ep4_tp3_pp1
	layer_7_expert_ar_sp2_ep4_pp1 [label="Expert All-Reduce L7 SP2 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep4_tp0_pp1 -> layer_7_expert_ar_sp2_ep4_pp1
	layer_7_expert_out_sp2_ep4_tp1_pp1 -> layer_7_expert_ar_sp2_ep4_pp1
	layer_7_expert_out_sp2_ep4_tp2_pp1 -> layer_7_expert_ar_sp2_ep4_pp1
	layer_7_expert_out_sp2_ep4_tp3_pp1 -> layer_7_expert_ar_sp2_ep4_pp1
	layer_7_combine_sp2_ep4_pp1 [label="Token Combine L7 SP2 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep4_pp1 -> layer_7_combine_sp2_ep4_pp1
	layer_7_dispatch_sp2_ep5_pp1 [label="Token Dispatch L7 SP2 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep5_pp1 [style=dashed]
	layer_7_expert_sp2_ep5_tp0_pp1 [label="Expert L7 SP2 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep5_pp1 -> layer_7_expert_sp2_ep5_tp0_pp1
	layer_7_expert_out_sp2_ep5_tp0_pp1 [label="Expert Out L7 SP2 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep5_tp0_pp1 -> layer_7_expert_out_sp2_ep5_tp0_pp1
	layer_7_expert_sp2_ep5_tp1_pp1 [label="Expert L7 SP2 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep5_pp1 -> layer_7_expert_sp2_ep5_tp1_pp1
	layer_7_expert_out_sp2_ep5_tp1_pp1 [label="Expert Out L7 SP2 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep5_tp1_pp1 -> layer_7_expert_out_sp2_ep5_tp1_pp1
	layer_7_expert_sp2_ep5_tp2_pp1 [label="Expert L7 SP2 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep5_pp1 -> layer_7_expert_sp2_ep5_tp2_pp1
	layer_7_expert_out_sp2_ep5_tp2_pp1 [label="Expert Out L7 SP2 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep5_tp2_pp1 -> layer_7_expert_out_sp2_ep5_tp2_pp1
	layer_7_expert_sp2_ep5_tp3_pp1 [label="Expert L7 SP2 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep5_pp1 -> layer_7_expert_sp2_ep5_tp3_pp1
	layer_7_expert_out_sp2_ep5_tp3_pp1 [label="Expert Out L7 SP2 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep5_tp3_pp1 -> layer_7_expert_out_sp2_ep5_tp3_pp1
	layer_7_expert_ar_sp2_ep5_pp1 [label="Expert All-Reduce L7 SP2 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep5_tp0_pp1 -> layer_7_expert_ar_sp2_ep5_pp1
	layer_7_expert_out_sp2_ep5_tp1_pp1 -> layer_7_expert_ar_sp2_ep5_pp1
	layer_7_expert_out_sp2_ep5_tp2_pp1 -> layer_7_expert_ar_sp2_ep5_pp1
	layer_7_expert_out_sp2_ep5_tp3_pp1 -> layer_7_expert_ar_sp2_ep5_pp1
	layer_7_combine_sp2_ep5_pp1 [label="Token Combine L7 SP2 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep5_pp1 -> layer_7_combine_sp2_ep5_pp1
	layer_7_dispatch_sp2_ep6_pp1 [label="Token Dispatch L7 SP2 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep6_pp1 [style=dashed]
	layer_7_expert_sp2_ep6_tp0_pp1 [label="Expert L7 SP2 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep6_pp1 -> layer_7_expert_sp2_ep6_tp0_pp1
	layer_7_expert_out_sp2_ep6_tp0_pp1 [label="Expert Out L7 SP2 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep6_tp0_pp1 -> layer_7_expert_out_sp2_ep6_tp0_pp1
	layer_7_expert_sp2_ep6_tp1_pp1 [label="Expert L7 SP2 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep6_pp1 -> layer_7_expert_sp2_ep6_tp1_pp1
	layer_7_expert_out_sp2_ep6_tp1_pp1 [label="Expert Out L7 SP2 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep6_tp1_pp1 -> layer_7_expert_out_sp2_ep6_tp1_pp1
	layer_7_expert_sp2_ep6_tp2_pp1 [label="Expert L7 SP2 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep6_pp1 -> layer_7_expert_sp2_ep6_tp2_pp1
	layer_7_expert_out_sp2_ep6_tp2_pp1 [label="Expert Out L7 SP2 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep6_tp2_pp1 -> layer_7_expert_out_sp2_ep6_tp2_pp1
	layer_7_expert_sp2_ep6_tp3_pp1 [label="Expert L7 SP2 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep6_pp1 -> layer_7_expert_sp2_ep6_tp3_pp1
	layer_7_expert_out_sp2_ep6_tp3_pp1 [label="Expert Out L7 SP2 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep6_tp3_pp1 -> layer_7_expert_out_sp2_ep6_tp3_pp1
	layer_7_expert_ar_sp2_ep6_pp1 [label="Expert All-Reduce L7 SP2 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep6_tp0_pp1 -> layer_7_expert_ar_sp2_ep6_pp1
	layer_7_expert_out_sp2_ep6_tp1_pp1 -> layer_7_expert_ar_sp2_ep6_pp1
	layer_7_expert_out_sp2_ep6_tp2_pp1 -> layer_7_expert_ar_sp2_ep6_pp1
	layer_7_expert_out_sp2_ep6_tp3_pp1 -> layer_7_expert_ar_sp2_ep6_pp1
	layer_7_combine_sp2_ep6_pp1 [label="Token Combine L7 SP2 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep6_pp1 -> layer_7_combine_sp2_ep6_pp1
	layer_7_dispatch_sp2_ep7_pp1 [label="Token Dispatch L7 SP2 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep7_pp1 [style=dashed]
	layer_7_expert_sp2_ep7_tp0_pp1 [label="Expert L7 SP2 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep7_pp1 -> layer_7_expert_sp2_ep7_tp0_pp1
	layer_7_expert_out_sp2_ep7_tp0_pp1 [label="Expert Out L7 SP2 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep7_tp0_pp1 -> layer_7_expert_out_sp2_ep7_tp0_pp1
	layer_7_expert_sp2_ep7_tp1_pp1 [label="Expert L7 SP2 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep7_pp1 -> layer_7_expert_sp2_ep7_tp1_pp1
	layer_7_expert_out_sp2_ep7_tp1_pp1 [label="Expert Out L7 SP2 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep7_tp1_pp1 -> layer_7_expert_out_sp2_ep7_tp1_pp1
	layer_7_expert_sp2_ep7_tp2_pp1 [label="Expert L7 SP2 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep7_pp1 -> layer_7_expert_sp2_ep7_tp2_pp1
	layer_7_expert_out_sp2_ep7_tp2_pp1 [label="Expert Out L7 SP2 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep7_tp2_pp1 -> layer_7_expert_out_sp2_ep7_tp2_pp1
	layer_7_expert_sp2_ep7_tp3_pp1 [label="Expert L7 SP2 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep7_pp1 -> layer_7_expert_sp2_ep7_tp3_pp1
	layer_7_expert_out_sp2_ep7_tp3_pp1 [label="Expert Out L7 SP2 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep7_tp3_pp1 -> layer_7_expert_out_sp2_ep7_tp3_pp1
	layer_7_expert_ar_sp2_ep7_pp1 [label="Expert All-Reduce L7 SP2 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep7_tp0_pp1 -> layer_7_expert_ar_sp2_ep7_pp1
	layer_7_expert_out_sp2_ep7_tp1_pp1 -> layer_7_expert_ar_sp2_ep7_pp1
	layer_7_expert_out_sp2_ep7_tp2_pp1 -> layer_7_expert_ar_sp2_ep7_pp1
	layer_7_expert_out_sp2_ep7_tp3_pp1 -> layer_7_expert_ar_sp2_ep7_pp1
	layer_7_combine_sp2_ep7_pp1 [label="Token Combine L7 SP2 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep7_pp1 -> layer_7_combine_sp2_ep7_pp1
	layer_7_dispatch_sp2_ep8_pp1 [label="Token Dispatch L7 SP2 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep8_pp1 [style=dashed]
	layer_7_expert_sp2_ep8_tp0_pp1 [label="Expert L7 SP2 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep8_pp1 -> layer_7_expert_sp2_ep8_tp0_pp1
	layer_7_expert_out_sp2_ep8_tp0_pp1 [label="Expert Out L7 SP2 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep8_tp0_pp1 -> layer_7_expert_out_sp2_ep8_tp0_pp1
	layer_7_expert_sp2_ep8_tp1_pp1 [label="Expert L7 SP2 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep8_pp1 -> layer_7_expert_sp2_ep8_tp1_pp1
	layer_7_expert_out_sp2_ep8_tp1_pp1 [label="Expert Out L7 SP2 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep8_tp1_pp1 -> layer_7_expert_out_sp2_ep8_tp1_pp1
	layer_7_expert_sp2_ep8_tp2_pp1 [label="Expert L7 SP2 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep8_pp1 -> layer_7_expert_sp2_ep8_tp2_pp1
	layer_7_expert_out_sp2_ep8_tp2_pp1 [label="Expert Out L7 SP2 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep8_tp2_pp1 -> layer_7_expert_out_sp2_ep8_tp2_pp1
	layer_7_expert_sp2_ep8_tp3_pp1 [label="Expert L7 SP2 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep8_pp1 -> layer_7_expert_sp2_ep8_tp3_pp1
	layer_7_expert_out_sp2_ep8_tp3_pp1 [label="Expert Out L7 SP2 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep8_tp3_pp1 -> layer_7_expert_out_sp2_ep8_tp3_pp1
	layer_7_expert_ar_sp2_ep8_pp1 [label="Expert All-Reduce L7 SP2 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep8_tp0_pp1 -> layer_7_expert_ar_sp2_ep8_pp1
	layer_7_expert_out_sp2_ep8_tp1_pp1 -> layer_7_expert_ar_sp2_ep8_pp1
	layer_7_expert_out_sp2_ep8_tp2_pp1 -> layer_7_expert_ar_sp2_ep8_pp1
	layer_7_expert_out_sp2_ep8_tp3_pp1 -> layer_7_expert_ar_sp2_ep8_pp1
	layer_7_combine_sp2_ep8_pp1 [label="Token Combine L7 SP2 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep8_pp1 -> layer_7_combine_sp2_ep8_pp1
	layer_7_dispatch_sp2_ep9_pp1 [label="Token Dispatch L7 SP2 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep9_pp1 [style=dashed]
	layer_7_expert_sp2_ep9_tp0_pp1 [label="Expert L7 SP2 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep9_pp1 -> layer_7_expert_sp2_ep9_tp0_pp1
	layer_7_expert_out_sp2_ep9_tp0_pp1 [label="Expert Out L7 SP2 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep9_tp0_pp1 -> layer_7_expert_out_sp2_ep9_tp0_pp1
	layer_7_expert_sp2_ep9_tp1_pp1 [label="Expert L7 SP2 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep9_pp1 -> layer_7_expert_sp2_ep9_tp1_pp1
	layer_7_expert_out_sp2_ep9_tp1_pp1 [label="Expert Out L7 SP2 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep9_tp1_pp1 -> layer_7_expert_out_sp2_ep9_tp1_pp1
	layer_7_expert_sp2_ep9_tp2_pp1 [label="Expert L7 SP2 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep9_pp1 -> layer_7_expert_sp2_ep9_tp2_pp1
	layer_7_expert_out_sp2_ep9_tp2_pp1 [label="Expert Out L7 SP2 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep9_tp2_pp1 -> layer_7_expert_out_sp2_ep9_tp2_pp1
	layer_7_expert_sp2_ep9_tp3_pp1 [label="Expert L7 SP2 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep9_pp1 -> layer_7_expert_sp2_ep9_tp3_pp1
	layer_7_expert_out_sp2_ep9_tp3_pp1 [label="Expert Out L7 SP2 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep9_tp3_pp1 -> layer_7_expert_out_sp2_ep9_tp3_pp1
	layer_7_expert_ar_sp2_ep9_pp1 [label="Expert All-Reduce L7 SP2 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep9_tp0_pp1 -> layer_7_expert_ar_sp2_ep9_pp1
	layer_7_expert_out_sp2_ep9_tp1_pp1 -> layer_7_expert_ar_sp2_ep9_pp1
	layer_7_expert_out_sp2_ep9_tp2_pp1 -> layer_7_expert_ar_sp2_ep9_pp1
	layer_7_expert_out_sp2_ep9_tp3_pp1 -> layer_7_expert_ar_sp2_ep9_pp1
	layer_7_combine_sp2_ep9_pp1 [label="Token Combine L7 SP2 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep9_pp1 -> layer_7_combine_sp2_ep9_pp1
	layer_7_dispatch_sp2_ep10_pp1 [label="Token Dispatch L7 SP2 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep10_pp1 [style=dashed]
	layer_7_expert_sp2_ep10_tp0_pp1 [label="Expert L7 SP2 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep10_pp1 -> layer_7_expert_sp2_ep10_tp0_pp1
	layer_7_expert_out_sp2_ep10_tp0_pp1 [label="Expert Out L7 SP2 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep10_tp0_pp1 -> layer_7_expert_out_sp2_ep10_tp0_pp1
	layer_7_expert_sp2_ep10_tp1_pp1 [label="Expert L7 SP2 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep10_pp1 -> layer_7_expert_sp2_ep10_tp1_pp1
	layer_7_expert_out_sp2_ep10_tp1_pp1 [label="Expert Out L7 SP2 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep10_tp1_pp1 -> layer_7_expert_out_sp2_ep10_tp1_pp1
	layer_7_expert_sp2_ep10_tp2_pp1 [label="Expert L7 SP2 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep10_pp1 -> layer_7_expert_sp2_ep10_tp2_pp1
	layer_7_expert_out_sp2_ep10_tp2_pp1 [label="Expert Out L7 SP2 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep10_tp2_pp1 -> layer_7_expert_out_sp2_ep10_tp2_pp1
	layer_7_expert_sp2_ep10_tp3_pp1 [label="Expert L7 SP2 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep10_pp1 -> layer_7_expert_sp2_ep10_tp3_pp1
	layer_7_expert_out_sp2_ep10_tp3_pp1 [label="Expert Out L7 SP2 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep10_tp3_pp1 -> layer_7_expert_out_sp2_ep10_tp3_pp1
	layer_7_expert_ar_sp2_ep10_pp1 [label="Expert All-Reduce L7 SP2 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep10_tp0_pp1 -> layer_7_expert_ar_sp2_ep10_pp1
	layer_7_expert_out_sp2_ep10_tp1_pp1 -> layer_7_expert_ar_sp2_ep10_pp1
	layer_7_expert_out_sp2_ep10_tp2_pp1 -> layer_7_expert_ar_sp2_ep10_pp1
	layer_7_expert_out_sp2_ep10_tp3_pp1 -> layer_7_expert_ar_sp2_ep10_pp1
	layer_7_combine_sp2_ep10_pp1 [label="Token Combine L7 SP2 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep10_pp1 -> layer_7_combine_sp2_ep10_pp1
	layer_7_dispatch_sp2_ep11_pp1 [label="Token Dispatch L7 SP2 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep11_pp1 [style=dashed]
	layer_7_expert_sp2_ep11_tp0_pp1 [label="Expert L7 SP2 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep11_pp1 -> layer_7_expert_sp2_ep11_tp0_pp1
	layer_7_expert_out_sp2_ep11_tp0_pp1 [label="Expert Out L7 SP2 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep11_tp0_pp1 -> layer_7_expert_out_sp2_ep11_tp0_pp1
	layer_7_expert_sp2_ep11_tp1_pp1 [label="Expert L7 SP2 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep11_pp1 -> layer_7_expert_sp2_ep11_tp1_pp1
	layer_7_expert_out_sp2_ep11_tp1_pp1 [label="Expert Out L7 SP2 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep11_tp1_pp1 -> layer_7_expert_out_sp2_ep11_tp1_pp1
	layer_7_expert_sp2_ep11_tp2_pp1 [label="Expert L7 SP2 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep11_pp1 -> layer_7_expert_sp2_ep11_tp2_pp1
	layer_7_expert_out_sp2_ep11_tp2_pp1 [label="Expert Out L7 SP2 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep11_tp2_pp1 -> layer_7_expert_out_sp2_ep11_tp2_pp1
	layer_7_expert_sp2_ep11_tp3_pp1 [label="Expert L7 SP2 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep11_pp1 -> layer_7_expert_sp2_ep11_tp3_pp1
	layer_7_expert_out_sp2_ep11_tp3_pp1 [label="Expert Out L7 SP2 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep11_tp3_pp1 -> layer_7_expert_out_sp2_ep11_tp3_pp1
	layer_7_expert_ar_sp2_ep11_pp1 [label="Expert All-Reduce L7 SP2 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep11_tp0_pp1 -> layer_7_expert_ar_sp2_ep11_pp1
	layer_7_expert_out_sp2_ep11_tp1_pp1 -> layer_7_expert_ar_sp2_ep11_pp1
	layer_7_expert_out_sp2_ep11_tp2_pp1 -> layer_7_expert_ar_sp2_ep11_pp1
	layer_7_expert_out_sp2_ep11_tp3_pp1 -> layer_7_expert_ar_sp2_ep11_pp1
	layer_7_combine_sp2_ep11_pp1 [label="Token Combine L7 SP2 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep11_pp1 -> layer_7_combine_sp2_ep11_pp1
	layer_7_dispatch_sp2_ep12_pp1 [label="Token Dispatch L7 SP2 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep12_pp1 [style=dashed]
	layer_7_expert_sp2_ep12_tp0_pp1 [label="Expert L7 SP2 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep12_pp1 -> layer_7_expert_sp2_ep12_tp0_pp1
	layer_7_expert_out_sp2_ep12_tp0_pp1 [label="Expert Out L7 SP2 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep12_tp0_pp1 -> layer_7_expert_out_sp2_ep12_tp0_pp1
	layer_7_expert_sp2_ep12_tp1_pp1 [label="Expert L7 SP2 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep12_pp1 -> layer_7_expert_sp2_ep12_tp1_pp1
	layer_7_expert_out_sp2_ep12_tp1_pp1 [label="Expert Out L7 SP2 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep12_tp1_pp1 -> layer_7_expert_out_sp2_ep12_tp1_pp1
	layer_7_expert_sp2_ep12_tp2_pp1 [label="Expert L7 SP2 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep12_pp1 -> layer_7_expert_sp2_ep12_tp2_pp1
	layer_7_expert_out_sp2_ep12_tp2_pp1 [label="Expert Out L7 SP2 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep12_tp2_pp1 -> layer_7_expert_out_sp2_ep12_tp2_pp1
	layer_7_expert_sp2_ep12_tp3_pp1 [label="Expert L7 SP2 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep12_pp1 -> layer_7_expert_sp2_ep12_tp3_pp1
	layer_7_expert_out_sp2_ep12_tp3_pp1 [label="Expert Out L7 SP2 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep12_tp3_pp1 -> layer_7_expert_out_sp2_ep12_tp3_pp1
	layer_7_expert_ar_sp2_ep12_pp1 [label="Expert All-Reduce L7 SP2 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep12_tp0_pp1 -> layer_7_expert_ar_sp2_ep12_pp1
	layer_7_expert_out_sp2_ep12_tp1_pp1 -> layer_7_expert_ar_sp2_ep12_pp1
	layer_7_expert_out_sp2_ep12_tp2_pp1 -> layer_7_expert_ar_sp2_ep12_pp1
	layer_7_expert_out_sp2_ep12_tp3_pp1 -> layer_7_expert_ar_sp2_ep12_pp1
	layer_7_combine_sp2_ep12_pp1 [label="Token Combine L7 SP2 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep12_pp1 -> layer_7_combine_sp2_ep12_pp1
	layer_7_dispatch_sp2_ep13_pp1 [label="Token Dispatch L7 SP2 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep13_pp1 [style=dashed]
	layer_7_expert_sp2_ep13_tp0_pp1 [label="Expert L7 SP2 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep13_pp1 -> layer_7_expert_sp2_ep13_tp0_pp1
	layer_7_expert_out_sp2_ep13_tp0_pp1 [label="Expert Out L7 SP2 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep13_tp0_pp1 -> layer_7_expert_out_sp2_ep13_tp0_pp1
	layer_7_expert_sp2_ep13_tp1_pp1 [label="Expert L7 SP2 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep13_pp1 -> layer_7_expert_sp2_ep13_tp1_pp1
	layer_7_expert_out_sp2_ep13_tp1_pp1 [label="Expert Out L7 SP2 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep13_tp1_pp1 -> layer_7_expert_out_sp2_ep13_tp1_pp1
	layer_7_expert_sp2_ep13_tp2_pp1 [label="Expert L7 SP2 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep13_pp1 -> layer_7_expert_sp2_ep13_tp2_pp1
	layer_7_expert_out_sp2_ep13_tp2_pp1 [label="Expert Out L7 SP2 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep13_tp2_pp1 -> layer_7_expert_out_sp2_ep13_tp2_pp1
	layer_7_expert_sp2_ep13_tp3_pp1 [label="Expert L7 SP2 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep13_pp1 -> layer_7_expert_sp2_ep13_tp3_pp1
	layer_7_expert_out_sp2_ep13_tp3_pp1 [label="Expert Out L7 SP2 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep13_tp3_pp1 -> layer_7_expert_out_sp2_ep13_tp3_pp1
	layer_7_expert_ar_sp2_ep13_pp1 [label="Expert All-Reduce L7 SP2 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep13_tp0_pp1 -> layer_7_expert_ar_sp2_ep13_pp1
	layer_7_expert_out_sp2_ep13_tp1_pp1 -> layer_7_expert_ar_sp2_ep13_pp1
	layer_7_expert_out_sp2_ep13_tp2_pp1 -> layer_7_expert_ar_sp2_ep13_pp1
	layer_7_expert_out_sp2_ep13_tp3_pp1 -> layer_7_expert_ar_sp2_ep13_pp1
	layer_7_combine_sp2_ep13_pp1 [label="Token Combine L7 SP2 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep13_pp1 -> layer_7_combine_sp2_ep13_pp1
	layer_7_dispatch_sp2_ep14_pp1 [label="Token Dispatch L7 SP2 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep14_pp1 [style=dashed]
	layer_7_expert_sp2_ep14_tp0_pp1 [label="Expert L7 SP2 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep14_pp1 -> layer_7_expert_sp2_ep14_tp0_pp1
	layer_7_expert_out_sp2_ep14_tp0_pp1 [label="Expert Out L7 SP2 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep14_tp0_pp1 -> layer_7_expert_out_sp2_ep14_tp0_pp1
	layer_7_expert_sp2_ep14_tp1_pp1 [label="Expert L7 SP2 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep14_pp1 -> layer_7_expert_sp2_ep14_tp1_pp1
	layer_7_expert_out_sp2_ep14_tp1_pp1 [label="Expert Out L7 SP2 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep14_tp1_pp1 -> layer_7_expert_out_sp2_ep14_tp1_pp1
	layer_7_expert_sp2_ep14_tp2_pp1 [label="Expert L7 SP2 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep14_pp1 -> layer_7_expert_sp2_ep14_tp2_pp1
	layer_7_expert_out_sp2_ep14_tp2_pp1 [label="Expert Out L7 SP2 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep14_tp2_pp1 -> layer_7_expert_out_sp2_ep14_tp2_pp1
	layer_7_expert_sp2_ep14_tp3_pp1 [label="Expert L7 SP2 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep14_pp1 -> layer_7_expert_sp2_ep14_tp3_pp1
	layer_7_expert_out_sp2_ep14_tp3_pp1 [label="Expert Out L7 SP2 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep14_tp3_pp1 -> layer_7_expert_out_sp2_ep14_tp3_pp1
	layer_7_expert_ar_sp2_ep14_pp1 [label="Expert All-Reduce L7 SP2 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep14_tp0_pp1 -> layer_7_expert_ar_sp2_ep14_pp1
	layer_7_expert_out_sp2_ep14_tp1_pp1 -> layer_7_expert_ar_sp2_ep14_pp1
	layer_7_expert_out_sp2_ep14_tp2_pp1 -> layer_7_expert_ar_sp2_ep14_pp1
	layer_7_expert_out_sp2_ep14_tp3_pp1 -> layer_7_expert_ar_sp2_ep14_pp1
	layer_7_combine_sp2_ep14_pp1 [label="Token Combine L7 SP2 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep14_pp1 -> layer_7_combine_sp2_ep14_pp1
	layer_7_dispatch_sp2_ep15_pp1 [label="Token Dispatch L7 SP2 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp2_pp1 -> layer_7_dispatch_sp2_ep15_pp1 [style=dashed]
	layer_7_expert_sp2_ep15_tp0_pp1 [label="Expert L7 SP2 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep15_pp1 -> layer_7_expert_sp2_ep15_tp0_pp1
	layer_7_expert_out_sp2_ep15_tp0_pp1 [label="Expert Out L7 SP2 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep15_tp0_pp1 -> layer_7_expert_out_sp2_ep15_tp0_pp1
	layer_7_expert_sp2_ep15_tp1_pp1 [label="Expert L7 SP2 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep15_pp1 -> layer_7_expert_sp2_ep15_tp1_pp1
	layer_7_expert_out_sp2_ep15_tp1_pp1 [label="Expert Out L7 SP2 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep15_tp1_pp1 -> layer_7_expert_out_sp2_ep15_tp1_pp1
	layer_7_expert_sp2_ep15_tp2_pp1 [label="Expert L7 SP2 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep15_pp1 -> layer_7_expert_sp2_ep15_tp2_pp1
	layer_7_expert_out_sp2_ep15_tp2_pp1 [label="Expert Out L7 SP2 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep15_tp2_pp1 -> layer_7_expert_out_sp2_ep15_tp2_pp1
	layer_7_expert_sp2_ep15_tp3_pp1 [label="Expert L7 SP2 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp2_ep15_pp1 -> layer_7_expert_sp2_ep15_tp3_pp1
	layer_7_expert_out_sp2_ep15_tp3_pp1 [label="Expert Out L7 SP2 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp2_ep15_tp3_pp1 -> layer_7_expert_out_sp2_ep15_tp3_pp1
	layer_7_expert_ar_sp2_ep15_pp1 [label="Expert All-Reduce L7 SP2 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp2_ep15_tp0_pp1 -> layer_7_expert_ar_sp2_ep15_pp1
	layer_7_expert_out_sp2_ep15_tp1_pp1 -> layer_7_expert_ar_sp2_ep15_pp1
	layer_7_expert_out_sp2_ep15_tp2_pp1 -> layer_7_expert_ar_sp2_ep15_pp1
	layer_7_expert_out_sp2_ep15_tp3_pp1 -> layer_7_expert_ar_sp2_ep15_pp1
	layer_7_combine_sp2_ep15_pp1 [label="Token Combine L7 SP2 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp2_ep15_pp1 -> layer_7_combine_sp2_ep15_pp1
	layer_7_moe_all2all_sp2_pp1 [label="MoE All-to-All L7 SP2\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_7_combine_sp2_ep0_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep1_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep2_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep3_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep4_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep5_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep6_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep7_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep8_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep9_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep10_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep11_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep12_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep13_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep14_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_combine_sp2_ep15_pp1 -> layer_7_moe_all2all_sp2_pp1
	layer_7_mlp_out_sp2_pp1 [label="MoE Output L7 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_moe_all2all_sp2_pp1 -> layer_7_mlp_out_sp2_pp1
	layer_7_mlp_res_sp2_pp1 [label="MLP Residual L7 SP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_mlp_out_sp2_pp1 -> layer_7_mlp_res_sp2_pp1
	layer_7_attn_res_sp2_pp1 -> layer_7_mlp_res_sp2_pp1 [style=dashed]
	layer_7_norm_sp3_pp1 [label="LayerNorm L7 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_6_mlp_out_sp3_pp1 -> layer_7_norm_sp3_pp1
	layer_7_qkv_sp3_tp0_pp1 [label="QKV Proj L7 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp3_pp1 -> layer_7_qkv_sp3_tp0_pp1
	layer_7_attn_sp3_tp0_pp1 [label="Attention L7 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp3_tp0_pp1 -> layer_7_attn_sp3_tp0_pp1
	layer_7_attn_out_sp3_tp0_pp1 [label="Attn Out Proj L7 SP3 TP0\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp3_tp0_pp1 -> layer_7_attn_out_sp3_tp0_pp1
	layer_7_qkv_sp3_tp1_pp1 [label="QKV Proj L7 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp3_pp1 -> layer_7_qkv_sp3_tp1_pp1
	layer_7_attn_sp3_tp1_pp1 [label="Attention L7 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp3_tp1_pp1 -> layer_7_attn_sp3_tp1_pp1
	layer_7_attn_out_sp3_tp1_pp1 [label="Attn Out Proj L7 SP3 TP1\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp3_tp1_pp1 -> layer_7_attn_out_sp3_tp1_pp1
	layer_7_qkv_sp3_tp2_pp1 [label="QKV Proj L7 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp3_pp1 -> layer_7_qkv_sp3_tp2_pp1
	layer_7_attn_sp3_tp2_pp1 [label="Attention L7 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp3_tp2_pp1 -> layer_7_attn_sp3_tp2_pp1
	layer_7_attn_out_sp3_tp2_pp1 [label="Attn Out Proj L7 SP3 TP2\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp3_tp2_pp1 -> layer_7_attn_out_sp3_tp2_pp1
	layer_7_qkv_sp3_tp3_pp1 [label="QKV Proj L7 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_norm_sp3_pp1 -> layer_7_qkv_sp3_tp3_pp1
	layer_7_attn_sp3_tp3_pp1 [label="Attention L7 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_qkv_sp3_tp3_pp1 -> layer_7_attn_sp3_tp3_pp1
	layer_7_attn_out_sp3_tp3_pp1 [label="Attn Out Proj L7 SP3 TP3\nPP Stage 1\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_7_attn_sp3_tp3_pp1 -> layer_7_attn_out_sp3_tp3_pp1
	layer_7_attn_ar_sp3_pp1 [label="Attention All-Reduce L7 SP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_attn_out_sp3_tp0_pp1 -> layer_7_attn_ar_sp3_pp1
	layer_7_attn_out_sp3_tp1_pp1 -> layer_7_attn_ar_sp3_pp1
	layer_7_attn_out_sp3_tp2_pp1 -> layer_7_attn_ar_sp3_pp1
	layer_7_attn_out_sp3_tp3_pp1 -> layer_7_attn_ar_sp3_pp1
	layer_7_attn_res_sp3_pp1 [label="Attention Residual L7 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_attn_ar_sp3_pp1 -> layer_7_attn_res_sp3_pp1
	layer_7_norm_sp3_pp1 -> layer_7_attn_res_sp3_pp1 [style=dashed]
	layer_7_post_norm_sp3_pp1 [label="Post-Attn Norm L7 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_attn_res_sp3_pp1 -> layer_7_post_norm_sp3_pp1
	layer_7_router_sp3_pp1 [label="MoE Router L7 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_7_post_norm_sp3_pp1 -> layer_7_router_sp3_pp1
	layer_7_dispatch_sp3_ep0_pp1 [label="Token Dispatch L7 SP3 EP0\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep0_pp1 [style=dashed]
	layer_7_expert_sp3_ep0_tp0_pp1 [label="Expert L7 SP3 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep0_pp1 -> layer_7_expert_sp3_ep0_tp0_pp1
	layer_7_expert_out_sp3_ep0_tp0_pp1 [label="Expert Out L7 SP3 EP0 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep0_tp0_pp1 -> layer_7_expert_out_sp3_ep0_tp0_pp1
	layer_7_expert_sp3_ep0_tp1_pp1 [label="Expert L7 SP3 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep0_pp1 -> layer_7_expert_sp3_ep0_tp1_pp1
	layer_7_expert_out_sp3_ep0_tp1_pp1 [label="Expert Out L7 SP3 EP0 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep0_tp1_pp1 -> layer_7_expert_out_sp3_ep0_tp1_pp1
	layer_7_expert_sp3_ep0_tp2_pp1 [label="Expert L7 SP3 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep0_pp1 -> layer_7_expert_sp3_ep0_tp2_pp1
	layer_7_expert_out_sp3_ep0_tp2_pp1 [label="Expert Out L7 SP3 EP0 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep0_tp2_pp1 -> layer_7_expert_out_sp3_ep0_tp2_pp1
	layer_7_expert_sp3_ep0_tp3_pp1 [label="Expert L7 SP3 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep0_pp1 -> layer_7_expert_sp3_ep0_tp3_pp1
	layer_7_expert_out_sp3_ep0_tp3_pp1 [label="Expert Out L7 SP3 EP0 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep0_tp3_pp1 -> layer_7_expert_out_sp3_ep0_tp3_pp1
	layer_7_expert_ar_sp3_ep0_pp1 [label="Expert All-Reduce L7 SP3 EP0\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep0_tp0_pp1 -> layer_7_expert_ar_sp3_ep0_pp1
	layer_7_expert_out_sp3_ep0_tp1_pp1 -> layer_7_expert_ar_sp3_ep0_pp1
	layer_7_expert_out_sp3_ep0_tp2_pp1 -> layer_7_expert_ar_sp3_ep0_pp1
	layer_7_expert_out_sp3_ep0_tp3_pp1 -> layer_7_expert_ar_sp3_ep0_pp1
	layer_7_combine_sp3_ep0_pp1 [label="Token Combine L7 SP3 EP0\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep0_pp1 -> layer_7_combine_sp3_ep0_pp1
	layer_7_dispatch_sp3_ep1_pp1 [label="Token Dispatch L7 SP3 EP1\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep1_pp1 [style=dashed]
	layer_7_expert_sp3_ep1_tp0_pp1 [label="Expert L7 SP3 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep1_pp1 -> layer_7_expert_sp3_ep1_tp0_pp1
	layer_7_expert_out_sp3_ep1_tp0_pp1 [label="Expert Out L7 SP3 EP1 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep1_tp0_pp1 -> layer_7_expert_out_sp3_ep1_tp0_pp1
	layer_7_expert_sp3_ep1_tp1_pp1 [label="Expert L7 SP3 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep1_pp1 -> layer_7_expert_sp3_ep1_tp1_pp1
	layer_7_expert_out_sp3_ep1_tp1_pp1 [label="Expert Out L7 SP3 EP1 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep1_tp1_pp1 -> layer_7_expert_out_sp3_ep1_tp1_pp1
	layer_7_expert_sp3_ep1_tp2_pp1 [label="Expert L7 SP3 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep1_pp1 -> layer_7_expert_sp3_ep1_tp2_pp1
	layer_7_expert_out_sp3_ep1_tp2_pp1 [label="Expert Out L7 SP3 EP1 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep1_tp2_pp1 -> layer_7_expert_out_sp3_ep1_tp2_pp1
	layer_7_expert_sp3_ep1_tp3_pp1 [label="Expert L7 SP3 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep1_pp1 -> layer_7_expert_sp3_ep1_tp3_pp1
	layer_7_expert_out_sp3_ep1_tp3_pp1 [label="Expert Out L7 SP3 EP1 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep1_tp3_pp1 -> layer_7_expert_out_sp3_ep1_tp3_pp1
	layer_7_expert_ar_sp3_ep1_pp1 [label="Expert All-Reduce L7 SP3 EP1\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep1_tp0_pp1 -> layer_7_expert_ar_sp3_ep1_pp1
	layer_7_expert_out_sp3_ep1_tp1_pp1 -> layer_7_expert_ar_sp3_ep1_pp1
	layer_7_expert_out_sp3_ep1_tp2_pp1 -> layer_7_expert_ar_sp3_ep1_pp1
	layer_7_expert_out_sp3_ep1_tp3_pp1 -> layer_7_expert_ar_sp3_ep1_pp1
	layer_7_combine_sp3_ep1_pp1 [label="Token Combine L7 SP3 EP1\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep1_pp1 -> layer_7_combine_sp3_ep1_pp1
	layer_7_dispatch_sp3_ep2_pp1 [label="Token Dispatch L7 SP3 EP2\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep2_pp1 [style=dashed]
	layer_7_expert_sp3_ep2_tp0_pp1 [label="Expert L7 SP3 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep2_pp1 -> layer_7_expert_sp3_ep2_tp0_pp1
	layer_7_expert_out_sp3_ep2_tp0_pp1 [label="Expert Out L7 SP3 EP2 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep2_tp0_pp1 -> layer_7_expert_out_sp3_ep2_tp0_pp1
	layer_7_expert_sp3_ep2_tp1_pp1 [label="Expert L7 SP3 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep2_pp1 -> layer_7_expert_sp3_ep2_tp1_pp1
	layer_7_expert_out_sp3_ep2_tp1_pp1 [label="Expert Out L7 SP3 EP2 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep2_tp1_pp1 -> layer_7_expert_out_sp3_ep2_tp1_pp1
	layer_7_expert_sp3_ep2_tp2_pp1 [label="Expert L7 SP3 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep2_pp1 -> layer_7_expert_sp3_ep2_tp2_pp1
	layer_7_expert_out_sp3_ep2_tp2_pp1 [label="Expert Out L7 SP3 EP2 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep2_tp2_pp1 -> layer_7_expert_out_sp3_ep2_tp2_pp1
	layer_7_expert_sp3_ep2_tp3_pp1 [label="Expert L7 SP3 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep2_pp1 -> layer_7_expert_sp3_ep2_tp3_pp1
	layer_7_expert_out_sp3_ep2_tp3_pp1 [label="Expert Out L7 SP3 EP2 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep2_tp3_pp1 -> layer_7_expert_out_sp3_ep2_tp3_pp1
	layer_7_expert_ar_sp3_ep2_pp1 [label="Expert All-Reduce L7 SP3 EP2\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep2_tp0_pp1 -> layer_7_expert_ar_sp3_ep2_pp1
	layer_7_expert_out_sp3_ep2_tp1_pp1 -> layer_7_expert_ar_sp3_ep2_pp1
	layer_7_expert_out_sp3_ep2_tp2_pp1 -> layer_7_expert_ar_sp3_ep2_pp1
	layer_7_expert_out_sp3_ep2_tp3_pp1 -> layer_7_expert_ar_sp3_ep2_pp1
	layer_7_combine_sp3_ep2_pp1 [label="Token Combine L7 SP3 EP2\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep2_pp1 -> layer_7_combine_sp3_ep2_pp1
	layer_7_dispatch_sp3_ep3_pp1 [label="Token Dispatch L7 SP3 EP3\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep3_pp1 [style=dashed]
	layer_7_expert_sp3_ep3_tp0_pp1 [label="Expert L7 SP3 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep3_pp1 -> layer_7_expert_sp3_ep3_tp0_pp1
	layer_7_expert_out_sp3_ep3_tp0_pp1 [label="Expert Out L7 SP3 EP3 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep3_tp0_pp1 -> layer_7_expert_out_sp3_ep3_tp0_pp1
	layer_7_expert_sp3_ep3_tp1_pp1 [label="Expert L7 SP3 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep3_pp1 -> layer_7_expert_sp3_ep3_tp1_pp1
	layer_7_expert_out_sp3_ep3_tp1_pp1 [label="Expert Out L7 SP3 EP3 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep3_tp1_pp1 -> layer_7_expert_out_sp3_ep3_tp1_pp1
	layer_7_expert_sp3_ep3_tp2_pp1 [label="Expert L7 SP3 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep3_pp1 -> layer_7_expert_sp3_ep3_tp2_pp1
	layer_7_expert_out_sp3_ep3_tp2_pp1 [label="Expert Out L7 SP3 EP3 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep3_tp2_pp1 -> layer_7_expert_out_sp3_ep3_tp2_pp1
	layer_7_expert_sp3_ep3_tp3_pp1 [label="Expert L7 SP3 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep3_pp1 -> layer_7_expert_sp3_ep3_tp3_pp1
	layer_7_expert_out_sp3_ep3_tp3_pp1 [label="Expert Out L7 SP3 EP3 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep3_tp3_pp1 -> layer_7_expert_out_sp3_ep3_tp3_pp1
	layer_7_expert_ar_sp3_ep3_pp1 [label="Expert All-Reduce L7 SP3 EP3\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep3_tp0_pp1 -> layer_7_expert_ar_sp3_ep3_pp1
	layer_7_expert_out_sp3_ep3_tp1_pp1 -> layer_7_expert_ar_sp3_ep3_pp1
	layer_7_expert_out_sp3_ep3_tp2_pp1 -> layer_7_expert_ar_sp3_ep3_pp1
	layer_7_expert_out_sp3_ep3_tp3_pp1 -> layer_7_expert_ar_sp3_ep3_pp1
	layer_7_combine_sp3_ep3_pp1 [label="Token Combine L7 SP3 EP3\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep3_pp1 -> layer_7_combine_sp3_ep3_pp1
	layer_7_dispatch_sp3_ep4_pp1 [label="Token Dispatch L7 SP3 EP4\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep4_pp1 [style=dashed]
	layer_7_expert_sp3_ep4_tp0_pp1 [label="Expert L7 SP3 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep4_pp1 -> layer_7_expert_sp3_ep4_tp0_pp1
	layer_7_expert_out_sp3_ep4_tp0_pp1 [label="Expert Out L7 SP3 EP4 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep4_tp0_pp1 -> layer_7_expert_out_sp3_ep4_tp0_pp1
	layer_7_expert_sp3_ep4_tp1_pp1 [label="Expert L7 SP3 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep4_pp1 -> layer_7_expert_sp3_ep4_tp1_pp1
	layer_7_expert_out_sp3_ep4_tp1_pp1 [label="Expert Out L7 SP3 EP4 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep4_tp1_pp1 -> layer_7_expert_out_sp3_ep4_tp1_pp1
	layer_7_expert_sp3_ep4_tp2_pp1 [label="Expert L7 SP3 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep4_pp1 -> layer_7_expert_sp3_ep4_tp2_pp1
	layer_7_expert_out_sp3_ep4_tp2_pp1 [label="Expert Out L7 SP3 EP4 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep4_tp2_pp1 -> layer_7_expert_out_sp3_ep4_tp2_pp1
	layer_7_expert_sp3_ep4_tp3_pp1 [label="Expert L7 SP3 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep4_pp1 -> layer_7_expert_sp3_ep4_tp3_pp1
	layer_7_expert_out_sp3_ep4_tp3_pp1 [label="Expert Out L7 SP3 EP4 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep4_tp3_pp1 -> layer_7_expert_out_sp3_ep4_tp3_pp1
	layer_7_expert_ar_sp3_ep4_pp1 [label="Expert All-Reduce L7 SP3 EP4\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep4_tp0_pp1 -> layer_7_expert_ar_sp3_ep4_pp1
	layer_7_expert_out_sp3_ep4_tp1_pp1 -> layer_7_expert_ar_sp3_ep4_pp1
	layer_7_expert_out_sp3_ep4_tp2_pp1 -> layer_7_expert_ar_sp3_ep4_pp1
	layer_7_expert_out_sp3_ep4_tp3_pp1 -> layer_7_expert_ar_sp3_ep4_pp1
	layer_7_combine_sp3_ep4_pp1 [label="Token Combine L7 SP3 EP4\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep4_pp1 -> layer_7_combine_sp3_ep4_pp1
	layer_7_dispatch_sp3_ep5_pp1 [label="Token Dispatch L7 SP3 EP5\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep5_pp1 [style=dashed]
	layer_7_expert_sp3_ep5_tp0_pp1 [label="Expert L7 SP3 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep5_pp1 -> layer_7_expert_sp3_ep5_tp0_pp1
	layer_7_expert_out_sp3_ep5_tp0_pp1 [label="Expert Out L7 SP3 EP5 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep5_tp0_pp1 -> layer_7_expert_out_sp3_ep5_tp0_pp1
	layer_7_expert_sp3_ep5_tp1_pp1 [label="Expert L7 SP3 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep5_pp1 -> layer_7_expert_sp3_ep5_tp1_pp1
	layer_7_expert_out_sp3_ep5_tp1_pp1 [label="Expert Out L7 SP3 EP5 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep5_tp1_pp1 -> layer_7_expert_out_sp3_ep5_tp1_pp1
	layer_7_expert_sp3_ep5_tp2_pp1 [label="Expert L7 SP3 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep5_pp1 -> layer_7_expert_sp3_ep5_tp2_pp1
	layer_7_expert_out_sp3_ep5_tp2_pp1 [label="Expert Out L7 SP3 EP5 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep5_tp2_pp1 -> layer_7_expert_out_sp3_ep5_tp2_pp1
	layer_7_expert_sp3_ep5_tp3_pp1 [label="Expert L7 SP3 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep5_pp1 -> layer_7_expert_sp3_ep5_tp3_pp1
	layer_7_expert_out_sp3_ep5_tp3_pp1 [label="Expert Out L7 SP3 EP5 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep5_tp3_pp1 -> layer_7_expert_out_sp3_ep5_tp3_pp1
	layer_7_expert_ar_sp3_ep5_pp1 [label="Expert All-Reduce L7 SP3 EP5\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep5_tp0_pp1 -> layer_7_expert_ar_sp3_ep5_pp1
	layer_7_expert_out_sp3_ep5_tp1_pp1 -> layer_7_expert_ar_sp3_ep5_pp1
	layer_7_expert_out_sp3_ep5_tp2_pp1 -> layer_7_expert_ar_sp3_ep5_pp1
	layer_7_expert_out_sp3_ep5_tp3_pp1 -> layer_7_expert_ar_sp3_ep5_pp1
	layer_7_combine_sp3_ep5_pp1 [label="Token Combine L7 SP3 EP5\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep5_pp1 -> layer_7_combine_sp3_ep5_pp1
	layer_7_dispatch_sp3_ep6_pp1 [label="Token Dispatch L7 SP3 EP6\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep6_pp1 [style=dashed]
	layer_7_expert_sp3_ep6_tp0_pp1 [label="Expert L7 SP3 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep6_pp1 -> layer_7_expert_sp3_ep6_tp0_pp1
	layer_7_expert_out_sp3_ep6_tp0_pp1 [label="Expert Out L7 SP3 EP6 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep6_tp0_pp1 -> layer_7_expert_out_sp3_ep6_tp0_pp1
	layer_7_expert_sp3_ep6_tp1_pp1 [label="Expert L7 SP3 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep6_pp1 -> layer_7_expert_sp3_ep6_tp1_pp1
	layer_7_expert_out_sp3_ep6_tp1_pp1 [label="Expert Out L7 SP3 EP6 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep6_tp1_pp1 -> layer_7_expert_out_sp3_ep6_tp1_pp1
	layer_7_expert_sp3_ep6_tp2_pp1 [label="Expert L7 SP3 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep6_pp1 -> layer_7_expert_sp3_ep6_tp2_pp1
	layer_7_expert_out_sp3_ep6_tp2_pp1 [label="Expert Out L7 SP3 EP6 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep6_tp2_pp1 -> layer_7_expert_out_sp3_ep6_tp2_pp1
	layer_7_expert_sp3_ep6_tp3_pp1 [label="Expert L7 SP3 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep6_pp1 -> layer_7_expert_sp3_ep6_tp3_pp1
	layer_7_expert_out_sp3_ep6_tp3_pp1 [label="Expert Out L7 SP3 EP6 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep6_tp3_pp1 -> layer_7_expert_out_sp3_ep6_tp3_pp1
	layer_7_expert_ar_sp3_ep6_pp1 [label="Expert All-Reduce L7 SP3 EP6\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep6_tp0_pp1 -> layer_7_expert_ar_sp3_ep6_pp1
	layer_7_expert_out_sp3_ep6_tp1_pp1 -> layer_7_expert_ar_sp3_ep6_pp1
	layer_7_expert_out_sp3_ep6_tp2_pp1 -> layer_7_expert_ar_sp3_ep6_pp1
	layer_7_expert_out_sp3_ep6_tp3_pp1 -> layer_7_expert_ar_sp3_ep6_pp1
	layer_7_combine_sp3_ep6_pp1 [label="Token Combine L7 SP3 EP6\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep6_pp1 -> layer_7_combine_sp3_ep6_pp1
	layer_7_dispatch_sp3_ep7_pp1 [label="Token Dispatch L7 SP3 EP7\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep7_pp1 [style=dashed]
	layer_7_expert_sp3_ep7_tp0_pp1 [label="Expert L7 SP3 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep7_pp1 -> layer_7_expert_sp3_ep7_tp0_pp1
	layer_7_expert_out_sp3_ep7_tp0_pp1 [label="Expert Out L7 SP3 EP7 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep7_tp0_pp1 -> layer_7_expert_out_sp3_ep7_tp0_pp1
	layer_7_expert_sp3_ep7_tp1_pp1 [label="Expert L7 SP3 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep7_pp1 -> layer_7_expert_sp3_ep7_tp1_pp1
	layer_7_expert_out_sp3_ep7_tp1_pp1 [label="Expert Out L7 SP3 EP7 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep7_tp1_pp1 -> layer_7_expert_out_sp3_ep7_tp1_pp1
	layer_7_expert_sp3_ep7_tp2_pp1 [label="Expert L7 SP3 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep7_pp1 -> layer_7_expert_sp3_ep7_tp2_pp1
	layer_7_expert_out_sp3_ep7_tp2_pp1 [label="Expert Out L7 SP3 EP7 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep7_tp2_pp1 -> layer_7_expert_out_sp3_ep7_tp2_pp1
	layer_7_expert_sp3_ep7_tp3_pp1 [label="Expert L7 SP3 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep7_pp1 -> layer_7_expert_sp3_ep7_tp3_pp1
	layer_7_expert_out_sp3_ep7_tp3_pp1 [label="Expert Out L7 SP3 EP7 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep7_tp3_pp1 -> layer_7_expert_out_sp3_ep7_tp3_pp1
	layer_7_expert_ar_sp3_ep7_pp1 [label="Expert All-Reduce L7 SP3 EP7\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep7_tp0_pp1 -> layer_7_expert_ar_sp3_ep7_pp1
	layer_7_expert_out_sp3_ep7_tp1_pp1 -> layer_7_expert_ar_sp3_ep7_pp1
	layer_7_expert_out_sp3_ep7_tp2_pp1 -> layer_7_expert_ar_sp3_ep7_pp1
	layer_7_expert_out_sp3_ep7_tp3_pp1 -> layer_7_expert_ar_sp3_ep7_pp1
	layer_7_combine_sp3_ep7_pp1 [label="Token Combine L7 SP3 EP7\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep7_pp1 -> layer_7_combine_sp3_ep7_pp1
	layer_7_dispatch_sp3_ep8_pp1 [label="Token Dispatch L7 SP3 EP8\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep8_pp1 [style=dashed]
	layer_7_expert_sp3_ep8_tp0_pp1 [label="Expert L7 SP3 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep8_pp1 -> layer_7_expert_sp3_ep8_tp0_pp1
	layer_7_expert_out_sp3_ep8_tp0_pp1 [label="Expert Out L7 SP3 EP8 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep8_tp0_pp1 -> layer_7_expert_out_sp3_ep8_tp0_pp1
	layer_7_expert_sp3_ep8_tp1_pp1 [label="Expert L7 SP3 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep8_pp1 -> layer_7_expert_sp3_ep8_tp1_pp1
	layer_7_expert_out_sp3_ep8_tp1_pp1 [label="Expert Out L7 SP3 EP8 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep8_tp1_pp1 -> layer_7_expert_out_sp3_ep8_tp1_pp1
	layer_7_expert_sp3_ep8_tp2_pp1 [label="Expert L7 SP3 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep8_pp1 -> layer_7_expert_sp3_ep8_tp2_pp1
	layer_7_expert_out_sp3_ep8_tp2_pp1 [label="Expert Out L7 SP3 EP8 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep8_tp2_pp1 -> layer_7_expert_out_sp3_ep8_tp2_pp1
	layer_7_expert_sp3_ep8_tp3_pp1 [label="Expert L7 SP3 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep8_pp1 -> layer_7_expert_sp3_ep8_tp3_pp1
	layer_7_expert_out_sp3_ep8_tp3_pp1 [label="Expert Out L7 SP3 EP8 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep8_tp3_pp1 -> layer_7_expert_out_sp3_ep8_tp3_pp1
	layer_7_expert_ar_sp3_ep8_pp1 [label="Expert All-Reduce L7 SP3 EP8\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep8_tp0_pp1 -> layer_7_expert_ar_sp3_ep8_pp1
	layer_7_expert_out_sp3_ep8_tp1_pp1 -> layer_7_expert_ar_sp3_ep8_pp1
	layer_7_expert_out_sp3_ep8_tp2_pp1 -> layer_7_expert_ar_sp3_ep8_pp1
	layer_7_expert_out_sp3_ep8_tp3_pp1 -> layer_7_expert_ar_sp3_ep8_pp1
	layer_7_combine_sp3_ep8_pp1 [label="Token Combine L7 SP3 EP8\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep8_pp1 -> layer_7_combine_sp3_ep8_pp1
	layer_7_dispatch_sp3_ep9_pp1 [label="Token Dispatch L7 SP3 EP9\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep9_pp1 [style=dashed]
	layer_7_expert_sp3_ep9_tp0_pp1 [label="Expert L7 SP3 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep9_pp1 -> layer_7_expert_sp3_ep9_tp0_pp1
	layer_7_expert_out_sp3_ep9_tp0_pp1 [label="Expert Out L7 SP3 EP9 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep9_tp0_pp1 -> layer_7_expert_out_sp3_ep9_tp0_pp1
	layer_7_expert_sp3_ep9_tp1_pp1 [label="Expert L7 SP3 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep9_pp1 -> layer_7_expert_sp3_ep9_tp1_pp1
	layer_7_expert_out_sp3_ep9_tp1_pp1 [label="Expert Out L7 SP3 EP9 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep9_tp1_pp1 -> layer_7_expert_out_sp3_ep9_tp1_pp1
	layer_7_expert_sp3_ep9_tp2_pp1 [label="Expert L7 SP3 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep9_pp1 -> layer_7_expert_sp3_ep9_tp2_pp1
	layer_7_expert_out_sp3_ep9_tp2_pp1 [label="Expert Out L7 SP3 EP9 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep9_tp2_pp1 -> layer_7_expert_out_sp3_ep9_tp2_pp1
	layer_7_expert_sp3_ep9_tp3_pp1 [label="Expert L7 SP3 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep9_pp1 -> layer_7_expert_sp3_ep9_tp3_pp1
	layer_7_expert_out_sp3_ep9_tp3_pp1 [label="Expert Out L7 SP3 EP9 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep9_tp3_pp1 -> layer_7_expert_out_sp3_ep9_tp3_pp1
	layer_7_expert_ar_sp3_ep9_pp1 [label="Expert All-Reduce L7 SP3 EP9\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep9_tp0_pp1 -> layer_7_expert_ar_sp3_ep9_pp1
	layer_7_expert_out_sp3_ep9_tp1_pp1 -> layer_7_expert_ar_sp3_ep9_pp1
	layer_7_expert_out_sp3_ep9_tp2_pp1 -> layer_7_expert_ar_sp3_ep9_pp1
	layer_7_expert_out_sp3_ep9_tp3_pp1 -> layer_7_expert_ar_sp3_ep9_pp1
	layer_7_combine_sp3_ep9_pp1 [label="Token Combine L7 SP3 EP9\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep9_pp1 -> layer_7_combine_sp3_ep9_pp1
	layer_7_dispatch_sp3_ep10_pp1 [label="Token Dispatch L7 SP3 EP10\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep10_pp1 [style=dashed]
	layer_7_expert_sp3_ep10_tp0_pp1 [label="Expert L7 SP3 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep10_pp1 -> layer_7_expert_sp3_ep10_tp0_pp1
	layer_7_expert_out_sp3_ep10_tp0_pp1 [label="Expert Out L7 SP3 EP10 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep10_tp0_pp1 -> layer_7_expert_out_sp3_ep10_tp0_pp1
	layer_7_expert_sp3_ep10_tp1_pp1 [label="Expert L7 SP3 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep10_pp1 -> layer_7_expert_sp3_ep10_tp1_pp1
	layer_7_expert_out_sp3_ep10_tp1_pp1 [label="Expert Out L7 SP3 EP10 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep10_tp1_pp1 -> layer_7_expert_out_sp3_ep10_tp1_pp1
	layer_7_expert_sp3_ep10_tp2_pp1 [label="Expert L7 SP3 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep10_pp1 -> layer_7_expert_sp3_ep10_tp2_pp1
	layer_7_expert_out_sp3_ep10_tp2_pp1 [label="Expert Out L7 SP3 EP10 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep10_tp2_pp1 -> layer_7_expert_out_sp3_ep10_tp2_pp1
	layer_7_expert_sp3_ep10_tp3_pp1 [label="Expert L7 SP3 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep10_pp1 -> layer_7_expert_sp3_ep10_tp3_pp1
	layer_7_expert_out_sp3_ep10_tp3_pp1 [label="Expert Out L7 SP3 EP10 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep10_tp3_pp1 -> layer_7_expert_out_sp3_ep10_tp3_pp1
	layer_7_expert_ar_sp3_ep10_pp1 [label="Expert All-Reduce L7 SP3 EP10\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep10_tp0_pp1 -> layer_7_expert_ar_sp3_ep10_pp1
	layer_7_expert_out_sp3_ep10_tp1_pp1 -> layer_7_expert_ar_sp3_ep10_pp1
	layer_7_expert_out_sp3_ep10_tp2_pp1 -> layer_7_expert_ar_sp3_ep10_pp1
	layer_7_expert_out_sp3_ep10_tp3_pp1 -> layer_7_expert_ar_sp3_ep10_pp1
	layer_7_combine_sp3_ep10_pp1 [label="Token Combine L7 SP3 EP10\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep10_pp1 -> layer_7_combine_sp3_ep10_pp1
	layer_7_dispatch_sp3_ep11_pp1 [label="Token Dispatch L7 SP3 EP11\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep11_pp1 [style=dashed]
	layer_7_expert_sp3_ep11_tp0_pp1 [label="Expert L7 SP3 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep11_pp1 -> layer_7_expert_sp3_ep11_tp0_pp1
	layer_7_expert_out_sp3_ep11_tp0_pp1 [label="Expert Out L7 SP3 EP11 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep11_tp0_pp1 -> layer_7_expert_out_sp3_ep11_tp0_pp1
	layer_7_expert_sp3_ep11_tp1_pp1 [label="Expert L7 SP3 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep11_pp1 -> layer_7_expert_sp3_ep11_tp1_pp1
	layer_7_expert_out_sp3_ep11_tp1_pp1 [label="Expert Out L7 SP3 EP11 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep11_tp1_pp1 -> layer_7_expert_out_sp3_ep11_tp1_pp1
	layer_7_expert_sp3_ep11_tp2_pp1 [label="Expert L7 SP3 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep11_pp1 -> layer_7_expert_sp3_ep11_tp2_pp1
	layer_7_expert_out_sp3_ep11_tp2_pp1 [label="Expert Out L7 SP3 EP11 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep11_tp2_pp1 -> layer_7_expert_out_sp3_ep11_tp2_pp1
	layer_7_expert_sp3_ep11_tp3_pp1 [label="Expert L7 SP3 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep11_pp1 -> layer_7_expert_sp3_ep11_tp3_pp1
	layer_7_expert_out_sp3_ep11_tp3_pp1 [label="Expert Out L7 SP3 EP11 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep11_tp3_pp1 -> layer_7_expert_out_sp3_ep11_tp3_pp1
	layer_7_expert_ar_sp3_ep11_pp1 [label="Expert All-Reduce L7 SP3 EP11\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep11_tp0_pp1 -> layer_7_expert_ar_sp3_ep11_pp1
	layer_7_expert_out_sp3_ep11_tp1_pp1 -> layer_7_expert_ar_sp3_ep11_pp1
	layer_7_expert_out_sp3_ep11_tp2_pp1 -> layer_7_expert_ar_sp3_ep11_pp1
	layer_7_expert_out_sp3_ep11_tp3_pp1 -> layer_7_expert_ar_sp3_ep11_pp1
	layer_7_combine_sp3_ep11_pp1 [label="Token Combine L7 SP3 EP11\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep11_pp1 -> layer_7_combine_sp3_ep11_pp1
	layer_7_dispatch_sp3_ep12_pp1 [label="Token Dispatch L7 SP3 EP12\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep12_pp1 [style=dashed]
	layer_7_expert_sp3_ep12_tp0_pp1 [label="Expert L7 SP3 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep12_pp1 -> layer_7_expert_sp3_ep12_tp0_pp1
	layer_7_expert_out_sp3_ep12_tp0_pp1 [label="Expert Out L7 SP3 EP12 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep12_tp0_pp1 -> layer_7_expert_out_sp3_ep12_tp0_pp1
	layer_7_expert_sp3_ep12_tp1_pp1 [label="Expert L7 SP3 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep12_pp1 -> layer_7_expert_sp3_ep12_tp1_pp1
	layer_7_expert_out_sp3_ep12_tp1_pp1 [label="Expert Out L7 SP3 EP12 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep12_tp1_pp1 -> layer_7_expert_out_sp3_ep12_tp1_pp1
	layer_7_expert_sp3_ep12_tp2_pp1 [label="Expert L7 SP3 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep12_pp1 -> layer_7_expert_sp3_ep12_tp2_pp1
	layer_7_expert_out_sp3_ep12_tp2_pp1 [label="Expert Out L7 SP3 EP12 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep12_tp2_pp1 -> layer_7_expert_out_sp3_ep12_tp2_pp1
	layer_7_expert_sp3_ep12_tp3_pp1 [label="Expert L7 SP3 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep12_pp1 -> layer_7_expert_sp3_ep12_tp3_pp1
	layer_7_expert_out_sp3_ep12_tp3_pp1 [label="Expert Out L7 SP3 EP12 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep12_tp3_pp1 -> layer_7_expert_out_sp3_ep12_tp3_pp1
	layer_7_expert_ar_sp3_ep12_pp1 [label="Expert All-Reduce L7 SP3 EP12\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep12_tp0_pp1 -> layer_7_expert_ar_sp3_ep12_pp1
	layer_7_expert_out_sp3_ep12_tp1_pp1 -> layer_7_expert_ar_sp3_ep12_pp1
	layer_7_expert_out_sp3_ep12_tp2_pp1 -> layer_7_expert_ar_sp3_ep12_pp1
	layer_7_expert_out_sp3_ep12_tp3_pp1 -> layer_7_expert_ar_sp3_ep12_pp1
	layer_7_combine_sp3_ep12_pp1 [label="Token Combine L7 SP3 EP12\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep12_pp1 -> layer_7_combine_sp3_ep12_pp1
	layer_7_dispatch_sp3_ep13_pp1 [label="Token Dispatch L7 SP3 EP13\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep13_pp1 [style=dashed]
	layer_7_expert_sp3_ep13_tp0_pp1 [label="Expert L7 SP3 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep13_pp1 -> layer_7_expert_sp3_ep13_tp0_pp1
	layer_7_expert_out_sp3_ep13_tp0_pp1 [label="Expert Out L7 SP3 EP13 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep13_tp0_pp1 -> layer_7_expert_out_sp3_ep13_tp0_pp1
	layer_7_expert_sp3_ep13_tp1_pp1 [label="Expert L7 SP3 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep13_pp1 -> layer_7_expert_sp3_ep13_tp1_pp1
	layer_7_expert_out_sp3_ep13_tp1_pp1 [label="Expert Out L7 SP3 EP13 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep13_tp1_pp1 -> layer_7_expert_out_sp3_ep13_tp1_pp1
	layer_7_expert_sp3_ep13_tp2_pp1 [label="Expert L7 SP3 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep13_pp1 -> layer_7_expert_sp3_ep13_tp2_pp1
	layer_7_expert_out_sp3_ep13_tp2_pp1 [label="Expert Out L7 SP3 EP13 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep13_tp2_pp1 -> layer_7_expert_out_sp3_ep13_tp2_pp1
	layer_7_expert_sp3_ep13_tp3_pp1 [label="Expert L7 SP3 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep13_pp1 -> layer_7_expert_sp3_ep13_tp3_pp1
	layer_7_expert_out_sp3_ep13_tp3_pp1 [label="Expert Out L7 SP3 EP13 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep13_tp3_pp1 -> layer_7_expert_out_sp3_ep13_tp3_pp1
	layer_7_expert_ar_sp3_ep13_pp1 [label="Expert All-Reduce L7 SP3 EP13\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep13_tp0_pp1 -> layer_7_expert_ar_sp3_ep13_pp1
	layer_7_expert_out_sp3_ep13_tp1_pp1 -> layer_7_expert_ar_sp3_ep13_pp1
	layer_7_expert_out_sp3_ep13_tp2_pp1 -> layer_7_expert_ar_sp3_ep13_pp1
	layer_7_expert_out_sp3_ep13_tp3_pp1 -> layer_7_expert_ar_sp3_ep13_pp1
	layer_7_combine_sp3_ep13_pp1 [label="Token Combine L7 SP3 EP13\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep13_pp1 -> layer_7_combine_sp3_ep13_pp1
	layer_7_dispatch_sp3_ep14_pp1 [label="Token Dispatch L7 SP3 EP14\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep14_pp1 [style=dashed]
	layer_7_expert_sp3_ep14_tp0_pp1 [label="Expert L7 SP3 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep14_pp1 -> layer_7_expert_sp3_ep14_tp0_pp1
	layer_7_expert_out_sp3_ep14_tp0_pp1 [label="Expert Out L7 SP3 EP14 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep14_tp0_pp1 -> layer_7_expert_out_sp3_ep14_tp0_pp1
	layer_7_expert_sp3_ep14_tp1_pp1 [label="Expert L7 SP3 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep14_pp1 -> layer_7_expert_sp3_ep14_tp1_pp1
	layer_7_expert_out_sp3_ep14_tp1_pp1 [label="Expert Out L7 SP3 EP14 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep14_tp1_pp1 -> layer_7_expert_out_sp3_ep14_tp1_pp1
	layer_7_expert_sp3_ep14_tp2_pp1 [label="Expert L7 SP3 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep14_pp1 -> layer_7_expert_sp3_ep14_tp2_pp1
	layer_7_expert_out_sp3_ep14_tp2_pp1 [label="Expert Out L7 SP3 EP14 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep14_tp2_pp1 -> layer_7_expert_out_sp3_ep14_tp2_pp1
	layer_7_expert_sp3_ep14_tp3_pp1 [label="Expert L7 SP3 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep14_pp1 -> layer_7_expert_sp3_ep14_tp3_pp1
	layer_7_expert_out_sp3_ep14_tp3_pp1 [label="Expert Out L7 SP3 EP14 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep14_tp3_pp1 -> layer_7_expert_out_sp3_ep14_tp3_pp1
	layer_7_expert_ar_sp3_ep14_pp1 [label="Expert All-Reduce L7 SP3 EP14\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep14_tp0_pp1 -> layer_7_expert_ar_sp3_ep14_pp1
	layer_7_expert_out_sp3_ep14_tp1_pp1 -> layer_7_expert_ar_sp3_ep14_pp1
	layer_7_expert_out_sp3_ep14_tp2_pp1 -> layer_7_expert_ar_sp3_ep14_pp1
	layer_7_expert_out_sp3_ep14_tp3_pp1 -> layer_7_expert_ar_sp3_ep14_pp1
	layer_7_combine_sp3_ep14_pp1 [label="Token Combine L7 SP3 EP14\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep14_pp1 -> layer_7_combine_sp3_ep14_pp1
	layer_7_dispatch_sp3_ep15_pp1 [label="Token Dispatch L7 SP3 EP15\nPP Stage 1\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_7_router_sp3_pp1 -> layer_7_dispatch_sp3_ep15_pp1 [style=dashed]
	layer_7_expert_sp3_ep15_tp0_pp1 [label="Expert L7 SP3 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep15_pp1 -> layer_7_expert_sp3_ep15_tp0_pp1
	layer_7_expert_out_sp3_ep15_tp0_pp1 [label="Expert Out L7 SP3 EP15 TP0\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep15_tp0_pp1 -> layer_7_expert_out_sp3_ep15_tp0_pp1
	layer_7_expert_sp3_ep15_tp1_pp1 [label="Expert L7 SP3 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep15_pp1 -> layer_7_expert_sp3_ep15_tp1_pp1
	layer_7_expert_out_sp3_ep15_tp1_pp1 [label="Expert Out L7 SP3 EP15 TP1\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep15_tp1_pp1 -> layer_7_expert_out_sp3_ep15_tp1_pp1
	layer_7_expert_sp3_ep15_tp2_pp1 [label="Expert L7 SP3 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep15_pp1 -> layer_7_expert_sp3_ep15_tp2_pp1
	layer_7_expert_out_sp3_ep15_tp2_pp1 [label="Expert Out L7 SP3 EP15 TP2\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep15_tp2_pp1 -> layer_7_expert_out_sp3_ep15_tp2_pp1
	layer_7_expert_sp3_ep15_tp3_pp1 [label="Expert L7 SP3 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_dispatch_sp3_ep15_pp1 -> layer_7_expert_sp3_ep15_tp3_pp1
	layer_7_expert_out_sp3_ep15_tp3_pp1 [label="Expert Out L7 SP3 EP15 TP3\nPP Stage 1\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_7_expert_sp3_ep15_tp3_pp1 -> layer_7_expert_out_sp3_ep15_tp3_pp1
	layer_7_expert_ar_sp3_ep15_pp1 [label="Expert All-Reduce L7 SP3 EP15\nPP Stage 1\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_expert_out_sp3_ep15_tp0_pp1 -> layer_7_expert_ar_sp3_ep15_pp1
	layer_7_expert_out_sp3_ep15_tp1_pp1 -> layer_7_expert_ar_sp3_ep15_pp1
	layer_7_expert_out_sp3_ep15_tp2_pp1 -> layer_7_expert_ar_sp3_ep15_pp1
	layer_7_expert_out_sp3_ep15_tp3_pp1 -> layer_7_expert_ar_sp3_ep15_pp1
	layer_7_combine_sp3_ep15_pp1 [label="Token Combine L7 SP3 EP15\nPP Stage 1\nCombined Output" fillcolor=orange shape=ellipse]
	layer_7_expert_ar_sp3_ep15_pp1 -> layer_7_combine_sp3_ep15_pp1
	layer_7_moe_all2all_sp3_pp1 [label="MoE All-to-All L7 SP3\nPP Stage 1\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_7_combine_sp3_ep0_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep1_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep2_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep3_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep4_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep5_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep6_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep7_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep8_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep9_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep10_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep11_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep12_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep13_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep14_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_combine_sp3_ep15_pp1 -> layer_7_moe_all2all_sp3_pp1
	layer_7_mlp_out_sp3_pp1 [label="MoE Output L7 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_moe_all2all_sp3_pp1 -> layer_7_mlp_out_sp3_pp1
	layer_7_mlp_res_sp3_pp1 [label="MLP Residual L7 SP3\nPP Stage 1\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_mlp_out_sp3_pp1 -> layer_7_mlp_res_sp3_pp1
	layer_7_attn_res_sp3_pp1 -> layer_7_mlp_res_sp3_pp1 [style=dashed]
	layer_8_norm_sp0_pp2 [label="LayerNorm L8 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_mlp_out_sp0_pp1 -> layer_8_norm_sp0_pp2 [style=dashed]
	layer_7_mlp_out_sp1_pp1 -> layer_8_norm_sp0_pp2 [style=dashed]
	layer_7_mlp_out_sp2_pp1 -> layer_8_norm_sp0_pp2 [style=dashed]
	layer_7_mlp_out_sp3_pp1 -> layer_8_norm_sp0_pp2 [style=dashed]
	layer_8_qkv_sp0_tp0_pp2 [label="QKV Proj L8 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp0_pp2 -> layer_8_qkv_sp0_tp0_pp2
	layer_8_attn_sp0_tp0_pp2 [label="Attention L8 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp0_tp0_pp2 -> layer_8_attn_sp0_tp0_pp2
	layer_8_attn_out_sp0_tp0_pp2 [label="Attn Out Proj L8 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp0_tp0_pp2 -> layer_8_attn_out_sp0_tp0_pp2
	layer_8_qkv_sp0_tp1_pp2 [label="QKV Proj L8 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp0_pp2 -> layer_8_qkv_sp0_tp1_pp2
	layer_8_attn_sp0_tp1_pp2 [label="Attention L8 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp0_tp1_pp2 -> layer_8_attn_sp0_tp1_pp2
	layer_8_attn_out_sp0_tp1_pp2 [label="Attn Out Proj L8 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp0_tp1_pp2 -> layer_8_attn_out_sp0_tp1_pp2
	layer_8_qkv_sp0_tp2_pp2 [label="QKV Proj L8 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp0_pp2 -> layer_8_qkv_sp0_tp2_pp2
	layer_8_attn_sp0_tp2_pp2 [label="Attention L8 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp0_tp2_pp2 -> layer_8_attn_sp0_tp2_pp2
	layer_8_attn_out_sp0_tp2_pp2 [label="Attn Out Proj L8 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp0_tp2_pp2 -> layer_8_attn_out_sp0_tp2_pp2
	layer_8_qkv_sp0_tp3_pp2 [label="QKV Proj L8 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp0_pp2 -> layer_8_qkv_sp0_tp3_pp2
	layer_8_attn_sp0_tp3_pp2 [label="Attention L8 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp0_tp3_pp2 -> layer_8_attn_sp0_tp3_pp2
	layer_8_attn_out_sp0_tp3_pp2 [label="Attn Out Proj L8 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp0_tp3_pp2 -> layer_8_attn_out_sp0_tp3_pp2
	layer_8_attn_ar_sp0_pp2 [label="Attention All-Reduce L8 SP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_attn_out_sp0_tp0_pp2 -> layer_8_attn_ar_sp0_pp2
	layer_8_attn_out_sp0_tp1_pp2 -> layer_8_attn_ar_sp0_pp2
	layer_8_attn_out_sp0_tp2_pp2 -> layer_8_attn_ar_sp0_pp2
	layer_8_attn_out_sp0_tp3_pp2 -> layer_8_attn_ar_sp0_pp2
	layer_8_attn_res_sp0_pp2 [label="Attention Residual L8 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_attn_ar_sp0_pp2 -> layer_8_attn_res_sp0_pp2
	layer_8_norm_sp0_pp2 -> layer_8_attn_res_sp0_pp2 [style=dashed]
	layer_8_post_norm_sp0_pp2 [label="Post-Attn Norm L8 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_attn_res_sp0_pp2 -> layer_8_post_norm_sp0_pp2
	layer_8_router_sp0_pp2 [label="MoE Router L8 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_8_post_norm_sp0_pp2 -> layer_8_router_sp0_pp2
	layer_8_dispatch_sp0_ep0_pp2 [label="Token Dispatch L8 SP0 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep0_pp2 [style=dashed]
	layer_8_expert_sp0_ep0_tp0_pp2 [label="Expert L8 SP0 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep0_pp2 -> layer_8_expert_sp0_ep0_tp0_pp2
	layer_8_expert_out_sp0_ep0_tp0_pp2 [label="Expert Out L8 SP0 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep0_tp0_pp2 -> layer_8_expert_out_sp0_ep0_tp0_pp2
	layer_8_expert_sp0_ep0_tp1_pp2 [label="Expert L8 SP0 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep0_pp2 -> layer_8_expert_sp0_ep0_tp1_pp2
	layer_8_expert_out_sp0_ep0_tp1_pp2 [label="Expert Out L8 SP0 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep0_tp1_pp2 -> layer_8_expert_out_sp0_ep0_tp1_pp2
	layer_8_expert_sp0_ep0_tp2_pp2 [label="Expert L8 SP0 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep0_pp2 -> layer_8_expert_sp0_ep0_tp2_pp2
	layer_8_expert_out_sp0_ep0_tp2_pp2 [label="Expert Out L8 SP0 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep0_tp2_pp2 -> layer_8_expert_out_sp0_ep0_tp2_pp2
	layer_8_expert_sp0_ep0_tp3_pp2 [label="Expert L8 SP0 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep0_pp2 -> layer_8_expert_sp0_ep0_tp3_pp2
	layer_8_expert_out_sp0_ep0_tp3_pp2 [label="Expert Out L8 SP0 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep0_tp3_pp2 -> layer_8_expert_out_sp0_ep0_tp3_pp2
	layer_8_expert_ar_sp0_ep0_pp2 [label="Expert All-Reduce L8 SP0 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep0_tp0_pp2 -> layer_8_expert_ar_sp0_ep0_pp2
	layer_8_expert_out_sp0_ep0_tp1_pp2 -> layer_8_expert_ar_sp0_ep0_pp2
	layer_8_expert_out_sp0_ep0_tp2_pp2 -> layer_8_expert_ar_sp0_ep0_pp2
	layer_8_expert_out_sp0_ep0_tp3_pp2 -> layer_8_expert_ar_sp0_ep0_pp2
	layer_8_combine_sp0_ep0_pp2 [label="Token Combine L8 SP0 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep0_pp2 -> layer_8_combine_sp0_ep0_pp2
	layer_8_dispatch_sp0_ep1_pp2 [label="Token Dispatch L8 SP0 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep1_pp2 [style=dashed]
	layer_8_expert_sp0_ep1_tp0_pp2 [label="Expert L8 SP0 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep1_pp2 -> layer_8_expert_sp0_ep1_tp0_pp2
	layer_8_expert_out_sp0_ep1_tp0_pp2 [label="Expert Out L8 SP0 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep1_tp0_pp2 -> layer_8_expert_out_sp0_ep1_tp0_pp2
	layer_8_expert_sp0_ep1_tp1_pp2 [label="Expert L8 SP0 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep1_pp2 -> layer_8_expert_sp0_ep1_tp1_pp2
	layer_8_expert_out_sp0_ep1_tp1_pp2 [label="Expert Out L8 SP0 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep1_tp1_pp2 -> layer_8_expert_out_sp0_ep1_tp1_pp2
	layer_8_expert_sp0_ep1_tp2_pp2 [label="Expert L8 SP0 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep1_pp2 -> layer_8_expert_sp0_ep1_tp2_pp2
	layer_8_expert_out_sp0_ep1_tp2_pp2 [label="Expert Out L8 SP0 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep1_tp2_pp2 -> layer_8_expert_out_sp0_ep1_tp2_pp2
	layer_8_expert_sp0_ep1_tp3_pp2 [label="Expert L8 SP0 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep1_pp2 -> layer_8_expert_sp0_ep1_tp3_pp2
	layer_8_expert_out_sp0_ep1_tp3_pp2 [label="Expert Out L8 SP0 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep1_tp3_pp2 -> layer_8_expert_out_sp0_ep1_tp3_pp2
	layer_8_expert_ar_sp0_ep1_pp2 [label="Expert All-Reduce L8 SP0 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep1_tp0_pp2 -> layer_8_expert_ar_sp0_ep1_pp2
	layer_8_expert_out_sp0_ep1_tp1_pp2 -> layer_8_expert_ar_sp0_ep1_pp2
	layer_8_expert_out_sp0_ep1_tp2_pp2 -> layer_8_expert_ar_sp0_ep1_pp2
	layer_8_expert_out_sp0_ep1_tp3_pp2 -> layer_8_expert_ar_sp0_ep1_pp2
	layer_8_combine_sp0_ep1_pp2 [label="Token Combine L8 SP0 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep1_pp2 -> layer_8_combine_sp0_ep1_pp2
	layer_8_dispatch_sp0_ep2_pp2 [label="Token Dispatch L8 SP0 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep2_pp2 [style=dashed]
	layer_8_expert_sp0_ep2_tp0_pp2 [label="Expert L8 SP0 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep2_pp2 -> layer_8_expert_sp0_ep2_tp0_pp2
	layer_8_expert_out_sp0_ep2_tp0_pp2 [label="Expert Out L8 SP0 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep2_tp0_pp2 -> layer_8_expert_out_sp0_ep2_tp0_pp2
	layer_8_expert_sp0_ep2_tp1_pp2 [label="Expert L8 SP0 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep2_pp2 -> layer_8_expert_sp0_ep2_tp1_pp2
	layer_8_expert_out_sp0_ep2_tp1_pp2 [label="Expert Out L8 SP0 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep2_tp1_pp2 -> layer_8_expert_out_sp0_ep2_tp1_pp2
	layer_8_expert_sp0_ep2_tp2_pp2 [label="Expert L8 SP0 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep2_pp2 -> layer_8_expert_sp0_ep2_tp2_pp2
	layer_8_expert_out_sp0_ep2_tp2_pp2 [label="Expert Out L8 SP0 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep2_tp2_pp2 -> layer_8_expert_out_sp0_ep2_tp2_pp2
	layer_8_expert_sp0_ep2_tp3_pp2 [label="Expert L8 SP0 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep2_pp2 -> layer_8_expert_sp0_ep2_tp3_pp2
	layer_8_expert_out_sp0_ep2_tp3_pp2 [label="Expert Out L8 SP0 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep2_tp3_pp2 -> layer_8_expert_out_sp0_ep2_tp3_pp2
	layer_8_expert_ar_sp0_ep2_pp2 [label="Expert All-Reduce L8 SP0 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep2_tp0_pp2 -> layer_8_expert_ar_sp0_ep2_pp2
	layer_8_expert_out_sp0_ep2_tp1_pp2 -> layer_8_expert_ar_sp0_ep2_pp2
	layer_8_expert_out_sp0_ep2_tp2_pp2 -> layer_8_expert_ar_sp0_ep2_pp2
	layer_8_expert_out_sp0_ep2_tp3_pp2 -> layer_8_expert_ar_sp0_ep2_pp2
	layer_8_combine_sp0_ep2_pp2 [label="Token Combine L8 SP0 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep2_pp2 -> layer_8_combine_sp0_ep2_pp2
	layer_8_dispatch_sp0_ep3_pp2 [label="Token Dispatch L8 SP0 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep3_pp2 [style=dashed]
	layer_8_expert_sp0_ep3_tp0_pp2 [label="Expert L8 SP0 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep3_pp2 -> layer_8_expert_sp0_ep3_tp0_pp2
	layer_8_expert_out_sp0_ep3_tp0_pp2 [label="Expert Out L8 SP0 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep3_tp0_pp2 -> layer_8_expert_out_sp0_ep3_tp0_pp2
	layer_8_expert_sp0_ep3_tp1_pp2 [label="Expert L8 SP0 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep3_pp2 -> layer_8_expert_sp0_ep3_tp1_pp2
	layer_8_expert_out_sp0_ep3_tp1_pp2 [label="Expert Out L8 SP0 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep3_tp1_pp2 -> layer_8_expert_out_sp0_ep3_tp1_pp2
	layer_8_expert_sp0_ep3_tp2_pp2 [label="Expert L8 SP0 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep3_pp2 -> layer_8_expert_sp0_ep3_tp2_pp2
	layer_8_expert_out_sp0_ep3_tp2_pp2 [label="Expert Out L8 SP0 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep3_tp2_pp2 -> layer_8_expert_out_sp0_ep3_tp2_pp2
	layer_8_expert_sp0_ep3_tp3_pp2 [label="Expert L8 SP0 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep3_pp2 -> layer_8_expert_sp0_ep3_tp3_pp2
	layer_8_expert_out_sp0_ep3_tp3_pp2 [label="Expert Out L8 SP0 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep3_tp3_pp2 -> layer_8_expert_out_sp0_ep3_tp3_pp2
	layer_8_expert_ar_sp0_ep3_pp2 [label="Expert All-Reduce L8 SP0 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep3_tp0_pp2 -> layer_8_expert_ar_sp0_ep3_pp2
	layer_8_expert_out_sp0_ep3_tp1_pp2 -> layer_8_expert_ar_sp0_ep3_pp2
	layer_8_expert_out_sp0_ep3_tp2_pp2 -> layer_8_expert_ar_sp0_ep3_pp2
	layer_8_expert_out_sp0_ep3_tp3_pp2 -> layer_8_expert_ar_sp0_ep3_pp2
	layer_8_combine_sp0_ep3_pp2 [label="Token Combine L8 SP0 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep3_pp2 -> layer_8_combine_sp0_ep3_pp2
	layer_8_dispatch_sp0_ep4_pp2 [label="Token Dispatch L8 SP0 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep4_pp2 [style=dashed]
	layer_8_expert_sp0_ep4_tp0_pp2 [label="Expert L8 SP0 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep4_pp2 -> layer_8_expert_sp0_ep4_tp0_pp2
	layer_8_expert_out_sp0_ep4_tp0_pp2 [label="Expert Out L8 SP0 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep4_tp0_pp2 -> layer_8_expert_out_sp0_ep4_tp0_pp2
	layer_8_expert_sp0_ep4_tp1_pp2 [label="Expert L8 SP0 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep4_pp2 -> layer_8_expert_sp0_ep4_tp1_pp2
	layer_8_expert_out_sp0_ep4_tp1_pp2 [label="Expert Out L8 SP0 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep4_tp1_pp2 -> layer_8_expert_out_sp0_ep4_tp1_pp2
	layer_8_expert_sp0_ep4_tp2_pp2 [label="Expert L8 SP0 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep4_pp2 -> layer_8_expert_sp0_ep4_tp2_pp2
	layer_8_expert_out_sp0_ep4_tp2_pp2 [label="Expert Out L8 SP0 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep4_tp2_pp2 -> layer_8_expert_out_sp0_ep4_tp2_pp2
	layer_8_expert_sp0_ep4_tp3_pp2 [label="Expert L8 SP0 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep4_pp2 -> layer_8_expert_sp0_ep4_tp3_pp2
	layer_8_expert_out_sp0_ep4_tp3_pp2 [label="Expert Out L8 SP0 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep4_tp3_pp2 -> layer_8_expert_out_sp0_ep4_tp3_pp2
	layer_8_expert_ar_sp0_ep4_pp2 [label="Expert All-Reduce L8 SP0 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep4_tp0_pp2 -> layer_8_expert_ar_sp0_ep4_pp2
	layer_8_expert_out_sp0_ep4_tp1_pp2 -> layer_8_expert_ar_sp0_ep4_pp2
	layer_8_expert_out_sp0_ep4_tp2_pp2 -> layer_8_expert_ar_sp0_ep4_pp2
	layer_8_expert_out_sp0_ep4_tp3_pp2 -> layer_8_expert_ar_sp0_ep4_pp2
	layer_8_combine_sp0_ep4_pp2 [label="Token Combine L8 SP0 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep4_pp2 -> layer_8_combine_sp0_ep4_pp2
	layer_8_dispatch_sp0_ep5_pp2 [label="Token Dispatch L8 SP0 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep5_pp2 [style=dashed]
	layer_8_expert_sp0_ep5_tp0_pp2 [label="Expert L8 SP0 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep5_pp2 -> layer_8_expert_sp0_ep5_tp0_pp2
	layer_8_expert_out_sp0_ep5_tp0_pp2 [label="Expert Out L8 SP0 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep5_tp0_pp2 -> layer_8_expert_out_sp0_ep5_tp0_pp2
	layer_8_expert_sp0_ep5_tp1_pp2 [label="Expert L8 SP0 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep5_pp2 -> layer_8_expert_sp0_ep5_tp1_pp2
	layer_8_expert_out_sp0_ep5_tp1_pp2 [label="Expert Out L8 SP0 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep5_tp1_pp2 -> layer_8_expert_out_sp0_ep5_tp1_pp2
	layer_8_expert_sp0_ep5_tp2_pp2 [label="Expert L8 SP0 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep5_pp2 -> layer_8_expert_sp0_ep5_tp2_pp2
	layer_8_expert_out_sp0_ep5_tp2_pp2 [label="Expert Out L8 SP0 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep5_tp2_pp2 -> layer_8_expert_out_sp0_ep5_tp2_pp2
	layer_8_expert_sp0_ep5_tp3_pp2 [label="Expert L8 SP0 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep5_pp2 -> layer_8_expert_sp0_ep5_tp3_pp2
	layer_8_expert_out_sp0_ep5_tp3_pp2 [label="Expert Out L8 SP0 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep5_tp3_pp2 -> layer_8_expert_out_sp0_ep5_tp3_pp2
	layer_8_expert_ar_sp0_ep5_pp2 [label="Expert All-Reduce L8 SP0 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep5_tp0_pp2 -> layer_8_expert_ar_sp0_ep5_pp2
	layer_8_expert_out_sp0_ep5_tp1_pp2 -> layer_8_expert_ar_sp0_ep5_pp2
	layer_8_expert_out_sp0_ep5_tp2_pp2 -> layer_8_expert_ar_sp0_ep5_pp2
	layer_8_expert_out_sp0_ep5_tp3_pp2 -> layer_8_expert_ar_sp0_ep5_pp2
	layer_8_combine_sp0_ep5_pp2 [label="Token Combine L8 SP0 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep5_pp2 -> layer_8_combine_sp0_ep5_pp2
	layer_8_dispatch_sp0_ep6_pp2 [label="Token Dispatch L8 SP0 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep6_pp2 [style=dashed]
	layer_8_expert_sp0_ep6_tp0_pp2 [label="Expert L8 SP0 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep6_pp2 -> layer_8_expert_sp0_ep6_tp0_pp2
	layer_8_expert_out_sp0_ep6_tp0_pp2 [label="Expert Out L8 SP0 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep6_tp0_pp2 -> layer_8_expert_out_sp0_ep6_tp0_pp2
	layer_8_expert_sp0_ep6_tp1_pp2 [label="Expert L8 SP0 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep6_pp2 -> layer_8_expert_sp0_ep6_tp1_pp2
	layer_8_expert_out_sp0_ep6_tp1_pp2 [label="Expert Out L8 SP0 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep6_tp1_pp2 -> layer_8_expert_out_sp0_ep6_tp1_pp2
	layer_8_expert_sp0_ep6_tp2_pp2 [label="Expert L8 SP0 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep6_pp2 -> layer_8_expert_sp0_ep6_tp2_pp2
	layer_8_expert_out_sp0_ep6_tp2_pp2 [label="Expert Out L8 SP0 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep6_tp2_pp2 -> layer_8_expert_out_sp0_ep6_tp2_pp2
	layer_8_expert_sp0_ep6_tp3_pp2 [label="Expert L8 SP0 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep6_pp2 -> layer_8_expert_sp0_ep6_tp3_pp2
	layer_8_expert_out_sp0_ep6_tp3_pp2 [label="Expert Out L8 SP0 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep6_tp3_pp2 -> layer_8_expert_out_sp0_ep6_tp3_pp2
	layer_8_expert_ar_sp0_ep6_pp2 [label="Expert All-Reduce L8 SP0 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep6_tp0_pp2 -> layer_8_expert_ar_sp0_ep6_pp2
	layer_8_expert_out_sp0_ep6_tp1_pp2 -> layer_8_expert_ar_sp0_ep6_pp2
	layer_8_expert_out_sp0_ep6_tp2_pp2 -> layer_8_expert_ar_sp0_ep6_pp2
	layer_8_expert_out_sp0_ep6_tp3_pp2 -> layer_8_expert_ar_sp0_ep6_pp2
	layer_8_combine_sp0_ep6_pp2 [label="Token Combine L8 SP0 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep6_pp2 -> layer_8_combine_sp0_ep6_pp2
	layer_8_dispatch_sp0_ep7_pp2 [label="Token Dispatch L8 SP0 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep7_pp2 [style=dashed]
	layer_8_expert_sp0_ep7_tp0_pp2 [label="Expert L8 SP0 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep7_pp2 -> layer_8_expert_sp0_ep7_tp0_pp2
	layer_8_expert_out_sp0_ep7_tp0_pp2 [label="Expert Out L8 SP0 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep7_tp0_pp2 -> layer_8_expert_out_sp0_ep7_tp0_pp2
	layer_8_expert_sp0_ep7_tp1_pp2 [label="Expert L8 SP0 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep7_pp2 -> layer_8_expert_sp0_ep7_tp1_pp2
	layer_8_expert_out_sp0_ep7_tp1_pp2 [label="Expert Out L8 SP0 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep7_tp1_pp2 -> layer_8_expert_out_sp0_ep7_tp1_pp2
	layer_8_expert_sp0_ep7_tp2_pp2 [label="Expert L8 SP0 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep7_pp2 -> layer_8_expert_sp0_ep7_tp2_pp2
	layer_8_expert_out_sp0_ep7_tp2_pp2 [label="Expert Out L8 SP0 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep7_tp2_pp2 -> layer_8_expert_out_sp0_ep7_tp2_pp2
	layer_8_expert_sp0_ep7_tp3_pp2 [label="Expert L8 SP0 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep7_pp2 -> layer_8_expert_sp0_ep7_tp3_pp2
	layer_8_expert_out_sp0_ep7_tp3_pp2 [label="Expert Out L8 SP0 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep7_tp3_pp2 -> layer_8_expert_out_sp0_ep7_tp3_pp2
	layer_8_expert_ar_sp0_ep7_pp2 [label="Expert All-Reduce L8 SP0 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep7_tp0_pp2 -> layer_8_expert_ar_sp0_ep7_pp2
	layer_8_expert_out_sp0_ep7_tp1_pp2 -> layer_8_expert_ar_sp0_ep7_pp2
	layer_8_expert_out_sp0_ep7_tp2_pp2 -> layer_8_expert_ar_sp0_ep7_pp2
	layer_8_expert_out_sp0_ep7_tp3_pp2 -> layer_8_expert_ar_sp0_ep7_pp2
	layer_8_combine_sp0_ep7_pp2 [label="Token Combine L8 SP0 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep7_pp2 -> layer_8_combine_sp0_ep7_pp2
	layer_8_dispatch_sp0_ep8_pp2 [label="Token Dispatch L8 SP0 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep8_pp2 [style=dashed]
	layer_8_expert_sp0_ep8_tp0_pp2 [label="Expert L8 SP0 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep8_pp2 -> layer_8_expert_sp0_ep8_tp0_pp2
	layer_8_expert_out_sp0_ep8_tp0_pp2 [label="Expert Out L8 SP0 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep8_tp0_pp2 -> layer_8_expert_out_sp0_ep8_tp0_pp2
	layer_8_expert_sp0_ep8_tp1_pp2 [label="Expert L8 SP0 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep8_pp2 -> layer_8_expert_sp0_ep8_tp1_pp2
	layer_8_expert_out_sp0_ep8_tp1_pp2 [label="Expert Out L8 SP0 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep8_tp1_pp2 -> layer_8_expert_out_sp0_ep8_tp1_pp2
	layer_8_expert_sp0_ep8_tp2_pp2 [label="Expert L8 SP0 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep8_pp2 -> layer_8_expert_sp0_ep8_tp2_pp2
	layer_8_expert_out_sp0_ep8_tp2_pp2 [label="Expert Out L8 SP0 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep8_tp2_pp2 -> layer_8_expert_out_sp0_ep8_tp2_pp2
	layer_8_expert_sp0_ep8_tp3_pp2 [label="Expert L8 SP0 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep8_pp2 -> layer_8_expert_sp0_ep8_tp3_pp2
	layer_8_expert_out_sp0_ep8_tp3_pp2 [label="Expert Out L8 SP0 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep8_tp3_pp2 -> layer_8_expert_out_sp0_ep8_tp3_pp2
	layer_8_expert_ar_sp0_ep8_pp2 [label="Expert All-Reduce L8 SP0 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep8_tp0_pp2 -> layer_8_expert_ar_sp0_ep8_pp2
	layer_8_expert_out_sp0_ep8_tp1_pp2 -> layer_8_expert_ar_sp0_ep8_pp2
	layer_8_expert_out_sp0_ep8_tp2_pp2 -> layer_8_expert_ar_sp0_ep8_pp2
	layer_8_expert_out_sp0_ep8_tp3_pp2 -> layer_8_expert_ar_sp0_ep8_pp2
	layer_8_combine_sp0_ep8_pp2 [label="Token Combine L8 SP0 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep8_pp2 -> layer_8_combine_sp0_ep8_pp2
	layer_8_dispatch_sp0_ep9_pp2 [label="Token Dispatch L8 SP0 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep9_pp2 [style=dashed]
	layer_8_expert_sp0_ep9_tp0_pp2 [label="Expert L8 SP0 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep9_pp2 -> layer_8_expert_sp0_ep9_tp0_pp2
	layer_8_expert_out_sp0_ep9_tp0_pp2 [label="Expert Out L8 SP0 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep9_tp0_pp2 -> layer_8_expert_out_sp0_ep9_tp0_pp2
	layer_8_expert_sp0_ep9_tp1_pp2 [label="Expert L8 SP0 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep9_pp2 -> layer_8_expert_sp0_ep9_tp1_pp2
	layer_8_expert_out_sp0_ep9_tp1_pp2 [label="Expert Out L8 SP0 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep9_tp1_pp2 -> layer_8_expert_out_sp0_ep9_tp1_pp2
	layer_8_expert_sp0_ep9_tp2_pp2 [label="Expert L8 SP0 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep9_pp2 -> layer_8_expert_sp0_ep9_tp2_pp2
	layer_8_expert_out_sp0_ep9_tp2_pp2 [label="Expert Out L8 SP0 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep9_tp2_pp2 -> layer_8_expert_out_sp0_ep9_tp2_pp2
	layer_8_expert_sp0_ep9_tp3_pp2 [label="Expert L8 SP0 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep9_pp2 -> layer_8_expert_sp0_ep9_tp3_pp2
	layer_8_expert_out_sp0_ep9_tp3_pp2 [label="Expert Out L8 SP0 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep9_tp3_pp2 -> layer_8_expert_out_sp0_ep9_tp3_pp2
	layer_8_expert_ar_sp0_ep9_pp2 [label="Expert All-Reduce L8 SP0 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep9_tp0_pp2 -> layer_8_expert_ar_sp0_ep9_pp2
	layer_8_expert_out_sp0_ep9_tp1_pp2 -> layer_8_expert_ar_sp0_ep9_pp2
	layer_8_expert_out_sp0_ep9_tp2_pp2 -> layer_8_expert_ar_sp0_ep9_pp2
	layer_8_expert_out_sp0_ep9_tp3_pp2 -> layer_8_expert_ar_sp0_ep9_pp2
	layer_8_combine_sp0_ep9_pp2 [label="Token Combine L8 SP0 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep9_pp2 -> layer_8_combine_sp0_ep9_pp2
	layer_8_dispatch_sp0_ep10_pp2 [label="Token Dispatch L8 SP0 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep10_pp2 [style=dashed]
	layer_8_expert_sp0_ep10_tp0_pp2 [label="Expert L8 SP0 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep10_pp2 -> layer_8_expert_sp0_ep10_tp0_pp2
	layer_8_expert_out_sp0_ep10_tp0_pp2 [label="Expert Out L8 SP0 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep10_tp0_pp2 -> layer_8_expert_out_sp0_ep10_tp0_pp2
	layer_8_expert_sp0_ep10_tp1_pp2 [label="Expert L8 SP0 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep10_pp2 -> layer_8_expert_sp0_ep10_tp1_pp2
	layer_8_expert_out_sp0_ep10_tp1_pp2 [label="Expert Out L8 SP0 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep10_tp1_pp2 -> layer_8_expert_out_sp0_ep10_tp1_pp2
	layer_8_expert_sp0_ep10_tp2_pp2 [label="Expert L8 SP0 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep10_pp2 -> layer_8_expert_sp0_ep10_tp2_pp2
	layer_8_expert_out_sp0_ep10_tp2_pp2 [label="Expert Out L8 SP0 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep10_tp2_pp2 -> layer_8_expert_out_sp0_ep10_tp2_pp2
	layer_8_expert_sp0_ep10_tp3_pp2 [label="Expert L8 SP0 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep10_pp2 -> layer_8_expert_sp0_ep10_tp3_pp2
	layer_8_expert_out_sp0_ep10_tp3_pp2 [label="Expert Out L8 SP0 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep10_tp3_pp2 -> layer_8_expert_out_sp0_ep10_tp3_pp2
	layer_8_expert_ar_sp0_ep10_pp2 [label="Expert All-Reduce L8 SP0 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep10_tp0_pp2 -> layer_8_expert_ar_sp0_ep10_pp2
	layer_8_expert_out_sp0_ep10_tp1_pp2 -> layer_8_expert_ar_sp0_ep10_pp2
	layer_8_expert_out_sp0_ep10_tp2_pp2 -> layer_8_expert_ar_sp0_ep10_pp2
	layer_8_expert_out_sp0_ep10_tp3_pp2 -> layer_8_expert_ar_sp0_ep10_pp2
	layer_8_combine_sp0_ep10_pp2 [label="Token Combine L8 SP0 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep10_pp2 -> layer_8_combine_sp0_ep10_pp2
	layer_8_dispatch_sp0_ep11_pp2 [label="Token Dispatch L8 SP0 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep11_pp2 [style=dashed]
	layer_8_expert_sp0_ep11_tp0_pp2 [label="Expert L8 SP0 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep11_pp2 -> layer_8_expert_sp0_ep11_tp0_pp2
	layer_8_expert_out_sp0_ep11_tp0_pp2 [label="Expert Out L8 SP0 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep11_tp0_pp2 -> layer_8_expert_out_sp0_ep11_tp0_pp2
	layer_8_expert_sp0_ep11_tp1_pp2 [label="Expert L8 SP0 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep11_pp2 -> layer_8_expert_sp0_ep11_tp1_pp2
	layer_8_expert_out_sp0_ep11_tp1_pp2 [label="Expert Out L8 SP0 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep11_tp1_pp2 -> layer_8_expert_out_sp0_ep11_tp1_pp2
	layer_8_expert_sp0_ep11_tp2_pp2 [label="Expert L8 SP0 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep11_pp2 -> layer_8_expert_sp0_ep11_tp2_pp2
	layer_8_expert_out_sp0_ep11_tp2_pp2 [label="Expert Out L8 SP0 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep11_tp2_pp2 -> layer_8_expert_out_sp0_ep11_tp2_pp2
	layer_8_expert_sp0_ep11_tp3_pp2 [label="Expert L8 SP0 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep11_pp2 -> layer_8_expert_sp0_ep11_tp3_pp2
	layer_8_expert_out_sp0_ep11_tp3_pp2 [label="Expert Out L8 SP0 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep11_tp3_pp2 -> layer_8_expert_out_sp0_ep11_tp3_pp2
	layer_8_expert_ar_sp0_ep11_pp2 [label="Expert All-Reduce L8 SP0 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep11_tp0_pp2 -> layer_8_expert_ar_sp0_ep11_pp2
	layer_8_expert_out_sp0_ep11_tp1_pp2 -> layer_8_expert_ar_sp0_ep11_pp2
	layer_8_expert_out_sp0_ep11_tp2_pp2 -> layer_8_expert_ar_sp0_ep11_pp2
	layer_8_expert_out_sp0_ep11_tp3_pp2 -> layer_8_expert_ar_sp0_ep11_pp2
	layer_8_combine_sp0_ep11_pp2 [label="Token Combine L8 SP0 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep11_pp2 -> layer_8_combine_sp0_ep11_pp2
	layer_8_dispatch_sp0_ep12_pp2 [label="Token Dispatch L8 SP0 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep12_pp2 [style=dashed]
	layer_8_expert_sp0_ep12_tp0_pp2 [label="Expert L8 SP0 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep12_pp2 -> layer_8_expert_sp0_ep12_tp0_pp2
	layer_8_expert_out_sp0_ep12_tp0_pp2 [label="Expert Out L8 SP0 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep12_tp0_pp2 -> layer_8_expert_out_sp0_ep12_tp0_pp2
	layer_8_expert_sp0_ep12_tp1_pp2 [label="Expert L8 SP0 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep12_pp2 -> layer_8_expert_sp0_ep12_tp1_pp2
	layer_8_expert_out_sp0_ep12_tp1_pp2 [label="Expert Out L8 SP0 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep12_tp1_pp2 -> layer_8_expert_out_sp0_ep12_tp1_pp2
	layer_8_expert_sp0_ep12_tp2_pp2 [label="Expert L8 SP0 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep12_pp2 -> layer_8_expert_sp0_ep12_tp2_pp2
	layer_8_expert_out_sp0_ep12_tp2_pp2 [label="Expert Out L8 SP0 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep12_tp2_pp2 -> layer_8_expert_out_sp0_ep12_tp2_pp2
	layer_8_expert_sp0_ep12_tp3_pp2 [label="Expert L8 SP0 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep12_pp2 -> layer_8_expert_sp0_ep12_tp3_pp2
	layer_8_expert_out_sp0_ep12_tp3_pp2 [label="Expert Out L8 SP0 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep12_tp3_pp2 -> layer_8_expert_out_sp0_ep12_tp3_pp2
	layer_8_expert_ar_sp0_ep12_pp2 [label="Expert All-Reduce L8 SP0 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep12_tp0_pp2 -> layer_8_expert_ar_sp0_ep12_pp2
	layer_8_expert_out_sp0_ep12_tp1_pp2 -> layer_8_expert_ar_sp0_ep12_pp2
	layer_8_expert_out_sp0_ep12_tp2_pp2 -> layer_8_expert_ar_sp0_ep12_pp2
	layer_8_expert_out_sp0_ep12_tp3_pp2 -> layer_8_expert_ar_sp0_ep12_pp2
	layer_8_combine_sp0_ep12_pp2 [label="Token Combine L8 SP0 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep12_pp2 -> layer_8_combine_sp0_ep12_pp2
	layer_8_dispatch_sp0_ep13_pp2 [label="Token Dispatch L8 SP0 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep13_pp2 [style=dashed]
	layer_8_expert_sp0_ep13_tp0_pp2 [label="Expert L8 SP0 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep13_pp2 -> layer_8_expert_sp0_ep13_tp0_pp2
	layer_8_expert_out_sp0_ep13_tp0_pp2 [label="Expert Out L8 SP0 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep13_tp0_pp2 -> layer_8_expert_out_sp0_ep13_tp0_pp2
	layer_8_expert_sp0_ep13_tp1_pp2 [label="Expert L8 SP0 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep13_pp2 -> layer_8_expert_sp0_ep13_tp1_pp2
	layer_8_expert_out_sp0_ep13_tp1_pp2 [label="Expert Out L8 SP0 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep13_tp1_pp2 -> layer_8_expert_out_sp0_ep13_tp1_pp2
	layer_8_expert_sp0_ep13_tp2_pp2 [label="Expert L8 SP0 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep13_pp2 -> layer_8_expert_sp0_ep13_tp2_pp2
	layer_8_expert_out_sp0_ep13_tp2_pp2 [label="Expert Out L8 SP0 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep13_tp2_pp2 -> layer_8_expert_out_sp0_ep13_tp2_pp2
	layer_8_expert_sp0_ep13_tp3_pp2 [label="Expert L8 SP0 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep13_pp2 -> layer_8_expert_sp0_ep13_tp3_pp2
	layer_8_expert_out_sp0_ep13_tp3_pp2 [label="Expert Out L8 SP0 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep13_tp3_pp2 -> layer_8_expert_out_sp0_ep13_tp3_pp2
	layer_8_expert_ar_sp0_ep13_pp2 [label="Expert All-Reduce L8 SP0 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep13_tp0_pp2 -> layer_8_expert_ar_sp0_ep13_pp2
	layer_8_expert_out_sp0_ep13_tp1_pp2 -> layer_8_expert_ar_sp0_ep13_pp2
	layer_8_expert_out_sp0_ep13_tp2_pp2 -> layer_8_expert_ar_sp0_ep13_pp2
	layer_8_expert_out_sp0_ep13_tp3_pp2 -> layer_8_expert_ar_sp0_ep13_pp2
	layer_8_combine_sp0_ep13_pp2 [label="Token Combine L8 SP0 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep13_pp2 -> layer_8_combine_sp0_ep13_pp2
	layer_8_dispatch_sp0_ep14_pp2 [label="Token Dispatch L8 SP0 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep14_pp2 [style=dashed]
	layer_8_expert_sp0_ep14_tp0_pp2 [label="Expert L8 SP0 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep14_pp2 -> layer_8_expert_sp0_ep14_tp0_pp2
	layer_8_expert_out_sp0_ep14_tp0_pp2 [label="Expert Out L8 SP0 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep14_tp0_pp2 -> layer_8_expert_out_sp0_ep14_tp0_pp2
	layer_8_expert_sp0_ep14_tp1_pp2 [label="Expert L8 SP0 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep14_pp2 -> layer_8_expert_sp0_ep14_tp1_pp2
	layer_8_expert_out_sp0_ep14_tp1_pp2 [label="Expert Out L8 SP0 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep14_tp1_pp2 -> layer_8_expert_out_sp0_ep14_tp1_pp2
	layer_8_expert_sp0_ep14_tp2_pp2 [label="Expert L8 SP0 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep14_pp2 -> layer_8_expert_sp0_ep14_tp2_pp2
	layer_8_expert_out_sp0_ep14_tp2_pp2 [label="Expert Out L8 SP0 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep14_tp2_pp2 -> layer_8_expert_out_sp0_ep14_tp2_pp2
	layer_8_expert_sp0_ep14_tp3_pp2 [label="Expert L8 SP0 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep14_pp2 -> layer_8_expert_sp0_ep14_tp3_pp2
	layer_8_expert_out_sp0_ep14_tp3_pp2 [label="Expert Out L8 SP0 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep14_tp3_pp2 -> layer_8_expert_out_sp0_ep14_tp3_pp2
	layer_8_expert_ar_sp0_ep14_pp2 [label="Expert All-Reduce L8 SP0 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep14_tp0_pp2 -> layer_8_expert_ar_sp0_ep14_pp2
	layer_8_expert_out_sp0_ep14_tp1_pp2 -> layer_8_expert_ar_sp0_ep14_pp2
	layer_8_expert_out_sp0_ep14_tp2_pp2 -> layer_8_expert_ar_sp0_ep14_pp2
	layer_8_expert_out_sp0_ep14_tp3_pp2 -> layer_8_expert_ar_sp0_ep14_pp2
	layer_8_combine_sp0_ep14_pp2 [label="Token Combine L8 SP0 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep14_pp2 -> layer_8_combine_sp0_ep14_pp2
	layer_8_dispatch_sp0_ep15_pp2 [label="Token Dispatch L8 SP0 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp0_pp2 -> layer_8_dispatch_sp0_ep15_pp2 [style=dashed]
	layer_8_expert_sp0_ep15_tp0_pp2 [label="Expert L8 SP0 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep15_pp2 -> layer_8_expert_sp0_ep15_tp0_pp2
	layer_8_expert_out_sp0_ep15_tp0_pp2 [label="Expert Out L8 SP0 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep15_tp0_pp2 -> layer_8_expert_out_sp0_ep15_tp0_pp2
	layer_8_expert_sp0_ep15_tp1_pp2 [label="Expert L8 SP0 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep15_pp2 -> layer_8_expert_sp0_ep15_tp1_pp2
	layer_8_expert_out_sp0_ep15_tp1_pp2 [label="Expert Out L8 SP0 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep15_tp1_pp2 -> layer_8_expert_out_sp0_ep15_tp1_pp2
	layer_8_expert_sp0_ep15_tp2_pp2 [label="Expert L8 SP0 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep15_pp2 -> layer_8_expert_sp0_ep15_tp2_pp2
	layer_8_expert_out_sp0_ep15_tp2_pp2 [label="Expert Out L8 SP0 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep15_tp2_pp2 -> layer_8_expert_out_sp0_ep15_tp2_pp2
	layer_8_expert_sp0_ep15_tp3_pp2 [label="Expert L8 SP0 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp0_ep15_pp2 -> layer_8_expert_sp0_ep15_tp3_pp2
	layer_8_expert_out_sp0_ep15_tp3_pp2 [label="Expert Out L8 SP0 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp0_ep15_tp3_pp2 -> layer_8_expert_out_sp0_ep15_tp3_pp2
	layer_8_expert_ar_sp0_ep15_pp2 [label="Expert All-Reduce L8 SP0 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp0_ep15_tp0_pp2 -> layer_8_expert_ar_sp0_ep15_pp2
	layer_8_expert_out_sp0_ep15_tp1_pp2 -> layer_8_expert_ar_sp0_ep15_pp2
	layer_8_expert_out_sp0_ep15_tp2_pp2 -> layer_8_expert_ar_sp0_ep15_pp2
	layer_8_expert_out_sp0_ep15_tp3_pp2 -> layer_8_expert_ar_sp0_ep15_pp2
	layer_8_combine_sp0_ep15_pp2 [label="Token Combine L8 SP0 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp0_ep15_pp2 -> layer_8_combine_sp0_ep15_pp2
	layer_8_moe_all2all_sp0_pp2 [label="MoE All-to-All L8 SP0\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_8_combine_sp0_ep0_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep1_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep2_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep3_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep4_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep5_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep6_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep7_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep8_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep9_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep10_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep11_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep12_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep13_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep14_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_combine_sp0_ep15_pp2 -> layer_8_moe_all2all_sp0_pp2
	layer_8_mlp_out_sp0_pp2 [label="MoE Output L8 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_moe_all2all_sp0_pp2 -> layer_8_mlp_out_sp0_pp2
	layer_8_mlp_res_sp0_pp2 [label="MLP Residual L8 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_mlp_out_sp0_pp2 -> layer_8_mlp_res_sp0_pp2
	layer_8_attn_res_sp0_pp2 -> layer_8_mlp_res_sp0_pp2 [style=dashed]
	layer_8_norm_sp1_pp2 [label="LayerNorm L8 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_mlp_out_sp0_pp1 -> layer_8_norm_sp1_pp2 [style=dashed]
	layer_7_mlp_out_sp1_pp1 -> layer_8_norm_sp1_pp2 [style=dashed]
	layer_7_mlp_out_sp2_pp1 -> layer_8_norm_sp1_pp2 [style=dashed]
	layer_7_mlp_out_sp3_pp1 -> layer_8_norm_sp1_pp2 [style=dashed]
	layer_8_qkv_sp1_tp0_pp2 [label="QKV Proj L8 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp1_pp2 -> layer_8_qkv_sp1_tp0_pp2
	layer_8_attn_sp1_tp0_pp2 [label="Attention L8 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp1_tp0_pp2 -> layer_8_attn_sp1_tp0_pp2
	layer_8_attn_out_sp1_tp0_pp2 [label="Attn Out Proj L8 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp1_tp0_pp2 -> layer_8_attn_out_sp1_tp0_pp2
	layer_8_qkv_sp1_tp1_pp2 [label="QKV Proj L8 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp1_pp2 -> layer_8_qkv_sp1_tp1_pp2
	layer_8_attn_sp1_tp1_pp2 [label="Attention L8 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp1_tp1_pp2 -> layer_8_attn_sp1_tp1_pp2
	layer_8_attn_out_sp1_tp1_pp2 [label="Attn Out Proj L8 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp1_tp1_pp2 -> layer_8_attn_out_sp1_tp1_pp2
	layer_8_qkv_sp1_tp2_pp2 [label="QKV Proj L8 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp1_pp2 -> layer_8_qkv_sp1_tp2_pp2
	layer_8_attn_sp1_tp2_pp2 [label="Attention L8 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp1_tp2_pp2 -> layer_8_attn_sp1_tp2_pp2
	layer_8_attn_out_sp1_tp2_pp2 [label="Attn Out Proj L8 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp1_tp2_pp2 -> layer_8_attn_out_sp1_tp2_pp2
	layer_8_qkv_sp1_tp3_pp2 [label="QKV Proj L8 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp1_pp2 -> layer_8_qkv_sp1_tp3_pp2
	layer_8_attn_sp1_tp3_pp2 [label="Attention L8 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp1_tp3_pp2 -> layer_8_attn_sp1_tp3_pp2
	layer_8_attn_out_sp1_tp3_pp2 [label="Attn Out Proj L8 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp1_tp3_pp2 -> layer_8_attn_out_sp1_tp3_pp2
	layer_8_attn_ar_sp1_pp2 [label="Attention All-Reduce L8 SP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_attn_out_sp1_tp0_pp2 -> layer_8_attn_ar_sp1_pp2
	layer_8_attn_out_sp1_tp1_pp2 -> layer_8_attn_ar_sp1_pp2
	layer_8_attn_out_sp1_tp2_pp2 -> layer_8_attn_ar_sp1_pp2
	layer_8_attn_out_sp1_tp3_pp2 -> layer_8_attn_ar_sp1_pp2
	layer_8_attn_res_sp1_pp2 [label="Attention Residual L8 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_attn_ar_sp1_pp2 -> layer_8_attn_res_sp1_pp2
	layer_8_norm_sp1_pp2 -> layer_8_attn_res_sp1_pp2 [style=dashed]
	layer_8_post_norm_sp1_pp2 [label="Post-Attn Norm L8 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_attn_res_sp1_pp2 -> layer_8_post_norm_sp1_pp2
	layer_8_router_sp1_pp2 [label="MoE Router L8 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_8_post_norm_sp1_pp2 -> layer_8_router_sp1_pp2
	layer_8_dispatch_sp1_ep0_pp2 [label="Token Dispatch L8 SP1 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep0_pp2 [style=dashed]
	layer_8_expert_sp1_ep0_tp0_pp2 [label="Expert L8 SP1 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep0_pp2 -> layer_8_expert_sp1_ep0_tp0_pp2
	layer_8_expert_out_sp1_ep0_tp0_pp2 [label="Expert Out L8 SP1 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep0_tp0_pp2 -> layer_8_expert_out_sp1_ep0_tp0_pp2
	layer_8_expert_sp1_ep0_tp1_pp2 [label="Expert L8 SP1 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep0_pp2 -> layer_8_expert_sp1_ep0_tp1_pp2
	layer_8_expert_out_sp1_ep0_tp1_pp2 [label="Expert Out L8 SP1 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep0_tp1_pp2 -> layer_8_expert_out_sp1_ep0_tp1_pp2
	layer_8_expert_sp1_ep0_tp2_pp2 [label="Expert L8 SP1 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep0_pp2 -> layer_8_expert_sp1_ep0_tp2_pp2
	layer_8_expert_out_sp1_ep0_tp2_pp2 [label="Expert Out L8 SP1 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep0_tp2_pp2 -> layer_8_expert_out_sp1_ep0_tp2_pp2
	layer_8_expert_sp1_ep0_tp3_pp2 [label="Expert L8 SP1 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep0_pp2 -> layer_8_expert_sp1_ep0_tp3_pp2
	layer_8_expert_out_sp1_ep0_tp3_pp2 [label="Expert Out L8 SP1 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep0_tp3_pp2 -> layer_8_expert_out_sp1_ep0_tp3_pp2
	layer_8_expert_ar_sp1_ep0_pp2 [label="Expert All-Reduce L8 SP1 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep0_tp0_pp2 -> layer_8_expert_ar_sp1_ep0_pp2
	layer_8_expert_out_sp1_ep0_tp1_pp2 -> layer_8_expert_ar_sp1_ep0_pp2
	layer_8_expert_out_sp1_ep0_tp2_pp2 -> layer_8_expert_ar_sp1_ep0_pp2
	layer_8_expert_out_sp1_ep0_tp3_pp2 -> layer_8_expert_ar_sp1_ep0_pp2
	layer_8_combine_sp1_ep0_pp2 [label="Token Combine L8 SP1 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep0_pp2 -> layer_8_combine_sp1_ep0_pp2
	layer_8_dispatch_sp1_ep1_pp2 [label="Token Dispatch L8 SP1 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep1_pp2 [style=dashed]
	layer_8_expert_sp1_ep1_tp0_pp2 [label="Expert L8 SP1 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep1_pp2 -> layer_8_expert_sp1_ep1_tp0_pp2
	layer_8_expert_out_sp1_ep1_tp0_pp2 [label="Expert Out L8 SP1 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep1_tp0_pp2 -> layer_8_expert_out_sp1_ep1_tp0_pp2
	layer_8_expert_sp1_ep1_tp1_pp2 [label="Expert L8 SP1 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep1_pp2 -> layer_8_expert_sp1_ep1_tp1_pp2
	layer_8_expert_out_sp1_ep1_tp1_pp2 [label="Expert Out L8 SP1 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep1_tp1_pp2 -> layer_8_expert_out_sp1_ep1_tp1_pp2
	layer_8_expert_sp1_ep1_tp2_pp2 [label="Expert L8 SP1 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep1_pp2 -> layer_8_expert_sp1_ep1_tp2_pp2
	layer_8_expert_out_sp1_ep1_tp2_pp2 [label="Expert Out L8 SP1 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep1_tp2_pp2 -> layer_8_expert_out_sp1_ep1_tp2_pp2
	layer_8_expert_sp1_ep1_tp3_pp2 [label="Expert L8 SP1 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep1_pp2 -> layer_8_expert_sp1_ep1_tp3_pp2
	layer_8_expert_out_sp1_ep1_tp3_pp2 [label="Expert Out L8 SP1 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep1_tp3_pp2 -> layer_8_expert_out_sp1_ep1_tp3_pp2
	layer_8_expert_ar_sp1_ep1_pp2 [label="Expert All-Reduce L8 SP1 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep1_tp0_pp2 -> layer_8_expert_ar_sp1_ep1_pp2
	layer_8_expert_out_sp1_ep1_tp1_pp2 -> layer_8_expert_ar_sp1_ep1_pp2
	layer_8_expert_out_sp1_ep1_tp2_pp2 -> layer_8_expert_ar_sp1_ep1_pp2
	layer_8_expert_out_sp1_ep1_tp3_pp2 -> layer_8_expert_ar_sp1_ep1_pp2
	layer_8_combine_sp1_ep1_pp2 [label="Token Combine L8 SP1 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep1_pp2 -> layer_8_combine_sp1_ep1_pp2
	layer_8_dispatch_sp1_ep2_pp2 [label="Token Dispatch L8 SP1 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep2_pp2 [style=dashed]
	layer_8_expert_sp1_ep2_tp0_pp2 [label="Expert L8 SP1 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep2_pp2 -> layer_8_expert_sp1_ep2_tp0_pp2
	layer_8_expert_out_sp1_ep2_tp0_pp2 [label="Expert Out L8 SP1 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep2_tp0_pp2 -> layer_8_expert_out_sp1_ep2_tp0_pp2
	layer_8_expert_sp1_ep2_tp1_pp2 [label="Expert L8 SP1 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep2_pp2 -> layer_8_expert_sp1_ep2_tp1_pp2
	layer_8_expert_out_sp1_ep2_tp1_pp2 [label="Expert Out L8 SP1 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep2_tp1_pp2 -> layer_8_expert_out_sp1_ep2_tp1_pp2
	layer_8_expert_sp1_ep2_tp2_pp2 [label="Expert L8 SP1 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep2_pp2 -> layer_8_expert_sp1_ep2_tp2_pp2
	layer_8_expert_out_sp1_ep2_tp2_pp2 [label="Expert Out L8 SP1 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep2_tp2_pp2 -> layer_8_expert_out_sp1_ep2_tp2_pp2
	layer_8_expert_sp1_ep2_tp3_pp2 [label="Expert L8 SP1 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep2_pp2 -> layer_8_expert_sp1_ep2_tp3_pp2
	layer_8_expert_out_sp1_ep2_tp3_pp2 [label="Expert Out L8 SP1 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep2_tp3_pp2 -> layer_8_expert_out_sp1_ep2_tp3_pp2
	layer_8_expert_ar_sp1_ep2_pp2 [label="Expert All-Reduce L8 SP1 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep2_tp0_pp2 -> layer_8_expert_ar_sp1_ep2_pp2
	layer_8_expert_out_sp1_ep2_tp1_pp2 -> layer_8_expert_ar_sp1_ep2_pp2
	layer_8_expert_out_sp1_ep2_tp2_pp2 -> layer_8_expert_ar_sp1_ep2_pp2
	layer_8_expert_out_sp1_ep2_tp3_pp2 -> layer_8_expert_ar_sp1_ep2_pp2
	layer_8_combine_sp1_ep2_pp2 [label="Token Combine L8 SP1 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep2_pp2 -> layer_8_combine_sp1_ep2_pp2
	layer_8_dispatch_sp1_ep3_pp2 [label="Token Dispatch L8 SP1 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep3_pp2 [style=dashed]
	layer_8_expert_sp1_ep3_tp0_pp2 [label="Expert L8 SP1 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep3_pp2 -> layer_8_expert_sp1_ep3_tp0_pp2
	layer_8_expert_out_sp1_ep3_tp0_pp2 [label="Expert Out L8 SP1 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep3_tp0_pp2 -> layer_8_expert_out_sp1_ep3_tp0_pp2
	layer_8_expert_sp1_ep3_tp1_pp2 [label="Expert L8 SP1 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep3_pp2 -> layer_8_expert_sp1_ep3_tp1_pp2
	layer_8_expert_out_sp1_ep3_tp1_pp2 [label="Expert Out L8 SP1 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep3_tp1_pp2 -> layer_8_expert_out_sp1_ep3_tp1_pp2
	layer_8_expert_sp1_ep3_tp2_pp2 [label="Expert L8 SP1 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep3_pp2 -> layer_8_expert_sp1_ep3_tp2_pp2
	layer_8_expert_out_sp1_ep3_tp2_pp2 [label="Expert Out L8 SP1 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep3_tp2_pp2 -> layer_8_expert_out_sp1_ep3_tp2_pp2
	layer_8_expert_sp1_ep3_tp3_pp2 [label="Expert L8 SP1 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep3_pp2 -> layer_8_expert_sp1_ep3_tp3_pp2
	layer_8_expert_out_sp1_ep3_tp3_pp2 [label="Expert Out L8 SP1 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep3_tp3_pp2 -> layer_8_expert_out_sp1_ep3_tp3_pp2
	layer_8_expert_ar_sp1_ep3_pp2 [label="Expert All-Reduce L8 SP1 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep3_tp0_pp2 -> layer_8_expert_ar_sp1_ep3_pp2
	layer_8_expert_out_sp1_ep3_tp1_pp2 -> layer_8_expert_ar_sp1_ep3_pp2
	layer_8_expert_out_sp1_ep3_tp2_pp2 -> layer_8_expert_ar_sp1_ep3_pp2
	layer_8_expert_out_sp1_ep3_tp3_pp2 -> layer_8_expert_ar_sp1_ep3_pp2
	layer_8_combine_sp1_ep3_pp2 [label="Token Combine L8 SP1 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep3_pp2 -> layer_8_combine_sp1_ep3_pp2
	layer_8_dispatch_sp1_ep4_pp2 [label="Token Dispatch L8 SP1 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep4_pp2 [style=dashed]
	layer_8_expert_sp1_ep4_tp0_pp2 [label="Expert L8 SP1 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep4_pp2 -> layer_8_expert_sp1_ep4_tp0_pp2
	layer_8_expert_out_sp1_ep4_tp0_pp2 [label="Expert Out L8 SP1 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep4_tp0_pp2 -> layer_8_expert_out_sp1_ep4_tp0_pp2
	layer_8_expert_sp1_ep4_tp1_pp2 [label="Expert L8 SP1 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep4_pp2 -> layer_8_expert_sp1_ep4_tp1_pp2
	layer_8_expert_out_sp1_ep4_tp1_pp2 [label="Expert Out L8 SP1 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep4_tp1_pp2 -> layer_8_expert_out_sp1_ep4_tp1_pp2
	layer_8_expert_sp1_ep4_tp2_pp2 [label="Expert L8 SP1 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep4_pp2 -> layer_8_expert_sp1_ep4_tp2_pp2
	layer_8_expert_out_sp1_ep4_tp2_pp2 [label="Expert Out L8 SP1 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep4_tp2_pp2 -> layer_8_expert_out_sp1_ep4_tp2_pp2
	layer_8_expert_sp1_ep4_tp3_pp2 [label="Expert L8 SP1 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep4_pp2 -> layer_8_expert_sp1_ep4_tp3_pp2
	layer_8_expert_out_sp1_ep4_tp3_pp2 [label="Expert Out L8 SP1 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep4_tp3_pp2 -> layer_8_expert_out_sp1_ep4_tp3_pp2
	layer_8_expert_ar_sp1_ep4_pp2 [label="Expert All-Reduce L8 SP1 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep4_tp0_pp2 -> layer_8_expert_ar_sp1_ep4_pp2
	layer_8_expert_out_sp1_ep4_tp1_pp2 -> layer_8_expert_ar_sp1_ep4_pp2
	layer_8_expert_out_sp1_ep4_tp2_pp2 -> layer_8_expert_ar_sp1_ep4_pp2
	layer_8_expert_out_sp1_ep4_tp3_pp2 -> layer_8_expert_ar_sp1_ep4_pp2
	layer_8_combine_sp1_ep4_pp2 [label="Token Combine L8 SP1 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep4_pp2 -> layer_8_combine_sp1_ep4_pp2
	layer_8_dispatch_sp1_ep5_pp2 [label="Token Dispatch L8 SP1 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep5_pp2 [style=dashed]
	layer_8_expert_sp1_ep5_tp0_pp2 [label="Expert L8 SP1 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep5_pp2 -> layer_8_expert_sp1_ep5_tp0_pp2
	layer_8_expert_out_sp1_ep5_tp0_pp2 [label="Expert Out L8 SP1 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep5_tp0_pp2 -> layer_8_expert_out_sp1_ep5_tp0_pp2
	layer_8_expert_sp1_ep5_tp1_pp2 [label="Expert L8 SP1 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep5_pp2 -> layer_8_expert_sp1_ep5_tp1_pp2
	layer_8_expert_out_sp1_ep5_tp1_pp2 [label="Expert Out L8 SP1 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep5_tp1_pp2 -> layer_8_expert_out_sp1_ep5_tp1_pp2
	layer_8_expert_sp1_ep5_tp2_pp2 [label="Expert L8 SP1 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep5_pp2 -> layer_8_expert_sp1_ep5_tp2_pp2
	layer_8_expert_out_sp1_ep5_tp2_pp2 [label="Expert Out L8 SP1 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep5_tp2_pp2 -> layer_8_expert_out_sp1_ep5_tp2_pp2
	layer_8_expert_sp1_ep5_tp3_pp2 [label="Expert L8 SP1 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep5_pp2 -> layer_8_expert_sp1_ep5_tp3_pp2
	layer_8_expert_out_sp1_ep5_tp3_pp2 [label="Expert Out L8 SP1 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep5_tp3_pp2 -> layer_8_expert_out_sp1_ep5_tp3_pp2
	layer_8_expert_ar_sp1_ep5_pp2 [label="Expert All-Reduce L8 SP1 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep5_tp0_pp2 -> layer_8_expert_ar_sp1_ep5_pp2
	layer_8_expert_out_sp1_ep5_tp1_pp2 -> layer_8_expert_ar_sp1_ep5_pp2
	layer_8_expert_out_sp1_ep5_tp2_pp2 -> layer_8_expert_ar_sp1_ep5_pp2
	layer_8_expert_out_sp1_ep5_tp3_pp2 -> layer_8_expert_ar_sp1_ep5_pp2
	layer_8_combine_sp1_ep5_pp2 [label="Token Combine L8 SP1 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep5_pp2 -> layer_8_combine_sp1_ep5_pp2
	layer_8_dispatch_sp1_ep6_pp2 [label="Token Dispatch L8 SP1 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep6_pp2 [style=dashed]
	layer_8_expert_sp1_ep6_tp0_pp2 [label="Expert L8 SP1 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep6_pp2 -> layer_8_expert_sp1_ep6_tp0_pp2
	layer_8_expert_out_sp1_ep6_tp0_pp2 [label="Expert Out L8 SP1 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep6_tp0_pp2 -> layer_8_expert_out_sp1_ep6_tp0_pp2
	layer_8_expert_sp1_ep6_tp1_pp2 [label="Expert L8 SP1 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep6_pp2 -> layer_8_expert_sp1_ep6_tp1_pp2
	layer_8_expert_out_sp1_ep6_tp1_pp2 [label="Expert Out L8 SP1 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep6_tp1_pp2 -> layer_8_expert_out_sp1_ep6_tp1_pp2
	layer_8_expert_sp1_ep6_tp2_pp2 [label="Expert L8 SP1 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep6_pp2 -> layer_8_expert_sp1_ep6_tp2_pp2
	layer_8_expert_out_sp1_ep6_tp2_pp2 [label="Expert Out L8 SP1 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep6_tp2_pp2 -> layer_8_expert_out_sp1_ep6_tp2_pp2
	layer_8_expert_sp1_ep6_tp3_pp2 [label="Expert L8 SP1 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep6_pp2 -> layer_8_expert_sp1_ep6_tp3_pp2
	layer_8_expert_out_sp1_ep6_tp3_pp2 [label="Expert Out L8 SP1 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep6_tp3_pp2 -> layer_8_expert_out_sp1_ep6_tp3_pp2
	layer_8_expert_ar_sp1_ep6_pp2 [label="Expert All-Reduce L8 SP1 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep6_tp0_pp2 -> layer_8_expert_ar_sp1_ep6_pp2
	layer_8_expert_out_sp1_ep6_tp1_pp2 -> layer_8_expert_ar_sp1_ep6_pp2
	layer_8_expert_out_sp1_ep6_tp2_pp2 -> layer_8_expert_ar_sp1_ep6_pp2
	layer_8_expert_out_sp1_ep6_tp3_pp2 -> layer_8_expert_ar_sp1_ep6_pp2
	layer_8_combine_sp1_ep6_pp2 [label="Token Combine L8 SP1 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep6_pp2 -> layer_8_combine_sp1_ep6_pp2
	layer_8_dispatch_sp1_ep7_pp2 [label="Token Dispatch L8 SP1 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep7_pp2 [style=dashed]
	layer_8_expert_sp1_ep7_tp0_pp2 [label="Expert L8 SP1 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep7_pp2 -> layer_8_expert_sp1_ep7_tp0_pp2
	layer_8_expert_out_sp1_ep7_tp0_pp2 [label="Expert Out L8 SP1 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep7_tp0_pp2 -> layer_8_expert_out_sp1_ep7_tp0_pp2
	layer_8_expert_sp1_ep7_tp1_pp2 [label="Expert L8 SP1 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep7_pp2 -> layer_8_expert_sp1_ep7_tp1_pp2
	layer_8_expert_out_sp1_ep7_tp1_pp2 [label="Expert Out L8 SP1 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep7_tp1_pp2 -> layer_8_expert_out_sp1_ep7_tp1_pp2
	layer_8_expert_sp1_ep7_tp2_pp2 [label="Expert L8 SP1 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep7_pp2 -> layer_8_expert_sp1_ep7_tp2_pp2
	layer_8_expert_out_sp1_ep7_tp2_pp2 [label="Expert Out L8 SP1 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep7_tp2_pp2 -> layer_8_expert_out_sp1_ep7_tp2_pp2
	layer_8_expert_sp1_ep7_tp3_pp2 [label="Expert L8 SP1 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep7_pp2 -> layer_8_expert_sp1_ep7_tp3_pp2
	layer_8_expert_out_sp1_ep7_tp3_pp2 [label="Expert Out L8 SP1 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep7_tp3_pp2 -> layer_8_expert_out_sp1_ep7_tp3_pp2
	layer_8_expert_ar_sp1_ep7_pp2 [label="Expert All-Reduce L8 SP1 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep7_tp0_pp2 -> layer_8_expert_ar_sp1_ep7_pp2
	layer_8_expert_out_sp1_ep7_tp1_pp2 -> layer_8_expert_ar_sp1_ep7_pp2
	layer_8_expert_out_sp1_ep7_tp2_pp2 -> layer_8_expert_ar_sp1_ep7_pp2
	layer_8_expert_out_sp1_ep7_tp3_pp2 -> layer_8_expert_ar_sp1_ep7_pp2
	layer_8_combine_sp1_ep7_pp2 [label="Token Combine L8 SP1 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep7_pp2 -> layer_8_combine_sp1_ep7_pp2
	layer_8_dispatch_sp1_ep8_pp2 [label="Token Dispatch L8 SP1 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep8_pp2 [style=dashed]
	layer_8_expert_sp1_ep8_tp0_pp2 [label="Expert L8 SP1 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep8_pp2 -> layer_8_expert_sp1_ep8_tp0_pp2
	layer_8_expert_out_sp1_ep8_tp0_pp2 [label="Expert Out L8 SP1 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep8_tp0_pp2 -> layer_8_expert_out_sp1_ep8_tp0_pp2
	layer_8_expert_sp1_ep8_tp1_pp2 [label="Expert L8 SP1 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep8_pp2 -> layer_8_expert_sp1_ep8_tp1_pp2
	layer_8_expert_out_sp1_ep8_tp1_pp2 [label="Expert Out L8 SP1 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep8_tp1_pp2 -> layer_8_expert_out_sp1_ep8_tp1_pp2
	layer_8_expert_sp1_ep8_tp2_pp2 [label="Expert L8 SP1 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep8_pp2 -> layer_8_expert_sp1_ep8_tp2_pp2
	layer_8_expert_out_sp1_ep8_tp2_pp2 [label="Expert Out L8 SP1 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep8_tp2_pp2 -> layer_8_expert_out_sp1_ep8_tp2_pp2
	layer_8_expert_sp1_ep8_tp3_pp2 [label="Expert L8 SP1 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep8_pp2 -> layer_8_expert_sp1_ep8_tp3_pp2
	layer_8_expert_out_sp1_ep8_tp3_pp2 [label="Expert Out L8 SP1 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep8_tp3_pp2 -> layer_8_expert_out_sp1_ep8_tp3_pp2
	layer_8_expert_ar_sp1_ep8_pp2 [label="Expert All-Reduce L8 SP1 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep8_tp0_pp2 -> layer_8_expert_ar_sp1_ep8_pp2
	layer_8_expert_out_sp1_ep8_tp1_pp2 -> layer_8_expert_ar_sp1_ep8_pp2
	layer_8_expert_out_sp1_ep8_tp2_pp2 -> layer_8_expert_ar_sp1_ep8_pp2
	layer_8_expert_out_sp1_ep8_tp3_pp2 -> layer_8_expert_ar_sp1_ep8_pp2
	layer_8_combine_sp1_ep8_pp2 [label="Token Combine L8 SP1 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep8_pp2 -> layer_8_combine_sp1_ep8_pp2
	layer_8_dispatch_sp1_ep9_pp2 [label="Token Dispatch L8 SP1 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep9_pp2 [style=dashed]
	layer_8_expert_sp1_ep9_tp0_pp2 [label="Expert L8 SP1 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep9_pp2 -> layer_8_expert_sp1_ep9_tp0_pp2
	layer_8_expert_out_sp1_ep9_tp0_pp2 [label="Expert Out L8 SP1 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep9_tp0_pp2 -> layer_8_expert_out_sp1_ep9_tp0_pp2
	layer_8_expert_sp1_ep9_tp1_pp2 [label="Expert L8 SP1 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep9_pp2 -> layer_8_expert_sp1_ep9_tp1_pp2
	layer_8_expert_out_sp1_ep9_tp1_pp2 [label="Expert Out L8 SP1 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep9_tp1_pp2 -> layer_8_expert_out_sp1_ep9_tp1_pp2
	layer_8_expert_sp1_ep9_tp2_pp2 [label="Expert L8 SP1 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep9_pp2 -> layer_8_expert_sp1_ep9_tp2_pp2
	layer_8_expert_out_sp1_ep9_tp2_pp2 [label="Expert Out L8 SP1 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep9_tp2_pp2 -> layer_8_expert_out_sp1_ep9_tp2_pp2
	layer_8_expert_sp1_ep9_tp3_pp2 [label="Expert L8 SP1 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep9_pp2 -> layer_8_expert_sp1_ep9_tp3_pp2
	layer_8_expert_out_sp1_ep9_tp3_pp2 [label="Expert Out L8 SP1 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep9_tp3_pp2 -> layer_8_expert_out_sp1_ep9_tp3_pp2
	layer_8_expert_ar_sp1_ep9_pp2 [label="Expert All-Reduce L8 SP1 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep9_tp0_pp2 -> layer_8_expert_ar_sp1_ep9_pp2
	layer_8_expert_out_sp1_ep9_tp1_pp2 -> layer_8_expert_ar_sp1_ep9_pp2
	layer_8_expert_out_sp1_ep9_tp2_pp2 -> layer_8_expert_ar_sp1_ep9_pp2
	layer_8_expert_out_sp1_ep9_tp3_pp2 -> layer_8_expert_ar_sp1_ep9_pp2
	layer_8_combine_sp1_ep9_pp2 [label="Token Combine L8 SP1 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep9_pp2 -> layer_8_combine_sp1_ep9_pp2
	layer_8_dispatch_sp1_ep10_pp2 [label="Token Dispatch L8 SP1 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep10_pp2 [style=dashed]
	layer_8_expert_sp1_ep10_tp0_pp2 [label="Expert L8 SP1 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep10_pp2 -> layer_8_expert_sp1_ep10_tp0_pp2
	layer_8_expert_out_sp1_ep10_tp0_pp2 [label="Expert Out L8 SP1 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep10_tp0_pp2 -> layer_8_expert_out_sp1_ep10_tp0_pp2
	layer_8_expert_sp1_ep10_tp1_pp2 [label="Expert L8 SP1 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep10_pp2 -> layer_8_expert_sp1_ep10_tp1_pp2
	layer_8_expert_out_sp1_ep10_tp1_pp2 [label="Expert Out L8 SP1 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep10_tp1_pp2 -> layer_8_expert_out_sp1_ep10_tp1_pp2
	layer_8_expert_sp1_ep10_tp2_pp2 [label="Expert L8 SP1 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep10_pp2 -> layer_8_expert_sp1_ep10_tp2_pp2
	layer_8_expert_out_sp1_ep10_tp2_pp2 [label="Expert Out L8 SP1 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep10_tp2_pp2 -> layer_8_expert_out_sp1_ep10_tp2_pp2
	layer_8_expert_sp1_ep10_tp3_pp2 [label="Expert L8 SP1 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep10_pp2 -> layer_8_expert_sp1_ep10_tp3_pp2
	layer_8_expert_out_sp1_ep10_tp3_pp2 [label="Expert Out L8 SP1 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep10_tp3_pp2 -> layer_8_expert_out_sp1_ep10_tp3_pp2
	layer_8_expert_ar_sp1_ep10_pp2 [label="Expert All-Reduce L8 SP1 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep10_tp0_pp2 -> layer_8_expert_ar_sp1_ep10_pp2
	layer_8_expert_out_sp1_ep10_tp1_pp2 -> layer_8_expert_ar_sp1_ep10_pp2
	layer_8_expert_out_sp1_ep10_tp2_pp2 -> layer_8_expert_ar_sp1_ep10_pp2
	layer_8_expert_out_sp1_ep10_tp3_pp2 -> layer_8_expert_ar_sp1_ep10_pp2
	layer_8_combine_sp1_ep10_pp2 [label="Token Combine L8 SP1 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep10_pp2 -> layer_8_combine_sp1_ep10_pp2
	layer_8_dispatch_sp1_ep11_pp2 [label="Token Dispatch L8 SP1 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep11_pp2 [style=dashed]
	layer_8_expert_sp1_ep11_tp0_pp2 [label="Expert L8 SP1 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep11_pp2 -> layer_8_expert_sp1_ep11_tp0_pp2
	layer_8_expert_out_sp1_ep11_tp0_pp2 [label="Expert Out L8 SP1 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep11_tp0_pp2 -> layer_8_expert_out_sp1_ep11_tp0_pp2
	layer_8_expert_sp1_ep11_tp1_pp2 [label="Expert L8 SP1 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep11_pp2 -> layer_8_expert_sp1_ep11_tp1_pp2
	layer_8_expert_out_sp1_ep11_tp1_pp2 [label="Expert Out L8 SP1 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep11_tp1_pp2 -> layer_8_expert_out_sp1_ep11_tp1_pp2
	layer_8_expert_sp1_ep11_tp2_pp2 [label="Expert L8 SP1 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep11_pp2 -> layer_8_expert_sp1_ep11_tp2_pp2
	layer_8_expert_out_sp1_ep11_tp2_pp2 [label="Expert Out L8 SP1 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep11_tp2_pp2 -> layer_8_expert_out_sp1_ep11_tp2_pp2
	layer_8_expert_sp1_ep11_tp3_pp2 [label="Expert L8 SP1 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep11_pp2 -> layer_8_expert_sp1_ep11_tp3_pp2
	layer_8_expert_out_sp1_ep11_tp3_pp2 [label="Expert Out L8 SP1 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep11_tp3_pp2 -> layer_8_expert_out_sp1_ep11_tp3_pp2
	layer_8_expert_ar_sp1_ep11_pp2 [label="Expert All-Reduce L8 SP1 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep11_tp0_pp2 -> layer_8_expert_ar_sp1_ep11_pp2
	layer_8_expert_out_sp1_ep11_tp1_pp2 -> layer_8_expert_ar_sp1_ep11_pp2
	layer_8_expert_out_sp1_ep11_tp2_pp2 -> layer_8_expert_ar_sp1_ep11_pp2
	layer_8_expert_out_sp1_ep11_tp3_pp2 -> layer_8_expert_ar_sp1_ep11_pp2
	layer_8_combine_sp1_ep11_pp2 [label="Token Combine L8 SP1 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep11_pp2 -> layer_8_combine_sp1_ep11_pp2
	layer_8_dispatch_sp1_ep12_pp2 [label="Token Dispatch L8 SP1 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep12_pp2 [style=dashed]
	layer_8_expert_sp1_ep12_tp0_pp2 [label="Expert L8 SP1 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep12_pp2 -> layer_8_expert_sp1_ep12_tp0_pp2
	layer_8_expert_out_sp1_ep12_tp0_pp2 [label="Expert Out L8 SP1 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep12_tp0_pp2 -> layer_8_expert_out_sp1_ep12_tp0_pp2
	layer_8_expert_sp1_ep12_tp1_pp2 [label="Expert L8 SP1 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep12_pp2 -> layer_8_expert_sp1_ep12_tp1_pp2
	layer_8_expert_out_sp1_ep12_tp1_pp2 [label="Expert Out L8 SP1 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep12_tp1_pp2 -> layer_8_expert_out_sp1_ep12_tp1_pp2
	layer_8_expert_sp1_ep12_tp2_pp2 [label="Expert L8 SP1 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep12_pp2 -> layer_8_expert_sp1_ep12_tp2_pp2
	layer_8_expert_out_sp1_ep12_tp2_pp2 [label="Expert Out L8 SP1 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep12_tp2_pp2 -> layer_8_expert_out_sp1_ep12_tp2_pp2
	layer_8_expert_sp1_ep12_tp3_pp2 [label="Expert L8 SP1 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep12_pp2 -> layer_8_expert_sp1_ep12_tp3_pp2
	layer_8_expert_out_sp1_ep12_tp3_pp2 [label="Expert Out L8 SP1 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep12_tp3_pp2 -> layer_8_expert_out_sp1_ep12_tp3_pp2
	layer_8_expert_ar_sp1_ep12_pp2 [label="Expert All-Reduce L8 SP1 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep12_tp0_pp2 -> layer_8_expert_ar_sp1_ep12_pp2
	layer_8_expert_out_sp1_ep12_tp1_pp2 -> layer_8_expert_ar_sp1_ep12_pp2
	layer_8_expert_out_sp1_ep12_tp2_pp2 -> layer_8_expert_ar_sp1_ep12_pp2
	layer_8_expert_out_sp1_ep12_tp3_pp2 -> layer_8_expert_ar_sp1_ep12_pp2
	layer_8_combine_sp1_ep12_pp2 [label="Token Combine L8 SP1 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep12_pp2 -> layer_8_combine_sp1_ep12_pp2
	layer_8_dispatch_sp1_ep13_pp2 [label="Token Dispatch L8 SP1 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep13_pp2 [style=dashed]
	layer_8_expert_sp1_ep13_tp0_pp2 [label="Expert L8 SP1 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep13_pp2 -> layer_8_expert_sp1_ep13_tp0_pp2
	layer_8_expert_out_sp1_ep13_tp0_pp2 [label="Expert Out L8 SP1 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep13_tp0_pp2 -> layer_8_expert_out_sp1_ep13_tp0_pp2
	layer_8_expert_sp1_ep13_tp1_pp2 [label="Expert L8 SP1 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep13_pp2 -> layer_8_expert_sp1_ep13_tp1_pp2
	layer_8_expert_out_sp1_ep13_tp1_pp2 [label="Expert Out L8 SP1 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep13_tp1_pp2 -> layer_8_expert_out_sp1_ep13_tp1_pp2
	layer_8_expert_sp1_ep13_tp2_pp2 [label="Expert L8 SP1 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep13_pp2 -> layer_8_expert_sp1_ep13_tp2_pp2
	layer_8_expert_out_sp1_ep13_tp2_pp2 [label="Expert Out L8 SP1 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep13_tp2_pp2 -> layer_8_expert_out_sp1_ep13_tp2_pp2
	layer_8_expert_sp1_ep13_tp3_pp2 [label="Expert L8 SP1 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep13_pp2 -> layer_8_expert_sp1_ep13_tp3_pp2
	layer_8_expert_out_sp1_ep13_tp3_pp2 [label="Expert Out L8 SP1 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep13_tp3_pp2 -> layer_8_expert_out_sp1_ep13_tp3_pp2
	layer_8_expert_ar_sp1_ep13_pp2 [label="Expert All-Reduce L8 SP1 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep13_tp0_pp2 -> layer_8_expert_ar_sp1_ep13_pp2
	layer_8_expert_out_sp1_ep13_tp1_pp2 -> layer_8_expert_ar_sp1_ep13_pp2
	layer_8_expert_out_sp1_ep13_tp2_pp2 -> layer_8_expert_ar_sp1_ep13_pp2
	layer_8_expert_out_sp1_ep13_tp3_pp2 -> layer_8_expert_ar_sp1_ep13_pp2
	layer_8_combine_sp1_ep13_pp2 [label="Token Combine L8 SP1 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep13_pp2 -> layer_8_combine_sp1_ep13_pp2
	layer_8_dispatch_sp1_ep14_pp2 [label="Token Dispatch L8 SP1 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep14_pp2 [style=dashed]
	layer_8_expert_sp1_ep14_tp0_pp2 [label="Expert L8 SP1 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep14_pp2 -> layer_8_expert_sp1_ep14_tp0_pp2
	layer_8_expert_out_sp1_ep14_tp0_pp2 [label="Expert Out L8 SP1 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep14_tp0_pp2 -> layer_8_expert_out_sp1_ep14_tp0_pp2
	layer_8_expert_sp1_ep14_tp1_pp2 [label="Expert L8 SP1 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep14_pp2 -> layer_8_expert_sp1_ep14_tp1_pp2
	layer_8_expert_out_sp1_ep14_tp1_pp2 [label="Expert Out L8 SP1 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep14_tp1_pp2 -> layer_8_expert_out_sp1_ep14_tp1_pp2
	layer_8_expert_sp1_ep14_tp2_pp2 [label="Expert L8 SP1 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep14_pp2 -> layer_8_expert_sp1_ep14_tp2_pp2
	layer_8_expert_out_sp1_ep14_tp2_pp2 [label="Expert Out L8 SP1 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep14_tp2_pp2 -> layer_8_expert_out_sp1_ep14_tp2_pp2
	layer_8_expert_sp1_ep14_tp3_pp2 [label="Expert L8 SP1 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep14_pp2 -> layer_8_expert_sp1_ep14_tp3_pp2
	layer_8_expert_out_sp1_ep14_tp3_pp2 [label="Expert Out L8 SP1 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep14_tp3_pp2 -> layer_8_expert_out_sp1_ep14_tp3_pp2
	layer_8_expert_ar_sp1_ep14_pp2 [label="Expert All-Reduce L8 SP1 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep14_tp0_pp2 -> layer_8_expert_ar_sp1_ep14_pp2
	layer_8_expert_out_sp1_ep14_tp1_pp2 -> layer_8_expert_ar_sp1_ep14_pp2
	layer_8_expert_out_sp1_ep14_tp2_pp2 -> layer_8_expert_ar_sp1_ep14_pp2
	layer_8_expert_out_sp1_ep14_tp3_pp2 -> layer_8_expert_ar_sp1_ep14_pp2
	layer_8_combine_sp1_ep14_pp2 [label="Token Combine L8 SP1 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep14_pp2 -> layer_8_combine_sp1_ep14_pp2
	layer_8_dispatch_sp1_ep15_pp2 [label="Token Dispatch L8 SP1 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp1_pp2 -> layer_8_dispatch_sp1_ep15_pp2 [style=dashed]
	layer_8_expert_sp1_ep15_tp0_pp2 [label="Expert L8 SP1 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep15_pp2 -> layer_8_expert_sp1_ep15_tp0_pp2
	layer_8_expert_out_sp1_ep15_tp0_pp2 [label="Expert Out L8 SP1 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep15_tp0_pp2 -> layer_8_expert_out_sp1_ep15_tp0_pp2
	layer_8_expert_sp1_ep15_tp1_pp2 [label="Expert L8 SP1 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep15_pp2 -> layer_8_expert_sp1_ep15_tp1_pp2
	layer_8_expert_out_sp1_ep15_tp1_pp2 [label="Expert Out L8 SP1 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep15_tp1_pp2 -> layer_8_expert_out_sp1_ep15_tp1_pp2
	layer_8_expert_sp1_ep15_tp2_pp2 [label="Expert L8 SP1 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep15_pp2 -> layer_8_expert_sp1_ep15_tp2_pp2
	layer_8_expert_out_sp1_ep15_tp2_pp2 [label="Expert Out L8 SP1 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep15_tp2_pp2 -> layer_8_expert_out_sp1_ep15_tp2_pp2
	layer_8_expert_sp1_ep15_tp3_pp2 [label="Expert L8 SP1 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp1_ep15_pp2 -> layer_8_expert_sp1_ep15_tp3_pp2
	layer_8_expert_out_sp1_ep15_tp3_pp2 [label="Expert Out L8 SP1 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp1_ep15_tp3_pp2 -> layer_8_expert_out_sp1_ep15_tp3_pp2
	layer_8_expert_ar_sp1_ep15_pp2 [label="Expert All-Reduce L8 SP1 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp1_ep15_tp0_pp2 -> layer_8_expert_ar_sp1_ep15_pp2
	layer_8_expert_out_sp1_ep15_tp1_pp2 -> layer_8_expert_ar_sp1_ep15_pp2
	layer_8_expert_out_sp1_ep15_tp2_pp2 -> layer_8_expert_ar_sp1_ep15_pp2
	layer_8_expert_out_sp1_ep15_tp3_pp2 -> layer_8_expert_ar_sp1_ep15_pp2
	layer_8_combine_sp1_ep15_pp2 [label="Token Combine L8 SP1 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp1_ep15_pp2 -> layer_8_combine_sp1_ep15_pp2
	layer_8_moe_all2all_sp1_pp2 [label="MoE All-to-All L8 SP1\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_8_combine_sp1_ep0_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep1_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep2_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep3_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep4_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep5_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep6_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep7_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep8_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep9_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep10_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep11_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep12_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep13_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep14_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_combine_sp1_ep15_pp2 -> layer_8_moe_all2all_sp1_pp2
	layer_8_mlp_out_sp1_pp2 [label="MoE Output L8 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_moe_all2all_sp1_pp2 -> layer_8_mlp_out_sp1_pp2
	layer_8_mlp_res_sp1_pp2 [label="MLP Residual L8 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_mlp_out_sp1_pp2 -> layer_8_mlp_res_sp1_pp2
	layer_8_attn_res_sp1_pp2 -> layer_8_mlp_res_sp1_pp2 [style=dashed]
	layer_8_norm_sp2_pp2 [label="LayerNorm L8 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_mlp_out_sp0_pp1 -> layer_8_norm_sp2_pp2 [style=dashed]
	layer_7_mlp_out_sp1_pp1 -> layer_8_norm_sp2_pp2 [style=dashed]
	layer_7_mlp_out_sp2_pp1 -> layer_8_norm_sp2_pp2 [style=dashed]
	layer_7_mlp_out_sp3_pp1 -> layer_8_norm_sp2_pp2 [style=dashed]
	layer_8_qkv_sp2_tp0_pp2 [label="QKV Proj L8 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp2_pp2 -> layer_8_qkv_sp2_tp0_pp2
	layer_8_attn_sp2_tp0_pp2 [label="Attention L8 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp2_tp0_pp2 -> layer_8_attn_sp2_tp0_pp2
	layer_8_attn_out_sp2_tp0_pp2 [label="Attn Out Proj L8 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp2_tp0_pp2 -> layer_8_attn_out_sp2_tp0_pp2
	layer_8_qkv_sp2_tp1_pp2 [label="QKV Proj L8 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp2_pp2 -> layer_8_qkv_sp2_tp1_pp2
	layer_8_attn_sp2_tp1_pp2 [label="Attention L8 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp2_tp1_pp2 -> layer_8_attn_sp2_tp1_pp2
	layer_8_attn_out_sp2_tp1_pp2 [label="Attn Out Proj L8 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp2_tp1_pp2 -> layer_8_attn_out_sp2_tp1_pp2
	layer_8_qkv_sp2_tp2_pp2 [label="QKV Proj L8 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp2_pp2 -> layer_8_qkv_sp2_tp2_pp2
	layer_8_attn_sp2_tp2_pp2 [label="Attention L8 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp2_tp2_pp2 -> layer_8_attn_sp2_tp2_pp2
	layer_8_attn_out_sp2_tp2_pp2 [label="Attn Out Proj L8 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp2_tp2_pp2 -> layer_8_attn_out_sp2_tp2_pp2
	layer_8_qkv_sp2_tp3_pp2 [label="QKV Proj L8 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp2_pp2 -> layer_8_qkv_sp2_tp3_pp2
	layer_8_attn_sp2_tp3_pp2 [label="Attention L8 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp2_tp3_pp2 -> layer_8_attn_sp2_tp3_pp2
	layer_8_attn_out_sp2_tp3_pp2 [label="Attn Out Proj L8 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp2_tp3_pp2 -> layer_8_attn_out_sp2_tp3_pp2
	layer_8_attn_ar_sp2_pp2 [label="Attention All-Reduce L8 SP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_attn_out_sp2_tp0_pp2 -> layer_8_attn_ar_sp2_pp2
	layer_8_attn_out_sp2_tp1_pp2 -> layer_8_attn_ar_sp2_pp2
	layer_8_attn_out_sp2_tp2_pp2 -> layer_8_attn_ar_sp2_pp2
	layer_8_attn_out_sp2_tp3_pp2 -> layer_8_attn_ar_sp2_pp2
	layer_8_attn_res_sp2_pp2 [label="Attention Residual L8 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_attn_ar_sp2_pp2 -> layer_8_attn_res_sp2_pp2
	layer_8_norm_sp2_pp2 -> layer_8_attn_res_sp2_pp2 [style=dashed]
	layer_8_post_norm_sp2_pp2 [label="Post-Attn Norm L8 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_attn_res_sp2_pp2 -> layer_8_post_norm_sp2_pp2
	layer_8_router_sp2_pp2 [label="MoE Router L8 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_8_post_norm_sp2_pp2 -> layer_8_router_sp2_pp2
	layer_8_dispatch_sp2_ep0_pp2 [label="Token Dispatch L8 SP2 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep0_pp2 [style=dashed]
	layer_8_expert_sp2_ep0_tp0_pp2 [label="Expert L8 SP2 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep0_pp2 -> layer_8_expert_sp2_ep0_tp0_pp2
	layer_8_expert_out_sp2_ep0_tp0_pp2 [label="Expert Out L8 SP2 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep0_tp0_pp2 -> layer_8_expert_out_sp2_ep0_tp0_pp2
	layer_8_expert_sp2_ep0_tp1_pp2 [label="Expert L8 SP2 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep0_pp2 -> layer_8_expert_sp2_ep0_tp1_pp2
	layer_8_expert_out_sp2_ep0_tp1_pp2 [label="Expert Out L8 SP2 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep0_tp1_pp2 -> layer_8_expert_out_sp2_ep0_tp1_pp2
	layer_8_expert_sp2_ep0_tp2_pp2 [label="Expert L8 SP2 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep0_pp2 -> layer_8_expert_sp2_ep0_tp2_pp2
	layer_8_expert_out_sp2_ep0_tp2_pp2 [label="Expert Out L8 SP2 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep0_tp2_pp2 -> layer_8_expert_out_sp2_ep0_tp2_pp2
	layer_8_expert_sp2_ep0_tp3_pp2 [label="Expert L8 SP2 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep0_pp2 -> layer_8_expert_sp2_ep0_tp3_pp2
	layer_8_expert_out_sp2_ep0_tp3_pp2 [label="Expert Out L8 SP2 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep0_tp3_pp2 -> layer_8_expert_out_sp2_ep0_tp3_pp2
	layer_8_expert_ar_sp2_ep0_pp2 [label="Expert All-Reduce L8 SP2 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep0_tp0_pp2 -> layer_8_expert_ar_sp2_ep0_pp2
	layer_8_expert_out_sp2_ep0_tp1_pp2 -> layer_8_expert_ar_sp2_ep0_pp2
	layer_8_expert_out_sp2_ep0_tp2_pp2 -> layer_8_expert_ar_sp2_ep0_pp2
	layer_8_expert_out_sp2_ep0_tp3_pp2 -> layer_8_expert_ar_sp2_ep0_pp2
	layer_8_combine_sp2_ep0_pp2 [label="Token Combine L8 SP2 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep0_pp2 -> layer_8_combine_sp2_ep0_pp2
	layer_8_dispatch_sp2_ep1_pp2 [label="Token Dispatch L8 SP2 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep1_pp2 [style=dashed]
	layer_8_expert_sp2_ep1_tp0_pp2 [label="Expert L8 SP2 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep1_pp2 -> layer_8_expert_sp2_ep1_tp0_pp2
	layer_8_expert_out_sp2_ep1_tp0_pp2 [label="Expert Out L8 SP2 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep1_tp0_pp2 -> layer_8_expert_out_sp2_ep1_tp0_pp2
	layer_8_expert_sp2_ep1_tp1_pp2 [label="Expert L8 SP2 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep1_pp2 -> layer_8_expert_sp2_ep1_tp1_pp2
	layer_8_expert_out_sp2_ep1_tp1_pp2 [label="Expert Out L8 SP2 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep1_tp1_pp2 -> layer_8_expert_out_sp2_ep1_tp1_pp2
	layer_8_expert_sp2_ep1_tp2_pp2 [label="Expert L8 SP2 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep1_pp2 -> layer_8_expert_sp2_ep1_tp2_pp2
	layer_8_expert_out_sp2_ep1_tp2_pp2 [label="Expert Out L8 SP2 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep1_tp2_pp2 -> layer_8_expert_out_sp2_ep1_tp2_pp2
	layer_8_expert_sp2_ep1_tp3_pp2 [label="Expert L8 SP2 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep1_pp2 -> layer_8_expert_sp2_ep1_tp3_pp2
	layer_8_expert_out_sp2_ep1_tp3_pp2 [label="Expert Out L8 SP2 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep1_tp3_pp2 -> layer_8_expert_out_sp2_ep1_tp3_pp2
	layer_8_expert_ar_sp2_ep1_pp2 [label="Expert All-Reduce L8 SP2 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep1_tp0_pp2 -> layer_8_expert_ar_sp2_ep1_pp2
	layer_8_expert_out_sp2_ep1_tp1_pp2 -> layer_8_expert_ar_sp2_ep1_pp2
	layer_8_expert_out_sp2_ep1_tp2_pp2 -> layer_8_expert_ar_sp2_ep1_pp2
	layer_8_expert_out_sp2_ep1_tp3_pp2 -> layer_8_expert_ar_sp2_ep1_pp2
	layer_8_combine_sp2_ep1_pp2 [label="Token Combine L8 SP2 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep1_pp2 -> layer_8_combine_sp2_ep1_pp2
	layer_8_dispatch_sp2_ep2_pp2 [label="Token Dispatch L8 SP2 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep2_pp2 [style=dashed]
	layer_8_expert_sp2_ep2_tp0_pp2 [label="Expert L8 SP2 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep2_pp2 -> layer_8_expert_sp2_ep2_tp0_pp2
	layer_8_expert_out_sp2_ep2_tp0_pp2 [label="Expert Out L8 SP2 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep2_tp0_pp2 -> layer_8_expert_out_sp2_ep2_tp0_pp2
	layer_8_expert_sp2_ep2_tp1_pp2 [label="Expert L8 SP2 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep2_pp2 -> layer_8_expert_sp2_ep2_tp1_pp2
	layer_8_expert_out_sp2_ep2_tp1_pp2 [label="Expert Out L8 SP2 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep2_tp1_pp2 -> layer_8_expert_out_sp2_ep2_tp1_pp2
	layer_8_expert_sp2_ep2_tp2_pp2 [label="Expert L8 SP2 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep2_pp2 -> layer_8_expert_sp2_ep2_tp2_pp2
	layer_8_expert_out_sp2_ep2_tp2_pp2 [label="Expert Out L8 SP2 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep2_tp2_pp2 -> layer_8_expert_out_sp2_ep2_tp2_pp2
	layer_8_expert_sp2_ep2_tp3_pp2 [label="Expert L8 SP2 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep2_pp2 -> layer_8_expert_sp2_ep2_tp3_pp2
	layer_8_expert_out_sp2_ep2_tp3_pp2 [label="Expert Out L8 SP2 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep2_tp3_pp2 -> layer_8_expert_out_sp2_ep2_tp3_pp2
	layer_8_expert_ar_sp2_ep2_pp2 [label="Expert All-Reduce L8 SP2 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep2_tp0_pp2 -> layer_8_expert_ar_sp2_ep2_pp2
	layer_8_expert_out_sp2_ep2_tp1_pp2 -> layer_8_expert_ar_sp2_ep2_pp2
	layer_8_expert_out_sp2_ep2_tp2_pp2 -> layer_8_expert_ar_sp2_ep2_pp2
	layer_8_expert_out_sp2_ep2_tp3_pp2 -> layer_8_expert_ar_sp2_ep2_pp2
	layer_8_combine_sp2_ep2_pp2 [label="Token Combine L8 SP2 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep2_pp2 -> layer_8_combine_sp2_ep2_pp2
	layer_8_dispatch_sp2_ep3_pp2 [label="Token Dispatch L8 SP2 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep3_pp2 [style=dashed]
	layer_8_expert_sp2_ep3_tp0_pp2 [label="Expert L8 SP2 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep3_pp2 -> layer_8_expert_sp2_ep3_tp0_pp2
	layer_8_expert_out_sp2_ep3_tp0_pp2 [label="Expert Out L8 SP2 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep3_tp0_pp2 -> layer_8_expert_out_sp2_ep3_tp0_pp2
	layer_8_expert_sp2_ep3_tp1_pp2 [label="Expert L8 SP2 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep3_pp2 -> layer_8_expert_sp2_ep3_tp1_pp2
	layer_8_expert_out_sp2_ep3_tp1_pp2 [label="Expert Out L8 SP2 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep3_tp1_pp2 -> layer_8_expert_out_sp2_ep3_tp1_pp2
	layer_8_expert_sp2_ep3_tp2_pp2 [label="Expert L8 SP2 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep3_pp2 -> layer_8_expert_sp2_ep3_tp2_pp2
	layer_8_expert_out_sp2_ep3_tp2_pp2 [label="Expert Out L8 SP2 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep3_tp2_pp2 -> layer_8_expert_out_sp2_ep3_tp2_pp2
	layer_8_expert_sp2_ep3_tp3_pp2 [label="Expert L8 SP2 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep3_pp2 -> layer_8_expert_sp2_ep3_tp3_pp2
	layer_8_expert_out_sp2_ep3_tp3_pp2 [label="Expert Out L8 SP2 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep3_tp3_pp2 -> layer_8_expert_out_sp2_ep3_tp3_pp2
	layer_8_expert_ar_sp2_ep3_pp2 [label="Expert All-Reduce L8 SP2 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep3_tp0_pp2 -> layer_8_expert_ar_sp2_ep3_pp2
	layer_8_expert_out_sp2_ep3_tp1_pp2 -> layer_8_expert_ar_sp2_ep3_pp2
	layer_8_expert_out_sp2_ep3_tp2_pp2 -> layer_8_expert_ar_sp2_ep3_pp2
	layer_8_expert_out_sp2_ep3_tp3_pp2 -> layer_8_expert_ar_sp2_ep3_pp2
	layer_8_combine_sp2_ep3_pp2 [label="Token Combine L8 SP2 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep3_pp2 -> layer_8_combine_sp2_ep3_pp2
	layer_8_dispatch_sp2_ep4_pp2 [label="Token Dispatch L8 SP2 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep4_pp2 [style=dashed]
	layer_8_expert_sp2_ep4_tp0_pp2 [label="Expert L8 SP2 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep4_pp2 -> layer_8_expert_sp2_ep4_tp0_pp2
	layer_8_expert_out_sp2_ep4_tp0_pp2 [label="Expert Out L8 SP2 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep4_tp0_pp2 -> layer_8_expert_out_sp2_ep4_tp0_pp2
	layer_8_expert_sp2_ep4_tp1_pp2 [label="Expert L8 SP2 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep4_pp2 -> layer_8_expert_sp2_ep4_tp1_pp2
	layer_8_expert_out_sp2_ep4_tp1_pp2 [label="Expert Out L8 SP2 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep4_tp1_pp2 -> layer_8_expert_out_sp2_ep4_tp1_pp2
	layer_8_expert_sp2_ep4_tp2_pp2 [label="Expert L8 SP2 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep4_pp2 -> layer_8_expert_sp2_ep4_tp2_pp2
	layer_8_expert_out_sp2_ep4_tp2_pp2 [label="Expert Out L8 SP2 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep4_tp2_pp2 -> layer_8_expert_out_sp2_ep4_tp2_pp2
	layer_8_expert_sp2_ep4_tp3_pp2 [label="Expert L8 SP2 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep4_pp2 -> layer_8_expert_sp2_ep4_tp3_pp2
	layer_8_expert_out_sp2_ep4_tp3_pp2 [label="Expert Out L8 SP2 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep4_tp3_pp2 -> layer_8_expert_out_sp2_ep4_tp3_pp2
	layer_8_expert_ar_sp2_ep4_pp2 [label="Expert All-Reduce L8 SP2 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep4_tp0_pp2 -> layer_8_expert_ar_sp2_ep4_pp2
	layer_8_expert_out_sp2_ep4_tp1_pp2 -> layer_8_expert_ar_sp2_ep4_pp2
	layer_8_expert_out_sp2_ep4_tp2_pp2 -> layer_8_expert_ar_sp2_ep4_pp2
	layer_8_expert_out_sp2_ep4_tp3_pp2 -> layer_8_expert_ar_sp2_ep4_pp2
	layer_8_combine_sp2_ep4_pp2 [label="Token Combine L8 SP2 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep4_pp2 -> layer_8_combine_sp2_ep4_pp2
	layer_8_dispatch_sp2_ep5_pp2 [label="Token Dispatch L8 SP2 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep5_pp2 [style=dashed]
	layer_8_expert_sp2_ep5_tp0_pp2 [label="Expert L8 SP2 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep5_pp2 -> layer_8_expert_sp2_ep5_tp0_pp2
	layer_8_expert_out_sp2_ep5_tp0_pp2 [label="Expert Out L8 SP2 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep5_tp0_pp2 -> layer_8_expert_out_sp2_ep5_tp0_pp2
	layer_8_expert_sp2_ep5_tp1_pp2 [label="Expert L8 SP2 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep5_pp2 -> layer_8_expert_sp2_ep5_tp1_pp2
	layer_8_expert_out_sp2_ep5_tp1_pp2 [label="Expert Out L8 SP2 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep5_tp1_pp2 -> layer_8_expert_out_sp2_ep5_tp1_pp2
	layer_8_expert_sp2_ep5_tp2_pp2 [label="Expert L8 SP2 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep5_pp2 -> layer_8_expert_sp2_ep5_tp2_pp2
	layer_8_expert_out_sp2_ep5_tp2_pp2 [label="Expert Out L8 SP2 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep5_tp2_pp2 -> layer_8_expert_out_sp2_ep5_tp2_pp2
	layer_8_expert_sp2_ep5_tp3_pp2 [label="Expert L8 SP2 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep5_pp2 -> layer_8_expert_sp2_ep5_tp3_pp2
	layer_8_expert_out_sp2_ep5_tp3_pp2 [label="Expert Out L8 SP2 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep5_tp3_pp2 -> layer_8_expert_out_sp2_ep5_tp3_pp2
	layer_8_expert_ar_sp2_ep5_pp2 [label="Expert All-Reduce L8 SP2 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep5_tp0_pp2 -> layer_8_expert_ar_sp2_ep5_pp2
	layer_8_expert_out_sp2_ep5_tp1_pp2 -> layer_8_expert_ar_sp2_ep5_pp2
	layer_8_expert_out_sp2_ep5_tp2_pp2 -> layer_8_expert_ar_sp2_ep5_pp2
	layer_8_expert_out_sp2_ep5_tp3_pp2 -> layer_8_expert_ar_sp2_ep5_pp2
	layer_8_combine_sp2_ep5_pp2 [label="Token Combine L8 SP2 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep5_pp2 -> layer_8_combine_sp2_ep5_pp2
	layer_8_dispatch_sp2_ep6_pp2 [label="Token Dispatch L8 SP2 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep6_pp2 [style=dashed]
	layer_8_expert_sp2_ep6_tp0_pp2 [label="Expert L8 SP2 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep6_pp2 -> layer_8_expert_sp2_ep6_tp0_pp2
	layer_8_expert_out_sp2_ep6_tp0_pp2 [label="Expert Out L8 SP2 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep6_tp0_pp2 -> layer_8_expert_out_sp2_ep6_tp0_pp2
	layer_8_expert_sp2_ep6_tp1_pp2 [label="Expert L8 SP2 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep6_pp2 -> layer_8_expert_sp2_ep6_tp1_pp2
	layer_8_expert_out_sp2_ep6_tp1_pp2 [label="Expert Out L8 SP2 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep6_tp1_pp2 -> layer_8_expert_out_sp2_ep6_tp1_pp2
	layer_8_expert_sp2_ep6_tp2_pp2 [label="Expert L8 SP2 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep6_pp2 -> layer_8_expert_sp2_ep6_tp2_pp2
	layer_8_expert_out_sp2_ep6_tp2_pp2 [label="Expert Out L8 SP2 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep6_tp2_pp2 -> layer_8_expert_out_sp2_ep6_tp2_pp2
	layer_8_expert_sp2_ep6_tp3_pp2 [label="Expert L8 SP2 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep6_pp2 -> layer_8_expert_sp2_ep6_tp3_pp2
	layer_8_expert_out_sp2_ep6_tp3_pp2 [label="Expert Out L8 SP2 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep6_tp3_pp2 -> layer_8_expert_out_sp2_ep6_tp3_pp2
	layer_8_expert_ar_sp2_ep6_pp2 [label="Expert All-Reduce L8 SP2 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep6_tp0_pp2 -> layer_8_expert_ar_sp2_ep6_pp2
	layer_8_expert_out_sp2_ep6_tp1_pp2 -> layer_8_expert_ar_sp2_ep6_pp2
	layer_8_expert_out_sp2_ep6_tp2_pp2 -> layer_8_expert_ar_sp2_ep6_pp2
	layer_8_expert_out_sp2_ep6_tp3_pp2 -> layer_8_expert_ar_sp2_ep6_pp2
	layer_8_combine_sp2_ep6_pp2 [label="Token Combine L8 SP2 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep6_pp2 -> layer_8_combine_sp2_ep6_pp2
	layer_8_dispatch_sp2_ep7_pp2 [label="Token Dispatch L8 SP2 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep7_pp2 [style=dashed]
	layer_8_expert_sp2_ep7_tp0_pp2 [label="Expert L8 SP2 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep7_pp2 -> layer_8_expert_sp2_ep7_tp0_pp2
	layer_8_expert_out_sp2_ep7_tp0_pp2 [label="Expert Out L8 SP2 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep7_tp0_pp2 -> layer_8_expert_out_sp2_ep7_tp0_pp2
	layer_8_expert_sp2_ep7_tp1_pp2 [label="Expert L8 SP2 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep7_pp2 -> layer_8_expert_sp2_ep7_tp1_pp2
	layer_8_expert_out_sp2_ep7_tp1_pp2 [label="Expert Out L8 SP2 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep7_tp1_pp2 -> layer_8_expert_out_sp2_ep7_tp1_pp2
	layer_8_expert_sp2_ep7_tp2_pp2 [label="Expert L8 SP2 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep7_pp2 -> layer_8_expert_sp2_ep7_tp2_pp2
	layer_8_expert_out_sp2_ep7_tp2_pp2 [label="Expert Out L8 SP2 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep7_tp2_pp2 -> layer_8_expert_out_sp2_ep7_tp2_pp2
	layer_8_expert_sp2_ep7_tp3_pp2 [label="Expert L8 SP2 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep7_pp2 -> layer_8_expert_sp2_ep7_tp3_pp2
	layer_8_expert_out_sp2_ep7_tp3_pp2 [label="Expert Out L8 SP2 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep7_tp3_pp2 -> layer_8_expert_out_sp2_ep7_tp3_pp2
	layer_8_expert_ar_sp2_ep7_pp2 [label="Expert All-Reduce L8 SP2 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep7_tp0_pp2 -> layer_8_expert_ar_sp2_ep7_pp2
	layer_8_expert_out_sp2_ep7_tp1_pp2 -> layer_8_expert_ar_sp2_ep7_pp2
	layer_8_expert_out_sp2_ep7_tp2_pp2 -> layer_8_expert_ar_sp2_ep7_pp2
	layer_8_expert_out_sp2_ep7_tp3_pp2 -> layer_8_expert_ar_sp2_ep7_pp2
	layer_8_combine_sp2_ep7_pp2 [label="Token Combine L8 SP2 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep7_pp2 -> layer_8_combine_sp2_ep7_pp2
	layer_8_dispatch_sp2_ep8_pp2 [label="Token Dispatch L8 SP2 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep8_pp2 [style=dashed]
	layer_8_expert_sp2_ep8_tp0_pp2 [label="Expert L8 SP2 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep8_pp2 -> layer_8_expert_sp2_ep8_tp0_pp2
	layer_8_expert_out_sp2_ep8_tp0_pp2 [label="Expert Out L8 SP2 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep8_tp0_pp2 -> layer_8_expert_out_sp2_ep8_tp0_pp2
	layer_8_expert_sp2_ep8_tp1_pp2 [label="Expert L8 SP2 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep8_pp2 -> layer_8_expert_sp2_ep8_tp1_pp2
	layer_8_expert_out_sp2_ep8_tp1_pp2 [label="Expert Out L8 SP2 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep8_tp1_pp2 -> layer_8_expert_out_sp2_ep8_tp1_pp2
	layer_8_expert_sp2_ep8_tp2_pp2 [label="Expert L8 SP2 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep8_pp2 -> layer_8_expert_sp2_ep8_tp2_pp2
	layer_8_expert_out_sp2_ep8_tp2_pp2 [label="Expert Out L8 SP2 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep8_tp2_pp2 -> layer_8_expert_out_sp2_ep8_tp2_pp2
	layer_8_expert_sp2_ep8_tp3_pp2 [label="Expert L8 SP2 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep8_pp2 -> layer_8_expert_sp2_ep8_tp3_pp2
	layer_8_expert_out_sp2_ep8_tp3_pp2 [label="Expert Out L8 SP2 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep8_tp3_pp2 -> layer_8_expert_out_sp2_ep8_tp3_pp2
	layer_8_expert_ar_sp2_ep8_pp2 [label="Expert All-Reduce L8 SP2 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep8_tp0_pp2 -> layer_8_expert_ar_sp2_ep8_pp2
	layer_8_expert_out_sp2_ep8_tp1_pp2 -> layer_8_expert_ar_sp2_ep8_pp2
	layer_8_expert_out_sp2_ep8_tp2_pp2 -> layer_8_expert_ar_sp2_ep8_pp2
	layer_8_expert_out_sp2_ep8_tp3_pp2 -> layer_8_expert_ar_sp2_ep8_pp2
	layer_8_combine_sp2_ep8_pp2 [label="Token Combine L8 SP2 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep8_pp2 -> layer_8_combine_sp2_ep8_pp2
	layer_8_dispatch_sp2_ep9_pp2 [label="Token Dispatch L8 SP2 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep9_pp2 [style=dashed]
	layer_8_expert_sp2_ep9_tp0_pp2 [label="Expert L8 SP2 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep9_pp2 -> layer_8_expert_sp2_ep9_tp0_pp2
	layer_8_expert_out_sp2_ep9_tp0_pp2 [label="Expert Out L8 SP2 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep9_tp0_pp2 -> layer_8_expert_out_sp2_ep9_tp0_pp2
	layer_8_expert_sp2_ep9_tp1_pp2 [label="Expert L8 SP2 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep9_pp2 -> layer_8_expert_sp2_ep9_tp1_pp2
	layer_8_expert_out_sp2_ep9_tp1_pp2 [label="Expert Out L8 SP2 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep9_tp1_pp2 -> layer_8_expert_out_sp2_ep9_tp1_pp2
	layer_8_expert_sp2_ep9_tp2_pp2 [label="Expert L8 SP2 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep9_pp2 -> layer_8_expert_sp2_ep9_tp2_pp2
	layer_8_expert_out_sp2_ep9_tp2_pp2 [label="Expert Out L8 SP2 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep9_tp2_pp2 -> layer_8_expert_out_sp2_ep9_tp2_pp2
	layer_8_expert_sp2_ep9_tp3_pp2 [label="Expert L8 SP2 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep9_pp2 -> layer_8_expert_sp2_ep9_tp3_pp2
	layer_8_expert_out_sp2_ep9_tp3_pp2 [label="Expert Out L8 SP2 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep9_tp3_pp2 -> layer_8_expert_out_sp2_ep9_tp3_pp2
	layer_8_expert_ar_sp2_ep9_pp2 [label="Expert All-Reduce L8 SP2 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep9_tp0_pp2 -> layer_8_expert_ar_sp2_ep9_pp2
	layer_8_expert_out_sp2_ep9_tp1_pp2 -> layer_8_expert_ar_sp2_ep9_pp2
	layer_8_expert_out_sp2_ep9_tp2_pp2 -> layer_8_expert_ar_sp2_ep9_pp2
	layer_8_expert_out_sp2_ep9_tp3_pp2 -> layer_8_expert_ar_sp2_ep9_pp2
	layer_8_combine_sp2_ep9_pp2 [label="Token Combine L8 SP2 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep9_pp2 -> layer_8_combine_sp2_ep9_pp2
	layer_8_dispatch_sp2_ep10_pp2 [label="Token Dispatch L8 SP2 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep10_pp2 [style=dashed]
	layer_8_expert_sp2_ep10_tp0_pp2 [label="Expert L8 SP2 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep10_pp2 -> layer_8_expert_sp2_ep10_tp0_pp2
	layer_8_expert_out_sp2_ep10_tp0_pp2 [label="Expert Out L8 SP2 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep10_tp0_pp2 -> layer_8_expert_out_sp2_ep10_tp0_pp2
	layer_8_expert_sp2_ep10_tp1_pp2 [label="Expert L8 SP2 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep10_pp2 -> layer_8_expert_sp2_ep10_tp1_pp2
	layer_8_expert_out_sp2_ep10_tp1_pp2 [label="Expert Out L8 SP2 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep10_tp1_pp2 -> layer_8_expert_out_sp2_ep10_tp1_pp2
	layer_8_expert_sp2_ep10_tp2_pp2 [label="Expert L8 SP2 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep10_pp2 -> layer_8_expert_sp2_ep10_tp2_pp2
	layer_8_expert_out_sp2_ep10_tp2_pp2 [label="Expert Out L8 SP2 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep10_tp2_pp2 -> layer_8_expert_out_sp2_ep10_tp2_pp2
	layer_8_expert_sp2_ep10_tp3_pp2 [label="Expert L8 SP2 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep10_pp2 -> layer_8_expert_sp2_ep10_tp3_pp2
	layer_8_expert_out_sp2_ep10_tp3_pp2 [label="Expert Out L8 SP2 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep10_tp3_pp2 -> layer_8_expert_out_sp2_ep10_tp3_pp2
	layer_8_expert_ar_sp2_ep10_pp2 [label="Expert All-Reduce L8 SP2 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep10_tp0_pp2 -> layer_8_expert_ar_sp2_ep10_pp2
	layer_8_expert_out_sp2_ep10_tp1_pp2 -> layer_8_expert_ar_sp2_ep10_pp2
	layer_8_expert_out_sp2_ep10_tp2_pp2 -> layer_8_expert_ar_sp2_ep10_pp2
	layer_8_expert_out_sp2_ep10_tp3_pp2 -> layer_8_expert_ar_sp2_ep10_pp2
	layer_8_combine_sp2_ep10_pp2 [label="Token Combine L8 SP2 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep10_pp2 -> layer_8_combine_sp2_ep10_pp2
	layer_8_dispatch_sp2_ep11_pp2 [label="Token Dispatch L8 SP2 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep11_pp2 [style=dashed]
	layer_8_expert_sp2_ep11_tp0_pp2 [label="Expert L8 SP2 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep11_pp2 -> layer_8_expert_sp2_ep11_tp0_pp2
	layer_8_expert_out_sp2_ep11_tp0_pp2 [label="Expert Out L8 SP2 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep11_tp0_pp2 -> layer_8_expert_out_sp2_ep11_tp0_pp2
	layer_8_expert_sp2_ep11_tp1_pp2 [label="Expert L8 SP2 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep11_pp2 -> layer_8_expert_sp2_ep11_tp1_pp2
	layer_8_expert_out_sp2_ep11_tp1_pp2 [label="Expert Out L8 SP2 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep11_tp1_pp2 -> layer_8_expert_out_sp2_ep11_tp1_pp2
	layer_8_expert_sp2_ep11_tp2_pp2 [label="Expert L8 SP2 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep11_pp2 -> layer_8_expert_sp2_ep11_tp2_pp2
	layer_8_expert_out_sp2_ep11_tp2_pp2 [label="Expert Out L8 SP2 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep11_tp2_pp2 -> layer_8_expert_out_sp2_ep11_tp2_pp2
	layer_8_expert_sp2_ep11_tp3_pp2 [label="Expert L8 SP2 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep11_pp2 -> layer_8_expert_sp2_ep11_tp3_pp2
	layer_8_expert_out_sp2_ep11_tp3_pp2 [label="Expert Out L8 SP2 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep11_tp3_pp2 -> layer_8_expert_out_sp2_ep11_tp3_pp2
	layer_8_expert_ar_sp2_ep11_pp2 [label="Expert All-Reduce L8 SP2 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep11_tp0_pp2 -> layer_8_expert_ar_sp2_ep11_pp2
	layer_8_expert_out_sp2_ep11_tp1_pp2 -> layer_8_expert_ar_sp2_ep11_pp2
	layer_8_expert_out_sp2_ep11_tp2_pp2 -> layer_8_expert_ar_sp2_ep11_pp2
	layer_8_expert_out_sp2_ep11_tp3_pp2 -> layer_8_expert_ar_sp2_ep11_pp2
	layer_8_combine_sp2_ep11_pp2 [label="Token Combine L8 SP2 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep11_pp2 -> layer_8_combine_sp2_ep11_pp2
	layer_8_dispatch_sp2_ep12_pp2 [label="Token Dispatch L8 SP2 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep12_pp2 [style=dashed]
	layer_8_expert_sp2_ep12_tp0_pp2 [label="Expert L8 SP2 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep12_pp2 -> layer_8_expert_sp2_ep12_tp0_pp2
	layer_8_expert_out_sp2_ep12_tp0_pp2 [label="Expert Out L8 SP2 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep12_tp0_pp2 -> layer_8_expert_out_sp2_ep12_tp0_pp2
	layer_8_expert_sp2_ep12_tp1_pp2 [label="Expert L8 SP2 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep12_pp2 -> layer_8_expert_sp2_ep12_tp1_pp2
	layer_8_expert_out_sp2_ep12_tp1_pp2 [label="Expert Out L8 SP2 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep12_tp1_pp2 -> layer_8_expert_out_sp2_ep12_tp1_pp2
	layer_8_expert_sp2_ep12_tp2_pp2 [label="Expert L8 SP2 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep12_pp2 -> layer_8_expert_sp2_ep12_tp2_pp2
	layer_8_expert_out_sp2_ep12_tp2_pp2 [label="Expert Out L8 SP2 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep12_tp2_pp2 -> layer_8_expert_out_sp2_ep12_tp2_pp2
	layer_8_expert_sp2_ep12_tp3_pp2 [label="Expert L8 SP2 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep12_pp2 -> layer_8_expert_sp2_ep12_tp3_pp2
	layer_8_expert_out_sp2_ep12_tp3_pp2 [label="Expert Out L8 SP2 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep12_tp3_pp2 -> layer_8_expert_out_sp2_ep12_tp3_pp2
	layer_8_expert_ar_sp2_ep12_pp2 [label="Expert All-Reduce L8 SP2 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep12_tp0_pp2 -> layer_8_expert_ar_sp2_ep12_pp2
	layer_8_expert_out_sp2_ep12_tp1_pp2 -> layer_8_expert_ar_sp2_ep12_pp2
	layer_8_expert_out_sp2_ep12_tp2_pp2 -> layer_8_expert_ar_sp2_ep12_pp2
	layer_8_expert_out_sp2_ep12_tp3_pp2 -> layer_8_expert_ar_sp2_ep12_pp2
	layer_8_combine_sp2_ep12_pp2 [label="Token Combine L8 SP2 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep12_pp2 -> layer_8_combine_sp2_ep12_pp2
	layer_8_dispatch_sp2_ep13_pp2 [label="Token Dispatch L8 SP2 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep13_pp2 [style=dashed]
	layer_8_expert_sp2_ep13_tp0_pp2 [label="Expert L8 SP2 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep13_pp2 -> layer_8_expert_sp2_ep13_tp0_pp2
	layer_8_expert_out_sp2_ep13_tp0_pp2 [label="Expert Out L8 SP2 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep13_tp0_pp2 -> layer_8_expert_out_sp2_ep13_tp0_pp2
	layer_8_expert_sp2_ep13_tp1_pp2 [label="Expert L8 SP2 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep13_pp2 -> layer_8_expert_sp2_ep13_tp1_pp2
	layer_8_expert_out_sp2_ep13_tp1_pp2 [label="Expert Out L8 SP2 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep13_tp1_pp2 -> layer_8_expert_out_sp2_ep13_tp1_pp2
	layer_8_expert_sp2_ep13_tp2_pp2 [label="Expert L8 SP2 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep13_pp2 -> layer_8_expert_sp2_ep13_tp2_pp2
	layer_8_expert_out_sp2_ep13_tp2_pp2 [label="Expert Out L8 SP2 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep13_tp2_pp2 -> layer_8_expert_out_sp2_ep13_tp2_pp2
	layer_8_expert_sp2_ep13_tp3_pp2 [label="Expert L8 SP2 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep13_pp2 -> layer_8_expert_sp2_ep13_tp3_pp2
	layer_8_expert_out_sp2_ep13_tp3_pp2 [label="Expert Out L8 SP2 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep13_tp3_pp2 -> layer_8_expert_out_sp2_ep13_tp3_pp2
	layer_8_expert_ar_sp2_ep13_pp2 [label="Expert All-Reduce L8 SP2 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep13_tp0_pp2 -> layer_8_expert_ar_sp2_ep13_pp2
	layer_8_expert_out_sp2_ep13_tp1_pp2 -> layer_8_expert_ar_sp2_ep13_pp2
	layer_8_expert_out_sp2_ep13_tp2_pp2 -> layer_8_expert_ar_sp2_ep13_pp2
	layer_8_expert_out_sp2_ep13_tp3_pp2 -> layer_8_expert_ar_sp2_ep13_pp2
	layer_8_combine_sp2_ep13_pp2 [label="Token Combine L8 SP2 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep13_pp2 -> layer_8_combine_sp2_ep13_pp2
	layer_8_dispatch_sp2_ep14_pp2 [label="Token Dispatch L8 SP2 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep14_pp2 [style=dashed]
	layer_8_expert_sp2_ep14_tp0_pp2 [label="Expert L8 SP2 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep14_pp2 -> layer_8_expert_sp2_ep14_tp0_pp2
	layer_8_expert_out_sp2_ep14_tp0_pp2 [label="Expert Out L8 SP2 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep14_tp0_pp2 -> layer_8_expert_out_sp2_ep14_tp0_pp2
	layer_8_expert_sp2_ep14_tp1_pp2 [label="Expert L8 SP2 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep14_pp2 -> layer_8_expert_sp2_ep14_tp1_pp2
	layer_8_expert_out_sp2_ep14_tp1_pp2 [label="Expert Out L8 SP2 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep14_tp1_pp2 -> layer_8_expert_out_sp2_ep14_tp1_pp2
	layer_8_expert_sp2_ep14_tp2_pp2 [label="Expert L8 SP2 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep14_pp2 -> layer_8_expert_sp2_ep14_tp2_pp2
	layer_8_expert_out_sp2_ep14_tp2_pp2 [label="Expert Out L8 SP2 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep14_tp2_pp2 -> layer_8_expert_out_sp2_ep14_tp2_pp2
	layer_8_expert_sp2_ep14_tp3_pp2 [label="Expert L8 SP2 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep14_pp2 -> layer_8_expert_sp2_ep14_tp3_pp2
	layer_8_expert_out_sp2_ep14_tp3_pp2 [label="Expert Out L8 SP2 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep14_tp3_pp2 -> layer_8_expert_out_sp2_ep14_tp3_pp2
	layer_8_expert_ar_sp2_ep14_pp2 [label="Expert All-Reduce L8 SP2 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep14_tp0_pp2 -> layer_8_expert_ar_sp2_ep14_pp2
	layer_8_expert_out_sp2_ep14_tp1_pp2 -> layer_8_expert_ar_sp2_ep14_pp2
	layer_8_expert_out_sp2_ep14_tp2_pp2 -> layer_8_expert_ar_sp2_ep14_pp2
	layer_8_expert_out_sp2_ep14_tp3_pp2 -> layer_8_expert_ar_sp2_ep14_pp2
	layer_8_combine_sp2_ep14_pp2 [label="Token Combine L8 SP2 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep14_pp2 -> layer_8_combine_sp2_ep14_pp2
	layer_8_dispatch_sp2_ep15_pp2 [label="Token Dispatch L8 SP2 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp2_pp2 -> layer_8_dispatch_sp2_ep15_pp2 [style=dashed]
	layer_8_expert_sp2_ep15_tp0_pp2 [label="Expert L8 SP2 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep15_pp2 -> layer_8_expert_sp2_ep15_tp0_pp2
	layer_8_expert_out_sp2_ep15_tp0_pp2 [label="Expert Out L8 SP2 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep15_tp0_pp2 -> layer_8_expert_out_sp2_ep15_tp0_pp2
	layer_8_expert_sp2_ep15_tp1_pp2 [label="Expert L8 SP2 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep15_pp2 -> layer_8_expert_sp2_ep15_tp1_pp2
	layer_8_expert_out_sp2_ep15_tp1_pp2 [label="Expert Out L8 SP2 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep15_tp1_pp2 -> layer_8_expert_out_sp2_ep15_tp1_pp2
	layer_8_expert_sp2_ep15_tp2_pp2 [label="Expert L8 SP2 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep15_pp2 -> layer_8_expert_sp2_ep15_tp2_pp2
	layer_8_expert_out_sp2_ep15_tp2_pp2 [label="Expert Out L8 SP2 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep15_tp2_pp2 -> layer_8_expert_out_sp2_ep15_tp2_pp2
	layer_8_expert_sp2_ep15_tp3_pp2 [label="Expert L8 SP2 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp2_ep15_pp2 -> layer_8_expert_sp2_ep15_tp3_pp2
	layer_8_expert_out_sp2_ep15_tp3_pp2 [label="Expert Out L8 SP2 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp2_ep15_tp3_pp2 -> layer_8_expert_out_sp2_ep15_tp3_pp2
	layer_8_expert_ar_sp2_ep15_pp2 [label="Expert All-Reduce L8 SP2 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp2_ep15_tp0_pp2 -> layer_8_expert_ar_sp2_ep15_pp2
	layer_8_expert_out_sp2_ep15_tp1_pp2 -> layer_8_expert_ar_sp2_ep15_pp2
	layer_8_expert_out_sp2_ep15_tp2_pp2 -> layer_8_expert_ar_sp2_ep15_pp2
	layer_8_expert_out_sp2_ep15_tp3_pp2 -> layer_8_expert_ar_sp2_ep15_pp2
	layer_8_combine_sp2_ep15_pp2 [label="Token Combine L8 SP2 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp2_ep15_pp2 -> layer_8_combine_sp2_ep15_pp2
	layer_8_moe_all2all_sp2_pp2 [label="MoE All-to-All L8 SP2\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_8_combine_sp2_ep0_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep1_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep2_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep3_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep4_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep5_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep6_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep7_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep8_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep9_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep10_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep11_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep12_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep13_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep14_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_combine_sp2_ep15_pp2 -> layer_8_moe_all2all_sp2_pp2
	layer_8_mlp_out_sp2_pp2 [label="MoE Output L8 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_moe_all2all_sp2_pp2 -> layer_8_mlp_out_sp2_pp2
	layer_8_mlp_res_sp2_pp2 [label="MLP Residual L8 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_mlp_out_sp2_pp2 -> layer_8_mlp_res_sp2_pp2
	layer_8_attn_res_sp2_pp2 -> layer_8_mlp_res_sp2_pp2 [style=dashed]
	layer_8_norm_sp3_pp2 [label="LayerNorm L8 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_7_mlp_out_sp0_pp1 -> layer_8_norm_sp3_pp2 [style=dashed]
	layer_7_mlp_out_sp1_pp1 -> layer_8_norm_sp3_pp2 [style=dashed]
	layer_7_mlp_out_sp2_pp1 -> layer_8_norm_sp3_pp2 [style=dashed]
	layer_7_mlp_out_sp3_pp1 -> layer_8_norm_sp3_pp2 [style=dashed]
	layer_8_qkv_sp3_tp0_pp2 [label="QKV Proj L8 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp3_pp2 -> layer_8_qkv_sp3_tp0_pp2
	layer_8_attn_sp3_tp0_pp2 [label="Attention L8 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp3_tp0_pp2 -> layer_8_attn_sp3_tp0_pp2
	layer_8_attn_out_sp3_tp0_pp2 [label="Attn Out Proj L8 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp3_tp0_pp2 -> layer_8_attn_out_sp3_tp0_pp2
	layer_8_qkv_sp3_tp1_pp2 [label="QKV Proj L8 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp3_pp2 -> layer_8_qkv_sp3_tp1_pp2
	layer_8_attn_sp3_tp1_pp2 [label="Attention L8 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp3_tp1_pp2 -> layer_8_attn_sp3_tp1_pp2
	layer_8_attn_out_sp3_tp1_pp2 [label="Attn Out Proj L8 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp3_tp1_pp2 -> layer_8_attn_out_sp3_tp1_pp2
	layer_8_qkv_sp3_tp2_pp2 [label="QKV Proj L8 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp3_pp2 -> layer_8_qkv_sp3_tp2_pp2
	layer_8_attn_sp3_tp2_pp2 [label="Attention L8 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp3_tp2_pp2 -> layer_8_attn_sp3_tp2_pp2
	layer_8_attn_out_sp3_tp2_pp2 [label="Attn Out Proj L8 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp3_tp2_pp2 -> layer_8_attn_out_sp3_tp2_pp2
	layer_8_qkv_sp3_tp3_pp2 [label="QKV Proj L8 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_norm_sp3_pp2 -> layer_8_qkv_sp3_tp3_pp2
	layer_8_attn_sp3_tp3_pp2 [label="Attention L8 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_qkv_sp3_tp3_pp2 -> layer_8_attn_sp3_tp3_pp2
	layer_8_attn_out_sp3_tp3_pp2 [label="Attn Out Proj L8 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_8_attn_sp3_tp3_pp2 -> layer_8_attn_out_sp3_tp3_pp2
	layer_8_attn_ar_sp3_pp2 [label="Attention All-Reduce L8 SP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_attn_out_sp3_tp0_pp2 -> layer_8_attn_ar_sp3_pp2
	layer_8_attn_out_sp3_tp1_pp2 -> layer_8_attn_ar_sp3_pp2
	layer_8_attn_out_sp3_tp2_pp2 -> layer_8_attn_ar_sp3_pp2
	layer_8_attn_out_sp3_tp3_pp2 -> layer_8_attn_ar_sp3_pp2
	layer_8_attn_res_sp3_pp2 [label="Attention Residual L8 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_attn_ar_sp3_pp2 -> layer_8_attn_res_sp3_pp2
	layer_8_norm_sp3_pp2 -> layer_8_attn_res_sp3_pp2 [style=dashed]
	layer_8_post_norm_sp3_pp2 [label="Post-Attn Norm L8 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_attn_res_sp3_pp2 -> layer_8_post_norm_sp3_pp2
	layer_8_router_sp3_pp2 [label="MoE Router L8 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_8_post_norm_sp3_pp2 -> layer_8_router_sp3_pp2
	layer_8_dispatch_sp3_ep0_pp2 [label="Token Dispatch L8 SP3 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep0_pp2 [style=dashed]
	layer_8_expert_sp3_ep0_tp0_pp2 [label="Expert L8 SP3 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep0_pp2 -> layer_8_expert_sp3_ep0_tp0_pp2
	layer_8_expert_out_sp3_ep0_tp0_pp2 [label="Expert Out L8 SP3 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep0_tp0_pp2 -> layer_8_expert_out_sp3_ep0_tp0_pp2
	layer_8_expert_sp3_ep0_tp1_pp2 [label="Expert L8 SP3 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep0_pp2 -> layer_8_expert_sp3_ep0_tp1_pp2
	layer_8_expert_out_sp3_ep0_tp1_pp2 [label="Expert Out L8 SP3 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep0_tp1_pp2 -> layer_8_expert_out_sp3_ep0_tp1_pp2
	layer_8_expert_sp3_ep0_tp2_pp2 [label="Expert L8 SP3 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep0_pp2 -> layer_8_expert_sp3_ep0_tp2_pp2
	layer_8_expert_out_sp3_ep0_tp2_pp2 [label="Expert Out L8 SP3 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep0_tp2_pp2 -> layer_8_expert_out_sp3_ep0_tp2_pp2
	layer_8_expert_sp3_ep0_tp3_pp2 [label="Expert L8 SP3 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep0_pp2 -> layer_8_expert_sp3_ep0_tp3_pp2
	layer_8_expert_out_sp3_ep0_tp3_pp2 [label="Expert Out L8 SP3 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep0_tp3_pp2 -> layer_8_expert_out_sp3_ep0_tp3_pp2
	layer_8_expert_ar_sp3_ep0_pp2 [label="Expert All-Reduce L8 SP3 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep0_tp0_pp2 -> layer_8_expert_ar_sp3_ep0_pp2
	layer_8_expert_out_sp3_ep0_tp1_pp2 -> layer_8_expert_ar_sp3_ep0_pp2
	layer_8_expert_out_sp3_ep0_tp2_pp2 -> layer_8_expert_ar_sp3_ep0_pp2
	layer_8_expert_out_sp3_ep0_tp3_pp2 -> layer_8_expert_ar_sp3_ep0_pp2
	layer_8_combine_sp3_ep0_pp2 [label="Token Combine L8 SP3 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep0_pp2 -> layer_8_combine_sp3_ep0_pp2
	layer_8_dispatch_sp3_ep1_pp2 [label="Token Dispatch L8 SP3 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep1_pp2 [style=dashed]
	layer_8_expert_sp3_ep1_tp0_pp2 [label="Expert L8 SP3 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep1_pp2 -> layer_8_expert_sp3_ep1_tp0_pp2
	layer_8_expert_out_sp3_ep1_tp0_pp2 [label="Expert Out L8 SP3 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep1_tp0_pp2 -> layer_8_expert_out_sp3_ep1_tp0_pp2
	layer_8_expert_sp3_ep1_tp1_pp2 [label="Expert L8 SP3 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep1_pp2 -> layer_8_expert_sp3_ep1_tp1_pp2
	layer_8_expert_out_sp3_ep1_tp1_pp2 [label="Expert Out L8 SP3 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep1_tp1_pp2 -> layer_8_expert_out_sp3_ep1_tp1_pp2
	layer_8_expert_sp3_ep1_tp2_pp2 [label="Expert L8 SP3 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep1_pp2 -> layer_8_expert_sp3_ep1_tp2_pp2
	layer_8_expert_out_sp3_ep1_tp2_pp2 [label="Expert Out L8 SP3 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep1_tp2_pp2 -> layer_8_expert_out_sp3_ep1_tp2_pp2
	layer_8_expert_sp3_ep1_tp3_pp2 [label="Expert L8 SP3 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep1_pp2 -> layer_8_expert_sp3_ep1_tp3_pp2
	layer_8_expert_out_sp3_ep1_tp3_pp2 [label="Expert Out L8 SP3 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep1_tp3_pp2 -> layer_8_expert_out_sp3_ep1_tp3_pp2
	layer_8_expert_ar_sp3_ep1_pp2 [label="Expert All-Reduce L8 SP3 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep1_tp0_pp2 -> layer_8_expert_ar_sp3_ep1_pp2
	layer_8_expert_out_sp3_ep1_tp1_pp2 -> layer_8_expert_ar_sp3_ep1_pp2
	layer_8_expert_out_sp3_ep1_tp2_pp2 -> layer_8_expert_ar_sp3_ep1_pp2
	layer_8_expert_out_sp3_ep1_tp3_pp2 -> layer_8_expert_ar_sp3_ep1_pp2
	layer_8_combine_sp3_ep1_pp2 [label="Token Combine L8 SP3 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep1_pp2 -> layer_8_combine_sp3_ep1_pp2
	layer_8_dispatch_sp3_ep2_pp2 [label="Token Dispatch L8 SP3 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep2_pp2 [style=dashed]
	layer_8_expert_sp3_ep2_tp0_pp2 [label="Expert L8 SP3 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep2_pp2 -> layer_8_expert_sp3_ep2_tp0_pp2
	layer_8_expert_out_sp3_ep2_tp0_pp2 [label="Expert Out L8 SP3 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep2_tp0_pp2 -> layer_8_expert_out_sp3_ep2_tp0_pp2
	layer_8_expert_sp3_ep2_tp1_pp2 [label="Expert L8 SP3 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep2_pp2 -> layer_8_expert_sp3_ep2_tp1_pp2
	layer_8_expert_out_sp3_ep2_tp1_pp2 [label="Expert Out L8 SP3 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep2_tp1_pp2 -> layer_8_expert_out_sp3_ep2_tp1_pp2
	layer_8_expert_sp3_ep2_tp2_pp2 [label="Expert L8 SP3 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep2_pp2 -> layer_8_expert_sp3_ep2_tp2_pp2
	layer_8_expert_out_sp3_ep2_tp2_pp2 [label="Expert Out L8 SP3 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep2_tp2_pp2 -> layer_8_expert_out_sp3_ep2_tp2_pp2
	layer_8_expert_sp3_ep2_tp3_pp2 [label="Expert L8 SP3 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep2_pp2 -> layer_8_expert_sp3_ep2_tp3_pp2
	layer_8_expert_out_sp3_ep2_tp3_pp2 [label="Expert Out L8 SP3 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep2_tp3_pp2 -> layer_8_expert_out_sp3_ep2_tp3_pp2
	layer_8_expert_ar_sp3_ep2_pp2 [label="Expert All-Reduce L8 SP3 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep2_tp0_pp2 -> layer_8_expert_ar_sp3_ep2_pp2
	layer_8_expert_out_sp3_ep2_tp1_pp2 -> layer_8_expert_ar_sp3_ep2_pp2
	layer_8_expert_out_sp3_ep2_tp2_pp2 -> layer_8_expert_ar_sp3_ep2_pp2
	layer_8_expert_out_sp3_ep2_tp3_pp2 -> layer_8_expert_ar_sp3_ep2_pp2
	layer_8_combine_sp3_ep2_pp2 [label="Token Combine L8 SP3 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep2_pp2 -> layer_8_combine_sp3_ep2_pp2
	layer_8_dispatch_sp3_ep3_pp2 [label="Token Dispatch L8 SP3 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep3_pp2 [style=dashed]
	layer_8_expert_sp3_ep3_tp0_pp2 [label="Expert L8 SP3 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep3_pp2 -> layer_8_expert_sp3_ep3_tp0_pp2
	layer_8_expert_out_sp3_ep3_tp0_pp2 [label="Expert Out L8 SP3 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep3_tp0_pp2 -> layer_8_expert_out_sp3_ep3_tp0_pp2
	layer_8_expert_sp3_ep3_tp1_pp2 [label="Expert L8 SP3 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep3_pp2 -> layer_8_expert_sp3_ep3_tp1_pp2
	layer_8_expert_out_sp3_ep3_tp1_pp2 [label="Expert Out L8 SP3 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep3_tp1_pp2 -> layer_8_expert_out_sp3_ep3_tp1_pp2
	layer_8_expert_sp3_ep3_tp2_pp2 [label="Expert L8 SP3 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep3_pp2 -> layer_8_expert_sp3_ep3_tp2_pp2
	layer_8_expert_out_sp3_ep3_tp2_pp2 [label="Expert Out L8 SP3 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep3_tp2_pp2 -> layer_8_expert_out_sp3_ep3_tp2_pp2
	layer_8_expert_sp3_ep3_tp3_pp2 [label="Expert L8 SP3 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep3_pp2 -> layer_8_expert_sp3_ep3_tp3_pp2
	layer_8_expert_out_sp3_ep3_tp3_pp2 [label="Expert Out L8 SP3 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep3_tp3_pp2 -> layer_8_expert_out_sp3_ep3_tp3_pp2
	layer_8_expert_ar_sp3_ep3_pp2 [label="Expert All-Reduce L8 SP3 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep3_tp0_pp2 -> layer_8_expert_ar_sp3_ep3_pp2
	layer_8_expert_out_sp3_ep3_tp1_pp2 -> layer_8_expert_ar_sp3_ep3_pp2
	layer_8_expert_out_sp3_ep3_tp2_pp2 -> layer_8_expert_ar_sp3_ep3_pp2
	layer_8_expert_out_sp3_ep3_tp3_pp2 -> layer_8_expert_ar_sp3_ep3_pp2
	layer_8_combine_sp3_ep3_pp2 [label="Token Combine L8 SP3 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep3_pp2 -> layer_8_combine_sp3_ep3_pp2
	layer_8_dispatch_sp3_ep4_pp2 [label="Token Dispatch L8 SP3 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep4_pp2 [style=dashed]
	layer_8_expert_sp3_ep4_tp0_pp2 [label="Expert L8 SP3 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep4_pp2 -> layer_8_expert_sp3_ep4_tp0_pp2
	layer_8_expert_out_sp3_ep4_tp0_pp2 [label="Expert Out L8 SP3 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep4_tp0_pp2 -> layer_8_expert_out_sp3_ep4_tp0_pp2
	layer_8_expert_sp3_ep4_tp1_pp2 [label="Expert L8 SP3 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep4_pp2 -> layer_8_expert_sp3_ep4_tp1_pp2
	layer_8_expert_out_sp3_ep4_tp1_pp2 [label="Expert Out L8 SP3 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep4_tp1_pp2 -> layer_8_expert_out_sp3_ep4_tp1_pp2
	layer_8_expert_sp3_ep4_tp2_pp2 [label="Expert L8 SP3 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep4_pp2 -> layer_8_expert_sp3_ep4_tp2_pp2
	layer_8_expert_out_sp3_ep4_tp2_pp2 [label="Expert Out L8 SP3 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep4_tp2_pp2 -> layer_8_expert_out_sp3_ep4_tp2_pp2
	layer_8_expert_sp3_ep4_tp3_pp2 [label="Expert L8 SP3 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep4_pp2 -> layer_8_expert_sp3_ep4_tp3_pp2
	layer_8_expert_out_sp3_ep4_tp3_pp2 [label="Expert Out L8 SP3 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep4_tp3_pp2 -> layer_8_expert_out_sp3_ep4_tp3_pp2
	layer_8_expert_ar_sp3_ep4_pp2 [label="Expert All-Reduce L8 SP3 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep4_tp0_pp2 -> layer_8_expert_ar_sp3_ep4_pp2
	layer_8_expert_out_sp3_ep4_tp1_pp2 -> layer_8_expert_ar_sp3_ep4_pp2
	layer_8_expert_out_sp3_ep4_tp2_pp2 -> layer_8_expert_ar_sp3_ep4_pp2
	layer_8_expert_out_sp3_ep4_tp3_pp2 -> layer_8_expert_ar_sp3_ep4_pp2
	layer_8_combine_sp3_ep4_pp2 [label="Token Combine L8 SP3 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep4_pp2 -> layer_8_combine_sp3_ep4_pp2
	layer_8_dispatch_sp3_ep5_pp2 [label="Token Dispatch L8 SP3 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep5_pp2 [style=dashed]
	layer_8_expert_sp3_ep5_tp0_pp2 [label="Expert L8 SP3 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep5_pp2 -> layer_8_expert_sp3_ep5_tp0_pp2
	layer_8_expert_out_sp3_ep5_tp0_pp2 [label="Expert Out L8 SP3 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep5_tp0_pp2 -> layer_8_expert_out_sp3_ep5_tp0_pp2
	layer_8_expert_sp3_ep5_tp1_pp2 [label="Expert L8 SP3 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep5_pp2 -> layer_8_expert_sp3_ep5_tp1_pp2
	layer_8_expert_out_sp3_ep5_tp1_pp2 [label="Expert Out L8 SP3 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep5_tp1_pp2 -> layer_8_expert_out_sp3_ep5_tp1_pp2
	layer_8_expert_sp3_ep5_tp2_pp2 [label="Expert L8 SP3 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep5_pp2 -> layer_8_expert_sp3_ep5_tp2_pp2
	layer_8_expert_out_sp3_ep5_tp2_pp2 [label="Expert Out L8 SP3 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep5_tp2_pp2 -> layer_8_expert_out_sp3_ep5_tp2_pp2
	layer_8_expert_sp3_ep5_tp3_pp2 [label="Expert L8 SP3 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep5_pp2 -> layer_8_expert_sp3_ep5_tp3_pp2
	layer_8_expert_out_sp3_ep5_tp3_pp2 [label="Expert Out L8 SP3 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep5_tp3_pp2 -> layer_8_expert_out_sp3_ep5_tp3_pp2
	layer_8_expert_ar_sp3_ep5_pp2 [label="Expert All-Reduce L8 SP3 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep5_tp0_pp2 -> layer_8_expert_ar_sp3_ep5_pp2
	layer_8_expert_out_sp3_ep5_tp1_pp2 -> layer_8_expert_ar_sp3_ep5_pp2
	layer_8_expert_out_sp3_ep5_tp2_pp2 -> layer_8_expert_ar_sp3_ep5_pp2
	layer_8_expert_out_sp3_ep5_tp3_pp2 -> layer_8_expert_ar_sp3_ep5_pp2
	layer_8_combine_sp3_ep5_pp2 [label="Token Combine L8 SP3 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep5_pp2 -> layer_8_combine_sp3_ep5_pp2
	layer_8_dispatch_sp3_ep6_pp2 [label="Token Dispatch L8 SP3 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep6_pp2 [style=dashed]
	layer_8_expert_sp3_ep6_tp0_pp2 [label="Expert L8 SP3 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep6_pp2 -> layer_8_expert_sp3_ep6_tp0_pp2
	layer_8_expert_out_sp3_ep6_tp0_pp2 [label="Expert Out L8 SP3 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep6_tp0_pp2 -> layer_8_expert_out_sp3_ep6_tp0_pp2
	layer_8_expert_sp3_ep6_tp1_pp2 [label="Expert L8 SP3 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep6_pp2 -> layer_8_expert_sp3_ep6_tp1_pp2
	layer_8_expert_out_sp3_ep6_tp1_pp2 [label="Expert Out L8 SP3 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep6_tp1_pp2 -> layer_8_expert_out_sp3_ep6_tp1_pp2
	layer_8_expert_sp3_ep6_tp2_pp2 [label="Expert L8 SP3 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep6_pp2 -> layer_8_expert_sp3_ep6_tp2_pp2
	layer_8_expert_out_sp3_ep6_tp2_pp2 [label="Expert Out L8 SP3 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep6_tp2_pp2 -> layer_8_expert_out_sp3_ep6_tp2_pp2
	layer_8_expert_sp3_ep6_tp3_pp2 [label="Expert L8 SP3 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep6_pp2 -> layer_8_expert_sp3_ep6_tp3_pp2
	layer_8_expert_out_sp3_ep6_tp3_pp2 [label="Expert Out L8 SP3 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep6_tp3_pp2 -> layer_8_expert_out_sp3_ep6_tp3_pp2
	layer_8_expert_ar_sp3_ep6_pp2 [label="Expert All-Reduce L8 SP3 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep6_tp0_pp2 -> layer_8_expert_ar_sp3_ep6_pp2
	layer_8_expert_out_sp3_ep6_tp1_pp2 -> layer_8_expert_ar_sp3_ep6_pp2
	layer_8_expert_out_sp3_ep6_tp2_pp2 -> layer_8_expert_ar_sp3_ep6_pp2
	layer_8_expert_out_sp3_ep6_tp3_pp2 -> layer_8_expert_ar_sp3_ep6_pp2
	layer_8_combine_sp3_ep6_pp2 [label="Token Combine L8 SP3 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep6_pp2 -> layer_8_combine_sp3_ep6_pp2
	layer_8_dispatch_sp3_ep7_pp2 [label="Token Dispatch L8 SP3 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep7_pp2 [style=dashed]
	layer_8_expert_sp3_ep7_tp0_pp2 [label="Expert L8 SP3 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep7_pp2 -> layer_8_expert_sp3_ep7_tp0_pp2
	layer_8_expert_out_sp3_ep7_tp0_pp2 [label="Expert Out L8 SP3 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep7_tp0_pp2 -> layer_8_expert_out_sp3_ep7_tp0_pp2
	layer_8_expert_sp3_ep7_tp1_pp2 [label="Expert L8 SP3 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep7_pp2 -> layer_8_expert_sp3_ep7_tp1_pp2
	layer_8_expert_out_sp3_ep7_tp1_pp2 [label="Expert Out L8 SP3 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep7_tp1_pp2 -> layer_8_expert_out_sp3_ep7_tp1_pp2
	layer_8_expert_sp3_ep7_tp2_pp2 [label="Expert L8 SP3 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep7_pp2 -> layer_8_expert_sp3_ep7_tp2_pp2
	layer_8_expert_out_sp3_ep7_tp2_pp2 [label="Expert Out L8 SP3 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep7_tp2_pp2 -> layer_8_expert_out_sp3_ep7_tp2_pp2
	layer_8_expert_sp3_ep7_tp3_pp2 [label="Expert L8 SP3 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep7_pp2 -> layer_8_expert_sp3_ep7_tp3_pp2
	layer_8_expert_out_sp3_ep7_tp3_pp2 [label="Expert Out L8 SP3 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep7_tp3_pp2 -> layer_8_expert_out_sp3_ep7_tp3_pp2
	layer_8_expert_ar_sp3_ep7_pp2 [label="Expert All-Reduce L8 SP3 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep7_tp0_pp2 -> layer_8_expert_ar_sp3_ep7_pp2
	layer_8_expert_out_sp3_ep7_tp1_pp2 -> layer_8_expert_ar_sp3_ep7_pp2
	layer_8_expert_out_sp3_ep7_tp2_pp2 -> layer_8_expert_ar_sp3_ep7_pp2
	layer_8_expert_out_sp3_ep7_tp3_pp2 -> layer_8_expert_ar_sp3_ep7_pp2
	layer_8_combine_sp3_ep7_pp2 [label="Token Combine L8 SP3 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep7_pp2 -> layer_8_combine_sp3_ep7_pp2
	layer_8_dispatch_sp3_ep8_pp2 [label="Token Dispatch L8 SP3 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep8_pp2 [style=dashed]
	layer_8_expert_sp3_ep8_tp0_pp2 [label="Expert L8 SP3 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep8_pp2 -> layer_8_expert_sp3_ep8_tp0_pp2
	layer_8_expert_out_sp3_ep8_tp0_pp2 [label="Expert Out L8 SP3 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep8_tp0_pp2 -> layer_8_expert_out_sp3_ep8_tp0_pp2
	layer_8_expert_sp3_ep8_tp1_pp2 [label="Expert L8 SP3 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep8_pp2 -> layer_8_expert_sp3_ep8_tp1_pp2
	layer_8_expert_out_sp3_ep8_tp1_pp2 [label="Expert Out L8 SP3 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep8_tp1_pp2 -> layer_8_expert_out_sp3_ep8_tp1_pp2
	layer_8_expert_sp3_ep8_tp2_pp2 [label="Expert L8 SP3 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep8_pp2 -> layer_8_expert_sp3_ep8_tp2_pp2
	layer_8_expert_out_sp3_ep8_tp2_pp2 [label="Expert Out L8 SP3 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep8_tp2_pp2 -> layer_8_expert_out_sp3_ep8_tp2_pp2
	layer_8_expert_sp3_ep8_tp3_pp2 [label="Expert L8 SP3 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep8_pp2 -> layer_8_expert_sp3_ep8_tp3_pp2
	layer_8_expert_out_sp3_ep8_tp3_pp2 [label="Expert Out L8 SP3 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep8_tp3_pp2 -> layer_8_expert_out_sp3_ep8_tp3_pp2
	layer_8_expert_ar_sp3_ep8_pp2 [label="Expert All-Reduce L8 SP3 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep8_tp0_pp2 -> layer_8_expert_ar_sp3_ep8_pp2
	layer_8_expert_out_sp3_ep8_tp1_pp2 -> layer_8_expert_ar_sp3_ep8_pp2
	layer_8_expert_out_sp3_ep8_tp2_pp2 -> layer_8_expert_ar_sp3_ep8_pp2
	layer_8_expert_out_sp3_ep8_tp3_pp2 -> layer_8_expert_ar_sp3_ep8_pp2
	layer_8_combine_sp3_ep8_pp2 [label="Token Combine L8 SP3 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep8_pp2 -> layer_8_combine_sp3_ep8_pp2
	layer_8_dispatch_sp3_ep9_pp2 [label="Token Dispatch L8 SP3 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep9_pp2 [style=dashed]
	layer_8_expert_sp3_ep9_tp0_pp2 [label="Expert L8 SP3 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep9_pp2 -> layer_8_expert_sp3_ep9_tp0_pp2
	layer_8_expert_out_sp3_ep9_tp0_pp2 [label="Expert Out L8 SP3 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep9_tp0_pp2 -> layer_8_expert_out_sp3_ep9_tp0_pp2
	layer_8_expert_sp3_ep9_tp1_pp2 [label="Expert L8 SP3 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep9_pp2 -> layer_8_expert_sp3_ep9_tp1_pp2
	layer_8_expert_out_sp3_ep9_tp1_pp2 [label="Expert Out L8 SP3 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep9_tp1_pp2 -> layer_8_expert_out_sp3_ep9_tp1_pp2
	layer_8_expert_sp3_ep9_tp2_pp2 [label="Expert L8 SP3 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep9_pp2 -> layer_8_expert_sp3_ep9_tp2_pp2
	layer_8_expert_out_sp3_ep9_tp2_pp2 [label="Expert Out L8 SP3 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep9_tp2_pp2 -> layer_8_expert_out_sp3_ep9_tp2_pp2
	layer_8_expert_sp3_ep9_tp3_pp2 [label="Expert L8 SP3 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep9_pp2 -> layer_8_expert_sp3_ep9_tp3_pp2
	layer_8_expert_out_sp3_ep9_tp3_pp2 [label="Expert Out L8 SP3 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep9_tp3_pp2 -> layer_8_expert_out_sp3_ep9_tp3_pp2
	layer_8_expert_ar_sp3_ep9_pp2 [label="Expert All-Reduce L8 SP3 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep9_tp0_pp2 -> layer_8_expert_ar_sp3_ep9_pp2
	layer_8_expert_out_sp3_ep9_tp1_pp2 -> layer_8_expert_ar_sp3_ep9_pp2
	layer_8_expert_out_sp3_ep9_tp2_pp2 -> layer_8_expert_ar_sp3_ep9_pp2
	layer_8_expert_out_sp3_ep9_tp3_pp2 -> layer_8_expert_ar_sp3_ep9_pp2
	layer_8_combine_sp3_ep9_pp2 [label="Token Combine L8 SP3 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep9_pp2 -> layer_8_combine_sp3_ep9_pp2
	layer_8_dispatch_sp3_ep10_pp2 [label="Token Dispatch L8 SP3 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep10_pp2 [style=dashed]
	layer_8_expert_sp3_ep10_tp0_pp2 [label="Expert L8 SP3 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep10_pp2 -> layer_8_expert_sp3_ep10_tp0_pp2
	layer_8_expert_out_sp3_ep10_tp0_pp2 [label="Expert Out L8 SP3 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep10_tp0_pp2 -> layer_8_expert_out_sp3_ep10_tp0_pp2
	layer_8_expert_sp3_ep10_tp1_pp2 [label="Expert L8 SP3 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep10_pp2 -> layer_8_expert_sp3_ep10_tp1_pp2
	layer_8_expert_out_sp3_ep10_tp1_pp2 [label="Expert Out L8 SP3 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep10_tp1_pp2 -> layer_8_expert_out_sp3_ep10_tp1_pp2
	layer_8_expert_sp3_ep10_tp2_pp2 [label="Expert L8 SP3 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep10_pp2 -> layer_8_expert_sp3_ep10_tp2_pp2
	layer_8_expert_out_sp3_ep10_tp2_pp2 [label="Expert Out L8 SP3 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep10_tp2_pp2 -> layer_8_expert_out_sp3_ep10_tp2_pp2
	layer_8_expert_sp3_ep10_tp3_pp2 [label="Expert L8 SP3 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep10_pp2 -> layer_8_expert_sp3_ep10_tp3_pp2
	layer_8_expert_out_sp3_ep10_tp3_pp2 [label="Expert Out L8 SP3 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep10_tp3_pp2 -> layer_8_expert_out_sp3_ep10_tp3_pp2
	layer_8_expert_ar_sp3_ep10_pp2 [label="Expert All-Reduce L8 SP3 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep10_tp0_pp2 -> layer_8_expert_ar_sp3_ep10_pp2
	layer_8_expert_out_sp3_ep10_tp1_pp2 -> layer_8_expert_ar_sp3_ep10_pp2
	layer_8_expert_out_sp3_ep10_tp2_pp2 -> layer_8_expert_ar_sp3_ep10_pp2
	layer_8_expert_out_sp3_ep10_tp3_pp2 -> layer_8_expert_ar_sp3_ep10_pp2
	layer_8_combine_sp3_ep10_pp2 [label="Token Combine L8 SP3 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep10_pp2 -> layer_8_combine_sp3_ep10_pp2
	layer_8_dispatch_sp3_ep11_pp2 [label="Token Dispatch L8 SP3 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep11_pp2 [style=dashed]
	layer_8_expert_sp3_ep11_tp0_pp2 [label="Expert L8 SP3 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep11_pp2 -> layer_8_expert_sp3_ep11_tp0_pp2
	layer_8_expert_out_sp3_ep11_tp0_pp2 [label="Expert Out L8 SP3 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep11_tp0_pp2 -> layer_8_expert_out_sp3_ep11_tp0_pp2
	layer_8_expert_sp3_ep11_tp1_pp2 [label="Expert L8 SP3 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep11_pp2 -> layer_8_expert_sp3_ep11_tp1_pp2
	layer_8_expert_out_sp3_ep11_tp1_pp2 [label="Expert Out L8 SP3 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep11_tp1_pp2 -> layer_8_expert_out_sp3_ep11_tp1_pp2
	layer_8_expert_sp3_ep11_tp2_pp2 [label="Expert L8 SP3 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep11_pp2 -> layer_8_expert_sp3_ep11_tp2_pp2
	layer_8_expert_out_sp3_ep11_tp2_pp2 [label="Expert Out L8 SP3 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep11_tp2_pp2 -> layer_8_expert_out_sp3_ep11_tp2_pp2
	layer_8_expert_sp3_ep11_tp3_pp2 [label="Expert L8 SP3 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep11_pp2 -> layer_8_expert_sp3_ep11_tp3_pp2
	layer_8_expert_out_sp3_ep11_tp3_pp2 [label="Expert Out L8 SP3 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep11_tp3_pp2 -> layer_8_expert_out_sp3_ep11_tp3_pp2
	layer_8_expert_ar_sp3_ep11_pp2 [label="Expert All-Reduce L8 SP3 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep11_tp0_pp2 -> layer_8_expert_ar_sp3_ep11_pp2
	layer_8_expert_out_sp3_ep11_tp1_pp2 -> layer_8_expert_ar_sp3_ep11_pp2
	layer_8_expert_out_sp3_ep11_tp2_pp2 -> layer_8_expert_ar_sp3_ep11_pp2
	layer_8_expert_out_sp3_ep11_tp3_pp2 -> layer_8_expert_ar_sp3_ep11_pp2
	layer_8_combine_sp3_ep11_pp2 [label="Token Combine L8 SP3 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep11_pp2 -> layer_8_combine_sp3_ep11_pp2
	layer_8_dispatch_sp3_ep12_pp2 [label="Token Dispatch L8 SP3 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep12_pp2 [style=dashed]
	layer_8_expert_sp3_ep12_tp0_pp2 [label="Expert L8 SP3 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep12_pp2 -> layer_8_expert_sp3_ep12_tp0_pp2
	layer_8_expert_out_sp3_ep12_tp0_pp2 [label="Expert Out L8 SP3 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep12_tp0_pp2 -> layer_8_expert_out_sp3_ep12_tp0_pp2
	layer_8_expert_sp3_ep12_tp1_pp2 [label="Expert L8 SP3 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep12_pp2 -> layer_8_expert_sp3_ep12_tp1_pp2
	layer_8_expert_out_sp3_ep12_tp1_pp2 [label="Expert Out L8 SP3 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep12_tp1_pp2 -> layer_8_expert_out_sp3_ep12_tp1_pp2
	layer_8_expert_sp3_ep12_tp2_pp2 [label="Expert L8 SP3 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep12_pp2 -> layer_8_expert_sp3_ep12_tp2_pp2
	layer_8_expert_out_sp3_ep12_tp2_pp2 [label="Expert Out L8 SP3 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep12_tp2_pp2 -> layer_8_expert_out_sp3_ep12_tp2_pp2
	layer_8_expert_sp3_ep12_tp3_pp2 [label="Expert L8 SP3 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep12_pp2 -> layer_8_expert_sp3_ep12_tp3_pp2
	layer_8_expert_out_sp3_ep12_tp3_pp2 [label="Expert Out L8 SP3 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep12_tp3_pp2 -> layer_8_expert_out_sp3_ep12_tp3_pp2
	layer_8_expert_ar_sp3_ep12_pp2 [label="Expert All-Reduce L8 SP3 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep12_tp0_pp2 -> layer_8_expert_ar_sp3_ep12_pp2
	layer_8_expert_out_sp3_ep12_tp1_pp2 -> layer_8_expert_ar_sp3_ep12_pp2
	layer_8_expert_out_sp3_ep12_tp2_pp2 -> layer_8_expert_ar_sp3_ep12_pp2
	layer_8_expert_out_sp3_ep12_tp3_pp2 -> layer_8_expert_ar_sp3_ep12_pp2
	layer_8_combine_sp3_ep12_pp2 [label="Token Combine L8 SP3 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep12_pp2 -> layer_8_combine_sp3_ep12_pp2
	layer_8_dispatch_sp3_ep13_pp2 [label="Token Dispatch L8 SP3 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep13_pp2 [style=dashed]
	layer_8_expert_sp3_ep13_tp0_pp2 [label="Expert L8 SP3 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep13_pp2 -> layer_8_expert_sp3_ep13_tp0_pp2
	layer_8_expert_out_sp3_ep13_tp0_pp2 [label="Expert Out L8 SP3 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep13_tp0_pp2 -> layer_8_expert_out_sp3_ep13_tp0_pp2
	layer_8_expert_sp3_ep13_tp1_pp2 [label="Expert L8 SP3 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep13_pp2 -> layer_8_expert_sp3_ep13_tp1_pp2
	layer_8_expert_out_sp3_ep13_tp1_pp2 [label="Expert Out L8 SP3 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep13_tp1_pp2 -> layer_8_expert_out_sp3_ep13_tp1_pp2
	layer_8_expert_sp3_ep13_tp2_pp2 [label="Expert L8 SP3 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep13_pp2 -> layer_8_expert_sp3_ep13_tp2_pp2
	layer_8_expert_out_sp3_ep13_tp2_pp2 [label="Expert Out L8 SP3 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep13_tp2_pp2 -> layer_8_expert_out_sp3_ep13_tp2_pp2
	layer_8_expert_sp3_ep13_tp3_pp2 [label="Expert L8 SP3 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep13_pp2 -> layer_8_expert_sp3_ep13_tp3_pp2
	layer_8_expert_out_sp3_ep13_tp3_pp2 [label="Expert Out L8 SP3 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep13_tp3_pp2 -> layer_8_expert_out_sp3_ep13_tp3_pp2
	layer_8_expert_ar_sp3_ep13_pp2 [label="Expert All-Reduce L8 SP3 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep13_tp0_pp2 -> layer_8_expert_ar_sp3_ep13_pp2
	layer_8_expert_out_sp3_ep13_tp1_pp2 -> layer_8_expert_ar_sp3_ep13_pp2
	layer_8_expert_out_sp3_ep13_tp2_pp2 -> layer_8_expert_ar_sp3_ep13_pp2
	layer_8_expert_out_sp3_ep13_tp3_pp2 -> layer_8_expert_ar_sp3_ep13_pp2
	layer_8_combine_sp3_ep13_pp2 [label="Token Combine L8 SP3 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep13_pp2 -> layer_8_combine_sp3_ep13_pp2
	layer_8_dispatch_sp3_ep14_pp2 [label="Token Dispatch L8 SP3 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep14_pp2 [style=dashed]
	layer_8_expert_sp3_ep14_tp0_pp2 [label="Expert L8 SP3 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep14_pp2 -> layer_8_expert_sp3_ep14_tp0_pp2
	layer_8_expert_out_sp3_ep14_tp0_pp2 [label="Expert Out L8 SP3 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep14_tp0_pp2 -> layer_8_expert_out_sp3_ep14_tp0_pp2
	layer_8_expert_sp3_ep14_tp1_pp2 [label="Expert L8 SP3 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep14_pp2 -> layer_8_expert_sp3_ep14_tp1_pp2
	layer_8_expert_out_sp3_ep14_tp1_pp2 [label="Expert Out L8 SP3 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep14_tp1_pp2 -> layer_8_expert_out_sp3_ep14_tp1_pp2
	layer_8_expert_sp3_ep14_tp2_pp2 [label="Expert L8 SP3 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep14_pp2 -> layer_8_expert_sp3_ep14_tp2_pp2
	layer_8_expert_out_sp3_ep14_tp2_pp2 [label="Expert Out L8 SP3 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep14_tp2_pp2 -> layer_8_expert_out_sp3_ep14_tp2_pp2
	layer_8_expert_sp3_ep14_tp3_pp2 [label="Expert L8 SP3 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep14_pp2 -> layer_8_expert_sp3_ep14_tp3_pp2
	layer_8_expert_out_sp3_ep14_tp3_pp2 [label="Expert Out L8 SP3 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep14_tp3_pp2 -> layer_8_expert_out_sp3_ep14_tp3_pp2
	layer_8_expert_ar_sp3_ep14_pp2 [label="Expert All-Reduce L8 SP3 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep14_tp0_pp2 -> layer_8_expert_ar_sp3_ep14_pp2
	layer_8_expert_out_sp3_ep14_tp1_pp2 -> layer_8_expert_ar_sp3_ep14_pp2
	layer_8_expert_out_sp3_ep14_tp2_pp2 -> layer_8_expert_ar_sp3_ep14_pp2
	layer_8_expert_out_sp3_ep14_tp3_pp2 -> layer_8_expert_ar_sp3_ep14_pp2
	layer_8_combine_sp3_ep14_pp2 [label="Token Combine L8 SP3 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep14_pp2 -> layer_8_combine_sp3_ep14_pp2
	layer_8_dispatch_sp3_ep15_pp2 [label="Token Dispatch L8 SP3 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_8_router_sp3_pp2 -> layer_8_dispatch_sp3_ep15_pp2 [style=dashed]
	layer_8_expert_sp3_ep15_tp0_pp2 [label="Expert L8 SP3 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep15_pp2 -> layer_8_expert_sp3_ep15_tp0_pp2
	layer_8_expert_out_sp3_ep15_tp0_pp2 [label="Expert Out L8 SP3 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep15_tp0_pp2 -> layer_8_expert_out_sp3_ep15_tp0_pp2
	layer_8_expert_sp3_ep15_tp1_pp2 [label="Expert L8 SP3 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep15_pp2 -> layer_8_expert_sp3_ep15_tp1_pp2
	layer_8_expert_out_sp3_ep15_tp1_pp2 [label="Expert Out L8 SP3 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep15_tp1_pp2 -> layer_8_expert_out_sp3_ep15_tp1_pp2
	layer_8_expert_sp3_ep15_tp2_pp2 [label="Expert L8 SP3 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep15_pp2 -> layer_8_expert_sp3_ep15_tp2_pp2
	layer_8_expert_out_sp3_ep15_tp2_pp2 [label="Expert Out L8 SP3 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep15_tp2_pp2 -> layer_8_expert_out_sp3_ep15_tp2_pp2
	layer_8_expert_sp3_ep15_tp3_pp2 [label="Expert L8 SP3 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_dispatch_sp3_ep15_pp2 -> layer_8_expert_sp3_ep15_tp3_pp2
	layer_8_expert_out_sp3_ep15_tp3_pp2 [label="Expert Out L8 SP3 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_8_expert_sp3_ep15_tp3_pp2 -> layer_8_expert_out_sp3_ep15_tp3_pp2
	layer_8_expert_ar_sp3_ep15_pp2 [label="Expert All-Reduce L8 SP3 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_8_expert_out_sp3_ep15_tp0_pp2 -> layer_8_expert_ar_sp3_ep15_pp2
	layer_8_expert_out_sp3_ep15_tp1_pp2 -> layer_8_expert_ar_sp3_ep15_pp2
	layer_8_expert_out_sp3_ep15_tp2_pp2 -> layer_8_expert_ar_sp3_ep15_pp2
	layer_8_expert_out_sp3_ep15_tp3_pp2 -> layer_8_expert_ar_sp3_ep15_pp2
	layer_8_combine_sp3_ep15_pp2 [label="Token Combine L8 SP3 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_8_expert_ar_sp3_ep15_pp2 -> layer_8_combine_sp3_ep15_pp2
	layer_8_moe_all2all_sp3_pp2 [label="MoE All-to-All L8 SP3\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_8_combine_sp3_ep0_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep1_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep2_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep3_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep4_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep5_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep6_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep7_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep8_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep9_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep10_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep11_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep12_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep13_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep14_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_combine_sp3_ep15_pp2 -> layer_8_moe_all2all_sp3_pp2
	layer_8_mlp_out_sp3_pp2 [label="MoE Output L8 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_moe_all2all_sp3_pp2 -> layer_8_mlp_out_sp3_pp2
	layer_8_mlp_res_sp3_pp2 [label="MLP Residual L8 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_mlp_out_sp3_pp2 -> layer_8_mlp_res_sp3_pp2
	layer_8_attn_res_sp3_pp2 -> layer_8_mlp_res_sp3_pp2 [style=dashed]
	layer_9_norm_sp0_pp2 [label="LayerNorm L9 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_mlp_out_sp0_pp2 -> layer_9_norm_sp0_pp2
	layer_9_qkv_sp0_tp0_pp2 [label="QKV Proj L9 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp0_pp2 -> layer_9_qkv_sp0_tp0_pp2
	layer_9_attn_sp0_tp0_pp2 [label="Attention L9 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp0_tp0_pp2 -> layer_9_attn_sp0_tp0_pp2
	layer_9_attn_out_sp0_tp0_pp2 [label="Attn Out Proj L9 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp0_tp0_pp2 -> layer_9_attn_out_sp0_tp0_pp2
	layer_9_qkv_sp0_tp1_pp2 [label="QKV Proj L9 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp0_pp2 -> layer_9_qkv_sp0_tp1_pp2
	layer_9_attn_sp0_tp1_pp2 [label="Attention L9 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp0_tp1_pp2 -> layer_9_attn_sp0_tp1_pp2
	layer_9_attn_out_sp0_tp1_pp2 [label="Attn Out Proj L9 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp0_tp1_pp2 -> layer_9_attn_out_sp0_tp1_pp2
	layer_9_qkv_sp0_tp2_pp2 [label="QKV Proj L9 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp0_pp2 -> layer_9_qkv_sp0_tp2_pp2
	layer_9_attn_sp0_tp2_pp2 [label="Attention L9 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp0_tp2_pp2 -> layer_9_attn_sp0_tp2_pp2
	layer_9_attn_out_sp0_tp2_pp2 [label="Attn Out Proj L9 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp0_tp2_pp2 -> layer_9_attn_out_sp0_tp2_pp2
	layer_9_qkv_sp0_tp3_pp2 [label="QKV Proj L9 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp0_pp2 -> layer_9_qkv_sp0_tp3_pp2
	layer_9_attn_sp0_tp3_pp2 [label="Attention L9 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp0_tp3_pp2 -> layer_9_attn_sp0_tp3_pp2
	layer_9_attn_out_sp0_tp3_pp2 [label="Attn Out Proj L9 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp0_tp3_pp2 -> layer_9_attn_out_sp0_tp3_pp2
	layer_9_attn_ar_sp0_pp2 [label="Attention All-Reduce L9 SP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_attn_out_sp0_tp0_pp2 -> layer_9_attn_ar_sp0_pp2
	layer_9_attn_out_sp0_tp1_pp2 -> layer_9_attn_ar_sp0_pp2
	layer_9_attn_out_sp0_tp2_pp2 -> layer_9_attn_ar_sp0_pp2
	layer_9_attn_out_sp0_tp3_pp2 -> layer_9_attn_ar_sp0_pp2
	layer_9_attn_res_sp0_pp2 [label="Attention Residual L9 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_attn_ar_sp0_pp2 -> layer_9_attn_res_sp0_pp2
	layer_9_norm_sp0_pp2 -> layer_9_attn_res_sp0_pp2 [style=dashed]
	layer_9_post_norm_sp0_pp2 [label="Post-Attn Norm L9 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_attn_res_sp0_pp2 -> layer_9_post_norm_sp0_pp2
	layer_9_router_sp0_pp2 [label="MoE Router L9 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_9_post_norm_sp0_pp2 -> layer_9_router_sp0_pp2
	layer_9_dispatch_sp0_ep0_pp2 [label="Token Dispatch L9 SP0 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep0_pp2 [style=dashed]
	layer_9_expert_sp0_ep0_tp0_pp2 [label="Expert L9 SP0 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep0_pp2 -> layer_9_expert_sp0_ep0_tp0_pp2
	layer_9_expert_out_sp0_ep0_tp0_pp2 [label="Expert Out L9 SP0 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep0_tp0_pp2 -> layer_9_expert_out_sp0_ep0_tp0_pp2
	layer_9_expert_sp0_ep0_tp1_pp2 [label="Expert L9 SP0 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep0_pp2 -> layer_9_expert_sp0_ep0_tp1_pp2
	layer_9_expert_out_sp0_ep0_tp1_pp2 [label="Expert Out L9 SP0 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep0_tp1_pp2 -> layer_9_expert_out_sp0_ep0_tp1_pp2
	layer_9_expert_sp0_ep0_tp2_pp2 [label="Expert L9 SP0 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep0_pp2 -> layer_9_expert_sp0_ep0_tp2_pp2
	layer_9_expert_out_sp0_ep0_tp2_pp2 [label="Expert Out L9 SP0 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep0_tp2_pp2 -> layer_9_expert_out_sp0_ep0_tp2_pp2
	layer_9_expert_sp0_ep0_tp3_pp2 [label="Expert L9 SP0 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep0_pp2 -> layer_9_expert_sp0_ep0_tp3_pp2
	layer_9_expert_out_sp0_ep0_tp3_pp2 [label="Expert Out L9 SP0 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep0_tp3_pp2 -> layer_9_expert_out_sp0_ep0_tp3_pp2
	layer_9_expert_ar_sp0_ep0_pp2 [label="Expert All-Reduce L9 SP0 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep0_tp0_pp2 -> layer_9_expert_ar_sp0_ep0_pp2
	layer_9_expert_out_sp0_ep0_tp1_pp2 -> layer_9_expert_ar_sp0_ep0_pp2
	layer_9_expert_out_sp0_ep0_tp2_pp2 -> layer_9_expert_ar_sp0_ep0_pp2
	layer_9_expert_out_sp0_ep0_tp3_pp2 -> layer_9_expert_ar_sp0_ep0_pp2
	layer_9_combine_sp0_ep0_pp2 [label="Token Combine L9 SP0 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep0_pp2 -> layer_9_combine_sp0_ep0_pp2
	layer_9_dispatch_sp0_ep1_pp2 [label="Token Dispatch L9 SP0 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep1_pp2 [style=dashed]
	layer_9_expert_sp0_ep1_tp0_pp2 [label="Expert L9 SP0 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep1_pp2 -> layer_9_expert_sp0_ep1_tp0_pp2
	layer_9_expert_out_sp0_ep1_tp0_pp2 [label="Expert Out L9 SP0 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep1_tp0_pp2 -> layer_9_expert_out_sp0_ep1_tp0_pp2
	layer_9_expert_sp0_ep1_tp1_pp2 [label="Expert L9 SP0 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep1_pp2 -> layer_9_expert_sp0_ep1_tp1_pp2
	layer_9_expert_out_sp0_ep1_tp1_pp2 [label="Expert Out L9 SP0 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep1_tp1_pp2 -> layer_9_expert_out_sp0_ep1_tp1_pp2
	layer_9_expert_sp0_ep1_tp2_pp2 [label="Expert L9 SP0 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep1_pp2 -> layer_9_expert_sp0_ep1_tp2_pp2
	layer_9_expert_out_sp0_ep1_tp2_pp2 [label="Expert Out L9 SP0 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep1_tp2_pp2 -> layer_9_expert_out_sp0_ep1_tp2_pp2
	layer_9_expert_sp0_ep1_tp3_pp2 [label="Expert L9 SP0 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep1_pp2 -> layer_9_expert_sp0_ep1_tp3_pp2
	layer_9_expert_out_sp0_ep1_tp3_pp2 [label="Expert Out L9 SP0 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep1_tp3_pp2 -> layer_9_expert_out_sp0_ep1_tp3_pp2
	layer_9_expert_ar_sp0_ep1_pp2 [label="Expert All-Reduce L9 SP0 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep1_tp0_pp2 -> layer_9_expert_ar_sp0_ep1_pp2
	layer_9_expert_out_sp0_ep1_tp1_pp2 -> layer_9_expert_ar_sp0_ep1_pp2
	layer_9_expert_out_sp0_ep1_tp2_pp2 -> layer_9_expert_ar_sp0_ep1_pp2
	layer_9_expert_out_sp0_ep1_tp3_pp2 -> layer_9_expert_ar_sp0_ep1_pp2
	layer_9_combine_sp0_ep1_pp2 [label="Token Combine L9 SP0 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep1_pp2 -> layer_9_combine_sp0_ep1_pp2
	layer_9_dispatch_sp0_ep2_pp2 [label="Token Dispatch L9 SP0 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep2_pp2 [style=dashed]
	layer_9_expert_sp0_ep2_tp0_pp2 [label="Expert L9 SP0 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep2_pp2 -> layer_9_expert_sp0_ep2_tp0_pp2
	layer_9_expert_out_sp0_ep2_tp0_pp2 [label="Expert Out L9 SP0 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep2_tp0_pp2 -> layer_9_expert_out_sp0_ep2_tp0_pp2
	layer_9_expert_sp0_ep2_tp1_pp2 [label="Expert L9 SP0 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep2_pp2 -> layer_9_expert_sp0_ep2_tp1_pp2
	layer_9_expert_out_sp0_ep2_tp1_pp2 [label="Expert Out L9 SP0 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep2_tp1_pp2 -> layer_9_expert_out_sp0_ep2_tp1_pp2
	layer_9_expert_sp0_ep2_tp2_pp2 [label="Expert L9 SP0 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep2_pp2 -> layer_9_expert_sp0_ep2_tp2_pp2
	layer_9_expert_out_sp0_ep2_tp2_pp2 [label="Expert Out L9 SP0 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep2_tp2_pp2 -> layer_9_expert_out_sp0_ep2_tp2_pp2
	layer_9_expert_sp0_ep2_tp3_pp2 [label="Expert L9 SP0 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep2_pp2 -> layer_9_expert_sp0_ep2_tp3_pp2
	layer_9_expert_out_sp0_ep2_tp3_pp2 [label="Expert Out L9 SP0 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep2_tp3_pp2 -> layer_9_expert_out_sp0_ep2_tp3_pp2
	layer_9_expert_ar_sp0_ep2_pp2 [label="Expert All-Reduce L9 SP0 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep2_tp0_pp2 -> layer_9_expert_ar_sp0_ep2_pp2
	layer_9_expert_out_sp0_ep2_tp1_pp2 -> layer_9_expert_ar_sp0_ep2_pp2
	layer_9_expert_out_sp0_ep2_tp2_pp2 -> layer_9_expert_ar_sp0_ep2_pp2
	layer_9_expert_out_sp0_ep2_tp3_pp2 -> layer_9_expert_ar_sp0_ep2_pp2
	layer_9_combine_sp0_ep2_pp2 [label="Token Combine L9 SP0 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep2_pp2 -> layer_9_combine_sp0_ep2_pp2
	layer_9_dispatch_sp0_ep3_pp2 [label="Token Dispatch L9 SP0 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep3_pp2 [style=dashed]
	layer_9_expert_sp0_ep3_tp0_pp2 [label="Expert L9 SP0 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep3_pp2 -> layer_9_expert_sp0_ep3_tp0_pp2
	layer_9_expert_out_sp0_ep3_tp0_pp2 [label="Expert Out L9 SP0 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep3_tp0_pp2 -> layer_9_expert_out_sp0_ep3_tp0_pp2
	layer_9_expert_sp0_ep3_tp1_pp2 [label="Expert L9 SP0 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep3_pp2 -> layer_9_expert_sp0_ep3_tp1_pp2
	layer_9_expert_out_sp0_ep3_tp1_pp2 [label="Expert Out L9 SP0 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep3_tp1_pp2 -> layer_9_expert_out_sp0_ep3_tp1_pp2
	layer_9_expert_sp0_ep3_tp2_pp2 [label="Expert L9 SP0 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep3_pp2 -> layer_9_expert_sp0_ep3_tp2_pp2
	layer_9_expert_out_sp0_ep3_tp2_pp2 [label="Expert Out L9 SP0 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep3_tp2_pp2 -> layer_9_expert_out_sp0_ep3_tp2_pp2
	layer_9_expert_sp0_ep3_tp3_pp2 [label="Expert L9 SP0 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep3_pp2 -> layer_9_expert_sp0_ep3_tp3_pp2
	layer_9_expert_out_sp0_ep3_tp3_pp2 [label="Expert Out L9 SP0 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep3_tp3_pp2 -> layer_9_expert_out_sp0_ep3_tp3_pp2
	layer_9_expert_ar_sp0_ep3_pp2 [label="Expert All-Reduce L9 SP0 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep3_tp0_pp2 -> layer_9_expert_ar_sp0_ep3_pp2
	layer_9_expert_out_sp0_ep3_tp1_pp2 -> layer_9_expert_ar_sp0_ep3_pp2
	layer_9_expert_out_sp0_ep3_tp2_pp2 -> layer_9_expert_ar_sp0_ep3_pp2
	layer_9_expert_out_sp0_ep3_tp3_pp2 -> layer_9_expert_ar_sp0_ep3_pp2
	layer_9_combine_sp0_ep3_pp2 [label="Token Combine L9 SP0 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep3_pp2 -> layer_9_combine_sp0_ep3_pp2
	layer_9_dispatch_sp0_ep4_pp2 [label="Token Dispatch L9 SP0 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep4_pp2 [style=dashed]
	layer_9_expert_sp0_ep4_tp0_pp2 [label="Expert L9 SP0 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep4_pp2 -> layer_9_expert_sp0_ep4_tp0_pp2
	layer_9_expert_out_sp0_ep4_tp0_pp2 [label="Expert Out L9 SP0 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep4_tp0_pp2 -> layer_9_expert_out_sp0_ep4_tp0_pp2
	layer_9_expert_sp0_ep4_tp1_pp2 [label="Expert L9 SP0 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep4_pp2 -> layer_9_expert_sp0_ep4_tp1_pp2
	layer_9_expert_out_sp0_ep4_tp1_pp2 [label="Expert Out L9 SP0 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep4_tp1_pp2 -> layer_9_expert_out_sp0_ep4_tp1_pp2
	layer_9_expert_sp0_ep4_tp2_pp2 [label="Expert L9 SP0 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep4_pp2 -> layer_9_expert_sp0_ep4_tp2_pp2
	layer_9_expert_out_sp0_ep4_tp2_pp2 [label="Expert Out L9 SP0 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep4_tp2_pp2 -> layer_9_expert_out_sp0_ep4_tp2_pp2
	layer_9_expert_sp0_ep4_tp3_pp2 [label="Expert L9 SP0 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep4_pp2 -> layer_9_expert_sp0_ep4_tp3_pp2
	layer_9_expert_out_sp0_ep4_tp3_pp2 [label="Expert Out L9 SP0 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep4_tp3_pp2 -> layer_9_expert_out_sp0_ep4_tp3_pp2
	layer_9_expert_ar_sp0_ep4_pp2 [label="Expert All-Reduce L9 SP0 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep4_tp0_pp2 -> layer_9_expert_ar_sp0_ep4_pp2
	layer_9_expert_out_sp0_ep4_tp1_pp2 -> layer_9_expert_ar_sp0_ep4_pp2
	layer_9_expert_out_sp0_ep4_tp2_pp2 -> layer_9_expert_ar_sp0_ep4_pp2
	layer_9_expert_out_sp0_ep4_tp3_pp2 -> layer_9_expert_ar_sp0_ep4_pp2
	layer_9_combine_sp0_ep4_pp2 [label="Token Combine L9 SP0 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep4_pp2 -> layer_9_combine_sp0_ep4_pp2
	layer_9_dispatch_sp0_ep5_pp2 [label="Token Dispatch L9 SP0 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep5_pp2 [style=dashed]
	layer_9_expert_sp0_ep5_tp0_pp2 [label="Expert L9 SP0 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep5_pp2 -> layer_9_expert_sp0_ep5_tp0_pp2
	layer_9_expert_out_sp0_ep5_tp0_pp2 [label="Expert Out L9 SP0 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep5_tp0_pp2 -> layer_9_expert_out_sp0_ep5_tp0_pp2
	layer_9_expert_sp0_ep5_tp1_pp2 [label="Expert L9 SP0 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep5_pp2 -> layer_9_expert_sp0_ep5_tp1_pp2
	layer_9_expert_out_sp0_ep5_tp1_pp2 [label="Expert Out L9 SP0 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep5_tp1_pp2 -> layer_9_expert_out_sp0_ep5_tp1_pp2
	layer_9_expert_sp0_ep5_tp2_pp2 [label="Expert L9 SP0 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep5_pp2 -> layer_9_expert_sp0_ep5_tp2_pp2
	layer_9_expert_out_sp0_ep5_tp2_pp2 [label="Expert Out L9 SP0 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep5_tp2_pp2 -> layer_9_expert_out_sp0_ep5_tp2_pp2
	layer_9_expert_sp0_ep5_tp3_pp2 [label="Expert L9 SP0 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep5_pp2 -> layer_9_expert_sp0_ep5_tp3_pp2
	layer_9_expert_out_sp0_ep5_tp3_pp2 [label="Expert Out L9 SP0 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep5_tp3_pp2 -> layer_9_expert_out_sp0_ep5_tp3_pp2
	layer_9_expert_ar_sp0_ep5_pp2 [label="Expert All-Reduce L9 SP0 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep5_tp0_pp2 -> layer_9_expert_ar_sp0_ep5_pp2
	layer_9_expert_out_sp0_ep5_tp1_pp2 -> layer_9_expert_ar_sp0_ep5_pp2
	layer_9_expert_out_sp0_ep5_tp2_pp2 -> layer_9_expert_ar_sp0_ep5_pp2
	layer_9_expert_out_sp0_ep5_tp3_pp2 -> layer_9_expert_ar_sp0_ep5_pp2
	layer_9_combine_sp0_ep5_pp2 [label="Token Combine L9 SP0 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep5_pp2 -> layer_9_combine_sp0_ep5_pp2
	layer_9_dispatch_sp0_ep6_pp2 [label="Token Dispatch L9 SP0 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep6_pp2 [style=dashed]
	layer_9_expert_sp0_ep6_tp0_pp2 [label="Expert L9 SP0 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep6_pp2 -> layer_9_expert_sp0_ep6_tp0_pp2
	layer_9_expert_out_sp0_ep6_tp0_pp2 [label="Expert Out L9 SP0 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep6_tp0_pp2 -> layer_9_expert_out_sp0_ep6_tp0_pp2
	layer_9_expert_sp0_ep6_tp1_pp2 [label="Expert L9 SP0 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep6_pp2 -> layer_9_expert_sp0_ep6_tp1_pp2
	layer_9_expert_out_sp0_ep6_tp1_pp2 [label="Expert Out L9 SP0 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep6_tp1_pp2 -> layer_9_expert_out_sp0_ep6_tp1_pp2
	layer_9_expert_sp0_ep6_tp2_pp2 [label="Expert L9 SP0 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep6_pp2 -> layer_9_expert_sp0_ep6_tp2_pp2
	layer_9_expert_out_sp0_ep6_tp2_pp2 [label="Expert Out L9 SP0 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep6_tp2_pp2 -> layer_9_expert_out_sp0_ep6_tp2_pp2
	layer_9_expert_sp0_ep6_tp3_pp2 [label="Expert L9 SP0 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep6_pp2 -> layer_9_expert_sp0_ep6_tp3_pp2
	layer_9_expert_out_sp0_ep6_tp3_pp2 [label="Expert Out L9 SP0 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep6_tp3_pp2 -> layer_9_expert_out_sp0_ep6_tp3_pp2
	layer_9_expert_ar_sp0_ep6_pp2 [label="Expert All-Reduce L9 SP0 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep6_tp0_pp2 -> layer_9_expert_ar_sp0_ep6_pp2
	layer_9_expert_out_sp0_ep6_tp1_pp2 -> layer_9_expert_ar_sp0_ep6_pp2
	layer_9_expert_out_sp0_ep6_tp2_pp2 -> layer_9_expert_ar_sp0_ep6_pp2
	layer_9_expert_out_sp0_ep6_tp3_pp2 -> layer_9_expert_ar_sp0_ep6_pp2
	layer_9_combine_sp0_ep6_pp2 [label="Token Combine L9 SP0 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep6_pp2 -> layer_9_combine_sp0_ep6_pp2
	layer_9_dispatch_sp0_ep7_pp2 [label="Token Dispatch L9 SP0 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep7_pp2 [style=dashed]
	layer_9_expert_sp0_ep7_tp0_pp2 [label="Expert L9 SP0 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep7_pp2 -> layer_9_expert_sp0_ep7_tp0_pp2
	layer_9_expert_out_sp0_ep7_tp0_pp2 [label="Expert Out L9 SP0 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep7_tp0_pp2 -> layer_9_expert_out_sp0_ep7_tp0_pp2
	layer_9_expert_sp0_ep7_tp1_pp2 [label="Expert L9 SP0 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep7_pp2 -> layer_9_expert_sp0_ep7_tp1_pp2
	layer_9_expert_out_sp0_ep7_tp1_pp2 [label="Expert Out L9 SP0 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep7_tp1_pp2 -> layer_9_expert_out_sp0_ep7_tp1_pp2
	layer_9_expert_sp0_ep7_tp2_pp2 [label="Expert L9 SP0 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep7_pp2 -> layer_9_expert_sp0_ep7_tp2_pp2
	layer_9_expert_out_sp0_ep7_tp2_pp2 [label="Expert Out L9 SP0 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep7_tp2_pp2 -> layer_9_expert_out_sp0_ep7_tp2_pp2
	layer_9_expert_sp0_ep7_tp3_pp2 [label="Expert L9 SP0 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep7_pp2 -> layer_9_expert_sp0_ep7_tp3_pp2
	layer_9_expert_out_sp0_ep7_tp3_pp2 [label="Expert Out L9 SP0 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep7_tp3_pp2 -> layer_9_expert_out_sp0_ep7_tp3_pp2
	layer_9_expert_ar_sp0_ep7_pp2 [label="Expert All-Reduce L9 SP0 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep7_tp0_pp2 -> layer_9_expert_ar_sp0_ep7_pp2
	layer_9_expert_out_sp0_ep7_tp1_pp2 -> layer_9_expert_ar_sp0_ep7_pp2
	layer_9_expert_out_sp0_ep7_tp2_pp2 -> layer_9_expert_ar_sp0_ep7_pp2
	layer_9_expert_out_sp0_ep7_tp3_pp2 -> layer_9_expert_ar_sp0_ep7_pp2
	layer_9_combine_sp0_ep7_pp2 [label="Token Combine L9 SP0 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep7_pp2 -> layer_9_combine_sp0_ep7_pp2
	layer_9_dispatch_sp0_ep8_pp2 [label="Token Dispatch L9 SP0 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep8_pp2 [style=dashed]
	layer_9_expert_sp0_ep8_tp0_pp2 [label="Expert L9 SP0 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep8_pp2 -> layer_9_expert_sp0_ep8_tp0_pp2
	layer_9_expert_out_sp0_ep8_tp0_pp2 [label="Expert Out L9 SP0 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep8_tp0_pp2 -> layer_9_expert_out_sp0_ep8_tp0_pp2
	layer_9_expert_sp0_ep8_tp1_pp2 [label="Expert L9 SP0 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep8_pp2 -> layer_9_expert_sp0_ep8_tp1_pp2
	layer_9_expert_out_sp0_ep8_tp1_pp2 [label="Expert Out L9 SP0 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep8_tp1_pp2 -> layer_9_expert_out_sp0_ep8_tp1_pp2
	layer_9_expert_sp0_ep8_tp2_pp2 [label="Expert L9 SP0 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep8_pp2 -> layer_9_expert_sp0_ep8_tp2_pp2
	layer_9_expert_out_sp0_ep8_tp2_pp2 [label="Expert Out L9 SP0 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep8_tp2_pp2 -> layer_9_expert_out_sp0_ep8_tp2_pp2
	layer_9_expert_sp0_ep8_tp3_pp2 [label="Expert L9 SP0 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep8_pp2 -> layer_9_expert_sp0_ep8_tp3_pp2
	layer_9_expert_out_sp0_ep8_tp3_pp2 [label="Expert Out L9 SP0 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep8_tp3_pp2 -> layer_9_expert_out_sp0_ep8_tp3_pp2
	layer_9_expert_ar_sp0_ep8_pp2 [label="Expert All-Reduce L9 SP0 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep8_tp0_pp2 -> layer_9_expert_ar_sp0_ep8_pp2
	layer_9_expert_out_sp0_ep8_tp1_pp2 -> layer_9_expert_ar_sp0_ep8_pp2
	layer_9_expert_out_sp0_ep8_tp2_pp2 -> layer_9_expert_ar_sp0_ep8_pp2
	layer_9_expert_out_sp0_ep8_tp3_pp2 -> layer_9_expert_ar_sp0_ep8_pp2
	layer_9_combine_sp0_ep8_pp2 [label="Token Combine L9 SP0 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep8_pp2 -> layer_9_combine_sp0_ep8_pp2
	layer_9_dispatch_sp0_ep9_pp2 [label="Token Dispatch L9 SP0 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep9_pp2 [style=dashed]
	layer_9_expert_sp0_ep9_tp0_pp2 [label="Expert L9 SP0 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep9_pp2 -> layer_9_expert_sp0_ep9_tp0_pp2
	layer_9_expert_out_sp0_ep9_tp0_pp2 [label="Expert Out L9 SP0 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep9_tp0_pp2 -> layer_9_expert_out_sp0_ep9_tp0_pp2
	layer_9_expert_sp0_ep9_tp1_pp2 [label="Expert L9 SP0 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep9_pp2 -> layer_9_expert_sp0_ep9_tp1_pp2
	layer_9_expert_out_sp0_ep9_tp1_pp2 [label="Expert Out L9 SP0 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep9_tp1_pp2 -> layer_9_expert_out_sp0_ep9_tp1_pp2
	layer_9_expert_sp0_ep9_tp2_pp2 [label="Expert L9 SP0 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep9_pp2 -> layer_9_expert_sp0_ep9_tp2_pp2
	layer_9_expert_out_sp0_ep9_tp2_pp2 [label="Expert Out L9 SP0 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep9_tp2_pp2 -> layer_9_expert_out_sp0_ep9_tp2_pp2
	layer_9_expert_sp0_ep9_tp3_pp2 [label="Expert L9 SP0 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep9_pp2 -> layer_9_expert_sp0_ep9_tp3_pp2
	layer_9_expert_out_sp0_ep9_tp3_pp2 [label="Expert Out L9 SP0 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep9_tp3_pp2 -> layer_9_expert_out_sp0_ep9_tp3_pp2
	layer_9_expert_ar_sp0_ep9_pp2 [label="Expert All-Reduce L9 SP0 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep9_tp0_pp2 -> layer_9_expert_ar_sp0_ep9_pp2
	layer_9_expert_out_sp0_ep9_tp1_pp2 -> layer_9_expert_ar_sp0_ep9_pp2
	layer_9_expert_out_sp0_ep9_tp2_pp2 -> layer_9_expert_ar_sp0_ep9_pp2
	layer_9_expert_out_sp0_ep9_tp3_pp2 -> layer_9_expert_ar_sp0_ep9_pp2
	layer_9_combine_sp0_ep9_pp2 [label="Token Combine L9 SP0 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep9_pp2 -> layer_9_combine_sp0_ep9_pp2
	layer_9_dispatch_sp0_ep10_pp2 [label="Token Dispatch L9 SP0 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep10_pp2 [style=dashed]
	layer_9_expert_sp0_ep10_tp0_pp2 [label="Expert L9 SP0 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep10_pp2 -> layer_9_expert_sp0_ep10_tp0_pp2
	layer_9_expert_out_sp0_ep10_tp0_pp2 [label="Expert Out L9 SP0 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep10_tp0_pp2 -> layer_9_expert_out_sp0_ep10_tp0_pp2
	layer_9_expert_sp0_ep10_tp1_pp2 [label="Expert L9 SP0 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep10_pp2 -> layer_9_expert_sp0_ep10_tp1_pp2
	layer_9_expert_out_sp0_ep10_tp1_pp2 [label="Expert Out L9 SP0 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep10_tp1_pp2 -> layer_9_expert_out_sp0_ep10_tp1_pp2
	layer_9_expert_sp0_ep10_tp2_pp2 [label="Expert L9 SP0 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep10_pp2 -> layer_9_expert_sp0_ep10_tp2_pp2
	layer_9_expert_out_sp0_ep10_tp2_pp2 [label="Expert Out L9 SP0 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep10_tp2_pp2 -> layer_9_expert_out_sp0_ep10_tp2_pp2
	layer_9_expert_sp0_ep10_tp3_pp2 [label="Expert L9 SP0 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep10_pp2 -> layer_9_expert_sp0_ep10_tp3_pp2
	layer_9_expert_out_sp0_ep10_tp3_pp2 [label="Expert Out L9 SP0 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep10_tp3_pp2 -> layer_9_expert_out_sp0_ep10_tp3_pp2
	layer_9_expert_ar_sp0_ep10_pp2 [label="Expert All-Reduce L9 SP0 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep10_tp0_pp2 -> layer_9_expert_ar_sp0_ep10_pp2
	layer_9_expert_out_sp0_ep10_tp1_pp2 -> layer_9_expert_ar_sp0_ep10_pp2
	layer_9_expert_out_sp0_ep10_tp2_pp2 -> layer_9_expert_ar_sp0_ep10_pp2
	layer_9_expert_out_sp0_ep10_tp3_pp2 -> layer_9_expert_ar_sp0_ep10_pp2
	layer_9_combine_sp0_ep10_pp2 [label="Token Combine L9 SP0 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep10_pp2 -> layer_9_combine_sp0_ep10_pp2
	layer_9_dispatch_sp0_ep11_pp2 [label="Token Dispatch L9 SP0 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep11_pp2 [style=dashed]
	layer_9_expert_sp0_ep11_tp0_pp2 [label="Expert L9 SP0 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep11_pp2 -> layer_9_expert_sp0_ep11_tp0_pp2
	layer_9_expert_out_sp0_ep11_tp0_pp2 [label="Expert Out L9 SP0 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep11_tp0_pp2 -> layer_9_expert_out_sp0_ep11_tp0_pp2
	layer_9_expert_sp0_ep11_tp1_pp2 [label="Expert L9 SP0 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep11_pp2 -> layer_9_expert_sp0_ep11_tp1_pp2
	layer_9_expert_out_sp0_ep11_tp1_pp2 [label="Expert Out L9 SP0 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep11_tp1_pp2 -> layer_9_expert_out_sp0_ep11_tp1_pp2
	layer_9_expert_sp0_ep11_tp2_pp2 [label="Expert L9 SP0 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep11_pp2 -> layer_9_expert_sp0_ep11_tp2_pp2
	layer_9_expert_out_sp0_ep11_tp2_pp2 [label="Expert Out L9 SP0 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep11_tp2_pp2 -> layer_9_expert_out_sp0_ep11_tp2_pp2
	layer_9_expert_sp0_ep11_tp3_pp2 [label="Expert L9 SP0 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep11_pp2 -> layer_9_expert_sp0_ep11_tp3_pp2
	layer_9_expert_out_sp0_ep11_tp3_pp2 [label="Expert Out L9 SP0 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep11_tp3_pp2 -> layer_9_expert_out_sp0_ep11_tp3_pp2
	layer_9_expert_ar_sp0_ep11_pp2 [label="Expert All-Reduce L9 SP0 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep11_tp0_pp2 -> layer_9_expert_ar_sp0_ep11_pp2
	layer_9_expert_out_sp0_ep11_tp1_pp2 -> layer_9_expert_ar_sp0_ep11_pp2
	layer_9_expert_out_sp0_ep11_tp2_pp2 -> layer_9_expert_ar_sp0_ep11_pp2
	layer_9_expert_out_sp0_ep11_tp3_pp2 -> layer_9_expert_ar_sp0_ep11_pp2
	layer_9_combine_sp0_ep11_pp2 [label="Token Combine L9 SP0 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep11_pp2 -> layer_9_combine_sp0_ep11_pp2
	layer_9_dispatch_sp0_ep12_pp2 [label="Token Dispatch L9 SP0 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep12_pp2 [style=dashed]
	layer_9_expert_sp0_ep12_tp0_pp2 [label="Expert L9 SP0 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep12_pp2 -> layer_9_expert_sp0_ep12_tp0_pp2
	layer_9_expert_out_sp0_ep12_tp0_pp2 [label="Expert Out L9 SP0 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep12_tp0_pp2 -> layer_9_expert_out_sp0_ep12_tp0_pp2
	layer_9_expert_sp0_ep12_tp1_pp2 [label="Expert L9 SP0 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep12_pp2 -> layer_9_expert_sp0_ep12_tp1_pp2
	layer_9_expert_out_sp0_ep12_tp1_pp2 [label="Expert Out L9 SP0 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep12_tp1_pp2 -> layer_9_expert_out_sp0_ep12_tp1_pp2
	layer_9_expert_sp0_ep12_tp2_pp2 [label="Expert L9 SP0 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep12_pp2 -> layer_9_expert_sp0_ep12_tp2_pp2
	layer_9_expert_out_sp0_ep12_tp2_pp2 [label="Expert Out L9 SP0 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep12_tp2_pp2 -> layer_9_expert_out_sp0_ep12_tp2_pp2
	layer_9_expert_sp0_ep12_tp3_pp2 [label="Expert L9 SP0 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep12_pp2 -> layer_9_expert_sp0_ep12_tp3_pp2
	layer_9_expert_out_sp0_ep12_tp3_pp2 [label="Expert Out L9 SP0 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep12_tp3_pp2 -> layer_9_expert_out_sp0_ep12_tp3_pp2
	layer_9_expert_ar_sp0_ep12_pp2 [label="Expert All-Reduce L9 SP0 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep12_tp0_pp2 -> layer_9_expert_ar_sp0_ep12_pp2
	layer_9_expert_out_sp0_ep12_tp1_pp2 -> layer_9_expert_ar_sp0_ep12_pp2
	layer_9_expert_out_sp0_ep12_tp2_pp2 -> layer_9_expert_ar_sp0_ep12_pp2
	layer_9_expert_out_sp0_ep12_tp3_pp2 -> layer_9_expert_ar_sp0_ep12_pp2
	layer_9_combine_sp0_ep12_pp2 [label="Token Combine L9 SP0 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep12_pp2 -> layer_9_combine_sp0_ep12_pp2
	layer_9_dispatch_sp0_ep13_pp2 [label="Token Dispatch L9 SP0 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep13_pp2 [style=dashed]
	layer_9_expert_sp0_ep13_tp0_pp2 [label="Expert L9 SP0 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep13_pp2 -> layer_9_expert_sp0_ep13_tp0_pp2
	layer_9_expert_out_sp0_ep13_tp0_pp2 [label="Expert Out L9 SP0 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep13_tp0_pp2 -> layer_9_expert_out_sp0_ep13_tp0_pp2
	layer_9_expert_sp0_ep13_tp1_pp2 [label="Expert L9 SP0 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep13_pp2 -> layer_9_expert_sp0_ep13_tp1_pp2
	layer_9_expert_out_sp0_ep13_tp1_pp2 [label="Expert Out L9 SP0 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep13_tp1_pp2 -> layer_9_expert_out_sp0_ep13_tp1_pp2
	layer_9_expert_sp0_ep13_tp2_pp2 [label="Expert L9 SP0 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep13_pp2 -> layer_9_expert_sp0_ep13_tp2_pp2
	layer_9_expert_out_sp0_ep13_tp2_pp2 [label="Expert Out L9 SP0 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep13_tp2_pp2 -> layer_9_expert_out_sp0_ep13_tp2_pp2
	layer_9_expert_sp0_ep13_tp3_pp2 [label="Expert L9 SP0 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep13_pp2 -> layer_9_expert_sp0_ep13_tp3_pp2
	layer_9_expert_out_sp0_ep13_tp3_pp2 [label="Expert Out L9 SP0 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep13_tp3_pp2 -> layer_9_expert_out_sp0_ep13_tp3_pp2
	layer_9_expert_ar_sp0_ep13_pp2 [label="Expert All-Reduce L9 SP0 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep13_tp0_pp2 -> layer_9_expert_ar_sp0_ep13_pp2
	layer_9_expert_out_sp0_ep13_tp1_pp2 -> layer_9_expert_ar_sp0_ep13_pp2
	layer_9_expert_out_sp0_ep13_tp2_pp2 -> layer_9_expert_ar_sp0_ep13_pp2
	layer_9_expert_out_sp0_ep13_tp3_pp2 -> layer_9_expert_ar_sp0_ep13_pp2
	layer_9_combine_sp0_ep13_pp2 [label="Token Combine L9 SP0 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep13_pp2 -> layer_9_combine_sp0_ep13_pp2
	layer_9_dispatch_sp0_ep14_pp2 [label="Token Dispatch L9 SP0 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep14_pp2 [style=dashed]
	layer_9_expert_sp0_ep14_tp0_pp2 [label="Expert L9 SP0 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep14_pp2 -> layer_9_expert_sp0_ep14_tp0_pp2
	layer_9_expert_out_sp0_ep14_tp0_pp2 [label="Expert Out L9 SP0 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep14_tp0_pp2 -> layer_9_expert_out_sp0_ep14_tp0_pp2
	layer_9_expert_sp0_ep14_tp1_pp2 [label="Expert L9 SP0 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep14_pp2 -> layer_9_expert_sp0_ep14_tp1_pp2
	layer_9_expert_out_sp0_ep14_tp1_pp2 [label="Expert Out L9 SP0 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep14_tp1_pp2 -> layer_9_expert_out_sp0_ep14_tp1_pp2
	layer_9_expert_sp0_ep14_tp2_pp2 [label="Expert L9 SP0 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep14_pp2 -> layer_9_expert_sp0_ep14_tp2_pp2
	layer_9_expert_out_sp0_ep14_tp2_pp2 [label="Expert Out L9 SP0 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep14_tp2_pp2 -> layer_9_expert_out_sp0_ep14_tp2_pp2
	layer_9_expert_sp0_ep14_tp3_pp2 [label="Expert L9 SP0 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep14_pp2 -> layer_9_expert_sp0_ep14_tp3_pp2
	layer_9_expert_out_sp0_ep14_tp3_pp2 [label="Expert Out L9 SP0 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep14_tp3_pp2 -> layer_9_expert_out_sp0_ep14_tp3_pp2
	layer_9_expert_ar_sp0_ep14_pp2 [label="Expert All-Reduce L9 SP0 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep14_tp0_pp2 -> layer_9_expert_ar_sp0_ep14_pp2
	layer_9_expert_out_sp0_ep14_tp1_pp2 -> layer_9_expert_ar_sp0_ep14_pp2
	layer_9_expert_out_sp0_ep14_tp2_pp2 -> layer_9_expert_ar_sp0_ep14_pp2
	layer_9_expert_out_sp0_ep14_tp3_pp2 -> layer_9_expert_ar_sp0_ep14_pp2
	layer_9_combine_sp0_ep14_pp2 [label="Token Combine L9 SP0 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep14_pp2 -> layer_9_combine_sp0_ep14_pp2
	layer_9_dispatch_sp0_ep15_pp2 [label="Token Dispatch L9 SP0 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp0_pp2 -> layer_9_dispatch_sp0_ep15_pp2 [style=dashed]
	layer_9_expert_sp0_ep15_tp0_pp2 [label="Expert L9 SP0 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep15_pp2 -> layer_9_expert_sp0_ep15_tp0_pp2
	layer_9_expert_out_sp0_ep15_tp0_pp2 [label="Expert Out L9 SP0 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep15_tp0_pp2 -> layer_9_expert_out_sp0_ep15_tp0_pp2
	layer_9_expert_sp0_ep15_tp1_pp2 [label="Expert L9 SP0 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep15_pp2 -> layer_9_expert_sp0_ep15_tp1_pp2
	layer_9_expert_out_sp0_ep15_tp1_pp2 [label="Expert Out L9 SP0 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep15_tp1_pp2 -> layer_9_expert_out_sp0_ep15_tp1_pp2
	layer_9_expert_sp0_ep15_tp2_pp2 [label="Expert L9 SP0 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep15_pp2 -> layer_9_expert_sp0_ep15_tp2_pp2
	layer_9_expert_out_sp0_ep15_tp2_pp2 [label="Expert Out L9 SP0 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep15_tp2_pp2 -> layer_9_expert_out_sp0_ep15_tp2_pp2
	layer_9_expert_sp0_ep15_tp3_pp2 [label="Expert L9 SP0 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp0_ep15_pp2 -> layer_9_expert_sp0_ep15_tp3_pp2
	layer_9_expert_out_sp0_ep15_tp3_pp2 [label="Expert Out L9 SP0 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp0_ep15_tp3_pp2 -> layer_9_expert_out_sp0_ep15_tp3_pp2
	layer_9_expert_ar_sp0_ep15_pp2 [label="Expert All-Reduce L9 SP0 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp0_ep15_tp0_pp2 -> layer_9_expert_ar_sp0_ep15_pp2
	layer_9_expert_out_sp0_ep15_tp1_pp2 -> layer_9_expert_ar_sp0_ep15_pp2
	layer_9_expert_out_sp0_ep15_tp2_pp2 -> layer_9_expert_ar_sp0_ep15_pp2
	layer_9_expert_out_sp0_ep15_tp3_pp2 -> layer_9_expert_ar_sp0_ep15_pp2
	layer_9_combine_sp0_ep15_pp2 [label="Token Combine L9 SP0 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp0_ep15_pp2 -> layer_9_combine_sp0_ep15_pp2
	layer_9_moe_all2all_sp0_pp2 [label="MoE All-to-All L9 SP0\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_9_combine_sp0_ep0_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep1_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep2_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep3_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep4_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep5_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep6_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep7_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep8_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep9_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep10_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep11_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep12_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep13_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep14_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_combine_sp0_ep15_pp2 -> layer_9_moe_all2all_sp0_pp2
	layer_9_mlp_out_sp0_pp2 [label="MoE Output L9 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_moe_all2all_sp0_pp2 -> layer_9_mlp_out_sp0_pp2
	layer_9_mlp_res_sp0_pp2 [label="MLP Residual L9 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_mlp_out_sp0_pp2 -> layer_9_mlp_res_sp0_pp2
	layer_9_attn_res_sp0_pp2 -> layer_9_mlp_res_sp0_pp2 [style=dashed]
	layer_9_norm_sp1_pp2 [label="LayerNorm L9 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_mlp_out_sp1_pp2 -> layer_9_norm_sp1_pp2
	layer_9_qkv_sp1_tp0_pp2 [label="QKV Proj L9 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp1_pp2 -> layer_9_qkv_sp1_tp0_pp2
	layer_9_attn_sp1_tp0_pp2 [label="Attention L9 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp1_tp0_pp2 -> layer_9_attn_sp1_tp0_pp2
	layer_9_attn_out_sp1_tp0_pp2 [label="Attn Out Proj L9 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp1_tp0_pp2 -> layer_9_attn_out_sp1_tp0_pp2
	layer_9_qkv_sp1_tp1_pp2 [label="QKV Proj L9 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp1_pp2 -> layer_9_qkv_sp1_tp1_pp2
	layer_9_attn_sp1_tp1_pp2 [label="Attention L9 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp1_tp1_pp2 -> layer_9_attn_sp1_tp1_pp2
	layer_9_attn_out_sp1_tp1_pp2 [label="Attn Out Proj L9 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp1_tp1_pp2 -> layer_9_attn_out_sp1_tp1_pp2
	layer_9_qkv_sp1_tp2_pp2 [label="QKV Proj L9 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp1_pp2 -> layer_9_qkv_sp1_tp2_pp2
	layer_9_attn_sp1_tp2_pp2 [label="Attention L9 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp1_tp2_pp2 -> layer_9_attn_sp1_tp2_pp2
	layer_9_attn_out_sp1_tp2_pp2 [label="Attn Out Proj L9 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp1_tp2_pp2 -> layer_9_attn_out_sp1_tp2_pp2
	layer_9_qkv_sp1_tp3_pp2 [label="QKV Proj L9 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp1_pp2 -> layer_9_qkv_sp1_tp3_pp2
	layer_9_attn_sp1_tp3_pp2 [label="Attention L9 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp1_tp3_pp2 -> layer_9_attn_sp1_tp3_pp2
	layer_9_attn_out_sp1_tp3_pp2 [label="Attn Out Proj L9 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp1_tp3_pp2 -> layer_9_attn_out_sp1_tp3_pp2
	layer_9_attn_ar_sp1_pp2 [label="Attention All-Reduce L9 SP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_attn_out_sp1_tp0_pp2 -> layer_9_attn_ar_sp1_pp2
	layer_9_attn_out_sp1_tp1_pp2 -> layer_9_attn_ar_sp1_pp2
	layer_9_attn_out_sp1_tp2_pp2 -> layer_9_attn_ar_sp1_pp2
	layer_9_attn_out_sp1_tp3_pp2 -> layer_9_attn_ar_sp1_pp2
	layer_9_attn_res_sp1_pp2 [label="Attention Residual L9 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_attn_ar_sp1_pp2 -> layer_9_attn_res_sp1_pp2
	layer_9_norm_sp1_pp2 -> layer_9_attn_res_sp1_pp2 [style=dashed]
	layer_9_post_norm_sp1_pp2 [label="Post-Attn Norm L9 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_attn_res_sp1_pp2 -> layer_9_post_norm_sp1_pp2
	layer_9_router_sp1_pp2 [label="MoE Router L9 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_9_post_norm_sp1_pp2 -> layer_9_router_sp1_pp2
	layer_9_dispatch_sp1_ep0_pp2 [label="Token Dispatch L9 SP1 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep0_pp2 [style=dashed]
	layer_9_expert_sp1_ep0_tp0_pp2 [label="Expert L9 SP1 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep0_pp2 -> layer_9_expert_sp1_ep0_tp0_pp2
	layer_9_expert_out_sp1_ep0_tp0_pp2 [label="Expert Out L9 SP1 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep0_tp0_pp2 -> layer_9_expert_out_sp1_ep0_tp0_pp2
	layer_9_expert_sp1_ep0_tp1_pp2 [label="Expert L9 SP1 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep0_pp2 -> layer_9_expert_sp1_ep0_tp1_pp2
	layer_9_expert_out_sp1_ep0_tp1_pp2 [label="Expert Out L9 SP1 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep0_tp1_pp2 -> layer_9_expert_out_sp1_ep0_tp1_pp2
	layer_9_expert_sp1_ep0_tp2_pp2 [label="Expert L9 SP1 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep0_pp2 -> layer_9_expert_sp1_ep0_tp2_pp2
	layer_9_expert_out_sp1_ep0_tp2_pp2 [label="Expert Out L9 SP1 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep0_tp2_pp2 -> layer_9_expert_out_sp1_ep0_tp2_pp2
	layer_9_expert_sp1_ep0_tp3_pp2 [label="Expert L9 SP1 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep0_pp2 -> layer_9_expert_sp1_ep0_tp3_pp2
	layer_9_expert_out_sp1_ep0_tp3_pp2 [label="Expert Out L9 SP1 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep0_tp3_pp2 -> layer_9_expert_out_sp1_ep0_tp3_pp2
	layer_9_expert_ar_sp1_ep0_pp2 [label="Expert All-Reduce L9 SP1 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep0_tp0_pp2 -> layer_9_expert_ar_sp1_ep0_pp2
	layer_9_expert_out_sp1_ep0_tp1_pp2 -> layer_9_expert_ar_sp1_ep0_pp2
	layer_9_expert_out_sp1_ep0_tp2_pp2 -> layer_9_expert_ar_sp1_ep0_pp2
	layer_9_expert_out_sp1_ep0_tp3_pp2 -> layer_9_expert_ar_sp1_ep0_pp2
	layer_9_combine_sp1_ep0_pp2 [label="Token Combine L9 SP1 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep0_pp2 -> layer_9_combine_sp1_ep0_pp2
	layer_9_dispatch_sp1_ep1_pp2 [label="Token Dispatch L9 SP1 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep1_pp2 [style=dashed]
	layer_9_expert_sp1_ep1_tp0_pp2 [label="Expert L9 SP1 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep1_pp2 -> layer_9_expert_sp1_ep1_tp0_pp2
	layer_9_expert_out_sp1_ep1_tp0_pp2 [label="Expert Out L9 SP1 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep1_tp0_pp2 -> layer_9_expert_out_sp1_ep1_tp0_pp2
	layer_9_expert_sp1_ep1_tp1_pp2 [label="Expert L9 SP1 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep1_pp2 -> layer_9_expert_sp1_ep1_tp1_pp2
	layer_9_expert_out_sp1_ep1_tp1_pp2 [label="Expert Out L9 SP1 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep1_tp1_pp2 -> layer_9_expert_out_sp1_ep1_tp1_pp2
	layer_9_expert_sp1_ep1_tp2_pp2 [label="Expert L9 SP1 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep1_pp2 -> layer_9_expert_sp1_ep1_tp2_pp2
	layer_9_expert_out_sp1_ep1_tp2_pp2 [label="Expert Out L9 SP1 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep1_tp2_pp2 -> layer_9_expert_out_sp1_ep1_tp2_pp2
	layer_9_expert_sp1_ep1_tp3_pp2 [label="Expert L9 SP1 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep1_pp2 -> layer_9_expert_sp1_ep1_tp3_pp2
	layer_9_expert_out_sp1_ep1_tp3_pp2 [label="Expert Out L9 SP1 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep1_tp3_pp2 -> layer_9_expert_out_sp1_ep1_tp3_pp2
	layer_9_expert_ar_sp1_ep1_pp2 [label="Expert All-Reduce L9 SP1 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep1_tp0_pp2 -> layer_9_expert_ar_sp1_ep1_pp2
	layer_9_expert_out_sp1_ep1_tp1_pp2 -> layer_9_expert_ar_sp1_ep1_pp2
	layer_9_expert_out_sp1_ep1_tp2_pp2 -> layer_9_expert_ar_sp1_ep1_pp2
	layer_9_expert_out_sp1_ep1_tp3_pp2 -> layer_9_expert_ar_sp1_ep1_pp2
	layer_9_combine_sp1_ep1_pp2 [label="Token Combine L9 SP1 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep1_pp2 -> layer_9_combine_sp1_ep1_pp2
	layer_9_dispatch_sp1_ep2_pp2 [label="Token Dispatch L9 SP1 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep2_pp2 [style=dashed]
	layer_9_expert_sp1_ep2_tp0_pp2 [label="Expert L9 SP1 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep2_pp2 -> layer_9_expert_sp1_ep2_tp0_pp2
	layer_9_expert_out_sp1_ep2_tp0_pp2 [label="Expert Out L9 SP1 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep2_tp0_pp2 -> layer_9_expert_out_sp1_ep2_tp0_pp2
	layer_9_expert_sp1_ep2_tp1_pp2 [label="Expert L9 SP1 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep2_pp2 -> layer_9_expert_sp1_ep2_tp1_pp2
	layer_9_expert_out_sp1_ep2_tp1_pp2 [label="Expert Out L9 SP1 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep2_tp1_pp2 -> layer_9_expert_out_sp1_ep2_tp1_pp2
	layer_9_expert_sp1_ep2_tp2_pp2 [label="Expert L9 SP1 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep2_pp2 -> layer_9_expert_sp1_ep2_tp2_pp2
	layer_9_expert_out_sp1_ep2_tp2_pp2 [label="Expert Out L9 SP1 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep2_tp2_pp2 -> layer_9_expert_out_sp1_ep2_tp2_pp2
	layer_9_expert_sp1_ep2_tp3_pp2 [label="Expert L9 SP1 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep2_pp2 -> layer_9_expert_sp1_ep2_tp3_pp2
	layer_9_expert_out_sp1_ep2_tp3_pp2 [label="Expert Out L9 SP1 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep2_tp3_pp2 -> layer_9_expert_out_sp1_ep2_tp3_pp2
	layer_9_expert_ar_sp1_ep2_pp2 [label="Expert All-Reduce L9 SP1 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep2_tp0_pp2 -> layer_9_expert_ar_sp1_ep2_pp2
	layer_9_expert_out_sp1_ep2_tp1_pp2 -> layer_9_expert_ar_sp1_ep2_pp2
	layer_9_expert_out_sp1_ep2_tp2_pp2 -> layer_9_expert_ar_sp1_ep2_pp2
	layer_9_expert_out_sp1_ep2_tp3_pp2 -> layer_9_expert_ar_sp1_ep2_pp2
	layer_9_combine_sp1_ep2_pp2 [label="Token Combine L9 SP1 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep2_pp2 -> layer_9_combine_sp1_ep2_pp2
	layer_9_dispatch_sp1_ep3_pp2 [label="Token Dispatch L9 SP1 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep3_pp2 [style=dashed]
	layer_9_expert_sp1_ep3_tp0_pp2 [label="Expert L9 SP1 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep3_pp2 -> layer_9_expert_sp1_ep3_tp0_pp2
	layer_9_expert_out_sp1_ep3_tp0_pp2 [label="Expert Out L9 SP1 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep3_tp0_pp2 -> layer_9_expert_out_sp1_ep3_tp0_pp2
	layer_9_expert_sp1_ep3_tp1_pp2 [label="Expert L9 SP1 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep3_pp2 -> layer_9_expert_sp1_ep3_tp1_pp2
	layer_9_expert_out_sp1_ep3_tp1_pp2 [label="Expert Out L9 SP1 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep3_tp1_pp2 -> layer_9_expert_out_sp1_ep3_tp1_pp2
	layer_9_expert_sp1_ep3_tp2_pp2 [label="Expert L9 SP1 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep3_pp2 -> layer_9_expert_sp1_ep3_tp2_pp2
	layer_9_expert_out_sp1_ep3_tp2_pp2 [label="Expert Out L9 SP1 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep3_tp2_pp2 -> layer_9_expert_out_sp1_ep3_tp2_pp2
	layer_9_expert_sp1_ep3_tp3_pp2 [label="Expert L9 SP1 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep3_pp2 -> layer_9_expert_sp1_ep3_tp3_pp2
	layer_9_expert_out_sp1_ep3_tp3_pp2 [label="Expert Out L9 SP1 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep3_tp3_pp2 -> layer_9_expert_out_sp1_ep3_tp3_pp2
	layer_9_expert_ar_sp1_ep3_pp2 [label="Expert All-Reduce L9 SP1 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep3_tp0_pp2 -> layer_9_expert_ar_sp1_ep3_pp2
	layer_9_expert_out_sp1_ep3_tp1_pp2 -> layer_9_expert_ar_sp1_ep3_pp2
	layer_9_expert_out_sp1_ep3_tp2_pp2 -> layer_9_expert_ar_sp1_ep3_pp2
	layer_9_expert_out_sp1_ep3_tp3_pp2 -> layer_9_expert_ar_sp1_ep3_pp2
	layer_9_combine_sp1_ep3_pp2 [label="Token Combine L9 SP1 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep3_pp2 -> layer_9_combine_sp1_ep3_pp2
	layer_9_dispatch_sp1_ep4_pp2 [label="Token Dispatch L9 SP1 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep4_pp2 [style=dashed]
	layer_9_expert_sp1_ep4_tp0_pp2 [label="Expert L9 SP1 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep4_pp2 -> layer_9_expert_sp1_ep4_tp0_pp2
	layer_9_expert_out_sp1_ep4_tp0_pp2 [label="Expert Out L9 SP1 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep4_tp0_pp2 -> layer_9_expert_out_sp1_ep4_tp0_pp2
	layer_9_expert_sp1_ep4_tp1_pp2 [label="Expert L9 SP1 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep4_pp2 -> layer_9_expert_sp1_ep4_tp1_pp2
	layer_9_expert_out_sp1_ep4_tp1_pp2 [label="Expert Out L9 SP1 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep4_tp1_pp2 -> layer_9_expert_out_sp1_ep4_tp1_pp2
	layer_9_expert_sp1_ep4_tp2_pp2 [label="Expert L9 SP1 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep4_pp2 -> layer_9_expert_sp1_ep4_tp2_pp2
	layer_9_expert_out_sp1_ep4_tp2_pp2 [label="Expert Out L9 SP1 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep4_tp2_pp2 -> layer_9_expert_out_sp1_ep4_tp2_pp2
	layer_9_expert_sp1_ep4_tp3_pp2 [label="Expert L9 SP1 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep4_pp2 -> layer_9_expert_sp1_ep4_tp3_pp2
	layer_9_expert_out_sp1_ep4_tp3_pp2 [label="Expert Out L9 SP1 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep4_tp3_pp2 -> layer_9_expert_out_sp1_ep4_tp3_pp2
	layer_9_expert_ar_sp1_ep4_pp2 [label="Expert All-Reduce L9 SP1 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep4_tp0_pp2 -> layer_9_expert_ar_sp1_ep4_pp2
	layer_9_expert_out_sp1_ep4_tp1_pp2 -> layer_9_expert_ar_sp1_ep4_pp2
	layer_9_expert_out_sp1_ep4_tp2_pp2 -> layer_9_expert_ar_sp1_ep4_pp2
	layer_9_expert_out_sp1_ep4_tp3_pp2 -> layer_9_expert_ar_sp1_ep4_pp2
	layer_9_combine_sp1_ep4_pp2 [label="Token Combine L9 SP1 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep4_pp2 -> layer_9_combine_sp1_ep4_pp2
	layer_9_dispatch_sp1_ep5_pp2 [label="Token Dispatch L9 SP1 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep5_pp2 [style=dashed]
	layer_9_expert_sp1_ep5_tp0_pp2 [label="Expert L9 SP1 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep5_pp2 -> layer_9_expert_sp1_ep5_tp0_pp2
	layer_9_expert_out_sp1_ep5_tp0_pp2 [label="Expert Out L9 SP1 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep5_tp0_pp2 -> layer_9_expert_out_sp1_ep5_tp0_pp2
	layer_9_expert_sp1_ep5_tp1_pp2 [label="Expert L9 SP1 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep5_pp2 -> layer_9_expert_sp1_ep5_tp1_pp2
	layer_9_expert_out_sp1_ep5_tp1_pp2 [label="Expert Out L9 SP1 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep5_tp1_pp2 -> layer_9_expert_out_sp1_ep5_tp1_pp2
	layer_9_expert_sp1_ep5_tp2_pp2 [label="Expert L9 SP1 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep5_pp2 -> layer_9_expert_sp1_ep5_tp2_pp2
	layer_9_expert_out_sp1_ep5_tp2_pp2 [label="Expert Out L9 SP1 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep5_tp2_pp2 -> layer_9_expert_out_sp1_ep5_tp2_pp2
	layer_9_expert_sp1_ep5_tp3_pp2 [label="Expert L9 SP1 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep5_pp2 -> layer_9_expert_sp1_ep5_tp3_pp2
	layer_9_expert_out_sp1_ep5_tp3_pp2 [label="Expert Out L9 SP1 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep5_tp3_pp2 -> layer_9_expert_out_sp1_ep5_tp3_pp2
	layer_9_expert_ar_sp1_ep5_pp2 [label="Expert All-Reduce L9 SP1 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep5_tp0_pp2 -> layer_9_expert_ar_sp1_ep5_pp2
	layer_9_expert_out_sp1_ep5_tp1_pp2 -> layer_9_expert_ar_sp1_ep5_pp2
	layer_9_expert_out_sp1_ep5_tp2_pp2 -> layer_9_expert_ar_sp1_ep5_pp2
	layer_9_expert_out_sp1_ep5_tp3_pp2 -> layer_9_expert_ar_sp1_ep5_pp2
	layer_9_combine_sp1_ep5_pp2 [label="Token Combine L9 SP1 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep5_pp2 -> layer_9_combine_sp1_ep5_pp2
	layer_9_dispatch_sp1_ep6_pp2 [label="Token Dispatch L9 SP1 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep6_pp2 [style=dashed]
	layer_9_expert_sp1_ep6_tp0_pp2 [label="Expert L9 SP1 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep6_pp2 -> layer_9_expert_sp1_ep6_tp0_pp2
	layer_9_expert_out_sp1_ep6_tp0_pp2 [label="Expert Out L9 SP1 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep6_tp0_pp2 -> layer_9_expert_out_sp1_ep6_tp0_pp2
	layer_9_expert_sp1_ep6_tp1_pp2 [label="Expert L9 SP1 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep6_pp2 -> layer_9_expert_sp1_ep6_tp1_pp2
	layer_9_expert_out_sp1_ep6_tp1_pp2 [label="Expert Out L9 SP1 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep6_tp1_pp2 -> layer_9_expert_out_sp1_ep6_tp1_pp2
	layer_9_expert_sp1_ep6_tp2_pp2 [label="Expert L9 SP1 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep6_pp2 -> layer_9_expert_sp1_ep6_tp2_pp2
	layer_9_expert_out_sp1_ep6_tp2_pp2 [label="Expert Out L9 SP1 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep6_tp2_pp2 -> layer_9_expert_out_sp1_ep6_tp2_pp2
	layer_9_expert_sp1_ep6_tp3_pp2 [label="Expert L9 SP1 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep6_pp2 -> layer_9_expert_sp1_ep6_tp3_pp2
	layer_9_expert_out_sp1_ep6_tp3_pp2 [label="Expert Out L9 SP1 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep6_tp3_pp2 -> layer_9_expert_out_sp1_ep6_tp3_pp2
	layer_9_expert_ar_sp1_ep6_pp2 [label="Expert All-Reduce L9 SP1 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep6_tp0_pp2 -> layer_9_expert_ar_sp1_ep6_pp2
	layer_9_expert_out_sp1_ep6_tp1_pp2 -> layer_9_expert_ar_sp1_ep6_pp2
	layer_9_expert_out_sp1_ep6_tp2_pp2 -> layer_9_expert_ar_sp1_ep6_pp2
	layer_9_expert_out_sp1_ep6_tp3_pp2 -> layer_9_expert_ar_sp1_ep6_pp2
	layer_9_combine_sp1_ep6_pp2 [label="Token Combine L9 SP1 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep6_pp2 -> layer_9_combine_sp1_ep6_pp2
	layer_9_dispatch_sp1_ep7_pp2 [label="Token Dispatch L9 SP1 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep7_pp2 [style=dashed]
	layer_9_expert_sp1_ep7_tp0_pp2 [label="Expert L9 SP1 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep7_pp2 -> layer_9_expert_sp1_ep7_tp0_pp2
	layer_9_expert_out_sp1_ep7_tp0_pp2 [label="Expert Out L9 SP1 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep7_tp0_pp2 -> layer_9_expert_out_sp1_ep7_tp0_pp2
	layer_9_expert_sp1_ep7_tp1_pp2 [label="Expert L9 SP1 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep7_pp2 -> layer_9_expert_sp1_ep7_tp1_pp2
	layer_9_expert_out_sp1_ep7_tp1_pp2 [label="Expert Out L9 SP1 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep7_tp1_pp2 -> layer_9_expert_out_sp1_ep7_tp1_pp2
	layer_9_expert_sp1_ep7_tp2_pp2 [label="Expert L9 SP1 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep7_pp2 -> layer_9_expert_sp1_ep7_tp2_pp2
	layer_9_expert_out_sp1_ep7_tp2_pp2 [label="Expert Out L9 SP1 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep7_tp2_pp2 -> layer_9_expert_out_sp1_ep7_tp2_pp2
	layer_9_expert_sp1_ep7_tp3_pp2 [label="Expert L9 SP1 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep7_pp2 -> layer_9_expert_sp1_ep7_tp3_pp2
	layer_9_expert_out_sp1_ep7_tp3_pp2 [label="Expert Out L9 SP1 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep7_tp3_pp2 -> layer_9_expert_out_sp1_ep7_tp3_pp2
	layer_9_expert_ar_sp1_ep7_pp2 [label="Expert All-Reduce L9 SP1 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep7_tp0_pp2 -> layer_9_expert_ar_sp1_ep7_pp2
	layer_9_expert_out_sp1_ep7_tp1_pp2 -> layer_9_expert_ar_sp1_ep7_pp2
	layer_9_expert_out_sp1_ep7_tp2_pp2 -> layer_9_expert_ar_sp1_ep7_pp2
	layer_9_expert_out_sp1_ep7_tp3_pp2 -> layer_9_expert_ar_sp1_ep7_pp2
	layer_9_combine_sp1_ep7_pp2 [label="Token Combine L9 SP1 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep7_pp2 -> layer_9_combine_sp1_ep7_pp2
	layer_9_dispatch_sp1_ep8_pp2 [label="Token Dispatch L9 SP1 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep8_pp2 [style=dashed]
	layer_9_expert_sp1_ep8_tp0_pp2 [label="Expert L9 SP1 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep8_pp2 -> layer_9_expert_sp1_ep8_tp0_pp2
	layer_9_expert_out_sp1_ep8_tp0_pp2 [label="Expert Out L9 SP1 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep8_tp0_pp2 -> layer_9_expert_out_sp1_ep8_tp0_pp2
	layer_9_expert_sp1_ep8_tp1_pp2 [label="Expert L9 SP1 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep8_pp2 -> layer_9_expert_sp1_ep8_tp1_pp2
	layer_9_expert_out_sp1_ep8_tp1_pp2 [label="Expert Out L9 SP1 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep8_tp1_pp2 -> layer_9_expert_out_sp1_ep8_tp1_pp2
	layer_9_expert_sp1_ep8_tp2_pp2 [label="Expert L9 SP1 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep8_pp2 -> layer_9_expert_sp1_ep8_tp2_pp2
	layer_9_expert_out_sp1_ep8_tp2_pp2 [label="Expert Out L9 SP1 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep8_tp2_pp2 -> layer_9_expert_out_sp1_ep8_tp2_pp2
	layer_9_expert_sp1_ep8_tp3_pp2 [label="Expert L9 SP1 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep8_pp2 -> layer_9_expert_sp1_ep8_tp3_pp2
	layer_9_expert_out_sp1_ep8_tp3_pp2 [label="Expert Out L9 SP1 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep8_tp3_pp2 -> layer_9_expert_out_sp1_ep8_tp3_pp2
	layer_9_expert_ar_sp1_ep8_pp2 [label="Expert All-Reduce L9 SP1 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep8_tp0_pp2 -> layer_9_expert_ar_sp1_ep8_pp2
	layer_9_expert_out_sp1_ep8_tp1_pp2 -> layer_9_expert_ar_sp1_ep8_pp2
	layer_9_expert_out_sp1_ep8_tp2_pp2 -> layer_9_expert_ar_sp1_ep8_pp2
	layer_9_expert_out_sp1_ep8_tp3_pp2 -> layer_9_expert_ar_sp1_ep8_pp2
	layer_9_combine_sp1_ep8_pp2 [label="Token Combine L9 SP1 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep8_pp2 -> layer_9_combine_sp1_ep8_pp2
	layer_9_dispatch_sp1_ep9_pp2 [label="Token Dispatch L9 SP1 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep9_pp2 [style=dashed]
	layer_9_expert_sp1_ep9_tp0_pp2 [label="Expert L9 SP1 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep9_pp2 -> layer_9_expert_sp1_ep9_tp0_pp2
	layer_9_expert_out_sp1_ep9_tp0_pp2 [label="Expert Out L9 SP1 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep9_tp0_pp2 -> layer_9_expert_out_sp1_ep9_tp0_pp2
	layer_9_expert_sp1_ep9_tp1_pp2 [label="Expert L9 SP1 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep9_pp2 -> layer_9_expert_sp1_ep9_tp1_pp2
	layer_9_expert_out_sp1_ep9_tp1_pp2 [label="Expert Out L9 SP1 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep9_tp1_pp2 -> layer_9_expert_out_sp1_ep9_tp1_pp2
	layer_9_expert_sp1_ep9_tp2_pp2 [label="Expert L9 SP1 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep9_pp2 -> layer_9_expert_sp1_ep9_tp2_pp2
	layer_9_expert_out_sp1_ep9_tp2_pp2 [label="Expert Out L9 SP1 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep9_tp2_pp2 -> layer_9_expert_out_sp1_ep9_tp2_pp2
	layer_9_expert_sp1_ep9_tp3_pp2 [label="Expert L9 SP1 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep9_pp2 -> layer_9_expert_sp1_ep9_tp3_pp2
	layer_9_expert_out_sp1_ep9_tp3_pp2 [label="Expert Out L9 SP1 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep9_tp3_pp2 -> layer_9_expert_out_sp1_ep9_tp3_pp2
	layer_9_expert_ar_sp1_ep9_pp2 [label="Expert All-Reduce L9 SP1 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep9_tp0_pp2 -> layer_9_expert_ar_sp1_ep9_pp2
	layer_9_expert_out_sp1_ep9_tp1_pp2 -> layer_9_expert_ar_sp1_ep9_pp2
	layer_9_expert_out_sp1_ep9_tp2_pp2 -> layer_9_expert_ar_sp1_ep9_pp2
	layer_9_expert_out_sp1_ep9_tp3_pp2 -> layer_9_expert_ar_sp1_ep9_pp2
	layer_9_combine_sp1_ep9_pp2 [label="Token Combine L9 SP1 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep9_pp2 -> layer_9_combine_sp1_ep9_pp2
	layer_9_dispatch_sp1_ep10_pp2 [label="Token Dispatch L9 SP1 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep10_pp2 [style=dashed]
	layer_9_expert_sp1_ep10_tp0_pp2 [label="Expert L9 SP1 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep10_pp2 -> layer_9_expert_sp1_ep10_tp0_pp2
	layer_9_expert_out_sp1_ep10_tp0_pp2 [label="Expert Out L9 SP1 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep10_tp0_pp2 -> layer_9_expert_out_sp1_ep10_tp0_pp2
	layer_9_expert_sp1_ep10_tp1_pp2 [label="Expert L9 SP1 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep10_pp2 -> layer_9_expert_sp1_ep10_tp1_pp2
	layer_9_expert_out_sp1_ep10_tp1_pp2 [label="Expert Out L9 SP1 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep10_tp1_pp2 -> layer_9_expert_out_sp1_ep10_tp1_pp2
	layer_9_expert_sp1_ep10_tp2_pp2 [label="Expert L9 SP1 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep10_pp2 -> layer_9_expert_sp1_ep10_tp2_pp2
	layer_9_expert_out_sp1_ep10_tp2_pp2 [label="Expert Out L9 SP1 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep10_tp2_pp2 -> layer_9_expert_out_sp1_ep10_tp2_pp2
	layer_9_expert_sp1_ep10_tp3_pp2 [label="Expert L9 SP1 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep10_pp2 -> layer_9_expert_sp1_ep10_tp3_pp2
	layer_9_expert_out_sp1_ep10_tp3_pp2 [label="Expert Out L9 SP1 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep10_tp3_pp2 -> layer_9_expert_out_sp1_ep10_tp3_pp2
	layer_9_expert_ar_sp1_ep10_pp2 [label="Expert All-Reduce L9 SP1 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep10_tp0_pp2 -> layer_9_expert_ar_sp1_ep10_pp2
	layer_9_expert_out_sp1_ep10_tp1_pp2 -> layer_9_expert_ar_sp1_ep10_pp2
	layer_9_expert_out_sp1_ep10_tp2_pp2 -> layer_9_expert_ar_sp1_ep10_pp2
	layer_9_expert_out_sp1_ep10_tp3_pp2 -> layer_9_expert_ar_sp1_ep10_pp2
	layer_9_combine_sp1_ep10_pp2 [label="Token Combine L9 SP1 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep10_pp2 -> layer_9_combine_sp1_ep10_pp2
	layer_9_dispatch_sp1_ep11_pp2 [label="Token Dispatch L9 SP1 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep11_pp2 [style=dashed]
	layer_9_expert_sp1_ep11_tp0_pp2 [label="Expert L9 SP1 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep11_pp2 -> layer_9_expert_sp1_ep11_tp0_pp2
	layer_9_expert_out_sp1_ep11_tp0_pp2 [label="Expert Out L9 SP1 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep11_tp0_pp2 -> layer_9_expert_out_sp1_ep11_tp0_pp2
	layer_9_expert_sp1_ep11_tp1_pp2 [label="Expert L9 SP1 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep11_pp2 -> layer_9_expert_sp1_ep11_tp1_pp2
	layer_9_expert_out_sp1_ep11_tp1_pp2 [label="Expert Out L9 SP1 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep11_tp1_pp2 -> layer_9_expert_out_sp1_ep11_tp1_pp2
	layer_9_expert_sp1_ep11_tp2_pp2 [label="Expert L9 SP1 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep11_pp2 -> layer_9_expert_sp1_ep11_tp2_pp2
	layer_9_expert_out_sp1_ep11_tp2_pp2 [label="Expert Out L9 SP1 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep11_tp2_pp2 -> layer_9_expert_out_sp1_ep11_tp2_pp2
	layer_9_expert_sp1_ep11_tp3_pp2 [label="Expert L9 SP1 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep11_pp2 -> layer_9_expert_sp1_ep11_tp3_pp2
	layer_9_expert_out_sp1_ep11_tp3_pp2 [label="Expert Out L9 SP1 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep11_tp3_pp2 -> layer_9_expert_out_sp1_ep11_tp3_pp2
	layer_9_expert_ar_sp1_ep11_pp2 [label="Expert All-Reduce L9 SP1 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep11_tp0_pp2 -> layer_9_expert_ar_sp1_ep11_pp2
	layer_9_expert_out_sp1_ep11_tp1_pp2 -> layer_9_expert_ar_sp1_ep11_pp2
	layer_9_expert_out_sp1_ep11_tp2_pp2 -> layer_9_expert_ar_sp1_ep11_pp2
	layer_9_expert_out_sp1_ep11_tp3_pp2 -> layer_9_expert_ar_sp1_ep11_pp2
	layer_9_combine_sp1_ep11_pp2 [label="Token Combine L9 SP1 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep11_pp2 -> layer_9_combine_sp1_ep11_pp2
	layer_9_dispatch_sp1_ep12_pp2 [label="Token Dispatch L9 SP1 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep12_pp2 [style=dashed]
	layer_9_expert_sp1_ep12_tp0_pp2 [label="Expert L9 SP1 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep12_pp2 -> layer_9_expert_sp1_ep12_tp0_pp2
	layer_9_expert_out_sp1_ep12_tp0_pp2 [label="Expert Out L9 SP1 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep12_tp0_pp2 -> layer_9_expert_out_sp1_ep12_tp0_pp2
	layer_9_expert_sp1_ep12_tp1_pp2 [label="Expert L9 SP1 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep12_pp2 -> layer_9_expert_sp1_ep12_tp1_pp2
	layer_9_expert_out_sp1_ep12_tp1_pp2 [label="Expert Out L9 SP1 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep12_tp1_pp2 -> layer_9_expert_out_sp1_ep12_tp1_pp2
	layer_9_expert_sp1_ep12_tp2_pp2 [label="Expert L9 SP1 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep12_pp2 -> layer_9_expert_sp1_ep12_tp2_pp2
	layer_9_expert_out_sp1_ep12_tp2_pp2 [label="Expert Out L9 SP1 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep12_tp2_pp2 -> layer_9_expert_out_sp1_ep12_tp2_pp2
	layer_9_expert_sp1_ep12_tp3_pp2 [label="Expert L9 SP1 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep12_pp2 -> layer_9_expert_sp1_ep12_tp3_pp2
	layer_9_expert_out_sp1_ep12_tp3_pp2 [label="Expert Out L9 SP1 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep12_tp3_pp2 -> layer_9_expert_out_sp1_ep12_tp3_pp2
	layer_9_expert_ar_sp1_ep12_pp2 [label="Expert All-Reduce L9 SP1 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep12_tp0_pp2 -> layer_9_expert_ar_sp1_ep12_pp2
	layer_9_expert_out_sp1_ep12_tp1_pp2 -> layer_9_expert_ar_sp1_ep12_pp2
	layer_9_expert_out_sp1_ep12_tp2_pp2 -> layer_9_expert_ar_sp1_ep12_pp2
	layer_9_expert_out_sp1_ep12_tp3_pp2 -> layer_9_expert_ar_sp1_ep12_pp2
	layer_9_combine_sp1_ep12_pp2 [label="Token Combine L9 SP1 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep12_pp2 -> layer_9_combine_sp1_ep12_pp2
	layer_9_dispatch_sp1_ep13_pp2 [label="Token Dispatch L9 SP1 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep13_pp2 [style=dashed]
	layer_9_expert_sp1_ep13_tp0_pp2 [label="Expert L9 SP1 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep13_pp2 -> layer_9_expert_sp1_ep13_tp0_pp2
	layer_9_expert_out_sp1_ep13_tp0_pp2 [label="Expert Out L9 SP1 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep13_tp0_pp2 -> layer_9_expert_out_sp1_ep13_tp0_pp2
	layer_9_expert_sp1_ep13_tp1_pp2 [label="Expert L9 SP1 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep13_pp2 -> layer_9_expert_sp1_ep13_tp1_pp2
	layer_9_expert_out_sp1_ep13_tp1_pp2 [label="Expert Out L9 SP1 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep13_tp1_pp2 -> layer_9_expert_out_sp1_ep13_tp1_pp2
	layer_9_expert_sp1_ep13_tp2_pp2 [label="Expert L9 SP1 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep13_pp2 -> layer_9_expert_sp1_ep13_tp2_pp2
	layer_9_expert_out_sp1_ep13_tp2_pp2 [label="Expert Out L9 SP1 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep13_tp2_pp2 -> layer_9_expert_out_sp1_ep13_tp2_pp2
	layer_9_expert_sp1_ep13_tp3_pp2 [label="Expert L9 SP1 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep13_pp2 -> layer_9_expert_sp1_ep13_tp3_pp2
	layer_9_expert_out_sp1_ep13_tp3_pp2 [label="Expert Out L9 SP1 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep13_tp3_pp2 -> layer_9_expert_out_sp1_ep13_tp3_pp2
	layer_9_expert_ar_sp1_ep13_pp2 [label="Expert All-Reduce L9 SP1 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep13_tp0_pp2 -> layer_9_expert_ar_sp1_ep13_pp2
	layer_9_expert_out_sp1_ep13_tp1_pp2 -> layer_9_expert_ar_sp1_ep13_pp2
	layer_9_expert_out_sp1_ep13_tp2_pp2 -> layer_9_expert_ar_sp1_ep13_pp2
	layer_9_expert_out_sp1_ep13_tp3_pp2 -> layer_9_expert_ar_sp1_ep13_pp2
	layer_9_combine_sp1_ep13_pp2 [label="Token Combine L9 SP1 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep13_pp2 -> layer_9_combine_sp1_ep13_pp2
	layer_9_dispatch_sp1_ep14_pp2 [label="Token Dispatch L9 SP1 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep14_pp2 [style=dashed]
	layer_9_expert_sp1_ep14_tp0_pp2 [label="Expert L9 SP1 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep14_pp2 -> layer_9_expert_sp1_ep14_tp0_pp2
	layer_9_expert_out_sp1_ep14_tp0_pp2 [label="Expert Out L9 SP1 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep14_tp0_pp2 -> layer_9_expert_out_sp1_ep14_tp0_pp2
	layer_9_expert_sp1_ep14_tp1_pp2 [label="Expert L9 SP1 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep14_pp2 -> layer_9_expert_sp1_ep14_tp1_pp2
	layer_9_expert_out_sp1_ep14_tp1_pp2 [label="Expert Out L9 SP1 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep14_tp1_pp2 -> layer_9_expert_out_sp1_ep14_tp1_pp2
	layer_9_expert_sp1_ep14_tp2_pp2 [label="Expert L9 SP1 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep14_pp2 -> layer_9_expert_sp1_ep14_tp2_pp2
	layer_9_expert_out_sp1_ep14_tp2_pp2 [label="Expert Out L9 SP1 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep14_tp2_pp2 -> layer_9_expert_out_sp1_ep14_tp2_pp2
	layer_9_expert_sp1_ep14_tp3_pp2 [label="Expert L9 SP1 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep14_pp2 -> layer_9_expert_sp1_ep14_tp3_pp2
	layer_9_expert_out_sp1_ep14_tp3_pp2 [label="Expert Out L9 SP1 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep14_tp3_pp2 -> layer_9_expert_out_sp1_ep14_tp3_pp2
	layer_9_expert_ar_sp1_ep14_pp2 [label="Expert All-Reduce L9 SP1 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep14_tp0_pp2 -> layer_9_expert_ar_sp1_ep14_pp2
	layer_9_expert_out_sp1_ep14_tp1_pp2 -> layer_9_expert_ar_sp1_ep14_pp2
	layer_9_expert_out_sp1_ep14_tp2_pp2 -> layer_9_expert_ar_sp1_ep14_pp2
	layer_9_expert_out_sp1_ep14_tp3_pp2 -> layer_9_expert_ar_sp1_ep14_pp2
	layer_9_combine_sp1_ep14_pp2 [label="Token Combine L9 SP1 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep14_pp2 -> layer_9_combine_sp1_ep14_pp2
	layer_9_dispatch_sp1_ep15_pp2 [label="Token Dispatch L9 SP1 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp1_pp2 -> layer_9_dispatch_sp1_ep15_pp2 [style=dashed]
	layer_9_expert_sp1_ep15_tp0_pp2 [label="Expert L9 SP1 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep15_pp2 -> layer_9_expert_sp1_ep15_tp0_pp2
	layer_9_expert_out_sp1_ep15_tp0_pp2 [label="Expert Out L9 SP1 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep15_tp0_pp2 -> layer_9_expert_out_sp1_ep15_tp0_pp2
	layer_9_expert_sp1_ep15_tp1_pp2 [label="Expert L9 SP1 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep15_pp2 -> layer_9_expert_sp1_ep15_tp1_pp2
	layer_9_expert_out_sp1_ep15_tp1_pp2 [label="Expert Out L9 SP1 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep15_tp1_pp2 -> layer_9_expert_out_sp1_ep15_tp1_pp2
	layer_9_expert_sp1_ep15_tp2_pp2 [label="Expert L9 SP1 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep15_pp2 -> layer_9_expert_sp1_ep15_tp2_pp2
	layer_9_expert_out_sp1_ep15_tp2_pp2 [label="Expert Out L9 SP1 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep15_tp2_pp2 -> layer_9_expert_out_sp1_ep15_tp2_pp2
	layer_9_expert_sp1_ep15_tp3_pp2 [label="Expert L9 SP1 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp1_ep15_pp2 -> layer_9_expert_sp1_ep15_tp3_pp2
	layer_9_expert_out_sp1_ep15_tp3_pp2 [label="Expert Out L9 SP1 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp1_ep15_tp3_pp2 -> layer_9_expert_out_sp1_ep15_tp3_pp2
	layer_9_expert_ar_sp1_ep15_pp2 [label="Expert All-Reduce L9 SP1 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp1_ep15_tp0_pp2 -> layer_9_expert_ar_sp1_ep15_pp2
	layer_9_expert_out_sp1_ep15_tp1_pp2 -> layer_9_expert_ar_sp1_ep15_pp2
	layer_9_expert_out_sp1_ep15_tp2_pp2 -> layer_9_expert_ar_sp1_ep15_pp2
	layer_9_expert_out_sp1_ep15_tp3_pp2 -> layer_9_expert_ar_sp1_ep15_pp2
	layer_9_combine_sp1_ep15_pp2 [label="Token Combine L9 SP1 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp1_ep15_pp2 -> layer_9_combine_sp1_ep15_pp2
	layer_9_moe_all2all_sp1_pp2 [label="MoE All-to-All L9 SP1\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_9_combine_sp1_ep0_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep1_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep2_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep3_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep4_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep5_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep6_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep7_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep8_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep9_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep10_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep11_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep12_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep13_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep14_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_combine_sp1_ep15_pp2 -> layer_9_moe_all2all_sp1_pp2
	layer_9_mlp_out_sp1_pp2 [label="MoE Output L9 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_moe_all2all_sp1_pp2 -> layer_9_mlp_out_sp1_pp2
	layer_9_mlp_res_sp1_pp2 [label="MLP Residual L9 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_mlp_out_sp1_pp2 -> layer_9_mlp_res_sp1_pp2
	layer_9_attn_res_sp1_pp2 -> layer_9_mlp_res_sp1_pp2 [style=dashed]
	layer_9_norm_sp2_pp2 [label="LayerNorm L9 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_mlp_out_sp2_pp2 -> layer_9_norm_sp2_pp2
	layer_9_qkv_sp2_tp0_pp2 [label="QKV Proj L9 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp2_pp2 -> layer_9_qkv_sp2_tp0_pp2
	layer_9_attn_sp2_tp0_pp2 [label="Attention L9 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp2_tp0_pp2 -> layer_9_attn_sp2_tp0_pp2
	layer_9_attn_out_sp2_tp0_pp2 [label="Attn Out Proj L9 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp2_tp0_pp2 -> layer_9_attn_out_sp2_tp0_pp2
	layer_9_qkv_sp2_tp1_pp2 [label="QKV Proj L9 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp2_pp2 -> layer_9_qkv_sp2_tp1_pp2
	layer_9_attn_sp2_tp1_pp2 [label="Attention L9 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp2_tp1_pp2 -> layer_9_attn_sp2_tp1_pp2
	layer_9_attn_out_sp2_tp1_pp2 [label="Attn Out Proj L9 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp2_tp1_pp2 -> layer_9_attn_out_sp2_tp1_pp2
	layer_9_qkv_sp2_tp2_pp2 [label="QKV Proj L9 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp2_pp2 -> layer_9_qkv_sp2_tp2_pp2
	layer_9_attn_sp2_tp2_pp2 [label="Attention L9 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp2_tp2_pp2 -> layer_9_attn_sp2_tp2_pp2
	layer_9_attn_out_sp2_tp2_pp2 [label="Attn Out Proj L9 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp2_tp2_pp2 -> layer_9_attn_out_sp2_tp2_pp2
	layer_9_qkv_sp2_tp3_pp2 [label="QKV Proj L9 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp2_pp2 -> layer_9_qkv_sp2_tp3_pp2
	layer_9_attn_sp2_tp3_pp2 [label="Attention L9 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp2_tp3_pp2 -> layer_9_attn_sp2_tp3_pp2
	layer_9_attn_out_sp2_tp3_pp2 [label="Attn Out Proj L9 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp2_tp3_pp2 -> layer_9_attn_out_sp2_tp3_pp2
	layer_9_attn_ar_sp2_pp2 [label="Attention All-Reduce L9 SP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_attn_out_sp2_tp0_pp2 -> layer_9_attn_ar_sp2_pp2
	layer_9_attn_out_sp2_tp1_pp2 -> layer_9_attn_ar_sp2_pp2
	layer_9_attn_out_sp2_tp2_pp2 -> layer_9_attn_ar_sp2_pp2
	layer_9_attn_out_sp2_tp3_pp2 -> layer_9_attn_ar_sp2_pp2
	layer_9_attn_res_sp2_pp2 [label="Attention Residual L9 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_attn_ar_sp2_pp2 -> layer_9_attn_res_sp2_pp2
	layer_9_norm_sp2_pp2 -> layer_9_attn_res_sp2_pp2 [style=dashed]
	layer_9_post_norm_sp2_pp2 [label="Post-Attn Norm L9 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_attn_res_sp2_pp2 -> layer_9_post_norm_sp2_pp2
	layer_9_router_sp2_pp2 [label="MoE Router L9 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_9_post_norm_sp2_pp2 -> layer_9_router_sp2_pp2
	layer_9_dispatch_sp2_ep0_pp2 [label="Token Dispatch L9 SP2 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep0_pp2 [style=dashed]
	layer_9_expert_sp2_ep0_tp0_pp2 [label="Expert L9 SP2 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep0_pp2 -> layer_9_expert_sp2_ep0_tp0_pp2
	layer_9_expert_out_sp2_ep0_tp0_pp2 [label="Expert Out L9 SP2 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep0_tp0_pp2 -> layer_9_expert_out_sp2_ep0_tp0_pp2
	layer_9_expert_sp2_ep0_tp1_pp2 [label="Expert L9 SP2 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep0_pp2 -> layer_9_expert_sp2_ep0_tp1_pp2
	layer_9_expert_out_sp2_ep0_tp1_pp2 [label="Expert Out L9 SP2 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep0_tp1_pp2 -> layer_9_expert_out_sp2_ep0_tp1_pp2
	layer_9_expert_sp2_ep0_tp2_pp2 [label="Expert L9 SP2 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep0_pp2 -> layer_9_expert_sp2_ep0_tp2_pp2
	layer_9_expert_out_sp2_ep0_tp2_pp2 [label="Expert Out L9 SP2 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep0_tp2_pp2 -> layer_9_expert_out_sp2_ep0_tp2_pp2
	layer_9_expert_sp2_ep0_tp3_pp2 [label="Expert L9 SP2 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep0_pp2 -> layer_9_expert_sp2_ep0_tp3_pp2
	layer_9_expert_out_sp2_ep0_tp3_pp2 [label="Expert Out L9 SP2 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep0_tp3_pp2 -> layer_9_expert_out_sp2_ep0_tp3_pp2
	layer_9_expert_ar_sp2_ep0_pp2 [label="Expert All-Reduce L9 SP2 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep0_tp0_pp2 -> layer_9_expert_ar_sp2_ep0_pp2
	layer_9_expert_out_sp2_ep0_tp1_pp2 -> layer_9_expert_ar_sp2_ep0_pp2
	layer_9_expert_out_sp2_ep0_tp2_pp2 -> layer_9_expert_ar_sp2_ep0_pp2
	layer_9_expert_out_sp2_ep0_tp3_pp2 -> layer_9_expert_ar_sp2_ep0_pp2
	layer_9_combine_sp2_ep0_pp2 [label="Token Combine L9 SP2 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep0_pp2 -> layer_9_combine_sp2_ep0_pp2
	layer_9_dispatch_sp2_ep1_pp2 [label="Token Dispatch L9 SP2 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep1_pp2 [style=dashed]
	layer_9_expert_sp2_ep1_tp0_pp2 [label="Expert L9 SP2 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep1_pp2 -> layer_9_expert_sp2_ep1_tp0_pp2
	layer_9_expert_out_sp2_ep1_tp0_pp2 [label="Expert Out L9 SP2 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep1_tp0_pp2 -> layer_9_expert_out_sp2_ep1_tp0_pp2
	layer_9_expert_sp2_ep1_tp1_pp2 [label="Expert L9 SP2 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep1_pp2 -> layer_9_expert_sp2_ep1_tp1_pp2
	layer_9_expert_out_sp2_ep1_tp1_pp2 [label="Expert Out L9 SP2 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep1_tp1_pp2 -> layer_9_expert_out_sp2_ep1_tp1_pp2
	layer_9_expert_sp2_ep1_tp2_pp2 [label="Expert L9 SP2 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep1_pp2 -> layer_9_expert_sp2_ep1_tp2_pp2
	layer_9_expert_out_sp2_ep1_tp2_pp2 [label="Expert Out L9 SP2 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep1_tp2_pp2 -> layer_9_expert_out_sp2_ep1_tp2_pp2
	layer_9_expert_sp2_ep1_tp3_pp2 [label="Expert L9 SP2 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep1_pp2 -> layer_9_expert_sp2_ep1_tp3_pp2
	layer_9_expert_out_sp2_ep1_tp3_pp2 [label="Expert Out L9 SP2 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep1_tp3_pp2 -> layer_9_expert_out_sp2_ep1_tp3_pp2
	layer_9_expert_ar_sp2_ep1_pp2 [label="Expert All-Reduce L9 SP2 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep1_tp0_pp2 -> layer_9_expert_ar_sp2_ep1_pp2
	layer_9_expert_out_sp2_ep1_tp1_pp2 -> layer_9_expert_ar_sp2_ep1_pp2
	layer_9_expert_out_sp2_ep1_tp2_pp2 -> layer_9_expert_ar_sp2_ep1_pp2
	layer_9_expert_out_sp2_ep1_tp3_pp2 -> layer_9_expert_ar_sp2_ep1_pp2
	layer_9_combine_sp2_ep1_pp2 [label="Token Combine L9 SP2 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep1_pp2 -> layer_9_combine_sp2_ep1_pp2
	layer_9_dispatch_sp2_ep2_pp2 [label="Token Dispatch L9 SP2 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep2_pp2 [style=dashed]
	layer_9_expert_sp2_ep2_tp0_pp2 [label="Expert L9 SP2 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep2_pp2 -> layer_9_expert_sp2_ep2_tp0_pp2
	layer_9_expert_out_sp2_ep2_tp0_pp2 [label="Expert Out L9 SP2 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep2_tp0_pp2 -> layer_9_expert_out_sp2_ep2_tp0_pp2
	layer_9_expert_sp2_ep2_tp1_pp2 [label="Expert L9 SP2 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep2_pp2 -> layer_9_expert_sp2_ep2_tp1_pp2
	layer_9_expert_out_sp2_ep2_tp1_pp2 [label="Expert Out L9 SP2 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep2_tp1_pp2 -> layer_9_expert_out_sp2_ep2_tp1_pp2
	layer_9_expert_sp2_ep2_tp2_pp2 [label="Expert L9 SP2 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep2_pp2 -> layer_9_expert_sp2_ep2_tp2_pp2
	layer_9_expert_out_sp2_ep2_tp2_pp2 [label="Expert Out L9 SP2 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep2_tp2_pp2 -> layer_9_expert_out_sp2_ep2_tp2_pp2
	layer_9_expert_sp2_ep2_tp3_pp2 [label="Expert L9 SP2 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep2_pp2 -> layer_9_expert_sp2_ep2_tp3_pp2
	layer_9_expert_out_sp2_ep2_tp3_pp2 [label="Expert Out L9 SP2 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep2_tp3_pp2 -> layer_9_expert_out_sp2_ep2_tp3_pp2
	layer_9_expert_ar_sp2_ep2_pp2 [label="Expert All-Reduce L9 SP2 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep2_tp0_pp2 -> layer_9_expert_ar_sp2_ep2_pp2
	layer_9_expert_out_sp2_ep2_tp1_pp2 -> layer_9_expert_ar_sp2_ep2_pp2
	layer_9_expert_out_sp2_ep2_tp2_pp2 -> layer_9_expert_ar_sp2_ep2_pp2
	layer_9_expert_out_sp2_ep2_tp3_pp2 -> layer_9_expert_ar_sp2_ep2_pp2
	layer_9_combine_sp2_ep2_pp2 [label="Token Combine L9 SP2 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep2_pp2 -> layer_9_combine_sp2_ep2_pp2
	layer_9_dispatch_sp2_ep3_pp2 [label="Token Dispatch L9 SP2 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep3_pp2 [style=dashed]
	layer_9_expert_sp2_ep3_tp0_pp2 [label="Expert L9 SP2 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep3_pp2 -> layer_9_expert_sp2_ep3_tp0_pp2
	layer_9_expert_out_sp2_ep3_tp0_pp2 [label="Expert Out L9 SP2 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep3_tp0_pp2 -> layer_9_expert_out_sp2_ep3_tp0_pp2
	layer_9_expert_sp2_ep3_tp1_pp2 [label="Expert L9 SP2 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep3_pp2 -> layer_9_expert_sp2_ep3_tp1_pp2
	layer_9_expert_out_sp2_ep3_tp1_pp2 [label="Expert Out L9 SP2 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep3_tp1_pp2 -> layer_9_expert_out_sp2_ep3_tp1_pp2
	layer_9_expert_sp2_ep3_tp2_pp2 [label="Expert L9 SP2 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep3_pp2 -> layer_9_expert_sp2_ep3_tp2_pp2
	layer_9_expert_out_sp2_ep3_tp2_pp2 [label="Expert Out L9 SP2 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep3_tp2_pp2 -> layer_9_expert_out_sp2_ep3_tp2_pp2
	layer_9_expert_sp2_ep3_tp3_pp2 [label="Expert L9 SP2 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep3_pp2 -> layer_9_expert_sp2_ep3_tp3_pp2
	layer_9_expert_out_sp2_ep3_tp3_pp2 [label="Expert Out L9 SP2 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep3_tp3_pp2 -> layer_9_expert_out_sp2_ep3_tp3_pp2
	layer_9_expert_ar_sp2_ep3_pp2 [label="Expert All-Reduce L9 SP2 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep3_tp0_pp2 -> layer_9_expert_ar_sp2_ep3_pp2
	layer_9_expert_out_sp2_ep3_tp1_pp2 -> layer_9_expert_ar_sp2_ep3_pp2
	layer_9_expert_out_sp2_ep3_tp2_pp2 -> layer_9_expert_ar_sp2_ep3_pp2
	layer_9_expert_out_sp2_ep3_tp3_pp2 -> layer_9_expert_ar_sp2_ep3_pp2
	layer_9_combine_sp2_ep3_pp2 [label="Token Combine L9 SP2 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep3_pp2 -> layer_9_combine_sp2_ep3_pp2
	layer_9_dispatch_sp2_ep4_pp2 [label="Token Dispatch L9 SP2 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep4_pp2 [style=dashed]
	layer_9_expert_sp2_ep4_tp0_pp2 [label="Expert L9 SP2 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep4_pp2 -> layer_9_expert_sp2_ep4_tp0_pp2
	layer_9_expert_out_sp2_ep4_tp0_pp2 [label="Expert Out L9 SP2 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep4_tp0_pp2 -> layer_9_expert_out_sp2_ep4_tp0_pp2
	layer_9_expert_sp2_ep4_tp1_pp2 [label="Expert L9 SP2 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep4_pp2 -> layer_9_expert_sp2_ep4_tp1_pp2
	layer_9_expert_out_sp2_ep4_tp1_pp2 [label="Expert Out L9 SP2 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep4_tp1_pp2 -> layer_9_expert_out_sp2_ep4_tp1_pp2
	layer_9_expert_sp2_ep4_tp2_pp2 [label="Expert L9 SP2 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep4_pp2 -> layer_9_expert_sp2_ep4_tp2_pp2
	layer_9_expert_out_sp2_ep4_tp2_pp2 [label="Expert Out L9 SP2 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep4_tp2_pp2 -> layer_9_expert_out_sp2_ep4_tp2_pp2
	layer_9_expert_sp2_ep4_tp3_pp2 [label="Expert L9 SP2 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep4_pp2 -> layer_9_expert_sp2_ep4_tp3_pp2
	layer_9_expert_out_sp2_ep4_tp3_pp2 [label="Expert Out L9 SP2 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep4_tp3_pp2 -> layer_9_expert_out_sp2_ep4_tp3_pp2
	layer_9_expert_ar_sp2_ep4_pp2 [label="Expert All-Reduce L9 SP2 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep4_tp0_pp2 -> layer_9_expert_ar_sp2_ep4_pp2
	layer_9_expert_out_sp2_ep4_tp1_pp2 -> layer_9_expert_ar_sp2_ep4_pp2
	layer_9_expert_out_sp2_ep4_tp2_pp2 -> layer_9_expert_ar_sp2_ep4_pp2
	layer_9_expert_out_sp2_ep4_tp3_pp2 -> layer_9_expert_ar_sp2_ep4_pp2
	layer_9_combine_sp2_ep4_pp2 [label="Token Combine L9 SP2 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep4_pp2 -> layer_9_combine_sp2_ep4_pp2
	layer_9_dispatch_sp2_ep5_pp2 [label="Token Dispatch L9 SP2 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep5_pp2 [style=dashed]
	layer_9_expert_sp2_ep5_tp0_pp2 [label="Expert L9 SP2 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep5_pp2 -> layer_9_expert_sp2_ep5_tp0_pp2
	layer_9_expert_out_sp2_ep5_tp0_pp2 [label="Expert Out L9 SP2 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep5_tp0_pp2 -> layer_9_expert_out_sp2_ep5_tp0_pp2
	layer_9_expert_sp2_ep5_tp1_pp2 [label="Expert L9 SP2 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep5_pp2 -> layer_9_expert_sp2_ep5_tp1_pp2
	layer_9_expert_out_sp2_ep5_tp1_pp2 [label="Expert Out L9 SP2 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep5_tp1_pp2 -> layer_9_expert_out_sp2_ep5_tp1_pp2
	layer_9_expert_sp2_ep5_tp2_pp2 [label="Expert L9 SP2 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep5_pp2 -> layer_9_expert_sp2_ep5_tp2_pp2
	layer_9_expert_out_sp2_ep5_tp2_pp2 [label="Expert Out L9 SP2 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep5_tp2_pp2 -> layer_9_expert_out_sp2_ep5_tp2_pp2
	layer_9_expert_sp2_ep5_tp3_pp2 [label="Expert L9 SP2 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep5_pp2 -> layer_9_expert_sp2_ep5_tp3_pp2
	layer_9_expert_out_sp2_ep5_tp3_pp2 [label="Expert Out L9 SP2 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep5_tp3_pp2 -> layer_9_expert_out_sp2_ep5_tp3_pp2
	layer_9_expert_ar_sp2_ep5_pp2 [label="Expert All-Reduce L9 SP2 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep5_tp0_pp2 -> layer_9_expert_ar_sp2_ep5_pp2
	layer_9_expert_out_sp2_ep5_tp1_pp2 -> layer_9_expert_ar_sp2_ep5_pp2
	layer_9_expert_out_sp2_ep5_tp2_pp2 -> layer_9_expert_ar_sp2_ep5_pp2
	layer_9_expert_out_sp2_ep5_tp3_pp2 -> layer_9_expert_ar_sp2_ep5_pp2
	layer_9_combine_sp2_ep5_pp2 [label="Token Combine L9 SP2 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep5_pp2 -> layer_9_combine_sp2_ep5_pp2
	layer_9_dispatch_sp2_ep6_pp2 [label="Token Dispatch L9 SP2 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep6_pp2 [style=dashed]
	layer_9_expert_sp2_ep6_tp0_pp2 [label="Expert L9 SP2 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep6_pp2 -> layer_9_expert_sp2_ep6_tp0_pp2
	layer_9_expert_out_sp2_ep6_tp0_pp2 [label="Expert Out L9 SP2 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep6_tp0_pp2 -> layer_9_expert_out_sp2_ep6_tp0_pp2
	layer_9_expert_sp2_ep6_tp1_pp2 [label="Expert L9 SP2 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep6_pp2 -> layer_9_expert_sp2_ep6_tp1_pp2
	layer_9_expert_out_sp2_ep6_tp1_pp2 [label="Expert Out L9 SP2 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep6_tp1_pp2 -> layer_9_expert_out_sp2_ep6_tp1_pp2
	layer_9_expert_sp2_ep6_tp2_pp2 [label="Expert L9 SP2 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep6_pp2 -> layer_9_expert_sp2_ep6_tp2_pp2
	layer_9_expert_out_sp2_ep6_tp2_pp2 [label="Expert Out L9 SP2 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep6_tp2_pp2 -> layer_9_expert_out_sp2_ep6_tp2_pp2
	layer_9_expert_sp2_ep6_tp3_pp2 [label="Expert L9 SP2 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep6_pp2 -> layer_9_expert_sp2_ep6_tp3_pp2
	layer_9_expert_out_sp2_ep6_tp3_pp2 [label="Expert Out L9 SP2 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep6_tp3_pp2 -> layer_9_expert_out_sp2_ep6_tp3_pp2
	layer_9_expert_ar_sp2_ep6_pp2 [label="Expert All-Reduce L9 SP2 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep6_tp0_pp2 -> layer_9_expert_ar_sp2_ep6_pp2
	layer_9_expert_out_sp2_ep6_tp1_pp2 -> layer_9_expert_ar_sp2_ep6_pp2
	layer_9_expert_out_sp2_ep6_tp2_pp2 -> layer_9_expert_ar_sp2_ep6_pp2
	layer_9_expert_out_sp2_ep6_tp3_pp2 -> layer_9_expert_ar_sp2_ep6_pp2
	layer_9_combine_sp2_ep6_pp2 [label="Token Combine L9 SP2 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep6_pp2 -> layer_9_combine_sp2_ep6_pp2
	layer_9_dispatch_sp2_ep7_pp2 [label="Token Dispatch L9 SP2 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep7_pp2 [style=dashed]
	layer_9_expert_sp2_ep7_tp0_pp2 [label="Expert L9 SP2 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep7_pp2 -> layer_9_expert_sp2_ep7_tp0_pp2
	layer_9_expert_out_sp2_ep7_tp0_pp2 [label="Expert Out L9 SP2 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep7_tp0_pp2 -> layer_9_expert_out_sp2_ep7_tp0_pp2
	layer_9_expert_sp2_ep7_tp1_pp2 [label="Expert L9 SP2 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep7_pp2 -> layer_9_expert_sp2_ep7_tp1_pp2
	layer_9_expert_out_sp2_ep7_tp1_pp2 [label="Expert Out L9 SP2 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep7_tp1_pp2 -> layer_9_expert_out_sp2_ep7_tp1_pp2
	layer_9_expert_sp2_ep7_tp2_pp2 [label="Expert L9 SP2 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep7_pp2 -> layer_9_expert_sp2_ep7_tp2_pp2
	layer_9_expert_out_sp2_ep7_tp2_pp2 [label="Expert Out L9 SP2 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep7_tp2_pp2 -> layer_9_expert_out_sp2_ep7_tp2_pp2
	layer_9_expert_sp2_ep7_tp3_pp2 [label="Expert L9 SP2 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep7_pp2 -> layer_9_expert_sp2_ep7_tp3_pp2
	layer_9_expert_out_sp2_ep7_tp3_pp2 [label="Expert Out L9 SP2 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep7_tp3_pp2 -> layer_9_expert_out_sp2_ep7_tp3_pp2
	layer_9_expert_ar_sp2_ep7_pp2 [label="Expert All-Reduce L9 SP2 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep7_tp0_pp2 -> layer_9_expert_ar_sp2_ep7_pp2
	layer_9_expert_out_sp2_ep7_tp1_pp2 -> layer_9_expert_ar_sp2_ep7_pp2
	layer_9_expert_out_sp2_ep7_tp2_pp2 -> layer_9_expert_ar_sp2_ep7_pp2
	layer_9_expert_out_sp2_ep7_tp3_pp2 -> layer_9_expert_ar_sp2_ep7_pp2
	layer_9_combine_sp2_ep7_pp2 [label="Token Combine L9 SP2 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep7_pp2 -> layer_9_combine_sp2_ep7_pp2
	layer_9_dispatch_sp2_ep8_pp2 [label="Token Dispatch L9 SP2 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep8_pp2 [style=dashed]
	layer_9_expert_sp2_ep8_tp0_pp2 [label="Expert L9 SP2 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep8_pp2 -> layer_9_expert_sp2_ep8_tp0_pp2
	layer_9_expert_out_sp2_ep8_tp0_pp2 [label="Expert Out L9 SP2 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep8_tp0_pp2 -> layer_9_expert_out_sp2_ep8_tp0_pp2
	layer_9_expert_sp2_ep8_tp1_pp2 [label="Expert L9 SP2 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep8_pp2 -> layer_9_expert_sp2_ep8_tp1_pp2
	layer_9_expert_out_sp2_ep8_tp1_pp2 [label="Expert Out L9 SP2 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep8_tp1_pp2 -> layer_9_expert_out_sp2_ep8_tp1_pp2
	layer_9_expert_sp2_ep8_tp2_pp2 [label="Expert L9 SP2 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep8_pp2 -> layer_9_expert_sp2_ep8_tp2_pp2
	layer_9_expert_out_sp2_ep8_tp2_pp2 [label="Expert Out L9 SP2 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep8_tp2_pp2 -> layer_9_expert_out_sp2_ep8_tp2_pp2
	layer_9_expert_sp2_ep8_tp3_pp2 [label="Expert L9 SP2 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep8_pp2 -> layer_9_expert_sp2_ep8_tp3_pp2
	layer_9_expert_out_sp2_ep8_tp3_pp2 [label="Expert Out L9 SP2 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep8_tp3_pp2 -> layer_9_expert_out_sp2_ep8_tp3_pp2
	layer_9_expert_ar_sp2_ep8_pp2 [label="Expert All-Reduce L9 SP2 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep8_tp0_pp2 -> layer_9_expert_ar_sp2_ep8_pp2
	layer_9_expert_out_sp2_ep8_tp1_pp2 -> layer_9_expert_ar_sp2_ep8_pp2
	layer_9_expert_out_sp2_ep8_tp2_pp2 -> layer_9_expert_ar_sp2_ep8_pp2
	layer_9_expert_out_sp2_ep8_tp3_pp2 -> layer_9_expert_ar_sp2_ep8_pp2
	layer_9_combine_sp2_ep8_pp2 [label="Token Combine L9 SP2 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep8_pp2 -> layer_9_combine_sp2_ep8_pp2
	layer_9_dispatch_sp2_ep9_pp2 [label="Token Dispatch L9 SP2 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep9_pp2 [style=dashed]
	layer_9_expert_sp2_ep9_tp0_pp2 [label="Expert L9 SP2 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep9_pp2 -> layer_9_expert_sp2_ep9_tp0_pp2
	layer_9_expert_out_sp2_ep9_tp0_pp2 [label="Expert Out L9 SP2 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep9_tp0_pp2 -> layer_9_expert_out_sp2_ep9_tp0_pp2
	layer_9_expert_sp2_ep9_tp1_pp2 [label="Expert L9 SP2 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep9_pp2 -> layer_9_expert_sp2_ep9_tp1_pp2
	layer_9_expert_out_sp2_ep9_tp1_pp2 [label="Expert Out L9 SP2 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep9_tp1_pp2 -> layer_9_expert_out_sp2_ep9_tp1_pp2
	layer_9_expert_sp2_ep9_tp2_pp2 [label="Expert L9 SP2 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep9_pp2 -> layer_9_expert_sp2_ep9_tp2_pp2
	layer_9_expert_out_sp2_ep9_tp2_pp2 [label="Expert Out L9 SP2 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep9_tp2_pp2 -> layer_9_expert_out_sp2_ep9_tp2_pp2
	layer_9_expert_sp2_ep9_tp3_pp2 [label="Expert L9 SP2 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep9_pp2 -> layer_9_expert_sp2_ep9_tp3_pp2
	layer_9_expert_out_sp2_ep9_tp3_pp2 [label="Expert Out L9 SP2 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep9_tp3_pp2 -> layer_9_expert_out_sp2_ep9_tp3_pp2
	layer_9_expert_ar_sp2_ep9_pp2 [label="Expert All-Reduce L9 SP2 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep9_tp0_pp2 -> layer_9_expert_ar_sp2_ep9_pp2
	layer_9_expert_out_sp2_ep9_tp1_pp2 -> layer_9_expert_ar_sp2_ep9_pp2
	layer_9_expert_out_sp2_ep9_tp2_pp2 -> layer_9_expert_ar_sp2_ep9_pp2
	layer_9_expert_out_sp2_ep9_tp3_pp2 -> layer_9_expert_ar_sp2_ep9_pp2
	layer_9_combine_sp2_ep9_pp2 [label="Token Combine L9 SP2 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep9_pp2 -> layer_9_combine_sp2_ep9_pp2
	layer_9_dispatch_sp2_ep10_pp2 [label="Token Dispatch L9 SP2 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep10_pp2 [style=dashed]
	layer_9_expert_sp2_ep10_tp0_pp2 [label="Expert L9 SP2 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep10_pp2 -> layer_9_expert_sp2_ep10_tp0_pp2
	layer_9_expert_out_sp2_ep10_tp0_pp2 [label="Expert Out L9 SP2 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep10_tp0_pp2 -> layer_9_expert_out_sp2_ep10_tp0_pp2
	layer_9_expert_sp2_ep10_tp1_pp2 [label="Expert L9 SP2 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep10_pp2 -> layer_9_expert_sp2_ep10_tp1_pp2
	layer_9_expert_out_sp2_ep10_tp1_pp2 [label="Expert Out L9 SP2 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep10_tp1_pp2 -> layer_9_expert_out_sp2_ep10_tp1_pp2
	layer_9_expert_sp2_ep10_tp2_pp2 [label="Expert L9 SP2 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep10_pp2 -> layer_9_expert_sp2_ep10_tp2_pp2
	layer_9_expert_out_sp2_ep10_tp2_pp2 [label="Expert Out L9 SP2 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep10_tp2_pp2 -> layer_9_expert_out_sp2_ep10_tp2_pp2
	layer_9_expert_sp2_ep10_tp3_pp2 [label="Expert L9 SP2 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep10_pp2 -> layer_9_expert_sp2_ep10_tp3_pp2
	layer_9_expert_out_sp2_ep10_tp3_pp2 [label="Expert Out L9 SP2 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep10_tp3_pp2 -> layer_9_expert_out_sp2_ep10_tp3_pp2
	layer_9_expert_ar_sp2_ep10_pp2 [label="Expert All-Reduce L9 SP2 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep10_tp0_pp2 -> layer_9_expert_ar_sp2_ep10_pp2
	layer_9_expert_out_sp2_ep10_tp1_pp2 -> layer_9_expert_ar_sp2_ep10_pp2
	layer_9_expert_out_sp2_ep10_tp2_pp2 -> layer_9_expert_ar_sp2_ep10_pp2
	layer_9_expert_out_sp2_ep10_tp3_pp2 -> layer_9_expert_ar_sp2_ep10_pp2
	layer_9_combine_sp2_ep10_pp2 [label="Token Combine L9 SP2 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep10_pp2 -> layer_9_combine_sp2_ep10_pp2
	layer_9_dispatch_sp2_ep11_pp2 [label="Token Dispatch L9 SP2 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep11_pp2 [style=dashed]
	layer_9_expert_sp2_ep11_tp0_pp2 [label="Expert L9 SP2 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep11_pp2 -> layer_9_expert_sp2_ep11_tp0_pp2
	layer_9_expert_out_sp2_ep11_tp0_pp2 [label="Expert Out L9 SP2 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep11_tp0_pp2 -> layer_9_expert_out_sp2_ep11_tp0_pp2
	layer_9_expert_sp2_ep11_tp1_pp2 [label="Expert L9 SP2 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep11_pp2 -> layer_9_expert_sp2_ep11_tp1_pp2
	layer_9_expert_out_sp2_ep11_tp1_pp2 [label="Expert Out L9 SP2 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep11_tp1_pp2 -> layer_9_expert_out_sp2_ep11_tp1_pp2
	layer_9_expert_sp2_ep11_tp2_pp2 [label="Expert L9 SP2 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep11_pp2 -> layer_9_expert_sp2_ep11_tp2_pp2
	layer_9_expert_out_sp2_ep11_tp2_pp2 [label="Expert Out L9 SP2 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep11_tp2_pp2 -> layer_9_expert_out_sp2_ep11_tp2_pp2
	layer_9_expert_sp2_ep11_tp3_pp2 [label="Expert L9 SP2 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep11_pp2 -> layer_9_expert_sp2_ep11_tp3_pp2
	layer_9_expert_out_sp2_ep11_tp3_pp2 [label="Expert Out L9 SP2 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep11_tp3_pp2 -> layer_9_expert_out_sp2_ep11_tp3_pp2
	layer_9_expert_ar_sp2_ep11_pp2 [label="Expert All-Reduce L9 SP2 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep11_tp0_pp2 -> layer_9_expert_ar_sp2_ep11_pp2
	layer_9_expert_out_sp2_ep11_tp1_pp2 -> layer_9_expert_ar_sp2_ep11_pp2
	layer_9_expert_out_sp2_ep11_tp2_pp2 -> layer_9_expert_ar_sp2_ep11_pp2
	layer_9_expert_out_sp2_ep11_tp3_pp2 -> layer_9_expert_ar_sp2_ep11_pp2
	layer_9_combine_sp2_ep11_pp2 [label="Token Combine L9 SP2 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep11_pp2 -> layer_9_combine_sp2_ep11_pp2
	layer_9_dispatch_sp2_ep12_pp2 [label="Token Dispatch L9 SP2 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep12_pp2 [style=dashed]
	layer_9_expert_sp2_ep12_tp0_pp2 [label="Expert L9 SP2 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep12_pp2 -> layer_9_expert_sp2_ep12_tp0_pp2
	layer_9_expert_out_sp2_ep12_tp0_pp2 [label="Expert Out L9 SP2 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep12_tp0_pp2 -> layer_9_expert_out_sp2_ep12_tp0_pp2
	layer_9_expert_sp2_ep12_tp1_pp2 [label="Expert L9 SP2 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep12_pp2 -> layer_9_expert_sp2_ep12_tp1_pp2
	layer_9_expert_out_sp2_ep12_tp1_pp2 [label="Expert Out L9 SP2 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep12_tp1_pp2 -> layer_9_expert_out_sp2_ep12_tp1_pp2
	layer_9_expert_sp2_ep12_tp2_pp2 [label="Expert L9 SP2 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep12_pp2 -> layer_9_expert_sp2_ep12_tp2_pp2
	layer_9_expert_out_sp2_ep12_tp2_pp2 [label="Expert Out L9 SP2 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep12_tp2_pp2 -> layer_9_expert_out_sp2_ep12_tp2_pp2
	layer_9_expert_sp2_ep12_tp3_pp2 [label="Expert L9 SP2 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep12_pp2 -> layer_9_expert_sp2_ep12_tp3_pp2
	layer_9_expert_out_sp2_ep12_tp3_pp2 [label="Expert Out L9 SP2 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep12_tp3_pp2 -> layer_9_expert_out_sp2_ep12_tp3_pp2
	layer_9_expert_ar_sp2_ep12_pp2 [label="Expert All-Reduce L9 SP2 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep12_tp0_pp2 -> layer_9_expert_ar_sp2_ep12_pp2
	layer_9_expert_out_sp2_ep12_tp1_pp2 -> layer_9_expert_ar_sp2_ep12_pp2
	layer_9_expert_out_sp2_ep12_tp2_pp2 -> layer_9_expert_ar_sp2_ep12_pp2
	layer_9_expert_out_sp2_ep12_tp3_pp2 -> layer_9_expert_ar_sp2_ep12_pp2
	layer_9_combine_sp2_ep12_pp2 [label="Token Combine L9 SP2 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep12_pp2 -> layer_9_combine_sp2_ep12_pp2
	layer_9_dispatch_sp2_ep13_pp2 [label="Token Dispatch L9 SP2 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep13_pp2 [style=dashed]
	layer_9_expert_sp2_ep13_tp0_pp2 [label="Expert L9 SP2 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep13_pp2 -> layer_9_expert_sp2_ep13_tp0_pp2
	layer_9_expert_out_sp2_ep13_tp0_pp2 [label="Expert Out L9 SP2 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep13_tp0_pp2 -> layer_9_expert_out_sp2_ep13_tp0_pp2
	layer_9_expert_sp2_ep13_tp1_pp2 [label="Expert L9 SP2 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep13_pp2 -> layer_9_expert_sp2_ep13_tp1_pp2
	layer_9_expert_out_sp2_ep13_tp1_pp2 [label="Expert Out L9 SP2 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep13_tp1_pp2 -> layer_9_expert_out_sp2_ep13_tp1_pp2
	layer_9_expert_sp2_ep13_tp2_pp2 [label="Expert L9 SP2 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep13_pp2 -> layer_9_expert_sp2_ep13_tp2_pp2
	layer_9_expert_out_sp2_ep13_tp2_pp2 [label="Expert Out L9 SP2 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep13_tp2_pp2 -> layer_9_expert_out_sp2_ep13_tp2_pp2
	layer_9_expert_sp2_ep13_tp3_pp2 [label="Expert L9 SP2 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep13_pp2 -> layer_9_expert_sp2_ep13_tp3_pp2
	layer_9_expert_out_sp2_ep13_tp3_pp2 [label="Expert Out L9 SP2 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep13_tp3_pp2 -> layer_9_expert_out_sp2_ep13_tp3_pp2
	layer_9_expert_ar_sp2_ep13_pp2 [label="Expert All-Reduce L9 SP2 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep13_tp0_pp2 -> layer_9_expert_ar_sp2_ep13_pp2
	layer_9_expert_out_sp2_ep13_tp1_pp2 -> layer_9_expert_ar_sp2_ep13_pp2
	layer_9_expert_out_sp2_ep13_tp2_pp2 -> layer_9_expert_ar_sp2_ep13_pp2
	layer_9_expert_out_sp2_ep13_tp3_pp2 -> layer_9_expert_ar_sp2_ep13_pp2
	layer_9_combine_sp2_ep13_pp2 [label="Token Combine L9 SP2 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep13_pp2 -> layer_9_combine_sp2_ep13_pp2
	layer_9_dispatch_sp2_ep14_pp2 [label="Token Dispatch L9 SP2 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep14_pp2 [style=dashed]
	layer_9_expert_sp2_ep14_tp0_pp2 [label="Expert L9 SP2 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep14_pp2 -> layer_9_expert_sp2_ep14_tp0_pp2
	layer_9_expert_out_sp2_ep14_tp0_pp2 [label="Expert Out L9 SP2 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep14_tp0_pp2 -> layer_9_expert_out_sp2_ep14_tp0_pp2
	layer_9_expert_sp2_ep14_tp1_pp2 [label="Expert L9 SP2 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep14_pp2 -> layer_9_expert_sp2_ep14_tp1_pp2
	layer_9_expert_out_sp2_ep14_tp1_pp2 [label="Expert Out L9 SP2 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep14_tp1_pp2 -> layer_9_expert_out_sp2_ep14_tp1_pp2
	layer_9_expert_sp2_ep14_tp2_pp2 [label="Expert L9 SP2 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep14_pp2 -> layer_9_expert_sp2_ep14_tp2_pp2
	layer_9_expert_out_sp2_ep14_tp2_pp2 [label="Expert Out L9 SP2 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep14_tp2_pp2 -> layer_9_expert_out_sp2_ep14_tp2_pp2
	layer_9_expert_sp2_ep14_tp3_pp2 [label="Expert L9 SP2 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep14_pp2 -> layer_9_expert_sp2_ep14_tp3_pp2
	layer_9_expert_out_sp2_ep14_tp3_pp2 [label="Expert Out L9 SP2 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep14_tp3_pp2 -> layer_9_expert_out_sp2_ep14_tp3_pp2
	layer_9_expert_ar_sp2_ep14_pp2 [label="Expert All-Reduce L9 SP2 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep14_tp0_pp2 -> layer_9_expert_ar_sp2_ep14_pp2
	layer_9_expert_out_sp2_ep14_tp1_pp2 -> layer_9_expert_ar_sp2_ep14_pp2
	layer_9_expert_out_sp2_ep14_tp2_pp2 -> layer_9_expert_ar_sp2_ep14_pp2
	layer_9_expert_out_sp2_ep14_tp3_pp2 -> layer_9_expert_ar_sp2_ep14_pp2
	layer_9_combine_sp2_ep14_pp2 [label="Token Combine L9 SP2 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep14_pp2 -> layer_9_combine_sp2_ep14_pp2
	layer_9_dispatch_sp2_ep15_pp2 [label="Token Dispatch L9 SP2 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp2_pp2 -> layer_9_dispatch_sp2_ep15_pp2 [style=dashed]
	layer_9_expert_sp2_ep15_tp0_pp2 [label="Expert L9 SP2 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep15_pp2 -> layer_9_expert_sp2_ep15_tp0_pp2
	layer_9_expert_out_sp2_ep15_tp0_pp2 [label="Expert Out L9 SP2 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep15_tp0_pp2 -> layer_9_expert_out_sp2_ep15_tp0_pp2
	layer_9_expert_sp2_ep15_tp1_pp2 [label="Expert L9 SP2 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep15_pp2 -> layer_9_expert_sp2_ep15_tp1_pp2
	layer_9_expert_out_sp2_ep15_tp1_pp2 [label="Expert Out L9 SP2 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep15_tp1_pp2 -> layer_9_expert_out_sp2_ep15_tp1_pp2
	layer_9_expert_sp2_ep15_tp2_pp2 [label="Expert L9 SP2 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep15_pp2 -> layer_9_expert_sp2_ep15_tp2_pp2
	layer_9_expert_out_sp2_ep15_tp2_pp2 [label="Expert Out L9 SP2 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep15_tp2_pp2 -> layer_9_expert_out_sp2_ep15_tp2_pp2
	layer_9_expert_sp2_ep15_tp3_pp2 [label="Expert L9 SP2 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp2_ep15_pp2 -> layer_9_expert_sp2_ep15_tp3_pp2
	layer_9_expert_out_sp2_ep15_tp3_pp2 [label="Expert Out L9 SP2 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp2_ep15_tp3_pp2 -> layer_9_expert_out_sp2_ep15_tp3_pp2
	layer_9_expert_ar_sp2_ep15_pp2 [label="Expert All-Reduce L9 SP2 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp2_ep15_tp0_pp2 -> layer_9_expert_ar_sp2_ep15_pp2
	layer_9_expert_out_sp2_ep15_tp1_pp2 -> layer_9_expert_ar_sp2_ep15_pp2
	layer_9_expert_out_sp2_ep15_tp2_pp2 -> layer_9_expert_ar_sp2_ep15_pp2
	layer_9_expert_out_sp2_ep15_tp3_pp2 -> layer_9_expert_ar_sp2_ep15_pp2
	layer_9_combine_sp2_ep15_pp2 [label="Token Combine L9 SP2 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp2_ep15_pp2 -> layer_9_combine_sp2_ep15_pp2
	layer_9_moe_all2all_sp2_pp2 [label="MoE All-to-All L9 SP2\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_9_combine_sp2_ep0_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep1_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep2_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep3_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep4_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep5_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep6_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep7_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep8_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep9_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep10_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep11_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep12_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep13_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep14_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_combine_sp2_ep15_pp2 -> layer_9_moe_all2all_sp2_pp2
	layer_9_mlp_out_sp2_pp2 [label="MoE Output L9 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_moe_all2all_sp2_pp2 -> layer_9_mlp_out_sp2_pp2
	layer_9_mlp_res_sp2_pp2 [label="MLP Residual L9 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_mlp_out_sp2_pp2 -> layer_9_mlp_res_sp2_pp2
	layer_9_attn_res_sp2_pp2 -> layer_9_mlp_res_sp2_pp2 [style=dashed]
	layer_9_norm_sp3_pp2 [label="LayerNorm L9 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_8_mlp_out_sp3_pp2 -> layer_9_norm_sp3_pp2
	layer_9_qkv_sp3_tp0_pp2 [label="QKV Proj L9 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp3_pp2 -> layer_9_qkv_sp3_tp0_pp2
	layer_9_attn_sp3_tp0_pp2 [label="Attention L9 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp3_tp0_pp2 -> layer_9_attn_sp3_tp0_pp2
	layer_9_attn_out_sp3_tp0_pp2 [label="Attn Out Proj L9 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp3_tp0_pp2 -> layer_9_attn_out_sp3_tp0_pp2
	layer_9_qkv_sp3_tp1_pp2 [label="QKV Proj L9 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp3_pp2 -> layer_9_qkv_sp3_tp1_pp2
	layer_9_attn_sp3_tp1_pp2 [label="Attention L9 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp3_tp1_pp2 -> layer_9_attn_sp3_tp1_pp2
	layer_9_attn_out_sp3_tp1_pp2 [label="Attn Out Proj L9 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp3_tp1_pp2 -> layer_9_attn_out_sp3_tp1_pp2
	layer_9_qkv_sp3_tp2_pp2 [label="QKV Proj L9 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp3_pp2 -> layer_9_qkv_sp3_tp2_pp2
	layer_9_attn_sp3_tp2_pp2 [label="Attention L9 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp3_tp2_pp2 -> layer_9_attn_sp3_tp2_pp2
	layer_9_attn_out_sp3_tp2_pp2 [label="Attn Out Proj L9 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp3_tp2_pp2 -> layer_9_attn_out_sp3_tp2_pp2
	layer_9_qkv_sp3_tp3_pp2 [label="QKV Proj L9 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_norm_sp3_pp2 -> layer_9_qkv_sp3_tp3_pp2
	layer_9_attn_sp3_tp3_pp2 [label="Attention L9 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_qkv_sp3_tp3_pp2 -> layer_9_attn_sp3_tp3_pp2
	layer_9_attn_out_sp3_tp3_pp2 [label="Attn Out Proj L9 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_9_attn_sp3_tp3_pp2 -> layer_9_attn_out_sp3_tp3_pp2
	layer_9_attn_ar_sp3_pp2 [label="Attention All-Reduce L9 SP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_attn_out_sp3_tp0_pp2 -> layer_9_attn_ar_sp3_pp2
	layer_9_attn_out_sp3_tp1_pp2 -> layer_9_attn_ar_sp3_pp2
	layer_9_attn_out_sp3_tp2_pp2 -> layer_9_attn_ar_sp3_pp2
	layer_9_attn_out_sp3_tp3_pp2 -> layer_9_attn_ar_sp3_pp2
	layer_9_attn_res_sp3_pp2 [label="Attention Residual L9 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_attn_ar_sp3_pp2 -> layer_9_attn_res_sp3_pp2
	layer_9_norm_sp3_pp2 -> layer_9_attn_res_sp3_pp2 [style=dashed]
	layer_9_post_norm_sp3_pp2 [label="Post-Attn Norm L9 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_attn_res_sp3_pp2 -> layer_9_post_norm_sp3_pp2
	layer_9_router_sp3_pp2 [label="MoE Router L9 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_9_post_norm_sp3_pp2 -> layer_9_router_sp3_pp2
	layer_9_dispatch_sp3_ep0_pp2 [label="Token Dispatch L9 SP3 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep0_pp2 [style=dashed]
	layer_9_expert_sp3_ep0_tp0_pp2 [label="Expert L9 SP3 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep0_pp2 -> layer_9_expert_sp3_ep0_tp0_pp2
	layer_9_expert_out_sp3_ep0_tp0_pp2 [label="Expert Out L9 SP3 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep0_tp0_pp2 -> layer_9_expert_out_sp3_ep0_tp0_pp2
	layer_9_expert_sp3_ep0_tp1_pp2 [label="Expert L9 SP3 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep0_pp2 -> layer_9_expert_sp3_ep0_tp1_pp2
	layer_9_expert_out_sp3_ep0_tp1_pp2 [label="Expert Out L9 SP3 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep0_tp1_pp2 -> layer_9_expert_out_sp3_ep0_tp1_pp2
	layer_9_expert_sp3_ep0_tp2_pp2 [label="Expert L9 SP3 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep0_pp2 -> layer_9_expert_sp3_ep0_tp2_pp2
	layer_9_expert_out_sp3_ep0_tp2_pp2 [label="Expert Out L9 SP3 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep0_tp2_pp2 -> layer_9_expert_out_sp3_ep0_tp2_pp2
	layer_9_expert_sp3_ep0_tp3_pp2 [label="Expert L9 SP3 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep0_pp2 -> layer_9_expert_sp3_ep0_tp3_pp2
	layer_9_expert_out_sp3_ep0_tp3_pp2 [label="Expert Out L9 SP3 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep0_tp3_pp2 -> layer_9_expert_out_sp3_ep0_tp3_pp2
	layer_9_expert_ar_sp3_ep0_pp2 [label="Expert All-Reduce L9 SP3 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep0_tp0_pp2 -> layer_9_expert_ar_sp3_ep0_pp2
	layer_9_expert_out_sp3_ep0_tp1_pp2 -> layer_9_expert_ar_sp3_ep0_pp2
	layer_9_expert_out_sp3_ep0_tp2_pp2 -> layer_9_expert_ar_sp3_ep0_pp2
	layer_9_expert_out_sp3_ep0_tp3_pp2 -> layer_9_expert_ar_sp3_ep0_pp2
	layer_9_combine_sp3_ep0_pp2 [label="Token Combine L9 SP3 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep0_pp2 -> layer_9_combine_sp3_ep0_pp2
	layer_9_dispatch_sp3_ep1_pp2 [label="Token Dispatch L9 SP3 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep1_pp2 [style=dashed]
	layer_9_expert_sp3_ep1_tp0_pp2 [label="Expert L9 SP3 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep1_pp2 -> layer_9_expert_sp3_ep1_tp0_pp2
	layer_9_expert_out_sp3_ep1_tp0_pp2 [label="Expert Out L9 SP3 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep1_tp0_pp2 -> layer_9_expert_out_sp3_ep1_tp0_pp2
	layer_9_expert_sp3_ep1_tp1_pp2 [label="Expert L9 SP3 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep1_pp2 -> layer_9_expert_sp3_ep1_tp1_pp2
	layer_9_expert_out_sp3_ep1_tp1_pp2 [label="Expert Out L9 SP3 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep1_tp1_pp2 -> layer_9_expert_out_sp3_ep1_tp1_pp2
	layer_9_expert_sp3_ep1_tp2_pp2 [label="Expert L9 SP3 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep1_pp2 -> layer_9_expert_sp3_ep1_tp2_pp2
	layer_9_expert_out_sp3_ep1_tp2_pp2 [label="Expert Out L9 SP3 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep1_tp2_pp2 -> layer_9_expert_out_sp3_ep1_tp2_pp2
	layer_9_expert_sp3_ep1_tp3_pp2 [label="Expert L9 SP3 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep1_pp2 -> layer_9_expert_sp3_ep1_tp3_pp2
	layer_9_expert_out_sp3_ep1_tp3_pp2 [label="Expert Out L9 SP3 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep1_tp3_pp2 -> layer_9_expert_out_sp3_ep1_tp3_pp2
	layer_9_expert_ar_sp3_ep1_pp2 [label="Expert All-Reduce L9 SP3 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep1_tp0_pp2 -> layer_9_expert_ar_sp3_ep1_pp2
	layer_9_expert_out_sp3_ep1_tp1_pp2 -> layer_9_expert_ar_sp3_ep1_pp2
	layer_9_expert_out_sp3_ep1_tp2_pp2 -> layer_9_expert_ar_sp3_ep1_pp2
	layer_9_expert_out_sp3_ep1_tp3_pp2 -> layer_9_expert_ar_sp3_ep1_pp2
	layer_9_combine_sp3_ep1_pp2 [label="Token Combine L9 SP3 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep1_pp2 -> layer_9_combine_sp3_ep1_pp2
	layer_9_dispatch_sp3_ep2_pp2 [label="Token Dispatch L9 SP3 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep2_pp2 [style=dashed]
	layer_9_expert_sp3_ep2_tp0_pp2 [label="Expert L9 SP3 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep2_pp2 -> layer_9_expert_sp3_ep2_tp0_pp2
	layer_9_expert_out_sp3_ep2_tp0_pp2 [label="Expert Out L9 SP3 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep2_tp0_pp2 -> layer_9_expert_out_sp3_ep2_tp0_pp2
	layer_9_expert_sp3_ep2_tp1_pp2 [label="Expert L9 SP3 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep2_pp2 -> layer_9_expert_sp3_ep2_tp1_pp2
	layer_9_expert_out_sp3_ep2_tp1_pp2 [label="Expert Out L9 SP3 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep2_tp1_pp2 -> layer_9_expert_out_sp3_ep2_tp1_pp2
	layer_9_expert_sp3_ep2_tp2_pp2 [label="Expert L9 SP3 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep2_pp2 -> layer_9_expert_sp3_ep2_tp2_pp2
	layer_9_expert_out_sp3_ep2_tp2_pp2 [label="Expert Out L9 SP3 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep2_tp2_pp2 -> layer_9_expert_out_sp3_ep2_tp2_pp2
	layer_9_expert_sp3_ep2_tp3_pp2 [label="Expert L9 SP3 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep2_pp2 -> layer_9_expert_sp3_ep2_tp3_pp2
	layer_9_expert_out_sp3_ep2_tp3_pp2 [label="Expert Out L9 SP3 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep2_tp3_pp2 -> layer_9_expert_out_sp3_ep2_tp3_pp2
	layer_9_expert_ar_sp3_ep2_pp2 [label="Expert All-Reduce L9 SP3 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep2_tp0_pp2 -> layer_9_expert_ar_sp3_ep2_pp2
	layer_9_expert_out_sp3_ep2_tp1_pp2 -> layer_9_expert_ar_sp3_ep2_pp2
	layer_9_expert_out_sp3_ep2_tp2_pp2 -> layer_9_expert_ar_sp3_ep2_pp2
	layer_9_expert_out_sp3_ep2_tp3_pp2 -> layer_9_expert_ar_sp3_ep2_pp2
	layer_9_combine_sp3_ep2_pp2 [label="Token Combine L9 SP3 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep2_pp2 -> layer_9_combine_sp3_ep2_pp2
	layer_9_dispatch_sp3_ep3_pp2 [label="Token Dispatch L9 SP3 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep3_pp2 [style=dashed]
	layer_9_expert_sp3_ep3_tp0_pp2 [label="Expert L9 SP3 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep3_pp2 -> layer_9_expert_sp3_ep3_tp0_pp2
	layer_9_expert_out_sp3_ep3_tp0_pp2 [label="Expert Out L9 SP3 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep3_tp0_pp2 -> layer_9_expert_out_sp3_ep3_tp0_pp2
	layer_9_expert_sp3_ep3_tp1_pp2 [label="Expert L9 SP3 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep3_pp2 -> layer_9_expert_sp3_ep3_tp1_pp2
	layer_9_expert_out_sp3_ep3_tp1_pp2 [label="Expert Out L9 SP3 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep3_tp1_pp2 -> layer_9_expert_out_sp3_ep3_tp1_pp2
	layer_9_expert_sp3_ep3_tp2_pp2 [label="Expert L9 SP3 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep3_pp2 -> layer_9_expert_sp3_ep3_tp2_pp2
	layer_9_expert_out_sp3_ep3_tp2_pp2 [label="Expert Out L9 SP3 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep3_tp2_pp2 -> layer_9_expert_out_sp3_ep3_tp2_pp2
	layer_9_expert_sp3_ep3_tp3_pp2 [label="Expert L9 SP3 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep3_pp2 -> layer_9_expert_sp3_ep3_tp3_pp2
	layer_9_expert_out_sp3_ep3_tp3_pp2 [label="Expert Out L9 SP3 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep3_tp3_pp2 -> layer_9_expert_out_sp3_ep3_tp3_pp2
	layer_9_expert_ar_sp3_ep3_pp2 [label="Expert All-Reduce L9 SP3 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep3_tp0_pp2 -> layer_9_expert_ar_sp3_ep3_pp2
	layer_9_expert_out_sp3_ep3_tp1_pp2 -> layer_9_expert_ar_sp3_ep3_pp2
	layer_9_expert_out_sp3_ep3_tp2_pp2 -> layer_9_expert_ar_sp3_ep3_pp2
	layer_9_expert_out_sp3_ep3_tp3_pp2 -> layer_9_expert_ar_sp3_ep3_pp2
	layer_9_combine_sp3_ep3_pp2 [label="Token Combine L9 SP3 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep3_pp2 -> layer_9_combine_sp3_ep3_pp2
	layer_9_dispatch_sp3_ep4_pp2 [label="Token Dispatch L9 SP3 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep4_pp2 [style=dashed]
	layer_9_expert_sp3_ep4_tp0_pp2 [label="Expert L9 SP3 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep4_pp2 -> layer_9_expert_sp3_ep4_tp0_pp2
	layer_9_expert_out_sp3_ep4_tp0_pp2 [label="Expert Out L9 SP3 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep4_tp0_pp2 -> layer_9_expert_out_sp3_ep4_tp0_pp2
	layer_9_expert_sp3_ep4_tp1_pp2 [label="Expert L9 SP3 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep4_pp2 -> layer_9_expert_sp3_ep4_tp1_pp2
	layer_9_expert_out_sp3_ep4_tp1_pp2 [label="Expert Out L9 SP3 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep4_tp1_pp2 -> layer_9_expert_out_sp3_ep4_tp1_pp2
	layer_9_expert_sp3_ep4_tp2_pp2 [label="Expert L9 SP3 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep4_pp2 -> layer_9_expert_sp3_ep4_tp2_pp2
	layer_9_expert_out_sp3_ep4_tp2_pp2 [label="Expert Out L9 SP3 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep4_tp2_pp2 -> layer_9_expert_out_sp3_ep4_tp2_pp2
	layer_9_expert_sp3_ep4_tp3_pp2 [label="Expert L9 SP3 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep4_pp2 -> layer_9_expert_sp3_ep4_tp3_pp2
	layer_9_expert_out_sp3_ep4_tp3_pp2 [label="Expert Out L9 SP3 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep4_tp3_pp2 -> layer_9_expert_out_sp3_ep4_tp3_pp2
	layer_9_expert_ar_sp3_ep4_pp2 [label="Expert All-Reduce L9 SP3 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep4_tp0_pp2 -> layer_9_expert_ar_sp3_ep4_pp2
	layer_9_expert_out_sp3_ep4_tp1_pp2 -> layer_9_expert_ar_sp3_ep4_pp2
	layer_9_expert_out_sp3_ep4_tp2_pp2 -> layer_9_expert_ar_sp3_ep4_pp2
	layer_9_expert_out_sp3_ep4_tp3_pp2 -> layer_9_expert_ar_sp3_ep4_pp2
	layer_9_combine_sp3_ep4_pp2 [label="Token Combine L9 SP3 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep4_pp2 -> layer_9_combine_sp3_ep4_pp2
	layer_9_dispatch_sp3_ep5_pp2 [label="Token Dispatch L9 SP3 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep5_pp2 [style=dashed]
	layer_9_expert_sp3_ep5_tp0_pp2 [label="Expert L9 SP3 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep5_pp2 -> layer_9_expert_sp3_ep5_tp0_pp2
	layer_9_expert_out_sp3_ep5_tp0_pp2 [label="Expert Out L9 SP3 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep5_tp0_pp2 -> layer_9_expert_out_sp3_ep5_tp0_pp2
	layer_9_expert_sp3_ep5_tp1_pp2 [label="Expert L9 SP3 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep5_pp2 -> layer_9_expert_sp3_ep5_tp1_pp2
	layer_9_expert_out_sp3_ep5_tp1_pp2 [label="Expert Out L9 SP3 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep5_tp1_pp2 -> layer_9_expert_out_sp3_ep5_tp1_pp2
	layer_9_expert_sp3_ep5_tp2_pp2 [label="Expert L9 SP3 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep5_pp2 -> layer_9_expert_sp3_ep5_tp2_pp2
	layer_9_expert_out_sp3_ep5_tp2_pp2 [label="Expert Out L9 SP3 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep5_tp2_pp2 -> layer_9_expert_out_sp3_ep5_tp2_pp2
	layer_9_expert_sp3_ep5_tp3_pp2 [label="Expert L9 SP3 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep5_pp2 -> layer_9_expert_sp3_ep5_tp3_pp2
	layer_9_expert_out_sp3_ep5_tp3_pp2 [label="Expert Out L9 SP3 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep5_tp3_pp2 -> layer_9_expert_out_sp3_ep5_tp3_pp2
	layer_9_expert_ar_sp3_ep5_pp2 [label="Expert All-Reduce L9 SP3 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep5_tp0_pp2 -> layer_9_expert_ar_sp3_ep5_pp2
	layer_9_expert_out_sp3_ep5_tp1_pp2 -> layer_9_expert_ar_sp3_ep5_pp2
	layer_9_expert_out_sp3_ep5_tp2_pp2 -> layer_9_expert_ar_sp3_ep5_pp2
	layer_9_expert_out_sp3_ep5_tp3_pp2 -> layer_9_expert_ar_sp3_ep5_pp2
	layer_9_combine_sp3_ep5_pp2 [label="Token Combine L9 SP3 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep5_pp2 -> layer_9_combine_sp3_ep5_pp2
	layer_9_dispatch_sp3_ep6_pp2 [label="Token Dispatch L9 SP3 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep6_pp2 [style=dashed]
	layer_9_expert_sp3_ep6_tp0_pp2 [label="Expert L9 SP3 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep6_pp2 -> layer_9_expert_sp3_ep6_tp0_pp2
	layer_9_expert_out_sp3_ep6_tp0_pp2 [label="Expert Out L9 SP3 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep6_tp0_pp2 -> layer_9_expert_out_sp3_ep6_tp0_pp2
	layer_9_expert_sp3_ep6_tp1_pp2 [label="Expert L9 SP3 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep6_pp2 -> layer_9_expert_sp3_ep6_tp1_pp2
	layer_9_expert_out_sp3_ep6_tp1_pp2 [label="Expert Out L9 SP3 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep6_tp1_pp2 -> layer_9_expert_out_sp3_ep6_tp1_pp2
	layer_9_expert_sp3_ep6_tp2_pp2 [label="Expert L9 SP3 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep6_pp2 -> layer_9_expert_sp3_ep6_tp2_pp2
	layer_9_expert_out_sp3_ep6_tp2_pp2 [label="Expert Out L9 SP3 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep6_tp2_pp2 -> layer_9_expert_out_sp3_ep6_tp2_pp2
	layer_9_expert_sp3_ep6_tp3_pp2 [label="Expert L9 SP3 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep6_pp2 -> layer_9_expert_sp3_ep6_tp3_pp2
	layer_9_expert_out_sp3_ep6_tp3_pp2 [label="Expert Out L9 SP3 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep6_tp3_pp2 -> layer_9_expert_out_sp3_ep6_tp3_pp2
	layer_9_expert_ar_sp3_ep6_pp2 [label="Expert All-Reduce L9 SP3 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep6_tp0_pp2 -> layer_9_expert_ar_sp3_ep6_pp2
	layer_9_expert_out_sp3_ep6_tp1_pp2 -> layer_9_expert_ar_sp3_ep6_pp2
	layer_9_expert_out_sp3_ep6_tp2_pp2 -> layer_9_expert_ar_sp3_ep6_pp2
	layer_9_expert_out_sp3_ep6_tp3_pp2 -> layer_9_expert_ar_sp3_ep6_pp2
	layer_9_combine_sp3_ep6_pp2 [label="Token Combine L9 SP3 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep6_pp2 -> layer_9_combine_sp3_ep6_pp2
	layer_9_dispatch_sp3_ep7_pp2 [label="Token Dispatch L9 SP3 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep7_pp2 [style=dashed]
	layer_9_expert_sp3_ep7_tp0_pp2 [label="Expert L9 SP3 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep7_pp2 -> layer_9_expert_sp3_ep7_tp0_pp2
	layer_9_expert_out_sp3_ep7_tp0_pp2 [label="Expert Out L9 SP3 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep7_tp0_pp2 -> layer_9_expert_out_sp3_ep7_tp0_pp2
	layer_9_expert_sp3_ep7_tp1_pp2 [label="Expert L9 SP3 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep7_pp2 -> layer_9_expert_sp3_ep7_tp1_pp2
	layer_9_expert_out_sp3_ep7_tp1_pp2 [label="Expert Out L9 SP3 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep7_tp1_pp2 -> layer_9_expert_out_sp3_ep7_tp1_pp2
	layer_9_expert_sp3_ep7_tp2_pp2 [label="Expert L9 SP3 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep7_pp2 -> layer_9_expert_sp3_ep7_tp2_pp2
	layer_9_expert_out_sp3_ep7_tp2_pp2 [label="Expert Out L9 SP3 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep7_tp2_pp2 -> layer_9_expert_out_sp3_ep7_tp2_pp2
	layer_9_expert_sp3_ep7_tp3_pp2 [label="Expert L9 SP3 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep7_pp2 -> layer_9_expert_sp3_ep7_tp3_pp2
	layer_9_expert_out_sp3_ep7_tp3_pp2 [label="Expert Out L9 SP3 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep7_tp3_pp2 -> layer_9_expert_out_sp3_ep7_tp3_pp2
	layer_9_expert_ar_sp3_ep7_pp2 [label="Expert All-Reduce L9 SP3 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep7_tp0_pp2 -> layer_9_expert_ar_sp3_ep7_pp2
	layer_9_expert_out_sp3_ep7_tp1_pp2 -> layer_9_expert_ar_sp3_ep7_pp2
	layer_9_expert_out_sp3_ep7_tp2_pp2 -> layer_9_expert_ar_sp3_ep7_pp2
	layer_9_expert_out_sp3_ep7_tp3_pp2 -> layer_9_expert_ar_sp3_ep7_pp2
	layer_9_combine_sp3_ep7_pp2 [label="Token Combine L9 SP3 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep7_pp2 -> layer_9_combine_sp3_ep7_pp2
	layer_9_dispatch_sp3_ep8_pp2 [label="Token Dispatch L9 SP3 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep8_pp2 [style=dashed]
	layer_9_expert_sp3_ep8_tp0_pp2 [label="Expert L9 SP3 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep8_pp2 -> layer_9_expert_sp3_ep8_tp0_pp2
	layer_9_expert_out_sp3_ep8_tp0_pp2 [label="Expert Out L9 SP3 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep8_tp0_pp2 -> layer_9_expert_out_sp3_ep8_tp0_pp2
	layer_9_expert_sp3_ep8_tp1_pp2 [label="Expert L9 SP3 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep8_pp2 -> layer_9_expert_sp3_ep8_tp1_pp2
	layer_9_expert_out_sp3_ep8_tp1_pp2 [label="Expert Out L9 SP3 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep8_tp1_pp2 -> layer_9_expert_out_sp3_ep8_tp1_pp2
	layer_9_expert_sp3_ep8_tp2_pp2 [label="Expert L9 SP3 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep8_pp2 -> layer_9_expert_sp3_ep8_tp2_pp2
	layer_9_expert_out_sp3_ep8_tp2_pp2 [label="Expert Out L9 SP3 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep8_tp2_pp2 -> layer_9_expert_out_sp3_ep8_tp2_pp2
	layer_9_expert_sp3_ep8_tp3_pp2 [label="Expert L9 SP3 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep8_pp2 -> layer_9_expert_sp3_ep8_tp3_pp2
	layer_9_expert_out_sp3_ep8_tp3_pp2 [label="Expert Out L9 SP3 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep8_tp3_pp2 -> layer_9_expert_out_sp3_ep8_tp3_pp2
	layer_9_expert_ar_sp3_ep8_pp2 [label="Expert All-Reduce L9 SP3 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep8_tp0_pp2 -> layer_9_expert_ar_sp3_ep8_pp2
	layer_9_expert_out_sp3_ep8_tp1_pp2 -> layer_9_expert_ar_sp3_ep8_pp2
	layer_9_expert_out_sp3_ep8_tp2_pp2 -> layer_9_expert_ar_sp3_ep8_pp2
	layer_9_expert_out_sp3_ep8_tp3_pp2 -> layer_9_expert_ar_sp3_ep8_pp2
	layer_9_combine_sp3_ep8_pp2 [label="Token Combine L9 SP3 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep8_pp2 -> layer_9_combine_sp3_ep8_pp2
	layer_9_dispatch_sp3_ep9_pp2 [label="Token Dispatch L9 SP3 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep9_pp2 [style=dashed]
	layer_9_expert_sp3_ep9_tp0_pp2 [label="Expert L9 SP3 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep9_pp2 -> layer_9_expert_sp3_ep9_tp0_pp2
	layer_9_expert_out_sp3_ep9_tp0_pp2 [label="Expert Out L9 SP3 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep9_tp0_pp2 -> layer_9_expert_out_sp3_ep9_tp0_pp2
	layer_9_expert_sp3_ep9_tp1_pp2 [label="Expert L9 SP3 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep9_pp2 -> layer_9_expert_sp3_ep9_tp1_pp2
	layer_9_expert_out_sp3_ep9_tp1_pp2 [label="Expert Out L9 SP3 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep9_tp1_pp2 -> layer_9_expert_out_sp3_ep9_tp1_pp2
	layer_9_expert_sp3_ep9_tp2_pp2 [label="Expert L9 SP3 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep9_pp2 -> layer_9_expert_sp3_ep9_tp2_pp2
	layer_9_expert_out_sp3_ep9_tp2_pp2 [label="Expert Out L9 SP3 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep9_tp2_pp2 -> layer_9_expert_out_sp3_ep9_tp2_pp2
	layer_9_expert_sp3_ep9_tp3_pp2 [label="Expert L9 SP3 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep9_pp2 -> layer_9_expert_sp3_ep9_tp3_pp2
	layer_9_expert_out_sp3_ep9_tp3_pp2 [label="Expert Out L9 SP3 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep9_tp3_pp2 -> layer_9_expert_out_sp3_ep9_tp3_pp2
	layer_9_expert_ar_sp3_ep9_pp2 [label="Expert All-Reduce L9 SP3 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep9_tp0_pp2 -> layer_9_expert_ar_sp3_ep9_pp2
	layer_9_expert_out_sp3_ep9_tp1_pp2 -> layer_9_expert_ar_sp3_ep9_pp2
	layer_9_expert_out_sp3_ep9_tp2_pp2 -> layer_9_expert_ar_sp3_ep9_pp2
	layer_9_expert_out_sp3_ep9_tp3_pp2 -> layer_9_expert_ar_sp3_ep9_pp2
	layer_9_combine_sp3_ep9_pp2 [label="Token Combine L9 SP3 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep9_pp2 -> layer_9_combine_sp3_ep9_pp2
	layer_9_dispatch_sp3_ep10_pp2 [label="Token Dispatch L9 SP3 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep10_pp2 [style=dashed]
	layer_9_expert_sp3_ep10_tp0_pp2 [label="Expert L9 SP3 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep10_pp2 -> layer_9_expert_sp3_ep10_tp0_pp2
	layer_9_expert_out_sp3_ep10_tp0_pp2 [label="Expert Out L9 SP3 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep10_tp0_pp2 -> layer_9_expert_out_sp3_ep10_tp0_pp2
	layer_9_expert_sp3_ep10_tp1_pp2 [label="Expert L9 SP3 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep10_pp2 -> layer_9_expert_sp3_ep10_tp1_pp2
	layer_9_expert_out_sp3_ep10_tp1_pp2 [label="Expert Out L9 SP3 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep10_tp1_pp2 -> layer_9_expert_out_sp3_ep10_tp1_pp2
	layer_9_expert_sp3_ep10_tp2_pp2 [label="Expert L9 SP3 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep10_pp2 -> layer_9_expert_sp3_ep10_tp2_pp2
	layer_9_expert_out_sp3_ep10_tp2_pp2 [label="Expert Out L9 SP3 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep10_tp2_pp2 -> layer_9_expert_out_sp3_ep10_tp2_pp2
	layer_9_expert_sp3_ep10_tp3_pp2 [label="Expert L9 SP3 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep10_pp2 -> layer_9_expert_sp3_ep10_tp3_pp2
	layer_9_expert_out_sp3_ep10_tp3_pp2 [label="Expert Out L9 SP3 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep10_tp3_pp2 -> layer_9_expert_out_sp3_ep10_tp3_pp2
	layer_9_expert_ar_sp3_ep10_pp2 [label="Expert All-Reduce L9 SP3 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep10_tp0_pp2 -> layer_9_expert_ar_sp3_ep10_pp2
	layer_9_expert_out_sp3_ep10_tp1_pp2 -> layer_9_expert_ar_sp3_ep10_pp2
	layer_9_expert_out_sp3_ep10_tp2_pp2 -> layer_9_expert_ar_sp3_ep10_pp2
	layer_9_expert_out_sp3_ep10_tp3_pp2 -> layer_9_expert_ar_sp3_ep10_pp2
	layer_9_combine_sp3_ep10_pp2 [label="Token Combine L9 SP3 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep10_pp2 -> layer_9_combine_sp3_ep10_pp2
	layer_9_dispatch_sp3_ep11_pp2 [label="Token Dispatch L9 SP3 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep11_pp2 [style=dashed]
	layer_9_expert_sp3_ep11_tp0_pp2 [label="Expert L9 SP3 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep11_pp2 -> layer_9_expert_sp3_ep11_tp0_pp2
	layer_9_expert_out_sp3_ep11_tp0_pp2 [label="Expert Out L9 SP3 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep11_tp0_pp2 -> layer_9_expert_out_sp3_ep11_tp0_pp2
	layer_9_expert_sp3_ep11_tp1_pp2 [label="Expert L9 SP3 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep11_pp2 -> layer_9_expert_sp3_ep11_tp1_pp2
	layer_9_expert_out_sp3_ep11_tp1_pp2 [label="Expert Out L9 SP3 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep11_tp1_pp2 -> layer_9_expert_out_sp3_ep11_tp1_pp2
	layer_9_expert_sp3_ep11_tp2_pp2 [label="Expert L9 SP3 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep11_pp2 -> layer_9_expert_sp3_ep11_tp2_pp2
	layer_9_expert_out_sp3_ep11_tp2_pp2 [label="Expert Out L9 SP3 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep11_tp2_pp2 -> layer_9_expert_out_sp3_ep11_tp2_pp2
	layer_9_expert_sp3_ep11_tp3_pp2 [label="Expert L9 SP3 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep11_pp2 -> layer_9_expert_sp3_ep11_tp3_pp2
	layer_9_expert_out_sp3_ep11_tp3_pp2 [label="Expert Out L9 SP3 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep11_tp3_pp2 -> layer_9_expert_out_sp3_ep11_tp3_pp2
	layer_9_expert_ar_sp3_ep11_pp2 [label="Expert All-Reduce L9 SP3 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep11_tp0_pp2 -> layer_9_expert_ar_sp3_ep11_pp2
	layer_9_expert_out_sp3_ep11_tp1_pp2 -> layer_9_expert_ar_sp3_ep11_pp2
	layer_9_expert_out_sp3_ep11_tp2_pp2 -> layer_9_expert_ar_sp3_ep11_pp2
	layer_9_expert_out_sp3_ep11_tp3_pp2 -> layer_9_expert_ar_sp3_ep11_pp2
	layer_9_combine_sp3_ep11_pp2 [label="Token Combine L9 SP3 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep11_pp2 -> layer_9_combine_sp3_ep11_pp2
	layer_9_dispatch_sp3_ep12_pp2 [label="Token Dispatch L9 SP3 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep12_pp2 [style=dashed]
	layer_9_expert_sp3_ep12_tp0_pp2 [label="Expert L9 SP3 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep12_pp2 -> layer_9_expert_sp3_ep12_tp0_pp2
	layer_9_expert_out_sp3_ep12_tp0_pp2 [label="Expert Out L9 SP3 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep12_tp0_pp2 -> layer_9_expert_out_sp3_ep12_tp0_pp2
	layer_9_expert_sp3_ep12_tp1_pp2 [label="Expert L9 SP3 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep12_pp2 -> layer_9_expert_sp3_ep12_tp1_pp2
	layer_9_expert_out_sp3_ep12_tp1_pp2 [label="Expert Out L9 SP3 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep12_tp1_pp2 -> layer_9_expert_out_sp3_ep12_tp1_pp2
	layer_9_expert_sp3_ep12_tp2_pp2 [label="Expert L9 SP3 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep12_pp2 -> layer_9_expert_sp3_ep12_tp2_pp2
	layer_9_expert_out_sp3_ep12_tp2_pp2 [label="Expert Out L9 SP3 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep12_tp2_pp2 -> layer_9_expert_out_sp3_ep12_tp2_pp2
	layer_9_expert_sp3_ep12_tp3_pp2 [label="Expert L9 SP3 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep12_pp2 -> layer_9_expert_sp3_ep12_tp3_pp2
	layer_9_expert_out_sp3_ep12_tp3_pp2 [label="Expert Out L9 SP3 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep12_tp3_pp2 -> layer_9_expert_out_sp3_ep12_tp3_pp2
	layer_9_expert_ar_sp3_ep12_pp2 [label="Expert All-Reduce L9 SP3 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep12_tp0_pp2 -> layer_9_expert_ar_sp3_ep12_pp2
	layer_9_expert_out_sp3_ep12_tp1_pp2 -> layer_9_expert_ar_sp3_ep12_pp2
	layer_9_expert_out_sp3_ep12_tp2_pp2 -> layer_9_expert_ar_sp3_ep12_pp2
	layer_9_expert_out_sp3_ep12_tp3_pp2 -> layer_9_expert_ar_sp3_ep12_pp2
	layer_9_combine_sp3_ep12_pp2 [label="Token Combine L9 SP3 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep12_pp2 -> layer_9_combine_sp3_ep12_pp2
	layer_9_dispatch_sp3_ep13_pp2 [label="Token Dispatch L9 SP3 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep13_pp2 [style=dashed]
	layer_9_expert_sp3_ep13_tp0_pp2 [label="Expert L9 SP3 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep13_pp2 -> layer_9_expert_sp3_ep13_tp0_pp2
	layer_9_expert_out_sp3_ep13_tp0_pp2 [label="Expert Out L9 SP3 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep13_tp0_pp2 -> layer_9_expert_out_sp3_ep13_tp0_pp2
	layer_9_expert_sp3_ep13_tp1_pp2 [label="Expert L9 SP3 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep13_pp2 -> layer_9_expert_sp3_ep13_tp1_pp2
	layer_9_expert_out_sp3_ep13_tp1_pp2 [label="Expert Out L9 SP3 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep13_tp1_pp2 -> layer_9_expert_out_sp3_ep13_tp1_pp2
	layer_9_expert_sp3_ep13_tp2_pp2 [label="Expert L9 SP3 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep13_pp2 -> layer_9_expert_sp3_ep13_tp2_pp2
	layer_9_expert_out_sp3_ep13_tp2_pp2 [label="Expert Out L9 SP3 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep13_tp2_pp2 -> layer_9_expert_out_sp3_ep13_tp2_pp2
	layer_9_expert_sp3_ep13_tp3_pp2 [label="Expert L9 SP3 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep13_pp2 -> layer_9_expert_sp3_ep13_tp3_pp2
	layer_9_expert_out_sp3_ep13_tp3_pp2 [label="Expert Out L9 SP3 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep13_tp3_pp2 -> layer_9_expert_out_sp3_ep13_tp3_pp2
	layer_9_expert_ar_sp3_ep13_pp2 [label="Expert All-Reduce L9 SP3 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep13_tp0_pp2 -> layer_9_expert_ar_sp3_ep13_pp2
	layer_9_expert_out_sp3_ep13_tp1_pp2 -> layer_9_expert_ar_sp3_ep13_pp2
	layer_9_expert_out_sp3_ep13_tp2_pp2 -> layer_9_expert_ar_sp3_ep13_pp2
	layer_9_expert_out_sp3_ep13_tp3_pp2 -> layer_9_expert_ar_sp3_ep13_pp2
	layer_9_combine_sp3_ep13_pp2 [label="Token Combine L9 SP3 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep13_pp2 -> layer_9_combine_sp3_ep13_pp2
	layer_9_dispatch_sp3_ep14_pp2 [label="Token Dispatch L9 SP3 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep14_pp2 [style=dashed]
	layer_9_expert_sp3_ep14_tp0_pp2 [label="Expert L9 SP3 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep14_pp2 -> layer_9_expert_sp3_ep14_tp0_pp2
	layer_9_expert_out_sp3_ep14_tp0_pp2 [label="Expert Out L9 SP3 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep14_tp0_pp2 -> layer_9_expert_out_sp3_ep14_tp0_pp2
	layer_9_expert_sp3_ep14_tp1_pp2 [label="Expert L9 SP3 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep14_pp2 -> layer_9_expert_sp3_ep14_tp1_pp2
	layer_9_expert_out_sp3_ep14_tp1_pp2 [label="Expert Out L9 SP3 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep14_tp1_pp2 -> layer_9_expert_out_sp3_ep14_tp1_pp2
	layer_9_expert_sp3_ep14_tp2_pp2 [label="Expert L9 SP3 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep14_pp2 -> layer_9_expert_sp3_ep14_tp2_pp2
	layer_9_expert_out_sp3_ep14_tp2_pp2 [label="Expert Out L9 SP3 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep14_tp2_pp2 -> layer_9_expert_out_sp3_ep14_tp2_pp2
	layer_9_expert_sp3_ep14_tp3_pp2 [label="Expert L9 SP3 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep14_pp2 -> layer_9_expert_sp3_ep14_tp3_pp2
	layer_9_expert_out_sp3_ep14_tp3_pp2 [label="Expert Out L9 SP3 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep14_tp3_pp2 -> layer_9_expert_out_sp3_ep14_tp3_pp2
	layer_9_expert_ar_sp3_ep14_pp2 [label="Expert All-Reduce L9 SP3 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep14_tp0_pp2 -> layer_9_expert_ar_sp3_ep14_pp2
	layer_9_expert_out_sp3_ep14_tp1_pp2 -> layer_9_expert_ar_sp3_ep14_pp2
	layer_9_expert_out_sp3_ep14_tp2_pp2 -> layer_9_expert_ar_sp3_ep14_pp2
	layer_9_expert_out_sp3_ep14_tp3_pp2 -> layer_9_expert_ar_sp3_ep14_pp2
	layer_9_combine_sp3_ep14_pp2 [label="Token Combine L9 SP3 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep14_pp2 -> layer_9_combine_sp3_ep14_pp2
	layer_9_dispatch_sp3_ep15_pp2 [label="Token Dispatch L9 SP3 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_9_router_sp3_pp2 -> layer_9_dispatch_sp3_ep15_pp2 [style=dashed]
	layer_9_expert_sp3_ep15_tp0_pp2 [label="Expert L9 SP3 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep15_pp2 -> layer_9_expert_sp3_ep15_tp0_pp2
	layer_9_expert_out_sp3_ep15_tp0_pp2 [label="Expert Out L9 SP3 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep15_tp0_pp2 -> layer_9_expert_out_sp3_ep15_tp0_pp2
	layer_9_expert_sp3_ep15_tp1_pp2 [label="Expert L9 SP3 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep15_pp2 -> layer_9_expert_sp3_ep15_tp1_pp2
	layer_9_expert_out_sp3_ep15_tp1_pp2 [label="Expert Out L9 SP3 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep15_tp1_pp2 -> layer_9_expert_out_sp3_ep15_tp1_pp2
	layer_9_expert_sp3_ep15_tp2_pp2 [label="Expert L9 SP3 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep15_pp2 -> layer_9_expert_sp3_ep15_tp2_pp2
	layer_9_expert_out_sp3_ep15_tp2_pp2 [label="Expert Out L9 SP3 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep15_tp2_pp2 -> layer_9_expert_out_sp3_ep15_tp2_pp2
	layer_9_expert_sp3_ep15_tp3_pp2 [label="Expert L9 SP3 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_dispatch_sp3_ep15_pp2 -> layer_9_expert_sp3_ep15_tp3_pp2
	layer_9_expert_out_sp3_ep15_tp3_pp2 [label="Expert Out L9 SP3 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_9_expert_sp3_ep15_tp3_pp2 -> layer_9_expert_out_sp3_ep15_tp3_pp2
	layer_9_expert_ar_sp3_ep15_pp2 [label="Expert All-Reduce L9 SP3 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_9_expert_out_sp3_ep15_tp0_pp2 -> layer_9_expert_ar_sp3_ep15_pp2
	layer_9_expert_out_sp3_ep15_tp1_pp2 -> layer_9_expert_ar_sp3_ep15_pp2
	layer_9_expert_out_sp3_ep15_tp2_pp2 -> layer_9_expert_ar_sp3_ep15_pp2
	layer_9_expert_out_sp3_ep15_tp3_pp2 -> layer_9_expert_ar_sp3_ep15_pp2
	layer_9_combine_sp3_ep15_pp2 [label="Token Combine L9 SP3 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_9_expert_ar_sp3_ep15_pp2 -> layer_9_combine_sp3_ep15_pp2
	layer_9_moe_all2all_sp3_pp2 [label="MoE All-to-All L9 SP3\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_9_combine_sp3_ep0_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep1_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep2_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep3_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep4_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep5_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep6_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep7_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep8_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep9_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep10_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep11_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep12_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep13_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep14_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_combine_sp3_ep15_pp2 -> layer_9_moe_all2all_sp3_pp2
	layer_9_mlp_out_sp3_pp2 [label="MoE Output L9 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_moe_all2all_sp3_pp2 -> layer_9_mlp_out_sp3_pp2
	layer_9_mlp_res_sp3_pp2 [label="MLP Residual L9 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_mlp_out_sp3_pp2 -> layer_9_mlp_res_sp3_pp2
	layer_9_attn_res_sp3_pp2 -> layer_9_mlp_res_sp3_pp2 [style=dashed]
	layer_10_norm_sp0_pp2 [label="LayerNorm L10 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_mlp_out_sp0_pp2 -> layer_10_norm_sp0_pp2
	layer_10_qkv_sp0_tp0_pp2 [label="QKV Proj L10 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp0_pp2 -> layer_10_qkv_sp0_tp0_pp2
	layer_10_attn_sp0_tp0_pp2 [label="Attention L10 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp0_tp0_pp2 -> layer_10_attn_sp0_tp0_pp2
	layer_10_attn_out_sp0_tp0_pp2 [label="Attn Out Proj L10 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp0_tp0_pp2 -> layer_10_attn_out_sp0_tp0_pp2
	layer_10_qkv_sp0_tp1_pp2 [label="QKV Proj L10 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp0_pp2 -> layer_10_qkv_sp0_tp1_pp2
	layer_10_attn_sp0_tp1_pp2 [label="Attention L10 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp0_tp1_pp2 -> layer_10_attn_sp0_tp1_pp2
	layer_10_attn_out_sp0_tp1_pp2 [label="Attn Out Proj L10 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp0_tp1_pp2 -> layer_10_attn_out_sp0_tp1_pp2
	layer_10_qkv_sp0_tp2_pp2 [label="QKV Proj L10 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp0_pp2 -> layer_10_qkv_sp0_tp2_pp2
	layer_10_attn_sp0_tp2_pp2 [label="Attention L10 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp0_tp2_pp2 -> layer_10_attn_sp0_tp2_pp2
	layer_10_attn_out_sp0_tp2_pp2 [label="Attn Out Proj L10 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp0_tp2_pp2 -> layer_10_attn_out_sp0_tp2_pp2
	layer_10_qkv_sp0_tp3_pp2 [label="QKV Proj L10 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp0_pp2 -> layer_10_qkv_sp0_tp3_pp2
	layer_10_attn_sp0_tp3_pp2 [label="Attention L10 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp0_tp3_pp2 -> layer_10_attn_sp0_tp3_pp2
	layer_10_attn_out_sp0_tp3_pp2 [label="Attn Out Proj L10 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp0_tp3_pp2 -> layer_10_attn_out_sp0_tp3_pp2
	layer_10_attn_ar_sp0_pp2 [label="Attention All-Reduce L10 SP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_attn_out_sp0_tp0_pp2 -> layer_10_attn_ar_sp0_pp2
	layer_10_attn_out_sp0_tp1_pp2 -> layer_10_attn_ar_sp0_pp2
	layer_10_attn_out_sp0_tp2_pp2 -> layer_10_attn_ar_sp0_pp2
	layer_10_attn_out_sp0_tp3_pp2 -> layer_10_attn_ar_sp0_pp2
	layer_10_attn_res_sp0_pp2 [label="Attention Residual L10 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_attn_ar_sp0_pp2 -> layer_10_attn_res_sp0_pp2
	layer_10_norm_sp0_pp2 -> layer_10_attn_res_sp0_pp2 [style=dashed]
	layer_10_post_norm_sp0_pp2 [label="Post-Attn Norm L10 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_attn_res_sp0_pp2 -> layer_10_post_norm_sp0_pp2
	layer_10_router_sp0_pp2 [label="MoE Router L10 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_10_post_norm_sp0_pp2 -> layer_10_router_sp0_pp2
	layer_10_dispatch_sp0_ep0_pp2 [label="Token Dispatch L10 SP0 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep0_pp2 [style=dashed]
	layer_10_expert_sp0_ep0_tp0_pp2 [label="Expert L10 SP0 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep0_pp2 -> layer_10_expert_sp0_ep0_tp0_pp2
	layer_10_expert_out_sp0_ep0_tp0_pp2 [label="Expert Out L10 SP0 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep0_tp0_pp2 -> layer_10_expert_out_sp0_ep0_tp0_pp2
	layer_10_expert_sp0_ep0_tp1_pp2 [label="Expert L10 SP0 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep0_pp2 -> layer_10_expert_sp0_ep0_tp1_pp2
	layer_10_expert_out_sp0_ep0_tp1_pp2 [label="Expert Out L10 SP0 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep0_tp1_pp2 -> layer_10_expert_out_sp0_ep0_tp1_pp2
	layer_10_expert_sp0_ep0_tp2_pp2 [label="Expert L10 SP0 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep0_pp2 -> layer_10_expert_sp0_ep0_tp2_pp2
	layer_10_expert_out_sp0_ep0_tp2_pp2 [label="Expert Out L10 SP0 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep0_tp2_pp2 -> layer_10_expert_out_sp0_ep0_tp2_pp2
	layer_10_expert_sp0_ep0_tp3_pp2 [label="Expert L10 SP0 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep0_pp2 -> layer_10_expert_sp0_ep0_tp3_pp2
	layer_10_expert_out_sp0_ep0_tp3_pp2 [label="Expert Out L10 SP0 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep0_tp3_pp2 -> layer_10_expert_out_sp0_ep0_tp3_pp2
	layer_10_expert_ar_sp0_ep0_pp2 [label="Expert All-Reduce L10 SP0 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep0_tp0_pp2 -> layer_10_expert_ar_sp0_ep0_pp2
	layer_10_expert_out_sp0_ep0_tp1_pp2 -> layer_10_expert_ar_sp0_ep0_pp2
	layer_10_expert_out_sp0_ep0_tp2_pp2 -> layer_10_expert_ar_sp0_ep0_pp2
	layer_10_expert_out_sp0_ep0_tp3_pp2 -> layer_10_expert_ar_sp0_ep0_pp2
	layer_10_combine_sp0_ep0_pp2 [label="Token Combine L10 SP0 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep0_pp2 -> layer_10_combine_sp0_ep0_pp2
	layer_10_dispatch_sp0_ep1_pp2 [label="Token Dispatch L10 SP0 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep1_pp2 [style=dashed]
	layer_10_expert_sp0_ep1_tp0_pp2 [label="Expert L10 SP0 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep1_pp2 -> layer_10_expert_sp0_ep1_tp0_pp2
	layer_10_expert_out_sp0_ep1_tp0_pp2 [label="Expert Out L10 SP0 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep1_tp0_pp2 -> layer_10_expert_out_sp0_ep1_tp0_pp2
	layer_10_expert_sp0_ep1_tp1_pp2 [label="Expert L10 SP0 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep1_pp2 -> layer_10_expert_sp0_ep1_tp1_pp2
	layer_10_expert_out_sp0_ep1_tp1_pp2 [label="Expert Out L10 SP0 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep1_tp1_pp2 -> layer_10_expert_out_sp0_ep1_tp1_pp2
	layer_10_expert_sp0_ep1_tp2_pp2 [label="Expert L10 SP0 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep1_pp2 -> layer_10_expert_sp0_ep1_tp2_pp2
	layer_10_expert_out_sp0_ep1_tp2_pp2 [label="Expert Out L10 SP0 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep1_tp2_pp2 -> layer_10_expert_out_sp0_ep1_tp2_pp2
	layer_10_expert_sp0_ep1_tp3_pp2 [label="Expert L10 SP0 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep1_pp2 -> layer_10_expert_sp0_ep1_tp3_pp2
	layer_10_expert_out_sp0_ep1_tp3_pp2 [label="Expert Out L10 SP0 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep1_tp3_pp2 -> layer_10_expert_out_sp0_ep1_tp3_pp2
	layer_10_expert_ar_sp0_ep1_pp2 [label="Expert All-Reduce L10 SP0 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep1_tp0_pp2 -> layer_10_expert_ar_sp0_ep1_pp2
	layer_10_expert_out_sp0_ep1_tp1_pp2 -> layer_10_expert_ar_sp0_ep1_pp2
	layer_10_expert_out_sp0_ep1_tp2_pp2 -> layer_10_expert_ar_sp0_ep1_pp2
	layer_10_expert_out_sp0_ep1_tp3_pp2 -> layer_10_expert_ar_sp0_ep1_pp2
	layer_10_combine_sp0_ep1_pp2 [label="Token Combine L10 SP0 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep1_pp2 -> layer_10_combine_sp0_ep1_pp2
	layer_10_dispatch_sp0_ep2_pp2 [label="Token Dispatch L10 SP0 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep2_pp2 [style=dashed]
	layer_10_expert_sp0_ep2_tp0_pp2 [label="Expert L10 SP0 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep2_pp2 -> layer_10_expert_sp0_ep2_tp0_pp2
	layer_10_expert_out_sp0_ep2_tp0_pp2 [label="Expert Out L10 SP0 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep2_tp0_pp2 -> layer_10_expert_out_sp0_ep2_tp0_pp2
	layer_10_expert_sp0_ep2_tp1_pp2 [label="Expert L10 SP0 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep2_pp2 -> layer_10_expert_sp0_ep2_tp1_pp2
	layer_10_expert_out_sp0_ep2_tp1_pp2 [label="Expert Out L10 SP0 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep2_tp1_pp2 -> layer_10_expert_out_sp0_ep2_tp1_pp2
	layer_10_expert_sp0_ep2_tp2_pp2 [label="Expert L10 SP0 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep2_pp2 -> layer_10_expert_sp0_ep2_tp2_pp2
	layer_10_expert_out_sp0_ep2_tp2_pp2 [label="Expert Out L10 SP0 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep2_tp2_pp2 -> layer_10_expert_out_sp0_ep2_tp2_pp2
	layer_10_expert_sp0_ep2_tp3_pp2 [label="Expert L10 SP0 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep2_pp2 -> layer_10_expert_sp0_ep2_tp3_pp2
	layer_10_expert_out_sp0_ep2_tp3_pp2 [label="Expert Out L10 SP0 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep2_tp3_pp2 -> layer_10_expert_out_sp0_ep2_tp3_pp2
	layer_10_expert_ar_sp0_ep2_pp2 [label="Expert All-Reduce L10 SP0 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep2_tp0_pp2 -> layer_10_expert_ar_sp0_ep2_pp2
	layer_10_expert_out_sp0_ep2_tp1_pp2 -> layer_10_expert_ar_sp0_ep2_pp2
	layer_10_expert_out_sp0_ep2_tp2_pp2 -> layer_10_expert_ar_sp0_ep2_pp2
	layer_10_expert_out_sp0_ep2_tp3_pp2 -> layer_10_expert_ar_sp0_ep2_pp2
	layer_10_combine_sp0_ep2_pp2 [label="Token Combine L10 SP0 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep2_pp2 -> layer_10_combine_sp0_ep2_pp2
	layer_10_dispatch_sp0_ep3_pp2 [label="Token Dispatch L10 SP0 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep3_pp2 [style=dashed]
	layer_10_expert_sp0_ep3_tp0_pp2 [label="Expert L10 SP0 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep3_pp2 -> layer_10_expert_sp0_ep3_tp0_pp2
	layer_10_expert_out_sp0_ep3_tp0_pp2 [label="Expert Out L10 SP0 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep3_tp0_pp2 -> layer_10_expert_out_sp0_ep3_tp0_pp2
	layer_10_expert_sp0_ep3_tp1_pp2 [label="Expert L10 SP0 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep3_pp2 -> layer_10_expert_sp0_ep3_tp1_pp2
	layer_10_expert_out_sp0_ep3_tp1_pp2 [label="Expert Out L10 SP0 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep3_tp1_pp2 -> layer_10_expert_out_sp0_ep3_tp1_pp2
	layer_10_expert_sp0_ep3_tp2_pp2 [label="Expert L10 SP0 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep3_pp2 -> layer_10_expert_sp0_ep3_tp2_pp2
	layer_10_expert_out_sp0_ep3_tp2_pp2 [label="Expert Out L10 SP0 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep3_tp2_pp2 -> layer_10_expert_out_sp0_ep3_tp2_pp2
	layer_10_expert_sp0_ep3_tp3_pp2 [label="Expert L10 SP0 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep3_pp2 -> layer_10_expert_sp0_ep3_tp3_pp2
	layer_10_expert_out_sp0_ep3_tp3_pp2 [label="Expert Out L10 SP0 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep3_tp3_pp2 -> layer_10_expert_out_sp0_ep3_tp3_pp2
	layer_10_expert_ar_sp0_ep3_pp2 [label="Expert All-Reduce L10 SP0 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep3_tp0_pp2 -> layer_10_expert_ar_sp0_ep3_pp2
	layer_10_expert_out_sp0_ep3_tp1_pp2 -> layer_10_expert_ar_sp0_ep3_pp2
	layer_10_expert_out_sp0_ep3_tp2_pp2 -> layer_10_expert_ar_sp0_ep3_pp2
	layer_10_expert_out_sp0_ep3_tp3_pp2 -> layer_10_expert_ar_sp0_ep3_pp2
	layer_10_combine_sp0_ep3_pp2 [label="Token Combine L10 SP0 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep3_pp2 -> layer_10_combine_sp0_ep3_pp2
	layer_10_dispatch_sp0_ep4_pp2 [label="Token Dispatch L10 SP0 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep4_pp2 [style=dashed]
	layer_10_expert_sp0_ep4_tp0_pp2 [label="Expert L10 SP0 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep4_pp2 -> layer_10_expert_sp0_ep4_tp0_pp2
	layer_10_expert_out_sp0_ep4_tp0_pp2 [label="Expert Out L10 SP0 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep4_tp0_pp2 -> layer_10_expert_out_sp0_ep4_tp0_pp2
	layer_10_expert_sp0_ep4_tp1_pp2 [label="Expert L10 SP0 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep4_pp2 -> layer_10_expert_sp0_ep4_tp1_pp2
	layer_10_expert_out_sp0_ep4_tp1_pp2 [label="Expert Out L10 SP0 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep4_tp1_pp2 -> layer_10_expert_out_sp0_ep4_tp1_pp2
	layer_10_expert_sp0_ep4_tp2_pp2 [label="Expert L10 SP0 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep4_pp2 -> layer_10_expert_sp0_ep4_tp2_pp2
	layer_10_expert_out_sp0_ep4_tp2_pp2 [label="Expert Out L10 SP0 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep4_tp2_pp2 -> layer_10_expert_out_sp0_ep4_tp2_pp2
	layer_10_expert_sp0_ep4_tp3_pp2 [label="Expert L10 SP0 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep4_pp2 -> layer_10_expert_sp0_ep4_tp3_pp2
	layer_10_expert_out_sp0_ep4_tp3_pp2 [label="Expert Out L10 SP0 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep4_tp3_pp2 -> layer_10_expert_out_sp0_ep4_tp3_pp2
	layer_10_expert_ar_sp0_ep4_pp2 [label="Expert All-Reduce L10 SP0 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep4_tp0_pp2 -> layer_10_expert_ar_sp0_ep4_pp2
	layer_10_expert_out_sp0_ep4_tp1_pp2 -> layer_10_expert_ar_sp0_ep4_pp2
	layer_10_expert_out_sp0_ep4_tp2_pp2 -> layer_10_expert_ar_sp0_ep4_pp2
	layer_10_expert_out_sp0_ep4_tp3_pp2 -> layer_10_expert_ar_sp0_ep4_pp2
	layer_10_combine_sp0_ep4_pp2 [label="Token Combine L10 SP0 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep4_pp2 -> layer_10_combine_sp0_ep4_pp2
	layer_10_dispatch_sp0_ep5_pp2 [label="Token Dispatch L10 SP0 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep5_pp2 [style=dashed]
	layer_10_expert_sp0_ep5_tp0_pp2 [label="Expert L10 SP0 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep5_pp2 -> layer_10_expert_sp0_ep5_tp0_pp2
	layer_10_expert_out_sp0_ep5_tp0_pp2 [label="Expert Out L10 SP0 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep5_tp0_pp2 -> layer_10_expert_out_sp0_ep5_tp0_pp2
	layer_10_expert_sp0_ep5_tp1_pp2 [label="Expert L10 SP0 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep5_pp2 -> layer_10_expert_sp0_ep5_tp1_pp2
	layer_10_expert_out_sp0_ep5_tp1_pp2 [label="Expert Out L10 SP0 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep5_tp1_pp2 -> layer_10_expert_out_sp0_ep5_tp1_pp2
	layer_10_expert_sp0_ep5_tp2_pp2 [label="Expert L10 SP0 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep5_pp2 -> layer_10_expert_sp0_ep5_tp2_pp2
	layer_10_expert_out_sp0_ep5_tp2_pp2 [label="Expert Out L10 SP0 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep5_tp2_pp2 -> layer_10_expert_out_sp0_ep5_tp2_pp2
	layer_10_expert_sp0_ep5_tp3_pp2 [label="Expert L10 SP0 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep5_pp2 -> layer_10_expert_sp0_ep5_tp3_pp2
	layer_10_expert_out_sp0_ep5_tp3_pp2 [label="Expert Out L10 SP0 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep5_tp3_pp2 -> layer_10_expert_out_sp0_ep5_tp3_pp2
	layer_10_expert_ar_sp0_ep5_pp2 [label="Expert All-Reduce L10 SP0 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep5_tp0_pp2 -> layer_10_expert_ar_sp0_ep5_pp2
	layer_10_expert_out_sp0_ep5_tp1_pp2 -> layer_10_expert_ar_sp0_ep5_pp2
	layer_10_expert_out_sp0_ep5_tp2_pp2 -> layer_10_expert_ar_sp0_ep5_pp2
	layer_10_expert_out_sp0_ep5_tp3_pp2 -> layer_10_expert_ar_sp0_ep5_pp2
	layer_10_combine_sp0_ep5_pp2 [label="Token Combine L10 SP0 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep5_pp2 -> layer_10_combine_sp0_ep5_pp2
	layer_10_dispatch_sp0_ep6_pp2 [label="Token Dispatch L10 SP0 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep6_pp2 [style=dashed]
	layer_10_expert_sp0_ep6_tp0_pp2 [label="Expert L10 SP0 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep6_pp2 -> layer_10_expert_sp0_ep6_tp0_pp2
	layer_10_expert_out_sp0_ep6_tp0_pp2 [label="Expert Out L10 SP0 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep6_tp0_pp2 -> layer_10_expert_out_sp0_ep6_tp0_pp2
	layer_10_expert_sp0_ep6_tp1_pp2 [label="Expert L10 SP0 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep6_pp2 -> layer_10_expert_sp0_ep6_tp1_pp2
	layer_10_expert_out_sp0_ep6_tp1_pp2 [label="Expert Out L10 SP0 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep6_tp1_pp2 -> layer_10_expert_out_sp0_ep6_tp1_pp2
	layer_10_expert_sp0_ep6_tp2_pp2 [label="Expert L10 SP0 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep6_pp2 -> layer_10_expert_sp0_ep6_tp2_pp2
	layer_10_expert_out_sp0_ep6_tp2_pp2 [label="Expert Out L10 SP0 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep6_tp2_pp2 -> layer_10_expert_out_sp0_ep6_tp2_pp2
	layer_10_expert_sp0_ep6_tp3_pp2 [label="Expert L10 SP0 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep6_pp2 -> layer_10_expert_sp0_ep6_tp3_pp2
	layer_10_expert_out_sp0_ep6_tp3_pp2 [label="Expert Out L10 SP0 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep6_tp3_pp2 -> layer_10_expert_out_sp0_ep6_tp3_pp2
	layer_10_expert_ar_sp0_ep6_pp2 [label="Expert All-Reduce L10 SP0 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep6_tp0_pp2 -> layer_10_expert_ar_sp0_ep6_pp2
	layer_10_expert_out_sp0_ep6_tp1_pp2 -> layer_10_expert_ar_sp0_ep6_pp2
	layer_10_expert_out_sp0_ep6_tp2_pp2 -> layer_10_expert_ar_sp0_ep6_pp2
	layer_10_expert_out_sp0_ep6_tp3_pp2 -> layer_10_expert_ar_sp0_ep6_pp2
	layer_10_combine_sp0_ep6_pp2 [label="Token Combine L10 SP0 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep6_pp2 -> layer_10_combine_sp0_ep6_pp2
	layer_10_dispatch_sp0_ep7_pp2 [label="Token Dispatch L10 SP0 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep7_pp2 [style=dashed]
	layer_10_expert_sp0_ep7_tp0_pp2 [label="Expert L10 SP0 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep7_pp2 -> layer_10_expert_sp0_ep7_tp0_pp2
	layer_10_expert_out_sp0_ep7_tp0_pp2 [label="Expert Out L10 SP0 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep7_tp0_pp2 -> layer_10_expert_out_sp0_ep7_tp0_pp2
	layer_10_expert_sp0_ep7_tp1_pp2 [label="Expert L10 SP0 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep7_pp2 -> layer_10_expert_sp0_ep7_tp1_pp2
	layer_10_expert_out_sp0_ep7_tp1_pp2 [label="Expert Out L10 SP0 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep7_tp1_pp2 -> layer_10_expert_out_sp0_ep7_tp1_pp2
	layer_10_expert_sp0_ep7_tp2_pp2 [label="Expert L10 SP0 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep7_pp2 -> layer_10_expert_sp0_ep7_tp2_pp2
	layer_10_expert_out_sp0_ep7_tp2_pp2 [label="Expert Out L10 SP0 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep7_tp2_pp2 -> layer_10_expert_out_sp0_ep7_tp2_pp2
	layer_10_expert_sp0_ep7_tp3_pp2 [label="Expert L10 SP0 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep7_pp2 -> layer_10_expert_sp0_ep7_tp3_pp2
	layer_10_expert_out_sp0_ep7_tp3_pp2 [label="Expert Out L10 SP0 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep7_tp3_pp2 -> layer_10_expert_out_sp0_ep7_tp3_pp2
	layer_10_expert_ar_sp0_ep7_pp2 [label="Expert All-Reduce L10 SP0 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep7_tp0_pp2 -> layer_10_expert_ar_sp0_ep7_pp2
	layer_10_expert_out_sp0_ep7_tp1_pp2 -> layer_10_expert_ar_sp0_ep7_pp2
	layer_10_expert_out_sp0_ep7_tp2_pp2 -> layer_10_expert_ar_sp0_ep7_pp2
	layer_10_expert_out_sp0_ep7_tp3_pp2 -> layer_10_expert_ar_sp0_ep7_pp2
	layer_10_combine_sp0_ep7_pp2 [label="Token Combine L10 SP0 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep7_pp2 -> layer_10_combine_sp0_ep7_pp2
	layer_10_dispatch_sp0_ep8_pp2 [label="Token Dispatch L10 SP0 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep8_pp2 [style=dashed]
	layer_10_expert_sp0_ep8_tp0_pp2 [label="Expert L10 SP0 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep8_pp2 -> layer_10_expert_sp0_ep8_tp0_pp2
	layer_10_expert_out_sp0_ep8_tp0_pp2 [label="Expert Out L10 SP0 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep8_tp0_pp2 -> layer_10_expert_out_sp0_ep8_tp0_pp2
	layer_10_expert_sp0_ep8_tp1_pp2 [label="Expert L10 SP0 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep8_pp2 -> layer_10_expert_sp0_ep8_tp1_pp2
	layer_10_expert_out_sp0_ep8_tp1_pp2 [label="Expert Out L10 SP0 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep8_tp1_pp2 -> layer_10_expert_out_sp0_ep8_tp1_pp2
	layer_10_expert_sp0_ep8_tp2_pp2 [label="Expert L10 SP0 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep8_pp2 -> layer_10_expert_sp0_ep8_tp2_pp2
	layer_10_expert_out_sp0_ep8_tp2_pp2 [label="Expert Out L10 SP0 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep8_tp2_pp2 -> layer_10_expert_out_sp0_ep8_tp2_pp2
	layer_10_expert_sp0_ep8_tp3_pp2 [label="Expert L10 SP0 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep8_pp2 -> layer_10_expert_sp0_ep8_tp3_pp2
	layer_10_expert_out_sp0_ep8_tp3_pp2 [label="Expert Out L10 SP0 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep8_tp3_pp2 -> layer_10_expert_out_sp0_ep8_tp3_pp2
	layer_10_expert_ar_sp0_ep8_pp2 [label="Expert All-Reduce L10 SP0 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep8_tp0_pp2 -> layer_10_expert_ar_sp0_ep8_pp2
	layer_10_expert_out_sp0_ep8_tp1_pp2 -> layer_10_expert_ar_sp0_ep8_pp2
	layer_10_expert_out_sp0_ep8_tp2_pp2 -> layer_10_expert_ar_sp0_ep8_pp2
	layer_10_expert_out_sp0_ep8_tp3_pp2 -> layer_10_expert_ar_sp0_ep8_pp2
	layer_10_combine_sp0_ep8_pp2 [label="Token Combine L10 SP0 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep8_pp2 -> layer_10_combine_sp0_ep8_pp2
	layer_10_dispatch_sp0_ep9_pp2 [label="Token Dispatch L10 SP0 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep9_pp2 [style=dashed]
	layer_10_expert_sp0_ep9_tp0_pp2 [label="Expert L10 SP0 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep9_pp2 -> layer_10_expert_sp0_ep9_tp0_pp2
	layer_10_expert_out_sp0_ep9_tp0_pp2 [label="Expert Out L10 SP0 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep9_tp0_pp2 -> layer_10_expert_out_sp0_ep9_tp0_pp2
	layer_10_expert_sp0_ep9_tp1_pp2 [label="Expert L10 SP0 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep9_pp2 -> layer_10_expert_sp0_ep9_tp1_pp2
	layer_10_expert_out_sp0_ep9_tp1_pp2 [label="Expert Out L10 SP0 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep9_tp1_pp2 -> layer_10_expert_out_sp0_ep9_tp1_pp2
	layer_10_expert_sp0_ep9_tp2_pp2 [label="Expert L10 SP0 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep9_pp2 -> layer_10_expert_sp0_ep9_tp2_pp2
	layer_10_expert_out_sp0_ep9_tp2_pp2 [label="Expert Out L10 SP0 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep9_tp2_pp2 -> layer_10_expert_out_sp0_ep9_tp2_pp2
	layer_10_expert_sp0_ep9_tp3_pp2 [label="Expert L10 SP0 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep9_pp2 -> layer_10_expert_sp0_ep9_tp3_pp2
	layer_10_expert_out_sp0_ep9_tp3_pp2 [label="Expert Out L10 SP0 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep9_tp3_pp2 -> layer_10_expert_out_sp0_ep9_tp3_pp2
	layer_10_expert_ar_sp0_ep9_pp2 [label="Expert All-Reduce L10 SP0 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep9_tp0_pp2 -> layer_10_expert_ar_sp0_ep9_pp2
	layer_10_expert_out_sp0_ep9_tp1_pp2 -> layer_10_expert_ar_sp0_ep9_pp2
	layer_10_expert_out_sp0_ep9_tp2_pp2 -> layer_10_expert_ar_sp0_ep9_pp2
	layer_10_expert_out_sp0_ep9_tp3_pp2 -> layer_10_expert_ar_sp0_ep9_pp2
	layer_10_combine_sp0_ep9_pp2 [label="Token Combine L10 SP0 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep9_pp2 -> layer_10_combine_sp0_ep9_pp2
	layer_10_dispatch_sp0_ep10_pp2 [label="Token Dispatch L10 SP0 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep10_pp2 [style=dashed]
	layer_10_expert_sp0_ep10_tp0_pp2 [label="Expert L10 SP0 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep10_pp2 -> layer_10_expert_sp0_ep10_tp0_pp2
	layer_10_expert_out_sp0_ep10_tp0_pp2 [label="Expert Out L10 SP0 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep10_tp0_pp2 -> layer_10_expert_out_sp0_ep10_tp0_pp2
	layer_10_expert_sp0_ep10_tp1_pp2 [label="Expert L10 SP0 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep10_pp2 -> layer_10_expert_sp0_ep10_tp1_pp2
	layer_10_expert_out_sp0_ep10_tp1_pp2 [label="Expert Out L10 SP0 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep10_tp1_pp2 -> layer_10_expert_out_sp0_ep10_tp1_pp2
	layer_10_expert_sp0_ep10_tp2_pp2 [label="Expert L10 SP0 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep10_pp2 -> layer_10_expert_sp0_ep10_tp2_pp2
	layer_10_expert_out_sp0_ep10_tp2_pp2 [label="Expert Out L10 SP0 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep10_tp2_pp2 -> layer_10_expert_out_sp0_ep10_tp2_pp2
	layer_10_expert_sp0_ep10_tp3_pp2 [label="Expert L10 SP0 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep10_pp2 -> layer_10_expert_sp0_ep10_tp3_pp2
	layer_10_expert_out_sp0_ep10_tp3_pp2 [label="Expert Out L10 SP0 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep10_tp3_pp2 -> layer_10_expert_out_sp0_ep10_tp3_pp2
	layer_10_expert_ar_sp0_ep10_pp2 [label="Expert All-Reduce L10 SP0 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep10_tp0_pp2 -> layer_10_expert_ar_sp0_ep10_pp2
	layer_10_expert_out_sp0_ep10_tp1_pp2 -> layer_10_expert_ar_sp0_ep10_pp2
	layer_10_expert_out_sp0_ep10_tp2_pp2 -> layer_10_expert_ar_sp0_ep10_pp2
	layer_10_expert_out_sp0_ep10_tp3_pp2 -> layer_10_expert_ar_sp0_ep10_pp2
	layer_10_combine_sp0_ep10_pp2 [label="Token Combine L10 SP0 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep10_pp2 -> layer_10_combine_sp0_ep10_pp2
	layer_10_dispatch_sp0_ep11_pp2 [label="Token Dispatch L10 SP0 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep11_pp2 [style=dashed]
	layer_10_expert_sp0_ep11_tp0_pp2 [label="Expert L10 SP0 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep11_pp2 -> layer_10_expert_sp0_ep11_tp0_pp2
	layer_10_expert_out_sp0_ep11_tp0_pp2 [label="Expert Out L10 SP0 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep11_tp0_pp2 -> layer_10_expert_out_sp0_ep11_tp0_pp2
	layer_10_expert_sp0_ep11_tp1_pp2 [label="Expert L10 SP0 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep11_pp2 -> layer_10_expert_sp0_ep11_tp1_pp2
	layer_10_expert_out_sp0_ep11_tp1_pp2 [label="Expert Out L10 SP0 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep11_tp1_pp2 -> layer_10_expert_out_sp0_ep11_tp1_pp2
	layer_10_expert_sp0_ep11_tp2_pp2 [label="Expert L10 SP0 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep11_pp2 -> layer_10_expert_sp0_ep11_tp2_pp2
	layer_10_expert_out_sp0_ep11_tp2_pp2 [label="Expert Out L10 SP0 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep11_tp2_pp2 -> layer_10_expert_out_sp0_ep11_tp2_pp2
	layer_10_expert_sp0_ep11_tp3_pp2 [label="Expert L10 SP0 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep11_pp2 -> layer_10_expert_sp0_ep11_tp3_pp2
	layer_10_expert_out_sp0_ep11_tp3_pp2 [label="Expert Out L10 SP0 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep11_tp3_pp2 -> layer_10_expert_out_sp0_ep11_tp3_pp2
	layer_10_expert_ar_sp0_ep11_pp2 [label="Expert All-Reduce L10 SP0 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep11_tp0_pp2 -> layer_10_expert_ar_sp0_ep11_pp2
	layer_10_expert_out_sp0_ep11_tp1_pp2 -> layer_10_expert_ar_sp0_ep11_pp2
	layer_10_expert_out_sp0_ep11_tp2_pp2 -> layer_10_expert_ar_sp0_ep11_pp2
	layer_10_expert_out_sp0_ep11_tp3_pp2 -> layer_10_expert_ar_sp0_ep11_pp2
	layer_10_combine_sp0_ep11_pp2 [label="Token Combine L10 SP0 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep11_pp2 -> layer_10_combine_sp0_ep11_pp2
	layer_10_dispatch_sp0_ep12_pp2 [label="Token Dispatch L10 SP0 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep12_pp2 [style=dashed]
	layer_10_expert_sp0_ep12_tp0_pp2 [label="Expert L10 SP0 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep12_pp2 -> layer_10_expert_sp0_ep12_tp0_pp2
	layer_10_expert_out_sp0_ep12_tp0_pp2 [label="Expert Out L10 SP0 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep12_tp0_pp2 -> layer_10_expert_out_sp0_ep12_tp0_pp2
	layer_10_expert_sp0_ep12_tp1_pp2 [label="Expert L10 SP0 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep12_pp2 -> layer_10_expert_sp0_ep12_tp1_pp2
	layer_10_expert_out_sp0_ep12_tp1_pp2 [label="Expert Out L10 SP0 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep12_tp1_pp2 -> layer_10_expert_out_sp0_ep12_tp1_pp2
	layer_10_expert_sp0_ep12_tp2_pp2 [label="Expert L10 SP0 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep12_pp2 -> layer_10_expert_sp0_ep12_tp2_pp2
	layer_10_expert_out_sp0_ep12_tp2_pp2 [label="Expert Out L10 SP0 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep12_tp2_pp2 -> layer_10_expert_out_sp0_ep12_tp2_pp2
	layer_10_expert_sp0_ep12_tp3_pp2 [label="Expert L10 SP0 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep12_pp2 -> layer_10_expert_sp0_ep12_tp3_pp2
	layer_10_expert_out_sp0_ep12_tp3_pp2 [label="Expert Out L10 SP0 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep12_tp3_pp2 -> layer_10_expert_out_sp0_ep12_tp3_pp2
	layer_10_expert_ar_sp0_ep12_pp2 [label="Expert All-Reduce L10 SP0 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep12_tp0_pp2 -> layer_10_expert_ar_sp0_ep12_pp2
	layer_10_expert_out_sp0_ep12_tp1_pp2 -> layer_10_expert_ar_sp0_ep12_pp2
	layer_10_expert_out_sp0_ep12_tp2_pp2 -> layer_10_expert_ar_sp0_ep12_pp2
	layer_10_expert_out_sp0_ep12_tp3_pp2 -> layer_10_expert_ar_sp0_ep12_pp2
	layer_10_combine_sp0_ep12_pp2 [label="Token Combine L10 SP0 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep12_pp2 -> layer_10_combine_sp0_ep12_pp2
	layer_10_dispatch_sp0_ep13_pp2 [label="Token Dispatch L10 SP0 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep13_pp2 [style=dashed]
	layer_10_expert_sp0_ep13_tp0_pp2 [label="Expert L10 SP0 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep13_pp2 -> layer_10_expert_sp0_ep13_tp0_pp2
	layer_10_expert_out_sp0_ep13_tp0_pp2 [label="Expert Out L10 SP0 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep13_tp0_pp2 -> layer_10_expert_out_sp0_ep13_tp0_pp2
	layer_10_expert_sp0_ep13_tp1_pp2 [label="Expert L10 SP0 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep13_pp2 -> layer_10_expert_sp0_ep13_tp1_pp2
	layer_10_expert_out_sp0_ep13_tp1_pp2 [label="Expert Out L10 SP0 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep13_tp1_pp2 -> layer_10_expert_out_sp0_ep13_tp1_pp2
	layer_10_expert_sp0_ep13_tp2_pp2 [label="Expert L10 SP0 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep13_pp2 -> layer_10_expert_sp0_ep13_tp2_pp2
	layer_10_expert_out_sp0_ep13_tp2_pp2 [label="Expert Out L10 SP0 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep13_tp2_pp2 -> layer_10_expert_out_sp0_ep13_tp2_pp2
	layer_10_expert_sp0_ep13_tp3_pp2 [label="Expert L10 SP0 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep13_pp2 -> layer_10_expert_sp0_ep13_tp3_pp2
	layer_10_expert_out_sp0_ep13_tp3_pp2 [label="Expert Out L10 SP0 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep13_tp3_pp2 -> layer_10_expert_out_sp0_ep13_tp3_pp2
	layer_10_expert_ar_sp0_ep13_pp2 [label="Expert All-Reduce L10 SP0 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep13_tp0_pp2 -> layer_10_expert_ar_sp0_ep13_pp2
	layer_10_expert_out_sp0_ep13_tp1_pp2 -> layer_10_expert_ar_sp0_ep13_pp2
	layer_10_expert_out_sp0_ep13_tp2_pp2 -> layer_10_expert_ar_sp0_ep13_pp2
	layer_10_expert_out_sp0_ep13_tp3_pp2 -> layer_10_expert_ar_sp0_ep13_pp2
	layer_10_combine_sp0_ep13_pp2 [label="Token Combine L10 SP0 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep13_pp2 -> layer_10_combine_sp0_ep13_pp2
	layer_10_dispatch_sp0_ep14_pp2 [label="Token Dispatch L10 SP0 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep14_pp2 [style=dashed]
	layer_10_expert_sp0_ep14_tp0_pp2 [label="Expert L10 SP0 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep14_pp2 -> layer_10_expert_sp0_ep14_tp0_pp2
	layer_10_expert_out_sp0_ep14_tp0_pp2 [label="Expert Out L10 SP0 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep14_tp0_pp2 -> layer_10_expert_out_sp0_ep14_tp0_pp2
	layer_10_expert_sp0_ep14_tp1_pp2 [label="Expert L10 SP0 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep14_pp2 -> layer_10_expert_sp0_ep14_tp1_pp2
	layer_10_expert_out_sp0_ep14_tp1_pp2 [label="Expert Out L10 SP0 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep14_tp1_pp2 -> layer_10_expert_out_sp0_ep14_tp1_pp2
	layer_10_expert_sp0_ep14_tp2_pp2 [label="Expert L10 SP0 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep14_pp2 -> layer_10_expert_sp0_ep14_tp2_pp2
	layer_10_expert_out_sp0_ep14_tp2_pp2 [label="Expert Out L10 SP0 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep14_tp2_pp2 -> layer_10_expert_out_sp0_ep14_tp2_pp2
	layer_10_expert_sp0_ep14_tp3_pp2 [label="Expert L10 SP0 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep14_pp2 -> layer_10_expert_sp0_ep14_tp3_pp2
	layer_10_expert_out_sp0_ep14_tp3_pp2 [label="Expert Out L10 SP0 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep14_tp3_pp2 -> layer_10_expert_out_sp0_ep14_tp3_pp2
	layer_10_expert_ar_sp0_ep14_pp2 [label="Expert All-Reduce L10 SP0 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep14_tp0_pp2 -> layer_10_expert_ar_sp0_ep14_pp2
	layer_10_expert_out_sp0_ep14_tp1_pp2 -> layer_10_expert_ar_sp0_ep14_pp2
	layer_10_expert_out_sp0_ep14_tp2_pp2 -> layer_10_expert_ar_sp0_ep14_pp2
	layer_10_expert_out_sp0_ep14_tp3_pp2 -> layer_10_expert_ar_sp0_ep14_pp2
	layer_10_combine_sp0_ep14_pp2 [label="Token Combine L10 SP0 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep14_pp2 -> layer_10_combine_sp0_ep14_pp2
	layer_10_dispatch_sp0_ep15_pp2 [label="Token Dispatch L10 SP0 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp0_pp2 -> layer_10_dispatch_sp0_ep15_pp2 [style=dashed]
	layer_10_expert_sp0_ep15_tp0_pp2 [label="Expert L10 SP0 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep15_pp2 -> layer_10_expert_sp0_ep15_tp0_pp2
	layer_10_expert_out_sp0_ep15_tp0_pp2 [label="Expert Out L10 SP0 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep15_tp0_pp2 -> layer_10_expert_out_sp0_ep15_tp0_pp2
	layer_10_expert_sp0_ep15_tp1_pp2 [label="Expert L10 SP0 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep15_pp2 -> layer_10_expert_sp0_ep15_tp1_pp2
	layer_10_expert_out_sp0_ep15_tp1_pp2 [label="Expert Out L10 SP0 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep15_tp1_pp2 -> layer_10_expert_out_sp0_ep15_tp1_pp2
	layer_10_expert_sp0_ep15_tp2_pp2 [label="Expert L10 SP0 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep15_pp2 -> layer_10_expert_sp0_ep15_tp2_pp2
	layer_10_expert_out_sp0_ep15_tp2_pp2 [label="Expert Out L10 SP0 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep15_tp2_pp2 -> layer_10_expert_out_sp0_ep15_tp2_pp2
	layer_10_expert_sp0_ep15_tp3_pp2 [label="Expert L10 SP0 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp0_ep15_pp2 -> layer_10_expert_sp0_ep15_tp3_pp2
	layer_10_expert_out_sp0_ep15_tp3_pp2 [label="Expert Out L10 SP0 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp0_ep15_tp3_pp2 -> layer_10_expert_out_sp0_ep15_tp3_pp2
	layer_10_expert_ar_sp0_ep15_pp2 [label="Expert All-Reduce L10 SP0 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp0_ep15_tp0_pp2 -> layer_10_expert_ar_sp0_ep15_pp2
	layer_10_expert_out_sp0_ep15_tp1_pp2 -> layer_10_expert_ar_sp0_ep15_pp2
	layer_10_expert_out_sp0_ep15_tp2_pp2 -> layer_10_expert_ar_sp0_ep15_pp2
	layer_10_expert_out_sp0_ep15_tp3_pp2 -> layer_10_expert_ar_sp0_ep15_pp2
	layer_10_combine_sp0_ep15_pp2 [label="Token Combine L10 SP0 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp0_ep15_pp2 -> layer_10_combine_sp0_ep15_pp2
	layer_10_moe_all2all_sp0_pp2 [label="MoE All-to-All L10 SP0\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_10_combine_sp0_ep0_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep1_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep2_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep3_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep4_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep5_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep6_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep7_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep8_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep9_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep10_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep11_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep12_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep13_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep14_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_combine_sp0_ep15_pp2 -> layer_10_moe_all2all_sp0_pp2
	layer_10_mlp_out_sp0_pp2 [label="MoE Output L10 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_moe_all2all_sp0_pp2 -> layer_10_mlp_out_sp0_pp2
	layer_10_mlp_res_sp0_pp2 [label="MLP Residual L10 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_mlp_out_sp0_pp2 -> layer_10_mlp_res_sp0_pp2
	layer_10_attn_res_sp0_pp2 -> layer_10_mlp_res_sp0_pp2 [style=dashed]
	layer_10_norm_sp1_pp2 [label="LayerNorm L10 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_mlp_out_sp1_pp2 -> layer_10_norm_sp1_pp2
	layer_10_qkv_sp1_tp0_pp2 [label="QKV Proj L10 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp1_pp2 -> layer_10_qkv_sp1_tp0_pp2
	layer_10_attn_sp1_tp0_pp2 [label="Attention L10 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp1_tp0_pp2 -> layer_10_attn_sp1_tp0_pp2
	layer_10_attn_out_sp1_tp0_pp2 [label="Attn Out Proj L10 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp1_tp0_pp2 -> layer_10_attn_out_sp1_tp0_pp2
	layer_10_qkv_sp1_tp1_pp2 [label="QKV Proj L10 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp1_pp2 -> layer_10_qkv_sp1_tp1_pp2
	layer_10_attn_sp1_tp1_pp2 [label="Attention L10 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp1_tp1_pp2 -> layer_10_attn_sp1_tp1_pp2
	layer_10_attn_out_sp1_tp1_pp2 [label="Attn Out Proj L10 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp1_tp1_pp2 -> layer_10_attn_out_sp1_tp1_pp2
	layer_10_qkv_sp1_tp2_pp2 [label="QKV Proj L10 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp1_pp2 -> layer_10_qkv_sp1_tp2_pp2
	layer_10_attn_sp1_tp2_pp2 [label="Attention L10 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp1_tp2_pp2 -> layer_10_attn_sp1_tp2_pp2
	layer_10_attn_out_sp1_tp2_pp2 [label="Attn Out Proj L10 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp1_tp2_pp2 -> layer_10_attn_out_sp1_tp2_pp2
	layer_10_qkv_sp1_tp3_pp2 [label="QKV Proj L10 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp1_pp2 -> layer_10_qkv_sp1_tp3_pp2
	layer_10_attn_sp1_tp3_pp2 [label="Attention L10 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp1_tp3_pp2 -> layer_10_attn_sp1_tp3_pp2
	layer_10_attn_out_sp1_tp3_pp2 [label="Attn Out Proj L10 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp1_tp3_pp2 -> layer_10_attn_out_sp1_tp3_pp2
	layer_10_attn_ar_sp1_pp2 [label="Attention All-Reduce L10 SP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_attn_out_sp1_tp0_pp2 -> layer_10_attn_ar_sp1_pp2
	layer_10_attn_out_sp1_tp1_pp2 -> layer_10_attn_ar_sp1_pp2
	layer_10_attn_out_sp1_tp2_pp2 -> layer_10_attn_ar_sp1_pp2
	layer_10_attn_out_sp1_tp3_pp2 -> layer_10_attn_ar_sp1_pp2
	layer_10_attn_res_sp1_pp2 [label="Attention Residual L10 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_attn_ar_sp1_pp2 -> layer_10_attn_res_sp1_pp2
	layer_10_norm_sp1_pp2 -> layer_10_attn_res_sp1_pp2 [style=dashed]
	layer_10_post_norm_sp1_pp2 [label="Post-Attn Norm L10 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_attn_res_sp1_pp2 -> layer_10_post_norm_sp1_pp2
	layer_10_router_sp1_pp2 [label="MoE Router L10 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_10_post_norm_sp1_pp2 -> layer_10_router_sp1_pp2
	layer_10_dispatch_sp1_ep0_pp2 [label="Token Dispatch L10 SP1 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep0_pp2 [style=dashed]
	layer_10_expert_sp1_ep0_tp0_pp2 [label="Expert L10 SP1 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep0_pp2 -> layer_10_expert_sp1_ep0_tp0_pp2
	layer_10_expert_out_sp1_ep0_tp0_pp2 [label="Expert Out L10 SP1 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep0_tp0_pp2 -> layer_10_expert_out_sp1_ep0_tp0_pp2
	layer_10_expert_sp1_ep0_tp1_pp2 [label="Expert L10 SP1 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep0_pp2 -> layer_10_expert_sp1_ep0_tp1_pp2
	layer_10_expert_out_sp1_ep0_tp1_pp2 [label="Expert Out L10 SP1 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep0_tp1_pp2 -> layer_10_expert_out_sp1_ep0_tp1_pp2
	layer_10_expert_sp1_ep0_tp2_pp2 [label="Expert L10 SP1 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep0_pp2 -> layer_10_expert_sp1_ep0_tp2_pp2
	layer_10_expert_out_sp1_ep0_tp2_pp2 [label="Expert Out L10 SP1 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep0_tp2_pp2 -> layer_10_expert_out_sp1_ep0_tp2_pp2
	layer_10_expert_sp1_ep0_tp3_pp2 [label="Expert L10 SP1 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep0_pp2 -> layer_10_expert_sp1_ep0_tp3_pp2
	layer_10_expert_out_sp1_ep0_tp3_pp2 [label="Expert Out L10 SP1 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep0_tp3_pp2 -> layer_10_expert_out_sp1_ep0_tp3_pp2
	layer_10_expert_ar_sp1_ep0_pp2 [label="Expert All-Reduce L10 SP1 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep0_tp0_pp2 -> layer_10_expert_ar_sp1_ep0_pp2
	layer_10_expert_out_sp1_ep0_tp1_pp2 -> layer_10_expert_ar_sp1_ep0_pp2
	layer_10_expert_out_sp1_ep0_tp2_pp2 -> layer_10_expert_ar_sp1_ep0_pp2
	layer_10_expert_out_sp1_ep0_tp3_pp2 -> layer_10_expert_ar_sp1_ep0_pp2
	layer_10_combine_sp1_ep0_pp2 [label="Token Combine L10 SP1 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep0_pp2 -> layer_10_combine_sp1_ep0_pp2
	layer_10_dispatch_sp1_ep1_pp2 [label="Token Dispatch L10 SP1 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep1_pp2 [style=dashed]
	layer_10_expert_sp1_ep1_tp0_pp2 [label="Expert L10 SP1 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep1_pp2 -> layer_10_expert_sp1_ep1_tp0_pp2
	layer_10_expert_out_sp1_ep1_tp0_pp2 [label="Expert Out L10 SP1 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep1_tp0_pp2 -> layer_10_expert_out_sp1_ep1_tp0_pp2
	layer_10_expert_sp1_ep1_tp1_pp2 [label="Expert L10 SP1 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep1_pp2 -> layer_10_expert_sp1_ep1_tp1_pp2
	layer_10_expert_out_sp1_ep1_tp1_pp2 [label="Expert Out L10 SP1 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep1_tp1_pp2 -> layer_10_expert_out_sp1_ep1_tp1_pp2
	layer_10_expert_sp1_ep1_tp2_pp2 [label="Expert L10 SP1 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep1_pp2 -> layer_10_expert_sp1_ep1_tp2_pp2
	layer_10_expert_out_sp1_ep1_tp2_pp2 [label="Expert Out L10 SP1 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep1_tp2_pp2 -> layer_10_expert_out_sp1_ep1_tp2_pp2
	layer_10_expert_sp1_ep1_tp3_pp2 [label="Expert L10 SP1 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep1_pp2 -> layer_10_expert_sp1_ep1_tp3_pp2
	layer_10_expert_out_sp1_ep1_tp3_pp2 [label="Expert Out L10 SP1 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep1_tp3_pp2 -> layer_10_expert_out_sp1_ep1_tp3_pp2
	layer_10_expert_ar_sp1_ep1_pp2 [label="Expert All-Reduce L10 SP1 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep1_tp0_pp2 -> layer_10_expert_ar_sp1_ep1_pp2
	layer_10_expert_out_sp1_ep1_tp1_pp2 -> layer_10_expert_ar_sp1_ep1_pp2
	layer_10_expert_out_sp1_ep1_tp2_pp2 -> layer_10_expert_ar_sp1_ep1_pp2
	layer_10_expert_out_sp1_ep1_tp3_pp2 -> layer_10_expert_ar_sp1_ep1_pp2
	layer_10_combine_sp1_ep1_pp2 [label="Token Combine L10 SP1 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep1_pp2 -> layer_10_combine_sp1_ep1_pp2
	layer_10_dispatch_sp1_ep2_pp2 [label="Token Dispatch L10 SP1 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep2_pp2 [style=dashed]
	layer_10_expert_sp1_ep2_tp0_pp2 [label="Expert L10 SP1 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep2_pp2 -> layer_10_expert_sp1_ep2_tp0_pp2
	layer_10_expert_out_sp1_ep2_tp0_pp2 [label="Expert Out L10 SP1 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep2_tp0_pp2 -> layer_10_expert_out_sp1_ep2_tp0_pp2
	layer_10_expert_sp1_ep2_tp1_pp2 [label="Expert L10 SP1 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep2_pp2 -> layer_10_expert_sp1_ep2_tp1_pp2
	layer_10_expert_out_sp1_ep2_tp1_pp2 [label="Expert Out L10 SP1 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep2_tp1_pp2 -> layer_10_expert_out_sp1_ep2_tp1_pp2
	layer_10_expert_sp1_ep2_tp2_pp2 [label="Expert L10 SP1 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep2_pp2 -> layer_10_expert_sp1_ep2_tp2_pp2
	layer_10_expert_out_sp1_ep2_tp2_pp2 [label="Expert Out L10 SP1 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep2_tp2_pp2 -> layer_10_expert_out_sp1_ep2_tp2_pp2
	layer_10_expert_sp1_ep2_tp3_pp2 [label="Expert L10 SP1 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep2_pp2 -> layer_10_expert_sp1_ep2_tp3_pp2
	layer_10_expert_out_sp1_ep2_tp3_pp2 [label="Expert Out L10 SP1 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep2_tp3_pp2 -> layer_10_expert_out_sp1_ep2_tp3_pp2
	layer_10_expert_ar_sp1_ep2_pp2 [label="Expert All-Reduce L10 SP1 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep2_tp0_pp2 -> layer_10_expert_ar_sp1_ep2_pp2
	layer_10_expert_out_sp1_ep2_tp1_pp2 -> layer_10_expert_ar_sp1_ep2_pp2
	layer_10_expert_out_sp1_ep2_tp2_pp2 -> layer_10_expert_ar_sp1_ep2_pp2
	layer_10_expert_out_sp1_ep2_tp3_pp2 -> layer_10_expert_ar_sp1_ep2_pp2
	layer_10_combine_sp1_ep2_pp2 [label="Token Combine L10 SP1 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep2_pp2 -> layer_10_combine_sp1_ep2_pp2
	layer_10_dispatch_sp1_ep3_pp2 [label="Token Dispatch L10 SP1 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep3_pp2 [style=dashed]
	layer_10_expert_sp1_ep3_tp0_pp2 [label="Expert L10 SP1 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep3_pp2 -> layer_10_expert_sp1_ep3_tp0_pp2
	layer_10_expert_out_sp1_ep3_tp0_pp2 [label="Expert Out L10 SP1 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep3_tp0_pp2 -> layer_10_expert_out_sp1_ep3_tp0_pp2
	layer_10_expert_sp1_ep3_tp1_pp2 [label="Expert L10 SP1 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep3_pp2 -> layer_10_expert_sp1_ep3_tp1_pp2
	layer_10_expert_out_sp1_ep3_tp1_pp2 [label="Expert Out L10 SP1 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep3_tp1_pp2 -> layer_10_expert_out_sp1_ep3_tp1_pp2
	layer_10_expert_sp1_ep3_tp2_pp2 [label="Expert L10 SP1 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep3_pp2 -> layer_10_expert_sp1_ep3_tp2_pp2
	layer_10_expert_out_sp1_ep3_tp2_pp2 [label="Expert Out L10 SP1 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep3_tp2_pp2 -> layer_10_expert_out_sp1_ep3_tp2_pp2
	layer_10_expert_sp1_ep3_tp3_pp2 [label="Expert L10 SP1 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep3_pp2 -> layer_10_expert_sp1_ep3_tp3_pp2
	layer_10_expert_out_sp1_ep3_tp3_pp2 [label="Expert Out L10 SP1 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep3_tp3_pp2 -> layer_10_expert_out_sp1_ep3_tp3_pp2
	layer_10_expert_ar_sp1_ep3_pp2 [label="Expert All-Reduce L10 SP1 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep3_tp0_pp2 -> layer_10_expert_ar_sp1_ep3_pp2
	layer_10_expert_out_sp1_ep3_tp1_pp2 -> layer_10_expert_ar_sp1_ep3_pp2
	layer_10_expert_out_sp1_ep3_tp2_pp2 -> layer_10_expert_ar_sp1_ep3_pp2
	layer_10_expert_out_sp1_ep3_tp3_pp2 -> layer_10_expert_ar_sp1_ep3_pp2
	layer_10_combine_sp1_ep3_pp2 [label="Token Combine L10 SP1 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep3_pp2 -> layer_10_combine_sp1_ep3_pp2
	layer_10_dispatch_sp1_ep4_pp2 [label="Token Dispatch L10 SP1 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep4_pp2 [style=dashed]
	layer_10_expert_sp1_ep4_tp0_pp2 [label="Expert L10 SP1 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep4_pp2 -> layer_10_expert_sp1_ep4_tp0_pp2
	layer_10_expert_out_sp1_ep4_tp0_pp2 [label="Expert Out L10 SP1 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep4_tp0_pp2 -> layer_10_expert_out_sp1_ep4_tp0_pp2
	layer_10_expert_sp1_ep4_tp1_pp2 [label="Expert L10 SP1 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep4_pp2 -> layer_10_expert_sp1_ep4_tp1_pp2
	layer_10_expert_out_sp1_ep4_tp1_pp2 [label="Expert Out L10 SP1 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep4_tp1_pp2 -> layer_10_expert_out_sp1_ep4_tp1_pp2
	layer_10_expert_sp1_ep4_tp2_pp2 [label="Expert L10 SP1 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep4_pp2 -> layer_10_expert_sp1_ep4_tp2_pp2
	layer_10_expert_out_sp1_ep4_tp2_pp2 [label="Expert Out L10 SP1 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep4_tp2_pp2 -> layer_10_expert_out_sp1_ep4_tp2_pp2
	layer_10_expert_sp1_ep4_tp3_pp2 [label="Expert L10 SP1 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep4_pp2 -> layer_10_expert_sp1_ep4_tp3_pp2
	layer_10_expert_out_sp1_ep4_tp3_pp2 [label="Expert Out L10 SP1 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep4_tp3_pp2 -> layer_10_expert_out_sp1_ep4_tp3_pp2
	layer_10_expert_ar_sp1_ep4_pp2 [label="Expert All-Reduce L10 SP1 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep4_tp0_pp2 -> layer_10_expert_ar_sp1_ep4_pp2
	layer_10_expert_out_sp1_ep4_tp1_pp2 -> layer_10_expert_ar_sp1_ep4_pp2
	layer_10_expert_out_sp1_ep4_tp2_pp2 -> layer_10_expert_ar_sp1_ep4_pp2
	layer_10_expert_out_sp1_ep4_tp3_pp2 -> layer_10_expert_ar_sp1_ep4_pp2
	layer_10_combine_sp1_ep4_pp2 [label="Token Combine L10 SP1 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep4_pp2 -> layer_10_combine_sp1_ep4_pp2
	layer_10_dispatch_sp1_ep5_pp2 [label="Token Dispatch L10 SP1 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep5_pp2 [style=dashed]
	layer_10_expert_sp1_ep5_tp0_pp2 [label="Expert L10 SP1 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep5_pp2 -> layer_10_expert_sp1_ep5_tp0_pp2
	layer_10_expert_out_sp1_ep5_tp0_pp2 [label="Expert Out L10 SP1 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep5_tp0_pp2 -> layer_10_expert_out_sp1_ep5_tp0_pp2
	layer_10_expert_sp1_ep5_tp1_pp2 [label="Expert L10 SP1 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep5_pp2 -> layer_10_expert_sp1_ep5_tp1_pp2
	layer_10_expert_out_sp1_ep5_tp1_pp2 [label="Expert Out L10 SP1 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep5_tp1_pp2 -> layer_10_expert_out_sp1_ep5_tp1_pp2
	layer_10_expert_sp1_ep5_tp2_pp2 [label="Expert L10 SP1 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep5_pp2 -> layer_10_expert_sp1_ep5_tp2_pp2
	layer_10_expert_out_sp1_ep5_tp2_pp2 [label="Expert Out L10 SP1 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep5_tp2_pp2 -> layer_10_expert_out_sp1_ep5_tp2_pp2
	layer_10_expert_sp1_ep5_tp3_pp2 [label="Expert L10 SP1 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep5_pp2 -> layer_10_expert_sp1_ep5_tp3_pp2
	layer_10_expert_out_sp1_ep5_tp3_pp2 [label="Expert Out L10 SP1 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep5_tp3_pp2 -> layer_10_expert_out_sp1_ep5_tp3_pp2
	layer_10_expert_ar_sp1_ep5_pp2 [label="Expert All-Reduce L10 SP1 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep5_tp0_pp2 -> layer_10_expert_ar_sp1_ep5_pp2
	layer_10_expert_out_sp1_ep5_tp1_pp2 -> layer_10_expert_ar_sp1_ep5_pp2
	layer_10_expert_out_sp1_ep5_tp2_pp2 -> layer_10_expert_ar_sp1_ep5_pp2
	layer_10_expert_out_sp1_ep5_tp3_pp2 -> layer_10_expert_ar_sp1_ep5_pp2
	layer_10_combine_sp1_ep5_pp2 [label="Token Combine L10 SP1 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep5_pp2 -> layer_10_combine_sp1_ep5_pp2
	layer_10_dispatch_sp1_ep6_pp2 [label="Token Dispatch L10 SP1 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep6_pp2 [style=dashed]
	layer_10_expert_sp1_ep6_tp0_pp2 [label="Expert L10 SP1 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep6_pp2 -> layer_10_expert_sp1_ep6_tp0_pp2
	layer_10_expert_out_sp1_ep6_tp0_pp2 [label="Expert Out L10 SP1 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep6_tp0_pp2 -> layer_10_expert_out_sp1_ep6_tp0_pp2
	layer_10_expert_sp1_ep6_tp1_pp2 [label="Expert L10 SP1 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep6_pp2 -> layer_10_expert_sp1_ep6_tp1_pp2
	layer_10_expert_out_sp1_ep6_tp1_pp2 [label="Expert Out L10 SP1 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep6_tp1_pp2 -> layer_10_expert_out_sp1_ep6_tp1_pp2
	layer_10_expert_sp1_ep6_tp2_pp2 [label="Expert L10 SP1 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep6_pp2 -> layer_10_expert_sp1_ep6_tp2_pp2
	layer_10_expert_out_sp1_ep6_tp2_pp2 [label="Expert Out L10 SP1 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep6_tp2_pp2 -> layer_10_expert_out_sp1_ep6_tp2_pp2
	layer_10_expert_sp1_ep6_tp3_pp2 [label="Expert L10 SP1 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep6_pp2 -> layer_10_expert_sp1_ep6_tp3_pp2
	layer_10_expert_out_sp1_ep6_tp3_pp2 [label="Expert Out L10 SP1 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep6_tp3_pp2 -> layer_10_expert_out_sp1_ep6_tp3_pp2
	layer_10_expert_ar_sp1_ep6_pp2 [label="Expert All-Reduce L10 SP1 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep6_tp0_pp2 -> layer_10_expert_ar_sp1_ep6_pp2
	layer_10_expert_out_sp1_ep6_tp1_pp2 -> layer_10_expert_ar_sp1_ep6_pp2
	layer_10_expert_out_sp1_ep6_tp2_pp2 -> layer_10_expert_ar_sp1_ep6_pp2
	layer_10_expert_out_sp1_ep6_tp3_pp2 -> layer_10_expert_ar_sp1_ep6_pp2
	layer_10_combine_sp1_ep6_pp2 [label="Token Combine L10 SP1 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep6_pp2 -> layer_10_combine_sp1_ep6_pp2
	layer_10_dispatch_sp1_ep7_pp2 [label="Token Dispatch L10 SP1 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep7_pp2 [style=dashed]
	layer_10_expert_sp1_ep7_tp0_pp2 [label="Expert L10 SP1 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep7_pp2 -> layer_10_expert_sp1_ep7_tp0_pp2
	layer_10_expert_out_sp1_ep7_tp0_pp2 [label="Expert Out L10 SP1 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep7_tp0_pp2 -> layer_10_expert_out_sp1_ep7_tp0_pp2
	layer_10_expert_sp1_ep7_tp1_pp2 [label="Expert L10 SP1 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep7_pp2 -> layer_10_expert_sp1_ep7_tp1_pp2
	layer_10_expert_out_sp1_ep7_tp1_pp2 [label="Expert Out L10 SP1 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep7_tp1_pp2 -> layer_10_expert_out_sp1_ep7_tp1_pp2
	layer_10_expert_sp1_ep7_tp2_pp2 [label="Expert L10 SP1 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep7_pp2 -> layer_10_expert_sp1_ep7_tp2_pp2
	layer_10_expert_out_sp1_ep7_tp2_pp2 [label="Expert Out L10 SP1 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep7_tp2_pp2 -> layer_10_expert_out_sp1_ep7_tp2_pp2
	layer_10_expert_sp1_ep7_tp3_pp2 [label="Expert L10 SP1 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep7_pp2 -> layer_10_expert_sp1_ep7_tp3_pp2
	layer_10_expert_out_sp1_ep7_tp3_pp2 [label="Expert Out L10 SP1 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep7_tp3_pp2 -> layer_10_expert_out_sp1_ep7_tp3_pp2
	layer_10_expert_ar_sp1_ep7_pp2 [label="Expert All-Reduce L10 SP1 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep7_tp0_pp2 -> layer_10_expert_ar_sp1_ep7_pp2
	layer_10_expert_out_sp1_ep7_tp1_pp2 -> layer_10_expert_ar_sp1_ep7_pp2
	layer_10_expert_out_sp1_ep7_tp2_pp2 -> layer_10_expert_ar_sp1_ep7_pp2
	layer_10_expert_out_sp1_ep7_tp3_pp2 -> layer_10_expert_ar_sp1_ep7_pp2
	layer_10_combine_sp1_ep7_pp2 [label="Token Combine L10 SP1 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep7_pp2 -> layer_10_combine_sp1_ep7_pp2
	layer_10_dispatch_sp1_ep8_pp2 [label="Token Dispatch L10 SP1 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep8_pp2 [style=dashed]
	layer_10_expert_sp1_ep8_tp0_pp2 [label="Expert L10 SP1 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep8_pp2 -> layer_10_expert_sp1_ep8_tp0_pp2
	layer_10_expert_out_sp1_ep8_tp0_pp2 [label="Expert Out L10 SP1 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep8_tp0_pp2 -> layer_10_expert_out_sp1_ep8_tp0_pp2
	layer_10_expert_sp1_ep8_tp1_pp2 [label="Expert L10 SP1 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep8_pp2 -> layer_10_expert_sp1_ep8_tp1_pp2
	layer_10_expert_out_sp1_ep8_tp1_pp2 [label="Expert Out L10 SP1 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep8_tp1_pp2 -> layer_10_expert_out_sp1_ep8_tp1_pp2
	layer_10_expert_sp1_ep8_tp2_pp2 [label="Expert L10 SP1 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep8_pp2 -> layer_10_expert_sp1_ep8_tp2_pp2
	layer_10_expert_out_sp1_ep8_tp2_pp2 [label="Expert Out L10 SP1 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep8_tp2_pp2 -> layer_10_expert_out_sp1_ep8_tp2_pp2
	layer_10_expert_sp1_ep8_tp3_pp2 [label="Expert L10 SP1 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep8_pp2 -> layer_10_expert_sp1_ep8_tp3_pp2
	layer_10_expert_out_sp1_ep8_tp3_pp2 [label="Expert Out L10 SP1 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep8_tp3_pp2 -> layer_10_expert_out_sp1_ep8_tp3_pp2
	layer_10_expert_ar_sp1_ep8_pp2 [label="Expert All-Reduce L10 SP1 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep8_tp0_pp2 -> layer_10_expert_ar_sp1_ep8_pp2
	layer_10_expert_out_sp1_ep8_tp1_pp2 -> layer_10_expert_ar_sp1_ep8_pp2
	layer_10_expert_out_sp1_ep8_tp2_pp2 -> layer_10_expert_ar_sp1_ep8_pp2
	layer_10_expert_out_sp1_ep8_tp3_pp2 -> layer_10_expert_ar_sp1_ep8_pp2
	layer_10_combine_sp1_ep8_pp2 [label="Token Combine L10 SP1 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep8_pp2 -> layer_10_combine_sp1_ep8_pp2
	layer_10_dispatch_sp1_ep9_pp2 [label="Token Dispatch L10 SP1 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep9_pp2 [style=dashed]
	layer_10_expert_sp1_ep9_tp0_pp2 [label="Expert L10 SP1 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep9_pp2 -> layer_10_expert_sp1_ep9_tp0_pp2
	layer_10_expert_out_sp1_ep9_tp0_pp2 [label="Expert Out L10 SP1 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep9_tp0_pp2 -> layer_10_expert_out_sp1_ep9_tp0_pp2
	layer_10_expert_sp1_ep9_tp1_pp2 [label="Expert L10 SP1 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep9_pp2 -> layer_10_expert_sp1_ep9_tp1_pp2
	layer_10_expert_out_sp1_ep9_tp1_pp2 [label="Expert Out L10 SP1 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep9_tp1_pp2 -> layer_10_expert_out_sp1_ep9_tp1_pp2
	layer_10_expert_sp1_ep9_tp2_pp2 [label="Expert L10 SP1 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep9_pp2 -> layer_10_expert_sp1_ep9_tp2_pp2
	layer_10_expert_out_sp1_ep9_tp2_pp2 [label="Expert Out L10 SP1 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep9_tp2_pp2 -> layer_10_expert_out_sp1_ep9_tp2_pp2
	layer_10_expert_sp1_ep9_tp3_pp2 [label="Expert L10 SP1 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep9_pp2 -> layer_10_expert_sp1_ep9_tp3_pp2
	layer_10_expert_out_sp1_ep9_tp3_pp2 [label="Expert Out L10 SP1 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep9_tp3_pp2 -> layer_10_expert_out_sp1_ep9_tp3_pp2
	layer_10_expert_ar_sp1_ep9_pp2 [label="Expert All-Reduce L10 SP1 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep9_tp0_pp2 -> layer_10_expert_ar_sp1_ep9_pp2
	layer_10_expert_out_sp1_ep9_tp1_pp2 -> layer_10_expert_ar_sp1_ep9_pp2
	layer_10_expert_out_sp1_ep9_tp2_pp2 -> layer_10_expert_ar_sp1_ep9_pp2
	layer_10_expert_out_sp1_ep9_tp3_pp2 -> layer_10_expert_ar_sp1_ep9_pp2
	layer_10_combine_sp1_ep9_pp2 [label="Token Combine L10 SP1 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep9_pp2 -> layer_10_combine_sp1_ep9_pp2
	layer_10_dispatch_sp1_ep10_pp2 [label="Token Dispatch L10 SP1 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep10_pp2 [style=dashed]
	layer_10_expert_sp1_ep10_tp0_pp2 [label="Expert L10 SP1 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep10_pp2 -> layer_10_expert_sp1_ep10_tp0_pp2
	layer_10_expert_out_sp1_ep10_tp0_pp2 [label="Expert Out L10 SP1 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep10_tp0_pp2 -> layer_10_expert_out_sp1_ep10_tp0_pp2
	layer_10_expert_sp1_ep10_tp1_pp2 [label="Expert L10 SP1 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep10_pp2 -> layer_10_expert_sp1_ep10_tp1_pp2
	layer_10_expert_out_sp1_ep10_tp1_pp2 [label="Expert Out L10 SP1 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep10_tp1_pp2 -> layer_10_expert_out_sp1_ep10_tp1_pp2
	layer_10_expert_sp1_ep10_tp2_pp2 [label="Expert L10 SP1 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep10_pp2 -> layer_10_expert_sp1_ep10_tp2_pp2
	layer_10_expert_out_sp1_ep10_tp2_pp2 [label="Expert Out L10 SP1 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep10_tp2_pp2 -> layer_10_expert_out_sp1_ep10_tp2_pp2
	layer_10_expert_sp1_ep10_tp3_pp2 [label="Expert L10 SP1 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep10_pp2 -> layer_10_expert_sp1_ep10_tp3_pp2
	layer_10_expert_out_sp1_ep10_tp3_pp2 [label="Expert Out L10 SP1 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep10_tp3_pp2 -> layer_10_expert_out_sp1_ep10_tp3_pp2
	layer_10_expert_ar_sp1_ep10_pp2 [label="Expert All-Reduce L10 SP1 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep10_tp0_pp2 -> layer_10_expert_ar_sp1_ep10_pp2
	layer_10_expert_out_sp1_ep10_tp1_pp2 -> layer_10_expert_ar_sp1_ep10_pp2
	layer_10_expert_out_sp1_ep10_tp2_pp2 -> layer_10_expert_ar_sp1_ep10_pp2
	layer_10_expert_out_sp1_ep10_tp3_pp2 -> layer_10_expert_ar_sp1_ep10_pp2
	layer_10_combine_sp1_ep10_pp2 [label="Token Combine L10 SP1 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep10_pp2 -> layer_10_combine_sp1_ep10_pp2
	layer_10_dispatch_sp1_ep11_pp2 [label="Token Dispatch L10 SP1 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep11_pp2 [style=dashed]
	layer_10_expert_sp1_ep11_tp0_pp2 [label="Expert L10 SP1 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep11_pp2 -> layer_10_expert_sp1_ep11_tp0_pp2
	layer_10_expert_out_sp1_ep11_tp0_pp2 [label="Expert Out L10 SP1 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep11_tp0_pp2 -> layer_10_expert_out_sp1_ep11_tp0_pp2
	layer_10_expert_sp1_ep11_tp1_pp2 [label="Expert L10 SP1 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep11_pp2 -> layer_10_expert_sp1_ep11_tp1_pp2
	layer_10_expert_out_sp1_ep11_tp1_pp2 [label="Expert Out L10 SP1 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep11_tp1_pp2 -> layer_10_expert_out_sp1_ep11_tp1_pp2
	layer_10_expert_sp1_ep11_tp2_pp2 [label="Expert L10 SP1 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep11_pp2 -> layer_10_expert_sp1_ep11_tp2_pp2
	layer_10_expert_out_sp1_ep11_tp2_pp2 [label="Expert Out L10 SP1 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep11_tp2_pp2 -> layer_10_expert_out_sp1_ep11_tp2_pp2
	layer_10_expert_sp1_ep11_tp3_pp2 [label="Expert L10 SP1 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep11_pp2 -> layer_10_expert_sp1_ep11_tp3_pp2
	layer_10_expert_out_sp1_ep11_tp3_pp2 [label="Expert Out L10 SP1 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep11_tp3_pp2 -> layer_10_expert_out_sp1_ep11_tp3_pp2
	layer_10_expert_ar_sp1_ep11_pp2 [label="Expert All-Reduce L10 SP1 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep11_tp0_pp2 -> layer_10_expert_ar_sp1_ep11_pp2
	layer_10_expert_out_sp1_ep11_tp1_pp2 -> layer_10_expert_ar_sp1_ep11_pp2
	layer_10_expert_out_sp1_ep11_tp2_pp2 -> layer_10_expert_ar_sp1_ep11_pp2
	layer_10_expert_out_sp1_ep11_tp3_pp2 -> layer_10_expert_ar_sp1_ep11_pp2
	layer_10_combine_sp1_ep11_pp2 [label="Token Combine L10 SP1 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep11_pp2 -> layer_10_combine_sp1_ep11_pp2
	layer_10_dispatch_sp1_ep12_pp2 [label="Token Dispatch L10 SP1 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep12_pp2 [style=dashed]
	layer_10_expert_sp1_ep12_tp0_pp2 [label="Expert L10 SP1 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep12_pp2 -> layer_10_expert_sp1_ep12_tp0_pp2
	layer_10_expert_out_sp1_ep12_tp0_pp2 [label="Expert Out L10 SP1 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep12_tp0_pp2 -> layer_10_expert_out_sp1_ep12_tp0_pp2
	layer_10_expert_sp1_ep12_tp1_pp2 [label="Expert L10 SP1 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep12_pp2 -> layer_10_expert_sp1_ep12_tp1_pp2
	layer_10_expert_out_sp1_ep12_tp1_pp2 [label="Expert Out L10 SP1 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep12_tp1_pp2 -> layer_10_expert_out_sp1_ep12_tp1_pp2
	layer_10_expert_sp1_ep12_tp2_pp2 [label="Expert L10 SP1 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep12_pp2 -> layer_10_expert_sp1_ep12_tp2_pp2
	layer_10_expert_out_sp1_ep12_tp2_pp2 [label="Expert Out L10 SP1 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep12_tp2_pp2 -> layer_10_expert_out_sp1_ep12_tp2_pp2
	layer_10_expert_sp1_ep12_tp3_pp2 [label="Expert L10 SP1 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep12_pp2 -> layer_10_expert_sp1_ep12_tp3_pp2
	layer_10_expert_out_sp1_ep12_tp3_pp2 [label="Expert Out L10 SP1 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep12_tp3_pp2 -> layer_10_expert_out_sp1_ep12_tp3_pp2
	layer_10_expert_ar_sp1_ep12_pp2 [label="Expert All-Reduce L10 SP1 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep12_tp0_pp2 -> layer_10_expert_ar_sp1_ep12_pp2
	layer_10_expert_out_sp1_ep12_tp1_pp2 -> layer_10_expert_ar_sp1_ep12_pp2
	layer_10_expert_out_sp1_ep12_tp2_pp2 -> layer_10_expert_ar_sp1_ep12_pp2
	layer_10_expert_out_sp1_ep12_tp3_pp2 -> layer_10_expert_ar_sp1_ep12_pp2
	layer_10_combine_sp1_ep12_pp2 [label="Token Combine L10 SP1 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep12_pp2 -> layer_10_combine_sp1_ep12_pp2
	layer_10_dispatch_sp1_ep13_pp2 [label="Token Dispatch L10 SP1 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep13_pp2 [style=dashed]
	layer_10_expert_sp1_ep13_tp0_pp2 [label="Expert L10 SP1 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep13_pp2 -> layer_10_expert_sp1_ep13_tp0_pp2
	layer_10_expert_out_sp1_ep13_tp0_pp2 [label="Expert Out L10 SP1 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep13_tp0_pp2 -> layer_10_expert_out_sp1_ep13_tp0_pp2
	layer_10_expert_sp1_ep13_tp1_pp2 [label="Expert L10 SP1 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep13_pp2 -> layer_10_expert_sp1_ep13_tp1_pp2
	layer_10_expert_out_sp1_ep13_tp1_pp2 [label="Expert Out L10 SP1 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep13_tp1_pp2 -> layer_10_expert_out_sp1_ep13_tp1_pp2
	layer_10_expert_sp1_ep13_tp2_pp2 [label="Expert L10 SP1 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep13_pp2 -> layer_10_expert_sp1_ep13_tp2_pp2
	layer_10_expert_out_sp1_ep13_tp2_pp2 [label="Expert Out L10 SP1 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep13_tp2_pp2 -> layer_10_expert_out_sp1_ep13_tp2_pp2
	layer_10_expert_sp1_ep13_tp3_pp2 [label="Expert L10 SP1 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep13_pp2 -> layer_10_expert_sp1_ep13_tp3_pp2
	layer_10_expert_out_sp1_ep13_tp3_pp2 [label="Expert Out L10 SP1 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep13_tp3_pp2 -> layer_10_expert_out_sp1_ep13_tp3_pp2
	layer_10_expert_ar_sp1_ep13_pp2 [label="Expert All-Reduce L10 SP1 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep13_tp0_pp2 -> layer_10_expert_ar_sp1_ep13_pp2
	layer_10_expert_out_sp1_ep13_tp1_pp2 -> layer_10_expert_ar_sp1_ep13_pp2
	layer_10_expert_out_sp1_ep13_tp2_pp2 -> layer_10_expert_ar_sp1_ep13_pp2
	layer_10_expert_out_sp1_ep13_tp3_pp2 -> layer_10_expert_ar_sp1_ep13_pp2
	layer_10_combine_sp1_ep13_pp2 [label="Token Combine L10 SP1 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep13_pp2 -> layer_10_combine_sp1_ep13_pp2
	layer_10_dispatch_sp1_ep14_pp2 [label="Token Dispatch L10 SP1 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep14_pp2 [style=dashed]
	layer_10_expert_sp1_ep14_tp0_pp2 [label="Expert L10 SP1 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep14_pp2 -> layer_10_expert_sp1_ep14_tp0_pp2
	layer_10_expert_out_sp1_ep14_tp0_pp2 [label="Expert Out L10 SP1 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep14_tp0_pp2 -> layer_10_expert_out_sp1_ep14_tp0_pp2
	layer_10_expert_sp1_ep14_tp1_pp2 [label="Expert L10 SP1 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep14_pp2 -> layer_10_expert_sp1_ep14_tp1_pp2
	layer_10_expert_out_sp1_ep14_tp1_pp2 [label="Expert Out L10 SP1 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep14_tp1_pp2 -> layer_10_expert_out_sp1_ep14_tp1_pp2
	layer_10_expert_sp1_ep14_tp2_pp2 [label="Expert L10 SP1 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep14_pp2 -> layer_10_expert_sp1_ep14_tp2_pp2
	layer_10_expert_out_sp1_ep14_tp2_pp2 [label="Expert Out L10 SP1 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep14_tp2_pp2 -> layer_10_expert_out_sp1_ep14_tp2_pp2
	layer_10_expert_sp1_ep14_tp3_pp2 [label="Expert L10 SP1 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep14_pp2 -> layer_10_expert_sp1_ep14_tp3_pp2
	layer_10_expert_out_sp1_ep14_tp3_pp2 [label="Expert Out L10 SP1 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep14_tp3_pp2 -> layer_10_expert_out_sp1_ep14_tp3_pp2
	layer_10_expert_ar_sp1_ep14_pp2 [label="Expert All-Reduce L10 SP1 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep14_tp0_pp2 -> layer_10_expert_ar_sp1_ep14_pp2
	layer_10_expert_out_sp1_ep14_tp1_pp2 -> layer_10_expert_ar_sp1_ep14_pp2
	layer_10_expert_out_sp1_ep14_tp2_pp2 -> layer_10_expert_ar_sp1_ep14_pp2
	layer_10_expert_out_sp1_ep14_tp3_pp2 -> layer_10_expert_ar_sp1_ep14_pp2
	layer_10_combine_sp1_ep14_pp2 [label="Token Combine L10 SP1 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep14_pp2 -> layer_10_combine_sp1_ep14_pp2
	layer_10_dispatch_sp1_ep15_pp2 [label="Token Dispatch L10 SP1 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp1_pp2 -> layer_10_dispatch_sp1_ep15_pp2 [style=dashed]
	layer_10_expert_sp1_ep15_tp0_pp2 [label="Expert L10 SP1 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep15_pp2 -> layer_10_expert_sp1_ep15_tp0_pp2
	layer_10_expert_out_sp1_ep15_tp0_pp2 [label="Expert Out L10 SP1 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep15_tp0_pp2 -> layer_10_expert_out_sp1_ep15_tp0_pp2
	layer_10_expert_sp1_ep15_tp1_pp2 [label="Expert L10 SP1 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep15_pp2 -> layer_10_expert_sp1_ep15_tp1_pp2
	layer_10_expert_out_sp1_ep15_tp1_pp2 [label="Expert Out L10 SP1 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep15_tp1_pp2 -> layer_10_expert_out_sp1_ep15_tp1_pp2
	layer_10_expert_sp1_ep15_tp2_pp2 [label="Expert L10 SP1 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep15_pp2 -> layer_10_expert_sp1_ep15_tp2_pp2
	layer_10_expert_out_sp1_ep15_tp2_pp2 [label="Expert Out L10 SP1 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep15_tp2_pp2 -> layer_10_expert_out_sp1_ep15_tp2_pp2
	layer_10_expert_sp1_ep15_tp3_pp2 [label="Expert L10 SP1 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp1_ep15_pp2 -> layer_10_expert_sp1_ep15_tp3_pp2
	layer_10_expert_out_sp1_ep15_tp3_pp2 [label="Expert Out L10 SP1 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp1_ep15_tp3_pp2 -> layer_10_expert_out_sp1_ep15_tp3_pp2
	layer_10_expert_ar_sp1_ep15_pp2 [label="Expert All-Reduce L10 SP1 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp1_ep15_tp0_pp2 -> layer_10_expert_ar_sp1_ep15_pp2
	layer_10_expert_out_sp1_ep15_tp1_pp2 -> layer_10_expert_ar_sp1_ep15_pp2
	layer_10_expert_out_sp1_ep15_tp2_pp2 -> layer_10_expert_ar_sp1_ep15_pp2
	layer_10_expert_out_sp1_ep15_tp3_pp2 -> layer_10_expert_ar_sp1_ep15_pp2
	layer_10_combine_sp1_ep15_pp2 [label="Token Combine L10 SP1 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp1_ep15_pp2 -> layer_10_combine_sp1_ep15_pp2
	layer_10_moe_all2all_sp1_pp2 [label="MoE All-to-All L10 SP1\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_10_combine_sp1_ep0_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep1_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep2_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep3_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep4_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep5_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep6_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep7_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep8_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep9_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep10_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep11_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep12_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep13_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep14_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_combine_sp1_ep15_pp2 -> layer_10_moe_all2all_sp1_pp2
	layer_10_mlp_out_sp1_pp2 [label="MoE Output L10 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_moe_all2all_sp1_pp2 -> layer_10_mlp_out_sp1_pp2
	layer_10_mlp_res_sp1_pp2 [label="MLP Residual L10 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_mlp_out_sp1_pp2 -> layer_10_mlp_res_sp1_pp2
	layer_10_attn_res_sp1_pp2 -> layer_10_mlp_res_sp1_pp2 [style=dashed]
	layer_10_norm_sp2_pp2 [label="LayerNorm L10 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_mlp_out_sp2_pp2 -> layer_10_norm_sp2_pp2
	layer_10_qkv_sp2_tp0_pp2 [label="QKV Proj L10 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp2_pp2 -> layer_10_qkv_sp2_tp0_pp2
	layer_10_attn_sp2_tp0_pp2 [label="Attention L10 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp2_tp0_pp2 -> layer_10_attn_sp2_tp0_pp2
	layer_10_attn_out_sp2_tp0_pp2 [label="Attn Out Proj L10 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp2_tp0_pp2 -> layer_10_attn_out_sp2_tp0_pp2
	layer_10_qkv_sp2_tp1_pp2 [label="QKV Proj L10 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp2_pp2 -> layer_10_qkv_sp2_tp1_pp2
	layer_10_attn_sp2_tp1_pp2 [label="Attention L10 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp2_tp1_pp2 -> layer_10_attn_sp2_tp1_pp2
	layer_10_attn_out_sp2_tp1_pp2 [label="Attn Out Proj L10 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp2_tp1_pp2 -> layer_10_attn_out_sp2_tp1_pp2
	layer_10_qkv_sp2_tp2_pp2 [label="QKV Proj L10 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp2_pp2 -> layer_10_qkv_sp2_tp2_pp2
	layer_10_attn_sp2_tp2_pp2 [label="Attention L10 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp2_tp2_pp2 -> layer_10_attn_sp2_tp2_pp2
	layer_10_attn_out_sp2_tp2_pp2 [label="Attn Out Proj L10 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp2_tp2_pp2 -> layer_10_attn_out_sp2_tp2_pp2
	layer_10_qkv_sp2_tp3_pp2 [label="QKV Proj L10 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp2_pp2 -> layer_10_qkv_sp2_tp3_pp2
	layer_10_attn_sp2_tp3_pp2 [label="Attention L10 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp2_tp3_pp2 -> layer_10_attn_sp2_tp3_pp2
	layer_10_attn_out_sp2_tp3_pp2 [label="Attn Out Proj L10 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp2_tp3_pp2 -> layer_10_attn_out_sp2_tp3_pp2
	layer_10_attn_ar_sp2_pp2 [label="Attention All-Reduce L10 SP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_attn_out_sp2_tp0_pp2 -> layer_10_attn_ar_sp2_pp2
	layer_10_attn_out_sp2_tp1_pp2 -> layer_10_attn_ar_sp2_pp2
	layer_10_attn_out_sp2_tp2_pp2 -> layer_10_attn_ar_sp2_pp2
	layer_10_attn_out_sp2_tp3_pp2 -> layer_10_attn_ar_sp2_pp2
	layer_10_attn_res_sp2_pp2 [label="Attention Residual L10 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_attn_ar_sp2_pp2 -> layer_10_attn_res_sp2_pp2
	layer_10_norm_sp2_pp2 -> layer_10_attn_res_sp2_pp2 [style=dashed]
	layer_10_post_norm_sp2_pp2 [label="Post-Attn Norm L10 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_attn_res_sp2_pp2 -> layer_10_post_norm_sp2_pp2
	layer_10_router_sp2_pp2 [label="MoE Router L10 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_10_post_norm_sp2_pp2 -> layer_10_router_sp2_pp2
	layer_10_dispatch_sp2_ep0_pp2 [label="Token Dispatch L10 SP2 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep0_pp2 [style=dashed]
	layer_10_expert_sp2_ep0_tp0_pp2 [label="Expert L10 SP2 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep0_pp2 -> layer_10_expert_sp2_ep0_tp0_pp2
	layer_10_expert_out_sp2_ep0_tp0_pp2 [label="Expert Out L10 SP2 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep0_tp0_pp2 -> layer_10_expert_out_sp2_ep0_tp0_pp2
	layer_10_expert_sp2_ep0_tp1_pp2 [label="Expert L10 SP2 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep0_pp2 -> layer_10_expert_sp2_ep0_tp1_pp2
	layer_10_expert_out_sp2_ep0_tp1_pp2 [label="Expert Out L10 SP2 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep0_tp1_pp2 -> layer_10_expert_out_sp2_ep0_tp1_pp2
	layer_10_expert_sp2_ep0_tp2_pp2 [label="Expert L10 SP2 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep0_pp2 -> layer_10_expert_sp2_ep0_tp2_pp2
	layer_10_expert_out_sp2_ep0_tp2_pp2 [label="Expert Out L10 SP2 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep0_tp2_pp2 -> layer_10_expert_out_sp2_ep0_tp2_pp2
	layer_10_expert_sp2_ep0_tp3_pp2 [label="Expert L10 SP2 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep0_pp2 -> layer_10_expert_sp2_ep0_tp3_pp2
	layer_10_expert_out_sp2_ep0_tp3_pp2 [label="Expert Out L10 SP2 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep0_tp3_pp2 -> layer_10_expert_out_sp2_ep0_tp3_pp2
	layer_10_expert_ar_sp2_ep0_pp2 [label="Expert All-Reduce L10 SP2 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep0_tp0_pp2 -> layer_10_expert_ar_sp2_ep0_pp2
	layer_10_expert_out_sp2_ep0_tp1_pp2 -> layer_10_expert_ar_sp2_ep0_pp2
	layer_10_expert_out_sp2_ep0_tp2_pp2 -> layer_10_expert_ar_sp2_ep0_pp2
	layer_10_expert_out_sp2_ep0_tp3_pp2 -> layer_10_expert_ar_sp2_ep0_pp2
	layer_10_combine_sp2_ep0_pp2 [label="Token Combine L10 SP2 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep0_pp2 -> layer_10_combine_sp2_ep0_pp2
	layer_10_dispatch_sp2_ep1_pp2 [label="Token Dispatch L10 SP2 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep1_pp2 [style=dashed]
	layer_10_expert_sp2_ep1_tp0_pp2 [label="Expert L10 SP2 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep1_pp2 -> layer_10_expert_sp2_ep1_tp0_pp2
	layer_10_expert_out_sp2_ep1_tp0_pp2 [label="Expert Out L10 SP2 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep1_tp0_pp2 -> layer_10_expert_out_sp2_ep1_tp0_pp2
	layer_10_expert_sp2_ep1_tp1_pp2 [label="Expert L10 SP2 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep1_pp2 -> layer_10_expert_sp2_ep1_tp1_pp2
	layer_10_expert_out_sp2_ep1_tp1_pp2 [label="Expert Out L10 SP2 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep1_tp1_pp2 -> layer_10_expert_out_sp2_ep1_tp1_pp2
	layer_10_expert_sp2_ep1_tp2_pp2 [label="Expert L10 SP2 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep1_pp2 -> layer_10_expert_sp2_ep1_tp2_pp2
	layer_10_expert_out_sp2_ep1_tp2_pp2 [label="Expert Out L10 SP2 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep1_tp2_pp2 -> layer_10_expert_out_sp2_ep1_tp2_pp2
	layer_10_expert_sp2_ep1_tp3_pp2 [label="Expert L10 SP2 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep1_pp2 -> layer_10_expert_sp2_ep1_tp3_pp2
	layer_10_expert_out_sp2_ep1_tp3_pp2 [label="Expert Out L10 SP2 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep1_tp3_pp2 -> layer_10_expert_out_sp2_ep1_tp3_pp2
	layer_10_expert_ar_sp2_ep1_pp2 [label="Expert All-Reduce L10 SP2 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep1_tp0_pp2 -> layer_10_expert_ar_sp2_ep1_pp2
	layer_10_expert_out_sp2_ep1_tp1_pp2 -> layer_10_expert_ar_sp2_ep1_pp2
	layer_10_expert_out_sp2_ep1_tp2_pp2 -> layer_10_expert_ar_sp2_ep1_pp2
	layer_10_expert_out_sp2_ep1_tp3_pp2 -> layer_10_expert_ar_sp2_ep1_pp2
	layer_10_combine_sp2_ep1_pp2 [label="Token Combine L10 SP2 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep1_pp2 -> layer_10_combine_sp2_ep1_pp2
	layer_10_dispatch_sp2_ep2_pp2 [label="Token Dispatch L10 SP2 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep2_pp2 [style=dashed]
	layer_10_expert_sp2_ep2_tp0_pp2 [label="Expert L10 SP2 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep2_pp2 -> layer_10_expert_sp2_ep2_tp0_pp2
	layer_10_expert_out_sp2_ep2_tp0_pp2 [label="Expert Out L10 SP2 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep2_tp0_pp2 -> layer_10_expert_out_sp2_ep2_tp0_pp2
	layer_10_expert_sp2_ep2_tp1_pp2 [label="Expert L10 SP2 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep2_pp2 -> layer_10_expert_sp2_ep2_tp1_pp2
	layer_10_expert_out_sp2_ep2_tp1_pp2 [label="Expert Out L10 SP2 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep2_tp1_pp2 -> layer_10_expert_out_sp2_ep2_tp1_pp2
	layer_10_expert_sp2_ep2_tp2_pp2 [label="Expert L10 SP2 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep2_pp2 -> layer_10_expert_sp2_ep2_tp2_pp2
	layer_10_expert_out_sp2_ep2_tp2_pp2 [label="Expert Out L10 SP2 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep2_tp2_pp2 -> layer_10_expert_out_sp2_ep2_tp2_pp2
	layer_10_expert_sp2_ep2_tp3_pp2 [label="Expert L10 SP2 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep2_pp2 -> layer_10_expert_sp2_ep2_tp3_pp2
	layer_10_expert_out_sp2_ep2_tp3_pp2 [label="Expert Out L10 SP2 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep2_tp3_pp2 -> layer_10_expert_out_sp2_ep2_tp3_pp2
	layer_10_expert_ar_sp2_ep2_pp2 [label="Expert All-Reduce L10 SP2 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep2_tp0_pp2 -> layer_10_expert_ar_sp2_ep2_pp2
	layer_10_expert_out_sp2_ep2_tp1_pp2 -> layer_10_expert_ar_sp2_ep2_pp2
	layer_10_expert_out_sp2_ep2_tp2_pp2 -> layer_10_expert_ar_sp2_ep2_pp2
	layer_10_expert_out_sp2_ep2_tp3_pp2 -> layer_10_expert_ar_sp2_ep2_pp2
	layer_10_combine_sp2_ep2_pp2 [label="Token Combine L10 SP2 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep2_pp2 -> layer_10_combine_sp2_ep2_pp2
	layer_10_dispatch_sp2_ep3_pp2 [label="Token Dispatch L10 SP2 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep3_pp2 [style=dashed]
	layer_10_expert_sp2_ep3_tp0_pp2 [label="Expert L10 SP2 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep3_pp2 -> layer_10_expert_sp2_ep3_tp0_pp2
	layer_10_expert_out_sp2_ep3_tp0_pp2 [label="Expert Out L10 SP2 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep3_tp0_pp2 -> layer_10_expert_out_sp2_ep3_tp0_pp2
	layer_10_expert_sp2_ep3_tp1_pp2 [label="Expert L10 SP2 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep3_pp2 -> layer_10_expert_sp2_ep3_tp1_pp2
	layer_10_expert_out_sp2_ep3_tp1_pp2 [label="Expert Out L10 SP2 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep3_tp1_pp2 -> layer_10_expert_out_sp2_ep3_tp1_pp2
	layer_10_expert_sp2_ep3_tp2_pp2 [label="Expert L10 SP2 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep3_pp2 -> layer_10_expert_sp2_ep3_tp2_pp2
	layer_10_expert_out_sp2_ep3_tp2_pp2 [label="Expert Out L10 SP2 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep3_tp2_pp2 -> layer_10_expert_out_sp2_ep3_tp2_pp2
	layer_10_expert_sp2_ep3_tp3_pp2 [label="Expert L10 SP2 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep3_pp2 -> layer_10_expert_sp2_ep3_tp3_pp2
	layer_10_expert_out_sp2_ep3_tp3_pp2 [label="Expert Out L10 SP2 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep3_tp3_pp2 -> layer_10_expert_out_sp2_ep3_tp3_pp2
	layer_10_expert_ar_sp2_ep3_pp2 [label="Expert All-Reduce L10 SP2 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep3_tp0_pp2 -> layer_10_expert_ar_sp2_ep3_pp2
	layer_10_expert_out_sp2_ep3_tp1_pp2 -> layer_10_expert_ar_sp2_ep3_pp2
	layer_10_expert_out_sp2_ep3_tp2_pp2 -> layer_10_expert_ar_sp2_ep3_pp2
	layer_10_expert_out_sp2_ep3_tp3_pp2 -> layer_10_expert_ar_sp2_ep3_pp2
	layer_10_combine_sp2_ep3_pp2 [label="Token Combine L10 SP2 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep3_pp2 -> layer_10_combine_sp2_ep3_pp2
	layer_10_dispatch_sp2_ep4_pp2 [label="Token Dispatch L10 SP2 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep4_pp2 [style=dashed]
	layer_10_expert_sp2_ep4_tp0_pp2 [label="Expert L10 SP2 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep4_pp2 -> layer_10_expert_sp2_ep4_tp0_pp2
	layer_10_expert_out_sp2_ep4_tp0_pp2 [label="Expert Out L10 SP2 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep4_tp0_pp2 -> layer_10_expert_out_sp2_ep4_tp0_pp2
	layer_10_expert_sp2_ep4_tp1_pp2 [label="Expert L10 SP2 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep4_pp2 -> layer_10_expert_sp2_ep4_tp1_pp2
	layer_10_expert_out_sp2_ep4_tp1_pp2 [label="Expert Out L10 SP2 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep4_tp1_pp2 -> layer_10_expert_out_sp2_ep4_tp1_pp2
	layer_10_expert_sp2_ep4_tp2_pp2 [label="Expert L10 SP2 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep4_pp2 -> layer_10_expert_sp2_ep4_tp2_pp2
	layer_10_expert_out_sp2_ep4_tp2_pp2 [label="Expert Out L10 SP2 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep4_tp2_pp2 -> layer_10_expert_out_sp2_ep4_tp2_pp2
	layer_10_expert_sp2_ep4_tp3_pp2 [label="Expert L10 SP2 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep4_pp2 -> layer_10_expert_sp2_ep4_tp3_pp2
	layer_10_expert_out_sp2_ep4_tp3_pp2 [label="Expert Out L10 SP2 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep4_tp3_pp2 -> layer_10_expert_out_sp2_ep4_tp3_pp2
	layer_10_expert_ar_sp2_ep4_pp2 [label="Expert All-Reduce L10 SP2 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep4_tp0_pp2 -> layer_10_expert_ar_sp2_ep4_pp2
	layer_10_expert_out_sp2_ep4_tp1_pp2 -> layer_10_expert_ar_sp2_ep4_pp2
	layer_10_expert_out_sp2_ep4_tp2_pp2 -> layer_10_expert_ar_sp2_ep4_pp2
	layer_10_expert_out_sp2_ep4_tp3_pp2 -> layer_10_expert_ar_sp2_ep4_pp2
	layer_10_combine_sp2_ep4_pp2 [label="Token Combine L10 SP2 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep4_pp2 -> layer_10_combine_sp2_ep4_pp2
	layer_10_dispatch_sp2_ep5_pp2 [label="Token Dispatch L10 SP2 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep5_pp2 [style=dashed]
	layer_10_expert_sp2_ep5_tp0_pp2 [label="Expert L10 SP2 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep5_pp2 -> layer_10_expert_sp2_ep5_tp0_pp2
	layer_10_expert_out_sp2_ep5_tp0_pp2 [label="Expert Out L10 SP2 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep5_tp0_pp2 -> layer_10_expert_out_sp2_ep5_tp0_pp2
	layer_10_expert_sp2_ep5_tp1_pp2 [label="Expert L10 SP2 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep5_pp2 -> layer_10_expert_sp2_ep5_tp1_pp2
	layer_10_expert_out_sp2_ep5_tp1_pp2 [label="Expert Out L10 SP2 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep5_tp1_pp2 -> layer_10_expert_out_sp2_ep5_tp1_pp2
	layer_10_expert_sp2_ep5_tp2_pp2 [label="Expert L10 SP2 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep5_pp2 -> layer_10_expert_sp2_ep5_tp2_pp2
	layer_10_expert_out_sp2_ep5_tp2_pp2 [label="Expert Out L10 SP2 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep5_tp2_pp2 -> layer_10_expert_out_sp2_ep5_tp2_pp2
	layer_10_expert_sp2_ep5_tp3_pp2 [label="Expert L10 SP2 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep5_pp2 -> layer_10_expert_sp2_ep5_tp3_pp2
	layer_10_expert_out_sp2_ep5_tp3_pp2 [label="Expert Out L10 SP2 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep5_tp3_pp2 -> layer_10_expert_out_sp2_ep5_tp3_pp2
	layer_10_expert_ar_sp2_ep5_pp2 [label="Expert All-Reduce L10 SP2 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep5_tp0_pp2 -> layer_10_expert_ar_sp2_ep5_pp2
	layer_10_expert_out_sp2_ep5_tp1_pp2 -> layer_10_expert_ar_sp2_ep5_pp2
	layer_10_expert_out_sp2_ep5_tp2_pp2 -> layer_10_expert_ar_sp2_ep5_pp2
	layer_10_expert_out_sp2_ep5_tp3_pp2 -> layer_10_expert_ar_sp2_ep5_pp2
	layer_10_combine_sp2_ep5_pp2 [label="Token Combine L10 SP2 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep5_pp2 -> layer_10_combine_sp2_ep5_pp2
	layer_10_dispatch_sp2_ep6_pp2 [label="Token Dispatch L10 SP2 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep6_pp2 [style=dashed]
	layer_10_expert_sp2_ep6_tp0_pp2 [label="Expert L10 SP2 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep6_pp2 -> layer_10_expert_sp2_ep6_tp0_pp2
	layer_10_expert_out_sp2_ep6_tp0_pp2 [label="Expert Out L10 SP2 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep6_tp0_pp2 -> layer_10_expert_out_sp2_ep6_tp0_pp2
	layer_10_expert_sp2_ep6_tp1_pp2 [label="Expert L10 SP2 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep6_pp2 -> layer_10_expert_sp2_ep6_tp1_pp2
	layer_10_expert_out_sp2_ep6_tp1_pp2 [label="Expert Out L10 SP2 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep6_tp1_pp2 -> layer_10_expert_out_sp2_ep6_tp1_pp2
	layer_10_expert_sp2_ep6_tp2_pp2 [label="Expert L10 SP2 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep6_pp2 -> layer_10_expert_sp2_ep6_tp2_pp2
	layer_10_expert_out_sp2_ep6_tp2_pp2 [label="Expert Out L10 SP2 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep6_tp2_pp2 -> layer_10_expert_out_sp2_ep6_tp2_pp2
	layer_10_expert_sp2_ep6_tp3_pp2 [label="Expert L10 SP2 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep6_pp2 -> layer_10_expert_sp2_ep6_tp3_pp2
	layer_10_expert_out_sp2_ep6_tp3_pp2 [label="Expert Out L10 SP2 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep6_tp3_pp2 -> layer_10_expert_out_sp2_ep6_tp3_pp2
	layer_10_expert_ar_sp2_ep6_pp2 [label="Expert All-Reduce L10 SP2 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep6_tp0_pp2 -> layer_10_expert_ar_sp2_ep6_pp2
	layer_10_expert_out_sp2_ep6_tp1_pp2 -> layer_10_expert_ar_sp2_ep6_pp2
	layer_10_expert_out_sp2_ep6_tp2_pp2 -> layer_10_expert_ar_sp2_ep6_pp2
	layer_10_expert_out_sp2_ep6_tp3_pp2 -> layer_10_expert_ar_sp2_ep6_pp2
	layer_10_combine_sp2_ep6_pp2 [label="Token Combine L10 SP2 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep6_pp2 -> layer_10_combine_sp2_ep6_pp2
	layer_10_dispatch_sp2_ep7_pp2 [label="Token Dispatch L10 SP2 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep7_pp2 [style=dashed]
	layer_10_expert_sp2_ep7_tp0_pp2 [label="Expert L10 SP2 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep7_pp2 -> layer_10_expert_sp2_ep7_tp0_pp2
	layer_10_expert_out_sp2_ep7_tp0_pp2 [label="Expert Out L10 SP2 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep7_tp0_pp2 -> layer_10_expert_out_sp2_ep7_tp0_pp2
	layer_10_expert_sp2_ep7_tp1_pp2 [label="Expert L10 SP2 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep7_pp2 -> layer_10_expert_sp2_ep7_tp1_pp2
	layer_10_expert_out_sp2_ep7_tp1_pp2 [label="Expert Out L10 SP2 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep7_tp1_pp2 -> layer_10_expert_out_sp2_ep7_tp1_pp2
	layer_10_expert_sp2_ep7_tp2_pp2 [label="Expert L10 SP2 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep7_pp2 -> layer_10_expert_sp2_ep7_tp2_pp2
	layer_10_expert_out_sp2_ep7_tp2_pp2 [label="Expert Out L10 SP2 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep7_tp2_pp2 -> layer_10_expert_out_sp2_ep7_tp2_pp2
	layer_10_expert_sp2_ep7_tp3_pp2 [label="Expert L10 SP2 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep7_pp2 -> layer_10_expert_sp2_ep7_tp3_pp2
	layer_10_expert_out_sp2_ep7_tp3_pp2 [label="Expert Out L10 SP2 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep7_tp3_pp2 -> layer_10_expert_out_sp2_ep7_tp3_pp2
	layer_10_expert_ar_sp2_ep7_pp2 [label="Expert All-Reduce L10 SP2 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep7_tp0_pp2 -> layer_10_expert_ar_sp2_ep7_pp2
	layer_10_expert_out_sp2_ep7_tp1_pp2 -> layer_10_expert_ar_sp2_ep7_pp2
	layer_10_expert_out_sp2_ep7_tp2_pp2 -> layer_10_expert_ar_sp2_ep7_pp2
	layer_10_expert_out_sp2_ep7_tp3_pp2 -> layer_10_expert_ar_sp2_ep7_pp2
	layer_10_combine_sp2_ep7_pp2 [label="Token Combine L10 SP2 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep7_pp2 -> layer_10_combine_sp2_ep7_pp2
	layer_10_dispatch_sp2_ep8_pp2 [label="Token Dispatch L10 SP2 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep8_pp2 [style=dashed]
	layer_10_expert_sp2_ep8_tp0_pp2 [label="Expert L10 SP2 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep8_pp2 -> layer_10_expert_sp2_ep8_tp0_pp2
	layer_10_expert_out_sp2_ep8_tp0_pp2 [label="Expert Out L10 SP2 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep8_tp0_pp2 -> layer_10_expert_out_sp2_ep8_tp0_pp2
	layer_10_expert_sp2_ep8_tp1_pp2 [label="Expert L10 SP2 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep8_pp2 -> layer_10_expert_sp2_ep8_tp1_pp2
	layer_10_expert_out_sp2_ep8_tp1_pp2 [label="Expert Out L10 SP2 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep8_tp1_pp2 -> layer_10_expert_out_sp2_ep8_tp1_pp2
	layer_10_expert_sp2_ep8_tp2_pp2 [label="Expert L10 SP2 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep8_pp2 -> layer_10_expert_sp2_ep8_tp2_pp2
	layer_10_expert_out_sp2_ep8_tp2_pp2 [label="Expert Out L10 SP2 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep8_tp2_pp2 -> layer_10_expert_out_sp2_ep8_tp2_pp2
	layer_10_expert_sp2_ep8_tp3_pp2 [label="Expert L10 SP2 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep8_pp2 -> layer_10_expert_sp2_ep8_tp3_pp2
	layer_10_expert_out_sp2_ep8_tp3_pp2 [label="Expert Out L10 SP2 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep8_tp3_pp2 -> layer_10_expert_out_sp2_ep8_tp3_pp2
	layer_10_expert_ar_sp2_ep8_pp2 [label="Expert All-Reduce L10 SP2 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep8_tp0_pp2 -> layer_10_expert_ar_sp2_ep8_pp2
	layer_10_expert_out_sp2_ep8_tp1_pp2 -> layer_10_expert_ar_sp2_ep8_pp2
	layer_10_expert_out_sp2_ep8_tp2_pp2 -> layer_10_expert_ar_sp2_ep8_pp2
	layer_10_expert_out_sp2_ep8_tp3_pp2 -> layer_10_expert_ar_sp2_ep8_pp2
	layer_10_combine_sp2_ep8_pp2 [label="Token Combine L10 SP2 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep8_pp2 -> layer_10_combine_sp2_ep8_pp2
	layer_10_dispatch_sp2_ep9_pp2 [label="Token Dispatch L10 SP2 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep9_pp2 [style=dashed]
	layer_10_expert_sp2_ep9_tp0_pp2 [label="Expert L10 SP2 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep9_pp2 -> layer_10_expert_sp2_ep9_tp0_pp2
	layer_10_expert_out_sp2_ep9_tp0_pp2 [label="Expert Out L10 SP2 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep9_tp0_pp2 -> layer_10_expert_out_sp2_ep9_tp0_pp2
	layer_10_expert_sp2_ep9_tp1_pp2 [label="Expert L10 SP2 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep9_pp2 -> layer_10_expert_sp2_ep9_tp1_pp2
	layer_10_expert_out_sp2_ep9_tp1_pp2 [label="Expert Out L10 SP2 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep9_tp1_pp2 -> layer_10_expert_out_sp2_ep9_tp1_pp2
	layer_10_expert_sp2_ep9_tp2_pp2 [label="Expert L10 SP2 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep9_pp2 -> layer_10_expert_sp2_ep9_tp2_pp2
	layer_10_expert_out_sp2_ep9_tp2_pp2 [label="Expert Out L10 SP2 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep9_tp2_pp2 -> layer_10_expert_out_sp2_ep9_tp2_pp2
	layer_10_expert_sp2_ep9_tp3_pp2 [label="Expert L10 SP2 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep9_pp2 -> layer_10_expert_sp2_ep9_tp3_pp2
	layer_10_expert_out_sp2_ep9_tp3_pp2 [label="Expert Out L10 SP2 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep9_tp3_pp2 -> layer_10_expert_out_sp2_ep9_tp3_pp2
	layer_10_expert_ar_sp2_ep9_pp2 [label="Expert All-Reduce L10 SP2 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep9_tp0_pp2 -> layer_10_expert_ar_sp2_ep9_pp2
	layer_10_expert_out_sp2_ep9_tp1_pp2 -> layer_10_expert_ar_sp2_ep9_pp2
	layer_10_expert_out_sp2_ep9_tp2_pp2 -> layer_10_expert_ar_sp2_ep9_pp2
	layer_10_expert_out_sp2_ep9_tp3_pp2 -> layer_10_expert_ar_sp2_ep9_pp2
	layer_10_combine_sp2_ep9_pp2 [label="Token Combine L10 SP2 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep9_pp2 -> layer_10_combine_sp2_ep9_pp2
	layer_10_dispatch_sp2_ep10_pp2 [label="Token Dispatch L10 SP2 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep10_pp2 [style=dashed]
	layer_10_expert_sp2_ep10_tp0_pp2 [label="Expert L10 SP2 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep10_pp2 -> layer_10_expert_sp2_ep10_tp0_pp2
	layer_10_expert_out_sp2_ep10_tp0_pp2 [label="Expert Out L10 SP2 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep10_tp0_pp2 -> layer_10_expert_out_sp2_ep10_tp0_pp2
	layer_10_expert_sp2_ep10_tp1_pp2 [label="Expert L10 SP2 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep10_pp2 -> layer_10_expert_sp2_ep10_tp1_pp2
	layer_10_expert_out_sp2_ep10_tp1_pp2 [label="Expert Out L10 SP2 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep10_tp1_pp2 -> layer_10_expert_out_sp2_ep10_tp1_pp2
	layer_10_expert_sp2_ep10_tp2_pp2 [label="Expert L10 SP2 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep10_pp2 -> layer_10_expert_sp2_ep10_tp2_pp2
	layer_10_expert_out_sp2_ep10_tp2_pp2 [label="Expert Out L10 SP2 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep10_tp2_pp2 -> layer_10_expert_out_sp2_ep10_tp2_pp2
	layer_10_expert_sp2_ep10_tp3_pp2 [label="Expert L10 SP2 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep10_pp2 -> layer_10_expert_sp2_ep10_tp3_pp2
	layer_10_expert_out_sp2_ep10_tp3_pp2 [label="Expert Out L10 SP2 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep10_tp3_pp2 -> layer_10_expert_out_sp2_ep10_tp3_pp2
	layer_10_expert_ar_sp2_ep10_pp2 [label="Expert All-Reduce L10 SP2 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep10_tp0_pp2 -> layer_10_expert_ar_sp2_ep10_pp2
	layer_10_expert_out_sp2_ep10_tp1_pp2 -> layer_10_expert_ar_sp2_ep10_pp2
	layer_10_expert_out_sp2_ep10_tp2_pp2 -> layer_10_expert_ar_sp2_ep10_pp2
	layer_10_expert_out_sp2_ep10_tp3_pp2 -> layer_10_expert_ar_sp2_ep10_pp2
	layer_10_combine_sp2_ep10_pp2 [label="Token Combine L10 SP2 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep10_pp2 -> layer_10_combine_sp2_ep10_pp2
	layer_10_dispatch_sp2_ep11_pp2 [label="Token Dispatch L10 SP2 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep11_pp2 [style=dashed]
	layer_10_expert_sp2_ep11_tp0_pp2 [label="Expert L10 SP2 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep11_pp2 -> layer_10_expert_sp2_ep11_tp0_pp2
	layer_10_expert_out_sp2_ep11_tp0_pp2 [label="Expert Out L10 SP2 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep11_tp0_pp2 -> layer_10_expert_out_sp2_ep11_tp0_pp2
	layer_10_expert_sp2_ep11_tp1_pp2 [label="Expert L10 SP2 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep11_pp2 -> layer_10_expert_sp2_ep11_tp1_pp2
	layer_10_expert_out_sp2_ep11_tp1_pp2 [label="Expert Out L10 SP2 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep11_tp1_pp2 -> layer_10_expert_out_sp2_ep11_tp1_pp2
	layer_10_expert_sp2_ep11_tp2_pp2 [label="Expert L10 SP2 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep11_pp2 -> layer_10_expert_sp2_ep11_tp2_pp2
	layer_10_expert_out_sp2_ep11_tp2_pp2 [label="Expert Out L10 SP2 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep11_tp2_pp2 -> layer_10_expert_out_sp2_ep11_tp2_pp2
	layer_10_expert_sp2_ep11_tp3_pp2 [label="Expert L10 SP2 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep11_pp2 -> layer_10_expert_sp2_ep11_tp3_pp2
	layer_10_expert_out_sp2_ep11_tp3_pp2 [label="Expert Out L10 SP2 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep11_tp3_pp2 -> layer_10_expert_out_sp2_ep11_tp3_pp2
	layer_10_expert_ar_sp2_ep11_pp2 [label="Expert All-Reduce L10 SP2 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep11_tp0_pp2 -> layer_10_expert_ar_sp2_ep11_pp2
	layer_10_expert_out_sp2_ep11_tp1_pp2 -> layer_10_expert_ar_sp2_ep11_pp2
	layer_10_expert_out_sp2_ep11_tp2_pp2 -> layer_10_expert_ar_sp2_ep11_pp2
	layer_10_expert_out_sp2_ep11_tp3_pp2 -> layer_10_expert_ar_sp2_ep11_pp2
	layer_10_combine_sp2_ep11_pp2 [label="Token Combine L10 SP2 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep11_pp2 -> layer_10_combine_sp2_ep11_pp2
	layer_10_dispatch_sp2_ep12_pp2 [label="Token Dispatch L10 SP2 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep12_pp2 [style=dashed]
	layer_10_expert_sp2_ep12_tp0_pp2 [label="Expert L10 SP2 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep12_pp2 -> layer_10_expert_sp2_ep12_tp0_pp2
	layer_10_expert_out_sp2_ep12_tp0_pp2 [label="Expert Out L10 SP2 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep12_tp0_pp2 -> layer_10_expert_out_sp2_ep12_tp0_pp2
	layer_10_expert_sp2_ep12_tp1_pp2 [label="Expert L10 SP2 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep12_pp2 -> layer_10_expert_sp2_ep12_tp1_pp2
	layer_10_expert_out_sp2_ep12_tp1_pp2 [label="Expert Out L10 SP2 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep12_tp1_pp2 -> layer_10_expert_out_sp2_ep12_tp1_pp2
	layer_10_expert_sp2_ep12_tp2_pp2 [label="Expert L10 SP2 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep12_pp2 -> layer_10_expert_sp2_ep12_tp2_pp2
	layer_10_expert_out_sp2_ep12_tp2_pp2 [label="Expert Out L10 SP2 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep12_tp2_pp2 -> layer_10_expert_out_sp2_ep12_tp2_pp2
	layer_10_expert_sp2_ep12_tp3_pp2 [label="Expert L10 SP2 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep12_pp2 -> layer_10_expert_sp2_ep12_tp3_pp2
	layer_10_expert_out_sp2_ep12_tp3_pp2 [label="Expert Out L10 SP2 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep12_tp3_pp2 -> layer_10_expert_out_sp2_ep12_tp3_pp2
	layer_10_expert_ar_sp2_ep12_pp2 [label="Expert All-Reduce L10 SP2 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep12_tp0_pp2 -> layer_10_expert_ar_sp2_ep12_pp2
	layer_10_expert_out_sp2_ep12_tp1_pp2 -> layer_10_expert_ar_sp2_ep12_pp2
	layer_10_expert_out_sp2_ep12_tp2_pp2 -> layer_10_expert_ar_sp2_ep12_pp2
	layer_10_expert_out_sp2_ep12_tp3_pp2 -> layer_10_expert_ar_sp2_ep12_pp2
	layer_10_combine_sp2_ep12_pp2 [label="Token Combine L10 SP2 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep12_pp2 -> layer_10_combine_sp2_ep12_pp2
	layer_10_dispatch_sp2_ep13_pp2 [label="Token Dispatch L10 SP2 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep13_pp2 [style=dashed]
	layer_10_expert_sp2_ep13_tp0_pp2 [label="Expert L10 SP2 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep13_pp2 -> layer_10_expert_sp2_ep13_tp0_pp2
	layer_10_expert_out_sp2_ep13_tp0_pp2 [label="Expert Out L10 SP2 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep13_tp0_pp2 -> layer_10_expert_out_sp2_ep13_tp0_pp2
	layer_10_expert_sp2_ep13_tp1_pp2 [label="Expert L10 SP2 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep13_pp2 -> layer_10_expert_sp2_ep13_tp1_pp2
	layer_10_expert_out_sp2_ep13_tp1_pp2 [label="Expert Out L10 SP2 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep13_tp1_pp2 -> layer_10_expert_out_sp2_ep13_tp1_pp2
	layer_10_expert_sp2_ep13_tp2_pp2 [label="Expert L10 SP2 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep13_pp2 -> layer_10_expert_sp2_ep13_tp2_pp2
	layer_10_expert_out_sp2_ep13_tp2_pp2 [label="Expert Out L10 SP2 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep13_tp2_pp2 -> layer_10_expert_out_sp2_ep13_tp2_pp2
	layer_10_expert_sp2_ep13_tp3_pp2 [label="Expert L10 SP2 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep13_pp2 -> layer_10_expert_sp2_ep13_tp3_pp2
	layer_10_expert_out_sp2_ep13_tp3_pp2 [label="Expert Out L10 SP2 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep13_tp3_pp2 -> layer_10_expert_out_sp2_ep13_tp3_pp2
	layer_10_expert_ar_sp2_ep13_pp2 [label="Expert All-Reduce L10 SP2 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep13_tp0_pp2 -> layer_10_expert_ar_sp2_ep13_pp2
	layer_10_expert_out_sp2_ep13_tp1_pp2 -> layer_10_expert_ar_sp2_ep13_pp2
	layer_10_expert_out_sp2_ep13_tp2_pp2 -> layer_10_expert_ar_sp2_ep13_pp2
	layer_10_expert_out_sp2_ep13_tp3_pp2 -> layer_10_expert_ar_sp2_ep13_pp2
	layer_10_combine_sp2_ep13_pp2 [label="Token Combine L10 SP2 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep13_pp2 -> layer_10_combine_sp2_ep13_pp2
	layer_10_dispatch_sp2_ep14_pp2 [label="Token Dispatch L10 SP2 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep14_pp2 [style=dashed]
	layer_10_expert_sp2_ep14_tp0_pp2 [label="Expert L10 SP2 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep14_pp2 -> layer_10_expert_sp2_ep14_tp0_pp2
	layer_10_expert_out_sp2_ep14_tp0_pp2 [label="Expert Out L10 SP2 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep14_tp0_pp2 -> layer_10_expert_out_sp2_ep14_tp0_pp2
	layer_10_expert_sp2_ep14_tp1_pp2 [label="Expert L10 SP2 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep14_pp2 -> layer_10_expert_sp2_ep14_tp1_pp2
	layer_10_expert_out_sp2_ep14_tp1_pp2 [label="Expert Out L10 SP2 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep14_tp1_pp2 -> layer_10_expert_out_sp2_ep14_tp1_pp2
	layer_10_expert_sp2_ep14_tp2_pp2 [label="Expert L10 SP2 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep14_pp2 -> layer_10_expert_sp2_ep14_tp2_pp2
	layer_10_expert_out_sp2_ep14_tp2_pp2 [label="Expert Out L10 SP2 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep14_tp2_pp2 -> layer_10_expert_out_sp2_ep14_tp2_pp2
	layer_10_expert_sp2_ep14_tp3_pp2 [label="Expert L10 SP2 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep14_pp2 -> layer_10_expert_sp2_ep14_tp3_pp2
	layer_10_expert_out_sp2_ep14_tp3_pp2 [label="Expert Out L10 SP2 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep14_tp3_pp2 -> layer_10_expert_out_sp2_ep14_tp3_pp2
	layer_10_expert_ar_sp2_ep14_pp2 [label="Expert All-Reduce L10 SP2 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep14_tp0_pp2 -> layer_10_expert_ar_sp2_ep14_pp2
	layer_10_expert_out_sp2_ep14_tp1_pp2 -> layer_10_expert_ar_sp2_ep14_pp2
	layer_10_expert_out_sp2_ep14_tp2_pp2 -> layer_10_expert_ar_sp2_ep14_pp2
	layer_10_expert_out_sp2_ep14_tp3_pp2 -> layer_10_expert_ar_sp2_ep14_pp2
	layer_10_combine_sp2_ep14_pp2 [label="Token Combine L10 SP2 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep14_pp2 -> layer_10_combine_sp2_ep14_pp2
	layer_10_dispatch_sp2_ep15_pp2 [label="Token Dispatch L10 SP2 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp2_pp2 -> layer_10_dispatch_sp2_ep15_pp2 [style=dashed]
	layer_10_expert_sp2_ep15_tp0_pp2 [label="Expert L10 SP2 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep15_pp2 -> layer_10_expert_sp2_ep15_tp0_pp2
	layer_10_expert_out_sp2_ep15_tp0_pp2 [label="Expert Out L10 SP2 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep15_tp0_pp2 -> layer_10_expert_out_sp2_ep15_tp0_pp2
	layer_10_expert_sp2_ep15_tp1_pp2 [label="Expert L10 SP2 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep15_pp2 -> layer_10_expert_sp2_ep15_tp1_pp2
	layer_10_expert_out_sp2_ep15_tp1_pp2 [label="Expert Out L10 SP2 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep15_tp1_pp2 -> layer_10_expert_out_sp2_ep15_tp1_pp2
	layer_10_expert_sp2_ep15_tp2_pp2 [label="Expert L10 SP2 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep15_pp2 -> layer_10_expert_sp2_ep15_tp2_pp2
	layer_10_expert_out_sp2_ep15_tp2_pp2 [label="Expert Out L10 SP2 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep15_tp2_pp2 -> layer_10_expert_out_sp2_ep15_tp2_pp2
	layer_10_expert_sp2_ep15_tp3_pp2 [label="Expert L10 SP2 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp2_ep15_pp2 -> layer_10_expert_sp2_ep15_tp3_pp2
	layer_10_expert_out_sp2_ep15_tp3_pp2 [label="Expert Out L10 SP2 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp2_ep15_tp3_pp2 -> layer_10_expert_out_sp2_ep15_tp3_pp2
	layer_10_expert_ar_sp2_ep15_pp2 [label="Expert All-Reduce L10 SP2 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp2_ep15_tp0_pp2 -> layer_10_expert_ar_sp2_ep15_pp2
	layer_10_expert_out_sp2_ep15_tp1_pp2 -> layer_10_expert_ar_sp2_ep15_pp2
	layer_10_expert_out_sp2_ep15_tp2_pp2 -> layer_10_expert_ar_sp2_ep15_pp2
	layer_10_expert_out_sp2_ep15_tp3_pp2 -> layer_10_expert_ar_sp2_ep15_pp2
	layer_10_combine_sp2_ep15_pp2 [label="Token Combine L10 SP2 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp2_ep15_pp2 -> layer_10_combine_sp2_ep15_pp2
	layer_10_moe_all2all_sp2_pp2 [label="MoE All-to-All L10 SP2\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_10_combine_sp2_ep0_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep1_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep2_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep3_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep4_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep5_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep6_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep7_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep8_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep9_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep10_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep11_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep12_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep13_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep14_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_combine_sp2_ep15_pp2 -> layer_10_moe_all2all_sp2_pp2
	layer_10_mlp_out_sp2_pp2 [label="MoE Output L10 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_moe_all2all_sp2_pp2 -> layer_10_mlp_out_sp2_pp2
	layer_10_mlp_res_sp2_pp2 [label="MLP Residual L10 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_mlp_out_sp2_pp2 -> layer_10_mlp_res_sp2_pp2
	layer_10_attn_res_sp2_pp2 -> layer_10_mlp_res_sp2_pp2 [style=dashed]
	layer_10_norm_sp3_pp2 [label="LayerNorm L10 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_9_mlp_out_sp3_pp2 -> layer_10_norm_sp3_pp2
	layer_10_qkv_sp3_tp0_pp2 [label="QKV Proj L10 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp3_pp2 -> layer_10_qkv_sp3_tp0_pp2
	layer_10_attn_sp3_tp0_pp2 [label="Attention L10 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp3_tp0_pp2 -> layer_10_attn_sp3_tp0_pp2
	layer_10_attn_out_sp3_tp0_pp2 [label="Attn Out Proj L10 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp3_tp0_pp2 -> layer_10_attn_out_sp3_tp0_pp2
	layer_10_qkv_sp3_tp1_pp2 [label="QKV Proj L10 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp3_pp2 -> layer_10_qkv_sp3_tp1_pp2
	layer_10_attn_sp3_tp1_pp2 [label="Attention L10 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp3_tp1_pp2 -> layer_10_attn_sp3_tp1_pp2
	layer_10_attn_out_sp3_tp1_pp2 [label="Attn Out Proj L10 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp3_tp1_pp2 -> layer_10_attn_out_sp3_tp1_pp2
	layer_10_qkv_sp3_tp2_pp2 [label="QKV Proj L10 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp3_pp2 -> layer_10_qkv_sp3_tp2_pp2
	layer_10_attn_sp3_tp2_pp2 [label="Attention L10 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp3_tp2_pp2 -> layer_10_attn_sp3_tp2_pp2
	layer_10_attn_out_sp3_tp2_pp2 [label="Attn Out Proj L10 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp3_tp2_pp2 -> layer_10_attn_out_sp3_tp2_pp2
	layer_10_qkv_sp3_tp3_pp2 [label="QKV Proj L10 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_norm_sp3_pp2 -> layer_10_qkv_sp3_tp3_pp2
	layer_10_attn_sp3_tp3_pp2 [label="Attention L10 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_qkv_sp3_tp3_pp2 -> layer_10_attn_sp3_tp3_pp2
	layer_10_attn_out_sp3_tp3_pp2 [label="Attn Out Proj L10 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_10_attn_sp3_tp3_pp2 -> layer_10_attn_out_sp3_tp3_pp2
	layer_10_attn_ar_sp3_pp2 [label="Attention All-Reduce L10 SP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_attn_out_sp3_tp0_pp2 -> layer_10_attn_ar_sp3_pp2
	layer_10_attn_out_sp3_tp1_pp2 -> layer_10_attn_ar_sp3_pp2
	layer_10_attn_out_sp3_tp2_pp2 -> layer_10_attn_ar_sp3_pp2
	layer_10_attn_out_sp3_tp3_pp2 -> layer_10_attn_ar_sp3_pp2
	layer_10_attn_res_sp3_pp2 [label="Attention Residual L10 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_attn_ar_sp3_pp2 -> layer_10_attn_res_sp3_pp2
	layer_10_norm_sp3_pp2 -> layer_10_attn_res_sp3_pp2 [style=dashed]
	layer_10_post_norm_sp3_pp2 [label="Post-Attn Norm L10 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_attn_res_sp3_pp2 -> layer_10_post_norm_sp3_pp2
	layer_10_router_sp3_pp2 [label="MoE Router L10 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_10_post_norm_sp3_pp2 -> layer_10_router_sp3_pp2
	layer_10_dispatch_sp3_ep0_pp2 [label="Token Dispatch L10 SP3 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep0_pp2 [style=dashed]
	layer_10_expert_sp3_ep0_tp0_pp2 [label="Expert L10 SP3 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep0_pp2 -> layer_10_expert_sp3_ep0_tp0_pp2
	layer_10_expert_out_sp3_ep0_tp0_pp2 [label="Expert Out L10 SP3 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep0_tp0_pp2 -> layer_10_expert_out_sp3_ep0_tp0_pp2
	layer_10_expert_sp3_ep0_tp1_pp2 [label="Expert L10 SP3 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep0_pp2 -> layer_10_expert_sp3_ep0_tp1_pp2
	layer_10_expert_out_sp3_ep0_tp1_pp2 [label="Expert Out L10 SP3 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep0_tp1_pp2 -> layer_10_expert_out_sp3_ep0_tp1_pp2
	layer_10_expert_sp3_ep0_tp2_pp2 [label="Expert L10 SP3 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep0_pp2 -> layer_10_expert_sp3_ep0_tp2_pp2
	layer_10_expert_out_sp3_ep0_tp2_pp2 [label="Expert Out L10 SP3 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep0_tp2_pp2 -> layer_10_expert_out_sp3_ep0_tp2_pp2
	layer_10_expert_sp3_ep0_tp3_pp2 [label="Expert L10 SP3 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep0_pp2 -> layer_10_expert_sp3_ep0_tp3_pp2
	layer_10_expert_out_sp3_ep0_tp3_pp2 [label="Expert Out L10 SP3 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep0_tp3_pp2 -> layer_10_expert_out_sp3_ep0_tp3_pp2
	layer_10_expert_ar_sp3_ep0_pp2 [label="Expert All-Reduce L10 SP3 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep0_tp0_pp2 -> layer_10_expert_ar_sp3_ep0_pp2
	layer_10_expert_out_sp3_ep0_tp1_pp2 -> layer_10_expert_ar_sp3_ep0_pp2
	layer_10_expert_out_sp3_ep0_tp2_pp2 -> layer_10_expert_ar_sp3_ep0_pp2
	layer_10_expert_out_sp3_ep0_tp3_pp2 -> layer_10_expert_ar_sp3_ep0_pp2
	layer_10_combine_sp3_ep0_pp2 [label="Token Combine L10 SP3 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep0_pp2 -> layer_10_combine_sp3_ep0_pp2
	layer_10_dispatch_sp3_ep1_pp2 [label="Token Dispatch L10 SP3 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep1_pp2 [style=dashed]
	layer_10_expert_sp3_ep1_tp0_pp2 [label="Expert L10 SP3 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep1_pp2 -> layer_10_expert_sp3_ep1_tp0_pp2
	layer_10_expert_out_sp3_ep1_tp0_pp2 [label="Expert Out L10 SP3 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep1_tp0_pp2 -> layer_10_expert_out_sp3_ep1_tp0_pp2
	layer_10_expert_sp3_ep1_tp1_pp2 [label="Expert L10 SP3 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep1_pp2 -> layer_10_expert_sp3_ep1_tp1_pp2
	layer_10_expert_out_sp3_ep1_tp1_pp2 [label="Expert Out L10 SP3 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep1_tp1_pp2 -> layer_10_expert_out_sp3_ep1_tp1_pp2
	layer_10_expert_sp3_ep1_tp2_pp2 [label="Expert L10 SP3 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep1_pp2 -> layer_10_expert_sp3_ep1_tp2_pp2
	layer_10_expert_out_sp3_ep1_tp2_pp2 [label="Expert Out L10 SP3 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep1_tp2_pp2 -> layer_10_expert_out_sp3_ep1_tp2_pp2
	layer_10_expert_sp3_ep1_tp3_pp2 [label="Expert L10 SP3 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep1_pp2 -> layer_10_expert_sp3_ep1_tp3_pp2
	layer_10_expert_out_sp3_ep1_tp3_pp2 [label="Expert Out L10 SP3 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep1_tp3_pp2 -> layer_10_expert_out_sp3_ep1_tp3_pp2
	layer_10_expert_ar_sp3_ep1_pp2 [label="Expert All-Reduce L10 SP3 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep1_tp0_pp2 -> layer_10_expert_ar_sp3_ep1_pp2
	layer_10_expert_out_sp3_ep1_tp1_pp2 -> layer_10_expert_ar_sp3_ep1_pp2
	layer_10_expert_out_sp3_ep1_tp2_pp2 -> layer_10_expert_ar_sp3_ep1_pp2
	layer_10_expert_out_sp3_ep1_tp3_pp2 -> layer_10_expert_ar_sp3_ep1_pp2
	layer_10_combine_sp3_ep1_pp2 [label="Token Combine L10 SP3 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep1_pp2 -> layer_10_combine_sp3_ep1_pp2
	layer_10_dispatch_sp3_ep2_pp2 [label="Token Dispatch L10 SP3 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep2_pp2 [style=dashed]
	layer_10_expert_sp3_ep2_tp0_pp2 [label="Expert L10 SP3 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep2_pp2 -> layer_10_expert_sp3_ep2_tp0_pp2
	layer_10_expert_out_sp3_ep2_tp0_pp2 [label="Expert Out L10 SP3 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep2_tp0_pp2 -> layer_10_expert_out_sp3_ep2_tp0_pp2
	layer_10_expert_sp3_ep2_tp1_pp2 [label="Expert L10 SP3 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep2_pp2 -> layer_10_expert_sp3_ep2_tp1_pp2
	layer_10_expert_out_sp3_ep2_tp1_pp2 [label="Expert Out L10 SP3 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep2_tp1_pp2 -> layer_10_expert_out_sp3_ep2_tp1_pp2
	layer_10_expert_sp3_ep2_tp2_pp2 [label="Expert L10 SP3 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep2_pp2 -> layer_10_expert_sp3_ep2_tp2_pp2
	layer_10_expert_out_sp3_ep2_tp2_pp2 [label="Expert Out L10 SP3 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep2_tp2_pp2 -> layer_10_expert_out_sp3_ep2_tp2_pp2
	layer_10_expert_sp3_ep2_tp3_pp2 [label="Expert L10 SP3 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep2_pp2 -> layer_10_expert_sp3_ep2_tp3_pp2
	layer_10_expert_out_sp3_ep2_tp3_pp2 [label="Expert Out L10 SP3 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep2_tp3_pp2 -> layer_10_expert_out_sp3_ep2_tp3_pp2
	layer_10_expert_ar_sp3_ep2_pp2 [label="Expert All-Reduce L10 SP3 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep2_tp0_pp2 -> layer_10_expert_ar_sp3_ep2_pp2
	layer_10_expert_out_sp3_ep2_tp1_pp2 -> layer_10_expert_ar_sp3_ep2_pp2
	layer_10_expert_out_sp3_ep2_tp2_pp2 -> layer_10_expert_ar_sp3_ep2_pp2
	layer_10_expert_out_sp3_ep2_tp3_pp2 -> layer_10_expert_ar_sp3_ep2_pp2
	layer_10_combine_sp3_ep2_pp2 [label="Token Combine L10 SP3 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep2_pp2 -> layer_10_combine_sp3_ep2_pp2
	layer_10_dispatch_sp3_ep3_pp2 [label="Token Dispatch L10 SP3 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep3_pp2 [style=dashed]
	layer_10_expert_sp3_ep3_tp0_pp2 [label="Expert L10 SP3 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep3_pp2 -> layer_10_expert_sp3_ep3_tp0_pp2
	layer_10_expert_out_sp3_ep3_tp0_pp2 [label="Expert Out L10 SP3 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep3_tp0_pp2 -> layer_10_expert_out_sp3_ep3_tp0_pp2
	layer_10_expert_sp3_ep3_tp1_pp2 [label="Expert L10 SP3 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep3_pp2 -> layer_10_expert_sp3_ep3_tp1_pp2
	layer_10_expert_out_sp3_ep3_tp1_pp2 [label="Expert Out L10 SP3 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep3_tp1_pp2 -> layer_10_expert_out_sp3_ep3_tp1_pp2
	layer_10_expert_sp3_ep3_tp2_pp2 [label="Expert L10 SP3 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep3_pp2 -> layer_10_expert_sp3_ep3_tp2_pp2
	layer_10_expert_out_sp3_ep3_tp2_pp2 [label="Expert Out L10 SP3 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep3_tp2_pp2 -> layer_10_expert_out_sp3_ep3_tp2_pp2
	layer_10_expert_sp3_ep3_tp3_pp2 [label="Expert L10 SP3 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep3_pp2 -> layer_10_expert_sp3_ep3_tp3_pp2
	layer_10_expert_out_sp3_ep3_tp3_pp2 [label="Expert Out L10 SP3 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep3_tp3_pp2 -> layer_10_expert_out_sp3_ep3_tp3_pp2
	layer_10_expert_ar_sp3_ep3_pp2 [label="Expert All-Reduce L10 SP3 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep3_tp0_pp2 -> layer_10_expert_ar_sp3_ep3_pp2
	layer_10_expert_out_sp3_ep3_tp1_pp2 -> layer_10_expert_ar_sp3_ep3_pp2
	layer_10_expert_out_sp3_ep3_tp2_pp2 -> layer_10_expert_ar_sp3_ep3_pp2
	layer_10_expert_out_sp3_ep3_tp3_pp2 -> layer_10_expert_ar_sp3_ep3_pp2
	layer_10_combine_sp3_ep3_pp2 [label="Token Combine L10 SP3 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep3_pp2 -> layer_10_combine_sp3_ep3_pp2
	layer_10_dispatch_sp3_ep4_pp2 [label="Token Dispatch L10 SP3 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep4_pp2 [style=dashed]
	layer_10_expert_sp3_ep4_tp0_pp2 [label="Expert L10 SP3 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep4_pp2 -> layer_10_expert_sp3_ep4_tp0_pp2
	layer_10_expert_out_sp3_ep4_tp0_pp2 [label="Expert Out L10 SP3 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep4_tp0_pp2 -> layer_10_expert_out_sp3_ep4_tp0_pp2
	layer_10_expert_sp3_ep4_tp1_pp2 [label="Expert L10 SP3 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep4_pp2 -> layer_10_expert_sp3_ep4_tp1_pp2
	layer_10_expert_out_sp3_ep4_tp1_pp2 [label="Expert Out L10 SP3 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep4_tp1_pp2 -> layer_10_expert_out_sp3_ep4_tp1_pp2
	layer_10_expert_sp3_ep4_tp2_pp2 [label="Expert L10 SP3 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep4_pp2 -> layer_10_expert_sp3_ep4_tp2_pp2
	layer_10_expert_out_sp3_ep4_tp2_pp2 [label="Expert Out L10 SP3 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep4_tp2_pp2 -> layer_10_expert_out_sp3_ep4_tp2_pp2
	layer_10_expert_sp3_ep4_tp3_pp2 [label="Expert L10 SP3 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep4_pp2 -> layer_10_expert_sp3_ep4_tp3_pp2
	layer_10_expert_out_sp3_ep4_tp3_pp2 [label="Expert Out L10 SP3 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep4_tp3_pp2 -> layer_10_expert_out_sp3_ep4_tp3_pp2
	layer_10_expert_ar_sp3_ep4_pp2 [label="Expert All-Reduce L10 SP3 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep4_tp0_pp2 -> layer_10_expert_ar_sp3_ep4_pp2
	layer_10_expert_out_sp3_ep4_tp1_pp2 -> layer_10_expert_ar_sp3_ep4_pp2
	layer_10_expert_out_sp3_ep4_tp2_pp2 -> layer_10_expert_ar_sp3_ep4_pp2
	layer_10_expert_out_sp3_ep4_tp3_pp2 -> layer_10_expert_ar_sp3_ep4_pp2
	layer_10_combine_sp3_ep4_pp2 [label="Token Combine L10 SP3 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep4_pp2 -> layer_10_combine_sp3_ep4_pp2
	layer_10_dispatch_sp3_ep5_pp2 [label="Token Dispatch L10 SP3 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep5_pp2 [style=dashed]
	layer_10_expert_sp3_ep5_tp0_pp2 [label="Expert L10 SP3 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep5_pp2 -> layer_10_expert_sp3_ep5_tp0_pp2
	layer_10_expert_out_sp3_ep5_tp0_pp2 [label="Expert Out L10 SP3 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep5_tp0_pp2 -> layer_10_expert_out_sp3_ep5_tp0_pp2
	layer_10_expert_sp3_ep5_tp1_pp2 [label="Expert L10 SP3 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep5_pp2 -> layer_10_expert_sp3_ep5_tp1_pp2
	layer_10_expert_out_sp3_ep5_tp1_pp2 [label="Expert Out L10 SP3 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep5_tp1_pp2 -> layer_10_expert_out_sp3_ep5_tp1_pp2
	layer_10_expert_sp3_ep5_tp2_pp2 [label="Expert L10 SP3 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep5_pp2 -> layer_10_expert_sp3_ep5_tp2_pp2
	layer_10_expert_out_sp3_ep5_tp2_pp2 [label="Expert Out L10 SP3 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep5_tp2_pp2 -> layer_10_expert_out_sp3_ep5_tp2_pp2
	layer_10_expert_sp3_ep5_tp3_pp2 [label="Expert L10 SP3 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep5_pp2 -> layer_10_expert_sp3_ep5_tp3_pp2
	layer_10_expert_out_sp3_ep5_tp3_pp2 [label="Expert Out L10 SP3 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep5_tp3_pp2 -> layer_10_expert_out_sp3_ep5_tp3_pp2
	layer_10_expert_ar_sp3_ep5_pp2 [label="Expert All-Reduce L10 SP3 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep5_tp0_pp2 -> layer_10_expert_ar_sp3_ep5_pp2
	layer_10_expert_out_sp3_ep5_tp1_pp2 -> layer_10_expert_ar_sp3_ep5_pp2
	layer_10_expert_out_sp3_ep5_tp2_pp2 -> layer_10_expert_ar_sp3_ep5_pp2
	layer_10_expert_out_sp3_ep5_tp3_pp2 -> layer_10_expert_ar_sp3_ep5_pp2
	layer_10_combine_sp3_ep5_pp2 [label="Token Combine L10 SP3 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep5_pp2 -> layer_10_combine_sp3_ep5_pp2
	layer_10_dispatch_sp3_ep6_pp2 [label="Token Dispatch L10 SP3 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep6_pp2 [style=dashed]
	layer_10_expert_sp3_ep6_tp0_pp2 [label="Expert L10 SP3 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep6_pp2 -> layer_10_expert_sp3_ep6_tp0_pp2
	layer_10_expert_out_sp3_ep6_tp0_pp2 [label="Expert Out L10 SP3 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep6_tp0_pp2 -> layer_10_expert_out_sp3_ep6_tp0_pp2
	layer_10_expert_sp3_ep6_tp1_pp2 [label="Expert L10 SP3 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep6_pp2 -> layer_10_expert_sp3_ep6_tp1_pp2
	layer_10_expert_out_sp3_ep6_tp1_pp2 [label="Expert Out L10 SP3 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep6_tp1_pp2 -> layer_10_expert_out_sp3_ep6_tp1_pp2
	layer_10_expert_sp3_ep6_tp2_pp2 [label="Expert L10 SP3 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep6_pp2 -> layer_10_expert_sp3_ep6_tp2_pp2
	layer_10_expert_out_sp3_ep6_tp2_pp2 [label="Expert Out L10 SP3 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep6_tp2_pp2 -> layer_10_expert_out_sp3_ep6_tp2_pp2
	layer_10_expert_sp3_ep6_tp3_pp2 [label="Expert L10 SP3 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep6_pp2 -> layer_10_expert_sp3_ep6_tp3_pp2
	layer_10_expert_out_sp3_ep6_tp3_pp2 [label="Expert Out L10 SP3 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep6_tp3_pp2 -> layer_10_expert_out_sp3_ep6_tp3_pp2
	layer_10_expert_ar_sp3_ep6_pp2 [label="Expert All-Reduce L10 SP3 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep6_tp0_pp2 -> layer_10_expert_ar_sp3_ep6_pp2
	layer_10_expert_out_sp3_ep6_tp1_pp2 -> layer_10_expert_ar_sp3_ep6_pp2
	layer_10_expert_out_sp3_ep6_tp2_pp2 -> layer_10_expert_ar_sp3_ep6_pp2
	layer_10_expert_out_sp3_ep6_tp3_pp2 -> layer_10_expert_ar_sp3_ep6_pp2
	layer_10_combine_sp3_ep6_pp2 [label="Token Combine L10 SP3 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep6_pp2 -> layer_10_combine_sp3_ep6_pp2
	layer_10_dispatch_sp3_ep7_pp2 [label="Token Dispatch L10 SP3 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep7_pp2 [style=dashed]
	layer_10_expert_sp3_ep7_tp0_pp2 [label="Expert L10 SP3 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep7_pp2 -> layer_10_expert_sp3_ep7_tp0_pp2
	layer_10_expert_out_sp3_ep7_tp0_pp2 [label="Expert Out L10 SP3 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep7_tp0_pp2 -> layer_10_expert_out_sp3_ep7_tp0_pp2
	layer_10_expert_sp3_ep7_tp1_pp2 [label="Expert L10 SP3 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep7_pp2 -> layer_10_expert_sp3_ep7_tp1_pp2
	layer_10_expert_out_sp3_ep7_tp1_pp2 [label="Expert Out L10 SP3 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep7_tp1_pp2 -> layer_10_expert_out_sp3_ep7_tp1_pp2
	layer_10_expert_sp3_ep7_tp2_pp2 [label="Expert L10 SP3 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep7_pp2 -> layer_10_expert_sp3_ep7_tp2_pp2
	layer_10_expert_out_sp3_ep7_tp2_pp2 [label="Expert Out L10 SP3 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep7_tp2_pp2 -> layer_10_expert_out_sp3_ep7_tp2_pp2
	layer_10_expert_sp3_ep7_tp3_pp2 [label="Expert L10 SP3 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep7_pp2 -> layer_10_expert_sp3_ep7_tp3_pp2
	layer_10_expert_out_sp3_ep7_tp3_pp2 [label="Expert Out L10 SP3 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep7_tp3_pp2 -> layer_10_expert_out_sp3_ep7_tp3_pp2
	layer_10_expert_ar_sp3_ep7_pp2 [label="Expert All-Reduce L10 SP3 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep7_tp0_pp2 -> layer_10_expert_ar_sp3_ep7_pp2
	layer_10_expert_out_sp3_ep7_tp1_pp2 -> layer_10_expert_ar_sp3_ep7_pp2
	layer_10_expert_out_sp3_ep7_tp2_pp2 -> layer_10_expert_ar_sp3_ep7_pp2
	layer_10_expert_out_sp3_ep7_tp3_pp2 -> layer_10_expert_ar_sp3_ep7_pp2
	layer_10_combine_sp3_ep7_pp2 [label="Token Combine L10 SP3 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep7_pp2 -> layer_10_combine_sp3_ep7_pp2
	layer_10_dispatch_sp3_ep8_pp2 [label="Token Dispatch L10 SP3 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep8_pp2 [style=dashed]
	layer_10_expert_sp3_ep8_tp0_pp2 [label="Expert L10 SP3 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep8_pp2 -> layer_10_expert_sp3_ep8_tp0_pp2
	layer_10_expert_out_sp3_ep8_tp0_pp2 [label="Expert Out L10 SP3 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep8_tp0_pp2 -> layer_10_expert_out_sp3_ep8_tp0_pp2
	layer_10_expert_sp3_ep8_tp1_pp2 [label="Expert L10 SP3 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep8_pp2 -> layer_10_expert_sp3_ep8_tp1_pp2
	layer_10_expert_out_sp3_ep8_tp1_pp2 [label="Expert Out L10 SP3 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep8_tp1_pp2 -> layer_10_expert_out_sp3_ep8_tp1_pp2
	layer_10_expert_sp3_ep8_tp2_pp2 [label="Expert L10 SP3 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep8_pp2 -> layer_10_expert_sp3_ep8_tp2_pp2
	layer_10_expert_out_sp3_ep8_tp2_pp2 [label="Expert Out L10 SP3 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep8_tp2_pp2 -> layer_10_expert_out_sp3_ep8_tp2_pp2
	layer_10_expert_sp3_ep8_tp3_pp2 [label="Expert L10 SP3 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep8_pp2 -> layer_10_expert_sp3_ep8_tp3_pp2
	layer_10_expert_out_sp3_ep8_tp3_pp2 [label="Expert Out L10 SP3 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep8_tp3_pp2 -> layer_10_expert_out_sp3_ep8_tp3_pp2
	layer_10_expert_ar_sp3_ep8_pp2 [label="Expert All-Reduce L10 SP3 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep8_tp0_pp2 -> layer_10_expert_ar_sp3_ep8_pp2
	layer_10_expert_out_sp3_ep8_tp1_pp2 -> layer_10_expert_ar_sp3_ep8_pp2
	layer_10_expert_out_sp3_ep8_tp2_pp2 -> layer_10_expert_ar_sp3_ep8_pp2
	layer_10_expert_out_sp3_ep8_tp3_pp2 -> layer_10_expert_ar_sp3_ep8_pp2
	layer_10_combine_sp3_ep8_pp2 [label="Token Combine L10 SP3 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep8_pp2 -> layer_10_combine_sp3_ep8_pp2
	layer_10_dispatch_sp3_ep9_pp2 [label="Token Dispatch L10 SP3 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep9_pp2 [style=dashed]
	layer_10_expert_sp3_ep9_tp0_pp2 [label="Expert L10 SP3 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep9_pp2 -> layer_10_expert_sp3_ep9_tp0_pp2
	layer_10_expert_out_sp3_ep9_tp0_pp2 [label="Expert Out L10 SP3 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep9_tp0_pp2 -> layer_10_expert_out_sp3_ep9_tp0_pp2
	layer_10_expert_sp3_ep9_tp1_pp2 [label="Expert L10 SP3 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep9_pp2 -> layer_10_expert_sp3_ep9_tp1_pp2
	layer_10_expert_out_sp3_ep9_tp1_pp2 [label="Expert Out L10 SP3 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep9_tp1_pp2 -> layer_10_expert_out_sp3_ep9_tp1_pp2
	layer_10_expert_sp3_ep9_tp2_pp2 [label="Expert L10 SP3 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep9_pp2 -> layer_10_expert_sp3_ep9_tp2_pp2
	layer_10_expert_out_sp3_ep9_tp2_pp2 [label="Expert Out L10 SP3 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep9_tp2_pp2 -> layer_10_expert_out_sp3_ep9_tp2_pp2
	layer_10_expert_sp3_ep9_tp3_pp2 [label="Expert L10 SP3 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep9_pp2 -> layer_10_expert_sp3_ep9_tp3_pp2
	layer_10_expert_out_sp3_ep9_tp3_pp2 [label="Expert Out L10 SP3 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep9_tp3_pp2 -> layer_10_expert_out_sp3_ep9_tp3_pp2
	layer_10_expert_ar_sp3_ep9_pp2 [label="Expert All-Reduce L10 SP3 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep9_tp0_pp2 -> layer_10_expert_ar_sp3_ep9_pp2
	layer_10_expert_out_sp3_ep9_tp1_pp2 -> layer_10_expert_ar_sp3_ep9_pp2
	layer_10_expert_out_sp3_ep9_tp2_pp2 -> layer_10_expert_ar_sp3_ep9_pp2
	layer_10_expert_out_sp3_ep9_tp3_pp2 -> layer_10_expert_ar_sp3_ep9_pp2
	layer_10_combine_sp3_ep9_pp2 [label="Token Combine L10 SP3 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep9_pp2 -> layer_10_combine_sp3_ep9_pp2
	layer_10_dispatch_sp3_ep10_pp2 [label="Token Dispatch L10 SP3 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep10_pp2 [style=dashed]
	layer_10_expert_sp3_ep10_tp0_pp2 [label="Expert L10 SP3 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep10_pp2 -> layer_10_expert_sp3_ep10_tp0_pp2
	layer_10_expert_out_sp3_ep10_tp0_pp2 [label="Expert Out L10 SP3 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep10_tp0_pp2 -> layer_10_expert_out_sp3_ep10_tp0_pp2
	layer_10_expert_sp3_ep10_tp1_pp2 [label="Expert L10 SP3 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep10_pp2 -> layer_10_expert_sp3_ep10_tp1_pp2
	layer_10_expert_out_sp3_ep10_tp1_pp2 [label="Expert Out L10 SP3 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep10_tp1_pp2 -> layer_10_expert_out_sp3_ep10_tp1_pp2
	layer_10_expert_sp3_ep10_tp2_pp2 [label="Expert L10 SP3 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep10_pp2 -> layer_10_expert_sp3_ep10_tp2_pp2
	layer_10_expert_out_sp3_ep10_tp2_pp2 [label="Expert Out L10 SP3 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep10_tp2_pp2 -> layer_10_expert_out_sp3_ep10_tp2_pp2
	layer_10_expert_sp3_ep10_tp3_pp2 [label="Expert L10 SP3 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep10_pp2 -> layer_10_expert_sp3_ep10_tp3_pp2
	layer_10_expert_out_sp3_ep10_tp3_pp2 [label="Expert Out L10 SP3 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep10_tp3_pp2 -> layer_10_expert_out_sp3_ep10_tp3_pp2
	layer_10_expert_ar_sp3_ep10_pp2 [label="Expert All-Reduce L10 SP3 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep10_tp0_pp2 -> layer_10_expert_ar_sp3_ep10_pp2
	layer_10_expert_out_sp3_ep10_tp1_pp2 -> layer_10_expert_ar_sp3_ep10_pp2
	layer_10_expert_out_sp3_ep10_tp2_pp2 -> layer_10_expert_ar_sp3_ep10_pp2
	layer_10_expert_out_sp3_ep10_tp3_pp2 -> layer_10_expert_ar_sp3_ep10_pp2
	layer_10_combine_sp3_ep10_pp2 [label="Token Combine L10 SP3 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep10_pp2 -> layer_10_combine_sp3_ep10_pp2
	layer_10_dispatch_sp3_ep11_pp2 [label="Token Dispatch L10 SP3 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep11_pp2 [style=dashed]
	layer_10_expert_sp3_ep11_tp0_pp2 [label="Expert L10 SP3 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep11_pp2 -> layer_10_expert_sp3_ep11_tp0_pp2
	layer_10_expert_out_sp3_ep11_tp0_pp2 [label="Expert Out L10 SP3 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep11_tp0_pp2 -> layer_10_expert_out_sp3_ep11_tp0_pp2
	layer_10_expert_sp3_ep11_tp1_pp2 [label="Expert L10 SP3 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep11_pp2 -> layer_10_expert_sp3_ep11_tp1_pp2
	layer_10_expert_out_sp3_ep11_tp1_pp2 [label="Expert Out L10 SP3 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep11_tp1_pp2 -> layer_10_expert_out_sp3_ep11_tp1_pp2
	layer_10_expert_sp3_ep11_tp2_pp2 [label="Expert L10 SP3 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep11_pp2 -> layer_10_expert_sp3_ep11_tp2_pp2
	layer_10_expert_out_sp3_ep11_tp2_pp2 [label="Expert Out L10 SP3 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep11_tp2_pp2 -> layer_10_expert_out_sp3_ep11_tp2_pp2
	layer_10_expert_sp3_ep11_tp3_pp2 [label="Expert L10 SP3 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep11_pp2 -> layer_10_expert_sp3_ep11_tp3_pp2
	layer_10_expert_out_sp3_ep11_tp3_pp2 [label="Expert Out L10 SP3 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep11_tp3_pp2 -> layer_10_expert_out_sp3_ep11_tp3_pp2
	layer_10_expert_ar_sp3_ep11_pp2 [label="Expert All-Reduce L10 SP3 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep11_tp0_pp2 -> layer_10_expert_ar_sp3_ep11_pp2
	layer_10_expert_out_sp3_ep11_tp1_pp2 -> layer_10_expert_ar_sp3_ep11_pp2
	layer_10_expert_out_sp3_ep11_tp2_pp2 -> layer_10_expert_ar_sp3_ep11_pp2
	layer_10_expert_out_sp3_ep11_tp3_pp2 -> layer_10_expert_ar_sp3_ep11_pp2
	layer_10_combine_sp3_ep11_pp2 [label="Token Combine L10 SP3 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep11_pp2 -> layer_10_combine_sp3_ep11_pp2
	layer_10_dispatch_sp3_ep12_pp2 [label="Token Dispatch L10 SP3 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep12_pp2 [style=dashed]
	layer_10_expert_sp3_ep12_tp0_pp2 [label="Expert L10 SP3 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep12_pp2 -> layer_10_expert_sp3_ep12_tp0_pp2
	layer_10_expert_out_sp3_ep12_tp0_pp2 [label="Expert Out L10 SP3 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep12_tp0_pp2 -> layer_10_expert_out_sp3_ep12_tp0_pp2
	layer_10_expert_sp3_ep12_tp1_pp2 [label="Expert L10 SP3 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep12_pp2 -> layer_10_expert_sp3_ep12_tp1_pp2
	layer_10_expert_out_sp3_ep12_tp1_pp2 [label="Expert Out L10 SP3 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep12_tp1_pp2 -> layer_10_expert_out_sp3_ep12_tp1_pp2
	layer_10_expert_sp3_ep12_tp2_pp2 [label="Expert L10 SP3 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep12_pp2 -> layer_10_expert_sp3_ep12_tp2_pp2
	layer_10_expert_out_sp3_ep12_tp2_pp2 [label="Expert Out L10 SP3 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep12_tp2_pp2 -> layer_10_expert_out_sp3_ep12_tp2_pp2
	layer_10_expert_sp3_ep12_tp3_pp2 [label="Expert L10 SP3 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep12_pp2 -> layer_10_expert_sp3_ep12_tp3_pp2
	layer_10_expert_out_sp3_ep12_tp3_pp2 [label="Expert Out L10 SP3 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep12_tp3_pp2 -> layer_10_expert_out_sp3_ep12_tp3_pp2
	layer_10_expert_ar_sp3_ep12_pp2 [label="Expert All-Reduce L10 SP3 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep12_tp0_pp2 -> layer_10_expert_ar_sp3_ep12_pp2
	layer_10_expert_out_sp3_ep12_tp1_pp2 -> layer_10_expert_ar_sp3_ep12_pp2
	layer_10_expert_out_sp3_ep12_tp2_pp2 -> layer_10_expert_ar_sp3_ep12_pp2
	layer_10_expert_out_sp3_ep12_tp3_pp2 -> layer_10_expert_ar_sp3_ep12_pp2
	layer_10_combine_sp3_ep12_pp2 [label="Token Combine L10 SP3 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep12_pp2 -> layer_10_combine_sp3_ep12_pp2
	layer_10_dispatch_sp3_ep13_pp2 [label="Token Dispatch L10 SP3 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep13_pp2 [style=dashed]
	layer_10_expert_sp3_ep13_tp0_pp2 [label="Expert L10 SP3 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep13_pp2 -> layer_10_expert_sp3_ep13_tp0_pp2
	layer_10_expert_out_sp3_ep13_tp0_pp2 [label="Expert Out L10 SP3 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep13_tp0_pp2 -> layer_10_expert_out_sp3_ep13_tp0_pp2
	layer_10_expert_sp3_ep13_tp1_pp2 [label="Expert L10 SP3 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep13_pp2 -> layer_10_expert_sp3_ep13_tp1_pp2
	layer_10_expert_out_sp3_ep13_tp1_pp2 [label="Expert Out L10 SP3 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep13_tp1_pp2 -> layer_10_expert_out_sp3_ep13_tp1_pp2
	layer_10_expert_sp3_ep13_tp2_pp2 [label="Expert L10 SP3 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep13_pp2 -> layer_10_expert_sp3_ep13_tp2_pp2
	layer_10_expert_out_sp3_ep13_tp2_pp2 [label="Expert Out L10 SP3 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep13_tp2_pp2 -> layer_10_expert_out_sp3_ep13_tp2_pp2
	layer_10_expert_sp3_ep13_tp3_pp2 [label="Expert L10 SP3 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep13_pp2 -> layer_10_expert_sp3_ep13_tp3_pp2
	layer_10_expert_out_sp3_ep13_tp3_pp2 [label="Expert Out L10 SP3 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep13_tp3_pp2 -> layer_10_expert_out_sp3_ep13_tp3_pp2
	layer_10_expert_ar_sp3_ep13_pp2 [label="Expert All-Reduce L10 SP3 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep13_tp0_pp2 -> layer_10_expert_ar_sp3_ep13_pp2
	layer_10_expert_out_sp3_ep13_tp1_pp2 -> layer_10_expert_ar_sp3_ep13_pp2
	layer_10_expert_out_sp3_ep13_tp2_pp2 -> layer_10_expert_ar_sp3_ep13_pp2
	layer_10_expert_out_sp3_ep13_tp3_pp2 -> layer_10_expert_ar_sp3_ep13_pp2
	layer_10_combine_sp3_ep13_pp2 [label="Token Combine L10 SP3 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep13_pp2 -> layer_10_combine_sp3_ep13_pp2
	layer_10_dispatch_sp3_ep14_pp2 [label="Token Dispatch L10 SP3 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep14_pp2 [style=dashed]
	layer_10_expert_sp3_ep14_tp0_pp2 [label="Expert L10 SP3 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep14_pp2 -> layer_10_expert_sp3_ep14_tp0_pp2
	layer_10_expert_out_sp3_ep14_tp0_pp2 [label="Expert Out L10 SP3 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep14_tp0_pp2 -> layer_10_expert_out_sp3_ep14_tp0_pp2
	layer_10_expert_sp3_ep14_tp1_pp2 [label="Expert L10 SP3 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep14_pp2 -> layer_10_expert_sp3_ep14_tp1_pp2
	layer_10_expert_out_sp3_ep14_tp1_pp2 [label="Expert Out L10 SP3 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep14_tp1_pp2 -> layer_10_expert_out_sp3_ep14_tp1_pp2
	layer_10_expert_sp3_ep14_tp2_pp2 [label="Expert L10 SP3 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep14_pp2 -> layer_10_expert_sp3_ep14_tp2_pp2
	layer_10_expert_out_sp3_ep14_tp2_pp2 [label="Expert Out L10 SP3 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep14_tp2_pp2 -> layer_10_expert_out_sp3_ep14_tp2_pp2
	layer_10_expert_sp3_ep14_tp3_pp2 [label="Expert L10 SP3 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep14_pp2 -> layer_10_expert_sp3_ep14_tp3_pp2
	layer_10_expert_out_sp3_ep14_tp3_pp2 [label="Expert Out L10 SP3 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep14_tp3_pp2 -> layer_10_expert_out_sp3_ep14_tp3_pp2
	layer_10_expert_ar_sp3_ep14_pp2 [label="Expert All-Reduce L10 SP3 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep14_tp0_pp2 -> layer_10_expert_ar_sp3_ep14_pp2
	layer_10_expert_out_sp3_ep14_tp1_pp2 -> layer_10_expert_ar_sp3_ep14_pp2
	layer_10_expert_out_sp3_ep14_tp2_pp2 -> layer_10_expert_ar_sp3_ep14_pp2
	layer_10_expert_out_sp3_ep14_tp3_pp2 -> layer_10_expert_ar_sp3_ep14_pp2
	layer_10_combine_sp3_ep14_pp2 [label="Token Combine L10 SP3 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep14_pp2 -> layer_10_combine_sp3_ep14_pp2
	layer_10_dispatch_sp3_ep15_pp2 [label="Token Dispatch L10 SP3 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_10_router_sp3_pp2 -> layer_10_dispatch_sp3_ep15_pp2 [style=dashed]
	layer_10_expert_sp3_ep15_tp0_pp2 [label="Expert L10 SP3 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep15_pp2 -> layer_10_expert_sp3_ep15_tp0_pp2
	layer_10_expert_out_sp3_ep15_tp0_pp2 [label="Expert Out L10 SP3 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep15_tp0_pp2 -> layer_10_expert_out_sp3_ep15_tp0_pp2
	layer_10_expert_sp3_ep15_tp1_pp2 [label="Expert L10 SP3 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep15_pp2 -> layer_10_expert_sp3_ep15_tp1_pp2
	layer_10_expert_out_sp3_ep15_tp1_pp2 [label="Expert Out L10 SP3 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep15_tp1_pp2 -> layer_10_expert_out_sp3_ep15_tp1_pp2
	layer_10_expert_sp3_ep15_tp2_pp2 [label="Expert L10 SP3 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep15_pp2 -> layer_10_expert_sp3_ep15_tp2_pp2
	layer_10_expert_out_sp3_ep15_tp2_pp2 [label="Expert Out L10 SP3 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep15_tp2_pp2 -> layer_10_expert_out_sp3_ep15_tp2_pp2
	layer_10_expert_sp3_ep15_tp3_pp2 [label="Expert L10 SP3 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_dispatch_sp3_ep15_pp2 -> layer_10_expert_sp3_ep15_tp3_pp2
	layer_10_expert_out_sp3_ep15_tp3_pp2 [label="Expert Out L10 SP3 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_10_expert_sp3_ep15_tp3_pp2 -> layer_10_expert_out_sp3_ep15_tp3_pp2
	layer_10_expert_ar_sp3_ep15_pp2 [label="Expert All-Reduce L10 SP3 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_10_expert_out_sp3_ep15_tp0_pp2 -> layer_10_expert_ar_sp3_ep15_pp2
	layer_10_expert_out_sp3_ep15_tp1_pp2 -> layer_10_expert_ar_sp3_ep15_pp2
	layer_10_expert_out_sp3_ep15_tp2_pp2 -> layer_10_expert_ar_sp3_ep15_pp2
	layer_10_expert_out_sp3_ep15_tp3_pp2 -> layer_10_expert_ar_sp3_ep15_pp2
	layer_10_combine_sp3_ep15_pp2 [label="Token Combine L10 SP3 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_10_expert_ar_sp3_ep15_pp2 -> layer_10_combine_sp3_ep15_pp2
	layer_10_moe_all2all_sp3_pp2 [label="MoE All-to-All L10 SP3\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_10_combine_sp3_ep0_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep1_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep2_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep3_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep4_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep5_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep6_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep7_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep8_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep9_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep10_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep11_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep12_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep13_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep14_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_combine_sp3_ep15_pp2 -> layer_10_moe_all2all_sp3_pp2
	layer_10_mlp_out_sp3_pp2 [label="MoE Output L10 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_moe_all2all_sp3_pp2 -> layer_10_mlp_out_sp3_pp2
	layer_10_mlp_res_sp3_pp2 [label="MLP Residual L10 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_mlp_out_sp3_pp2 -> layer_10_mlp_res_sp3_pp2
	layer_10_attn_res_sp3_pp2 -> layer_10_mlp_res_sp3_pp2 [style=dashed]
	layer_11_norm_sp0_pp2 [label="LayerNorm L11 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_mlp_out_sp0_pp2 -> layer_11_norm_sp0_pp2
	layer_11_qkv_sp0_tp0_pp2 [label="QKV Proj L11 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp0_pp2 -> layer_11_qkv_sp0_tp0_pp2
	layer_11_attn_sp0_tp0_pp2 [label="Attention L11 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp0_tp0_pp2 -> layer_11_attn_sp0_tp0_pp2
	layer_11_attn_out_sp0_tp0_pp2 [label="Attn Out Proj L11 SP0 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp0_tp0_pp2 -> layer_11_attn_out_sp0_tp0_pp2
	layer_11_qkv_sp0_tp1_pp2 [label="QKV Proj L11 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp0_pp2 -> layer_11_qkv_sp0_tp1_pp2
	layer_11_attn_sp0_tp1_pp2 [label="Attention L11 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp0_tp1_pp2 -> layer_11_attn_sp0_tp1_pp2
	layer_11_attn_out_sp0_tp1_pp2 [label="Attn Out Proj L11 SP0 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp0_tp1_pp2 -> layer_11_attn_out_sp0_tp1_pp2
	layer_11_qkv_sp0_tp2_pp2 [label="QKV Proj L11 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp0_pp2 -> layer_11_qkv_sp0_tp2_pp2
	layer_11_attn_sp0_tp2_pp2 [label="Attention L11 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp0_tp2_pp2 -> layer_11_attn_sp0_tp2_pp2
	layer_11_attn_out_sp0_tp2_pp2 [label="Attn Out Proj L11 SP0 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp0_tp2_pp2 -> layer_11_attn_out_sp0_tp2_pp2
	layer_11_qkv_sp0_tp3_pp2 [label="QKV Proj L11 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp0_pp2 -> layer_11_qkv_sp0_tp3_pp2
	layer_11_attn_sp0_tp3_pp2 [label="Attention L11 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp0_tp3_pp2 -> layer_11_attn_sp0_tp3_pp2
	layer_11_attn_out_sp0_tp3_pp2 [label="Attn Out Proj L11 SP0 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp0_tp3_pp2 -> layer_11_attn_out_sp0_tp3_pp2
	layer_11_attn_ar_sp0_pp2 [label="Attention All-Reduce L11 SP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_attn_out_sp0_tp0_pp2 -> layer_11_attn_ar_sp0_pp2
	layer_11_attn_out_sp0_tp1_pp2 -> layer_11_attn_ar_sp0_pp2
	layer_11_attn_out_sp0_tp2_pp2 -> layer_11_attn_ar_sp0_pp2
	layer_11_attn_out_sp0_tp3_pp2 -> layer_11_attn_ar_sp0_pp2
	layer_11_attn_res_sp0_pp2 [label="Attention Residual L11 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_attn_ar_sp0_pp2 -> layer_11_attn_res_sp0_pp2
	layer_11_norm_sp0_pp2 -> layer_11_attn_res_sp0_pp2 [style=dashed]
	layer_11_post_norm_sp0_pp2 [label="Post-Attn Norm L11 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_attn_res_sp0_pp2 -> layer_11_post_norm_sp0_pp2
	layer_11_router_sp0_pp2 [label="MoE Router L11 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_11_post_norm_sp0_pp2 -> layer_11_router_sp0_pp2
	layer_11_dispatch_sp0_ep0_pp2 [label="Token Dispatch L11 SP0 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep0_pp2 [style=dashed]
	layer_11_expert_sp0_ep0_tp0_pp2 [label="Expert L11 SP0 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep0_pp2 -> layer_11_expert_sp0_ep0_tp0_pp2
	layer_11_expert_out_sp0_ep0_tp0_pp2 [label="Expert Out L11 SP0 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep0_tp0_pp2 -> layer_11_expert_out_sp0_ep0_tp0_pp2
	layer_11_expert_sp0_ep0_tp1_pp2 [label="Expert L11 SP0 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep0_pp2 -> layer_11_expert_sp0_ep0_tp1_pp2
	layer_11_expert_out_sp0_ep0_tp1_pp2 [label="Expert Out L11 SP0 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep0_tp1_pp2 -> layer_11_expert_out_sp0_ep0_tp1_pp2
	layer_11_expert_sp0_ep0_tp2_pp2 [label="Expert L11 SP0 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep0_pp2 -> layer_11_expert_sp0_ep0_tp2_pp2
	layer_11_expert_out_sp0_ep0_tp2_pp2 [label="Expert Out L11 SP0 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep0_tp2_pp2 -> layer_11_expert_out_sp0_ep0_tp2_pp2
	layer_11_expert_sp0_ep0_tp3_pp2 [label="Expert L11 SP0 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep0_pp2 -> layer_11_expert_sp0_ep0_tp3_pp2
	layer_11_expert_out_sp0_ep0_tp3_pp2 [label="Expert Out L11 SP0 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep0_tp3_pp2 -> layer_11_expert_out_sp0_ep0_tp3_pp2
	layer_11_expert_ar_sp0_ep0_pp2 [label="Expert All-Reduce L11 SP0 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep0_tp0_pp2 -> layer_11_expert_ar_sp0_ep0_pp2
	layer_11_expert_out_sp0_ep0_tp1_pp2 -> layer_11_expert_ar_sp0_ep0_pp2
	layer_11_expert_out_sp0_ep0_tp2_pp2 -> layer_11_expert_ar_sp0_ep0_pp2
	layer_11_expert_out_sp0_ep0_tp3_pp2 -> layer_11_expert_ar_sp0_ep0_pp2
	layer_11_combine_sp0_ep0_pp2 [label="Token Combine L11 SP0 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep0_pp2 -> layer_11_combine_sp0_ep0_pp2
	layer_11_dispatch_sp0_ep1_pp2 [label="Token Dispatch L11 SP0 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep1_pp2 [style=dashed]
	layer_11_expert_sp0_ep1_tp0_pp2 [label="Expert L11 SP0 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep1_pp2 -> layer_11_expert_sp0_ep1_tp0_pp2
	layer_11_expert_out_sp0_ep1_tp0_pp2 [label="Expert Out L11 SP0 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep1_tp0_pp2 -> layer_11_expert_out_sp0_ep1_tp0_pp2
	layer_11_expert_sp0_ep1_tp1_pp2 [label="Expert L11 SP0 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep1_pp2 -> layer_11_expert_sp0_ep1_tp1_pp2
	layer_11_expert_out_sp0_ep1_tp1_pp2 [label="Expert Out L11 SP0 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep1_tp1_pp2 -> layer_11_expert_out_sp0_ep1_tp1_pp2
	layer_11_expert_sp0_ep1_tp2_pp2 [label="Expert L11 SP0 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep1_pp2 -> layer_11_expert_sp0_ep1_tp2_pp2
	layer_11_expert_out_sp0_ep1_tp2_pp2 [label="Expert Out L11 SP0 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep1_tp2_pp2 -> layer_11_expert_out_sp0_ep1_tp2_pp2
	layer_11_expert_sp0_ep1_tp3_pp2 [label="Expert L11 SP0 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep1_pp2 -> layer_11_expert_sp0_ep1_tp3_pp2
	layer_11_expert_out_sp0_ep1_tp3_pp2 [label="Expert Out L11 SP0 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep1_tp3_pp2 -> layer_11_expert_out_sp0_ep1_tp3_pp2
	layer_11_expert_ar_sp0_ep1_pp2 [label="Expert All-Reduce L11 SP0 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep1_tp0_pp2 -> layer_11_expert_ar_sp0_ep1_pp2
	layer_11_expert_out_sp0_ep1_tp1_pp2 -> layer_11_expert_ar_sp0_ep1_pp2
	layer_11_expert_out_sp0_ep1_tp2_pp2 -> layer_11_expert_ar_sp0_ep1_pp2
	layer_11_expert_out_sp0_ep1_tp3_pp2 -> layer_11_expert_ar_sp0_ep1_pp2
	layer_11_combine_sp0_ep1_pp2 [label="Token Combine L11 SP0 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep1_pp2 -> layer_11_combine_sp0_ep1_pp2
	layer_11_dispatch_sp0_ep2_pp2 [label="Token Dispatch L11 SP0 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep2_pp2 [style=dashed]
	layer_11_expert_sp0_ep2_tp0_pp2 [label="Expert L11 SP0 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep2_pp2 -> layer_11_expert_sp0_ep2_tp0_pp2
	layer_11_expert_out_sp0_ep2_tp0_pp2 [label="Expert Out L11 SP0 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep2_tp0_pp2 -> layer_11_expert_out_sp0_ep2_tp0_pp2
	layer_11_expert_sp0_ep2_tp1_pp2 [label="Expert L11 SP0 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep2_pp2 -> layer_11_expert_sp0_ep2_tp1_pp2
	layer_11_expert_out_sp0_ep2_tp1_pp2 [label="Expert Out L11 SP0 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep2_tp1_pp2 -> layer_11_expert_out_sp0_ep2_tp1_pp2
	layer_11_expert_sp0_ep2_tp2_pp2 [label="Expert L11 SP0 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep2_pp2 -> layer_11_expert_sp0_ep2_tp2_pp2
	layer_11_expert_out_sp0_ep2_tp2_pp2 [label="Expert Out L11 SP0 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep2_tp2_pp2 -> layer_11_expert_out_sp0_ep2_tp2_pp2
	layer_11_expert_sp0_ep2_tp3_pp2 [label="Expert L11 SP0 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep2_pp2 -> layer_11_expert_sp0_ep2_tp3_pp2
	layer_11_expert_out_sp0_ep2_tp3_pp2 [label="Expert Out L11 SP0 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep2_tp3_pp2 -> layer_11_expert_out_sp0_ep2_tp3_pp2
	layer_11_expert_ar_sp0_ep2_pp2 [label="Expert All-Reduce L11 SP0 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep2_tp0_pp2 -> layer_11_expert_ar_sp0_ep2_pp2
	layer_11_expert_out_sp0_ep2_tp1_pp2 -> layer_11_expert_ar_sp0_ep2_pp2
	layer_11_expert_out_sp0_ep2_tp2_pp2 -> layer_11_expert_ar_sp0_ep2_pp2
	layer_11_expert_out_sp0_ep2_tp3_pp2 -> layer_11_expert_ar_sp0_ep2_pp2
	layer_11_combine_sp0_ep2_pp2 [label="Token Combine L11 SP0 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep2_pp2 -> layer_11_combine_sp0_ep2_pp2
	layer_11_dispatch_sp0_ep3_pp2 [label="Token Dispatch L11 SP0 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep3_pp2 [style=dashed]
	layer_11_expert_sp0_ep3_tp0_pp2 [label="Expert L11 SP0 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep3_pp2 -> layer_11_expert_sp0_ep3_tp0_pp2
	layer_11_expert_out_sp0_ep3_tp0_pp2 [label="Expert Out L11 SP0 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep3_tp0_pp2 -> layer_11_expert_out_sp0_ep3_tp0_pp2
	layer_11_expert_sp0_ep3_tp1_pp2 [label="Expert L11 SP0 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep3_pp2 -> layer_11_expert_sp0_ep3_tp1_pp2
	layer_11_expert_out_sp0_ep3_tp1_pp2 [label="Expert Out L11 SP0 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep3_tp1_pp2 -> layer_11_expert_out_sp0_ep3_tp1_pp2
	layer_11_expert_sp0_ep3_tp2_pp2 [label="Expert L11 SP0 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep3_pp2 -> layer_11_expert_sp0_ep3_tp2_pp2
	layer_11_expert_out_sp0_ep3_tp2_pp2 [label="Expert Out L11 SP0 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep3_tp2_pp2 -> layer_11_expert_out_sp0_ep3_tp2_pp2
	layer_11_expert_sp0_ep3_tp3_pp2 [label="Expert L11 SP0 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep3_pp2 -> layer_11_expert_sp0_ep3_tp3_pp2
	layer_11_expert_out_sp0_ep3_tp3_pp2 [label="Expert Out L11 SP0 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep3_tp3_pp2 -> layer_11_expert_out_sp0_ep3_tp3_pp2
	layer_11_expert_ar_sp0_ep3_pp2 [label="Expert All-Reduce L11 SP0 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep3_tp0_pp2 -> layer_11_expert_ar_sp0_ep3_pp2
	layer_11_expert_out_sp0_ep3_tp1_pp2 -> layer_11_expert_ar_sp0_ep3_pp2
	layer_11_expert_out_sp0_ep3_tp2_pp2 -> layer_11_expert_ar_sp0_ep3_pp2
	layer_11_expert_out_sp0_ep3_tp3_pp2 -> layer_11_expert_ar_sp0_ep3_pp2
	layer_11_combine_sp0_ep3_pp2 [label="Token Combine L11 SP0 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep3_pp2 -> layer_11_combine_sp0_ep3_pp2
	layer_11_dispatch_sp0_ep4_pp2 [label="Token Dispatch L11 SP0 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep4_pp2 [style=dashed]
	layer_11_expert_sp0_ep4_tp0_pp2 [label="Expert L11 SP0 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep4_pp2 -> layer_11_expert_sp0_ep4_tp0_pp2
	layer_11_expert_out_sp0_ep4_tp0_pp2 [label="Expert Out L11 SP0 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep4_tp0_pp2 -> layer_11_expert_out_sp0_ep4_tp0_pp2
	layer_11_expert_sp0_ep4_tp1_pp2 [label="Expert L11 SP0 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep4_pp2 -> layer_11_expert_sp0_ep4_tp1_pp2
	layer_11_expert_out_sp0_ep4_tp1_pp2 [label="Expert Out L11 SP0 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep4_tp1_pp2 -> layer_11_expert_out_sp0_ep4_tp1_pp2
	layer_11_expert_sp0_ep4_tp2_pp2 [label="Expert L11 SP0 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep4_pp2 -> layer_11_expert_sp0_ep4_tp2_pp2
	layer_11_expert_out_sp0_ep4_tp2_pp2 [label="Expert Out L11 SP0 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep4_tp2_pp2 -> layer_11_expert_out_sp0_ep4_tp2_pp2
	layer_11_expert_sp0_ep4_tp3_pp2 [label="Expert L11 SP0 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep4_pp2 -> layer_11_expert_sp0_ep4_tp3_pp2
	layer_11_expert_out_sp0_ep4_tp3_pp2 [label="Expert Out L11 SP0 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep4_tp3_pp2 -> layer_11_expert_out_sp0_ep4_tp3_pp2
	layer_11_expert_ar_sp0_ep4_pp2 [label="Expert All-Reduce L11 SP0 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep4_tp0_pp2 -> layer_11_expert_ar_sp0_ep4_pp2
	layer_11_expert_out_sp0_ep4_tp1_pp2 -> layer_11_expert_ar_sp0_ep4_pp2
	layer_11_expert_out_sp0_ep4_tp2_pp2 -> layer_11_expert_ar_sp0_ep4_pp2
	layer_11_expert_out_sp0_ep4_tp3_pp2 -> layer_11_expert_ar_sp0_ep4_pp2
	layer_11_combine_sp0_ep4_pp2 [label="Token Combine L11 SP0 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep4_pp2 -> layer_11_combine_sp0_ep4_pp2
	layer_11_dispatch_sp0_ep5_pp2 [label="Token Dispatch L11 SP0 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep5_pp2 [style=dashed]
	layer_11_expert_sp0_ep5_tp0_pp2 [label="Expert L11 SP0 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep5_pp2 -> layer_11_expert_sp0_ep5_tp0_pp2
	layer_11_expert_out_sp0_ep5_tp0_pp2 [label="Expert Out L11 SP0 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep5_tp0_pp2 -> layer_11_expert_out_sp0_ep5_tp0_pp2
	layer_11_expert_sp0_ep5_tp1_pp2 [label="Expert L11 SP0 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep5_pp2 -> layer_11_expert_sp0_ep5_tp1_pp2
	layer_11_expert_out_sp0_ep5_tp1_pp2 [label="Expert Out L11 SP0 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep5_tp1_pp2 -> layer_11_expert_out_sp0_ep5_tp1_pp2
	layer_11_expert_sp0_ep5_tp2_pp2 [label="Expert L11 SP0 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep5_pp2 -> layer_11_expert_sp0_ep5_tp2_pp2
	layer_11_expert_out_sp0_ep5_tp2_pp2 [label="Expert Out L11 SP0 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep5_tp2_pp2 -> layer_11_expert_out_sp0_ep5_tp2_pp2
	layer_11_expert_sp0_ep5_tp3_pp2 [label="Expert L11 SP0 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep5_pp2 -> layer_11_expert_sp0_ep5_tp3_pp2
	layer_11_expert_out_sp0_ep5_tp3_pp2 [label="Expert Out L11 SP0 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep5_tp3_pp2 -> layer_11_expert_out_sp0_ep5_tp3_pp2
	layer_11_expert_ar_sp0_ep5_pp2 [label="Expert All-Reduce L11 SP0 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep5_tp0_pp2 -> layer_11_expert_ar_sp0_ep5_pp2
	layer_11_expert_out_sp0_ep5_tp1_pp2 -> layer_11_expert_ar_sp0_ep5_pp2
	layer_11_expert_out_sp0_ep5_tp2_pp2 -> layer_11_expert_ar_sp0_ep5_pp2
	layer_11_expert_out_sp0_ep5_tp3_pp2 -> layer_11_expert_ar_sp0_ep5_pp2
	layer_11_combine_sp0_ep5_pp2 [label="Token Combine L11 SP0 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep5_pp2 -> layer_11_combine_sp0_ep5_pp2
	layer_11_dispatch_sp0_ep6_pp2 [label="Token Dispatch L11 SP0 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep6_pp2 [style=dashed]
	layer_11_expert_sp0_ep6_tp0_pp2 [label="Expert L11 SP0 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep6_pp2 -> layer_11_expert_sp0_ep6_tp0_pp2
	layer_11_expert_out_sp0_ep6_tp0_pp2 [label="Expert Out L11 SP0 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep6_tp0_pp2 -> layer_11_expert_out_sp0_ep6_tp0_pp2
	layer_11_expert_sp0_ep6_tp1_pp2 [label="Expert L11 SP0 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep6_pp2 -> layer_11_expert_sp0_ep6_tp1_pp2
	layer_11_expert_out_sp0_ep6_tp1_pp2 [label="Expert Out L11 SP0 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep6_tp1_pp2 -> layer_11_expert_out_sp0_ep6_tp1_pp2
	layer_11_expert_sp0_ep6_tp2_pp2 [label="Expert L11 SP0 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep6_pp2 -> layer_11_expert_sp0_ep6_tp2_pp2
	layer_11_expert_out_sp0_ep6_tp2_pp2 [label="Expert Out L11 SP0 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep6_tp2_pp2 -> layer_11_expert_out_sp0_ep6_tp2_pp2
	layer_11_expert_sp0_ep6_tp3_pp2 [label="Expert L11 SP0 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep6_pp2 -> layer_11_expert_sp0_ep6_tp3_pp2
	layer_11_expert_out_sp0_ep6_tp3_pp2 [label="Expert Out L11 SP0 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep6_tp3_pp2 -> layer_11_expert_out_sp0_ep6_tp3_pp2
	layer_11_expert_ar_sp0_ep6_pp2 [label="Expert All-Reduce L11 SP0 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep6_tp0_pp2 -> layer_11_expert_ar_sp0_ep6_pp2
	layer_11_expert_out_sp0_ep6_tp1_pp2 -> layer_11_expert_ar_sp0_ep6_pp2
	layer_11_expert_out_sp0_ep6_tp2_pp2 -> layer_11_expert_ar_sp0_ep6_pp2
	layer_11_expert_out_sp0_ep6_tp3_pp2 -> layer_11_expert_ar_sp0_ep6_pp2
	layer_11_combine_sp0_ep6_pp2 [label="Token Combine L11 SP0 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep6_pp2 -> layer_11_combine_sp0_ep6_pp2
	layer_11_dispatch_sp0_ep7_pp2 [label="Token Dispatch L11 SP0 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep7_pp2 [style=dashed]
	layer_11_expert_sp0_ep7_tp0_pp2 [label="Expert L11 SP0 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep7_pp2 -> layer_11_expert_sp0_ep7_tp0_pp2
	layer_11_expert_out_sp0_ep7_tp0_pp2 [label="Expert Out L11 SP0 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep7_tp0_pp2 -> layer_11_expert_out_sp0_ep7_tp0_pp2
	layer_11_expert_sp0_ep7_tp1_pp2 [label="Expert L11 SP0 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep7_pp2 -> layer_11_expert_sp0_ep7_tp1_pp2
	layer_11_expert_out_sp0_ep7_tp1_pp2 [label="Expert Out L11 SP0 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep7_tp1_pp2 -> layer_11_expert_out_sp0_ep7_tp1_pp2
	layer_11_expert_sp0_ep7_tp2_pp2 [label="Expert L11 SP0 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep7_pp2 -> layer_11_expert_sp0_ep7_tp2_pp2
	layer_11_expert_out_sp0_ep7_tp2_pp2 [label="Expert Out L11 SP0 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep7_tp2_pp2 -> layer_11_expert_out_sp0_ep7_tp2_pp2
	layer_11_expert_sp0_ep7_tp3_pp2 [label="Expert L11 SP0 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep7_pp2 -> layer_11_expert_sp0_ep7_tp3_pp2
	layer_11_expert_out_sp0_ep7_tp3_pp2 [label="Expert Out L11 SP0 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep7_tp3_pp2 -> layer_11_expert_out_sp0_ep7_tp3_pp2
	layer_11_expert_ar_sp0_ep7_pp2 [label="Expert All-Reduce L11 SP0 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep7_tp0_pp2 -> layer_11_expert_ar_sp0_ep7_pp2
	layer_11_expert_out_sp0_ep7_tp1_pp2 -> layer_11_expert_ar_sp0_ep7_pp2
	layer_11_expert_out_sp0_ep7_tp2_pp2 -> layer_11_expert_ar_sp0_ep7_pp2
	layer_11_expert_out_sp0_ep7_tp3_pp2 -> layer_11_expert_ar_sp0_ep7_pp2
	layer_11_combine_sp0_ep7_pp2 [label="Token Combine L11 SP0 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep7_pp2 -> layer_11_combine_sp0_ep7_pp2
	layer_11_dispatch_sp0_ep8_pp2 [label="Token Dispatch L11 SP0 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep8_pp2 [style=dashed]
	layer_11_expert_sp0_ep8_tp0_pp2 [label="Expert L11 SP0 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep8_pp2 -> layer_11_expert_sp0_ep8_tp0_pp2
	layer_11_expert_out_sp0_ep8_tp0_pp2 [label="Expert Out L11 SP0 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep8_tp0_pp2 -> layer_11_expert_out_sp0_ep8_tp0_pp2
	layer_11_expert_sp0_ep8_tp1_pp2 [label="Expert L11 SP0 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep8_pp2 -> layer_11_expert_sp0_ep8_tp1_pp2
	layer_11_expert_out_sp0_ep8_tp1_pp2 [label="Expert Out L11 SP0 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep8_tp1_pp2 -> layer_11_expert_out_sp0_ep8_tp1_pp2
	layer_11_expert_sp0_ep8_tp2_pp2 [label="Expert L11 SP0 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep8_pp2 -> layer_11_expert_sp0_ep8_tp2_pp2
	layer_11_expert_out_sp0_ep8_tp2_pp2 [label="Expert Out L11 SP0 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep8_tp2_pp2 -> layer_11_expert_out_sp0_ep8_tp2_pp2
	layer_11_expert_sp0_ep8_tp3_pp2 [label="Expert L11 SP0 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep8_pp2 -> layer_11_expert_sp0_ep8_tp3_pp2
	layer_11_expert_out_sp0_ep8_tp3_pp2 [label="Expert Out L11 SP0 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep8_tp3_pp2 -> layer_11_expert_out_sp0_ep8_tp3_pp2
	layer_11_expert_ar_sp0_ep8_pp2 [label="Expert All-Reduce L11 SP0 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep8_tp0_pp2 -> layer_11_expert_ar_sp0_ep8_pp2
	layer_11_expert_out_sp0_ep8_tp1_pp2 -> layer_11_expert_ar_sp0_ep8_pp2
	layer_11_expert_out_sp0_ep8_tp2_pp2 -> layer_11_expert_ar_sp0_ep8_pp2
	layer_11_expert_out_sp0_ep8_tp3_pp2 -> layer_11_expert_ar_sp0_ep8_pp2
	layer_11_combine_sp0_ep8_pp2 [label="Token Combine L11 SP0 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep8_pp2 -> layer_11_combine_sp0_ep8_pp2
	layer_11_dispatch_sp0_ep9_pp2 [label="Token Dispatch L11 SP0 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep9_pp2 [style=dashed]
	layer_11_expert_sp0_ep9_tp0_pp2 [label="Expert L11 SP0 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep9_pp2 -> layer_11_expert_sp0_ep9_tp0_pp2
	layer_11_expert_out_sp0_ep9_tp0_pp2 [label="Expert Out L11 SP0 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep9_tp0_pp2 -> layer_11_expert_out_sp0_ep9_tp0_pp2
	layer_11_expert_sp0_ep9_tp1_pp2 [label="Expert L11 SP0 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep9_pp2 -> layer_11_expert_sp0_ep9_tp1_pp2
	layer_11_expert_out_sp0_ep9_tp1_pp2 [label="Expert Out L11 SP0 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep9_tp1_pp2 -> layer_11_expert_out_sp0_ep9_tp1_pp2
	layer_11_expert_sp0_ep9_tp2_pp2 [label="Expert L11 SP0 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep9_pp2 -> layer_11_expert_sp0_ep9_tp2_pp2
	layer_11_expert_out_sp0_ep9_tp2_pp2 [label="Expert Out L11 SP0 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep9_tp2_pp2 -> layer_11_expert_out_sp0_ep9_tp2_pp2
	layer_11_expert_sp0_ep9_tp3_pp2 [label="Expert L11 SP0 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep9_pp2 -> layer_11_expert_sp0_ep9_tp3_pp2
	layer_11_expert_out_sp0_ep9_tp3_pp2 [label="Expert Out L11 SP0 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep9_tp3_pp2 -> layer_11_expert_out_sp0_ep9_tp3_pp2
	layer_11_expert_ar_sp0_ep9_pp2 [label="Expert All-Reduce L11 SP0 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep9_tp0_pp2 -> layer_11_expert_ar_sp0_ep9_pp2
	layer_11_expert_out_sp0_ep9_tp1_pp2 -> layer_11_expert_ar_sp0_ep9_pp2
	layer_11_expert_out_sp0_ep9_tp2_pp2 -> layer_11_expert_ar_sp0_ep9_pp2
	layer_11_expert_out_sp0_ep9_tp3_pp2 -> layer_11_expert_ar_sp0_ep9_pp2
	layer_11_combine_sp0_ep9_pp2 [label="Token Combine L11 SP0 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep9_pp2 -> layer_11_combine_sp0_ep9_pp2
	layer_11_dispatch_sp0_ep10_pp2 [label="Token Dispatch L11 SP0 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep10_pp2 [style=dashed]
	layer_11_expert_sp0_ep10_tp0_pp2 [label="Expert L11 SP0 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep10_pp2 -> layer_11_expert_sp0_ep10_tp0_pp2
	layer_11_expert_out_sp0_ep10_tp0_pp2 [label="Expert Out L11 SP0 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep10_tp0_pp2 -> layer_11_expert_out_sp0_ep10_tp0_pp2
	layer_11_expert_sp0_ep10_tp1_pp2 [label="Expert L11 SP0 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep10_pp2 -> layer_11_expert_sp0_ep10_tp1_pp2
	layer_11_expert_out_sp0_ep10_tp1_pp2 [label="Expert Out L11 SP0 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep10_tp1_pp2 -> layer_11_expert_out_sp0_ep10_tp1_pp2
	layer_11_expert_sp0_ep10_tp2_pp2 [label="Expert L11 SP0 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep10_pp2 -> layer_11_expert_sp0_ep10_tp2_pp2
	layer_11_expert_out_sp0_ep10_tp2_pp2 [label="Expert Out L11 SP0 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep10_tp2_pp2 -> layer_11_expert_out_sp0_ep10_tp2_pp2
	layer_11_expert_sp0_ep10_tp3_pp2 [label="Expert L11 SP0 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep10_pp2 -> layer_11_expert_sp0_ep10_tp3_pp2
	layer_11_expert_out_sp0_ep10_tp3_pp2 [label="Expert Out L11 SP0 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep10_tp3_pp2 -> layer_11_expert_out_sp0_ep10_tp3_pp2
	layer_11_expert_ar_sp0_ep10_pp2 [label="Expert All-Reduce L11 SP0 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep10_tp0_pp2 -> layer_11_expert_ar_sp0_ep10_pp2
	layer_11_expert_out_sp0_ep10_tp1_pp2 -> layer_11_expert_ar_sp0_ep10_pp2
	layer_11_expert_out_sp0_ep10_tp2_pp2 -> layer_11_expert_ar_sp0_ep10_pp2
	layer_11_expert_out_sp0_ep10_tp3_pp2 -> layer_11_expert_ar_sp0_ep10_pp2
	layer_11_combine_sp0_ep10_pp2 [label="Token Combine L11 SP0 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep10_pp2 -> layer_11_combine_sp0_ep10_pp2
	layer_11_dispatch_sp0_ep11_pp2 [label="Token Dispatch L11 SP0 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep11_pp2 [style=dashed]
	layer_11_expert_sp0_ep11_tp0_pp2 [label="Expert L11 SP0 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep11_pp2 -> layer_11_expert_sp0_ep11_tp0_pp2
	layer_11_expert_out_sp0_ep11_tp0_pp2 [label="Expert Out L11 SP0 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep11_tp0_pp2 -> layer_11_expert_out_sp0_ep11_tp0_pp2
	layer_11_expert_sp0_ep11_tp1_pp2 [label="Expert L11 SP0 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep11_pp2 -> layer_11_expert_sp0_ep11_tp1_pp2
	layer_11_expert_out_sp0_ep11_tp1_pp2 [label="Expert Out L11 SP0 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep11_tp1_pp2 -> layer_11_expert_out_sp0_ep11_tp1_pp2
	layer_11_expert_sp0_ep11_tp2_pp2 [label="Expert L11 SP0 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep11_pp2 -> layer_11_expert_sp0_ep11_tp2_pp2
	layer_11_expert_out_sp0_ep11_tp2_pp2 [label="Expert Out L11 SP0 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep11_tp2_pp2 -> layer_11_expert_out_sp0_ep11_tp2_pp2
	layer_11_expert_sp0_ep11_tp3_pp2 [label="Expert L11 SP0 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep11_pp2 -> layer_11_expert_sp0_ep11_tp3_pp2
	layer_11_expert_out_sp0_ep11_tp3_pp2 [label="Expert Out L11 SP0 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep11_tp3_pp2 -> layer_11_expert_out_sp0_ep11_tp3_pp2
	layer_11_expert_ar_sp0_ep11_pp2 [label="Expert All-Reduce L11 SP0 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep11_tp0_pp2 -> layer_11_expert_ar_sp0_ep11_pp2
	layer_11_expert_out_sp0_ep11_tp1_pp2 -> layer_11_expert_ar_sp0_ep11_pp2
	layer_11_expert_out_sp0_ep11_tp2_pp2 -> layer_11_expert_ar_sp0_ep11_pp2
	layer_11_expert_out_sp0_ep11_tp3_pp2 -> layer_11_expert_ar_sp0_ep11_pp2
	layer_11_combine_sp0_ep11_pp2 [label="Token Combine L11 SP0 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep11_pp2 -> layer_11_combine_sp0_ep11_pp2
	layer_11_dispatch_sp0_ep12_pp2 [label="Token Dispatch L11 SP0 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep12_pp2 [style=dashed]
	layer_11_expert_sp0_ep12_tp0_pp2 [label="Expert L11 SP0 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep12_pp2 -> layer_11_expert_sp0_ep12_tp0_pp2
	layer_11_expert_out_sp0_ep12_tp0_pp2 [label="Expert Out L11 SP0 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep12_tp0_pp2 -> layer_11_expert_out_sp0_ep12_tp0_pp2
	layer_11_expert_sp0_ep12_tp1_pp2 [label="Expert L11 SP0 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep12_pp2 -> layer_11_expert_sp0_ep12_tp1_pp2
	layer_11_expert_out_sp0_ep12_tp1_pp2 [label="Expert Out L11 SP0 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep12_tp1_pp2 -> layer_11_expert_out_sp0_ep12_tp1_pp2
	layer_11_expert_sp0_ep12_tp2_pp2 [label="Expert L11 SP0 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep12_pp2 -> layer_11_expert_sp0_ep12_tp2_pp2
	layer_11_expert_out_sp0_ep12_tp2_pp2 [label="Expert Out L11 SP0 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep12_tp2_pp2 -> layer_11_expert_out_sp0_ep12_tp2_pp2
	layer_11_expert_sp0_ep12_tp3_pp2 [label="Expert L11 SP0 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep12_pp2 -> layer_11_expert_sp0_ep12_tp3_pp2
	layer_11_expert_out_sp0_ep12_tp3_pp2 [label="Expert Out L11 SP0 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep12_tp3_pp2 -> layer_11_expert_out_sp0_ep12_tp3_pp2
	layer_11_expert_ar_sp0_ep12_pp2 [label="Expert All-Reduce L11 SP0 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep12_tp0_pp2 -> layer_11_expert_ar_sp0_ep12_pp2
	layer_11_expert_out_sp0_ep12_tp1_pp2 -> layer_11_expert_ar_sp0_ep12_pp2
	layer_11_expert_out_sp0_ep12_tp2_pp2 -> layer_11_expert_ar_sp0_ep12_pp2
	layer_11_expert_out_sp0_ep12_tp3_pp2 -> layer_11_expert_ar_sp0_ep12_pp2
	layer_11_combine_sp0_ep12_pp2 [label="Token Combine L11 SP0 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep12_pp2 -> layer_11_combine_sp0_ep12_pp2
	layer_11_dispatch_sp0_ep13_pp2 [label="Token Dispatch L11 SP0 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep13_pp2 [style=dashed]
	layer_11_expert_sp0_ep13_tp0_pp2 [label="Expert L11 SP0 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep13_pp2 -> layer_11_expert_sp0_ep13_tp0_pp2
	layer_11_expert_out_sp0_ep13_tp0_pp2 [label="Expert Out L11 SP0 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep13_tp0_pp2 -> layer_11_expert_out_sp0_ep13_tp0_pp2
	layer_11_expert_sp0_ep13_tp1_pp2 [label="Expert L11 SP0 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep13_pp2 -> layer_11_expert_sp0_ep13_tp1_pp2
	layer_11_expert_out_sp0_ep13_tp1_pp2 [label="Expert Out L11 SP0 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep13_tp1_pp2 -> layer_11_expert_out_sp0_ep13_tp1_pp2
	layer_11_expert_sp0_ep13_tp2_pp2 [label="Expert L11 SP0 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep13_pp2 -> layer_11_expert_sp0_ep13_tp2_pp2
	layer_11_expert_out_sp0_ep13_tp2_pp2 [label="Expert Out L11 SP0 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep13_tp2_pp2 -> layer_11_expert_out_sp0_ep13_tp2_pp2
	layer_11_expert_sp0_ep13_tp3_pp2 [label="Expert L11 SP0 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep13_pp2 -> layer_11_expert_sp0_ep13_tp3_pp2
	layer_11_expert_out_sp0_ep13_tp3_pp2 [label="Expert Out L11 SP0 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep13_tp3_pp2 -> layer_11_expert_out_sp0_ep13_tp3_pp2
	layer_11_expert_ar_sp0_ep13_pp2 [label="Expert All-Reduce L11 SP0 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep13_tp0_pp2 -> layer_11_expert_ar_sp0_ep13_pp2
	layer_11_expert_out_sp0_ep13_tp1_pp2 -> layer_11_expert_ar_sp0_ep13_pp2
	layer_11_expert_out_sp0_ep13_tp2_pp2 -> layer_11_expert_ar_sp0_ep13_pp2
	layer_11_expert_out_sp0_ep13_tp3_pp2 -> layer_11_expert_ar_sp0_ep13_pp2
	layer_11_combine_sp0_ep13_pp2 [label="Token Combine L11 SP0 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep13_pp2 -> layer_11_combine_sp0_ep13_pp2
	layer_11_dispatch_sp0_ep14_pp2 [label="Token Dispatch L11 SP0 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep14_pp2 [style=dashed]
	layer_11_expert_sp0_ep14_tp0_pp2 [label="Expert L11 SP0 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep14_pp2 -> layer_11_expert_sp0_ep14_tp0_pp2
	layer_11_expert_out_sp0_ep14_tp0_pp2 [label="Expert Out L11 SP0 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep14_tp0_pp2 -> layer_11_expert_out_sp0_ep14_tp0_pp2
	layer_11_expert_sp0_ep14_tp1_pp2 [label="Expert L11 SP0 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep14_pp2 -> layer_11_expert_sp0_ep14_tp1_pp2
	layer_11_expert_out_sp0_ep14_tp1_pp2 [label="Expert Out L11 SP0 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep14_tp1_pp2 -> layer_11_expert_out_sp0_ep14_tp1_pp2
	layer_11_expert_sp0_ep14_tp2_pp2 [label="Expert L11 SP0 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep14_pp2 -> layer_11_expert_sp0_ep14_tp2_pp2
	layer_11_expert_out_sp0_ep14_tp2_pp2 [label="Expert Out L11 SP0 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep14_tp2_pp2 -> layer_11_expert_out_sp0_ep14_tp2_pp2
	layer_11_expert_sp0_ep14_tp3_pp2 [label="Expert L11 SP0 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep14_pp2 -> layer_11_expert_sp0_ep14_tp3_pp2
	layer_11_expert_out_sp0_ep14_tp3_pp2 [label="Expert Out L11 SP0 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep14_tp3_pp2 -> layer_11_expert_out_sp0_ep14_tp3_pp2
	layer_11_expert_ar_sp0_ep14_pp2 [label="Expert All-Reduce L11 SP0 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep14_tp0_pp2 -> layer_11_expert_ar_sp0_ep14_pp2
	layer_11_expert_out_sp0_ep14_tp1_pp2 -> layer_11_expert_ar_sp0_ep14_pp2
	layer_11_expert_out_sp0_ep14_tp2_pp2 -> layer_11_expert_ar_sp0_ep14_pp2
	layer_11_expert_out_sp0_ep14_tp3_pp2 -> layer_11_expert_ar_sp0_ep14_pp2
	layer_11_combine_sp0_ep14_pp2 [label="Token Combine L11 SP0 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep14_pp2 -> layer_11_combine_sp0_ep14_pp2
	layer_11_dispatch_sp0_ep15_pp2 [label="Token Dispatch L11 SP0 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp0_pp2 -> layer_11_dispatch_sp0_ep15_pp2 [style=dashed]
	layer_11_expert_sp0_ep15_tp0_pp2 [label="Expert L11 SP0 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep15_pp2 -> layer_11_expert_sp0_ep15_tp0_pp2
	layer_11_expert_out_sp0_ep15_tp0_pp2 [label="Expert Out L11 SP0 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep15_tp0_pp2 -> layer_11_expert_out_sp0_ep15_tp0_pp2
	layer_11_expert_sp0_ep15_tp1_pp2 [label="Expert L11 SP0 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep15_pp2 -> layer_11_expert_sp0_ep15_tp1_pp2
	layer_11_expert_out_sp0_ep15_tp1_pp2 [label="Expert Out L11 SP0 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep15_tp1_pp2 -> layer_11_expert_out_sp0_ep15_tp1_pp2
	layer_11_expert_sp0_ep15_tp2_pp2 [label="Expert L11 SP0 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep15_pp2 -> layer_11_expert_sp0_ep15_tp2_pp2
	layer_11_expert_out_sp0_ep15_tp2_pp2 [label="Expert Out L11 SP0 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep15_tp2_pp2 -> layer_11_expert_out_sp0_ep15_tp2_pp2
	layer_11_expert_sp0_ep15_tp3_pp2 [label="Expert L11 SP0 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp0_ep15_pp2 -> layer_11_expert_sp0_ep15_tp3_pp2
	layer_11_expert_out_sp0_ep15_tp3_pp2 [label="Expert Out L11 SP0 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp0_ep15_tp3_pp2 -> layer_11_expert_out_sp0_ep15_tp3_pp2
	layer_11_expert_ar_sp0_ep15_pp2 [label="Expert All-Reduce L11 SP0 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp0_ep15_tp0_pp2 -> layer_11_expert_ar_sp0_ep15_pp2
	layer_11_expert_out_sp0_ep15_tp1_pp2 -> layer_11_expert_ar_sp0_ep15_pp2
	layer_11_expert_out_sp0_ep15_tp2_pp2 -> layer_11_expert_ar_sp0_ep15_pp2
	layer_11_expert_out_sp0_ep15_tp3_pp2 -> layer_11_expert_ar_sp0_ep15_pp2
	layer_11_combine_sp0_ep15_pp2 [label="Token Combine L11 SP0 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp0_ep15_pp2 -> layer_11_combine_sp0_ep15_pp2
	layer_11_moe_all2all_sp0_pp2 [label="MoE All-to-All L11 SP0\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_11_combine_sp0_ep0_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep1_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep2_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep3_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep4_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep5_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep6_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep7_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep8_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep9_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep10_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep11_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep12_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep13_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep14_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_combine_sp0_ep15_pp2 -> layer_11_moe_all2all_sp0_pp2
	layer_11_mlp_out_sp0_pp2 [label="MoE Output L11 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_moe_all2all_sp0_pp2 -> layer_11_mlp_out_sp0_pp2
	layer_11_mlp_res_sp0_pp2 [label="MLP Residual L11 SP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_mlp_out_sp0_pp2 -> layer_11_mlp_res_sp0_pp2
	layer_11_attn_res_sp0_pp2 -> layer_11_mlp_res_sp0_pp2 [style=dashed]
	layer_11_norm_sp1_pp2 [label="LayerNorm L11 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_mlp_out_sp1_pp2 -> layer_11_norm_sp1_pp2
	layer_11_qkv_sp1_tp0_pp2 [label="QKV Proj L11 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp1_pp2 -> layer_11_qkv_sp1_tp0_pp2
	layer_11_attn_sp1_tp0_pp2 [label="Attention L11 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp1_tp0_pp2 -> layer_11_attn_sp1_tp0_pp2
	layer_11_attn_out_sp1_tp0_pp2 [label="Attn Out Proj L11 SP1 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp1_tp0_pp2 -> layer_11_attn_out_sp1_tp0_pp2
	layer_11_qkv_sp1_tp1_pp2 [label="QKV Proj L11 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp1_pp2 -> layer_11_qkv_sp1_tp1_pp2
	layer_11_attn_sp1_tp1_pp2 [label="Attention L11 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp1_tp1_pp2 -> layer_11_attn_sp1_tp1_pp2
	layer_11_attn_out_sp1_tp1_pp2 [label="Attn Out Proj L11 SP1 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp1_tp1_pp2 -> layer_11_attn_out_sp1_tp1_pp2
	layer_11_qkv_sp1_tp2_pp2 [label="QKV Proj L11 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp1_pp2 -> layer_11_qkv_sp1_tp2_pp2
	layer_11_attn_sp1_tp2_pp2 [label="Attention L11 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp1_tp2_pp2 -> layer_11_attn_sp1_tp2_pp2
	layer_11_attn_out_sp1_tp2_pp2 [label="Attn Out Proj L11 SP1 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp1_tp2_pp2 -> layer_11_attn_out_sp1_tp2_pp2
	layer_11_qkv_sp1_tp3_pp2 [label="QKV Proj L11 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp1_pp2 -> layer_11_qkv_sp1_tp3_pp2
	layer_11_attn_sp1_tp3_pp2 [label="Attention L11 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp1_tp3_pp2 -> layer_11_attn_sp1_tp3_pp2
	layer_11_attn_out_sp1_tp3_pp2 [label="Attn Out Proj L11 SP1 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp1_tp3_pp2 -> layer_11_attn_out_sp1_tp3_pp2
	layer_11_attn_ar_sp1_pp2 [label="Attention All-Reduce L11 SP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_attn_out_sp1_tp0_pp2 -> layer_11_attn_ar_sp1_pp2
	layer_11_attn_out_sp1_tp1_pp2 -> layer_11_attn_ar_sp1_pp2
	layer_11_attn_out_sp1_tp2_pp2 -> layer_11_attn_ar_sp1_pp2
	layer_11_attn_out_sp1_tp3_pp2 -> layer_11_attn_ar_sp1_pp2
	layer_11_attn_res_sp1_pp2 [label="Attention Residual L11 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_attn_ar_sp1_pp2 -> layer_11_attn_res_sp1_pp2
	layer_11_norm_sp1_pp2 -> layer_11_attn_res_sp1_pp2 [style=dashed]
	layer_11_post_norm_sp1_pp2 [label="Post-Attn Norm L11 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_attn_res_sp1_pp2 -> layer_11_post_norm_sp1_pp2
	layer_11_router_sp1_pp2 [label="MoE Router L11 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_11_post_norm_sp1_pp2 -> layer_11_router_sp1_pp2
	layer_11_dispatch_sp1_ep0_pp2 [label="Token Dispatch L11 SP1 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep0_pp2 [style=dashed]
	layer_11_expert_sp1_ep0_tp0_pp2 [label="Expert L11 SP1 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep0_pp2 -> layer_11_expert_sp1_ep0_tp0_pp2
	layer_11_expert_out_sp1_ep0_tp0_pp2 [label="Expert Out L11 SP1 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep0_tp0_pp2 -> layer_11_expert_out_sp1_ep0_tp0_pp2
	layer_11_expert_sp1_ep0_tp1_pp2 [label="Expert L11 SP1 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep0_pp2 -> layer_11_expert_sp1_ep0_tp1_pp2
	layer_11_expert_out_sp1_ep0_tp1_pp2 [label="Expert Out L11 SP1 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep0_tp1_pp2 -> layer_11_expert_out_sp1_ep0_tp1_pp2
	layer_11_expert_sp1_ep0_tp2_pp2 [label="Expert L11 SP1 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep0_pp2 -> layer_11_expert_sp1_ep0_tp2_pp2
	layer_11_expert_out_sp1_ep0_tp2_pp2 [label="Expert Out L11 SP1 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep0_tp2_pp2 -> layer_11_expert_out_sp1_ep0_tp2_pp2
	layer_11_expert_sp1_ep0_tp3_pp2 [label="Expert L11 SP1 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep0_pp2 -> layer_11_expert_sp1_ep0_tp3_pp2
	layer_11_expert_out_sp1_ep0_tp3_pp2 [label="Expert Out L11 SP1 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep0_tp3_pp2 -> layer_11_expert_out_sp1_ep0_tp3_pp2
	layer_11_expert_ar_sp1_ep0_pp2 [label="Expert All-Reduce L11 SP1 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep0_tp0_pp2 -> layer_11_expert_ar_sp1_ep0_pp2
	layer_11_expert_out_sp1_ep0_tp1_pp2 -> layer_11_expert_ar_sp1_ep0_pp2
	layer_11_expert_out_sp1_ep0_tp2_pp2 -> layer_11_expert_ar_sp1_ep0_pp2
	layer_11_expert_out_sp1_ep0_tp3_pp2 -> layer_11_expert_ar_sp1_ep0_pp2
	layer_11_combine_sp1_ep0_pp2 [label="Token Combine L11 SP1 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep0_pp2 -> layer_11_combine_sp1_ep0_pp2
	layer_11_dispatch_sp1_ep1_pp2 [label="Token Dispatch L11 SP1 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep1_pp2 [style=dashed]
	layer_11_expert_sp1_ep1_tp0_pp2 [label="Expert L11 SP1 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep1_pp2 -> layer_11_expert_sp1_ep1_tp0_pp2
	layer_11_expert_out_sp1_ep1_tp0_pp2 [label="Expert Out L11 SP1 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep1_tp0_pp2 -> layer_11_expert_out_sp1_ep1_tp0_pp2
	layer_11_expert_sp1_ep1_tp1_pp2 [label="Expert L11 SP1 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep1_pp2 -> layer_11_expert_sp1_ep1_tp1_pp2
	layer_11_expert_out_sp1_ep1_tp1_pp2 [label="Expert Out L11 SP1 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep1_tp1_pp2 -> layer_11_expert_out_sp1_ep1_tp1_pp2
	layer_11_expert_sp1_ep1_tp2_pp2 [label="Expert L11 SP1 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep1_pp2 -> layer_11_expert_sp1_ep1_tp2_pp2
	layer_11_expert_out_sp1_ep1_tp2_pp2 [label="Expert Out L11 SP1 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep1_tp2_pp2 -> layer_11_expert_out_sp1_ep1_tp2_pp2
	layer_11_expert_sp1_ep1_tp3_pp2 [label="Expert L11 SP1 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep1_pp2 -> layer_11_expert_sp1_ep1_tp3_pp2
	layer_11_expert_out_sp1_ep1_tp3_pp2 [label="Expert Out L11 SP1 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep1_tp3_pp2 -> layer_11_expert_out_sp1_ep1_tp3_pp2
	layer_11_expert_ar_sp1_ep1_pp2 [label="Expert All-Reduce L11 SP1 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep1_tp0_pp2 -> layer_11_expert_ar_sp1_ep1_pp2
	layer_11_expert_out_sp1_ep1_tp1_pp2 -> layer_11_expert_ar_sp1_ep1_pp2
	layer_11_expert_out_sp1_ep1_tp2_pp2 -> layer_11_expert_ar_sp1_ep1_pp2
	layer_11_expert_out_sp1_ep1_tp3_pp2 -> layer_11_expert_ar_sp1_ep1_pp2
	layer_11_combine_sp1_ep1_pp2 [label="Token Combine L11 SP1 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep1_pp2 -> layer_11_combine_sp1_ep1_pp2
	layer_11_dispatch_sp1_ep2_pp2 [label="Token Dispatch L11 SP1 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep2_pp2 [style=dashed]
	layer_11_expert_sp1_ep2_tp0_pp2 [label="Expert L11 SP1 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep2_pp2 -> layer_11_expert_sp1_ep2_tp0_pp2
	layer_11_expert_out_sp1_ep2_tp0_pp2 [label="Expert Out L11 SP1 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep2_tp0_pp2 -> layer_11_expert_out_sp1_ep2_tp0_pp2
	layer_11_expert_sp1_ep2_tp1_pp2 [label="Expert L11 SP1 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep2_pp2 -> layer_11_expert_sp1_ep2_tp1_pp2
	layer_11_expert_out_sp1_ep2_tp1_pp2 [label="Expert Out L11 SP1 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep2_tp1_pp2 -> layer_11_expert_out_sp1_ep2_tp1_pp2
	layer_11_expert_sp1_ep2_tp2_pp2 [label="Expert L11 SP1 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep2_pp2 -> layer_11_expert_sp1_ep2_tp2_pp2
	layer_11_expert_out_sp1_ep2_tp2_pp2 [label="Expert Out L11 SP1 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep2_tp2_pp2 -> layer_11_expert_out_sp1_ep2_tp2_pp2
	layer_11_expert_sp1_ep2_tp3_pp2 [label="Expert L11 SP1 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep2_pp2 -> layer_11_expert_sp1_ep2_tp3_pp2
	layer_11_expert_out_sp1_ep2_tp3_pp2 [label="Expert Out L11 SP1 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep2_tp3_pp2 -> layer_11_expert_out_sp1_ep2_tp3_pp2
	layer_11_expert_ar_sp1_ep2_pp2 [label="Expert All-Reduce L11 SP1 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep2_tp0_pp2 -> layer_11_expert_ar_sp1_ep2_pp2
	layer_11_expert_out_sp1_ep2_tp1_pp2 -> layer_11_expert_ar_sp1_ep2_pp2
	layer_11_expert_out_sp1_ep2_tp2_pp2 -> layer_11_expert_ar_sp1_ep2_pp2
	layer_11_expert_out_sp1_ep2_tp3_pp2 -> layer_11_expert_ar_sp1_ep2_pp2
	layer_11_combine_sp1_ep2_pp2 [label="Token Combine L11 SP1 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep2_pp2 -> layer_11_combine_sp1_ep2_pp2
	layer_11_dispatch_sp1_ep3_pp2 [label="Token Dispatch L11 SP1 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep3_pp2 [style=dashed]
	layer_11_expert_sp1_ep3_tp0_pp2 [label="Expert L11 SP1 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep3_pp2 -> layer_11_expert_sp1_ep3_tp0_pp2
	layer_11_expert_out_sp1_ep3_tp0_pp2 [label="Expert Out L11 SP1 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep3_tp0_pp2 -> layer_11_expert_out_sp1_ep3_tp0_pp2
	layer_11_expert_sp1_ep3_tp1_pp2 [label="Expert L11 SP1 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep3_pp2 -> layer_11_expert_sp1_ep3_tp1_pp2
	layer_11_expert_out_sp1_ep3_tp1_pp2 [label="Expert Out L11 SP1 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep3_tp1_pp2 -> layer_11_expert_out_sp1_ep3_tp1_pp2
	layer_11_expert_sp1_ep3_tp2_pp2 [label="Expert L11 SP1 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep3_pp2 -> layer_11_expert_sp1_ep3_tp2_pp2
	layer_11_expert_out_sp1_ep3_tp2_pp2 [label="Expert Out L11 SP1 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep3_tp2_pp2 -> layer_11_expert_out_sp1_ep3_tp2_pp2
	layer_11_expert_sp1_ep3_tp3_pp2 [label="Expert L11 SP1 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep3_pp2 -> layer_11_expert_sp1_ep3_tp3_pp2
	layer_11_expert_out_sp1_ep3_tp3_pp2 [label="Expert Out L11 SP1 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep3_tp3_pp2 -> layer_11_expert_out_sp1_ep3_tp3_pp2
	layer_11_expert_ar_sp1_ep3_pp2 [label="Expert All-Reduce L11 SP1 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep3_tp0_pp2 -> layer_11_expert_ar_sp1_ep3_pp2
	layer_11_expert_out_sp1_ep3_tp1_pp2 -> layer_11_expert_ar_sp1_ep3_pp2
	layer_11_expert_out_sp1_ep3_tp2_pp2 -> layer_11_expert_ar_sp1_ep3_pp2
	layer_11_expert_out_sp1_ep3_tp3_pp2 -> layer_11_expert_ar_sp1_ep3_pp2
	layer_11_combine_sp1_ep3_pp2 [label="Token Combine L11 SP1 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep3_pp2 -> layer_11_combine_sp1_ep3_pp2
	layer_11_dispatch_sp1_ep4_pp2 [label="Token Dispatch L11 SP1 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep4_pp2 [style=dashed]
	layer_11_expert_sp1_ep4_tp0_pp2 [label="Expert L11 SP1 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep4_pp2 -> layer_11_expert_sp1_ep4_tp0_pp2
	layer_11_expert_out_sp1_ep4_tp0_pp2 [label="Expert Out L11 SP1 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep4_tp0_pp2 -> layer_11_expert_out_sp1_ep4_tp0_pp2
	layer_11_expert_sp1_ep4_tp1_pp2 [label="Expert L11 SP1 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep4_pp2 -> layer_11_expert_sp1_ep4_tp1_pp2
	layer_11_expert_out_sp1_ep4_tp1_pp2 [label="Expert Out L11 SP1 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep4_tp1_pp2 -> layer_11_expert_out_sp1_ep4_tp1_pp2
	layer_11_expert_sp1_ep4_tp2_pp2 [label="Expert L11 SP1 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep4_pp2 -> layer_11_expert_sp1_ep4_tp2_pp2
	layer_11_expert_out_sp1_ep4_tp2_pp2 [label="Expert Out L11 SP1 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep4_tp2_pp2 -> layer_11_expert_out_sp1_ep4_tp2_pp2
	layer_11_expert_sp1_ep4_tp3_pp2 [label="Expert L11 SP1 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep4_pp2 -> layer_11_expert_sp1_ep4_tp3_pp2
	layer_11_expert_out_sp1_ep4_tp3_pp2 [label="Expert Out L11 SP1 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep4_tp3_pp2 -> layer_11_expert_out_sp1_ep4_tp3_pp2
	layer_11_expert_ar_sp1_ep4_pp2 [label="Expert All-Reduce L11 SP1 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep4_tp0_pp2 -> layer_11_expert_ar_sp1_ep4_pp2
	layer_11_expert_out_sp1_ep4_tp1_pp2 -> layer_11_expert_ar_sp1_ep4_pp2
	layer_11_expert_out_sp1_ep4_tp2_pp2 -> layer_11_expert_ar_sp1_ep4_pp2
	layer_11_expert_out_sp1_ep4_tp3_pp2 -> layer_11_expert_ar_sp1_ep4_pp2
	layer_11_combine_sp1_ep4_pp2 [label="Token Combine L11 SP1 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep4_pp2 -> layer_11_combine_sp1_ep4_pp2
	layer_11_dispatch_sp1_ep5_pp2 [label="Token Dispatch L11 SP1 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep5_pp2 [style=dashed]
	layer_11_expert_sp1_ep5_tp0_pp2 [label="Expert L11 SP1 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep5_pp2 -> layer_11_expert_sp1_ep5_tp0_pp2
	layer_11_expert_out_sp1_ep5_tp0_pp2 [label="Expert Out L11 SP1 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep5_tp0_pp2 -> layer_11_expert_out_sp1_ep5_tp0_pp2
	layer_11_expert_sp1_ep5_tp1_pp2 [label="Expert L11 SP1 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep5_pp2 -> layer_11_expert_sp1_ep5_tp1_pp2
	layer_11_expert_out_sp1_ep5_tp1_pp2 [label="Expert Out L11 SP1 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep5_tp1_pp2 -> layer_11_expert_out_sp1_ep5_tp1_pp2
	layer_11_expert_sp1_ep5_tp2_pp2 [label="Expert L11 SP1 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep5_pp2 -> layer_11_expert_sp1_ep5_tp2_pp2
	layer_11_expert_out_sp1_ep5_tp2_pp2 [label="Expert Out L11 SP1 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep5_tp2_pp2 -> layer_11_expert_out_sp1_ep5_tp2_pp2
	layer_11_expert_sp1_ep5_tp3_pp2 [label="Expert L11 SP1 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep5_pp2 -> layer_11_expert_sp1_ep5_tp3_pp2
	layer_11_expert_out_sp1_ep5_tp3_pp2 [label="Expert Out L11 SP1 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep5_tp3_pp2 -> layer_11_expert_out_sp1_ep5_tp3_pp2
	layer_11_expert_ar_sp1_ep5_pp2 [label="Expert All-Reduce L11 SP1 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep5_tp0_pp2 -> layer_11_expert_ar_sp1_ep5_pp2
	layer_11_expert_out_sp1_ep5_tp1_pp2 -> layer_11_expert_ar_sp1_ep5_pp2
	layer_11_expert_out_sp1_ep5_tp2_pp2 -> layer_11_expert_ar_sp1_ep5_pp2
	layer_11_expert_out_sp1_ep5_tp3_pp2 -> layer_11_expert_ar_sp1_ep5_pp2
	layer_11_combine_sp1_ep5_pp2 [label="Token Combine L11 SP1 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep5_pp2 -> layer_11_combine_sp1_ep5_pp2
	layer_11_dispatch_sp1_ep6_pp2 [label="Token Dispatch L11 SP1 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep6_pp2 [style=dashed]
	layer_11_expert_sp1_ep6_tp0_pp2 [label="Expert L11 SP1 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep6_pp2 -> layer_11_expert_sp1_ep6_tp0_pp2
	layer_11_expert_out_sp1_ep6_tp0_pp2 [label="Expert Out L11 SP1 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep6_tp0_pp2 -> layer_11_expert_out_sp1_ep6_tp0_pp2
	layer_11_expert_sp1_ep6_tp1_pp2 [label="Expert L11 SP1 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep6_pp2 -> layer_11_expert_sp1_ep6_tp1_pp2
	layer_11_expert_out_sp1_ep6_tp1_pp2 [label="Expert Out L11 SP1 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep6_tp1_pp2 -> layer_11_expert_out_sp1_ep6_tp1_pp2
	layer_11_expert_sp1_ep6_tp2_pp2 [label="Expert L11 SP1 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep6_pp2 -> layer_11_expert_sp1_ep6_tp2_pp2
	layer_11_expert_out_sp1_ep6_tp2_pp2 [label="Expert Out L11 SP1 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep6_tp2_pp2 -> layer_11_expert_out_sp1_ep6_tp2_pp2
	layer_11_expert_sp1_ep6_tp3_pp2 [label="Expert L11 SP1 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep6_pp2 -> layer_11_expert_sp1_ep6_tp3_pp2
	layer_11_expert_out_sp1_ep6_tp3_pp2 [label="Expert Out L11 SP1 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep6_tp3_pp2 -> layer_11_expert_out_sp1_ep6_tp3_pp2
	layer_11_expert_ar_sp1_ep6_pp2 [label="Expert All-Reduce L11 SP1 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep6_tp0_pp2 -> layer_11_expert_ar_sp1_ep6_pp2
	layer_11_expert_out_sp1_ep6_tp1_pp2 -> layer_11_expert_ar_sp1_ep6_pp2
	layer_11_expert_out_sp1_ep6_tp2_pp2 -> layer_11_expert_ar_sp1_ep6_pp2
	layer_11_expert_out_sp1_ep6_tp3_pp2 -> layer_11_expert_ar_sp1_ep6_pp2
	layer_11_combine_sp1_ep6_pp2 [label="Token Combine L11 SP1 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep6_pp2 -> layer_11_combine_sp1_ep6_pp2
	layer_11_dispatch_sp1_ep7_pp2 [label="Token Dispatch L11 SP1 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep7_pp2 [style=dashed]
	layer_11_expert_sp1_ep7_tp0_pp2 [label="Expert L11 SP1 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep7_pp2 -> layer_11_expert_sp1_ep7_tp0_pp2
	layer_11_expert_out_sp1_ep7_tp0_pp2 [label="Expert Out L11 SP1 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep7_tp0_pp2 -> layer_11_expert_out_sp1_ep7_tp0_pp2
	layer_11_expert_sp1_ep7_tp1_pp2 [label="Expert L11 SP1 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep7_pp2 -> layer_11_expert_sp1_ep7_tp1_pp2
	layer_11_expert_out_sp1_ep7_tp1_pp2 [label="Expert Out L11 SP1 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep7_tp1_pp2 -> layer_11_expert_out_sp1_ep7_tp1_pp2
	layer_11_expert_sp1_ep7_tp2_pp2 [label="Expert L11 SP1 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep7_pp2 -> layer_11_expert_sp1_ep7_tp2_pp2
	layer_11_expert_out_sp1_ep7_tp2_pp2 [label="Expert Out L11 SP1 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep7_tp2_pp2 -> layer_11_expert_out_sp1_ep7_tp2_pp2
	layer_11_expert_sp1_ep7_tp3_pp2 [label="Expert L11 SP1 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep7_pp2 -> layer_11_expert_sp1_ep7_tp3_pp2
	layer_11_expert_out_sp1_ep7_tp3_pp2 [label="Expert Out L11 SP1 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep7_tp3_pp2 -> layer_11_expert_out_sp1_ep7_tp3_pp2
	layer_11_expert_ar_sp1_ep7_pp2 [label="Expert All-Reduce L11 SP1 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep7_tp0_pp2 -> layer_11_expert_ar_sp1_ep7_pp2
	layer_11_expert_out_sp1_ep7_tp1_pp2 -> layer_11_expert_ar_sp1_ep7_pp2
	layer_11_expert_out_sp1_ep7_tp2_pp2 -> layer_11_expert_ar_sp1_ep7_pp2
	layer_11_expert_out_sp1_ep7_tp3_pp2 -> layer_11_expert_ar_sp1_ep7_pp2
	layer_11_combine_sp1_ep7_pp2 [label="Token Combine L11 SP1 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep7_pp2 -> layer_11_combine_sp1_ep7_pp2
	layer_11_dispatch_sp1_ep8_pp2 [label="Token Dispatch L11 SP1 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep8_pp2 [style=dashed]
	layer_11_expert_sp1_ep8_tp0_pp2 [label="Expert L11 SP1 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep8_pp2 -> layer_11_expert_sp1_ep8_tp0_pp2
	layer_11_expert_out_sp1_ep8_tp0_pp2 [label="Expert Out L11 SP1 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep8_tp0_pp2 -> layer_11_expert_out_sp1_ep8_tp0_pp2
	layer_11_expert_sp1_ep8_tp1_pp2 [label="Expert L11 SP1 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep8_pp2 -> layer_11_expert_sp1_ep8_tp1_pp2
	layer_11_expert_out_sp1_ep8_tp1_pp2 [label="Expert Out L11 SP1 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep8_tp1_pp2 -> layer_11_expert_out_sp1_ep8_tp1_pp2
	layer_11_expert_sp1_ep8_tp2_pp2 [label="Expert L11 SP1 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep8_pp2 -> layer_11_expert_sp1_ep8_tp2_pp2
	layer_11_expert_out_sp1_ep8_tp2_pp2 [label="Expert Out L11 SP1 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep8_tp2_pp2 -> layer_11_expert_out_sp1_ep8_tp2_pp2
	layer_11_expert_sp1_ep8_tp3_pp2 [label="Expert L11 SP1 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep8_pp2 -> layer_11_expert_sp1_ep8_tp3_pp2
	layer_11_expert_out_sp1_ep8_tp3_pp2 [label="Expert Out L11 SP1 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep8_tp3_pp2 -> layer_11_expert_out_sp1_ep8_tp3_pp2
	layer_11_expert_ar_sp1_ep8_pp2 [label="Expert All-Reduce L11 SP1 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep8_tp0_pp2 -> layer_11_expert_ar_sp1_ep8_pp2
	layer_11_expert_out_sp1_ep8_tp1_pp2 -> layer_11_expert_ar_sp1_ep8_pp2
	layer_11_expert_out_sp1_ep8_tp2_pp2 -> layer_11_expert_ar_sp1_ep8_pp2
	layer_11_expert_out_sp1_ep8_tp3_pp2 -> layer_11_expert_ar_sp1_ep8_pp2
	layer_11_combine_sp1_ep8_pp2 [label="Token Combine L11 SP1 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep8_pp2 -> layer_11_combine_sp1_ep8_pp2
	layer_11_dispatch_sp1_ep9_pp2 [label="Token Dispatch L11 SP1 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep9_pp2 [style=dashed]
	layer_11_expert_sp1_ep9_tp0_pp2 [label="Expert L11 SP1 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep9_pp2 -> layer_11_expert_sp1_ep9_tp0_pp2
	layer_11_expert_out_sp1_ep9_tp0_pp2 [label="Expert Out L11 SP1 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep9_tp0_pp2 -> layer_11_expert_out_sp1_ep9_tp0_pp2
	layer_11_expert_sp1_ep9_tp1_pp2 [label="Expert L11 SP1 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep9_pp2 -> layer_11_expert_sp1_ep9_tp1_pp2
	layer_11_expert_out_sp1_ep9_tp1_pp2 [label="Expert Out L11 SP1 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep9_tp1_pp2 -> layer_11_expert_out_sp1_ep9_tp1_pp2
	layer_11_expert_sp1_ep9_tp2_pp2 [label="Expert L11 SP1 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep9_pp2 -> layer_11_expert_sp1_ep9_tp2_pp2
	layer_11_expert_out_sp1_ep9_tp2_pp2 [label="Expert Out L11 SP1 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep9_tp2_pp2 -> layer_11_expert_out_sp1_ep9_tp2_pp2
	layer_11_expert_sp1_ep9_tp3_pp2 [label="Expert L11 SP1 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep9_pp2 -> layer_11_expert_sp1_ep9_tp3_pp2
	layer_11_expert_out_sp1_ep9_tp3_pp2 [label="Expert Out L11 SP1 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep9_tp3_pp2 -> layer_11_expert_out_sp1_ep9_tp3_pp2
	layer_11_expert_ar_sp1_ep9_pp2 [label="Expert All-Reduce L11 SP1 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep9_tp0_pp2 -> layer_11_expert_ar_sp1_ep9_pp2
	layer_11_expert_out_sp1_ep9_tp1_pp2 -> layer_11_expert_ar_sp1_ep9_pp2
	layer_11_expert_out_sp1_ep9_tp2_pp2 -> layer_11_expert_ar_sp1_ep9_pp2
	layer_11_expert_out_sp1_ep9_tp3_pp2 -> layer_11_expert_ar_sp1_ep9_pp2
	layer_11_combine_sp1_ep9_pp2 [label="Token Combine L11 SP1 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep9_pp2 -> layer_11_combine_sp1_ep9_pp2
	layer_11_dispatch_sp1_ep10_pp2 [label="Token Dispatch L11 SP1 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep10_pp2 [style=dashed]
	layer_11_expert_sp1_ep10_tp0_pp2 [label="Expert L11 SP1 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep10_pp2 -> layer_11_expert_sp1_ep10_tp0_pp2
	layer_11_expert_out_sp1_ep10_tp0_pp2 [label="Expert Out L11 SP1 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep10_tp0_pp2 -> layer_11_expert_out_sp1_ep10_tp0_pp2
	layer_11_expert_sp1_ep10_tp1_pp2 [label="Expert L11 SP1 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep10_pp2 -> layer_11_expert_sp1_ep10_tp1_pp2
	layer_11_expert_out_sp1_ep10_tp1_pp2 [label="Expert Out L11 SP1 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep10_tp1_pp2 -> layer_11_expert_out_sp1_ep10_tp1_pp2
	layer_11_expert_sp1_ep10_tp2_pp2 [label="Expert L11 SP1 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep10_pp2 -> layer_11_expert_sp1_ep10_tp2_pp2
	layer_11_expert_out_sp1_ep10_tp2_pp2 [label="Expert Out L11 SP1 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep10_tp2_pp2 -> layer_11_expert_out_sp1_ep10_tp2_pp2
	layer_11_expert_sp1_ep10_tp3_pp2 [label="Expert L11 SP1 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep10_pp2 -> layer_11_expert_sp1_ep10_tp3_pp2
	layer_11_expert_out_sp1_ep10_tp3_pp2 [label="Expert Out L11 SP1 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep10_tp3_pp2 -> layer_11_expert_out_sp1_ep10_tp3_pp2
	layer_11_expert_ar_sp1_ep10_pp2 [label="Expert All-Reduce L11 SP1 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep10_tp0_pp2 -> layer_11_expert_ar_sp1_ep10_pp2
	layer_11_expert_out_sp1_ep10_tp1_pp2 -> layer_11_expert_ar_sp1_ep10_pp2
	layer_11_expert_out_sp1_ep10_tp2_pp2 -> layer_11_expert_ar_sp1_ep10_pp2
	layer_11_expert_out_sp1_ep10_tp3_pp2 -> layer_11_expert_ar_sp1_ep10_pp2
	layer_11_combine_sp1_ep10_pp2 [label="Token Combine L11 SP1 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep10_pp2 -> layer_11_combine_sp1_ep10_pp2
	layer_11_dispatch_sp1_ep11_pp2 [label="Token Dispatch L11 SP1 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep11_pp2 [style=dashed]
	layer_11_expert_sp1_ep11_tp0_pp2 [label="Expert L11 SP1 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep11_pp2 -> layer_11_expert_sp1_ep11_tp0_pp2
	layer_11_expert_out_sp1_ep11_tp0_pp2 [label="Expert Out L11 SP1 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep11_tp0_pp2 -> layer_11_expert_out_sp1_ep11_tp0_pp2
	layer_11_expert_sp1_ep11_tp1_pp2 [label="Expert L11 SP1 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep11_pp2 -> layer_11_expert_sp1_ep11_tp1_pp2
	layer_11_expert_out_sp1_ep11_tp1_pp2 [label="Expert Out L11 SP1 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep11_tp1_pp2 -> layer_11_expert_out_sp1_ep11_tp1_pp2
	layer_11_expert_sp1_ep11_tp2_pp2 [label="Expert L11 SP1 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep11_pp2 -> layer_11_expert_sp1_ep11_tp2_pp2
	layer_11_expert_out_sp1_ep11_tp2_pp2 [label="Expert Out L11 SP1 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep11_tp2_pp2 -> layer_11_expert_out_sp1_ep11_tp2_pp2
	layer_11_expert_sp1_ep11_tp3_pp2 [label="Expert L11 SP1 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep11_pp2 -> layer_11_expert_sp1_ep11_tp3_pp2
	layer_11_expert_out_sp1_ep11_tp3_pp2 [label="Expert Out L11 SP1 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep11_tp3_pp2 -> layer_11_expert_out_sp1_ep11_tp3_pp2
	layer_11_expert_ar_sp1_ep11_pp2 [label="Expert All-Reduce L11 SP1 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep11_tp0_pp2 -> layer_11_expert_ar_sp1_ep11_pp2
	layer_11_expert_out_sp1_ep11_tp1_pp2 -> layer_11_expert_ar_sp1_ep11_pp2
	layer_11_expert_out_sp1_ep11_tp2_pp2 -> layer_11_expert_ar_sp1_ep11_pp2
	layer_11_expert_out_sp1_ep11_tp3_pp2 -> layer_11_expert_ar_sp1_ep11_pp2
	layer_11_combine_sp1_ep11_pp2 [label="Token Combine L11 SP1 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep11_pp2 -> layer_11_combine_sp1_ep11_pp2
	layer_11_dispatch_sp1_ep12_pp2 [label="Token Dispatch L11 SP1 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep12_pp2 [style=dashed]
	layer_11_expert_sp1_ep12_tp0_pp2 [label="Expert L11 SP1 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep12_pp2 -> layer_11_expert_sp1_ep12_tp0_pp2
	layer_11_expert_out_sp1_ep12_tp0_pp2 [label="Expert Out L11 SP1 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep12_tp0_pp2 -> layer_11_expert_out_sp1_ep12_tp0_pp2
	layer_11_expert_sp1_ep12_tp1_pp2 [label="Expert L11 SP1 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep12_pp2 -> layer_11_expert_sp1_ep12_tp1_pp2
	layer_11_expert_out_sp1_ep12_tp1_pp2 [label="Expert Out L11 SP1 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep12_tp1_pp2 -> layer_11_expert_out_sp1_ep12_tp1_pp2
	layer_11_expert_sp1_ep12_tp2_pp2 [label="Expert L11 SP1 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep12_pp2 -> layer_11_expert_sp1_ep12_tp2_pp2
	layer_11_expert_out_sp1_ep12_tp2_pp2 [label="Expert Out L11 SP1 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep12_tp2_pp2 -> layer_11_expert_out_sp1_ep12_tp2_pp2
	layer_11_expert_sp1_ep12_tp3_pp2 [label="Expert L11 SP1 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep12_pp2 -> layer_11_expert_sp1_ep12_tp3_pp2
	layer_11_expert_out_sp1_ep12_tp3_pp2 [label="Expert Out L11 SP1 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep12_tp3_pp2 -> layer_11_expert_out_sp1_ep12_tp3_pp2
	layer_11_expert_ar_sp1_ep12_pp2 [label="Expert All-Reduce L11 SP1 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep12_tp0_pp2 -> layer_11_expert_ar_sp1_ep12_pp2
	layer_11_expert_out_sp1_ep12_tp1_pp2 -> layer_11_expert_ar_sp1_ep12_pp2
	layer_11_expert_out_sp1_ep12_tp2_pp2 -> layer_11_expert_ar_sp1_ep12_pp2
	layer_11_expert_out_sp1_ep12_tp3_pp2 -> layer_11_expert_ar_sp1_ep12_pp2
	layer_11_combine_sp1_ep12_pp2 [label="Token Combine L11 SP1 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep12_pp2 -> layer_11_combine_sp1_ep12_pp2
	layer_11_dispatch_sp1_ep13_pp2 [label="Token Dispatch L11 SP1 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep13_pp2 [style=dashed]
	layer_11_expert_sp1_ep13_tp0_pp2 [label="Expert L11 SP1 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep13_pp2 -> layer_11_expert_sp1_ep13_tp0_pp2
	layer_11_expert_out_sp1_ep13_tp0_pp2 [label="Expert Out L11 SP1 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep13_tp0_pp2 -> layer_11_expert_out_sp1_ep13_tp0_pp2
	layer_11_expert_sp1_ep13_tp1_pp2 [label="Expert L11 SP1 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep13_pp2 -> layer_11_expert_sp1_ep13_tp1_pp2
	layer_11_expert_out_sp1_ep13_tp1_pp2 [label="Expert Out L11 SP1 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep13_tp1_pp2 -> layer_11_expert_out_sp1_ep13_tp1_pp2
	layer_11_expert_sp1_ep13_tp2_pp2 [label="Expert L11 SP1 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep13_pp2 -> layer_11_expert_sp1_ep13_tp2_pp2
	layer_11_expert_out_sp1_ep13_tp2_pp2 [label="Expert Out L11 SP1 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep13_tp2_pp2 -> layer_11_expert_out_sp1_ep13_tp2_pp2
	layer_11_expert_sp1_ep13_tp3_pp2 [label="Expert L11 SP1 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep13_pp2 -> layer_11_expert_sp1_ep13_tp3_pp2
	layer_11_expert_out_sp1_ep13_tp3_pp2 [label="Expert Out L11 SP1 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep13_tp3_pp2 -> layer_11_expert_out_sp1_ep13_tp3_pp2
	layer_11_expert_ar_sp1_ep13_pp2 [label="Expert All-Reduce L11 SP1 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep13_tp0_pp2 -> layer_11_expert_ar_sp1_ep13_pp2
	layer_11_expert_out_sp1_ep13_tp1_pp2 -> layer_11_expert_ar_sp1_ep13_pp2
	layer_11_expert_out_sp1_ep13_tp2_pp2 -> layer_11_expert_ar_sp1_ep13_pp2
	layer_11_expert_out_sp1_ep13_tp3_pp2 -> layer_11_expert_ar_sp1_ep13_pp2
	layer_11_combine_sp1_ep13_pp2 [label="Token Combine L11 SP1 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep13_pp2 -> layer_11_combine_sp1_ep13_pp2
	layer_11_dispatch_sp1_ep14_pp2 [label="Token Dispatch L11 SP1 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep14_pp2 [style=dashed]
	layer_11_expert_sp1_ep14_tp0_pp2 [label="Expert L11 SP1 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep14_pp2 -> layer_11_expert_sp1_ep14_tp0_pp2
	layer_11_expert_out_sp1_ep14_tp0_pp2 [label="Expert Out L11 SP1 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep14_tp0_pp2 -> layer_11_expert_out_sp1_ep14_tp0_pp2
	layer_11_expert_sp1_ep14_tp1_pp2 [label="Expert L11 SP1 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep14_pp2 -> layer_11_expert_sp1_ep14_tp1_pp2
	layer_11_expert_out_sp1_ep14_tp1_pp2 [label="Expert Out L11 SP1 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep14_tp1_pp2 -> layer_11_expert_out_sp1_ep14_tp1_pp2
	layer_11_expert_sp1_ep14_tp2_pp2 [label="Expert L11 SP1 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep14_pp2 -> layer_11_expert_sp1_ep14_tp2_pp2
	layer_11_expert_out_sp1_ep14_tp2_pp2 [label="Expert Out L11 SP1 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep14_tp2_pp2 -> layer_11_expert_out_sp1_ep14_tp2_pp2
	layer_11_expert_sp1_ep14_tp3_pp2 [label="Expert L11 SP1 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep14_pp2 -> layer_11_expert_sp1_ep14_tp3_pp2
	layer_11_expert_out_sp1_ep14_tp3_pp2 [label="Expert Out L11 SP1 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep14_tp3_pp2 -> layer_11_expert_out_sp1_ep14_tp3_pp2
	layer_11_expert_ar_sp1_ep14_pp2 [label="Expert All-Reduce L11 SP1 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep14_tp0_pp2 -> layer_11_expert_ar_sp1_ep14_pp2
	layer_11_expert_out_sp1_ep14_tp1_pp2 -> layer_11_expert_ar_sp1_ep14_pp2
	layer_11_expert_out_sp1_ep14_tp2_pp2 -> layer_11_expert_ar_sp1_ep14_pp2
	layer_11_expert_out_sp1_ep14_tp3_pp2 -> layer_11_expert_ar_sp1_ep14_pp2
	layer_11_combine_sp1_ep14_pp2 [label="Token Combine L11 SP1 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep14_pp2 -> layer_11_combine_sp1_ep14_pp2
	layer_11_dispatch_sp1_ep15_pp2 [label="Token Dispatch L11 SP1 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp1_pp2 -> layer_11_dispatch_sp1_ep15_pp2 [style=dashed]
	layer_11_expert_sp1_ep15_tp0_pp2 [label="Expert L11 SP1 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep15_pp2 -> layer_11_expert_sp1_ep15_tp0_pp2
	layer_11_expert_out_sp1_ep15_tp0_pp2 [label="Expert Out L11 SP1 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep15_tp0_pp2 -> layer_11_expert_out_sp1_ep15_tp0_pp2
	layer_11_expert_sp1_ep15_tp1_pp2 [label="Expert L11 SP1 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep15_pp2 -> layer_11_expert_sp1_ep15_tp1_pp2
	layer_11_expert_out_sp1_ep15_tp1_pp2 [label="Expert Out L11 SP1 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep15_tp1_pp2 -> layer_11_expert_out_sp1_ep15_tp1_pp2
	layer_11_expert_sp1_ep15_tp2_pp2 [label="Expert L11 SP1 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep15_pp2 -> layer_11_expert_sp1_ep15_tp2_pp2
	layer_11_expert_out_sp1_ep15_tp2_pp2 [label="Expert Out L11 SP1 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep15_tp2_pp2 -> layer_11_expert_out_sp1_ep15_tp2_pp2
	layer_11_expert_sp1_ep15_tp3_pp2 [label="Expert L11 SP1 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp1_ep15_pp2 -> layer_11_expert_sp1_ep15_tp3_pp2
	layer_11_expert_out_sp1_ep15_tp3_pp2 [label="Expert Out L11 SP1 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp1_ep15_tp3_pp2 -> layer_11_expert_out_sp1_ep15_tp3_pp2
	layer_11_expert_ar_sp1_ep15_pp2 [label="Expert All-Reduce L11 SP1 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp1_ep15_tp0_pp2 -> layer_11_expert_ar_sp1_ep15_pp2
	layer_11_expert_out_sp1_ep15_tp1_pp2 -> layer_11_expert_ar_sp1_ep15_pp2
	layer_11_expert_out_sp1_ep15_tp2_pp2 -> layer_11_expert_ar_sp1_ep15_pp2
	layer_11_expert_out_sp1_ep15_tp3_pp2 -> layer_11_expert_ar_sp1_ep15_pp2
	layer_11_combine_sp1_ep15_pp2 [label="Token Combine L11 SP1 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp1_ep15_pp2 -> layer_11_combine_sp1_ep15_pp2
	layer_11_moe_all2all_sp1_pp2 [label="MoE All-to-All L11 SP1\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_11_combine_sp1_ep0_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep1_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep2_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep3_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep4_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep5_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep6_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep7_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep8_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep9_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep10_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep11_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep12_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep13_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep14_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_combine_sp1_ep15_pp2 -> layer_11_moe_all2all_sp1_pp2
	layer_11_mlp_out_sp1_pp2 [label="MoE Output L11 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_moe_all2all_sp1_pp2 -> layer_11_mlp_out_sp1_pp2
	layer_11_mlp_res_sp1_pp2 [label="MLP Residual L11 SP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_mlp_out_sp1_pp2 -> layer_11_mlp_res_sp1_pp2
	layer_11_attn_res_sp1_pp2 -> layer_11_mlp_res_sp1_pp2 [style=dashed]
	layer_11_norm_sp2_pp2 [label="LayerNorm L11 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_mlp_out_sp2_pp2 -> layer_11_norm_sp2_pp2
	layer_11_qkv_sp2_tp0_pp2 [label="QKV Proj L11 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp2_pp2 -> layer_11_qkv_sp2_tp0_pp2
	layer_11_attn_sp2_tp0_pp2 [label="Attention L11 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp2_tp0_pp2 -> layer_11_attn_sp2_tp0_pp2
	layer_11_attn_out_sp2_tp0_pp2 [label="Attn Out Proj L11 SP2 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp2_tp0_pp2 -> layer_11_attn_out_sp2_tp0_pp2
	layer_11_qkv_sp2_tp1_pp2 [label="QKV Proj L11 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp2_pp2 -> layer_11_qkv_sp2_tp1_pp2
	layer_11_attn_sp2_tp1_pp2 [label="Attention L11 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp2_tp1_pp2 -> layer_11_attn_sp2_tp1_pp2
	layer_11_attn_out_sp2_tp1_pp2 [label="Attn Out Proj L11 SP2 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp2_tp1_pp2 -> layer_11_attn_out_sp2_tp1_pp2
	layer_11_qkv_sp2_tp2_pp2 [label="QKV Proj L11 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp2_pp2 -> layer_11_qkv_sp2_tp2_pp2
	layer_11_attn_sp2_tp2_pp2 [label="Attention L11 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp2_tp2_pp2 -> layer_11_attn_sp2_tp2_pp2
	layer_11_attn_out_sp2_tp2_pp2 [label="Attn Out Proj L11 SP2 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp2_tp2_pp2 -> layer_11_attn_out_sp2_tp2_pp2
	layer_11_qkv_sp2_tp3_pp2 [label="QKV Proj L11 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp2_pp2 -> layer_11_qkv_sp2_tp3_pp2
	layer_11_attn_sp2_tp3_pp2 [label="Attention L11 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp2_tp3_pp2 -> layer_11_attn_sp2_tp3_pp2
	layer_11_attn_out_sp2_tp3_pp2 [label="Attn Out Proj L11 SP2 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp2_tp3_pp2 -> layer_11_attn_out_sp2_tp3_pp2
	layer_11_attn_ar_sp2_pp2 [label="Attention All-Reduce L11 SP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_attn_out_sp2_tp0_pp2 -> layer_11_attn_ar_sp2_pp2
	layer_11_attn_out_sp2_tp1_pp2 -> layer_11_attn_ar_sp2_pp2
	layer_11_attn_out_sp2_tp2_pp2 -> layer_11_attn_ar_sp2_pp2
	layer_11_attn_out_sp2_tp3_pp2 -> layer_11_attn_ar_sp2_pp2
	layer_11_attn_res_sp2_pp2 [label="Attention Residual L11 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_attn_ar_sp2_pp2 -> layer_11_attn_res_sp2_pp2
	layer_11_norm_sp2_pp2 -> layer_11_attn_res_sp2_pp2 [style=dashed]
	layer_11_post_norm_sp2_pp2 [label="Post-Attn Norm L11 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_attn_res_sp2_pp2 -> layer_11_post_norm_sp2_pp2
	layer_11_router_sp2_pp2 [label="MoE Router L11 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_11_post_norm_sp2_pp2 -> layer_11_router_sp2_pp2
	layer_11_dispatch_sp2_ep0_pp2 [label="Token Dispatch L11 SP2 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep0_pp2 [style=dashed]
	layer_11_expert_sp2_ep0_tp0_pp2 [label="Expert L11 SP2 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep0_pp2 -> layer_11_expert_sp2_ep0_tp0_pp2
	layer_11_expert_out_sp2_ep0_tp0_pp2 [label="Expert Out L11 SP2 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep0_tp0_pp2 -> layer_11_expert_out_sp2_ep0_tp0_pp2
	layer_11_expert_sp2_ep0_tp1_pp2 [label="Expert L11 SP2 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep0_pp2 -> layer_11_expert_sp2_ep0_tp1_pp2
	layer_11_expert_out_sp2_ep0_tp1_pp2 [label="Expert Out L11 SP2 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep0_tp1_pp2 -> layer_11_expert_out_sp2_ep0_tp1_pp2
	layer_11_expert_sp2_ep0_tp2_pp2 [label="Expert L11 SP2 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep0_pp2 -> layer_11_expert_sp2_ep0_tp2_pp2
	layer_11_expert_out_sp2_ep0_tp2_pp2 [label="Expert Out L11 SP2 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep0_tp2_pp2 -> layer_11_expert_out_sp2_ep0_tp2_pp2
	layer_11_expert_sp2_ep0_tp3_pp2 [label="Expert L11 SP2 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep0_pp2 -> layer_11_expert_sp2_ep0_tp3_pp2
	layer_11_expert_out_sp2_ep0_tp3_pp2 [label="Expert Out L11 SP2 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep0_tp3_pp2 -> layer_11_expert_out_sp2_ep0_tp3_pp2
	layer_11_expert_ar_sp2_ep0_pp2 [label="Expert All-Reduce L11 SP2 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep0_tp0_pp2 -> layer_11_expert_ar_sp2_ep0_pp2
	layer_11_expert_out_sp2_ep0_tp1_pp2 -> layer_11_expert_ar_sp2_ep0_pp2
	layer_11_expert_out_sp2_ep0_tp2_pp2 -> layer_11_expert_ar_sp2_ep0_pp2
	layer_11_expert_out_sp2_ep0_tp3_pp2 -> layer_11_expert_ar_sp2_ep0_pp2
	layer_11_combine_sp2_ep0_pp2 [label="Token Combine L11 SP2 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep0_pp2 -> layer_11_combine_sp2_ep0_pp2
	layer_11_dispatch_sp2_ep1_pp2 [label="Token Dispatch L11 SP2 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep1_pp2 [style=dashed]
	layer_11_expert_sp2_ep1_tp0_pp2 [label="Expert L11 SP2 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep1_pp2 -> layer_11_expert_sp2_ep1_tp0_pp2
	layer_11_expert_out_sp2_ep1_tp0_pp2 [label="Expert Out L11 SP2 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep1_tp0_pp2 -> layer_11_expert_out_sp2_ep1_tp0_pp2
	layer_11_expert_sp2_ep1_tp1_pp2 [label="Expert L11 SP2 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep1_pp2 -> layer_11_expert_sp2_ep1_tp1_pp2
	layer_11_expert_out_sp2_ep1_tp1_pp2 [label="Expert Out L11 SP2 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep1_tp1_pp2 -> layer_11_expert_out_sp2_ep1_tp1_pp2
	layer_11_expert_sp2_ep1_tp2_pp2 [label="Expert L11 SP2 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep1_pp2 -> layer_11_expert_sp2_ep1_tp2_pp2
	layer_11_expert_out_sp2_ep1_tp2_pp2 [label="Expert Out L11 SP2 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep1_tp2_pp2 -> layer_11_expert_out_sp2_ep1_tp2_pp2
	layer_11_expert_sp2_ep1_tp3_pp2 [label="Expert L11 SP2 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep1_pp2 -> layer_11_expert_sp2_ep1_tp3_pp2
	layer_11_expert_out_sp2_ep1_tp3_pp2 [label="Expert Out L11 SP2 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep1_tp3_pp2 -> layer_11_expert_out_sp2_ep1_tp3_pp2
	layer_11_expert_ar_sp2_ep1_pp2 [label="Expert All-Reduce L11 SP2 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep1_tp0_pp2 -> layer_11_expert_ar_sp2_ep1_pp2
	layer_11_expert_out_sp2_ep1_tp1_pp2 -> layer_11_expert_ar_sp2_ep1_pp2
	layer_11_expert_out_sp2_ep1_tp2_pp2 -> layer_11_expert_ar_sp2_ep1_pp2
	layer_11_expert_out_sp2_ep1_tp3_pp2 -> layer_11_expert_ar_sp2_ep1_pp2
	layer_11_combine_sp2_ep1_pp2 [label="Token Combine L11 SP2 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep1_pp2 -> layer_11_combine_sp2_ep1_pp2
	layer_11_dispatch_sp2_ep2_pp2 [label="Token Dispatch L11 SP2 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep2_pp2 [style=dashed]
	layer_11_expert_sp2_ep2_tp0_pp2 [label="Expert L11 SP2 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep2_pp2 -> layer_11_expert_sp2_ep2_tp0_pp2
	layer_11_expert_out_sp2_ep2_tp0_pp2 [label="Expert Out L11 SP2 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep2_tp0_pp2 -> layer_11_expert_out_sp2_ep2_tp0_pp2
	layer_11_expert_sp2_ep2_tp1_pp2 [label="Expert L11 SP2 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep2_pp2 -> layer_11_expert_sp2_ep2_tp1_pp2
	layer_11_expert_out_sp2_ep2_tp1_pp2 [label="Expert Out L11 SP2 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep2_tp1_pp2 -> layer_11_expert_out_sp2_ep2_tp1_pp2
	layer_11_expert_sp2_ep2_tp2_pp2 [label="Expert L11 SP2 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep2_pp2 -> layer_11_expert_sp2_ep2_tp2_pp2
	layer_11_expert_out_sp2_ep2_tp2_pp2 [label="Expert Out L11 SP2 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep2_tp2_pp2 -> layer_11_expert_out_sp2_ep2_tp2_pp2
	layer_11_expert_sp2_ep2_tp3_pp2 [label="Expert L11 SP2 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep2_pp2 -> layer_11_expert_sp2_ep2_tp3_pp2
	layer_11_expert_out_sp2_ep2_tp3_pp2 [label="Expert Out L11 SP2 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep2_tp3_pp2 -> layer_11_expert_out_sp2_ep2_tp3_pp2
	layer_11_expert_ar_sp2_ep2_pp2 [label="Expert All-Reduce L11 SP2 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep2_tp0_pp2 -> layer_11_expert_ar_sp2_ep2_pp2
	layer_11_expert_out_sp2_ep2_tp1_pp2 -> layer_11_expert_ar_sp2_ep2_pp2
	layer_11_expert_out_sp2_ep2_tp2_pp2 -> layer_11_expert_ar_sp2_ep2_pp2
	layer_11_expert_out_sp2_ep2_tp3_pp2 -> layer_11_expert_ar_sp2_ep2_pp2
	layer_11_combine_sp2_ep2_pp2 [label="Token Combine L11 SP2 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep2_pp2 -> layer_11_combine_sp2_ep2_pp2
	layer_11_dispatch_sp2_ep3_pp2 [label="Token Dispatch L11 SP2 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep3_pp2 [style=dashed]
	layer_11_expert_sp2_ep3_tp0_pp2 [label="Expert L11 SP2 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep3_pp2 -> layer_11_expert_sp2_ep3_tp0_pp2
	layer_11_expert_out_sp2_ep3_tp0_pp2 [label="Expert Out L11 SP2 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep3_tp0_pp2 -> layer_11_expert_out_sp2_ep3_tp0_pp2
	layer_11_expert_sp2_ep3_tp1_pp2 [label="Expert L11 SP2 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep3_pp2 -> layer_11_expert_sp2_ep3_tp1_pp2
	layer_11_expert_out_sp2_ep3_tp1_pp2 [label="Expert Out L11 SP2 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep3_tp1_pp2 -> layer_11_expert_out_sp2_ep3_tp1_pp2
	layer_11_expert_sp2_ep3_tp2_pp2 [label="Expert L11 SP2 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep3_pp2 -> layer_11_expert_sp2_ep3_tp2_pp2
	layer_11_expert_out_sp2_ep3_tp2_pp2 [label="Expert Out L11 SP2 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep3_tp2_pp2 -> layer_11_expert_out_sp2_ep3_tp2_pp2
	layer_11_expert_sp2_ep3_tp3_pp2 [label="Expert L11 SP2 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep3_pp2 -> layer_11_expert_sp2_ep3_tp3_pp2
	layer_11_expert_out_sp2_ep3_tp3_pp2 [label="Expert Out L11 SP2 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep3_tp3_pp2 -> layer_11_expert_out_sp2_ep3_tp3_pp2
	layer_11_expert_ar_sp2_ep3_pp2 [label="Expert All-Reduce L11 SP2 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep3_tp0_pp2 -> layer_11_expert_ar_sp2_ep3_pp2
	layer_11_expert_out_sp2_ep3_tp1_pp2 -> layer_11_expert_ar_sp2_ep3_pp2
	layer_11_expert_out_sp2_ep3_tp2_pp2 -> layer_11_expert_ar_sp2_ep3_pp2
	layer_11_expert_out_sp2_ep3_tp3_pp2 -> layer_11_expert_ar_sp2_ep3_pp2
	layer_11_combine_sp2_ep3_pp2 [label="Token Combine L11 SP2 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep3_pp2 -> layer_11_combine_sp2_ep3_pp2
	layer_11_dispatch_sp2_ep4_pp2 [label="Token Dispatch L11 SP2 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep4_pp2 [style=dashed]
	layer_11_expert_sp2_ep4_tp0_pp2 [label="Expert L11 SP2 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep4_pp2 -> layer_11_expert_sp2_ep4_tp0_pp2
	layer_11_expert_out_sp2_ep4_tp0_pp2 [label="Expert Out L11 SP2 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep4_tp0_pp2 -> layer_11_expert_out_sp2_ep4_tp0_pp2
	layer_11_expert_sp2_ep4_tp1_pp2 [label="Expert L11 SP2 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep4_pp2 -> layer_11_expert_sp2_ep4_tp1_pp2
	layer_11_expert_out_sp2_ep4_tp1_pp2 [label="Expert Out L11 SP2 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep4_tp1_pp2 -> layer_11_expert_out_sp2_ep4_tp1_pp2
	layer_11_expert_sp2_ep4_tp2_pp2 [label="Expert L11 SP2 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep4_pp2 -> layer_11_expert_sp2_ep4_tp2_pp2
	layer_11_expert_out_sp2_ep4_tp2_pp2 [label="Expert Out L11 SP2 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep4_tp2_pp2 -> layer_11_expert_out_sp2_ep4_tp2_pp2
	layer_11_expert_sp2_ep4_tp3_pp2 [label="Expert L11 SP2 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep4_pp2 -> layer_11_expert_sp2_ep4_tp3_pp2
	layer_11_expert_out_sp2_ep4_tp3_pp2 [label="Expert Out L11 SP2 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep4_tp3_pp2 -> layer_11_expert_out_sp2_ep4_tp3_pp2
	layer_11_expert_ar_sp2_ep4_pp2 [label="Expert All-Reduce L11 SP2 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep4_tp0_pp2 -> layer_11_expert_ar_sp2_ep4_pp2
	layer_11_expert_out_sp2_ep4_tp1_pp2 -> layer_11_expert_ar_sp2_ep4_pp2
	layer_11_expert_out_sp2_ep4_tp2_pp2 -> layer_11_expert_ar_sp2_ep4_pp2
	layer_11_expert_out_sp2_ep4_tp3_pp2 -> layer_11_expert_ar_sp2_ep4_pp2
	layer_11_combine_sp2_ep4_pp2 [label="Token Combine L11 SP2 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep4_pp2 -> layer_11_combine_sp2_ep4_pp2
	layer_11_dispatch_sp2_ep5_pp2 [label="Token Dispatch L11 SP2 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep5_pp2 [style=dashed]
	layer_11_expert_sp2_ep5_tp0_pp2 [label="Expert L11 SP2 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep5_pp2 -> layer_11_expert_sp2_ep5_tp0_pp2
	layer_11_expert_out_sp2_ep5_tp0_pp2 [label="Expert Out L11 SP2 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep5_tp0_pp2 -> layer_11_expert_out_sp2_ep5_tp0_pp2
	layer_11_expert_sp2_ep5_tp1_pp2 [label="Expert L11 SP2 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep5_pp2 -> layer_11_expert_sp2_ep5_tp1_pp2
	layer_11_expert_out_sp2_ep5_tp1_pp2 [label="Expert Out L11 SP2 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep5_tp1_pp2 -> layer_11_expert_out_sp2_ep5_tp1_pp2
	layer_11_expert_sp2_ep5_tp2_pp2 [label="Expert L11 SP2 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep5_pp2 -> layer_11_expert_sp2_ep5_tp2_pp2
	layer_11_expert_out_sp2_ep5_tp2_pp2 [label="Expert Out L11 SP2 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep5_tp2_pp2 -> layer_11_expert_out_sp2_ep5_tp2_pp2
	layer_11_expert_sp2_ep5_tp3_pp2 [label="Expert L11 SP2 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep5_pp2 -> layer_11_expert_sp2_ep5_tp3_pp2
	layer_11_expert_out_sp2_ep5_tp3_pp2 [label="Expert Out L11 SP2 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep5_tp3_pp2 -> layer_11_expert_out_sp2_ep5_tp3_pp2
	layer_11_expert_ar_sp2_ep5_pp2 [label="Expert All-Reduce L11 SP2 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep5_tp0_pp2 -> layer_11_expert_ar_sp2_ep5_pp2
	layer_11_expert_out_sp2_ep5_tp1_pp2 -> layer_11_expert_ar_sp2_ep5_pp2
	layer_11_expert_out_sp2_ep5_tp2_pp2 -> layer_11_expert_ar_sp2_ep5_pp2
	layer_11_expert_out_sp2_ep5_tp3_pp2 -> layer_11_expert_ar_sp2_ep5_pp2
	layer_11_combine_sp2_ep5_pp2 [label="Token Combine L11 SP2 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep5_pp2 -> layer_11_combine_sp2_ep5_pp2
	layer_11_dispatch_sp2_ep6_pp2 [label="Token Dispatch L11 SP2 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep6_pp2 [style=dashed]
	layer_11_expert_sp2_ep6_tp0_pp2 [label="Expert L11 SP2 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep6_pp2 -> layer_11_expert_sp2_ep6_tp0_pp2
	layer_11_expert_out_sp2_ep6_tp0_pp2 [label="Expert Out L11 SP2 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep6_tp0_pp2 -> layer_11_expert_out_sp2_ep6_tp0_pp2
	layer_11_expert_sp2_ep6_tp1_pp2 [label="Expert L11 SP2 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep6_pp2 -> layer_11_expert_sp2_ep6_tp1_pp2
	layer_11_expert_out_sp2_ep6_tp1_pp2 [label="Expert Out L11 SP2 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep6_tp1_pp2 -> layer_11_expert_out_sp2_ep6_tp1_pp2
	layer_11_expert_sp2_ep6_tp2_pp2 [label="Expert L11 SP2 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep6_pp2 -> layer_11_expert_sp2_ep6_tp2_pp2
	layer_11_expert_out_sp2_ep6_tp2_pp2 [label="Expert Out L11 SP2 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep6_tp2_pp2 -> layer_11_expert_out_sp2_ep6_tp2_pp2
	layer_11_expert_sp2_ep6_tp3_pp2 [label="Expert L11 SP2 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep6_pp2 -> layer_11_expert_sp2_ep6_tp3_pp2
	layer_11_expert_out_sp2_ep6_tp3_pp2 [label="Expert Out L11 SP2 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep6_tp3_pp2 -> layer_11_expert_out_sp2_ep6_tp3_pp2
	layer_11_expert_ar_sp2_ep6_pp2 [label="Expert All-Reduce L11 SP2 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep6_tp0_pp2 -> layer_11_expert_ar_sp2_ep6_pp2
	layer_11_expert_out_sp2_ep6_tp1_pp2 -> layer_11_expert_ar_sp2_ep6_pp2
	layer_11_expert_out_sp2_ep6_tp2_pp2 -> layer_11_expert_ar_sp2_ep6_pp2
	layer_11_expert_out_sp2_ep6_tp3_pp2 -> layer_11_expert_ar_sp2_ep6_pp2
	layer_11_combine_sp2_ep6_pp2 [label="Token Combine L11 SP2 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep6_pp2 -> layer_11_combine_sp2_ep6_pp2
	layer_11_dispatch_sp2_ep7_pp2 [label="Token Dispatch L11 SP2 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep7_pp2 [style=dashed]
	layer_11_expert_sp2_ep7_tp0_pp2 [label="Expert L11 SP2 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep7_pp2 -> layer_11_expert_sp2_ep7_tp0_pp2
	layer_11_expert_out_sp2_ep7_tp0_pp2 [label="Expert Out L11 SP2 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep7_tp0_pp2 -> layer_11_expert_out_sp2_ep7_tp0_pp2
	layer_11_expert_sp2_ep7_tp1_pp2 [label="Expert L11 SP2 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep7_pp2 -> layer_11_expert_sp2_ep7_tp1_pp2
	layer_11_expert_out_sp2_ep7_tp1_pp2 [label="Expert Out L11 SP2 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep7_tp1_pp2 -> layer_11_expert_out_sp2_ep7_tp1_pp2
	layer_11_expert_sp2_ep7_tp2_pp2 [label="Expert L11 SP2 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep7_pp2 -> layer_11_expert_sp2_ep7_tp2_pp2
	layer_11_expert_out_sp2_ep7_tp2_pp2 [label="Expert Out L11 SP2 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep7_tp2_pp2 -> layer_11_expert_out_sp2_ep7_tp2_pp2
	layer_11_expert_sp2_ep7_tp3_pp2 [label="Expert L11 SP2 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep7_pp2 -> layer_11_expert_sp2_ep7_tp3_pp2
	layer_11_expert_out_sp2_ep7_tp3_pp2 [label="Expert Out L11 SP2 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep7_tp3_pp2 -> layer_11_expert_out_sp2_ep7_tp3_pp2
	layer_11_expert_ar_sp2_ep7_pp2 [label="Expert All-Reduce L11 SP2 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep7_tp0_pp2 -> layer_11_expert_ar_sp2_ep7_pp2
	layer_11_expert_out_sp2_ep7_tp1_pp2 -> layer_11_expert_ar_sp2_ep7_pp2
	layer_11_expert_out_sp2_ep7_tp2_pp2 -> layer_11_expert_ar_sp2_ep7_pp2
	layer_11_expert_out_sp2_ep7_tp3_pp2 -> layer_11_expert_ar_sp2_ep7_pp2
	layer_11_combine_sp2_ep7_pp2 [label="Token Combine L11 SP2 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep7_pp2 -> layer_11_combine_sp2_ep7_pp2
	layer_11_dispatch_sp2_ep8_pp2 [label="Token Dispatch L11 SP2 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep8_pp2 [style=dashed]
	layer_11_expert_sp2_ep8_tp0_pp2 [label="Expert L11 SP2 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep8_pp2 -> layer_11_expert_sp2_ep8_tp0_pp2
	layer_11_expert_out_sp2_ep8_tp0_pp2 [label="Expert Out L11 SP2 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep8_tp0_pp2 -> layer_11_expert_out_sp2_ep8_tp0_pp2
	layer_11_expert_sp2_ep8_tp1_pp2 [label="Expert L11 SP2 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep8_pp2 -> layer_11_expert_sp2_ep8_tp1_pp2
	layer_11_expert_out_sp2_ep8_tp1_pp2 [label="Expert Out L11 SP2 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep8_tp1_pp2 -> layer_11_expert_out_sp2_ep8_tp1_pp2
	layer_11_expert_sp2_ep8_tp2_pp2 [label="Expert L11 SP2 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep8_pp2 -> layer_11_expert_sp2_ep8_tp2_pp2
	layer_11_expert_out_sp2_ep8_tp2_pp2 [label="Expert Out L11 SP2 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep8_tp2_pp2 -> layer_11_expert_out_sp2_ep8_tp2_pp2
	layer_11_expert_sp2_ep8_tp3_pp2 [label="Expert L11 SP2 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep8_pp2 -> layer_11_expert_sp2_ep8_tp3_pp2
	layer_11_expert_out_sp2_ep8_tp3_pp2 [label="Expert Out L11 SP2 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep8_tp3_pp2 -> layer_11_expert_out_sp2_ep8_tp3_pp2
	layer_11_expert_ar_sp2_ep8_pp2 [label="Expert All-Reduce L11 SP2 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep8_tp0_pp2 -> layer_11_expert_ar_sp2_ep8_pp2
	layer_11_expert_out_sp2_ep8_tp1_pp2 -> layer_11_expert_ar_sp2_ep8_pp2
	layer_11_expert_out_sp2_ep8_tp2_pp2 -> layer_11_expert_ar_sp2_ep8_pp2
	layer_11_expert_out_sp2_ep8_tp3_pp2 -> layer_11_expert_ar_sp2_ep8_pp2
	layer_11_combine_sp2_ep8_pp2 [label="Token Combine L11 SP2 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep8_pp2 -> layer_11_combine_sp2_ep8_pp2
	layer_11_dispatch_sp2_ep9_pp2 [label="Token Dispatch L11 SP2 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep9_pp2 [style=dashed]
	layer_11_expert_sp2_ep9_tp0_pp2 [label="Expert L11 SP2 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep9_pp2 -> layer_11_expert_sp2_ep9_tp0_pp2
	layer_11_expert_out_sp2_ep9_tp0_pp2 [label="Expert Out L11 SP2 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep9_tp0_pp2 -> layer_11_expert_out_sp2_ep9_tp0_pp2
	layer_11_expert_sp2_ep9_tp1_pp2 [label="Expert L11 SP2 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep9_pp2 -> layer_11_expert_sp2_ep9_tp1_pp2
	layer_11_expert_out_sp2_ep9_tp1_pp2 [label="Expert Out L11 SP2 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep9_tp1_pp2 -> layer_11_expert_out_sp2_ep9_tp1_pp2
	layer_11_expert_sp2_ep9_tp2_pp2 [label="Expert L11 SP2 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep9_pp2 -> layer_11_expert_sp2_ep9_tp2_pp2
	layer_11_expert_out_sp2_ep9_tp2_pp2 [label="Expert Out L11 SP2 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep9_tp2_pp2 -> layer_11_expert_out_sp2_ep9_tp2_pp2
	layer_11_expert_sp2_ep9_tp3_pp2 [label="Expert L11 SP2 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep9_pp2 -> layer_11_expert_sp2_ep9_tp3_pp2
	layer_11_expert_out_sp2_ep9_tp3_pp2 [label="Expert Out L11 SP2 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep9_tp3_pp2 -> layer_11_expert_out_sp2_ep9_tp3_pp2
	layer_11_expert_ar_sp2_ep9_pp2 [label="Expert All-Reduce L11 SP2 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep9_tp0_pp2 -> layer_11_expert_ar_sp2_ep9_pp2
	layer_11_expert_out_sp2_ep9_tp1_pp2 -> layer_11_expert_ar_sp2_ep9_pp2
	layer_11_expert_out_sp2_ep9_tp2_pp2 -> layer_11_expert_ar_sp2_ep9_pp2
	layer_11_expert_out_sp2_ep9_tp3_pp2 -> layer_11_expert_ar_sp2_ep9_pp2
	layer_11_combine_sp2_ep9_pp2 [label="Token Combine L11 SP2 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep9_pp2 -> layer_11_combine_sp2_ep9_pp2
	layer_11_dispatch_sp2_ep10_pp2 [label="Token Dispatch L11 SP2 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep10_pp2 [style=dashed]
	layer_11_expert_sp2_ep10_tp0_pp2 [label="Expert L11 SP2 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep10_pp2 -> layer_11_expert_sp2_ep10_tp0_pp2
	layer_11_expert_out_sp2_ep10_tp0_pp2 [label="Expert Out L11 SP2 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep10_tp0_pp2 -> layer_11_expert_out_sp2_ep10_tp0_pp2
	layer_11_expert_sp2_ep10_tp1_pp2 [label="Expert L11 SP2 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep10_pp2 -> layer_11_expert_sp2_ep10_tp1_pp2
	layer_11_expert_out_sp2_ep10_tp1_pp2 [label="Expert Out L11 SP2 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep10_tp1_pp2 -> layer_11_expert_out_sp2_ep10_tp1_pp2
	layer_11_expert_sp2_ep10_tp2_pp2 [label="Expert L11 SP2 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep10_pp2 -> layer_11_expert_sp2_ep10_tp2_pp2
	layer_11_expert_out_sp2_ep10_tp2_pp2 [label="Expert Out L11 SP2 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep10_tp2_pp2 -> layer_11_expert_out_sp2_ep10_tp2_pp2
	layer_11_expert_sp2_ep10_tp3_pp2 [label="Expert L11 SP2 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep10_pp2 -> layer_11_expert_sp2_ep10_tp3_pp2
	layer_11_expert_out_sp2_ep10_tp3_pp2 [label="Expert Out L11 SP2 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep10_tp3_pp2 -> layer_11_expert_out_sp2_ep10_tp3_pp2
	layer_11_expert_ar_sp2_ep10_pp2 [label="Expert All-Reduce L11 SP2 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep10_tp0_pp2 -> layer_11_expert_ar_sp2_ep10_pp2
	layer_11_expert_out_sp2_ep10_tp1_pp2 -> layer_11_expert_ar_sp2_ep10_pp2
	layer_11_expert_out_sp2_ep10_tp2_pp2 -> layer_11_expert_ar_sp2_ep10_pp2
	layer_11_expert_out_sp2_ep10_tp3_pp2 -> layer_11_expert_ar_sp2_ep10_pp2
	layer_11_combine_sp2_ep10_pp2 [label="Token Combine L11 SP2 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep10_pp2 -> layer_11_combine_sp2_ep10_pp2
	layer_11_dispatch_sp2_ep11_pp2 [label="Token Dispatch L11 SP2 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep11_pp2 [style=dashed]
	layer_11_expert_sp2_ep11_tp0_pp2 [label="Expert L11 SP2 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep11_pp2 -> layer_11_expert_sp2_ep11_tp0_pp2
	layer_11_expert_out_sp2_ep11_tp0_pp2 [label="Expert Out L11 SP2 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep11_tp0_pp2 -> layer_11_expert_out_sp2_ep11_tp0_pp2
	layer_11_expert_sp2_ep11_tp1_pp2 [label="Expert L11 SP2 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep11_pp2 -> layer_11_expert_sp2_ep11_tp1_pp2
	layer_11_expert_out_sp2_ep11_tp1_pp2 [label="Expert Out L11 SP2 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep11_tp1_pp2 -> layer_11_expert_out_sp2_ep11_tp1_pp2
	layer_11_expert_sp2_ep11_tp2_pp2 [label="Expert L11 SP2 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep11_pp2 -> layer_11_expert_sp2_ep11_tp2_pp2
	layer_11_expert_out_sp2_ep11_tp2_pp2 [label="Expert Out L11 SP2 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep11_tp2_pp2 -> layer_11_expert_out_sp2_ep11_tp2_pp2
	layer_11_expert_sp2_ep11_tp3_pp2 [label="Expert L11 SP2 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep11_pp2 -> layer_11_expert_sp2_ep11_tp3_pp2
	layer_11_expert_out_sp2_ep11_tp3_pp2 [label="Expert Out L11 SP2 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep11_tp3_pp2 -> layer_11_expert_out_sp2_ep11_tp3_pp2
	layer_11_expert_ar_sp2_ep11_pp2 [label="Expert All-Reduce L11 SP2 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep11_tp0_pp2 -> layer_11_expert_ar_sp2_ep11_pp2
	layer_11_expert_out_sp2_ep11_tp1_pp2 -> layer_11_expert_ar_sp2_ep11_pp2
	layer_11_expert_out_sp2_ep11_tp2_pp2 -> layer_11_expert_ar_sp2_ep11_pp2
	layer_11_expert_out_sp2_ep11_tp3_pp2 -> layer_11_expert_ar_sp2_ep11_pp2
	layer_11_combine_sp2_ep11_pp2 [label="Token Combine L11 SP2 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep11_pp2 -> layer_11_combine_sp2_ep11_pp2
	layer_11_dispatch_sp2_ep12_pp2 [label="Token Dispatch L11 SP2 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep12_pp2 [style=dashed]
	layer_11_expert_sp2_ep12_tp0_pp2 [label="Expert L11 SP2 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep12_pp2 -> layer_11_expert_sp2_ep12_tp0_pp2
	layer_11_expert_out_sp2_ep12_tp0_pp2 [label="Expert Out L11 SP2 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep12_tp0_pp2 -> layer_11_expert_out_sp2_ep12_tp0_pp2
	layer_11_expert_sp2_ep12_tp1_pp2 [label="Expert L11 SP2 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep12_pp2 -> layer_11_expert_sp2_ep12_tp1_pp2
	layer_11_expert_out_sp2_ep12_tp1_pp2 [label="Expert Out L11 SP2 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep12_tp1_pp2 -> layer_11_expert_out_sp2_ep12_tp1_pp2
	layer_11_expert_sp2_ep12_tp2_pp2 [label="Expert L11 SP2 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep12_pp2 -> layer_11_expert_sp2_ep12_tp2_pp2
	layer_11_expert_out_sp2_ep12_tp2_pp2 [label="Expert Out L11 SP2 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep12_tp2_pp2 -> layer_11_expert_out_sp2_ep12_tp2_pp2
	layer_11_expert_sp2_ep12_tp3_pp2 [label="Expert L11 SP2 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep12_pp2 -> layer_11_expert_sp2_ep12_tp3_pp2
	layer_11_expert_out_sp2_ep12_tp3_pp2 [label="Expert Out L11 SP2 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep12_tp3_pp2 -> layer_11_expert_out_sp2_ep12_tp3_pp2
	layer_11_expert_ar_sp2_ep12_pp2 [label="Expert All-Reduce L11 SP2 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep12_tp0_pp2 -> layer_11_expert_ar_sp2_ep12_pp2
	layer_11_expert_out_sp2_ep12_tp1_pp2 -> layer_11_expert_ar_sp2_ep12_pp2
	layer_11_expert_out_sp2_ep12_tp2_pp2 -> layer_11_expert_ar_sp2_ep12_pp2
	layer_11_expert_out_sp2_ep12_tp3_pp2 -> layer_11_expert_ar_sp2_ep12_pp2
	layer_11_combine_sp2_ep12_pp2 [label="Token Combine L11 SP2 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep12_pp2 -> layer_11_combine_sp2_ep12_pp2
	layer_11_dispatch_sp2_ep13_pp2 [label="Token Dispatch L11 SP2 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep13_pp2 [style=dashed]
	layer_11_expert_sp2_ep13_tp0_pp2 [label="Expert L11 SP2 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep13_pp2 -> layer_11_expert_sp2_ep13_tp0_pp2
	layer_11_expert_out_sp2_ep13_tp0_pp2 [label="Expert Out L11 SP2 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep13_tp0_pp2 -> layer_11_expert_out_sp2_ep13_tp0_pp2
	layer_11_expert_sp2_ep13_tp1_pp2 [label="Expert L11 SP2 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep13_pp2 -> layer_11_expert_sp2_ep13_tp1_pp2
	layer_11_expert_out_sp2_ep13_tp1_pp2 [label="Expert Out L11 SP2 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep13_tp1_pp2 -> layer_11_expert_out_sp2_ep13_tp1_pp2
	layer_11_expert_sp2_ep13_tp2_pp2 [label="Expert L11 SP2 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep13_pp2 -> layer_11_expert_sp2_ep13_tp2_pp2
	layer_11_expert_out_sp2_ep13_tp2_pp2 [label="Expert Out L11 SP2 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep13_tp2_pp2 -> layer_11_expert_out_sp2_ep13_tp2_pp2
	layer_11_expert_sp2_ep13_tp3_pp2 [label="Expert L11 SP2 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep13_pp2 -> layer_11_expert_sp2_ep13_tp3_pp2
	layer_11_expert_out_sp2_ep13_tp3_pp2 [label="Expert Out L11 SP2 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep13_tp3_pp2 -> layer_11_expert_out_sp2_ep13_tp3_pp2
	layer_11_expert_ar_sp2_ep13_pp2 [label="Expert All-Reduce L11 SP2 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep13_tp0_pp2 -> layer_11_expert_ar_sp2_ep13_pp2
	layer_11_expert_out_sp2_ep13_tp1_pp2 -> layer_11_expert_ar_sp2_ep13_pp2
	layer_11_expert_out_sp2_ep13_tp2_pp2 -> layer_11_expert_ar_sp2_ep13_pp2
	layer_11_expert_out_sp2_ep13_tp3_pp2 -> layer_11_expert_ar_sp2_ep13_pp2
	layer_11_combine_sp2_ep13_pp2 [label="Token Combine L11 SP2 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep13_pp2 -> layer_11_combine_sp2_ep13_pp2
	layer_11_dispatch_sp2_ep14_pp2 [label="Token Dispatch L11 SP2 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep14_pp2 [style=dashed]
	layer_11_expert_sp2_ep14_tp0_pp2 [label="Expert L11 SP2 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep14_pp2 -> layer_11_expert_sp2_ep14_tp0_pp2
	layer_11_expert_out_sp2_ep14_tp0_pp2 [label="Expert Out L11 SP2 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep14_tp0_pp2 -> layer_11_expert_out_sp2_ep14_tp0_pp2
	layer_11_expert_sp2_ep14_tp1_pp2 [label="Expert L11 SP2 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep14_pp2 -> layer_11_expert_sp2_ep14_tp1_pp2
	layer_11_expert_out_sp2_ep14_tp1_pp2 [label="Expert Out L11 SP2 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep14_tp1_pp2 -> layer_11_expert_out_sp2_ep14_tp1_pp2
	layer_11_expert_sp2_ep14_tp2_pp2 [label="Expert L11 SP2 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep14_pp2 -> layer_11_expert_sp2_ep14_tp2_pp2
	layer_11_expert_out_sp2_ep14_tp2_pp2 [label="Expert Out L11 SP2 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep14_tp2_pp2 -> layer_11_expert_out_sp2_ep14_tp2_pp2
	layer_11_expert_sp2_ep14_tp3_pp2 [label="Expert L11 SP2 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep14_pp2 -> layer_11_expert_sp2_ep14_tp3_pp2
	layer_11_expert_out_sp2_ep14_tp3_pp2 [label="Expert Out L11 SP2 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep14_tp3_pp2 -> layer_11_expert_out_sp2_ep14_tp3_pp2
	layer_11_expert_ar_sp2_ep14_pp2 [label="Expert All-Reduce L11 SP2 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep14_tp0_pp2 -> layer_11_expert_ar_sp2_ep14_pp2
	layer_11_expert_out_sp2_ep14_tp1_pp2 -> layer_11_expert_ar_sp2_ep14_pp2
	layer_11_expert_out_sp2_ep14_tp2_pp2 -> layer_11_expert_ar_sp2_ep14_pp2
	layer_11_expert_out_sp2_ep14_tp3_pp2 -> layer_11_expert_ar_sp2_ep14_pp2
	layer_11_combine_sp2_ep14_pp2 [label="Token Combine L11 SP2 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep14_pp2 -> layer_11_combine_sp2_ep14_pp2
	layer_11_dispatch_sp2_ep15_pp2 [label="Token Dispatch L11 SP2 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp2_pp2 -> layer_11_dispatch_sp2_ep15_pp2 [style=dashed]
	layer_11_expert_sp2_ep15_tp0_pp2 [label="Expert L11 SP2 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep15_pp2 -> layer_11_expert_sp2_ep15_tp0_pp2
	layer_11_expert_out_sp2_ep15_tp0_pp2 [label="Expert Out L11 SP2 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep15_tp0_pp2 -> layer_11_expert_out_sp2_ep15_tp0_pp2
	layer_11_expert_sp2_ep15_tp1_pp2 [label="Expert L11 SP2 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep15_pp2 -> layer_11_expert_sp2_ep15_tp1_pp2
	layer_11_expert_out_sp2_ep15_tp1_pp2 [label="Expert Out L11 SP2 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep15_tp1_pp2 -> layer_11_expert_out_sp2_ep15_tp1_pp2
	layer_11_expert_sp2_ep15_tp2_pp2 [label="Expert L11 SP2 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep15_pp2 -> layer_11_expert_sp2_ep15_tp2_pp2
	layer_11_expert_out_sp2_ep15_tp2_pp2 [label="Expert Out L11 SP2 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep15_tp2_pp2 -> layer_11_expert_out_sp2_ep15_tp2_pp2
	layer_11_expert_sp2_ep15_tp3_pp2 [label="Expert L11 SP2 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp2_ep15_pp2 -> layer_11_expert_sp2_ep15_tp3_pp2
	layer_11_expert_out_sp2_ep15_tp3_pp2 [label="Expert Out L11 SP2 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp2_ep15_tp3_pp2 -> layer_11_expert_out_sp2_ep15_tp3_pp2
	layer_11_expert_ar_sp2_ep15_pp2 [label="Expert All-Reduce L11 SP2 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp2_ep15_tp0_pp2 -> layer_11_expert_ar_sp2_ep15_pp2
	layer_11_expert_out_sp2_ep15_tp1_pp2 -> layer_11_expert_ar_sp2_ep15_pp2
	layer_11_expert_out_sp2_ep15_tp2_pp2 -> layer_11_expert_ar_sp2_ep15_pp2
	layer_11_expert_out_sp2_ep15_tp3_pp2 -> layer_11_expert_ar_sp2_ep15_pp2
	layer_11_combine_sp2_ep15_pp2 [label="Token Combine L11 SP2 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp2_ep15_pp2 -> layer_11_combine_sp2_ep15_pp2
	layer_11_moe_all2all_sp2_pp2 [label="MoE All-to-All L11 SP2\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_11_combine_sp2_ep0_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep1_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep2_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep3_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep4_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep5_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep6_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep7_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep8_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep9_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep10_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep11_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep12_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep13_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep14_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_combine_sp2_ep15_pp2 -> layer_11_moe_all2all_sp2_pp2
	layer_11_mlp_out_sp2_pp2 [label="MoE Output L11 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_moe_all2all_sp2_pp2 -> layer_11_mlp_out_sp2_pp2
	layer_11_mlp_res_sp2_pp2 [label="MLP Residual L11 SP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_mlp_out_sp2_pp2 -> layer_11_mlp_res_sp2_pp2
	layer_11_attn_res_sp2_pp2 -> layer_11_mlp_res_sp2_pp2 [style=dashed]
	layer_11_norm_sp3_pp2 [label="LayerNorm L11 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_10_mlp_out_sp3_pp2 -> layer_11_norm_sp3_pp2
	layer_11_qkv_sp3_tp0_pp2 [label="QKV Proj L11 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp3_pp2 -> layer_11_qkv_sp3_tp0_pp2
	layer_11_attn_sp3_tp0_pp2 [label="Attention L11 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp3_tp0_pp2 -> layer_11_attn_sp3_tp0_pp2
	layer_11_attn_out_sp3_tp0_pp2 [label="Attn Out Proj L11 SP3 TP0\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp3_tp0_pp2 -> layer_11_attn_out_sp3_tp0_pp2
	layer_11_qkv_sp3_tp1_pp2 [label="QKV Proj L11 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp3_pp2 -> layer_11_qkv_sp3_tp1_pp2
	layer_11_attn_sp3_tp1_pp2 [label="Attention L11 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp3_tp1_pp2 -> layer_11_attn_sp3_tp1_pp2
	layer_11_attn_out_sp3_tp1_pp2 [label="Attn Out Proj L11 SP3 TP1\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp3_tp1_pp2 -> layer_11_attn_out_sp3_tp1_pp2
	layer_11_qkv_sp3_tp2_pp2 [label="QKV Proj L11 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp3_pp2 -> layer_11_qkv_sp3_tp2_pp2
	layer_11_attn_sp3_tp2_pp2 [label="Attention L11 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp3_tp2_pp2 -> layer_11_attn_sp3_tp2_pp2
	layer_11_attn_out_sp3_tp2_pp2 [label="Attn Out Proj L11 SP3 TP2\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp3_tp2_pp2 -> layer_11_attn_out_sp3_tp2_pp2
	layer_11_qkv_sp3_tp3_pp2 [label="QKV Proj L11 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_norm_sp3_pp2 -> layer_11_qkv_sp3_tp3_pp2
	layer_11_attn_sp3_tp3_pp2 [label="Attention L11 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_qkv_sp3_tp3_pp2 -> layer_11_attn_sp3_tp3_pp2
	layer_11_attn_out_sp3_tp3_pp2 [label="Attn Out Proj L11 SP3 TP3\nPP Stage 2\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_11_attn_sp3_tp3_pp2 -> layer_11_attn_out_sp3_tp3_pp2
	layer_11_attn_ar_sp3_pp2 [label="Attention All-Reduce L11 SP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_attn_out_sp3_tp0_pp2 -> layer_11_attn_ar_sp3_pp2
	layer_11_attn_out_sp3_tp1_pp2 -> layer_11_attn_ar_sp3_pp2
	layer_11_attn_out_sp3_tp2_pp2 -> layer_11_attn_ar_sp3_pp2
	layer_11_attn_out_sp3_tp3_pp2 -> layer_11_attn_ar_sp3_pp2
	layer_11_attn_res_sp3_pp2 [label="Attention Residual L11 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_attn_ar_sp3_pp2 -> layer_11_attn_res_sp3_pp2
	layer_11_norm_sp3_pp2 -> layer_11_attn_res_sp3_pp2 [style=dashed]
	layer_11_post_norm_sp3_pp2 [label="Post-Attn Norm L11 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_attn_res_sp3_pp2 -> layer_11_post_norm_sp3_pp2
	layer_11_router_sp3_pp2 [label="MoE Router L11 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_11_post_norm_sp3_pp2 -> layer_11_router_sp3_pp2
	layer_11_dispatch_sp3_ep0_pp2 [label="Token Dispatch L11 SP3 EP0\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep0_pp2 [style=dashed]
	layer_11_expert_sp3_ep0_tp0_pp2 [label="Expert L11 SP3 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep0_pp2 -> layer_11_expert_sp3_ep0_tp0_pp2
	layer_11_expert_out_sp3_ep0_tp0_pp2 [label="Expert Out L11 SP3 EP0 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep0_tp0_pp2 -> layer_11_expert_out_sp3_ep0_tp0_pp2
	layer_11_expert_sp3_ep0_tp1_pp2 [label="Expert L11 SP3 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep0_pp2 -> layer_11_expert_sp3_ep0_tp1_pp2
	layer_11_expert_out_sp3_ep0_tp1_pp2 [label="Expert Out L11 SP3 EP0 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep0_tp1_pp2 -> layer_11_expert_out_sp3_ep0_tp1_pp2
	layer_11_expert_sp3_ep0_tp2_pp2 [label="Expert L11 SP3 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep0_pp2 -> layer_11_expert_sp3_ep0_tp2_pp2
	layer_11_expert_out_sp3_ep0_tp2_pp2 [label="Expert Out L11 SP3 EP0 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep0_tp2_pp2 -> layer_11_expert_out_sp3_ep0_tp2_pp2
	layer_11_expert_sp3_ep0_tp3_pp2 [label="Expert L11 SP3 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep0_pp2 -> layer_11_expert_sp3_ep0_tp3_pp2
	layer_11_expert_out_sp3_ep0_tp3_pp2 [label="Expert Out L11 SP3 EP0 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep0_tp3_pp2 -> layer_11_expert_out_sp3_ep0_tp3_pp2
	layer_11_expert_ar_sp3_ep0_pp2 [label="Expert All-Reduce L11 SP3 EP0\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep0_tp0_pp2 -> layer_11_expert_ar_sp3_ep0_pp2
	layer_11_expert_out_sp3_ep0_tp1_pp2 -> layer_11_expert_ar_sp3_ep0_pp2
	layer_11_expert_out_sp3_ep0_tp2_pp2 -> layer_11_expert_ar_sp3_ep0_pp2
	layer_11_expert_out_sp3_ep0_tp3_pp2 -> layer_11_expert_ar_sp3_ep0_pp2
	layer_11_combine_sp3_ep0_pp2 [label="Token Combine L11 SP3 EP0\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep0_pp2 -> layer_11_combine_sp3_ep0_pp2
	layer_11_dispatch_sp3_ep1_pp2 [label="Token Dispatch L11 SP3 EP1\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep1_pp2 [style=dashed]
	layer_11_expert_sp3_ep1_tp0_pp2 [label="Expert L11 SP3 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep1_pp2 -> layer_11_expert_sp3_ep1_tp0_pp2
	layer_11_expert_out_sp3_ep1_tp0_pp2 [label="Expert Out L11 SP3 EP1 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep1_tp0_pp2 -> layer_11_expert_out_sp3_ep1_tp0_pp2
	layer_11_expert_sp3_ep1_tp1_pp2 [label="Expert L11 SP3 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep1_pp2 -> layer_11_expert_sp3_ep1_tp1_pp2
	layer_11_expert_out_sp3_ep1_tp1_pp2 [label="Expert Out L11 SP3 EP1 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep1_tp1_pp2 -> layer_11_expert_out_sp3_ep1_tp1_pp2
	layer_11_expert_sp3_ep1_tp2_pp2 [label="Expert L11 SP3 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep1_pp2 -> layer_11_expert_sp3_ep1_tp2_pp2
	layer_11_expert_out_sp3_ep1_tp2_pp2 [label="Expert Out L11 SP3 EP1 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep1_tp2_pp2 -> layer_11_expert_out_sp3_ep1_tp2_pp2
	layer_11_expert_sp3_ep1_tp3_pp2 [label="Expert L11 SP3 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep1_pp2 -> layer_11_expert_sp3_ep1_tp3_pp2
	layer_11_expert_out_sp3_ep1_tp3_pp2 [label="Expert Out L11 SP3 EP1 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep1_tp3_pp2 -> layer_11_expert_out_sp3_ep1_tp3_pp2
	layer_11_expert_ar_sp3_ep1_pp2 [label="Expert All-Reduce L11 SP3 EP1\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep1_tp0_pp2 -> layer_11_expert_ar_sp3_ep1_pp2
	layer_11_expert_out_sp3_ep1_tp1_pp2 -> layer_11_expert_ar_sp3_ep1_pp2
	layer_11_expert_out_sp3_ep1_tp2_pp2 -> layer_11_expert_ar_sp3_ep1_pp2
	layer_11_expert_out_sp3_ep1_tp3_pp2 -> layer_11_expert_ar_sp3_ep1_pp2
	layer_11_combine_sp3_ep1_pp2 [label="Token Combine L11 SP3 EP1\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep1_pp2 -> layer_11_combine_sp3_ep1_pp2
	layer_11_dispatch_sp3_ep2_pp2 [label="Token Dispatch L11 SP3 EP2\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep2_pp2 [style=dashed]
	layer_11_expert_sp3_ep2_tp0_pp2 [label="Expert L11 SP3 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep2_pp2 -> layer_11_expert_sp3_ep2_tp0_pp2
	layer_11_expert_out_sp3_ep2_tp0_pp2 [label="Expert Out L11 SP3 EP2 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep2_tp0_pp2 -> layer_11_expert_out_sp3_ep2_tp0_pp2
	layer_11_expert_sp3_ep2_tp1_pp2 [label="Expert L11 SP3 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep2_pp2 -> layer_11_expert_sp3_ep2_tp1_pp2
	layer_11_expert_out_sp3_ep2_tp1_pp2 [label="Expert Out L11 SP3 EP2 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep2_tp1_pp2 -> layer_11_expert_out_sp3_ep2_tp1_pp2
	layer_11_expert_sp3_ep2_tp2_pp2 [label="Expert L11 SP3 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep2_pp2 -> layer_11_expert_sp3_ep2_tp2_pp2
	layer_11_expert_out_sp3_ep2_tp2_pp2 [label="Expert Out L11 SP3 EP2 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep2_tp2_pp2 -> layer_11_expert_out_sp3_ep2_tp2_pp2
	layer_11_expert_sp3_ep2_tp3_pp2 [label="Expert L11 SP3 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep2_pp2 -> layer_11_expert_sp3_ep2_tp3_pp2
	layer_11_expert_out_sp3_ep2_tp3_pp2 [label="Expert Out L11 SP3 EP2 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep2_tp3_pp2 -> layer_11_expert_out_sp3_ep2_tp3_pp2
	layer_11_expert_ar_sp3_ep2_pp2 [label="Expert All-Reduce L11 SP3 EP2\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep2_tp0_pp2 -> layer_11_expert_ar_sp3_ep2_pp2
	layer_11_expert_out_sp3_ep2_tp1_pp2 -> layer_11_expert_ar_sp3_ep2_pp2
	layer_11_expert_out_sp3_ep2_tp2_pp2 -> layer_11_expert_ar_sp3_ep2_pp2
	layer_11_expert_out_sp3_ep2_tp3_pp2 -> layer_11_expert_ar_sp3_ep2_pp2
	layer_11_combine_sp3_ep2_pp2 [label="Token Combine L11 SP3 EP2\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep2_pp2 -> layer_11_combine_sp3_ep2_pp2
	layer_11_dispatch_sp3_ep3_pp2 [label="Token Dispatch L11 SP3 EP3\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep3_pp2 [style=dashed]
	layer_11_expert_sp3_ep3_tp0_pp2 [label="Expert L11 SP3 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep3_pp2 -> layer_11_expert_sp3_ep3_tp0_pp2
	layer_11_expert_out_sp3_ep3_tp0_pp2 [label="Expert Out L11 SP3 EP3 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep3_tp0_pp2 -> layer_11_expert_out_sp3_ep3_tp0_pp2
	layer_11_expert_sp3_ep3_tp1_pp2 [label="Expert L11 SP3 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep3_pp2 -> layer_11_expert_sp3_ep3_tp1_pp2
	layer_11_expert_out_sp3_ep3_tp1_pp2 [label="Expert Out L11 SP3 EP3 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep3_tp1_pp2 -> layer_11_expert_out_sp3_ep3_tp1_pp2
	layer_11_expert_sp3_ep3_tp2_pp2 [label="Expert L11 SP3 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep3_pp2 -> layer_11_expert_sp3_ep3_tp2_pp2
	layer_11_expert_out_sp3_ep3_tp2_pp2 [label="Expert Out L11 SP3 EP3 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep3_tp2_pp2 -> layer_11_expert_out_sp3_ep3_tp2_pp2
	layer_11_expert_sp3_ep3_tp3_pp2 [label="Expert L11 SP3 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep3_pp2 -> layer_11_expert_sp3_ep3_tp3_pp2
	layer_11_expert_out_sp3_ep3_tp3_pp2 [label="Expert Out L11 SP3 EP3 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep3_tp3_pp2 -> layer_11_expert_out_sp3_ep3_tp3_pp2
	layer_11_expert_ar_sp3_ep3_pp2 [label="Expert All-Reduce L11 SP3 EP3\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep3_tp0_pp2 -> layer_11_expert_ar_sp3_ep3_pp2
	layer_11_expert_out_sp3_ep3_tp1_pp2 -> layer_11_expert_ar_sp3_ep3_pp2
	layer_11_expert_out_sp3_ep3_tp2_pp2 -> layer_11_expert_ar_sp3_ep3_pp2
	layer_11_expert_out_sp3_ep3_tp3_pp2 -> layer_11_expert_ar_sp3_ep3_pp2
	layer_11_combine_sp3_ep3_pp2 [label="Token Combine L11 SP3 EP3\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep3_pp2 -> layer_11_combine_sp3_ep3_pp2
	layer_11_dispatch_sp3_ep4_pp2 [label="Token Dispatch L11 SP3 EP4\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep4_pp2 [style=dashed]
	layer_11_expert_sp3_ep4_tp0_pp2 [label="Expert L11 SP3 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep4_pp2 -> layer_11_expert_sp3_ep4_tp0_pp2
	layer_11_expert_out_sp3_ep4_tp0_pp2 [label="Expert Out L11 SP3 EP4 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep4_tp0_pp2 -> layer_11_expert_out_sp3_ep4_tp0_pp2
	layer_11_expert_sp3_ep4_tp1_pp2 [label="Expert L11 SP3 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep4_pp2 -> layer_11_expert_sp3_ep4_tp1_pp2
	layer_11_expert_out_sp3_ep4_tp1_pp2 [label="Expert Out L11 SP3 EP4 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep4_tp1_pp2 -> layer_11_expert_out_sp3_ep4_tp1_pp2
	layer_11_expert_sp3_ep4_tp2_pp2 [label="Expert L11 SP3 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep4_pp2 -> layer_11_expert_sp3_ep4_tp2_pp2
	layer_11_expert_out_sp3_ep4_tp2_pp2 [label="Expert Out L11 SP3 EP4 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep4_tp2_pp2 -> layer_11_expert_out_sp3_ep4_tp2_pp2
	layer_11_expert_sp3_ep4_tp3_pp2 [label="Expert L11 SP3 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep4_pp2 -> layer_11_expert_sp3_ep4_tp3_pp2
	layer_11_expert_out_sp3_ep4_tp3_pp2 [label="Expert Out L11 SP3 EP4 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep4_tp3_pp2 -> layer_11_expert_out_sp3_ep4_tp3_pp2
	layer_11_expert_ar_sp3_ep4_pp2 [label="Expert All-Reduce L11 SP3 EP4\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep4_tp0_pp2 -> layer_11_expert_ar_sp3_ep4_pp2
	layer_11_expert_out_sp3_ep4_tp1_pp2 -> layer_11_expert_ar_sp3_ep4_pp2
	layer_11_expert_out_sp3_ep4_tp2_pp2 -> layer_11_expert_ar_sp3_ep4_pp2
	layer_11_expert_out_sp3_ep4_tp3_pp2 -> layer_11_expert_ar_sp3_ep4_pp2
	layer_11_combine_sp3_ep4_pp2 [label="Token Combine L11 SP3 EP4\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep4_pp2 -> layer_11_combine_sp3_ep4_pp2
	layer_11_dispatch_sp3_ep5_pp2 [label="Token Dispatch L11 SP3 EP5\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep5_pp2 [style=dashed]
	layer_11_expert_sp3_ep5_tp0_pp2 [label="Expert L11 SP3 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep5_pp2 -> layer_11_expert_sp3_ep5_tp0_pp2
	layer_11_expert_out_sp3_ep5_tp0_pp2 [label="Expert Out L11 SP3 EP5 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep5_tp0_pp2 -> layer_11_expert_out_sp3_ep5_tp0_pp2
	layer_11_expert_sp3_ep5_tp1_pp2 [label="Expert L11 SP3 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep5_pp2 -> layer_11_expert_sp3_ep5_tp1_pp2
	layer_11_expert_out_sp3_ep5_tp1_pp2 [label="Expert Out L11 SP3 EP5 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep5_tp1_pp2 -> layer_11_expert_out_sp3_ep5_tp1_pp2
	layer_11_expert_sp3_ep5_tp2_pp2 [label="Expert L11 SP3 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep5_pp2 -> layer_11_expert_sp3_ep5_tp2_pp2
	layer_11_expert_out_sp3_ep5_tp2_pp2 [label="Expert Out L11 SP3 EP5 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep5_tp2_pp2 -> layer_11_expert_out_sp3_ep5_tp2_pp2
	layer_11_expert_sp3_ep5_tp3_pp2 [label="Expert L11 SP3 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep5_pp2 -> layer_11_expert_sp3_ep5_tp3_pp2
	layer_11_expert_out_sp3_ep5_tp3_pp2 [label="Expert Out L11 SP3 EP5 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep5_tp3_pp2 -> layer_11_expert_out_sp3_ep5_tp3_pp2
	layer_11_expert_ar_sp3_ep5_pp2 [label="Expert All-Reduce L11 SP3 EP5\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep5_tp0_pp2 -> layer_11_expert_ar_sp3_ep5_pp2
	layer_11_expert_out_sp3_ep5_tp1_pp2 -> layer_11_expert_ar_sp3_ep5_pp2
	layer_11_expert_out_sp3_ep5_tp2_pp2 -> layer_11_expert_ar_sp3_ep5_pp2
	layer_11_expert_out_sp3_ep5_tp3_pp2 -> layer_11_expert_ar_sp3_ep5_pp2
	layer_11_combine_sp3_ep5_pp2 [label="Token Combine L11 SP3 EP5\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep5_pp2 -> layer_11_combine_sp3_ep5_pp2
	layer_11_dispatch_sp3_ep6_pp2 [label="Token Dispatch L11 SP3 EP6\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep6_pp2 [style=dashed]
	layer_11_expert_sp3_ep6_tp0_pp2 [label="Expert L11 SP3 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep6_pp2 -> layer_11_expert_sp3_ep6_tp0_pp2
	layer_11_expert_out_sp3_ep6_tp0_pp2 [label="Expert Out L11 SP3 EP6 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep6_tp0_pp2 -> layer_11_expert_out_sp3_ep6_tp0_pp2
	layer_11_expert_sp3_ep6_tp1_pp2 [label="Expert L11 SP3 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep6_pp2 -> layer_11_expert_sp3_ep6_tp1_pp2
	layer_11_expert_out_sp3_ep6_tp1_pp2 [label="Expert Out L11 SP3 EP6 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep6_tp1_pp2 -> layer_11_expert_out_sp3_ep6_tp1_pp2
	layer_11_expert_sp3_ep6_tp2_pp2 [label="Expert L11 SP3 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep6_pp2 -> layer_11_expert_sp3_ep6_tp2_pp2
	layer_11_expert_out_sp3_ep6_tp2_pp2 [label="Expert Out L11 SP3 EP6 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep6_tp2_pp2 -> layer_11_expert_out_sp3_ep6_tp2_pp2
	layer_11_expert_sp3_ep6_tp3_pp2 [label="Expert L11 SP3 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep6_pp2 -> layer_11_expert_sp3_ep6_tp3_pp2
	layer_11_expert_out_sp3_ep6_tp3_pp2 [label="Expert Out L11 SP3 EP6 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep6_tp3_pp2 -> layer_11_expert_out_sp3_ep6_tp3_pp2
	layer_11_expert_ar_sp3_ep6_pp2 [label="Expert All-Reduce L11 SP3 EP6\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep6_tp0_pp2 -> layer_11_expert_ar_sp3_ep6_pp2
	layer_11_expert_out_sp3_ep6_tp1_pp2 -> layer_11_expert_ar_sp3_ep6_pp2
	layer_11_expert_out_sp3_ep6_tp2_pp2 -> layer_11_expert_ar_sp3_ep6_pp2
	layer_11_expert_out_sp3_ep6_tp3_pp2 -> layer_11_expert_ar_sp3_ep6_pp2
	layer_11_combine_sp3_ep6_pp2 [label="Token Combine L11 SP3 EP6\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep6_pp2 -> layer_11_combine_sp3_ep6_pp2
	layer_11_dispatch_sp3_ep7_pp2 [label="Token Dispatch L11 SP3 EP7\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep7_pp2 [style=dashed]
	layer_11_expert_sp3_ep7_tp0_pp2 [label="Expert L11 SP3 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep7_pp2 -> layer_11_expert_sp3_ep7_tp0_pp2
	layer_11_expert_out_sp3_ep7_tp0_pp2 [label="Expert Out L11 SP3 EP7 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep7_tp0_pp2 -> layer_11_expert_out_sp3_ep7_tp0_pp2
	layer_11_expert_sp3_ep7_tp1_pp2 [label="Expert L11 SP3 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep7_pp2 -> layer_11_expert_sp3_ep7_tp1_pp2
	layer_11_expert_out_sp3_ep7_tp1_pp2 [label="Expert Out L11 SP3 EP7 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep7_tp1_pp2 -> layer_11_expert_out_sp3_ep7_tp1_pp2
	layer_11_expert_sp3_ep7_tp2_pp2 [label="Expert L11 SP3 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep7_pp2 -> layer_11_expert_sp3_ep7_tp2_pp2
	layer_11_expert_out_sp3_ep7_tp2_pp2 [label="Expert Out L11 SP3 EP7 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep7_tp2_pp2 -> layer_11_expert_out_sp3_ep7_tp2_pp2
	layer_11_expert_sp3_ep7_tp3_pp2 [label="Expert L11 SP3 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep7_pp2 -> layer_11_expert_sp3_ep7_tp3_pp2
	layer_11_expert_out_sp3_ep7_tp3_pp2 [label="Expert Out L11 SP3 EP7 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep7_tp3_pp2 -> layer_11_expert_out_sp3_ep7_tp3_pp2
	layer_11_expert_ar_sp3_ep7_pp2 [label="Expert All-Reduce L11 SP3 EP7\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep7_tp0_pp2 -> layer_11_expert_ar_sp3_ep7_pp2
	layer_11_expert_out_sp3_ep7_tp1_pp2 -> layer_11_expert_ar_sp3_ep7_pp2
	layer_11_expert_out_sp3_ep7_tp2_pp2 -> layer_11_expert_ar_sp3_ep7_pp2
	layer_11_expert_out_sp3_ep7_tp3_pp2 -> layer_11_expert_ar_sp3_ep7_pp2
	layer_11_combine_sp3_ep7_pp2 [label="Token Combine L11 SP3 EP7\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep7_pp2 -> layer_11_combine_sp3_ep7_pp2
	layer_11_dispatch_sp3_ep8_pp2 [label="Token Dispatch L11 SP3 EP8\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep8_pp2 [style=dashed]
	layer_11_expert_sp3_ep8_tp0_pp2 [label="Expert L11 SP3 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep8_pp2 -> layer_11_expert_sp3_ep8_tp0_pp2
	layer_11_expert_out_sp3_ep8_tp0_pp2 [label="Expert Out L11 SP3 EP8 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep8_tp0_pp2 -> layer_11_expert_out_sp3_ep8_tp0_pp2
	layer_11_expert_sp3_ep8_tp1_pp2 [label="Expert L11 SP3 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep8_pp2 -> layer_11_expert_sp3_ep8_tp1_pp2
	layer_11_expert_out_sp3_ep8_tp1_pp2 [label="Expert Out L11 SP3 EP8 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep8_tp1_pp2 -> layer_11_expert_out_sp3_ep8_tp1_pp2
	layer_11_expert_sp3_ep8_tp2_pp2 [label="Expert L11 SP3 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep8_pp2 -> layer_11_expert_sp3_ep8_tp2_pp2
	layer_11_expert_out_sp3_ep8_tp2_pp2 [label="Expert Out L11 SP3 EP8 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep8_tp2_pp2 -> layer_11_expert_out_sp3_ep8_tp2_pp2
	layer_11_expert_sp3_ep8_tp3_pp2 [label="Expert L11 SP3 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep8_pp2 -> layer_11_expert_sp3_ep8_tp3_pp2
	layer_11_expert_out_sp3_ep8_tp3_pp2 [label="Expert Out L11 SP3 EP8 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep8_tp3_pp2 -> layer_11_expert_out_sp3_ep8_tp3_pp2
	layer_11_expert_ar_sp3_ep8_pp2 [label="Expert All-Reduce L11 SP3 EP8\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep8_tp0_pp2 -> layer_11_expert_ar_sp3_ep8_pp2
	layer_11_expert_out_sp3_ep8_tp1_pp2 -> layer_11_expert_ar_sp3_ep8_pp2
	layer_11_expert_out_sp3_ep8_tp2_pp2 -> layer_11_expert_ar_sp3_ep8_pp2
	layer_11_expert_out_sp3_ep8_tp3_pp2 -> layer_11_expert_ar_sp3_ep8_pp2
	layer_11_combine_sp3_ep8_pp2 [label="Token Combine L11 SP3 EP8\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep8_pp2 -> layer_11_combine_sp3_ep8_pp2
	layer_11_dispatch_sp3_ep9_pp2 [label="Token Dispatch L11 SP3 EP9\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep9_pp2 [style=dashed]
	layer_11_expert_sp3_ep9_tp0_pp2 [label="Expert L11 SP3 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep9_pp2 -> layer_11_expert_sp3_ep9_tp0_pp2
	layer_11_expert_out_sp3_ep9_tp0_pp2 [label="Expert Out L11 SP3 EP9 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep9_tp0_pp2 -> layer_11_expert_out_sp3_ep9_tp0_pp2
	layer_11_expert_sp3_ep9_tp1_pp2 [label="Expert L11 SP3 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep9_pp2 -> layer_11_expert_sp3_ep9_tp1_pp2
	layer_11_expert_out_sp3_ep9_tp1_pp2 [label="Expert Out L11 SP3 EP9 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep9_tp1_pp2 -> layer_11_expert_out_sp3_ep9_tp1_pp2
	layer_11_expert_sp3_ep9_tp2_pp2 [label="Expert L11 SP3 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep9_pp2 -> layer_11_expert_sp3_ep9_tp2_pp2
	layer_11_expert_out_sp3_ep9_tp2_pp2 [label="Expert Out L11 SP3 EP9 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep9_tp2_pp2 -> layer_11_expert_out_sp3_ep9_tp2_pp2
	layer_11_expert_sp3_ep9_tp3_pp2 [label="Expert L11 SP3 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep9_pp2 -> layer_11_expert_sp3_ep9_tp3_pp2
	layer_11_expert_out_sp3_ep9_tp3_pp2 [label="Expert Out L11 SP3 EP9 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep9_tp3_pp2 -> layer_11_expert_out_sp3_ep9_tp3_pp2
	layer_11_expert_ar_sp3_ep9_pp2 [label="Expert All-Reduce L11 SP3 EP9\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep9_tp0_pp2 -> layer_11_expert_ar_sp3_ep9_pp2
	layer_11_expert_out_sp3_ep9_tp1_pp2 -> layer_11_expert_ar_sp3_ep9_pp2
	layer_11_expert_out_sp3_ep9_tp2_pp2 -> layer_11_expert_ar_sp3_ep9_pp2
	layer_11_expert_out_sp3_ep9_tp3_pp2 -> layer_11_expert_ar_sp3_ep9_pp2
	layer_11_combine_sp3_ep9_pp2 [label="Token Combine L11 SP3 EP9\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep9_pp2 -> layer_11_combine_sp3_ep9_pp2
	layer_11_dispatch_sp3_ep10_pp2 [label="Token Dispatch L11 SP3 EP10\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep10_pp2 [style=dashed]
	layer_11_expert_sp3_ep10_tp0_pp2 [label="Expert L11 SP3 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep10_pp2 -> layer_11_expert_sp3_ep10_tp0_pp2
	layer_11_expert_out_sp3_ep10_tp0_pp2 [label="Expert Out L11 SP3 EP10 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep10_tp0_pp2 -> layer_11_expert_out_sp3_ep10_tp0_pp2
	layer_11_expert_sp3_ep10_tp1_pp2 [label="Expert L11 SP3 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep10_pp2 -> layer_11_expert_sp3_ep10_tp1_pp2
	layer_11_expert_out_sp3_ep10_tp1_pp2 [label="Expert Out L11 SP3 EP10 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep10_tp1_pp2 -> layer_11_expert_out_sp3_ep10_tp1_pp2
	layer_11_expert_sp3_ep10_tp2_pp2 [label="Expert L11 SP3 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep10_pp2 -> layer_11_expert_sp3_ep10_tp2_pp2
	layer_11_expert_out_sp3_ep10_tp2_pp2 [label="Expert Out L11 SP3 EP10 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep10_tp2_pp2 -> layer_11_expert_out_sp3_ep10_tp2_pp2
	layer_11_expert_sp3_ep10_tp3_pp2 [label="Expert L11 SP3 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep10_pp2 -> layer_11_expert_sp3_ep10_tp3_pp2
	layer_11_expert_out_sp3_ep10_tp3_pp2 [label="Expert Out L11 SP3 EP10 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep10_tp3_pp2 -> layer_11_expert_out_sp3_ep10_tp3_pp2
	layer_11_expert_ar_sp3_ep10_pp2 [label="Expert All-Reduce L11 SP3 EP10\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep10_tp0_pp2 -> layer_11_expert_ar_sp3_ep10_pp2
	layer_11_expert_out_sp3_ep10_tp1_pp2 -> layer_11_expert_ar_sp3_ep10_pp2
	layer_11_expert_out_sp3_ep10_tp2_pp2 -> layer_11_expert_ar_sp3_ep10_pp2
	layer_11_expert_out_sp3_ep10_tp3_pp2 -> layer_11_expert_ar_sp3_ep10_pp2
	layer_11_combine_sp3_ep10_pp2 [label="Token Combine L11 SP3 EP10\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep10_pp2 -> layer_11_combine_sp3_ep10_pp2
	layer_11_dispatch_sp3_ep11_pp2 [label="Token Dispatch L11 SP3 EP11\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep11_pp2 [style=dashed]
	layer_11_expert_sp3_ep11_tp0_pp2 [label="Expert L11 SP3 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep11_pp2 -> layer_11_expert_sp3_ep11_tp0_pp2
	layer_11_expert_out_sp3_ep11_tp0_pp2 [label="Expert Out L11 SP3 EP11 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep11_tp0_pp2 -> layer_11_expert_out_sp3_ep11_tp0_pp2
	layer_11_expert_sp3_ep11_tp1_pp2 [label="Expert L11 SP3 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep11_pp2 -> layer_11_expert_sp3_ep11_tp1_pp2
	layer_11_expert_out_sp3_ep11_tp1_pp2 [label="Expert Out L11 SP3 EP11 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep11_tp1_pp2 -> layer_11_expert_out_sp3_ep11_tp1_pp2
	layer_11_expert_sp3_ep11_tp2_pp2 [label="Expert L11 SP3 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep11_pp2 -> layer_11_expert_sp3_ep11_tp2_pp2
	layer_11_expert_out_sp3_ep11_tp2_pp2 [label="Expert Out L11 SP3 EP11 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep11_tp2_pp2 -> layer_11_expert_out_sp3_ep11_tp2_pp2
	layer_11_expert_sp3_ep11_tp3_pp2 [label="Expert L11 SP3 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep11_pp2 -> layer_11_expert_sp3_ep11_tp3_pp2
	layer_11_expert_out_sp3_ep11_tp3_pp2 [label="Expert Out L11 SP3 EP11 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep11_tp3_pp2 -> layer_11_expert_out_sp3_ep11_tp3_pp2
	layer_11_expert_ar_sp3_ep11_pp2 [label="Expert All-Reduce L11 SP3 EP11\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep11_tp0_pp2 -> layer_11_expert_ar_sp3_ep11_pp2
	layer_11_expert_out_sp3_ep11_tp1_pp2 -> layer_11_expert_ar_sp3_ep11_pp2
	layer_11_expert_out_sp3_ep11_tp2_pp2 -> layer_11_expert_ar_sp3_ep11_pp2
	layer_11_expert_out_sp3_ep11_tp3_pp2 -> layer_11_expert_ar_sp3_ep11_pp2
	layer_11_combine_sp3_ep11_pp2 [label="Token Combine L11 SP3 EP11\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep11_pp2 -> layer_11_combine_sp3_ep11_pp2
	layer_11_dispatch_sp3_ep12_pp2 [label="Token Dispatch L11 SP3 EP12\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep12_pp2 [style=dashed]
	layer_11_expert_sp3_ep12_tp0_pp2 [label="Expert L11 SP3 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep12_pp2 -> layer_11_expert_sp3_ep12_tp0_pp2
	layer_11_expert_out_sp3_ep12_tp0_pp2 [label="Expert Out L11 SP3 EP12 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep12_tp0_pp2 -> layer_11_expert_out_sp3_ep12_tp0_pp2
	layer_11_expert_sp3_ep12_tp1_pp2 [label="Expert L11 SP3 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep12_pp2 -> layer_11_expert_sp3_ep12_tp1_pp2
	layer_11_expert_out_sp3_ep12_tp1_pp2 [label="Expert Out L11 SP3 EP12 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep12_tp1_pp2 -> layer_11_expert_out_sp3_ep12_tp1_pp2
	layer_11_expert_sp3_ep12_tp2_pp2 [label="Expert L11 SP3 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep12_pp2 -> layer_11_expert_sp3_ep12_tp2_pp2
	layer_11_expert_out_sp3_ep12_tp2_pp2 [label="Expert Out L11 SP3 EP12 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep12_tp2_pp2 -> layer_11_expert_out_sp3_ep12_tp2_pp2
	layer_11_expert_sp3_ep12_tp3_pp2 [label="Expert L11 SP3 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep12_pp2 -> layer_11_expert_sp3_ep12_tp3_pp2
	layer_11_expert_out_sp3_ep12_tp3_pp2 [label="Expert Out L11 SP3 EP12 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep12_tp3_pp2 -> layer_11_expert_out_sp3_ep12_tp3_pp2
	layer_11_expert_ar_sp3_ep12_pp2 [label="Expert All-Reduce L11 SP3 EP12\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep12_tp0_pp2 -> layer_11_expert_ar_sp3_ep12_pp2
	layer_11_expert_out_sp3_ep12_tp1_pp2 -> layer_11_expert_ar_sp3_ep12_pp2
	layer_11_expert_out_sp3_ep12_tp2_pp2 -> layer_11_expert_ar_sp3_ep12_pp2
	layer_11_expert_out_sp3_ep12_tp3_pp2 -> layer_11_expert_ar_sp3_ep12_pp2
	layer_11_combine_sp3_ep12_pp2 [label="Token Combine L11 SP3 EP12\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep12_pp2 -> layer_11_combine_sp3_ep12_pp2
	layer_11_dispatch_sp3_ep13_pp2 [label="Token Dispatch L11 SP3 EP13\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep13_pp2 [style=dashed]
	layer_11_expert_sp3_ep13_tp0_pp2 [label="Expert L11 SP3 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep13_pp2 -> layer_11_expert_sp3_ep13_tp0_pp2
	layer_11_expert_out_sp3_ep13_tp0_pp2 [label="Expert Out L11 SP3 EP13 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep13_tp0_pp2 -> layer_11_expert_out_sp3_ep13_tp0_pp2
	layer_11_expert_sp3_ep13_tp1_pp2 [label="Expert L11 SP3 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep13_pp2 -> layer_11_expert_sp3_ep13_tp1_pp2
	layer_11_expert_out_sp3_ep13_tp1_pp2 [label="Expert Out L11 SP3 EP13 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep13_tp1_pp2 -> layer_11_expert_out_sp3_ep13_tp1_pp2
	layer_11_expert_sp3_ep13_tp2_pp2 [label="Expert L11 SP3 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep13_pp2 -> layer_11_expert_sp3_ep13_tp2_pp2
	layer_11_expert_out_sp3_ep13_tp2_pp2 [label="Expert Out L11 SP3 EP13 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep13_tp2_pp2 -> layer_11_expert_out_sp3_ep13_tp2_pp2
	layer_11_expert_sp3_ep13_tp3_pp2 [label="Expert L11 SP3 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep13_pp2 -> layer_11_expert_sp3_ep13_tp3_pp2
	layer_11_expert_out_sp3_ep13_tp3_pp2 [label="Expert Out L11 SP3 EP13 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep13_tp3_pp2 -> layer_11_expert_out_sp3_ep13_tp3_pp2
	layer_11_expert_ar_sp3_ep13_pp2 [label="Expert All-Reduce L11 SP3 EP13\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep13_tp0_pp2 -> layer_11_expert_ar_sp3_ep13_pp2
	layer_11_expert_out_sp3_ep13_tp1_pp2 -> layer_11_expert_ar_sp3_ep13_pp2
	layer_11_expert_out_sp3_ep13_tp2_pp2 -> layer_11_expert_ar_sp3_ep13_pp2
	layer_11_expert_out_sp3_ep13_tp3_pp2 -> layer_11_expert_ar_sp3_ep13_pp2
	layer_11_combine_sp3_ep13_pp2 [label="Token Combine L11 SP3 EP13\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep13_pp2 -> layer_11_combine_sp3_ep13_pp2
	layer_11_dispatch_sp3_ep14_pp2 [label="Token Dispatch L11 SP3 EP14\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep14_pp2 [style=dashed]
	layer_11_expert_sp3_ep14_tp0_pp2 [label="Expert L11 SP3 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep14_pp2 -> layer_11_expert_sp3_ep14_tp0_pp2
	layer_11_expert_out_sp3_ep14_tp0_pp2 [label="Expert Out L11 SP3 EP14 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep14_tp0_pp2 -> layer_11_expert_out_sp3_ep14_tp0_pp2
	layer_11_expert_sp3_ep14_tp1_pp2 [label="Expert L11 SP3 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep14_pp2 -> layer_11_expert_sp3_ep14_tp1_pp2
	layer_11_expert_out_sp3_ep14_tp1_pp2 [label="Expert Out L11 SP3 EP14 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep14_tp1_pp2 -> layer_11_expert_out_sp3_ep14_tp1_pp2
	layer_11_expert_sp3_ep14_tp2_pp2 [label="Expert L11 SP3 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep14_pp2 -> layer_11_expert_sp3_ep14_tp2_pp2
	layer_11_expert_out_sp3_ep14_tp2_pp2 [label="Expert Out L11 SP3 EP14 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep14_tp2_pp2 -> layer_11_expert_out_sp3_ep14_tp2_pp2
	layer_11_expert_sp3_ep14_tp3_pp2 [label="Expert L11 SP3 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep14_pp2 -> layer_11_expert_sp3_ep14_tp3_pp2
	layer_11_expert_out_sp3_ep14_tp3_pp2 [label="Expert Out L11 SP3 EP14 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep14_tp3_pp2 -> layer_11_expert_out_sp3_ep14_tp3_pp2
	layer_11_expert_ar_sp3_ep14_pp2 [label="Expert All-Reduce L11 SP3 EP14\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep14_tp0_pp2 -> layer_11_expert_ar_sp3_ep14_pp2
	layer_11_expert_out_sp3_ep14_tp1_pp2 -> layer_11_expert_ar_sp3_ep14_pp2
	layer_11_expert_out_sp3_ep14_tp2_pp2 -> layer_11_expert_ar_sp3_ep14_pp2
	layer_11_expert_out_sp3_ep14_tp3_pp2 -> layer_11_expert_ar_sp3_ep14_pp2
	layer_11_combine_sp3_ep14_pp2 [label="Token Combine L11 SP3 EP14\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep14_pp2 -> layer_11_combine_sp3_ep14_pp2
	layer_11_dispatch_sp3_ep15_pp2 [label="Token Dispatch L11 SP3 EP15\nPP Stage 2\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_11_router_sp3_pp2 -> layer_11_dispatch_sp3_ep15_pp2 [style=dashed]
	layer_11_expert_sp3_ep15_tp0_pp2 [label="Expert L11 SP3 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep15_pp2 -> layer_11_expert_sp3_ep15_tp0_pp2
	layer_11_expert_out_sp3_ep15_tp0_pp2 [label="Expert Out L11 SP3 EP15 TP0\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep15_tp0_pp2 -> layer_11_expert_out_sp3_ep15_tp0_pp2
	layer_11_expert_sp3_ep15_tp1_pp2 [label="Expert L11 SP3 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep15_pp2 -> layer_11_expert_sp3_ep15_tp1_pp2
	layer_11_expert_out_sp3_ep15_tp1_pp2 [label="Expert Out L11 SP3 EP15 TP1\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep15_tp1_pp2 -> layer_11_expert_out_sp3_ep15_tp1_pp2
	layer_11_expert_sp3_ep15_tp2_pp2 [label="Expert L11 SP3 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep15_pp2 -> layer_11_expert_sp3_ep15_tp2_pp2
	layer_11_expert_out_sp3_ep15_tp2_pp2 [label="Expert Out L11 SP3 EP15 TP2\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep15_tp2_pp2 -> layer_11_expert_out_sp3_ep15_tp2_pp2
	layer_11_expert_sp3_ep15_tp3_pp2 [label="Expert L11 SP3 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_dispatch_sp3_ep15_pp2 -> layer_11_expert_sp3_ep15_tp3_pp2
	layer_11_expert_out_sp3_ep15_tp3_pp2 [label="Expert Out L11 SP3 EP15 TP3\nPP Stage 2\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_11_expert_sp3_ep15_tp3_pp2 -> layer_11_expert_out_sp3_ep15_tp3_pp2
	layer_11_expert_ar_sp3_ep15_pp2 [label="Expert All-Reduce L11 SP3 EP15\nPP Stage 2\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_expert_out_sp3_ep15_tp0_pp2 -> layer_11_expert_ar_sp3_ep15_pp2
	layer_11_expert_out_sp3_ep15_tp1_pp2 -> layer_11_expert_ar_sp3_ep15_pp2
	layer_11_expert_out_sp3_ep15_tp2_pp2 -> layer_11_expert_ar_sp3_ep15_pp2
	layer_11_expert_out_sp3_ep15_tp3_pp2 -> layer_11_expert_ar_sp3_ep15_pp2
	layer_11_combine_sp3_ep15_pp2 [label="Token Combine L11 SP3 EP15\nPP Stage 2\nCombined Output" fillcolor=orange shape=ellipse]
	layer_11_expert_ar_sp3_ep15_pp2 -> layer_11_combine_sp3_ep15_pp2
	layer_11_moe_all2all_sp3_pp2 [label="MoE All-to-All L11 SP3\nPP Stage 2\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_11_combine_sp3_ep0_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep1_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep2_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep3_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep4_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep5_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep6_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep7_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep8_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep9_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep10_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep11_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep12_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep13_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep14_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_combine_sp3_ep15_pp2 -> layer_11_moe_all2all_sp3_pp2
	layer_11_mlp_out_sp3_pp2 [label="MoE Output L11 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_moe_all2all_sp3_pp2 -> layer_11_mlp_out_sp3_pp2
	layer_11_mlp_res_sp3_pp2 [label="MLP Residual L11 SP3\nPP Stage 2\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_mlp_out_sp3_pp2 -> layer_11_mlp_res_sp3_pp2
	layer_11_attn_res_sp3_pp2 -> layer_11_mlp_res_sp3_pp2 [style=dashed]
	layer_12_norm_sp0_pp3 [label="LayerNorm L12 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_mlp_out_sp0_pp2 -> layer_12_norm_sp0_pp3 [style=dashed]
	layer_11_mlp_out_sp1_pp2 -> layer_12_norm_sp0_pp3 [style=dashed]
	layer_11_mlp_out_sp2_pp2 -> layer_12_norm_sp0_pp3 [style=dashed]
	layer_11_mlp_out_sp3_pp2 -> layer_12_norm_sp0_pp3 [style=dashed]
	layer_12_qkv_sp0_tp0_pp3 [label="QKV Proj L12 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp0_pp3 -> layer_12_qkv_sp0_tp0_pp3
	layer_12_attn_sp0_tp0_pp3 [label="Attention L12 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp0_tp0_pp3 -> layer_12_attn_sp0_tp0_pp3
	layer_12_attn_out_sp0_tp0_pp3 [label="Attn Out Proj L12 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp0_tp0_pp3 -> layer_12_attn_out_sp0_tp0_pp3
	layer_12_qkv_sp0_tp1_pp3 [label="QKV Proj L12 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp0_pp3 -> layer_12_qkv_sp0_tp1_pp3
	layer_12_attn_sp0_tp1_pp3 [label="Attention L12 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp0_tp1_pp3 -> layer_12_attn_sp0_tp1_pp3
	layer_12_attn_out_sp0_tp1_pp3 [label="Attn Out Proj L12 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp0_tp1_pp3 -> layer_12_attn_out_sp0_tp1_pp3
	layer_12_qkv_sp0_tp2_pp3 [label="QKV Proj L12 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp0_pp3 -> layer_12_qkv_sp0_tp2_pp3
	layer_12_attn_sp0_tp2_pp3 [label="Attention L12 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp0_tp2_pp3 -> layer_12_attn_sp0_tp2_pp3
	layer_12_attn_out_sp0_tp2_pp3 [label="Attn Out Proj L12 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp0_tp2_pp3 -> layer_12_attn_out_sp0_tp2_pp3
	layer_12_qkv_sp0_tp3_pp3 [label="QKV Proj L12 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp0_pp3 -> layer_12_qkv_sp0_tp3_pp3
	layer_12_attn_sp0_tp3_pp3 [label="Attention L12 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp0_tp3_pp3 -> layer_12_attn_sp0_tp3_pp3
	layer_12_attn_out_sp0_tp3_pp3 [label="Attn Out Proj L12 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp0_tp3_pp3 -> layer_12_attn_out_sp0_tp3_pp3
	layer_12_attn_ar_sp0_pp3 [label="Attention All-Reduce L12 SP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_attn_out_sp0_tp0_pp3 -> layer_12_attn_ar_sp0_pp3
	layer_12_attn_out_sp0_tp1_pp3 -> layer_12_attn_ar_sp0_pp3
	layer_12_attn_out_sp0_tp2_pp3 -> layer_12_attn_ar_sp0_pp3
	layer_12_attn_out_sp0_tp3_pp3 -> layer_12_attn_ar_sp0_pp3
	layer_12_attn_res_sp0_pp3 [label="Attention Residual L12 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_attn_ar_sp0_pp3 -> layer_12_attn_res_sp0_pp3
	layer_12_norm_sp0_pp3 -> layer_12_attn_res_sp0_pp3 [style=dashed]
	layer_12_post_norm_sp0_pp3 [label="Post-Attn Norm L12 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_attn_res_sp0_pp3 -> layer_12_post_norm_sp0_pp3
	layer_12_router_sp0_pp3 [label="MoE Router L12 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_12_post_norm_sp0_pp3 -> layer_12_router_sp0_pp3
	layer_12_dispatch_sp0_ep0_pp3 [label="Token Dispatch L12 SP0 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep0_pp3 [style=dashed]
	layer_12_expert_sp0_ep0_tp0_pp3 [label="Expert L12 SP0 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep0_pp3 -> layer_12_expert_sp0_ep0_tp0_pp3
	layer_12_expert_out_sp0_ep0_tp0_pp3 [label="Expert Out L12 SP0 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep0_tp0_pp3 -> layer_12_expert_out_sp0_ep0_tp0_pp3
	layer_12_expert_sp0_ep0_tp1_pp3 [label="Expert L12 SP0 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep0_pp3 -> layer_12_expert_sp0_ep0_tp1_pp3
	layer_12_expert_out_sp0_ep0_tp1_pp3 [label="Expert Out L12 SP0 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep0_tp1_pp3 -> layer_12_expert_out_sp0_ep0_tp1_pp3
	layer_12_expert_sp0_ep0_tp2_pp3 [label="Expert L12 SP0 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep0_pp3 -> layer_12_expert_sp0_ep0_tp2_pp3
	layer_12_expert_out_sp0_ep0_tp2_pp3 [label="Expert Out L12 SP0 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep0_tp2_pp3 -> layer_12_expert_out_sp0_ep0_tp2_pp3
	layer_12_expert_sp0_ep0_tp3_pp3 [label="Expert L12 SP0 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep0_pp3 -> layer_12_expert_sp0_ep0_tp3_pp3
	layer_12_expert_out_sp0_ep0_tp3_pp3 [label="Expert Out L12 SP0 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep0_tp3_pp3 -> layer_12_expert_out_sp0_ep0_tp3_pp3
	layer_12_expert_ar_sp0_ep0_pp3 [label="Expert All-Reduce L12 SP0 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep0_tp0_pp3 -> layer_12_expert_ar_sp0_ep0_pp3
	layer_12_expert_out_sp0_ep0_tp1_pp3 -> layer_12_expert_ar_sp0_ep0_pp3
	layer_12_expert_out_sp0_ep0_tp2_pp3 -> layer_12_expert_ar_sp0_ep0_pp3
	layer_12_expert_out_sp0_ep0_tp3_pp3 -> layer_12_expert_ar_sp0_ep0_pp3
	layer_12_combine_sp0_ep0_pp3 [label="Token Combine L12 SP0 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep0_pp3 -> layer_12_combine_sp0_ep0_pp3
	layer_12_dispatch_sp0_ep1_pp3 [label="Token Dispatch L12 SP0 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep1_pp3 [style=dashed]
	layer_12_expert_sp0_ep1_tp0_pp3 [label="Expert L12 SP0 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep1_pp3 -> layer_12_expert_sp0_ep1_tp0_pp3
	layer_12_expert_out_sp0_ep1_tp0_pp3 [label="Expert Out L12 SP0 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep1_tp0_pp3 -> layer_12_expert_out_sp0_ep1_tp0_pp3
	layer_12_expert_sp0_ep1_tp1_pp3 [label="Expert L12 SP0 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep1_pp3 -> layer_12_expert_sp0_ep1_tp1_pp3
	layer_12_expert_out_sp0_ep1_tp1_pp3 [label="Expert Out L12 SP0 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep1_tp1_pp3 -> layer_12_expert_out_sp0_ep1_tp1_pp3
	layer_12_expert_sp0_ep1_tp2_pp3 [label="Expert L12 SP0 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep1_pp3 -> layer_12_expert_sp0_ep1_tp2_pp3
	layer_12_expert_out_sp0_ep1_tp2_pp3 [label="Expert Out L12 SP0 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep1_tp2_pp3 -> layer_12_expert_out_sp0_ep1_tp2_pp3
	layer_12_expert_sp0_ep1_tp3_pp3 [label="Expert L12 SP0 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep1_pp3 -> layer_12_expert_sp0_ep1_tp3_pp3
	layer_12_expert_out_sp0_ep1_tp3_pp3 [label="Expert Out L12 SP0 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep1_tp3_pp3 -> layer_12_expert_out_sp0_ep1_tp3_pp3
	layer_12_expert_ar_sp0_ep1_pp3 [label="Expert All-Reduce L12 SP0 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep1_tp0_pp3 -> layer_12_expert_ar_sp0_ep1_pp3
	layer_12_expert_out_sp0_ep1_tp1_pp3 -> layer_12_expert_ar_sp0_ep1_pp3
	layer_12_expert_out_sp0_ep1_tp2_pp3 -> layer_12_expert_ar_sp0_ep1_pp3
	layer_12_expert_out_sp0_ep1_tp3_pp3 -> layer_12_expert_ar_sp0_ep1_pp3
	layer_12_combine_sp0_ep1_pp3 [label="Token Combine L12 SP0 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep1_pp3 -> layer_12_combine_sp0_ep1_pp3
	layer_12_dispatch_sp0_ep2_pp3 [label="Token Dispatch L12 SP0 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep2_pp3 [style=dashed]
	layer_12_expert_sp0_ep2_tp0_pp3 [label="Expert L12 SP0 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep2_pp3 -> layer_12_expert_sp0_ep2_tp0_pp3
	layer_12_expert_out_sp0_ep2_tp0_pp3 [label="Expert Out L12 SP0 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep2_tp0_pp3 -> layer_12_expert_out_sp0_ep2_tp0_pp3
	layer_12_expert_sp0_ep2_tp1_pp3 [label="Expert L12 SP0 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep2_pp3 -> layer_12_expert_sp0_ep2_tp1_pp3
	layer_12_expert_out_sp0_ep2_tp1_pp3 [label="Expert Out L12 SP0 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep2_tp1_pp3 -> layer_12_expert_out_sp0_ep2_tp1_pp3
	layer_12_expert_sp0_ep2_tp2_pp3 [label="Expert L12 SP0 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep2_pp3 -> layer_12_expert_sp0_ep2_tp2_pp3
	layer_12_expert_out_sp0_ep2_tp2_pp3 [label="Expert Out L12 SP0 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep2_tp2_pp3 -> layer_12_expert_out_sp0_ep2_tp2_pp3
	layer_12_expert_sp0_ep2_tp3_pp3 [label="Expert L12 SP0 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep2_pp3 -> layer_12_expert_sp0_ep2_tp3_pp3
	layer_12_expert_out_sp0_ep2_tp3_pp3 [label="Expert Out L12 SP0 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep2_tp3_pp3 -> layer_12_expert_out_sp0_ep2_tp3_pp3
	layer_12_expert_ar_sp0_ep2_pp3 [label="Expert All-Reduce L12 SP0 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep2_tp0_pp3 -> layer_12_expert_ar_sp0_ep2_pp3
	layer_12_expert_out_sp0_ep2_tp1_pp3 -> layer_12_expert_ar_sp0_ep2_pp3
	layer_12_expert_out_sp0_ep2_tp2_pp3 -> layer_12_expert_ar_sp0_ep2_pp3
	layer_12_expert_out_sp0_ep2_tp3_pp3 -> layer_12_expert_ar_sp0_ep2_pp3
	layer_12_combine_sp0_ep2_pp3 [label="Token Combine L12 SP0 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep2_pp3 -> layer_12_combine_sp0_ep2_pp3
	layer_12_dispatch_sp0_ep3_pp3 [label="Token Dispatch L12 SP0 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep3_pp3 [style=dashed]
	layer_12_expert_sp0_ep3_tp0_pp3 [label="Expert L12 SP0 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep3_pp3 -> layer_12_expert_sp0_ep3_tp0_pp3
	layer_12_expert_out_sp0_ep3_tp0_pp3 [label="Expert Out L12 SP0 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep3_tp0_pp3 -> layer_12_expert_out_sp0_ep3_tp0_pp3
	layer_12_expert_sp0_ep3_tp1_pp3 [label="Expert L12 SP0 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep3_pp3 -> layer_12_expert_sp0_ep3_tp1_pp3
	layer_12_expert_out_sp0_ep3_tp1_pp3 [label="Expert Out L12 SP0 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep3_tp1_pp3 -> layer_12_expert_out_sp0_ep3_tp1_pp3
	layer_12_expert_sp0_ep3_tp2_pp3 [label="Expert L12 SP0 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep3_pp3 -> layer_12_expert_sp0_ep3_tp2_pp3
	layer_12_expert_out_sp0_ep3_tp2_pp3 [label="Expert Out L12 SP0 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep3_tp2_pp3 -> layer_12_expert_out_sp0_ep3_tp2_pp3
	layer_12_expert_sp0_ep3_tp3_pp3 [label="Expert L12 SP0 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep3_pp3 -> layer_12_expert_sp0_ep3_tp3_pp3
	layer_12_expert_out_sp0_ep3_tp3_pp3 [label="Expert Out L12 SP0 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep3_tp3_pp3 -> layer_12_expert_out_sp0_ep3_tp3_pp3
	layer_12_expert_ar_sp0_ep3_pp3 [label="Expert All-Reduce L12 SP0 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep3_tp0_pp3 -> layer_12_expert_ar_sp0_ep3_pp3
	layer_12_expert_out_sp0_ep3_tp1_pp3 -> layer_12_expert_ar_sp0_ep3_pp3
	layer_12_expert_out_sp0_ep3_tp2_pp3 -> layer_12_expert_ar_sp0_ep3_pp3
	layer_12_expert_out_sp0_ep3_tp3_pp3 -> layer_12_expert_ar_sp0_ep3_pp3
	layer_12_combine_sp0_ep3_pp3 [label="Token Combine L12 SP0 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep3_pp3 -> layer_12_combine_sp0_ep3_pp3
	layer_12_dispatch_sp0_ep4_pp3 [label="Token Dispatch L12 SP0 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep4_pp3 [style=dashed]
	layer_12_expert_sp0_ep4_tp0_pp3 [label="Expert L12 SP0 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep4_pp3 -> layer_12_expert_sp0_ep4_tp0_pp3
	layer_12_expert_out_sp0_ep4_tp0_pp3 [label="Expert Out L12 SP0 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep4_tp0_pp3 -> layer_12_expert_out_sp0_ep4_tp0_pp3
	layer_12_expert_sp0_ep4_tp1_pp3 [label="Expert L12 SP0 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep4_pp3 -> layer_12_expert_sp0_ep4_tp1_pp3
	layer_12_expert_out_sp0_ep4_tp1_pp3 [label="Expert Out L12 SP0 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep4_tp1_pp3 -> layer_12_expert_out_sp0_ep4_tp1_pp3
	layer_12_expert_sp0_ep4_tp2_pp3 [label="Expert L12 SP0 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep4_pp3 -> layer_12_expert_sp0_ep4_tp2_pp3
	layer_12_expert_out_sp0_ep4_tp2_pp3 [label="Expert Out L12 SP0 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep4_tp2_pp3 -> layer_12_expert_out_sp0_ep4_tp2_pp3
	layer_12_expert_sp0_ep4_tp3_pp3 [label="Expert L12 SP0 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep4_pp3 -> layer_12_expert_sp0_ep4_tp3_pp3
	layer_12_expert_out_sp0_ep4_tp3_pp3 [label="Expert Out L12 SP0 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep4_tp3_pp3 -> layer_12_expert_out_sp0_ep4_tp3_pp3
	layer_12_expert_ar_sp0_ep4_pp3 [label="Expert All-Reduce L12 SP0 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep4_tp0_pp3 -> layer_12_expert_ar_sp0_ep4_pp3
	layer_12_expert_out_sp0_ep4_tp1_pp3 -> layer_12_expert_ar_sp0_ep4_pp3
	layer_12_expert_out_sp0_ep4_tp2_pp3 -> layer_12_expert_ar_sp0_ep4_pp3
	layer_12_expert_out_sp0_ep4_tp3_pp3 -> layer_12_expert_ar_sp0_ep4_pp3
	layer_12_combine_sp0_ep4_pp3 [label="Token Combine L12 SP0 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep4_pp3 -> layer_12_combine_sp0_ep4_pp3
	layer_12_dispatch_sp0_ep5_pp3 [label="Token Dispatch L12 SP0 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep5_pp3 [style=dashed]
	layer_12_expert_sp0_ep5_tp0_pp3 [label="Expert L12 SP0 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep5_pp3 -> layer_12_expert_sp0_ep5_tp0_pp3
	layer_12_expert_out_sp0_ep5_tp0_pp3 [label="Expert Out L12 SP0 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep5_tp0_pp3 -> layer_12_expert_out_sp0_ep5_tp0_pp3
	layer_12_expert_sp0_ep5_tp1_pp3 [label="Expert L12 SP0 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep5_pp3 -> layer_12_expert_sp0_ep5_tp1_pp3
	layer_12_expert_out_sp0_ep5_tp1_pp3 [label="Expert Out L12 SP0 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep5_tp1_pp3 -> layer_12_expert_out_sp0_ep5_tp1_pp3
	layer_12_expert_sp0_ep5_tp2_pp3 [label="Expert L12 SP0 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep5_pp3 -> layer_12_expert_sp0_ep5_tp2_pp3
	layer_12_expert_out_sp0_ep5_tp2_pp3 [label="Expert Out L12 SP0 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep5_tp2_pp3 -> layer_12_expert_out_sp0_ep5_tp2_pp3
	layer_12_expert_sp0_ep5_tp3_pp3 [label="Expert L12 SP0 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep5_pp3 -> layer_12_expert_sp0_ep5_tp3_pp3
	layer_12_expert_out_sp0_ep5_tp3_pp3 [label="Expert Out L12 SP0 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep5_tp3_pp3 -> layer_12_expert_out_sp0_ep5_tp3_pp3
	layer_12_expert_ar_sp0_ep5_pp3 [label="Expert All-Reduce L12 SP0 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep5_tp0_pp3 -> layer_12_expert_ar_sp0_ep5_pp3
	layer_12_expert_out_sp0_ep5_tp1_pp3 -> layer_12_expert_ar_sp0_ep5_pp3
	layer_12_expert_out_sp0_ep5_tp2_pp3 -> layer_12_expert_ar_sp0_ep5_pp3
	layer_12_expert_out_sp0_ep5_tp3_pp3 -> layer_12_expert_ar_sp0_ep5_pp3
	layer_12_combine_sp0_ep5_pp3 [label="Token Combine L12 SP0 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep5_pp3 -> layer_12_combine_sp0_ep5_pp3
	layer_12_dispatch_sp0_ep6_pp3 [label="Token Dispatch L12 SP0 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep6_pp3 [style=dashed]
	layer_12_expert_sp0_ep6_tp0_pp3 [label="Expert L12 SP0 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep6_pp3 -> layer_12_expert_sp0_ep6_tp0_pp3
	layer_12_expert_out_sp0_ep6_tp0_pp3 [label="Expert Out L12 SP0 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep6_tp0_pp3 -> layer_12_expert_out_sp0_ep6_tp0_pp3
	layer_12_expert_sp0_ep6_tp1_pp3 [label="Expert L12 SP0 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep6_pp3 -> layer_12_expert_sp0_ep6_tp1_pp3
	layer_12_expert_out_sp0_ep6_tp1_pp3 [label="Expert Out L12 SP0 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep6_tp1_pp3 -> layer_12_expert_out_sp0_ep6_tp1_pp3
	layer_12_expert_sp0_ep6_tp2_pp3 [label="Expert L12 SP0 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep6_pp3 -> layer_12_expert_sp0_ep6_tp2_pp3
	layer_12_expert_out_sp0_ep6_tp2_pp3 [label="Expert Out L12 SP0 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep6_tp2_pp3 -> layer_12_expert_out_sp0_ep6_tp2_pp3
	layer_12_expert_sp0_ep6_tp3_pp3 [label="Expert L12 SP0 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep6_pp3 -> layer_12_expert_sp0_ep6_tp3_pp3
	layer_12_expert_out_sp0_ep6_tp3_pp3 [label="Expert Out L12 SP0 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep6_tp3_pp3 -> layer_12_expert_out_sp0_ep6_tp3_pp3
	layer_12_expert_ar_sp0_ep6_pp3 [label="Expert All-Reduce L12 SP0 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep6_tp0_pp3 -> layer_12_expert_ar_sp0_ep6_pp3
	layer_12_expert_out_sp0_ep6_tp1_pp3 -> layer_12_expert_ar_sp0_ep6_pp3
	layer_12_expert_out_sp0_ep6_tp2_pp3 -> layer_12_expert_ar_sp0_ep6_pp3
	layer_12_expert_out_sp0_ep6_tp3_pp3 -> layer_12_expert_ar_sp0_ep6_pp3
	layer_12_combine_sp0_ep6_pp3 [label="Token Combine L12 SP0 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep6_pp3 -> layer_12_combine_sp0_ep6_pp3
	layer_12_dispatch_sp0_ep7_pp3 [label="Token Dispatch L12 SP0 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep7_pp3 [style=dashed]
	layer_12_expert_sp0_ep7_tp0_pp3 [label="Expert L12 SP0 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep7_pp3 -> layer_12_expert_sp0_ep7_tp0_pp3
	layer_12_expert_out_sp0_ep7_tp0_pp3 [label="Expert Out L12 SP0 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep7_tp0_pp3 -> layer_12_expert_out_sp0_ep7_tp0_pp3
	layer_12_expert_sp0_ep7_tp1_pp3 [label="Expert L12 SP0 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep7_pp3 -> layer_12_expert_sp0_ep7_tp1_pp3
	layer_12_expert_out_sp0_ep7_tp1_pp3 [label="Expert Out L12 SP0 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep7_tp1_pp3 -> layer_12_expert_out_sp0_ep7_tp1_pp3
	layer_12_expert_sp0_ep7_tp2_pp3 [label="Expert L12 SP0 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep7_pp3 -> layer_12_expert_sp0_ep7_tp2_pp3
	layer_12_expert_out_sp0_ep7_tp2_pp3 [label="Expert Out L12 SP0 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep7_tp2_pp3 -> layer_12_expert_out_sp0_ep7_tp2_pp3
	layer_12_expert_sp0_ep7_tp3_pp3 [label="Expert L12 SP0 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep7_pp3 -> layer_12_expert_sp0_ep7_tp3_pp3
	layer_12_expert_out_sp0_ep7_tp3_pp3 [label="Expert Out L12 SP0 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep7_tp3_pp3 -> layer_12_expert_out_sp0_ep7_tp3_pp3
	layer_12_expert_ar_sp0_ep7_pp3 [label="Expert All-Reduce L12 SP0 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep7_tp0_pp3 -> layer_12_expert_ar_sp0_ep7_pp3
	layer_12_expert_out_sp0_ep7_tp1_pp3 -> layer_12_expert_ar_sp0_ep7_pp3
	layer_12_expert_out_sp0_ep7_tp2_pp3 -> layer_12_expert_ar_sp0_ep7_pp3
	layer_12_expert_out_sp0_ep7_tp3_pp3 -> layer_12_expert_ar_sp0_ep7_pp3
	layer_12_combine_sp0_ep7_pp3 [label="Token Combine L12 SP0 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep7_pp3 -> layer_12_combine_sp0_ep7_pp3
	layer_12_dispatch_sp0_ep8_pp3 [label="Token Dispatch L12 SP0 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep8_pp3 [style=dashed]
	layer_12_expert_sp0_ep8_tp0_pp3 [label="Expert L12 SP0 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep8_pp3 -> layer_12_expert_sp0_ep8_tp0_pp3
	layer_12_expert_out_sp0_ep8_tp0_pp3 [label="Expert Out L12 SP0 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep8_tp0_pp3 -> layer_12_expert_out_sp0_ep8_tp0_pp3
	layer_12_expert_sp0_ep8_tp1_pp3 [label="Expert L12 SP0 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep8_pp3 -> layer_12_expert_sp0_ep8_tp1_pp3
	layer_12_expert_out_sp0_ep8_tp1_pp3 [label="Expert Out L12 SP0 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep8_tp1_pp3 -> layer_12_expert_out_sp0_ep8_tp1_pp3
	layer_12_expert_sp0_ep8_tp2_pp3 [label="Expert L12 SP0 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep8_pp3 -> layer_12_expert_sp0_ep8_tp2_pp3
	layer_12_expert_out_sp0_ep8_tp2_pp3 [label="Expert Out L12 SP0 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep8_tp2_pp3 -> layer_12_expert_out_sp0_ep8_tp2_pp3
	layer_12_expert_sp0_ep8_tp3_pp3 [label="Expert L12 SP0 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep8_pp3 -> layer_12_expert_sp0_ep8_tp3_pp3
	layer_12_expert_out_sp0_ep8_tp3_pp3 [label="Expert Out L12 SP0 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep8_tp3_pp3 -> layer_12_expert_out_sp0_ep8_tp3_pp3
	layer_12_expert_ar_sp0_ep8_pp3 [label="Expert All-Reduce L12 SP0 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep8_tp0_pp3 -> layer_12_expert_ar_sp0_ep8_pp3
	layer_12_expert_out_sp0_ep8_tp1_pp3 -> layer_12_expert_ar_sp0_ep8_pp3
	layer_12_expert_out_sp0_ep8_tp2_pp3 -> layer_12_expert_ar_sp0_ep8_pp3
	layer_12_expert_out_sp0_ep8_tp3_pp3 -> layer_12_expert_ar_sp0_ep8_pp3
	layer_12_combine_sp0_ep8_pp3 [label="Token Combine L12 SP0 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep8_pp3 -> layer_12_combine_sp0_ep8_pp3
	layer_12_dispatch_sp0_ep9_pp3 [label="Token Dispatch L12 SP0 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep9_pp3 [style=dashed]
	layer_12_expert_sp0_ep9_tp0_pp3 [label="Expert L12 SP0 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep9_pp3 -> layer_12_expert_sp0_ep9_tp0_pp3
	layer_12_expert_out_sp0_ep9_tp0_pp3 [label="Expert Out L12 SP0 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep9_tp0_pp3 -> layer_12_expert_out_sp0_ep9_tp0_pp3
	layer_12_expert_sp0_ep9_tp1_pp3 [label="Expert L12 SP0 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep9_pp3 -> layer_12_expert_sp0_ep9_tp1_pp3
	layer_12_expert_out_sp0_ep9_tp1_pp3 [label="Expert Out L12 SP0 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep9_tp1_pp3 -> layer_12_expert_out_sp0_ep9_tp1_pp3
	layer_12_expert_sp0_ep9_tp2_pp3 [label="Expert L12 SP0 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep9_pp3 -> layer_12_expert_sp0_ep9_tp2_pp3
	layer_12_expert_out_sp0_ep9_tp2_pp3 [label="Expert Out L12 SP0 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep9_tp2_pp3 -> layer_12_expert_out_sp0_ep9_tp2_pp3
	layer_12_expert_sp0_ep9_tp3_pp3 [label="Expert L12 SP0 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep9_pp3 -> layer_12_expert_sp0_ep9_tp3_pp3
	layer_12_expert_out_sp0_ep9_tp3_pp3 [label="Expert Out L12 SP0 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep9_tp3_pp3 -> layer_12_expert_out_sp0_ep9_tp3_pp3
	layer_12_expert_ar_sp0_ep9_pp3 [label="Expert All-Reduce L12 SP0 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep9_tp0_pp3 -> layer_12_expert_ar_sp0_ep9_pp3
	layer_12_expert_out_sp0_ep9_tp1_pp3 -> layer_12_expert_ar_sp0_ep9_pp3
	layer_12_expert_out_sp0_ep9_tp2_pp3 -> layer_12_expert_ar_sp0_ep9_pp3
	layer_12_expert_out_sp0_ep9_tp3_pp3 -> layer_12_expert_ar_sp0_ep9_pp3
	layer_12_combine_sp0_ep9_pp3 [label="Token Combine L12 SP0 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep9_pp3 -> layer_12_combine_sp0_ep9_pp3
	layer_12_dispatch_sp0_ep10_pp3 [label="Token Dispatch L12 SP0 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep10_pp3 [style=dashed]
	layer_12_expert_sp0_ep10_tp0_pp3 [label="Expert L12 SP0 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep10_pp3 -> layer_12_expert_sp0_ep10_tp0_pp3
	layer_12_expert_out_sp0_ep10_tp0_pp3 [label="Expert Out L12 SP0 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep10_tp0_pp3 -> layer_12_expert_out_sp0_ep10_tp0_pp3
	layer_12_expert_sp0_ep10_tp1_pp3 [label="Expert L12 SP0 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep10_pp3 -> layer_12_expert_sp0_ep10_tp1_pp3
	layer_12_expert_out_sp0_ep10_tp1_pp3 [label="Expert Out L12 SP0 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep10_tp1_pp3 -> layer_12_expert_out_sp0_ep10_tp1_pp3
	layer_12_expert_sp0_ep10_tp2_pp3 [label="Expert L12 SP0 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep10_pp3 -> layer_12_expert_sp0_ep10_tp2_pp3
	layer_12_expert_out_sp0_ep10_tp2_pp3 [label="Expert Out L12 SP0 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep10_tp2_pp3 -> layer_12_expert_out_sp0_ep10_tp2_pp3
	layer_12_expert_sp0_ep10_tp3_pp3 [label="Expert L12 SP0 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep10_pp3 -> layer_12_expert_sp0_ep10_tp3_pp3
	layer_12_expert_out_sp0_ep10_tp3_pp3 [label="Expert Out L12 SP0 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep10_tp3_pp3 -> layer_12_expert_out_sp0_ep10_tp3_pp3
	layer_12_expert_ar_sp0_ep10_pp3 [label="Expert All-Reduce L12 SP0 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep10_tp0_pp3 -> layer_12_expert_ar_sp0_ep10_pp3
	layer_12_expert_out_sp0_ep10_tp1_pp3 -> layer_12_expert_ar_sp0_ep10_pp3
	layer_12_expert_out_sp0_ep10_tp2_pp3 -> layer_12_expert_ar_sp0_ep10_pp3
	layer_12_expert_out_sp0_ep10_tp3_pp3 -> layer_12_expert_ar_sp0_ep10_pp3
	layer_12_combine_sp0_ep10_pp3 [label="Token Combine L12 SP0 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep10_pp3 -> layer_12_combine_sp0_ep10_pp3
	layer_12_dispatch_sp0_ep11_pp3 [label="Token Dispatch L12 SP0 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep11_pp3 [style=dashed]
	layer_12_expert_sp0_ep11_tp0_pp3 [label="Expert L12 SP0 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep11_pp3 -> layer_12_expert_sp0_ep11_tp0_pp3
	layer_12_expert_out_sp0_ep11_tp0_pp3 [label="Expert Out L12 SP0 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep11_tp0_pp3 -> layer_12_expert_out_sp0_ep11_tp0_pp3
	layer_12_expert_sp0_ep11_tp1_pp3 [label="Expert L12 SP0 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep11_pp3 -> layer_12_expert_sp0_ep11_tp1_pp3
	layer_12_expert_out_sp0_ep11_tp1_pp3 [label="Expert Out L12 SP0 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep11_tp1_pp3 -> layer_12_expert_out_sp0_ep11_tp1_pp3
	layer_12_expert_sp0_ep11_tp2_pp3 [label="Expert L12 SP0 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep11_pp3 -> layer_12_expert_sp0_ep11_tp2_pp3
	layer_12_expert_out_sp0_ep11_tp2_pp3 [label="Expert Out L12 SP0 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep11_tp2_pp3 -> layer_12_expert_out_sp0_ep11_tp2_pp3
	layer_12_expert_sp0_ep11_tp3_pp3 [label="Expert L12 SP0 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep11_pp3 -> layer_12_expert_sp0_ep11_tp3_pp3
	layer_12_expert_out_sp0_ep11_tp3_pp3 [label="Expert Out L12 SP0 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep11_tp3_pp3 -> layer_12_expert_out_sp0_ep11_tp3_pp3
	layer_12_expert_ar_sp0_ep11_pp3 [label="Expert All-Reduce L12 SP0 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep11_tp0_pp3 -> layer_12_expert_ar_sp0_ep11_pp3
	layer_12_expert_out_sp0_ep11_tp1_pp3 -> layer_12_expert_ar_sp0_ep11_pp3
	layer_12_expert_out_sp0_ep11_tp2_pp3 -> layer_12_expert_ar_sp0_ep11_pp3
	layer_12_expert_out_sp0_ep11_tp3_pp3 -> layer_12_expert_ar_sp0_ep11_pp3
	layer_12_combine_sp0_ep11_pp3 [label="Token Combine L12 SP0 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep11_pp3 -> layer_12_combine_sp0_ep11_pp3
	layer_12_dispatch_sp0_ep12_pp3 [label="Token Dispatch L12 SP0 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep12_pp3 [style=dashed]
	layer_12_expert_sp0_ep12_tp0_pp3 [label="Expert L12 SP0 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep12_pp3 -> layer_12_expert_sp0_ep12_tp0_pp3
	layer_12_expert_out_sp0_ep12_tp0_pp3 [label="Expert Out L12 SP0 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep12_tp0_pp3 -> layer_12_expert_out_sp0_ep12_tp0_pp3
	layer_12_expert_sp0_ep12_tp1_pp3 [label="Expert L12 SP0 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep12_pp3 -> layer_12_expert_sp0_ep12_tp1_pp3
	layer_12_expert_out_sp0_ep12_tp1_pp3 [label="Expert Out L12 SP0 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep12_tp1_pp3 -> layer_12_expert_out_sp0_ep12_tp1_pp3
	layer_12_expert_sp0_ep12_tp2_pp3 [label="Expert L12 SP0 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep12_pp3 -> layer_12_expert_sp0_ep12_tp2_pp3
	layer_12_expert_out_sp0_ep12_tp2_pp3 [label="Expert Out L12 SP0 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep12_tp2_pp3 -> layer_12_expert_out_sp0_ep12_tp2_pp3
	layer_12_expert_sp0_ep12_tp3_pp3 [label="Expert L12 SP0 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep12_pp3 -> layer_12_expert_sp0_ep12_tp3_pp3
	layer_12_expert_out_sp0_ep12_tp3_pp3 [label="Expert Out L12 SP0 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep12_tp3_pp3 -> layer_12_expert_out_sp0_ep12_tp3_pp3
	layer_12_expert_ar_sp0_ep12_pp3 [label="Expert All-Reduce L12 SP0 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep12_tp0_pp3 -> layer_12_expert_ar_sp0_ep12_pp3
	layer_12_expert_out_sp0_ep12_tp1_pp3 -> layer_12_expert_ar_sp0_ep12_pp3
	layer_12_expert_out_sp0_ep12_tp2_pp3 -> layer_12_expert_ar_sp0_ep12_pp3
	layer_12_expert_out_sp0_ep12_tp3_pp3 -> layer_12_expert_ar_sp0_ep12_pp3
	layer_12_combine_sp0_ep12_pp3 [label="Token Combine L12 SP0 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep12_pp3 -> layer_12_combine_sp0_ep12_pp3
	layer_12_dispatch_sp0_ep13_pp3 [label="Token Dispatch L12 SP0 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep13_pp3 [style=dashed]
	layer_12_expert_sp0_ep13_tp0_pp3 [label="Expert L12 SP0 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep13_pp3 -> layer_12_expert_sp0_ep13_tp0_pp3
	layer_12_expert_out_sp0_ep13_tp0_pp3 [label="Expert Out L12 SP0 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep13_tp0_pp3 -> layer_12_expert_out_sp0_ep13_tp0_pp3
	layer_12_expert_sp0_ep13_tp1_pp3 [label="Expert L12 SP0 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep13_pp3 -> layer_12_expert_sp0_ep13_tp1_pp3
	layer_12_expert_out_sp0_ep13_tp1_pp3 [label="Expert Out L12 SP0 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep13_tp1_pp3 -> layer_12_expert_out_sp0_ep13_tp1_pp3
	layer_12_expert_sp0_ep13_tp2_pp3 [label="Expert L12 SP0 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep13_pp3 -> layer_12_expert_sp0_ep13_tp2_pp3
	layer_12_expert_out_sp0_ep13_tp2_pp3 [label="Expert Out L12 SP0 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep13_tp2_pp3 -> layer_12_expert_out_sp0_ep13_tp2_pp3
	layer_12_expert_sp0_ep13_tp3_pp3 [label="Expert L12 SP0 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep13_pp3 -> layer_12_expert_sp0_ep13_tp3_pp3
	layer_12_expert_out_sp0_ep13_tp3_pp3 [label="Expert Out L12 SP0 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep13_tp3_pp3 -> layer_12_expert_out_sp0_ep13_tp3_pp3
	layer_12_expert_ar_sp0_ep13_pp3 [label="Expert All-Reduce L12 SP0 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep13_tp0_pp3 -> layer_12_expert_ar_sp0_ep13_pp3
	layer_12_expert_out_sp0_ep13_tp1_pp3 -> layer_12_expert_ar_sp0_ep13_pp3
	layer_12_expert_out_sp0_ep13_tp2_pp3 -> layer_12_expert_ar_sp0_ep13_pp3
	layer_12_expert_out_sp0_ep13_tp3_pp3 -> layer_12_expert_ar_sp0_ep13_pp3
	layer_12_combine_sp0_ep13_pp3 [label="Token Combine L12 SP0 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep13_pp3 -> layer_12_combine_sp0_ep13_pp3
	layer_12_dispatch_sp0_ep14_pp3 [label="Token Dispatch L12 SP0 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep14_pp3 [style=dashed]
	layer_12_expert_sp0_ep14_tp0_pp3 [label="Expert L12 SP0 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep14_pp3 -> layer_12_expert_sp0_ep14_tp0_pp3
	layer_12_expert_out_sp0_ep14_tp0_pp3 [label="Expert Out L12 SP0 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep14_tp0_pp3 -> layer_12_expert_out_sp0_ep14_tp0_pp3
	layer_12_expert_sp0_ep14_tp1_pp3 [label="Expert L12 SP0 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep14_pp3 -> layer_12_expert_sp0_ep14_tp1_pp3
	layer_12_expert_out_sp0_ep14_tp1_pp3 [label="Expert Out L12 SP0 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep14_tp1_pp3 -> layer_12_expert_out_sp0_ep14_tp1_pp3
	layer_12_expert_sp0_ep14_tp2_pp3 [label="Expert L12 SP0 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep14_pp3 -> layer_12_expert_sp0_ep14_tp2_pp3
	layer_12_expert_out_sp0_ep14_tp2_pp3 [label="Expert Out L12 SP0 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep14_tp2_pp3 -> layer_12_expert_out_sp0_ep14_tp2_pp3
	layer_12_expert_sp0_ep14_tp3_pp3 [label="Expert L12 SP0 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep14_pp3 -> layer_12_expert_sp0_ep14_tp3_pp3
	layer_12_expert_out_sp0_ep14_tp3_pp3 [label="Expert Out L12 SP0 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep14_tp3_pp3 -> layer_12_expert_out_sp0_ep14_tp3_pp3
	layer_12_expert_ar_sp0_ep14_pp3 [label="Expert All-Reduce L12 SP0 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep14_tp0_pp3 -> layer_12_expert_ar_sp0_ep14_pp3
	layer_12_expert_out_sp0_ep14_tp1_pp3 -> layer_12_expert_ar_sp0_ep14_pp3
	layer_12_expert_out_sp0_ep14_tp2_pp3 -> layer_12_expert_ar_sp0_ep14_pp3
	layer_12_expert_out_sp0_ep14_tp3_pp3 -> layer_12_expert_ar_sp0_ep14_pp3
	layer_12_combine_sp0_ep14_pp3 [label="Token Combine L12 SP0 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep14_pp3 -> layer_12_combine_sp0_ep14_pp3
	layer_12_dispatch_sp0_ep15_pp3 [label="Token Dispatch L12 SP0 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp0_pp3 -> layer_12_dispatch_sp0_ep15_pp3 [style=dashed]
	layer_12_expert_sp0_ep15_tp0_pp3 [label="Expert L12 SP0 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep15_pp3 -> layer_12_expert_sp0_ep15_tp0_pp3
	layer_12_expert_out_sp0_ep15_tp0_pp3 [label="Expert Out L12 SP0 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep15_tp0_pp3 -> layer_12_expert_out_sp0_ep15_tp0_pp3
	layer_12_expert_sp0_ep15_tp1_pp3 [label="Expert L12 SP0 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep15_pp3 -> layer_12_expert_sp0_ep15_tp1_pp3
	layer_12_expert_out_sp0_ep15_tp1_pp3 [label="Expert Out L12 SP0 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep15_tp1_pp3 -> layer_12_expert_out_sp0_ep15_tp1_pp3
	layer_12_expert_sp0_ep15_tp2_pp3 [label="Expert L12 SP0 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep15_pp3 -> layer_12_expert_sp0_ep15_tp2_pp3
	layer_12_expert_out_sp0_ep15_tp2_pp3 [label="Expert Out L12 SP0 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep15_tp2_pp3 -> layer_12_expert_out_sp0_ep15_tp2_pp3
	layer_12_expert_sp0_ep15_tp3_pp3 [label="Expert L12 SP0 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp0_ep15_pp3 -> layer_12_expert_sp0_ep15_tp3_pp3
	layer_12_expert_out_sp0_ep15_tp3_pp3 [label="Expert Out L12 SP0 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp0_ep15_tp3_pp3 -> layer_12_expert_out_sp0_ep15_tp3_pp3
	layer_12_expert_ar_sp0_ep15_pp3 [label="Expert All-Reduce L12 SP0 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp0_ep15_tp0_pp3 -> layer_12_expert_ar_sp0_ep15_pp3
	layer_12_expert_out_sp0_ep15_tp1_pp3 -> layer_12_expert_ar_sp0_ep15_pp3
	layer_12_expert_out_sp0_ep15_tp2_pp3 -> layer_12_expert_ar_sp0_ep15_pp3
	layer_12_expert_out_sp0_ep15_tp3_pp3 -> layer_12_expert_ar_sp0_ep15_pp3
	layer_12_combine_sp0_ep15_pp3 [label="Token Combine L12 SP0 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp0_ep15_pp3 -> layer_12_combine_sp0_ep15_pp3
	layer_12_moe_all2all_sp0_pp3 [label="MoE All-to-All L12 SP0\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_12_combine_sp0_ep0_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep1_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep2_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep3_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep4_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep5_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep6_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep7_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep8_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep9_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep10_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep11_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep12_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep13_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep14_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_combine_sp0_ep15_pp3 -> layer_12_moe_all2all_sp0_pp3
	layer_12_mlp_out_sp0_pp3 [label="MoE Output L12 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_moe_all2all_sp0_pp3 -> layer_12_mlp_out_sp0_pp3
	layer_12_mlp_res_sp0_pp3 [label="MLP Residual L12 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_mlp_out_sp0_pp3 -> layer_12_mlp_res_sp0_pp3
	layer_12_attn_res_sp0_pp3 -> layer_12_mlp_res_sp0_pp3 [style=dashed]
	layer_12_norm_sp1_pp3 [label="LayerNorm L12 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_mlp_out_sp0_pp2 -> layer_12_norm_sp1_pp3 [style=dashed]
	layer_11_mlp_out_sp1_pp2 -> layer_12_norm_sp1_pp3 [style=dashed]
	layer_11_mlp_out_sp2_pp2 -> layer_12_norm_sp1_pp3 [style=dashed]
	layer_11_mlp_out_sp3_pp2 -> layer_12_norm_sp1_pp3 [style=dashed]
	layer_12_qkv_sp1_tp0_pp3 [label="QKV Proj L12 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp1_pp3 -> layer_12_qkv_sp1_tp0_pp3
	layer_12_attn_sp1_tp0_pp3 [label="Attention L12 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp1_tp0_pp3 -> layer_12_attn_sp1_tp0_pp3
	layer_12_attn_out_sp1_tp0_pp3 [label="Attn Out Proj L12 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp1_tp0_pp3 -> layer_12_attn_out_sp1_tp0_pp3
	layer_12_qkv_sp1_tp1_pp3 [label="QKV Proj L12 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp1_pp3 -> layer_12_qkv_sp1_tp1_pp3
	layer_12_attn_sp1_tp1_pp3 [label="Attention L12 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp1_tp1_pp3 -> layer_12_attn_sp1_tp1_pp3
	layer_12_attn_out_sp1_tp1_pp3 [label="Attn Out Proj L12 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp1_tp1_pp3 -> layer_12_attn_out_sp1_tp1_pp3
	layer_12_qkv_sp1_tp2_pp3 [label="QKV Proj L12 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp1_pp3 -> layer_12_qkv_sp1_tp2_pp3
	layer_12_attn_sp1_tp2_pp3 [label="Attention L12 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp1_tp2_pp3 -> layer_12_attn_sp1_tp2_pp3
	layer_12_attn_out_sp1_tp2_pp3 [label="Attn Out Proj L12 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp1_tp2_pp3 -> layer_12_attn_out_sp1_tp2_pp3
	layer_12_qkv_sp1_tp3_pp3 [label="QKV Proj L12 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp1_pp3 -> layer_12_qkv_sp1_tp3_pp3
	layer_12_attn_sp1_tp3_pp3 [label="Attention L12 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp1_tp3_pp3 -> layer_12_attn_sp1_tp3_pp3
	layer_12_attn_out_sp1_tp3_pp3 [label="Attn Out Proj L12 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp1_tp3_pp3 -> layer_12_attn_out_sp1_tp3_pp3
	layer_12_attn_ar_sp1_pp3 [label="Attention All-Reduce L12 SP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_attn_out_sp1_tp0_pp3 -> layer_12_attn_ar_sp1_pp3
	layer_12_attn_out_sp1_tp1_pp3 -> layer_12_attn_ar_sp1_pp3
	layer_12_attn_out_sp1_tp2_pp3 -> layer_12_attn_ar_sp1_pp3
	layer_12_attn_out_sp1_tp3_pp3 -> layer_12_attn_ar_sp1_pp3
	layer_12_attn_res_sp1_pp3 [label="Attention Residual L12 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_attn_ar_sp1_pp3 -> layer_12_attn_res_sp1_pp3
	layer_12_norm_sp1_pp3 -> layer_12_attn_res_sp1_pp3 [style=dashed]
	layer_12_post_norm_sp1_pp3 [label="Post-Attn Norm L12 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_attn_res_sp1_pp3 -> layer_12_post_norm_sp1_pp3
	layer_12_router_sp1_pp3 [label="MoE Router L12 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_12_post_norm_sp1_pp3 -> layer_12_router_sp1_pp3
	layer_12_dispatch_sp1_ep0_pp3 [label="Token Dispatch L12 SP1 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep0_pp3 [style=dashed]
	layer_12_expert_sp1_ep0_tp0_pp3 [label="Expert L12 SP1 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep0_pp3 -> layer_12_expert_sp1_ep0_tp0_pp3
	layer_12_expert_out_sp1_ep0_tp0_pp3 [label="Expert Out L12 SP1 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep0_tp0_pp3 -> layer_12_expert_out_sp1_ep0_tp0_pp3
	layer_12_expert_sp1_ep0_tp1_pp3 [label="Expert L12 SP1 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep0_pp3 -> layer_12_expert_sp1_ep0_tp1_pp3
	layer_12_expert_out_sp1_ep0_tp1_pp3 [label="Expert Out L12 SP1 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep0_tp1_pp3 -> layer_12_expert_out_sp1_ep0_tp1_pp3
	layer_12_expert_sp1_ep0_tp2_pp3 [label="Expert L12 SP1 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep0_pp3 -> layer_12_expert_sp1_ep0_tp2_pp3
	layer_12_expert_out_sp1_ep0_tp2_pp3 [label="Expert Out L12 SP1 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep0_tp2_pp3 -> layer_12_expert_out_sp1_ep0_tp2_pp3
	layer_12_expert_sp1_ep0_tp3_pp3 [label="Expert L12 SP1 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep0_pp3 -> layer_12_expert_sp1_ep0_tp3_pp3
	layer_12_expert_out_sp1_ep0_tp3_pp3 [label="Expert Out L12 SP1 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep0_tp3_pp3 -> layer_12_expert_out_sp1_ep0_tp3_pp3
	layer_12_expert_ar_sp1_ep0_pp3 [label="Expert All-Reduce L12 SP1 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep0_tp0_pp3 -> layer_12_expert_ar_sp1_ep0_pp3
	layer_12_expert_out_sp1_ep0_tp1_pp3 -> layer_12_expert_ar_sp1_ep0_pp3
	layer_12_expert_out_sp1_ep0_tp2_pp3 -> layer_12_expert_ar_sp1_ep0_pp3
	layer_12_expert_out_sp1_ep0_tp3_pp3 -> layer_12_expert_ar_sp1_ep0_pp3
	layer_12_combine_sp1_ep0_pp3 [label="Token Combine L12 SP1 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep0_pp3 -> layer_12_combine_sp1_ep0_pp3
	layer_12_dispatch_sp1_ep1_pp3 [label="Token Dispatch L12 SP1 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep1_pp3 [style=dashed]
	layer_12_expert_sp1_ep1_tp0_pp3 [label="Expert L12 SP1 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep1_pp3 -> layer_12_expert_sp1_ep1_tp0_pp3
	layer_12_expert_out_sp1_ep1_tp0_pp3 [label="Expert Out L12 SP1 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep1_tp0_pp3 -> layer_12_expert_out_sp1_ep1_tp0_pp3
	layer_12_expert_sp1_ep1_tp1_pp3 [label="Expert L12 SP1 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep1_pp3 -> layer_12_expert_sp1_ep1_tp1_pp3
	layer_12_expert_out_sp1_ep1_tp1_pp3 [label="Expert Out L12 SP1 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep1_tp1_pp3 -> layer_12_expert_out_sp1_ep1_tp1_pp3
	layer_12_expert_sp1_ep1_tp2_pp3 [label="Expert L12 SP1 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep1_pp3 -> layer_12_expert_sp1_ep1_tp2_pp3
	layer_12_expert_out_sp1_ep1_tp2_pp3 [label="Expert Out L12 SP1 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep1_tp2_pp3 -> layer_12_expert_out_sp1_ep1_tp2_pp3
	layer_12_expert_sp1_ep1_tp3_pp3 [label="Expert L12 SP1 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep1_pp3 -> layer_12_expert_sp1_ep1_tp3_pp3
	layer_12_expert_out_sp1_ep1_tp3_pp3 [label="Expert Out L12 SP1 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep1_tp3_pp3 -> layer_12_expert_out_sp1_ep1_tp3_pp3
	layer_12_expert_ar_sp1_ep1_pp3 [label="Expert All-Reduce L12 SP1 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep1_tp0_pp3 -> layer_12_expert_ar_sp1_ep1_pp3
	layer_12_expert_out_sp1_ep1_tp1_pp3 -> layer_12_expert_ar_sp1_ep1_pp3
	layer_12_expert_out_sp1_ep1_tp2_pp3 -> layer_12_expert_ar_sp1_ep1_pp3
	layer_12_expert_out_sp1_ep1_tp3_pp3 -> layer_12_expert_ar_sp1_ep1_pp3
	layer_12_combine_sp1_ep1_pp3 [label="Token Combine L12 SP1 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep1_pp3 -> layer_12_combine_sp1_ep1_pp3
	layer_12_dispatch_sp1_ep2_pp3 [label="Token Dispatch L12 SP1 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep2_pp3 [style=dashed]
	layer_12_expert_sp1_ep2_tp0_pp3 [label="Expert L12 SP1 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep2_pp3 -> layer_12_expert_sp1_ep2_tp0_pp3
	layer_12_expert_out_sp1_ep2_tp0_pp3 [label="Expert Out L12 SP1 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep2_tp0_pp3 -> layer_12_expert_out_sp1_ep2_tp0_pp3
	layer_12_expert_sp1_ep2_tp1_pp3 [label="Expert L12 SP1 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep2_pp3 -> layer_12_expert_sp1_ep2_tp1_pp3
	layer_12_expert_out_sp1_ep2_tp1_pp3 [label="Expert Out L12 SP1 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep2_tp1_pp3 -> layer_12_expert_out_sp1_ep2_tp1_pp3
	layer_12_expert_sp1_ep2_tp2_pp3 [label="Expert L12 SP1 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep2_pp3 -> layer_12_expert_sp1_ep2_tp2_pp3
	layer_12_expert_out_sp1_ep2_tp2_pp3 [label="Expert Out L12 SP1 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep2_tp2_pp3 -> layer_12_expert_out_sp1_ep2_tp2_pp3
	layer_12_expert_sp1_ep2_tp3_pp3 [label="Expert L12 SP1 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep2_pp3 -> layer_12_expert_sp1_ep2_tp3_pp3
	layer_12_expert_out_sp1_ep2_tp3_pp3 [label="Expert Out L12 SP1 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep2_tp3_pp3 -> layer_12_expert_out_sp1_ep2_tp3_pp3
	layer_12_expert_ar_sp1_ep2_pp3 [label="Expert All-Reduce L12 SP1 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep2_tp0_pp3 -> layer_12_expert_ar_sp1_ep2_pp3
	layer_12_expert_out_sp1_ep2_tp1_pp3 -> layer_12_expert_ar_sp1_ep2_pp3
	layer_12_expert_out_sp1_ep2_tp2_pp3 -> layer_12_expert_ar_sp1_ep2_pp3
	layer_12_expert_out_sp1_ep2_tp3_pp3 -> layer_12_expert_ar_sp1_ep2_pp3
	layer_12_combine_sp1_ep2_pp3 [label="Token Combine L12 SP1 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep2_pp3 -> layer_12_combine_sp1_ep2_pp3
	layer_12_dispatch_sp1_ep3_pp3 [label="Token Dispatch L12 SP1 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep3_pp3 [style=dashed]
	layer_12_expert_sp1_ep3_tp0_pp3 [label="Expert L12 SP1 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep3_pp3 -> layer_12_expert_sp1_ep3_tp0_pp3
	layer_12_expert_out_sp1_ep3_tp0_pp3 [label="Expert Out L12 SP1 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep3_tp0_pp3 -> layer_12_expert_out_sp1_ep3_tp0_pp3
	layer_12_expert_sp1_ep3_tp1_pp3 [label="Expert L12 SP1 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep3_pp3 -> layer_12_expert_sp1_ep3_tp1_pp3
	layer_12_expert_out_sp1_ep3_tp1_pp3 [label="Expert Out L12 SP1 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep3_tp1_pp3 -> layer_12_expert_out_sp1_ep3_tp1_pp3
	layer_12_expert_sp1_ep3_tp2_pp3 [label="Expert L12 SP1 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep3_pp3 -> layer_12_expert_sp1_ep3_tp2_pp3
	layer_12_expert_out_sp1_ep3_tp2_pp3 [label="Expert Out L12 SP1 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep3_tp2_pp3 -> layer_12_expert_out_sp1_ep3_tp2_pp3
	layer_12_expert_sp1_ep3_tp3_pp3 [label="Expert L12 SP1 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep3_pp3 -> layer_12_expert_sp1_ep3_tp3_pp3
	layer_12_expert_out_sp1_ep3_tp3_pp3 [label="Expert Out L12 SP1 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep3_tp3_pp3 -> layer_12_expert_out_sp1_ep3_tp3_pp3
	layer_12_expert_ar_sp1_ep3_pp3 [label="Expert All-Reduce L12 SP1 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep3_tp0_pp3 -> layer_12_expert_ar_sp1_ep3_pp3
	layer_12_expert_out_sp1_ep3_tp1_pp3 -> layer_12_expert_ar_sp1_ep3_pp3
	layer_12_expert_out_sp1_ep3_tp2_pp3 -> layer_12_expert_ar_sp1_ep3_pp3
	layer_12_expert_out_sp1_ep3_tp3_pp3 -> layer_12_expert_ar_sp1_ep3_pp3
	layer_12_combine_sp1_ep3_pp3 [label="Token Combine L12 SP1 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep3_pp3 -> layer_12_combine_sp1_ep3_pp3
	layer_12_dispatch_sp1_ep4_pp3 [label="Token Dispatch L12 SP1 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep4_pp3 [style=dashed]
	layer_12_expert_sp1_ep4_tp0_pp3 [label="Expert L12 SP1 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep4_pp3 -> layer_12_expert_sp1_ep4_tp0_pp3
	layer_12_expert_out_sp1_ep4_tp0_pp3 [label="Expert Out L12 SP1 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep4_tp0_pp3 -> layer_12_expert_out_sp1_ep4_tp0_pp3
	layer_12_expert_sp1_ep4_tp1_pp3 [label="Expert L12 SP1 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep4_pp3 -> layer_12_expert_sp1_ep4_tp1_pp3
	layer_12_expert_out_sp1_ep4_tp1_pp3 [label="Expert Out L12 SP1 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep4_tp1_pp3 -> layer_12_expert_out_sp1_ep4_tp1_pp3
	layer_12_expert_sp1_ep4_tp2_pp3 [label="Expert L12 SP1 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep4_pp3 -> layer_12_expert_sp1_ep4_tp2_pp3
	layer_12_expert_out_sp1_ep4_tp2_pp3 [label="Expert Out L12 SP1 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep4_tp2_pp3 -> layer_12_expert_out_sp1_ep4_tp2_pp3
	layer_12_expert_sp1_ep4_tp3_pp3 [label="Expert L12 SP1 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep4_pp3 -> layer_12_expert_sp1_ep4_tp3_pp3
	layer_12_expert_out_sp1_ep4_tp3_pp3 [label="Expert Out L12 SP1 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep4_tp3_pp3 -> layer_12_expert_out_sp1_ep4_tp3_pp3
	layer_12_expert_ar_sp1_ep4_pp3 [label="Expert All-Reduce L12 SP1 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep4_tp0_pp3 -> layer_12_expert_ar_sp1_ep4_pp3
	layer_12_expert_out_sp1_ep4_tp1_pp3 -> layer_12_expert_ar_sp1_ep4_pp3
	layer_12_expert_out_sp1_ep4_tp2_pp3 -> layer_12_expert_ar_sp1_ep4_pp3
	layer_12_expert_out_sp1_ep4_tp3_pp3 -> layer_12_expert_ar_sp1_ep4_pp3
	layer_12_combine_sp1_ep4_pp3 [label="Token Combine L12 SP1 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep4_pp3 -> layer_12_combine_sp1_ep4_pp3
	layer_12_dispatch_sp1_ep5_pp3 [label="Token Dispatch L12 SP1 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep5_pp3 [style=dashed]
	layer_12_expert_sp1_ep5_tp0_pp3 [label="Expert L12 SP1 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep5_pp3 -> layer_12_expert_sp1_ep5_tp0_pp3
	layer_12_expert_out_sp1_ep5_tp0_pp3 [label="Expert Out L12 SP1 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep5_tp0_pp3 -> layer_12_expert_out_sp1_ep5_tp0_pp3
	layer_12_expert_sp1_ep5_tp1_pp3 [label="Expert L12 SP1 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep5_pp3 -> layer_12_expert_sp1_ep5_tp1_pp3
	layer_12_expert_out_sp1_ep5_tp1_pp3 [label="Expert Out L12 SP1 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep5_tp1_pp3 -> layer_12_expert_out_sp1_ep5_tp1_pp3
	layer_12_expert_sp1_ep5_tp2_pp3 [label="Expert L12 SP1 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep5_pp3 -> layer_12_expert_sp1_ep5_tp2_pp3
	layer_12_expert_out_sp1_ep5_tp2_pp3 [label="Expert Out L12 SP1 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep5_tp2_pp3 -> layer_12_expert_out_sp1_ep5_tp2_pp3
	layer_12_expert_sp1_ep5_tp3_pp3 [label="Expert L12 SP1 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep5_pp3 -> layer_12_expert_sp1_ep5_tp3_pp3
	layer_12_expert_out_sp1_ep5_tp3_pp3 [label="Expert Out L12 SP1 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep5_tp3_pp3 -> layer_12_expert_out_sp1_ep5_tp3_pp3
	layer_12_expert_ar_sp1_ep5_pp3 [label="Expert All-Reduce L12 SP1 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep5_tp0_pp3 -> layer_12_expert_ar_sp1_ep5_pp3
	layer_12_expert_out_sp1_ep5_tp1_pp3 -> layer_12_expert_ar_sp1_ep5_pp3
	layer_12_expert_out_sp1_ep5_tp2_pp3 -> layer_12_expert_ar_sp1_ep5_pp3
	layer_12_expert_out_sp1_ep5_tp3_pp3 -> layer_12_expert_ar_sp1_ep5_pp3
	layer_12_combine_sp1_ep5_pp3 [label="Token Combine L12 SP1 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep5_pp3 -> layer_12_combine_sp1_ep5_pp3
	layer_12_dispatch_sp1_ep6_pp3 [label="Token Dispatch L12 SP1 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep6_pp3 [style=dashed]
	layer_12_expert_sp1_ep6_tp0_pp3 [label="Expert L12 SP1 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep6_pp3 -> layer_12_expert_sp1_ep6_tp0_pp3
	layer_12_expert_out_sp1_ep6_tp0_pp3 [label="Expert Out L12 SP1 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep6_tp0_pp3 -> layer_12_expert_out_sp1_ep6_tp0_pp3
	layer_12_expert_sp1_ep6_tp1_pp3 [label="Expert L12 SP1 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep6_pp3 -> layer_12_expert_sp1_ep6_tp1_pp3
	layer_12_expert_out_sp1_ep6_tp1_pp3 [label="Expert Out L12 SP1 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep6_tp1_pp3 -> layer_12_expert_out_sp1_ep6_tp1_pp3
	layer_12_expert_sp1_ep6_tp2_pp3 [label="Expert L12 SP1 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep6_pp3 -> layer_12_expert_sp1_ep6_tp2_pp3
	layer_12_expert_out_sp1_ep6_tp2_pp3 [label="Expert Out L12 SP1 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep6_tp2_pp3 -> layer_12_expert_out_sp1_ep6_tp2_pp3
	layer_12_expert_sp1_ep6_tp3_pp3 [label="Expert L12 SP1 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep6_pp3 -> layer_12_expert_sp1_ep6_tp3_pp3
	layer_12_expert_out_sp1_ep6_tp3_pp3 [label="Expert Out L12 SP1 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep6_tp3_pp3 -> layer_12_expert_out_sp1_ep6_tp3_pp3
	layer_12_expert_ar_sp1_ep6_pp3 [label="Expert All-Reduce L12 SP1 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep6_tp0_pp3 -> layer_12_expert_ar_sp1_ep6_pp3
	layer_12_expert_out_sp1_ep6_tp1_pp3 -> layer_12_expert_ar_sp1_ep6_pp3
	layer_12_expert_out_sp1_ep6_tp2_pp3 -> layer_12_expert_ar_sp1_ep6_pp3
	layer_12_expert_out_sp1_ep6_tp3_pp3 -> layer_12_expert_ar_sp1_ep6_pp3
	layer_12_combine_sp1_ep6_pp3 [label="Token Combine L12 SP1 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep6_pp3 -> layer_12_combine_sp1_ep6_pp3
	layer_12_dispatch_sp1_ep7_pp3 [label="Token Dispatch L12 SP1 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep7_pp3 [style=dashed]
	layer_12_expert_sp1_ep7_tp0_pp3 [label="Expert L12 SP1 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep7_pp3 -> layer_12_expert_sp1_ep7_tp0_pp3
	layer_12_expert_out_sp1_ep7_tp0_pp3 [label="Expert Out L12 SP1 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep7_tp0_pp3 -> layer_12_expert_out_sp1_ep7_tp0_pp3
	layer_12_expert_sp1_ep7_tp1_pp3 [label="Expert L12 SP1 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep7_pp3 -> layer_12_expert_sp1_ep7_tp1_pp3
	layer_12_expert_out_sp1_ep7_tp1_pp3 [label="Expert Out L12 SP1 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep7_tp1_pp3 -> layer_12_expert_out_sp1_ep7_tp1_pp3
	layer_12_expert_sp1_ep7_tp2_pp3 [label="Expert L12 SP1 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep7_pp3 -> layer_12_expert_sp1_ep7_tp2_pp3
	layer_12_expert_out_sp1_ep7_tp2_pp3 [label="Expert Out L12 SP1 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep7_tp2_pp3 -> layer_12_expert_out_sp1_ep7_tp2_pp3
	layer_12_expert_sp1_ep7_tp3_pp3 [label="Expert L12 SP1 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep7_pp3 -> layer_12_expert_sp1_ep7_tp3_pp3
	layer_12_expert_out_sp1_ep7_tp3_pp3 [label="Expert Out L12 SP1 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep7_tp3_pp3 -> layer_12_expert_out_sp1_ep7_tp3_pp3
	layer_12_expert_ar_sp1_ep7_pp3 [label="Expert All-Reduce L12 SP1 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep7_tp0_pp3 -> layer_12_expert_ar_sp1_ep7_pp3
	layer_12_expert_out_sp1_ep7_tp1_pp3 -> layer_12_expert_ar_sp1_ep7_pp3
	layer_12_expert_out_sp1_ep7_tp2_pp3 -> layer_12_expert_ar_sp1_ep7_pp3
	layer_12_expert_out_sp1_ep7_tp3_pp3 -> layer_12_expert_ar_sp1_ep7_pp3
	layer_12_combine_sp1_ep7_pp3 [label="Token Combine L12 SP1 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep7_pp3 -> layer_12_combine_sp1_ep7_pp3
	layer_12_dispatch_sp1_ep8_pp3 [label="Token Dispatch L12 SP1 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep8_pp3 [style=dashed]
	layer_12_expert_sp1_ep8_tp0_pp3 [label="Expert L12 SP1 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep8_pp3 -> layer_12_expert_sp1_ep8_tp0_pp3
	layer_12_expert_out_sp1_ep8_tp0_pp3 [label="Expert Out L12 SP1 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep8_tp0_pp3 -> layer_12_expert_out_sp1_ep8_tp0_pp3
	layer_12_expert_sp1_ep8_tp1_pp3 [label="Expert L12 SP1 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep8_pp3 -> layer_12_expert_sp1_ep8_tp1_pp3
	layer_12_expert_out_sp1_ep8_tp1_pp3 [label="Expert Out L12 SP1 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep8_tp1_pp3 -> layer_12_expert_out_sp1_ep8_tp1_pp3
	layer_12_expert_sp1_ep8_tp2_pp3 [label="Expert L12 SP1 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep8_pp3 -> layer_12_expert_sp1_ep8_tp2_pp3
	layer_12_expert_out_sp1_ep8_tp2_pp3 [label="Expert Out L12 SP1 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep8_tp2_pp3 -> layer_12_expert_out_sp1_ep8_tp2_pp3
	layer_12_expert_sp1_ep8_tp3_pp3 [label="Expert L12 SP1 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep8_pp3 -> layer_12_expert_sp1_ep8_tp3_pp3
	layer_12_expert_out_sp1_ep8_tp3_pp3 [label="Expert Out L12 SP1 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep8_tp3_pp3 -> layer_12_expert_out_sp1_ep8_tp3_pp3
	layer_12_expert_ar_sp1_ep8_pp3 [label="Expert All-Reduce L12 SP1 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep8_tp0_pp3 -> layer_12_expert_ar_sp1_ep8_pp3
	layer_12_expert_out_sp1_ep8_tp1_pp3 -> layer_12_expert_ar_sp1_ep8_pp3
	layer_12_expert_out_sp1_ep8_tp2_pp3 -> layer_12_expert_ar_sp1_ep8_pp3
	layer_12_expert_out_sp1_ep8_tp3_pp3 -> layer_12_expert_ar_sp1_ep8_pp3
	layer_12_combine_sp1_ep8_pp3 [label="Token Combine L12 SP1 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep8_pp3 -> layer_12_combine_sp1_ep8_pp3
	layer_12_dispatch_sp1_ep9_pp3 [label="Token Dispatch L12 SP1 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep9_pp3 [style=dashed]
	layer_12_expert_sp1_ep9_tp0_pp3 [label="Expert L12 SP1 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep9_pp3 -> layer_12_expert_sp1_ep9_tp0_pp3
	layer_12_expert_out_sp1_ep9_tp0_pp3 [label="Expert Out L12 SP1 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep9_tp0_pp3 -> layer_12_expert_out_sp1_ep9_tp0_pp3
	layer_12_expert_sp1_ep9_tp1_pp3 [label="Expert L12 SP1 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep9_pp3 -> layer_12_expert_sp1_ep9_tp1_pp3
	layer_12_expert_out_sp1_ep9_tp1_pp3 [label="Expert Out L12 SP1 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep9_tp1_pp3 -> layer_12_expert_out_sp1_ep9_tp1_pp3
	layer_12_expert_sp1_ep9_tp2_pp3 [label="Expert L12 SP1 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep9_pp3 -> layer_12_expert_sp1_ep9_tp2_pp3
	layer_12_expert_out_sp1_ep9_tp2_pp3 [label="Expert Out L12 SP1 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep9_tp2_pp3 -> layer_12_expert_out_sp1_ep9_tp2_pp3
	layer_12_expert_sp1_ep9_tp3_pp3 [label="Expert L12 SP1 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep9_pp3 -> layer_12_expert_sp1_ep9_tp3_pp3
	layer_12_expert_out_sp1_ep9_tp3_pp3 [label="Expert Out L12 SP1 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep9_tp3_pp3 -> layer_12_expert_out_sp1_ep9_tp3_pp3
	layer_12_expert_ar_sp1_ep9_pp3 [label="Expert All-Reduce L12 SP1 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep9_tp0_pp3 -> layer_12_expert_ar_sp1_ep9_pp3
	layer_12_expert_out_sp1_ep9_tp1_pp3 -> layer_12_expert_ar_sp1_ep9_pp3
	layer_12_expert_out_sp1_ep9_tp2_pp3 -> layer_12_expert_ar_sp1_ep9_pp3
	layer_12_expert_out_sp1_ep9_tp3_pp3 -> layer_12_expert_ar_sp1_ep9_pp3
	layer_12_combine_sp1_ep9_pp3 [label="Token Combine L12 SP1 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep9_pp3 -> layer_12_combine_sp1_ep9_pp3
	layer_12_dispatch_sp1_ep10_pp3 [label="Token Dispatch L12 SP1 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep10_pp3 [style=dashed]
	layer_12_expert_sp1_ep10_tp0_pp3 [label="Expert L12 SP1 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep10_pp3 -> layer_12_expert_sp1_ep10_tp0_pp3
	layer_12_expert_out_sp1_ep10_tp0_pp3 [label="Expert Out L12 SP1 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep10_tp0_pp3 -> layer_12_expert_out_sp1_ep10_tp0_pp3
	layer_12_expert_sp1_ep10_tp1_pp3 [label="Expert L12 SP1 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep10_pp3 -> layer_12_expert_sp1_ep10_tp1_pp3
	layer_12_expert_out_sp1_ep10_tp1_pp3 [label="Expert Out L12 SP1 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep10_tp1_pp3 -> layer_12_expert_out_sp1_ep10_tp1_pp3
	layer_12_expert_sp1_ep10_tp2_pp3 [label="Expert L12 SP1 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep10_pp3 -> layer_12_expert_sp1_ep10_tp2_pp3
	layer_12_expert_out_sp1_ep10_tp2_pp3 [label="Expert Out L12 SP1 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep10_tp2_pp3 -> layer_12_expert_out_sp1_ep10_tp2_pp3
	layer_12_expert_sp1_ep10_tp3_pp3 [label="Expert L12 SP1 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep10_pp3 -> layer_12_expert_sp1_ep10_tp3_pp3
	layer_12_expert_out_sp1_ep10_tp3_pp3 [label="Expert Out L12 SP1 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep10_tp3_pp3 -> layer_12_expert_out_sp1_ep10_tp3_pp3
	layer_12_expert_ar_sp1_ep10_pp3 [label="Expert All-Reduce L12 SP1 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep10_tp0_pp3 -> layer_12_expert_ar_sp1_ep10_pp3
	layer_12_expert_out_sp1_ep10_tp1_pp3 -> layer_12_expert_ar_sp1_ep10_pp3
	layer_12_expert_out_sp1_ep10_tp2_pp3 -> layer_12_expert_ar_sp1_ep10_pp3
	layer_12_expert_out_sp1_ep10_tp3_pp3 -> layer_12_expert_ar_sp1_ep10_pp3
	layer_12_combine_sp1_ep10_pp3 [label="Token Combine L12 SP1 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep10_pp3 -> layer_12_combine_sp1_ep10_pp3
	layer_12_dispatch_sp1_ep11_pp3 [label="Token Dispatch L12 SP1 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep11_pp3 [style=dashed]
	layer_12_expert_sp1_ep11_tp0_pp3 [label="Expert L12 SP1 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep11_pp3 -> layer_12_expert_sp1_ep11_tp0_pp3
	layer_12_expert_out_sp1_ep11_tp0_pp3 [label="Expert Out L12 SP1 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep11_tp0_pp3 -> layer_12_expert_out_sp1_ep11_tp0_pp3
	layer_12_expert_sp1_ep11_tp1_pp3 [label="Expert L12 SP1 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep11_pp3 -> layer_12_expert_sp1_ep11_tp1_pp3
	layer_12_expert_out_sp1_ep11_tp1_pp3 [label="Expert Out L12 SP1 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep11_tp1_pp3 -> layer_12_expert_out_sp1_ep11_tp1_pp3
	layer_12_expert_sp1_ep11_tp2_pp3 [label="Expert L12 SP1 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep11_pp3 -> layer_12_expert_sp1_ep11_tp2_pp3
	layer_12_expert_out_sp1_ep11_tp2_pp3 [label="Expert Out L12 SP1 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep11_tp2_pp3 -> layer_12_expert_out_sp1_ep11_tp2_pp3
	layer_12_expert_sp1_ep11_tp3_pp3 [label="Expert L12 SP1 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep11_pp3 -> layer_12_expert_sp1_ep11_tp3_pp3
	layer_12_expert_out_sp1_ep11_tp3_pp3 [label="Expert Out L12 SP1 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep11_tp3_pp3 -> layer_12_expert_out_sp1_ep11_tp3_pp3
	layer_12_expert_ar_sp1_ep11_pp3 [label="Expert All-Reduce L12 SP1 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep11_tp0_pp3 -> layer_12_expert_ar_sp1_ep11_pp3
	layer_12_expert_out_sp1_ep11_tp1_pp3 -> layer_12_expert_ar_sp1_ep11_pp3
	layer_12_expert_out_sp1_ep11_tp2_pp3 -> layer_12_expert_ar_sp1_ep11_pp3
	layer_12_expert_out_sp1_ep11_tp3_pp3 -> layer_12_expert_ar_sp1_ep11_pp3
	layer_12_combine_sp1_ep11_pp3 [label="Token Combine L12 SP1 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep11_pp3 -> layer_12_combine_sp1_ep11_pp3
	layer_12_dispatch_sp1_ep12_pp3 [label="Token Dispatch L12 SP1 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep12_pp3 [style=dashed]
	layer_12_expert_sp1_ep12_tp0_pp3 [label="Expert L12 SP1 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep12_pp3 -> layer_12_expert_sp1_ep12_tp0_pp3
	layer_12_expert_out_sp1_ep12_tp0_pp3 [label="Expert Out L12 SP1 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep12_tp0_pp3 -> layer_12_expert_out_sp1_ep12_tp0_pp3
	layer_12_expert_sp1_ep12_tp1_pp3 [label="Expert L12 SP1 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep12_pp3 -> layer_12_expert_sp1_ep12_tp1_pp3
	layer_12_expert_out_sp1_ep12_tp1_pp3 [label="Expert Out L12 SP1 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep12_tp1_pp3 -> layer_12_expert_out_sp1_ep12_tp1_pp3
	layer_12_expert_sp1_ep12_tp2_pp3 [label="Expert L12 SP1 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep12_pp3 -> layer_12_expert_sp1_ep12_tp2_pp3
	layer_12_expert_out_sp1_ep12_tp2_pp3 [label="Expert Out L12 SP1 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep12_tp2_pp3 -> layer_12_expert_out_sp1_ep12_tp2_pp3
	layer_12_expert_sp1_ep12_tp3_pp3 [label="Expert L12 SP1 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep12_pp3 -> layer_12_expert_sp1_ep12_tp3_pp3
	layer_12_expert_out_sp1_ep12_tp3_pp3 [label="Expert Out L12 SP1 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep12_tp3_pp3 -> layer_12_expert_out_sp1_ep12_tp3_pp3
	layer_12_expert_ar_sp1_ep12_pp3 [label="Expert All-Reduce L12 SP1 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep12_tp0_pp3 -> layer_12_expert_ar_sp1_ep12_pp3
	layer_12_expert_out_sp1_ep12_tp1_pp3 -> layer_12_expert_ar_sp1_ep12_pp3
	layer_12_expert_out_sp1_ep12_tp2_pp3 -> layer_12_expert_ar_sp1_ep12_pp3
	layer_12_expert_out_sp1_ep12_tp3_pp3 -> layer_12_expert_ar_sp1_ep12_pp3
	layer_12_combine_sp1_ep12_pp3 [label="Token Combine L12 SP1 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep12_pp3 -> layer_12_combine_sp1_ep12_pp3
	layer_12_dispatch_sp1_ep13_pp3 [label="Token Dispatch L12 SP1 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep13_pp3 [style=dashed]
	layer_12_expert_sp1_ep13_tp0_pp3 [label="Expert L12 SP1 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep13_pp3 -> layer_12_expert_sp1_ep13_tp0_pp3
	layer_12_expert_out_sp1_ep13_tp0_pp3 [label="Expert Out L12 SP1 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep13_tp0_pp3 -> layer_12_expert_out_sp1_ep13_tp0_pp3
	layer_12_expert_sp1_ep13_tp1_pp3 [label="Expert L12 SP1 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep13_pp3 -> layer_12_expert_sp1_ep13_tp1_pp3
	layer_12_expert_out_sp1_ep13_tp1_pp3 [label="Expert Out L12 SP1 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep13_tp1_pp3 -> layer_12_expert_out_sp1_ep13_tp1_pp3
	layer_12_expert_sp1_ep13_tp2_pp3 [label="Expert L12 SP1 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep13_pp3 -> layer_12_expert_sp1_ep13_tp2_pp3
	layer_12_expert_out_sp1_ep13_tp2_pp3 [label="Expert Out L12 SP1 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep13_tp2_pp3 -> layer_12_expert_out_sp1_ep13_tp2_pp3
	layer_12_expert_sp1_ep13_tp3_pp3 [label="Expert L12 SP1 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep13_pp3 -> layer_12_expert_sp1_ep13_tp3_pp3
	layer_12_expert_out_sp1_ep13_tp3_pp3 [label="Expert Out L12 SP1 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep13_tp3_pp3 -> layer_12_expert_out_sp1_ep13_tp3_pp3
	layer_12_expert_ar_sp1_ep13_pp3 [label="Expert All-Reduce L12 SP1 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep13_tp0_pp3 -> layer_12_expert_ar_sp1_ep13_pp3
	layer_12_expert_out_sp1_ep13_tp1_pp3 -> layer_12_expert_ar_sp1_ep13_pp3
	layer_12_expert_out_sp1_ep13_tp2_pp3 -> layer_12_expert_ar_sp1_ep13_pp3
	layer_12_expert_out_sp1_ep13_tp3_pp3 -> layer_12_expert_ar_sp1_ep13_pp3
	layer_12_combine_sp1_ep13_pp3 [label="Token Combine L12 SP1 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep13_pp3 -> layer_12_combine_sp1_ep13_pp3
	layer_12_dispatch_sp1_ep14_pp3 [label="Token Dispatch L12 SP1 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep14_pp3 [style=dashed]
	layer_12_expert_sp1_ep14_tp0_pp3 [label="Expert L12 SP1 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep14_pp3 -> layer_12_expert_sp1_ep14_tp0_pp3
	layer_12_expert_out_sp1_ep14_tp0_pp3 [label="Expert Out L12 SP1 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep14_tp0_pp3 -> layer_12_expert_out_sp1_ep14_tp0_pp3
	layer_12_expert_sp1_ep14_tp1_pp3 [label="Expert L12 SP1 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep14_pp3 -> layer_12_expert_sp1_ep14_tp1_pp3
	layer_12_expert_out_sp1_ep14_tp1_pp3 [label="Expert Out L12 SP1 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep14_tp1_pp3 -> layer_12_expert_out_sp1_ep14_tp1_pp3
	layer_12_expert_sp1_ep14_tp2_pp3 [label="Expert L12 SP1 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep14_pp3 -> layer_12_expert_sp1_ep14_tp2_pp3
	layer_12_expert_out_sp1_ep14_tp2_pp3 [label="Expert Out L12 SP1 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep14_tp2_pp3 -> layer_12_expert_out_sp1_ep14_tp2_pp3
	layer_12_expert_sp1_ep14_tp3_pp3 [label="Expert L12 SP1 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep14_pp3 -> layer_12_expert_sp1_ep14_tp3_pp3
	layer_12_expert_out_sp1_ep14_tp3_pp3 [label="Expert Out L12 SP1 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep14_tp3_pp3 -> layer_12_expert_out_sp1_ep14_tp3_pp3
	layer_12_expert_ar_sp1_ep14_pp3 [label="Expert All-Reduce L12 SP1 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep14_tp0_pp3 -> layer_12_expert_ar_sp1_ep14_pp3
	layer_12_expert_out_sp1_ep14_tp1_pp3 -> layer_12_expert_ar_sp1_ep14_pp3
	layer_12_expert_out_sp1_ep14_tp2_pp3 -> layer_12_expert_ar_sp1_ep14_pp3
	layer_12_expert_out_sp1_ep14_tp3_pp3 -> layer_12_expert_ar_sp1_ep14_pp3
	layer_12_combine_sp1_ep14_pp3 [label="Token Combine L12 SP1 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep14_pp3 -> layer_12_combine_sp1_ep14_pp3
	layer_12_dispatch_sp1_ep15_pp3 [label="Token Dispatch L12 SP1 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp1_pp3 -> layer_12_dispatch_sp1_ep15_pp3 [style=dashed]
	layer_12_expert_sp1_ep15_tp0_pp3 [label="Expert L12 SP1 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep15_pp3 -> layer_12_expert_sp1_ep15_tp0_pp3
	layer_12_expert_out_sp1_ep15_tp0_pp3 [label="Expert Out L12 SP1 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep15_tp0_pp3 -> layer_12_expert_out_sp1_ep15_tp0_pp3
	layer_12_expert_sp1_ep15_tp1_pp3 [label="Expert L12 SP1 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep15_pp3 -> layer_12_expert_sp1_ep15_tp1_pp3
	layer_12_expert_out_sp1_ep15_tp1_pp3 [label="Expert Out L12 SP1 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep15_tp1_pp3 -> layer_12_expert_out_sp1_ep15_tp1_pp3
	layer_12_expert_sp1_ep15_tp2_pp3 [label="Expert L12 SP1 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep15_pp3 -> layer_12_expert_sp1_ep15_tp2_pp3
	layer_12_expert_out_sp1_ep15_tp2_pp3 [label="Expert Out L12 SP1 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep15_tp2_pp3 -> layer_12_expert_out_sp1_ep15_tp2_pp3
	layer_12_expert_sp1_ep15_tp3_pp3 [label="Expert L12 SP1 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp1_ep15_pp3 -> layer_12_expert_sp1_ep15_tp3_pp3
	layer_12_expert_out_sp1_ep15_tp3_pp3 [label="Expert Out L12 SP1 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp1_ep15_tp3_pp3 -> layer_12_expert_out_sp1_ep15_tp3_pp3
	layer_12_expert_ar_sp1_ep15_pp3 [label="Expert All-Reduce L12 SP1 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp1_ep15_tp0_pp3 -> layer_12_expert_ar_sp1_ep15_pp3
	layer_12_expert_out_sp1_ep15_tp1_pp3 -> layer_12_expert_ar_sp1_ep15_pp3
	layer_12_expert_out_sp1_ep15_tp2_pp3 -> layer_12_expert_ar_sp1_ep15_pp3
	layer_12_expert_out_sp1_ep15_tp3_pp3 -> layer_12_expert_ar_sp1_ep15_pp3
	layer_12_combine_sp1_ep15_pp3 [label="Token Combine L12 SP1 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp1_ep15_pp3 -> layer_12_combine_sp1_ep15_pp3
	layer_12_moe_all2all_sp1_pp3 [label="MoE All-to-All L12 SP1\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_12_combine_sp1_ep0_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep1_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep2_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep3_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep4_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep5_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep6_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep7_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep8_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep9_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep10_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep11_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep12_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep13_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep14_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_combine_sp1_ep15_pp3 -> layer_12_moe_all2all_sp1_pp3
	layer_12_mlp_out_sp1_pp3 [label="MoE Output L12 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_moe_all2all_sp1_pp3 -> layer_12_mlp_out_sp1_pp3
	layer_12_mlp_res_sp1_pp3 [label="MLP Residual L12 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_mlp_out_sp1_pp3 -> layer_12_mlp_res_sp1_pp3
	layer_12_attn_res_sp1_pp3 -> layer_12_mlp_res_sp1_pp3 [style=dashed]
	layer_12_norm_sp2_pp3 [label="LayerNorm L12 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_mlp_out_sp0_pp2 -> layer_12_norm_sp2_pp3 [style=dashed]
	layer_11_mlp_out_sp1_pp2 -> layer_12_norm_sp2_pp3 [style=dashed]
	layer_11_mlp_out_sp2_pp2 -> layer_12_norm_sp2_pp3 [style=dashed]
	layer_11_mlp_out_sp3_pp2 -> layer_12_norm_sp2_pp3 [style=dashed]
	layer_12_qkv_sp2_tp0_pp3 [label="QKV Proj L12 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp2_pp3 -> layer_12_qkv_sp2_tp0_pp3
	layer_12_attn_sp2_tp0_pp3 [label="Attention L12 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp2_tp0_pp3 -> layer_12_attn_sp2_tp0_pp3
	layer_12_attn_out_sp2_tp0_pp3 [label="Attn Out Proj L12 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp2_tp0_pp3 -> layer_12_attn_out_sp2_tp0_pp3
	layer_12_qkv_sp2_tp1_pp3 [label="QKV Proj L12 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp2_pp3 -> layer_12_qkv_sp2_tp1_pp3
	layer_12_attn_sp2_tp1_pp3 [label="Attention L12 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp2_tp1_pp3 -> layer_12_attn_sp2_tp1_pp3
	layer_12_attn_out_sp2_tp1_pp3 [label="Attn Out Proj L12 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp2_tp1_pp3 -> layer_12_attn_out_sp2_tp1_pp3
	layer_12_qkv_sp2_tp2_pp3 [label="QKV Proj L12 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp2_pp3 -> layer_12_qkv_sp2_tp2_pp3
	layer_12_attn_sp2_tp2_pp3 [label="Attention L12 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp2_tp2_pp3 -> layer_12_attn_sp2_tp2_pp3
	layer_12_attn_out_sp2_tp2_pp3 [label="Attn Out Proj L12 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp2_tp2_pp3 -> layer_12_attn_out_sp2_tp2_pp3
	layer_12_qkv_sp2_tp3_pp3 [label="QKV Proj L12 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp2_pp3 -> layer_12_qkv_sp2_tp3_pp3
	layer_12_attn_sp2_tp3_pp3 [label="Attention L12 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp2_tp3_pp3 -> layer_12_attn_sp2_tp3_pp3
	layer_12_attn_out_sp2_tp3_pp3 [label="Attn Out Proj L12 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp2_tp3_pp3 -> layer_12_attn_out_sp2_tp3_pp3
	layer_12_attn_ar_sp2_pp3 [label="Attention All-Reduce L12 SP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_attn_out_sp2_tp0_pp3 -> layer_12_attn_ar_sp2_pp3
	layer_12_attn_out_sp2_tp1_pp3 -> layer_12_attn_ar_sp2_pp3
	layer_12_attn_out_sp2_tp2_pp3 -> layer_12_attn_ar_sp2_pp3
	layer_12_attn_out_sp2_tp3_pp3 -> layer_12_attn_ar_sp2_pp3
	layer_12_attn_res_sp2_pp3 [label="Attention Residual L12 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_attn_ar_sp2_pp3 -> layer_12_attn_res_sp2_pp3
	layer_12_norm_sp2_pp3 -> layer_12_attn_res_sp2_pp3 [style=dashed]
	layer_12_post_norm_sp2_pp3 [label="Post-Attn Norm L12 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_attn_res_sp2_pp3 -> layer_12_post_norm_sp2_pp3
	layer_12_router_sp2_pp3 [label="MoE Router L12 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_12_post_norm_sp2_pp3 -> layer_12_router_sp2_pp3
	layer_12_dispatch_sp2_ep0_pp3 [label="Token Dispatch L12 SP2 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep0_pp3 [style=dashed]
	layer_12_expert_sp2_ep0_tp0_pp3 [label="Expert L12 SP2 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep0_pp3 -> layer_12_expert_sp2_ep0_tp0_pp3
	layer_12_expert_out_sp2_ep0_tp0_pp3 [label="Expert Out L12 SP2 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep0_tp0_pp3 -> layer_12_expert_out_sp2_ep0_tp0_pp3
	layer_12_expert_sp2_ep0_tp1_pp3 [label="Expert L12 SP2 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep0_pp3 -> layer_12_expert_sp2_ep0_tp1_pp3
	layer_12_expert_out_sp2_ep0_tp1_pp3 [label="Expert Out L12 SP2 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep0_tp1_pp3 -> layer_12_expert_out_sp2_ep0_tp1_pp3
	layer_12_expert_sp2_ep0_tp2_pp3 [label="Expert L12 SP2 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep0_pp3 -> layer_12_expert_sp2_ep0_tp2_pp3
	layer_12_expert_out_sp2_ep0_tp2_pp3 [label="Expert Out L12 SP2 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep0_tp2_pp3 -> layer_12_expert_out_sp2_ep0_tp2_pp3
	layer_12_expert_sp2_ep0_tp3_pp3 [label="Expert L12 SP2 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep0_pp3 -> layer_12_expert_sp2_ep0_tp3_pp3
	layer_12_expert_out_sp2_ep0_tp3_pp3 [label="Expert Out L12 SP2 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep0_tp3_pp3 -> layer_12_expert_out_sp2_ep0_tp3_pp3
	layer_12_expert_ar_sp2_ep0_pp3 [label="Expert All-Reduce L12 SP2 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep0_tp0_pp3 -> layer_12_expert_ar_sp2_ep0_pp3
	layer_12_expert_out_sp2_ep0_tp1_pp3 -> layer_12_expert_ar_sp2_ep0_pp3
	layer_12_expert_out_sp2_ep0_tp2_pp3 -> layer_12_expert_ar_sp2_ep0_pp3
	layer_12_expert_out_sp2_ep0_tp3_pp3 -> layer_12_expert_ar_sp2_ep0_pp3
	layer_12_combine_sp2_ep0_pp3 [label="Token Combine L12 SP2 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep0_pp3 -> layer_12_combine_sp2_ep0_pp3
	layer_12_dispatch_sp2_ep1_pp3 [label="Token Dispatch L12 SP2 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep1_pp3 [style=dashed]
	layer_12_expert_sp2_ep1_tp0_pp3 [label="Expert L12 SP2 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep1_pp3 -> layer_12_expert_sp2_ep1_tp0_pp3
	layer_12_expert_out_sp2_ep1_tp0_pp3 [label="Expert Out L12 SP2 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep1_tp0_pp3 -> layer_12_expert_out_sp2_ep1_tp0_pp3
	layer_12_expert_sp2_ep1_tp1_pp3 [label="Expert L12 SP2 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep1_pp3 -> layer_12_expert_sp2_ep1_tp1_pp3
	layer_12_expert_out_sp2_ep1_tp1_pp3 [label="Expert Out L12 SP2 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep1_tp1_pp3 -> layer_12_expert_out_sp2_ep1_tp1_pp3
	layer_12_expert_sp2_ep1_tp2_pp3 [label="Expert L12 SP2 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep1_pp3 -> layer_12_expert_sp2_ep1_tp2_pp3
	layer_12_expert_out_sp2_ep1_tp2_pp3 [label="Expert Out L12 SP2 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep1_tp2_pp3 -> layer_12_expert_out_sp2_ep1_tp2_pp3
	layer_12_expert_sp2_ep1_tp3_pp3 [label="Expert L12 SP2 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep1_pp3 -> layer_12_expert_sp2_ep1_tp3_pp3
	layer_12_expert_out_sp2_ep1_tp3_pp3 [label="Expert Out L12 SP2 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep1_tp3_pp3 -> layer_12_expert_out_sp2_ep1_tp3_pp3
	layer_12_expert_ar_sp2_ep1_pp3 [label="Expert All-Reduce L12 SP2 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep1_tp0_pp3 -> layer_12_expert_ar_sp2_ep1_pp3
	layer_12_expert_out_sp2_ep1_tp1_pp3 -> layer_12_expert_ar_sp2_ep1_pp3
	layer_12_expert_out_sp2_ep1_tp2_pp3 -> layer_12_expert_ar_sp2_ep1_pp3
	layer_12_expert_out_sp2_ep1_tp3_pp3 -> layer_12_expert_ar_sp2_ep1_pp3
	layer_12_combine_sp2_ep1_pp3 [label="Token Combine L12 SP2 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep1_pp3 -> layer_12_combine_sp2_ep1_pp3
	layer_12_dispatch_sp2_ep2_pp3 [label="Token Dispatch L12 SP2 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep2_pp3 [style=dashed]
	layer_12_expert_sp2_ep2_tp0_pp3 [label="Expert L12 SP2 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep2_pp3 -> layer_12_expert_sp2_ep2_tp0_pp3
	layer_12_expert_out_sp2_ep2_tp0_pp3 [label="Expert Out L12 SP2 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep2_tp0_pp3 -> layer_12_expert_out_sp2_ep2_tp0_pp3
	layer_12_expert_sp2_ep2_tp1_pp3 [label="Expert L12 SP2 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep2_pp3 -> layer_12_expert_sp2_ep2_tp1_pp3
	layer_12_expert_out_sp2_ep2_tp1_pp3 [label="Expert Out L12 SP2 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep2_tp1_pp3 -> layer_12_expert_out_sp2_ep2_tp1_pp3
	layer_12_expert_sp2_ep2_tp2_pp3 [label="Expert L12 SP2 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep2_pp3 -> layer_12_expert_sp2_ep2_tp2_pp3
	layer_12_expert_out_sp2_ep2_tp2_pp3 [label="Expert Out L12 SP2 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep2_tp2_pp3 -> layer_12_expert_out_sp2_ep2_tp2_pp3
	layer_12_expert_sp2_ep2_tp3_pp3 [label="Expert L12 SP2 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep2_pp3 -> layer_12_expert_sp2_ep2_tp3_pp3
	layer_12_expert_out_sp2_ep2_tp3_pp3 [label="Expert Out L12 SP2 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep2_tp3_pp3 -> layer_12_expert_out_sp2_ep2_tp3_pp3
	layer_12_expert_ar_sp2_ep2_pp3 [label="Expert All-Reduce L12 SP2 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep2_tp0_pp3 -> layer_12_expert_ar_sp2_ep2_pp3
	layer_12_expert_out_sp2_ep2_tp1_pp3 -> layer_12_expert_ar_sp2_ep2_pp3
	layer_12_expert_out_sp2_ep2_tp2_pp3 -> layer_12_expert_ar_sp2_ep2_pp3
	layer_12_expert_out_sp2_ep2_tp3_pp3 -> layer_12_expert_ar_sp2_ep2_pp3
	layer_12_combine_sp2_ep2_pp3 [label="Token Combine L12 SP2 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep2_pp3 -> layer_12_combine_sp2_ep2_pp3
	layer_12_dispatch_sp2_ep3_pp3 [label="Token Dispatch L12 SP2 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep3_pp3 [style=dashed]
	layer_12_expert_sp2_ep3_tp0_pp3 [label="Expert L12 SP2 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep3_pp3 -> layer_12_expert_sp2_ep3_tp0_pp3
	layer_12_expert_out_sp2_ep3_tp0_pp3 [label="Expert Out L12 SP2 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep3_tp0_pp3 -> layer_12_expert_out_sp2_ep3_tp0_pp3
	layer_12_expert_sp2_ep3_tp1_pp3 [label="Expert L12 SP2 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep3_pp3 -> layer_12_expert_sp2_ep3_tp1_pp3
	layer_12_expert_out_sp2_ep3_tp1_pp3 [label="Expert Out L12 SP2 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep3_tp1_pp3 -> layer_12_expert_out_sp2_ep3_tp1_pp3
	layer_12_expert_sp2_ep3_tp2_pp3 [label="Expert L12 SP2 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep3_pp3 -> layer_12_expert_sp2_ep3_tp2_pp3
	layer_12_expert_out_sp2_ep3_tp2_pp3 [label="Expert Out L12 SP2 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep3_tp2_pp3 -> layer_12_expert_out_sp2_ep3_tp2_pp3
	layer_12_expert_sp2_ep3_tp3_pp3 [label="Expert L12 SP2 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep3_pp3 -> layer_12_expert_sp2_ep3_tp3_pp3
	layer_12_expert_out_sp2_ep3_tp3_pp3 [label="Expert Out L12 SP2 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep3_tp3_pp3 -> layer_12_expert_out_sp2_ep3_tp3_pp3
	layer_12_expert_ar_sp2_ep3_pp3 [label="Expert All-Reduce L12 SP2 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep3_tp0_pp3 -> layer_12_expert_ar_sp2_ep3_pp3
	layer_12_expert_out_sp2_ep3_tp1_pp3 -> layer_12_expert_ar_sp2_ep3_pp3
	layer_12_expert_out_sp2_ep3_tp2_pp3 -> layer_12_expert_ar_sp2_ep3_pp3
	layer_12_expert_out_sp2_ep3_tp3_pp3 -> layer_12_expert_ar_sp2_ep3_pp3
	layer_12_combine_sp2_ep3_pp3 [label="Token Combine L12 SP2 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep3_pp3 -> layer_12_combine_sp2_ep3_pp3
	layer_12_dispatch_sp2_ep4_pp3 [label="Token Dispatch L12 SP2 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep4_pp3 [style=dashed]
	layer_12_expert_sp2_ep4_tp0_pp3 [label="Expert L12 SP2 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep4_pp3 -> layer_12_expert_sp2_ep4_tp0_pp3
	layer_12_expert_out_sp2_ep4_tp0_pp3 [label="Expert Out L12 SP2 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep4_tp0_pp3 -> layer_12_expert_out_sp2_ep4_tp0_pp3
	layer_12_expert_sp2_ep4_tp1_pp3 [label="Expert L12 SP2 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep4_pp3 -> layer_12_expert_sp2_ep4_tp1_pp3
	layer_12_expert_out_sp2_ep4_tp1_pp3 [label="Expert Out L12 SP2 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep4_tp1_pp3 -> layer_12_expert_out_sp2_ep4_tp1_pp3
	layer_12_expert_sp2_ep4_tp2_pp3 [label="Expert L12 SP2 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep4_pp3 -> layer_12_expert_sp2_ep4_tp2_pp3
	layer_12_expert_out_sp2_ep4_tp2_pp3 [label="Expert Out L12 SP2 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep4_tp2_pp3 -> layer_12_expert_out_sp2_ep4_tp2_pp3
	layer_12_expert_sp2_ep4_tp3_pp3 [label="Expert L12 SP2 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep4_pp3 -> layer_12_expert_sp2_ep4_tp3_pp3
	layer_12_expert_out_sp2_ep4_tp3_pp3 [label="Expert Out L12 SP2 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep4_tp3_pp3 -> layer_12_expert_out_sp2_ep4_tp3_pp3
	layer_12_expert_ar_sp2_ep4_pp3 [label="Expert All-Reduce L12 SP2 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep4_tp0_pp3 -> layer_12_expert_ar_sp2_ep4_pp3
	layer_12_expert_out_sp2_ep4_tp1_pp3 -> layer_12_expert_ar_sp2_ep4_pp3
	layer_12_expert_out_sp2_ep4_tp2_pp3 -> layer_12_expert_ar_sp2_ep4_pp3
	layer_12_expert_out_sp2_ep4_tp3_pp3 -> layer_12_expert_ar_sp2_ep4_pp3
	layer_12_combine_sp2_ep4_pp3 [label="Token Combine L12 SP2 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep4_pp3 -> layer_12_combine_sp2_ep4_pp3
	layer_12_dispatch_sp2_ep5_pp3 [label="Token Dispatch L12 SP2 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep5_pp3 [style=dashed]
	layer_12_expert_sp2_ep5_tp0_pp3 [label="Expert L12 SP2 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep5_pp3 -> layer_12_expert_sp2_ep5_tp0_pp3
	layer_12_expert_out_sp2_ep5_tp0_pp3 [label="Expert Out L12 SP2 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep5_tp0_pp3 -> layer_12_expert_out_sp2_ep5_tp0_pp3
	layer_12_expert_sp2_ep5_tp1_pp3 [label="Expert L12 SP2 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep5_pp3 -> layer_12_expert_sp2_ep5_tp1_pp3
	layer_12_expert_out_sp2_ep5_tp1_pp3 [label="Expert Out L12 SP2 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep5_tp1_pp3 -> layer_12_expert_out_sp2_ep5_tp1_pp3
	layer_12_expert_sp2_ep5_tp2_pp3 [label="Expert L12 SP2 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep5_pp3 -> layer_12_expert_sp2_ep5_tp2_pp3
	layer_12_expert_out_sp2_ep5_tp2_pp3 [label="Expert Out L12 SP2 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep5_tp2_pp3 -> layer_12_expert_out_sp2_ep5_tp2_pp3
	layer_12_expert_sp2_ep5_tp3_pp3 [label="Expert L12 SP2 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep5_pp3 -> layer_12_expert_sp2_ep5_tp3_pp3
	layer_12_expert_out_sp2_ep5_tp3_pp3 [label="Expert Out L12 SP2 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep5_tp3_pp3 -> layer_12_expert_out_sp2_ep5_tp3_pp3
	layer_12_expert_ar_sp2_ep5_pp3 [label="Expert All-Reduce L12 SP2 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep5_tp0_pp3 -> layer_12_expert_ar_sp2_ep5_pp3
	layer_12_expert_out_sp2_ep5_tp1_pp3 -> layer_12_expert_ar_sp2_ep5_pp3
	layer_12_expert_out_sp2_ep5_tp2_pp3 -> layer_12_expert_ar_sp2_ep5_pp3
	layer_12_expert_out_sp2_ep5_tp3_pp3 -> layer_12_expert_ar_sp2_ep5_pp3
	layer_12_combine_sp2_ep5_pp3 [label="Token Combine L12 SP2 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep5_pp3 -> layer_12_combine_sp2_ep5_pp3
	layer_12_dispatch_sp2_ep6_pp3 [label="Token Dispatch L12 SP2 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep6_pp3 [style=dashed]
	layer_12_expert_sp2_ep6_tp0_pp3 [label="Expert L12 SP2 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep6_pp3 -> layer_12_expert_sp2_ep6_tp0_pp3
	layer_12_expert_out_sp2_ep6_tp0_pp3 [label="Expert Out L12 SP2 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep6_tp0_pp3 -> layer_12_expert_out_sp2_ep6_tp0_pp3
	layer_12_expert_sp2_ep6_tp1_pp3 [label="Expert L12 SP2 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep6_pp3 -> layer_12_expert_sp2_ep6_tp1_pp3
	layer_12_expert_out_sp2_ep6_tp1_pp3 [label="Expert Out L12 SP2 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep6_tp1_pp3 -> layer_12_expert_out_sp2_ep6_tp1_pp3
	layer_12_expert_sp2_ep6_tp2_pp3 [label="Expert L12 SP2 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep6_pp3 -> layer_12_expert_sp2_ep6_tp2_pp3
	layer_12_expert_out_sp2_ep6_tp2_pp3 [label="Expert Out L12 SP2 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep6_tp2_pp3 -> layer_12_expert_out_sp2_ep6_tp2_pp3
	layer_12_expert_sp2_ep6_tp3_pp3 [label="Expert L12 SP2 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep6_pp3 -> layer_12_expert_sp2_ep6_tp3_pp3
	layer_12_expert_out_sp2_ep6_tp3_pp3 [label="Expert Out L12 SP2 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep6_tp3_pp3 -> layer_12_expert_out_sp2_ep6_tp3_pp3
	layer_12_expert_ar_sp2_ep6_pp3 [label="Expert All-Reduce L12 SP2 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep6_tp0_pp3 -> layer_12_expert_ar_sp2_ep6_pp3
	layer_12_expert_out_sp2_ep6_tp1_pp3 -> layer_12_expert_ar_sp2_ep6_pp3
	layer_12_expert_out_sp2_ep6_tp2_pp3 -> layer_12_expert_ar_sp2_ep6_pp3
	layer_12_expert_out_sp2_ep6_tp3_pp3 -> layer_12_expert_ar_sp2_ep6_pp3
	layer_12_combine_sp2_ep6_pp3 [label="Token Combine L12 SP2 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep6_pp3 -> layer_12_combine_sp2_ep6_pp3
	layer_12_dispatch_sp2_ep7_pp3 [label="Token Dispatch L12 SP2 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep7_pp3 [style=dashed]
	layer_12_expert_sp2_ep7_tp0_pp3 [label="Expert L12 SP2 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep7_pp3 -> layer_12_expert_sp2_ep7_tp0_pp3
	layer_12_expert_out_sp2_ep7_tp0_pp3 [label="Expert Out L12 SP2 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep7_tp0_pp3 -> layer_12_expert_out_sp2_ep7_tp0_pp3
	layer_12_expert_sp2_ep7_tp1_pp3 [label="Expert L12 SP2 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep7_pp3 -> layer_12_expert_sp2_ep7_tp1_pp3
	layer_12_expert_out_sp2_ep7_tp1_pp3 [label="Expert Out L12 SP2 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep7_tp1_pp3 -> layer_12_expert_out_sp2_ep7_tp1_pp3
	layer_12_expert_sp2_ep7_tp2_pp3 [label="Expert L12 SP2 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep7_pp3 -> layer_12_expert_sp2_ep7_tp2_pp3
	layer_12_expert_out_sp2_ep7_tp2_pp3 [label="Expert Out L12 SP2 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep7_tp2_pp3 -> layer_12_expert_out_sp2_ep7_tp2_pp3
	layer_12_expert_sp2_ep7_tp3_pp3 [label="Expert L12 SP2 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep7_pp3 -> layer_12_expert_sp2_ep7_tp3_pp3
	layer_12_expert_out_sp2_ep7_tp3_pp3 [label="Expert Out L12 SP2 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep7_tp3_pp3 -> layer_12_expert_out_sp2_ep7_tp3_pp3
	layer_12_expert_ar_sp2_ep7_pp3 [label="Expert All-Reduce L12 SP2 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep7_tp0_pp3 -> layer_12_expert_ar_sp2_ep7_pp3
	layer_12_expert_out_sp2_ep7_tp1_pp3 -> layer_12_expert_ar_sp2_ep7_pp3
	layer_12_expert_out_sp2_ep7_tp2_pp3 -> layer_12_expert_ar_sp2_ep7_pp3
	layer_12_expert_out_sp2_ep7_tp3_pp3 -> layer_12_expert_ar_sp2_ep7_pp3
	layer_12_combine_sp2_ep7_pp3 [label="Token Combine L12 SP2 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep7_pp3 -> layer_12_combine_sp2_ep7_pp3
	layer_12_dispatch_sp2_ep8_pp3 [label="Token Dispatch L12 SP2 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep8_pp3 [style=dashed]
	layer_12_expert_sp2_ep8_tp0_pp3 [label="Expert L12 SP2 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep8_pp3 -> layer_12_expert_sp2_ep8_tp0_pp3
	layer_12_expert_out_sp2_ep8_tp0_pp3 [label="Expert Out L12 SP2 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep8_tp0_pp3 -> layer_12_expert_out_sp2_ep8_tp0_pp3
	layer_12_expert_sp2_ep8_tp1_pp3 [label="Expert L12 SP2 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep8_pp3 -> layer_12_expert_sp2_ep8_tp1_pp3
	layer_12_expert_out_sp2_ep8_tp1_pp3 [label="Expert Out L12 SP2 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep8_tp1_pp3 -> layer_12_expert_out_sp2_ep8_tp1_pp3
	layer_12_expert_sp2_ep8_tp2_pp3 [label="Expert L12 SP2 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep8_pp3 -> layer_12_expert_sp2_ep8_tp2_pp3
	layer_12_expert_out_sp2_ep8_tp2_pp3 [label="Expert Out L12 SP2 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep8_tp2_pp3 -> layer_12_expert_out_sp2_ep8_tp2_pp3
	layer_12_expert_sp2_ep8_tp3_pp3 [label="Expert L12 SP2 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep8_pp3 -> layer_12_expert_sp2_ep8_tp3_pp3
	layer_12_expert_out_sp2_ep8_tp3_pp3 [label="Expert Out L12 SP2 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep8_tp3_pp3 -> layer_12_expert_out_sp2_ep8_tp3_pp3
	layer_12_expert_ar_sp2_ep8_pp3 [label="Expert All-Reduce L12 SP2 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep8_tp0_pp3 -> layer_12_expert_ar_sp2_ep8_pp3
	layer_12_expert_out_sp2_ep8_tp1_pp3 -> layer_12_expert_ar_sp2_ep8_pp3
	layer_12_expert_out_sp2_ep8_tp2_pp3 -> layer_12_expert_ar_sp2_ep8_pp3
	layer_12_expert_out_sp2_ep8_tp3_pp3 -> layer_12_expert_ar_sp2_ep8_pp3
	layer_12_combine_sp2_ep8_pp3 [label="Token Combine L12 SP2 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep8_pp3 -> layer_12_combine_sp2_ep8_pp3
	layer_12_dispatch_sp2_ep9_pp3 [label="Token Dispatch L12 SP2 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep9_pp3 [style=dashed]
	layer_12_expert_sp2_ep9_tp0_pp3 [label="Expert L12 SP2 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep9_pp3 -> layer_12_expert_sp2_ep9_tp0_pp3
	layer_12_expert_out_sp2_ep9_tp0_pp3 [label="Expert Out L12 SP2 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep9_tp0_pp3 -> layer_12_expert_out_sp2_ep9_tp0_pp3
	layer_12_expert_sp2_ep9_tp1_pp3 [label="Expert L12 SP2 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep9_pp3 -> layer_12_expert_sp2_ep9_tp1_pp3
	layer_12_expert_out_sp2_ep9_tp1_pp3 [label="Expert Out L12 SP2 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep9_tp1_pp3 -> layer_12_expert_out_sp2_ep9_tp1_pp3
	layer_12_expert_sp2_ep9_tp2_pp3 [label="Expert L12 SP2 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep9_pp3 -> layer_12_expert_sp2_ep9_tp2_pp3
	layer_12_expert_out_sp2_ep9_tp2_pp3 [label="Expert Out L12 SP2 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep9_tp2_pp3 -> layer_12_expert_out_sp2_ep9_tp2_pp3
	layer_12_expert_sp2_ep9_tp3_pp3 [label="Expert L12 SP2 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep9_pp3 -> layer_12_expert_sp2_ep9_tp3_pp3
	layer_12_expert_out_sp2_ep9_tp3_pp3 [label="Expert Out L12 SP2 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep9_tp3_pp3 -> layer_12_expert_out_sp2_ep9_tp3_pp3
	layer_12_expert_ar_sp2_ep9_pp3 [label="Expert All-Reduce L12 SP2 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep9_tp0_pp3 -> layer_12_expert_ar_sp2_ep9_pp3
	layer_12_expert_out_sp2_ep9_tp1_pp3 -> layer_12_expert_ar_sp2_ep9_pp3
	layer_12_expert_out_sp2_ep9_tp2_pp3 -> layer_12_expert_ar_sp2_ep9_pp3
	layer_12_expert_out_sp2_ep9_tp3_pp3 -> layer_12_expert_ar_sp2_ep9_pp3
	layer_12_combine_sp2_ep9_pp3 [label="Token Combine L12 SP2 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep9_pp3 -> layer_12_combine_sp2_ep9_pp3
	layer_12_dispatch_sp2_ep10_pp3 [label="Token Dispatch L12 SP2 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep10_pp3 [style=dashed]
	layer_12_expert_sp2_ep10_tp0_pp3 [label="Expert L12 SP2 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep10_pp3 -> layer_12_expert_sp2_ep10_tp0_pp3
	layer_12_expert_out_sp2_ep10_tp0_pp3 [label="Expert Out L12 SP2 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep10_tp0_pp3 -> layer_12_expert_out_sp2_ep10_tp0_pp3
	layer_12_expert_sp2_ep10_tp1_pp3 [label="Expert L12 SP2 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep10_pp3 -> layer_12_expert_sp2_ep10_tp1_pp3
	layer_12_expert_out_sp2_ep10_tp1_pp3 [label="Expert Out L12 SP2 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep10_tp1_pp3 -> layer_12_expert_out_sp2_ep10_tp1_pp3
	layer_12_expert_sp2_ep10_tp2_pp3 [label="Expert L12 SP2 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep10_pp3 -> layer_12_expert_sp2_ep10_tp2_pp3
	layer_12_expert_out_sp2_ep10_tp2_pp3 [label="Expert Out L12 SP2 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep10_tp2_pp3 -> layer_12_expert_out_sp2_ep10_tp2_pp3
	layer_12_expert_sp2_ep10_tp3_pp3 [label="Expert L12 SP2 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep10_pp3 -> layer_12_expert_sp2_ep10_tp3_pp3
	layer_12_expert_out_sp2_ep10_tp3_pp3 [label="Expert Out L12 SP2 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep10_tp3_pp3 -> layer_12_expert_out_sp2_ep10_tp3_pp3
	layer_12_expert_ar_sp2_ep10_pp3 [label="Expert All-Reduce L12 SP2 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep10_tp0_pp3 -> layer_12_expert_ar_sp2_ep10_pp3
	layer_12_expert_out_sp2_ep10_tp1_pp3 -> layer_12_expert_ar_sp2_ep10_pp3
	layer_12_expert_out_sp2_ep10_tp2_pp3 -> layer_12_expert_ar_sp2_ep10_pp3
	layer_12_expert_out_sp2_ep10_tp3_pp3 -> layer_12_expert_ar_sp2_ep10_pp3
	layer_12_combine_sp2_ep10_pp3 [label="Token Combine L12 SP2 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep10_pp3 -> layer_12_combine_sp2_ep10_pp3
	layer_12_dispatch_sp2_ep11_pp3 [label="Token Dispatch L12 SP2 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep11_pp3 [style=dashed]
	layer_12_expert_sp2_ep11_tp0_pp3 [label="Expert L12 SP2 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep11_pp3 -> layer_12_expert_sp2_ep11_tp0_pp3
	layer_12_expert_out_sp2_ep11_tp0_pp3 [label="Expert Out L12 SP2 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep11_tp0_pp3 -> layer_12_expert_out_sp2_ep11_tp0_pp3
	layer_12_expert_sp2_ep11_tp1_pp3 [label="Expert L12 SP2 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep11_pp3 -> layer_12_expert_sp2_ep11_tp1_pp3
	layer_12_expert_out_sp2_ep11_tp1_pp3 [label="Expert Out L12 SP2 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep11_tp1_pp3 -> layer_12_expert_out_sp2_ep11_tp1_pp3
	layer_12_expert_sp2_ep11_tp2_pp3 [label="Expert L12 SP2 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep11_pp3 -> layer_12_expert_sp2_ep11_tp2_pp3
	layer_12_expert_out_sp2_ep11_tp2_pp3 [label="Expert Out L12 SP2 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep11_tp2_pp3 -> layer_12_expert_out_sp2_ep11_tp2_pp3
	layer_12_expert_sp2_ep11_tp3_pp3 [label="Expert L12 SP2 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep11_pp3 -> layer_12_expert_sp2_ep11_tp3_pp3
	layer_12_expert_out_sp2_ep11_tp3_pp3 [label="Expert Out L12 SP2 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep11_tp3_pp3 -> layer_12_expert_out_sp2_ep11_tp3_pp3
	layer_12_expert_ar_sp2_ep11_pp3 [label="Expert All-Reduce L12 SP2 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep11_tp0_pp3 -> layer_12_expert_ar_sp2_ep11_pp3
	layer_12_expert_out_sp2_ep11_tp1_pp3 -> layer_12_expert_ar_sp2_ep11_pp3
	layer_12_expert_out_sp2_ep11_tp2_pp3 -> layer_12_expert_ar_sp2_ep11_pp3
	layer_12_expert_out_sp2_ep11_tp3_pp3 -> layer_12_expert_ar_sp2_ep11_pp3
	layer_12_combine_sp2_ep11_pp3 [label="Token Combine L12 SP2 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep11_pp3 -> layer_12_combine_sp2_ep11_pp3
	layer_12_dispatch_sp2_ep12_pp3 [label="Token Dispatch L12 SP2 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep12_pp3 [style=dashed]
	layer_12_expert_sp2_ep12_tp0_pp3 [label="Expert L12 SP2 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep12_pp3 -> layer_12_expert_sp2_ep12_tp0_pp3
	layer_12_expert_out_sp2_ep12_tp0_pp3 [label="Expert Out L12 SP2 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep12_tp0_pp3 -> layer_12_expert_out_sp2_ep12_tp0_pp3
	layer_12_expert_sp2_ep12_tp1_pp3 [label="Expert L12 SP2 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep12_pp3 -> layer_12_expert_sp2_ep12_tp1_pp3
	layer_12_expert_out_sp2_ep12_tp1_pp3 [label="Expert Out L12 SP2 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep12_tp1_pp3 -> layer_12_expert_out_sp2_ep12_tp1_pp3
	layer_12_expert_sp2_ep12_tp2_pp3 [label="Expert L12 SP2 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep12_pp3 -> layer_12_expert_sp2_ep12_tp2_pp3
	layer_12_expert_out_sp2_ep12_tp2_pp3 [label="Expert Out L12 SP2 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep12_tp2_pp3 -> layer_12_expert_out_sp2_ep12_tp2_pp3
	layer_12_expert_sp2_ep12_tp3_pp3 [label="Expert L12 SP2 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep12_pp3 -> layer_12_expert_sp2_ep12_tp3_pp3
	layer_12_expert_out_sp2_ep12_tp3_pp3 [label="Expert Out L12 SP2 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep12_tp3_pp3 -> layer_12_expert_out_sp2_ep12_tp3_pp3
	layer_12_expert_ar_sp2_ep12_pp3 [label="Expert All-Reduce L12 SP2 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep12_tp0_pp3 -> layer_12_expert_ar_sp2_ep12_pp3
	layer_12_expert_out_sp2_ep12_tp1_pp3 -> layer_12_expert_ar_sp2_ep12_pp3
	layer_12_expert_out_sp2_ep12_tp2_pp3 -> layer_12_expert_ar_sp2_ep12_pp3
	layer_12_expert_out_sp2_ep12_tp3_pp3 -> layer_12_expert_ar_sp2_ep12_pp3
	layer_12_combine_sp2_ep12_pp3 [label="Token Combine L12 SP2 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep12_pp3 -> layer_12_combine_sp2_ep12_pp3
	layer_12_dispatch_sp2_ep13_pp3 [label="Token Dispatch L12 SP2 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep13_pp3 [style=dashed]
	layer_12_expert_sp2_ep13_tp0_pp3 [label="Expert L12 SP2 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep13_pp3 -> layer_12_expert_sp2_ep13_tp0_pp3
	layer_12_expert_out_sp2_ep13_tp0_pp3 [label="Expert Out L12 SP2 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep13_tp0_pp3 -> layer_12_expert_out_sp2_ep13_tp0_pp3
	layer_12_expert_sp2_ep13_tp1_pp3 [label="Expert L12 SP2 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep13_pp3 -> layer_12_expert_sp2_ep13_tp1_pp3
	layer_12_expert_out_sp2_ep13_tp1_pp3 [label="Expert Out L12 SP2 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep13_tp1_pp3 -> layer_12_expert_out_sp2_ep13_tp1_pp3
	layer_12_expert_sp2_ep13_tp2_pp3 [label="Expert L12 SP2 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep13_pp3 -> layer_12_expert_sp2_ep13_tp2_pp3
	layer_12_expert_out_sp2_ep13_tp2_pp3 [label="Expert Out L12 SP2 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep13_tp2_pp3 -> layer_12_expert_out_sp2_ep13_tp2_pp3
	layer_12_expert_sp2_ep13_tp3_pp3 [label="Expert L12 SP2 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep13_pp3 -> layer_12_expert_sp2_ep13_tp3_pp3
	layer_12_expert_out_sp2_ep13_tp3_pp3 [label="Expert Out L12 SP2 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep13_tp3_pp3 -> layer_12_expert_out_sp2_ep13_tp3_pp3
	layer_12_expert_ar_sp2_ep13_pp3 [label="Expert All-Reduce L12 SP2 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep13_tp0_pp3 -> layer_12_expert_ar_sp2_ep13_pp3
	layer_12_expert_out_sp2_ep13_tp1_pp3 -> layer_12_expert_ar_sp2_ep13_pp3
	layer_12_expert_out_sp2_ep13_tp2_pp3 -> layer_12_expert_ar_sp2_ep13_pp3
	layer_12_expert_out_sp2_ep13_tp3_pp3 -> layer_12_expert_ar_sp2_ep13_pp3
	layer_12_combine_sp2_ep13_pp3 [label="Token Combine L12 SP2 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep13_pp3 -> layer_12_combine_sp2_ep13_pp3
	layer_12_dispatch_sp2_ep14_pp3 [label="Token Dispatch L12 SP2 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep14_pp3 [style=dashed]
	layer_12_expert_sp2_ep14_tp0_pp3 [label="Expert L12 SP2 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep14_pp3 -> layer_12_expert_sp2_ep14_tp0_pp3
	layer_12_expert_out_sp2_ep14_tp0_pp3 [label="Expert Out L12 SP2 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep14_tp0_pp3 -> layer_12_expert_out_sp2_ep14_tp0_pp3
	layer_12_expert_sp2_ep14_tp1_pp3 [label="Expert L12 SP2 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep14_pp3 -> layer_12_expert_sp2_ep14_tp1_pp3
	layer_12_expert_out_sp2_ep14_tp1_pp3 [label="Expert Out L12 SP2 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep14_tp1_pp3 -> layer_12_expert_out_sp2_ep14_tp1_pp3
	layer_12_expert_sp2_ep14_tp2_pp3 [label="Expert L12 SP2 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep14_pp3 -> layer_12_expert_sp2_ep14_tp2_pp3
	layer_12_expert_out_sp2_ep14_tp2_pp3 [label="Expert Out L12 SP2 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep14_tp2_pp3 -> layer_12_expert_out_sp2_ep14_tp2_pp3
	layer_12_expert_sp2_ep14_tp3_pp3 [label="Expert L12 SP2 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep14_pp3 -> layer_12_expert_sp2_ep14_tp3_pp3
	layer_12_expert_out_sp2_ep14_tp3_pp3 [label="Expert Out L12 SP2 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep14_tp3_pp3 -> layer_12_expert_out_sp2_ep14_tp3_pp3
	layer_12_expert_ar_sp2_ep14_pp3 [label="Expert All-Reduce L12 SP2 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep14_tp0_pp3 -> layer_12_expert_ar_sp2_ep14_pp3
	layer_12_expert_out_sp2_ep14_tp1_pp3 -> layer_12_expert_ar_sp2_ep14_pp3
	layer_12_expert_out_sp2_ep14_tp2_pp3 -> layer_12_expert_ar_sp2_ep14_pp3
	layer_12_expert_out_sp2_ep14_tp3_pp3 -> layer_12_expert_ar_sp2_ep14_pp3
	layer_12_combine_sp2_ep14_pp3 [label="Token Combine L12 SP2 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep14_pp3 -> layer_12_combine_sp2_ep14_pp3
	layer_12_dispatch_sp2_ep15_pp3 [label="Token Dispatch L12 SP2 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp2_pp3 -> layer_12_dispatch_sp2_ep15_pp3 [style=dashed]
	layer_12_expert_sp2_ep15_tp0_pp3 [label="Expert L12 SP2 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep15_pp3 -> layer_12_expert_sp2_ep15_tp0_pp3
	layer_12_expert_out_sp2_ep15_tp0_pp3 [label="Expert Out L12 SP2 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep15_tp0_pp3 -> layer_12_expert_out_sp2_ep15_tp0_pp3
	layer_12_expert_sp2_ep15_tp1_pp3 [label="Expert L12 SP2 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep15_pp3 -> layer_12_expert_sp2_ep15_tp1_pp3
	layer_12_expert_out_sp2_ep15_tp1_pp3 [label="Expert Out L12 SP2 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep15_tp1_pp3 -> layer_12_expert_out_sp2_ep15_tp1_pp3
	layer_12_expert_sp2_ep15_tp2_pp3 [label="Expert L12 SP2 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep15_pp3 -> layer_12_expert_sp2_ep15_tp2_pp3
	layer_12_expert_out_sp2_ep15_tp2_pp3 [label="Expert Out L12 SP2 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep15_tp2_pp3 -> layer_12_expert_out_sp2_ep15_tp2_pp3
	layer_12_expert_sp2_ep15_tp3_pp3 [label="Expert L12 SP2 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp2_ep15_pp3 -> layer_12_expert_sp2_ep15_tp3_pp3
	layer_12_expert_out_sp2_ep15_tp3_pp3 [label="Expert Out L12 SP2 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp2_ep15_tp3_pp3 -> layer_12_expert_out_sp2_ep15_tp3_pp3
	layer_12_expert_ar_sp2_ep15_pp3 [label="Expert All-Reduce L12 SP2 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp2_ep15_tp0_pp3 -> layer_12_expert_ar_sp2_ep15_pp3
	layer_12_expert_out_sp2_ep15_tp1_pp3 -> layer_12_expert_ar_sp2_ep15_pp3
	layer_12_expert_out_sp2_ep15_tp2_pp3 -> layer_12_expert_ar_sp2_ep15_pp3
	layer_12_expert_out_sp2_ep15_tp3_pp3 -> layer_12_expert_ar_sp2_ep15_pp3
	layer_12_combine_sp2_ep15_pp3 [label="Token Combine L12 SP2 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp2_ep15_pp3 -> layer_12_combine_sp2_ep15_pp3
	layer_12_moe_all2all_sp2_pp3 [label="MoE All-to-All L12 SP2\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_12_combine_sp2_ep0_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep1_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep2_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep3_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep4_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep5_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep6_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep7_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep8_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep9_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep10_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep11_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep12_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep13_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep14_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_combine_sp2_ep15_pp3 -> layer_12_moe_all2all_sp2_pp3
	layer_12_mlp_out_sp2_pp3 [label="MoE Output L12 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_moe_all2all_sp2_pp3 -> layer_12_mlp_out_sp2_pp3
	layer_12_mlp_res_sp2_pp3 [label="MLP Residual L12 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_mlp_out_sp2_pp3 -> layer_12_mlp_res_sp2_pp3
	layer_12_attn_res_sp2_pp3 -> layer_12_mlp_res_sp2_pp3 [style=dashed]
	layer_12_norm_sp3_pp3 [label="LayerNorm L12 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_11_mlp_out_sp0_pp2 -> layer_12_norm_sp3_pp3 [style=dashed]
	layer_11_mlp_out_sp1_pp2 -> layer_12_norm_sp3_pp3 [style=dashed]
	layer_11_mlp_out_sp2_pp2 -> layer_12_norm_sp3_pp3 [style=dashed]
	layer_11_mlp_out_sp3_pp2 -> layer_12_norm_sp3_pp3 [style=dashed]
	layer_12_qkv_sp3_tp0_pp3 [label="QKV Proj L12 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp3_pp3 -> layer_12_qkv_sp3_tp0_pp3
	layer_12_attn_sp3_tp0_pp3 [label="Attention L12 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp3_tp0_pp3 -> layer_12_attn_sp3_tp0_pp3
	layer_12_attn_out_sp3_tp0_pp3 [label="Attn Out Proj L12 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp3_tp0_pp3 -> layer_12_attn_out_sp3_tp0_pp3
	layer_12_qkv_sp3_tp1_pp3 [label="QKV Proj L12 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp3_pp3 -> layer_12_qkv_sp3_tp1_pp3
	layer_12_attn_sp3_tp1_pp3 [label="Attention L12 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp3_tp1_pp3 -> layer_12_attn_sp3_tp1_pp3
	layer_12_attn_out_sp3_tp1_pp3 [label="Attn Out Proj L12 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp3_tp1_pp3 -> layer_12_attn_out_sp3_tp1_pp3
	layer_12_qkv_sp3_tp2_pp3 [label="QKV Proj L12 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp3_pp3 -> layer_12_qkv_sp3_tp2_pp3
	layer_12_attn_sp3_tp2_pp3 [label="Attention L12 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp3_tp2_pp3 -> layer_12_attn_sp3_tp2_pp3
	layer_12_attn_out_sp3_tp2_pp3 [label="Attn Out Proj L12 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp3_tp2_pp3 -> layer_12_attn_out_sp3_tp2_pp3
	layer_12_qkv_sp3_tp3_pp3 [label="QKV Proj L12 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_norm_sp3_pp3 -> layer_12_qkv_sp3_tp3_pp3
	layer_12_attn_sp3_tp3_pp3 [label="Attention L12 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_qkv_sp3_tp3_pp3 -> layer_12_attn_sp3_tp3_pp3
	layer_12_attn_out_sp3_tp3_pp3 [label="Attn Out Proj L12 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_12_attn_sp3_tp3_pp3 -> layer_12_attn_out_sp3_tp3_pp3
	layer_12_attn_ar_sp3_pp3 [label="Attention All-Reduce L12 SP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_attn_out_sp3_tp0_pp3 -> layer_12_attn_ar_sp3_pp3
	layer_12_attn_out_sp3_tp1_pp3 -> layer_12_attn_ar_sp3_pp3
	layer_12_attn_out_sp3_tp2_pp3 -> layer_12_attn_ar_sp3_pp3
	layer_12_attn_out_sp3_tp3_pp3 -> layer_12_attn_ar_sp3_pp3
	layer_12_attn_res_sp3_pp3 [label="Attention Residual L12 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_attn_ar_sp3_pp3 -> layer_12_attn_res_sp3_pp3
	layer_12_norm_sp3_pp3 -> layer_12_attn_res_sp3_pp3 [style=dashed]
	layer_12_post_norm_sp3_pp3 [label="Post-Attn Norm L12 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_attn_res_sp3_pp3 -> layer_12_post_norm_sp3_pp3
	layer_12_router_sp3_pp3 [label="MoE Router L12 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_12_post_norm_sp3_pp3 -> layer_12_router_sp3_pp3
	layer_12_dispatch_sp3_ep0_pp3 [label="Token Dispatch L12 SP3 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep0_pp3 [style=dashed]
	layer_12_expert_sp3_ep0_tp0_pp3 [label="Expert L12 SP3 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep0_pp3 -> layer_12_expert_sp3_ep0_tp0_pp3
	layer_12_expert_out_sp3_ep0_tp0_pp3 [label="Expert Out L12 SP3 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep0_tp0_pp3 -> layer_12_expert_out_sp3_ep0_tp0_pp3
	layer_12_expert_sp3_ep0_tp1_pp3 [label="Expert L12 SP3 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep0_pp3 -> layer_12_expert_sp3_ep0_tp1_pp3
	layer_12_expert_out_sp3_ep0_tp1_pp3 [label="Expert Out L12 SP3 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep0_tp1_pp3 -> layer_12_expert_out_sp3_ep0_tp1_pp3
	layer_12_expert_sp3_ep0_tp2_pp3 [label="Expert L12 SP3 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep0_pp3 -> layer_12_expert_sp3_ep0_tp2_pp3
	layer_12_expert_out_sp3_ep0_tp2_pp3 [label="Expert Out L12 SP3 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep0_tp2_pp3 -> layer_12_expert_out_sp3_ep0_tp2_pp3
	layer_12_expert_sp3_ep0_tp3_pp3 [label="Expert L12 SP3 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep0_pp3 -> layer_12_expert_sp3_ep0_tp3_pp3
	layer_12_expert_out_sp3_ep0_tp3_pp3 [label="Expert Out L12 SP3 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep0_tp3_pp3 -> layer_12_expert_out_sp3_ep0_tp3_pp3
	layer_12_expert_ar_sp3_ep0_pp3 [label="Expert All-Reduce L12 SP3 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep0_tp0_pp3 -> layer_12_expert_ar_sp3_ep0_pp3
	layer_12_expert_out_sp3_ep0_tp1_pp3 -> layer_12_expert_ar_sp3_ep0_pp3
	layer_12_expert_out_sp3_ep0_tp2_pp3 -> layer_12_expert_ar_sp3_ep0_pp3
	layer_12_expert_out_sp3_ep0_tp3_pp3 -> layer_12_expert_ar_sp3_ep0_pp3
	layer_12_combine_sp3_ep0_pp3 [label="Token Combine L12 SP3 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep0_pp3 -> layer_12_combine_sp3_ep0_pp3
	layer_12_dispatch_sp3_ep1_pp3 [label="Token Dispatch L12 SP3 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep1_pp3 [style=dashed]
	layer_12_expert_sp3_ep1_tp0_pp3 [label="Expert L12 SP3 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep1_pp3 -> layer_12_expert_sp3_ep1_tp0_pp3
	layer_12_expert_out_sp3_ep1_tp0_pp3 [label="Expert Out L12 SP3 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep1_tp0_pp3 -> layer_12_expert_out_sp3_ep1_tp0_pp3
	layer_12_expert_sp3_ep1_tp1_pp3 [label="Expert L12 SP3 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep1_pp3 -> layer_12_expert_sp3_ep1_tp1_pp3
	layer_12_expert_out_sp3_ep1_tp1_pp3 [label="Expert Out L12 SP3 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep1_tp1_pp3 -> layer_12_expert_out_sp3_ep1_tp1_pp3
	layer_12_expert_sp3_ep1_tp2_pp3 [label="Expert L12 SP3 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep1_pp3 -> layer_12_expert_sp3_ep1_tp2_pp3
	layer_12_expert_out_sp3_ep1_tp2_pp3 [label="Expert Out L12 SP3 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep1_tp2_pp3 -> layer_12_expert_out_sp3_ep1_tp2_pp3
	layer_12_expert_sp3_ep1_tp3_pp3 [label="Expert L12 SP3 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep1_pp3 -> layer_12_expert_sp3_ep1_tp3_pp3
	layer_12_expert_out_sp3_ep1_tp3_pp3 [label="Expert Out L12 SP3 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep1_tp3_pp3 -> layer_12_expert_out_sp3_ep1_tp3_pp3
	layer_12_expert_ar_sp3_ep1_pp3 [label="Expert All-Reduce L12 SP3 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep1_tp0_pp3 -> layer_12_expert_ar_sp3_ep1_pp3
	layer_12_expert_out_sp3_ep1_tp1_pp3 -> layer_12_expert_ar_sp3_ep1_pp3
	layer_12_expert_out_sp3_ep1_tp2_pp3 -> layer_12_expert_ar_sp3_ep1_pp3
	layer_12_expert_out_sp3_ep1_tp3_pp3 -> layer_12_expert_ar_sp3_ep1_pp3
	layer_12_combine_sp3_ep1_pp3 [label="Token Combine L12 SP3 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep1_pp3 -> layer_12_combine_sp3_ep1_pp3
	layer_12_dispatch_sp3_ep2_pp3 [label="Token Dispatch L12 SP3 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep2_pp3 [style=dashed]
	layer_12_expert_sp3_ep2_tp0_pp3 [label="Expert L12 SP3 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep2_pp3 -> layer_12_expert_sp3_ep2_tp0_pp3
	layer_12_expert_out_sp3_ep2_tp0_pp3 [label="Expert Out L12 SP3 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep2_tp0_pp3 -> layer_12_expert_out_sp3_ep2_tp0_pp3
	layer_12_expert_sp3_ep2_tp1_pp3 [label="Expert L12 SP3 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep2_pp3 -> layer_12_expert_sp3_ep2_tp1_pp3
	layer_12_expert_out_sp3_ep2_tp1_pp3 [label="Expert Out L12 SP3 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep2_tp1_pp3 -> layer_12_expert_out_sp3_ep2_tp1_pp3
	layer_12_expert_sp3_ep2_tp2_pp3 [label="Expert L12 SP3 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep2_pp3 -> layer_12_expert_sp3_ep2_tp2_pp3
	layer_12_expert_out_sp3_ep2_tp2_pp3 [label="Expert Out L12 SP3 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep2_tp2_pp3 -> layer_12_expert_out_sp3_ep2_tp2_pp3
	layer_12_expert_sp3_ep2_tp3_pp3 [label="Expert L12 SP3 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep2_pp3 -> layer_12_expert_sp3_ep2_tp3_pp3
	layer_12_expert_out_sp3_ep2_tp3_pp3 [label="Expert Out L12 SP3 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep2_tp3_pp3 -> layer_12_expert_out_sp3_ep2_tp3_pp3
	layer_12_expert_ar_sp3_ep2_pp3 [label="Expert All-Reduce L12 SP3 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep2_tp0_pp3 -> layer_12_expert_ar_sp3_ep2_pp3
	layer_12_expert_out_sp3_ep2_tp1_pp3 -> layer_12_expert_ar_sp3_ep2_pp3
	layer_12_expert_out_sp3_ep2_tp2_pp3 -> layer_12_expert_ar_sp3_ep2_pp3
	layer_12_expert_out_sp3_ep2_tp3_pp3 -> layer_12_expert_ar_sp3_ep2_pp3
	layer_12_combine_sp3_ep2_pp3 [label="Token Combine L12 SP3 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep2_pp3 -> layer_12_combine_sp3_ep2_pp3
	layer_12_dispatch_sp3_ep3_pp3 [label="Token Dispatch L12 SP3 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep3_pp3 [style=dashed]
	layer_12_expert_sp3_ep3_tp0_pp3 [label="Expert L12 SP3 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep3_pp3 -> layer_12_expert_sp3_ep3_tp0_pp3
	layer_12_expert_out_sp3_ep3_tp0_pp3 [label="Expert Out L12 SP3 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep3_tp0_pp3 -> layer_12_expert_out_sp3_ep3_tp0_pp3
	layer_12_expert_sp3_ep3_tp1_pp3 [label="Expert L12 SP3 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep3_pp3 -> layer_12_expert_sp3_ep3_tp1_pp3
	layer_12_expert_out_sp3_ep3_tp1_pp3 [label="Expert Out L12 SP3 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep3_tp1_pp3 -> layer_12_expert_out_sp3_ep3_tp1_pp3
	layer_12_expert_sp3_ep3_tp2_pp3 [label="Expert L12 SP3 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep3_pp3 -> layer_12_expert_sp3_ep3_tp2_pp3
	layer_12_expert_out_sp3_ep3_tp2_pp3 [label="Expert Out L12 SP3 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep3_tp2_pp3 -> layer_12_expert_out_sp3_ep3_tp2_pp3
	layer_12_expert_sp3_ep3_tp3_pp3 [label="Expert L12 SP3 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep3_pp3 -> layer_12_expert_sp3_ep3_tp3_pp3
	layer_12_expert_out_sp3_ep3_tp3_pp3 [label="Expert Out L12 SP3 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep3_tp3_pp3 -> layer_12_expert_out_sp3_ep3_tp3_pp3
	layer_12_expert_ar_sp3_ep3_pp3 [label="Expert All-Reduce L12 SP3 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep3_tp0_pp3 -> layer_12_expert_ar_sp3_ep3_pp3
	layer_12_expert_out_sp3_ep3_tp1_pp3 -> layer_12_expert_ar_sp3_ep3_pp3
	layer_12_expert_out_sp3_ep3_tp2_pp3 -> layer_12_expert_ar_sp3_ep3_pp3
	layer_12_expert_out_sp3_ep3_tp3_pp3 -> layer_12_expert_ar_sp3_ep3_pp3
	layer_12_combine_sp3_ep3_pp3 [label="Token Combine L12 SP3 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep3_pp3 -> layer_12_combine_sp3_ep3_pp3
	layer_12_dispatch_sp3_ep4_pp3 [label="Token Dispatch L12 SP3 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep4_pp3 [style=dashed]
	layer_12_expert_sp3_ep4_tp0_pp3 [label="Expert L12 SP3 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep4_pp3 -> layer_12_expert_sp3_ep4_tp0_pp3
	layer_12_expert_out_sp3_ep4_tp0_pp3 [label="Expert Out L12 SP3 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep4_tp0_pp3 -> layer_12_expert_out_sp3_ep4_tp0_pp3
	layer_12_expert_sp3_ep4_tp1_pp3 [label="Expert L12 SP3 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep4_pp3 -> layer_12_expert_sp3_ep4_tp1_pp3
	layer_12_expert_out_sp3_ep4_tp1_pp3 [label="Expert Out L12 SP3 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep4_tp1_pp3 -> layer_12_expert_out_sp3_ep4_tp1_pp3
	layer_12_expert_sp3_ep4_tp2_pp3 [label="Expert L12 SP3 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep4_pp3 -> layer_12_expert_sp3_ep4_tp2_pp3
	layer_12_expert_out_sp3_ep4_tp2_pp3 [label="Expert Out L12 SP3 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep4_tp2_pp3 -> layer_12_expert_out_sp3_ep4_tp2_pp3
	layer_12_expert_sp3_ep4_tp3_pp3 [label="Expert L12 SP3 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep4_pp3 -> layer_12_expert_sp3_ep4_tp3_pp3
	layer_12_expert_out_sp3_ep4_tp3_pp3 [label="Expert Out L12 SP3 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep4_tp3_pp3 -> layer_12_expert_out_sp3_ep4_tp3_pp3
	layer_12_expert_ar_sp3_ep4_pp3 [label="Expert All-Reduce L12 SP3 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep4_tp0_pp3 -> layer_12_expert_ar_sp3_ep4_pp3
	layer_12_expert_out_sp3_ep4_tp1_pp3 -> layer_12_expert_ar_sp3_ep4_pp3
	layer_12_expert_out_sp3_ep4_tp2_pp3 -> layer_12_expert_ar_sp3_ep4_pp3
	layer_12_expert_out_sp3_ep4_tp3_pp3 -> layer_12_expert_ar_sp3_ep4_pp3
	layer_12_combine_sp3_ep4_pp3 [label="Token Combine L12 SP3 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep4_pp3 -> layer_12_combine_sp3_ep4_pp3
	layer_12_dispatch_sp3_ep5_pp3 [label="Token Dispatch L12 SP3 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep5_pp3 [style=dashed]
	layer_12_expert_sp3_ep5_tp0_pp3 [label="Expert L12 SP3 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep5_pp3 -> layer_12_expert_sp3_ep5_tp0_pp3
	layer_12_expert_out_sp3_ep5_tp0_pp3 [label="Expert Out L12 SP3 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep5_tp0_pp3 -> layer_12_expert_out_sp3_ep5_tp0_pp3
	layer_12_expert_sp3_ep5_tp1_pp3 [label="Expert L12 SP3 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep5_pp3 -> layer_12_expert_sp3_ep5_tp1_pp3
	layer_12_expert_out_sp3_ep5_tp1_pp3 [label="Expert Out L12 SP3 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep5_tp1_pp3 -> layer_12_expert_out_sp3_ep5_tp1_pp3
	layer_12_expert_sp3_ep5_tp2_pp3 [label="Expert L12 SP3 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep5_pp3 -> layer_12_expert_sp3_ep5_tp2_pp3
	layer_12_expert_out_sp3_ep5_tp2_pp3 [label="Expert Out L12 SP3 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep5_tp2_pp3 -> layer_12_expert_out_sp3_ep5_tp2_pp3
	layer_12_expert_sp3_ep5_tp3_pp3 [label="Expert L12 SP3 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep5_pp3 -> layer_12_expert_sp3_ep5_tp3_pp3
	layer_12_expert_out_sp3_ep5_tp3_pp3 [label="Expert Out L12 SP3 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep5_tp3_pp3 -> layer_12_expert_out_sp3_ep5_tp3_pp3
	layer_12_expert_ar_sp3_ep5_pp3 [label="Expert All-Reduce L12 SP3 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep5_tp0_pp3 -> layer_12_expert_ar_sp3_ep5_pp3
	layer_12_expert_out_sp3_ep5_tp1_pp3 -> layer_12_expert_ar_sp3_ep5_pp3
	layer_12_expert_out_sp3_ep5_tp2_pp3 -> layer_12_expert_ar_sp3_ep5_pp3
	layer_12_expert_out_sp3_ep5_tp3_pp3 -> layer_12_expert_ar_sp3_ep5_pp3
	layer_12_combine_sp3_ep5_pp3 [label="Token Combine L12 SP3 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep5_pp3 -> layer_12_combine_sp3_ep5_pp3
	layer_12_dispatch_sp3_ep6_pp3 [label="Token Dispatch L12 SP3 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep6_pp3 [style=dashed]
	layer_12_expert_sp3_ep6_tp0_pp3 [label="Expert L12 SP3 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep6_pp3 -> layer_12_expert_sp3_ep6_tp0_pp3
	layer_12_expert_out_sp3_ep6_tp0_pp3 [label="Expert Out L12 SP3 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep6_tp0_pp3 -> layer_12_expert_out_sp3_ep6_tp0_pp3
	layer_12_expert_sp3_ep6_tp1_pp3 [label="Expert L12 SP3 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep6_pp3 -> layer_12_expert_sp3_ep6_tp1_pp3
	layer_12_expert_out_sp3_ep6_tp1_pp3 [label="Expert Out L12 SP3 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep6_tp1_pp3 -> layer_12_expert_out_sp3_ep6_tp1_pp3
	layer_12_expert_sp3_ep6_tp2_pp3 [label="Expert L12 SP3 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep6_pp3 -> layer_12_expert_sp3_ep6_tp2_pp3
	layer_12_expert_out_sp3_ep6_tp2_pp3 [label="Expert Out L12 SP3 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep6_tp2_pp3 -> layer_12_expert_out_sp3_ep6_tp2_pp3
	layer_12_expert_sp3_ep6_tp3_pp3 [label="Expert L12 SP3 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep6_pp3 -> layer_12_expert_sp3_ep6_tp3_pp3
	layer_12_expert_out_sp3_ep6_tp3_pp3 [label="Expert Out L12 SP3 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep6_tp3_pp3 -> layer_12_expert_out_sp3_ep6_tp3_pp3
	layer_12_expert_ar_sp3_ep6_pp3 [label="Expert All-Reduce L12 SP3 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep6_tp0_pp3 -> layer_12_expert_ar_sp3_ep6_pp3
	layer_12_expert_out_sp3_ep6_tp1_pp3 -> layer_12_expert_ar_sp3_ep6_pp3
	layer_12_expert_out_sp3_ep6_tp2_pp3 -> layer_12_expert_ar_sp3_ep6_pp3
	layer_12_expert_out_sp3_ep6_tp3_pp3 -> layer_12_expert_ar_sp3_ep6_pp3
	layer_12_combine_sp3_ep6_pp3 [label="Token Combine L12 SP3 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep6_pp3 -> layer_12_combine_sp3_ep6_pp3
	layer_12_dispatch_sp3_ep7_pp3 [label="Token Dispatch L12 SP3 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep7_pp3 [style=dashed]
	layer_12_expert_sp3_ep7_tp0_pp3 [label="Expert L12 SP3 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep7_pp3 -> layer_12_expert_sp3_ep7_tp0_pp3
	layer_12_expert_out_sp3_ep7_tp0_pp3 [label="Expert Out L12 SP3 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep7_tp0_pp3 -> layer_12_expert_out_sp3_ep7_tp0_pp3
	layer_12_expert_sp3_ep7_tp1_pp3 [label="Expert L12 SP3 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep7_pp3 -> layer_12_expert_sp3_ep7_tp1_pp3
	layer_12_expert_out_sp3_ep7_tp1_pp3 [label="Expert Out L12 SP3 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep7_tp1_pp3 -> layer_12_expert_out_sp3_ep7_tp1_pp3
	layer_12_expert_sp3_ep7_tp2_pp3 [label="Expert L12 SP3 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep7_pp3 -> layer_12_expert_sp3_ep7_tp2_pp3
	layer_12_expert_out_sp3_ep7_tp2_pp3 [label="Expert Out L12 SP3 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep7_tp2_pp3 -> layer_12_expert_out_sp3_ep7_tp2_pp3
	layer_12_expert_sp3_ep7_tp3_pp3 [label="Expert L12 SP3 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep7_pp3 -> layer_12_expert_sp3_ep7_tp3_pp3
	layer_12_expert_out_sp3_ep7_tp3_pp3 [label="Expert Out L12 SP3 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep7_tp3_pp3 -> layer_12_expert_out_sp3_ep7_tp3_pp3
	layer_12_expert_ar_sp3_ep7_pp3 [label="Expert All-Reduce L12 SP3 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep7_tp0_pp3 -> layer_12_expert_ar_sp3_ep7_pp3
	layer_12_expert_out_sp3_ep7_tp1_pp3 -> layer_12_expert_ar_sp3_ep7_pp3
	layer_12_expert_out_sp3_ep7_tp2_pp3 -> layer_12_expert_ar_sp3_ep7_pp3
	layer_12_expert_out_sp3_ep7_tp3_pp3 -> layer_12_expert_ar_sp3_ep7_pp3
	layer_12_combine_sp3_ep7_pp3 [label="Token Combine L12 SP3 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep7_pp3 -> layer_12_combine_sp3_ep7_pp3
	layer_12_dispatch_sp3_ep8_pp3 [label="Token Dispatch L12 SP3 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep8_pp3 [style=dashed]
	layer_12_expert_sp3_ep8_tp0_pp3 [label="Expert L12 SP3 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep8_pp3 -> layer_12_expert_sp3_ep8_tp0_pp3
	layer_12_expert_out_sp3_ep8_tp0_pp3 [label="Expert Out L12 SP3 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep8_tp0_pp3 -> layer_12_expert_out_sp3_ep8_tp0_pp3
	layer_12_expert_sp3_ep8_tp1_pp3 [label="Expert L12 SP3 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep8_pp3 -> layer_12_expert_sp3_ep8_tp1_pp3
	layer_12_expert_out_sp3_ep8_tp1_pp3 [label="Expert Out L12 SP3 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep8_tp1_pp3 -> layer_12_expert_out_sp3_ep8_tp1_pp3
	layer_12_expert_sp3_ep8_tp2_pp3 [label="Expert L12 SP3 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep8_pp3 -> layer_12_expert_sp3_ep8_tp2_pp3
	layer_12_expert_out_sp3_ep8_tp2_pp3 [label="Expert Out L12 SP3 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep8_tp2_pp3 -> layer_12_expert_out_sp3_ep8_tp2_pp3
	layer_12_expert_sp3_ep8_tp3_pp3 [label="Expert L12 SP3 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep8_pp3 -> layer_12_expert_sp3_ep8_tp3_pp3
	layer_12_expert_out_sp3_ep8_tp3_pp3 [label="Expert Out L12 SP3 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep8_tp3_pp3 -> layer_12_expert_out_sp3_ep8_tp3_pp3
	layer_12_expert_ar_sp3_ep8_pp3 [label="Expert All-Reduce L12 SP3 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep8_tp0_pp3 -> layer_12_expert_ar_sp3_ep8_pp3
	layer_12_expert_out_sp3_ep8_tp1_pp3 -> layer_12_expert_ar_sp3_ep8_pp3
	layer_12_expert_out_sp3_ep8_tp2_pp3 -> layer_12_expert_ar_sp3_ep8_pp3
	layer_12_expert_out_sp3_ep8_tp3_pp3 -> layer_12_expert_ar_sp3_ep8_pp3
	layer_12_combine_sp3_ep8_pp3 [label="Token Combine L12 SP3 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep8_pp3 -> layer_12_combine_sp3_ep8_pp3
	layer_12_dispatch_sp3_ep9_pp3 [label="Token Dispatch L12 SP3 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep9_pp3 [style=dashed]
	layer_12_expert_sp3_ep9_tp0_pp3 [label="Expert L12 SP3 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep9_pp3 -> layer_12_expert_sp3_ep9_tp0_pp3
	layer_12_expert_out_sp3_ep9_tp0_pp3 [label="Expert Out L12 SP3 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep9_tp0_pp3 -> layer_12_expert_out_sp3_ep9_tp0_pp3
	layer_12_expert_sp3_ep9_tp1_pp3 [label="Expert L12 SP3 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep9_pp3 -> layer_12_expert_sp3_ep9_tp1_pp3
	layer_12_expert_out_sp3_ep9_tp1_pp3 [label="Expert Out L12 SP3 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep9_tp1_pp3 -> layer_12_expert_out_sp3_ep9_tp1_pp3
	layer_12_expert_sp3_ep9_tp2_pp3 [label="Expert L12 SP3 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep9_pp3 -> layer_12_expert_sp3_ep9_tp2_pp3
	layer_12_expert_out_sp3_ep9_tp2_pp3 [label="Expert Out L12 SP3 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep9_tp2_pp3 -> layer_12_expert_out_sp3_ep9_tp2_pp3
	layer_12_expert_sp3_ep9_tp3_pp3 [label="Expert L12 SP3 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep9_pp3 -> layer_12_expert_sp3_ep9_tp3_pp3
	layer_12_expert_out_sp3_ep9_tp3_pp3 [label="Expert Out L12 SP3 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep9_tp3_pp3 -> layer_12_expert_out_sp3_ep9_tp3_pp3
	layer_12_expert_ar_sp3_ep9_pp3 [label="Expert All-Reduce L12 SP3 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep9_tp0_pp3 -> layer_12_expert_ar_sp3_ep9_pp3
	layer_12_expert_out_sp3_ep9_tp1_pp3 -> layer_12_expert_ar_sp3_ep9_pp3
	layer_12_expert_out_sp3_ep9_tp2_pp3 -> layer_12_expert_ar_sp3_ep9_pp3
	layer_12_expert_out_sp3_ep9_tp3_pp3 -> layer_12_expert_ar_sp3_ep9_pp3
	layer_12_combine_sp3_ep9_pp3 [label="Token Combine L12 SP3 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep9_pp3 -> layer_12_combine_sp3_ep9_pp3
	layer_12_dispatch_sp3_ep10_pp3 [label="Token Dispatch L12 SP3 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep10_pp3 [style=dashed]
	layer_12_expert_sp3_ep10_tp0_pp3 [label="Expert L12 SP3 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep10_pp3 -> layer_12_expert_sp3_ep10_tp0_pp3
	layer_12_expert_out_sp3_ep10_tp0_pp3 [label="Expert Out L12 SP3 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep10_tp0_pp3 -> layer_12_expert_out_sp3_ep10_tp0_pp3
	layer_12_expert_sp3_ep10_tp1_pp3 [label="Expert L12 SP3 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep10_pp3 -> layer_12_expert_sp3_ep10_tp1_pp3
	layer_12_expert_out_sp3_ep10_tp1_pp3 [label="Expert Out L12 SP3 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep10_tp1_pp3 -> layer_12_expert_out_sp3_ep10_tp1_pp3
	layer_12_expert_sp3_ep10_tp2_pp3 [label="Expert L12 SP3 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep10_pp3 -> layer_12_expert_sp3_ep10_tp2_pp3
	layer_12_expert_out_sp3_ep10_tp2_pp3 [label="Expert Out L12 SP3 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep10_tp2_pp3 -> layer_12_expert_out_sp3_ep10_tp2_pp3
	layer_12_expert_sp3_ep10_tp3_pp3 [label="Expert L12 SP3 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep10_pp3 -> layer_12_expert_sp3_ep10_tp3_pp3
	layer_12_expert_out_sp3_ep10_tp3_pp3 [label="Expert Out L12 SP3 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep10_tp3_pp3 -> layer_12_expert_out_sp3_ep10_tp3_pp3
	layer_12_expert_ar_sp3_ep10_pp3 [label="Expert All-Reduce L12 SP3 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep10_tp0_pp3 -> layer_12_expert_ar_sp3_ep10_pp3
	layer_12_expert_out_sp3_ep10_tp1_pp3 -> layer_12_expert_ar_sp3_ep10_pp3
	layer_12_expert_out_sp3_ep10_tp2_pp3 -> layer_12_expert_ar_sp3_ep10_pp3
	layer_12_expert_out_sp3_ep10_tp3_pp3 -> layer_12_expert_ar_sp3_ep10_pp3
	layer_12_combine_sp3_ep10_pp3 [label="Token Combine L12 SP3 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep10_pp3 -> layer_12_combine_sp3_ep10_pp3
	layer_12_dispatch_sp3_ep11_pp3 [label="Token Dispatch L12 SP3 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep11_pp3 [style=dashed]
	layer_12_expert_sp3_ep11_tp0_pp3 [label="Expert L12 SP3 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep11_pp3 -> layer_12_expert_sp3_ep11_tp0_pp3
	layer_12_expert_out_sp3_ep11_tp0_pp3 [label="Expert Out L12 SP3 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep11_tp0_pp3 -> layer_12_expert_out_sp3_ep11_tp0_pp3
	layer_12_expert_sp3_ep11_tp1_pp3 [label="Expert L12 SP3 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep11_pp3 -> layer_12_expert_sp3_ep11_tp1_pp3
	layer_12_expert_out_sp3_ep11_tp1_pp3 [label="Expert Out L12 SP3 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep11_tp1_pp3 -> layer_12_expert_out_sp3_ep11_tp1_pp3
	layer_12_expert_sp3_ep11_tp2_pp3 [label="Expert L12 SP3 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep11_pp3 -> layer_12_expert_sp3_ep11_tp2_pp3
	layer_12_expert_out_sp3_ep11_tp2_pp3 [label="Expert Out L12 SP3 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep11_tp2_pp3 -> layer_12_expert_out_sp3_ep11_tp2_pp3
	layer_12_expert_sp3_ep11_tp3_pp3 [label="Expert L12 SP3 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep11_pp3 -> layer_12_expert_sp3_ep11_tp3_pp3
	layer_12_expert_out_sp3_ep11_tp3_pp3 [label="Expert Out L12 SP3 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep11_tp3_pp3 -> layer_12_expert_out_sp3_ep11_tp3_pp3
	layer_12_expert_ar_sp3_ep11_pp3 [label="Expert All-Reduce L12 SP3 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep11_tp0_pp3 -> layer_12_expert_ar_sp3_ep11_pp3
	layer_12_expert_out_sp3_ep11_tp1_pp3 -> layer_12_expert_ar_sp3_ep11_pp3
	layer_12_expert_out_sp3_ep11_tp2_pp3 -> layer_12_expert_ar_sp3_ep11_pp3
	layer_12_expert_out_sp3_ep11_tp3_pp3 -> layer_12_expert_ar_sp3_ep11_pp3
	layer_12_combine_sp3_ep11_pp3 [label="Token Combine L12 SP3 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep11_pp3 -> layer_12_combine_sp3_ep11_pp3
	layer_12_dispatch_sp3_ep12_pp3 [label="Token Dispatch L12 SP3 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep12_pp3 [style=dashed]
	layer_12_expert_sp3_ep12_tp0_pp3 [label="Expert L12 SP3 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep12_pp3 -> layer_12_expert_sp3_ep12_tp0_pp3
	layer_12_expert_out_sp3_ep12_tp0_pp3 [label="Expert Out L12 SP3 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep12_tp0_pp3 -> layer_12_expert_out_sp3_ep12_tp0_pp3
	layer_12_expert_sp3_ep12_tp1_pp3 [label="Expert L12 SP3 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep12_pp3 -> layer_12_expert_sp3_ep12_tp1_pp3
	layer_12_expert_out_sp3_ep12_tp1_pp3 [label="Expert Out L12 SP3 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep12_tp1_pp3 -> layer_12_expert_out_sp3_ep12_tp1_pp3
	layer_12_expert_sp3_ep12_tp2_pp3 [label="Expert L12 SP3 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep12_pp3 -> layer_12_expert_sp3_ep12_tp2_pp3
	layer_12_expert_out_sp3_ep12_tp2_pp3 [label="Expert Out L12 SP3 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep12_tp2_pp3 -> layer_12_expert_out_sp3_ep12_tp2_pp3
	layer_12_expert_sp3_ep12_tp3_pp3 [label="Expert L12 SP3 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep12_pp3 -> layer_12_expert_sp3_ep12_tp3_pp3
	layer_12_expert_out_sp3_ep12_tp3_pp3 [label="Expert Out L12 SP3 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep12_tp3_pp3 -> layer_12_expert_out_sp3_ep12_tp3_pp3
	layer_12_expert_ar_sp3_ep12_pp3 [label="Expert All-Reduce L12 SP3 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep12_tp0_pp3 -> layer_12_expert_ar_sp3_ep12_pp3
	layer_12_expert_out_sp3_ep12_tp1_pp3 -> layer_12_expert_ar_sp3_ep12_pp3
	layer_12_expert_out_sp3_ep12_tp2_pp3 -> layer_12_expert_ar_sp3_ep12_pp3
	layer_12_expert_out_sp3_ep12_tp3_pp3 -> layer_12_expert_ar_sp3_ep12_pp3
	layer_12_combine_sp3_ep12_pp3 [label="Token Combine L12 SP3 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep12_pp3 -> layer_12_combine_sp3_ep12_pp3
	layer_12_dispatch_sp3_ep13_pp3 [label="Token Dispatch L12 SP3 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep13_pp3 [style=dashed]
	layer_12_expert_sp3_ep13_tp0_pp3 [label="Expert L12 SP3 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep13_pp3 -> layer_12_expert_sp3_ep13_tp0_pp3
	layer_12_expert_out_sp3_ep13_tp0_pp3 [label="Expert Out L12 SP3 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep13_tp0_pp3 -> layer_12_expert_out_sp3_ep13_tp0_pp3
	layer_12_expert_sp3_ep13_tp1_pp3 [label="Expert L12 SP3 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep13_pp3 -> layer_12_expert_sp3_ep13_tp1_pp3
	layer_12_expert_out_sp3_ep13_tp1_pp3 [label="Expert Out L12 SP3 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep13_tp1_pp3 -> layer_12_expert_out_sp3_ep13_tp1_pp3
	layer_12_expert_sp3_ep13_tp2_pp3 [label="Expert L12 SP3 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep13_pp3 -> layer_12_expert_sp3_ep13_tp2_pp3
	layer_12_expert_out_sp3_ep13_tp2_pp3 [label="Expert Out L12 SP3 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep13_tp2_pp3 -> layer_12_expert_out_sp3_ep13_tp2_pp3
	layer_12_expert_sp3_ep13_tp3_pp3 [label="Expert L12 SP3 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep13_pp3 -> layer_12_expert_sp3_ep13_tp3_pp3
	layer_12_expert_out_sp3_ep13_tp3_pp3 [label="Expert Out L12 SP3 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep13_tp3_pp3 -> layer_12_expert_out_sp3_ep13_tp3_pp3
	layer_12_expert_ar_sp3_ep13_pp3 [label="Expert All-Reduce L12 SP3 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep13_tp0_pp3 -> layer_12_expert_ar_sp3_ep13_pp3
	layer_12_expert_out_sp3_ep13_tp1_pp3 -> layer_12_expert_ar_sp3_ep13_pp3
	layer_12_expert_out_sp3_ep13_tp2_pp3 -> layer_12_expert_ar_sp3_ep13_pp3
	layer_12_expert_out_sp3_ep13_tp3_pp3 -> layer_12_expert_ar_sp3_ep13_pp3
	layer_12_combine_sp3_ep13_pp3 [label="Token Combine L12 SP3 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep13_pp3 -> layer_12_combine_sp3_ep13_pp3
	layer_12_dispatch_sp3_ep14_pp3 [label="Token Dispatch L12 SP3 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep14_pp3 [style=dashed]
	layer_12_expert_sp3_ep14_tp0_pp3 [label="Expert L12 SP3 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep14_pp3 -> layer_12_expert_sp3_ep14_tp0_pp3
	layer_12_expert_out_sp3_ep14_tp0_pp3 [label="Expert Out L12 SP3 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep14_tp0_pp3 -> layer_12_expert_out_sp3_ep14_tp0_pp3
	layer_12_expert_sp3_ep14_tp1_pp3 [label="Expert L12 SP3 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep14_pp3 -> layer_12_expert_sp3_ep14_tp1_pp3
	layer_12_expert_out_sp3_ep14_tp1_pp3 [label="Expert Out L12 SP3 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep14_tp1_pp3 -> layer_12_expert_out_sp3_ep14_tp1_pp3
	layer_12_expert_sp3_ep14_tp2_pp3 [label="Expert L12 SP3 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep14_pp3 -> layer_12_expert_sp3_ep14_tp2_pp3
	layer_12_expert_out_sp3_ep14_tp2_pp3 [label="Expert Out L12 SP3 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep14_tp2_pp3 -> layer_12_expert_out_sp3_ep14_tp2_pp3
	layer_12_expert_sp3_ep14_tp3_pp3 [label="Expert L12 SP3 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep14_pp3 -> layer_12_expert_sp3_ep14_tp3_pp3
	layer_12_expert_out_sp3_ep14_tp3_pp3 [label="Expert Out L12 SP3 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep14_tp3_pp3 -> layer_12_expert_out_sp3_ep14_tp3_pp3
	layer_12_expert_ar_sp3_ep14_pp3 [label="Expert All-Reduce L12 SP3 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep14_tp0_pp3 -> layer_12_expert_ar_sp3_ep14_pp3
	layer_12_expert_out_sp3_ep14_tp1_pp3 -> layer_12_expert_ar_sp3_ep14_pp3
	layer_12_expert_out_sp3_ep14_tp2_pp3 -> layer_12_expert_ar_sp3_ep14_pp3
	layer_12_expert_out_sp3_ep14_tp3_pp3 -> layer_12_expert_ar_sp3_ep14_pp3
	layer_12_combine_sp3_ep14_pp3 [label="Token Combine L12 SP3 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep14_pp3 -> layer_12_combine_sp3_ep14_pp3
	layer_12_dispatch_sp3_ep15_pp3 [label="Token Dispatch L12 SP3 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_12_router_sp3_pp3 -> layer_12_dispatch_sp3_ep15_pp3 [style=dashed]
	layer_12_expert_sp3_ep15_tp0_pp3 [label="Expert L12 SP3 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep15_pp3 -> layer_12_expert_sp3_ep15_tp0_pp3
	layer_12_expert_out_sp3_ep15_tp0_pp3 [label="Expert Out L12 SP3 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep15_tp0_pp3 -> layer_12_expert_out_sp3_ep15_tp0_pp3
	layer_12_expert_sp3_ep15_tp1_pp3 [label="Expert L12 SP3 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep15_pp3 -> layer_12_expert_sp3_ep15_tp1_pp3
	layer_12_expert_out_sp3_ep15_tp1_pp3 [label="Expert Out L12 SP3 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep15_tp1_pp3 -> layer_12_expert_out_sp3_ep15_tp1_pp3
	layer_12_expert_sp3_ep15_tp2_pp3 [label="Expert L12 SP3 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep15_pp3 -> layer_12_expert_sp3_ep15_tp2_pp3
	layer_12_expert_out_sp3_ep15_tp2_pp3 [label="Expert Out L12 SP3 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep15_tp2_pp3 -> layer_12_expert_out_sp3_ep15_tp2_pp3
	layer_12_expert_sp3_ep15_tp3_pp3 [label="Expert L12 SP3 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_dispatch_sp3_ep15_pp3 -> layer_12_expert_sp3_ep15_tp3_pp3
	layer_12_expert_out_sp3_ep15_tp3_pp3 [label="Expert Out L12 SP3 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_12_expert_sp3_ep15_tp3_pp3 -> layer_12_expert_out_sp3_ep15_tp3_pp3
	layer_12_expert_ar_sp3_ep15_pp3 [label="Expert All-Reduce L12 SP3 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_12_expert_out_sp3_ep15_tp0_pp3 -> layer_12_expert_ar_sp3_ep15_pp3
	layer_12_expert_out_sp3_ep15_tp1_pp3 -> layer_12_expert_ar_sp3_ep15_pp3
	layer_12_expert_out_sp3_ep15_tp2_pp3 -> layer_12_expert_ar_sp3_ep15_pp3
	layer_12_expert_out_sp3_ep15_tp3_pp3 -> layer_12_expert_ar_sp3_ep15_pp3
	layer_12_combine_sp3_ep15_pp3 [label="Token Combine L12 SP3 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_12_expert_ar_sp3_ep15_pp3 -> layer_12_combine_sp3_ep15_pp3
	layer_12_moe_all2all_sp3_pp3 [label="MoE All-to-All L12 SP3\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_12_combine_sp3_ep0_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep1_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep2_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep3_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep4_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep5_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep6_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep7_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep8_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep9_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep10_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep11_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep12_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep13_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep14_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_combine_sp3_ep15_pp3 -> layer_12_moe_all2all_sp3_pp3
	layer_12_mlp_out_sp3_pp3 [label="MoE Output L12 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_moe_all2all_sp3_pp3 -> layer_12_mlp_out_sp3_pp3
	layer_12_mlp_res_sp3_pp3 [label="MLP Residual L12 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_mlp_out_sp3_pp3 -> layer_12_mlp_res_sp3_pp3
	layer_12_attn_res_sp3_pp3 -> layer_12_mlp_res_sp3_pp3 [style=dashed]
	layer_13_norm_sp0_pp3 [label="LayerNorm L13 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_mlp_out_sp0_pp3 -> layer_13_norm_sp0_pp3
	layer_13_qkv_sp0_tp0_pp3 [label="QKV Proj L13 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp0_pp3 -> layer_13_qkv_sp0_tp0_pp3
	layer_13_attn_sp0_tp0_pp3 [label="Attention L13 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp0_tp0_pp3 -> layer_13_attn_sp0_tp0_pp3
	layer_13_attn_out_sp0_tp0_pp3 [label="Attn Out Proj L13 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp0_tp0_pp3 -> layer_13_attn_out_sp0_tp0_pp3
	layer_13_qkv_sp0_tp1_pp3 [label="QKV Proj L13 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp0_pp3 -> layer_13_qkv_sp0_tp1_pp3
	layer_13_attn_sp0_tp1_pp3 [label="Attention L13 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp0_tp1_pp3 -> layer_13_attn_sp0_tp1_pp3
	layer_13_attn_out_sp0_tp1_pp3 [label="Attn Out Proj L13 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp0_tp1_pp3 -> layer_13_attn_out_sp0_tp1_pp3
	layer_13_qkv_sp0_tp2_pp3 [label="QKV Proj L13 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp0_pp3 -> layer_13_qkv_sp0_tp2_pp3
	layer_13_attn_sp0_tp2_pp3 [label="Attention L13 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp0_tp2_pp3 -> layer_13_attn_sp0_tp2_pp3
	layer_13_attn_out_sp0_tp2_pp3 [label="Attn Out Proj L13 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp0_tp2_pp3 -> layer_13_attn_out_sp0_tp2_pp3
	layer_13_qkv_sp0_tp3_pp3 [label="QKV Proj L13 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp0_pp3 -> layer_13_qkv_sp0_tp3_pp3
	layer_13_attn_sp0_tp3_pp3 [label="Attention L13 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp0_tp3_pp3 -> layer_13_attn_sp0_tp3_pp3
	layer_13_attn_out_sp0_tp3_pp3 [label="Attn Out Proj L13 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp0_tp3_pp3 -> layer_13_attn_out_sp0_tp3_pp3
	layer_13_attn_ar_sp0_pp3 [label="Attention All-Reduce L13 SP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_attn_out_sp0_tp0_pp3 -> layer_13_attn_ar_sp0_pp3
	layer_13_attn_out_sp0_tp1_pp3 -> layer_13_attn_ar_sp0_pp3
	layer_13_attn_out_sp0_tp2_pp3 -> layer_13_attn_ar_sp0_pp3
	layer_13_attn_out_sp0_tp3_pp3 -> layer_13_attn_ar_sp0_pp3
	layer_13_attn_res_sp0_pp3 [label="Attention Residual L13 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_attn_ar_sp0_pp3 -> layer_13_attn_res_sp0_pp3
	layer_13_norm_sp0_pp3 -> layer_13_attn_res_sp0_pp3 [style=dashed]
	layer_13_post_norm_sp0_pp3 [label="Post-Attn Norm L13 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_attn_res_sp0_pp3 -> layer_13_post_norm_sp0_pp3
	layer_13_router_sp0_pp3 [label="MoE Router L13 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_13_post_norm_sp0_pp3 -> layer_13_router_sp0_pp3
	layer_13_dispatch_sp0_ep0_pp3 [label="Token Dispatch L13 SP0 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep0_pp3 [style=dashed]
	layer_13_expert_sp0_ep0_tp0_pp3 [label="Expert L13 SP0 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep0_pp3 -> layer_13_expert_sp0_ep0_tp0_pp3
	layer_13_expert_out_sp0_ep0_tp0_pp3 [label="Expert Out L13 SP0 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep0_tp0_pp3 -> layer_13_expert_out_sp0_ep0_tp0_pp3
	layer_13_expert_sp0_ep0_tp1_pp3 [label="Expert L13 SP0 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep0_pp3 -> layer_13_expert_sp0_ep0_tp1_pp3
	layer_13_expert_out_sp0_ep0_tp1_pp3 [label="Expert Out L13 SP0 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep0_tp1_pp3 -> layer_13_expert_out_sp0_ep0_tp1_pp3
	layer_13_expert_sp0_ep0_tp2_pp3 [label="Expert L13 SP0 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep0_pp3 -> layer_13_expert_sp0_ep0_tp2_pp3
	layer_13_expert_out_sp0_ep0_tp2_pp3 [label="Expert Out L13 SP0 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep0_tp2_pp3 -> layer_13_expert_out_sp0_ep0_tp2_pp3
	layer_13_expert_sp0_ep0_tp3_pp3 [label="Expert L13 SP0 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep0_pp3 -> layer_13_expert_sp0_ep0_tp3_pp3
	layer_13_expert_out_sp0_ep0_tp3_pp3 [label="Expert Out L13 SP0 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep0_tp3_pp3 -> layer_13_expert_out_sp0_ep0_tp3_pp3
	layer_13_expert_ar_sp0_ep0_pp3 [label="Expert All-Reduce L13 SP0 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep0_tp0_pp3 -> layer_13_expert_ar_sp0_ep0_pp3
	layer_13_expert_out_sp0_ep0_tp1_pp3 -> layer_13_expert_ar_sp0_ep0_pp3
	layer_13_expert_out_sp0_ep0_tp2_pp3 -> layer_13_expert_ar_sp0_ep0_pp3
	layer_13_expert_out_sp0_ep0_tp3_pp3 -> layer_13_expert_ar_sp0_ep0_pp3
	layer_13_combine_sp0_ep0_pp3 [label="Token Combine L13 SP0 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep0_pp3 -> layer_13_combine_sp0_ep0_pp3
	layer_13_dispatch_sp0_ep1_pp3 [label="Token Dispatch L13 SP0 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep1_pp3 [style=dashed]
	layer_13_expert_sp0_ep1_tp0_pp3 [label="Expert L13 SP0 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep1_pp3 -> layer_13_expert_sp0_ep1_tp0_pp3
	layer_13_expert_out_sp0_ep1_tp0_pp3 [label="Expert Out L13 SP0 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep1_tp0_pp3 -> layer_13_expert_out_sp0_ep1_tp0_pp3
	layer_13_expert_sp0_ep1_tp1_pp3 [label="Expert L13 SP0 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep1_pp3 -> layer_13_expert_sp0_ep1_tp1_pp3
	layer_13_expert_out_sp0_ep1_tp1_pp3 [label="Expert Out L13 SP0 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep1_tp1_pp3 -> layer_13_expert_out_sp0_ep1_tp1_pp3
	layer_13_expert_sp0_ep1_tp2_pp3 [label="Expert L13 SP0 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep1_pp3 -> layer_13_expert_sp0_ep1_tp2_pp3
	layer_13_expert_out_sp0_ep1_tp2_pp3 [label="Expert Out L13 SP0 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep1_tp2_pp3 -> layer_13_expert_out_sp0_ep1_tp2_pp3
	layer_13_expert_sp0_ep1_tp3_pp3 [label="Expert L13 SP0 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep1_pp3 -> layer_13_expert_sp0_ep1_tp3_pp3
	layer_13_expert_out_sp0_ep1_tp3_pp3 [label="Expert Out L13 SP0 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep1_tp3_pp3 -> layer_13_expert_out_sp0_ep1_tp3_pp3
	layer_13_expert_ar_sp0_ep1_pp3 [label="Expert All-Reduce L13 SP0 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep1_tp0_pp3 -> layer_13_expert_ar_sp0_ep1_pp3
	layer_13_expert_out_sp0_ep1_tp1_pp3 -> layer_13_expert_ar_sp0_ep1_pp3
	layer_13_expert_out_sp0_ep1_tp2_pp3 -> layer_13_expert_ar_sp0_ep1_pp3
	layer_13_expert_out_sp0_ep1_tp3_pp3 -> layer_13_expert_ar_sp0_ep1_pp3
	layer_13_combine_sp0_ep1_pp3 [label="Token Combine L13 SP0 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep1_pp3 -> layer_13_combine_sp0_ep1_pp3
	layer_13_dispatch_sp0_ep2_pp3 [label="Token Dispatch L13 SP0 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep2_pp3 [style=dashed]
	layer_13_expert_sp0_ep2_tp0_pp3 [label="Expert L13 SP0 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep2_pp3 -> layer_13_expert_sp0_ep2_tp0_pp3
	layer_13_expert_out_sp0_ep2_tp0_pp3 [label="Expert Out L13 SP0 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep2_tp0_pp3 -> layer_13_expert_out_sp0_ep2_tp0_pp3
	layer_13_expert_sp0_ep2_tp1_pp3 [label="Expert L13 SP0 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep2_pp3 -> layer_13_expert_sp0_ep2_tp1_pp3
	layer_13_expert_out_sp0_ep2_tp1_pp3 [label="Expert Out L13 SP0 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep2_tp1_pp3 -> layer_13_expert_out_sp0_ep2_tp1_pp3
	layer_13_expert_sp0_ep2_tp2_pp3 [label="Expert L13 SP0 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep2_pp3 -> layer_13_expert_sp0_ep2_tp2_pp3
	layer_13_expert_out_sp0_ep2_tp2_pp3 [label="Expert Out L13 SP0 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep2_tp2_pp3 -> layer_13_expert_out_sp0_ep2_tp2_pp3
	layer_13_expert_sp0_ep2_tp3_pp3 [label="Expert L13 SP0 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep2_pp3 -> layer_13_expert_sp0_ep2_tp3_pp3
	layer_13_expert_out_sp0_ep2_tp3_pp3 [label="Expert Out L13 SP0 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep2_tp3_pp3 -> layer_13_expert_out_sp0_ep2_tp3_pp3
	layer_13_expert_ar_sp0_ep2_pp3 [label="Expert All-Reduce L13 SP0 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep2_tp0_pp3 -> layer_13_expert_ar_sp0_ep2_pp3
	layer_13_expert_out_sp0_ep2_tp1_pp3 -> layer_13_expert_ar_sp0_ep2_pp3
	layer_13_expert_out_sp0_ep2_tp2_pp3 -> layer_13_expert_ar_sp0_ep2_pp3
	layer_13_expert_out_sp0_ep2_tp3_pp3 -> layer_13_expert_ar_sp0_ep2_pp3
	layer_13_combine_sp0_ep2_pp3 [label="Token Combine L13 SP0 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep2_pp3 -> layer_13_combine_sp0_ep2_pp3
	layer_13_dispatch_sp0_ep3_pp3 [label="Token Dispatch L13 SP0 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep3_pp3 [style=dashed]
	layer_13_expert_sp0_ep3_tp0_pp3 [label="Expert L13 SP0 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep3_pp3 -> layer_13_expert_sp0_ep3_tp0_pp3
	layer_13_expert_out_sp0_ep3_tp0_pp3 [label="Expert Out L13 SP0 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep3_tp0_pp3 -> layer_13_expert_out_sp0_ep3_tp0_pp3
	layer_13_expert_sp0_ep3_tp1_pp3 [label="Expert L13 SP0 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep3_pp3 -> layer_13_expert_sp0_ep3_tp1_pp3
	layer_13_expert_out_sp0_ep3_tp1_pp3 [label="Expert Out L13 SP0 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep3_tp1_pp3 -> layer_13_expert_out_sp0_ep3_tp1_pp3
	layer_13_expert_sp0_ep3_tp2_pp3 [label="Expert L13 SP0 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep3_pp3 -> layer_13_expert_sp0_ep3_tp2_pp3
	layer_13_expert_out_sp0_ep3_tp2_pp3 [label="Expert Out L13 SP0 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep3_tp2_pp3 -> layer_13_expert_out_sp0_ep3_tp2_pp3
	layer_13_expert_sp0_ep3_tp3_pp3 [label="Expert L13 SP0 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep3_pp3 -> layer_13_expert_sp0_ep3_tp3_pp3
	layer_13_expert_out_sp0_ep3_tp3_pp3 [label="Expert Out L13 SP0 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep3_tp3_pp3 -> layer_13_expert_out_sp0_ep3_tp3_pp3
	layer_13_expert_ar_sp0_ep3_pp3 [label="Expert All-Reduce L13 SP0 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep3_tp0_pp3 -> layer_13_expert_ar_sp0_ep3_pp3
	layer_13_expert_out_sp0_ep3_tp1_pp3 -> layer_13_expert_ar_sp0_ep3_pp3
	layer_13_expert_out_sp0_ep3_tp2_pp3 -> layer_13_expert_ar_sp0_ep3_pp3
	layer_13_expert_out_sp0_ep3_tp3_pp3 -> layer_13_expert_ar_sp0_ep3_pp3
	layer_13_combine_sp0_ep3_pp3 [label="Token Combine L13 SP0 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep3_pp3 -> layer_13_combine_sp0_ep3_pp3
	layer_13_dispatch_sp0_ep4_pp3 [label="Token Dispatch L13 SP0 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep4_pp3 [style=dashed]
	layer_13_expert_sp0_ep4_tp0_pp3 [label="Expert L13 SP0 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep4_pp3 -> layer_13_expert_sp0_ep4_tp0_pp3
	layer_13_expert_out_sp0_ep4_tp0_pp3 [label="Expert Out L13 SP0 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep4_tp0_pp3 -> layer_13_expert_out_sp0_ep4_tp0_pp3
	layer_13_expert_sp0_ep4_tp1_pp3 [label="Expert L13 SP0 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep4_pp3 -> layer_13_expert_sp0_ep4_tp1_pp3
	layer_13_expert_out_sp0_ep4_tp1_pp3 [label="Expert Out L13 SP0 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep4_tp1_pp3 -> layer_13_expert_out_sp0_ep4_tp1_pp3
	layer_13_expert_sp0_ep4_tp2_pp3 [label="Expert L13 SP0 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep4_pp3 -> layer_13_expert_sp0_ep4_tp2_pp3
	layer_13_expert_out_sp0_ep4_tp2_pp3 [label="Expert Out L13 SP0 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep4_tp2_pp3 -> layer_13_expert_out_sp0_ep4_tp2_pp3
	layer_13_expert_sp0_ep4_tp3_pp3 [label="Expert L13 SP0 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep4_pp3 -> layer_13_expert_sp0_ep4_tp3_pp3
	layer_13_expert_out_sp0_ep4_tp3_pp3 [label="Expert Out L13 SP0 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep4_tp3_pp3 -> layer_13_expert_out_sp0_ep4_tp3_pp3
	layer_13_expert_ar_sp0_ep4_pp3 [label="Expert All-Reduce L13 SP0 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep4_tp0_pp3 -> layer_13_expert_ar_sp0_ep4_pp3
	layer_13_expert_out_sp0_ep4_tp1_pp3 -> layer_13_expert_ar_sp0_ep4_pp3
	layer_13_expert_out_sp0_ep4_tp2_pp3 -> layer_13_expert_ar_sp0_ep4_pp3
	layer_13_expert_out_sp0_ep4_tp3_pp3 -> layer_13_expert_ar_sp0_ep4_pp3
	layer_13_combine_sp0_ep4_pp3 [label="Token Combine L13 SP0 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep4_pp3 -> layer_13_combine_sp0_ep4_pp3
	layer_13_dispatch_sp0_ep5_pp3 [label="Token Dispatch L13 SP0 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep5_pp3 [style=dashed]
	layer_13_expert_sp0_ep5_tp0_pp3 [label="Expert L13 SP0 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep5_pp3 -> layer_13_expert_sp0_ep5_tp0_pp3
	layer_13_expert_out_sp0_ep5_tp0_pp3 [label="Expert Out L13 SP0 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep5_tp0_pp3 -> layer_13_expert_out_sp0_ep5_tp0_pp3
	layer_13_expert_sp0_ep5_tp1_pp3 [label="Expert L13 SP0 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep5_pp3 -> layer_13_expert_sp0_ep5_tp1_pp3
	layer_13_expert_out_sp0_ep5_tp1_pp3 [label="Expert Out L13 SP0 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep5_tp1_pp3 -> layer_13_expert_out_sp0_ep5_tp1_pp3
	layer_13_expert_sp0_ep5_tp2_pp3 [label="Expert L13 SP0 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep5_pp3 -> layer_13_expert_sp0_ep5_tp2_pp3
	layer_13_expert_out_sp0_ep5_tp2_pp3 [label="Expert Out L13 SP0 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep5_tp2_pp3 -> layer_13_expert_out_sp0_ep5_tp2_pp3
	layer_13_expert_sp0_ep5_tp3_pp3 [label="Expert L13 SP0 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep5_pp3 -> layer_13_expert_sp0_ep5_tp3_pp3
	layer_13_expert_out_sp0_ep5_tp3_pp3 [label="Expert Out L13 SP0 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep5_tp3_pp3 -> layer_13_expert_out_sp0_ep5_tp3_pp3
	layer_13_expert_ar_sp0_ep5_pp3 [label="Expert All-Reduce L13 SP0 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep5_tp0_pp3 -> layer_13_expert_ar_sp0_ep5_pp3
	layer_13_expert_out_sp0_ep5_tp1_pp3 -> layer_13_expert_ar_sp0_ep5_pp3
	layer_13_expert_out_sp0_ep5_tp2_pp3 -> layer_13_expert_ar_sp0_ep5_pp3
	layer_13_expert_out_sp0_ep5_tp3_pp3 -> layer_13_expert_ar_sp0_ep5_pp3
	layer_13_combine_sp0_ep5_pp3 [label="Token Combine L13 SP0 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep5_pp3 -> layer_13_combine_sp0_ep5_pp3
	layer_13_dispatch_sp0_ep6_pp3 [label="Token Dispatch L13 SP0 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep6_pp3 [style=dashed]
	layer_13_expert_sp0_ep6_tp0_pp3 [label="Expert L13 SP0 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep6_pp3 -> layer_13_expert_sp0_ep6_tp0_pp3
	layer_13_expert_out_sp0_ep6_tp0_pp3 [label="Expert Out L13 SP0 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep6_tp0_pp3 -> layer_13_expert_out_sp0_ep6_tp0_pp3
	layer_13_expert_sp0_ep6_tp1_pp3 [label="Expert L13 SP0 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep6_pp3 -> layer_13_expert_sp0_ep6_tp1_pp3
	layer_13_expert_out_sp0_ep6_tp1_pp3 [label="Expert Out L13 SP0 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep6_tp1_pp3 -> layer_13_expert_out_sp0_ep6_tp1_pp3
	layer_13_expert_sp0_ep6_tp2_pp3 [label="Expert L13 SP0 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep6_pp3 -> layer_13_expert_sp0_ep6_tp2_pp3
	layer_13_expert_out_sp0_ep6_tp2_pp3 [label="Expert Out L13 SP0 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep6_tp2_pp3 -> layer_13_expert_out_sp0_ep6_tp2_pp3
	layer_13_expert_sp0_ep6_tp3_pp3 [label="Expert L13 SP0 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep6_pp3 -> layer_13_expert_sp0_ep6_tp3_pp3
	layer_13_expert_out_sp0_ep6_tp3_pp3 [label="Expert Out L13 SP0 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep6_tp3_pp3 -> layer_13_expert_out_sp0_ep6_tp3_pp3
	layer_13_expert_ar_sp0_ep6_pp3 [label="Expert All-Reduce L13 SP0 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep6_tp0_pp3 -> layer_13_expert_ar_sp0_ep6_pp3
	layer_13_expert_out_sp0_ep6_tp1_pp3 -> layer_13_expert_ar_sp0_ep6_pp3
	layer_13_expert_out_sp0_ep6_tp2_pp3 -> layer_13_expert_ar_sp0_ep6_pp3
	layer_13_expert_out_sp0_ep6_tp3_pp3 -> layer_13_expert_ar_sp0_ep6_pp3
	layer_13_combine_sp0_ep6_pp3 [label="Token Combine L13 SP0 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep6_pp3 -> layer_13_combine_sp0_ep6_pp3
	layer_13_dispatch_sp0_ep7_pp3 [label="Token Dispatch L13 SP0 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep7_pp3 [style=dashed]
	layer_13_expert_sp0_ep7_tp0_pp3 [label="Expert L13 SP0 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep7_pp3 -> layer_13_expert_sp0_ep7_tp0_pp3
	layer_13_expert_out_sp0_ep7_tp0_pp3 [label="Expert Out L13 SP0 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep7_tp0_pp3 -> layer_13_expert_out_sp0_ep7_tp0_pp3
	layer_13_expert_sp0_ep7_tp1_pp3 [label="Expert L13 SP0 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep7_pp3 -> layer_13_expert_sp0_ep7_tp1_pp3
	layer_13_expert_out_sp0_ep7_tp1_pp3 [label="Expert Out L13 SP0 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep7_tp1_pp3 -> layer_13_expert_out_sp0_ep7_tp1_pp3
	layer_13_expert_sp0_ep7_tp2_pp3 [label="Expert L13 SP0 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep7_pp3 -> layer_13_expert_sp0_ep7_tp2_pp3
	layer_13_expert_out_sp0_ep7_tp2_pp3 [label="Expert Out L13 SP0 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep7_tp2_pp3 -> layer_13_expert_out_sp0_ep7_tp2_pp3
	layer_13_expert_sp0_ep7_tp3_pp3 [label="Expert L13 SP0 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep7_pp3 -> layer_13_expert_sp0_ep7_tp3_pp3
	layer_13_expert_out_sp0_ep7_tp3_pp3 [label="Expert Out L13 SP0 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep7_tp3_pp3 -> layer_13_expert_out_sp0_ep7_tp3_pp3
	layer_13_expert_ar_sp0_ep7_pp3 [label="Expert All-Reduce L13 SP0 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep7_tp0_pp3 -> layer_13_expert_ar_sp0_ep7_pp3
	layer_13_expert_out_sp0_ep7_tp1_pp3 -> layer_13_expert_ar_sp0_ep7_pp3
	layer_13_expert_out_sp0_ep7_tp2_pp3 -> layer_13_expert_ar_sp0_ep7_pp3
	layer_13_expert_out_sp0_ep7_tp3_pp3 -> layer_13_expert_ar_sp0_ep7_pp3
	layer_13_combine_sp0_ep7_pp3 [label="Token Combine L13 SP0 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep7_pp3 -> layer_13_combine_sp0_ep7_pp3
	layer_13_dispatch_sp0_ep8_pp3 [label="Token Dispatch L13 SP0 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep8_pp3 [style=dashed]
	layer_13_expert_sp0_ep8_tp0_pp3 [label="Expert L13 SP0 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep8_pp3 -> layer_13_expert_sp0_ep8_tp0_pp3
	layer_13_expert_out_sp0_ep8_tp0_pp3 [label="Expert Out L13 SP0 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep8_tp0_pp3 -> layer_13_expert_out_sp0_ep8_tp0_pp3
	layer_13_expert_sp0_ep8_tp1_pp3 [label="Expert L13 SP0 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep8_pp3 -> layer_13_expert_sp0_ep8_tp1_pp3
	layer_13_expert_out_sp0_ep8_tp1_pp3 [label="Expert Out L13 SP0 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep8_tp1_pp3 -> layer_13_expert_out_sp0_ep8_tp1_pp3
	layer_13_expert_sp0_ep8_tp2_pp3 [label="Expert L13 SP0 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep8_pp3 -> layer_13_expert_sp0_ep8_tp2_pp3
	layer_13_expert_out_sp0_ep8_tp2_pp3 [label="Expert Out L13 SP0 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep8_tp2_pp3 -> layer_13_expert_out_sp0_ep8_tp2_pp3
	layer_13_expert_sp0_ep8_tp3_pp3 [label="Expert L13 SP0 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep8_pp3 -> layer_13_expert_sp0_ep8_tp3_pp3
	layer_13_expert_out_sp0_ep8_tp3_pp3 [label="Expert Out L13 SP0 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep8_tp3_pp3 -> layer_13_expert_out_sp0_ep8_tp3_pp3
	layer_13_expert_ar_sp0_ep8_pp3 [label="Expert All-Reduce L13 SP0 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep8_tp0_pp3 -> layer_13_expert_ar_sp0_ep8_pp3
	layer_13_expert_out_sp0_ep8_tp1_pp3 -> layer_13_expert_ar_sp0_ep8_pp3
	layer_13_expert_out_sp0_ep8_tp2_pp3 -> layer_13_expert_ar_sp0_ep8_pp3
	layer_13_expert_out_sp0_ep8_tp3_pp3 -> layer_13_expert_ar_sp0_ep8_pp3
	layer_13_combine_sp0_ep8_pp3 [label="Token Combine L13 SP0 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep8_pp3 -> layer_13_combine_sp0_ep8_pp3
	layer_13_dispatch_sp0_ep9_pp3 [label="Token Dispatch L13 SP0 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep9_pp3 [style=dashed]
	layer_13_expert_sp0_ep9_tp0_pp3 [label="Expert L13 SP0 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep9_pp3 -> layer_13_expert_sp0_ep9_tp0_pp3
	layer_13_expert_out_sp0_ep9_tp0_pp3 [label="Expert Out L13 SP0 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep9_tp0_pp3 -> layer_13_expert_out_sp0_ep9_tp0_pp3
	layer_13_expert_sp0_ep9_tp1_pp3 [label="Expert L13 SP0 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep9_pp3 -> layer_13_expert_sp0_ep9_tp1_pp3
	layer_13_expert_out_sp0_ep9_tp1_pp3 [label="Expert Out L13 SP0 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep9_tp1_pp3 -> layer_13_expert_out_sp0_ep9_tp1_pp3
	layer_13_expert_sp0_ep9_tp2_pp3 [label="Expert L13 SP0 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep9_pp3 -> layer_13_expert_sp0_ep9_tp2_pp3
	layer_13_expert_out_sp0_ep9_tp2_pp3 [label="Expert Out L13 SP0 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep9_tp2_pp3 -> layer_13_expert_out_sp0_ep9_tp2_pp3
	layer_13_expert_sp0_ep9_tp3_pp3 [label="Expert L13 SP0 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep9_pp3 -> layer_13_expert_sp0_ep9_tp3_pp3
	layer_13_expert_out_sp0_ep9_tp3_pp3 [label="Expert Out L13 SP0 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep9_tp3_pp3 -> layer_13_expert_out_sp0_ep9_tp3_pp3
	layer_13_expert_ar_sp0_ep9_pp3 [label="Expert All-Reduce L13 SP0 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep9_tp0_pp3 -> layer_13_expert_ar_sp0_ep9_pp3
	layer_13_expert_out_sp0_ep9_tp1_pp3 -> layer_13_expert_ar_sp0_ep9_pp3
	layer_13_expert_out_sp0_ep9_tp2_pp3 -> layer_13_expert_ar_sp0_ep9_pp3
	layer_13_expert_out_sp0_ep9_tp3_pp3 -> layer_13_expert_ar_sp0_ep9_pp3
	layer_13_combine_sp0_ep9_pp3 [label="Token Combine L13 SP0 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep9_pp3 -> layer_13_combine_sp0_ep9_pp3
	layer_13_dispatch_sp0_ep10_pp3 [label="Token Dispatch L13 SP0 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep10_pp3 [style=dashed]
	layer_13_expert_sp0_ep10_tp0_pp3 [label="Expert L13 SP0 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep10_pp3 -> layer_13_expert_sp0_ep10_tp0_pp3
	layer_13_expert_out_sp0_ep10_tp0_pp3 [label="Expert Out L13 SP0 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep10_tp0_pp3 -> layer_13_expert_out_sp0_ep10_tp0_pp3
	layer_13_expert_sp0_ep10_tp1_pp3 [label="Expert L13 SP0 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep10_pp3 -> layer_13_expert_sp0_ep10_tp1_pp3
	layer_13_expert_out_sp0_ep10_tp1_pp3 [label="Expert Out L13 SP0 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep10_tp1_pp3 -> layer_13_expert_out_sp0_ep10_tp1_pp3
	layer_13_expert_sp0_ep10_tp2_pp3 [label="Expert L13 SP0 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep10_pp3 -> layer_13_expert_sp0_ep10_tp2_pp3
	layer_13_expert_out_sp0_ep10_tp2_pp3 [label="Expert Out L13 SP0 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep10_tp2_pp3 -> layer_13_expert_out_sp0_ep10_tp2_pp3
	layer_13_expert_sp0_ep10_tp3_pp3 [label="Expert L13 SP0 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep10_pp3 -> layer_13_expert_sp0_ep10_tp3_pp3
	layer_13_expert_out_sp0_ep10_tp3_pp3 [label="Expert Out L13 SP0 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep10_tp3_pp3 -> layer_13_expert_out_sp0_ep10_tp3_pp3
	layer_13_expert_ar_sp0_ep10_pp3 [label="Expert All-Reduce L13 SP0 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep10_tp0_pp3 -> layer_13_expert_ar_sp0_ep10_pp3
	layer_13_expert_out_sp0_ep10_tp1_pp3 -> layer_13_expert_ar_sp0_ep10_pp3
	layer_13_expert_out_sp0_ep10_tp2_pp3 -> layer_13_expert_ar_sp0_ep10_pp3
	layer_13_expert_out_sp0_ep10_tp3_pp3 -> layer_13_expert_ar_sp0_ep10_pp3
	layer_13_combine_sp0_ep10_pp3 [label="Token Combine L13 SP0 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep10_pp3 -> layer_13_combine_sp0_ep10_pp3
	layer_13_dispatch_sp0_ep11_pp3 [label="Token Dispatch L13 SP0 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep11_pp3 [style=dashed]
	layer_13_expert_sp0_ep11_tp0_pp3 [label="Expert L13 SP0 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep11_pp3 -> layer_13_expert_sp0_ep11_tp0_pp3
	layer_13_expert_out_sp0_ep11_tp0_pp3 [label="Expert Out L13 SP0 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep11_tp0_pp3 -> layer_13_expert_out_sp0_ep11_tp0_pp3
	layer_13_expert_sp0_ep11_tp1_pp3 [label="Expert L13 SP0 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep11_pp3 -> layer_13_expert_sp0_ep11_tp1_pp3
	layer_13_expert_out_sp0_ep11_tp1_pp3 [label="Expert Out L13 SP0 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep11_tp1_pp3 -> layer_13_expert_out_sp0_ep11_tp1_pp3
	layer_13_expert_sp0_ep11_tp2_pp3 [label="Expert L13 SP0 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep11_pp3 -> layer_13_expert_sp0_ep11_tp2_pp3
	layer_13_expert_out_sp0_ep11_tp2_pp3 [label="Expert Out L13 SP0 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep11_tp2_pp3 -> layer_13_expert_out_sp0_ep11_tp2_pp3
	layer_13_expert_sp0_ep11_tp3_pp3 [label="Expert L13 SP0 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep11_pp3 -> layer_13_expert_sp0_ep11_tp3_pp3
	layer_13_expert_out_sp0_ep11_tp3_pp3 [label="Expert Out L13 SP0 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep11_tp3_pp3 -> layer_13_expert_out_sp0_ep11_tp3_pp3
	layer_13_expert_ar_sp0_ep11_pp3 [label="Expert All-Reduce L13 SP0 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep11_tp0_pp3 -> layer_13_expert_ar_sp0_ep11_pp3
	layer_13_expert_out_sp0_ep11_tp1_pp3 -> layer_13_expert_ar_sp0_ep11_pp3
	layer_13_expert_out_sp0_ep11_tp2_pp3 -> layer_13_expert_ar_sp0_ep11_pp3
	layer_13_expert_out_sp0_ep11_tp3_pp3 -> layer_13_expert_ar_sp0_ep11_pp3
	layer_13_combine_sp0_ep11_pp3 [label="Token Combine L13 SP0 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep11_pp3 -> layer_13_combine_sp0_ep11_pp3
	layer_13_dispatch_sp0_ep12_pp3 [label="Token Dispatch L13 SP0 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep12_pp3 [style=dashed]
	layer_13_expert_sp0_ep12_tp0_pp3 [label="Expert L13 SP0 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep12_pp3 -> layer_13_expert_sp0_ep12_tp0_pp3
	layer_13_expert_out_sp0_ep12_tp0_pp3 [label="Expert Out L13 SP0 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep12_tp0_pp3 -> layer_13_expert_out_sp0_ep12_tp0_pp3
	layer_13_expert_sp0_ep12_tp1_pp3 [label="Expert L13 SP0 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep12_pp3 -> layer_13_expert_sp0_ep12_tp1_pp3
	layer_13_expert_out_sp0_ep12_tp1_pp3 [label="Expert Out L13 SP0 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep12_tp1_pp3 -> layer_13_expert_out_sp0_ep12_tp1_pp3
	layer_13_expert_sp0_ep12_tp2_pp3 [label="Expert L13 SP0 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep12_pp3 -> layer_13_expert_sp0_ep12_tp2_pp3
	layer_13_expert_out_sp0_ep12_tp2_pp3 [label="Expert Out L13 SP0 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep12_tp2_pp3 -> layer_13_expert_out_sp0_ep12_tp2_pp3
	layer_13_expert_sp0_ep12_tp3_pp3 [label="Expert L13 SP0 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep12_pp3 -> layer_13_expert_sp0_ep12_tp3_pp3
	layer_13_expert_out_sp0_ep12_tp3_pp3 [label="Expert Out L13 SP0 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep12_tp3_pp3 -> layer_13_expert_out_sp0_ep12_tp3_pp3
	layer_13_expert_ar_sp0_ep12_pp3 [label="Expert All-Reduce L13 SP0 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep12_tp0_pp3 -> layer_13_expert_ar_sp0_ep12_pp3
	layer_13_expert_out_sp0_ep12_tp1_pp3 -> layer_13_expert_ar_sp0_ep12_pp3
	layer_13_expert_out_sp0_ep12_tp2_pp3 -> layer_13_expert_ar_sp0_ep12_pp3
	layer_13_expert_out_sp0_ep12_tp3_pp3 -> layer_13_expert_ar_sp0_ep12_pp3
	layer_13_combine_sp0_ep12_pp3 [label="Token Combine L13 SP0 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep12_pp3 -> layer_13_combine_sp0_ep12_pp3
	layer_13_dispatch_sp0_ep13_pp3 [label="Token Dispatch L13 SP0 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep13_pp3 [style=dashed]
	layer_13_expert_sp0_ep13_tp0_pp3 [label="Expert L13 SP0 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep13_pp3 -> layer_13_expert_sp0_ep13_tp0_pp3
	layer_13_expert_out_sp0_ep13_tp0_pp3 [label="Expert Out L13 SP0 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep13_tp0_pp3 -> layer_13_expert_out_sp0_ep13_tp0_pp3
	layer_13_expert_sp0_ep13_tp1_pp3 [label="Expert L13 SP0 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep13_pp3 -> layer_13_expert_sp0_ep13_tp1_pp3
	layer_13_expert_out_sp0_ep13_tp1_pp3 [label="Expert Out L13 SP0 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep13_tp1_pp3 -> layer_13_expert_out_sp0_ep13_tp1_pp3
	layer_13_expert_sp0_ep13_tp2_pp3 [label="Expert L13 SP0 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep13_pp3 -> layer_13_expert_sp0_ep13_tp2_pp3
	layer_13_expert_out_sp0_ep13_tp2_pp3 [label="Expert Out L13 SP0 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep13_tp2_pp3 -> layer_13_expert_out_sp0_ep13_tp2_pp3
	layer_13_expert_sp0_ep13_tp3_pp3 [label="Expert L13 SP0 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep13_pp3 -> layer_13_expert_sp0_ep13_tp3_pp3
	layer_13_expert_out_sp0_ep13_tp3_pp3 [label="Expert Out L13 SP0 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep13_tp3_pp3 -> layer_13_expert_out_sp0_ep13_tp3_pp3
	layer_13_expert_ar_sp0_ep13_pp3 [label="Expert All-Reduce L13 SP0 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep13_tp0_pp3 -> layer_13_expert_ar_sp0_ep13_pp3
	layer_13_expert_out_sp0_ep13_tp1_pp3 -> layer_13_expert_ar_sp0_ep13_pp3
	layer_13_expert_out_sp0_ep13_tp2_pp3 -> layer_13_expert_ar_sp0_ep13_pp3
	layer_13_expert_out_sp0_ep13_tp3_pp3 -> layer_13_expert_ar_sp0_ep13_pp3
	layer_13_combine_sp0_ep13_pp3 [label="Token Combine L13 SP0 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep13_pp3 -> layer_13_combine_sp0_ep13_pp3
	layer_13_dispatch_sp0_ep14_pp3 [label="Token Dispatch L13 SP0 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep14_pp3 [style=dashed]
	layer_13_expert_sp0_ep14_tp0_pp3 [label="Expert L13 SP0 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep14_pp3 -> layer_13_expert_sp0_ep14_tp0_pp3
	layer_13_expert_out_sp0_ep14_tp0_pp3 [label="Expert Out L13 SP0 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep14_tp0_pp3 -> layer_13_expert_out_sp0_ep14_tp0_pp3
	layer_13_expert_sp0_ep14_tp1_pp3 [label="Expert L13 SP0 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep14_pp3 -> layer_13_expert_sp0_ep14_tp1_pp3
	layer_13_expert_out_sp0_ep14_tp1_pp3 [label="Expert Out L13 SP0 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep14_tp1_pp3 -> layer_13_expert_out_sp0_ep14_tp1_pp3
	layer_13_expert_sp0_ep14_tp2_pp3 [label="Expert L13 SP0 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep14_pp3 -> layer_13_expert_sp0_ep14_tp2_pp3
	layer_13_expert_out_sp0_ep14_tp2_pp3 [label="Expert Out L13 SP0 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep14_tp2_pp3 -> layer_13_expert_out_sp0_ep14_tp2_pp3
	layer_13_expert_sp0_ep14_tp3_pp3 [label="Expert L13 SP0 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep14_pp3 -> layer_13_expert_sp0_ep14_tp3_pp3
	layer_13_expert_out_sp0_ep14_tp3_pp3 [label="Expert Out L13 SP0 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep14_tp3_pp3 -> layer_13_expert_out_sp0_ep14_tp3_pp3
	layer_13_expert_ar_sp0_ep14_pp3 [label="Expert All-Reduce L13 SP0 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep14_tp0_pp3 -> layer_13_expert_ar_sp0_ep14_pp3
	layer_13_expert_out_sp0_ep14_tp1_pp3 -> layer_13_expert_ar_sp0_ep14_pp3
	layer_13_expert_out_sp0_ep14_tp2_pp3 -> layer_13_expert_ar_sp0_ep14_pp3
	layer_13_expert_out_sp0_ep14_tp3_pp3 -> layer_13_expert_ar_sp0_ep14_pp3
	layer_13_combine_sp0_ep14_pp3 [label="Token Combine L13 SP0 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep14_pp3 -> layer_13_combine_sp0_ep14_pp3
	layer_13_dispatch_sp0_ep15_pp3 [label="Token Dispatch L13 SP0 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp0_pp3 -> layer_13_dispatch_sp0_ep15_pp3 [style=dashed]
	layer_13_expert_sp0_ep15_tp0_pp3 [label="Expert L13 SP0 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep15_pp3 -> layer_13_expert_sp0_ep15_tp0_pp3
	layer_13_expert_out_sp0_ep15_tp0_pp3 [label="Expert Out L13 SP0 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep15_tp0_pp3 -> layer_13_expert_out_sp0_ep15_tp0_pp3
	layer_13_expert_sp0_ep15_tp1_pp3 [label="Expert L13 SP0 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep15_pp3 -> layer_13_expert_sp0_ep15_tp1_pp3
	layer_13_expert_out_sp0_ep15_tp1_pp3 [label="Expert Out L13 SP0 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep15_tp1_pp3 -> layer_13_expert_out_sp0_ep15_tp1_pp3
	layer_13_expert_sp0_ep15_tp2_pp3 [label="Expert L13 SP0 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep15_pp3 -> layer_13_expert_sp0_ep15_tp2_pp3
	layer_13_expert_out_sp0_ep15_tp2_pp3 [label="Expert Out L13 SP0 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep15_tp2_pp3 -> layer_13_expert_out_sp0_ep15_tp2_pp3
	layer_13_expert_sp0_ep15_tp3_pp3 [label="Expert L13 SP0 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp0_ep15_pp3 -> layer_13_expert_sp0_ep15_tp3_pp3
	layer_13_expert_out_sp0_ep15_tp3_pp3 [label="Expert Out L13 SP0 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp0_ep15_tp3_pp3 -> layer_13_expert_out_sp0_ep15_tp3_pp3
	layer_13_expert_ar_sp0_ep15_pp3 [label="Expert All-Reduce L13 SP0 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp0_ep15_tp0_pp3 -> layer_13_expert_ar_sp0_ep15_pp3
	layer_13_expert_out_sp0_ep15_tp1_pp3 -> layer_13_expert_ar_sp0_ep15_pp3
	layer_13_expert_out_sp0_ep15_tp2_pp3 -> layer_13_expert_ar_sp0_ep15_pp3
	layer_13_expert_out_sp0_ep15_tp3_pp3 -> layer_13_expert_ar_sp0_ep15_pp3
	layer_13_combine_sp0_ep15_pp3 [label="Token Combine L13 SP0 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp0_ep15_pp3 -> layer_13_combine_sp0_ep15_pp3
	layer_13_moe_all2all_sp0_pp3 [label="MoE All-to-All L13 SP0\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_13_combine_sp0_ep0_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep1_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep2_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep3_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep4_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep5_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep6_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep7_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep8_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep9_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep10_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep11_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep12_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep13_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep14_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_combine_sp0_ep15_pp3 -> layer_13_moe_all2all_sp0_pp3
	layer_13_mlp_out_sp0_pp3 [label="MoE Output L13 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_moe_all2all_sp0_pp3 -> layer_13_mlp_out_sp0_pp3
	layer_13_mlp_res_sp0_pp3 [label="MLP Residual L13 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_mlp_out_sp0_pp3 -> layer_13_mlp_res_sp0_pp3
	layer_13_attn_res_sp0_pp3 -> layer_13_mlp_res_sp0_pp3 [style=dashed]
	layer_13_norm_sp1_pp3 [label="LayerNorm L13 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_mlp_out_sp1_pp3 -> layer_13_norm_sp1_pp3
	layer_13_qkv_sp1_tp0_pp3 [label="QKV Proj L13 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp1_pp3 -> layer_13_qkv_sp1_tp0_pp3
	layer_13_attn_sp1_tp0_pp3 [label="Attention L13 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp1_tp0_pp3 -> layer_13_attn_sp1_tp0_pp3
	layer_13_attn_out_sp1_tp0_pp3 [label="Attn Out Proj L13 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp1_tp0_pp3 -> layer_13_attn_out_sp1_tp0_pp3
	layer_13_qkv_sp1_tp1_pp3 [label="QKV Proj L13 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp1_pp3 -> layer_13_qkv_sp1_tp1_pp3
	layer_13_attn_sp1_tp1_pp3 [label="Attention L13 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp1_tp1_pp3 -> layer_13_attn_sp1_tp1_pp3
	layer_13_attn_out_sp1_tp1_pp3 [label="Attn Out Proj L13 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp1_tp1_pp3 -> layer_13_attn_out_sp1_tp1_pp3
	layer_13_qkv_sp1_tp2_pp3 [label="QKV Proj L13 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp1_pp3 -> layer_13_qkv_sp1_tp2_pp3
	layer_13_attn_sp1_tp2_pp3 [label="Attention L13 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp1_tp2_pp3 -> layer_13_attn_sp1_tp2_pp3
	layer_13_attn_out_sp1_tp2_pp3 [label="Attn Out Proj L13 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp1_tp2_pp3 -> layer_13_attn_out_sp1_tp2_pp3
	layer_13_qkv_sp1_tp3_pp3 [label="QKV Proj L13 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp1_pp3 -> layer_13_qkv_sp1_tp3_pp3
	layer_13_attn_sp1_tp3_pp3 [label="Attention L13 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp1_tp3_pp3 -> layer_13_attn_sp1_tp3_pp3
	layer_13_attn_out_sp1_tp3_pp3 [label="Attn Out Proj L13 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp1_tp3_pp3 -> layer_13_attn_out_sp1_tp3_pp3
	layer_13_attn_ar_sp1_pp3 [label="Attention All-Reduce L13 SP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_attn_out_sp1_tp0_pp3 -> layer_13_attn_ar_sp1_pp3
	layer_13_attn_out_sp1_tp1_pp3 -> layer_13_attn_ar_sp1_pp3
	layer_13_attn_out_sp1_tp2_pp3 -> layer_13_attn_ar_sp1_pp3
	layer_13_attn_out_sp1_tp3_pp3 -> layer_13_attn_ar_sp1_pp3
	layer_13_attn_res_sp1_pp3 [label="Attention Residual L13 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_attn_ar_sp1_pp3 -> layer_13_attn_res_sp1_pp3
	layer_13_norm_sp1_pp3 -> layer_13_attn_res_sp1_pp3 [style=dashed]
	layer_13_post_norm_sp1_pp3 [label="Post-Attn Norm L13 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_attn_res_sp1_pp3 -> layer_13_post_norm_sp1_pp3
	layer_13_router_sp1_pp3 [label="MoE Router L13 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_13_post_norm_sp1_pp3 -> layer_13_router_sp1_pp3
	layer_13_dispatch_sp1_ep0_pp3 [label="Token Dispatch L13 SP1 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep0_pp3 [style=dashed]
	layer_13_expert_sp1_ep0_tp0_pp3 [label="Expert L13 SP1 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep0_pp3 -> layer_13_expert_sp1_ep0_tp0_pp3
	layer_13_expert_out_sp1_ep0_tp0_pp3 [label="Expert Out L13 SP1 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep0_tp0_pp3 -> layer_13_expert_out_sp1_ep0_tp0_pp3
	layer_13_expert_sp1_ep0_tp1_pp3 [label="Expert L13 SP1 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep0_pp3 -> layer_13_expert_sp1_ep0_tp1_pp3
	layer_13_expert_out_sp1_ep0_tp1_pp3 [label="Expert Out L13 SP1 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep0_tp1_pp3 -> layer_13_expert_out_sp1_ep0_tp1_pp3
	layer_13_expert_sp1_ep0_tp2_pp3 [label="Expert L13 SP1 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep0_pp3 -> layer_13_expert_sp1_ep0_tp2_pp3
	layer_13_expert_out_sp1_ep0_tp2_pp3 [label="Expert Out L13 SP1 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep0_tp2_pp3 -> layer_13_expert_out_sp1_ep0_tp2_pp3
	layer_13_expert_sp1_ep0_tp3_pp3 [label="Expert L13 SP1 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep0_pp3 -> layer_13_expert_sp1_ep0_tp3_pp3
	layer_13_expert_out_sp1_ep0_tp3_pp3 [label="Expert Out L13 SP1 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep0_tp3_pp3 -> layer_13_expert_out_sp1_ep0_tp3_pp3
	layer_13_expert_ar_sp1_ep0_pp3 [label="Expert All-Reduce L13 SP1 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep0_tp0_pp3 -> layer_13_expert_ar_sp1_ep0_pp3
	layer_13_expert_out_sp1_ep0_tp1_pp3 -> layer_13_expert_ar_sp1_ep0_pp3
	layer_13_expert_out_sp1_ep0_tp2_pp3 -> layer_13_expert_ar_sp1_ep0_pp3
	layer_13_expert_out_sp1_ep0_tp3_pp3 -> layer_13_expert_ar_sp1_ep0_pp3
	layer_13_combine_sp1_ep0_pp3 [label="Token Combine L13 SP1 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep0_pp3 -> layer_13_combine_sp1_ep0_pp3
	layer_13_dispatch_sp1_ep1_pp3 [label="Token Dispatch L13 SP1 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep1_pp3 [style=dashed]
	layer_13_expert_sp1_ep1_tp0_pp3 [label="Expert L13 SP1 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep1_pp3 -> layer_13_expert_sp1_ep1_tp0_pp3
	layer_13_expert_out_sp1_ep1_tp0_pp3 [label="Expert Out L13 SP1 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep1_tp0_pp3 -> layer_13_expert_out_sp1_ep1_tp0_pp3
	layer_13_expert_sp1_ep1_tp1_pp3 [label="Expert L13 SP1 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep1_pp3 -> layer_13_expert_sp1_ep1_tp1_pp3
	layer_13_expert_out_sp1_ep1_tp1_pp3 [label="Expert Out L13 SP1 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep1_tp1_pp3 -> layer_13_expert_out_sp1_ep1_tp1_pp3
	layer_13_expert_sp1_ep1_tp2_pp3 [label="Expert L13 SP1 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep1_pp3 -> layer_13_expert_sp1_ep1_tp2_pp3
	layer_13_expert_out_sp1_ep1_tp2_pp3 [label="Expert Out L13 SP1 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep1_tp2_pp3 -> layer_13_expert_out_sp1_ep1_tp2_pp3
	layer_13_expert_sp1_ep1_tp3_pp3 [label="Expert L13 SP1 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep1_pp3 -> layer_13_expert_sp1_ep1_tp3_pp3
	layer_13_expert_out_sp1_ep1_tp3_pp3 [label="Expert Out L13 SP1 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep1_tp3_pp3 -> layer_13_expert_out_sp1_ep1_tp3_pp3
	layer_13_expert_ar_sp1_ep1_pp3 [label="Expert All-Reduce L13 SP1 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep1_tp0_pp3 -> layer_13_expert_ar_sp1_ep1_pp3
	layer_13_expert_out_sp1_ep1_tp1_pp3 -> layer_13_expert_ar_sp1_ep1_pp3
	layer_13_expert_out_sp1_ep1_tp2_pp3 -> layer_13_expert_ar_sp1_ep1_pp3
	layer_13_expert_out_sp1_ep1_tp3_pp3 -> layer_13_expert_ar_sp1_ep1_pp3
	layer_13_combine_sp1_ep1_pp3 [label="Token Combine L13 SP1 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep1_pp3 -> layer_13_combine_sp1_ep1_pp3
	layer_13_dispatch_sp1_ep2_pp3 [label="Token Dispatch L13 SP1 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep2_pp3 [style=dashed]
	layer_13_expert_sp1_ep2_tp0_pp3 [label="Expert L13 SP1 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep2_pp3 -> layer_13_expert_sp1_ep2_tp0_pp3
	layer_13_expert_out_sp1_ep2_tp0_pp3 [label="Expert Out L13 SP1 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep2_tp0_pp3 -> layer_13_expert_out_sp1_ep2_tp0_pp3
	layer_13_expert_sp1_ep2_tp1_pp3 [label="Expert L13 SP1 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep2_pp3 -> layer_13_expert_sp1_ep2_tp1_pp3
	layer_13_expert_out_sp1_ep2_tp1_pp3 [label="Expert Out L13 SP1 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep2_tp1_pp3 -> layer_13_expert_out_sp1_ep2_tp1_pp3
	layer_13_expert_sp1_ep2_tp2_pp3 [label="Expert L13 SP1 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep2_pp3 -> layer_13_expert_sp1_ep2_tp2_pp3
	layer_13_expert_out_sp1_ep2_tp2_pp3 [label="Expert Out L13 SP1 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep2_tp2_pp3 -> layer_13_expert_out_sp1_ep2_tp2_pp3
	layer_13_expert_sp1_ep2_tp3_pp3 [label="Expert L13 SP1 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep2_pp3 -> layer_13_expert_sp1_ep2_tp3_pp3
	layer_13_expert_out_sp1_ep2_tp3_pp3 [label="Expert Out L13 SP1 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep2_tp3_pp3 -> layer_13_expert_out_sp1_ep2_tp3_pp3
	layer_13_expert_ar_sp1_ep2_pp3 [label="Expert All-Reduce L13 SP1 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep2_tp0_pp3 -> layer_13_expert_ar_sp1_ep2_pp3
	layer_13_expert_out_sp1_ep2_tp1_pp3 -> layer_13_expert_ar_sp1_ep2_pp3
	layer_13_expert_out_sp1_ep2_tp2_pp3 -> layer_13_expert_ar_sp1_ep2_pp3
	layer_13_expert_out_sp1_ep2_tp3_pp3 -> layer_13_expert_ar_sp1_ep2_pp3
	layer_13_combine_sp1_ep2_pp3 [label="Token Combine L13 SP1 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep2_pp3 -> layer_13_combine_sp1_ep2_pp3
	layer_13_dispatch_sp1_ep3_pp3 [label="Token Dispatch L13 SP1 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep3_pp3 [style=dashed]
	layer_13_expert_sp1_ep3_tp0_pp3 [label="Expert L13 SP1 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep3_pp3 -> layer_13_expert_sp1_ep3_tp0_pp3
	layer_13_expert_out_sp1_ep3_tp0_pp3 [label="Expert Out L13 SP1 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep3_tp0_pp3 -> layer_13_expert_out_sp1_ep3_tp0_pp3
	layer_13_expert_sp1_ep3_tp1_pp3 [label="Expert L13 SP1 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep3_pp3 -> layer_13_expert_sp1_ep3_tp1_pp3
	layer_13_expert_out_sp1_ep3_tp1_pp3 [label="Expert Out L13 SP1 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep3_tp1_pp3 -> layer_13_expert_out_sp1_ep3_tp1_pp3
	layer_13_expert_sp1_ep3_tp2_pp3 [label="Expert L13 SP1 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep3_pp3 -> layer_13_expert_sp1_ep3_tp2_pp3
	layer_13_expert_out_sp1_ep3_tp2_pp3 [label="Expert Out L13 SP1 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep3_tp2_pp3 -> layer_13_expert_out_sp1_ep3_tp2_pp3
	layer_13_expert_sp1_ep3_tp3_pp3 [label="Expert L13 SP1 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep3_pp3 -> layer_13_expert_sp1_ep3_tp3_pp3
	layer_13_expert_out_sp1_ep3_tp3_pp3 [label="Expert Out L13 SP1 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep3_tp3_pp3 -> layer_13_expert_out_sp1_ep3_tp3_pp3
	layer_13_expert_ar_sp1_ep3_pp3 [label="Expert All-Reduce L13 SP1 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep3_tp0_pp3 -> layer_13_expert_ar_sp1_ep3_pp3
	layer_13_expert_out_sp1_ep3_tp1_pp3 -> layer_13_expert_ar_sp1_ep3_pp3
	layer_13_expert_out_sp1_ep3_tp2_pp3 -> layer_13_expert_ar_sp1_ep3_pp3
	layer_13_expert_out_sp1_ep3_tp3_pp3 -> layer_13_expert_ar_sp1_ep3_pp3
	layer_13_combine_sp1_ep3_pp3 [label="Token Combine L13 SP1 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep3_pp3 -> layer_13_combine_sp1_ep3_pp3
	layer_13_dispatch_sp1_ep4_pp3 [label="Token Dispatch L13 SP1 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep4_pp3 [style=dashed]
	layer_13_expert_sp1_ep4_tp0_pp3 [label="Expert L13 SP1 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep4_pp3 -> layer_13_expert_sp1_ep4_tp0_pp3
	layer_13_expert_out_sp1_ep4_tp0_pp3 [label="Expert Out L13 SP1 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep4_tp0_pp3 -> layer_13_expert_out_sp1_ep4_tp0_pp3
	layer_13_expert_sp1_ep4_tp1_pp3 [label="Expert L13 SP1 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep4_pp3 -> layer_13_expert_sp1_ep4_tp1_pp3
	layer_13_expert_out_sp1_ep4_tp1_pp3 [label="Expert Out L13 SP1 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep4_tp1_pp3 -> layer_13_expert_out_sp1_ep4_tp1_pp3
	layer_13_expert_sp1_ep4_tp2_pp3 [label="Expert L13 SP1 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep4_pp3 -> layer_13_expert_sp1_ep4_tp2_pp3
	layer_13_expert_out_sp1_ep4_tp2_pp3 [label="Expert Out L13 SP1 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep4_tp2_pp3 -> layer_13_expert_out_sp1_ep4_tp2_pp3
	layer_13_expert_sp1_ep4_tp3_pp3 [label="Expert L13 SP1 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep4_pp3 -> layer_13_expert_sp1_ep4_tp3_pp3
	layer_13_expert_out_sp1_ep4_tp3_pp3 [label="Expert Out L13 SP1 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep4_tp3_pp3 -> layer_13_expert_out_sp1_ep4_tp3_pp3
	layer_13_expert_ar_sp1_ep4_pp3 [label="Expert All-Reduce L13 SP1 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep4_tp0_pp3 -> layer_13_expert_ar_sp1_ep4_pp3
	layer_13_expert_out_sp1_ep4_tp1_pp3 -> layer_13_expert_ar_sp1_ep4_pp3
	layer_13_expert_out_sp1_ep4_tp2_pp3 -> layer_13_expert_ar_sp1_ep4_pp3
	layer_13_expert_out_sp1_ep4_tp3_pp3 -> layer_13_expert_ar_sp1_ep4_pp3
	layer_13_combine_sp1_ep4_pp3 [label="Token Combine L13 SP1 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep4_pp3 -> layer_13_combine_sp1_ep4_pp3
	layer_13_dispatch_sp1_ep5_pp3 [label="Token Dispatch L13 SP1 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep5_pp3 [style=dashed]
	layer_13_expert_sp1_ep5_tp0_pp3 [label="Expert L13 SP1 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep5_pp3 -> layer_13_expert_sp1_ep5_tp0_pp3
	layer_13_expert_out_sp1_ep5_tp0_pp3 [label="Expert Out L13 SP1 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep5_tp0_pp3 -> layer_13_expert_out_sp1_ep5_tp0_pp3
	layer_13_expert_sp1_ep5_tp1_pp3 [label="Expert L13 SP1 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep5_pp3 -> layer_13_expert_sp1_ep5_tp1_pp3
	layer_13_expert_out_sp1_ep5_tp1_pp3 [label="Expert Out L13 SP1 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep5_tp1_pp3 -> layer_13_expert_out_sp1_ep5_tp1_pp3
	layer_13_expert_sp1_ep5_tp2_pp3 [label="Expert L13 SP1 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep5_pp3 -> layer_13_expert_sp1_ep5_tp2_pp3
	layer_13_expert_out_sp1_ep5_tp2_pp3 [label="Expert Out L13 SP1 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep5_tp2_pp3 -> layer_13_expert_out_sp1_ep5_tp2_pp3
	layer_13_expert_sp1_ep5_tp3_pp3 [label="Expert L13 SP1 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep5_pp3 -> layer_13_expert_sp1_ep5_tp3_pp3
	layer_13_expert_out_sp1_ep5_tp3_pp3 [label="Expert Out L13 SP1 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep5_tp3_pp3 -> layer_13_expert_out_sp1_ep5_tp3_pp3
	layer_13_expert_ar_sp1_ep5_pp3 [label="Expert All-Reduce L13 SP1 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep5_tp0_pp3 -> layer_13_expert_ar_sp1_ep5_pp3
	layer_13_expert_out_sp1_ep5_tp1_pp3 -> layer_13_expert_ar_sp1_ep5_pp3
	layer_13_expert_out_sp1_ep5_tp2_pp3 -> layer_13_expert_ar_sp1_ep5_pp3
	layer_13_expert_out_sp1_ep5_tp3_pp3 -> layer_13_expert_ar_sp1_ep5_pp3
	layer_13_combine_sp1_ep5_pp3 [label="Token Combine L13 SP1 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep5_pp3 -> layer_13_combine_sp1_ep5_pp3
	layer_13_dispatch_sp1_ep6_pp3 [label="Token Dispatch L13 SP1 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep6_pp3 [style=dashed]
	layer_13_expert_sp1_ep6_tp0_pp3 [label="Expert L13 SP1 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep6_pp3 -> layer_13_expert_sp1_ep6_tp0_pp3
	layer_13_expert_out_sp1_ep6_tp0_pp3 [label="Expert Out L13 SP1 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep6_tp0_pp3 -> layer_13_expert_out_sp1_ep6_tp0_pp3
	layer_13_expert_sp1_ep6_tp1_pp3 [label="Expert L13 SP1 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep6_pp3 -> layer_13_expert_sp1_ep6_tp1_pp3
	layer_13_expert_out_sp1_ep6_tp1_pp3 [label="Expert Out L13 SP1 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep6_tp1_pp3 -> layer_13_expert_out_sp1_ep6_tp1_pp3
	layer_13_expert_sp1_ep6_tp2_pp3 [label="Expert L13 SP1 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep6_pp3 -> layer_13_expert_sp1_ep6_tp2_pp3
	layer_13_expert_out_sp1_ep6_tp2_pp3 [label="Expert Out L13 SP1 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep6_tp2_pp3 -> layer_13_expert_out_sp1_ep6_tp2_pp3
	layer_13_expert_sp1_ep6_tp3_pp3 [label="Expert L13 SP1 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep6_pp3 -> layer_13_expert_sp1_ep6_tp3_pp3
	layer_13_expert_out_sp1_ep6_tp3_pp3 [label="Expert Out L13 SP1 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep6_tp3_pp3 -> layer_13_expert_out_sp1_ep6_tp3_pp3
	layer_13_expert_ar_sp1_ep6_pp3 [label="Expert All-Reduce L13 SP1 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep6_tp0_pp3 -> layer_13_expert_ar_sp1_ep6_pp3
	layer_13_expert_out_sp1_ep6_tp1_pp3 -> layer_13_expert_ar_sp1_ep6_pp3
	layer_13_expert_out_sp1_ep6_tp2_pp3 -> layer_13_expert_ar_sp1_ep6_pp3
	layer_13_expert_out_sp1_ep6_tp3_pp3 -> layer_13_expert_ar_sp1_ep6_pp3
	layer_13_combine_sp1_ep6_pp3 [label="Token Combine L13 SP1 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep6_pp3 -> layer_13_combine_sp1_ep6_pp3
	layer_13_dispatch_sp1_ep7_pp3 [label="Token Dispatch L13 SP1 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep7_pp3 [style=dashed]
	layer_13_expert_sp1_ep7_tp0_pp3 [label="Expert L13 SP1 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep7_pp3 -> layer_13_expert_sp1_ep7_tp0_pp3
	layer_13_expert_out_sp1_ep7_tp0_pp3 [label="Expert Out L13 SP1 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep7_tp0_pp3 -> layer_13_expert_out_sp1_ep7_tp0_pp3
	layer_13_expert_sp1_ep7_tp1_pp3 [label="Expert L13 SP1 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep7_pp3 -> layer_13_expert_sp1_ep7_tp1_pp3
	layer_13_expert_out_sp1_ep7_tp1_pp3 [label="Expert Out L13 SP1 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep7_tp1_pp3 -> layer_13_expert_out_sp1_ep7_tp1_pp3
	layer_13_expert_sp1_ep7_tp2_pp3 [label="Expert L13 SP1 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep7_pp3 -> layer_13_expert_sp1_ep7_tp2_pp3
	layer_13_expert_out_sp1_ep7_tp2_pp3 [label="Expert Out L13 SP1 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep7_tp2_pp3 -> layer_13_expert_out_sp1_ep7_tp2_pp3
	layer_13_expert_sp1_ep7_tp3_pp3 [label="Expert L13 SP1 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep7_pp3 -> layer_13_expert_sp1_ep7_tp3_pp3
	layer_13_expert_out_sp1_ep7_tp3_pp3 [label="Expert Out L13 SP1 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep7_tp3_pp3 -> layer_13_expert_out_sp1_ep7_tp3_pp3
	layer_13_expert_ar_sp1_ep7_pp3 [label="Expert All-Reduce L13 SP1 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep7_tp0_pp3 -> layer_13_expert_ar_sp1_ep7_pp3
	layer_13_expert_out_sp1_ep7_tp1_pp3 -> layer_13_expert_ar_sp1_ep7_pp3
	layer_13_expert_out_sp1_ep7_tp2_pp3 -> layer_13_expert_ar_sp1_ep7_pp3
	layer_13_expert_out_sp1_ep7_tp3_pp3 -> layer_13_expert_ar_sp1_ep7_pp3
	layer_13_combine_sp1_ep7_pp3 [label="Token Combine L13 SP1 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep7_pp3 -> layer_13_combine_sp1_ep7_pp3
	layer_13_dispatch_sp1_ep8_pp3 [label="Token Dispatch L13 SP1 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep8_pp3 [style=dashed]
	layer_13_expert_sp1_ep8_tp0_pp3 [label="Expert L13 SP1 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep8_pp3 -> layer_13_expert_sp1_ep8_tp0_pp3
	layer_13_expert_out_sp1_ep8_tp0_pp3 [label="Expert Out L13 SP1 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep8_tp0_pp3 -> layer_13_expert_out_sp1_ep8_tp0_pp3
	layer_13_expert_sp1_ep8_tp1_pp3 [label="Expert L13 SP1 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep8_pp3 -> layer_13_expert_sp1_ep8_tp1_pp3
	layer_13_expert_out_sp1_ep8_tp1_pp3 [label="Expert Out L13 SP1 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep8_tp1_pp3 -> layer_13_expert_out_sp1_ep8_tp1_pp3
	layer_13_expert_sp1_ep8_tp2_pp3 [label="Expert L13 SP1 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep8_pp3 -> layer_13_expert_sp1_ep8_tp2_pp3
	layer_13_expert_out_sp1_ep8_tp2_pp3 [label="Expert Out L13 SP1 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep8_tp2_pp3 -> layer_13_expert_out_sp1_ep8_tp2_pp3
	layer_13_expert_sp1_ep8_tp3_pp3 [label="Expert L13 SP1 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep8_pp3 -> layer_13_expert_sp1_ep8_tp3_pp3
	layer_13_expert_out_sp1_ep8_tp3_pp3 [label="Expert Out L13 SP1 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep8_tp3_pp3 -> layer_13_expert_out_sp1_ep8_tp3_pp3
	layer_13_expert_ar_sp1_ep8_pp3 [label="Expert All-Reduce L13 SP1 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep8_tp0_pp3 -> layer_13_expert_ar_sp1_ep8_pp3
	layer_13_expert_out_sp1_ep8_tp1_pp3 -> layer_13_expert_ar_sp1_ep8_pp3
	layer_13_expert_out_sp1_ep8_tp2_pp3 -> layer_13_expert_ar_sp1_ep8_pp3
	layer_13_expert_out_sp1_ep8_tp3_pp3 -> layer_13_expert_ar_sp1_ep8_pp3
	layer_13_combine_sp1_ep8_pp3 [label="Token Combine L13 SP1 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep8_pp3 -> layer_13_combine_sp1_ep8_pp3
	layer_13_dispatch_sp1_ep9_pp3 [label="Token Dispatch L13 SP1 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep9_pp3 [style=dashed]
	layer_13_expert_sp1_ep9_tp0_pp3 [label="Expert L13 SP1 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep9_pp3 -> layer_13_expert_sp1_ep9_tp0_pp3
	layer_13_expert_out_sp1_ep9_tp0_pp3 [label="Expert Out L13 SP1 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep9_tp0_pp3 -> layer_13_expert_out_sp1_ep9_tp0_pp3
	layer_13_expert_sp1_ep9_tp1_pp3 [label="Expert L13 SP1 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep9_pp3 -> layer_13_expert_sp1_ep9_tp1_pp3
	layer_13_expert_out_sp1_ep9_tp1_pp3 [label="Expert Out L13 SP1 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep9_tp1_pp3 -> layer_13_expert_out_sp1_ep9_tp1_pp3
	layer_13_expert_sp1_ep9_tp2_pp3 [label="Expert L13 SP1 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep9_pp3 -> layer_13_expert_sp1_ep9_tp2_pp3
	layer_13_expert_out_sp1_ep9_tp2_pp3 [label="Expert Out L13 SP1 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep9_tp2_pp3 -> layer_13_expert_out_sp1_ep9_tp2_pp3
	layer_13_expert_sp1_ep9_tp3_pp3 [label="Expert L13 SP1 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep9_pp3 -> layer_13_expert_sp1_ep9_tp3_pp3
	layer_13_expert_out_sp1_ep9_tp3_pp3 [label="Expert Out L13 SP1 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep9_tp3_pp3 -> layer_13_expert_out_sp1_ep9_tp3_pp3
	layer_13_expert_ar_sp1_ep9_pp3 [label="Expert All-Reduce L13 SP1 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep9_tp0_pp3 -> layer_13_expert_ar_sp1_ep9_pp3
	layer_13_expert_out_sp1_ep9_tp1_pp3 -> layer_13_expert_ar_sp1_ep9_pp3
	layer_13_expert_out_sp1_ep9_tp2_pp3 -> layer_13_expert_ar_sp1_ep9_pp3
	layer_13_expert_out_sp1_ep9_tp3_pp3 -> layer_13_expert_ar_sp1_ep9_pp3
	layer_13_combine_sp1_ep9_pp3 [label="Token Combine L13 SP1 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep9_pp3 -> layer_13_combine_sp1_ep9_pp3
	layer_13_dispatch_sp1_ep10_pp3 [label="Token Dispatch L13 SP1 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep10_pp3 [style=dashed]
	layer_13_expert_sp1_ep10_tp0_pp3 [label="Expert L13 SP1 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep10_pp3 -> layer_13_expert_sp1_ep10_tp0_pp3
	layer_13_expert_out_sp1_ep10_tp0_pp3 [label="Expert Out L13 SP1 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep10_tp0_pp3 -> layer_13_expert_out_sp1_ep10_tp0_pp3
	layer_13_expert_sp1_ep10_tp1_pp3 [label="Expert L13 SP1 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep10_pp3 -> layer_13_expert_sp1_ep10_tp1_pp3
	layer_13_expert_out_sp1_ep10_tp1_pp3 [label="Expert Out L13 SP1 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep10_tp1_pp3 -> layer_13_expert_out_sp1_ep10_tp1_pp3
	layer_13_expert_sp1_ep10_tp2_pp3 [label="Expert L13 SP1 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep10_pp3 -> layer_13_expert_sp1_ep10_tp2_pp3
	layer_13_expert_out_sp1_ep10_tp2_pp3 [label="Expert Out L13 SP1 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep10_tp2_pp3 -> layer_13_expert_out_sp1_ep10_tp2_pp3
	layer_13_expert_sp1_ep10_tp3_pp3 [label="Expert L13 SP1 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep10_pp3 -> layer_13_expert_sp1_ep10_tp3_pp3
	layer_13_expert_out_sp1_ep10_tp3_pp3 [label="Expert Out L13 SP1 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep10_tp3_pp3 -> layer_13_expert_out_sp1_ep10_tp3_pp3
	layer_13_expert_ar_sp1_ep10_pp3 [label="Expert All-Reduce L13 SP1 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep10_tp0_pp3 -> layer_13_expert_ar_sp1_ep10_pp3
	layer_13_expert_out_sp1_ep10_tp1_pp3 -> layer_13_expert_ar_sp1_ep10_pp3
	layer_13_expert_out_sp1_ep10_tp2_pp3 -> layer_13_expert_ar_sp1_ep10_pp3
	layer_13_expert_out_sp1_ep10_tp3_pp3 -> layer_13_expert_ar_sp1_ep10_pp3
	layer_13_combine_sp1_ep10_pp3 [label="Token Combine L13 SP1 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep10_pp3 -> layer_13_combine_sp1_ep10_pp3
	layer_13_dispatch_sp1_ep11_pp3 [label="Token Dispatch L13 SP1 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep11_pp3 [style=dashed]
	layer_13_expert_sp1_ep11_tp0_pp3 [label="Expert L13 SP1 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep11_pp3 -> layer_13_expert_sp1_ep11_tp0_pp3
	layer_13_expert_out_sp1_ep11_tp0_pp3 [label="Expert Out L13 SP1 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep11_tp0_pp3 -> layer_13_expert_out_sp1_ep11_tp0_pp3
	layer_13_expert_sp1_ep11_tp1_pp3 [label="Expert L13 SP1 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep11_pp3 -> layer_13_expert_sp1_ep11_tp1_pp3
	layer_13_expert_out_sp1_ep11_tp1_pp3 [label="Expert Out L13 SP1 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep11_tp1_pp3 -> layer_13_expert_out_sp1_ep11_tp1_pp3
	layer_13_expert_sp1_ep11_tp2_pp3 [label="Expert L13 SP1 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep11_pp3 -> layer_13_expert_sp1_ep11_tp2_pp3
	layer_13_expert_out_sp1_ep11_tp2_pp3 [label="Expert Out L13 SP1 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep11_tp2_pp3 -> layer_13_expert_out_sp1_ep11_tp2_pp3
	layer_13_expert_sp1_ep11_tp3_pp3 [label="Expert L13 SP1 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep11_pp3 -> layer_13_expert_sp1_ep11_tp3_pp3
	layer_13_expert_out_sp1_ep11_tp3_pp3 [label="Expert Out L13 SP1 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep11_tp3_pp3 -> layer_13_expert_out_sp1_ep11_tp3_pp3
	layer_13_expert_ar_sp1_ep11_pp3 [label="Expert All-Reduce L13 SP1 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep11_tp0_pp3 -> layer_13_expert_ar_sp1_ep11_pp3
	layer_13_expert_out_sp1_ep11_tp1_pp3 -> layer_13_expert_ar_sp1_ep11_pp3
	layer_13_expert_out_sp1_ep11_tp2_pp3 -> layer_13_expert_ar_sp1_ep11_pp3
	layer_13_expert_out_sp1_ep11_tp3_pp3 -> layer_13_expert_ar_sp1_ep11_pp3
	layer_13_combine_sp1_ep11_pp3 [label="Token Combine L13 SP1 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep11_pp3 -> layer_13_combine_sp1_ep11_pp3
	layer_13_dispatch_sp1_ep12_pp3 [label="Token Dispatch L13 SP1 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep12_pp3 [style=dashed]
	layer_13_expert_sp1_ep12_tp0_pp3 [label="Expert L13 SP1 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep12_pp3 -> layer_13_expert_sp1_ep12_tp0_pp3
	layer_13_expert_out_sp1_ep12_tp0_pp3 [label="Expert Out L13 SP1 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep12_tp0_pp3 -> layer_13_expert_out_sp1_ep12_tp0_pp3
	layer_13_expert_sp1_ep12_tp1_pp3 [label="Expert L13 SP1 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep12_pp3 -> layer_13_expert_sp1_ep12_tp1_pp3
	layer_13_expert_out_sp1_ep12_tp1_pp3 [label="Expert Out L13 SP1 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep12_tp1_pp3 -> layer_13_expert_out_sp1_ep12_tp1_pp3
	layer_13_expert_sp1_ep12_tp2_pp3 [label="Expert L13 SP1 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep12_pp3 -> layer_13_expert_sp1_ep12_tp2_pp3
	layer_13_expert_out_sp1_ep12_tp2_pp3 [label="Expert Out L13 SP1 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep12_tp2_pp3 -> layer_13_expert_out_sp1_ep12_tp2_pp3
	layer_13_expert_sp1_ep12_tp3_pp3 [label="Expert L13 SP1 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep12_pp3 -> layer_13_expert_sp1_ep12_tp3_pp3
	layer_13_expert_out_sp1_ep12_tp3_pp3 [label="Expert Out L13 SP1 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep12_tp3_pp3 -> layer_13_expert_out_sp1_ep12_tp3_pp3
	layer_13_expert_ar_sp1_ep12_pp3 [label="Expert All-Reduce L13 SP1 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep12_tp0_pp3 -> layer_13_expert_ar_sp1_ep12_pp3
	layer_13_expert_out_sp1_ep12_tp1_pp3 -> layer_13_expert_ar_sp1_ep12_pp3
	layer_13_expert_out_sp1_ep12_tp2_pp3 -> layer_13_expert_ar_sp1_ep12_pp3
	layer_13_expert_out_sp1_ep12_tp3_pp3 -> layer_13_expert_ar_sp1_ep12_pp3
	layer_13_combine_sp1_ep12_pp3 [label="Token Combine L13 SP1 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep12_pp3 -> layer_13_combine_sp1_ep12_pp3
	layer_13_dispatch_sp1_ep13_pp3 [label="Token Dispatch L13 SP1 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep13_pp3 [style=dashed]
	layer_13_expert_sp1_ep13_tp0_pp3 [label="Expert L13 SP1 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep13_pp3 -> layer_13_expert_sp1_ep13_tp0_pp3
	layer_13_expert_out_sp1_ep13_tp0_pp3 [label="Expert Out L13 SP1 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep13_tp0_pp3 -> layer_13_expert_out_sp1_ep13_tp0_pp3
	layer_13_expert_sp1_ep13_tp1_pp3 [label="Expert L13 SP1 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep13_pp3 -> layer_13_expert_sp1_ep13_tp1_pp3
	layer_13_expert_out_sp1_ep13_tp1_pp3 [label="Expert Out L13 SP1 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep13_tp1_pp3 -> layer_13_expert_out_sp1_ep13_tp1_pp3
	layer_13_expert_sp1_ep13_tp2_pp3 [label="Expert L13 SP1 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep13_pp3 -> layer_13_expert_sp1_ep13_tp2_pp3
	layer_13_expert_out_sp1_ep13_tp2_pp3 [label="Expert Out L13 SP1 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep13_tp2_pp3 -> layer_13_expert_out_sp1_ep13_tp2_pp3
	layer_13_expert_sp1_ep13_tp3_pp3 [label="Expert L13 SP1 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep13_pp3 -> layer_13_expert_sp1_ep13_tp3_pp3
	layer_13_expert_out_sp1_ep13_tp3_pp3 [label="Expert Out L13 SP1 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep13_tp3_pp3 -> layer_13_expert_out_sp1_ep13_tp3_pp3
	layer_13_expert_ar_sp1_ep13_pp3 [label="Expert All-Reduce L13 SP1 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep13_tp0_pp3 -> layer_13_expert_ar_sp1_ep13_pp3
	layer_13_expert_out_sp1_ep13_tp1_pp3 -> layer_13_expert_ar_sp1_ep13_pp3
	layer_13_expert_out_sp1_ep13_tp2_pp3 -> layer_13_expert_ar_sp1_ep13_pp3
	layer_13_expert_out_sp1_ep13_tp3_pp3 -> layer_13_expert_ar_sp1_ep13_pp3
	layer_13_combine_sp1_ep13_pp3 [label="Token Combine L13 SP1 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep13_pp3 -> layer_13_combine_sp1_ep13_pp3
	layer_13_dispatch_sp1_ep14_pp3 [label="Token Dispatch L13 SP1 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep14_pp3 [style=dashed]
	layer_13_expert_sp1_ep14_tp0_pp3 [label="Expert L13 SP1 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep14_pp3 -> layer_13_expert_sp1_ep14_tp0_pp3
	layer_13_expert_out_sp1_ep14_tp0_pp3 [label="Expert Out L13 SP1 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep14_tp0_pp3 -> layer_13_expert_out_sp1_ep14_tp0_pp3
	layer_13_expert_sp1_ep14_tp1_pp3 [label="Expert L13 SP1 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep14_pp3 -> layer_13_expert_sp1_ep14_tp1_pp3
	layer_13_expert_out_sp1_ep14_tp1_pp3 [label="Expert Out L13 SP1 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep14_tp1_pp3 -> layer_13_expert_out_sp1_ep14_tp1_pp3
	layer_13_expert_sp1_ep14_tp2_pp3 [label="Expert L13 SP1 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep14_pp3 -> layer_13_expert_sp1_ep14_tp2_pp3
	layer_13_expert_out_sp1_ep14_tp2_pp3 [label="Expert Out L13 SP1 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep14_tp2_pp3 -> layer_13_expert_out_sp1_ep14_tp2_pp3
	layer_13_expert_sp1_ep14_tp3_pp3 [label="Expert L13 SP1 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep14_pp3 -> layer_13_expert_sp1_ep14_tp3_pp3
	layer_13_expert_out_sp1_ep14_tp3_pp3 [label="Expert Out L13 SP1 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep14_tp3_pp3 -> layer_13_expert_out_sp1_ep14_tp3_pp3
	layer_13_expert_ar_sp1_ep14_pp3 [label="Expert All-Reduce L13 SP1 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep14_tp0_pp3 -> layer_13_expert_ar_sp1_ep14_pp3
	layer_13_expert_out_sp1_ep14_tp1_pp3 -> layer_13_expert_ar_sp1_ep14_pp3
	layer_13_expert_out_sp1_ep14_tp2_pp3 -> layer_13_expert_ar_sp1_ep14_pp3
	layer_13_expert_out_sp1_ep14_tp3_pp3 -> layer_13_expert_ar_sp1_ep14_pp3
	layer_13_combine_sp1_ep14_pp3 [label="Token Combine L13 SP1 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep14_pp3 -> layer_13_combine_sp1_ep14_pp3
	layer_13_dispatch_sp1_ep15_pp3 [label="Token Dispatch L13 SP1 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp1_pp3 -> layer_13_dispatch_sp1_ep15_pp3 [style=dashed]
	layer_13_expert_sp1_ep15_tp0_pp3 [label="Expert L13 SP1 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep15_pp3 -> layer_13_expert_sp1_ep15_tp0_pp3
	layer_13_expert_out_sp1_ep15_tp0_pp3 [label="Expert Out L13 SP1 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep15_tp0_pp3 -> layer_13_expert_out_sp1_ep15_tp0_pp3
	layer_13_expert_sp1_ep15_tp1_pp3 [label="Expert L13 SP1 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep15_pp3 -> layer_13_expert_sp1_ep15_tp1_pp3
	layer_13_expert_out_sp1_ep15_tp1_pp3 [label="Expert Out L13 SP1 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep15_tp1_pp3 -> layer_13_expert_out_sp1_ep15_tp1_pp3
	layer_13_expert_sp1_ep15_tp2_pp3 [label="Expert L13 SP1 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep15_pp3 -> layer_13_expert_sp1_ep15_tp2_pp3
	layer_13_expert_out_sp1_ep15_tp2_pp3 [label="Expert Out L13 SP1 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep15_tp2_pp3 -> layer_13_expert_out_sp1_ep15_tp2_pp3
	layer_13_expert_sp1_ep15_tp3_pp3 [label="Expert L13 SP1 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp1_ep15_pp3 -> layer_13_expert_sp1_ep15_tp3_pp3
	layer_13_expert_out_sp1_ep15_tp3_pp3 [label="Expert Out L13 SP1 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp1_ep15_tp3_pp3 -> layer_13_expert_out_sp1_ep15_tp3_pp3
	layer_13_expert_ar_sp1_ep15_pp3 [label="Expert All-Reduce L13 SP1 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp1_ep15_tp0_pp3 -> layer_13_expert_ar_sp1_ep15_pp3
	layer_13_expert_out_sp1_ep15_tp1_pp3 -> layer_13_expert_ar_sp1_ep15_pp3
	layer_13_expert_out_sp1_ep15_tp2_pp3 -> layer_13_expert_ar_sp1_ep15_pp3
	layer_13_expert_out_sp1_ep15_tp3_pp3 -> layer_13_expert_ar_sp1_ep15_pp3
	layer_13_combine_sp1_ep15_pp3 [label="Token Combine L13 SP1 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp1_ep15_pp3 -> layer_13_combine_sp1_ep15_pp3
	layer_13_moe_all2all_sp1_pp3 [label="MoE All-to-All L13 SP1\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_13_combine_sp1_ep0_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep1_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep2_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep3_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep4_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep5_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep6_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep7_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep8_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep9_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep10_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep11_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep12_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep13_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep14_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_combine_sp1_ep15_pp3 -> layer_13_moe_all2all_sp1_pp3
	layer_13_mlp_out_sp1_pp3 [label="MoE Output L13 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_moe_all2all_sp1_pp3 -> layer_13_mlp_out_sp1_pp3
	layer_13_mlp_res_sp1_pp3 [label="MLP Residual L13 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_mlp_out_sp1_pp3 -> layer_13_mlp_res_sp1_pp3
	layer_13_attn_res_sp1_pp3 -> layer_13_mlp_res_sp1_pp3 [style=dashed]
	layer_13_norm_sp2_pp3 [label="LayerNorm L13 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_mlp_out_sp2_pp3 -> layer_13_norm_sp2_pp3
	layer_13_qkv_sp2_tp0_pp3 [label="QKV Proj L13 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp2_pp3 -> layer_13_qkv_sp2_tp0_pp3
	layer_13_attn_sp2_tp0_pp3 [label="Attention L13 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp2_tp0_pp3 -> layer_13_attn_sp2_tp0_pp3
	layer_13_attn_out_sp2_tp0_pp3 [label="Attn Out Proj L13 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp2_tp0_pp3 -> layer_13_attn_out_sp2_tp0_pp3
	layer_13_qkv_sp2_tp1_pp3 [label="QKV Proj L13 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp2_pp3 -> layer_13_qkv_sp2_tp1_pp3
	layer_13_attn_sp2_tp1_pp3 [label="Attention L13 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp2_tp1_pp3 -> layer_13_attn_sp2_tp1_pp3
	layer_13_attn_out_sp2_tp1_pp3 [label="Attn Out Proj L13 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp2_tp1_pp3 -> layer_13_attn_out_sp2_tp1_pp3
	layer_13_qkv_sp2_tp2_pp3 [label="QKV Proj L13 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp2_pp3 -> layer_13_qkv_sp2_tp2_pp3
	layer_13_attn_sp2_tp2_pp3 [label="Attention L13 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp2_tp2_pp3 -> layer_13_attn_sp2_tp2_pp3
	layer_13_attn_out_sp2_tp2_pp3 [label="Attn Out Proj L13 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp2_tp2_pp3 -> layer_13_attn_out_sp2_tp2_pp3
	layer_13_qkv_sp2_tp3_pp3 [label="QKV Proj L13 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp2_pp3 -> layer_13_qkv_sp2_tp3_pp3
	layer_13_attn_sp2_tp3_pp3 [label="Attention L13 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp2_tp3_pp3 -> layer_13_attn_sp2_tp3_pp3
	layer_13_attn_out_sp2_tp3_pp3 [label="Attn Out Proj L13 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp2_tp3_pp3 -> layer_13_attn_out_sp2_tp3_pp3
	layer_13_attn_ar_sp2_pp3 [label="Attention All-Reduce L13 SP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_attn_out_sp2_tp0_pp3 -> layer_13_attn_ar_sp2_pp3
	layer_13_attn_out_sp2_tp1_pp3 -> layer_13_attn_ar_sp2_pp3
	layer_13_attn_out_sp2_tp2_pp3 -> layer_13_attn_ar_sp2_pp3
	layer_13_attn_out_sp2_tp3_pp3 -> layer_13_attn_ar_sp2_pp3
	layer_13_attn_res_sp2_pp3 [label="Attention Residual L13 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_attn_ar_sp2_pp3 -> layer_13_attn_res_sp2_pp3
	layer_13_norm_sp2_pp3 -> layer_13_attn_res_sp2_pp3 [style=dashed]
	layer_13_post_norm_sp2_pp3 [label="Post-Attn Norm L13 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_attn_res_sp2_pp3 -> layer_13_post_norm_sp2_pp3
	layer_13_router_sp2_pp3 [label="MoE Router L13 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_13_post_norm_sp2_pp3 -> layer_13_router_sp2_pp3
	layer_13_dispatch_sp2_ep0_pp3 [label="Token Dispatch L13 SP2 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep0_pp3 [style=dashed]
	layer_13_expert_sp2_ep0_tp0_pp3 [label="Expert L13 SP2 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep0_pp3 -> layer_13_expert_sp2_ep0_tp0_pp3
	layer_13_expert_out_sp2_ep0_tp0_pp3 [label="Expert Out L13 SP2 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep0_tp0_pp3 -> layer_13_expert_out_sp2_ep0_tp0_pp3
	layer_13_expert_sp2_ep0_tp1_pp3 [label="Expert L13 SP2 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep0_pp3 -> layer_13_expert_sp2_ep0_tp1_pp3
	layer_13_expert_out_sp2_ep0_tp1_pp3 [label="Expert Out L13 SP2 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep0_tp1_pp3 -> layer_13_expert_out_sp2_ep0_tp1_pp3
	layer_13_expert_sp2_ep0_tp2_pp3 [label="Expert L13 SP2 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep0_pp3 -> layer_13_expert_sp2_ep0_tp2_pp3
	layer_13_expert_out_sp2_ep0_tp2_pp3 [label="Expert Out L13 SP2 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep0_tp2_pp3 -> layer_13_expert_out_sp2_ep0_tp2_pp3
	layer_13_expert_sp2_ep0_tp3_pp3 [label="Expert L13 SP2 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep0_pp3 -> layer_13_expert_sp2_ep0_tp3_pp3
	layer_13_expert_out_sp2_ep0_tp3_pp3 [label="Expert Out L13 SP2 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep0_tp3_pp3 -> layer_13_expert_out_sp2_ep0_tp3_pp3
	layer_13_expert_ar_sp2_ep0_pp3 [label="Expert All-Reduce L13 SP2 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep0_tp0_pp3 -> layer_13_expert_ar_sp2_ep0_pp3
	layer_13_expert_out_sp2_ep0_tp1_pp3 -> layer_13_expert_ar_sp2_ep0_pp3
	layer_13_expert_out_sp2_ep0_tp2_pp3 -> layer_13_expert_ar_sp2_ep0_pp3
	layer_13_expert_out_sp2_ep0_tp3_pp3 -> layer_13_expert_ar_sp2_ep0_pp3
	layer_13_combine_sp2_ep0_pp3 [label="Token Combine L13 SP2 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep0_pp3 -> layer_13_combine_sp2_ep0_pp3
	layer_13_dispatch_sp2_ep1_pp3 [label="Token Dispatch L13 SP2 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep1_pp3 [style=dashed]
	layer_13_expert_sp2_ep1_tp0_pp3 [label="Expert L13 SP2 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep1_pp3 -> layer_13_expert_sp2_ep1_tp0_pp3
	layer_13_expert_out_sp2_ep1_tp0_pp3 [label="Expert Out L13 SP2 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep1_tp0_pp3 -> layer_13_expert_out_sp2_ep1_tp0_pp3
	layer_13_expert_sp2_ep1_tp1_pp3 [label="Expert L13 SP2 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep1_pp3 -> layer_13_expert_sp2_ep1_tp1_pp3
	layer_13_expert_out_sp2_ep1_tp1_pp3 [label="Expert Out L13 SP2 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep1_tp1_pp3 -> layer_13_expert_out_sp2_ep1_tp1_pp3
	layer_13_expert_sp2_ep1_tp2_pp3 [label="Expert L13 SP2 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep1_pp3 -> layer_13_expert_sp2_ep1_tp2_pp3
	layer_13_expert_out_sp2_ep1_tp2_pp3 [label="Expert Out L13 SP2 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep1_tp2_pp3 -> layer_13_expert_out_sp2_ep1_tp2_pp3
	layer_13_expert_sp2_ep1_tp3_pp3 [label="Expert L13 SP2 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep1_pp3 -> layer_13_expert_sp2_ep1_tp3_pp3
	layer_13_expert_out_sp2_ep1_tp3_pp3 [label="Expert Out L13 SP2 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep1_tp3_pp3 -> layer_13_expert_out_sp2_ep1_tp3_pp3
	layer_13_expert_ar_sp2_ep1_pp3 [label="Expert All-Reduce L13 SP2 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep1_tp0_pp3 -> layer_13_expert_ar_sp2_ep1_pp3
	layer_13_expert_out_sp2_ep1_tp1_pp3 -> layer_13_expert_ar_sp2_ep1_pp3
	layer_13_expert_out_sp2_ep1_tp2_pp3 -> layer_13_expert_ar_sp2_ep1_pp3
	layer_13_expert_out_sp2_ep1_tp3_pp3 -> layer_13_expert_ar_sp2_ep1_pp3
	layer_13_combine_sp2_ep1_pp3 [label="Token Combine L13 SP2 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep1_pp3 -> layer_13_combine_sp2_ep1_pp3
	layer_13_dispatch_sp2_ep2_pp3 [label="Token Dispatch L13 SP2 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep2_pp3 [style=dashed]
	layer_13_expert_sp2_ep2_tp0_pp3 [label="Expert L13 SP2 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep2_pp3 -> layer_13_expert_sp2_ep2_tp0_pp3
	layer_13_expert_out_sp2_ep2_tp0_pp3 [label="Expert Out L13 SP2 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep2_tp0_pp3 -> layer_13_expert_out_sp2_ep2_tp0_pp3
	layer_13_expert_sp2_ep2_tp1_pp3 [label="Expert L13 SP2 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep2_pp3 -> layer_13_expert_sp2_ep2_tp1_pp3
	layer_13_expert_out_sp2_ep2_tp1_pp3 [label="Expert Out L13 SP2 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep2_tp1_pp3 -> layer_13_expert_out_sp2_ep2_tp1_pp3
	layer_13_expert_sp2_ep2_tp2_pp3 [label="Expert L13 SP2 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep2_pp3 -> layer_13_expert_sp2_ep2_tp2_pp3
	layer_13_expert_out_sp2_ep2_tp2_pp3 [label="Expert Out L13 SP2 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep2_tp2_pp3 -> layer_13_expert_out_sp2_ep2_tp2_pp3
	layer_13_expert_sp2_ep2_tp3_pp3 [label="Expert L13 SP2 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep2_pp3 -> layer_13_expert_sp2_ep2_tp3_pp3
	layer_13_expert_out_sp2_ep2_tp3_pp3 [label="Expert Out L13 SP2 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep2_tp3_pp3 -> layer_13_expert_out_sp2_ep2_tp3_pp3
	layer_13_expert_ar_sp2_ep2_pp3 [label="Expert All-Reduce L13 SP2 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep2_tp0_pp3 -> layer_13_expert_ar_sp2_ep2_pp3
	layer_13_expert_out_sp2_ep2_tp1_pp3 -> layer_13_expert_ar_sp2_ep2_pp3
	layer_13_expert_out_sp2_ep2_tp2_pp3 -> layer_13_expert_ar_sp2_ep2_pp3
	layer_13_expert_out_sp2_ep2_tp3_pp3 -> layer_13_expert_ar_sp2_ep2_pp3
	layer_13_combine_sp2_ep2_pp3 [label="Token Combine L13 SP2 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep2_pp3 -> layer_13_combine_sp2_ep2_pp3
	layer_13_dispatch_sp2_ep3_pp3 [label="Token Dispatch L13 SP2 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep3_pp3 [style=dashed]
	layer_13_expert_sp2_ep3_tp0_pp3 [label="Expert L13 SP2 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep3_pp3 -> layer_13_expert_sp2_ep3_tp0_pp3
	layer_13_expert_out_sp2_ep3_tp0_pp3 [label="Expert Out L13 SP2 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep3_tp0_pp3 -> layer_13_expert_out_sp2_ep3_tp0_pp3
	layer_13_expert_sp2_ep3_tp1_pp3 [label="Expert L13 SP2 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep3_pp3 -> layer_13_expert_sp2_ep3_tp1_pp3
	layer_13_expert_out_sp2_ep3_tp1_pp3 [label="Expert Out L13 SP2 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep3_tp1_pp3 -> layer_13_expert_out_sp2_ep3_tp1_pp3
	layer_13_expert_sp2_ep3_tp2_pp3 [label="Expert L13 SP2 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep3_pp3 -> layer_13_expert_sp2_ep3_tp2_pp3
	layer_13_expert_out_sp2_ep3_tp2_pp3 [label="Expert Out L13 SP2 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep3_tp2_pp3 -> layer_13_expert_out_sp2_ep3_tp2_pp3
	layer_13_expert_sp2_ep3_tp3_pp3 [label="Expert L13 SP2 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep3_pp3 -> layer_13_expert_sp2_ep3_tp3_pp3
	layer_13_expert_out_sp2_ep3_tp3_pp3 [label="Expert Out L13 SP2 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep3_tp3_pp3 -> layer_13_expert_out_sp2_ep3_tp3_pp3
	layer_13_expert_ar_sp2_ep3_pp3 [label="Expert All-Reduce L13 SP2 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep3_tp0_pp3 -> layer_13_expert_ar_sp2_ep3_pp3
	layer_13_expert_out_sp2_ep3_tp1_pp3 -> layer_13_expert_ar_sp2_ep3_pp3
	layer_13_expert_out_sp2_ep3_tp2_pp3 -> layer_13_expert_ar_sp2_ep3_pp3
	layer_13_expert_out_sp2_ep3_tp3_pp3 -> layer_13_expert_ar_sp2_ep3_pp3
	layer_13_combine_sp2_ep3_pp3 [label="Token Combine L13 SP2 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep3_pp3 -> layer_13_combine_sp2_ep3_pp3
	layer_13_dispatch_sp2_ep4_pp3 [label="Token Dispatch L13 SP2 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep4_pp3 [style=dashed]
	layer_13_expert_sp2_ep4_tp0_pp3 [label="Expert L13 SP2 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep4_pp3 -> layer_13_expert_sp2_ep4_tp0_pp3
	layer_13_expert_out_sp2_ep4_tp0_pp3 [label="Expert Out L13 SP2 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep4_tp0_pp3 -> layer_13_expert_out_sp2_ep4_tp0_pp3
	layer_13_expert_sp2_ep4_tp1_pp3 [label="Expert L13 SP2 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep4_pp3 -> layer_13_expert_sp2_ep4_tp1_pp3
	layer_13_expert_out_sp2_ep4_tp1_pp3 [label="Expert Out L13 SP2 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep4_tp1_pp3 -> layer_13_expert_out_sp2_ep4_tp1_pp3
	layer_13_expert_sp2_ep4_tp2_pp3 [label="Expert L13 SP2 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep4_pp3 -> layer_13_expert_sp2_ep4_tp2_pp3
	layer_13_expert_out_sp2_ep4_tp2_pp3 [label="Expert Out L13 SP2 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep4_tp2_pp3 -> layer_13_expert_out_sp2_ep4_tp2_pp3
	layer_13_expert_sp2_ep4_tp3_pp3 [label="Expert L13 SP2 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep4_pp3 -> layer_13_expert_sp2_ep4_tp3_pp3
	layer_13_expert_out_sp2_ep4_tp3_pp3 [label="Expert Out L13 SP2 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep4_tp3_pp3 -> layer_13_expert_out_sp2_ep4_tp3_pp3
	layer_13_expert_ar_sp2_ep4_pp3 [label="Expert All-Reduce L13 SP2 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep4_tp0_pp3 -> layer_13_expert_ar_sp2_ep4_pp3
	layer_13_expert_out_sp2_ep4_tp1_pp3 -> layer_13_expert_ar_sp2_ep4_pp3
	layer_13_expert_out_sp2_ep4_tp2_pp3 -> layer_13_expert_ar_sp2_ep4_pp3
	layer_13_expert_out_sp2_ep4_tp3_pp3 -> layer_13_expert_ar_sp2_ep4_pp3
	layer_13_combine_sp2_ep4_pp3 [label="Token Combine L13 SP2 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep4_pp3 -> layer_13_combine_sp2_ep4_pp3
	layer_13_dispatch_sp2_ep5_pp3 [label="Token Dispatch L13 SP2 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep5_pp3 [style=dashed]
	layer_13_expert_sp2_ep5_tp0_pp3 [label="Expert L13 SP2 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep5_pp3 -> layer_13_expert_sp2_ep5_tp0_pp3
	layer_13_expert_out_sp2_ep5_tp0_pp3 [label="Expert Out L13 SP2 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep5_tp0_pp3 -> layer_13_expert_out_sp2_ep5_tp0_pp3
	layer_13_expert_sp2_ep5_tp1_pp3 [label="Expert L13 SP2 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep5_pp3 -> layer_13_expert_sp2_ep5_tp1_pp3
	layer_13_expert_out_sp2_ep5_tp1_pp3 [label="Expert Out L13 SP2 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep5_tp1_pp3 -> layer_13_expert_out_sp2_ep5_tp1_pp3
	layer_13_expert_sp2_ep5_tp2_pp3 [label="Expert L13 SP2 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep5_pp3 -> layer_13_expert_sp2_ep5_tp2_pp3
	layer_13_expert_out_sp2_ep5_tp2_pp3 [label="Expert Out L13 SP2 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep5_tp2_pp3 -> layer_13_expert_out_sp2_ep5_tp2_pp3
	layer_13_expert_sp2_ep5_tp3_pp3 [label="Expert L13 SP2 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep5_pp3 -> layer_13_expert_sp2_ep5_tp3_pp3
	layer_13_expert_out_sp2_ep5_tp3_pp3 [label="Expert Out L13 SP2 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep5_tp3_pp3 -> layer_13_expert_out_sp2_ep5_tp3_pp3
	layer_13_expert_ar_sp2_ep5_pp3 [label="Expert All-Reduce L13 SP2 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep5_tp0_pp3 -> layer_13_expert_ar_sp2_ep5_pp3
	layer_13_expert_out_sp2_ep5_tp1_pp3 -> layer_13_expert_ar_sp2_ep5_pp3
	layer_13_expert_out_sp2_ep5_tp2_pp3 -> layer_13_expert_ar_sp2_ep5_pp3
	layer_13_expert_out_sp2_ep5_tp3_pp3 -> layer_13_expert_ar_sp2_ep5_pp3
	layer_13_combine_sp2_ep5_pp3 [label="Token Combine L13 SP2 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep5_pp3 -> layer_13_combine_sp2_ep5_pp3
	layer_13_dispatch_sp2_ep6_pp3 [label="Token Dispatch L13 SP2 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep6_pp3 [style=dashed]
	layer_13_expert_sp2_ep6_tp0_pp3 [label="Expert L13 SP2 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep6_pp3 -> layer_13_expert_sp2_ep6_tp0_pp3
	layer_13_expert_out_sp2_ep6_tp0_pp3 [label="Expert Out L13 SP2 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep6_tp0_pp3 -> layer_13_expert_out_sp2_ep6_tp0_pp3
	layer_13_expert_sp2_ep6_tp1_pp3 [label="Expert L13 SP2 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep6_pp3 -> layer_13_expert_sp2_ep6_tp1_pp3
	layer_13_expert_out_sp2_ep6_tp1_pp3 [label="Expert Out L13 SP2 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep6_tp1_pp3 -> layer_13_expert_out_sp2_ep6_tp1_pp3
	layer_13_expert_sp2_ep6_tp2_pp3 [label="Expert L13 SP2 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep6_pp3 -> layer_13_expert_sp2_ep6_tp2_pp3
	layer_13_expert_out_sp2_ep6_tp2_pp3 [label="Expert Out L13 SP2 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep6_tp2_pp3 -> layer_13_expert_out_sp2_ep6_tp2_pp3
	layer_13_expert_sp2_ep6_tp3_pp3 [label="Expert L13 SP2 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep6_pp3 -> layer_13_expert_sp2_ep6_tp3_pp3
	layer_13_expert_out_sp2_ep6_tp3_pp3 [label="Expert Out L13 SP2 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep6_tp3_pp3 -> layer_13_expert_out_sp2_ep6_tp3_pp3
	layer_13_expert_ar_sp2_ep6_pp3 [label="Expert All-Reduce L13 SP2 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep6_tp0_pp3 -> layer_13_expert_ar_sp2_ep6_pp3
	layer_13_expert_out_sp2_ep6_tp1_pp3 -> layer_13_expert_ar_sp2_ep6_pp3
	layer_13_expert_out_sp2_ep6_tp2_pp3 -> layer_13_expert_ar_sp2_ep6_pp3
	layer_13_expert_out_sp2_ep6_tp3_pp3 -> layer_13_expert_ar_sp2_ep6_pp3
	layer_13_combine_sp2_ep6_pp3 [label="Token Combine L13 SP2 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep6_pp3 -> layer_13_combine_sp2_ep6_pp3
	layer_13_dispatch_sp2_ep7_pp3 [label="Token Dispatch L13 SP2 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep7_pp3 [style=dashed]
	layer_13_expert_sp2_ep7_tp0_pp3 [label="Expert L13 SP2 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep7_pp3 -> layer_13_expert_sp2_ep7_tp0_pp3
	layer_13_expert_out_sp2_ep7_tp0_pp3 [label="Expert Out L13 SP2 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep7_tp0_pp3 -> layer_13_expert_out_sp2_ep7_tp0_pp3
	layer_13_expert_sp2_ep7_tp1_pp3 [label="Expert L13 SP2 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep7_pp3 -> layer_13_expert_sp2_ep7_tp1_pp3
	layer_13_expert_out_sp2_ep7_tp1_pp3 [label="Expert Out L13 SP2 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep7_tp1_pp3 -> layer_13_expert_out_sp2_ep7_tp1_pp3
	layer_13_expert_sp2_ep7_tp2_pp3 [label="Expert L13 SP2 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep7_pp3 -> layer_13_expert_sp2_ep7_tp2_pp3
	layer_13_expert_out_sp2_ep7_tp2_pp3 [label="Expert Out L13 SP2 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep7_tp2_pp3 -> layer_13_expert_out_sp2_ep7_tp2_pp3
	layer_13_expert_sp2_ep7_tp3_pp3 [label="Expert L13 SP2 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep7_pp3 -> layer_13_expert_sp2_ep7_tp3_pp3
	layer_13_expert_out_sp2_ep7_tp3_pp3 [label="Expert Out L13 SP2 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep7_tp3_pp3 -> layer_13_expert_out_sp2_ep7_tp3_pp3
	layer_13_expert_ar_sp2_ep7_pp3 [label="Expert All-Reduce L13 SP2 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep7_tp0_pp3 -> layer_13_expert_ar_sp2_ep7_pp3
	layer_13_expert_out_sp2_ep7_tp1_pp3 -> layer_13_expert_ar_sp2_ep7_pp3
	layer_13_expert_out_sp2_ep7_tp2_pp3 -> layer_13_expert_ar_sp2_ep7_pp3
	layer_13_expert_out_sp2_ep7_tp3_pp3 -> layer_13_expert_ar_sp2_ep7_pp3
	layer_13_combine_sp2_ep7_pp3 [label="Token Combine L13 SP2 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep7_pp3 -> layer_13_combine_sp2_ep7_pp3
	layer_13_dispatch_sp2_ep8_pp3 [label="Token Dispatch L13 SP2 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep8_pp3 [style=dashed]
	layer_13_expert_sp2_ep8_tp0_pp3 [label="Expert L13 SP2 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep8_pp3 -> layer_13_expert_sp2_ep8_tp0_pp3
	layer_13_expert_out_sp2_ep8_tp0_pp3 [label="Expert Out L13 SP2 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep8_tp0_pp3 -> layer_13_expert_out_sp2_ep8_tp0_pp3
	layer_13_expert_sp2_ep8_tp1_pp3 [label="Expert L13 SP2 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep8_pp3 -> layer_13_expert_sp2_ep8_tp1_pp3
	layer_13_expert_out_sp2_ep8_tp1_pp3 [label="Expert Out L13 SP2 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep8_tp1_pp3 -> layer_13_expert_out_sp2_ep8_tp1_pp3
	layer_13_expert_sp2_ep8_tp2_pp3 [label="Expert L13 SP2 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep8_pp3 -> layer_13_expert_sp2_ep8_tp2_pp3
	layer_13_expert_out_sp2_ep8_tp2_pp3 [label="Expert Out L13 SP2 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep8_tp2_pp3 -> layer_13_expert_out_sp2_ep8_tp2_pp3
	layer_13_expert_sp2_ep8_tp3_pp3 [label="Expert L13 SP2 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep8_pp3 -> layer_13_expert_sp2_ep8_tp3_pp3
	layer_13_expert_out_sp2_ep8_tp3_pp3 [label="Expert Out L13 SP2 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep8_tp3_pp3 -> layer_13_expert_out_sp2_ep8_tp3_pp3
	layer_13_expert_ar_sp2_ep8_pp3 [label="Expert All-Reduce L13 SP2 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep8_tp0_pp3 -> layer_13_expert_ar_sp2_ep8_pp3
	layer_13_expert_out_sp2_ep8_tp1_pp3 -> layer_13_expert_ar_sp2_ep8_pp3
	layer_13_expert_out_sp2_ep8_tp2_pp3 -> layer_13_expert_ar_sp2_ep8_pp3
	layer_13_expert_out_sp2_ep8_tp3_pp3 -> layer_13_expert_ar_sp2_ep8_pp3
	layer_13_combine_sp2_ep8_pp3 [label="Token Combine L13 SP2 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep8_pp3 -> layer_13_combine_sp2_ep8_pp3
	layer_13_dispatch_sp2_ep9_pp3 [label="Token Dispatch L13 SP2 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep9_pp3 [style=dashed]
	layer_13_expert_sp2_ep9_tp0_pp3 [label="Expert L13 SP2 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep9_pp3 -> layer_13_expert_sp2_ep9_tp0_pp3
	layer_13_expert_out_sp2_ep9_tp0_pp3 [label="Expert Out L13 SP2 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep9_tp0_pp3 -> layer_13_expert_out_sp2_ep9_tp0_pp3
	layer_13_expert_sp2_ep9_tp1_pp3 [label="Expert L13 SP2 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep9_pp3 -> layer_13_expert_sp2_ep9_tp1_pp3
	layer_13_expert_out_sp2_ep9_tp1_pp3 [label="Expert Out L13 SP2 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep9_tp1_pp3 -> layer_13_expert_out_sp2_ep9_tp1_pp3
	layer_13_expert_sp2_ep9_tp2_pp3 [label="Expert L13 SP2 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep9_pp3 -> layer_13_expert_sp2_ep9_tp2_pp3
	layer_13_expert_out_sp2_ep9_tp2_pp3 [label="Expert Out L13 SP2 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep9_tp2_pp3 -> layer_13_expert_out_sp2_ep9_tp2_pp3
	layer_13_expert_sp2_ep9_tp3_pp3 [label="Expert L13 SP2 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep9_pp3 -> layer_13_expert_sp2_ep9_tp3_pp3
	layer_13_expert_out_sp2_ep9_tp3_pp3 [label="Expert Out L13 SP2 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep9_tp3_pp3 -> layer_13_expert_out_sp2_ep9_tp3_pp3
	layer_13_expert_ar_sp2_ep9_pp3 [label="Expert All-Reduce L13 SP2 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep9_tp0_pp3 -> layer_13_expert_ar_sp2_ep9_pp3
	layer_13_expert_out_sp2_ep9_tp1_pp3 -> layer_13_expert_ar_sp2_ep9_pp3
	layer_13_expert_out_sp2_ep9_tp2_pp3 -> layer_13_expert_ar_sp2_ep9_pp3
	layer_13_expert_out_sp2_ep9_tp3_pp3 -> layer_13_expert_ar_sp2_ep9_pp3
	layer_13_combine_sp2_ep9_pp3 [label="Token Combine L13 SP2 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep9_pp3 -> layer_13_combine_sp2_ep9_pp3
	layer_13_dispatch_sp2_ep10_pp3 [label="Token Dispatch L13 SP2 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep10_pp3 [style=dashed]
	layer_13_expert_sp2_ep10_tp0_pp3 [label="Expert L13 SP2 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep10_pp3 -> layer_13_expert_sp2_ep10_tp0_pp3
	layer_13_expert_out_sp2_ep10_tp0_pp3 [label="Expert Out L13 SP2 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep10_tp0_pp3 -> layer_13_expert_out_sp2_ep10_tp0_pp3
	layer_13_expert_sp2_ep10_tp1_pp3 [label="Expert L13 SP2 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep10_pp3 -> layer_13_expert_sp2_ep10_tp1_pp3
	layer_13_expert_out_sp2_ep10_tp1_pp3 [label="Expert Out L13 SP2 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep10_tp1_pp3 -> layer_13_expert_out_sp2_ep10_tp1_pp3
	layer_13_expert_sp2_ep10_tp2_pp3 [label="Expert L13 SP2 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep10_pp3 -> layer_13_expert_sp2_ep10_tp2_pp3
	layer_13_expert_out_sp2_ep10_tp2_pp3 [label="Expert Out L13 SP2 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep10_tp2_pp3 -> layer_13_expert_out_sp2_ep10_tp2_pp3
	layer_13_expert_sp2_ep10_tp3_pp3 [label="Expert L13 SP2 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep10_pp3 -> layer_13_expert_sp2_ep10_tp3_pp3
	layer_13_expert_out_sp2_ep10_tp3_pp3 [label="Expert Out L13 SP2 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep10_tp3_pp3 -> layer_13_expert_out_sp2_ep10_tp3_pp3
	layer_13_expert_ar_sp2_ep10_pp3 [label="Expert All-Reduce L13 SP2 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep10_tp0_pp3 -> layer_13_expert_ar_sp2_ep10_pp3
	layer_13_expert_out_sp2_ep10_tp1_pp3 -> layer_13_expert_ar_sp2_ep10_pp3
	layer_13_expert_out_sp2_ep10_tp2_pp3 -> layer_13_expert_ar_sp2_ep10_pp3
	layer_13_expert_out_sp2_ep10_tp3_pp3 -> layer_13_expert_ar_sp2_ep10_pp3
	layer_13_combine_sp2_ep10_pp3 [label="Token Combine L13 SP2 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep10_pp3 -> layer_13_combine_sp2_ep10_pp3
	layer_13_dispatch_sp2_ep11_pp3 [label="Token Dispatch L13 SP2 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep11_pp3 [style=dashed]
	layer_13_expert_sp2_ep11_tp0_pp3 [label="Expert L13 SP2 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep11_pp3 -> layer_13_expert_sp2_ep11_tp0_pp3
	layer_13_expert_out_sp2_ep11_tp0_pp3 [label="Expert Out L13 SP2 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep11_tp0_pp3 -> layer_13_expert_out_sp2_ep11_tp0_pp3
	layer_13_expert_sp2_ep11_tp1_pp3 [label="Expert L13 SP2 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep11_pp3 -> layer_13_expert_sp2_ep11_tp1_pp3
	layer_13_expert_out_sp2_ep11_tp1_pp3 [label="Expert Out L13 SP2 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep11_tp1_pp3 -> layer_13_expert_out_sp2_ep11_tp1_pp3
	layer_13_expert_sp2_ep11_tp2_pp3 [label="Expert L13 SP2 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep11_pp3 -> layer_13_expert_sp2_ep11_tp2_pp3
	layer_13_expert_out_sp2_ep11_tp2_pp3 [label="Expert Out L13 SP2 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep11_tp2_pp3 -> layer_13_expert_out_sp2_ep11_tp2_pp3
	layer_13_expert_sp2_ep11_tp3_pp3 [label="Expert L13 SP2 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep11_pp3 -> layer_13_expert_sp2_ep11_tp3_pp3
	layer_13_expert_out_sp2_ep11_tp3_pp3 [label="Expert Out L13 SP2 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep11_tp3_pp3 -> layer_13_expert_out_sp2_ep11_tp3_pp3
	layer_13_expert_ar_sp2_ep11_pp3 [label="Expert All-Reduce L13 SP2 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep11_tp0_pp3 -> layer_13_expert_ar_sp2_ep11_pp3
	layer_13_expert_out_sp2_ep11_tp1_pp3 -> layer_13_expert_ar_sp2_ep11_pp3
	layer_13_expert_out_sp2_ep11_tp2_pp3 -> layer_13_expert_ar_sp2_ep11_pp3
	layer_13_expert_out_sp2_ep11_tp3_pp3 -> layer_13_expert_ar_sp2_ep11_pp3
	layer_13_combine_sp2_ep11_pp3 [label="Token Combine L13 SP2 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep11_pp3 -> layer_13_combine_sp2_ep11_pp3
	layer_13_dispatch_sp2_ep12_pp3 [label="Token Dispatch L13 SP2 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep12_pp3 [style=dashed]
	layer_13_expert_sp2_ep12_tp0_pp3 [label="Expert L13 SP2 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep12_pp3 -> layer_13_expert_sp2_ep12_tp0_pp3
	layer_13_expert_out_sp2_ep12_tp0_pp3 [label="Expert Out L13 SP2 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep12_tp0_pp3 -> layer_13_expert_out_sp2_ep12_tp0_pp3
	layer_13_expert_sp2_ep12_tp1_pp3 [label="Expert L13 SP2 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep12_pp3 -> layer_13_expert_sp2_ep12_tp1_pp3
	layer_13_expert_out_sp2_ep12_tp1_pp3 [label="Expert Out L13 SP2 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep12_tp1_pp3 -> layer_13_expert_out_sp2_ep12_tp1_pp3
	layer_13_expert_sp2_ep12_tp2_pp3 [label="Expert L13 SP2 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep12_pp3 -> layer_13_expert_sp2_ep12_tp2_pp3
	layer_13_expert_out_sp2_ep12_tp2_pp3 [label="Expert Out L13 SP2 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep12_tp2_pp3 -> layer_13_expert_out_sp2_ep12_tp2_pp3
	layer_13_expert_sp2_ep12_tp3_pp3 [label="Expert L13 SP2 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep12_pp3 -> layer_13_expert_sp2_ep12_tp3_pp3
	layer_13_expert_out_sp2_ep12_tp3_pp3 [label="Expert Out L13 SP2 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep12_tp3_pp3 -> layer_13_expert_out_sp2_ep12_tp3_pp3
	layer_13_expert_ar_sp2_ep12_pp3 [label="Expert All-Reduce L13 SP2 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep12_tp0_pp3 -> layer_13_expert_ar_sp2_ep12_pp3
	layer_13_expert_out_sp2_ep12_tp1_pp3 -> layer_13_expert_ar_sp2_ep12_pp3
	layer_13_expert_out_sp2_ep12_tp2_pp3 -> layer_13_expert_ar_sp2_ep12_pp3
	layer_13_expert_out_sp2_ep12_tp3_pp3 -> layer_13_expert_ar_sp2_ep12_pp3
	layer_13_combine_sp2_ep12_pp3 [label="Token Combine L13 SP2 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep12_pp3 -> layer_13_combine_sp2_ep12_pp3
	layer_13_dispatch_sp2_ep13_pp3 [label="Token Dispatch L13 SP2 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep13_pp3 [style=dashed]
	layer_13_expert_sp2_ep13_tp0_pp3 [label="Expert L13 SP2 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep13_pp3 -> layer_13_expert_sp2_ep13_tp0_pp3
	layer_13_expert_out_sp2_ep13_tp0_pp3 [label="Expert Out L13 SP2 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep13_tp0_pp3 -> layer_13_expert_out_sp2_ep13_tp0_pp3
	layer_13_expert_sp2_ep13_tp1_pp3 [label="Expert L13 SP2 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep13_pp3 -> layer_13_expert_sp2_ep13_tp1_pp3
	layer_13_expert_out_sp2_ep13_tp1_pp3 [label="Expert Out L13 SP2 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep13_tp1_pp3 -> layer_13_expert_out_sp2_ep13_tp1_pp3
	layer_13_expert_sp2_ep13_tp2_pp3 [label="Expert L13 SP2 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep13_pp3 -> layer_13_expert_sp2_ep13_tp2_pp3
	layer_13_expert_out_sp2_ep13_tp2_pp3 [label="Expert Out L13 SP2 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep13_tp2_pp3 -> layer_13_expert_out_sp2_ep13_tp2_pp3
	layer_13_expert_sp2_ep13_tp3_pp3 [label="Expert L13 SP2 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep13_pp3 -> layer_13_expert_sp2_ep13_tp3_pp3
	layer_13_expert_out_sp2_ep13_tp3_pp3 [label="Expert Out L13 SP2 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep13_tp3_pp3 -> layer_13_expert_out_sp2_ep13_tp3_pp3
	layer_13_expert_ar_sp2_ep13_pp3 [label="Expert All-Reduce L13 SP2 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep13_tp0_pp3 -> layer_13_expert_ar_sp2_ep13_pp3
	layer_13_expert_out_sp2_ep13_tp1_pp3 -> layer_13_expert_ar_sp2_ep13_pp3
	layer_13_expert_out_sp2_ep13_tp2_pp3 -> layer_13_expert_ar_sp2_ep13_pp3
	layer_13_expert_out_sp2_ep13_tp3_pp3 -> layer_13_expert_ar_sp2_ep13_pp3
	layer_13_combine_sp2_ep13_pp3 [label="Token Combine L13 SP2 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep13_pp3 -> layer_13_combine_sp2_ep13_pp3
	layer_13_dispatch_sp2_ep14_pp3 [label="Token Dispatch L13 SP2 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep14_pp3 [style=dashed]
	layer_13_expert_sp2_ep14_tp0_pp3 [label="Expert L13 SP2 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep14_pp3 -> layer_13_expert_sp2_ep14_tp0_pp3
	layer_13_expert_out_sp2_ep14_tp0_pp3 [label="Expert Out L13 SP2 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep14_tp0_pp3 -> layer_13_expert_out_sp2_ep14_tp0_pp3
	layer_13_expert_sp2_ep14_tp1_pp3 [label="Expert L13 SP2 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep14_pp3 -> layer_13_expert_sp2_ep14_tp1_pp3
	layer_13_expert_out_sp2_ep14_tp1_pp3 [label="Expert Out L13 SP2 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep14_tp1_pp3 -> layer_13_expert_out_sp2_ep14_tp1_pp3
	layer_13_expert_sp2_ep14_tp2_pp3 [label="Expert L13 SP2 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep14_pp3 -> layer_13_expert_sp2_ep14_tp2_pp3
	layer_13_expert_out_sp2_ep14_tp2_pp3 [label="Expert Out L13 SP2 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep14_tp2_pp3 -> layer_13_expert_out_sp2_ep14_tp2_pp3
	layer_13_expert_sp2_ep14_tp3_pp3 [label="Expert L13 SP2 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep14_pp3 -> layer_13_expert_sp2_ep14_tp3_pp3
	layer_13_expert_out_sp2_ep14_tp3_pp3 [label="Expert Out L13 SP2 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep14_tp3_pp3 -> layer_13_expert_out_sp2_ep14_tp3_pp3
	layer_13_expert_ar_sp2_ep14_pp3 [label="Expert All-Reduce L13 SP2 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep14_tp0_pp3 -> layer_13_expert_ar_sp2_ep14_pp3
	layer_13_expert_out_sp2_ep14_tp1_pp3 -> layer_13_expert_ar_sp2_ep14_pp3
	layer_13_expert_out_sp2_ep14_tp2_pp3 -> layer_13_expert_ar_sp2_ep14_pp3
	layer_13_expert_out_sp2_ep14_tp3_pp3 -> layer_13_expert_ar_sp2_ep14_pp3
	layer_13_combine_sp2_ep14_pp3 [label="Token Combine L13 SP2 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep14_pp3 -> layer_13_combine_sp2_ep14_pp3
	layer_13_dispatch_sp2_ep15_pp3 [label="Token Dispatch L13 SP2 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp2_pp3 -> layer_13_dispatch_sp2_ep15_pp3 [style=dashed]
	layer_13_expert_sp2_ep15_tp0_pp3 [label="Expert L13 SP2 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep15_pp3 -> layer_13_expert_sp2_ep15_tp0_pp3
	layer_13_expert_out_sp2_ep15_tp0_pp3 [label="Expert Out L13 SP2 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep15_tp0_pp3 -> layer_13_expert_out_sp2_ep15_tp0_pp3
	layer_13_expert_sp2_ep15_tp1_pp3 [label="Expert L13 SP2 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep15_pp3 -> layer_13_expert_sp2_ep15_tp1_pp3
	layer_13_expert_out_sp2_ep15_tp1_pp3 [label="Expert Out L13 SP2 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep15_tp1_pp3 -> layer_13_expert_out_sp2_ep15_tp1_pp3
	layer_13_expert_sp2_ep15_tp2_pp3 [label="Expert L13 SP2 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep15_pp3 -> layer_13_expert_sp2_ep15_tp2_pp3
	layer_13_expert_out_sp2_ep15_tp2_pp3 [label="Expert Out L13 SP2 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep15_tp2_pp3 -> layer_13_expert_out_sp2_ep15_tp2_pp3
	layer_13_expert_sp2_ep15_tp3_pp3 [label="Expert L13 SP2 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp2_ep15_pp3 -> layer_13_expert_sp2_ep15_tp3_pp3
	layer_13_expert_out_sp2_ep15_tp3_pp3 [label="Expert Out L13 SP2 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp2_ep15_tp3_pp3 -> layer_13_expert_out_sp2_ep15_tp3_pp3
	layer_13_expert_ar_sp2_ep15_pp3 [label="Expert All-Reduce L13 SP2 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp2_ep15_tp0_pp3 -> layer_13_expert_ar_sp2_ep15_pp3
	layer_13_expert_out_sp2_ep15_tp1_pp3 -> layer_13_expert_ar_sp2_ep15_pp3
	layer_13_expert_out_sp2_ep15_tp2_pp3 -> layer_13_expert_ar_sp2_ep15_pp3
	layer_13_expert_out_sp2_ep15_tp3_pp3 -> layer_13_expert_ar_sp2_ep15_pp3
	layer_13_combine_sp2_ep15_pp3 [label="Token Combine L13 SP2 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp2_ep15_pp3 -> layer_13_combine_sp2_ep15_pp3
	layer_13_moe_all2all_sp2_pp3 [label="MoE All-to-All L13 SP2\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_13_combine_sp2_ep0_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep1_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep2_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep3_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep4_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep5_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep6_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep7_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep8_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep9_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep10_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep11_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep12_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep13_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep14_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_combine_sp2_ep15_pp3 -> layer_13_moe_all2all_sp2_pp3
	layer_13_mlp_out_sp2_pp3 [label="MoE Output L13 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_moe_all2all_sp2_pp3 -> layer_13_mlp_out_sp2_pp3
	layer_13_mlp_res_sp2_pp3 [label="MLP Residual L13 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_mlp_out_sp2_pp3 -> layer_13_mlp_res_sp2_pp3
	layer_13_attn_res_sp2_pp3 -> layer_13_mlp_res_sp2_pp3 [style=dashed]
	layer_13_norm_sp3_pp3 [label="LayerNorm L13 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_12_mlp_out_sp3_pp3 -> layer_13_norm_sp3_pp3
	layer_13_qkv_sp3_tp0_pp3 [label="QKV Proj L13 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp3_pp3 -> layer_13_qkv_sp3_tp0_pp3
	layer_13_attn_sp3_tp0_pp3 [label="Attention L13 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp3_tp0_pp3 -> layer_13_attn_sp3_tp0_pp3
	layer_13_attn_out_sp3_tp0_pp3 [label="Attn Out Proj L13 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp3_tp0_pp3 -> layer_13_attn_out_sp3_tp0_pp3
	layer_13_qkv_sp3_tp1_pp3 [label="QKV Proj L13 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp3_pp3 -> layer_13_qkv_sp3_tp1_pp3
	layer_13_attn_sp3_tp1_pp3 [label="Attention L13 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp3_tp1_pp3 -> layer_13_attn_sp3_tp1_pp3
	layer_13_attn_out_sp3_tp1_pp3 [label="Attn Out Proj L13 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp3_tp1_pp3 -> layer_13_attn_out_sp3_tp1_pp3
	layer_13_qkv_sp3_tp2_pp3 [label="QKV Proj L13 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp3_pp3 -> layer_13_qkv_sp3_tp2_pp3
	layer_13_attn_sp3_tp2_pp3 [label="Attention L13 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp3_tp2_pp3 -> layer_13_attn_sp3_tp2_pp3
	layer_13_attn_out_sp3_tp2_pp3 [label="Attn Out Proj L13 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp3_tp2_pp3 -> layer_13_attn_out_sp3_tp2_pp3
	layer_13_qkv_sp3_tp3_pp3 [label="QKV Proj L13 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_norm_sp3_pp3 -> layer_13_qkv_sp3_tp3_pp3
	layer_13_attn_sp3_tp3_pp3 [label="Attention L13 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_qkv_sp3_tp3_pp3 -> layer_13_attn_sp3_tp3_pp3
	layer_13_attn_out_sp3_tp3_pp3 [label="Attn Out Proj L13 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_13_attn_sp3_tp3_pp3 -> layer_13_attn_out_sp3_tp3_pp3
	layer_13_attn_ar_sp3_pp3 [label="Attention All-Reduce L13 SP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_attn_out_sp3_tp0_pp3 -> layer_13_attn_ar_sp3_pp3
	layer_13_attn_out_sp3_tp1_pp3 -> layer_13_attn_ar_sp3_pp3
	layer_13_attn_out_sp3_tp2_pp3 -> layer_13_attn_ar_sp3_pp3
	layer_13_attn_out_sp3_tp3_pp3 -> layer_13_attn_ar_sp3_pp3
	layer_13_attn_res_sp3_pp3 [label="Attention Residual L13 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_attn_ar_sp3_pp3 -> layer_13_attn_res_sp3_pp3
	layer_13_norm_sp3_pp3 -> layer_13_attn_res_sp3_pp3 [style=dashed]
	layer_13_post_norm_sp3_pp3 [label="Post-Attn Norm L13 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_attn_res_sp3_pp3 -> layer_13_post_norm_sp3_pp3
	layer_13_router_sp3_pp3 [label="MoE Router L13 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_13_post_norm_sp3_pp3 -> layer_13_router_sp3_pp3
	layer_13_dispatch_sp3_ep0_pp3 [label="Token Dispatch L13 SP3 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep0_pp3 [style=dashed]
	layer_13_expert_sp3_ep0_tp0_pp3 [label="Expert L13 SP3 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep0_pp3 -> layer_13_expert_sp3_ep0_tp0_pp3
	layer_13_expert_out_sp3_ep0_tp0_pp3 [label="Expert Out L13 SP3 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep0_tp0_pp3 -> layer_13_expert_out_sp3_ep0_tp0_pp3
	layer_13_expert_sp3_ep0_tp1_pp3 [label="Expert L13 SP3 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep0_pp3 -> layer_13_expert_sp3_ep0_tp1_pp3
	layer_13_expert_out_sp3_ep0_tp1_pp3 [label="Expert Out L13 SP3 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep0_tp1_pp3 -> layer_13_expert_out_sp3_ep0_tp1_pp3
	layer_13_expert_sp3_ep0_tp2_pp3 [label="Expert L13 SP3 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep0_pp3 -> layer_13_expert_sp3_ep0_tp2_pp3
	layer_13_expert_out_sp3_ep0_tp2_pp3 [label="Expert Out L13 SP3 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep0_tp2_pp3 -> layer_13_expert_out_sp3_ep0_tp2_pp3
	layer_13_expert_sp3_ep0_tp3_pp3 [label="Expert L13 SP3 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep0_pp3 -> layer_13_expert_sp3_ep0_tp3_pp3
	layer_13_expert_out_sp3_ep0_tp3_pp3 [label="Expert Out L13 SP3 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep0_tp3_pp3 -> layer_13_expert_out_sp3_ep0_tp3_pp3
	layer_13_expert_ar_sp3_ep0_pp3 [label="Expert All-Reduce L13 SP3 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep0_tp0_pp3 -> layer_13_expert_ar_sp3_ep0_pp3
	layer_13_expert_out_sp3_ep0_tp1_pp3 -> layer_13_expert_ar_sp3_ep0_pp3
	layer_13_expert_out_sp3_ep0_tp2_pp3 -> layer_13_expert_ar_sp3_ep0_pp3
	layer_13_expert_out_sp3_ep0_tp3_pp3 -> layer_13_expert_ar_sp3_ep0_pp3
	layer_13_combine_sp3_ep0_pp3 [label="Token Combine L13 SP3 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep0_pp3 -> layer_13_combine_sp3_ep0_pp3
	layer_13_dispatch_sp3_ep1_pp3 [label="Token Dispatch L13 SP3 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep1_pp3 [style=dashed]
	layer_13_expert_sp3_ep1_tp0_pp3 [label="Expert L13 SP3 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep1_pp3 -> layer_13_expert_sp3_ep1_tp0_pp3
	layer_13_expert_out_sp3_ep1_tp0_pp3 [label="Expert Out L13 SP3 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep1_tp0_pp3 -> layer_13_expert_out_sp3_ep1_tp0_pp3
	layer_13_expert_sp3_ep1_tp1_pp3 [label="Expert L13 SP3 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep1_pp3 -> layer_13_expert_sp3_ep1_tp1_pp3
	layer_13_expert_out_sp3_ep1_tp1_pp3 [label="Expert Out L13 SP3 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep1_tp1_pp3 -> layer_13_expert_out_sp3_ep1_tp1_pp3
	layer_13_expert_sp3_ep1_tp2_pp3 [label="Expert L13 SP3 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep1_pp3 -> layer_13_expert_sp3_ep1_tp2_pp3
	layer_13_expert_out_sp3_ep1_tp2_pp3 [label="Expert Out L13 SP3 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep1_tp2_pp3 -> layer_13_expert_out_sp3_ep1_tp2_pp3
	layer_13_expert_sp3_ep1_tp3_pp3 [label="Expert L13 SP3 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep1_pp3 -> layer_13_expert_sp3_ep1_tp3_pp3
	layer_13_expert_out_sp3_ep1_tp3_pp3 [label="Expert Out L13 SP3 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep1_tp3_pp3 -> layer_13_expert_out_sp3_ep1_tp3_pp3
	layer_13_expert_ar_sp3_ep1_pp3 [label="Expert All-Reduce L13 SP3 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep1_tp0_pp3 -> layer_13_expert_ar_sp3_ep1_pp3
	layer_13_expert_out_sp3_ep1_tp1_pp3 -> layer_13_expert_ar_sp3_ep1_pp3
	layer_13_expert_out_sp3_ep1_tp2_pp3 -> layer_13_expert_ar_sp3_ep1_pp3
	layer_13_expert_out_sp3_ep1_tp3_pp3 -> layer_13_expert_ar_sp3_ep1_pp3
	layer_13_combine_sp3_ep1_pp3 [label="Token Combine L13 SP3 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep1_pp3 -> layer_13_combine_sp3_ep1_pp3
	layer_13_dispatch_sp3_ep2_pp3 [label="Token Dispatch L13 SP3 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep2_pp3 [style=dashed]
	layer_13_expert_sp3_ep2_tp0_pp3 [label="Expert L13 SP3 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep2_pp3 -> layer_13_expert_sp3_ep2_tp0_pp3
	layer_13_expert_out_sp3_ep2_tp0_pp3 [label="Expert Out L13 SP3 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep2_tp0_pp3 -> layer_13_expert_out_sp3_ep2_tp0_pp3
	layer_13_expert_sp3_ep2_tp1_pp3 [label="Expert L13 SP3 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep2_pp3 -> layer_13_expert_sp3_ep2_tp1_pp3
	layer_13_expert_out_sp3_ep2_tp1_pp3 [label="Expert Out L13 SP3 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep2_tp1_pp3 -> layer_13_expert_out_sp3_ep2_tp1_pp3
	layer_13_expert_sp3_ep2_tp2_pp3 [label="Expert L13 SP3 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep2_pp3 -> layer_13_expert_sp3_ep2_tp2_pp3
	layer_13_expert_out_sp3_ep2_tp2_pp3 [label="Expert Out L13 SP3 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep2_tp2_pp3 -> layer_13_expert_out_sp3_ep2_tp2_pp3
	layer_13_expert_sp3_ep2_tp3_pp3 [label="Expert L13 SP3 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep2_pp3 -> layer_13_expert_sp3_ep2_tp3_pp3
	layer_13_expert_out_sp3_ep2_tp3_pp3 [label="Expert Out L13 SP3 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep2_tp3_pp3 -> layer_13_expert_out_sp3_ep2_tp3_pp3
	layer_13_expert_ar_sp3_ep2_pp3 [label="Expert All-Reduce L13 SP3 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep2_tp0_pp3 -> layer_13_expert_ar_sp3_ep2_pp3
	layer_13_expert_out_sp3_ep2_tp1_pp3 -> layer_13_expert_ar_sp3_ep2_pp3
	layer_13_expert_out_sp3_ep2_tp2_pp3 -> layer_13_expert_ar_sp3_ep2_pp3
	layer_13_expert_out_sp3_ep2_tp3_pp3 -> layer_13_expert_ar_sp3_ep2_pp3
	layer_13_combine_sp3_ep2_pp3 [label="Token Combine L13 SP3 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep2_pp3 -> layer_13_combine_sp3_ep2_pp3
	layer_13_dispatch_sp3_ep3_pp3 [label="Token Dispatch L13 SP3 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep3_pp3 [style=dashed]
	layer_13_expert_sp3_ep3_tp0_pp3 [label="Expert L13 SP3 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep3_pp3 -> layer_13_expert_sp3_ep3_tp0_pp3
	layer_13_expert_out_sp3_ep3_tp0_pp3 [label="Expert Out L13 SP3 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep3_tp0_pp3 -> layer_13_expert_out_sp3_ep3_tp0_pp3
	layer_13_expert_sp3_ep3_tp1_pp3 [label="Expert L13 SP3 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep3_pp3 -> layer_13_expert_sp3_ep3_tp1_pp3
	layer_13_expert_out_sp3_ep3_tp1_pp3 [label="Expert Out L13 SP3 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep3_tp1_pp3 -> layer_13_expert_out_sp3_ep3_tp1_pp3
	layer_13_expert_sp3_ep3_tp2_pp3 [label="Expert L13 SP3 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep3_pp3 -> layer_13_expert_sp3_ep3_tp2_pp3
	layer_13_expert_out_sp3_ep3_tp2_pp3 [label="Expert Out L13 SP3 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep3_tp2_pp3 -> layer_13_expert_out_sp3_ep3_tp2_pp3
	layer_13_expert_sp3_ep3_tp3_pp3 [label="Expert L13 SP3 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep3_pp3 -> layer_13_expert_sp3_ep3_tp3_pp3
	layer_13_expert_out_sp3_ep3_tp3_pp3 [label="Expert Out L13 SP3 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep3_tp3_pp3 -> layer_13_expert_out_sp3_ep3_tp3_pp3
	layer_13_expert_ar_sp3_ep3_pp3 [label="Expert All-Reduce L13 SP3 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep3_tp0_pp3 -> layer_13_expert_ar_sp3_ep3_pp3
	layer_13_expert_out_sp3_ep3_tp1_pp3 -> layer_13_expert_ar_sp3_ep3_pp3
	layer_13_expert_out_sp3_ep3_tp2_pp3 -> layer_13_expert_ar_sp3_ep3_pp3
	layer_13_expert_out_sp3_ep3_tp3_pp3 -> layer_13_expert_ar_sp3_ep3_pp3
	layer_13_combine_sp3_ep3_pp3 [label="Token Combine L13 SP3 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep3_pp3 -> layer_13_combine_sp3_ep3_pp3
	layer_13_dispatch_sp3_ep4_pp3 [label="Token Dispatch L13 SP3 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep4_pp3 [style=dashed]
	layer_13_expert_sp3_ep4_tp0_pp3 [label="Expert L13 SP3 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep4_pp3 -> layer_13_expert_sp3_ep4_tp0_pp3
	layer_13_expert_out_sp3_ep4_tp0_pp3 [label="Expert Out L13 SP3 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep4_tp0_pp3 -> layer_13_expert_out_sp3_ep4_tp0_pp3
	layer_13_expert_sp3_ep4_tp1_pp3 [label="Expert L13 SP3 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep4_pp3 -> layer_13_expert_sp3_ep4_tp1_pp3
	layer_13_expert_out_sp3_ep4_tp1_pp3 [label="Expert Out L13 SP3 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep4_tp1_pp3 -> layer_13_expert_out_sp3_ep4_tp1_pp3
	layer_13_expert_sp3_ep4_tp2_pp3 [label="Expert L13 SP3 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep4_pp3 -> layer_13_expert_sp3_ep4_tp2_pp3
	layer_13_expert_out_sp3_ep4_tp2_pp3 [label="Expert Out L13 SP3 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep4_tp2_pp3 -> layer_13_expert_out_sp3_ep4_tp2_pp3
	layer_13_expert_sp3_ep4_tp3_pp3 [label="Expert L13 SP3 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep4_pp3 -> layer_13_expert_sp3_ep4_tp3_pp3
	layer_13_expert_out_sp3_ep4_tp3_pp3 [label="Expert Out L13 SP3 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep4_tp3_pp3 -> layer_13_expert_out_sp3_ep4_tp3_pp3
	layer_13_expert_ar_sp3_ep4_pp3 [label="Expert All-Reduce L13 SP3 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep4_tp0_pp3 -> layer_13_expert_ar_sp3_ep4_pp3
	layer_13_expert_out_sp3_ep4_tp1_pp3 -> layer_13_expert_ar_sp3_ep4_pp3
	layer_13_expert_out_sp3_ep4_tp2_pp3 -> layer_13_expert_ar_sp3_ep4_pp3
	layer_13_expert_out_sp3_ep4_tp3_pp3 -> layer_13_expert_ar_sp3_ep4_pp3
	layer_13_combine_sp3_ep4_pp3 [label="Token Combine L13 SP3 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep4_pp3 -> layer_13_combine_sp3_ep4_pp3
	layer_13_dispatch_sp3_ep5_pp3 [label="Token Dispatch L13 SP3 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep5_pp3 [style=dashed]
	layer_13_expert_sp3_ep5_tp0_pp3 [label="Expert L13 SP3 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep5_pp3 -> layer_13_expert_sp3_ep5_tp0_pp3
	layer_13_expert_out_sp3_ep5_tp0_pp3 [label="Expert Out L13 SP3 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep5_tp0_pp3 -> layer_13_expert_out_sp3_ep5_tp0_pp3
	layer_13_expert_sp3_ep5_tp1_pp3 [label="Expert L13 SP3 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep5_pp3 -> layer_13_expert_sp3_ep5_tp1_pp3
	layer_13_expert_out_sp3_ep5_tp1_pp3 [label="Expert Out L13 SP3 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep5_tp1_pp3 -> layer_13_expert_out_sp3_ep5_tp1_pp3
	layer_13_expert_sp3_ep5_tp2_pp3 [label="Expert L13 SP3 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep5_pp3 -> layer_13_expert_sp3_ep5_tp2_pp3
	layer_13_expert_out_sp3_ep5_tp2_pp3 [label="Expert Out L13 SP3 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep5_tp2_pp3 -> layer_13_expert_out_sp3_ep5_tp2_pp3
	layer_13_expert_sp3_ep5_tp3_pp3 [label="Expert L13 SP3 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep5_pp3 -> layer_13_expert_sp3_ep5_tp3_pp3
	layer_13_expert_out_sp3_ep5_tp3_pp3 [label="Expert Out L13 SP3 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep5_tp3_pp3 -> layer_13_expert_out_sp3_ep5_tp3_pp3
	layer_13_expert_ar_sp3_ep5_pp3 [label="Expert All-Reduce L13 SP3 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep5_tp0_pp3 -> layer_13_expert_ar_sp3_ep5_pp3
	layer_13_expert_out_sp3_ep5_tp1_pp3 -> layer_13_expert_ar_sp3_ep5_pp3
	layer_13_expert_out_sp3_ep5_tp2_pp3 -> layer_13_expert_ar_sp3_ep5_pp3
	layer_13_expert_out_sp3_ep5_tp3_pp3 -> layer_13_expert_ar_sp3_ep5_pp3
	layer_13_combine_sp3_ep5_pp3 [label="Token Combine L13 SP3 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep5_pp3 -> layer_13_combine_sp3_ep5_pp3
	layer_13_dispatch_sp3_ep6_pp3 [label="Token Dispatch L13 SP3 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep6_pp3 [style=dashed]
	layer_13_expert_sp3_ep6_tp0_pp3 [label="Expert L13 SP3 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep6_pp3 -> layer_13_expert_sp3_ep6_tp0_pp3
	layer_13_expert_out_sp3_ep6_tp0_pp3 [label="Expert Out L13 SP3 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep6_tp0_pp3 -> layer_13_expert_out_sp3_ep6_tp0_pp3
	layer_13_expert_sp3_ep6_tp1_pp3 [label="Expert L13 SP3 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep6_pp3 -> layer_13_expert_sp3_ep6_tp1_pp3
	layer_13_expert_out_sp3_ep6_tp1_pp3 [label="Expert Out L13 SP3 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep6_tp1_pp3 -> layer_13_expert_out_sp3_ep6_tp1_pp3
	layer_13_expert_sp3_ep6_tp2_pp3 [label="Expert L13 SP3 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep6_pp3 -> layer_13_expert_sp3_ep6_tp2_pp3
	layer_13_expert_out_sp3_ep6_tp2_pp3 [label="Expert Out L13 SP3 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep6_tp2_pp3 -> layer_13_expert_out_sp3_ep6_tp2_pp3
	layer_13_expert_sp3_ep6_tp3_pp3 [label="Expert L13 SP3 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep6_pp3 -> layer_13_expert_sp3_ep6_tp3_pp3
	layer_13_expert_out_sp3_ep6_tp3_pp3 [label="Expert Out L13 SP3 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep6_tp3_pp3 -> layer_13_expert_out_sp3_ep6_tp3_pp3
	layer_13_expert_ar_sp3_ep6_pp3 [label="Expert All-Reduce L13 SP3 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep6_tp0_pp3 -> layer_13_expert_ar_sp3_ep6_pp3
	layer_13_expert_out_sp3_ep6_tp1_pp3 -> layer_13_expert_ar_sp3_ep6_pp3
	layer_13_expert_out_sp3_ep6_tp2_pp3 -> layer_13_expert_ar_sp3_ep6_pp3
	layer_13_expert_out_sp3_ep6_tp3_pp3 -> layer_13_expert_ar_sp3_ep6_pp3
	layer_13_combine_sp3_ep6_pp3 [label="Token Combine L13 SP3 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep6_pp3 -> layer_13_combine_sp3_ep6_pp3
	layer_13_dispatch_sp3_ep7_pp3 [label="Token Dispatch L13 SP3 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep7_pp3 [style=dashed]
	layer_13_expert_sp3_ep7_tp0_pp3 [label="Expert L13 SP3 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep7_pp3 -> layer_13_expert_sp3_ep7_tp0_pp3
	layer_13_expert_out_sp3_ep7_tp0_pp3 [label="Expert Out L13 SP3 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep7_tp0_pp3 -> layer_13_expert_out_sp3_ep7_tp0_pp3
	layer_13_expert_sp3_ep7_tp1_pp3 [label="Expert L13 SP3 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep7_pp3 -> layer_13_expert_sp3_ep7_tp1_pp3
	layer_13_expert_out_sp3_ep7_tp1_pp3 [label="Expert Out L13 SP3 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep7_tp1_pp3 -> layer_13_expert_out_sp3_ep7_tp1_pp3
	layer_13_expert_sp3_ep7_tp2_pp3 [label="Expert L13 SP3 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep7_pp3 -> layer_13_expert_sp3_ep7_tp2_pp3
	layer_13_expert_out_sp3_ep7_tp2_pp3 [label="Expert Out L13 SP3 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep7_tp2_pp3 -> layer_13_expert_out_sp3_ep7_tp2_pp3
	layer_13_expert_sp3_ep7_tp3_pp3 [label="Expert L13 SP3 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep7_pp3 -> layer_13_expert_sp3_ep7_tp3_pp3
	layer_13_expert_out_sp3_ep7_tp3_pp3 [label="Expert Out L13 SP3 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep7_tp3_pp3 -> layer_13_expert_out_sp3_ep7_tp3_pp3
	layer_13_expert_ar_sp3_ep7_pp3 [label="Expert All-Reduce L13 SP3 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep7_tp0_pp3 -> layer_13_expert_ar_sp3_ep7_pp3
	layer_13_expert_out_sp3_ep7_tp1_pp3 -> layer_13_expert_ar_sp3_ep7_pp3
	layer_13_expert_out_sp3_ep7_tp2_pp3 -> layer_13_expert_ar_sp3_ep7_pp3
	layer_13_expert_out_sp3_ep7_tp3_pp3 -> layer_13_expert_ar_sp3_ep7_pp3
	layer_13_combine_sp3_ep7_pp3 [label="Token Combine L13 SP3 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep7_pp3 -> layer_13_combine_sp3_ep7_pp3
	layer_13_dispatch_sp3_ep8_pp3 [label="Token Dispatch L13 SP3 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep8_pp3 [style=dashed]
	layer_13_expert_sp3_ep8_tp0_pp3 [label="Expert L13 SP3 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep8_pp3 -> layer_13_expert_sp3_ep8_tp0_pp3
	layer_13_expert_out_sp3_ep8_tp0_pp3 [label="Expert Out L13 SP3 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep8_tp0_pp3 -> layer_13_expert_out_sp3_ep8_tp0_pp3
	layer_13_expert_sp3_ep8_tp1_pp3 [label="Expert L13 SP3 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep8_pp3 -> layer_13_expert_sp3_ep8_tp1_pp3
	layer_13_expert_out_sp3_ep8_tp1_pp3 [label="Expert Out L13 SP3 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep8_tp1_pp3 -> layer_13_expert_out_sp3_ep8_tp1_pp3
	layer_13_expert_sp3_ep8_tp2_pp3 [label="Expert L13 SP3 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep8_pp3 -> layer_13_expert_sp3_ep8_tp2_pp3
	layer_13_expert_out_sp3_ep8_tp2_pp3 [label="Expert Out L13 SP3 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep8_tp2_pp3 -> layer_13_expert_out_sp3_ep8_tp2_pp3
	layer_13_expert_sp3_ep8_tp3_pp3 [label="Expert L13 SP3 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep8_pp3 -> layer_13_expert_sp3_ep8_tp3_pp3
	layer_13_expert_out_sp3_ep8_tp3_pp3 [label="Expert Out L13 SP3 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep8_tp3_pp3 -> layer_13_expert_out_sp3_ep8_tp3_pp3
	layer_13_expert_ar_sp3_ep8_pp3 [label="Expert All-Reduce L13 SP3 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep8_tp0_pp3 -> layer_13_expert_ar_sp3_ep8_pp3
	layer_13_expert_out_sp3_ep8_tp1_pp3 -> layer_13_expert_ar_sp3_ep8_pp3
	layer_13_expert_out_sp3_ep8_tp2_pp3 -> layer_13_expert_ar_sp3_ep8_pp3
	layer_13_expert_out_sp3_ep8_tp3_pp3 -> layer_13_expert_ar_sp3_ep8_pp3
	layer_13_combine_sp3_ep8_pp3 [label="Token Combine L13 SP3 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep8_pp3 -> layer_13_combine_sp3_ep8_pp3
	layer_13_dispatch_sp3_ep9_pp3 [label="Token Dispatch L13 SP3 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep9_pp3 [style=dashed]
	layer_13_expert_sp3_ep9_tp0_pp3 [label="Expert L13 SP3 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep9_pp3 -> layer_13_expert_sp3_ep9_tp0_pp3
	layer_13_expert_out_sp3_ep9_tp0_pp3 [label="Expert Out L13 SP3 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep9_tp0_pp3 -> layer_13_expert_out_sp3_ep9_tp0_pp3
	layer_13_expert_sp3_ep9_tp1_pp3 [label="Expert L13 SP3 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep9_pp3 -> layer_13_expert_sp3_ep9_tp1_pp3
	layer_13_expert_out_sp3_ep9_tp1_pp3 [label="Expert Out L13 SP3 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep9_tp1_pp3 -> layer_13_expert_out_sp3_ep9_tp1_pp3
	layer_13_expert_sp3_ep9_tp2_pp3 [label="Expert L13 SP3 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep9_pp3 -> layer_13_expert_sp3_ep9_tp2_pp3
	layer_13_expert_out_sp3_ep9_tp2_pp3 [label="Expert Out L13 SP3 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep9_tp2_pp3 -> layer_13_expert_out_sp3_ep9_tp2_pp3
	layer_13_expert_sp3_ep9_tp3_pp3 [label="Expert L13 SP3 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep9_pp3 -> layer_13_expert_sp3_ep9_tp3_pp3
	layer_13_expert_out_sp3_ep9_tp3_pp3 [label="Expert Out L13 SP3 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep9_tp3_pp3 -> layer_13_expert_out_sp3_ep9_tp3_pp3
	layer_13_expert_ar_sp3_ep9_pp3 [label="Expert All-Reduce L13 SP3 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep9_tp0_pp3 -> layer_13_expert_ar_sp3_ep9_pp3
	layer_13_expert_out_sp3_ep9_tp1_pp3 -> layer_13_expert_ar_sp3_ep9_pp3
	layer_13_expert_out_sp3_ep9_tp2_pp3 -> layer_13_expert_ar_sp3_ep9_pp3
	layer_13_expert_out_sp3_ep9_tp3_pp3 -> layer_13_expert_ar_sp3_ep9_pp3
	layer_13_combine_sp3_ep9_pp3 [label="Token Combine L13 SP3 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep9_pp3 -> layer_13_combine_sp3_ep9_pp3
	layer_13_dispatch_sp3_ep10_pp3 [label="Token Dispatch L13 SP3 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep10_pp3 [style=dashed]
	layer_13_expert_sp3_ep10_tp0_pp3 [label="Expert L13 SP3 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep10_pp3 -> layer_13_expert_sp3_ep10_tp0_pp3
	layer_13_expert_out_sp3_ep10_tp0_pp3 [label="Expert Out L13 SP3 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep10_tp0_pp3 -> layer_13_expert_out_sp3_ep10_tp0_pp3
	layer_13_expert_sp3_ep10_tp1_pp3 [label="Expert L13 SP3 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep10_pp3 -> layer_13_expert_sp3_ep10_tp1_pp3
	layer_13_expert_out_sp3_ep10_tp1_pp3 [label="Expert Out L13 SP3 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep10_tp1_pp3 -> layer_13_expert_out_sp3_ep10_tp1_pp3
	layer_13_expert_sp3_ep10_tp2_pp3 [label="Expert L13 SP3 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep10_pp3 -> layer_13_expert_sp3_ep10_tp2_pp3
	layer_13_expert_out_sp3_ep10_tp2_pp3 [label="Expert Out L13 SP3 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep10_tp2_pp3 -> layer_13_expert_out_sp3_ep10_tp2_pp3
	layer_13_expert_sp3_ep10_tp3_pp3 [label="Expert L13 SP3 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep10_pp3 -> layer_13_expert_sp3_ep10_tp3_pp3
	layer_13_expert_out_sp3_ep10_tp3_pp3 [label="Expert Out L13 SP3 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep10_tp3_pp3 -> layer_13_expert_out_sp3_ep10_tp3_pp3
	layer_13_expert_ar_sp3_ep10_pp3 [label="Expert All-Reduce L13 SP3 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep10_tp0_pp3 -> layer_13_expert_ar_sp3_ep10_pp3
	layer_13_expert_out_sp3_ep10_tp1_pp3 -> layer_13_expert_ar_sp3_ep10_pp3
	layer_13_expert_out_sp3_ep10_tp2_pp3 -> layer_13_expert_ar_sp3_ep10_pp3
	layer_13_expert_out_sp3_ep10_tp3_pp3 -> layer_13_expert_ar_sp3_ep10_pp3
	layer_13_combine_sp3_ep10_pp3 [label="Token Combine L13 SP3 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep10_pp3 -> layer_13_combine_sp3_ep10_pp3
	layer_13_dispatch_sp3_ep11_pp3 [label="Token Dispatch L13 SP3 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep11_pp3 [style=dashed]
	layer_13_expert_sp3_ep11_tp0_pp3 [label="Expert L13 SP3 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep11_pp3 -> layer_13_expert_sp3_ep11_tp0_pp3
	layer_13_expert_out_sp3_ep11_tp0_pp3 [label="Expert Out L13 SP3 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep11_tp0_pp3 -> layer_13_expert_out_sp3_ep11_tp0_pp3
	layer_13_expert_sp3_ep11_tp1_pp3 [label="Expert L13 SP3 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep11_pp3 -> layer_13_expert_sp3_ep11_tp1_pp3
	layer_13_expert_out_sp3_ep11_tp1_pp3 [label="Expert Out L13 SP3 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep11_tp1_pp3 -> layer_13_expert_out_sp3_ep11_tp1_pp3
	layer_13_expert_sp3_ep11_tp2_pp3 [label="Expert L13 SP3 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep11_pp3 -> layer_13_expert_sp3_ep11_tp2_pp3
	layer_13_expert_out_sp3_ep11_tp2_pp3 [label="Expert Out L13 SP3 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep11_tp2_pp3 -> layer_13_expert_out_sp3_ep11_tp2_pp3
	layer_13_expert_sp3_ep11_tp3_pp3 [label="Expert L13 SP3 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep11_pp3 -> layer_13_expert_sp3_ep11_tp3_pp3
	layer_13_expert_out_sp3_ep11_tp3_pp3 [label="Expert Out L13 SP3 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep11_tp3_pp3 -> layer_13_expert_out_sp3_ep11_tp3_pp3
	layer_13_expert_ar_sp3_ep11_pp3 [label="Expert All-Reduce L13 SP3 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep11_tp0_pp3 -> layer_13_expert_ar_sp3_ep11_pp3
	layer_13_expert_out_sp3_ep11_tp1_pp3 -> layer_13_expert_ar_sp3_ep11_pp3
	layer_13_expert_out_sp3_ep11_tp2_pp3 -> layer_13_expert_ar_sp3_ep11_pp3
	layer_13_expert_out_sp3_ep11_tp3_pp3 -> layer_13_expert_ar_sp3_ep11_pp3
	layer_13_combine_sp3_ep11_pp3 [label="Token Combine L13 SP3 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep11_pp3 -> layer_13_combine_sp3_ep11_pp3
	layer_13_dispatch_sp3_ep12_pp3 [label="Token Dispatch L13 SP3 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep12_pp3 [style=dashed]
	layer_13_expert_sp3_ep12_tp0_pp3 [label="Expert L13 SP3 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep12_pp3 -> layer_13_expert_sp3_ep12_tp0_pp3
	layer_13_expert_out_sp3_ep12_tp0_pp3 [label="Expert Out L13 SP3 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep12_tp0_pp3 -> layer_13_expert_out_sp3_ep12_tp0_pp3
	layer_13_expert_sp3_ep12_tp1_pp3 [label="Expert L13 SP3 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep12_pp3 -> layer_13_expert_sp3_ep12_tp1_pp3
	layer_13_expert_out_sp3_ep12_tp1_pp3 [label="Expert Out L13 SP3 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep12_tp1_pp3 -> layer_13_expert_out_sp3_ep12_tp1_pp3
	layer_13_expert_sp3_ep12_tp2_pp3 [label="Expert L13 SP3 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep12_pp3 -> layer_13_expert_sp3_ep12_tp2_pp3
	layer_13_expert_out_sp3_ep12_tp2_pp3 [label="Expert Out L13 SP3 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep12_tp2_pp3 -> layer_13_expert_out_sp3_ep12_tp2_pp3
	layer_13_expert_sp3_ep12_tp3_pp3 [label="Expert L13 SP3 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep12_pp3 -> layer_13_expert_sp3_ep12_tp3_pp3
	layer_13_expert_out_sp3_ep12_tp3_pp3 [label="Expert Out L13 SP3 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep12_tp3_pp3 -> layer_13_expert_out_sp3_ep12_tp3_pp3
	layer_13_expert_ar_sp3_ep12_pp3 [label="Expert All-Reduce L13 SP3 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep12_tp0_pp3 -> layer_13_expert_ar_sp3_ep12_pp3
	layer_13_expert_out_sp3_ep12_tp1_pp3 -> layer_13_expert_ar_sp3_ep12_pp3
	layer_13_expert_out_sp3_ep12_tp2_pp3 -> layer_13_expert_ar_sp3_ep12_pp3
	layer_13_expert_out_sp3_ep12_tp3_pp3 -> layer_13_expert_ar_sp3_ep12_pp3
	layer_13_combine_sp3_ep12_pp3 [label="Token Combine L13 SP3 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep12_pp3 -> layer_13_combine_sp3_ep12_pp3
	layer_13_dispatch_sp3_ep13_pp3 [label="Token Dispatch L13 SP3 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep13_pp3 [style=dashed]
	layer_13_expert_sp3_ep13_tp0_pp3 [label="Expert L13 SP3 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep13_pp3 -> layer_13_expert_sp3_ep13_tp0_pp3
	layer_13_expert_out_sp3_ep13_tp0_pp3 [label="Expert Out L13 SP3 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep13_tp0_pp3 -> layer_13_expert_out_sp3_ep13_tp0_pp3
	layer_13_expert_sp3_ep13_tp1_pp3 [label="Expert L13 SP3 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep13_pp3 -> layer_13_expert_sp3_ep13_tp1_pp3
	layer_13_expert_out_sp3_ep13_tp1_pp3 [label="Expert Out L13 SP3 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep13_tp1_pp3 -> layer_13_expert_out_sp3_ep13_tp1_pp3
	layer_13_expert_sp3_ep13_tp2_pp3 [label="Expert L13 SP3 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep13_pp3 -> layer_13_expert_sp3_ep13_tp2_pp3
	layer_13_expert_out_sp3_ep13_tp2_pp3 [label="Expert Out L13 SP3 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep13_tp2_pp3 -> layer_13_expert_out_sp3_ep13_tp2_pp3
	layer_13_expert_sp3_ep13_tp3_pp3 [label="Expert L13 SP3 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep13_pp3 -> layer_13_expert_sp3_ep13_tp3_pp3
	layer_13_expert_out_sp3_ep13_tp3_pp3 [label="Expert Out L13 SP3 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep13_tp3_pp3 -> layer_13_expert_out_sp3_ep13_tp3_pp3
	layer_13_expert_ar_sp3_ep13_pp3 [label="Expert All-Reduce L13 SP3 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep13_tp0_pp3 -> layer_13_expert_ar_sp3_ep13_pp3
	layer_13_expert_out_sp3_ep13_tp1_pp3 -> layer_13_expert_ar_sp3_ep13_pp3
	layer_13_expert_out_sp3_ep13_tp2_pp3 -> layer_13_expert_ar_sp3_ep13_pp3
	layer_13_expert_out_sp3_ep13_tp3_pp3 -> layer_13_expert_ar_sp3_ep13_pp3
	layer_13_combine_sp3_ep13_pp3 [label="Token Combine L13 SP3 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep13_pp3 -> layer_13_combine_sp3_ep13_pp3
	layer_13_dispatch_sp3_ep14_pp3 [label="Token Dispatch L13 SP3 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep14_pp3 [style=dashed]
	layer_13_expert_sp3_ep14_tp0_pp3 [label="Expert L13 SP3 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep14_pp3 -> layer_13_expert_sp3_ep14_tp0_pp3
	layer_13_expert_out_sp3_ep14_tp0_pp3 [label="Expert Out L13 SP3 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep14_tp0_pp3 -> layer_13_expert_out_sp3_ep14_tp0_pp3
	layer_13_expert_sp3_ep14_tp1_pp3 [label="Expert L13 SP3 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep14_pp3 -> layer_13_expert_sp3_ep14_tp1_pp3
	layer_13_expert_out_sp3_ep14_tp1_pp3 [label="Expert Out L13 SP3 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep14_tp1_pp3 -> layer_13_expert_out_sp3_ep14_tp1_pp3
	layer_13_expert_sp3_ep14_tp2_pp3 [label="Expert L13 SP3 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep14_pp3 -> layer_13_expert_sp3_ep14_tp2_pp3
	layer_13_expert_out_sp3_ep14_tp2_pp3 [label="Expert Out L13 SP3 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep14_tp2_pp3 -> layer_13_expert_out_sp3_ep14_tp2_pp3
	layer_13_expert_sp3_ep14_tp3_pp3 [label="Expert L13 SP3 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep14_pp3 -> layer_13_expert_sp3_ep14_tp3_pp3
	layer_13_expert_out_sp3_ep14_tp3_pp3 [label="Expert Out L13 SP3 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep14_tp3_pp3 -> layer_13_expert_out_sp3_ep14_tp3_pp3
	layer_13_expert_ar_sp3_ep14_pp3 [label="Expert All-Reduce L13 SP3 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep14_tp0_pp3 -> layer_13_expert_ar_sp3_ep14_pp3
	layer_13_expert_out_sp3_ep14_tp1_pp3 -> layer_13_expert_ar_sp3_ep14_pp3
	layer_13_expert_out_sp3_ep14_tp2_pp3 -> layer_13_expert_ar_sp3_ep14_pp3
	layer_13_expert_out_sp3_ep14_tp3_pp3 -> layer_13_expert_ar_sp3_ep14_pp3
	layer_13_combine_sp3_ep14_pp3 [label="Token Combine L13 SP3 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep14_pp3 -> layer_13_combine_sp3_ep14_pp3
	layer_13_dispatch_sp3_ep15_pp3 [label="Token Dispatch L13 SP3 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_13_router_sp3_pp3 -> layer_13_dispatch_sp3_ep15_pp3 [style=dashed]
	layer_13_expert_sp3_ep15_tp0_pp3 [label="Expert L13 SP3 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep15_pp3 -> layer_13_expert_sp3_ep15_tp0_pp3
	layer_13_expert_out_sp3_ep15_tp0_pp3 [label="Expert Out L13 SP3 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep15_tp0_pp3 -> layer_13_expert_out_sp3_ep15_tp0_pp3
	layer_13_expert_sp3_ep15_tp1_pp3 [label="Expert L13 SP3 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep15_pp3 -> layer_13_expert_sp3_ep15_tp1_pp3
	layer_13_expert_out_sp3_ep15_tp1_pp3 [label="Expert Out L13 SP3 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep15_tp1_pp3 -> layer_13_expert_out_sp3_ep15_tp1_pp3
	layer_13_expert_sp3_ep15_tp2_pp3 [label="Expert L13 SP3 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep15_pp3 -> layer_13_expert_sp3_ep15_tp2_pp3
	layer_13_expert_out_sp3_ep15_tp2_pp3 [label="Expert Out L13 SP3 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep15_tp2_pp3 -> layer_13_expert_out_sp3_ep15_tp2_pp3
	layer_13_expert_sp3_ep15_tp3_pp3 [label="Expert L13 SP3 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_dispatch_sp3_ep15_pp3 -> layer_13_expert_sp3_ep15_tp3_pp3
	layer_13_expert_out_sp3_ep15_tp3_pp3 [label="Expert Out L13 SP3 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_13_expert_sp3_ep15_tp3_pp3 -> layer_13_expert_out_sp3_ep15_tp3_pp3
	layer_13_expert_ar_sp3_ep15_pp3 [label="Expert All-Reduce L13 SP3 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_13_expert_out_sp3_ep15_tp0_pp3 -> layer_13_expert_ar_sp3_ep15_pp3
	layer_13_expert_out_sp3_ep15_tp1_pp3 -> layer_13_expert_ar_sp3_ep15_pp3
	layer_13_expert_out_sp3_ep15_tp2_pp3 -> layer_13_expert_ar_sp3_ep15_pp3
	layer_13_expert_out_sp3_ep15_tp3_pp3 -> layer_13_expert_ar_sp3_ep15_pp3
	layer_13_combine_sp3_ep15_pp3 [label="Token Combine L13 SP3 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_13_expert_ar_sp3_ep15_pp3 -> layer_13_combine_sp3_ep15_pp3
	layer_13_moe_all2all_sp3_pp3 [label="MoE All-to-All L13 SP3\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_13_combine_sp3_ep0_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep1_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep2_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep3_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep4_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep5_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep6_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep7_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep8_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep9_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep10_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep11_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep12_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep13_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep14_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_combine_sp3_ep15_pp3 -> layer_13_moe_all2all_sp3_pp3
	layer_13_mlp_out_sp3_pp3 [label="MoE Output L13 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_moe_all2all_sp3_pp3 -> layer_13_mlp_out_sp3_pp3
	layer_13_mlp_res_sp3_pp3 [label="MLP Residual L13 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_mlp_out_sp3_pp3 -> layer_13_mlp_res_sp3_pp3
	layer_13_attn_res_sp3_pp3 -> layer_13_mlp_res_sp3_pp3 [style=dashed]
	layer_14_norm_sp0_pp3 [label="LayerNorm L14 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_mlp_out_sp0_pp3 -> layer_14_norm_sp0_pp3
	layer_14_qkv_sp0_tp0_pp3 [label="QKV Proj L14 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp0_pp3 -> layer_14_qkv_sp0_tp0_pp3
	layer_14_attn_sp0_tp0_pp3 [label="Attention L14 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp0_tp0_pp3 -> layer_14_attn_sp0_tp0_pp3
	layer_14_attn_out_sp0_tp0_pp3 [label="Attn Out Proj L14 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp0_tp0_pp3 -> layer_14_attn_out_sp0_tp0_pp3
	layer_14_qkv_sp0_tp1_pp3 [label="QKV Proj L14 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp0_pp3 -> layer_14_qkv_sp0_tp1_pp3
	layer_14_attn_sp0_tp1_pp3 [label="Attention L14 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp0_tp1_pp3 -> layer_14_attn_sp0_tp1_pp3
	layer_14_attn_out_sp0_tp1_pp3 [label="Attn Out Proj L14 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp0_tp1_pp3 -> layer_14_attn_out_sp0_tp1_pp3
	layer_14_qkv_sp0_tp2_pp3 [label="QKV Proj L14 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp0_pp3 -> layer_14_qkv_sp0_tp2_pp3
	layer_14_attn_sp0_tp2_pp3 [label="Attention L14 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp0_tp2_pp3 -> layer_14_attn_sp0_tp2_pp3
	layer_14_attn_out_sp0_tp2_pp3 [label="Attn Out Proj L14 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp0_tp2_pp3 -> layer_14_attn_out_sp0_tp2_pp3
	layer_14_qkv_sp0_tp3_pp3 [label="QKV Proj L14 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp0_pp3 -> layer_14_qkv_sp0_tp3_pp3
	layer_14_attn_sp0_tp3_pp3 [label="Attention L14 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp0_tp3_pp3 -> layer_14_attn_sp0_tp3_pp3
	layer_14_attn_out_sp0_tp3_pp3 [label="Attn Out Proj L14 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp0_tp3_pp3 -> layer_14_attn_out_sp0_tp3_pp3
	layer_14_attn_ar_sp0_pp3 [label="Attention All-Reduce L14 SP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_attn_out_sp0_tp0_pp3 -> layer_14_attn_ar_sp0_pp3
	layer_14_attn_out_sp0_tp1_pp3 -> layer_14_attn_ar_sp0_pp3
	layer_14_attn_out_sp0_tp2_pp3 -> layer_14_attn_ar_sp0_pp3
	layer_14_attn_out_sp0_tp3_pp3 -> layer_14_attn_ar_sp0_pp3
	layer_14_attn_res_sp0_pp3 [label="Attention Residual L14 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_attn_ar_sp0_pp3 -> layer_14_attn_res_sp0_pp3
	layer_14_norm_sp0_pp3 -> layer_14_attn_res_sp0_pp3 [style=dashed]
	layer_14_post_norm_sp0_pp3 [label="Post-Attn Norm L14 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_attn_res_sp0_pp3 -> layer_14_post_norm_sp0_pp3
	layer_14_router_sp0_pp3 [label="MoE Router L14 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_14_post_norm_sp0_pp3 -> layer_14_router_sp0_pp3
	layer_14_dispatch_sp0_ep0_pp3 [label="Token Dispatch L14 SP0 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep0_pp3 [style=dashed]
	layer_14_expert_sp0_ep0_tp0_pp3 [label="Expert L14 SP0 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep0_pp3 -> layer_14_expert_sp0_ep0_tp0_pp3
	layer_14_expert_out_sp0_ep0_tp0_pp3 [label="Expert Out L14 SP0 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep0_tp0_pp3 -> layer_14_expert_out_sp0_ep0_tp0_pp3
	layer_14_expert_sp0_ep0_tp1_pp3 [label="Expert L14 SP0 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep0_pp3 -> layer_14_expert_sp0_ep0_tp1_pp3
	layer_14_expert_out_sp0_ep0_tp1_pp3 [label="Expert Out L14 SP0 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep0_tp1_pp3 -> layer_14_expert_out_sp0_ep0_tp1_pp3
	layer_14_expert_sp0_ep0_tp2_pp3 [label="Expert L14 SP0 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep0_pp3 -> layer_14_expert_sp0_ep0_tp2_pp3
	layer_14_expert_out_sp0_ep0_tp2_pp3 [label="Expert Out L14 SP0 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep0_tp2_pp3 -> layer_14_expert_out_sp0_ep0_tp2_pp3
	layer_14_expert_sp0_ep0_tp3_pp3 [label="Expert L14 SP0 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep0_pp3 -> layer_14_expert_sp0_ep0_tp3_pp3
	layer_14_expert_out_sp0_ep0_tp3_pp3 [label="Expert Out L14 SP0 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep0_tp3_pp3 -> layer_14_expert_out_sp0_ep0_tp3_pp3
	layer_14_expert_ar_sp0_ep0_pp3 [label="Expert All-Reduce L14 SP0 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep0_tp0_pp3 -> layer_14_expert_ar_sp0_ep0_pp3
	layer_14_expert_out_sp0_ep0_tp1_pp3 -> layer_14_expert_ar_sp0_ep0_pp3
	layer_14_expert_out_sp0_ep0_tp2_pp3 -> layer_14_expert_ar_sp0_ep0_pp3
	layer_14_expert_out_sp0_ep0_tp3_pp3 -> layer_14_expert_ar_sp0_ep0_pp3
	layer_14_combine_sp0_ep0_pp3 [label="Token Combine L14 SP0 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep0_pp3 -> layer_14_combine_sp0_ep0_pp3
	layer_14_dispatch_sp0_ep1_pp3 [label="Token Dispatch L14 SP0 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep1_pp3 [style=dashed]
	layer_14_expert_sp0_ep1_tp0_pp3 [label="Expert L14 SP0 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep1_pp3 -> layer_14_expert_sp0_ep1_tp0_pp3
	layer_14_expert_out_sp0_ep1_tp0_pp3 [label="Expert Out L14 SP0 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep1_tp0_pp3 -> layer_14_expert_out_sp0_ep1_tp0_pp3
	layer_14_expert_sp0_ep1_tp1_pp3 [label="Expert L14 SP0 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep1_pp3 -> layer_14_expert_sp0_ep1_tp1_pp3
	layer_14_expert_out_sp0_ep1_tp1_pp3 [label="Expert Out L14 SP0 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep1_tp1_pp3 -> layer_14_expert_out_sp0_ep1_tp1_pp3
	layer_14_expert_sp0_ep1_tp2_pp3 [label="Expert L14 SP0 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep1_pp3 -> layer_14_expert_sp0_ep1_tp2_pp3
	layer_14_expert_out_sp0_ep1_tp2_pp3 [label="Expert Out L14 SP0 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep1_tp2_pp3 -> layer_14_expert_out_sp0_ep1_tp2_pp3
	layer_14_expert_sp0_ep1_tp3_pp3 [label="Expert L14 SP0 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep1_pp3 -> layer_14_expert_sp0_ep1_tp3_pp3
	layer_14_expert_out_sp0_ep1_tp3_pp3 [label="Expert Out L14 SP0 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep1_tp3_pp3 -> layer_14_expert_out_sp0_ep1_tp3_pp3
	layer_14_expert_ar_sp0_ep1_pp3 [label="Expert All-Reduce L14 SP0 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep1_tp0_pp3 -> layer_14_expert_ar_sp0_ep1_pp3
	layer_14_expert_out_sp0_ep1_tp1_pp3 -> layer_14_expert_ar_sp0_ep1_pp3
	layer_14_expert_out_sp0_ep1_tp2_pp3 -> layer_14_expert_ar_sp0_ep1_pp3
	layer_14_expert_out_sp0_ep1_tp3_pp3 -> layer_14_expert_ar_sp0_ep1_pp3
	layer_14_combine_sp0_ep1_pp3 [label="Token Combine L14 SP0 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep1_pp3 -> layer_14_combine_sp0_ep1_pp3
	layer_14_dispatch_sp0_ep2_pp3 [label="Token Dispatch L14 SP0 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep2_pp3 [style=dashed]
	layer_14_expert_sp0_ep2_tp0_pp3 [label="Expert L14 SP0 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep2_pp3 -> layer_14_expert_sp0_ep2_tp0_pp3
	layer_14_expert_out_sp0_ep2_tp0_pp3 [label="Expert Out L14 SP0 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep2_tp0_pp3 -> layer_14_expert_out_sp0_ep2_tp0_pp3
	layer_14_expert_sp0_ep2_tp1_pp3 [label="Expert L14 SP0 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep2_pp3 -> layer_14_expert_sp0_ep2_tp1_pp3
	layer_14_expert_out_sp0_ep2_tp1_pp3 [label="Expert Out L14 SP0 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep2_tp1_pp3 -> layer_14_expert_out_sp0_ep2_tp1_pp3
	layer_14_expert_sp0_ep2_tp2_pp3 [label="Expert L14 SP0 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep2_pp3 -> layer_14_expert_sp0_ep2_tp2_pp3
	layer_14_expert_out_sp0_ep2_tp2_pp3 [label="Expert Out L14 SP0 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep2_tp2_pp3 -> layer_14_expert_out_sp0_ep2_tp2_pp3
	layer_14_expert_sp0_ep2_tp3_pp3 [label="Expert L14 SP0 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep2_pp3 -> layer_14_expert_sp0_ep2_tp3_pp3
	layer_14_expert_out_sp0_ep2_tp3_pp3 [label="Expert Out L14 SP0 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep2_tp3_pp3 -> layer_14_expert_out_sp0_ep2_tp3_pp3
	layer_14_expert_ar_sp0_ep2_pp3 [label="Expert All-Reduce L14 SP0 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep2_tp0_pp3 -> layer_14_expert_ar_sp0_ep2_pp3
	layer_14_expert_out_sp0_ep2_tp1_pp3 -> layer_14_expert_ar_sp0_ep2_pp3
	layer_14_expert_out_sp0_ep2_tp2_pp3 -> layer_14_expert_ar_sp0_ep2_pp3
	layer_14_expert_out_sp0_ep2_tp3_pp3 -> layer_14_expert_ar_sp0_ep2_pp3
	layer_14_combine_sp0_ep2_pp3 [label="Token Combine L14 SP0 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep2_pp3 -> layer_14_combine_sp0_ep2_pp3
	layer_14_dispatch_sp0_ep3_pp3 [label="Token Dispatch L14 SP0 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep3_pp3 [style=dashed]
	layer_14_expert_sp0_ep3_tp0_pp3 [label="Expert L14 SP0 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep3_pp3 -> layer_14_expert_sp0_ep3_tp0_pp3
	layer_14_expert_out_sp0_ep3_tp0_pp3 [label="Expert Out L14 SP0 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep3_tp0_pp3 -> layer_14_expert_out_sp0_ep3_tp0_pp3
	layer_14_expert_sp0_ep3_tp1_pp3 [label="Expert L14 SP0 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep3_pp3 -> layer_14_expert_sp0_ep3_tp1_pp3
	layer_14_expert_out_sp0_ep3_tp1_pp3 [label="Expert Out L14 SP0 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep3_tp1_pp3 -> layer_14_expert_out_sp0_ep3_tp1_pp3
	layer_14_expert_sp0_ep3_tp2_pp3 [label="Expert L14 SP0 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep3_pp3 -> layer_14_expert_sp0_ep3_tp2_pp3
	layer_14_expert_out_sp0_ep3_tp2_pp3 [label="Expert Out L14 SP0 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep3_tp2_pp3 -> layer_14_expert_out_sp0_ep3_tp2_pp3
	layer_14_expert_sp0_ep3_tp3_pp3 [label="Expert L14 SP0 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep3_pp3 -> layer_14_expert_sp0_ep3_tp3_pp3
	layer_14_expert_out_sp0_ep3_tp3_pp3 [label="Expert Out L14 SP0 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep3_tp3_pp3 -> layer_14_expert_out_sp0_ep3_tp3_pp3
	layer_14_expert_ar_sp0_ep3_pp3 [label="Expert All-Reduce L14 SP0 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep3_tp0_pp3 -> layer_14_expert_ar_sp0_ep3_pp3
	layer_14_expert_out_sp0_ep3_tp1_pp3 -> layer_14_expert_ar_sp0_ep3_pp3
	layer_14_expert_out_sp0_ep3_tp2_pp3 -> layer_14_expert_ar_sp0_ep3_pp3
	layer_14_expert_out_sp0_ep3_tp3_pp3 -> layer_14_expert_ar_sp0_ep3_pp3
	layer_14_combine_sp0_ep3_pp3 [label="Token Combine L14 SP0 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep3_pp3 -> layer_14_combine_sp0_ep3_pp3
	layer_14_dispatch_sp0_ep4_pp3 [label="Token Dispatch L14 SP0 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep4_pp3 [style=dashed]
	layer_14_expert_sp0_ep4_tp0_pp3 [label="Expert L14 SP0 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep4_pp3 -> layer_14_expert_sp0_ep4_tp0_pp3
	layer_14_expert_out_sp0_ep4_tp0_pp3 [label="Expert Out L14 SP0 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep4_tp0_pp3 -> layer_14_expert_out_sp0_ep4_tp0_pp3
	layer_14_expert_sp0_ep4_tp1_pp3 [label="Expert L14 SP0 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep4_pp3 -> layer_14_expert_sp0_ep4_tp1_pp3
	layer_14_expert_out_sp0_ep4_tp1_pp3 [label="Expert Out L14 SP0 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep4_tp1_pp3 -> layer_14_expert_out_sp0_ep4_tp1_pp3
	layer_14_expert_sp0_ep4_tp2_pp3 [label="Expert L14 SP0 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep4_pp3 -> layer_14_expert_sp0_ep4_tp2_pp3
	layer_14_expert_out_sp0_ep4_tp2_pp3 [label="Expert Out L14 SP0 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep4_tp2_pp3 -> layer_14_expert_out_sp0_ep4_tp2_pp3
	layer_14_expert_sp0_ep4_tp3_pp3 [label="Expert L14 SP0 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep4_pp3 -> layer_14_expert_sp0_ep4_tp3_pp3
	layer_14_expert_out_sp0_ep4_tp3_pp3 [label="Expert Out L14 SP0 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep4_tp3_pp3 -> layer_14_expert_out_sp0_ep4_tp3_pp3
	layer_14_expert_ar_sp0_ep4_pp3 [label="Expert All-Reduce L14 SP0 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep4_tp0_pp3 -> layer_14_expert_ar_sp0_ep4_pp3
	layer_14_expert_out_sp0_ep4_tp1_pp3 -> layer_14_expert_ar_sp0_ep4_pp3
	layer_14_expert_out_sp0_ep4_tp2_pp3 -> layer_14_expert_ar_sp0_ep4_pp3
	layer_14_expert_out_sp0_ep4_tp3_pp3 -> layer_14_expert_ar_sp0_ep4_pp3
	layer_14_combine_sp0_ep4_pp3 [label="Token Combine L14 SP0 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep4_pp3 -> layer_14_combine_sp0_ep4_pp3
	layer_14_dispatch_sp0_ep5_pp3 [label="Token Dispatch L14 SP0 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep5_pp3 [style=dashed]
	layer_14_expert_sp0_ep5_tp0_pp3 [label="Expert L14 SP0 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep5_pp3 -> layer_14_expert_sp0_ep5_tp0_pp3
	layer_14_expert_out_sp0_ep5_tp0_pp3 [label="Expert Out L14 SP0 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep5_tp0_pp3 -> layer_14_expert_out_sp0_ep5_tp0_pp3
	layer_14_expert_sp0_ep5_tp1_pp3 [label="Expert L14 SP0 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep5_pp3 -> layer_14_expert_sp0_ep5_tp1_pp3
	layer_14_expert_out_sp0_ep5_tp1_pp3 [label="Expert Out L14 SP0 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep5_tp1_pp3 -> layer_14_expert_out_sp0_ep5_tp1_pp3
	layer_14_expert_sp0_ep5_tp2_pp3 [label="Expert L14 SP0 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep5_pp3 -> layer_14_expert_sp0_ep5_tp2_pp3
	layer_14_expert_out_sp0_ep5_tp2_pp3 [label="Expert Out L14 SP0 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep5_tp2_pp3 -> layer_14_expert_out_sp0_ep5_tp2_pp3
	layer_14_expert_sp0_ep5_tp3_pp3 [label="Expert L14 SP0 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep5_pp3 -> layer_14_expert_sp0_ep5_tp3_pp3
	layer_14_expert_out_sp0_ep5_tp3_pp3 [label="Expert Out L14 SP0 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep5_tp3_pp3 -> layer_14_expert_out_sp0_ep5_tp3_pp3
	layer_14_expert_ar_sp0_ep5_pp3 [label="Expert All-Reduce L14 SP0 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep5_tp0_pp3 -> layer_14_expert_ar_sp0_ep5_pp3
	layer_14_expert_out_sp0_ep5_tp1_pp3 -> layer_14_expert_ar_sp0_ep5_pp3
	layer_14_expert_out_sp0_ep5_tp2_pp3 -> layer_14_expert_ar_sp0_ep5_pp3
	layer_14_expert_out_sp0_ep5_tp3_pp3 -> layer_14_expert_ar_sp0_ep5_pp3
	layer_14_combine_sp0_ep5_pp3 [label="Token Combine L14 SP0 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep5_pp3 -> layer_14_combine_sp0_ep5_pp3
	layer_14_dispatch_sp0_ep6_pp3 [label="Token Dispatch L14 SP0 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep6_pp3 [style=dashed]
	layer_14_expert_sp0_ep6_tp0_pp3 [label="Expert L14 SP0 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep6_pp3 -> layer_14_expert_sp0_ep6_tp0_pp3
	layer_14_expert_out_sp0_ep6_tp0_pp3 [label="Expert Out L14 SP0 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep6_tp0_pp3 -> layer_14_expert_out_sp0_ep6_tp0_pp3
	layer_14_expert_sp0_ep6_tp1_pp3 [label="Expert L14 SP0 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep6_pp3 -> layer_14_expert_sp0_ep6_tp1_pp3
	layer_14_expert_out_sp0_ep6_tp1_pp3 [label="Expert Out L14 SP0 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep6_tp1_pp3 -> layer_14_expert_out_sp0_ep6_tp1_pp3
	layer_14_expert_sp0_ep6_tp2_pp3 [label="Expert L14 SP0 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep6_pp3 -> layer_14_expert_sp0_ep6_tp2_pp3
	layer_14_expert_out_sp0_ep6_tp2_pp3 [label="Expert Out L14 SP0 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep6_tp2_pp3 -> layer_14_expert_out_sp0_ep6_tp2_pp3
	layer_14_expert_sp0_ep6_tp3_pp3 [label="Expert L14 SP0 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep6_pp3 -> layer_14_expert_sp0_ep6_tp3_pp3
	layer_14_expert_out_sp0_ep6_tp3_pp3 [label="Expert Out L14 SP0 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep6_tp3_pp3 -> layer_14_expert_out_sp0_ep6_tp3_pp3
	layer_14_expert_ar_sp0_ep6_pp3 [label="Expert All-Reduce L14 SP0 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep6_tp0_pp3 -> layer_14_expert_ar_sp0_ep6_pp3
	layer_14_expert_out_sp0_ep6_tp1_pp3 -> layer_14_expert_ar_sp0_ep6_pp3
	layer_14_expert_out_sp0_ep6_tp2_pp3 -> layer_14_expert_ar_sp0_ep6_pp3
	layer_14_expert_out_sp0_ep6_tp3_pp3 -> layer_14_expert_ar_sp0_ep6_pp3
	layer_14_combine_sp0_ep6_pp3 [label="Token Combine L14 SP0 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep6_pp3 -> layer_14_combine_sp0_ep6_pp3
	layer_14_dispatch_sp0_ep7_pp3 [label="Token Dispatch L14 SP0 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep7_pp3 [style=dashed]
	layer_14_expert_sp0_ep7_tp0_pp3 [label="Expert L14 SP0 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep7_pp3 -> layer_14_expert_sp0_ep7_tp0_pp3
	layer_14_expert_out_sp0_ep7_tp0_pp3 [label="Expert Out L14 SP0 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep7_tp0_pp3 -> layer_14_expert_out_sp0_ep7_tp0_pp3
	layer_14_expert_sp0_ep7_tp1_pp3 [label="Expert L14 SP0 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep7_pp3 -> layer_14_expert_sp0_ep7_tp1_pp3
	layer_14_expert_out_sp0_ep7_tp1_pp3 [label="Expert Out L14 SP0 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep7_tp1_pp3 -> layer_14_expert_out_sp0_ep7_tp1_pp3
	layer_14_expert_sp0_ep7_tp2_pp3 [label="Expert L14 SP0 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep7_pp3 -> layer_14_expert_sp0_ep7_tp2_pp3
	layer_14_expert_out_sp0_ep7_tp2_pp3 [label="Expert Out L14 SP0 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep7_tp2_pp3 -> layer_14_expert_out_sp0_ep7_tp2_pp3
	layer_14_expert_sp0_ep7_tp3_pp3 [label="Expert L14 SP0 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep7_pp3 -> layer_14_expert_sp0_ep7_tp3_pp3
	layer_14_expert_out_sp0_ep7_tp3_pp3 [label="Expert Out L14 SP0 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep7_tp3_pp3 -> layer_14_expert_out_sp0_ep7_tp3_pp3
	layer_14_expert_ar_sp0_ep7_pp3 [label="Expert All-Reduce L14 SP0 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep7_tp0_pp3 -> layer_14_expert_ar_sp0_ep7_pp3
	layer_14_expert_out_sp0_ep7_tp1_pp3 -> layer_14_expert_ar_sp0_ep7_pp3
	layer_14_expert_out_sp0_ep7_tp2_pp3 -> layer_14_expert_ar_sp0_ep7_pp3
	layer_14_expert_out_sp0_ep7_tp3_pp3 -> layer_14_expert_ar_sp0_ep7_pp3
	layer_14_combine_sp0_ep7_pp3 [label="Token Combine L14 SP0 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep7_pp3 -> layer_14_combine_sp0_ep7_pp3
	layer_14_dispatch_sp0_ep8_pp3 [label="Token Dispatch L14 SP0 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep8_pp3 [style=dashed]
	layer_14_expert_sp0_ep8_tp0_pp3 [label="Expert L14 SP0 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep8_pp3 -> layer_14_expert_sp0_ep8_tp0_pp3
	layer_14_expert_out_sp0_ep8_tp0_pp3 [label="Expert Out L14 SP0 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep8_tp0_pp3 -> layer_14_expert_out_sp0_ep8_tp0_pp3
	layer_14_expert_sp0_ep8_tp1_pp3 [label="Expert L14 SP0 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep8_pp3 -> layer_14_expert_sp0_ep8_tp1_pp3
	layer_14_expert_out_sp0_ep8_tp1_pp3 [label="Expert Out L14 SP0 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep8_tp1_pp3 -> layer_14_expert_out_sp0_ep8_tp1_pp3
	layer_14_expert_sp0_ep8_tp2_pp3 [label="Expert L14 SP0 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep8_pp3 -> layer_14_expert_sp0_ep8_tp2_pp3
	layer_14_expert_out_sp0_ep8_tp2_pp3 [label="Expert Out L14 SP0 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep8_tp2_pp3 -> layer_14_expert_out_sp0_ep8_tp2_pp3
	layer_14_expert_sp0_ep8_tp3_pp3 [label="Expert L14 SP0 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep8_pp3 -> layer_14_expert_sp0_ep8_tp3_pp3
	layer_14_expert_out_sp0_ep8_tp3_pp3 [label="Expert Out L14 SP0 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep8_tp3_pp3 -> layer_14_expert_out_sp0_ep8_tp3_pp3
	layer_14_expert_ar_sp0_ep8_pp3 [label="Expert All-Reduce L14 SP0 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep8_tp0_pp3 -> layer_14_expert_ar_sp0_ep8_pp3
	layer_14_expert_out_sp0_ep8_tp1_pp3 -> layer_14_expert_ar_sp0_ep8_pp3
	layer_14_expert_out_sp0_ep8_tp2_pp3 -> layer_14_expert_ar_sp0_ep8_pp3
	layer_14_expert_out_sp0_ep8_tp3_pp3 -> layer_14_expert_ar_sp0_ep8_pp3
	layer_14_combine_sp0_ep8_pp3 [label="Token Combine L14 SP0 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep8_pp3 -> layer_14_combine_sp0_ep8_pp3
	layer_14_dispatch_sp0_ep9_pp3 [label="Token Dispatch L14 SP0 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep9_pp3 [style=dashed]
	layer_14_expert_sp0_ep9_tp0_pp3 [label="Expert L14 SP0 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep9_pp3 -> layer_14_expert_sp0_ep9_tp0_pp3
	layer_14_expert_out_sp0_ep9_tp0_pp3 [label="Expert Out L14 SP0 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep9_tp0_pp3 -> layer_14_expert_out_sp0_ep9_tp0_pp3
	layer_14_expert_sp0_ep9_tp1_pp3 [label="Expert L14 SP0 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep9_pp3 -> layer_14_expert_sp0_ep9_tp1_pp3
	layer_14_expert_out_sp0_ep9_tp1_pp3 [label="Expert Out L14 SP0 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep9_tp1_pp3 -> layer_14_expert_out_sp0_ep9_tp1_pp3
	layer_14_expert_sp0_ep9_tp2_pp3 [label="Expert L14 SP0 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep9_pp3 -> layer_14_expert_sp0_ep9_tp2_pp3
	layer_14_expert_out_sp0_ep9_tp2_pp3 [label="Expert Out L14 SP0 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep9_tp2_pp3 -> layer_14_expert_out_sp0_ep9_tp2_pp3
	layer_14_expert_sp0_ep9_tp3_pp3 [label="Expert L14 SP0 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep9_pp3 -> layer_14_expert_sp0_ep9_tp3_pp3
	layer_14_expert_out_sp0_ep9_tp3_pp3 [label="Expert Out L14 SP0 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep9_tp3_pp3 -> layer_14_expert_out_sp0_ep9_tp3_pp3
	layer_14_expert_ar_sp0_ep9_pp3 [label="Expert All-Reduce L14 SP0 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep9_tp0_pp3 -> layer_14_expert_ar_sp0_ep9_pp3
	layer_14_expert_out_sp0_ep9_tp1_pp3 -> layer_14_expert_ar_sp0_ep9_pp3
	layer_14_expert_out_sp0_ep9_tp2_pp3 -> layer_14_expert_ar_sp0_ep9_pp3
	layer_14_expert_out_sp0_ep9_tp3_pp3 -> layer_14_expert_ar_sp0_ep9_pp3
	layer_14_combine_sp0_ep9_pp3 [label="Token Combine L14 SP0 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep9_pp3 -> layer_14_combine_sp0_ep9_pp3
	layer_14_dispatch_sp0_ep10_pp3 [label="Token Dispatch L14 SP0 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep10_pp3 [style=dashed]
	layer_14_expert_sp0_ep10_tp0_pp3 [label="Expert L14 SP0 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep10_pp3 -> layer_14_expert_sp0_ep10_tp0_pp3
	layer_14_expert_out_sp0_ep10_tp0_pp3 [label="Expert Out L14 SP0 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep10_tp0_pp3 -> layer_14_expert_out_sp0_ep10_tp0_pp3
	layer_14_expert_sp0_ep10_tp1_pp3 [label="Expert L14 SP0 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep10_pp3 -> layer_14_expert_sp0_ep10_tp1_pp3
	layer_14_expert_out_sp0_ep10_tp1_pp3 [label="Expert Out L14 SP0 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep10_tp1_pp3 -> layer_14_expert_out_sp0_ep10_tp1_pp3
	layer_14_expert_sp0_ep10_tp2_pp3 [label="Expert L14 SP0 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep10_pp3 -> layer_14_expert_sp0_ep10_tp2_pp3
	layer_14_expert_out_sp0_ep10_tp2_pp3 [label="Expert Out L14 SP0 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep10_tp2_pp3 -> layer_14_expert_out_sp0_ep10_tp2_pp3
	layer_14_expert_sp0_ep10_tp3_pp3 [label="Expert L14 SP0 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep10_pp3 -> layer_14_expert_sp0_ep10_tp3_pp3
	layer_14_expert_out_sp0_ep10_tp3_pp3 [label="Expert Out L14 SP0 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep10_tp3_pp3 -> layer_14_expert_out_sp0_ep10_tp3_pp3
	layer_14_expert_ar_sp0_ep10_pp3 [label="Expert All-Reduce L14 SP0 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep10_tp0_pp3 -> layer_14_expert_ar_sp0_ep10_pp3
	layer_14_expert_out_sp0_ep10_tp1_pp3 -> layer_14_expert_ar_sp0_ep10_pp3
	layer_14_expert_out_sp0_ep10_tp2_pp3 -> layer_14_expert_ar_sp0_ep10_pp3
	layer_14_expert_out_sp0_ep10_tp3_pp3 -> layer_14_expert_ar_sp0_ep10_pp3
	layer_14_combine_sp0_ep10_pp3 [label="Token Combine L14 SP0 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep10_pp3 -> layer_14_combine_sp0_ep10_pp3
	layer_14_dispatch_sp0_ep11_pp3 [label="Token Dispatch L14 SP0 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep11_pp3 [style=dashed]
	layer_14_expert_sp0_ep11_tp0_pp3 [label="Expert L14 SP0 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep11_pp3 -> layer_14_expert_sp0_ep11_tp0_pp3
	layer_14_expert_out_sp0_ep11_tp0_pp3 [label="Expert Out L14 SP0 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep11_tp0_pp3 -> layer_14_expert_out_sp0_ep11_tp0_pp3
	layer_14_expert_sp0_ep11_tp1_pp3 [label="Expert L14 SP0 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep11_pp3 -> layer_14_expert_sp0_ep11_tp1_pp3
	layer_14_expert_out_sp0_ep11_tp1_pp3 [label="Expert Out L14 SP0 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep11_tp1_pp3 -> layer_14_expert_out_sp0_ep11_tp1_pp3
	layer_14_expert_sp0_ep11_tp2_pp3 [label="Expert L14 SP0 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep11_pp3 -> layer_14_expert_sp0_ep11_tp2_pp3
	layer_14_expert_out_sp0_ep11_tp2_pp3 [label="Expert Out L14 SP0 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep11_tp2_pp3 -> layer_14_expert_out_sp0_ep11_tp2_pp3
	layer_14_expert_sp0_ep11_tp3_pp3 [label="Expert L14 SP0 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep11_pp3 -> layer_14_expert_sp0_ep11_tp3_pp3
	layer_14_expert_out_sp0_ep11_tp3_pp3 [label="Expert Out L14 SP0 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep11_tp3_pp3 -> layer_14_expert_out_sp0_ep11_tp3_pp3
	layer_14_expert_ar_sp0_ep11_pp3 [label="Expert All-Reduce L14 SP0 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep11_tp0_pp3 -> layer_14_expert_ar_sp0_ep11_pp3
	layer_14_expert_out_sp0_ep11_tp1_pp3 -> layer_14_expert_ar_sp0_ep11_pp3
	layer_14_expert_out_sp0_ep11_tp2_pp3 -> layer_14_expert_ar_sp0_ep11_pp3
	layer_14_expert_out_sp0_ep11_tp3_pp3 -> layer_14_expert_ar_sp0_ep11_pp3
	layer_14_combine_sp0_ep11_pp3 [label="Token Combine L14 SP0 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep11_pp3 -> layer_14_combine_sp0_ep11_pp3
	layer_14_dispatch_sp0_ep12_pp3 [label="Token Dispatch L14 SP0 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep12_pp3 [style=dashed]
	layer_14_expert_sp0_ep12_tp0_pp3 [label="Expert L14 SP0 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep12_pp3 -> layer_14_expert_sp0_ep12_tp0_pp3
	layer_14_expert_out_sp0_ep12_tp0_pp3 [label="Expert Out L14 SP0 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep12_tp0_pp3 -> layer_14_expert_out_sp0_ep12_tp0_pp3
	layer_14_expert_sp0_ep12_tp1_pp3 [label="Expert L14 SP0 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep12_pp3 -> layer_14_expert_sp0_ep12_tp1_pp3
	layer_14_expert_out_sp0_ep12_tp1_pp3 [label="Expert Out L14 SP0 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep12_tp1_pp3 -> layer_14_expert_out_sp0_ep12_tp1_pp3
	layer_14_expert_sp0_ep12_tp2_pp3 [label="Expert L14 SP0 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep12_pp3 -> layer_14_expert_sp0_ep12_tp2_pp3
	layer_14_expert_out_sp0_ep12_tp2_pp3 [label="Expert Out L14 SP0 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep12_tp2_pp3 -> layer_14_expert_out_sp0_ep12_tp2_pp3
	layer_14_expert_sp0_ep12_tp3_pp3 [label="Expert L14 SP0 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep12_pp3 -> layer_14_expert_sp0_ep12_tp3_pp3
	layer_14_expert_out_sp0_ep12_tp3_pp3 [label="Expert Out L14 SP0 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep12_tp3_pp3 -> layer_14_expert_out_sp0_ep12_tp3_pp3
	layer_14_expert_ar_sp0_ep12_pp3 [label="Expert All-Reduce L14 SP0 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep12_tp0_pp3 -> layer_14_expert_ar_sp0_ep12_pp3
	layer_14_expert_out_sp0_ep12_tp1_pp3 -> layer_14_expert_ar_sp0_ep12_pp3
	layer_14_expert_out_sp0_ep12_tp2_pp3 -> layer_14_expert_ar_sp0_ep12_pp3
	layer_14_expert_out_sp0_ep12_tp3_pp3 -> layer_14_expert_ar_sp0_ep12_pp3
	layer_14_combine_sp0_ep12_pp3 [label="Token Combine L14 SP0 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep12_pp3 -> layer_14_combine_sp0_ep12_pp3
	layer_14_dispatch_sp0_ep13_pp3 [label="Token Dispatch L14 SP0 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep13_pp3 [style=dashed]
	layer_14_expert_sp0_ep13_tp0_pp3 [label="Expert L14 SP0 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep13_pp3 -> layer_14_expert_sp0_ep13_tp0_pp3
	layer_14_expert_out_sp0_ep13_tp0_pp3 [label="Expert Out L14 SP0 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep13_tp0_pp3 -> layer_14_expert_out_sp0_ep13_tp0_pp3
	layer_14_expert_sp0_ep13_tp1_pp3 [label="Expert L14 SP0 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep13_pp3 -> layer_14_expert_sp0_ep13_tp1_pp3
	layer_14_expert_out_sp0_ep13_tp1_pp3 [label="Expert Out L14 SP0 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep13_tp1_pp3 -> layer_14_expert_out_sp0_ep13_tp1_pp3
	layer_14_expert_sp0_ep13_tp2_pp3 [label="Expert L14 SP0 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep13_pp3 -> layer_14_expert_sp0_ep13_tp2_pp3
	layer_14_expert_out_sp0_ep13_tp2_pp3 [label="Expert Out L14 SP0 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep13_tp2_pp3 -> layer_14_expert_out_sp0_ep13_tp2_pp3
	layer_14_expert_sp0_ep13_tp3_pp3 [label="Expert L14 SP0 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep13_pp3 -> layer_14_expert_sp0_ep13_tp3_pp3
	layer_14_expert_out_sp0_ep13_tp3_pp3 [label="Expert Out L14 SP0 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep13_tp3_pp3 -> layer_14_expert_out_sp0_ep13_tp3_pp3
	layer_14_expert_ar_sp0_ep13_pp3 [label="Expert All-Reduce L14 SP0 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep13_tp0_pp3 -> layer_14_expert_ar_sp0_ep13_pp3
	layer_14_expert_out_sp0_ep13_tp1_pp3 -> layer_14_expert_ar_sp0_ep13_pp3
	layer_14_expert_out_sp0_ep13_tp2_pp3 -> layer_14_expert_ar_sp0_ep13_pp3
	layer_14_expert_out_sp0_ep13_tp3_pp3 -> layer_14_expert_ar_sp0_ep13_pp3
	layer_14_combine_sp0_ep13_pp3 [label="Token Combine L14 SP0 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep13_pp3 -> layer_14_combine_sp0_ep13_pp3
	layer_14_dispatch_sp0_ep14_pp3 [label="Token Dispatch L14 SP0 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep14_pp3 [style=dashed]
	layer_14_expert_sp0_ep14_tp0_pp3 [label="Expert L14 SP0 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep14_pp3 -> layer_14_expert_sp0_ep14_tp0_pp3
	layer_14_expert_out_sp0_ep14_tp0_pp3 [label="Expert Out L14 SP0 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep14_tp0_pp3 -> layer_14_expert_out_sp0_ep14_tp0_pp3
	layer_14_expert_sp0_ep14_tp1_pp3 [label="Expert L14 SP0 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep14_pp3 -> layer_14_expert_sp0_ep14_tp1_pp3
	layer_14_expert_out_sp0_ep14_tp1_pp3 [label="Expert Out L14 SP0 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep14_tp1_pp3 -> layer_14_expert_out_sp0_ep14_tp1_pp3
	layer_14_expert_sp0_ep14_tp2_pp3 [label="Expert L14 SP0 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep14_pp3 -> layer_14_expert_sp0_ep14_tp2_pp3
	layer_14_expert_out_sp0_ep14_tp2_pp3 [label="Expert Out L14 SP0 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep14_tp2_pp3 -> layer_14_expert_out_sp0_ep14_tp2_pp3
	layer_14_expert_sp0_ep14_tp3_pp3 [label="Expert L14 SP0 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep14_pp3 -> layer_14_expert_sp0_ep14_tp3_pp3
	layer_14_expert_out_sp0_ep14_tp3_pp3 [label="Expert Out L14 SP0 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep14_tp3_pp3 -> layer_14_expert_out_sp0_ep14_tp3_pp3
	layer_14_expert_ar_sp0_ep14_pp3 [label="Expert All-Reduce L14 SP0 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep14_tp0_pp3 -> layer_14_expert_ar_sp0_ep14_pp3
	layer_14_expert_out_sp0_ep14_tp1_pp3 -> layer_14_expert_ar_sp0_ep14_pp3
	layer_14_expert_out_sp0_ep14_tp2_pp3 -> layer_14_expert_ar_sp0_ep14_pp3
	layer_14_expert_out_sp0_ep14_tp3_pp3 -> layer_14_expert_ar_sp0_ep14_pp3
	layer_14_combine_sp0_ep14_pp3 [label="Token Combine L14 SP0 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep14_pp3 -> layer_14_combine_sp0_ep14_pp3
	layer_14_dispatch_sp0_ep15_pp3 [label="Token Dispatch L14 SP0 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp0_pp3 -> layer_14_dispatch_sp0_ep15_pp3 [style=dashed]
	layer_14_expert_sp0_ep15_tp0_pp3 [label="Expert L14 SP0 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep15_pp3 -> layer_14_expert_sp0_ep15_tp0_pp3
	layer_14_expert_out_sp0_ep15_tp0_pp3 [label="Expert Out L14 SP0 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep15_tp0_pp3 -> layer_14_expert_out_sp0_ep15_tp0_pp3
	layer_14_expert_sp0_ep15_tp1_pp3 [label="Expert L14 SP0 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep15_pp3 -> layer_14_expert_sp0_ep15_tp1_pp3
	layer_14_expert_out_sp0_ep15_tp1_pp3 [label="Expert Out L14 SP0 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep15_tp1_pp3 -> layer_14_expert_out_sp0_ep15_tp1_pp3
	layer_14_expert_sp0_ep15_tp2_pp3 [label="Expert L14 SP0 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep15_pp3 -> layer_14_expert_sp0_ep15_tp2_pp3
	layer_14_expert_out_sp0_ep15_tp2_pp3 [label="Expert Out L14 SP0 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep15_tp2_pp3 -> layer_14_expert_out_sp0_ep15_tp2_pp3
	layer_14_expert_sp0_ep15_tp3_pp3 [label="Expert L14 SP0 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp0_ep15_pp3 -> layer_14_expert_sp0_ep15_tp3_pp3
	layer_14_expert_out_sp0_ep15_tp3_pp3 [label="Expert Out L14 SP0 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp0_ep15_tp3_pp3 -> layer_14_expert_out_sp0_ep15_tp3_pp3
	layer_14_expert_ar_sp0_ep15_pp3 [label="Expert All-Reduce L14 SP0 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp0_ep15_tp0_pp3 -> layer_14_expert_ar_sp0_ep15_pp3
	layer_14_expert_out_sp0_ep15_tp1_pp3 -> layer_14_expert_ar_sp0_ep15_pp3
	layer_14_expert_out_sp0_ep15_tp2_pp3 -> layer_14_expert_ar_sp0_ep15_pp3
	layer_14_expert_out_sp0_ep15_tp3_pp3 -> layer_14_expert_ar_sp0_ep15_pp3
	layer_14_combine_sp0_ep15_pp3 [label="Token Combine L14 SP0 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp0_ep15_pp3 -> layer_14_combine_sp0_ep15_pp3
	layer_14_moe_all2all_sp0_pp3 [label="MoE All-to-All L14 SP0\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_14_combine_sp0_ep0_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep1_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep2_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep3_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep4_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep5_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep6_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep7_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep8_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep9_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep10_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep11_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep12_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep13_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep14_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_combine_sp0_ep15_pp3 -> layer_14_moe_all2all_sp0_pp3
	layer_14_mlp_out_sp0_pp3 [label="MoE Output L14 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_moe_all2all_sp0_pp3 -> layer_14_mlp_out_sp0_pp3
	layer_14_mlp_res_sp0_pp3 [label="MLP Residual L14 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_mlp_out_sp0_pp3 -> layer_14_mlp_res_sp0_pp3
	layer_14_attn_res_sp0_pp3 -> layer_14_mlp_res_sp0_pp3 [style=dashed]
	layer_14_norm_sp1_pp3 [label="LayerNorm L14 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_mlp_out_sp1_pp3 -> layer_14_norm_sp1_pp3
	layer_14_qkv_sp1_tp0_pp3 [label="QKV Proj L14 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp1_pp3 -> layer_14_qkv_sp1_tp0_pp3
	layer_14_attn_sp1_tp0_pp3 [label="Attention L14 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp1_tp0_pp3 -> layer_14_attn_sp1_tp0_pp3
	layer_14_attn_out_sp1_tp0_pp3 [label="Attn Out Proj L14 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp1_tp0_pp3 -> layer_14_attn_out_sp1_tp0_pp3
	layer_14_qkv_sp1_tp1_pp3 [label="QKV Proj L14 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp1_pp3 -> layer_14_qkv_sp1_tp1_pp3
	layer_14_attn_sp1_tp1_pp3 [label="Attention L14 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp1_tp1_pp3 -> layer_14_attn_sp1_tp1_pp3
	layer_14_attn_out_sp1_tp1_pp3 [label="Attn Out Proj L14 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp1_tp1_pp3 -> layer_14_attn_out_sp1_tp1_pp3
	layer_14_qkv_sp1_tp2_pp3 [label="QKV Proj L14 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp1_pp3 -> layer_14_qkv_sp1_tp2_pp3
	layer_14_attn_sp1_tp2_pp3 [label="Attention L14 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp1_tp2_pp3 -> layer_14_attn_sp1_tp2_pp3
	layer_14_attn_out_sp1_tp2_pp3 [label="Attn Out Proj L14 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp1_tp2_pp3 -> layer_14_attn_out_sp1_tp2_pp3
	layer_14_qkv_sp1_tp3_pp3 [label="QKV Proj L14 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp1_pp3 -> layer_14_qkv_sp1_tp3_pp3
	layer_14_attn_sp1_tp3_pp3 [label="Attention L14 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp1_tp3_pp3 -> layer_14_attn_sp1_tp3_pp3
	layer_14_attn_out_sp1_tp3_pp3 [label="Attn Out Proj L14 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp1_tp3_pp3 -> layer_14_attn_out_sp1_tp3_pp3
	layer_14_attn_ar_sp1_pp3 [label="Attention All-Reduce L14 SP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_attn_out_sp1_tp0_pp3 -> layer_14_attn_ar_sp1_pp3
	layer_14_attn_out_sp1_tp1_pp3 -> layer_14_attn_ar_sp1_pp3
	layer_14_attn_out_sp1_tp2_pp3 -> layer_14_attn_ar_sp1_pp3
	layer_14_attn_out_sp1_tp3_pp3 -> layer_14_attn_ar_sp1_pp3
	layer_14_attn_res_sp1_pp3 [label="Attention Residual L14 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_attn_ar_sp1_pp3 -> layer_14_attn_res_sp1_pp3
	layer_14_norm_sp1_pp3 -> layer_14_attn_res_sp1_pp3 [style=dashed]
	layer_14_post_norm_sp1_pp3 [label="Post-Attn Norm L14 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_attn_res_sp1_pp3 -> layer_14_post_norm_sp1_pp3
	layer_14_router_sp1_pp3 [label="MoE Router L14 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_14_post_norm_sp1_pp3 -> layer_14_router_sp1_pp3
	layer_14_dispatch_sp1_ep0_pp3 [label="Token Dispatch L14 SP1 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep0_pp3 [style=dashed]
	layer_14_expert_sp1_ep0_tp0_pp3 [label="Expert L14 SP1 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep0_pp3 -> layer_14_expert_sp1_ep0_tp0_pp3
	layer_14_expert_out_sp1_ep0_tp0_pp3 [label="Expert Out L14 SP1 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep0_tp0_pp3 -> layer_14_expert_out_sp1_ep0_tp0_pp3
	layer_14_expert_sp1_ep0_tp1_pp3 [label="Expert L14 SP1 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep0_pp3 -> layer_14_expert_sp1_ep0_tp1_pp3
	layer_14_expert_out_sp1_ep0_tp1_pp3 [label="Expert Out L14 SP1 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep0_tp1_pp3 -> layer_14_expert_out_sp1_ep0_tp1_pp3
	layer_14_expert_sp1_ep0_tp2_pp3 [label="Expert L14 SP1 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep0_pp3 -> layer_14_expert_sp1_ep0_tp2_pp3
	layer_14_expert_out_sp1_ep0_tp2_pp3 [label="Expert Out L14 SP1 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep0_tp2_pp3 -> layer_14_expert_out_sp1_ep0_tp2_pp3
	layer_14_expert_sp1_ep0_tp3_pp3 [label="Expert L14 SP1 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep0_pp3 -> layer_14_expert_sp1_ep0_tp3_pp3
	layer_14_expert_out_sp1_ep0_tp3_pp3 [label="Expert Out L14 SP1 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep0_tp3_pp3 -> layer_14_expert_out_sp1_ep0_tp3_pp3
	layer_14_expert_ar_sp1_ep0_pp3 [label="Expert All-Reduce L14 SP1 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep0_tp0_pp3 -> layer_14_expert_ar_sp1_ep0_pp3
	layer_14_expert_out_sp1_ep0_tp1_pp3 -> layer_14_expert_ar_sp1_ep0_pp3
	layer_14_expert_out_sp1_ep0_tp2_pp3 -> layer_14_expert_ar_sp1_ep0_pp3
	layer_14_expert_out_sp1_ep0_tp3_pp3 -> layer_14_expert_ar_sp1_ep0_pp3
	layer_14_combine_sp1_ep0_pp3 [label="Token Combine L14 SP1 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep0_pp3 -> layer_14_combine_sp1_ep0_pp3
	layer_14_dispatch_sp1_ep1_pp3 [label="Token Dispatch L14 SP1 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep1_pp3 [style=dashed]
	layer_14_expert_sp1_ep1_tp0_pp3 [label="Expert L14 SP1 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep1_pp3 -> layer_14_expert_sp1_ep1_tp0_pp3
	layer_14_expert_out_sp1_ep1_tp0_pp3 [label="Expert Out L14 SP1 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep1_tp0_pp3 -> layer_14_expert_out_sp1_ep1_tp0_pp3
	layer_14_expert_sp1_ep1_tp1_pp3 [label="Expert L14 SP1 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep1_pp3 -> layer_14_expert_sp1_ep1_tp1_pp3
	layer_14_expert_out_sp1_ep1_tp1_pp3 [label="Expert Out L14 SP1 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep1_tp1_pp3 -> layer_14_expert_out_sp1_ep1_tp1_pp3
	layer_14_expert_sp1_ep1_tp2_pp3 [label="Expert L14 SP1 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep1_pp3 -> layer_14_expert_sp1_ep1_tp2_pp3
	layer_14_expert_out_sp1_ep1_tp2_pp3 [label="Expert Out L14 SP1 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep1_tp2_pp3 -> layer_14_expert_out_sp1_ep1_tp2_pp3
	layer_14_expert_sp1_ep1_tp3_pp3 [label="Expert L14 SP1 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep1_pp3 -> layer_14_expert_sp1_ep1_tp3_pp3
	layer_14_expert_out_sp1_ep1_tp3_pp3 [label="Expert Out L14 SP1 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep1_tp3_pp3 -> layer_14_expert_out_sp1_ep1_tp3_pp3
	layer_14_expert_ar_sp1_ep1_pp3 [label="Expert All-Reduce L14 SP1 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep1_tp0_pp3 -> layer_14_expert_ar_sp1_ep1_pp3
	layer_14_expert_out_sp1_ep1_tp1_pp3 -> layer_14_expert_ar_sp1_ep1_pp3
	layer_14_expert_out_sp1_ep1_tp2_pp3 -> layer_14_expert_ar_sp1_ep1_pp3
	layer_14_expert_out_sp1_ep1_tp3_pp3 -> layer_14_expert_ar_sp1_ep1_pp3
	layer_14_combine_sp1_ep1_pp3 [label="Token Combine L14 SP1 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep1_pp3 -> layer_14_combine_sp1_ep1_pp3
	layer_14_dispatch_sp1_ep2_pp3 [label="Token Dispatch L14 SP1 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep2_pp3 [style=dashed]
	layer_14_expert_sp1_ep2_tp0_pp3 [label="Expert L14 SP1 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep2_pp3 -> layer_14_expert_sp1_ep2_tp0_pp3
	layer_14_expert_out_sp1_ep2_tp0_pp3 [label="Expert Out L14 SP1 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep2_tp0_pp3 -> layer_14_expert_out_sp1_ep2_tp0_pp3
	layer_14_expert_sp1_ep2_tp1_pp3 [label="Expert L14 SP1 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep2_pp3 -> layer_14_expert_sp1_ep2_tp1_pp3
	layer_14_expert_out_sp1_ep2_tp1_pp3 [label="Expert Out L14 SP1 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep2_tp1_pp3 -> layer_14_expert_out_sp1_ep2_tp1_pp3
	layer_14_expert_sp1_ep2_tp2_pp3 [label="Expert L14 SP1 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep2_pp3 -> layer_14_expert_sp1_ep2_tp2_pp3
	layer_14_expert_out_sp1_ep2_tp2_pp3 [label="Expert Out L14 SP1 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep2_tp2_pp3 -> layer_14_expert_out_sp1_ep2_tp2_pp3
	layer_14_expert_sp1_ep2_tp3_pp3 [label="Expert L14 SP1 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep2_pp3 -> layer_14_expert_sp1_ep2_tp3_pp3
	layer_14_expert_out_sp1_ep2_tp3_pp3 [label="Expert Out L14 SP1 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep2_tp3_pp3 -> layer_14_expert_out_sp1_ep2_tp3_pp3
	layer_14_expert_ar_sp1_ep2_pp3 [label="Expert All-Reduce L14 SP1 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep2_tp0_pp3 -> layer_14_expert_ar_sp1_ep2_pp3
	layer_14_expert_out_sp1_ep2_tp1_pp3 -> layer_14_expert_ar_sp1_ep2_pp3
	layer_14_expert_out_sp1_ep2_tp2_pp3 -> layer_14_expert_ar_sp1_ep2_pp3
	layer_14_expert_out_sp1_ep2_tp3_pp3 -> layer_14_expert_ar_sp1_ep2_pp3
	layer_14_combine_sp1_ep2_pp3 [label="Token Combine L14 SP1 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep2_pp3 -> layer_14_combine_sp1_ep2_pp3
	layer_14_dispatch_sp1_ep3_pp3 [label="Token Dispatch L14 SP1 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep3_pp3 [style=dashed]
	layer_14_expert_sp1_ep3_tp0_pp3 [label="Expert L14 SP1 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep3_pp3 -> layer_14_expert_sp1_ep3_tp0_pp3
	layer_14_expert_out_sp1_ep3_tp0_pp3 [label="Expert Out L14 SP1 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep3_tp0_pp3 -> layer_14_expert_out_sp1_ep3_tp0_pp3
	layer_14_expert_sp1_ep3_tp1_pp3 [label="Expert L14 SP1 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep3_pp3 -> layer_14_expert_sp1_ep3_tp1_pp3
	layer_14_expert_out_sp1_ep3_tp1_pp3 [label="Expert Out L14 SP1 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep3_tp1_pp3 -> layer_14_expert_out_sp1_ep3_tp1_pp3
	layer_14_expert_sp1_ep3_tp2_pp3 [label="Expert L14 SP1 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep3_pp3 -> layer_14_expert_sp1_ep3_tp2_pp3
	layer_14_expert_out_sp1_ep3_tp2_pp3 [label="Expert Out L14 SP1 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep3_tp2_pp3 -> layer_14_expert_out_sp1_ep3_tp2_pp3
	layer_14_expert_sp1_ep3_tp3_pp3 [label="Expert L14 SP1 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep3_pp3 -> layer_14_expert_sp1_ep3_tp3_pp3
	layer_14_expert_out_sp1_ep3_tp3_pp3 [label="Expert Out L14 SP1 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep3_tp3_pp3 -> layer_14_expert_out_sp1_ep3_tp3_pp3
	layer_14_expert_ar_sp1_ep3_pp3 [label="Expert All-Reduce L14 SP1 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep3_tp0_pp3 -> layer_14_expert_ar_sp1_ep3_pp3
	layer_14_expert_out_sp1_ep3_tp1_pp3 -> layer_14_expert_ar_sp1_ep3_pp3
	layer_14_expert_out_sp1_ep3_tp2_pp3 -> layer_14_expert_ar_sp1_ep3_pp3
	layer_14_expert_out_sp1_ep3_tp3_pp3 -> layer_14_expert_ar_sp1_ep3_pp3
	layer_14_combine_sp1_ep3_pp3 [label="Token Combine L14 SP1 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep3_pp3 -> layer_14_combine_sp1_ep3_pp3
	layer_14_dispatch_sp1_ep4_pp3 [label="Token Dispatch L14 SP1 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep4_pp3 [style=dashed]
	layer_14_expert_sp1_ep4_tp0_pp3 [label="Expert L14 SP1 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep4_pp3 -> layer_14_expert_sp1_ep4_tp0_pp3
	layer_14_expert_out_sp1_ep4_tp0_pp3 [label="Expert Out L14 SP1 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep4_tp0_pp3 -> layer_14_expert_out_sp1_ep4_tp0_pp3
	layer_14_expert_sp1_ep4_tp1_pp3 [label="Expert L14 SP1 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep4_pp3 -> layer_14_expert_sp1_ep4_tp1_pp3
	layer_14_expert_out_sp1_ep4_tp1_pp3 [label="Expert Out L14 SP1 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep4_tp1_pp3 -> layer_14_expert_out_sp1_ep4_tp1_pp3
	layer_14_expert_sp1_ep4_tp2_pp3 [label="Expert L14 SP1 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep4_pp3 -> layer_14_expert_sp1_ep4_tp2_pp3
	layer_14_expert_out_sp1_ep4_tp2_pp3 [label="Expert Out L14 SP1 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep4_tp2_pp3 -> layer_14_expert_out_sp1_ep4_tp2_pp3
	layer_14_expert_sp1_ep4_tp3_pp3 [label="Expert L14 SP1 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep4_pp3 -> layer_14_expert_sp1_ep4_tp3_pp3
	layer_14_expert_out_sp1_ep4_tp3_pp3 [label="Expert Out L14 SP1 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep4_tp3_pp3 -> layer_14_expert_out_sp1_ep4_tp3_pp3
	layer_14_expert_ar_sp1_ep4_pp3 [label="Expert All-Reduce L14 SP1 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep4_tp0_pp3 -> layer_14_expert_ar_sp1_ep4_pp3
	layer_14_expert_out_sp1_ep4_tp1_pp3 -> layer_14_expert_ar_sp1_ep4_pp3
	layer_14_expert_out_sp1_ep4_tp2_pp3 -> layer_14_expert_ar_sp1_ep4_pp3
	layer_14_expert_out_sp1_ep4_tp3_pp3 -> layer_14_expert_ar_sp1_ep4_pp3
	layer_14_combine_sp1_ep4_pp3 [label="Token Combine L14 SP1 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep4_pp3 -> layer_14_combine_sp1_ep4_pp3
	layer_14_dispatch_sp1_ep5_pp3 [label="Token Dispatch L14 SP1 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep5_pp3 [style=dashed]
	layer_14_expert_sp1_ep5_tp0_pp3 [label="Expert L14 SP1 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep5_pp3 -> layer_14_expert_sp1_ep5_tp0_pp3
	layer_14_expert_out_sp1_ep5_tp0_pp3 [label="Expert Out L14 SP1 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep5_tp0_pp3 -> layer_14_expert_out_sp1_ep5_tp0_pp3
	layer_14_expert_sp1_ep5_tp1_pp3 [label="Expert L14 SP1 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep5_pp3 -> layer_14_expert_sp1_ep5_tp1_pp3
	layer_14_expert_out_sp1_ep5_tp1_pp3 [label="Expert Out L14 SP1 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep5_tp1_pp3 -> layer_14_expert_out_sp1_ep5_tp1_pp3
	layer_14_expert_sp1_ep5_tp2_pp3 [label="Expert L14 SP1 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep5_pp3 -> layer_14_expert_sp1_ep5_tp2_pp3
	layer_14_expert_out_sp1_ep5_tp2_pp3 [label="Expert Out L14 SP1 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep5_tp2_pp3 -> layer_14_expert_out_sp1_ep5_tp2_pp3
	layer_14_expert_sp1_ep5_tp3_pp3 [label="Expert L14 SP1 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep5_pp3 -> layer_14_expert_sp1_ep5_tp3_pp3
	layer_14_expert_out_sp1_ep5_tp3_pp3 [label="Expert Out L14 SP1 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep5_tp3_pp3 -> layer_14_expert_out_sp1_ep5_tp3_pp3
	layer_14_expert_ar_sp1_ep5_pp3 [label="Expert All-Reduce L14 SP1 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep5_tp0_pp3 -> layer_14_expert_ar_sp1_ep5_pp3
	layer_14_expert_out_sp1_ep5_tp1_pp3 -> layer_14_expert_ar_sp1_ep5_pp3
	layer_14_expert_out_sp1_ep5_tp2_pp3 -> layer_14_expert_ar_sp1_ep5_pp3
	layer_14_expert_out_sp1_ep5_tp3_pp3 -> layer_14_expert_ar_sp1_ep5_pp3
	layer_14_combine_sp1_ep5_pp3 [label="Token Combine L14 SP1 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep5_pp3 -> layer_14_combine_sp1_ep5_pp3
	layer_14_dispatch_sp1_ep6_pp3 [label="Token Dispatch L14 SP1 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep6_pp3 [style=dashed]
	layer_14_expert_sp1_ep6_tp0_pp3 [label="Expert L14 SP1 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep6_pp3 -> layer_14_expert_sp1_ep6_tp0_pp3
	layer_14_expert_out_sp1_ep6_tp0_pp3 [label="Expert Out L14 SP1 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep6_tp0_pp3 -> layer_14_expert_out_sp1_ep6_tp0_pp3
	layer_14_expert_sp1_ep6_tp1_pp3 [label="Expert L14 SP1 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep6_pp3 -> layer_14_expert_sp1_ep6_tp1_pp3
	layer_14_expert_out_sp1_ep6_tp1_pp3 [label="Expert Out L14 SP1 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep6_tp1_pp3 -> layer_14_expert_out_sp1_ep6_tp1_pp3
	layer_14_expert_sp1_ep6_tp2_pp3 [label="Expert L14 SP1 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep6_pp3 -> layer_14_expert_sp1_ep6_tp2_pp3
	layer_14_expert_out_sp1_ep6_tp2_pp3 [label="Expert Out L14 SP1 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep6_tp2_pp3 -> layer_14_expert_out_sp1_ep6_tp2_pp3
	layer_14_expert_sp1_ep6_tp3_pp3 [label="Expert L14 SP1 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep6_pp3 -> layer_14_expert_sp1_ep6_tp3_pp3
	layer_14_expert_out_sp1_ep6_tp3_pp3 [label="Expert Out L14 SP1 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep6_tp3_pp3 -> layer_14_expert_out_sp1_ep6_tp3_pp3
	layer_14_expert_ar_sp1_ep6_pp3 [label="Expert All-Reduce L14 SP1 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep6_tp0_pp3 -> layer_14_expert_ar_sp1_ep6_pp3
	layer_14_expert_out_sp1_ep6_tp1_pp3 -> layer_14_expert_ar_sp1_ep6_pp3
	layer_14_expert_out_sp1_ep6_tp2_pp3 -> layer_14_expert_ar_sp1_ep6_pp3
	layer_14_expert_out_sp1_ep6_tp3_pp3 -> layer_14_expert_ar_sp1_ep6_pp3
	layer_14_combine_sp1_ep6_pp3 [label="Token Combine L14 SP1 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep6_pp3 -> layer_14_combine_sp1_ep6_pp3
	layer_14_dispatch_sp1_ep7_pp3 [label="Token Dispatch L14 SP1 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep7_pp3 [style=dashed]
	layer_14_expert_sp1_ep7_tp0_pp3 [label="Expert L14 SP1 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep7_pp3 -> layer_14_expert_sp1_ep7_tp0_pp3
	layer_14_expert_out_sp1_ep7_tp0_pp3 [label="Expert Out L14 SP1 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep7_tp0_pp3 -> layer_14_expert_out_sp1_ep7_tp0_pp3
	layer_14_expert_sp1_ep7_tp1_pp3 [label="Expert L14 SP1 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep7_pp3 -> layer_14_expert_sp1_ep7_tp1_pp3
	layer_14_expert_out_sp1_ep7_tp1_pp3 [label="Expert Out L14 SP1 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep7_tp1_pp3 -> layer_14_expert_out_sp1_ep7_tp1_pp3
	layer_14_expert_sp1_ep7_tp2_pp3 [label="Expert L14 SP1 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep7_pp3 -> layer_14_expert_sp1_ep7_tp2_pp3
	layer_14_expert_out_sp1_ep7_tp2_pp3 [label="Expert Out L14 SP1 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep7_tp2_pp3 -> layer_14_expert_out_sp1_ep7_tp2_pp3
	layer_14_expert_sp1_ep7_tp3_pp3 [label="Expert L14 SP1 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep7_pp3 -> layer_14_expert_sp1_ep7_tp3_pp3
	layer_14_expert_out_sp1_ep7_tp3_pp3 [label="Expert Out L14 SP1 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep7_tp3_pp3 -> layer_14_expert_out_sp1_ep7_tp3_pp3
	layer_14_expert_ar_sp1_ep7_pp3 [label="Expert All-Reduce L14 SP1 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep7_tp0_pp3 -> layer_14_expert_ar_sp1_ep7_pp3
	layer_14_expert_out_sp1_ep7_tp1_pp3 -> layer_14_expert_ar_sp1_ep7_pp3
	layer_14_expert_out_sp1_ep7_tp2_pp3 -> layer_14_expert_ar_sp1_ep7_pp3
	layer_14_expert_out_sp1_ep7_tp3_pp3 -> layer_14_expert_ar_sp1_ep7_pp3
	layer_14_combine_sp1_ep7_pp3 [label="Token Combine L14 SP1 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep7_pp3 -> layer_14_combine_sp1_ep7_pp3
	layer_14_dispatch_sp1_ep8_pp3 [label="Token Dispatch L14 SP1 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep8_pp3 [style=dashed]
	layer_14_expert_sp1_ep8_tp0_pp3 [label="Expert L14 SP1 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep8_pp3 -> layer_14_expert_sp1_ep8_tp0_pp3
	layer_14_expert_out_sp1_ep8_tp0_pp3 [label="Expert Out L14 SP1 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep8_tp0_pp3 -> layer_14_expert_out_sp1_ep8_tp0_pp3
	layer_14_expert_sp1_ep8_tp1_pp3 [label="Expert L14 SP1 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep8_pp3 -> layer_14_expert_sp1_ep8_tp1_pp3
	layer_14_expert_out_sp1_ep8_tp1_pp3 [label="Expert Out L14 SP1 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep8_tp1_pp3 -> layer_14_expert_out_sp1_ep8_tp1_pp3
	layer_14_expert_sp1_ep8_tp2_pp3 [label="Expert L14 SP1 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep8_pp3 -> layer_14_expert_sp1_ep8_tp2_pp3
	layer_14_expert_out_sp1_ep8_tp2_pp3 [label="Expert Out L14 SP1 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep8_tp2_pp3 -> layer_14_expert_out_sp1_ep8_tp2_pp3
	layer_14_expert_sp1_ep8_tp3_pp3 [label="Expert L14 SP1 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep8_pp3 -> layer_14_expert_sp1_ep8_tp3_pp3
	layer_14_expert_out_sp1_ep8_tp3_pp3 [label="Expert Out L14 SP1 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep8_tp3_pp3 -> layer_14_expert_out_sp1_ep8_tp3_pp3
	layer_14_expert_ar_sp1_ep8_pp3 [label="Expert All-Reduce L14 SP1 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep8_tp0_pp3 -> layer_14_expert_ar_sp1_ep8_pp3
	layer_14_expert_out_sp1_ep8_tp1_pp3 -> layer_14_expert_ar_sp1_ep8_pp3
	layer_14_expert_out_sp1_ep8_tp2_pp3 -> layer_14_expert_ar_sp1_ep8_pp3
	layer_14_expert_out_sp1_ep8_tp3_pp3 -> layer_14_expert_ar_sp1_ep8_pp3
	layer_14_combine_sp1_ep8_pp3 [label="Token Combine L14 SP1 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep8_pp3 -> layer_14_combine_sp1_ep8_pp3
	layer_14_dispatch_sp1_ep9_pp3 [label="Token Dispatch L14 SP1 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep9_pp3 [style=dashed]
	layer_14_expert_sp1_ep9_tp0_pp3 [label="Expert L14 SP1 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep9_pp3 -> layer_14_expert_sp1_ep9_tp0_pp3
	layer_14_expert_out_sp1_ep9_tp0_pp3 [label="Expert Out L14 SP1 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep9_tp0_pp3 -> layer_14_expert_out_sp1_ep9_tp0_pp3
	layer_14_expert_sp1_ep9_tp1_pp3 [label="Expert L14 SP1 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep9_pp3 -> layer_14_expert_sp1_ep9_tp1_pp3
	layer_14_expert_out_sp1_ep9_tp1_pp3 [label="Expert Out L14 SP1 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep9_tp1_pp3 -> layer_14_expert_out_sp1_ep9_tp1_pp3
	layer_14_expert_sp1_ep9_tp2_pp3 [label="Expert L14 SP1 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep9_pp3 -> layer_14_expert_sp1_ep9_tp2_pp3
	layer_14_expert_out_sp1_ep9_tp2_pp3 [label="Expert Out L14 SP1 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep9_tp2_pp3 -> layer_14_expert_out_sp1_ep9_tp2_pp3
	layer_14_expert_sp1_ep9_tp3_pp3 [label="Expert L14 SP1 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep9_pp3 -> layer_14_expert_sp1_ep9_tp3_pp3
	layer_14_expert_out_sp1_ep9_tp3_pp3 [label="Expert Out L14 SP1 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep9_tp3_pp3 -> layer_14_expert_out_sp1_ep9_tp3_pp3
	layer_14_expert_ar_sp1_ep9_pp3 [label="Expert All-Reduce L14 SP1 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep9_tp0_pp3 -> layer_14_expert_ar_sp1_ep9_pp3
	layer_14_expert_out_sp1_ep9_tp1_pp3 -> layer_14_expert_ar_sp1_ep9_pp3
	layer_14_expert_out_sp1_ep9_tp2_pp3 -> layer_14_expert_ar_sp1_ep9_pp3
	layer_14_expert_out_sp1_ep9_tp3_pp3 -> layer_14_expert_ar_sp1_ep9_pp3
	layer_14_combine_sp1_ep9_pp3 [label="Token Combine L14 SP1 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep9_pp3 -> layer_14_combine_sp1_ep9_pp3
	layer_14_dispatch_sp1_ep10_pp3 [label="Token Dispatch L14 SP1 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep10_pp3 [style=dashed]
	layer_14_expert_sp1_ep10_tp0_pp3 [label="Expert L14 SP1 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep10_pp3 -> layer_14_expert_sp1_ep10_tp0_pp3
	layer_14_expert_out_sp1_ep10_tp0_pp3 [label="Expert Out L14 SP1 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep10_tp0_pp3 -> layer_14_expert_out_sp1_ep10_tp0_pp3
	layer_14_expert_sp1_ep10_tp1_pp3 [label="Expert L14 SP1 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep10_pp3 -> layer_14_expert_sp1_ep10_tp1_pp3
	layer_14_expert_out_sp1_ep10_tp1_pp3 [label="Expert Out L14 SP1 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep10_tp1_pp3 -> layer_14_expert_out_sp1_ep10_tp1_pp3
	layer_14_expert_sp1_ep10_tp2_pp3 [label="Expert L14 SP1 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep10_pp3 -> layer_14_expert_sp1_ep10_tp2_pp3
	layer_14_expert_out_sp1_ep10_tp2_pp3 [label="Expert Out L14 SP1 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep10_tp2_pp3 -> layer_14_expert_out_sp1_ep10_tp2_pp3
	layer_14_expert_sp1_ep10_tp3_pp3 [label="Expert L14 SP1 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep10_pp3 -> layer_14_expert_sp1_ep10_tp3_pp3
	layer_14_expert_out_sp1_ep10_tp3_pp3 [label="Expert Out L14 SP1 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep10_tp3_pp3 -> layer_14_expert_out_sp1_ep10_tp3_pp3
	layer_14_expert_ar_sp1_ep10_pp3 [label="Expert All-Reduce L14 SP1 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep10_tp0_pp3 -> layer_14_expert_ar_sp1_ep10_pp3
	layer_14_expert_out_sp1_ep10_tp1_pp3 -> layer_14_expert_ar_sp1_ep10_pp3
	layer_14_expert_out_sp1_ep10_tp2_pp3 -> layer_14_expert_ar_sp1_ep10_pp3
	layer_14_expert_out_sp1_ep10_tp3_pp3 -> layer_14_expert_ar_sp1_ep10_pp3
	layer_14_combine_sp1_ep10_pp3 [label="Token Combine L14 SP1 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep10_pp3 -> layer_14_combine_sp1_ep10_pp3
	layer_14_dispatch_sp1_ep11_pp3 [label="Token Dispatch L14 SP1 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep11_pp3 [style=dashed]
	layer_14_expert_sp1_ep11_tp0_pp3 [label="Expert L14 SP1 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep11_pp3 -> layer_14_expert_sp1_ep11_tp0_pp3
	layer_14_expert_out_sp1_ep11_tp0_pp3 [label="Expert Out L14 SP1 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep11_tp0_pp3 -> layer_14_expert_out_sp1_ep11_tp0_pp3
	layer_14_expert_sp1_ep11_tp1_pp3 [label="Expert L14 SP1 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep11_pp3 -> layer_14_expert_sp1_ep11_tp1_pp3
	layer_14_expert_out_sp1_ep11_tp1_pp3 [label="Expert Out L14 SP1 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep11_tp1_pp3 -> layer_14_expert_out_sp1_ep11_tp1_pp3
	layer_14_expert_sp1_ep11_tp2_pp3 [label="Expert L14 SP1 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep11_pp3 -> layer_14_expert_sp1_ep11_tp2_pp3
	layer_14_expert_out_sp1_ep11_tp2_pp3 [label="Expert Out L14 SP1 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep11_tp2_pp3 -> layer_14_expert_out_sp1_ep11_tp2_pp3
	layer_14_expert_sp1_ep11_tp3_pp3 [label="Expert L14 SP1 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep11_pp3 -> layer_14_expert_sp1_ep11_tp3_pp3
	layer_14_expert_out_sp1_ep11_tp3_pp3 [label="Expert Out L14 SP1 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep11_tp3_pp3 -> layer_14_expert_out_sp1_ep11_tp3_pp3
	layer_14_expert_ar_sp1_ep11_pp3 [label="Expert All-Reduce L14 SP1 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep11_tp0_pp3 -> layer_14_expert_ar_sp1_ep11_pp3
	layer_14_expert_out_sp1_ep11_tp1_pp3 -> layer_14_expert_ar_sp1_ep11_pp3
	layer_14_expert_out_sp1_ep11_tp2_pp3 -> layer_14_expert_ar_sp1_ep11_pp3
	layer_14_expert_out_sp1_ep11_tp3_pp3 -> layer_14_expert_ar_sp1_ep11_pp3
	layer_14_combine_sp1_ep11_pp3 [label="Token Combine L14 SP1 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep11_pp3 -> layer_14_combine_sp1_ep11_pp3
	layer_14_dispatch_sp1_ep12_pp3 [label="Token Dispatch L14 SP1 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep12_pp3 [style=dashed]
	layer_14_expert_sp1_ep12_tp0_pp3 [label="Expert L14 SP1 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep12_pp3 -> layer_14_expert_sp1_ep12_tp0_pp3
	layer_14_expert_out_sp1_ep12_tp0_pp3 [label="Expert Out L14 SP1 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep12_tp0_pp3 -> layer_14_expert_out_sp1_ep12_tp0_pp3
	layer_14_expert_sp1_ep12_tp1_pp3 [label="Expert L14 SP1 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep12_pp3 -> layer_14_expert_sp1_ep12_tp1_pp3
	layer_14_expert_out_sp1_ep12_tp1_pp3 [label="Expert Out L14 SP1 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep12_tp1_pp3 -> layer_14_expert_out_sp1_ep12_tp1_pp3
	layer_14_expert_sp1_ep12_tp2_pp3 [label="Expert L14 SP1 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep12_pp3 -> layer_14_expert_sp1_ep12_tp2_pp3
	layer_14_expert_out_sp1_ep12_tp2_pp3 [label="Expert Out L14 SP1 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep12_tp2_pp3 -> layer_14_expert_out_sp1_ep12_tp2_pp3
	layer_14_expert_sp1_ep12_tp3_pp3 [label="Expert L14 SP1 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep12_pp3 -> layer_14_expert_sp1_ep12_tp3_pp3
	layer_14_expert_out_sp1_ep12_tp3_pp3 [label="Expert Out L14 SP1 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep12_tp3_pp3 -> layer_14_expert_out_sp1_ep12_tp3_pp3
	layer_14_expert_ar_sp1_ep12_pp3 [label="Expert All-Reduce L14 SP1 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep12_tp0_pp3 -> layer_14_expert_ar_sp1_ep12_pp3
	layer_14_expert_out_sp1_ep12_tp1_pp3 -> layer_14_expert_ar_sp1_ep12_pp3
	layer_14_expert_out_sp1_ep12_tp2_pp3 -> layer_14_expert_ar_sp1_ep12_pp3
	layer_14_expert_out_sp1_ep12_tp3_pp3 -> layer_14_expert_ar_sp1_ep12_pp3
	layer_14_combine_sp1_ep12_pp3 [label="Token Combine L14 SP1 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep12_pp3 -> layer_14_combine_sp1_ep12_pp3
	layer_14_dispatch_sp1_ep13_pp3 [label="Token Dispatch L14 SP1 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep13_pp3 [style=dashed]
	layer_14_expert_sp1_ep13_tp0_pp3 [label="Expert L14 SP1 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep13_pp3 -> layer_14_expert_sp1_ep13_tp0_pp3
	layer_14_expert_out_sp1_ep13_tp0_pp3 [label="Expert Out L14 SP1 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep13_tp0_pp3 -> layer_14_expert_out_sp1_ep13_tp0_pp3
	layer_14_expert_sp1_ep13_tp1_pp3 [label="Expert L14 SP1 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep13_pp3 -> layer_14_expert_sp1_ep13_tp1_pp3
	layer_14_expert_out_sp1_ep13_tp1_pp3 [label="Expert Out L14 SP1 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep13_tp1_pp3 -> layer_14_expert_out_sp1_ep13_tp1_pp3
	layer_14_expert_sp1_ep13_tp2_pp3 [label="Expert L14 SP1 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep13_pp3 -> layer_14_expert_sp1_ep13_tp2_pp3
	layer_14_expert_out_sp1_ep13_tp2_pp3 [label="Expert Out L14 SP1 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep13_tp2_pp3 -> layer_14_expert_out_sp1_ep13_tp2_pp3
	layer_14_expert_sp1_ep13_tp3_pp3 [label="Expert L14 SP1 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep13_pp3 -> layer_14_expert_sp1_ep13_tp3_pp3
	layer_14_expert_out_sp1_ep13_tp3_pp3 [label="Expert Out L14 SP1 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep13_tp3_pp3 -> layer_14_expert_out_sp1_ep13_tp3_pp3
	layer_14_expert_ar_sp1_ep13_pp3 [label="Expert All-Reduce L14 SP1 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep13_tp0_pp3 -> layer_14_expert_ar_sp1_ep13_pp3
	layer_14_expert_out_sp1_ep13_tp1_pp3 -> layer_14_expert_ar_sp1_ep13_pp3
	layer_14_expert_out_sp1_ep13_tp2_pp3 -> layer_14_expert_ar_sp1_ep13_pp3
	layer_14_expert_out_sp1_ep13_tp3_pp3 -> layer_14_expert_ar_sp1_ep13_pp3
	layer_14_combine_sp1_ep13_pp3 [label="Token Combine L14 SP1 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep13_pp3 -> layer_14_combine_sp1_ep13_pp3
	layer_14_dispatch_sp1_ep14_pp3 [label="Token Dispatch L14 SP1 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep14_pp3 [style=dashed]
	layer_14_expert_sp1_ep14_tp0_pp3 [label="Expert L14 SP1 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep14_pp3 -> layer_14_expert_sp1_ep14_tp0_pp3
	layer_14_expert_out_sp1_ep14_tp0_pp3 [label="Expert Out L14 SP1 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep14_tp0_pp3 -> layer_14_expert_out_sp1_ep14_tp0_pp3
	layer_14_expert_sp1_ep14_tp1_pp3 [label="Expert L14 SP1 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep14_pp3 -> layer_14_expert_sp1_ep14_tp1_pp3
	layer_14_expert_out_sp1_ep14_tp1_pp3 [label="Expert Out L14 SP1 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep14_tp1_pp3 -> layer_14_expert_out_sp1_ep14_tp1_pp3
	layer_14_expert_sp1_ep14_tp2_pp3 [label="Expert L14 SP1 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep14_pp3 -> layer_14_expert_sp1_ep14_tp2_pp3
	layer_14_expert_out_sp1_ep14_tp2_pp3 [label="Expert Out L14 SP1 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep14_tp2_pp3 -> layer_14_expert_out_sp1_ep14_tp2_pp3
	layer_14_expert_sp1_ep14_tp3_pp3 [label="Expert L14 SP1 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep14_pp3 -> layer_14_expert_sp1_ep14_tp3_pp3
	layer_14_expert_out_sp1_ep14_tp3_pp3 [label="Expert Out L14 SP1 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep14_tp3_pp3 -> layer_14_expert_out_sp1_ep14_tp3_pp3
	layer_14_expert_ar_sp1_ep14_pp3 [label="Expert All-Reduce L14 SP1 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep14_tp0_pp3 -> layer_14_expert_ar_sp1_ep14_pp3
	layer_14_expert_out_sp1_ep14_tp1_pp3 -> layer_14_expert_ar_sp1_ep14_pp3
	layer_14_expert_out_sp1_ep14_tp2_pp3 -> layer_14_expert_ar_sp1_ep14_pp3
	layer_14_expert_out_sp1_ep14_tp3_pp3 -> layer_14_expert_ar_sp1_ep14_pp3
	layer_14_combine_sp1_ep14_pp3 [label="Token Combine L14 SP1 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep14_pp3 -> layer_14_combine_sp1_ep14_pp3
	layer_14_dispatch_sp1_ep15_pp3 [label="Token Dispatch L14 SP1 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp1_pp3 -> layer_14_dispatch_sp1_ep15_pp3 [style=dashed]
	layer_14_expert_sp1_ep15_tp0_pp3 [label="Expert L14 SP1 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep15_pp3 -> layer_14_expert_sp1_ep15_tp0_pp3
	layer_14_expert_out_sp1_ep15_tp0_pp3 [label="Expert Out L14 SP1 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep15_tp0_pp3 -> layer_14_expert_out_sp1_ep15_tp0_pp3
	layer_14_expert_sp1_ep15_tp1_pp3 [label="Expert L14 SP1 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep15_pp3 -> layer_14_expert_sp1_ep15_tp1_pp3
	layer_14_expert_out_sp1_ep15_tp1_pp3 [label="Expert Out L14 SP1 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep15_tp1_pp3 -> layer_14_expert_out_sp1_ep15_tp1_pp3
	layer_14_expert_sp1_ep15_tp2_pp3 [label="Expert L14 SP1 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep15_pp3 -> layer_14_expert_sp1_ep15_tp2_pp3
	layer_14_expert_out_sp1_ep15_tp2_pp3 [label="Expert Out L14 SP1 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep15_tp2_pp3 -> layer_14_expert_out_sp1_ep15_tp2_pp3
	layer_14_expert_sp1_ep15_tp3_pp3 [label="Expert L14 SP1 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp1_ep15_pp3 -> layer_14_expert_sp1_ep15_tp3_pp3
	layer_14_expert_out_sp1_ep15_tp3_pp3 [label="Expert Out L14 SP1 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp1_ep15_tp3_pp3 -> layer_14_expert_out_sp1_ep15_tp3_pp3
	layer_14_expert_ar_sp1_ep15_pp3 [label="Expert All-Reduce L14 SP1 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp1_ep15_tp0_pp3 -> layer_14_expert_ar_sp1_ep15_pp3
	layer_14_expert_out_sp1_ep15_tp1_pp3 -> layer_14_expert_ar_sp1_ep15_pp3
	layer_14_expert_out_sp1_ep15_tp2_pp3 -> layer_14_expert_ar_sp1_ep15_pp3
	layer_14_expert_out_sp1_ep15_tp3_pp3 -> layer_14_expert_ar_sp1_ep15_pp3
	layer_14_combine_sp1_ep15_pp3 [label="Token Combine L14 SP1 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp1_ep15_pp3 -> layer_14_combine_sp1_ep15_pp3
	layer_14_moe_all2all_sp1_pp3 [label="MoE All-to-All L14 SP1\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_14_combine_sp1_ep0_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep1_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep2_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep3_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep4_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep5_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep6_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep7_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep8_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep9_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep10_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep11_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep12_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep13_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep14_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_combine_sp1_ep15_pp3 -> layer_14_moe_all2all_sp1_pp3
	layer_14_mlp_out_sp1_pp3 [label="MoE Output L14 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_moe_all2all_sp1_pp3 -> layer_14_mlp_out_sp1_pp3
	layer_14_mlp_res_sp1_pp3 [label="MLP Residual L14 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_mlp_out_sp1_pp3 -> layer_14_mlp_res_sp1_pp3
	layer_14_attn_res_sp1_pp3 -> layer_14_mlp_res_sp1_pp3 [style=dashed]
	layer_14_norm_sp2_pp3 [label="LayerNorm L14 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_mlp_out_sp2_pp3 -> layer_14_norm_sp2_pp3
	layer_14_qkv_sp2_tp0_pp3 [label="QKV Proj L14 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp2_pp3 -> layer_14_qkv_sp2_tp0_pp3
	layer_14_attn_sp2_tp0_pp3 [label="Attention L14 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp2_tp0_pp3 -> layer_14_attn_sp2_tp0_pp3
	layer_14_attn_out_sp2_tp0_pp3 [label="Attn Out Proj L14 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp2_tp0_pp3 -> layer_14_attn_out_sp2_tp0_pp3
	layer_14_qkv_sp2_tp1_pp3 [label="QKV Proj L14 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp2_pp3 -> layer_14_qkv_sp2_tp1_pp3
	layer_14_attn_sp2_tp1_pp3 [label="Attention L14 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp2_tp1_pp3 -> layer_14_attn_sp2_tp1_pp3
	layer_14_attn_out_sp2_tp1_pp3 [label="Attn Out Proj L14 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp2_tp1_pp3 -> layer_14_attn_out_sp2_tp1_pp3
	layer_14_qkv_sp2_tp2_pp3 [label="QKV Proj L14 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp2_pp3 -> layer_14_qkv_sp2_tp2_pp3
	layer_14_attn_sp2_tp2_pp3 [label="Attention L14 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp2_tp2_pp3 -> layer_14_attn_sp2_tp2_pp3
	layer_14_attn_out_sp2_tp2_pp3 [label="Attn Out Proj L14 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp2_tp2_pp3 -> layer_14_attn_out_sp2_tp2_pp3
	layer_14_qkv_sp2_tp3_pp3 [label="QKV Proj L14 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp2_pp3 -> layer_14_qkv_sp2_tp3_pp3
	layer_14_attn_sp2_tp3_pp3 [label="Attention L14 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp2_tp3_pp3 -> layer_14_attn_sp2_tp3_pp3
	layer_14_attn_out_sp2_tp3_pp3 [label="Attn Out Proj L14 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp2_tp3_pp3 -> layer_14_attn_out_sp2_tp3_pp3
	layer_14_attn_ar_sp2_pp3 [label="Attention All-Reduce L14 SP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_attn_out_sp2_tp0_pp3 -> layer_14_attn_ar_sp2_pp3
	layer_14_attn_out_sp2_tp1_pp3 -> layer_14_attn_ar_sp2_pp3
	layer_14_attn_out_sp2_tp2_pp3 -> layer_14_attn_ar_sp2_pp3
	layer_14_attn_out_sp2_tp3_pp3 -> layer_14_attn_ar_sp2_pp3
	layer_14_attn_res_sp2_pp3 [label="Attention Residual L14 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_attn_ar_sp2_pp3 -> layer_14_attn_res_sp2_pp3
	layer_14_norm_sp2_pp3 -> layer_14_attn_res_sp2_pp3 [style=dashed]
	layer_14_post_norm_sp2_pp3 [label="Post-Attn Norm L14 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_attn_res_sp2_pp3 -> layer_14_post_norm_sp2_pp3
	layer_14_router_sp2_pp3 [label="MoE Router L14 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_14_post_norm_sp2_pp3 -> layer_14_router_sp2_pp3
	layer_14_dispatch_sp2_ep0_pp3 [label="Token Dispatch L14 SP2 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep0_pp3 [style=dashed]
	layer_14_expert_sp2_ep0_tp0_pp3 [label="Expert L14 SP2 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep0_pp3 -> layer_14_expert_sp2_ep0_tp0_pp3
	layer_14_expert_out_sp2_ep0_tp0_pp3 [label="Expert Out L14 SP2 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep0_tp0_pp3 -> layer_14_expert_out_sp2_ep0_tp0_pp3
	layer_14_expert_sp2_ep0_tp1_pp3 [label="Expert L14 SP2 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep0_pp3 -> layer_14_expert_sp2_ep0_tp1_pp3
	layer_14_expert_out_sp2_ep0_tp1_pp3 [label="Expert Out L14 SP2 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep0_tp1_pp3 -> layer_14_expert_out_sp2_ep0_tp1_pp3
	layer_14_expert_sp2_ep0_tp2_pp3 [label="Expert L14 SP2 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep0_pp3 -> layer_14_expert_sp2_ep0_tp2_pp3
	layer_14_expert_out_sp2_ep0_tp2_pp3 [label="Expert Out L14 SP2 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep0_tp2_pp3 -> layer_14_expert_out_sp2_ep0_tp2_pp3
	layer_14_expert_sp2_ep0_tp3_pp3 [label="Expert L14 SP2 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep0_pp3 -> layer_14_expert_sp2_ep0_tp3_pp3
	layer_14_expert_out_sp2_ep0_tp3_pp3 [label="Expert Out L14 SP2 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep0_tp3_pp3 -> layer_14_expert_out_sp2_ep0_tp3_pp3
	layer_14_expert_ar_sp2_ep0_pp3 [label="Expert All-Reduce L14 SP2 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep0_tp0_pp3 -> layer_14_expert_ar_sp2_ep0_pp3
	layer_14_expert_out_sp2_ep0_tp1_pp3 -> layer_14_expert_ar_sp2_ep0_pp3
	layer_14_expert_out_sp2_ep0_tp2_pp3 -> layer_14_expert_ar_sp2_ep0_pp3
	layer_14_expert_out_sp2_ep0_tp3_pp3 -> layer_14_expert_ar_sp2_ep0_pp3
	layer_14_combine_sp2_ep0_pp3 [label="Token Combine L14 SP2 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep0_pp3 -> layer_14_combine_sp2_ep0_pp3
	layer_14_dispatch_sp2_ep1_pp3 [label="Token Dispatch L14 SP2 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep1_pp3 [style=dashed]
	layer_14_expert_sp2_ep1_tp0_pp3 [label="Expert L14 SP2 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep1_pp3 -> layer_14_expert_sp2_ep1_tp0_pp3
	layer_14_expert_out_sp2_ep1_tp0_pp3 [label="Expert Out L14 SP2 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep1_tp0_pp3 -> layer_14_expert_out_sp2_ep1_tp0_pp3
	layer_14_expert_sp2_ep1_tp1_pp3 [label="Expert L14 SP2 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep1_pp3 -> layer_14_expert_sp2_ep1_tp1_pp3
	layer_14_expert_out_sp2_ep1_tp1_pp3 [label="Expert Out L14 SP2 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep1_tp1_pp3 -> layer_14_expert_out_sp2_ep1_tp1_pp3
	layer_14_expert_sp2_ep1_tp2_pp3 [label="Expert L14 SP2 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep1_pp3 -> layer_14_expert_sp2_ep1_tp2_pp3
	layer_14_expert_out_sp2_ep1_tp2_pp3 [label="Expert Out L14 SP2 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep1_tp2_pp3 -> layer_14_expert_out_sp2_ep1_tp2_pp3
	layer_14_expert_sp2_ep1_tp3_pp3 [label="Expert L14 SP2 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep1_pp3 -> layer_14_expert_sp2_ep1_tp3_pp3
	layer_14_expert_out_sp2_ep1_tp3_pp3 [label="Expert Out L14 SP2 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep1_tp3_pp3 -> layer_14_expert_out_sp2_ep1_tp3_pp3
	layer_14_expert_ar_sp2_ep1_pp3 [label="Expert All-Reduce L14 SP2 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep1_tp0_pp3 -> layer_14_expert_ar_sp2_ep1_pp3
	layer_14_expert_out_sp2_ep1_tp1_pp3 -> layer_14_expert_ar_sp2_ep1_pp3
	layer_14_expert_out_sp2_ep1_tp2_pp3 -> layer_14_expert_ar_sp2_ep1_pp3
	layer_14_expert_out_sp2_ep1_tp3_pp3 -> layer_14_expert_ar_sp2_ep1_pp3
	layer_14_combine_sp2_ep1_pp3 [label="Token Combine L14 SP2 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep1_pp3 -> layer_14_combine_sp2_ep1_pp3
	layer_14_dispatch_sp2_ep2_pp3 [label="Token Dispatch L14 SP2 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep2_pp3 [style=dashed]
	layer_14_expert_sp2_ep2_tp0_pp3 [label="Expert L14 SP2 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep2_pp3 -> layer_14_expert_sp2_ep2_tp0_pp3
	layer_14_expert_out_sp2_ep2_tp0_pp3 [label="Expert Out L14 SP2 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep2_tp0_pp3 -> layer_14_expert_out_sp2_ep2_tp0_pp3
	layer_14_expert_sp2_ep2_tp1_pp3 [label="Expert L14 SP2 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep2_pp3 -> layer_14_expert_sp2_ep2_tp1_pp3
	layer_14_expert_out_sp2_ep2_tp1_pp3 [label="Expert Out L14 SP2 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep2_tp1_pp3 -> layer_14_expert_out_sp2_ep2_tp1_pp3
	layer_14_expert_sp2_ep2_tp2_pp3 [label="Expert L14 SP2 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep2_pp3 -> layer_14_expert_sp2_ep2_tp2_pp3
	layer_14_expert_out_sp2_ep2_tp2_pp3 [label="Expert Out L14 SP2 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep2_tp2_pp3 -> layer_14_expert_out_sp2_ep2_tp2_pp3
	layer_14_expert_sp2_ep2_tp3_pp3 [label="Expert L14 SP2 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep2_pp3 -> layer_14_expert_sp2_ep2_tp3_pp3
	layer_14_expert_out_sp2_ep2_tp3_pp3 [label="Expert Out L14 SP2 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep2_tp3_pp3 -> layer_14_expert_out_sp2_ep2_tp3_pp3
	layer_14_expert_ar_sp2_ep2_pp3 [label="Expert All-Reduce L14 SP2 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep2_tp0_pp3 -> layer_14_expert_ar_sp2_ep2_pp3
	layer_14_expert_out_sp2_ep2_tp1_pp3 -> layer_14_expert_ar_sp2_ep2_pp3
	layer_14_expert_out_sp2_ep2_tp2_pp3 -> layer_14_expert_ar_sp2_ep2_pp3
	layer_14_expert_out_sp2_ep2_tp3_pp3 -> layer_14_expert_ar_sp2_ep2_pp3
	layer_14_combine_sp2_ep2_pp3 [label="Token Combine L14 SP2 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep2_pp3 -> layer_14_combine_sp2_ep2_pp3
	layer_14_dispatch_sp2_ep3_pp3 [label="Token Dispatch L14 SP2 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep3_pp3 [style=dashed]
	layer_14_expert_sp2_ep3_tp0_pp3 [label="Expert L14 SP2 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep3_pp3 -> layer_14_expert_sp2_ep3_tp0_pp3
	layer_14_expert_out_sp2_ep3_tp0_pp3 [label="Expert Out L14 SP2 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep3_tp0_pp3 -> layer_14_expert_out_sp2_ep3_tp0_pp3
	layer_14_expert_sp2_ep3_tp1_pp3 [label="Expert L14 SP2 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep3_pp3 -> layer_14_expert_sp2_ep3_tp1_pp3
	layer_14_expert_out_sp2_ep3_tp1_pp3 [label="Expert Out L14 SP2 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep3_tp1_pp3 -> layer_14_expert_out_sp2_ep3_tp1_pp3
	layer_14_expert_sp2_ep3_tp2_pp3 [label="Expert L14 SP2 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep3_pp3 -> layer_14_expert_sp2_ep3_tp2_pp3
	layer_14_expert_out_sp2_ep3_tp2_pp3 [label="Expert Out L14 SP2 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep3_tp2_pp3 -> layer_14_expert_out_sp2_ep3_tp2_pp3
	layer_14_expert_sp2_ep3_tp3_pp3 [label="Expert L14 SP2 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep3_pp3 -> layer_14_expert_sp2_ep3_tp3_pp3
	layer_14_expert_out_sp2_ep3_tp3_pp3 [label="Expert Out L14 SP2 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep3_tp3_pp3 -> layer_14_expert_out_sp2_ep3_tp3_pp3
	layer_14_expert_ar_sp2_ep3_pp3 [label="Expert All-Reduce L14 SP2 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep3_tp0_pp3 -> layer_14_expert_ar_sp2_ep3_pp3
	layer_14_expert_out_sp2_ep3_tp1_pp3 -> layer_14_expert_ar_sp2_ep3_pp3
	layer_14_expert_out_sp2_ep3_tp2_pp3 -> layer_14_expert_ar_sp2_ep3_pp3
	layer_14_expert_out_sp2_ep3_tp3_pp3 -> layer_14_expert_ar_sp2_ep3_pp3
	layer_14_combine_sp2_ep3_pp3 [label="Token Combine L14 SP2 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep3_pp3 -> layer_14_combine_sp2_ep3_pp3
	layer_14_dispatch_sp2_ep4_pp3 [label="Token Dispatch L14 SP2 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep4_pp3 [style=dashed]
	layer_14_expert_sp2_ep4_tp0_pp3 [label="Expert L14 SP2 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep4_pp3 -> layer_14_expert_sp2_ep4_tp0_pp3
	layer_14_expert_out_sp2_ep4_tp0_pp3 [label="Expert Out L14 SP2 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep4_tp0_pp3 -> layer_14_expert_out_sp2_ep4_tp0_pp3
	layer_14_expert_sp2_ep4_tp1_pp3 [label="Expert L14 SP2 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep4_pp3 -> layer_14_expert_sp2_ep4_tp1_pp3
	layer_14_expert_out_sp2_ep4_tp1_pp3 [label="Expert Out L14 SP2 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep4_tp1_pp3 -> layer_14_expert_out_sp2_ep4_tp1_pp3
	layer_14_expert_sp2_ep4_tp2_pp3 [label="Expert L14 SP2 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep4_pp3 -> layer_14_expert_sp2_ep4_tp2_pp3
	layer_14_expert_out_sp2_ep4_tp2_pp3 [label="Expert Out L14 SP2 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep4_tp2_pp3 -> layer_14_expert_out_sp2_ep4_tp2_pp3
	layer_14_expert_sp2_ep4_tp3_pp3 [label="Expert L14 SP2 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep4_pp3 -> layer_14_expert_sp2_ep4_tp3_pp3
	layer_14_expert_out_sp2_ep4_tp3_pp3 [label="Expert Out L14 SP2 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep4_tp3_pp3 -> layer_14_expert_out_sp2_ep4_tp3_pp3
	layer_14_expert_ar_sp2_ep4_pp3 [label="Expert All-Reduce L14 SP2 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep4_tp0_pp3 -> layer_14_expert_ar_sp2_ep4_pp3
	layer_14_expert_out_sp2_ep4_tp1_pp3 -> layer_14_expert_ar_sp2_ep4_pp3
	layer_14_expert_out_sp2_ep4_tp2_pp3 -> layer_14_expert_ar_sp2_ep4_pp3
	layer_14_expert_out_sp2_ep4_tp3_pp3 -> layer_14_expert_ar_sp2_ep4_pp3
	layer_14_combine_sp2_ep4_pp3 [label="Token Combine L14 SP2 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep4_pp3 -> layer_14_combine_sp2_ep4_pp3
	layer_14_dispatch_sp2_ep5_pp3 [label="Token Dispatch L14 SP2 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep5_pp3 [style=dashed]
	layer_14_expert_sp2_ep5_tp0_pp3 [label="Expert L14 SP2 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep5_pp3 -> layer_14_expert_sp2_ep5_tp0_pp3
	layer_14_expert_out_sp2_ep5_tp0_pp3 [label="Expert Out L14 SP2 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep5_tp0_pp3 -> layer_14_expert_out_sp2_ep5_tp0_pp3
	layer_14_expert_sp2_ep5_tp1_pp3 [label="Expert L14 SP2 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep5_pp3 -> layer_14_expert_sp2_ep5_tp1_pp3
	layer_14_expert_out_sp2_ep5_tp1_pp3 [label="Expert Out L14 SP2 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep5_tp1_pp3 -> layer_14_expert_out_sp2_ep5_tp1_pp3
	layer_14_expert_sp2_ep5_tp2_pp3 [label="Expert L14 SP2 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep5_pp3 -> layer_14_expert_sp2_ep5_tp2_pp3
	layer_14_expert_out_sp2_ep5_tp2_pp3 [label="Expert Out L14 SP2 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep5_tp2_pp3 -> layer_14_expert_out_sp2_ep5_tp2_pp3
	layer_14_expert_sp2_ep5_tp3_pp3 [label="Expert L14 SP2 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep5_pp3 -> layer_14_expert_sp2_ep5_tp3_pp3
	layer_14_expert_out_sp2_ep5_tp3_pp3 [label="Expert Out L14 SP2 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep5_tp3_pp3 -> layer_14_expert_out_sp2_ep5_tp3_pp3
	layer_14_expert_ar_sp2_ep5_pp3 [label="Expert All-Reduce L14 SP2 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep5_tp0_pp3 -> layer_14_expert_ar_sp2_ep5_pp3
	layer_14_expert_out_sp2_ep5_tp1_pp3 -> layer_14_expert_ar_sp2_ep5_pp3
	layer_14_expert_out_sp2_ep5_tp2_pp3 -> layer_14_expert_ar_sp2_ep5_pp3
	layer_14_expert_out_sp2_ep5_tp3_pp3 -> layer_14_expert_ar_sp2_ep5_pp3
	layer_14_combine_sp2_ep5_pp3 [label="Token Combine L14 SP2 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep5_pp3 -> layer_14_combine_sp2_ep5_pp3
	layer_14_dispatch_sp2_ep6_pp3 [label="Token Dispatch L14 SP2 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep6_pp3 [style=dashed]
	layer_14_expert_sp2_ep6_tp0_pp3 [label="Expert L14 SP2 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep6_pp3 -> layer_14_expert_sp2_ep6_tp0_pp3
	layer_14_expert_out_sp2_ep6_tp0_pp3 [label="Expert Out L14 SP2 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep6_tp0_pp3 -> layer_14_expert_out_sp2_ep6_tp0_pp3
	layer_14_expert_sp2_ep6_tp1_pp3 [label="Expert L14 SP2 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep6_pp3 -> layer_14_expert_sp2_ep6_tp1_pp3
	layer_14_expert_out_sp2_ep6_tp1_pp3 [label="Expert Out L14 SP2 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep6_tp1_pp3 -> layer_14_expert_out_sp2_ep6_tp1_pp3
	layer_14_expert_sp2_ep6_tp2_pp3 [label="Expert L14 SP2 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep6_pp3 -> layer_14_expert_sp2_ep6_tp2_pp3
	layer_14_expert_out_sp2_ep6_tp2_pp3 [label="Expert Out L14 SP2 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep6_tp2_pp3 -> layer_14_expert_out_sp2_ep6_tp2_pp3
	layer_14_expert_sp2_ep6_tp3_pp3 [label="Expert L14 SP2 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep6_pp3 -> layer_14_expert_sp2_ep6_tp3_pp3
	layer_14_expert_out_sp2_ep6_tp3_pp3 [label="Expert Out L14 SP2 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep6_tp3_pp3 -> layer_14_expert_out_sp2_ep6_tp3_pp3
	layer_14_expert_ar_sp2_ep6_pp3 [label="Expert All-Reduce L14 SP2 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep6_tp0_pp3 -> layer_14_expert_ar_sp2_ep6_pp3
	layer_14_expert_out_sp2_ep6_tp1_pp3 -> layer_14_expert_ar_sp2_ep6_pp3
	layer_14_expert_out_sp2_ep6_tp2_pp3 -> layer_14_expert_ar_sp2_ep6_pp3
	layer_14_expert_out_sp2_ep6_tp3_pp3 -> layer_14_expert_ar_sp2_ep6_pp3
	layer_14_combine_sp2_ep6_pp3 [label="Token Combine L14 SP2 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep6_pp3 -> layer_14_combine_sp2_ep6_pp3
	layer_14_dispatch_sp2_ep7_pp3 [label="Token Dispatch L14 SP2 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep7_pp3 [style=dashed]
	layer_14_expert_sp2_ep7_tp0_pp3 [label="Expert L14 SP2 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep7_pp3 -> layer_14_expert_sp2_ep7_tp0_pp3
	layer_14_expert_out_sp2_ep7_tp0_pp3 [label="Expert Out L14 SP2 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep7_tp0_pp3 -> layer_14_expert_out_sp2_ep7_tp0_pp3
	layer_14_expert_sp2_ep7_tp1_pp3 [label="Expert L14 SP2 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep7_pp3 -> layer_14_expert_sp2_ep7_tp1_pp3
	layer_14_expert_out_sp2_ep7_tp1_pp3 [label="Expert Out L14 SP2 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep7_tp1_pp3 -> layer_14_expert_out_sp2_ep7_tp1_pp3
	layer_14_expert_sp2_ep7_tp2_pp3 [label="Expert L14 SP2 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep7_pp3 -> layer_14_expert_sp2_ep7_tp2_pp3
	layer_14_expert_out_sp2_ep7_tp2_pp3 [label="Expert Out L14 SP2 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep7_tp2_pp3 -> layer_14_expert_out_sp2_ep7_tp2_pp3
	layer_14_expert_sp2_ep7_tp3_pp3 [label="Expert L14 SP2 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep7_pp3 -> layer_14_expert_sp2_ep7_tp3_pp3
	layer_14_expert_out_sp2_ep7_tp3_pp3 [label="Expert Out L14 SP2 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep7_tp3_pp3 -> layer_14_expert_out_sp2_ep7_tp3_pp3
	layer_14_expert_ar_sp2_ep7_pp3 [label="Expert All-Reduce L14 SP2 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep7_tp0_pp3 -> layer_14_expert_ar_sp2_ep7_pp3
	layer_14_expert_out_sp2_ep7_tp1_pp3 -> layer_14_expert_ar_sp2_ep7_pp3
	layer_14_expert_out_sp2_ep7_tp2_pp3 -> layer_14_expert_ar_sp2_ep7_pp3
	layer_14_expert_out_sp2_ep7_tp3_pp3 -> layer_14_expert_ar_sp2_ep7_pp3
	layer_14_combine_sp2_ep7_pp3 [label="Token Combine L14 SP2 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep7_pp3 -> layer_14_combine_sp2_ep7_pp3
	layer_14_dispatch_sp2_ep8_pp3 [label="Token Dispatch L14 SP2 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep8_pp3 [style=dashed]
	layer_14_expert_sp2_ep8_tp0_pp3 [label="Expert L14 SP2 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep8_pp3 -> layer_14_expert_sp2_ep8_tp0_pp3
	layer_14_expert_out_sp2_ep8_tp0_pp3 [label="Expert Out L14 SP2 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep8_tp0_pp3 -> layer_14_expert_out_sp2_ep8_tp0_pp3
	layer_14_expert_sp2_ep8_tp1_pp3 [label="Expert L14 SP2 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep8_pp3 -> layer_14_expert_sp2_ep8_tp1_pp3
	layer_14_expert_out_sp2_ep8_tp1_pp3 [label="Expert Out L14 SP2 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep8_tp1_pp3 -> layer_14_expert_out_sp2_ep8_tp1_pp3
	layer_14_expert_sp2_ep8_tp2_pp3 [label="Expert L14 SP2 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep8_pp3 -> layer_14_expert_sp2_ep8_tp2_pp3
	layer_14_expert_out_sp2_ep8_tp2_pp3 [label="Expert Out L14 SP2 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep8_tp2_pp3 -> layer_14_expert_out_sp2_ep8_tp2_pp3
	layer_14_expert_sp2_ep8_tp3_pp3 [label="Expert L14 SP2 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep8_pp3 -> layer_14_expert_sp2_ep8_tp3_pp3
	layer_14_expert_out_sp2_ep8_tp3_pp3 [label="Expert Out L14 SP2 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep8_tp3_pp3 -> layer_14_expert_out_sp2_ep8_tp3_pp3
	layer_14_expert_ar_sp2_ep8_pp3 [label="Expert All-Reduce L14 SP2 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep8_tp0_pp3 -> layer_14_expert_ar_sp2_ep8_pp3
	layer_14_expert_out_sp2_ep8_tp1_pp3 -> layer_14_expert_ar_sp2_ep8_pp3
	layer_14_expert_out_sp2_ep8_tp2_pp3 -> layer_14_expert_ar_sp2_ep8_pp3
	layer_14_expert_out_sp2_ep8_tp3_pp3 -> layer_14_expert_ar_sp2_ep8_pp3
	layer_14_combine_sp2_ep8_pp3 [label="Token Combine L14 SP2 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep8_pp3 -> layer_14_combine_sp2_ep8_pp3
	layer_14_dispatch_sp2_ep9_pp3 [label="Token Dispatch L14 SP2 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep9_pp3 [style=dashed]
	layer_14_expert_sp2_ep9_tp0_pp3 [label="Expert L14 SP2 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep9_pp3 -> layer_14_expert_sp2_ep9_tp0_pp3
	layer_14_expert_out_sp2_ep9_tp0_pp3 [label="Expert Out L14 SP2 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep9_tp0_pp3 -> layer_14_expert_out_sp2_ep9_tp0_pp3
	layer_14_expert_sp2_ep9_tp1_pp3 [label="Expert L14 SP2 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep9_pp3 -> layer_14_expert_sp2_ep9_tp1_pp3
	layer_14_expert_out_sp2_ep9_tp1_pp3 [label="Expert Out L14 SP2 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep9_tp1_pp3 -> layer_14_expert_out_sp2_ep9_tp1_pp3
	layer_14_expert_sp2_ep9_tp2_pp3 [label="Expert L14 SP2 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep9_pp3 -> layer_14_expert_sp2_ep9_tp2_pp3
	layer_14_expert_out_sp2_ep9_tp2_pp3 [label="Expert Out L14 SP2 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep9_tp2_pp3 -> layer_14_expert_out_sp2_ep9_tp2_pp3
	layer_14_expert_sp2_ep9_tp3_pp3 [label="Expert L14 SP2 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep9_pp3 -> layer_14_expert_sp2_ep9_tp3_pp3
	layer_14_expert_out_sp2_ep9_tp3_pp3 [label="Expert Out L14 SP2 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep9_tp3_pp3 -> layer_14_expert_out_sp2_ep9_tp3_pp3
	layer_14_expert_ar_sp2_ep9_pp3 [label="Expert All-Reduce L14 SP2 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep9_tp0_pp3 -> layer_14_expert_ar_sp2_ep9_pp3
	layer_14_expert_out_sp2_ep9_tp1_pp3 -> layer_14_expert_ar_sp2_ep9_pp3
	layer_14_expert_out_sp2_ep9_tp2_pp3 -> layer_14_expert_ar_sp2_ep9_pp3
	layer_14_expert_out_sp2_ep9_tp3_pp3 -> layer_14_expert_ar_sp2_ep9_pp3
	layer_14_combine_sp2_ep9_pp3 [label="Token Combine L14 SP2 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep9_pp3 -> layer_14_combine_sp2_ep9_pp3
	layer_14_dispatch_sp2_ep10_pp3 [label="Token Dispatch L14 SP2 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep10_pp3 [style=dashed]
	layer_14_expert_sp2_ep10_tp0_pp3 [label="Expert L14 SP2 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep10_pp3 -> layer_14_expert_sp2_ep10_tp0_pp3
	layer_14_expert_out_sp2_ep10_tp0_pp3 [label="Expert Out L14 SP2 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep10_tp0_pp3 -> layer_14_expert_out_sp2_ep10_tp0_pp3
	layer_14_expert_sp2_ep10_tp1_pp3 [label="Expert L14 SP2 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep10_pp3 -> layer_14_expert_sp2_ep10_tp1_pp3
	layer_14_expert_out_sp2_ep10_tp1_pp3 [label="Expert Out L14 SP2 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep10_tp1_pp3 -> layer_14_expert_out_sp2_ep10_tp1_pp3
	layer_14_expert_sp2_ep10_tp2_pp3 [label="Expert L14 SP2 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep10_pp3 -> layer_14_expert_sp2_ep10_tp2_pp3
	layer_14_expert_out_sp2_ep10_tp2_pp3 [label="Expert Out L14 SP2 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep10_tp2_pp3 -> layer_14_expert_out_sp2_ep10_tp2_pp3
	layer_14_expert_sp2_ep10_tp3_pp3 [label="Expert L14 SP2 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep10_pp3 -> layer_14_expert_sp2_ep10_tp3_pp3
	layer_14_expert_out_sp2_ep10_tp3_pp3 [label="Expert Out L14 SP2 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep10_tp3_pp3 -> layer_14_expert_out_sp2_ep10_tp3_pp3
	layer_14_expert_ar_sp2_ep10_pp3 [label="Expert All-Reduce L14 SP2 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep10_tp0_pp3 -> layer_14_expert_ar_sp2_ep10_pp3
	layer_14_expert_out_sp2_ep10_tp1_pp3 -> layer_14_expert_ar_sp2_ep10_pp3
	layer_14_expert_out_sp2_ep10_tp2_pp3 -> layer_14_expert_ar_sp2_ep10_pp3
	layer_14_expert_out_sp2_ep10_tp3_pp3 -> layer_14_expert_ar_sp2_ep10_pp3
	layer_14_combine_sp2_ep10_pp3 [label="Token Combine L14 SP2 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep10_pp3 -> layer_14_combine_sp2_ep10_pp3
	layer_14_dispatch_sp2_ep11_pp3 [label="Token Dispatch L14 SP2 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep11_pp3 [style=dashed]
	layer_14_expert_sp2_ep11_tp0_pp3 [label="Expert L14 SP2 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep11_pp3 -> layer_14_expert_sp2_ep11_tp0_pp3
	layer_14_expert_out_sp2_ep11_tp0_pp3 [label="Expert Out L14 SP2 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep11_tp0_pp3 -> layer_14_expert_out_sp2_ep11_tp0_pp3
	layer_14_expert_sp2_ep11_tp1_pp3 [label="Expert L14 SP2 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep11_pp3 -> layer_14_expert_sp2_ep11_tp1_pp3
	layer_14_expert_out_sp2_ep11_tp1_pp3 [label="Expert Out L14 SP2 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep11_tp1_pp3 -> layer_14_expert_out_sp2_ep11_tp1_pp3
	layer_14_expert_sp2_ep11_tp2_pp3 [label="Expert L14 SP2 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep11_pp3 -> layer_14_expert_sp2_ep11_tp2_pp3
	layer_14_expert_out_sp2_ep11_tp2_pp3 [label="Expert Out L14 SP2 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep11_tp2_pp3 -> layer_14_expert_out_sp2_ep11_tp2_pp3
	layer_14_expert_sp2_ep11_tp3_pp3 [label="Expert L14 SP2 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep11_pp3 -> layer_14_expert_sp2_ep11_tp3_pp3
	layer_14_expert_out_sp2_ep11_tp3_pp3 [label="Expert Out L14 SP2 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep11_tp3_pp3 -> layer_14_expert_out_sp2_ep11_tp3_pp3
	layer_14_expert_ar_sp2_ep11_pp3 [label="Expert All-Reduce L14 SP2 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep11_tp0_pp3 -> layer_14_expert_ar_sp2_ep11_pp3
	layer_14_expert_out_sp2_ep11_tp1_pp3 -> layer_14_expert_ar_sp2_ep11_pp3
	layer_14_expert_out_sp2_ep11_tp2_pp3 -> layer_14_expert_ar_sp2_ep11_pp3
	layer_14_expert_out_sp2_ep11_tp3_pp3 -> layer_14_expert_ar_sp2_ep11_pp3
	layer_14_combine_sp2_ep11_pp3 [label="Token Combine L14 SP2 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep11_pp3 -> layer_14_combine_sp2_ep11_pp3
	layer_14_dispatch_sp2_ep12_pp3 [label="Token Dispatch L14 SP2 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep12_pp3 [style=dashed]
	layer_14_expert_sp2_ep12_tp0_pp3 [label="Expert L14 SP2 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep12_pp3 -> layer_14_expert_sp2_ep12_tp0_pp3
	layer_14_expert_out_sp2_ep12_tp0_pp3 [label="Expert Out L14 SP2 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep12_tp0_pp3 -> layer_14_expert_out_sp2_ep12_tp0_pp3
	layer_14_expert_sp2_ep12_tp1_pp3 [label="Expert L14 SP2 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep12_pp3 -> layer_14_expert_sp2_ep12_tp1_pp3
	layer_14_expert_out_sp2_ep12_tp1_pp3 [label="Expert Out L14 SP2 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep12_tp1_pp3 -> layer_14_expert_out_sp2_ep12_tp1_pp3
	layer_14_expert_sp2_ep12_tp2_pp3 [label="Expert L14 SP2 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep12_pp3 -> layer_14_expert_sp2_ep12_tp2_pp3
	layer_14_expert_out_sp2_ep12_tp2_pp3 [label="Expert Out L14 SP2 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep12_tp2_pp3 -> layer_14_expert_out_sp2_ep12_tp2_pp3
	layer_14_expert_sp2_ep12_tp3_pp3 [label="Expert L14 SP2 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep12_pp3 -> layer_14_expert_sp2_ep12_tp3_pp3
	layer_14_expert_out_sp2_ep12_tp3_pp3 [label="Expert Out L14 SP2 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep12_tp3_pp3 -> layer_14_expert_out_sp2_ep12_tp3_pp3
	layer_14_expert_ar_sp2_ep12_pp3 [label="Expert All-Reduce L14 SP2 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep12_tp0_pp3 -> layer_14_expert_ar_sp2_ep12_pp3
	layer_14_expert_out_sp2_ep12_tp1_pp3 -> layer_14_expert_ar_sp2_ep12_pp3
	layer_14_expert_out_sp2_ep12_tp2_pp3 -> layer_14_expert_ar_sp2_ep12_pp3
	layer_14_expert_out_sp2_ep12_tp3_pp3 -> layer_14_expert_ar_sp2_ep12_pp3
	layer_14_combine_sp2_ep12_pp3 [label="Token Combine L14 SP2 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep12_pp3 -> layer_14_combine_sp2_ep12_pp3
	layer_14_dispatch_sp2_ep13_pp3 [label="Token Dispatch L14 SP2 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep13_pp3 [style=dashed]
	layer_14_expert_sp2_ep13_tp0_pp3 [label="Expert L14 SP2 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep13_pp3 -> layer_14_expert_sp2_ep13_tp0_pp3
	layer_14_expert_out_sp2_ep13_tp0_pp3 [label="Expert Out L14 SP2 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep13_tp0_pp3 -> layer_14_expert_out_sp2_ep13_tp0_pp3
	layer_14_expert_sp2_ep13_tp1_pp3 [label="Expert L14 SP2 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep13_pp3 -> layer_14_expert_sp2_ep13_tp1_pp3
	layer_14_expert_out_sp2_ep13_tp1_pp3 [label="Expert Out L14 SP2 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep13_tp1_pp3 -> layer_14_expert_out_sp2_ep13_tp1_pp3
	layer_14_expert_sp2_ep13_tp2_pp3 [label="Expert L14 SP2 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep13_pp3 -> layer_14_expert_sp2_ep13_tp2_pp3
	layer_14_expert_out_sp2_ep13_tp2_pp3 [label="Expert Out L14 SP2 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep13_tp2_pp3 -> layer_14_expert_out_sp2_ep13_tp2_pp3
	layer_14_expert_sp2_ep13_tp3_pp3 [label="Expert L14 SP2 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep13_pp3 -> layer_14_expert_sp2_ep13_tp3_pp3
	layer_14_expert_out_sp2_ep13_tp3_pp3 [label="Expert Out L14 SP2 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep13_tp3_pp3 -> layer_14_expert_out_sp2_ep13_tp3_pp3
	layer_14_expert_ar_sp2_ep13_pp3 [label="Expert All-Reduce L14 SP2 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep13_tp0_pp3 -> layer_14_expert_ar_sp2_ep13_pp3
	layer_14_expert_out_sp2_ep13_tp1_pp3 -> layer_14_expert_ar_sp2_ep13_pp3
	layer_14_expert_out_sp2_ep13_tp2_pp3 -> layer_14_expert_ar_sp2_ep13_pp3
	layer_14_expert_out_sp2_ep13_tp3_pp3 -> layer_14_expert_ar_sp2_ep13_pp3
	layer_14_combine_sp2_ep13_pp3 [label="Token Combine L14 SP2 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep13_pp3 -> layer_14_combine_sp2_ep13_pp3
	layer_14_dispatch_sp2_ep14_pp3 [label="Token Dispatch L14 SP2 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep14_pp3 [style=dashed]
	layer_14_expert_sp2_ep14_tp0_pp3 [label="Expert L14 SP2 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep14_pp3 -> layer_14_expert_sp2_ep14_tp0_pp3
	layer_14_expert_out_sp2_ep14_tp0_pp3 [label="Expert Out L14 SP2 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep14_tp0_pp3 -> layer_14_expert_out_sp2_ep14_tp0_pp3
	layer_14_expert_sp2_ep14_tp1_pp3 [label="Expert L14 SP2 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep14_pp3 -> layer_14_expert_sp2_ep14_tp1_pp3
	layer_14_expert_out_sp2_ep14_tp1_pp3 [label="Expert Out L14 SP2 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep14_tp1_pp3 -> layer_14_expert_out_sp2_ep14_tp1_pp3
	layer_14_expert_sp2_ep14_tp2_pp3 [label="Expert L14 SP2 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep14_pp3 -> layer_14_expert_sp2_ep14_tp2_pp3
	layer_14_expert_out_sp2_ep14_tp2_pp3 [label="Expert Out L14 SP2 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep14_tp2_pp3 -> layer_14_expert_out_sp2_ep14_tp2_pp3
	layer_14_expert_sp2_ep14_tp3_pp3 [label="Expert L14 SP2 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep14_pp3 -> layer_14_expert_sp2_ep14_tp3_pp3
	layer_14_expert_out_sp2_ep14_tp3_pp3 [label="Expert Out L14 SP2 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep14_tp3_pp3 -> layer_14_expert_out_sp2_ep14_tp3_pp3
	layer_14_expert_ar_sp2_ep14_pp3 [label="Expert All-Reduce L14 SP2 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep14_tp0_pp3 -> layer_14_expert_ar_sp2_ep14_pp3
	layer_14_expert_out_sp2_ep14_tp1_pp3 -> layer_14_expert_ar_sp2_ep14_pp3
	layer_14_expert_out_sp2_ep14_tp2_pp3 -> layer_14_expert_ar_sp2_ep14_pp3
	layer_14_expert_out_sp2_ep14_tp3_pp3 -> layer_14_expert_ar_sp2_ep14_pp3
	layer_14_combine_sp2_ep14_pp3 [label="Token Combine L14 SP2 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep14_pp3 -> layer_14_combine_sp2_ep14_pp3
	layer_14_dispatch_sp2_ep15_pp3 [label="Token Dispatch L14 SP2 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp2_pp3 -> layer_14_dispatch_sp2_ep15_pp3 [style=dashed]
	layer_14_expert_sp2_ep15_tp0_pp3 [label="Expert L14 SP2 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep15_pp3 -> layer_14_expert_sp2_ep15_tp0_pp3
	layer_14_expert_out_sp2_ep15_tp0_pp3 [label="Expert Out L14 SP2 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep15_tp0_pp3 -> layer_14_expert_out_sp2_ep15_tp0_pp3
	layer_14_expert_sp2_ep15_tp1_pp3 [label="Expert L14 SP2 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep15_pp3 -> layer_14_expert_sp2_ep15_tp1_pp3
	layer_14_expert_out_sp2_ep15_tp1_pp3 [label="Expert Out L14 SP2 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep15_tp1_pp3 -> layer_14_expert_out_sp2_ep15_tp1_pp3
	layer_14_expert_sp2_ep15_tp2_pp3 [label="Expert L14 SP2 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep15_pp3 -> layer_14_expert_sp2_ep15_tp2_pp3
	layer_14_expert_out_sp2_ep15_tp2_pp3 [label="Expert Out L14 SP2 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep15_tp2_pp3 -> layer_14_expert_out_sp2_ep15_tp2_pp3
	layer_14_expert_sp2_ep15_tp3_pp3 [label="Expert L14 SP2 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp2_ep15_pp3 -> layer_14_expert_sp2_ep15_tp3_pp3
	layer_14_expert_out_sp2_ep15_tp3_pp3 [label="Expert Out L14 SP2 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp2_ep15_tp3_pp3 -> layer_14_expert_out_sp2_ep15_tp3_pp3
	layer_14_expert_ar_sp2_ep15_pp3 [label="Expert All-Reduce L14 SP2 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp2_ep15_tp0_pp3 -> layer_14_expert_ar_sp2_ep15_pp3
	layer_14_expert_out_sp2_ep15_tp1_pp3 -> layer_14_expert_ar_sp2_ep15_pp3
	layer_14_expert_out_sp2_ep15_tp2_pp3 -> layer_14_expert_ar_sp2_ep15_pp3
	layer_14_expert_out_sp2_ep15_tp3_pp3 -> layer_14_expert_ar_sp2_ep15_pp3
	layer_14_combine_sp2_ep15_pp3 [label="Token Combine L14 SP2 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp2_ep15_pp3 -> layer_14_combine_sp2_ep15_pp3
	layer_14_moe_all2all_sp2_pp3 [label="MoE All-to-All L14 SP2\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_14_combine_sp2_ep0_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep1_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep2_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep3_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep4_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep5_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep6_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep7_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep8_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep9_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep10_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep11_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep12_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep13_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep14_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_combine_sp2_ep15_pp3 -> layer_14_moe_all2all_sp2_pp3
	layer_14_mlp_out_sp2_pp3 [label="MoE Output L14 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_moe_all2all_sp2_pp3 -> layer_14_mlp_out_sp2_pp3
	layer_14_mlp_res_sp2_pp3 [label="MLP Residual L14 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_mlp_out_sp2_pp3 -> layer_14_mlp_res_sp2_pp3
	layer_14_attn_res_sp2_pp3 -> layer_14_mlp_res_sp2_pp3 [style=dashed]
	layer_14_norm_sp3_pp3 [label="LayerNorm L14 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_13_mlp_out_sp3_pp3 -> layer_14_norm_sp3_pp3
	layer_14_qkv_sp3_tp0_pp3 [label="QKV Proj L14 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp3_pp3 -> layer_14_qkv_sp3_tp0_pp3
	layer_14_attn_sp3_tp0_pp3 [label="Attention L14 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp3_tp0_pp3 -> layer_14_attn_sp3_tp0_pp3
	layer_14_attn_out_sp3_tp0_pp3 [label="Attn Out Proj L14 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp3_tp0_pp3 -> layer_14_attn_out_sp3_tp0_pp3
	layer_14_qkv_sp3_tp1_pp3 [label="QKV Proj L14 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp3_pp3 -> layer_14_qkv_sp3_tp1_pp3
	layer_14_attn_sp3_tp1_pp3 [label="Attention L14 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp3_tp1_pp3 -> layer_14_attn_sp3_tp1_pp3
	layer_14_attn_out_sp3_tp1_pp3 [label="Attn Out Proj L14 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp3_tp1_pp3 -> layer_14_attn_out_sp3_tp1_pp3
	layer_14_qkv_sp3_tp2_pp3 [label="QKV Proj L14 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp3_pp3 -> layer_14_qkv_sp3_tp2_pp3
	layer_14_attn_sp3_tp2_pp3 [label="Attention L14 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp3_tp2_pp3 -> layer_14_attn_sp3_tp2_pp3
	layer_14_attn_out_sp3_tp2_pp3 [label="Attn Out Proj L14 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp3_tp2_pp3 -> layer_14_attn_out_sp3_tp2_pp3
	layer_14_qkv_sp3_tp3_pp3 [label="QKV Proj L14 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_norm_sp3_pp3 -> layer_14_qkv_sp3_tp3_pp3
	layer_14_attn_sp3_tp3_pp3 [label="Attention L14 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_qkv_sp3_tp3_pp3 -> layer_14_attn_sp3_tp3_pp3
	layer_14_attn_out_sp3_tp3_pp3 [label="Attn Out Proj L14 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_14_attn_sp3_tp3_pp3 -> layer_14_attn_out_sp3_tp3_pp3
	layer_14_attn_ar_sp3_pp3 [label="Attention All-Reduce L14 SP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_attn_out_sp3_tp0_pp3 -> layer_14_attn_ar_sp3_pp3
	layer_14_attn_out_sp3_tp1_pp3 -> layer_14_attn_ar_sp3_pp3
	layer_14_attn_out_sp3_tp2_pp3 -> layer_14_attn_ar_sp3_pp3
	layer_14_attn_out_sp3_tp3_pp3 -> layer_14_attn_ar_sp3_pp3
	layer_14_attn_res_sp3_pp3 [label="Attention Residual L14 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_attn_ar_sp3_pp3 -> layer_14_attn_res_sp3_pp3
	layer_14_norm_sp3_pp3 -> layer_14_attn_res_sp3_pp3 [style=dashed]
	layer_14_post_norm_sp3_pp3 [label="Post-Attn Norm L14 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_attn_res_sp3_pp3 -> layer_14_post_norm_sp3_pp3
	layer_14_router_sp3_pp3 [label="MoE Router L14 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_14_post_norm_sp3_pp3 -> layer_14_router_sp3_pp3
	layer_14_dispatch_sp3_ep0_pp3 [label="Token Dispatch L14 SP3 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep0_pp3 [style=dashed]
	layer_14_expert_sp3_ep0_tp0_pp3 [label="Expert L14 SP3 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep0_pp3 -> layer_14_expert_sp3_ep0_tp0_pp3
	layer_14_expert_out_sp3_ep0_tp0_pp3 [label="Expert Out L14 SP3 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep0_tp0_pp3 -> layer_14_expert_out_sp3_ep0_tp0_pp3
	layer_14_expert_sp3_ep0_tp1_pp3 [label="Expert L14 SP3 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep0_pp3 -> layer_14_expert_sp3_ep0_tp1_pp3
	layer_14_expert_out_sp3_ep0_tp1_pp3 [label="Expert Out L14 SP3 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep0_tp1_pp3 -> layer_14_expert_out_sp3_ep0_tp1_pp3
	layer_14_expert_sp3_ep0_tp2_pp3 [label="Expert L14 SP3 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep0_pp3 -> layer_14_expert_sp3_ep0_tp2_pp3
	layer_14_expert_out_sp3_ep0_tp2_pp3 [label="Expert Out L14 SP3 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep0_tp2_pp3 -> layer_14_expert_out_sp3_ep0_tp2_pp3
	layer_14_expert_sp3_ep0_tp3_pp3 [label="Expert L14 SP3 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep0_pp3 -> layer_14_expert_sp3_ep0_tp3_pp3
	layer_14_expert_out_sp3_ep0_tp3_pp3 [label="Expert Out L14 SP3 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep0_tp3_pp3 -> layer_14_expert_out_sp3_ep0_tp3_pp3
	layer_14_expert_ar_sp3_ep0_pp3 [label="Expert All-Reduce L14 SP3 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep0_tp0_pp3 -> layer_14_expert_ar_sp3_ep0_pp3
	layer_14_expert_out_sp3_ep0_tp1_pp3 -> layer_14_expert_ar_sp3_ep0_pp3
	layer_14_expert_out_sp3_ep0_tp2_pp3 -> layer_14_expert_ar_sp3_ep0_pp3
	layer_14_expert_out_sp3_ep0_tp3_pp3 -> layer_14_expert_ar_sp3_ep0_pp3
	layer_14_combine_sp3_ep0_pp3 [label="Token Combine L14 SP3 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep0_pp3 -> layer_14_combine_sp3_ep0_pp3
	layer_14_dispatch_sp3_ep1_pp3 [label="Token Dispatch L14 SP3 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep1_pp3 [style=dashed]
	layer_14_expert_sp3_ep1_tp0_pp3 [label="Expert L14 SP3 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep1_pp3 -> layer_14_expert_sp3_ep1_tp0_pp3
	layer_14_expert_out_sp3_ep1_tp0_pp3 [label="Expert Out L14 SP3 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep1_tp0_pp3 -> layer_14_expert_out_sp3_ep1_tp0_pp3
	layer_14_expert_sp3_ep1_tp1_pp3 [label="Expert L14 SP3 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep1_pp3 -> layer_14_expert_sp3_ep1_tp1_pp3
	layer_14_expert_out_sp3_ep1_tp1_pp3 [label="Expert Out L14 SP3 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep1_tp1_pp3 -> layer_14_expert_out_sp3_ep1_tp1_pp3
	layer_14_expert_sp3_ep1_tp2_pp3 [label="Expert L14 SP3 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep1_pp3 -> layer_14_expert_sp3_ep1_tp2_pp3
	layer_14_expert_out_sp3_ep1_tp2_pp3 [label="Expert Out L14 SP3 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep1_tp2_pp3 -> layer_14_expert_out_sp3_ep1_tp2_pp3
	layer_14_expert_sp3_ep1_tp3_pp3 [label="Expert L14 SP3 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep1_pp3 -> layer_14_expert_sp3_ep1_tp3_pp3
	layer_14_expert_out_sp3_ep1_tp3_pp3 [label="Expert Out L14 SP3 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep1_tp3_pp3 -> layer_14_expert_out_sp3_ep1_tp3_pp3
	layer_14_expert_ar_sp3_ep1_pp3 [label="Expert All-Reduce L14 SP3 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep1_tp0_pp3 -> layer_14_expert_ar_sp3_ep1_pp3
	layer_14_expert_out_sp3_ep1_tp1_pp3 -> layer_14_expert_ar_sp3_ep1_pp3
	layer_14_expert_out_sp3_ep1_tp2_pp3 -> layer_14_expert_ar_sp3_ep1_pp3
	layer_14_expert_out_sp3_ep1_tp3_pp3 -> layer_14_expert_ar_sp3_ep1_pp3
	layer_14_combine_sp3_ep1_pp3 [label="Token Combine L14 SP3 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep1_pp3 -> layer_14_combine_sp3_ep1_pp3
	layer_14_dispatch_sp3_ep2_pp3 [label="Token Dispatch L14 SP3 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep2_pp3 [style=dashed]
	layer_14_expert_sp3_ep2_tp0_pp3 [label="Expert L14 SP3 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep2_pp3 -> layer_14_expert_sp3_ep2_tp0_pp3
	layer_14_expert_out_sp3_ep2_tp0_pp3 [label="Expert Out L14 SP3 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep2_tp0_pp3 -> layer_14_expert_out_sp3_ep2_tp0_pp3
	layer_14_expert_sp3_ep2_tp1_pp3 [label="Expert L14 SP3 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep2_pp3 -> layer_14_expert_sp3_ep2_tp1_pp3
	layer_14_expert_out_sp3_ep2_tp1_pp3 [label="Expert Out L14 SP3 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep2_tp1_pp3 -> layer_14_expert_out_sp3_ep2_tp1_pp3
	layer_14_expert_sp3_ep2_tp2_pp3 [label="Expert L14 SP3 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep2_pp3 -> layer_14_expert_sp3_ep2_tp2_pp3
	layer_14_expert_out_sp3_ep2_tp2_pp3 [label="Expert Out L14 SP3 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep2_tp2_pp3 -> layer_14_expert_out_sp3_ep2_tp2_pp3
	layer_14_expert_sp3_ep2_tp3_pp3 [label="Expert L14 SP3 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep2_pp3 -> layer_14_expert_sp3_ep2_tp3_pp3
	layer_14_expert_out_sp3_ep2_tp3_pp3 [label="Expert Out L14 SP3 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep2_tp3_pp3 -> layer_14_expert_out_sp3_ep2_tp3_pp3
	layer_14_expert_ar_sp3_ep2_pp3 [label="Expert All-Reduce L14 SP3 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep2_tp0_pp3 -> layer_14_expert_ar_sp3_ep2_pp3
	layer_14_expert_out_sp3_ep2_tp1_pp3 -> layer_14_expert_ar_sp3_ep2_pp3
	layer_14_expert_out_sp3_ep2_tp2_pp3 -> layer_14_expert_ar_sp3_ep2_pp3
	layer_14_expert_out_sp3_ep2_tp3_pp3 -> layer_14_expert_ar_sp3_ep2_pp3
	layer_14_combine_sp3_ep2_pp3 [label="Token Combine L14 SP3 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep2_pp3 -> layer_14_combine_sp3_ep2_pp3
	layer_14_dispatch_sp3_ep3_pp3 [label="Token Dispatch L14 SP3 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep3_pp3 [style=dashed]
	layer_14_expert_sp3_ep3_tp0_pp3 [label="Expert L14 SP3 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep3_pp3 -> layer_14_expert_sp3_ep3_tp0_pp3
	layer_14_expert_out_sp3_ep3_tp0_pp3 [label="Expert Out L14 SP3 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep3_tp0_pp3 -> layer_14_expert_out_sp3_ep3_tp0_pp3
	layer_14_expert_sp3_ep3_tp1_pp3 [label="Expert L14 SP3 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep3_pp3 -> layer_14_expert_sp3_ep3_tp1_pp3
	layer_14_expert_out_sp3_ep3_tp1_pp3 [label="Expert Out L14 SP3 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep3_tp1_pp3 -> layer_14_expert_out_sp3_ep3_tp1_pp3
	layer_14_expert_sp3_ep3_tp2_pp3 [label="Expert L14 SP3 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep3_pp3 -> layer_14_expert_sp3_ep3_tp2_pp3
	layer_14_expert_out_sp3_ep3_tp2_pp3 [label="Expert Out L14 SP3 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep3_tp2_pp3 -> layer_14_expert_out_sp3_ep3_tp2_pp3
	layer_14_expert_sp3_ep3_tp3_pp3 [label="Expert L14 SP3 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep3_pp3 -> layer_14_expert_sp3_ep3_tp3_pp3
	layer_14_expert_out_sp3_ep3_tp3_pp3 [label="Expert Out L14 SP3 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep3_tp3_pp3 -> layer_14_expert_out_sp3_ep3_tp3_pp3
	layer_14_expert_ar_sp3_ep3_pp3 [label="Expert All-Reduce L14 SP3 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep3_tp0_pp3 -> layer_14_expert_ar_sp3_ep3_pp3
	layer_14_expert_out_sp3_ep3_tp1_pp3 -> layer_14_expert_ar_sp3_ep3_pp3
	layer_14_expert_out_sp3_ep3_tp2_pp3 -> layer_14_expert_ar_sp3_ep3_pp3
	layer_14_expert_out_sp3_ep3_tp3_pp3 -> layer_14_expert_ar_sp3_ep3_pp3
	layer_14_combine_sp3_ep3_pp3 [label="Token Combine L14 SP3 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep3_pp3 -> layer_14_combine_sp3_ep3_pp3
	layer_14_dispatch_sp3_ep4_pp3 [label="Token Dispatch L14 SP3 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep4_pp3 [style=dashed]
	layer_14_expert_sp3_ep4_tp0_pp3 [label="Expert L14 SP3 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep4_pp3 -> layer_14_expert_sp3_ep4_tp0_pp3
	layer_14_expert_out_sp3_ep4_tp0_pp3 [label="Expert Out L14 SP3 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep4_tp0_pp3 -> layer_14_expert_out_sp3_ep4_tp0_pp3
	layer_14_expert_sp3_ep4_tp1_pp3 [label="Expert L14 SP3 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep4_pp3 -> layer_14_expert_sp3_ep4_tp1_pp3
	layer_14_expert_out_sp3_ep4_tp1_pp3 [label="Expert Out L14 SP3 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep4_tp1_pp3 -> layer_14_expert_out_sp3_ep4_tp1_pp3
	layer_14_expert_sp3_ep4_tp2_pp3 [label="Expert L14 SP3 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep4_pp3 -> layer_14_expert_sp3_ep4_tp2_pp3
	layer_14_expert_out_sp3_ep4_tp2_pp3 [label="Expert Out L14 SP3 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep4_tp2_pp3 -> layer_14_expert_out_sp3_ep4_tp2_pp3
	layer_14_expert_sp3_ep4_tp3_pp3 [label="Expert L14 SP3 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep4_pp3 -> layer_14_expert_sp3_ep4_tp3_pp3
	layer_14_expert_out_sp3_ep4_tp3_pp3 [label="Expert Out L14 SP3 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep4_tp3_pp3 -> layer_14_expert_out_sp3_ep4_tp3_pp3
	layer_14_expert_ar_sp3_ep4_pp3 [label="Expert All-Reduce L14 SP3 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep4_tp0_pp3 -> layer_14_expert_ar_sp3_ep4_pp3
	layer_14_expert_out_sp3_ep4_tp1_pp3 -> layer_14_expert_ar_sp3_ep4_pp3
	layer_14_expert_out_sp3_ep4_tp2_pp3 -> layer_14_expert_ar_sp3_ep4_pp3
	layer_14_expert_out_sp3_ep4_tp3_pp3 -> layer_14_expert_ar_sp3_ep4_pp3
	layer_14_combine_sp3_ep4_pp3 [label="Token Combine L14 SP3 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep4_pp3 -> layer_14_combine_sp3_ep4_pp3
	layer_14_dispatch_sp3_ep5_pp3 [label="Token Dispatch L14 SP3 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep5_pp3 [style=dashed]
	layer_14_expert_sp3_ep5_tp0_pp3 [label="Expert L14 SP3 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep5_pp3 -> layer_14_expert_sp3_ep5_tp0_pp3
	layer_14_expert_out_sp3_ep5_tp0_pp3 [label="Expert Out L14 SP3 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep5_tp0_pp3 -> layer_14_expert_out_sp3_ep5_tp0_pp3
	layer_14_expert_sp3_ep5_tp1_pp3 [label="Expert L14 SP3 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep5_pp3 -> layer_14_expert_sp3_ep5_tp1_pp3
	layer_14_expert_out_sp3_ep5_tp1_pp3 [label="Expert Out L14 SP3 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep5_tp1_pp3 -> layer_14_expert_out_sp3_ep5_tp1_pp3
	layer_14_expert_sp3_ep5_tp2_pp3 [label="Expert L14 SP3 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep5_pp3 -> layer_14_expert_sp3_ep5_tp2_pp3
	layer_14_expert_out_sp3_ep5_tp2_pp3 [label="Expert Out L14 SP3 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep5_tp2_pp3 -> layer_14_expert_out_sp3_ep5_tp2_pp3
	layer_14_expert_sp3_ep5_tp3_pp3 [label="Expert L14 SP3 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep5_pp3 -> layer_14_expert_sp3_ep5_tp3_pp3
	layer_14_expert_out_sp3_ep5_tp3_pp3 [label="Expert Out L14 SP3 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep5_tp3_pp3 -> layer_14_expert_out_sp3_ep5_tp3_pp3
	layer_14_expert_ar_sp3_ep5_pp3 [label="Expert All-Reduce L14 SP3 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep5_tp0_pp3 -> layer_14_expert_ar_sp3_ep5_pp3
	layer_14_expert_out_sp3_ep5_tp1_pp3 -> layer_14_expert_ar_sp3_ep5_pp3
	layer_14_expert_out_sp3_ep5_tp2_pp3 -> layer_14_expert_ar_sp3_ep5_pp3
	layer_14_expert_out_sp3_ep5_tp3_pp3 -> layer_14_expert_ar_sp3_ep5_pp3
	layer_14_combine_sp3_ep5_pp3 [label="Token Combine L14 SP3 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep5_pp3 -> layer_14_combine_sp3_ep5_pp3
	layer_14_dispatch_sp3_ep6_pp3 [label="Token Dispatch L14 SP3 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep6_pp3 [style=dashed]
	layer_14_expert_sp3_ep6_tp0_pp3 [label="Expert L14 SP3 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep6_pp3 -> layer_14_expert_sp3_ep6_tp0_pp3
	layer_14_expert_out_sp3_ep6_tp0_pp3 [label="Expert Out L14 SP3 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep6_tp0_pp3 -> layer_14_expert_out_sp3_ep6_tp0_pp3
	layer_14_expert_sp3_ep6_tp1_pp3 [label="Expert L14 SP3 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep6_pp3 -> layer_14_expert_sp3_ep6_tp1_pp3
	layer_14_expert_out_sp3_ep6_tp1_pp3 [label="Expert Out L14 SP3 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep6_tp1_pp3 -> layer_14_expert_out_sp3_ep6_tp1_pp3
	layer_14_expert_sp3_ep6_tp2_pp3 [label="Expert L14 SP3 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep6_pp3 -> layer_14_expert_sp3_ep6_tp2_pp3
	layer_14_expert_out_sp3_ep6_tp2_pp3 [label="Expert Out L14 SP3 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep6_tp2_pp3 -> layer_14_expert_out_sp3_ep6_tp2_pp3
	layer_14_expert_sp3_ep6_tp3_pp3 [label="Expert L14 SP3 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep6_pp3 -> layer_14_expert_sp3_ep6_tp3_pp3
	layer_14_expert_out_sp3_ep6_tp3_pp3 [label="Expert Out L14 SP3 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep6_tp3_pp3 -> layer_14_expert_out_sp3_ep6_tp3_pp3
	layer_14_expert_ar_sp3_ep6_pp3 [label="Expert All-Reduce L14 SP3 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep6_tp0_pp3 -> layer_14_expert_ar_sp3_ep6_pp3
	layer_14_expert_out_sp3_ep6_tp1_pp3 -> layer_14_expert_ar_sp3_ep6_pp3
	layer_14_expert_out_sp3_ep6_tp2_pp3 -> layer_14_expert_ar_sp3_ep6_pp3
	layer_14_expert_out_sp3_ep6_tp3_pp3 -> layer_14_expert_ar_sp3_ep6_pp3
	layer_14_combine_sp3_ep6_pp3 [label="Token Combine L14 SP3 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep6_pp3 -> layer_14_combine_sp3_ep6_pp3
	layer_14_dispatch_sp3_ep7_pp3 [label="Token Dispatch L14 SP3 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep7_pp3 [style=dashed]
	layer_14_expert_sp3_ep7_tp0_pp3 [label="Expert L14 SP3 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep7_pp3 -> layer_14_expert_sp3_ep7_tp0_pp3
	layer_14_expert_out_sp3_ep7_tp0_pp3 [label="Expert Out L14 SP3 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep7_tp0_pp3 -> layer_14_expert_out_sp3_ep7_tp0_pp3
	layer_14_expert_sp3_ep7_tp1_pp3 [label="Expert L14 SP3 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep7_pp3 -> layer_14_expert_sp3_ep7_tp1_pp3
	layer_14_expert_out_sp3_ep7_tp1_pp3 [label="Expert Out L14 SP3 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep7_tp1_pp3 -> layer_14_expert_out_sp3_ep7_tp1_pp3
	layer_14_expert_sp3_ep7_tp2_pp3 [label="Expert L14 SP3 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep7_pp3 -> layer_14_expert_sp3_ep7_tp2_pp3
	layer_14_expert_out_sp3_ep7_tp2_pp3 [label="Expert Out L14 SP3 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep7_tp2_pp3 -> layer_14_expert_out_sp3_ep7_tp2_pp3
	layer_14_expert_sp3_ep7_tp3_pp3 [label="Expert L14 SP3 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep7_pp3 -> layer_14_expert_sp3_ep7_tp3_pp3
	layer_14_expert_out_sp3_ep7_tp3_pp3 [label="Expert Out L14 SP3 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep7_tp3_pp3 -> layer_14_expert_out_sp3_ep7_tp3_pp3
	layer_14_expert_ar_sp3_ep7_pp3 [label="Expert All-Reduce L14 SP3 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep7_tp0_pp3 -> layer_14_expert_ar_sp3_ep7_pp3
	layer_14_expert_out_sp3_ep7_tp1_pp3 -> layer_14_expert_ar_sp3_ep7_pp3
	layer_14_expert_out_sp3_ep7_tp2_pp3 -> layer_14_expert_ar_sp3_ep7_pp3
	layer_14_expert_out_sp3_ep7_tp3_pp3 -> layer_14_expert_ar_sp3_ep7_pp3
	layer_14_combine_sp3_ep7_pp3 [label="Token Combine L14 SP3 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep7_pp3 -> layer_14_combine_sp3_ep7_pp3
	layer_14_dispatch_sp3_ep8_pp3 [label="Token Dispatch L14 SP3 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep8_pp3 [style=dashed]
	layer_14_expert_sp3_ep8_tp0_pp3 [label="Expert L14 SP3 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep8_pp3 -> layer_14_expert_sp3_ep8_tp0_pp3
	layer_14_expert_out_sp3_ep8_tp0_pp3 [label="Expert Out L14 SP3 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep8_tp0_pp3 -> layer_14_expert_out_sp3_ep8_tp0_pp3
	layer_14_expert_sp3_ep8_tp1_pp3 [label="Expert L14 SP3 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep8_pp3 -> layer_14_expert_sp3_ep8_tp1_pp3
	layer_14_expert_out_sp3_ep8_tp1_pp3 [label="Expert Out L14 SP3 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep8_tp1_pp3 -> layer_14_expert_out_sp3_ep8_tp1_pp3
	layer_14_expert_sp3_ep8_tp2_pp3 [label="Expert L14 SP3 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep8_pp3 -> layer_14_expert_sp3_ep8_tp2_pp3
	layer_14_expert_out_sp3_ep8_tp2_pp3 [label="Expert Out L14 SP3 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep8_tp2_pp3 -> layer_14_expert_out_sp3_ep8_tp2_pp3
	layer_14_expert_sp3_ep8_tp3_pp3 [label="Expert L14 SP3 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep8_pp3 -> layer_14_expert_sp3_ep8_tp3_pp3
	layer_14_expert_out_sp3_ep8_tp3_pp3 [label="Expert Out L14 SP3 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep8_tp3_pp3 -> layer_14_expert_out_sp3_ep8_tp3_pp3
	layer_14_expert_ar_sp3_ep8_pp3 [label="Expert All-Reduce L14 SP3 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep8_tp0_pp3 -> layer_14_expert_ar_sp3_ep8_pp3
	layer_14_expert_out_sp3_ep8_tp1_pp3 -> layer_14_expert_ar_sp3_ep8_pp3
	layer_14_expert_out_sp3_ep8_tp2_pp3 -> layer_14_expert_ar_sp3_ep8_pp3
	layer_14_expert_out_sp3_ep8_tp3_pp3 -> layer_14_expert_ar_sp3_ep8_pp3
	layer_14_combine_sp3_ep8_pp3 [label="Token Combine L14 SP3 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep8_pp3 -> layer_14_combine_sp3_ep8_pp3
	layer_14_dispatch_sp3_ep9_pp3 [label="Token Dispatch L14 SP3 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep9_pp3 [style=dashed]
	layer_14_expert_sp3_ep9_tp0_pp3 [label="Expert L14 SP3 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep9_pp3 -> layer_14_expert_sp3_ep9_tp0_pp3
	layer_14_expert_out_sp3_ep9_tp0_pp3 [label="Expert Out L14 SP3 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep9_tp0_pp3 -> layer_14_expert_out_sp3_ep9_tp0_pp3
	layer_14_expert_sp3_ep9_tp1_pp3 [label="Expert L14 SP3 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep9_pp3 -> layer_14_expert_sp3_ep9_tp1_pp3
	layer_14_expert_out_sp3_ep9_tp1_pp3 [label="Expert Out L14 SP3 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep9_tp1_pp3 -> layer_14_expert_out_sp3_ep9_tp1_pp3
	layer_14_expert_sp3_ep9_tp2_pp3 [label="Expert L14 SP3 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep9_pp3 -> layer_14_expert_sp3_ep9_tp2_pp3
	layer_14_expert_out_sp3_ep9_tp2_pp3 [label="Expert Out L14 SP3 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep9_tp2_pp3 -> layer_14_expert_out_sp3_ep9_tp2_pp3
	layer_14_expert_sp3_ep9_tp3_pp3 [label="Expert L14 SP3 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep9_pp3 -> layer_14_expert_sp3_ep9_tp3_pp3
	layer_14_expert_out_sp3_ep9_tp3_pp3 [label="Expert Out L14 SP3 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep9_tp3_pp3 -> layer_14_expert_out_sp3_ep9_tp3_pp3
	layer_14_expert_ar_sp3_ep9_pp3 [label="Expert All-Reduce L14 SP3 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep9_tp0_pp3 -> layer_14_expert_ar_sp3_ep9_pp3
	layer_14_expert_out_sp3_ep9_tp1_pp3 -> layer_14_expert_ar_sp3_ep9_pp3
	layer_14_expert_out_sp3_ep9_tp2_pp3 -> layer_14_expert_ar_sp3_ep9_pp3
	layer_14_expert_out_sp3_ep9_tp3_pp3 -> layer_14_expert_ar_sp3_ep9_pp3
	layer_14_combine_sp3_ep9_pp3 [label="Token Combine L14 SP3 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep9_pp3 -> layer_14_combine_sp3_ep9_pp3
	layer_14_dispatch_sp3_ep10_pp3 [label="Token Dispatch L14 SP3 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep10_pp3 [style=dashed]
	layer_14_expert_sp3_ep10_tp0_pp3 [label="Expert L14 SP3 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep10_pp3 -> layer_14_expert_sp3_ep10_tp0_pp3
	layer_14_expert_out_sp3_ep10_tp0_pp3 [label="Expert Out L14 SP3 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep10_tp0_pp3 -> layer_14_expert_out_sp3_ep10_tp0_pp3
	layer_14_expert_sp3_ep10_tp1_pp3 [label="Expert L14 SP3 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep10_pp3 -> layer_14_expert_sp3_ep10_tp1_pp3
	layer_14_expert_out_sp3_ep10_tp1_pp3 [label="Expert Out L14 SP3 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep10_tp1_pp3 -> layer_14_expert_out_sp3_ep10_tp1_pp3
	layer_14_expert_sp3_ep10_tp2_pp3 [label="Expert L14 SP3 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep10_pp3 -> layer_14_expert_sp3_ep10_tp2_pp3
	layer_14_expert_out_sp3_ep10_tp2_pp3 [label="Expert Out L14 SP3 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep10_tp2_pp3 -> layer_14_expert_out_sp3_ep10_tp2_pp3
	layer_14_expert_sp3_ep10_tp3_pp3 [label="Expert L14 SP3 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep10_pp3 -> layer_14_expert_sp3_ep10_tp3_pp3
	layer_14_expert_out_sp3_ep10_tp3_pp3 [label="Expert Out L14 SP3 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep10_tp3_pp3 -> layer_14_expert_out_sp3_ep10_tp3_pp3
	layer_14_expert_ar_sp3_ep10_pp3 [label="Expert All-Reduce L14 SP3 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep10_tp0_pp3 -> layer_14_expert_ar_sp3_ep10_pp3
	layer_14_expert_out_sp3_ep10_tp1_pp3 -> layer_14_expert_ar_sp3_ep10_pp3
	layer_14_expert_out_sp3_ep10_tp2_pp3 -> layer_14_expert_ar_sp3_ep10_pp3
	layer_14_expert_out_sp3_ep10_tp3_pp3 -> layer_14_expert_ar_sp3_ep10_pp3
	layer_14_combine_sp3_ep10_pp3 [label="Token Combine L14 SP3 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep10_pp3 -> layer_14_combine_sp3_ep10_pp3
	layer_14_dispatch_sp3_ep11_pp3 [label="Token Dispatch L14 SP3 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep11_pp3 [style=dashed]
	layer_14_expert_sp3_ep11_tp0_pp3 [label="Expert L14 SP3 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep11_pp3 -> layer_14_expert_sp3_ep11_tp0_pp3
	layer_14_expert_out_sp3_ep11_tp0_pp3 [label="Expert Out L14 SP3 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep11_tp0_pp3 -> layer_14_expert_out_sp3_ep11_tp0_pp3
	layer_14_expert_sp3_ep11_tp1_pp3 [label="Expert L14 SP3 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep11_pp3 -> layer_14_expert_sp3_ep11_tp1_pp3
	layer_14_expert_out_sp3_ep11_tp1_pp3 [label="Expert Out L14 SP3 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep11_tp1_pp3 -> layer_14_expert_out_sp3_ep11_tp1_pp3
	layer_14_expert_sp3_ep11_tp2_pp3 [label="Expert L14 SP3 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep11_pp3 -> layer_14_expert_sp3_ep11_tp2_pp3
	layer_14_expert_out_sp3_ep11_tp2_pp3 [label="Expert Out L14 SP3 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep11_tp2_pp3 -> layer_14_expert_out_sp3_ep11_tp2_pp3
	layer_14_expert_sp3_ep11_tp3_pp3 [label="Expert L14 SP3 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep11_pp3 -> layer_14_expert_sp3_ep11_tp3_pp3
	layer_14_expert_out_sp3_ep11_tp3_pp3 [label="Expert Out L14 SP3 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep11_tp3_pp3 -> layer_14_expert_out_sp3_ep11_tp3_pp3
	layer_14_expert_ar_sp3_ep11_pp3 [label="Expert All-Reduce L14 SP3 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep11_tp0_pp3 -> layer_14_expert_ar_sp3_ep11_pp3
	layer_14_expert_out_sp3_ep11_tp1_pp3 -> layer_14_expert_ar_sp3_ep11_pp3
	layer_14_expert_out_sp3_ep11_tp2_pp3 -> layer_14_expert_ar_sp3_ep11_pp3
	layer_14_expert_out_sp3_ep11_tp3_pp3 -> layer_14_expert_ar_sp3_ep11_pp3
	layer_14_combine_sp3_ep11_pp3 [label="Token Combine L14 SP3 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep11_pp3 -> layer_14_combine_sp3_ep11_pp3
	layer_14_dispatch_sp3_ep12_pp3 [label="Token Dispatch L14 SP3 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep12_pp3 [style=dashed]
	layer_14_expert_sp3_ep12_tp0_pp3 [label="Expert L14 SP3 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep12_pp3 -> layer_14_expert_sp3_ep12_tp0_pp3
	layer_14_expert_out_sp3_ep12_tp0_pp3 [label="Expert Out L14 SP3 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep12_tp0_pp3 -> layer_14_expert_out_sp3_ep12_tp0_pp3
	layer_14_expert_sp3_ep12_tp1_pp3 [label="Expert L14 SP3 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep12_pp3 -> layer_14_expert_sp3_ep12_tp1_pp3
	layer_14_expert_out_sp3_ep12_tp1_pp3 [label="Expert Out L14 SP3 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep12_tp1_pp3 -> layer_14_expert_out_sp3_ep12_tp1_pp3
	layer_14_expert_sp3_ep12_tp2_pp3 [label="Expert L14 SP3 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep12_pp3 -> layer_14_expert_sp3_ep12_tp2_pp3
	layer_14_expert_out_sp3_ep12_tp2_pp3 [label="Expert Out L14 SP3 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep12_tp2_pp3 -> layer_14_expert_out_sp3_ep12_tp2_pp3
	layer_14_expert_sp3_ep12_tp3_pp3 [label="Expert L14 SP3 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep12_pp3 -> layer_14_expert_sp3_ep12_tp3_pp3
	layer_14_expert_out_sp3_ep12_tp3_pp3 [label="Expert Out L14 SP3 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep12_tp3_pp3 -> layer_14_expert_out_sp3_ep12_tp3_pp3
	layer_14_expert_ar_sp3_ep12_pp3 [label="Expert All-Reduce L14 SP3 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep12_tp0_pp3 -> layer_14_expert_ar_sp3_ep12_pp3
	layer_14_expert_out_sp3_ep12_tp1_pp3 -> layer_14_expert_ar_sp3_ep12_pp3
	layer_14_expert_out_sp3_ep12_tp2_pp3 -> layer_14_expert_ar_sp3_ep12_pp3
	layer_14_expert_out_sp3_ep12_tp3_pp3 -> layer_14_expert_ar_sp3_ep12_pp3
	layer_14_combine_sp3_ep12_pp3 [label="Token Combine L14 SP3 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep12_pp3 -> layer_14_combine_sp3_ep12_pp3
	layer_14_dispatch_sp3_ep13_pp3 [label="Token Dispatch L14 SP3 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep13_pp3 [style=dashed]
	layer_14_expert_sp3_ep13_tp0_pp3 [label="Expert L14 SP3 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep13_pp3 -> layer_14_expert_sp3_ep13_tp0_pp3
	layer_14_expert_out_sp3_ep13_tp0_pp3 [label="Expert Out L14 SP3 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep13_tp0_pp3 -> layer_14_expert_out_sp3_ep13_tp0_pp3
	layer_14_expert_sp3_ep13_tp1_pp3 [label="Expert L14 SP3 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep13_pp3 -> layer_14_expert_sp3_ep13_tp1_pp3
	layer_14_expert_out_sp3_ep13_tp1_pp3 [label="Expert Out L14 SP3 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep13_tp1_pp3 -> layer_14_expert_out_sp3_ep13_tp1_pp3
	layer_14_expert_sp3_ep13_tp2_pp3 [label="Expert L14 SP3 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep13_pp3 -> layer_14_expert_sp3_ep13_tp2_pp3
	layer_14_expert_out_sp3_ep13_tp2_pp3 [label="Expert Out L14 SP3 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep13_tp2_pp3 -> layer_14_expert_out_sp3_ep13_tp2_pp3
	layer_14_expert_sp3_ep13_tp3_pp3 [label="Expert L14 SP3 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep13_pp3 -> layer_14_expert_sp3_ep13_tp3_pp3
	layer_14_expert_out_sp3_ep13_tp3_pp3 [label="Expert Out L14 SP3 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep13_tp3_pp3 -> layer_14_expert_out_sp3_ep13_tp3_pp3
	layer_14_expert_ar_sp3_ep13_pp3 [label="Expert All-Reduce L14 SP3 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep13_tp0_pp3 -> layer_14_expert_ar_sp3_ep13_pp3
	layer_14_expert_out_sp3_ep13_tp1_pp3 -> layer_14_expert_ar_sp3_ep13_pp3
	layer_14_expert_out_sp3_ep13_tp2_pp3 -> layer_14_expert_ar_sp3_ep13_pp3
	layer_14_expert_out_sp3_ep13_tp3_pp3 -> layer_14_expert_ar_sp3_ep13_pp3
	layer_14_combine_sp3_ep13_pp3 [label="Token Combine L14 SP3 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep13_pp3 -> layer_14_combine_sp3_ep13_pp3
	layer_14_dispatch_sp3_ep14_pp3 [label="Token Dispatch L14 SP3 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep14_pp3 [style=dashed]
	layer_14_expert_sp3_ep14_tp0_pp3 [label="Expert L14 SP3 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep14_pp3 -> layer_14_expert_sp3_ep14_tp0_pp3
	layer_14_expert_out_sp3_ep14_tp0_pp3 [label="Expert Out L14 SP3 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep14_tp0_pp3 -> layer_14_expert_out_sp3_ep14_tp0_pp3
	layer_14_expert_sp3_ep14_tp1_pp3 [label="Expert L14 SP3 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep14_pp3 -> layer_14_expert_sp3_ep14_tp1_pp3
	layer_14_expert_out_sp3_ep14_tp1_pp3 [label="Expert Out L14 SP3 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep14_tp1_pp3 -> layer_14_expert_out_sp3_ep14_tp1_pp3
	layer_14_expert_sp3_ep14_tp2_pp3 [label="Expert L14 SP3 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep14_pp3 -> layer_14_expert_sp3_ep14_tp2_pp3
	layer_14_expert_out_sp3_ep14_tp2_pp3 [label="Expert Out L14 SP3 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep14_tp2_pp3 -> layer_14_expert_out_sp3_ep14_tp2_pp3
	layer_14_expert_sp3_ep14_tp3_pp3 [label="Expert L14 SP3 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep14_pp3 -> layer_14_expert_sp3_ep14_tp3_pp3
	layer_14_expert_out_sp3_ep14_tp3_pp3 [label="Expert Out L14 SP3 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep14_tp3_pp3 -> layer_14_expert_out_sp3_ep14_tp3_pp3
	layer_14_expert_ar_sp3_ep14_pp3 [label="Expert All-Reduce L14 SP3 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep14_tp0_pp3 -> layer_14_expert_ar_sp3_ep14_pp3
	layer_14_expert_out_sp3_ep14_tp1_pp3 -> layer_14_expert_ar_sp3_ep14_pp3
	layer_14_expert_out_sp3_ep14_tp2_pp3 -> layer_14_expert_ar_sp3_ep14_pp3
	layer_14_expert_out_sp3_ep14_tp3_pp3 -> layer_14_expert_ar_sp3_ep14_pp3
	layer_14_combine_sp3_ep14_pp3 [label="Token Combine L14 SP3 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep14_pp3 -> layer_14_combine_sp3_ep14_pp3
	layer_14_dispatch_sp3_ep15_pp3 [label="Token Dispatch L14 SP3 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_14_router_sp3_pp3 -> layer_14_dispatch_sp3_ep15_pp3 [style=dashed]
	layer_14_expert_sp3_ep15_tp0_pp3 [label="Expert L14 SP3 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep15_pp3 -> layer_14_expert_sp3_ep15_tp0_pp3
	layer_14_expert_out_sp3_ep15_tp0_pp3 [label="Expert Out L14 SP3 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep15_tp0_pp3 -> layer_14_expert_out_sp3_ep15_tp0_pp3
	layer_14_expert_sp3_ep15_tp1_pp3 [label="Expert L14 SP3 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep15_pp3 -> layer_14_expert_sp3_ep15_tp1_pp3
	layer_14_expert_out_sp3_ep15_tp1_pp3 [label="Expert Out L14 SP3 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep15_tp1_pp3 -> layer_14_expert_out_sp3_ep15_tp1_pp3
	layer_14_expert_sp3_ep15_tp2_pp3 [label="Expert L14 SP3 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep15_pp3 -> layer_14_expert_sp3_ep15_tp2_pp3
	layer_14_expert_out_sp3_ep15_tp2_pp3 [label="Expert Out L14 SP3 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep15_tp2_pp3 -> layer_14_expert_out_sp3_ep15_tp2_pp3
	layer_14_expert_sp3_ep15_tp3_pp3 [label="Expert L14 SP3 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_dispatch_sp3_ep15_pp3 -> layer_14_expert_sp3_ep15_tp3_pp3
	layer_14_expert_out_sp3_ep15_tp3_pp3 [label="Expert Out L14 SP3 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_14_expert_sp3_ep15_tp3_pp3 -> layer_14_expert_out_sp3_ep15_tp3_pp3
	layer_14_expert_ar_sp3_ep15_pp3 [label="Expert All-Reduce L14 SP3 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_14_expert_out_sp3_ep15_tp0_pp3 -> layer_14_expert_ar_sp3_ep15_pp3
	layer_14_expert_out_sp3_ep15_tp1_pp3 -> layer_14_expert_ar_sp3_ep15_pp3
	layer_14_expert_out_sp3_ep15_tp2_pp3 -> layer_14_expert_ar_sp3_ep15_pp3
	layer_14_expert_out_sp3_ep15_tp3_pp3 -> layer_14_expert_ar_sp3_ep15_pp3
	layer_14_combine_sp3_ep15_pp3 [label="Token Combine L14 SP3 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_14_expert_ar_sp3_ep15_pp3 -> layer_14_combine_sp3_ep15_pp3
	layer_14_moe_all2all_sp3_pp3 [label="MoE All-to-All L14 SP3\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_14_combine_sp3_ep0_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep1_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep2_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep3_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep4_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep5_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep6_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep7_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep8_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep9_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep10_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep11_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep12_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep13_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep14_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_combine_sp3_ep15_pp3 -> layer_14_moe_all2all_sp3_pp3
	layer_14_mlp_out_sp3_pp3 [label="MoE Output L14 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_moe_all2all_sp3_pp3 -> layer_14_mlp_out_sp3_pp3
	layer_14_mlp_res_sp3_pp3 [label="MLP Residual L14 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_mlp_out_sp3_pp3 -> layer_14_mlp_res_sp3_pp3
	layer_14_attn_res_sp3_pp3 -> layer_14_mlp_res_sp3_pp3 [style=dashed]
	layer_15_norm_sp0_pp3 [label="LayerNorm L15 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_mlp_out_sp0_pp3 -> layer_15_norm_sp0_pp3
	layer_15_qkv_sp0_tp0_pp3 [label="QKV Proj L15 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp0_pp3 -> layer_15_qkv_sp0_tp0_pp3
	layer_15_attn_sp0_tp0_pp3 [label="Attention L15 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp0_tp0_pp3 -> layer_15_attn_sp0_tp0_pp3
	layer_15_attn_out_sp0_tp0_pp3 [label="Attn Out Proj L15 SP0 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp0_tp0_pp3 -> layer_15_attn_out_sp0_tp0_pp3
	layer_15_qkv_sp0_tp1_pp3 [label="QKV Proj L15 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp0_pp3 -> layer_15_qkv_sp0_tp1_pp3
	layer_15_attn_sp0_tp1_pp3 [label="Attention L15 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp0_tp1_pp3 -> layer_15_attn_sp0_tp1_pp3
	layer_15_attn_out_sp0_tp1_pp3 [label="Attn Out Proj L15 SP0 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp0_tp1_pp3 -> layer_15_attn_out_sp0_tp1_pp3
	layer_15_qkv_sp0_tp2_pp3 [label="QKV Proj L15 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp0_pp3 -> layer_15_qkv_sp0_tp2_pp3
	layer_15_attn_sp0_tp2_pp3 [label="Attention L15 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp0_tp2_pp3 -> layer_15_attn_sp0_tp2_pp3
	layer_15_attn_out_sp0_tp2_pp3 [label="Attn Out Proj L15 SP0 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp0_tp2_pp3 -> layer_15_attn_out_sp0_tp2_pp3
	layer_15_qkv_sp0_tp3_pp3 [label="QKV Proj L15 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp0_pp3 -> layer_15_qkv_sp0_tp3_pp3
	layer_15_attn_sp0_tp3_pp3 [label="Attention L15 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp0_tp3_pp3 -> layer_15_attn_sp0_tp3_pp3
	layer_15_attn_out_sp0_tp3_pp3 [label="Attn Out Proj L15 SP0 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp0_tp3_pp3 -> layer_15_attn_out_sp0_tp3_pp3
	layer_15_attn_ar_sp0_pp3 [label="Attention All-Reduce L15 SP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_attn_out_sp0_tp0_pp3 -> layer_15_attn_ar_sp0_pp3
	layer_15_attn_out_sp0_tp1_pp3 -> layer_15_attn_ar_sp0_pp3
	layer_15_attn_out_sp0_tp2_pp3 -> layer_15_attn_ar_sp0_pp3
	layer_15_attn_out_sp0_tp3_pp3 -> layer_15_attn_ar_sp0_pp3
	layer_15_attn_res_sp0_pp3 [label="Attention Residual L15 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_attn_ar_sp0_pp3 -> layer_15_attn_res_sp0_pp3
	layer_15_norm_sp0_pp3 -> layer_15_attn_res_sp0_pp3 [style=dashed]
	layer_15_post_norm_sp0_pp3 [label="Post-Attn Norm L15 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_attn_res_sp0_pp3 -> layer_15_post_norm_sp0_pp3
	layer_15_router_sp0_pp3 [label="MoE Router L15 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_15_post_norm_sp0_pp3 -> layer_15_router_sp0_pp3
	layer_15_dispatch_sp0_ep0_pp3 [label="Token Dispatch L15 SP0 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep0_pp3 [style=dashed]
	layer_15_expert_sp0_ep0_tp0_pp3 [label="Expert L15 SP0 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep0_pp3 -> layer_15_expert_sp0_ep0_tp0_pp3
	layer_15_expert_out_sp0_ep0_tp0_pp3 [label="Expert Out L15 SP0 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep0_tp0_pp3 -> layer_15_expert_out_sp0_ep0_tp0_pp3
	layer_15_expert_sp0_ep0_tp1_pp3 [label="Expert L15 SP0 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep0_pp3 -> layer_15_expert_sp0_ep0_tp1_pp3
	layer_15_expert_out_sp0_ep0_tp1_pp3 [label="Expert Out L15 SP0 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep0_tp1_pp3 -> layer_15_expert_out_sp0_ep0_tp1_pp3
	layer_15_expert_sp0_ep0_tp2_pp3 [label="Expert L15 SP0 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep0_pp3 -> layer_15_expert_sp0_ep0_tp2_pp3
	layer_15_expert_out_sp0_ep0_tp2_pp3 [label="Expert Out L15 SP0 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep0_tp2_pp3 -> layer_15_expert_out_sp0_ep0_tp2_pp3
	layer_15_expert_sp0_ep0_tp3_pp3 [label="Expert L15 SP0 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep0_pp3 -> layer_15_expert_sp0_ep0_tp3_pp3
	layer_15_expert_out_sp0_ep0_tp3_pp3 [label="Expert Out L15 SP0 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep0_tp3_pp3 -> layer_15_expert_out_sp0_ep0_tp3_pp3
	layer_15_expert_ar_sp0_ep0_pp3 [label="Expert All-Reduce L15 SP0 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep0_tp0_pp3 -> layer_15_expert_ar_sp0_ep0_pp3
	layer_15_expert_out_sp0_ep0_tp1_pp3 -> layer_15_expert_ar_sp0_ep0_pp3
	layer_15_expert_out_sp0_ep0_tp2_pp3 -> layer_15_expert_ar_sp0_ep0_pp3
	layer_15_expert_out_sp0_ep0_tp3_pp3 -> layer_15_expert_ar_sp0_ep0_pp3
	layer_15_combine_sp0_ep0_pp3 [label="Token Combine L15 SP0 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep0_pp3 -> layer_15_combine_sp0_ep0_pp3
	layer_15_dispatch_sp0_ep1_pp3 [label="Token Dispatch L15 SP0 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep1_pp3 [style=dashed]
	layer_15_expert_sp0_ep1_tp0_pp3 [label="Expert L15 SP0 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep1_pp3 -> layer_15_expert_sp0_ep1_tp0_pp3
	layer_15_expert_out_sp0_ep1_tp0_pp3 [label="Expert Out L15 SP0 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep1_tp0_pp3 -> layer_15_expert_out_sp0_ep1_tp0_pp3
	layer_15_expert_sp0_ep1_tp1_pp3 [label="Expert L15 SP0 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep1_pp3 -> layer_15_expert_sp0_ep1_tp1_pp3
	layer_15_expert_out_sp0_ep1_tp1_pp3 [label="Expert Out L15 SP0 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep1_tp1_pp3 -> layer_15_expert_out_sp0_ep1_tp1_pp3
	layer_15_expert_sp0_ep1_tp2_pp3 [label="Expert L15 SP0 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep1_pp3 -> layer_15_expert_sp0_ep1_tp2_pp3
	layer_15_expert_out_sp0_ep1_tp2_pp3 [label="Expert Out L15 SP0 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep1_tp2_pp3 -> layer_15_expert_out_sp0_ep1_tp2_pp3
	layer_15_expert_sp0_ep1_tp3_pp3 [label="Expert L15 SP0 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep1_pp3 -> layer_15_expert_sp0_ep1_tp3_pp3
	layer_15_expert_out_sp0_ep1_tp3_pp3 [label="Expert Out L15 SP0 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep1_tp3_pp3 -> layer_15_expert_out_sp0_ep1_tp3_pp3
	layer_15_expert_ar_sp0_ep1_pp3 [label="Expert All-Reduce L15 SP0 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep1_tp0_pp3 -> layer_15_expert_ar_sp0_ep1_pp3
	layer_15_expert_out_sp0_ep1_tp1_pp3 -> layer_15_expert_ar_sp0_ep1_pp3
	layer_15_expert_out_sp0_ep1_tp2_pp3 -> layer_15_expert_ar_sp0_ep1_pp3
	layer_15_expert_out_sp0_ep1_tp3_pp3 -> layer_15_expert_ar_sp0_ep1_pp3
	layer_15_combine_sp0_ep1_pp3 [label="Token Combine L15 SP0 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep1_pp3 -> layer_15_combine_sp0_ep1_pp3
	layer_15_dispatch_sp0_ep2_pp3 [label="Token Dispatch L15 SP0 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep2_pp3 [style=dashed]
	layer_15_expert_sp0_ep2_tp0_pp3 [label="Expert L15 SP0 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep2_pp3 -> layer_15_expert_sp0_ep2_tp0_pp3
	layer_15_expert_out_sp0_ep2_tp0_pp3 [label="Expert Out L15 SP0 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep2_tp0_pp3 -> layer_15_expert_out_sp0_ep2_tp0_pp3
	layer_15_expert_sp0_ep2_tp1_pp3 [label="Expert L15 SP0 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep2_pp3 -> layer_15_expert_sp0_ep2_tp1_pp3
	layer_15_expert_out_sp0_ep2_tp1_pp3 [label="Expert Out L15 SP0 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep2_tp1_pp3 -> layer_15_expert_out_sp0_ep2_tp1_pp3
	layer_15_expert_sp0_ep2_tp2_pp3 [label="Expert L15 SP0 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep2_pp3 -> layer_15_expert_sp0_ep2_tp2_pp3
	layer_15_expert_out_sp0_ep2_tp2_pp3 [label="Expert Out L15 SP0 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep2_tp2_pp3 -> layer_15_expert_out_sp0_ep2_tp2_pp3
	layer_15_expert_sp0_ep2_tp3_pp3 [label="Expert L15 SP0 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep2_pp3 -> layer_15_expert_sp0_ep2_tp3_pp3
	layer_15_expert_out_sp0_ep2_tp3_pp3 [label="Expert Out L15 SP0 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep2_tp3_pp3 -> layer_15_expert_out_sp0_ep2_tp3_pp3
	layer_15_expert_ar_sp0_ep2_pp3 [label="Expert All-Reduce L15 SP0 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep2_tp0_pp3 -> layer_15_expert_ar_sp0_ep2_pp3
	layer_15_expert_out_sp0_ep2_tp1_pp3 -> layer_15_expert_ar_sp0_ep2_pp3
	layer_15_expert_out_sp0_ep2_tp2_pp3 -> layer_15_expert_ar_sp0_ep2_pp3
	layer_15_expert_out_sp0_ep2_tp3_pp3 -> layer_15_expert_ar_sp0_ep2_pp3
	layer_15_combine_sp0_ep2_pp3 [label="Token Combine L15 SP0 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep2_pp3 -> layer_15_combine_sp0_ep2_pp3
	layer_15_dispatch_sp0_ep3_pp3 [label="Token Dispatch L15 SP0 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep3_pp3 [style=dashed]
	layer_15_expert_sp0_ep3_tp0_pp3 [label="Expert L15 SP0 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep3_pp3 -> layer_15_expert_sp0_ep3_tp0_pp3
	layer_15_expert_out_sp0_ep3_tp0_pp3 [label="Expert Out L15 SP0 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep3_tp0_pp3 -> layer_15_expert_out_sp0_ep3_tp0_pp3
	layer_15_expert_sp0_ep3_tp1_pp3 [label="Expert L15 SP0 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep3_pp3 -> layer_15_expert_sp0_ep3_tp1_pp3
	layer_15_expert_out_sp0_ep3_tp1_pp3 [label="Expert Out L15 SP0 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep3_tp1_pp3 -> layer_15_expert_out_sp0_ep3_tp1_pp3
	layer_15_expert_sp0_ep3_tp2_pp3 [label="Expert L15 SP0 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep3_pp3 -> layer_15_expert_sp0_ep3_tp2_pp3
	layer_15_expert_out_sp0_ep3_tp2_pp3 [label="Expert Out L15 SP0 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep3_tp2_pp3 -> layer_15_expert_out_sp0_ep3_tp2_pp3
	layer_15_expert_sp0_ep3_tp3_pp3 [label="Expert L15 SP0 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep3_pp3 -> layer_15_expert_sp0_ep3_tp3_pp3
	layer_15_expert_out_sp0_ep3_tp3_pp3 [label="Expert Out L15 SP0 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep3_tp3_pp3 -> layer_15_expert_out_sp0_ep3_tp3_pp3
	layer_15_expert_ar_sp0_ep3_pp3 [label="Expert All-Reduce L15 SP0 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep3_tp0_pp3 -> layer_15_expert_ar_sp0_ep3_pp3
	layer_15_expert_out_sp0_ep3_tp1_pp3 -> layer_15_expert_ar_sp0_ep3_pp3
	layer_15_expert_out_sp0_ep3_tp2_pp3 -> layer_15_expert_ar_sp0_ep3_pp3
	layer_15_expert_out_sp0_ep3_tp3_pp3 -> layer_15_expert_ar_sp0_ep3_pp3
	layer_15_combine_sp0_ep3_pp3 [label="Token Combine L15 SP0 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep3_pp3 -> layer_15_combine_sp0_ep3_pp3
	layer_15_dispatch_sp0_ep4_pp3 [label="Token Dispatch L15 SP0 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep4_pp3 [style=dashed]
	layer_15_expert_sp0_ep4_tp0_pp3 [label="Expert L15 SP0 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep4_pp3 -> layer_15_expert_sp0_ep4_tp0_pp3
	layer_15_expert_out_sp0_ep4_tp0_pp3 [label="Expert Out L15 SP0 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep4_tp0_pp3 -> layer_15_expert_out_sp0_ep4_tp0_pp3
	layer_15_expert_sp0_ep4_tp1_pp3 [label="Expert L15 SP0 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep4_pp3 -> layer_15_expert_sp0_ep4_tp1_pp3
	layer_15_expert_out_sp0_ep4_tp1_pp3 [label="Expert Out L15 SP0 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep4_tp1_pp3 -> layer_15_expert_out_sp0_ep4_tp1_pp3
	layer_15_expert_sp0_ep4_tp2_pp3 [label="Expert L15 SP0 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep4_pp3 -> layer_15_expert_sp0_ep4_tp2_pp3
	layer_15_expert_out_sp0_ep4_tp2_pp3 [label="Expert Out L15 SP0 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep4_tp2_pp3 -> layer_15_expert_out_sp0_ep4_tp2_pp3
	layer_15_expert_sp0_ep4_tp3_pp3 [label="Expert L15 SP0 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep4_pp3 -> layer_15_expert_sp0_ep4_tp3_pp3
	layer_15_expert_out_sp0_ep4_tp3_pp3 [label="Expert Out L15 SP0 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep4_tp3_pp3 -> layer_15_expert_out_sp0_ep4_tp3_pp3
	layer_15_expert_ar_sp0_ep4_pp3 [label="Expert All-Reduce L15 SP0 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep4_tp0_pp3 -> layer_15_expert_ar_sp0_ep4_pp3
	layer_15_expert_out_sp0_ep4_tp1_pp3 -> layer_15_expert_ar_sp0_ep4_pp3
	layer_15_expert_out_sp0_ep4_tp2_pp3 -> layer_15_expert_ar_sp0_ep4_pp3
	layer_15_expert_out_sp0_ep4_tp3_pp3 -> layer_15_expert_ar_sp0_ep4_pp3
	layer_15_combine_sp0_ep4_pp3 [label="Token Combine L15 SP0 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep4_pp3 -> layer_15_combine_sp0_ep4_pp3
	layer_15_dispatch_sp0_ep5_pp3 [label="Token Dispatch L15 SP0 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep5_pp3 [style=dashed]
	layer_15_expert_sp0_ep5_tp0_pp3 [label="Expert L15 SP0 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep5_pp3 -> layer_15_expert_sp0_ep5_tp0_pp3
	layer_15_expert_out_sp0_ep5_tp0_pp3 [label="Expert Out L15 SP0 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep5_tp0_pp3 -> layer_15_expert_out_sp0_ep5_tp0_pp3
	layer_15_expert_sp0_ep5_tp1_pp3 [label="Expert L15 SP0 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep5_pp3 -> layer_15_expert_sp0_ep5_tp1_pp3
	layer_15_expert_out_sp0_ep5_tp1_pp3 [label="Expert Out L15 SP0 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep5_tp1_pp3 -> layer_15_expert_out_sp0_ep5_tp1_pp3
	layer_15_expert_sp0_ep5_tp2_pp3 [label="Expert L15 SP0 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep5_pp3 -> layer_15_expert_sp0_ep5_tp2_pp3
	layer_15_expert_out_sp0_ep5_tp2_pp3 [label="Expert Out L15 SP0 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep5_tp2_pp3 -> layer_15_expert_out_sp0_ep5_tp2_pp3
	layer_15_expert_sp0_ep5_tp3_pp3 [label="Expert L15 SP0 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep5_pp3 -> layer_15_expert_sp0_ep5_tp3_pp3
	layer_15_expert_out_sp0_ep5_tp3_pp3 [label="Expert Out L15 SP0 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep5_tp3_pp3 -> layer_15_expert_out_sp0_ep5_tp3_pp3
	layer_15_expert_ar_sp0_ep5_pp3 [label="Expert All-Reduce L15 SP0 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep5_tp0_pp3 -> layer_15_expert_ar_sp0_ep5_pp3
	layer_15_expert_out_sp0_ep5_tp1_pp3 -> layer_15_expert_ar_sp0_ep5_pp3
	layer_15_expert_out_sp0_ep5_tp2_pp3 -> layer_15_expert_ar_sp0_ep5_pp3
	layer_15_expert_out_sp0_ep5_tp3_pp3 -> layer_15_expert_ar_sp0_ep5_pp3
	layer_15_combine_sp0_ep5_pp3 [label="Token Combine L15 SP0 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep5_pp3 -> layer_15_combine_sp0_ep5_pp3
	layer_15_dispatch_sp0_ep6_pp3 [label="Token Dispatch L15 SP0 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep6_pp3 [style=dashed]
	layer_15_expert_sp0_ep6_tp0_pp3 [label="Expert L15 SP0 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep6_pp3 -> layer_15_expert_sp0_ep6_tp0_pp3
	layer_15_expert_out_sp0_ep6_tp0_pp3 [label="Expert Out L15 SP0 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep6_tp0_pp3 -> layer_15_expert_out_sp0_ep6_tp0_pp3
	layer_15_expert_sp0_ep6_tp1_pp3 [label="Expert L15 SP0 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep6_pp3 -> layer_15_expert_sp0_ep6_tp1_pp3
	layer_15_expert_out_sp0_ep6_tp1_pp3 [label="Expert Out L15 SP0 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep6_tp1_pp3 -> layer_15_expert_out_sp0_ep6_tp1_pp3
	layer_15_expert_sp0_ep6_tp2_pp3 [label="Expert L15 SP0 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep6_pp3 -> layer_15_expert_sp0_ep6_tp2_pp3
	layer_15_expert_out_sp0_ep6_tp2_pp3 [label="Expert Out L15 SP0 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep6_tp2_pp3 -> layer_15_expert_out_sp0_ep6_tp2_pp3
	layer_15_expert_sp0_ep6_tp3_pp3 [label="Expert L15 SP0 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep6_pp3 -> layer_15_expert_sp0_ep6_tp3_pp3
	layer_15_expert_out_sp0_ep6_tp3_pp3 [label="Expert Out L15 SP0 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep6_tp3_pp3 -> layer_15_expert_out_sp0_ep6_tp3_pp3
	layer_15_expert_ar_sp0_ep6_pp3 [label="Expert All-Reduce L15 SP0 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep6_tp0_pp3 -> layer_15_expert_ar_sp0_ep6_pp3
	layer_15_expert_out_sp0_ep6_tp1_pp3 -> layer_15_expert_ar_sp0_ep6_pp3
	layer_15_expert_out_sp0_ep6_tp2_pp3 -> layer_15_expert_ar_sp0_ep6_pp3
	layer_15_expert_out_sp0_ep6_tp3_pp3 -> layer_15_expert_ar_sp0_ep6_pp3
	layer_15_combine_sp0_ep6_pp3 [label="Token Combine L15 SP0 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep6_pp3 -> layer_15_combine_sp0_ep6_pp3
	layer_15_dispatch_sp0_ep7_pp3 [label="Token Dispatch L15 SP0 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep7_pp3 [style=dashed]
	layer_15_expert_sp0_ep7_tp0_pp3 [label="Expert L15 SP0 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep7_pp3 -> layer_15_expert_sp0_ep7_tp0_pp3
	layer_15_expert_out_sp0_ep7_tp0_pp3 [label="Expert Out L15 SP0 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep7_tp0_pp3 -> layer_15_expert_out_sp0_ep7_tp0_pp3
	layer_15_expert_sp0_ep7_tp1_pp3 [label="Expert L15 SP0 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep7_pp3 -> layer_15_expert_sp0_ep7_tp1_pp3
	layer_15_expert_out_sp0_ep7_tp1_pp3 [label="Expert Out L15 SP0 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep7_tp1_pp3 -> layer_15_expert_out_sp0_ep7_tp1_pp3
	layer_15_expert_sp0_ep7_tp2_pp3 [label="Expert L15 SP0 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep7_pp3 -> layer_15_expert_sp0_ep7_tp2_pp3
	layer_15_expert_out_sp0_ep7_tp2_pp3 [label="Expert Out L15 SP0 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep7_tp2_pp3 -> layer_15_expert_out_sp0_ep7_tp2_pp3
	layer_15_expert_sp0_ep7_tp3_pp3 [label="Expert L15 SP0 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep7_pp3 -> layer_15_expert_sp0_ep7_tp3_pp3
	layer_15_expert_out_sp0_ep7_tp3_pp3 [label="Expert Out L15 SP0 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep7_tp3_pp3 -> layer_15_expert_out_sp0_ep7_tp3_pp3
	layer_15_expert_ar_sp0_ep7_pp3 [label="Expert All-Reduce L15 SP0 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep7_tp0_pp3 -> layer_15_expert_ar_sp0_ep7_pp3
	layer_15_expert_out_sp0_ep7_tp1_pp3 -> layer_15_expert_ar_sp0_ep7_pp3
	layer_15_expert_out_sp0_ep7_tp2_pp3 -> layer_15_expert_ar_sp0_ep7_pp3
	layer_15_expert_out_sp0_ep7_tp3_pp3 -> layer_15_expert_ar_sp0_ep7_pp3
	layer_15_combine_sp0_ep7_pp3 [label="Token Combine L15 SP0 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep7_pp3 -> layer_15_combine_sp0_ep7_pp3
	layer_15_dispatch_sp0_ep8_pp3 [label="Token Dispatch L15 SP0 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep8_pp3 [style=dashed]
	layer_15_expert_sp0_ep8_tp0_pp3 [label="Expert L15 SP0 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep8_pp3 -> layer_15_expert_sp0_ep8_tp0_pp3
	layer_15_expert_out_sp0_ep8_tp0_pp3 [label="Expert Out L15 SP0 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep8_tp0_pp3 -> layer_15_expert_out_sp0_ep8_tp0_pp3
	layer_15_expert_sp0_ep8_tp1_pp3 [label="Expert L15 SP0 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep8_pp3 -> layer_15_expert_sp0_ep8_tp1_pp3
	layer_15_expert_out_sp0_ep8_tp1_pp3 [label="Expert Out L15 SP0 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep8_tp1_pp3 -> layer_15_expert_out_sp0_ep8_tp1_pp3
	layer_15_expert_sp0_ep8_tp2_pp3 [label="Expert L15 SP0 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep8_pp3 -> layer_15_expert_sp0_ep8_tp2_pp3
	layer_15_expert_out_sp0_ep8_tp2_pp3 [label="Expert Out L15 SP0 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep8_tp2_pp3 -> layer_15_expert_out_sp0_ep8_tp2_pp3
	layer_15_expert_sp0_ep8_tp3_pp3 [label="Expert L15 SP0 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep8_pp3 -> layer_15_expert_sp0_ep8_tp3_pp3
	layer_15_expert_out_sp0_ep8_tp3_pp3 [label="Expert Out L15 SP0 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep8_tp3_pp3 -> layer_15_expert_out_sp0_ep8_tp3_pp3
	layer_15_expert_ar_sp0_ep8_pp3 [label="Expert All-Reduce L15 SP0 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep8_tp0_pp3 -> layer_15_expert_ar_sp0_ep8_pp3
	layer_15_expert_out_sp0_ep8_tp1_pp3 -> layer_15_expert_ar_sp0_ep8_pp3
	layer_15_expert_out_sp0_ep8_tp2_pp3 -> layer_15_expert_ar_sp0_ep8_pp3
	layer_15_expert_out_sp0_ep8_tp3_pp3 -> layer_15_expert_ar_sp0_ep8_pp3
	layer_15_combine_sp0_ep8_pp3 [label="Token Combine L15 SP0 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep8_pp3 -> layer_15_combine_sp0_ep8_pp3
	layer_15_dispatch_sp0_ep9_pp3 [label="Token Dispatch L15 SP0 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep9_pp3 [style=dashed]
	layer_15_expert_sp0_ep9_tp0_pp3 [label="Expert L15 SP0 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep9_pp3 -> layer_15_expert_sp0_ep9_tp0_pp3
	layer_15_expert_out_sp0_ep9_tp0_pp3 [label="Expert Out L15 SP0 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep9_tp0_pp3 -> layer_15_expert_out_sp0_ep9_tp0_pp3
	layer_15_expert_sp0_ep9_tp1_pp3 [label="Expert L15 SP0 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep9_pp3 -> layer_15_expert_sp0_ep9_tp1_pp3
	layer_15_expert_out_sp0_ep9_tp1_pp3 [label="Expert Out L15 SP0 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep9_tp1_pp3 -> layer_15_expert_out_sp0_ep9_tp1_pp3
	layer_15_expert_sp0_ep9_tp2_pp3 [label="Expert L15 SP0 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep9_pp3 -> layer_15_expert_sp0_ep9_tp2_pp3
	layer_15_expert_out_sp0_ep9_tp2_pp3 [label="Expert Out L15 SP0 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep9_tp2_pp3 -> layer_15_expert_out_sp0_ep9_tp2_pp3
	layer_15_expert_sp0_ep9_tp3_pp3 [label="Expert L15 SP0 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep9_pp3 -> layer_15_expert_sp0_ep9_tp3_pp3
	layer_15_expert_out_sp0_ep9_tp3_pp3 [label="Expert Out L15 SP0 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep9_tp3_pp3 -> layer_15_expert_out_sp0_ep9_tp3_pp3
	layer_15_expert_ar_sp0_ep9_pp3 [label="Expert All-Reduce L15 SP0 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep9_tp0_pp3 -> layer_15_expert_ar_sp0_ep9_pp3
	layer_15_expert_out_sp0_ep9_tp1_pp3 -> layer_15_expert_ar_sp0_ep9_pp3
	layer_15_expert_out_sp0_ep9_tp2_pp3 -> layer_15_expert_ar_sp0_ep9_pp3
	layer_15_expert_out_sp0_ep9_tp3_pp3 -> layer_15_expert_ar_sp0_ep9_pp3
	layer_15_combine_sp0_ep9_pp3 [label="Token Combine L15 SP0 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep9_pp3 -> layer_15_combine_sp0_ep9_pp3
	layer_15_dispatch_sp0_ep10_pp3 [label="Token Dispatch L15 SP0 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep10_pp3 [style=dashed]
	layer_15_expert_sp0_ep10_tp0_pp3 [label="Expert L15 SP0 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep10_pp3 -> layer_15_expert_sp0_ep10_tp0_pp3
	layer_15_expert_out_sp0_ep10_tp0_pp3 [label="Expert Out L15 SP0 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep10_tp0_pp3 -> layer_15_expert_out_sp0_ep10_tp0_pp3
	layer_15_expert_sp0_ep10_tp1_pp3 [label="Expert L15 SP0 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep10_pp3 -> layer_15_expert_sp0_ep10_tp1_pp3
	layer_15_expert_out_sp0_ep10_tp1_pp3 [label="Expert Out L15 SP0 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep10_tp1_pp3 -> layer_15_expert_out_sp0_ep10_tp1_pp3
	layer_15_expert_sp0_ep10_tp2_pp3 [label="Expert L15 SP0 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep10_pp3 -> layer_15_expert_sp0_ep10_tp2_pp3
	layer_15_expert_out_sp0_ep10_tp2_pp3 [label="Expert Out L15 SP0 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep10_tp2_pp3 -> layer_15_expert_out_sp0_ep10_tp2_pp3
	layer_15_expert_sp0_ep10_tp3_pp3 [label="Expert L15 SP0 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep10_pp3 -> layer_15_expert_sp0_ep10_tp3_pp3
	layer_15_expert_out_sp0_ep10_tp3_pp3 [label="Expert Out L15 SP0 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep10_tp3_pp3 -> layer_15_expert_out_sp0_ep10_tp3_pp3
	layer_15_expert_ar_sp0_ep10_pp3 [label="Expert All-Reduce L15 SP0 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep10_tp0_pp3 -> layer_15_expert_ar_sp0_ep10_pp3
	layer_15_expert_out_sp0_ep10_tp1_pp3 -> layer_15_expert_ar_sp0_ep10_pp3
	layer_15_expert_out_sp0_ep10_tp2_pp3 -> layer_15_expert_ar_sp0_ep10_pp3
	layer_15_expert_out_sp0_ep10_tp3_pp3 -> layer_15_expert_ar_sp0_ep10_pp3
	layer_15_combine_sp0_ep10_pp3 [label="Token Combine L15 SP0 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep10_pp3 -> layer_15_combine_sp0_ep10_pp3
	layer_15_dispatch_sp0_ep11_pp3 [label="Token Dispatch L15 SP0 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep11_pp3 [style=dashed]
	layer_15_expert_sp0_ep11_tp0_pp3 [label="Expert L15 SP0 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep11_pp3 -> layer_15_expert_sp0_ep11_tp0_pp3
	layer_15_expert_out_sp0_ep11_tp0_pp3 [label="Expert Out L15 SP0 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep11_tp0_pp3 -> layer_15_expert_out_sp0_ep11_tp0_pp3
	layer_15_expert_sp0_ep11_tp1_pp3 [label="Expert L15 SP0 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep11_pp3 -> layer_15_expert_sp0_ep11_tp1_pp3
	layer_15_expert_out_sp0_ep11_tp1_pp3 [label="Expert Out L15 SP0 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep11_tp1_pp3 -> layer_15_expert_out_sp0_ep11_tp1_pp3
	layer_15_expert_sp0_ep11_tp2_pp3 [label="Expert L15 SP0 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep11_pp3 -> layer_15_expert_sp0_ep11_tp2_pp3
	layer_15_expert_out_sp0_ep11_tp2_pp3 [label="Expert Out L15 SP0 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep11_tp2_pp3 -> layer_15_expert_out_sp0_ep11_tp2_pp3
	layer_15_expert_sp0_ep11_tp3_pp3 [label="Expert L15 SP0 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep11_pp3 -> layer_15_expert_sp0_ep11_tp3_pp3
	layer_15_expert_out_sp0_ep11_tp3_pp3 [label="Expert Out L15 SP0 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep11_tp3_pp3 -> layer_15_expert_out_sp0_ep11_tp3_pp3
	layer_15_expert_ar_sp0_ep11_pp3 [label="Expert All-Reduce L15 SP0 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep11_tp0_pp3 -> layer_15_expert_ar_sp0_ep11_pp3
	layer_15_expert_out_sp0_ep11_tp1_pp3 -> layer_15_expert_ar_sp0_ep11_pp3
	layer_15_expert_out_sp0_ep11_tp2_pp3 -> layer_15_expert_ar_sp0_ep11_pp3
	layer_15_expert_out_sp0_ep11_tp3_pp3 -> layer_15_expert_ar_sp0_ep11_pp3
	layer_15_combine_sp0_ep11_pp3 [label="Token Combine L15 SP0 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep11_pp3 -> layer_15_combine_sp0_ep11_pp3
	layer_15_dispatch_sp0_ep12_pp3 [label="Token Dispatch L15 SP0 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep12_pp3 [style=dashed]
	layer_15_expert_sp0_ep12_tp0_pp3 [label="Expert L15 SP0 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep12_pp3 -> layer_15_expert_sp0_ep12_tp0_pp3
	layer_15_expert_out_sp0_ep12_tp0_pp3 [label="Expert Out L15 SP0 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep12_tp0_pp3 -> layer_15_expert_out_sp0_ep12_tp0_pp3
	layer_15_expert_sp0_ep12_tp1_pp3 [label="Expert L15 SP0 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep12_pp3 -> layer_15_expert_sp0_ep12_tp1_pp3
	layer_15_expert_out_sp0_ep12_tp1_pp3 [label="Expert Out L15 SP0 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep12_tp1_pp3 -> layer_15_expert_out_sp0_ep12_tp1_pp3
	layer_15_expert_sp0_ep12_tp2_pp3 [label="Expert L15 SP0 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep12_pp3 -> layer_15_expert_sp0_ep12_tp2_pp3
	layer_15_expert_out_sp0_ep12_tp2_pp3 [label="Expert Out L15 SP0 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep12_tp2_pp3 -> layer_15_expert_out_sp0_ep12_tp2_pp3
	layer_15_expert_sp0_ep12_tp3_pp3 [label="Expert L15 SP0 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep12_pp3 -> layer_15_expert_sp0_ep12_tp3_pp3
	layer_15_expert_out_sp0_ep12_tp3_pp3 [label="Expert Out L15 SP0 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep12_tp3_pp3 -> layer_15_expert_out_sp0_ep12_tp3_pp3
	layer_15_expert_ar_sp0_ep12_pp3 [label="Expert All-Reduce L15 SP0 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep12_tp0_pp3 -> layer_15_expert_ar_sp0_ep12_pp3
	layer_15_expert_out_sp0_ep12_tp1_pp3 -> layer_15_expert_ar_sp0_ep12_pp3
	layer_15_expert_out_sp0_ep12_tp2_pp3 -> layer_15_expert_ar_sp0_ep12_pp3
	layer_15_expert_out_sp0_ep12_tp3_pp3 -> layer_15_expert_ar_sp0_ep12_pp3
	layer_15_combine_sp0_ep12_pp3 [label="Token Combine L15 SP0 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep12_pp3 -> layer_15_combine_sp0_ep12_pp3
	layer_15_dispatch_sp0_ep13_pp3 [label="Token Dispatch L15 SP0 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep13_pp3 [style=dashed]
	layer_15_expert_sp0_ep13_tp0_pp3 [label="Expert L15 SP0 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep13_pp3 -> layer_15_expert_sp0_ep13_tp0_pp3
	layer_15_expert_out_sp0_ep13_tp0_pp3 [label="Expert Out L15 SP0 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep13_tp0_pp3 -> layer_15_expert_out_sp0_ep13_tp0_pp3
	layer_15_expert_sp0_ep13_tp1_pp3 [label="Expert L15 SP0 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep13_pp3 -> layer_15_expert_sp0_ep13_tp1_pp3
	layer_15_expert_out_sp0_ep13_tp1_pp3 [label="Expert Out L15 SP0 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep13_tp1_pp3 -> layer_15_expert_out_sp0_ep13_tp1_pp3
	layer_15_expert_sp0_ep13_tp2_pp3 [label="Expert L15 SP0 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep13_pp3 -> layer_15_expert_sp0_ep13_tp2_pp3
	layer_15_expert_out_sp0_ep13_tp2_pp3 [label="Expert Out L15 SP0 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep13_tp2_pp3 -> layer_15_expert_out_sp0_ep13_tp2_pp3
	layer_15_expert_sp0_ep13_tp3_pp3 [label="Expert L15 SP0 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep13_pp3 -> layer_15_expert_sp0_ep13_tp3_pp3
	layer_15_expert_out_sp0_ep13_tp3_pp3 [label="Expert Out L15 SP0 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep13_tp3_pp3 -> layer_15_expert_out_sp0_ep13_tp3_pp3
	layer_15_expert_ar_sp0_ep13_pp3 [label="Expert All-Reduce L15 SP0 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep13_tp0_pp3 -> layer_15_expert_ar_sp0_ep13_pp3
	layer_15_expert_out_sp0_ep13_tp1_pp3 -> layer_15_expert_ar_sp0_ep13_pp3
	layer_15_expert_out_sp0_ep13_tp2_pp3 -> layer_15_expert_ar_sp0_ep13_pp3
	layer_15_expert_out_sp0_ep13_tp3_pp3 -> layer_15_expert_ar_sp0_ep13_pp3
	layer_15_combine_sp0_ep13_pp3 [label="Token Combine L15 SP0 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep13_pp3 -> layer_15_combine_sp0_ep13_pp3
	layer_15_dispatch_sp0_ep14_pp3 [label="Token Dispatch L15 SP0 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep14_pp3 [style=dashed]
	layer_15_expert_sp0_ep14_tp0_pp3 [label="Expert L15 SP0 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep14_pp3 -> layer_15_expert_sp0_ep14_tp0_pp3
	layer_15_expert_out_sp0_ep14_tp0_pp3 [label="Expert Out L15 SP0 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep14_tp0_pp3 -> layer_15_expert_out_sp0_ep14_tp0_pp3
	layer_15_expert_sp0_ep14_tp1_pp3 [label="Expert L15 SP0 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep14_pp3 -> layer_15_expert_sp0_ep14_tp1_pp3
	layer_15_expert_out_sp0_ep14_tp1_pp3 [label="Expert Out L15 SP0 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep14_tp1_pp3 -> layer_15_expert_out_sp0_ep14_tp1_pp3
	layer_15_expert_sp0_ep14_tp2_pp3 [label="Expert L15 SP0 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep14_pp3 -> layer_15_expert_sp0_ep14_tp2_pp3
	layer_15_expert_out_sp0_ep14_tp2_pp3 [label="Expert Out L15 SP0 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep14_tp2_pp3 -> layer_15_expert_out_sp0_ep14_tp2_pp3
	layer_15_expert_sp0_ep14_tp3_pp3 [label="Expert L15 SP0 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep14_pp3 -> layer_15_expert_sp0_ep14_tp3_pp3
	layer_15_expert_out_sp0_ep14_tp3_pp3 [label="Expert Out L15 SP0 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep14_tp3_pp3 -> layer_15_expert_out_sp0_ep14_tp3_pp3
	layer_15_expert_ar_sp0_ep14_pp3 [label="Expert All-Reduce L15 SP0 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep14_tp0_pp3 -> layer_15_expert_ar_sp0_ep14_pp3
	layer_15_expert_out_sp0_ep14_tp1_pp3 -> layer_15_expert_ar_sp0_ep14_pp3
	layer_15_expert_out_sp0_ep14_tp2_pp3 -> layer_15_expert_ar_sp0_ep14_pp3
	layer_15_expert_out_sp0_ep14_tp3_pp3 -> layer_15_expert_ar_sp0_ep14_pp3
	layer_15_combine_sp0_ep14_pp3 [label="Token Combine L15 SP0 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep14_pp3 -> layer_15_combine_sp0_ep14_pp3
	layer_15_dispatch_sp0_ep15_pp3 [label="Token Dispatch L15 SP0 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp0_pp3 -> layer_15_dispatch_sp0_ep15_pp3 [style=dashed]
	layer_15_expert_sp0_ep15_tp0_pp3 [label="Expert L15 SP0 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep15_pp3 -> layer_15_expert_sp0_ep15_tp0_pp3
	layer_15_expert_out_sp0_ep15_tp0_pp3 [label="Expert Out L15 SP0 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep15_tp0_pp3 -> layer_15_expert_out_sp0_ep15_tp0_pp3
	layer_15_expert_sp0_ep15_tp1_pp3 [label="Expert L15 SP0 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep15_pp3 -> layer_15_expert_sp0_ep15_tp1_pp3
	layer_15_expert_out_sp0_ep15_tp1_pp3 [label="Expert Out L15 SP0 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep15_tp1_pp3 -> layer_15_expert_out_sp0_ep15_tp1_pp3
	layer_15_expert_sp0_ep15_tp2_pp3 [label="Expert L15 SP0 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep15_pp3 -> layer_15_expert_sp0_ep15_tp2_pp3
	layer_15_expert_out_sp0_ep15_tp2_pp3 [label="Expert Out L15 SP0 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep15_tp2_pp3 -> layer_15_expert_out_sp0_ep15_tp2_pp3
	layer_15_expert_sp0_ep15_tp3_pp3 [label="Expert L15 SP0 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp0_ep15_pp3 -> layer_15_expert_sp0_ep15_tp3_pp3
	layer_15_expert_out_sp0_ep15_tp3_pp3 [label="Expert Out L15 SP0 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp0_ep15_tp3_pp3 -> layer_15_expert_out_sp0_ep15_tp3_pp3
	layer_15_expert_ar_sp0_ep15_pp3 [label="Expert All-Reduce L15 SP0 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp0_ep15_tp0_pp3 -> layer_15_expert_ar_sp0_ep15_pp3
	layer_15_expert_out_sp0_ep15_tp1_pp3 -> layer_15_expert_ar_sp0_ep15_pp3
	layer_15_expert_out_sp0_ep15_tp2_pp3 -> layer_15_expert_ar_sp0_ep15_pp3
	layer_15_expert_out_sp0_ep15_tp3_pp3 -> layer_15_expert_ar_sp0_ep15_pp3
	layer_15_combine_sp0_ep15_pp3 [label="Token Combine L15 SP0 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp0_ep15_pp3 -> layer_15_combine_sp0_ep15_pp3
	layer_15_moe_all2all_sp0_pp3 [label="MoE All-to-All L15 SP0\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_15_combine_sp0_ep0_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep1_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep2_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep3_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep4_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep5_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep6_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep7_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep8_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep9_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep10_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep11_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep12_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep13_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep14_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_combine_sp0_ep15_pp3 -> layer_15_moe_all2all_sp0_pp3
	layer_15_mlp_out_sp0_pp3 [label="MoE Output L15 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_moe_all2all_sp0_pp3 -> layer_15_mlp_out_sp0_pp3
	layer_15_mlp_res_sp0_pp3 [label="MLP Residual L15 SP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_mlp_out_sp0_pp3 -> layer_15_mlp_res_sp0_pp3
	layer_15_attn_res_sp0_pp3 -> layer_15_mlp_res_sp0_pp3 [style=dashed]
	layer_15_norm_sp1_pp3 [label="LayerNorm L15 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_mlp_out_sp1_pp3 -> layer_15_norm_sp1_pp3
	layer_15_qkv_sp1_tp0_pp3 [label="QKV Proj L15 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp1_pp3 -> layer_15_qkv_sp1_tp0_pp3
	layer_15_attn_sp1_tp0_pp3 [label="Attention L15 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp1_tp0_pp3 -> layer_15_attn_sp1_tp0_pp3
	layer_15_attn_out_sp1_tp0_pp3 [label="Attn Out Proj L15 SP1 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp1_tp0_pp3 -> layer_15_attn_out_sp1_tp0_pp3
	layer_15_qkv_sp1_tp1_pp3 [label="QKV Proj L15 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp1_pp3 -> layer_15_qkv_sp1_tp1_pp3
	layer_15_attn_sp1_tp1_pp3 [label="Attention L15 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp1_tp1_pp3 -> layer_15_attn_sp1_tp1_pp3
	layer_15_attn_out_sp1_tp1_pp3 [label="Attn Out Proj L15 SP1 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp1_tp1_pp3 -> layer_15_attn_out_sp1_tp1_pp3
	layer_15_qkv_sp1_tp2_pp3 [label="QKV Proj L15 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp1_pp3 -> layer_15_qkv_sp1_tp2_pp3
	layer_15_attn_sp1_tp2_pp3 [label="Attention L15 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp1_tp2_pp3 -> layer_15_attn_sp1_tp2_pp3
	layer_15_attn_out_sp1_tp2_pp3 [label="Attn Out Proj L15 SP1 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp1_tp2_pp3 -> layer_15_attn_out_sp1_tp2_pp3
	layer_15_qkv_sp1_tp3_pp3 [label="QKV Proj L15 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp1_pp3 -> layer_15_qkv_sp1_tp3_pp3
	layer_15_attn_sp1_tp3_pp3 [label="Attention L15 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp1_tp3_pp3 -> layer_15_attn_sp1_tp3_pp3
	layer_15_attn_out_sp1_tp3_pp3 [label="Attn Out Proj L15 SP1 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp1_tp3_pp3 -> layer_15_attn_out_sp1_tp3_pp3
	layer_15_attn_ar_sp1_pp3 [label="Attention All-Reduce L15 SP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_attn_out_sp1_tp0_pp3 -> layer_15_attn_ar_sp1_pp3
	layer_15_attn_out_sp1_tp1_pp3 -> layer_15_attn_ar_sp1_pp3
	layer_15_attn_out_sp1_tp2_pp3 -> layer_15_attn_ar_sp1_pp3
	layer_15_attn_out_sp1_tp3_pp3 -> layer_15_attn_ar_sp1_pp3
	layer_15_attn_res_sp1_pp3 [label="Attention Residual L15 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_attn_ar_sp1_pp3 -> layer_15_attn_res_sp1_pp3
	layer_15_norm_sp1_pp3 -> layer_15_attn_res_sp1_pp3 [style=dashed]
	layer_15_post_norm_sp1_pp3 [label="Post-Attn Norm L15 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_attn_res_sp1_pp3 -> layer_15_post_norm_sp1_pp3
	layer_15_router_sp1_pp3 [label="MoE Router L15 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_15_post_norm_sp1_pp3 -> layer_15_router_sp1_pp3
	layer_15_dispatch_sp1_ep0_pp3 [label="Token Dispatch L15 SP1 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep0_pp3 [style=dashed]
	layer_15_expert_sp1_ep0_tp0_pp3 [label="Expert L15 SP1 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep0_pp3 -> layer_15_expert_sp1_ep0_tp0_pp3
	layer_15_expert_out_sp1_ep0_tp0_pp3 [label="Expert Out L15 SP1 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep0_tp0_pp3 -> layer_15_expert_out_sp1_ep0_tp0_pp3
	layer_15_expert_sp1_ep0_tp1_pp3 [label="Expert L15 SP1 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep0_pp3 -> layer_15_expert_sp1_ep0_tp1_pp3
	layer_15_expert_out_sp1_ep0_tp1_pp3 [label="Expert Out L15 SP1 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep0_tp1_pp3 -> layer_15_expert_out_sp1_ep0_tp1_pp3
	layer_15_expert_sp1_ep0_tp2_pp3 [label="Expert L15 SP1 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep0_pp3 -> layer_15_expert_sp1_ep0_tp2_pp3
	layer_15_expert_out_sp1_ep0_tp2_pp3 [label="Expert Out L15 SP1 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep0_tp2_pp3 -> layer_15_expert_out_sp1_ep0_tp2_pp3
	layer_15_expert_sp1_ep0_tp3_pp3 [label="Expert L15 SP1 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep0_pp3 -> layer_15_expert_sp1_ep0_tp3_pp3
	layer_15_expert_out_sp1_ep0_tp3_pp3 [label="Expert Out L15 SP1 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep0_tp3_pp3 -> layer_15_expert_out_sp1_ep0_tp3_pp3
	layer_15_expert_ar_sp1_ep0_pp3 [label="Expert All-Reduce L15 SP1 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep0_tp0_pp3 -> layer_15_expert_ar_sp1_ep0_pp3
	layer_15_expert_out_sp1_ep0_tp1_pp3 -> layer_15_expert_ar_sp1_ep0_pp3
	layer_15_expert_out_sp1_ep0_tp2_pp3 -> layer_15_expert_ar_sp1_ep0_pp3
	layer_15_expert_out_sp1_ep0_tp3_pp3 -> layer_15_expert_ar_sp1_ep0_pp3
	layer_15_combine_sp1_ep0_pp3 [label="Token Combine L15 SP1 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep0_pp3 -> layer_15_combine_sp1_ep0_pp3
	layer_15_dispatch_sp1_ep1_pp3 [label="Token Dispatch L15 SP1 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep1_pp3 [style=dashed]
	layer_15_expert_sp1_ep1_tp0_pp3 [label="Expert L15 SP1 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep1_pp3 -> layer_15_expert_sp1_ep1_tp0_pp3
	layer_15_expert_out_sp1_ep1_tp0_pp3 [label="Expert Out L15 SP1 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep1_tp0_pp3 -> layer_15_expert_out_sp1_ep1_tp0_pp3
	layer_15_expert_sp1_ep1_tp1_pp3 [label="Expert L15 SP1 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep1_pp3 -> layer_15_expert_sp1_ep1_tp1_pp3
	layer_15_expert_out_sp1_ep1_tp1_pp3 [label="Expert Out L15 SP1 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep1_tp1_pp3 -> layer_15_expert_out_sp1_ep1_tp1_pp3
	layer_15_expert_sp1_ep1_tp2_pp3 [label="Expert L15 SP1 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep1_pp3 -> layer_15_expert_sp1_ep1_tp2_pp3
	layer_15_expert_out_sp1_ep1_tp2_pp3 [label="Expert Out L15 SP1 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep1_tp2_pp3 -> layer_15_expert_out_sp1_ep1_tp2_pp3
	layer_15_expert_sp1_ep1_tp3_pp3 [label="Expert L15 SP1 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep1_pp3 -> layer_15_expert_sp1_ep1_tp3_pp3
	layer_15_expert_out_sp1_ep1_tp3_pp3 [label="Expert Out L15 SP1 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep1_tp3_pp3 -> layer_15_expert_out_sp1_ep1_tp3_pp3
	layer_15_expert_ar_sp1_ep1_pp3 [label="Expert All-Reduce L15 SP1 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep1_tp0_pp3 -> layer_15_expert_ar_sp1_ep1_pp3
	layer_15_expert_out_sp1_ep1_tp1_pp3 -> layer_15_expert_ar_sp1_ep1_pp3
	layer_15_expert_out_sp1_ep1_tp2_pp3 -> layer_15_expert_ar_sp1_ep1_pp3
	layer_15_expert_out_sp1_ep1_tp3_pp3 -> layer_15_expert_ar_sp1_ep1_pp3
	layer_15_combine_sp1_ep1_pp3 [label="Token Combine L15 SP1 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep1_pp3 -> layer_15_combine_sp1_ep1_pp3
	layer_15_dispatch_sp1_ep2_pp3 [label="Token Dispatch L15 SP1 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep2_pp3 [style=dashed]
	layer_15_expert_sp1_ep2_tp0_pp3 [label="Expert L15 SP1 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep2_pp3 -> layer_15_expert_sp1_ep2_tp0_pp3
	layer_15_expert_out_sp1_ep2_tp0_pp3 [label="Expert Out L15 SP1 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep2_tp0_pp3 -> layer_15_expert_out_sp1_ep2_tp0_pp3
	layer_15_expert_sp1_ep2_tp1_pp3 [label="Expert L15 SP1 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep2_pp3 -> layer_15_expert_sp1_ep2_tp1_pp3
	layer_15_expert_out_sp1_ep2_tp1_pp3 [label="Expert Out L15 SP1 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep2_tp1_pp3 -> layer_15_expert_out_sp1_ep2_tp1_pp3
	layer_15_expert_sp1_ep2_tp2_pp3 [label="Expert L15 SP1 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep2_pp3 -> layer_15_expert_sp1_ep2_tp2_pp3
	layer_15_expert_out_sp1_ep2_tp2_pp3 [label="Expert Out L15 SP1 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep2_tp2_pp3 -> layer_15_expert_out_sp1_ep2_tp2_pp3
	layer_15_expert_sp1_ep2_tp3_pp3 [label="Expert L15 SP1 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep2_pp3 -> layer_15_expert_sp1_ep2_tp3_pp3
	layer_15_expert_out_sp1_ep2_tp3_pp3 [label="Expert Out L15 SP1 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep2_tp3_pp3 -> layer_15_expert_out_sp1_ep2_tp3_pp3
	layer_15_expert_ar_sp1_ep2_pp3 [label="Expert All-Reduce L15 SP1 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep2_tp0_pp3 -> layer_15_expert_ar_sp1_ep2_pp3
	layer_15_expert_out_sp1_ep2_tp1_pp3 -> layer_15_expert_ar_sp1_ep2_pp3
	layer_15_expert_out_sp1_ep2_tp2_pp3 -> layer_15_expert_ar_sp1_ep2_pp3
	layer_15_expert_out_sp1_ep2_tp3_pp3 -> layer_15_expert_ar_sp1_ep2_pp3
	layer_15_combine_sp1_ep2_pp3 [label="Token Combine L15 SP1 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep2_pp3 -> layer_15_combine_sp1_ep2_pp3
	layer_15_dispatch_sp1_ep3_pp3 [label="Token Dispatch L15 SP1 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep3_pp3 [style=dashed]
	layer_15_expert_sp1_ep3_tp0_pp3 [label="Expert L15 SP1 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep3_pp3 -> layer_15_expert_sp1_ep3_tp0_pp3
	layer_15_expert_out_sp1_ep3_tp0_pp3 [label="Expert Out L15 SP1 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep3_tp0_pp3 -> layer_15_expert_out_sp1_ep3_tp0_pp3
	layer_15_expert_sp1_ep3_tp1_pp3 [label="Expert L15 SP1 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep3_pp3 -> layer_15_expert_sp1_ep3_tp1_pp3
	layer_15_expert_out_sp1_ep3_tp1_pp3 [label="Expert Out L15 SP1 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep3_tp1_pp3 -> layer_15_expert_out_sp1_ep3_tp1_pp3
	layer_15_expert_sp1_ep3_tp2_pp3 [label="Expert L15 SP1 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep3_pp3 -> layer_15_expert_sp1_ep3_tp2_pp3
	layer_15_expert_out_sp1_ep3_tp2_pp3 [label="Expert Out L15 SP1 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep3_tp2_pp3 -> layer_15_expert_out_sp1_ep3_tp2_pp3
	layer_15_expert_sp1_ep3_tp3_pp3 [label="Expert L15 SP1 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep3_pp3 -> layer_15_expert_sp1_ep3_tp3_pp3
	layer_15_expert_out_sp1_ep3_tp3_pp3 [label="Expert Out L15 SP1 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep3_tp3_pp3 -> layer_15_expert_out_sp1_ep3_tp3_pp3
	layer_15_expert_ar_sp1_ep3_pp3 [label="Expert All-Reduce L15 SP1 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep3_tp0_pp3 -> layer_15_expert_ar_sp1_ep3_pp3
	layer_15_expert_out_sp1_ep3_tp1_pp3 -> layer_15_expert_ar_sp1_ep3_pp3
	layer_15_expert_out_sp1_ep3_tp2_pp3 -> layer_15_expert_ar_sp1_ep3_pp3
	layer_15_expert_out_sp1_ep3_tp3_pp3 -> layer_15_expert_ar_sp1_ep3_pp3
	layer_15_combine_sp1_ep3_pp3 [label="Token Combine L15 SP1 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep3_pp3 -> layer_15_combine_sp1_ep3_pp3
	layer_15_dispatch_sp1_ep4_pp3 [label="Token Dispatch L15 SP1 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep4_pp3 [style=dashed]
	layer_15_expert_sp1_ep4_tp0_pp3 [label="Expert L15 SP1 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep4_pp3 -> layer_15_expert_sp1_ep4_tp0_pp3
	layer_15_expert_out_sp1_ep4_tp0_pp3 [label="Expert Out L15 SP1 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep4_tp0_pp3 -> layer_15_expert_out_sp1_ep4_tp0_pp3
	layer_15_expert_sp1_ep4_tp1_pp3 [label="Expert L15 SP1 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep4_pp3 -> layer_15_expert_sp1_ep4_tp1_pp3
	layer_15_expert_out_sp1_ep4_tp1_pp3 [label="Expert Out L15 SP1 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep4_tp1_pp3 -> layer_15_expert_out_sp1_ep4_tp1_pp3
	layer_15_expert_sp1_ep4_tp2_pp3 [label="Expert L15 SP1 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep4_pp3 -> layer_15_expert_sp1_ep4_tp2_pp3
	layer_15_expert_out_sp1_ep4_tp2_pp3 [label="Expert Out L15 SP1 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep4_tp2_pp3 -> layer_15_expert_out_sp1_ep4_tp2_pp3
	layer_15_expert_sp1_ep4_tp3_pp3 [label="Expert L15 SP1 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep4_pp3 -> layer_15_expert_sp1_ep4_tp3_pp3
	layer_15_expert_out_sp1_ep4_tp3_pp3 [label="Expert Out L15 SP1 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep4_tp3_pp3 -> layer_15_expert_out_sp1_ep4_tp3_pp3
	layer_15_expert_ar_sp1_ep4_pp3 [label="Expert All-Reduce L15 SP1 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep4_tp0_pp3 -> layer_15_expert_ar_sp1_ep4_pp3
	layer_15_expert_out_sp1_ep4_tp1_pp3 -> layer_15_expert_ar_sp1_ep4_pp3
	layer_15_expert_out_sp1_ep4_tp2_pp3 -> layer_15_expert_ar_sp1_ep4_pp3
	layer_15_expert_out_sp1_ep4_tp3_pp3 -> layer_15_expert_ar_sp1_ep4_pp3
	layer_15_combine_sp1_ep4_pp3 [label="Token Combine L15 SP1 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep4_pp3 -> layer_15_combine_sp1_ep4_pp3
	layer_15_dispatch_sp1_ep5_pp3 [label="Token Dispatch L15 SP1 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep5_pp3 [style=dashed]
	layer_15_expert_sp1_ep5_tp0_pp3 [label="Expert L15 SP1 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep5_pp3 -> layer_15_expert_sp1_ep5_tp0_pp3
	layer_15_expert_out_sp1_ep5_tp0_pp3 [label="Expert Out L15 SP1 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep5_tp0_pp3 -> layer_15_expert_out_sp1_ep5_tp0_pp3
	layer_15_expert_sp1_ep5_tp1_pp3 [label="Expert L15 SP1 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep5_pp3 -> layer_15_expert_sp1_ep5_tp1_pp3
	layer_15_expert_out_sp1_ep5_tp1_pp3 [label="Expert Out L15 SP1 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep5_tp1_pp3 -> layer_15_expert_out_sp1_ep5_tp1_pp3
	layer_15_expert_sp1_ep5_tp2_pp3 [label="Expert L15 SP1 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep5_pp3 -> layer_15_expert_sp1_ep5_tp2_pp3
	layer_15_expert_out_sp1_ep5_tp2_pp3 [label="Expert Out L15 SP1 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep5_tp2_pp3 -> layer_15_expert_out_sp1_ep5_tp2_pp3
	layer_15_expert_sp1_ep5_tp3_pp3 [label="Expert L15 SP1 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep5_pp3 -> layer_15_expert_sp1_ep5_tp3_pp3
	layer_15_expert_out_sp1_ep5_tp3_pp3 [label="Expert Out L15 SP1 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep5_tp3_pp3 -> layer_15_expert_out_sp1_ep5_tp3_pp3
	layer_15_expert_ar_sp1_ep5_pp3 [label="Expert All-Reduce L15 SP1 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep5_tp0_pp3 -> layer_15_expert_ar_sp1_ep5_pp3
	layer_15_expert_out_sp1_ep5_tp1_pp3 -> layer_15_expert_ar_sp1_ep5_pp3
	layer_15_expert_out_sp1_ep5_tp2_pp3 -> layer_15_expert_ar_sp1_ep5_pp3
	layer_15_expert_out_sp1_ep5_tp3_pp3 -> layer_15_expert_ar_sp1_ep5_pp3
	layer_15_combine_sp1_ep5_pp3 [label="Token Combine L15 SP1 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep5_pp3 -> layer_15_combine_sp1_ep5_pp3
	layer_15_dispatch_sp1_ep6_pp3 [label="Token Dispatch L15 SP1 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep6_pp3 [style=dashed]
	layer_15_expert_sp1_ep6_tp0_pp3 [label="Expert L15 SP1 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep6_pp3 -> layer_15_expert_sp1_ep6_tp0_pp3
	layer_15_expert_out_sp1_ep6_tp0_pp3 [label="Expert Out L15 SP1 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep6_tp0_pp3 -> layer_15_expert_out_sp1_ep6_tp0_pp3
	layer_15_expert_sp1_ep6_tp1_pp3 [label="Expert L15 SP1 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep6_pp3 -> layer_15_expert_sp1_ep6_tp1_pp3
	layer_15_expert_out_sp1_ep6_tp1_pp3 [label="Expert Out L15 SP1 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep6_tp1_pp3 -> layer_15_expert_out_sp1_ep6_tp1_pp3
	layer_15_expert_sp1_ep6_tp2_pp3 [label="Expert L15 SP1 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep6_pp3 -> layer_15_expert_sp1_ep6_tp2_pp3
	layer_15_expert_out_sp1_ep6_tp2_pp3 [label="Expert Out L15 SP1 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep6_tp2_pp3 -> layer_15_expert_out_sp1_ep6_tp2_pp3
	layer_15_expert_sp1_ep6_tp3_pp3 [label="Expert L15 SP1 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep6_pp3 -> layer_15_expert_sp1_ep6_tp3_pp3
	layer_15_expert_out_sp1_ep6_tp3_pp3 [label="Expert Out L15 SP1 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep6_tp3_pp3 -> layer_15_expert_out_sp1_ep6_tp3_pp3
	layer_15_expert_ar_sp1_ep6_pp3 [label="Expert All-Reduce L15 SP1 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep6_tp0_pp3 -> layer_15_expert_ar_sp1_ep6_pp3
	layer_15_expert_out_sp1_ep6_tp1_pp3 -> layer_15_expert_ar_sp1_ep6_pp3
	layer_15_expert_out_sp1_ep6_tp2_pp3 -> layer_15_expert_ar_sp1_ep6_pp3
	layer_15_expert_out_sp1_ep6_tp3_pp3 -> layer_15_expert_ar_sp1_ep6_pp3
	layer_15_combine_sp1_ep6_pp3 [label="Token Combine L15 SP1 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep6_pp3 -> layer_15_combine_sp1_ep6_pp3
	layer_15_dispatch_sp1_ep7_pp3 [label="Token Dispatch L15 SP1 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep7_pp3 [style=dashed]
	layer_15_expert_sp1_ep7_tp0_pp3 [label="Expert L15 SP1 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep7_pp3 -> layer_15_expert_sp1_ep7_tp0_pp3
	layer_15_expert_out_sp1_ep7_tp0_pp3 [label="Expert Out L15 SP1 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep7_tp0_pp3 -> layer_15_expert_out_sp1_ep7_tp0_pp3
	layer_15_expert_sp1_ep7_tp1_pp3 [label="Expert L15 SP1 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep7_pp3 -> layer_15_expert_sp1_ep7_tp1_pp3
	layer_15_expert_out_sp1_ep7_tp1_pp3 [label="Expert Out L15 SP1 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep7_tp1_pp3 -> layer_15_expert_out_sp1_ep7_tp1_pp3
	layer_15_expert_sp1_ep7_tp2_pp3 [label="Expert L15 SP1 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep7_pp3 -> layer_15_expert_sp1_ep7_tp2_pp3
	layer_15_expert_out_sp1_ep7_tp2_pp3 [label="Expert Out L15 SP1 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep7_tp2_pp3 -> layer_15_expert_out_sp1_ep7_tp2_pp3
	layer_15_expert_sp1_ep7_tp3_pp3 [label="Expert L15 SP1 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep7_pp3 -> layer_15_expert_sp1_ep7_tp3_pp3
	layer_15_expert_out_sp1_ep7_tp3_pp3 [label="Expert Out L15 SP1 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep7_tp3_pp3 -> layer_15_expert_out_sp1_ep7_tp3_pp3
	layer_15_expert_ar_sp1_ep7_pp3 [label="Expert All-Reduce L15 SP1 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep7_tp0_pp3 -> layer_15_expert_ar_sp1_ep7_pp3
	layer_15_expert_out_sp1_ep7_tp1_pp3 -> layer_15_expert_ar_sp1_ep7_pp3
	layer_15_expert_out_sp1_ep7_tp2_pp3 -> layer_15_expert_ar_sp1_ep7_pp3
	layer_15_expert_out_sp1_ep7_tp3_pp3 -> layer_15_expert_ar_sp1_ep7_pp3
	layer_15_combine_sp1_ep7_pp3 [label="Token Combine L15 SP1 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep7_pp3 -> layer_15_combine_sp1_ep7_pp3
	layer_15_dispatch_sp1_ep8_pp3 [label="Token Dispatch L15 SP1 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep8_pp3 [style=dashed]
	layer_15_expert_sp1_ep8_tp0_pp3 [label="Expert L15 SP1 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep8_pp3 -> layer_15_expert_sp1_ep8_tp0_pp3
	layer_15_expert_out_sp1_ep8_tp0_pp3 [label="Expert Out L15 SP1 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep8_tp0_pp3 -> layer_15_expert_out_sp1_ep8_tp0_pp3
	layer_15_expert_sp1_ep8_tp1_pp3 [label="Expert L15 SP1 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep8_pp3 -> layer_15_expert_sp1_ep8_tp1_pp3
	layer_15_expert_out_sp1_ep8_tp1_pp3 [label="Expert Out L15 SP1 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep8_tp1_pp3 -> layer_15_expert_out_sp1_ep8_tp1_pp3
	layer_15_expert_sp1_ep8_tp2_pp3 [label="Expert L15 SP1 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep8_pp3 -> layer_15_expert_sp1_ep8_tp2_pp3
	layer_15_expert_out_sp1_ep8_tp2_pp3 [label="Expert Out L15 SP1 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep8_tp2_pp3 -> layer_15_expert_out_sp1_ep8_tp2_pp3
	layer_15_expert_sp1_ep8_tp3_pp3 [label="Expert L15 SP1 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep8_pp3 -> layer_15_expert_sp1_ep8_tp3_pp3
	layer_15_expert_out_sp1_ep8_tp3_pp3 [label="Expert Out L15 SP1 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep8_tp3_pp3 -> layer_15_expert_out_sp1_ep8_tp3_pp3
	layer_15_expert_ar_sp1_ep8_pp3 [label="Expert All-Reduce L15 SP1 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep8_tp0_pp3 -> layer_15_expert_ar_sp1_ep8_pp3
	layer_15_expert_out_sp1_ep8_tp1_pp3 -> layer_15_expert_ar_sp1_ep8_pp3
	layer_15_expert_out_sp1_ep8_tp2_pp3 -> layer_15_expert_ar_sp1_ep8_pp3
	layer_15_expert_out_sp1_ep8_tp3_pp3 -> layer_15_expert_ar_sp1_ep8_pp3
	layer_15_combine_sp1_ep8_pp3 [label="Token Combine L15 SP1 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep8_pp3 -> layer_15_combine_sp1_ep8_pp3
	layer_15_dispatch_sp1_ep9_pp3 [label="Token Dispatch L15 SP1 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep9_pp3 [style=dashed]
	layer_15_expert_sp1_ep9_tp0_pp3 [label="Expert L15 SP1 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep9_pp3 -> layer_15_expert_sp1_ep9_tp0_pp3
	layer_15_expert_out_sp1_ep9_tp0_pp3 [label="Expert Out L15 SP1 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep9_tp0_pp3 -> layer_15_expert_out_sp1_ep9_tp0_pp3
	layer_15_expert_sp1_ep9_tp1_pp3 [label="Expert L15 SP1 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep9_pp3 -> layer_15_expert_sp1_ep9_tp1_pp3
	layer_15_expert_out_sp1_ep9_tp1_pp3 [label="Expert Out L15 SP1 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep9_tp1_pp3 -> layer_15_expert_out_sp1_ep9_tp1_pp3
	layer_15_expert_sp1_ep9_tp2_pp3 [label="Expert L15 SP1 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep9_pp3 -> layer_15_expert_sp1_ep9_tp2_pp3
	layer_15_expert_out_sp1_ep9_tp2_pp3 [label="Expert Out L15 SP1 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep9_tp2_pp3 -> layer_15_expert_out_sp1_ep9_tp2_pp3
	layer_15_expert_sp1_ep9_tp3_pp3 [label="Expert L15 SP1 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep9_pp3 -> layer_15_expert_sp1_ep9_tp3_pp3
	layer_15_expert_out_sp1_ep9_tp3_pp3 [label="Expert Out L15 SP1 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep9_tp3_pp3 -> layer_15_expert_out_sp1_ep9_tp3_pp3
	layer_15_expert_ar_sp1_ep9_pp3 [label="Expert All-Reduce L15 SP1 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep9_tp0_pp3 -> layer_15_expert_ar_sp1_ep9_pp3
	layer_15_expert_out_sp1_ep9_tp1_pp3 -> layer_15_expert_ar_sp1_ep9_pp3
	layer_15_expert_out_sp1_ep9_tp2_pp3 -> layer_15_expert_ar_sp1_ep9_pp3
	layer_15_expert_out_sp1_ep9_tp3_pp3 -> layer_15_expert_ar_sp1_ep9_pp3
	layer_15_combine_sp1_ep9_pp3 [label="Token Combine L15 SP1 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep9_pp3 -> layer_15_combine_sp1_ep9_pp3
	layer_15_dispatch_sp1_ep10_pp3 [label="Token Dispatch L15 SP1 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep10_pp3 [style=dashed]
	layer_15_expert_sp1_ep10_tp0_pp3 [label="Expert L15 SP1 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep10_pp3 -> layer_15_expert_sp1_ep10_tp0_pp3
	layer_15_expert_out_sp1_ep10_tp0_pp3 [label="Expert Out L15 SP1 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep10_tp0_pp3 -> layer_15_expert_out_sp1_ep10_tp0_pp3
	layer_15_expert_sp1_ep10_tp1_pp3 [label="Expert L15 SP1 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep10_pp3 -> layer_15_expert_sp1_ep10_tp1_pp3
	layer_15_expert_out_sp1_ep10_tp1_pp3 [label="Expert Out L15 SP1 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep10_tp1_pp3 -> layer_15_expert_out_sp1_ep10_tp1_pp3
	layer_15_expert_sp1_ep10_tp2_pp3 [label="Expert L15 SP1 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep10_pp3 -> layer_15_expert_sp1_ep10_tp2_pp3
	layer_15_expert_out_sp1_ep10_tp2_pp3 [label="Expert Out L15 SP1 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep10_tp2_pp3 -> layer_15_expert_out_sp1_ep10_tp2_pp3
	layer_15_expert_sp1_ep10_tp3_pp3 [label="Expert L15 SP1 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep10_pp3 -> layer_15_expert_sp1_ep10_tp3_pp3
	layer_15_expert_out_sp1_ep10_tp3_pp3 [label="Expert Out L15 SP1 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep10_tp3_pp3 -> layer_15_expert_out_sp1_ep10_tp3_pp3
	layer_15_expert_ar_sp1_ep10_pp3 [label="Expert All-Reduce L15 SP1 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep10_tp0_pp3 -> layer_15_expert_ar_sp1_ep10_pp3
	layer_15_expert_out_sp1_ep10_tp1_pp3 -> layer_15_expert_ar_sp1_ep10_pp3
	layer_15_expert_out_sp1_ep10_tp2_pp3 -> layer_15_expert_ar_sp1_ep10_pp3
	layer_15_expert_out_sp1_ep10_tp3_pp3 -> layer_15_expert_ar_sp1_ep10_pp3
	layer_15_combine_sp1_ep10_pp3 [label="Token Combine L15 SP1 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep10_pp3 -> layer_15_combine_sp1_ep10_pp3
	layer_15_dispatch_sp1_ep11_pp3 [label="Token Dispatch L15 SP1 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep11_pp3 [style=dashed]
	layer_15_expert_sp1_ep11_tp0_pp3 [label="Expert L15 SP1 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep11_pp3 -> layer_15_expert_sp1_ep11_tp0_pp3
	layer_15_expert_out_sp1_ep11_tp0_pp3 [label="Expert Out L15 SP1 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep11_tp0_pp3 -> layer_15_expert_out_sp1_ep11_tp0_pp3
	layer_15_expert_sp1_ep11_tp1_pp3 [label="Expert L15 SP1 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep11_pp3 -> layer_15_expert_sp1_ep11_tp1_pp3
	layer_15_expert_out_sp1_ep11_tp1_pp3 [label="Expert Out L15 SP1 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep11_tp1_pp3 -> layer_15_expert_out_sp1_ep11_tp1_pp3
	layer_15_expert_sp1_ep11_tp2_pp3 [label="Expert L15 SP1 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep11_pp3 -> layer_15_expert_sp1_ep11_tp2_pp3
	layer_15_expert_out_sp1_ep11_tp2_pp3 [label="Expert Out L15 SP1 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep11_tp2_pp3 -> layer_15_expert_out_sp1_ep11_tp2_pp3
	layer_15_expert_sp1_ep11_tp3_pp3 [label="Expert L15 SP1 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep11_pp3 -> layer_15_expert_sp1_ep11_tp3_pp3
	layer_15_expert_out_sp1_ep11_tp3_pp3 [label="Expert Out L15 SP1 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep11_tp3_pp3 -> layer_15_expert_out_sp1_ep11_tp3_pp3
	layer_15_expert_ar_sp1_ep11_pp3 [label="Expert All-Reduce L15 SP1 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep11_tp0_pp3 -> layer_15_expert_ar_sp1_ep11_pp3
	layer_15_expert_out_sp1_ep11_tp1_pp3 -> layer_15_expert_ar_sp1_ep11_pp3
	layer_15_expert_out_sp1_ep11_tp2_pp3 -> layer_15_expert_ar_sp1_ep11_pp3
	layer_15_expert_out_sp1_ep11_tp3_pp3 -> layer_15_expert_ar_sp1_ep11_pp3
	layer_15_combine_sp1_ep11_pp3 [label="Token Combine L15 SP1 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep11_pp3 -> layer_15_combine_sp1_ep11_pp3
	layer_15_dispatch_sp1_ep12_pp3 [label="Token Dispatch L15 SP1 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep12_pp3 [style=dashed]
	layer_15_expert_sp1_ep12_tp0_pp3 [label="Expert L15 SP1 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep12_pp3 -> layer_15_expert_sp1_ep12_tp0_pp3
	layer_15_expert_out_sp1_ep12_tp0_pp3 [label="Expert Out L15 SP1 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep12_tp0_pp3 -> layer_15_expert_out_sp1_ep12_tp0_pp3
	layer_15_expert_sp1_ep12_tp1_pp3 [label="Expert L15 SP1 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep12_pp3 -> layer_15_expert_sp1_ep12_tp1_pp3
	layer_15_expert_out_sp1_ep12_tp1_pp3 [label="Expert Out L15 SP1 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep12_tp1_pp3 -> layer_15_expert_out_sp1_ep12_tp1_pp3
	layer_15_expert_sp1_ep12_tp2_pp3 [label="Expert L15 SP1 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep12_pp3 -> layer_15_expert_sp1_ep12_tp2_pp3
	layer_15_expert_out_sp1_ep12_tp2_pp3 [label="Expert Out L15 SP1 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep12_tp2_pp3 -> layer_15_expert_out_sp1_ep12_tp2_pp3
	layer_15_expert_sp1_ep12_tp3_pp3 [label="Expert L15 SP1 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep12_pp3 -> layer_15_expert_sp1_ep12_tp3_pp3
	layer_15_expert_out_sp1_ep12_tp3_pp3 [label="Expert Out L15 SP1 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep12_tp3_pp3 -> layer_15_expert_out_sp1_ep12_tp3_pp3
	layer_15_expert_ar_sp1_ep12_pp3 [label="Expert All-Reduce L15 SP1 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep12_tp0_pp3 -> layer_15_expert_ar_sp1_ep12_pp3
	layer_15_expert_out_sp1_ep12_tp1_pp3 -> layer_15_expert_ar_sp1_ep12_pp3
	layer_15_expert_out_sp1_ep12_tp2_pp3 -> layer_15_expert_ar_sp1_ep12_pp3
	layer_15_expert_out_sp1_ep12_tp3_pp3 -> layer_15_expert_ar_sp1_ep12_pp3
	layer_15_combine_sp1_ep12_pp3 [label="Token Combine L15 SP1 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep12_pp3 -> layer_15_combine_sp1_ep12_pp3
	layer_15_dispatch_sp1_ep13_pp3 [label="Token Dispatch L15 SP1 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep13_pp3 [style=dashed]
	layer_15_expert_sp1_ep13_tp0_pp3 [label="Expert L15 SP1 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep13_pp3 -> layer_15_expert_sp1_ep13_tp0_pp3
	layer_15_expert_out_sp1_ep13_tp0_pp3 [label="Expert Out L15 SP1 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep13_tp0_pp3 -> layer_15_expert_out_sp1_ep13_tp0_pp3
	layer_15_expert_sp1_ep13_tp1_pp3 [label="Expert L15 SP1 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep13_pp3 -> layer_15_expert_sp1_ep13_tp1_pp3
	layer_15_expert_out_sp1_ep13_tp1_pp3 [label="Expert Out L15 SP1 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep13_tp1_pp3 -> layer_15_expert_out_sp1_ep13_tp1_pp3
	layer_15_expert_sp1_ep13_tp2_pp3 [label="Expert L15 SP1 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep13_pp3 -> layer_15_expert_sp1_ep13_tp2_pp3
	layer_15_expert_out_sp1_ep13_tp2_pp3 [label="Expert Out L15 SP1 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep13_tp2_pp3 -> layer_15_expert_out_sp1_ep13_tp2_pp3
	layer_15_expert_sp1_ep13_tp3_pp3 [label="Expert L15 SP1 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep13_pp3 -> layer_15_expert_sp1_ep13_tp3_pp3
	layer_15_expert_out_sp1_ep13_tp3_pp3 [label="Expert Out L15 SP1 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep13_tp3_pp3 -> layer_15_expert_out_sp1_ep13_tp3_pp3
	layer_15_expert_ar_sp1_ep13_pp3 [label="Expert All-Reduce L15 SP1 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep13_tp0_pp3 -> layer_15_expert_ar_sp1_ep13_pp3
	layer_15_expert_out_sp1_ep13_tp1_pp3 -> layer_15_expert_ar_sp1_ep13_pp3
	layer_15_expert_out_sp1_ep13_tp2_pp3 -> layer_15_expert_ar_sp1_ep13_pp3
	layer_15_expert_out_sp1_ep13_tp3_pp3 -> layer_15_expert_ar_sp1_ep13_pp3
	layer_15_combine_sp1_ep13_pp3 [label="Token Combine L15 SP1 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep13_pp3 -> layer_15_combine_sp1_ep13_pp3
	layer_15_dispatch_sp1_ep14_pp3 [label="Token Dispatch L15 SP1 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep14_pp3 [style=dashed]
	layer_15_expert_sp1_ep14_tp0_pp3 [label="Expert L15 SP1 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep14_pp3 -> layer_15_expert_sp1_ep14_tp0_pp3
	layer_15_expert_out_sp1_ep14_tp0_pp3 [label="Expert Out L15 SP1 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep14_tp0_pp3 -> layer_15_expert_out_sp1_ep14_tp0_pp3
	layer_15_expert_sp1_ep14_tp1_pp3 [label="Expert L15 SP1 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep14_pp3 -> layer_15_expert_sp1_ep14_tp1_pp3
	layer_15_expert_out_sp1_ep14_tp1_pp3 [label="Expert Out L15 SP1 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep14_tp1_pp3 -> layer_15_expert_out_sp1_ep14_tp1_pp3
	layer_15_expert_sp1_ep14_tp2_pp3 [label="Expert L15 SP1 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep14_pp3 -> layer_15_expert_sp1_ep14_tp2_pp3
	layer_15_expert_out_sp1_ep14_tp2_pp3 [label="Expert Out L15 SP1 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep14_tp2_pp3 -> layer_15_expert_out_sp1_ep14_tp2_pp3
	layer_15_expert_sp1_ep14_tp3_pp3 [label="Expert L15 SP1 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep14_pp3 -> layer_15_expert_sp1_ep14_tp3_pp3
	layer_15_expert_out_sp1_ep14_tp3_pp3 [label="Expert Out L15 SP1 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep14_tp3_pp3 -> layer_15_expert_out_sp1_ep14_tp3_pp3
	layer_15_expert_ar_sp1_ep14_pp3 [label="Expert All-Reduce L15 SP1 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep14_tp0_pp3 -> layer_15_expert_ar_sp1_ep14_pp3
	layer_15_expert_out_sp1_ep14_tp1_pp3 -> layer_15_expert_ar_sp1_ep14_pp3
	layer_15_expert_out_sp1_ep14_tp2_pp3 -> layer_15_expert_ar_sp1_ep14_pp3
	layer_15_expert_out_sp1_ep14_tp3_pp3 -> layer_15_expert_ar_sp1_ep14_pp3
	layer_15_combine_sp1_ep14_pp3 [label="Token Combine L15 SP1 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep14_pp3 -> layer_15_combine_sp1_ep14_pp3
	layer_15_dispatch_sp1_ep15_pp3 [label="Token Dispatch L15 SP1 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp1_pp3 -> layer_15_dispatch_sp1_ep15_pp3 [style=dashed]
	layer_15_expert_sp1_ep15_tp0_pp3 [label="Expert L15 SP1 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep15_pp3 -> layer_15_expert_sp1_ep15_tp0_pp3
	layer_15_expert_out_sp1_ep15_tp0_pp3 [label="Expert Out L15 SP1 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep15_tp0_pp3 -> layer_15_expert_out_sp1_ep15_tp0_pp3
	layer_15_expert_sp1_ep15_tp1_pp3 [label="Expert L15 SP1 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep15_pp3 -> layer_15_expert_sp1_ep15_tp1_pp3
	layer_15_expert_out_sp1_ep15_tp1_pp3 [label="Expert Out L15 SP1 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep15_tp1_pp3 -> layer_15_expert_out_sp1_ep15_tp1_pp3
	layer_15_expert_sp1_ep15_tp2_pp3 [label="Expert L15 SP1 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep15_pp3 -> layer_15_expert_sp1_ep15_tp2_pp3
	layer_15_expert_out_sp1_ep15_tp2_pp3 [label="Expert Out L15 SP1 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep15_tp2_pp3 -> layer_15_expert_out_sp1_ep15_tp2_pp3
	layer_15_expert_sp1_ep15_tp3_pp3 [label="Expert L15 SP1 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp1_ep15_pp3 -> layer_15_expert_sp1_ep15_tp3_pp3
	layer_15_expert_out_sp1_ep15_tp3_pp3 [label="Expert Out L15 SP1 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp1_ep15_tp3_pp3 -> layer_15_expert_out_sp1_ep15_tp3_pp3
	layer_15_expert_ar_sp1_ep15_pp3 [label="Expert All-Reduce L15 SP1 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp1_ep15_tp0_pp3 -> layer_15_expert_ar_sp1_ep15_pp3
	layer_15_expert_out_sp1_ep15_tp1_pp3 -> layer_15_expert_ar_sp1_ep15_pp3
	layer_15_expert_out_sp1_ep15_tp2_pp3 -> layer_15_expert_ar_sp1_ep15_pp3
	layer_15_expert_out_sp1_ep15_tp3_pp3 -> layer_15_expert_ar_sp1_ep15_pp3
	layer_15_combine_sp1_ep15_pp3 [label="Token Combine L15 SP1 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp1_ep15_pp3 -> layer_15_combine_sp1_ep15_pp3
	layer_15_moe_all2all_sp1_pp3 [label="MoE All-to-All L15 SP1\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_15_combine_sp1_ep0_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep1_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep2_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep3_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep4_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep5_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep6_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep7_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep8_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep9_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep10_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep11_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep12_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep13_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep14_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_combine_sp1_ep15_pp3 -> layer_15_moe_all2all_sp1_pp3
	layer_15_mlp_out_sp1_pp3 [label="MoE Output L15 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_moe_all2all_sp1_pp3 -> layer_15_mlp_out_sp1_pp3
	layer_15_mlp_res_sp1_pp3 [label="MLP Residual L15 SP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_mlp_out_sp1_pp3 -> layer_15_mlp_res_sp1_pp3
	layer_15_attn_res_sp1_pp3 -> layer_15_mlp_res_sp1_pp3 [style=dashed]
	layer_15_norm_sp2_pp3 [label="LayerNorm L15 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_mlp_out_sp2_pp3 -> layer_15_norm_sp2_pp3
	layer_15_qkv_sp2_tp0_pp3 [label="QKV Proj L15 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp2_pp3 -> layer_15_qkv_sp2_tp0_pp3
	layer_15_attn_sp2_tp0_pp3 [label="Attention L15 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp2_tp0_pp3 -> layer_15_attn_sp2_tp0_pp3
	layer_15_attn_out_sp2_tp0_pp3 [label="Attn Out Proj L15 SP2 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp2_tp0_pp3 -> layer_15_attn_out_sp2_tp0_pp3
	layer_15_qkv_sp2_tp1_pp3 [label="QKV Proj L15 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp2_pp3 -> layer_15_qkv_sp2_tp1_pp3
	layer_15_attn_sp2_tp1_pp3 [label="Attention L15 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp2_tp1_pp3 -> layer_15_attn_sp2_tp1_pp3
	layer_15_attn_out_sp2_tp1_pp3 [label="Attn Out Proj L15 SP2 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp2_tp1_pp3 -> layer_15_attn_out_sp2_tp1_pp3
	layer_15_qkv_sp2_tp2_pp3 [label="QKV Proj L15 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp2_pp3 -> layer_15_qkv_sp2_tp2_pp3
	layer_15_attn_sp2_tp2_pp3 [label="Attention L15 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp2_tp2_pp3 -> layer_15_attn_sp2_tp2_pp3
	layer_15_attn_out_sp2_tp2_pp3 [label="Attn Out Proj L15 SP2 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp2_tp2_pp3 -> layer_15_attn_out_sp2_tp2_pp3
	layer_15_qkv_sp2_tp3_pp3 [label="QKV Proj L15 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp2_pp3 -> layer_15_qkv_sp2_tp3_pp3
	layer_15_attn_sp2_tp3_pp3 [label="Attention L15 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp2_tp3_pp3 -> layer_15_attn_sp2_tp3_pp3
	layer_15_attn_out_sp2_tp3_pp3 [label="Attn Out Proj L15 SP2 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp2_tp3_pp3 -> layer_15_attn_out_sp2_tp3_pp3
	layer_15_attn_ar_sp2_pp3 [label="Attention All-Reduce L15 SP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_attn_out_sp2_tp0_pp3 -> layer_15_attn_ar_sp2_pp3
	layer_15_attn_out_sp2_tp1_pp3 -> layer_15_attn_ar_sp2_pp3
	layer_15_attn_out_sp2_tp2_pp3 -> layer_15_attn_ar_sp2_pp3
	layer_15_attn_out_sp2_tp3_pp3 -> layer_15_attn_ar_sp2_pp3
	layer_15_attn_res_sp2_pp3 [label="Attention Residual L15 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_attn_ar_sp2_pp3 -> layer_15_attn_res_sp2_pp3
	layer_15_norm_sp2_pp3 -> layer_15_attn_res_sp2_pp3 [style=dashed]
	layer_15_post_norm_sp2_pp3 [label="Post-Attn Norm L15 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_attn_res_sp2_pp3 -> layer_15_post_norm_sp2_pp3
	layer_15_router_sp2_pp3 [label="MoE Router L15 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_15_post_norm_sp2_pp3 -> layer_15_router_sp2_pp3
	layer_15_dispatch_sp2_ep0_pp3 [label="Token Dispatch L15 SP2 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep0_pp3 [style=dashed]
	layer_15_expert_sp2_ep0_tp0_pp3 [label="Expert L15 SP2 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep0_pp3 -> layer_15_expert_sp2_ep0_tp0_pp3
	layer_15_expert_out_sp2_ep0_tp0_pp3 [label="Expert Out L15 SP2 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep0_tp0_pp3 -> layer_15_expert_out_sp2_ep0_tp0_pp3
	layer_15_expert_sp2_ep0_tp1_pp3 [label="Expert L15 SP2 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep0_pp3 -> layer_15_expert_sp2_ep0_tp1_pp3
	layer_15_expert_out_sp2_ep0_tp1_pp3 [label="Expert Out L15 SP2 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep0_tp1_pp3 -> layer_15_expert_out_sp2_ep0_tp1_pp3
	layer_15_expert_sp2_ep0_tp2_pp3 [label="Expert L15 SP2 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep0_pp3 -> layer_15_expert_sp2_ep0_tp2_pp3
	layer_15_expert_out_sp2_ep0_tp2_pp3 [label="Expert Out L15 SP2 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep0_tp2_pp3 -> layer_15_expert_out_sp2_ep0_tp2_pp3
	layer_15_expert_sp2_ep0_tp3_pp3 [label="Expert L15 SP2 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep0_pp3 -> layer_15_expert_sp2_ep0_tp3_pp3
	layer_15_expert_out_sp2_ep0_tp3_pp3 [label="Expert Out L15 SP2 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep0_tp3_pp3 -> layer_15_expert_out_sp2_ep0_tp3_pp3
	layer_15_expert_ar_sp2_ep0_pp3 [label="Expert All-Reduce L15 SP2 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep0_tp0_pp3 -> layer_15_expert_ar_sp2_ep0_pp3
	layer_15_expert_out_sp2_ep0_tp1_pp3 -> layer_15_expert_ar_sp2_ep0_pp3
	layer_15_expert_out_sp2_ep0_tp2_pp3 -> layer_15_expert_ar_sp2_ep0_pp3
	layer_15_expert_out_sp2_ep0_tp3_pp3 -> layer_15_expert_ar_sp2_ep0_pp3
	layer_15_combine_sp2_ep0_pp3 [label="Token Combine L15 SP2 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep0_pp3 -> layer_15_combine_sp2_ep0_pp3
	layer_15_dispatch_sp2_ep1_pp3 [label="Token Dispatch L15 SP2 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep1_pp3 [style=dashed]
	layer_15_expert_sp2_ep1_tp0_pp3 [label="Expert L15 SP2 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep1_pp3 -> layer_15_expert_sp2_ep1_tp0_pp3
	layer_15_expert_out_sp2_ep1_tp0_pp3 [label="Expert Out L15 SP2 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep1_tp0_pp3 -> layer_15_expert_out_sp2_ep1_tp0_pp3
	layer_15_expert_sp2_ep1_tp1_pp3 [label="Expert L15 SP2 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep1_pp3 -> layer_15_expert_sp2_ep1_tp1_pp3
	layer_15_expert_out_sp2_ep1_tp1_pp3 [label="Expert Out L15 SP2 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep1_tp1_pp3 -> layer_15_expert_out_sp2_ep1_tp1_pp3
	layer_15_expert_sp2_ep1_tp2_pp3 [label="Expert L15 SP2 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep1_pp3 -> layer_15_expert_sp2_ep1_tp2_pp3
	layer_15_expert_out_sp2_ep1_tp2_pp3 [label="Expert Out L15 SP2 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep1_tp2_pp3 -> layer_15_expert_out_sp2_ep1_tp2_pp3
	layer_15_expert_sp2_ep1_tp3_pp3 [label="Expert L15 SP2 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep1_pp3 -> layer_15_expert_sp2_ep1_tp3_pp3
	layer_15_expert_out_sp2_ep1_tp3_pp3 [label="Expert Out L15 SP2 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep1_tp3_pp3 -> layer_15_expert_out_sp2_ep1_tp3_pp3
	layer_15_expert_ar_sp2_ep1_pp3 [label="Expert All-Reduce L15 SP2 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep1_tp0_pp3 -> layer_15_expert_ar_sp2_ep1_pp3
	layer_15_expert_out_sp2_ep1_tp1_pp3 -> layer_15_expert_ar_sp2_ep1_pp3
	layer_15_expert_out_sp2_ep1_tp2_pp3 -> layer_15_expert_ar_sp2_ep1_pp3
	layer_15_expert_out_sp2_ep1_tp3_pp3 -> layer_15_expert_ar_sp2_ep1_pp3
	layer_15_combine_sp2_ep1_pp3 [label="Token Combine L15 SP2 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep1_pp3 -> layer_15_combine_sp2_ep1_pp3
	layer_15_dispatch_sp2_ep2_pp3 [label="Token Dispatch L15 SP2 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep2_pp3 [style=dashed]
	layer_15_expert_sp2_ep2_tp0_pp3 [label="Expert L15 SP2 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep2_pp3 -> layer_15_expert_sp2_ep2_tp0_pp3
	layer_15_expert_out_sp2_ep2_tp0_pp3 [label="Expert Out L15 SP2 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep2_tp0_pp3 -> layer_15_expert_out_sp2_ep2_tp0_pp3
	layer_15_expert_sp2_ep2_tp1_pp3 [label="Expert L15 SP2 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep2_pp3 -> layer_15_expert_sp2_ep2_tp1_pp3
	layer_15_expert_out_sp2_ep2_tp1_pp3 [label="Expert Out L15 SP2 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep2_tp1_pp3 -> layer_15_expert_out_sp2_ep2_tp1_pp3
	layer_15_expert_sp2_ep2_tp2_pp3 [label="Expert L15 SP2 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep2_pp3 -> layer_15_expert_sp2_ep2_tp2_pp3
	layer_15_expert_out_sp2_ep2_tp2_pp3 [label="Expert Out L15 SP2 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep2_tp2_pp3 -> layer_15_expert_out_sp2_ep2_tp2_pp3
	layer_15_expert_sp2_ep2_tp3_pp3 [label="Expert L15 SP2 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep2_pp3 -> layer_15_expert_sp2_ep2_tp3_pp3
	layer_15_expert_out_sp2_ep2_tp3_pp3 [label="Expert Out L15 SP2 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep2_tp3_pp3 -> layer_15_expert_out_sp2_ep2_tp3_pp3
	layer_15_expert_ar_sp2_ep2_pp3 [label="Expert All-Reduce L15 SP2 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep2_tp0_pp3 -> layer_15_expert_ar_sp2_ep2_pp3
	layer_15_expert_out_sp2_ep2_tp1_pp3 -> layer_15_expert_ar_sp2_ep2_pp3
	layer_15_expert_out_sp2_ep2_tp2_pp3 -> layer_15_expert_ar_sp2_ep2_pp3
	layer_15_expert_out_sp2_ep2_tp3_pp3 -> layer_15_expert_ar_sp2_ep2_pp3
	layer_15_combine_sp2_ep2_pp3 [label="Token Combine L15 SP2 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep2_pp3 -> layer_15_combine_sp2_ep2_pp3
	layer_15_dispatch_sp2_ep3_pp3 [label="Token Dispatch L15 SP2 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep3_pp3 [style=dashed]
	layer_15_expert_sp2_ep3_tp0_pp3 [label="Expert L15 SP2 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep3_pp3 -> layer_15_expert_sp2_ep3_tp0_pp3
	layer_15_expert_out_sp2_ep3_tp0_pp3 [label="Expert Out L15 SP2 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep3_tp0_pp3 -> layer_15_expert_out_sp2_ep3_tp0_pp3
	layer_15_expert_sp2_ep3_tp1_pp3 [label="Expert L15 SP2 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep3_pp3 -> layer_15_expert_sp2_ep3_tp1_pp3
	layer_15_expert_out_sp2_ep3_tp1_pp3 [label="Expert Out L15 SP2 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep3_tp1_pp3 -> layer_15_expert_out_sp2_ep3_tp1_pp3
	layer_15_expert_sp2_ep3_tp2_pp3 [label="Expert L15 SP2 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep3_pp3 -> layer_15_expert_sp2_ep3_tp2_pp3
	layer_15_expert_out_sp2_ep3_tp2_pp3 [label="Expert Out L15 SP2 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep3_tp2_pp3 -> layer_15_expert_out_sp2_ep3_tp2_pp3
	layer_15_expert_sp2_ep3_tp3_pp3 [label="Expert L15 SP2 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep3_pp3 -> layer_15_expert_sp2_ep3_tp3_pp3
	layer_15_expert_out_sp2_ep3_tp3_pp3 [label="Expert Out L15 SP2 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep3_tp3_pp3 -> layer_15_expert_out_sp2_ep3_tp3_pp3
	layer_15_expert_ar_sp2_ep3_pp3 [label="Expert All-Reduce L15 SP2 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep3_tp0_pp3 -> layer_15_expert_ar_sp2_ep3_pp3
	layer_15_expert_out_sp2_ep3_tp1_pp3 -> layer_15_expert_ar_sp2_ep3_pp3
	layer_15_expert_out_sp2_ep3_tp2_pp3 -> layer_15_expert_ar_sp2_ep3_pp3
	layer_15_expert_out_sp2_ep3_tp3_pp3 -> layer_15_expert_ar_sp2_ep3_pp3
	layer_15_combine_sp2_ep3_pp3 [label="Token Combine L15 SP2 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep3_pp3 -> layer_15_combine_sp2_ep3_pp3
	layer_15_dispatch_sp2_ep4_pp3 [label="Token Dispatch L15 SP2 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep4_pp3 [style=dashed]
	layer_15_expert_sp2_ep4_tp0_pp3 [label="Expert L15 SP2 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep4_pp3 -> layer_15_expert_sp2_ep4_tp0_pp3
	layer_15_expert_out_sp2_ep4_tp0_pp3 [label="Expert Out L15 SP2 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep4_tp0_pp3 -> layer_15_expert_out_sp2_ep4_tp0_pp3
	layer_15_expert_sp2_ep4_tp1_pp3 [label="Expert L15 SP2 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep4_pp3 -> layer_15_expert_sp2_ep4_tp1_pp3
	layer_15_expert_out_sp2_ep4_tp1_pp3 [label="Expert Out L15 SP2 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep4_tp1_pp3 -> layer_15_expert_out_sp2_ep4_tp1_pp3
	layer_15_expert_sp2_ep4_tp2_pp3 [label="Expert L15 SP2 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep4_pp3 -> layer_15_expert_sp2_ep4_tp2_pp3
	layer_15_expert_out_sp2_ep4_tp2_pp3 [label="Expert Out L15 SP2 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep4_tp2_pp3 -> layer_15_expert_out_sp2_ep4_tp2_pp3
	layer_15_expert_sp2_ep4_tp3_pp3 [label="Expert L15 SP2 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep4_pp3 -> layer_15_expert_sp2_ep4_tp3_pp3
	layer_15_expert_out_sp2_ep4_tp3_pp3 [label="Expert Out L15 SP2 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep4_tp3_pp3 -> layer_15_expert_out_sp2_ep4_tp3_pp3
	layer_15_expert_ar_sp2_ep4_pp3 [label="Expert All-Reduce L15 SP2 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep4_tp0_pp3 -> layer_15_expert_ar_sp2_ep4_pp3
	layer_15_expert_out_sp2_ep4_tp1_pp3 -> layer_15_expert_ar_sp2_ep4_pp3
	layer_15_expert_out_sp2_ep4_tp2_pp3 -> layer_15_expert_ar_sp2_ep4_pp3
	layer_15_expert_out_sp2_ep4_tp3_pp3 -> layer_15_expert_ar_sp2_ep4_pp3
	layer_15_combine_sp2_ep4_pp3 [label="Token Combine L15 SP2 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep4_pp3 -> layer_15_combine_sp2_ep4_pp3
	layer_15_dispatch_sp2_ep5_pp3 [label="Token Dispatch L15 SP2 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep5_pp3 [style=dashed]
	layer_15_expert_sp2_ep5_tp0_pp3 [label="Expert L15 SP2 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep5_pp3 -> layer_15_expert_sp2_ep5_tp0_pp3
	layer_15_expert_out_sp2_ep5_tp0_pp3 [label="Expert Out L15 SP2 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep5_tp0_pp3 -> layer_15_expert_out_sp2_ep5_tp0_pp3
	layer_15_expert_sp2_ep5_tp1_pp3 [label="Expert L15 SP2 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep5_pp3 -> layer_15_expert_sp2_ep5_tp1_pp3
	layer_15_expert_out_sp2_ep5_tp1_pp3 [label="Expert Out L15 SP2 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep5_tp1_pp3 -> layer_15_expert_out_sp2_ep5_tp1_pp3
	layer_15_expert_sp2_ep5_tp2_pp3 [label="Expert L15 SP2 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep5_pp3 -> layer_15_expert_sp2_ep5_tp2_pp3
	layer_15_expert_out_sp2_ep5_tp2_pp3 [label="Expert Out L15 SP2 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep5_tp2_pp3 -> layer_15_expert_out_sp2_ep5_tp2_pp3
	layer_15_expert_sp2_ep5_tp3_pp3 [label="Expert L15 SP2 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep5_pp3 -> layer_15_expert_sp2_ep5_tp3_pp3
	layer_15_expert_out_sp2_ep5_tp3_pp3 [label="Expert Out L15 SP2 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep5_tp3_pp3 -> layer_15_expert_out_sp2_ep5_tp3_pp3
	layer_15_expert_ar_sp2_ep5_pp3 [label="Expert All-Reduce L15 SP2 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep5_tp0_pp3 -> layer_15_expert_ar_sp2_ep5_pp3
	layer_15_expert_out_sp2_ep5_tp1_pp3 -> layer_15_expert_ar_sp2_ep5_pp3
	layer_15_expert_out_sp2_ep5_tp2_pp3 -> layer_15_expert_ar_sp2_ep5_pp3
	layer_15_expert_out_sp2_ep5_tp3_pp3 -> layer_15_expert_ar_sp2_ep5_pp3
	layer_15_combine_sp2_ep5_pp3 [label="Token Combine L15 SP2 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep5_pp3 -> layer_15_combine_sp2_ep5_pp3
	layer_15_dispatch_sp2_ep6_pp3 [label="Token Dispatch L15 SP2 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep6_pp3 [style=dashed]
	layer_15_expert_sp2_ep6_tp0_pp3 [label="Expert L15 SP2 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep6_pp3 -> layer_15_expert_sp2_ep6_tp0_pp3
	layer_15_expert_out_sp2_ep6_tp0_pp3 [label="Expert Out L15 SP2 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep6_tp0_pp3 -> layer_15_expert_out_sp2_ep6_tp0_pp3
	layer_15_expert_sp2_ep6_tp1_pp3 [label="Expert L15 SP2 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep6_pp3 -> layer_15_expert_sp2_ep6_tp1_pp3
	layer_15_expert_out_sp2_ep6_tp1_pp3 [label="Expert Out L15 SP2 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep6_tp1_pp3 -> layer_15_expert_out_sp2_ep6_tp1_pp3
	layer_15_expert_sp2_ep6_tp2_pp3 [label="Expert L15 SP2 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep6_pp3 -> layer_15_expert_sp2_ep6_tp2_pp3
	layer_15_expert_out_sp2_ep6_tp2_pp3 [label="Expert Out L15 SP2 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep6_tp2_pp3 -> layer_15_expert_out_sp2_ep6_tp2_pp3
	layer_15_expert_sp2_ep6_tp3_pp3 [label="Expert L15 SP2 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep6_pp3 -> layer_15_expert_sp2_ep6_tp3_pp3
	layer_15_expert_out_sp2_ep6_tp3_pp3 [label="Expert Out L15 SP2 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep6_tp3_pp3 -> layer_15_expert_out_sp2_ep6_tp3_pp3
	layer_15_expert_ar_sp2_ep6_pp3 [label="Expert All-Reduce L15 SP2 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep6_tp0_pp3 -> layer_15_expert_ar_sp2_ep6_pp3
	layer_15_expert_out_sp2_ep6_tp1_pp3 -> layer_15_expert_ar_sp2_ep6_pp3
	layer_15_expert_out_sp2_ep6_tp2_pp3 -> layer_15_expert_ar_sp2_ep6_pp3
	layer_15_expert_out_sp2_ep6_tp3_pp3 -> layer_15_expert_ar_sp2_ep6_pp3
	layer_15_combine_sp2_ep6_pp3 [label="Token Combine L15 SP2 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep6_pp3 -> layer_15_combine_sp2_ep6_pp3
	layer_15_dispatch_sp2_ep7_pp3 [label="Token Dispatch L15 SP2 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep7_pp3 [style=dashed]
	layer_15_expert_sp2_ep7_tp0_pp3 [label="Expert L15 SP2 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep7_pp3 -> layer_15_expert_sp2_ep7_tp0_pp3
	layer_15_expert_out_sp2_ep7_tp0_pp3 [label="Expert Out L15 SP2 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep7_tp0_pp3 -> layer_15_expert_out_sp2_ep7_tp0_pp3
	layer_15_expert_sp2_ep7_tp1_pp3 [label="Expert L15 SP2 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep7_pp3 -> layer_15_expert_sp2_ep7_tp1_pp3
	layer_15_expert_out_sp2_ep7_tp1_pp3 [label="Expert Out L15 SP2 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep7_tp1_pp3 -> layer_15_expert_out_sp2_ep7_tp1_pp3
	layer_15_expert_sp2_ep7_tp2_pp3 [label="Expert L15 SP2 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep7_pp3 -> layer_15_expert_sp2_ep7_tp2_pp3
	layer_15_expert_out_sp2_ep7_tp2_pp3 [label="Expert Out L15 SP2 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep7_tp2_pp3 -> layer_15_expert_out_sp2_ep7_tp2_pp3
	layer_15_expert_sp2_ep7_tp3_pp3 [label="Expert L15 SP2 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep7_pp3 -> layer_15_expert_sp2_ep7_tp3_pp3
	layer_15_expert_out_sp2_ep7_tp3_pp3 [label="Expert Out L15 SP2 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep7_tp3_pp3 -> layer_15_expert_out_sp2_ep7_tp3_pp3
	layer_15_expert_ar_sp2_ep7_pp3 [label="Expert All-Reduce L15 SP2 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep7_tp0_pp3 -> layer_15_expert_ar_sp2_ep7_pp3
	layer_15_expert_out_sp2_ep7_tp1_pp3 -> layer_15_expert_ar_sp2_ep7_pp3
	layer_15_expert_out_sp2_ep7_tp2_pp3 -> layer_15_expert_ar_sp2_ep7_pp3
	layer_15_expert_out_sp2_ep7_tp3_pp3 -> layer_15_expert_ar_sp2_ep7_pp3
	layer_15_combine_sp2_ep7_pp3 [label="Token Combine L15 SP2 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep7_pp3 -> layer_15_combine_sp2_ep7_pp3
	layer_15_dispatch_sp2_ep8_pp3 [label="Token Dispatch L15 SP2 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep8_pp3 [style=dashed]
	layer_15_expert_sp2_ep8_tp0_pp3 [label="Expert L15 SP2 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep8_pp3 -> layer_15_expert_sp2_ep8_tp0_pp3
	layer_15_expert_out_sp2_ep8_tp0_pp3 [label="Expert Out L15 SP2 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep8_tp0_pp3 -> layer_15_expert_out_sp2_ep8_tp0_pp3
	layer_15_expert_sp2_ep8_tp1_pp3 [label="Expert L15 SP2 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep8_pp3 -> layer_15_expert_sp2_ep8_tp1_pp3
	layer_15_expert_out_sp2_ep8_tp1_pp3 [label="Expert Out L15 SP2 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep8_tp1_pp3 -> layer_15_expert_out_sp2_ep8_tp1_pp3
	layer_15_expert_sp2_ep8_tp2_pp3 [label="Expert L15 SP2 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep8_pp3 -> layer_15_expert_sp2_ep8_tp2_pp3
	layer_15_expert_out_sp2_ep8_tp2_pp3 [label="Expert Out L15 SP2 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep8_tp2_pp3 -> layer_15_expert_out_sp2_ep8_tp2_pp3
	layer_15_expert_sp2_ep8_tp3_pp3 [label="Expert L15 SP2 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep8_pp3 -> layer_15_expert_sp2_ep8_tp3_pp3
	layer_15_expert_out_sp2_ep8_tp3_pp3 [label="Expert Out L15 SP2 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep8_tp3_pp3 -> layer_15_expert_out_sp2_ep8_tp3_pp3
	layer_15_expert_ar_sp2_ep8_pp3 [label="Expert All-Reduce L15 SP2 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep8_tp0_pp3 -> layer_15_expert_ar_sp2_ep8_pp3
	layer_15_expert_out_sp2_ep8_tp1_pp3 -> layer_15_expert_ar_sp2_ep8_pp3
	layer_15_expert_out_sp2_ep8_tp2_pp3 -> layer_15_expert_ar_sp2_ep8_pp3
	layer_15_expert_out_sp2_ep8_tp3_pp3 -> layer_15_expert_ar_sp2_ep8_pp3
	layer_15_combine_sp2_ep8_pp3 [label="Token Combine L15 SP2 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep8_pp3 -> layer_15_combine_sp2_ep8_pp3
	layer_15_dispatch_sp2_ep9_pp3 [label="Token Dispatch L15 SP2 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep9_pp3 [style=dashed]
	layer_15_expert_sp2_ep9_tp0_pp3 [label="Expert L15 SP2 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep9_pp3 -> layer_15_expert_sp2_ep9_tp0_pp3
	layer_15_expert_out_sp2_ep9_tp0_pp3 [label="Expert Out L15 SP2 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep9_tp0_pp3 -> layer_15_expert_out_sp2_ep9_tp0_pp3
	layer_15_expert_sp2_ep9_tp1_pp3 [label="Expert L15 SP2 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep9_pp3 -> layer_15_expert_sp2_ep9_tp1_pp3
	layer_15_expert_out_sp2_ep9_tp1_pp3 [label="Expert Out L15 SP2 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep9_tp1_pp3 -> layer_15_expert_out_sp2_ep9_tp1_pp3
	layer_15_expert_sp2_ep9_tp2_pp3 [label="Expert L15 SP2 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep9_pp3 -> layer_15_expert_sp2_ep9_tp2_pp3
	layer_15_expert_out_sp2_ep9_tp2_pp3 [label="Expert Out L15 SP2 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep9_tp2_pp3 -> layer_15_expert_out_sp2_ep9_tp2_pp3
	layer_15_expert_sp2_ep9_tp3_pp3 [label="Expert L15 SP2 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep9_pp3 -> layer_15_expert_sp2_ep9_tp3_pp3
	layer_15_expert_out_sp2_ep9_tp3_pp3 [label="Expert Out L15 SP2 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep9_tp3_pp3 -> layer_15_expert_out_sp2_ep9_tp3_pp3
	layer_15_expert_ar_sp2_ep9_pp3 [label="Expert All-Reduce L15 SP2 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep9_tp0_pp3 -> layer_15_expert_ar_sp2_ep9_pp3
	layer_15_expert_out_sp2_ep9_tp1_pp3 -> layer_15_expert_ar_sp2_ep9_pp3
	layer_15_expert_out_sp2_ep9_tp2_pp3 -> layer_15_expert_ar_sp2_ep9_pp3
	layer_15_expert_out_sp2_ep9_tp3_pp3 -> layer_15_expert_ar_sp2_ep9_pp3
	layer_15_combine_sp2_ep9_pp3 [label="Token Combine L15 SP2 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep9_pp3 -> layer_15_combine_sp2_ep9_pp3
	layer_15_dispatch_sp2_ep10_pp3 [label="Token Dispatch L15 SP2 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep10_pp3 [style=dashed]
	layer_15_expert_sp2_ep10_tp0_pp3 [label="Expert L15 SP2 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep10_pp3 -> layer_15_expert_sp2_ep10_tp0_pp3
	layer_15_expert_out_sp2_ep10_tp0_pp3 [label="Expert Out L15 SP2 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep10_tp0_pp3 -> layer_15_expert_out_sp2_ep10_tp0_pp3
	layer_15_expert_sp2_ep10_tp1_pp3 [label="Expert L15 SP2 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep10_pp3 -> layer_15_expert_sp2_ep10_tp1_pp3
	layer_15_expert_out_sp2_ep10_tp1_pp3 [label="Expert Out L15 SP2 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep10_tp1_pp3 -> layer_15_expert_out_sp2_ep10_tp1_pp3
	layer_15_expert_sp2_ep10_tp2_pp3 [label="Expert L15 SP2 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep10_pp3 -> layer_15_expert_sp2_ep10_tp2_pp3
	layer_15_expert_out_sp2_ep10_tp2_pp3 [label="Expert Out L15 SP2 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep10_tp2_pp3 -> layer_15_expert_out_sp2_ep10_tp2_pp3
	layer_15_expert_sp2_ep10_tp3_pp3 [label="Expert L15 SP2 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep10_pp3 -> layer_15_expert_sp2_ep10_tp3_pp3
	layer_15_expert_out_sp2_ep10_tp3_pp3 [label="Expert Out L15 SP2 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep10_tp3_pp3 -> layer_15_expert_out_sp2_ep10_tp3_pp3
	layer_15_expert_ar_sp2_ep10_pp3 [label="Expert All-Reduce L15 SP2 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep10_tp0_pp3 -> layer_15_expert_ar_sp2_ep10_pp3
	layer_15_expert_out_sp2_ep10_tp1_pp3 -> layer_15_expert_ar_sp2_ep10_pp3
	layer_15_expert_out_sp2_ep10_tp2_pp3 -> layer_15_expert_ar_sp2_ep10_pp3
	layer_15_expert_out_sp2_ep10_tp3_pp3 -> layer_15_expert_ar_sp2_ep10_pp3
	layer_15_combine_sp2_ep10_pp3 [label="Token Combine L15 SP2 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep10_pp3 -> layer_15_combine_sp2_ep10_pp3
	layer_15_dispatch_sp2_ep11_pp3 [label="Token Dispatch L15 SP2 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep11_pp3 [style=dashed]
	layer_15_expert_sp2_ep11_tp0_pp3 [label="Expert L15 SP2 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep11_pp3 -> layer_15_expert_sp2_ep11_tp0_pp3
	layer_15_expert_out_sp2_ep11_tp0_pp3 [label="Expert Out L15 SP2 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep11_tp0_pp3 -> layer_15_expert_out_sp2_ep11_tp0_pp3
	layer_15_expert_sp2_ep11_tp1_pp3 [label="Expert L15 SP2 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep11_pp3 -> layer_15_expert_sp2_ep11_tp1_pp3
	layer_15_expert_out_sp2_ep11_tp1_pp3 [label="Expert Out L15 SP2 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep11_tp1_pp3 -> layer_15_expert_out_sp2_ep11_tp1_pp3
	layer_15_expert_sp2_ep11_tp2_pp3 [label="Expert L15 SP2 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep11_pp3 -> layer_15_expert_sp2_ep11_tp2_pp3
	layer_15_expert_out_sp2_ep11_tp2_pp3 [label="Expert Out L15 SP2 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep11_tp2_pp3 -> layer_15_expert_out_sp2_ep11_tp2_pp3
	layer_15_expert_sp2_ep11_tp3_pp3 [label="Expert L15 SP2 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep11_pp3 -> layer_15_expert_sp2_ep11_tp3_pp3
	layer_15_expert_out_sp2_ep11_tp3_pp3 [label="Expert Out L15 SP2 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep11_tp3_pp3 -> layer_15_expert_out_sp2_ep11_tp3_pp3
	layer_15_expert_ar_sp2_ep11_pp3 [label="Expert All-Reduce L15 SP2 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep11_tp0_pp3 -> layer_15_expert_ar_sp2_ep11_pp3
	layer_15_expert_out_sp2_ep11_tp1_pp3 -> layer_15_expert_ar_sp2_ep11_pp3
	layer_15_expert_out_sp2_ep11_tp2_pp3 -> layer_15_expert_ar_sp2_ep11_pp3
	layer_15_expert_out_sp2_ep11_tp3_pp3 -> layer_15_expert_ar_sp2_ep11_pp3
	layer_15_combine_sp2_ep11_pp3 [label="Token Combine L15 SP2 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep11_pp3 -> layer_15_combine_sp2_ep11_pp3
	layer_15_dispatch_sp2_ep12_pp3 [label="Token Dispatch L15 SP2 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep12_pp3 [style=dashed]
	layer_15_expert_sp2_ep12_tp0_pp3 [label="Expert L15 SP2 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep12_pp3 -> layer_15_expert_sp2_ep12_tp0_pp3
	layer_15_expert_out_sp2_ep12_tp0_pp3 [label="Expert Out L15 SP2 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep12_tp0_pp3 -> layer_15_expert_out_sp2_ep12_tp0_pp3
	layer_15_expert_sp2_ep12_tp1_pp3 [label="Expert L15 SP2 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep12_pp3 -> layer_15_expert_sp2_ep12_tp1_pp3
	layer_15_expert_out_sp2_ep12_tp1_pp3 [label="Expert Out L15 SP2 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep12_tp1_pp3 -> layer_15_expert_out_sp2_ep12_tp1_pp3
	layer_15_expert_sp2_ep12_tp2_pp3 [label="Expert L15 SP2 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep12_pp3 -> layer_15_expert_sp2_ep12_tp2_pp3
	layer_15_expert_out_sp2_ep12_tp2_pp3 [label="Expert Out L15 SP2 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep12_tp2_pp3 -> layer_15_expert_out_sp2_ep12_tp2_pp3
	layer_15_expert_sp2_ep12_tp3_pp3 [label="Expert L15 SP2 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep12_pp3 -> layer_15_expert_sp2_ep12_tp3_pp3
	layer_15_expert_out_sp2_ep12_tp3_pp3 [label="Expert Out L15 SP2 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep12_tp3_pp3 -> layer_15_expert_out_sp2_ep12_tp3_pp3
	layer_15_expert_ar_sp2_ep12_pp3 [label="Expert All-Reduce L15 SP2 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep12_tp0_pp3 -> layer_15_expert_ar_sp2_ep12_pp3
	layer_15_expert_out_sp2_ep12_tp1_pp3 -> layer_15_expert_ar_sp2_ep12_pp3
	layer_15_expert_out_sp2_ep12_tp2_pp3 -> layer_15_expert_ar_sp2_ep12_pp3
	layer_15_expert_out_sp2_ep12_tp3_pp3 -> layer_15_expert_ar_sp2_ep12_pp3
	layer_15_combine_sp2_ep12_pp3 [label="Token Combine L15 SP2 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep12_pp3 -> layer_15_combine_sp2_ep12_pp3
	layer_15_dispatch_sp2_ep13_pp3 [label="Token Dispatch L15 SP2 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep13_pp3 [style=dashed]
	layer_15_expert_sp2_ep13_tp0_pp3 [label="Expert L15 SP2 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep13_pp3 -> layer_15_expert_sp2_ep13_tp0_pp3
	layer_15_expert_out_sp2_ep13_tp0_pp3 [label="Expert Out L15 SP2 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep13_tp0_pp3 -> layer_15_expert_out_sp2_ep13_tp0_pp3
	layer_15_expert_sp2_ep13_tp1_pp3 [label="Expert L15 SP2 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep13_pp3 -> layer_15_expert_sp2_ep13_tp1_pp3
	layer_15_expert_out_sp2_ep13_tp1_pp3 [label="Expert Out L15 SP2 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep13_tp1_pp3 -> layer_15_expert_out_sp2_ep13_tp1_pp3
	layer_15_expert_sp2_ep13_tp2_pp3 [label="Expert L15 SP2 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep13_pp3 -> layer_15_expert_sp2_ep13_tp2_pp3
	layer_15_expert_out_sp2_ep13_tp2_pp3 [label="Expert Out L15 SP2 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep13_tp2_pp3 -> layer_15_expert_out_sp2_ep13_tp2_pp3
	layer_15_expert_sp2_ep13_tp3_pp3 [label="Expert L15 SP2 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep13_pp3 -> layer_15_expert_sp2_ep13_tp3_pp3
	layer_15_expert_out_sp2_ep13_tp3_pp3 [label="Expert Out L15 SP2 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep13_tp3_pp3 -> layer_15_expert_out_sp2_ep13_tp3_pp3
	layer_15_expert_ar_sp2_ep13_pp3 [label="Expert All-Reduce L15 SP2 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep13_tp0_pp3 -> layer_15_expert_ar_sp2_ep13_pp3
	layer_15_expert_out_sp2_ep13_tp1_pp3 -> layer_15_expert_ar_sp2_ep13_pp3
	layer_15_expert_out_sp2_ep13_tp2_pp3 -> layer_15_expert_ar_sp2_ep13_pp3
	layer_15_expert_out_sp2_ep13_tp3_pp3 -> layer_15_expert_ar_sp2_ep13_pp3
	layer_15_combine_sp2_ep13_pp3 [label="Token Combine L15 SP2 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep13_pp3 -> layer_15_combine_sp2_ep13_pp3
	layer_15_dispatch_sp2_ep14_pp3 [label="Token Dispatch L15 SP2 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep14_pp3 [style=dashed]
	layer_15_expert_sp2_ep14_tp0_pp3 [label="Expert L15 SP2 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep14_pp3 -> layer_15_expert_sp2_ep14_tp0_pp3
	layer_15_expert_out_sp2_ep14_tp0_pp3 [label="Expert Out L15 SP2 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep14_tp0_pp3 -> layer_15_expert_out_sp2_ep14_tp0_pp3
	layer_15_expert_sp2_ep14_tp1_pp3 [label="Expert L15 SP2 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep14_pp3 -> layer_15_expert_sp2_ep14_tp1_pp3
	layer_15_expert_out_sp2_ep14_tp1_pp3 [label="Expert Out L15 SP2 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep14_tp1_pp3 -> layer_15_expert_out_sp2_ep14_tp1_pp3
	layer_15_expert_sp2_ep14_tp2_pp3 [label="Expert L15 SP2 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep14_pp3 -> layer_15_expert_sp2_ep14_tp2_pp3
	layer_15_expert_out_sp2_ep14_tp2_pp3 [label="Expert Out L15 SP2 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep14_tp2_pp3 -> layer_15_expert_out_sp2_ep14_tp2_pp3
	layer_15_expert_sp2_ep14_tp3_pp3 [label="Expert L15 SP2 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep14_pp3 -> layer_15_expert_sp2_ep14_tp3_pp3
	layer_15_expert_out_sp2_ep14_tp3_pp3 [label="Expert Out L15 SP2 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep14_tp3_pp3 -> layer_15_expert_out_sp2_ep14_tp3_pp3
	layer_15_expert_ar_sp2_ep14_pp3 [label="Expert All-Reduce L15 SP2 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep14_tp0_pp3 -> layer_15_expert_ar_sp2_ep14_pp3
	layer_15_expert_out_sp2_ep14_tp1_pp3 -> layer_15_expert_ar_sp2_ep14_pp3
	layer_15_expert_out_sp2_ep14_tp2_pp3 -> layer_15_expert_ar_sp2_ep14_pp3
	layer_15_expert_out_sp2_ep14_tp3_pp3 -> layer_15_expert_ar_sp2_ep14_pp3
	layer_15_combine_sp2_ep14_pp3 [label="Token Combine L15 SP2 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep14_pp3 -> layer_15_combine_sp2_ep14_pp3
	layer_15_dispatch_sp2_ep15_pp3 [label="Token Dispatch L15 SP2 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp2_pp3 -> layer_15_dispatch_sp2_ep15_pp3 [style=dashed]
	layer_15_expert_sp2_ep15_tp0_pp3 [label="Expert L15 SP2 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep15_pp3 -> layer_15_expert_sp2_ep15_tp0_pp3
	layer_15_expert_out_sp2_ep15_tp0_pp3 [label="Expert Out L15 SP2 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep15_tp0_pp3 -> layer_15_expert_out_sp2_ep15_tp0_pp3
	layer_15_expert_sp2_ep15_tp1_pp3 [label="Expert L15 SP2 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep15_pp3 -> layer_15_expert_sp2_ep15_tp1_pp3
	layer_15_expert_out_sp2_ep15_tp1_pp3 [label="Expert Out L15 SP2 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep15_tp1_pp3 -> layer_15_expert_out_sp2_ep15_tp1_pp3
	layer_15_expert_sp2_ep15_tp2_pp3 [label="Expert L15 SP2 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep15_pp3 -> layer_15_expert_sp2_ep15_tp2_pp3
	layer_15_expert_out_sp2_ep15_tp2_pp3 [label="Expert Out L15 SP2 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep15_tp2_pp3 -> layer_15_expert_out_sp2_ep15_tp2_pp3
	layer_15_expert_sp2_ep15_tp3_pp3 [label="Expert L15 SP2 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp2_ep15_pp3 -> layer_15_expert_sp2_ep15_tp3_pp3
	layer_15_expert_out_sp2_ep15_tp3_pp3 [label="Expert Out L15 SP2 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp2_ep15_tp3_pp3 -> layer_15_expert_out_sp2_ep15_tp3_pp3
	layer_15_expert_ar_sp2_ep15_pp3 [label="Expert All-Reduce L15 SP2 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp2_ep15_tp0_pp3 -> layer_15_expert_ar_sp2_ep15_pp3
	layer_15_expert_out_sp2_ep15_tp1_pp3 -> layer_15_expert_ar_sp2_ep15_pp3
	layer_15_expert_out_sp2_ep15_tp2_pp3 -> layer_15_expert_ar_sp2_ep15_pp3
	layer_15_expert_out_sp2_ep15_tp3_pp3 -> layer_15_expert_ar_sp2_ep15_pp3
	layer_15_combine_sp2_ep15_pp3 [label="Token Combine L15 SP2 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp2_ep15_pp3 -> layer_15_combine_sp2_ep15_pp3
	layer_15_moe_all2all_sp2_pp3 [label="MoE All-to-All L15 SP2\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_15_combine_sp2_ep0_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep1_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep2_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep3_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep4_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep5_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep6_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep7_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep8_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep9_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep10_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep11_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep12_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep13_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep14_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_combine_sp2_ep15_pp3 -> layer_15_moe_all2all_sp2_pp3
	layer_15_mlp_out_sp2_pp3 [label="MoE Output L15 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_moe_all2all_sp2_pp3 -> layer_15_mlp_out_sp2_pp3
	layer_15_mlp_res_sp2_pp3 [label="MLP Residual L15 SP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_mlp_out_sp2_pp3 -> layer_15_mlp_res_sp2_pp3
	layer_15_attn_res_sp2_pp3 -> layer_15_mlp_res_sp2_pp3 [style=dashed]
	layer_15_norm_sp3_pp3 [label="LayerNorm L15 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_14_mlp_out_sp3_pp3 -> layer_15_norm_sp3_pp3
	layer_15_qkv_sp3_tp0_pp3 [label="QKV Proj L15 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp3_pp3 -> layer_15_qkv_sp3_tp0_pp3
	layer_15_attn_sp3_tp0_pp3 [label="Attention L15 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp3_tp0_pp3 -> layer_15_attn_sp3_tp0_pp3
	layer_15_attn_out_sp3_tp0_pp3 [label="Attn Out Proj L15 SP3 TP0\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp3_tp0_pp3 -> layer_15_attn_out_sp3_tp0_pp3
	layer_15_qkv_sp3_tp1_pp3 [label="QKV Proj L15 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp3_pp3 -> layer_15_qkv_sp3_tp1_pp3
	layer_15_attn_sp3_tp1_pp3 [label="Attention L15 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp3_tp1_pp3 -> layer_15_attn_sp3_tp1_pp3
	layer_15_attn_out_sp3_tp1_pp3 [label="Attn Out Proj L15 SP3 TP1\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp3_tp1_pp3 -> layer_15_attn_out_sp3_tp1_pp3
	layer_15_qkv_sp3_tp2_pp3 [label="QKV Proj L15 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp3_pp3 -> layer_15_qkv_sp3_tp2_pp3
	layer_15_attn_sp3_tp2_pp3 [label="Attention L15 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp3_tp2_pp3 -> layer_15_attn_sp3_tp2_pp3
	layer_15_attn_out_sp3_tp2_pp3 [label="Attn Out Proj L15 SP3 TP2\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp3_tp2_pp3 -> layer_15_attn_out_sp3_tp2_pp3
	layer_15_qkv_sp3_tp3_pp3 [label="QKV Proj L15 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_norm_sp3_pp3 -> layer_15_qkv_sp3_tp3_pp3
	layer_15_attn_sp3_tp3_pp3 [label="Attention L15 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_qkv_sp3_tp3_pp3 -> layer_15_attn_sp3_tp3_pp3
	layer_15_attn_out_sp3_tp3_pp3 [label="Attn Out Proj L15 SP3 TP3\nPP Stage 3\nInput: [128, 2560, 128]\nOutput: [128, 2560, 128]" fillcolor=lightcoral]
	layer_15_attn_sp3_tp3_pp3 -> layer_15_attn_out_sp3_tp3_pp3
	layer_15_attn_ar_sp3_pp3 [label="Attention All-Reduce L15 SP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_attn_out_sp3_tp0_pp3 -> layer_15_attn_ar_sp3_pp3
	layer_15_attn_out_sp3_tp1_pp3 -> layer_15_attn_ar_sp3_pp3
	layer_15_attn_out_sp3_tp2_pp3 -> layer_15_attn_ar_sp3_pp3
	layer_15_attn_out_sp3_tp3_pp3 -> layer_15_attn_ar_sp3_pp3
	layer_15_attn_res_sp3_pp3 [label="Attention Residual L15 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_attn_ar_sp3_pp3 -> layer_15_attn_res_sp3_pp3
	layer_15_norm_sp3_pp3 -> layer_15_attn_res_sp3_pp3 [style=dashed]
	layer_15_post_norm_sp3_pp3 [label="Post-Attn Norm L15 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_attn_res_sp3_pp3 -> layer_15_post_norm_sp3_pp3
	layer_15_router_sp3_pp3 [label="MoE Router L15 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: Expert Selection" fillcolor=lightyellow shape=parallelogram]
	layer_15_post_norm_sp3_pp3 -> layer_15_router_sp3_pp3
	layer_15_dispatch_sp3_ep0_pp3 [label="Token Dispatch L15 SP3 EP0\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep0_pp3 [style=dashed]
	layer_15_expert_sp3_ep0_tp0_pp3 [label="Expert L15 SP3 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep0_pp3 -> layer_15_expert_sp3_ep0_tp0_pp3
	layer_15_expert_out_sp3_ep0_tp0_pp3 [label="Expert Out L15 SP3 EP0 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep0_tp0_pp3 -> layer_15_expert_out_sp3_ep0_tp0_pp3
	layer_15_expert_sp3_ep0_tp1_pp3 [label="Expert L15 SP3 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep0_pp3 -> layer_15_expert_sp3_ep0_tp1_pp3
	layer_15_expert_out_sp3_ep0_tp1_pp3 [label="Expert Out L15 SP3 EP0 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep0_tp1_pp3 -> layer_15_expert_out_sp3_ep0_tp1_pp3
	layer_15_expert_sp3_ep0_tp2_pp3 [label="Expert L15 SP3 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep0_pp3 -> layer_15_expert_sp3_ep0_tp2_pp3
	layer_15_expert_out_sp3_ep0_tp2_pp3 [label="Expert Out L15 SP3 EP0 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep0_tp2_pp3 -> layer_15_expert_out_sp3_ep0_tp2_pp3
	layer_15_expert_sp3_ep0_tp3_pp3 [label="Expert L15 SP3 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep0_pp3 -> layer_15_expert_sp3_ep0_tp3_pp3
	layer_15_expert_out_sp3_ep0_tp3_pp3 [label="Expert Out L15 SP3 EP0 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep0_tp3_pp3 -> layer_15_expert_out_sp3_ep0_tp3_pp3
	layer_15_expert_ar_sp3_ep0_pp3 [label="Expert All-Reduce L15 SP3 EP0\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep0_tp0_pp3 -> layer_15_expert_ar_sp3_ep0_pp3
	layer_15_expert_out_sp3_ep0_tp1_pp3 -> layer_15_expert_ar_sp3_ep0_pp3
	layer_15_expert_out_sp3_ep0_tp2_pp3 -> layer_15_expert_ar_sp3_ep0_pp3
	layer_15_expert_out_sp3_ep0_tp3_pp3 -> layer_15_expert_ar_sp3_ep0_pp3
	layer_15_combine_sp3_ep0_pp3 [label="Token Combine L15 SP3 EP0\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep0_pp3 -> layer_15_combine_sp3_ep0_pp3
	layer_15_dispatch_sp3_ep1_pp3 [label="Token Dispatch L15 SP3 EP1\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep1_pp3 [style=dashed]
	layer_15_expert_sp3_ep1_tp0_pp3 [label="Expert L15 SP3 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep1_pp3 -> layer_15_expert_sp3_ep1_tp0_pp3
	layer_15_expert_out_sp3_ep1_tp0_pp3 [label="Expert Out L15 SP3 EP1 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep1_tp0_pp3 -> layer_15_expert_out_sp3_ep1_tp0_pp3
	layer_15_expert_sp3_ep1_tp1_pp3 [label="Expert L15 SP3 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep1_pp3 -> layer_15_expert_sp3_ep1_tp1_pp3
	layer_15_expert_out_sp3_ep1_tp1_pp3 [label="Expert Out L15 SP3 EP1 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep1_tp1_pp3 -> layer_15_expert_out_sp3_ep1_tp1_pp3
	layer_15_expert_sp3_ep1_tp2_pp3 [label="Expert L15 SP3 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep1_pp3 -> layer_15_expert_sp3_ep1_tp2_pp3
	layer_15_expert_out_sp3_ep1_tp2_pp3 [label="Expert Out L15 SP3 EP1 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep1_tp2_pp3 -> layer_15_expert_out_sp3_ep1_tp2_pp3
	layer_15_expert_sp3_ep1_tp3_pp3 [label="Expert L15 SP3 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep1_pp3 -> layer_15_expert_sp3_ep1_tp3_pp3
	layer_15_expert_out_sp3_ep1_tp3_pp3 [label="Expert Out L15 SP3 EP1 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep1_tp3_pp3 -> layer_15_expert_out_sp3_ep1_tp3_pp3
	layer_15_expert_ar_sp3_ep1_pp3 [label="Expert All-Reduce L15 SP3 EP1\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep1_tp0_pp3 -> layer_15_expert_ar_sp3_ep1_pp3
	layer_15_expert_out_sp3_ep1_tp1_pp3 -> layer_15_expert_ar_sp3_ep1_pp3
	layer_15_expert_out_sp3_ep1_tp2_pp3 -> layer_15_expert_ar_sp3_ep1_pp3
	layer_15_expert_out_sp3_ep1_tp3_pp3 -> layer_15_expert_ar_sp3_ep1_pp3
	layer_15_combine_sp3_ep1_pp3 [label="Token Combine L15 SP3 EP1\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep1_pp3 -> layer_15_combine_sp3_ep1_pp3
	layer_15_dispatch_sp3_ep2_pp3 [label="Token Dispatch L15 SP3 EP2\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep2_pp3 [style=dashed]
	layer_15_expert_sp3_ep2_tp0_pp3 [label="Expert L15 SP3 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep2_pp3 -> layer_15_expert_sp3_ep2_tp0_pp3
	layer_15_expert_out_sp3_ep2_tp0_pp3 [label="Expert Out L15 SP3 EP2 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep2_tp0_pp3 -> layer_15_expert_out_sp3_ep2_tp0_pp3
	layer_15_expert_sp3_ep2_tp1_pp3 [label="Expert L15 SP3 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep2_pp3 -> layer_15_expert_sp3_ep2_tp1_pp3
	layer_15_expert_out_sp3_ep2_tp1_pp3 [label="Expert Out L15 SP3 EP2 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep2_tp1_pp3 -> layer_15_expert_out_sp3_ep2_tp1_pp3
	layer_15_expert_sp3_ep2_tp2_pp3 [label="Expert L15 SP3 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep2_pp3 -> layer_15_expert_sp3_ep2_tp2_pp3
	layer_15_expert_out_sp3_ep2_tp2_pp3 [label="Expert Out L15 SP3 EP2 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep2_tp2_pp3 -> layer_15_expert_out_sp3_ep2_tp2_pp3
	layer_15_expert_sp3_ep2_tp3_pp3 [label="Expert L15 SP3 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep2_pp3 -> layer_15_expert_sp3_ep2_tp3_pp3
	layer_15_expert_out_sp3_ep2_tp3_pp3 [label="Expert Out L15 SP3 EP2 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep2_tp3_pp3 -> layer_15_expert_out_sp3_ep2_tp3_pp3
	layer_15_expert_ar_sp3_ep2_pp3 [label="Expert All-Reduce L15 SP3 EP2\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep2_tp0_pp3 -> layer_15_expert_ar_sp3_ep2_pp3
	layer_15_expert_out_sp3_ep2_tp1_pp3 -> layer_15_expert_ar_sp3_ep2_pp3
	layer_15_expert_out_sp3_ep2_tp2_pp3 -> layer_15_expert_ar_sp3_ep2_pp3
	layer_15_expert_out_sp3_ep2_tp3_pp3 -> layer_15_expert_ar_sp3_ep2_pp3
	layer_15_combine_sp3_ep2_pp3 [label="Token Combine L15 SP3 EP2\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep2_pp3 -> layer_15_combine_sp3_ep2_pp3
	layer_15_dispatch_sp3_ep3_pp3 [label="Token Dispatch L15 SP3 EP3\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep3_pp3 [style=dashed]
	layer_15_expert_sp3_ep3_tp0_pp3 [label="Expert L15 SP3 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep3_pp3 -> layer_15_expert_sp3_ep3_tp0_pp3
	layer_15_expert_out_sp3_ep3_tp0_pp3 [label="Expert Out L15 SP3 EP3 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep3_tp0_pp3 -> layer_15_expert_out_sp3_ep3_tp0_pp3
	layer_15_expert_sp3_ep3_tp1_pp3 [label="Expert L15 SP3 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep3_pp3 -> layer_15_expert_sp3_ep3_tp1_pp3
	layer_15_expert_out_sp3_ep3_tp1_pp3 [label="Expert Out L15 SP3 EP3 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep3_tp1_pp3 -> layer_15_expert_out_sp3_ep3_tp1_pp3
	layer_15_expert_sp3_ep3_tp2_pp3 [label="Expert L15 SP3 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep3_pp3 -> layer_15_expert_sp3_ep3_tp2_pp3
	layer_15_expert_out_sp3_ep3_tp2_pp3 [label="Expert Out L15 SP3 EP3 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep3_tp2_pp3 -> layer_15_expert_out_sp3_ep3_tp2_pp3
	layer_15_expert_sp3_ep3_tp3_pp3 [label="Expert L15 SP3 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep3_pp3 -> layer_15_expert_sp3_ep3_tp3_pp3
	layer_15_expert_out_sp3_ep3_tp3_pp3 [label="Expert Out L15 SP3 EP3 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep3_tp3_pp3 -> layer_15_expert_out_sp3_ep3_tp3_pp3
	layer_15_expert_ar_sp3_ep3_pp3 [label="Expert All-Reduce L15 SP3 EP3\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep3_tp0_pp3 -> layer_15_expert_ar_sp3_ep3_pp3
	layer_15_expert_out_sp3_ep3_tp1_pp3 -> layer_15_expert_ar_sp3_ep3_pp3
	layer_15_expert_out_sp3_ep3_tp2_pp3 -> layer_15_expert_ar_sp3_ep3_pp3
	layer_15_expert_out_sp3_ep3_tp3_pp3 -> layer_15_expert_ar_sp3_ep3_pp3
	layer_15_combine_sp3_ep3_pp3 [label="Token Combine L15 SP3 EP3\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep3_pp3 -> layer_15_combine_sp3_ep3_pp3
	layer_15_dispatch_sp3_ep4_pp3 [label="Token Dispatch L15 SP3 EP4\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep4_pp3 [style=dashed]
	layer_15_expert_sp3_ep4_tp0_pp3 [label="Expert L15 SP3 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep4_pp3 -> layer_15_expert_sp3_ep4_tp0_pp3
	layer_15_expert_out_sp3_ep4_tp0_pp3 [label="Expert Out L15 SP3 EP4 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep4_tp0_pp3 -> layer_15_expert_out_sp3_ep4_tp0_pp3
	layer_15_expert_sp3_ep4_tp1_pp3 [label="Expert L15 SP3 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep4_pp3 -> layer_15_expert_sp3_ep4_tp1_pp3
	layer_15_expert_out_sp3_ep4_tp1_pp3 [label="Expert Out L15 SP3 EP4 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep4_tp1_pp3 -> layer_15_expert_out_sp3_ep4_tp1_pp3
	layer_15_expert_sp3_ep4_tp2_pp3 [label="Expert L15 SP3 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep4_pp3 -> layer_15_expert_sp3_ep4_tp2_pp3
	layer_15_expert_out_sp3_ep4_tp2_pp3 [label="Expert Out L15 SP3 EP4 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep4_tp2_pp3 -> layer_15_expert_out_sp3_ep4_tp2_pp3
	layer_15_expert_sp3_ep4_tp3_pp3 [label="Expert L15 SP3 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep4_pp3 -> layer_15_expert_sp3_ep4_tp3_pp3
	layer_15_expert_out_sp3_ep4_tp3_pp3 [label="Expert Out L15 SP3 EP4 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep4_tp3_pp3 -> layer_15_expert_out_sp3_ep4_tp3_pp3
	layer_15_expert_ar_sp3_ep4_pp3 [label="Expert All-Reduce L15 SP3 EP4\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep4_tp0_pp3 -> layer_15_expert_ar_sp3_ep4_pp3
	layer_15_expert_out_sp3_ep4_tp1_pp3 -> layer_15_expert_ar_sp3_ep4_pp3
	layer_15_expert_out_sp3_ep4_tp2_pp3 -> layer_15_expert_ar_sp3_ep4_pp3
	layer_15_expert_out_sp3_ep4_tp3_pp3 -> layer_15_expert_ar_sp3_ep4_pp3
	layer_15_combine_sp3_ep4_pp3 [label="Token Combine L15 SP3 EP4\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep4_pp3 -> layer_15_combine_sp3_ep4_pp3
	layer_15_dispatch_sp3_ep5_pp3 [label="Token Dispatch L15 SP3 EP5\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep5_pp3 [style=dashed]
	layer_15_expert_sp3_ep5_tp0_pp3 [label="Expert L15 SP3 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep5_pp3 -> layer_15_expert_sp3_ep5_tp0_pp3
	layer_15_expert_out_sp3_ep5_tp0_pp3 [label="Expert Out L15 SP3 EP5 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep5_tp0_pp3 -> layer_15_expert_out_sp3_ep5_tp0_pp3
	layer_15_expert_sp3_ep5_tp1_pp3 [label="Expert L15 SP3 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep5_pp3 -> layer_15_expert_sp3_ep5_tp1_pp3
	layer_15_expert_out_sp3_ep5_tp1_pp3 [label="Expert Out L15 SP3 EP5 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep5_tp1_pp3 -> layer_15_expert_out_sp3_ep5_tp1_pp3
	layer_15_expert_sp3_ep5_tp2_pp3 [label="Expert L15 SP3 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep5_pp3 -> layer_15_expert_sp3_ep5_tp2_pp3
	layer_15_expert_out_sp3_ep5_tp2_pp3 [label="Expert Out L15 SP3 EP5 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep5_tp2_pp3 -> layer_15_expert_out_sp3_ep5_tp2_pp3
	layer_15_expert_sp3_ep5_tp3_pp3 [label="Expert L15 SP3 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep5_pp3 -> layer_15_expert_sp3_ep5_tp3_pp3
	layer_15_expert_out_sp3_ep5_tp3_pp3 [label="Expert Out L15 SP3 EP5 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep5_tp3_pp3 -> layer_15_expert_out_sp3_ep5_tp3_pp3
	layer_15_expert_ar_sp3_ep5_pp3 [label="Expert All-Reduce L15 SP3 EP5\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep5_tp0_pp3 -> layer_15_expert_ar_sp3_ep5_pp3
	layer_15_expert_out_sp3_ep5_tp1_pp3 -> layer_15_expert_ar_sp3_ep5_pp3
	layer_15_expert_out_sp3_ep5_tp2_pp3 -> layer_15_expert_ar_sp3_ep5_pp3
	layer_15_expert_out_sp3_ep5_tp3_pp3 -> layer_15_expert_ar_sp3_ep5_pp3
	layer_15_combine_sp3_ep5_pp3 [label="Token Combine L15 SP3 EP5\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep5_pp3 -> layer_15_combine_sp3_ep5_pp3
	layer_15_dispatch_sp3_ep6_pp3 [label="Token Dispatch L15 SP3 EP6\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep6_pp3 [style=dashed]
	layer_15_expert_sp3_ep6_tp0_pp3 [label="Expert L15 SP3 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep6_pp3 -> layer_15_expert_sp3_ep6_tp0_pp3
	layer_15_expert_out_sp3_ep6_tp0_pp3 [label="Expert Out L15 SP3 EP6 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep6_tp0_pp3 -> layer_15_expert_out_sp3_ep6_tp0_pp3
	layer_15_expert_sp3_ep6_tp1_pp3 [label="Expert L15 SP3 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep6_pp3 -> layer_15_expert_sp3_ep6_tp1_pp3
	layer_15_expert_out_sp3_ep6_tp1_pp3 [label="Expert Out L15 SP3 EP6 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep6_tp1_pp3 -> layer_15_expert_out_sp3_ep6_tp1_pp3
	layer_15_expert_sp3_ep6_tp2_pp3 [label="Expert L15 SP3 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep6_pp3 -> layer_15_expert_sp3_ep6_tp2_pp3
	layer_15_expert_out_sp3_ep6_tp2_pp3 [label="Expert Out L15 SP3 EP6 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep6_tp2_pp3 -> layer_15_expert_out_sp3_ep6_tp2_pp3
	layer_15_expert_sp3_ep6_tp3_pp3 [label="Expert L15 SP3 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep6_pp3 -> layer_15_expert_sp3_ep6_tp3_pp3
	layer_15_expert_out_sp3_ep6_tp3_pp3 [label="Expert Out L15 SP3 EP6 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep6_tp3_pp3 -> layer_15_expert_out_sp3_ep6_tp3_pp3
	layer_15_expert_ar_sp3_ep6_pp3 [label="Expert All-Reduce L15 SP3 EP6\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep6_tp0_pp3 -> layer_15_expert_ar_sp3_ep6_pp3
	layer_15_expert_out_sp3_ep6_tp1_pp3 -> layer_15_expert_ar_sp3_ep6_pp3
	layer_15_expert_out_sp3_ep6_tp2_pp3 -> layer_15_expert_ar_sp3_ep6_pp3
	layer_15_expert_out_sp3_ep6_tp3_pp3 -> layer_15_expert_ar_sp3_ep6_pp3
	layer_15_combine_sp3_ep6_pp3 [label="Token Combine L15 SP3 EP6\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep6_pp3 -> layer_15_combine_sp3_ep6_pp3
	layer_15_dispatch_sp3_ep7_pp3 [label="Token Dispatch L15 SP3 EP7\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep7_pp3 [style=dashed]
	layer_15_expert_sp3_ep7_tp0_pp3 [label="Expert L15 SP3 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep7_pp3 -> layer_15_expert_sp3_ep7_tp0_pp3
	layer_15_expert_out_sp3_ep7_tp0_pp3 [label="Expert Out L15 SP3 EP7 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep7_tp0_pp3 -> layer_15_expert_out_sp3_ep7_tp0_pp3
	layer_15_expert_sp3_ep7_tp1_pp3 [label="Expert L15 SP3 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep7_pp3 -> layer_15_expert_sp3_ep7_tp1_pp3
	layer_15_expert_out_sp3_ep7_tp1_pp3 [label="Expert Out L15 SP3 EP7 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep7_tp1_pp3 -> layer_15_expert_out_sp3_ep7_tp1_pp3
	layer_15_expert_sp3_ep7_tp2_pp3 [label="Expert L15 SP3 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep7_pp3 -> layer_15_expert_sp3_ep7_tp2_pp3
	layer_15_expert_out_sp3_ep7_tp2_pp3 [label="Expert Out L15 SP3 EP7 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep7_tp2_pp3 -> layer_15_expert_out_sp3_ep7_tp2_pp3
	layer_15_expert_sp3_ep7_tp3_pp3 [label="Expert L15 SP3 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep7_pp3 -> layer_15_expert_sp3_ep7_tp3_pp3
	layer_15_expert_out_sp3_ep7_tp3_pp3 [label="Expert Out L15 SP3 EP7 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep7_tp3_pp3 -> layer_15_expert_out_sp3_ep7_tp3_pp3
	layer_15_expert_ar_sp3_ep7_pp3 [label="Expert All-Reduce L15 SP3 EP7\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep7_tp0_pp3 -> layer_15_expert_ar_sp3_ep7_pp3
	layer_15_expert_out_sp3_ep7_tp1_pp3 -> layer_15_expert_ar_sp3_ep7_pp3
	layer_15_expert_out_sp3_ep7_tp2_pp3 -> layer_15_expert_ar_sp3_ep7_pp3
	layer_15_expert_out_sp3_ep7_tp3_pp3 -> layer_15_expert_ar_sp3_ep7_pp3
	layer_15_combine_sp3_ep7_pp3 [label="Token Combine L15 SP3 EP7\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep7_pp3 -> layer_15_combine_sp3_ep7_pp3
	layer_15_dispatch_sp3_ep8_pp3 [label="Token Dispatch L15 SP3 EP8\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep8_pp3 [style=dashed]
	layer_15_expert_sp3_ep8_tp0_pp3 [label="Expert L15 SP3 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep8_pp3 -> layer_15_expert_sp3_ep8_tp0_pp3
	layer_15_expert_out_sp3_ep8_tp0_pp3 [label="Expert Out L15 SP3 EP8 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep8_tp0_pp3 -> layer_15_expert_out_sp3_ep8_tp0_pp3
	layer_15_expert_sp3_ep8_tp1_pp3 [label="Expert L15 SP3 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep8_pp3 -> layer_15_expert_sp3_ep8_tp1_pp3
	layer_15_expert_out_sp3_ep8_tp1_pp3 [label="Expert Out L15 SP3 EP8 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep8_tp1_pp3 -> layer_15_expert_out_sp3_ep8_tp1_pp3
	layer_15_expert_sp3_ep8_tp2_pp3 [label="Expert L15 SP3 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep8_pp3 -> layer_15_expert_sp3_ep8_tp2_pp3
	layer_15_expert_out_sp3_ep8_tp2_pp3 [label="Expert Out L15 SP3 EP8 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep8_tp2_pp3 -> layer_15_expert_out_sp3_ep8_tp2_pp3
	layer_15_expert_sp3_ep8_tp3_pp3 [label="Expert L15 SP3 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep8_pp3 -> layer_15_expert_sp3_ep8_tp3_pp3
	layer_15_expert_out_sp3_ep8_tp3_pp3 [label="Expert Out L15 SP3 EP8 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep8_tp3_pp3 -> layer_15_expert_out_sp3_ep8_tp3_pp3
	layer_15_expert_ar_sp3_ep8_pp3 [label="Expert All-Reduce L15 SP3 EP8\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep8_tp0_pp3 -> layer_15_expert_ar_sp3_ep8_pp3
	layer_15_expert_out_sp3_ep8_tp1_pp3 -> layer_15_expert_ar_sp3_ep8_pp3
	layer_15_expert_out_sp3_ep8_tp2_pp3 -> layer_15_expert_ar_sp3_ep8_pp3
	layer_15_expert_out_sp3_ep8_tp3_pp3 -> layer_15_expert_ar_sp3_ep8_pp3
	layer_15_combine_sp3_ep8_pp3 [label="Token Combine L15 SP3 EP8\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep8_pp3 -> layer_15_combine_sp3_ep8_pp3
	layer_15_dispatch_sp3_ep9_pp3 [label="Token Dispatch L15 SP3 EP9\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep9_pp3 [style=dashed]
	layer_15_expert_sp3_ep9_tp0_pp3 [label="Expert L15 SP3 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep9_pp3 -> layer_15_expert_sp3_ep9_tp0_pp3
	layer_15_expert_out_sp3_ep9_tp0_pp3 [label="Expert Out L15 SP3 EP9 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep9_tp0_pp3 -> layer_15_expert_out_sp3_ep9_tp0_pp3
	layer_15_expert_sp3_ep9_tp1_pp3 [label="Expert L15 SP3 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep9_pp3 -> layer_15_expert_sp3_ep9_tp1_pp3
	layer_15_expert_out_sp3_ep9_tp1_pp3 [label="Expert Out L15 SP3 EP9 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep9_tp1_pp3 -> layer_15_expert_out_sp3_ep9_tp1_pp3
	layer_15_expert_sp3_ep9_tp2_pp3 [label="Expert L15 SP3 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep9_pp3 -> layer_15_expert_sp3_ep9_tp2_pp3
	layer_15_expert_out_sp3_ep9_tp2_pp3 [label="Expert Out L15 SP3 EP9 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep9_tp2_pp3 -> layer_15_expert_out_sp3_ep9_tp2_pp3
	layer_15_expert_sp3_ep9_tp3_pp3 [label="Expert L15 SP3 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep9_pp3 -> layer_15_expert_sp3_ep9_tp3_pp3
	layer_15_expert_out_sp3_ep9_tp3_pp3 [label="Expert Out L15 SP3 EP9 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep9_tp3_pp3 -> layer_15_expert_out_sp3_ep9_tp3_pp3
	layer_15_expert_ar_sp3_ep9_pp3 [label="Expert All-Reduce L15 SP3 EP9\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep9_tp0_pp3 -> layer_15_expert_ar_sp3_ep9_pp3
	layer_15_expert_out_sp3_ep9_tp1_pp3 -> layer_15_expert_ar_sp3_ep9_pp3
	layer_15_expert_out_sp3_ep9_tp2_pp3 -> layer_15_expert_ar_sp3_ep9_pp3
	layer_15_expert_out_sp3_ep9_tp3_pp3 -> layer_15_expert_ar_sp3_ep9_pp3
	layer_15_combine_sp3_ep9_pp3 [label="Token Combine L15 SP3 EP9\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep9_pp3 -> layer_15_combine_sp3_ep9_pp3
	layer_15_dispatch_sp3_ep10_pp3 [label="Token Dispatch L15 SP3 EP10\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep10_pp3 [style=dashed]
	layer_15_expert_sp3_ep10_tp0_pp3 [label="Expert L15 SP3 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep10_pp3 -> layer_15_expert_sp3_ep10_tp0_pp3
	layer_15_expert_out_sp3_ep10_tp0_pp3 [label="Expert Out L15 SP3 EP10 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep10_tp0_pp3 -> layer_15_expert_out_sp3_ep10_tp0_pp3
	layer_15_expert_sp3_ep10_tp1_pp3 [label="Expert L15 SP3 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep10_pp3 -> layer_15_expert_sp3_ep10_tp1_pp3
	layer_15_expert_out_sp3_ep10_tp1_pp3 [label="Expert Out L15 SP3 EP10 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep10_tp1_pp3 -> layer_15_expert_out_sp3_ep10_tp1_pp3
	layer_15_expert_sp3_ep10_tp2_pp3 [label="Expert L15 SP3 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep10_pp3 -> layer_15_expert_sp3_ep10_tp2_pp3
	layer_15_expert_out_sp3_ep10_tp2_pp3 [label="Expert Out L15 SP3 EP10 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep10_tp2_pp3 -> layer_15_expert_out_sp3_ep10_tp2_pp3
	layer_15_expert_sp3_ep10_tp3_pp3 [label="Expert L15 SP3 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep10_pp3 -> layer_15_expert_sp3_ep10_tp3_pp3
	layer_15_expert_out_sp3_ep10_tp3_pp3 [label="Expert Out L15 SP3 EP10 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep10_tp3_pp3 -> layer_15_expert_out_sp3_ep10_tp3_pp3
	layer_15_expert_ar_sp3_ep10_pp3 [label="Expert All-Reduce L15 SP3 EP10\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep10_tp0_pp3 -> layer_15_expert_ar_sp3_ep10_pp3
	layer_15_expert_out_sp3_ep10_tp1_pp3 -> layer_15_expert_ar_sp3_ep10_pp3
	layer_15_expert_out_sp3_ep10_tp2_pp3 -> layer_15_expert_ar_sp3_ep10_pp3
	layer_15_expert_out_sp3_ep10_tp3_pp3 -> layer_15_expert_ar_sp3_ep10_pp3
	layer_15_combine_sp3_ep10_pp3 [label="Token Combine L15 SP3 EP10\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep10_pp3 -> layer_15_combine_sp3_ep10_pp3
	layer_15_dispatch_sp3_ep11_pp3 [label="Token Dispatch L15 SP3 EP11\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep11_pp3 [style=dashed]
	layer_15_expert_sp3_ep11_tp0_pp3 [label="Expert L15 SP3 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep11_pp3 -> layer_15_expert_sp3_ep11_tp0_pp3
	layer_15_expert_out_sp3_ep11_tp0_pp3 [label="Expert Out L15 SP3 EP11 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep11_tp0_pp3 -> layer_15_expert_out_sp3_ep11_tp0_pp3
	layer_15_expert_sp3_ep11_tp1_pp3 [label="Expert L15 SP3 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep11_pp3 -> layer_15_expert_sp3_ep11_tp1_pp3
	layer_15_expert_out_sp3_ep11_tp1_pp3 [label="Expert Out L15 SP3 EP11 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep11_tp1_pp3 -> layer_15_expert_out_sp3_ep11_tp1_pp3
	layer_15_expert_sp3_ep11_tp2_pp3 [label="Expert L15 SP3 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep11_pp3 -> layer_15_expert_sp3_ep11_tp2_pp3
	layer_15_expert_out_sp3_ep11_tp2_pp3 [label="Expert Out L15 SP3 EP11 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep11_tp2_pp3 -> layer_15_expert_out_sp3_ep11_tp2_pp3
	layer_15_expert_sp3_ep11_tp3_pp3 [label="Expert L15 SP3 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep11_pp3 -> layer_15_expert_sp3_ep11_tp3_pp3
	layer_15_expert_out_sp3_ep11_tp3_pp3 [label="Expert Out L15 SP3 EP11 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep11_tp3_pp3 -> layer_15_expert_out_sp3_ep11_tp3_pp3
	layer_15_expert_ar_sp3_ep11_pp3 [label="Expert All-Reduce L15 SP3 EP11\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep11_tp0_pp3 -> layer_15_expert_ar_sp3_ep11_pp3
	layer_15_expert_out_sp3_ep11_tp1_pp3 -> layer_15_expert_ar_sp3_ep11_pp3
	layer_15_expert_out_sp3_ep11_tp2_pp3 -> layer_15_expert_ar_sp3_ep11_pp3
	layer_15_expert_out_sp3_ep11_tp3_pp3 -> layer_15_expert_ar_sp3_ep11_pp3
	layer_15_combine_sp3_ep11_pp3 [label="Token Combine L15 SP3 EP11\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep11_pp3 -> layer_15_combine_sp3_ep11_pp3
	layer_15_dispatch_sp3_ep12_pp3 [label="Token Dispatch L15 SP3 EP12\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep12_pp3 [style=dashed]
	layer_15_expert_sp3_ep12_tp0_pp3 [label="Expert L15 SP3 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep12_pp3 -> layer_15_expert_sp3_ep12_tp0_pp3
	layer_15_expert_out_sp3_ep12_tp0_pp3 [label="Expert Out L15 SP3 EP12 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep12_tp0_pp3 -> layer_15_expert_out_sp3_ep12_tp0_pp3
	layer_15_expert_sp3_ep12_tp1_pp3 [label="Expert L15 SP3 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep12_pp3 -> layer_15_expert_sp3_ep12_tp1_pp3
	layer_15_expert_out_sp3_ep12_tp1_pp3 [label="Expert Out L15 SP3 EP12 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep12_tp1_pp3 -> layer_15_expert_out_sp3_ep12_tp1_pp3
	layer_15_expert_sp3_ep12_tp2_pp3 [label="Expert L15 SP3 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep12_pp3 -> layer_15_expert_sp3_ep12_tp2_pp3
	layer_15_expert_out_sp3_ep12_tp2_pp3 [label="Expert Out L15 SP3 EP12 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep12_tp2_pp3 -> layer_15_expert_out_sp3_ep12_tp2_pp3
	layer_15_expert_sp3_ep12_tp3_pp3 [label="Expert L15 SP3 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep12_pp3 -> layer_15_expert_sp3_ep12_tp3_pp3
	layer_15_expert_out_sp3_ep12_tp3_pp3 [label="Expert Out L15 SP3 EP12 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep12_tp3_pp3 -> layer_15_expert_out_sp3_ep12_tp3_pp3
	layer_15_expert_ar_sp3_ep12_pp3 [label="Expert All-Reduce L15 SP3 EP12\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep12_tp0_pp3 -> layer_15_expert_ar_sp3_ep12_pp3
	layer_15_expert_out_sp3_ep12_tp1_pp3 -> layer_15_expert_ar_sp3_ep12_pp3
	layer_15_expert_out_sp3_ep12_tp2_pp3 -> layer_15_expert_ar_sp3_ep12_pp3
	layer_15_expert_out_sp3_ep12_tp3_pp3 -> layer_15_expert_ar_sp3_ep12_pp3
	layer_15_combine_sp3_ep12_pp3 [label="Token Combine L15 SP3 EP12\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep12_pp3 -> layer_15_combine_sp3_ep12_pp3
	layer_15_dispatch_sp3_ep13_pp3 [label="Token Dispatch L15 SP3 EP13\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep13_pp3 [style=dashed]
	layer_15_expert_sp3_ep13_tp0_pp3 [label="Expert L15 SP3 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep13_pp3 -> layer_15_expert_sp3_ep13_tp0_pp3
	layer_15_expert_out_sp3_ep13_tp0_pp3 [label="Expert Out L15 SP3 EP13 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep13_tp0_pp3 -> layer_15_expert_out_sp3_ep13_tp0_pp3
	layer_15_expert_sp3_ep13_tp1_pp3 [label="Expert L15 SP3 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep13_pp3 -> layer_15_expert_sp3_ep13_tp1_pp3
	layer_15_expert_out_sp3_ep13_tp1_pp3 [label="Expert Out L15 SP3 EP13 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep13_tp1_pp3 -> layer_15_expert_out_sp3_ep13_tp1_pp3
	layer_15_expert_sp3_ep13_tp2_pp3 [label="Expert L15 SP3 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep13_pp3 -> layer_15_expert_sp3_ep13_tp2_pp3
	layer_15_expert_out_sp3_ep13_tp2_pp3 [label="Expert Out L15 SP3 EP13 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep13_tp2_pp3 -> layer_15_expert_out_sp3_ep13_tp2_pp3
	layer_15_expert_sp3_ep13_tp3_pp3 [label="Expert L15 SP3 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep13_pp3 -> layer_15_expert_sp3_ep13_tp3_pp3
	layer_15_expert_out_sp3_ep13_tp3_pp3 [label="Expert Out L15 SP3 EP13 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep13_tp3_pp3 -> layer_15_expert_out_sp3_ep13_tp3_pp3
	layer_15_expert_ar_sp3_ep13_pp3 [label="Expert All-Reduce L15 SP3 EP13\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep13_tp0_pp3 -> layer_15_expert_ar_sp3_ep13_pp3
	layer_15_expert_out_sp3_ep13_tp1_pp3 -> layer_15_expert_ar_sp3_ep13_pp3
	layer_15_expert_out_sp3_ep13_tp2_pp3 -> layer_15_expert_ar_sp3_ep13_pp3
	layer_15_expert_out_sp3_ep13_tp3_pp3 -> layer_15_expert_ar_sp3_ep13_pp3
	layer_15_combine_sp3_ep13_pp3 [label="Token Combine L15 SP3 EP13\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep13_pp3 -> layer_15_combine_sp3_ep13_pp3
	layer_15_dispatch_sp3_ep14_pp3 [label="Token Dispatch L15 SP3 EP14\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep14_pp3 [style=dashed]
	layer_15_expert_sp3_ep14_tp0_pp3 [label="Expert L15 SP3 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep14_pp3 -> layer_15_expert_sp3_ep14_tp0_pp3
	layer_15_expert_out_sp3_ep14_tp0_pp3 [label="Expert Out L15 SP3 EP14 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep14_tp0_pp3 -> layer_15_expert_out_sp3_ep14_tp0_pp3
	layer_15_expert_sp3_ep14_tp1_pp3 [label="Expert L15 SP3 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep14_pp3 -> layer_15_expert_sp3_ep14_tp1_pp3
	layer_15_expert_out_sp3_ep14_tp1_pp3 [label="Expert Out L15 SP3 EP14 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep14_tp1_pp3 -> layer_15_expert_out_sp3_ep14_tp1_pp3
	layer_15_expert_sp3_ep14_tp2_pp3 [label="Expert L15 SP3 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep14_pp3 -> layer_15_expert_sp3_ep14_tp2_pp3
	layer_15_expert_out_sp3_ep14_tp2_pp3 [label="Expert Out L15 SP3 EP14 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep14_tp2_pp3 -> layer_15_expert_out_sp3_ep14_tp2_pp3
	layer_15_expert_sp3_ep14_tp3_pp3 [label="Expert L15 SP3 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep14_pp3 -> layer_15_expert_sp3_ep14_tp3_pp3
	layer_15_expert_out_sp3_ep14_tp3_pp3 [label="Expert Out L15 SP3 EP14 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep14_tp3_pp3 -> layer_15_expert_out_sp3_ep14_tp3_pp3
	layer_15_expert_ar_sp3_ep14_pp3 [label="Expert All-Reduce L15 SP3 EP14\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep14_tp0_pp3 -> layer_15_expert_ar_sp3_ep14_pp3
	layer_15_expert_out_sp3_ep14_tp1_pp3 -> layer_15_expert_ar_sp3_ep14_pp3
	layer_15_expert_out_sp3_ep14_tp2_pp3 -> layer_15_expert_ar_sp3_ep14_pp3
	layer_15_expert_out_sp3_ep14_tp3_pp3 -> layer_15_expert_ar_sp3_ep14_pp3
	layer_15_combine_sp3_ep14_pp3 [label="Token Combine L15 SP3 EP14\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep14_pp3 -> layer_15_combine_sp3_ep14_pp3
	layer_15_dispatch_sp3_ep15_pp3 [label="Token Dispatch L15 SP3 EP15\nPP Stage 3\nSelected Tokens" fillcolor=orange shape=ellipse]
	layer_15_router_sp3_pp3 -> layer_15_dispatch_sp3_ep15_pp3 [style=dashed]
	layer_15_expert_sp3_ep15_tp0_pp3 [label="Expert L15 SP3 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep15_pp3 -> layer_15_expert_sp3_ep15_tp0_pp3
	layer_15_expert_out_sp3_ep15_tp0_pp3 [label="Expert Out L15 SP3 EP15 TP0\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep15_tp0_pp3 -> layer_15_expert_out_sp3_ep15_tp0_pp3
	layer_15_expert_sp3_ep15_tp1_pp3 [label="Expert L15 SP3 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep15_pp3 -> layer_15_expert_sp3_ep15_tp1_pp3
	layer_15_expert_out_sp3_ep15_tp1_pp3 [label="Expert Out L15 SP3 EP15 TP1\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep15_tp1_pp3 -> layer_15_expert_out_sp3_ep15_tp1_pp3
	layer_15_expert_sp3_ep15_tp2_pp3 [label="Expert L15 SP3 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep15_pp3 -> layer_15_expert_sp3_ep15_tp2_pp3
	layer_15_expert_out_sp3_ep15_tp2_pp3 [label="Expert Out L15 SP3 EP15 TP2\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep15_tp2_pp3 -> layer_15_expert_out_sp3_ep15_tp2_pp3
	layer_15_expert_sp3_ep15_tp3_pp3 [label="Expert L15 SP3 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_dispatch_sp3_ep15_pp3 -> layer_15_expert_sp3_ep15_tp3_pp3
	layer_15_expert_out_sp3_ep15_tp3_pp3 [label="Expert Out L15 SP3 EP15 TP3\nPP Stage 3\nInput: [tokens, 512]\nOutput: [tokens, 512]" fillcolor=lightgreen]
	layer_15_expert_sp3_ep15_tp3_pp3 -> layer_15_expert_out_sp3_ep15_tp3_pp3
	layer_15_expert_ar_sp3_ep15_pp3 [label="Expert All-Reduce L15 SP3 EP15\nPP Stage 3\nTP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_expert_out_sp3_ep15_tp0_pp3 -> layer_15_expert_ar_sp3_ep15_pp3
	layer_15_expert_out_sp3_ep15_tp1_pp3 -> layer_15_expert_ar_sp3_ep15_pp3
	layer_15_expert_out_sp3_ep15_tp2_pp3 -> layer_15_expert_ar_sp3_ep15_pp3
	layer_15_expert_out_sp3_ep15_tp3_pp3 -> layer_15_expert_ar_sp3_ep15_pp3
	layer_15_combine_sp3_ep15_pp3 [label="Token Combine L15 SP3 EP15\nPP Stage 3\nCombined Output" fillcolor=orange shape=ellipse]
	layer_15_expert_ar_sp3_ep15_pp3 -> layer_15_combine_sp3_ep15_pp3
	layer_15_moe_all2all_sp3_pp3 [label="MoE All-to-All L15 SP3\nPP Stage 3\nEP Ranks: 0-15" fillcolor=orange shape=ellipse]
	layer_15_combine_sp3_ep0_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep1_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep2_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep3_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep4_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep5_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep6_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep7_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep8_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep9_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep10_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep11_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep12_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep13_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep14_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_combine_sp3_ep15_pp3 -> layer_15_moe_all2all_sp3_pp3
	layer_15_mlp_out_sp3_pp3 [label="MoE Output L15 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_moe_all2all_sp3_pp3 -> layer_15_mlp_out_sp3_pp3
	layer_15_mlp_res_sp3_pp3 [label="MLP Residual L15 SP3\nPP Stage 3\nInput: [128, 2560, 512]\nOutput: [128, 2560, 512]" fillcolor=lightblue]
	layer_15_mlp_out_sp3_pp3 -> layer_15_mlp_res_sp3_pp3
	layer_15_attn_res_sp3_pp3 -> layer_15_mlp_res_sp3_pp3 [style=dashed]
	sp_allgather_pp0 [label="SP All-Gather\nPP Stage 0\nSP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_3_mlp_res_sp0_pp0 -> sp_allgather_pp0
	layer_3_mlp_res_sp1_pp0 -> sp_allgather_pp0
	layer_3_mlp_res_sp2_pp0 -> sp_allgather_pp0
	layer_3_mlp_res_sp3_pp0 -> sp_allgather_pp0
	output_pp0 [label="Pipeline Stage 0 Output\n[128, 10240, 512]" fillcolor=lightyellow shape=parallelogram]
	sp_allgather_pp0 -> output_pp0
	output_pp0 -> sp_allgather_pp1 [style=dashed]
	sp_allgather_pp1 [label="SP All-Gather\nPP Stage 1\nSP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_7_mlp_res_sp0_pp1 -> sp_allgather_pp1
	layer_7_mlp_res_sp1_pp1 -> sp_allgather_pp1
	layer_7_mlp_res_sp2_pp1 -> sp_allgather_pp1
	layer_7_mlp_res_sp3_pp1 -> sp_allgather_pp1
	output_pp1 [label="Pipeline Stage 1 Output\n[128, 10240, 512]" fillcolor=lightyellow shape=parallelogram]
	sp_allgather_pp1 -> output_pp1
	output_pp1 -> sp_allgather_pp2 [style=dashed]
	sp_allgather_pp2 [label="SP All-Gather\nPP Stage 2\nSP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_11_mlp_res_sp0_pp2 -> sp_allgather_pp2
	layer_11_mlp_res_sp1_pp2 -> sp_allgather_pp2
	layer_11_mlp_res_sp2_pp2 -> sp_allgather_pp2
	layer_11_mlp_res_sp3_pp2 -> sp_allgather_pp2
	output_pp2 [label="Pipeline Stage 2 Output\n[128, 10240, 512]" fillcolor=lightyellow shape=parallelogram]
	sp_allgather_pp2 -> output_pp2
	output_pp2 -> sp_allgather_pp3 [style=dashed]
	sp_allgather_pp3 [label="SP All-Gather\nPP Stage 3\nSP Ranks: 0-3" fillcolor=orange shape=ellipse]
	layer_15_mlp_res_sp0_pp3 -> sp_allgather_pp3
	layer_15_mlp_res_sp1_pp3 -> sp_allgather_pp3
	layer_15_mlp_res_sp2_pp3 -> sp_allgather_pp3
	layer_15_mlp_res_sp3_pp3 -> sp_allgather_pp3
	output_pp3 [label="Pipeline Stage 3 Output\n[128, 10240, 512]" fillcolor=lightyellow shape=parallelogram]
	sp_allgather_pp3 -> output_pp3
	output [label="Final Output\nBatch Size: 128\nSeq Length: 10240\nToken Dim: 512" fillcolor=lightgreen shape=ellipse]
	output_pp3 -> output
}
