<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: LLaMA3&#45;70B&#45;Parallel&#45;Strategy&#45;DAG Pages: 1 -->
<svg width="9000pt" height="911pt"
 viewBox="0.00 0.00 2160.00 218.52" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.53 0.53) rotate(0) translate(4 1729.7)">
<title>LLaMA3&#45;70B&#45;Parallel&#45;Strategy&#45;DAG</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1729.7 17133,-1729.7 17133,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="lightyellow" stroke="black" d="M20,-305.54C20,-305.54 8570,-305.54 8570,-305.54 8576,-305.54 8582,-311.54 8582,-317.54 8582,-317.54 8582,-1705.7 8582,-1705.7 8582,-1711.7 8576,-1717.7 8570,-1717.7 8570,-1717.7 20,-1717.7 20,-1717.7 14,-1717.7 8,-1711.7 8,-1705.7 8,-1705.7 8,-317.54 8,-317.54 8,-311.54 14,-305.54 20,-305.54"/>
<text text-anchor="middle" x="4295" y="-1702.5" font-family="Arial Bold" font-size="14.00">Pipeline Stage 0: Layers 0&#45;39 (GPUs 0,1,2,3)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage1</title>
<path fill="lightsteelblue" stroke="black" d="M8602,-8C8602,-8 17109,-8 17109,-8 17115,-8 17121,-14 17121,-20 17121,-20 17121,-1304.7 17121,-1304.7 17121,-1310.7 17115,-1316.7 17109,-1316.7 17109,-1316.7 8602,-1316.7 8602,-1316.7 8596,-1316.7 8590,-1310.7 8590,-1304.7 8590,-1304.7 8590,-20 8590,-20 8590,-14 8596,-8 8602,-8"/>
<text text-anchor="middle" x="12855.5" y="-1301.5" font-family="Arial Bold" font-size="14.00">Pipeline Stage 1: Layers 40&#45;79 (GPUs 4,5,6,7)</text>
</g>
<!-- input_stage0 -->
<g id="node1" class="node">
<title>input_stage0</title>
<polygon fill="lightgreen" stroke="black" points="261.5,-1660.7 16.5,-1660.7 16.5,-1608.7 261.5,-1608.7 261.5,-1660.7"/>
<text text-anchor="middle" x="139" y="-1648.7" font-family="Arial" font-size="10.00">Input Embedding</text>
<text text-anchor="middle" x="139" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="139" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch_size=8, seq_len=4096]</text>
<text text-anchor="middle" x="139" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch_size=8, seq_len=4096, hidden=8192]</text>
</g>
<!-- layer0_qkv_proj -->
<g id="node2" class="node">
<title>layer0_qkv_proj</title>
<polygon fill="lightblue" stroke="black" points="358,-1536.7 124,-1536.7 124,-1484.7 358,-1484.7 358,-1536.7"/>
<text text-anchor="middle" x="241" y="-1524.7" font-family="Arial" font-size="10.00">Layer 0: QKV Projection</text>
<text text-anchor="middle" x="241" y="-1513.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="241" y="-1502.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="241" y="-1491.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=64, d_k=128]</text>
</g>
<!-- input_stage0&#45;&gt;layer0_qkv_proj -->
<g id="edge1" class="edge">
<title>input_stage0&#45;&gt;layer0_qkv_proj</title>
<path fill="none" stroke="black" d="M160.13,-1608.42C175.59,-1589.93 196.69,-1564.69 213.47,-1544.63"/>
<polygon fill="black" stroke="black" points="216.16,-1546.86 219.89,-1536.94 210.79,-1542.37 216.16,-1546.86"/>
</g>
<!-- layer0_qkv_split -->
<g id="node3" class="node">
<title>layer0_qkv_split</title>
<polygon fill="lightcyan" stroke="black" points="586.21,-1447.7 132.5,-1447.7 15.79,-1343.7 469.5,-1343.7 586.21,-1447.7"/>
<text text-anchor="middle" x="301" y="-1409.7" font-family="Arial" font-size="10.00">Layer 0: QKV Split (TP=4)</text>
<text text-anchor="middle" x="301" y="-1398.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="301" y="-1387.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="301" y="-1376.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128] per GPU</text>
</g>
<!-- layer0_qkv_proj&#45;&gt;layer0_qkv_split -->
<g id="edge2" class="edge">
<title>layer0_qkv_proj&#45;&gt;layer0_qkv_split</title>
<path fill="none" stroke="black" d="M254.32,-1484.62C258.7,-1476.35 263.79,-1466.77 268.96,-1457.04"/>
<polygon fill="black" stroke="black" points="272.11,-1458.57 273.71,-1448.1 265.93,-1455.29 272.11,-1458.57"/>
</g>
<!-- layer0_attention -->
<g id="node4" class="node">
<title>layer0_attention</title>
<polygon fill="lightblue" stroke="black" points="418,-1259.7 184,-1259.7 184,-1207.7 418,-1207.7 418,-1259.7"/>
<text text-anchor="middle" x="301" y="-1247.7" font-family="Arial" font-size="10.00">Layer 0: Attention Compute</text>
<text text-anchor="middle" x="301" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="301" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="301" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128]</text>
</g>
<!-- layer0_qkv_split&#45;&gt;layer0_attention -->
<g id="edge3" class="edge">
<title>layer0_qkv_split&#45;&gt;layer0_attention</title>
<path fill="none" stroke="black" d="M301,-1343.63C301,-1319.58 301,-1291.5 301,-1269.87"/>
<polygon fill="black" stroke="black" points="304.5,-1269.82 301,-1259.82 297.5,-1269.82 304.5,-1269.82"/>
</g>
<!-- layer0_attn_allreduce -->
<g id="node5" class="node">
<title>layer0_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="301" cy="-1098.93" rx="160.53" ry="36.54"/>
<text text-anchor="middle" x="301" y="-1112.93" font-family="Arial" font-size="10.00">Layer 0: Attention All&#45;Reduce</text>
<text text-anchor="middle" x="301" y="-1101.93" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="301" y="-1090.93" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="301" y="-1079.93" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer0_attention&#45;&gt;layer0_attn_allreduce -->
<g id="edge4" class="edge">
<title>layer0_attention&#45;&gt;layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M301,-1207.41C301,-1190.1 301,-1166.63 301,-1146.05"/>
<polygon fill="black" stroke="black" points="304.5,-1145.9 301,-1135.9 297.5,-1145.9 304.5,-1145.9"/>
</g>
<!-- layer0_norm1 -->
<g id="node10" class="node">
<title>layer0_norm1</title>
<polygon fill="lightblue" stroke="black" points="402.5,-999.16 199.5,-999.16 199.5,-947.16 402.5,-947.16 402.5,-999.16"/>
<text text-anchor="middle" x="301" y="-987.16" font-family="Arial" font-size="10.00">Layer 0: RMSNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="301" y="-976.16" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="301" y="-965.16" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="301" y="-954.16" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer0_attn_allreduce&#45;&gt;layer0_norm1 -->
<g id="edge5" class="edge">
<title>layer0_attn_allreduce&#45;&gt;layer0_norm1</title>
<path fill="none" stroke="black" d="M301,-1062.13C301,-1045.61 301,-1026.06 301,-1009.59"/>
<polygon fill="black" stroke="black" points="304.5,-1009.28 301,-999.28 297.5,-1009.28 304.5,-1009.28"/>
</g>
<!-- layer0_ffn_gate -->
<g id="node6" class="node">
<title>layer0_ffn_gate</title>
<polygon fill="lightblue" stroke="black" points="425,-873.39 177,-873.39 177,-821.39 425,-821.39 425,-873.39"/>
<text text-anchor="middle" x="301" y="-861.39" font-family="Arial" font-size="10.00">Layer 0: FFN Gate Proj</text>
<text text-anchor="middle" x="301" y="-850.39" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="301" y="-839.39" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="301" y="-828.39" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer0_ffn_up -->
<g id="node7" class="node">
<title>layer0_ffn_up</title>
<polygon fill="lightblue" stroke="black" points="425,-762.85 177,-762.85 177,-710.85 425,-710.85 425,-762.85"/>
<text text-anchor="middle" x="301" y="-750.85" font-family="Arial" font-size="10.00">Layer 0: FFN Up Proj</text>
<text text-anchor="middle" x="301" y="-739.85" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="301" y="-728.85" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="301" y="-717.85" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer0_ffn_gate&#45;&gt;layer0_ffn_up -->
<g id="edge7" class="edge">
<title>layer0_ffn_gate&#45;&gt;layer0_ffn_up</title>
<path fill="none" stroke="black" d="M301,-821.21C301,-806.97 301,-788.92 301,-773.27"/>
<polygon fill="black" stroke="black" points="304.5,-772.89 301,-762.89 297.5,-772.89 304.5,-772.89"/>
</g>
<!-- layer0_ffn_down -->
<g id="node8" class="node">
<title>layer0_ffn_down</title>
<polygon fill="lightblue" stroke="black" points="423.5,-663.08 178.5,-663.08 178.5,-611.08 423.5,-611.08 423.5,-663.08"/>
<text text-anchor="middle" x="301" y="-651.08" font-family="Arial" font-size="10.00">Layer 0: FFN Down Proj</text>
<text text-anchor="middle" x="301" y="-640.08" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="301" y="-629.08" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, ffn_dim=2752]</text>
<text text-anchor="middle" x="301" y="-618.08" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192] per GPU</text>
</g>
<!-- layer0_ffn_up&#45;&gt;layer0_ffn_down -->
<g id="edge8" class="edge">
<title>layer0_ffn_up&#45;&gt;layer0_ffn_down</title>
<path fill="none" stroke="black" d="M301,-710.67C301,-699.27 301,-685.59 301,-673.2"/>
<polygon fill="black" stroke="black" points="304.5,-673.17 301,-663.17 297.5,-673.17 304.5,-673.17"/>
</g>
<!-- layer0_ffn_allreduce -->
<g id="node9" class="node">
<title>layer0_ffn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="301" cy="-537.31" rx="167.67" ry="36.54"/>
<text text-anchor="middle" x="301" y="-551.31" font-family="Arial" font-size="10.00">Layer 0: FFN All&#45;Reduce</text>
<text text-anchor="middle" x="301" y="-540.31" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="301" y="-529.31" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=2048] per GPU</text>
<text text-anchor="middle" x="301" y="-518.31" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer0_ffn_down&#45;&gt;layer0_ffn_allreduce -->
<g id="edge9" class="edge">
<title>layer0_ffn_down&#45;&gt;layer0_ffn_allreduce</title>
<path fill="none" stroke="black" d="M301,-610.9C301,-602.76 301,-593.46 301,-584.3"/>
<polygon fill="black" stroke="black" points="304.5,-584.09 301,-574.09 297.5,-584.09 304.5,-584.09"/>
</g>
<!-- layer0_norm2 -->
<g id="node11" class="node">
<title>layer0_norm2</title>
<polygon fill="lightblue" stroke="black" points="402.5,-463.54 199.5,-463.54 199.5,-411.54 402.5,-411.54 402.5,-463.54"/>
<text text-anchor="middle" x="301" y="-451.54" font-family="Arial" font-size="10.00">Layer 0: RMSNorm (Pre&#45;FFN)</text>
<text text-anchor="middle" x="301" y="-440.54" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="301" y="-429.54" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="301" y="-418.54" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer0_ffn_allreduce&#45;&gt;layer0_norm2 -->
<g id="edge10" class="edge">
<title>layer0_ffn_allreduce&#45;&gt;layer0_norm2</title>
<path fill="none" stroke="black" d="M301,-500.46C301,-491.78 301,-482.51 301,-473.85"/>
<polygon fill="black" stroke="black" points="304.5,-473.69 301,-463.69 297.5,-473.69 304.5,-473.69"/>
</g>
<!-- layer0_norm1&#45;&gt;layer0_ffn_gate -->
<g id="edge6" class="edge">
<title>layer0_norm1&#45;&gt;layer0_ffn_gate</title>
<path fill="none" stroke="black" d="M301,-947.11C301,-928.82 301,-903.79 301,-883.51"/>
<polygon fill="black" stroke="black" points="304.5,-883.4 301,-873.4 297.5,-883.4 304.5,-883.4"/>
</g>
<!-- layer10_qkv_proj -->
<g id="node12" class="node">
<title>layer10_qkv_proj</title>
<polygon fill="lightblue" stroke="black" points="418,-365.54 184,-365.54 184,-313.54 418,-313.54 418,-365.54"/>
<text text-anchor="middle" x="301" y="-353.54" font-family="Arial" font-size="10.00">Layer 10: QKV Projection</text>
<text text-anchor="middle" x="301" y="-342.54" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="301" y="-331.54" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="301" y="-320.54" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=64, d_k=128]</text>
</g>
<!-- layer0_norm2&#45;&gt;layer10_qkv_proj -->
<g id="edge11" class="edge">
<title>layer0_norm2&#45;&gt;layer10_qkv_proj</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M301,-411.32C301,-400.4 301,-387.44 301,-375.62"/>
<polygon fill="black" stroke="black" points="304.5,-375.59 301,-365.59 297.5,-375.59 304.5,-375.59"/>
<text text-anchor="middle" x="323" y="-386.34" font-family="Arial" font-size="9.00">Layers 1&#45;9</text>
</g>
<!-- layer10_qkv_split -->
<g id="node13" class="node">
<title>layer10_qkv_split</title>
<polygon fill="lightcyan" stroke="black" points="8353.21,-1686.7 7899.5,-1686.7 7782.79,-1582.7 8236.5,-1582.7 8353.21,-1686.7"/>
<text text-anchor="middle" x="8068" y="-1648.7" font-family="Arial" font-size="10.00">Layer 10: QKV Split (TP=4)</text>
<text text-anchor="middle" x="8068" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="8068" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="8068" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128] per GPU</text>
</g>
<!-- layer10_attention -->
<g id="node14" class="node">
<title>layer10_attention</title>
<polygon fill="lightblue" stroke="black" points="7765,-1660.7 7531,-1660.7 7531,-1608.7 7765,-1608.7 7765,-1660.7"/>
<text text-anchor="middle" x="7648" y="-1648.7" font-family="Arial" font-size="10.00">Layer 10: Attention Compute</text>
<text text-anchor="middle" x="7648" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="7648" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="7648" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128]</text>
</g>
<!-- layer10_attn_allreduce -->
<g id="node15" class="node">
<title>layer10_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="7352" cy="-1634.7" rx="160.53" ry="36.54"/>
<text text-anchor="middle" x="7352" y="-1648.7" font-family="Arial" font-size="10.00">Layer 10: Attention All&#45;Reduce</text>
<text text-anchor="middle" x="7352" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="7352" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="7352" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer10_ffn_gate -->
<g id="node16" class="node">
<title>layer10_ffn_gate</title>
<polygon fill="lightblue" stroke="black" points="7173,-1660.7 6925,-1660.7 6925,-1608.7 7173,-1608.7 7173,-1660.7"/>
<text text-anchor="middle" x="7049" y="-1648.7" font-family="Arial" font-size="10.00">Layer 10: FFN Gate Proj</text>
<text text-anchor="middle" x="7049" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="7049" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="7049" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer10_ffn_up -->
<g id="node17" class="node">
<title>layer10_ffn_up</title>
<polygon fill="lightblue" stroke="black" points="6907,-1660.7 6659,-1660.7 6659,-1608.7 6907,-1608.7 6907,-1660.7"/>
<text text-anchor="middle" x="6783" y="-1648.7" font-family="Arial" font-size="10.00">Layer 10: FFN Up Proj</text>
<text text-anchor="middle" x="6783" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="6783" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="6783" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer10_ffn_down -->
<g id="node18" class="node">
<title>layer10_ffn_down</title>
<polygon fill="lightblue" stroke="black" points="6640.5,-1660.7 6395.5,-1660.7 6395.5,-1608.7 6640.5,-1608.7 6640.5,-1660.7"/>
<text text-anchor="middle" x="6518" y="-1648.7" font-family="Arial" font-size="10.00">Layer 10: FFN Down Proj</text>
<text text-anchor="middle" x="6518" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="6518" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, ffn_dim=2752]</text>
<text text-anchor="middle" x="6518" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192] per GPU</text>
</g>
<!-- layer10_ffn_allreduce -->
<g id="node19" class="node">
<title>layer10_ffn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="6210" cy="-1634.7" rx="167.67" ry="36.54"/>
<text text-anchor="middle" x="6210" y="-1648.7" font-family="Arial" font-size="10.00">Layer 10: FFN All&#45;Reduce</text>
<text text-anchor="middle" x="6210" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="6210" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=2048] per GPU</text>
<text text-anchor="middle" x="6210" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer10_norm1 -->
<g id="node20" class="node">
<title>layer10_norm1</title>
<polygon fill="lightblue" stroke="black" points="6024.5,-1660.7 5821.5,-1660.7 5821.5,-1608.7 6024.5,-1608.7 6024.5,-1660.7"/>
<text text-anchor="middle" x="5923" y="-1648.7" font-family="Arial" font-size="10.00">Layer 10: RMSNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="5923" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="5923" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="5923" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer10_norm2 -->
<g id="node21" class="node">
<title>layer10_norm2</title>
<polygon fill="lightblue" stroke="black" points="5803.5,-1660.7 5600.5,-1660.7 5600.5,-1608.7 5803.5,-1608.7 5803.5,-1660.7"/>
<text text-anchor="middle" x="5702" y="-1648.7" font-family="Arial" font-size="10.00">Layer 10: RMSNorm (Pre&#45;FFN)</text>
<text text-anchor="middle" x="5702" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="5702" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="5702" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer20_qkv_proj -->
<g id="node22" class="node">
<title>layer20_qkv_proj</title>
<polygon fill="lightblue" stroke="black" points="5819,-1536.7 5585,-1536.7 5585,-1484.7 5819,-1484.7 5819,-1536.7"/>
<text text-anchor="middle" x="5702" y="-1524.7" font-family="Arial" font-size="10.00">Layer 20: QKV Projection</text>
<text text-anchor="middle" x="5702" y="-1513.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="5702" y="-1502.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="5702" y="-1491.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=64, d_k=128]</text>
</g>
<!-- layer10_norm2&#45;&gt;layer20_qkv_proj -->
<g id="edge12" class="edge">
<title>layer10_norm2&#45;&gt;layer20_qkv_proj</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5702,-1608.42C5702,-1590.67 5702,-1566.69 5702,-1547.05"/>
<polygon fill="black" stroke="black" points="5705.5,-1546.94 5702,-1536.94 5698.5,-1546.94 5705.5,-1546.94"/>
<text text-anchor="middle" x="5729.5" y="-1557.5" font-family="Arial" font-size="9.00">Layers 11&#45;19</text>
</g>
<!-- layer20_qkv_split -->
<g id="node23" class="node">
<title>layer20_qkv_split</title>
<polygon fill="lightcyan" stroke="black" points="5582.21,-1686.7 5128.5,-1686.7 5011.79,-1582.7 5465.5,-1582.7 5582.21,-1686.7"/>
<text text-anchor="middle" x="5297" y="-1648.7" font-family="Arial" font-size="10.00">Layer 20: QKV Split (TP=4)</text>
<text text-anchor="middle" x="5297" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="5297" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="5297" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128] per GPU</text>
</g>
<!-- layer20_attention -->
<g id="node24" class="node">
<title>layer20_attention</title>
<polygon fill="lightblue" stroke="black" points="4994,-1660.7 4760,-1660.7 4760,-1608.7 4994,-1608.7 4994,-1660.7"/>
<text text-anchor="middle" x="4877" y="-1648.7" font-family="Arial" font-size="10.00">Layer 20: Attention Compute</text>
<text text-anchor="middle" x="4877" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="4877" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="4877" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128]</text>
</g>
<!-- layer20_attn_allreduce -->
<g id="node25" class="node">
<title>layer20_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="4581" cy="-1634.7" rx="160.53" ry="36.54"/>
<text text-anchor="middle" x="4581" y="-1648.7" font-family="Arial" font-size="10.00">Layer 20: Attention All&#45;Reduce</text>
<text text-anchor="middle" x="4581" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="4581" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="4581" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer20_ffn_gate -->
<g id="node26" class="node">
<title>layer20_ffn_gate</title>
<polygon fill="lightblue" stroke="black" points="4402,-1660.7 4154,-1660.7 4154,-1608.7 4402,-1608.7 4402,-1660.7"/>
<text text-anchor="middle" x="4278" y="-1648.7" font-family="Arial" font-size="10.00">Layer 20: FFN Gate Proj</text>
<text text-anchor="middle" x="4278" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="4278" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="4278" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer20_ffn_up -->
<g id="node27" class="node">
<title>layer20_ffn_up</title>
<polygon fill="lightblue" stroke="black" points="4136,-1660.7 3888,-1660.7 3888,-1608.7 4136,-1608.7 4136,-1660.7"/>
<text text-anchor="middle" x="4012" y="-1648.7" font-family="Arial" font-size="10.00">Layer 20: FFN Up Proj</text>
<text text-anchor="middle" x="4012" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="4012" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="4012" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer20_ffn_down -->
<g id="node28" class="node">
<title>layer20_ffn_down</title>
<polygon fill="lightblue" stroke="black" points="3869.5,-1660.7 3624.5,-1660.7 3624.5,-1608.7 3869.5,-1608.7 3869.5,-1660.7"/>
<text text-anchor="middle" x="3747" y="-1648.7" font-family="Arial" font-size="10.00">Layer 20: FFN Down Proj</text>
<text text-anchor="middle" x="3747" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="3747" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, ffn_dim=2752]</text>
<text text-anchor="middle" x="3747" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192] per GPU</text>
</g>
<!-- layer20_ffn_allreduce -->
<g id="node29" class="node">
<title>layer20_ffn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="3439" cy="-1634.7" rx="167.67" ry="36.54"/>
<text text-anchor="middle" x="3439" y="-1648.7" font-family="Arial" font-size="10.00">Layer 20: FFN All&#45;Reduce</text>
<text text-anchor="middle" x="3439" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="3439" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=2048] per GPU</text>
<text text-anchor="middle" x="3439" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer20_norm1 -->
<g id="node30" class="node">
<title>layer20_norm1</title>
<polygon fill="lightblue" stroke="black" points="3253.5,-1660.7 3050.5,-1660.7 3050.5,-1608.7 3253.5,-1608.7 3253.5,-1660.7"/>
<text text-anchor="middle" x="3152" y="-1648.7" font-family="Arial" font-size="10.00">Layer 20: RMSNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="3152" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="3152" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="3152" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer20_norm2 -->
<g id="node31" class="node">
<title>layer20_norm2</title>
<polygon fill="lightblue" stroke="black" points="3032.5,-1660.7 2829.5,-1660.7 2829.5,-1608.7 3032.5,-1608.7 3032.5,-1660.7"/>
<text text-anchor="middle" x="2931" y="-1648.7" font-family="Arial" font-size="10.00">Layer 20: RMSNorm (Pre&#45;FFN)</text>
<text text-anchor="middle" x="2931" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="2931" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="2931" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer30_qkv_proj -->
<g id="node32" class="node">
<title>layer30_qkv_proj</title>
<polygon fill="lightblue" stroke="black" points="3048,-1536.7 2814,-1536.7 2814,-1484.7 3048,-1484.7 3048,-1536.7"/>
<text text-anchor="middle" x="2931" y="-1524.7" font-family="Arial" font-size="10.00">Layer 30: QKV Projection</text>
<text text-anchor="middle" x="2931" y="-1513.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="2931" y="-1502.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="2931" y="-1491.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=64, d_k=128]</text>
</g>
<!-- layer20_norm2&#45;&gt;layer30_qkv_proj -->
<g id="edge13" class="edge">
<title>layer20_norm2&#45;&gt;layer30_qkv_proj</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2931,-1608.42C2931,-1590.67 2931,-1566.69 2931,-1547.05"/>
<polygon fill="black" stroke="black" points="2934.5,-1546.94 2931,-1536.94 2927.5,-1546.94 2934.5,-1546.94"/>
<text text-anchor="middle" x="2958.5" y="-1557.5" font-family="Arial" font-size="9.00">Layers 21&#45;29</text>
</g>
<!-- layer30_qkv_split -->
<g id="node33" class="node">
<title>layer30_qkv_split</title>
<polygon fill="lightcyan" stroke="black" points="2811.21,-1686.7 2357.5,-1686.7 2240.79,-1582.7 2694.5,-1582.7 2811.21,-1686.7"/>
<text text-anchor="middle" x="2526" y="-1648.7" font-family="Arial" font-size="10.00">Layer 30: QKV Split (TP=4)</text>
<text text-anchor="middle" x="2526" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="2526" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="2526" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128] per GPU</text>
</g>
<!-- layer30_attention -->
<g id="node34" class="node">
<title>layer30_attention</title>
<polygon fill="lightblue" stroke="black" points="2223,-1660.7 1989,-1660.7 1989,-1608.7 2223,-1608.7 2223,-1660.7"/>
<text text-anchor="middle" x="2106" y="-1648.7" font-family="Arial" font-size="10.00">Layer 30: Attention Compute</text>
<text text-anchor="middle" x="2106" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="2106" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="2106" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128]</text>
</g>
<!-- layer30_attn_allreduce -->
<g id="node35" class="node">
<title>layer30_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="1810" cy="-1634.7" rx="160.53" ry="36.54"/>
<text text-anchor="middle" x="1810" y="-1648.7" font-family="Arial" font-size="10.00">Layer 30: Attention All&#45;Reduce</text>
<text text-anchor="middle" x="1810" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="1810" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="1810" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer30_ffn_gate -->
<g id="node36" class="node">
<title>layer30_ffn_gate</title>
<polygon fill="lightblue" stroke="black" points="1631,-1660.7 1383,-1660.7 1383,-1608.7 1631,-1608.7 1631,-1660.7"/>
<text text-anchor="middle" x="1507" y="-1648.7" font-family="Arial" font-size="10.00">Layer 30: FFN Gate Proj</text>
<text text-anchor="middle" x="1507" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="1507" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="1507" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer30_ffn_up -->
<g id="node37" class="node">
<title>layer30_ffn_up</title>
<polygon fill="lightblue" stroke="black" points="1365,-1660.7 1117,-1660.7 1117,-1608.7 1365,-1608.7 1365,-1660.7"/>
<text text-anchor="middle" x="1241" y="-1648.7" font-family="Arial" font-size="10.00">Layer 30: FFN Up Proj</text>
<text text-anchor="middle" x="1241" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="1241" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="1241" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer30_ffn_down -->
<g id="node38" class="node">
<title>layer30_ffn_down</title>
<polygon fill="lightblue" stroke="black" points="1098.5,-1660.7 853.5,-1660.7 853.5,-1608.7 1098.5,-1608.7 1098.5,-1660.7"/>
<text text-anchor="middle" x="976" y="-1648.7" font-family="Arial" font-size="10.00">Layer 30: FFN Down Proj</text>
<text text-anchor="middle" x="976" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="976" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, ffn_dim=2752]</text>
<text text-anchor="middle" x="976" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192] per GPU</text>
</g>
<!-- layer30_ffn_allreduce -->
<g id="node39" class="node">
<title>layer30_ffn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="668" cy="-1634.7" rx="167.67" ry="36.54"/>
<text text-anchor="middle" x="668" y="-1648.7" font-family="Arial" font-size="10.00">Layer 30: FFN All&#45;Reduce</text>
<text text-anchor="middle" x="668" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] TP=4</text>
<text text-anchor="middle" x="668" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=2048] per GPU</text>
<text text-anchor="middle" x="668" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer30_norm1 -->
<g id="node40" class="node">
<title>layer30_norm1</title>
<polygon fill="lightblue" stroke="black" points="482.5,-1660.7 279.5,-1660.7 279.5,-1608.7 482.5,-1608.7 482.5,-1660.7"/>
<text text-anchor="middle" x="381" y="-1648.7" font-family="Arial" font-size="10.00">Layer 30: RMSNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="381" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="381" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="381" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer30_norm2 -->
<g id="node41" class="node">
<title>layer30_norm2</title>
<polygon fill="lightblue" stroke="black" points="8574.5,-1660.7 8371.5,-1660.7 8371.5,-1608.7 8574.5,-1608.7 8574.5,-1660.7"/>
<text text-anchor="middle" x="8473" y="-1648.7" font-family="Arial" font-size="10.00">Layer 30: RMSNorm (Pre&#45;FFN)</text>
<text text-anchor="middle" x="8473" y="-1637.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="8473" y="-1626.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="8473" y="-1615.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- stage0_output -->
<g id="node42" class="node">
<title>stage0_output</title>
<polygon fill="lightgreen" stroke="black" points="8574.5,-1536.7 8371.5,-1536.7 8371.5,-1484.7 8574.5,-1484.7 8574.5,-1536.7"/>
<text text-anchor="middle" x="8473" y="-1524.7" font-family="Arial" font-size="10.00">Stage 0 Output</text>
<text text-anchor="middle" x="8473" y="-1513.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3]</text>
<text text-anchor="middle" x="8473" y="-1502.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="8473" y="-1491.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer30_norm2&#45;&gt;stage0_output -->
<g id="edge14" class="edge">
<title>layer30_norm2&#45;&gt;stage0_output</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8473,-1608.42C8473,-1590.67 8473,-1566.69 8473,-1547.05"/>
<polygon fill="black" stroke="black" points="8476.5,-1546.94 8473,-1536.94 8469.5,-1546.94 8476.5,-1546.94"/>
<text text-anchor="middle" x="8500.5" y="-1557.5" font-family="Arial" font-size="9.00">Layers 31&#45;39</text>
</g>
<!-- pipeline_comm -->
<g id="node88" class="node">
<title>pipeline_comm</title>
<ellipse fill="yellow" stroke="black" stroke-dasharray="5,2" cx="12870" cy="-1395.7" rx="137.77" ry="36.54"/>
<text text-anchor="middle" x="12870" y="-1409.7" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="12870" y="-1398.7" font-family="Arial" font-size="10.00">Stage 0 → Stage 1</text>
<text text-anchor="middle" x="12870" y="-1387.7" font-family="Arial" font-size="10.00">GPU: [0,1,2,3] → [4,5,6,7]</text>
<text text-anchor="middle" x="12870" y="-1376.7" font-family="Arial" font-size="10.00">Data: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- stage0_output&#45;&gt;pipeline_comm -->
<g id="edge15" class="edge">
<title>stage0_output&#45;&gt;pipeline_comm</title>
<path fill="none" stroke="black" d="M8574.68,-1507.08C9153.98,-1492.19 12035.95,-1418.13 12722.85,-1400.48"/>
<polygon fill="black" stroke="black" points="12723.14,-1403.97 12733.05,-1400.22 12722.96,-1396.97 12723.14,-1403.97"/>
</g>
<!-- input_stage1 -->
<g id="node43" class="node">
<title>input_stage1</title>
<polygon fill="lightgreen" stroke="black" points="17113.5,-1259.7 16910.5,-1259.7 16910.5,-1207.7 17113.5,-1207.7 17113.5,-1259.7"/>
<text text-anchor="middle" x="17012" y="-1247.7" font-family="Arial" font-size="10.00">Stage 1 Input</text>
<text text-anchor="middle" x="17012" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="17012" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="17012" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer40_qkv_proj -->
<g id="node44" class="node">
<title>layer40_qkv_proj</title>
<polygon fill="lightblue" stroke="black" points="17071,-1124.93 16837,-1124.93 16837,-1072.93 17071,-1072.93 17071,-1124.93"/>
<text text-anchor="middle" x="16954" y="-1112.93" font-family="Arial" font-size="10.00">Layer 40: QKV Projection</text>
<text text-anchor="middle" x="16954" y="-1101.93" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="16954" y="-1090.93" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="16954" y="-1079.93" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=64, d_k=128]</text>
</g>
<!-- input_stage1&#45;&gt;layer40_qkv_proj -->
<g id="edge17" class="edge">
<title>input_stage1&#45;&gt;layer40_qkv_proj</title>
<path fill="none" stroke="black" d="M17000.95,-1207.41C16991.92,-1186.74 16979.06,-1157.3 16969.09,-1134.46"/>
<polygon fill="black" stroke="black" points="16972.22,-1132.88 16965,-1125.12 16965.8,-1135.68 16972.22,-1132.88"/>
</g>
<!-- layer40_qkv_split -->
<g id="node45" class="node">
<title>layer40_qkv_split</title>
<polygon fill="lightcyan" stroke="black" points="17113.21,-1025.16 16659.5,-1025.16 16542.79,-921.16 16996.5,-921.16 17113.21,-1025.16"/>
<text text-anchor="middle" x="16828" y="-987.16" font-family="Arial" font-size="10.00">Layer 40: QKV Split (TP=4)</text>
<text text-anchor="middle" x="16828" y="-976.16" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="16828" y="-965.16" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="16828" y="-954.16" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128] per GPU</text>
</g>
<!-- layer40_qkv_proj&#45;&gt;layer40_qkv_split -->
<g id="edge18" class="edge">
<title>layer40_qkv_proj&#45;&gt;layer40_qkv_split</title>
<path fill="none" stroke="black" d="M16928.5,-1072.88C16916.62,-1061.21 16901.95,-1046.79 16887.51,-1032.62"/>
<polygon fill="black" stroke="black" points="16889.59,-1029.75 16880,-1025.24 16884.69,-1034.75 16889.59,-1029.75"/>
</g>
<!-- layer40_attention -->
<g id="node46" class="node">
<title>layer40_attention</title>
<polygon fill="lightblue" stroke="black" points="16945,-873.39 16711,-873.39 16711,-821.39 16945,-821.39 16945,-873.39"/>
<text text-anchor="middle" x="16828" y="-861.39" font-family="Arial" font-size="10.00">Layer 40: Attention Compute</text>
<text text-anchor="middle" x="16828" y="-850.39" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="16828" y="-839.39" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="16828" y="-828.39" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128]</text>
</g>
<!-- layer40_qkv_split&#45;&gt;layer40_attention -->
<g id="edge19" class="edge">
<title>layer40_qkv_split&#45;&gt;layer40_attention</title>
<path fill="none" stroke="black" d="M16828,-921.1C16828,-908.56 16828,-895.4 16828,-883.79"/>
<polygon fill="black" stroke="black" points="16831.5,-883.61 16828,-873.61 16824.5,-883.61 16831.5,-883.61"/>
</g>
<!-- layer40_attn_allreduce -->
<g id="node47" class="node">
<title>layer40_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="16828" cy="-736.85" rx="160.53" ry="36.54"/>
<text text-anchor="middle" x="16828" y="-750.85" font-family="Arial" font-size="10.00">Layer 40: Attention All&#45;Reduce</text>
<text text-anchor="middle" x="16828" y="-739.85" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="16828" y="-728.85" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="16828" y="-717.85" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer40_attention&#45;&gt;layer40_attn_allreduce -->
<g id="edge20" class="edge">
<title>layer40_attention&#45;&gt;layer40_attn_allreduce</title>
<path fill="none" stroke="black" d="M16828,-821.21C16828,-810.14 16828,-796.78 16828,-784.03"/>
<polygon fill="black" stroke="black" points="16831.5,-783.99 16828,-773.99 16824.5,-783.99 16831.5,-783.99"/>
</g>
<!-- layer40_norm1 -->
<g id="node52" class="node">
<title>layer40_norm1</title>
<polygon fill="lightblue" stroke="black" points="16929.5,-663.08 16726.5,-663.08 16726.5,-611.08 16929.5,-611.08 16929.5,-663.08"/>
<text text-anchor="middle" x="16828" y="-651.08" font-family="Arial" font-size="10.00">Layer 40: RMSNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="16828" y="-640.08" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="16828" y="-629.08" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="16828" y="-618.08" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer40_attn_allreduce&#45;&gt;layer40_norm1 -->
<g id="edge21" class="edge">
<title>layer40_attn_allreduce&#45;&gt;layer40_norm1</title>
<path fill="none" stroke="black" d="M16828,-700C16828,-691.32 16828,-682.05 16828,-673.39"/>
<polygon fill="black" stroke="black" points="16831.5,-673.22 16828,-663.22 16824.5,-673.22 16831.5,-673.22"/>
</g>
<!-- layer40_ffn_gate -->
<g id="node48" class="node">
<title>layer40_ffn_gate</title>
<polygon fill="lightblue" stroke="black" points="16952,-563.31 16704,-563.31 16704,-511.31 16952,-511.31 16952,-563.31"/>
<text text-anchor="middle" x="16828" y="-551.31" font-family="Arial" font-size="10.00">Layer 40: FFN Gate Proj</text>
<text text-anchor="middle" x="16828" y="-540.31" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="16828" y="-529.31" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="16828" y="-518.31" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer40_ffn_up -->
<g id="node49" class="node">
<title>layer40_ffn_up</title>
<polygon fill="lightblue" stroke="black" points="16952,-463.54 16704,-463.54 16704,-411.54 16952,-411.54 16952,-463.54"/>
<text text-anchor="middle" x="16828" y="-451.54" font-family="Arial" font-size="10.00">Layer 40: FFN Up Proj</text>
<text text-anchor="middle" x="16828" y="-440.54" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="16828" y="-429.54" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="16828" y="-418.54" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer40_ffn_gate&#45;&gt;layer40_ffn_up -->
<g id="edge23" class="edge">
<title>layer40_ffn_gate&#45;&gt;layer40_ffn_up</title>
<path fill="none" stroke="black" d="M16828,-511.13C16828,-499.73 16828,-486.05 16828,-473.66"/>
<polygon fill="black" stroke="black" points="16831.5,-473.63 16828,-463.63 16824.5,-473.63 16831.5,-473.63"/>
</g>
<!-- layer40_ffn_down -->
<g id="node50" class="node">
<title>layer40_ffn_down</title>
<polygon fill="lightblue" stroke="black" points="16950.5,-365.54 16705.5,-365.54 16705.5,-313.54 16950.5,-313.54 16950.5,-365.54"/>
<text text-anchor="middle" x="16828" y="-353.54" font-family="Arial" font-size="10.00">Layer 40: FFN Down Proj</text>
<text text-anchor="middle" x="16828" y="-342.54" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="16828" y="-331.54" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, ffn_dim=2752]</text>
<text text-anchor="middle" x="16828" y="-320.54" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192] per GPU</text>
</g>
<!-- layer40_ffn_up&#45;&gt;layer40_ffn_down -->
<g id="edge24" class="edge">
<title>layer40_ffn_up&#45;&gt;layer40_ffn_down</title>
<path fill="none" stroke="black" d="M16828,-411.32C16828,-400.4 16828,-387.44 16828,-375.62"/>
<polygon fill="black" stroke="black" points="16831.5,-375.59 16828,-365.59 16824.5,-375.59 16831.5,-375.59"/>
</g>
<!-- layer40_ffn_allreduce -->
<g id="node51" class="node">
<title>layer40_ffn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="16828" cy="-239.77" rx="167.67" ry="36.54"/>
<text text-anchor="middle" x="16828" y="-253.77" font-family="Arial" font-size="10.00">Layer 40: FFN All&#45;Reduce</text>
<text text-anchor="middle" x="16828" y="-242.77" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="16828" y="-231.77" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=2048] per GPU</text>
<text text-anchor="middle" x="16828" y="-220.77" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer40_ffn_down&#45;&gt;layer40_ffn_allreduce -->
<g id="edge25" class="edge">
<title>layer40_ffn_down&#45;&gt;layer40_ffn_allreduce</title>
<path fill="none" stroke="black" d="M16828,-313.36C16828,-305.22 16828,-295.93 16828,-286.76"/>
<polygon fill="black" stroke="black" points="16831.5,-286.55 16828,-276.55 16824.5,-286.55 16831.5,-286.55"/>
</g>
<!-- layer40_norm2 -->
<g id="node53" class="node">
<title>layer40_norm2</title>
<polygon fill="lightblue" stroke="black" points="16929.5,-166 16726.5,-166 16726.5,-114 16929.5,-114 16929.5,-166"/>
<text text-anchor="middle" x="16828" y="-154" font-family="Arial" font-size="10.00">Layer 40: RMSNorm (Pre&#45;FFN)</text>
<text text-anchor="middle" x="16828" y="-143" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="16828" y="-132" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="16828" y="-121" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer40_ffn_allreduce&#45;&gt;layer40_norm2 -->
<g id="edge26" class="edge">
<title>layer40_ffn_allreduce&#45;&gt;layer40_norm2</title>
<path fill="none" stroke="black" d="M16828,-202.92C16828,-194.24 16828,-184.97 16828,-176.32"/>
<polygon fill="black" stroke="black" points="16831.5,-176.15 16828,-166.15 16824.5,-176.15 16831.5,-176.15"/>
</g>
<!-- layer40_norm1&#45;&gt;layer40_ffn_gate -->
<g id="edge22" class="edge">
<title>layer40_norm1&#45;&gt;layer40_ffn_gate</title>
<path fill="none" stroke="black" d="M16828,-610.9C16828,-599.5 16828,-585.82 16828,-573.43"/>
<polygon fill="black" stroke="black" points="16831.5,-573.4 16828,-563.4 16824.5,-573.4 16831.5,-573.4"/>
</g>
<!-- layer50_qkv_proj -->
<g id="node54" class="node">
<title>layer50_qkv_proj</title>
<polygon fill="lightblue" stroke="black" points="16945,-68 16711,-68 16711,-16 16945,-16 16945,-68"/>
<text text-anchor="middle" x="16828" y="-56" font-family="Arial" font-size="10.00">Layer 50: QKV Projection</text>
<text text-anchor="middle" x="16828" y="-45" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="16828" y="-34" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="16828" y="-23" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=64, d_k=128]</text>
</g>
<!-- layer40_norm2&#45;&gt;layer50_qkv_proj -->
<g id="edge27" class="edge">
<title>layer40_norm2&#45;&gt;layer50_qkv_proj</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M16828,-113.78C16828,-102.86 16828,-89.9 16828,-78.08"/>
<polygon fill="black" stroke="black" points="16831.5,-78.05 16828,-68.05 16824.5,-78.05 16831.5,-78.05"/>
<text text-anchor="middle" x="16855.5" y="-88.8" font-family="Arial" font-size="9.00">Layers 41&#45;49</text>
</g>
<!-- layer50_qkv_split -->
<g id="node55" class="node">
<title>layer50_qkv_split</title>
<polygon fill="lightcyan" stroke="black" points="16892.21,-1285.7 16438.5,-1285.7 16321.79,-1181.7 16775.5,-1181.7 16892.21,-1285.7"/>
<text text-anchor="middle" x="16607" y="-1247.7" font-family="Arial" font-size="10.00">Layer 50: QKV Split (TP=4)</text>
<text text-anchor="middle" x="16607" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="16607" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="16607" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128] per GPU</text>
</g>
<!-- layer50_attention -->
<g id="node56" class="node">
<title>layer50_attention</title>
<polygon fill="lightblue" stroke="black" points="16304,-1259.7 16070,-1259.7 16070,-1207.7 16304,-1207.7 16304,-1259.7"/>
<text text-anchor="middle" x="16187" y="-1247.7" font-family="Arial" font-size="10.00">Layer 50: Attention Compute</text>
<text text-anchor="middle" x="16187" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="16187" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="16187" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128]</text>
</g>
<!-- layer50_attn_allreduce -->
<g id="node57" class="node">
<title>layer50_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="15891" cy="-1233.7" rx="160.53" ry="36.54"/>
<text text-anchor="middle" x="15891" y="-1247.7" font-family="Arial" font-size="10.00">Layer 50: Attention All&#45;Reduce</text>
<text text-anchor="middle" x="15891" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="15891" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="15891" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer50_ffn_gate -->
<g id="node58" class="node">
<title>layer50_ffn_gate</title>
<polygon fill="lightblue" stroke="black" points="15712,-1259.7 15464,-1259.7 15464,-1207.7 15712,-1207.7 15712,-1259.7"/>
<text text-anchor="middle" x="15588" y="-1247.7" font-family="Arial" font-size="10.00">Layer 50: FFN Gate Proj</text>
<text text-anchor="middle" x="15588" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="15588" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="15588" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer50_ffn_up -->
<g id="node59" class="node">
<title>layer50_ffn_up</title>
<polygon fill="lightblue" stroke="black" points="15446,-1259.7 15198,-1259.7 15198,-1207.7 15446,-1207.7 15446,-1259.7"/>
<text text-anchor="middle" x="15322" y="-1247.7" font-family="Arial" font-size="10.00">Layer 50: FFN Up Proj</text>
<text text-anchor="middle" x="15322" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="15322" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="15322" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer50_ffn_down -->
<g id="node60" class="node">
<title>layer50_ffn_down</title>
<polygon fill="lightblue" stroke="black" points="15179.5,-1259.7 14934.5,-1259.7 14934.5,-1207.7 15179.5,-1207.7 15179.5,-1259.7"/>
<text text-anchor="middle" x="15057" y="-1247.7" font-family="Arial" font-size="10.00">Layer 50: FFN Down Proj</text>
<text text-anchor="middle" x="15057" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="15057" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, ffn_dim=2752]</text>
<text text-anchor="middle" x="15057" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192] per GPU</text>
</g>
<!-- layer50_ffn_allreduce -->
<g id="node61" class="node">
<title>layer50_ffn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="14749" cy="-1233.7" rx="167.67" ry="36.54"/>
<text text-anchor="middle" x="14749" y="-1247.7" font-family="Arial" font-size="10.00">Layer 50: FFN All&#45;Reduce</text>
<text text-anchor="middle" x="14749" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="14749" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=2048] per GPU</text>
<text text-anchor="middle" x="14749" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer50_norm1 -->
<g id="node62" class="node">
<title>layer50_norm1</title>
<polygon fill="lightblue" stroke="black" points="14563.5,-1259.7 14360.5,-1259.7 14360.5,-1207.7 14563.5,-1207.7 14563.5,-1259.7"/>
<text text-anchor="middle" x="14462" y="-1247.7" font-family="Arial" font-size="10.00">Layer 50: RMSNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="14462" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="14462" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="14462" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer50_norm2 -->
<g id="node63" class="node">
<title>layer50_norm2</title>
<polygon fill="lightblue" stroke="black" points="14342.5,-1259.7 14139.5,-1259.7 14139.5,-1207.7 14342.5,-1207.7 14342.5,-1259.7"/>
<text text-anchor="middle" x="14241" y="-1247.7" font-family="Arial" font-size="10.00">Layer 50: RMSNorm (Pre&#45;FFN)</text>
<text text-anchor="middle" x="14241" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="14241" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="14241" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer60_qkv_proj -->
<g id="node64" class="node">
<title>layer60_qkv_proj</title>
<polygon fill="lightblue" stroke="black" points="14358,-1124.93 14124,-1124.93 14124,-1072.93 14358,-1072.93 14358,-1124.93"/>
<text text-anchor="middle" x="14241" y="-1112.93" font-family="Arial" font-size="10.00">Layer 60: QKV Projection</text>
<text text-anchor="middle" x="14241" y="-1101.93" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="14241" y="-1090.93" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="14241" y="-1079.93" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=64, d_k=128]</text>
</g>
<!-- layer50_norm2&#45;&gt;layer60_qkv_proj -->
<g id="edge28" class="edge">
<title>layer50_norm2&#45;&gt;layer60_qkv_proj</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14241,-1207.41C14241,-1187.02 14241,-1158.09 14241,-1135.38"/>
<polygon fill="black" stroke="black" points="14244.5,-1135.12 14241,-1125.12 14237.5,-1135.12 14244.5,-1135.12"/>
<text text-anchor="middle" x="14268.5" y="-1156.5" font-family="Arial" font-size="9.00">Layers 51&#45;59</text>
</g>
<!-- layer60_qkv_split -->
<g id="node65" class="node">
<title>layer60_qkv_split</title>
<polygon fill="lightcyan" stroke="black" points="14121.21,-1285.7 13667.5,-1285.7 13550.79,-1181.7 14004.5,-1181.7 14121.21,-1285.7"/>
<text text-anchor="middle" x="13836" y="-1247.7" font-family="Arial" font-size="10.00">Layer 60: QKV Split (TP=4)</text>
<text text-anchor="middle" x="13836" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="13836" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="13836" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128] per GPU</text>
</g>
<!-- layer60_attention -->
<g id="node66" class="node">
<title>layer60_attention</title>
<polygon fill="lightblue" stroke="black" points="13533,-1259.7 13299,-1259.7 13299,-1207.7 13533,-1207.7 13533,-1259.7"/>
<text text-anchor="middle" x="13416" y="-1247.7" font-family="Arial" font-size="10.00">Layer 60: Attention Compute</text>
<text text-anchor="middle" x="13416" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="13416" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="13416" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128]</text>
</g>
<!-- layer60_attn_allreduce -->
<g id="node67" class="node">
<title>layer60_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="13120" cy="-1233.7" rx="160.53" ry="36.54"/>
<text text-anchor="middle" x="13120" y="-1247.7" font-family="Arial" font-size="10.00">Layer 60: Attention All&#45;Reduce</text>
<text text-anchor="middle" x="13120" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="13120" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="13120" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer60_ffn_gate -->
<g id="node68" class="node">
<title>layer60_ffn_gate</title>
<polygon fill="lightblue" stroke="black" points="12941,-1259.7 12693,-1259.7 12693,-1207.7 12941,-1207.7 12941,-1259.7"/>
<text text-anchor="middle" x="12817" y="-1247.7" font-family="Arial" font-size="10.00">Layer 60: FFN Gate Proj</text>
<text text-anchor="middle" x="12817" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="12817" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="12817" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer60_ffn_up -->
<g id="node69" class="node">
<title>layer60_ffn_up</title>
<polygon fill="lightblue" stroke="black" points="12675,-1259.7 12427,-1259.7 12427,-1207.7 12675,-1207.7 12675,-1259.7"/>
<text text-anchor="middle" x="12551" y="-1247.7" font-family="Arial" font-size="10.00">Layer 60: FFN Up Proj</text>
<text text-anchor="middle" x="12551" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="12551" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="12551" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer60_ffn_down -->
<g id="node70" class="node">
<title>layer60_ffn_down</title>
<polygon fill="lightblue" stroke="black" points="12408.5,-1259.7 12163.5,-1259.7 12163.5,-1207.7 12408.5,-1207.7 12408.5,-1259.7"/>
<text text-anchor="middle" x="12286" y="-1247.7" font-family="Arial" font-size="10.00">Layer 60: FFN Down Proj</text>
<text text-anchor="middle" x="12286" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="12286" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, ffn_dim=2752]</text>
<text text-anchor="middle" x="12286" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192] per GPU</text>
</g>
<!-- layer60_ffn_allreduce -->
<g id="node71" class="node">
<title>layer60_ffn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="11978" cy="-1233.7" rx="167.67" ry="36.54"/>
<text text-anchor="middle" x="11978" y="-1247.7" font-family="Arial" font-size="10.00">Layer 60: FFN All&#45;Reduce</text>
<text text-anchor="middle" x="11978" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="11978" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=2048] per GPU</text>
<text text-anchor="middle" x="11978" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer60_norm1 -->
<g id="node72" class="node">
<title>layer60_norm1</title>
<polygon fill="lightblue" stroke="black" points="11792.5,-1259.7 11589.5,-1259.7 11589.5,-1207.7 11792.5,-1207.7 11792.5,-1259.7"/>
<text text-anchor="middle" x="11691" y="-1247.7" font-family="Arial" font-size="10.00">Layer 60: RMSNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="11691" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="11691" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="11691" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer60_norm2 -->
<g id="node73" class="node">
<title>layer60_norm2</title>
<polygon fill="lightblue" stroke="black" points="11571.5,-1259.7 11368.5,-1259.7 11368.5,-1207.7 11571.5,-1207.7 11571.5,-1259.7"/>
<text text-anchor="middle" x="11470" y="-1247.7" font-family="Arial" font-size="10.00">Layer 60: RMSNorm (Pre&#45;FFN)</text>
<text text-anchor="middle" x="11470" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="11470" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="11470" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer70_qkv_proj -->
<g id="node74" class="node">
<title>layer70_qkv_proj</title>
<polygon fill="lightblue" stroke="black" points="11587,-1124.93 11353,-1124.93 11353,-1072.93 11587,-1072.93 11587,-1124.93"/>
<text text-anchor="middle" x="11470" y="-1112.93" font-family="Arial" font-size="10.00">Layer 70: QKV Projection</text>
<text text-anchor="middle" x="11470" y="-1101.93" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="11470" y="-1090.93" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="11470" y="-1079.93" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=64, d_k=128]</text>
</g>
<!-- layer60_norm2&#45;&gt;layer70_qkv_proj -->
<g id="edge29" class="edge">
<title>layer60_norm2&#45;&gt;layer70_qkv_proj</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11470,-1207.41C11470,-1187.02 11470,-1158.09 11470,-1135.38"/>
<polygon fill="black" stroke="black" points="11473.5,-1135.12 11470,-1125.12 11466.5,-1135.12 11473.5,-1135.12"/>
<text text-anchor="middle" x="11497.5" y="-1156.5" font-family="Arial" font-size="9.00">Layers 61&#45;69</text>
</g>
<!-- layer70_qkv_split -->
<g id="node75" class="node">
<title>layer70_qkv_split</title>
<polygon fill="lightcyan" stroke="black" points="11350.21,-1285.7 10896.5,-1285.7 10779.79,-1181.7 11233.5,-1181.7 11350.21,-1285.7"/>
<text text-anchor="middle" x="11065" y="-1247.7" font-family="Arial" font-size="10.00">Layer 70: QKV Split (TP=4)</text>
<text text-anchor="middle" x="11065" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="11065" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="11065" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128] per GPU</text>
</g>
<!-- layer70_attention -->
<g id="node76" class="node">
<title>layer70_attention</title>
<polygon fill="lightblue" stroke="black" points="10762,-1259.7 10528,-1259.7 10528,-1207.7 10762,-1207.7 10762,-1259.7"/>
<text text-anchor="middle" x="10645" y="-1247.7" font-family="Arial" font-size="10.00">Layer 70: Attention Compute</text>
<text text-anchor="middle" x="10645" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="10645" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="10645" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, heads=16, d_k=128]</text>
</g>
<!-- layer70_attn_allreduce -->
<g id="node77" class="node">
<title>layer70_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="10349" cy="-1233.7" rx="160.53" ry="36.54"/>
<text text-anchor="middle" x="10349" y="-1247.7" font-family="Arial" font-size="10.00">Layer 70: Attention All&#45;Reduce</text>
<text text-anchor="middle" x="10349" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="10349" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, heads=16, d_k=128]</text>
<text text-anchor="middle" x="10349" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer70_ffn_gate -->
<g id="node78" class="node">
<title>layer70_ffn_gate</title>
<polygon fill="lightblue" stroke="black" points="10170,-1259.7 9922,-1259.7 9922,-1207.7 10170,-1207.7 10170,-1259.7"/>
<text text-anchor="middle" x="10046" y="-1247.7" font-family="Arial" font-size="10.00">Layer 70: FFN Gate Proj</text>
<text text-anchor="middle" x="10046" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="10046" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="10046" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer70_ffn_up -->
<g id="node79" class="node">
<title>layer70_ffn_up</title>
<polygon fill="lightblue" stroke="black" points="9904,-1259.7 9656,-1259.7 9656,-1207.7 9904,-1207.7 9904,-1259.7"/>
<text text-anchor="middle" x="9780" y="-1247.7" font-family="Arial" font-size="10.00">Layer 70: FFN Up Proj</text>
<text text-anchor="middle" x="9780" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="9780" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="9780" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, ffn_dim=2752] per GPU</text>
</g>
<!-- layer70_ffn_down -->
<g id="node80" class="node">
<title>layer70_ffn_down</title>
<polygon fill="lightblue" stroke="black" points="9637.5,-1259.7 9392.5,-1259.7 9392.5,-1207.7 9637.5,-1207.7 9637.5,-1259.7"/>
<text text-anchor="middle" x="9515" y="-1247.7" font-family="Arial" font-size="10.00">Layer 70: FFN Down Proj</text>
<text text-anchor="middle" x="9515" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="9515" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, ffn_dim=2752]</text>
<text text-anchor="middle" x="9515" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192] per GPU</text>
</g>
<!-- layer70_ffn_allreduce -->
<g id="node81" class="node">
<title>layer70_ffn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="9207" cy="-1233.7" rx="167.67" ry="36.54"/>
<text text-anchor="middle" x="9207" y="-1247.7" font-family="Arial" font-size="10.00">Layer 70: FFN All&#45;Reduce</text>
<text text-anchor="middle" x="9207" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="9207" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=2048] per GPU</text>
<text text-anchor="middle" x="9207" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer70_norm1 -->
<g id="node82" class="node">
<title>layer70_norm1</title>
<polygon fill="lightblue" stroke="black" points="9021.5,-1259.7 8818.5,-1259.7 8818.5,-1207.7 9021.5,-1207.7 9021.5,-1259.7"/>
<text text-anchor="middle" x="8920" y="-1247.7" font-family="Arial" font-size="10.00">Layer 70: RMSNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="8920" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="8920" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="8920" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer70_norm2 -->
<g id="node83" class="node">
<title>layer70_norm2</title>
<polygon fill="lightblue" stroke="black" points="8800.5,-1259.7 8597.5,-1259.7 8597.5,-1207.7 8800.5,-1207.7 8800.5,-1259.7"/>
<text text-anchor="middle" x="8699" y="-1247.7" font-family="Arial" font-size="10.00">Layer 70: RMSNorm (Pre&#45;FFN)</text>
<text text-anchor="middle" x="8699" y="-1236.7" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="8699" y="-1225.7" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="8699" y="-1214.7" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- final_norm -->
<g id="node84" class="node">
<title>final_norm</title>
<polygon fill="lightblue" stroke="black" points="8805.5,-1124.93 8602.5,-1124.93 8602.5,-1072.93 8805.5,-1072.93 8805.5,-1124.93"/>
<text text-anchor="middle" x="8704" y="-1112.93" font-family="Arial" font-size="10.00">Final RMSNorm</text>
<text text-anchor="middle" x="8704" y="-1101.93" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="8704" y="-1090.93" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="8704" y="-1079.93" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, hidden=8192]</text>
</g>
<!-- layer70_norm2&#45;&gt;final_norm -->
<g id="edge30" class="edge">
<title>layer70_norm2&#45;&gt;final_norm</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8699.95,-1207.41C8700.72,-1187.02 8701.81,-1158.09 8702.66,-1135.38"/>
<polygon fill="black" stroke="black" points="8706.17,-1135.24 8703.05,-1125.12 8699.18,-1134.98 8706.17,-1135.24"/>
<text text-anchor="middle" x="8728.5" y="-1156.5" font-family="Arial" font-size="9.00">Layers 71&#45;79</text>
</g>
<!-- logits_projection -->
<g id="node85" class="node">
<title>logits_projection</title>
<polygon fill="lightblue" stroke="black" points="8868.5,-999.16 8615.5,-999.16 8615.5,-947.16 8868.5,-947.16 8868.5,-999.16"/>
<text text-anchor="middle" x="8742" y="-987.16" font-family="Arial" font-size="10.00">Logits Projection</text>
<text text-anchor="middle" x="8742" y="-976.16" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="8742" y="-965.16" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, hidden=8192]</text>
<text text-anchor="middle" x="8742" y="-954.16" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, vocab=128256] per GPU</text>
</g>
<!-- final_norm&#45;&gt;logits_projection -->
<g id="edge31" class="edge">
<title>final_norm&#45;&gt;logits_projection</title>
<path fill="none" stroke="black" d="M8711.69,-1072.88C8717.33,-1054.51 8725.06,-1029.33 8731.3,-1009"/>
<polygon fill="black" stroke="black" points="8734.73,-1009.75 8734.32,-999.17 8728.04,-1007.7 8734.73,-1009.75"/>
</g>
<!-- logits_allgather -->
<g id="node86" class="node">
<title>logits_allgather</title>
<ellipse fill="lightpink" stroke="black" cx="8768" cy="-847.39" rx="169.91" ry="36.54"/>
<text text-anchor="middle" x="8768" y="-861.39" font-family="Arial" font-size="10.00">Logits All&#45;Gather</text>
<text text-anchor="middle" x="8768" y="-850.39" font-family="Arial" font-size="10.00">GPU: [4,5,6,7] TP=4</text>
<text text-anchor="middle" x="8768" y="-839.39" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, vocab=32064] per GPU</text>
<text text-anchor="middle" x="8768" y="-828.39" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, vocab=128256]</text>
</g>
<!-- logits_projection&#45;&gt;logits_allgather -->
<g id="edge32" class="edge">
<title>logits_projection&#45;&gt;logits_allgather</title>
<path fill="none" stroke="black" d="M8747.26,-947.11C8750.45,-931.92 8754.62,-912.08 8758.38,-894.17"/>
<polygon fill="black" stroke="black" points="8761.85,-894.69 8760.48,-884.19 8755,-893.25 8761.85,-894.69"/>
</g>
<!-- output -->
<g id="node87" class="node">
<title>output</title>
<polygon fill="lightgreen" stroke="black" points="8874,-762.85 8662,-762.85 8662,-710.85 8874,-710.85 8874,-762.85"/>
<text text-anchor="middle" x="8768" y="-750.85" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="8768" y="-739.85" font-family="Arial" font-size="10.00">GPU: [4,5,6,7]</text>
<text text-anchor="middle" x="8768" y="-728.85" font-family="Arial" font-size="10.00">Input: [batch=8, seq=4096, vocab=128256]</text>
<text text-anchor="middle" x="8768" y="-717.85" font-family="Arial" font-size="10.00">Output: [batch=8, seq=4096, vocab=128256]</text>
</g>
<!-- logits_allgather&#45;&gt;output -->
<g id="edge33" class="edge">
<title>logits_allgather&#45;&gt;output</title>
<path fill="none" stroke="black" d="M8768,-810.55C8768,-798.51 8768,-785.1 8768,-773.11"/>
<polygon fill="black" stroke="black" points="8771.5,-773.01 8768,-763.01 8764.5,-773.01 8771.5,-773.01"/>
</g>
<!-- pipeline_comm&#45;&gt;input_stage1 -->
<g id="edge16" class="edge">
<title>pipeline_comm&#45;&gt;input_stage1</title>
<path fill="none" stroke="black" d="M13007.92,-1394.38C13693.94,-1392.49 16713.12,-1380.59 16901,-1316.7 16930.77,-1306.57 16959.19,-1285.28 16979.82,-1266.93"/>
<polygon fill="black" stroke="black" points="16982.3,-1269.4 16987.33,-1260.07 16977.58,-1264.23 16982.3,-1269.4"/>
</g>
</g>
</svg>
