<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1800pt" height="717pt"
 viewBox="0.00 0.00 1800.00 717.46" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.47 0.47) rotate(0) translate(4 1514.62)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1514.62 3806,-1514.62 3806,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_experts</title>
<path fill="lightgray" stroke="black" d="M20,-651.54C20,-651.54 3770,-651.54 3770,-651.54 3776,-651.54 3782,-657.54 3782,-663.54 3782,-663.54 3782,-741.54 3782,-741.54 3782,-747.54 3776,-753.54 3770,-753.54 3770,-753.54 20,-753.54 20,-753.54 14,-753.54 8,-747.54 8,-741.54 8,-741.54 8,-663.54 8,-663.54 8,-657.54 14,-651.54 20,-651.54"/>
<text text-anchor="middle" x="1895" y="-738.34" font-family="Times,serif" font-size="14.00">Expert Parallelism &#45; One Expert Per GPU</text>
</g>
<!-- layer_input -->
<g id="node1" class="node">
<title>layer_input</title>
<polygon fill="lightgreen" stroke="black" points="2104,-1510.62 1796,-1510.62 1796,-1469.62 2104,-1469.62 2104,-1510.62"/>
<text text-anchor="middle" x="1950" y="-1498.62" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="1950" y="-1487.62" font-family="Arial" font-size="10.00">GPU: Distributed</text>
<text text-anchor="middle" x="1950" y="-1476.62" font-family="Arial" font-size="10.00">Input: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- mha -->
<g id="node2" class="node">
<title>mha</title>
<polygon fill="lightgreen" stroke="black" points="2108,-1432.62 1792,-1432.62 1792,-1380.62 2108,-1380.62 2108,-1432.62"/>
<text text-anchor="middle" x="1950" y="-1420.62" font-family="Arial" font-size="10.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1950" y="-1409.62" font-family="Arial" font-size="10.00">GPU: Replicated Across Nodes</text>
<text text-anchor="middle" x="1950" y="-1398.62" font-family="Arial" font-size="10.00">Input: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
<text text-anchor="middle" x="1950" y="-1387.62" font-family="Arial" font-size="10.00">Output: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- layer_input&#45;&gt;mha -->
<g id="edge1" class="edge">
<title>layer_input&#45;&gt;mha</title>
<path fill="none" stroke="black" d="M1950,-1469.39C1950,-1461.38 1950,-1451.88 1950,-1442.76"/>
<polygon fill="black" stroke="black" points="1953.5,-1442.72 1950,-1432.72 1946.5,-1442.72 1953.5,-1442.72"/>
</g>
<!-- residual1 -->
<g id="node3" class="node">
<title>residual1</title>
<polygon fill="lightyellow" stroke="black" points="2286.89,-1343.62 1750.97,-1343.62 1613.11,-1239.62 2149.03,-1239.62 2286.89,-1343.62"/>
<text text-anchor="middle" x="1950" y="-1305.62" font-family="Arial" font-size="10.00">Residual Add 1</text>
<text text-anchor="middle" x="1950" y="-1294.62" font-family="Arial" font-size="10.00">GPU: Replicated</text>
<text text-anchor="middle" x="1950" y="-1283.62" font-family="Arial" font-size="10.00">Input: [batch_size=batch_size, seq_len=seq_len, token_dim=7168] x 2</text>
<text text-anchor="middle" x="1950" y="-1272.62" font-family="Arial" font-size="10.00">Output: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- mha&#45;&gt;residual1 -->
<g id="edge2" class="edge">
<title>mha&#45;&gt;residual1</title>
<path fill="none" stroke="black" d="M1950,-1380.54C1950,-1372.61 1950,-1363.48 1950,-1354.16"/>
<polygon fill="black" stroke="black" points="1953.5,-1354.02 1950,-1344.02 1946.5,-1354.02 1953.5,-1354.02"/>
</g>
<!-- ln1 -->
<g id="node4" class="node">
<title>ln1</title>
<polygon fill="lightgreen" stroke="black" points="2108,-1202.62 1792,-1202.62 1792,-1150.62 2108,-1150.62 2108,-1202.62"/>
<text text-anchor="middle" x="1950" y="-1190.62" font-family="Arial" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1950" y="-1179.62" font-family="Arial" font-size="10.00">GPU: Replicated</text>
<text text-anchor="middle" x="1950" y="-1168.62" font-family="Arial" font-size="10.00">Input: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
<text text-anchor="middle" x="1950" y="-1157.62" font-family="Arial" font-size="10.00">Output: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- residual1&#45;&gt;ln1 -->
<g id="edge3" class="edge">
<title>residual1&#45;&gt;ln1</title>
<path fill="none" stroke="black" d="M1950,-1239.41C1950,-1230.46 1950,-1221.33 1950,-1212.93"/>
<polygon fill="black" stroke="black" points="1953.5,-1212.75 1950,-1202.75 1946.5,-1212.75 1953.5,-1212.75"/>
</g>
<!-- gate -->
<g id="node5" class="node">
<title>gate</title>
<polygon fill="lightyellow" stroke="black" points="2278.8,-1113.62 1755.75,-1113.62 1621.2,-1009.62 2144.25,-1009.62 2278.8,-1113.62"/>
<text text-anchor="middle" x="1950" y="-1075.62" font-family="Arial" font-size="10.00">Gating Network (Top&#45;2)</text>
<text text-anchor="middle" x="1950" y="-1064.62" font-family="Arial" font-size="10.00">GPU: Replicated per node</text>
<text text-anchor="middle" x="1950" y="-1053.62" font-family="Arial" font-size="10.00">Input: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
<text text-anchor="middle" x="1950" y="-1042.62" font-family="Arial" font-size="10.00">Output: [batch_size=batch_size, seq_len=seq_len, num_experts=16]</text>
</g>
<!-- ln1&#45;&gt;gate -->
<g id="edge4" class="edge">
<title>ln1&#45;&gt;gate</title>
<path fill="none" stroke="black" d="M1950,-1150.54C1950,-1142.61 1950,-1133.48 1950,-1124.16"/>
<polygon fill="black" stroke="black" points="1953.5,-1124.02 1950,-1114.02 1946.5,-1124.02 1953.5,-1124.02"/>
</g>
<!-- token_split -->
<g id="node6" class="node">
<title>token_split</title>
<ellipse fill="lightblue" stroke="black" cx="2073" cy="-935.85" rx="217.58" ry="36.54"/>
<text text-anchor="middle" x="2073" y="-949.85" font-family="Arial" font-size="10.00">Token Split by Expert</text>
<text text-anchor="middle" x="2073" y="-938.85" font-family="Arial" font-size="10.00">GPU: All GPUs</text>
<text text-anchor="middle" x="2073" y="-927.85" font-family="Arial" font-size="10.00">Input: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
<text text-anchor="middle" x="2073" y="-916.85" font-family="Arial" font-size="10.00">Output: Expert&#45;specific token subsets</text>
</g>
<!-- gate&#45;&gt;token_split -->
<g id="edge5" class="edge">
<title>gate&#45;&gt;token_split</title>
<path fill="none" stroke="black" d="M2000.74,-1009.56C2010.65,-999.59 2020.95,-989.22 2030.56,-979.55"/>
<polygon fill="black" stroke="black" points="2033.19,-981.87 2037.76,-972.31 2028.23,-976.94 2033.19,-981.87"/>
</g>
<!-- expert_0 -->
<g id="node8" class="node">
<title>expert_0</title>
<polygon fill="lightgreen" stroke="black" points="234,-722.54 16,-722.54 16,-659.54 234,-659.54 234,-722.54"/>
<text text-anchor="middle" x="125" y="-710.54" font-family="Arial" font-size="10.00">Expert 0 MLP</text>
<text text-anchor="middle" x="125" y="-699.54" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="125" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="125" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="125" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_0 -->
<g id="edge45" class="edge">
<title>gate&#45;&gt;expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1668.57,-1046.3C1480.06,-1033.79 1226.89,-1011.36 1006,-972.62 799.75,-936.44 750.93,-913.03 550,-854.08 412.23,-813.66 375.33,-809.25 243,-753.54 224.78,-745.87 205.55,-736.45 188.03,-727.32"/>
<polygon fill="black" stroke="black" points="189.51,-724.14 179.04,-722.58 186.25,-730.33 189.51,-724.14"/>
<text text-anchor="middle" x="648.5" y="-874.68" font-family="Arial" font-size="8.00">selects</text>
</g>
<!-- expert_1 -->
<g id="node9" class="node">
<title>expert_1</title>
<polygon fill="lightgreen" stroke="black" points="3066,-722.54 2848,-722.54 2848,-659.54 3066,-659.54 3066,-722.54"/>
<text text-anchor="middle" x="2957" y="-710.54" font-family="Arial" font-size="10.00">Expert 1 MLP</text>
<text text-anchor="middle" x="2957" y="-699.54" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="2957" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="2957" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="2957" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_1 -->
<g id="edge46" class="edge">
<title>gate&#45;&gt;expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2163.38,-1024.41C2222.28,-1014.12 2286.17,-1002.7 2345,-991.62 2386.89,-983.73 2398.93,-987.15 2439,-972.62 2618.53,-907.5 2811.75,-788.1 2903.18,-728.25"/>
<polygon fill="black" stroke="black" points="2905.27,-731.07 2911.7,-722.65 2901.42,-725.22 2905.27,-731.07"/>
</g>
<!-- expert_2 -->
<g id="node10" class="node">
<title>expert_2</title>
<polygon fill="lightgreen" stroke="black" points="1178,-722.54 960,-722.54 960,-659.54 1178,-659.54 1178,-722.54"/>
<text text-anchor="middle" x="1069" y="-710.54" font-family="Arial" font-size="10.00">Expert 2 MLP</text>
<text text-anchor="middle" x="1069" y="-699.54" font-family="Arial" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="1069" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="1069" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="1069" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_2 -->
<g id="edge47" class="edge">
<title>gate&#45;&gt;expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1765.23,-1009.56C1743.75,-999.3 1723.08,-987.09 1705,-972.62 1618.25,-903.18 1667.82,-816.08 1571,-761.54 1552.41,-751.07 1207.67,-758.83 1187,-753.54 1165.46,-748.02 1143.43,-737.96 1124.33,-727.55"/>
<polygon fill="black" stroke="black" points="1125.93,-724.43 1115.49,-722.6 1122.51,-730.54 1125.93,-724.43"/>
</g>
<!-- expert_3 -->
<g id="node11" class="node">
<title>expert_3</title>
<polygon fill="lightgreen" stroke="black" points="3774,-722.54 3556,-722.54 3556,-659.54 3774,-659.54 3774,-722.54"/>
<text text-anchor="middle" x="3665" y="-710.54" font-family="Arial" font-size="10.00">Expert 3 MLP</text>
<text text-anchor="middle" x="3665" y="-699.54" font-family="Arial" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="3665" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="3665" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="3665" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_3 -->
<g id="edge48" class="edge">
<title>gate&#45;&gt;expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2194.47,-1048.19C2368.95,-1036.32 2608.49,-1013.87 2816,-972.62 3148.66,-906.49 3232.77,-881.17 3547,-753.54 3565.5,-746.03 3584.96,-736.57 3602.62,-727.35"/>
<polygon fill="black" stroke="black" points="3604.47,-730.33 3611.68,-722.56 3601.2,-724.14 3604.47,-730.33"/>
</g>
<!-- expert_4 -->
<g id="node12" class="node">
<title>expert_4</title>
<polygon fill="lightgreen" stroke="black" points="1650,-722.54 1432,-722.54 1432,-659.54 1650,-659.54 1650,-722.54"/>
<text text-anchor="middle" x="1541" y="-710.54" font-family="Arial" font-size="10.00">Expert 4 MLP</text>
<text text-anchor="middle" x="1541" y="-699.54" font-family="Arial" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="1541" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="1541" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="1541" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_4 -->
<g id="edge49" class="edge">
<title>gate&#45;&gt;expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1846.27,-1009.61C1829.95,-998.81 1814.15,-986.44 1801,-972.62 1727.92,-895.84 1773.11,-827.33 1690,-761.54 1678.84,-752.71 1672.28,-758.64 1659,-753.54 1640.08,-746.28 1620.28,-736.77 1602.41,-727.41"/>
<polygon fill="black" stroke="black" points="1603.73,-724.15 1593.26,-722.55 1600.45,-730.33 1603.73,-724.15"/>
</g>
<!-- expert_5 -->
<g id="node13" class="node">
<title>expert_5</title>
<polygon fill="lightgreen" stroke="black" points="2830,-722.54 2612,-722.54 2612,-659.54 2830,-659.54 2830,-722.54"/>
<text text-anchor="middle" x="2721" y="-710.54" font-family="Arial" font-size="10.00">Expert 5 MLP</text>
<text text-anchor="middle" x="2721" y="-699.54" font-family="Arial" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="2721" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="2721" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="2721" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_5 -->
<g id="edge50" class="edge">
<title>gate&#45;&gt;expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2179.96,-1037.04C2243.85,-1024.03 2311.43,-1003.87 2369,-972.62 2495.13,-904.14 2621.44,-789.52 2682.77,-730.2"/>
<polygon fill="black" stroke="black" points="2685.54,-732.38 2690.27,-722.9 2680.66,-727.36 2685.54,-732.38"/>
</g>
<!-- expert_6 -->
<g id="node14" class="node">
<title>expert_6</title>
<polygon fill="lightgreen" stroke="black" points="470,-722.54 252,-722.54 252,-659.54 470,-659.54 470,-722.54"/>
<text text-anchor="middle" x="361" y="-710.54" font-family="Arial" font-size="10.00">Expert 6 MLP</text>
<text text-anchor="middle" x="361" y="-699.54" font-family="Arial" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="361" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="361" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="361" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_6 -->
<g id="edge51" class="edge">
<title>gate&#45;&gt;expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1626.31,-1009.57C1559.6,-998.15 1489.92,-985.56 1425,-972.62 1001.76,-888.22 883.81,-903.15 479,-753.54 459.9,-746.48 439.97,-736.99 422.04,-727.58"/>
<polygon fill="black" stroke="black" points="423.33,-724.31 412.86,-722.69 420.03,-730.48 423.33,-724.31"/>
</g>
<!-- expert_7 -->
<g id="node15" class="node">
<title>expert_7</title>
<polygon fill="lightgreen" stroke="black" points="942,-722.54 724,-722.54 724,-659.54 942,-659.54 942,-722.54"/>
<text text-anchor="middle" x="833" y="-710.54" font-family="Arial" font-size="10.00">Expert 7 MLP</text>
<text text-anchor="middle" x="833" y="-699.54" font-family="Arial" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="833" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="833" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="833" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_7 -->
<g id="edge52" class="edge">
<title>gate&#45;&gt;expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1723.7,-1009.58C1697.54,-999.34 1672.03,-987.13 1649,-972.62 1542.48,-905.46 1574.56,-813.82 1460,-761.54 1434.27,-749.8 978.42,-760.48 951,-753.54 929.44,-748.08 907.42,-738.03 888.32,-727.62"/>
<polygon fill="black" stroke="black" points="889.91,-724.5 879.48,-722.66 886.49,-730.6 889.91,-724.5"/>
</g>
<!-- expert_8 -->
<g id="node16" class="node">
<title>expert_8</title>
<polygon fill="lightgreen" stroke="black" points="1414,-722.54 1196,-722.54 1196,-659.54 1414,-659.54 1414,-722.54"/>
<text text-anchor="middle" x="1305" y="-710.54" font-family="Arial" font-size="10.00">Expert 8 MLP</text>
<text text-anchor="middle" x="1305" y="-699.54" font-family="Arial" font-size="10.00">GPU: 8</text>
<text text-anchor="middle" x="1305" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="1305" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="1305" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_8 -->
<g id="edge53" class="edge">
<title>gate&#45;&gt;expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1806.74,-1009.52C1787.77,-999.09 1769.54,-986.85 1754,-972.62 1674.74,-900.03 1727.67,-817.65 1636,-761.54 1615.8,-749.17 1445.89,-759.6 1423,-753.54 1401.6,-747.87 1379.69,-737.83 1360.65,-727.48"/>
<polygon fill="black" stroke="black" points="1362.27,-724.38 1351.83,-722.56 1358.85,-730.49 1362.27,-724.38"/>
</g>
<!-- expert_9 -->
<g id="node17" class="node">
<title>expert_9</title>
<polygon fill="lightgreen" stroke="black" points="706,-722.54 488,-722.54 488,-659.54 706,-659.54 706,-722.54"/>
<text text-anchor="middle" x="597" y="-710.54" font-family="Arial" font-size="10.00">Expert 9 MLP</text>
<text text-anchor="middle" x="597" y="-699.54" font-family="Arial" font-size="10.00">GPU: 9</text>
<text text-anchor="middle" x="597" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="597" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="597" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_9 -->
<g id="edge54" class="edge">
<title>gate&#45;&gt;expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1692.45,-1009.56C1651.97,-998.95 1610.99,-986.65 1573,-972.62 1381.86,-902 1363.53,-811.57 1166,-761.54 1117.42,-749.23 763.57,-765.89 715,-753.54 693.45,-748.06 671.42,-738 652.32,-727.59"/>
<polygon fill="black" stroke="black" points="653.92,-724.47 643.48,-722.63 650.49,-730.58 653.92,-724.47"/>
</g>
<!-- expert_10 -->
<g id="node18" class="node">
<title>expert_10</title>
<polygon fill="lightgreen" stroke="black" points="2594,-722.54 2376,-722.54 2376,-659.54 2594,-659.54 2594,-722.54"/>
<text text-anchor="middle" x="2485" y="-710.54" font-family="Arial" font-size="10.00">Expert 10 MLP</text>
<text text-anchor="middle" x="2485" y="-699.54" font-family="Arial" font-size="10.00">GPU: 10</text>
<text text-anchor="middle" x="2485" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="2485" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="2485" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_10 -->
<g id="edge55" class="edge">
<title>gate&#45;&gt;expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2169.53,-1029.09C2237.91,-1015.13 2301.78,-996.4 2326,-972.62 2398.13,-901.79 2447.61,-791.3 2470.51,-732.33"/>
<polygon fill="black" stroke="black" points="2473.91,-733.22 2474.21,-722.63 2467.37,-730.72 2473.91,-733.22"/>
</g>
<!-- expert_11 -->
<g id="node19" class="node">
<title>expert_11</title>
<polygon fill="lightgreen" stroke="black" points="3302,-722.54 3084,-722.54 3084,-659.54 3302,-659.54 3302,-722.54"/>
<text text-anchor="middle" x="3193" y="-710.54" font-family="Arial" font-size="10.00">Expert 11 MLP</text>
<text text-anchor="middle" x="3193" y="-699.54" font-family="Arial" font-size="10.00">GPU: 11</text>
<text text-anchor="middle" x="3193" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="3193" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="3193" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_11 -->
<g id="edge56" class="edge">
<title>gate&#45;&gt;expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2181.93,-1038.74C2290.96,-1025.19 2421.97,-1004.17 2537,-972.62 2785.98,-904.31 2840.71,-862 3075,-753.54 3092.25,-745.55 3110.59,-736.35 3127.55,-727.54"/>
<polygon fill="black" stroke="black" points="3129.58,-730.43 3136.82,-722.69 3126.33,-724.22 3129.58,-730.43"/>
</g>
<!-- expert_12 -->
<g id="node20" class="node">
<title>expert_12</title>
<polygon fill="lightgreen" stroke="black" points="3538,-722.54 3320,-722.54 3320,-659.54 3538,-659.54 3538,-722.54"/>
<text text-anchor="middle" x="3429" y="-710.54" font-family="Arial" font-size="10.00">Expert 12 MLP</text>
<text text-anchor="middle" x="3429" y="-699.54" font-family="Arial" font-size="10.00">GPU: 12</text>
<text text-anchor="middle" x="3429" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="3429" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="3429" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_12 -->
<g id="edge57" class="edge">
<title>gate&#45;&gt;expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2188.14,-1043.42C2327.71,-1030.32 2506.75,-1008.28 2663,-972.62 2959.39,-904.96 3031.37,-872.83 3311,-753.54 3329.09,-745.82 3348.21,-736.43 3365.66,-727.34"/>
<polygon fill="black" stroke="black" points="3367.4,-730.38 3374.62,-722.62 3364.14,-724.18 3367.4,-730.38"/>
</g>
<!-- expert_13 -->
<g id="node21" class="node">
<title>expert_13</title>
<polygon fill="lightgreen" stroke="black" points="1886,-722.54 1668,-722.54 1668,-659.54 1886,-659.54 1886,-722.54"/>
<text text-anchor="middle" x="1777" y="-710.54" font-family="Arial" font-size="10.00">Expert 13 MLP</text>
<text text-anchor="middle" x="1777" y="-699.54" font-family="Arial" font-size="10.00">GPU: 13</text>
<text text-anchor="middle" x="1777" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="1777" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="1777" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_13 -->
<g id="edge58" class="edge">
<title>gate&#45;&gt;expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1863.57,-1009.56C1851.76,-998.85 1841.23,-986.52 1834,-972.62 1793.31,-894.35 1781.65,-789.77 1778.31,-732.97"/>
<polygon fill="black" stroke="black" points="1781.81,-732.73 1777.78,-722.93 1774.82,-733.1 1781.81,-732.73"/>
</g>
<!-- expert_14 -->
<g id="node22" class="node">
<title>expert_14</title>
<polygon fill="lightgreen" stroke="black" points="2358,-722.54 2140,-722.54 2140,-659.54 2358,-659.54 2358,-722.54"/>
<text text-anchor="middle" x="2249" y="-710.54" font-family="Arial" font-size="10.00">Expert 14 MLP</text>
<text text-anchor="middle" x="2249" y="-699.54" font-family="Arial" font-size="10.00">GPU: 14</text>
<text text-anchor="middle" x="2249" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="2249" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="2249" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_14 -->
<g id="edge59" class="edge">
<title>gate&#45;&gt;expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2168.53,-1028.04C2228.23,-1014.45 2281.6,-996.21 2300,-972.62 2355.19,-901.83 2306.63,-790.58 2273.59,-731.68"/>
<polygon fill="black" stroke="black" points="2276.45,-729.63 2268.44,-722.7 2270.38,-733.11 2276.45,-729.63"/>
</g>
<!-- expert_15 -->
<g id="node23" class="node">
<title>expert_15</title>
<polygon fill="lightgreen" stroke="black" points="2122,-722.54 1904,-722.54 1904,-659.54 2122,-659.54 2122,-722.54"/>
<text text-anchor="middle" x="2013" y="-710.54" font-family="Arial" font-size="10.00">Expert 15 MLP</text>
<text text-anchor="middle" x="2013" y="-699.54" font-family="Arial" font-size="10.00">GPU: 15</text>
<text text-anchor="middle" x="2013" y="-688.54" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="2013" y="-677.54" font-family="Arial" font-size="10.00">Output: [batch_size_subset, token_dim=7168]</text>
<text text-anchor="middle" x="2013" y="-666.54" font-family="Arial" font-size="10.00">Hidden: 2048</text>
</g>
<!-- gate&#45;&gt;expert_15 -->
<g id="edge60" class="edge">
<title>gate&#45;&gt;expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1873,-1009.54C1862.05,-998.72 1852.37,-986.35 1846,-972.62 1832.25,-942.97 1841.45,-931.44 1846,-899.08 1853.63,-844.8 1847.64,-824.78 1880,-780.54 1895.47,-759.39 1917.63,-741.8 1939.44,-728.02"/>
<polygon fill="black" stroke="black" points="1941.38,-730.94 1948.09,-722.74 1937.73,-724.97 1941.38,-730.94"/>
</g>
<!-- weighted_combine -->
<g id="node25" class="node">
<title>weighted_combine</title>
<polygon fill="lightyellow" stroke="black" points="3234.73,-512 2713.39,-512 2579.27,-408 3100.61,-408 3234.73,-512"/>
<text text-anchor="middle" x="2907" y="-474" font-family="Arial" font-size="10.00">Weighted Combination</text>
<text text-anchor="middle" x="2907" y="-463" font-family="Arial" font-size="10.00">GPU: Replicated</text>
<text text-anchor="middle" x="2907" y="-452" font-family="Arial" font-size="10.00">Input: Expert outputs + Gate weights</text>
<text text-anchor="middle" x="2907" y="-441" font-family="Arial" font-size="10.00">Output: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- gate&#45;&gt;weighted_combine -->
<g id="edge40" class="edge">
<title>gate&#45;&gt;weighted_combine</title>
<path fill="none" stroke="black" d="M2205.08,-1056.47C2712.93,-1046.5 3802,-1015.92 3802,-936.85 3802,-936.85 3802,-936.85 3802,-584.77 3802,-522.41 3456.67,-489.77 3195.02,-473.98"/>
<polygon fill="black" stroke="black" points="3195.16,-470.48 3184.97,-473.38 3194.75,-477.47 3195.16,-470.48"/>
</g>
<!-- comm_node -->
<g id="node7" class="node">
<title>comm_node</title>
<ellipse fill="lightblue" stroke="black" cx="2013" cy="-817.31" rx="123.99" ry="36.54"/>
<text text-anchor="middle" x="2013" y="-831.31" font-family="Arial" font-size="10.00">Cross&#45;Node Token Transfer</text>
<text text-anchor="middle" x="2013" y="-820.31" font-family="Arial" font-size="10.00">GPU: NCCL Async</text>
<text text-anchor="middle" x="2013" y="-809.31" font-family="Arial" font-size="10.00">Input: Token subsets</text>
<text text-anchor="middle" x="2013" y="-798.31" font-family="Arial" font-size="10.00">Output: Routed to destination GPUs</text>
</g>
<!-- token_split&#45;&gt;comm_node -->
<g id="edge6" class="edge">
<title>token_split&#45;&gt;comm_node</title>
<path fill="none" stroke="black" d="M2054.51,-898.93C2048.64,-887.53 2042.07,-874.77 2035.93,-862.84"/>
<polygon fill="black" stroke="black" points="2039.02,-861.19 2031.33,-853.91 2032.79,-864.4 2039.02,-861.19"/>
</g>
<!-- comm_node&#45;&gt;expert_0 -->
<g id="edge7" class="edge">
<title>comm_node&#45;&gt;expert_0</title>
<path fill="none" stroke="black" d="M1889.41,-815.08C1513.64,-810.91 400.76,-795.16 243,-753.54 221.6,-747.89 199.68,-737.86 180.64,-727.51"/>
<polygon fill="black" stroke="black" points="182.26,-724.4 171.82,-722.58 178.85,-730.51 182.26,-724.4"/>
</g>
<!-- comm_node&#45;&gt;expert_1 -->
<g id="edge8" class="edge">
<title>comm_node&#45;&gt;expert_1</title>
<path fill="none" stroke="black" d="M2133.25,-808.45C2354.27,-793.82 2805.68,-763.05 2839,-753.54 2859.9,-747.57 2881.38,-737.68 2900.19,-727.56"/>
<polygon fill="black" stroke="black" points="2902.13,-730.48 2909.2,-722.59 2898.75,-724.36 2902.13,-730.48"/>
</g>
<!-- comm_node&#45;&gt;expert_2 -->
<g id="edge9" class="edge">
<title>comm_node&#45;&gt;expert_2</title>
<path fill="none" stroke="black" d="M1908.58,-797.52C1833.13,-784.82 1728.62,-769.06 1636,-761.54 1586.27,-757.5 1235.36,-765.84 1187,-753.54 1165.45,-748.06 1143.42,-738 1124.32,-727.59"/>
<polygon fill="black" stroke="black" points="1125.92,-724.47 1115.48,-722.63 1122.49,-730.58 1125.92,-724.47"/>
</g>
<!-- comm_node&#45;&gt;expert_3 -->
<g id="edge10" class="edge">
<title>comm_node&#45;&gt;expert_3</title>
<path fill="none" stroke="black" d="M2135.7,-812C2493.56,-799.34 3513.05,-762.6 3547,-753.54 3568.29,-747.86 3590.1,-737.87 3609.08,-727.58"/>
<polygon fill="black" stroke="black" points="3610.85,-730.6 3617.88,-722.68 3607.44,-724.49 3610.85,-730.6"/>
</g>
<!-- comm_node&#45;&gt;expert_4 -->
<g id="edge11" class="edge">
<title>comm_node&#45;&gt;expert_4</title>
<path fill="none" stroke="black" d="M1915.72,-794.57C1863.28,-783.46 1797.34,-770.43 1738,-761.54 1703.1,-756.31 1692.81,-763.65 1659,-753.54 1638.36,-747.37 1617.11,-737.53 1598.42,-727.52"/>
<polygon fill="black" stroke="black" points="1599.91,-724.35 1589.46,-722.61 1596.55,-730.49 1599.91,-724.35"/>
</g>
<!-- comm_node&#45;&gt;expert_5 -->
<g id="edge12" class="edge">
<title>comm_node&#45;&gt;expert_5</title>
<path fill="none" stroke="black" d="M2136.83,-816.46C2258.07,-813.53 2446.82,-800.69 2603,-753.54 2623.62,-747.31 2644.87,-737.46 2663.56,-727.46"/>
<polygon fill="black" stroke="black" points="2665.43,-730.42 2672.52,-722.55 2662.07,-724.29 2665.43,-730.42"/>
</g>
<!-- comm_node&#45;&gt;expert_6 -->
<g id="edge13" class="edge">
<title>comm_node&#45;&gt;expert_6</title>
<path fill="none" stroke="black" d="M1894.22,-806.64C1730.47,-793.76 1426.08,-771.46 1166,-761.54 1127.86,-760.08 516.02,-762.84 479,-753.54 457.34,-748.1 435.2,-737.99 416.05,-727.53"/>
<polygon fill="black" stroke="black" points="417.62,-724.39 407.18,-722.54 414.19,-730.49 417.62,-724.39"/>
</g>
<!-- comm_node&#45;&gt;expert_7 -->
<g id="edge14" class="edge">
<title>comm_node&#45;&gt;expert_7</title>
<path fill="none" stroke="black" d="M1904.34,-799.45C1815.06,-786.41 1685.17,-769.33 1571,-761.54 1536.63,-759.2 984.4,-761.95 951,-753.54 929.44,-748.11 907.41,-738.07 888.31,-727.65"/>
<polygon fill="black" stroke="black" points="889.9,-724.53 879.47,-722.69 886.48,-730.64 889.9,-724.53"/>
</g>
<!-- comm_node&#45;&gt;expert_8 -->
<g id="edge15" class="edge">
<title>comm_node&#45;&gt;expert_8</title>
<path fill="none" stroke="black" d="M1912.47,-795.71C1848.5,-783.52 1763.73,-769.03 1688,-761.54 1629.37,-755.74 1480.01,-768.42 1423,-753.54 1401.58,-747.95 1379.66,-737.93 1360.62,-727.57"/>
<polygon fill="black" stroke="black" points="1362.24,-724.47 1351.81,-722.65 1358.83,-730.58 1362.24,-724.47"/>
</g>
<!-- comm_node&#45;&gt;expert_9 -->
<g id="edge16" class="edge">
<title>comm_node&#45;&gt;expert_9</title>
<path fill="none" stroke="black" d="M1900.16,-802.2C1788.57,-788.94 1612.81,-769.91 1460,-761.54 1418.67,-759.27 755.15,-763.6 715,-753.54 693.33,-748.11 671.2,-738.01 652.05,-727.54"/>
<polygon fill="black" stroke="black" points="653.61,-724.4 643.18,-722.55 650.18,-730.51 653.61,-724.4"/>
</g>
<!-- comm_node&#45;&gt;expert_10 -->
<g id="edge17" class="edge">
<title>comm_node&#45;&gt;expert_10</title>
<path fill="none" stroke="black" d="M2129.62,-804.71C2199.75,-795.52 2290.04,-779.73 2367,-753.54 2386.74,-746.82 2407.23,-737.2 2425.48,-727.55"/>
<polygon fill="black" stroke="black" points="2427.39,-730.5 2434.53,-722.67 2424.06,-724.34 2427.39,-730.5"/>
</g>
<!-- comm_node&#45;&gt;expert_11 -->
<g id="edge18" class="edge">
<title>comm_node&#45;&gt;expert_11</title>
<path fill="none" stroke="black" d="M2134.81,-810.48C2404.22,-797.39 3030.38,-765.87 3075,-753.54 3096.14,-747.69 3117.84,-737.72 3136.77,-727.49"/>
<polygon fill="black" stroke="black" points="3138.49,-730.54 3145.54,-722.62 3135.09,-724.42 3138.49,-730.54"/>
</g>
<!-- comm_node&#45;&gt;expert_12 -->
<g id="edge19" class="edge">
<title>comm_node&#45;&gt;expert_12</title>
<path fill="none" stroke="black" d="M2135.5,-811.81C2448.12,-800.13 3254.91,-768.72 3311,-753.54 3332.27,-747.78 3354.07,-737.77 3373.06,-727.49"/>
<polygon fill="black" stroke="black" points="3374.82,-730.51 3381.85,-722.59 3371.41,-724.4 3374.82,-730.51"/>
</g>
<!-- comm_node&#45;&gt;expert_13 -->
<g id="edge20" class="edge">
<title>comm_node&#45;&gt;expert_13</title>
<path fill="none" stroke="black" d="M1953.45,-784.95C1920.23,-767.46 1878.75,-745.62 1844.35,-727.5"/>
<polygon fill="black" stroke="black" points="1845.79,-724.3 1835.31,-722.74 1842.53,-730.5 1845.79,-724.3"/>
</g>
<!-- comm_node&#45;&gt;expert_14 -->
<g id="edge21" class="edge">
<title>comm_node&#45;&gt;expert_14</title>
<path fill="none" stroke="black" d="M2072.55,-784.95C2105.77,-767.46 2147.25,-745.62 2181.65,-727.5"/>
<polygon fill="black" stroke="black" points="2183.47,-730.5 2190.69,-722.74 2180.21,-724.3 2183.47,-730.5"/>
</g>
<!-- comm_node&#45;&gt;expert_15 -->
<g id="edge22" class="edge">
<title>comm_node&#45;&gt;expert_15</title>
<path fill="none" stroke="black" d="M2013,-780.36C2013,-765.57 2013,-748.35 2013,-733.07"/>
<polygon fill="black" stroke="black" points="2016.5,-732.85 2013,-722.85 2009.5,-732.85 2016.5,-732.85"/>
</g>
<!-- expert_aggregate -->
<g id="node24" class="node">
<title>expert_aggregate</title>
<ellipse fill="lightblue" stroke="black" cx="2013" cy="-585.77" rx="223.39" ry="36.54"/>
<text text-anchor="middle" x="2013" y="-599.77" font-family="Arial" font-size="10.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="2013" y="-588.77" font-family="Arial" font-size="10.00">GPU: All GPUs</text>
<text text-anchor="middle" x="2013" y="-577.77" font-family="Arial" font-size="10.00">Input: [batch_size_subset, token_dim=7168] x 16</text>
<text text-anchor="middle" x="2013" y="-566.77" font-family="Arial" font-size="10.00">Output: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- expert_0&#45;&gt;expert_aggregate -->
<g id="edge23" class="edge">
<title>expert_0&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M209.03,-659.49C220.33,-656.31 231.86,-653.52 243,-651.54 530.85,-600.35 1367.68,-589.47 1779.1,-587.26"/>
<polygon fill="black" stroke="black" points="1779.36,-590.76 1789.34,-587.21 1779.32,-583.76 1779.36,-590.76"/>
</g>
<!-- expert_1&#45;&gt;expert_aggregate -->
<g id="edge24" class="edge">
<title>expert_1&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M2871.27,-659.46C2860.51,-656.4 2849.57,-653.65 2839,-651.54 2641.24,-612.11 2412.37,-596.44 2245.77,-590.33"/>
<polygon fill="black" stroke="black" points="2245.5,-586.82 2235.38,-589.96 2245.25,-593.82 2245.5,-586.82"/>
</g>
<!-- expert_2&#45;&gt;expert_aggregate -->
<g id="edge25" class="edge">
<title>expert_2&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M1154.73,-659.46C1165.49,-656.4 1176.43,-653.65 1187,-651.54 1384.76,-612.11 1613.63,-596.44 1780.23,-590.33"/>
<polygon fill="black" stroke="black" points="1780.75,-593.82 1790.62,-589.96 1780.5,-586.82 1780.75,-593.82"/>
</g>
<!-- expert_3&#45;&gt;expert_aggregate -->
<g id="edge26" class="edge">
<title>expert_3&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M3580.63,-659.46C3569.44,-656.3 3558.03,-653.53 3547,-651.54 3304.5,-607.72 2612.11,-593.41 2246.17,-588.84"/>
<polygon fill="black" stroke="black" points="2246.02,-585.34 2235.98,-588.72 2245.94,-592.34 2246.02,-585.34"/>
</g>
<!-- expert_4&#45;&gt;expert_aggregate -->
<g id="edge27" class="edge">
<title>expert_4&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M1630.51,-659.45C1640.08,-656.59 1649.7,-653.89 1659,-651.54 1718.26,-636.52 1783.93,-623.53 1842.45,-613.19"/>
<polygon fill="black" stroke="black" points="1843.29,-616.6 1852.53,-611.43 1842.08,-609.71 1843.29,-616.6"/>
</g>
<!-- expert_5&#45;&gt;expert_aggregate -->
<g id="edge28" class="edge">
<title>expert_5&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M2634.24,-659.5C2623.8,-656.49 2613.22,-653.74 2603,-651.54 2481.51,-625.34 2343.53,-609.46 2231.58,-599.98"/>
<polygon fill="black" stroke="black" points="2231.77,-596.48 2221.51,-599.13 2231.18,-603.46 2231.77,-596.48"/>
</g>
<!-- expert_6&#45;&gt;expert_aggregate -->
<g id="edge29" class="edge">
<title>expert_6&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M445.37,-659.46C456.56,-656.3 467.97,-653.53 479,-651.54 721.5,-607.72 1413.89,-593.41 1779.83,-588.84"/>
<polygon fill="black" stroke="black" points="1780.06,-592.34 1790.02,-588.72 1779.98,-585.34 1780.06,-592.34"/>
</g>
<!-- expert_7&#45;&gt;expert_aggregate -->
<g id="edge30" class="edge">
<title>expert_7&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M918.05,-659.47C929.03,-656.36 940.2,-653.59 951,-651.54 1104.9,-622.24 1521.14,-603.33 1784.48,-593.91"/>
<polygon fill="black" stroke="black" points="1784.69,-597.4 1794.56,-593.55 1784.44,-590.4 1784.69,-597.4"/>
</g>
<!-- expert_8&#45;&gt;expert_aggregate -->
<g id="edge31" class="edge">
<title>expert_8&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M1391.76,-659.5C1402.2,-656.49 1412.78,-653.74 1423,-651.54 1544.49,-625.34 1682.47,-609.46 1794.42,-599.98"/>
<polygon fill="black" stroke="black" points="1794.82,-603.46 1804.49,-599.13 1794.23,-596.48 1794.82,-603.46"/>
</g>
<!-- expert_9&#45;&gt;expert_aggregate -->
<g id="edge32" class="edge">
<title>expert_9&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M681.38,-659.54C692.57,-656.37 703.98,-653.57 715,-651.54 912.75,-615.02 1464.42,-597.95 1781.27,-590.96"/>
<polygon fill="black" stroke="black" points="1781.59,-594.45 1791.51,-590.73 1781.44,-587.45 1781.59,-594.45"/>
</g>
<!-- expert_10&#45;&gt;expert_aggregate -->
<g id="edge33" class="edge">
<title>expert_10&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M2395.49,-659.45C2385.92,-656.59 2376.3,-653.89 2367,-651.54 2307.74,-636.52 2242.07,-623.53 2183.55,-613.19"/>
<polygon fill="black" stroke="black" points="2183.92,-609.71 2173.47,-611.43 2182.71,-616.6 2183.92,-609.71"/>
</g>
<!-- expert_11&#45;&gt;expert_aggregate -->
<g id="edge34" class="edge">
<title>expert_11&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M3107.95,-659.47C3096.97,-656.36 3085.8,-653.59 3075,-651.54 2921.1,-622.24 2504.86,-603.33 2241.52,-593.91"/>
<polygon fill="black" stroke="black" points="2241.56,-590.4 2231.44,-593.55 2241.31,-597.4 2241.56,-590.4"/>
</g>
<!-- expert_12&#45;&gt;expert_aggregate -->
<g id="edge35" class="edge">
<title>expert_12&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M3344.62,-659.54C3333.43,-656.37 3322.02,-653.57 3311,-651.54 3113.25,-615.02 2561.58,-597.95 2244.73,-590.96"/>
<polygon fill="black" stroke="black" points="2244.56,-587.45 2234.49,-590.73 2244.41,-594.45 2244.56,-587.45"/>
</g>
<!-- expert_13&#45;&gt;expert_aggregate -->
<g id="edge36" class="edge">
<title>expert_13&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M1846.85,-659.47C1872.02,-648.46 1900.71,-635.9 1927.09,-624.36"/>
<polygon fill="black" stroke="black" points="1928.56,-627.54 1936.32,-620.32 1925.75,-621.13 1928.56,-627.54"/>
</g>
<!-- expert_14&#45;&gt;expert_aggregate -->
<g id="edge37" class="edge">
<title>expert_14&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M2179.15,-659.47C2153.98,-648.46 2125.29,-635.9 2098.91,-624.36"/>
<polygon fill="black" stroke="black" points="2100.25,-621.13 2089.68,-620.32 2097.44,-627.54 2100.25,-621.13"/>
</g>
<!-- expert_15&#45;&gt;expert_aggregate -->
<g id="edge38" class="edge">
<title>expert_15&#45;&gt;expert_aggregate</title>
<path fill="none" stroke="black" d="M2013,-659.33C2013,-650.95 2013,-641.69 2013,-632.66"/>
<polygon fill="black" stroke="black" points="2016.5,-632.63 2013,-622.63 2009.5,-632.63 2016.5,-632.63"/>
</g>
<!-- expert_aggregate&#45;&gt;weighted_combine -->
<g id="edge39" class="edge">
<title>expert_aggregate&#45;&gt;weighted_combine</title>
<path fill="none" stroke="black" d="M2181.15,-561.49C2321.1,-542.12 2521.75,-514.34 2676.64,-492.89"/>
<polygon fill="black" stroke="black" points="2677.35,-496.33 2686.77,-491.49 2676.39,-489.39 2677.35,-496.33"/>
</g>
<!-- ffn -->
<g id="node26" class="node">
<title>ffn</title>
<polygon fill="lightgreen" stroke="black" points="3065,-371 2749,-371 2749,-319 3065,-319 3065,-371"/>
<text text-anchor="middle" x="2907" y="-359" font-family="Arial" font-size="10.00">Feed&#45;Forward Network</text>
<text text-anchor="middle" x="2907" y="-348" font-family="Arial" font-size="10.00">GPU: Replicated</text>
<text text-anchor="middle" x="2907" y="-337" font-family="Arial" font-size="10.00">Input: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
<text text-anchor="middle" x="2907" y="-326" font-family="Arial" font-size="10.00">Output: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- weighted_combine&#45;&gt;ffn -->
<g id="edge41" class="edge">
<title>weighted_combine&#45;&gt;ffn</title>
<path fill="none" stroke="black" d="M2907,-407.79C2907,-398.84 2907,-389.71 2907,-381.31"/>
<polygon fill="black" stroke="black" points="2910.5,-381.13 2907,-371.13 2903.5,-381.13 2910.5,-381.13"/>
</g>
<!-- residual2 -->
<g id="node27" class="node">
<title>residual2</title>
<polygon fill="lightyellow" stroke="black" points="3243.89,-282 2707.97,-282 2570.11,-178 3106.03,-178 3243.89,-282"/>
<text text-anchor="middle" x="2907" y="-244" font-family="Arial" font-size="10.00">Residual Add 2</text>
<text text-anchor="middle" x="2907" y="-233" font-family="Arial" font-size="10.00">GPU: Replicated</text>
<text text-anchor="middle" x="2907" y="-222" font-family="Arial" font-size="10.00">Input: [batch_size=batch_size, seq_len=seq_len, token_dim=7168] x 2</text>
<text text-anchor="middle" x="2907" y="-211" font-family="Arial" font-size="10.00">Output: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- ffn&#45;&gt;residual2 -->
<g id="edge42" class="edge">
<title>ffn&#45;&gt;residual2</title>
<path fill="none" stroke="black" d="M2907,-318.92C2907,-311 2907,-301.86 2907,-292.54"/>
<polygon fill="black" stroke="black" points="2910.5,-292.4 2907,-282.4 2903.5,-292.4 2910.5,-292.4"/>
</g>
<!-- ln2 -->
<g id="node28" class="node">
<title>ln2</title>
<polygon fill="lightgreen" stroke="black" points="3065,-141 2749,-141 2749,-89 3065,-89 3065,-141"/>
<text text-anchor="middle" x="2907" y="-129" font-family="Arial" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2907" y="-118" font-family="Arial" font-size="10.00">GPU: Replicated</text>
<text text-anchor="middle" x="2907" y="-107" font-family="Arial" font-size="10.00">Input: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
<text text-anchor="middle" x="2907" y="-96" font-family="Arial" font-size="10.00">Output: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- residual2&#45;&gt;ln2 -->
<g id="edge43" class="edge">
<title>residual2&#45;&gt;ln2</title>
<path fill="none" stroke="black" d="M2907,-177.79C2907,-168.84 2907,-159.71 2907,-151.31"/>
<polygon fill="black" stroke="black" points="2910.5,-151.13 2907,-141.13 2903.5,-151.13 2910.5,-151.13"/>
</g>
<!-- layer_output -->
<g id="node29" class="node">
<title>layer_output</title>
<polygon fill="lightgreen" stroke="black" points="3065,-52 2749,-52 2749,0 3065,0 3065,-52"/>
<text text-anchor="middle" x="2907" y="-40" font-family="Arial" font-size="10.00">Layer Output</text>
<text text-anchor="middle" x="2907" y="-29" font-family="Arial" font-size="10.00">GPU: Distributed</text>
<text text-anchor="middle" x="2907" y="-18" font-family="Arial" font-size="10.00">Input: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
<text text-anchor="middle" x="2907" y="-7" font-family="Arial" font-size="10.00">Output: [batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- ln2&#45;&gt;layer_output -->
<g id="edge44" class="edge">
<title>ln2&#45;&gt;layer_output</title>
<path fill="none" stroke="black" d="M2907,-88.84C2907,-80.54 2907,-71.15 2907,-62.25"/>
<polygon fill="black" stroke="black" points="2910.5,-62.11 2907,-52.11 2903.5,-62.11 2910.5,-62.11"/>
</g>
</g>
</svg>
