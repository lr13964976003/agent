<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="709pt" height="749pt"
 viewBox="0.00 0.00 708.85 749.17" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 745.17)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-745.17 704.85,-745.17 704.85,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_experts</title>
<path fill="lightgray" stroke="black" d="M71.42,-231.08C71.42,-231.08 629.42,-231.08 629.42,-231.08 635.42,-231.08 641.42,-237.08 641.42,-243.08 641.42,-243.08 641.42,-305.08 641.42,-305.08 641.42,-311.08 635.42,-317.08 629.42,-317.08 629.42,-317.08 71.42,-317.08 71.42,-317.08 65.42,-317.08 59.42,-311.08 59.42,-305.08 59.42,-305.08 59.42,-243.08 59.42,-243.08 59.42,-237.08 65.42,-231.08 71.42,-231.08"/>
<text text-anchor="middle" x="350.42" y="-301.88" font-family="Times,serif" font-size="14.00">Expert Parallelism (16 Experts)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightgreen" stroke="black" points="519.42,-741.17 181.42,-741.17 181.42,-705.17 519.42,-705.17 519.42,-741.17"/>
<text text-anchor="middle" x="350.42" y="-726.57" font-family="Arial" font-size="12.00">Input</text>
<text text-anchor="middle" x="350.42" y="-713.57" font-family="Arial" font-size="12.00">[batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- dense_block -->
<g id="node2" class="node">
<title>dense_block</title>
<polygon fill="lightgreen" stroke="black" points="424.92,-669.17 275.92,-669.17 275.92,-622.17 424.92,-622.17 424.92,-669.17"/>
<text text-anchor="middle" x="350.42" y="-655.57" font-family="Arial" font-size="12.00">Dense Layers (1&#45;3)</text>
<text text-anchor="middle" x="350.42" y="-642.57" font-family="Arial" font-size="12.00">Replicated Across GPUs</text>
<text text-anchor="middle" x="350.42" y="-629.57" font-family="Arial" font-size="12.00">MHA + FFN</text>
</g>
<!-- input&#45;&gt;dense_block -->
<g id="edge1" class="edge">
<title>input&#45;&gt;dense_block</title>
<path fill="none" stroke="black" d="M350.42,-705.03C350.42,-697.4 350.42,-688.15 350.42,-679.29"/>
<polygon fill="black" stroke="black" points="353.92,-679.18 350.42,-669.18 346.92,-679.18 353.92,-679.18"/>
</g>
<!-- mha -->
<g id="node3" class="node">
<title>mha</title>
<polygon fill="lightgreen" stroke="black" points="519.42,-586.17 181.42,-586.17 181.42,-539.17 519.42,-539.17 519.42,-586.17"/>
<text text-anchor="middle" x="350.42" y="-572.57" font-family="Arial" font-size="12.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="350.42" y="-559.57" font-family="Arial" font-size="12.00">Replicated</text>
<text text-anchor="middle" x="350.42" y="-546.57" font-family="Arial" font-size="12.00">[batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- dense_block&#45;&gt;mha -->
<g id="edge2" class="edge">
<title>dense_block&#45;&gt;mha</title>
<path fill="none" stroke="black" d="M350.42,-622.1C350.42,-614.18 350.42,-605.12 350.42,-596.52"/>
<polygon fill="black" stroke="black" points="353.92,-596.39 350.42,-586.39 346.92,-596.39 353.92,-596.39"/>
</g>
<!-- gate -->
<g id="node4" class="node">
<title>gate</title>
<polygon fill="lightyellow" stroke="black" points="700.77,-503.17 143.45,-503.17 0.08,-409.17 557.4,-409.17 700.77,-503.17"/>
<text text-anchor="middle" x="350.42" y="-466.07" font-family="Arial" font-size="12.00">Gating Network</text>
<text text-anchor="middle" x="350.42" y="-453.07" font-family="Arial" font-size="12.00">Top&#45;K Selection</text>
<text text-anchor="middle" x="350.42" y="-440.07" font-family="Arial" font-size="12.00">[batch_size=batch_size, seq_len=seq_len, num_experts=16]</text>
</g>
<!-- mha&#45;&gt;gate -->
<g id="edge3" class="edge">
<title>mha&#45;&gt;gate</title>
<path fill="none" stroke="black" d="M350.42,-538.99C350.42,-531.4 350.42,-522.57 350.42,-513.58"/>
<polygon fill="black" stroke="black" points="353.92,-513.41 350.42,-503.41 346.92,-513.41 353.92,-513.41"/>
</g>
<!-- route -->
<g id="node5" class="node">
<title>route</title>
<ellipse fill="lightblue" stroke="black" cx="350.42" cy="-349.12" rx="118.59" ry="24.08"/>
<text text-anchor="middle" x="350.42" y="-352.52" font-family="Arial" font-size="12.00">Token Routing</text>
<text text-anchor="middle" x="350.42" y="-339.52" font-family="Arial" font-size="12.00">Cross&#45;Node Communication</text>
</g>
<!-- gate&#45;&gt;route -->
<g id="edge4" class="edge">
<title>gate&#45;&gt;route</title>
<path fill="none" stroke="black" d="M350.42,-409.09C350.42,-400.51 350.42,-391.69 350.42,-383.57"/>
<polygon fill="black" stroke="black" points="353.92,-383.39 350.42,-373.39 346.92,-383.39 353.92,-383.39"/>
</g>
<!-- expert_0 -->
<g id="node6" class="node">
<title>expert_0</title>
<polygon fill="lightgreen" stroke="black" points="633.42,-286.08 505.42,-286.08 505.42,-239.08 633.42,-239.08 633.42,-286.08"/>
<text text-anchor="middle" x="569.42" y="-272.48" font-family="Arial" font-size="12.00">Expert 0</text>
<text text-anchor="middle" x="569.42" y="-259.48" font-family="Arial" font-size="12.00">GPU 0</text>
<text text-anchor="middle" x="569.42" y="-246.48" font-family="Arial" font-size="12.00">One Expert Per GPU</text>
</g>
<!-- route&#45;&gt;expert_0 -->
<g id="edge5" class="edge">
<title>route&#45;&gt;expert_0</title>
<path fill="none" stroke="black" d="M444.2,-334.33C461.97,-330.01 480.1,-324.39 496.42,-317.08 510.4,-310.82 524.33,-301.57 536.2,-292.51"/>
<polygon fill="black" stroke="black" points="538.39,-295.25 544.08,-286.31 534.05,-289.75 538.39,-295.25"/>
</g>
<!-- expert_1 -->
<g id="node7" class="node">
<title>expert_1</title>
<polygon fill="lightgreen" stroke="black" points="487.42,-286.08 359.42,-286.08 359.42,-239.08 487.42,-239.08 487.42,-286.08"/>
<text text-anchor="middle" x="423.42" y="-272.48" font-family="Arial" font-size="12.00">Expert 1</text>
<text text-anchor="middle" x="423.42" y="-259.48" font-family="Arial" font-size="12.00">GPU 1</text>
<text text-anchor="middle" x="423.42" y="-246.48" font-family="Arial" font-size="12.00">One Expert Per GPU</text>
</g>
<!-- route&#45;&gt;expert_1 -->
<g id="edge6" class="edge">
<title>route&#45;&gt;expert_1</title>
<path fill="none" stroke="black" d="M370.37,-325.02C378.65,-315.44 388.36,-304.19 397.2,-293.95"/>
<polygon fill="black" stroke="black" points="399.87,-296.22 403.75,-286.36 394.57,-291.65 399.87,-296.22"/>
</g>
<!-- expert_2 -->
<g id="node8" class="node">
<title>expert_2</title>
<polygon fill="lightgreen" stroke="black" points="341.42,-286.08 213.42,-286.08 213.42,-239.08 341.42,-239.08 341.42,-286.08"/>
<text text-anchor="middle" x="277.42" y="-272.48" font-family="Arial" font-size="12.00">Expert 2</text>
<text text-anchor="middle" x="277.42" y="-259.48" font-family="Arial" font-size="12.00">GPU 2</text>
<text text-anchor="middle" x="277.42" y="-246.48" font-family="Arial" font-size="12.00">One Expert Per GPU</text>
</g>
<!-- route&#45;&gt;expert_2 -->
<g id="edge7" class="edge">
<title>route&#45;&gt;expert_2</title>
<path fill="none" stroke="black" d="M330.47,-325.02C322.2,-315.44 312.48,-304.19 303.64,-293.95"/>
<polygon fill="black" stroke="black" points="306.28,-291.65 297.09,-286.36 300.98,-296.22 306.28,-291.65"/>
</g>
<!-- expert_3 -->
<g id="node9" class="node">
<title>expert_3</title>
<polygon fill="lightgreen" stroke="black" points="195.42,-286.08 67.42,-286.08 67.42,-239.08 195.42,-239.08 195.42,-286.08"/>
<text text-anchor="middle" x="131.42" y="-272.48" font-family="Arial" font-size="12.00">Expert 3</text>
<text text-anchor="middle" x="131.42" y="-259.48" font-family="Arial" font-size="12.00">GPU 3</text>
<text text-anchor="middle" x="131.42" y="-246.48" font-family="Arial" font-size="12.00">One Expert Per GPU</text>
</g>
<!-- route&#45;&gt;expert_3 -->
<g id="edge8" class="edge">
<title>route&#45;&gt;expert_3</title>
<path fill="none" stroke="black" d="M256.65,-334.33C238.87,-330.01 220.74,-324.39 204.42,-317.08 190.44,-310.82 176.52,-301.57 164.64,-292.51"/>
<polygon fill="black" stroke="black" points="166.79,-289.75 156.77,-286.31 162.46,-295.25 166.79,-289.75"/>
</g>
<!-- aggregate -->
<g id="node10" class="node">
<title>aggregate</title>
<ellipse fill="lightblue" stroke="black" cx="350.42" cy="-179.04" rx="118.59" ry="24.08"/>
<text text-anchor="middle" x="350.42" y="-182.44" font-family="Arial" font-size="12.00">Expert Aggregation</text>
<text text-anchor="middle" x="350.42" y="-169.44" font-family="Arial" font-size="12.00">Cross&#45;Node Communication</text>
</g>
<!-- expert_0&#45;&gt;aggregate -->
<g id="edge9" class="edge">
<title>expert_0&#45;&gt;aggregate</title>
<path fill="none" stroke="black" d="M516.54,-239.06C509.8,-236.31 502.96,-233.59 496.42,-231.08 471.52,-221.54 443.97,-211.72 419.57,-203.27"/>
<polygon fill="black" stroke="black" points="420.62,-199.93 410.03,-199.98 418.34,-206.55 420.62,-199.93"/>
</g>
<!-- expert_1&#45;&gt;aggregate -->
<g id="edge10" class="edge">
<title>expert_1&#45;&gt;aggregate</title>
<path fill="none" stroke="black" d="M403.09,-238.87C395.24,-230.11 386.15,-219.95 377.75,-210.57"/>
<polygon fill="black" stroke="black" points="380.18,-208.03 370.9,-202.92 374.96,-212.7 380.18,-208.03"/>
</g>
<!-- expert_2&#45;&gt;aggregate -->
<g id="edge11" class="edge">
<title>expert_2&#45;&gt;aggregate</title>
<path fill="none" stroke="black" d="M297.76,-238.87C305.6,-230.11 314.69,-219.95 323.09,-210.57"/>
<polygon fill="black" stroke="black" points="325.88,-212.7 329.94,-202.92 320.67,-208.03 325.88,-212.7"/>
</g>
<!-- expert_3&#45;&gt;aggregate -->
<g id="edge12" class="edge">
<title>expert_3&#45;&gt;aggregate</title>
<path fill="none" stroke="black" d="M184.3,-239.06C191.05,-236.31 197.88,-233.59 204.42,-231.08 229.32,-221.54 256.88,-211.72 281.28,-203.27"/>
<polygon fill="black" stroke="black" points="282.5,-206.55 290.82,-199.98 280.22,-199.93 282.5,-206.55"/>
</g>
<!-- ffn -->
<g id="node11" class="node">
<title>ffn</title>
<polygon fill="lightgreen" stroke="black" points="519.42,-119 181.42,-119 181.42,-72 519.42,-72 519.42,-119"/>
<text text-anchor="middle" x="350.42" y="-105.4" font-family="Arial" font-size="12.00">FFN Layer</text>
<text text-anchor="middle" x="350.42" y="-92.4" font-family="Arial" font-size="12.00">Replicated</text>
<text text-anchor="middle" x="350.42" y="-79.4" font-family="Arial" font-size="12.00">[batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- aggregate&#45;&gt;ffn -->
<g id="edge13" class="edge">
<title>aggregate&#45;&gt;ffn</title>
<path fill="none" stroke="black" d="M350.42,-154.89C350.42,-146.93 350.42,-137.85 350.42,-129.26"/>
<polygon fill="black" stroke="black" points="353.92,-129.14 350.42,-119.14 346.92,-129.14 353.92,-129.14"/>
</g>
<!-- output -->
<g id="node12" class="node">
<title>output</title>
<polygon fill="lightgreen" stroke="black" points="519.42,-36 181.42,-36 181.42,0 519.42,0 519.42,-36"/>
<text text-anchor="middle" x="350.42" y="-21.4" font-family="Arial" font-size="12.00">Output</text>
<text text-anchor="middle" x="350.42" y="-8.4" font-family="Arial" font-size="12.00">[batch_size=batch_size, seq_len=seq_len, token_dim=7168]</text>
</g>
<!-- ffn&#45;&gt;output -->
<g id="edge14" class="edge">
<title>ffn&#45;&gt;output</title>
<path fill="none" stroke="black" d="M350.42,-71.85C350.42,-63.78 350.42,-54.62 350.42,-46.22"/>
<polygon fill="black" stroke="black" points="353.92,-46.11 350.42,-36.11 346.92,-46.11 353.92,-46.11"/>
</g>
</g>
</svg>
