<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: ring_attention_sequence_parallel Pages: 1 -->
<svg width="1607pt" height="1789pt"
 viewBox="0.00 0.00 1607.00 1789.21" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1785.21)">
<title>ring_attention_sequence_parallel</title>
<polygon fill="#f8f9fa" stroke="transparent" points="-4,4 -4,-1785.21 1603,-1785.21 1603,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_sequence_split</title>
<path fill="#f8f9fa" stroke="black" stroke-dasharray="5,2" d="M219,-1504.25C219,-1504.25 1497,-1504.25 1497,-1504.25 1503,-1504.25 1509,-1510.25 1509,-1516.25 1509,-1516.25 1509,-1667.25 1509,-1667.25 1509,-1673.25 1503,-1679.25 1497,-1679.25 1497,-1679.25 219,-1679.25 219,-1679.25 213,-1679.25 207,-1673.25 207,-1667.25 207,-1667.25 207,-1516.25 207,-1516.25 207,-1510.25 213,-1504.25 219,-1504.25"/>
<text text-anchor="middle" x="858" y="-1664.05" font-family="Times,serif" font-size="14.00">Sequence Parallel Split (16 GPUs)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_device0_layer0</title>
<path fill="#f8f9fa" stroke="black" stroke-dasharray="5,2" d="M342,-394.95C342,-394.95 1286,-394.95 1286,-394.95 1292,-394.95 1298,-400.95 1298,-406.95 1298,-406.95 1298,-1473.25 1298,-1473.25 1298,-1479.25 1292,-1485.25 1286,-1485.25 1286,-1485.25 342,-1485.25 342,-1485.25 336,-1485.25 330,-1479.25 330,-1473.25 330,-1473.25 330,-406.95 330,-406.95 330,-400.95 336,-394.95 342,-394.95"/>
<text text-anchor="middle" x="814" y="-1470.05" font-family="Times,serif" font-size="14.00">Layer 0 &#45; Device 0 (Ring Position 0)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_ring_communication</title>
<path fill="#f8f9fa" stroke="black" stroke-dasharray="5,2" d="M1318,-1007.08C1318,-1007.08 1518,-1007.08 1518,-1007.08 1524,-1007.08 1530,-1013.08 1530,-1019.08 1530,-1019.08 1530,-1347.25 1530,-1347.25 1530,-1353.25 1524,-1359.25 1518,-1359.25 1518,-1359.25 1318,-1359.25 1318,-1359.25 1312,-1359.25 1306,-1353.25 1306,-1347.25 1306,-1347.25 1306,-1019.08 1306,-1019.08 1306,-1013.08 1312,-1007.08 1318,-1007.08"/>
<text text-anchor="middle" x="1418" y="-1344.05" font-family="Times,serif" font-size="14.00">Ring Communication Pattern</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_other_devices</title>
<path fill="#f8f9fa" stroke="black" stroke-dasharray="5,2" d="M20,-1007.45C20,-1007.45 310,-1007.45 310,-1007.45 316,-1007.45 322,-1013.45 322,-1019.45 322,-1019.45 322,-1087.45 322,-1087.45 322,-1093.45 316,-1099.45 310,-1099.45 310,-1099.45 20,-1099.45 20,-1099.45 14,-1099.45 8,-1093.45 8,-1087.45 8,-1087.45 8,-1019.45 8,-1019.45 8,-1013.45 14,-1007.45 20,-1007.45"/>
<text text-anchor="middle" x="165" y="-1084.25" font-family="Times,serif" font-size="14.00">Other Devices (1&#45;15)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_all_layers</title>
<path fill="#f8f9fa" stroke="black" stroke-dasharray="5,2" d="M1064,-283.95C1064,-283.95 1320,-283.95 1320,-283.95 1326,-283.95 1332,-289.95 1332,-295.95 1332,-295.95 1332,-363.95 1332,-363.95 1332,-369.95 1326,-375.95 1320,-375.95 1320,-375.95 1064,-375.95 1064,-375.95 1058,-375.95 1052,-369.95 1052,-363.95 1052,-363.95 1052,-295.95 1052,-295.95 1052,-289.95 1058,-283.95 1064,-283.95"/>
<text text-anchor="middle" x="1192" y="-360.75" font-family="Times,serif" font-size="14.00">All 16 Layers</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_output</title>
<path fill="#f8f9fa" stroke="black" stroke-dasharray="5,2" d="M1018,-8C1018,-8 1366,-8 1366,-8 1372,-8 1378,-14 1378,-20 1378,-20 1378,-252.95 1378,-252.95 1378,-258.95 1372,-264.95 1366,-264.95 1366,-264.95 1018,-264.95 1018,-264.95 1012,-264.95 1006,-258.95 1006,-252.95 1006,-252.95 1006,-20 1006,-20 1006,-14 1012,-8 1018,-8"/>
<text text-anchor="middle" x="1192" y="-249.75" font-family="Times,serif" font-size="14.00">Output Aggregation</text>
</g>
<!-- Input -->
<g id="node1" class="node">
<title>Input</title>
<ellipse fill="#e3f2fd" stroke="black" cx="1297" cy="-1743.73" rx="139.1" ry="37.45"/>
<text text-anchor="middle" x="1297" y="-1755.03" font-family="Helvetica,sans-Serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="1297" y="-1740.03" font-family="Helvetica,sans-Serif" font-size="14.00">Sequence</text>
<text text-anchor="middle" x="1297" y="-1725.03" font-family="Helvetica,sans-Serif" font-size="14.00">B=128, L=100K, D=4096</text>
</g>
<!-- Split0 -->
<g id="node2" class="node">
<title>Split0</title>
<path fill="#ffecb3" stroke="black" d="M1489.48,-1633.25C1489.48,-1633.25 1188.2,-1633.25 1188.2,-1633.25 1182.2,-1633.25 1172.48,-1628.54 1168.76,-1623.83 1168.76,-1623.83 1099.95,-1536.67 1099.95,-1536.67 1096.24,-1531.96 1098.52,-1527.25 1104.52,-1527.25 1104.52,-1527.25 1405.8,-1527.25 1405.8,-1527.25 1411.8,-1527.25 1421.52,-1531.96 1425.24,-1536.67 1425.24,-1536.67 1494.05,-1623.83 1494.05,-1623.83 1497.76,-1628.54 1495.48,-1633.25 1489.48,-1633.25"/>
<text text-anchor="middle" x="1297" y="-1591.55" font-family="Helvetica,sans-Serif" font-size="14.00">Split</text>
<text text-anchor="middle" x="1297" y="-1576.55" font-family="Helvetica,sans-Serif" font-size="14.00">Device 0: [0:6250]</text>
<text text-anchor="middle" x="1297" y="-1561.55" font-family="Helvetica,sans-Serif" font-size="14.00">B=128, L=6250, D=4096</text>
</g>
<!-- Input&#45;&gt;Split0 -->
<g id="edge3" class="edge">
<title>Input&#45;&gt;Split0</title>
<path fill="none" stroke="black" d="M1297,-1706.09C1297,-1687.62 1297,-1664.7 1297,-1643.57"/>
<polygon fill="black" stroke="black" points="1300.5,-1643.36 1297,-1633.36 1293.5,-1643.36 1300.5,-1643.36"/>
</g>
<!-- D0_L0_QKV_proj -->
<g id="node5" class="node">
<title>D0_L0_QKV_proj</title>
<path fill="#c8e6c9" stroke="black" d="M1259,-1454.25C1259,-1454.25 1081,-1454.25 1081,-1454.25 1075,-1454.25 1069,-1448.25 1069,-1442.25 1069,-1442.25 1069,-1398.25 1069,-1398.25 1069,-1392.25 1075,-1386.25 1081,-1386.25 1081,-1386.25 1259,-1386.25 1259,-1386.25 1265,-1386.25 1271,-1392.25 1271,-1398.25 1271,-1398.25 1271,-1442.25 1271,-1442.25 1271,-1448.25 1265,-1454.25 1259,-1454.25"/>
<text text-anchor="middle" x="1170" y="-1439.05" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1170" y="-1424.05" font-family="Helvetica,sans-Serif" font-size="14.00">Input: [128, 6250, 4096]</text>
<text text-anchor="middle" x="1170" y="-1409.05" font-family="Helvetica,sans-Serif" font-size="14.00">Output: [128, 6250, 4096]</text>
<text text-anchor="middle" x="1170" y="-1394.05" font-family="Helvetica,sans-Serif" font-size="14.00">Weights: [512, 4096]</text>
</g>
<!-- Split0&#45;&gt;D0_L0_QKV_proj -->
<g id="edge4" class="edge">
<title>Split0&#45;&gt;D0_L0_QKV_proj</title>
<path fill="none" stroke="black" d="M1255.06,-1527.08C1238.17,-1506.07 1218.97,-1482.18 1203.09,-1462.42"/>
<polygon fill="black" stroke="black" points="1205.72,-1460.11 1196.73,-1454.51 1200.27,-1464.5 1205.72,-1460.11"/>
</g>
<!-- D0_L0_residual1 -->
<g id="node15" class="node">
<title>D0_L0_residual1</title>
<path fill="#ffccbc" stroke="black" d="M1174.3,-856.53C1174.3,-856.53 1120.7,-829.38 1120.7,-829.38 1115.35,-826.67 1115.35,-821.24 1120.7,-818.53 1120.7,-818.53 1174.3,-791.38 1174.3,-791.38 1179.65,-788.67 1190.35,-788.67 1195.7,-791.38 1195.7,-791.38 1249.3,-818.53 1249.3,-818.53 1254.65,-821.24 1254.65,-826.67 1249.3,-829.38 1249.3,-829.38 1195.7,-856.53 1195.7,-856.53 1190.35,-859.24 1179.65,-859.24 1174.3,-856.53"/>
<text text-anchor="middle" x="1185" y="-827.75" font-family="Helvetica,sans-Serif" font-size="14.00">Add</text>
<text text-anchor="middle" x="1185" y="-812.75" font-family="Helvetica,sans-Serif" font-size="14.00">Residual</text>
</g>
<!-- Split0&#45;&gt;D0_L0_residual1 -->
<g id="edge25" class="edge">
<title>Split0&#45;&gt;D0_L0_residual1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1434.46,-1547.95C1496.45,-1524.89 1556,-1485.91 1556,-1421.25 1556,-1421.25 1556,-1421.25 1556,-924.45 1556,-863.81 1368.73,-839.11 1260.29,-829.89"/>
<polygon fill="black" stroke="black" points="1260.3,-826.38 1250.05,-829.05 1259.73,-833.36 1260.3,-826.38"/>
<text text-anchor="middle" x="1577.5" y="-1176.93" font-family="Helvetica,sans-Serif" font-size="10.00">Residual</text>
</g>
<!-- Split1 -->
<g id="node3" class="node">
<title>Split1</title>
<path fill="#ffecb3" stroke="black" d="M1063.48,-1633.25C1063.48,-1633.25 762.2,-1633.25 762.2,-1633.25 756.2,-1633.25 746.48,-1628.54 742.76,-1623.83 742.76,-1623.83 673.95,-1536.67 673.95,-1536.67 670.24,-1531.96 672.52,-1527.25 678.52,-1527.25 678.52,-1527.25 979.8,-1527.25 979.8,-1527.25 985.8,-1527.25 995.52,-1531.96 999.24,-1536.67 999.24,-1536.67 1068.05,-1623.83 1068.05,-1623.83 1071.76,-1628.54 1069.48,-1633.25 1063.48,-1633.25"/>
<text text-anchor="middle" x="871" y="-1591.55" font-family="Helvetica,sans-Serif" font-size="14.00">Split</text>
<text text-anchor="middle" x="871" y="-1576.55" font-family="Helvetica,sans-Serif" font-size="14.00">Device 1: [6250:12500]</text>
<text text-anchor="middle" x="871" y="-1561.55" font-family="Helvetica,sans-Serif" font-size="14.00">B=128, L=6250, D=4096</text>
</g>
<!-- Split15 -->
<g id="node4" class="node">
<title>Split15</title>
<path fill="#ffecb3" stroke="black" d="M636.86,-1648.25C636.86,-1648.25 315.88,-1648.25 315.88,-1648.25 309.88,-1648.25 300.6,-1643.23 297.32,-1638.2 297.32,-1638.2 221.69,-1522.3 221.69,-1522.3 218.42,-1517.28 221.14,-1512.25 227.14,-1512.25 227.14,-1512.25 548.12,-1512.25 548.12,-1512.25 554.12,-1512.25 563.4,-1517.28 566.68,-1522.3 566.68,-1522.3 642.31,-1638.2 642.31,-1638.2 645.58,-1643.23 642.86,-1648.25 636.86,-1648.25"/>
<text text-anchor="middle" x="432" y="-1599.05" font-family="Helvetica,sans-Serif" font-size="14.00">Split</text>
<text text-anchor="middle" x="432" y="-1584.05" font-family="Helvetica,sans-Serif" font-size="14.00">...</text>
<text text-anchor="middle" x="432" y="-1569.05" font-family="Helvetica,sans-Serif" font-size="14.00">Device 15: [93750:100000]</text>
<text text-anchor="middle" x="432" y="-1554.05" font-family="Helvetica,sans-Serif" font-size="14.00">B=128, L=6250, D=4096</text>
</g>
<!-- D0_L0_KV_buffer -->
<g id="node6" class="node">
<title>D0_L0_KV_buffer</title>
<path fill="#fff9c4" stroke="black" d="M1249,-1327.88C1249,-1327.88 1091,-1327.88 1091,-1327.88 1085,-1327.88 1079,-1321.88 1079,-1315.88 1079,-1315.88 1079,-1286.88 1079,-1286.88 1079,-1280.88 1085,-1274.88 1091,-1274.88 1091,-1274.88 1249,-1274.88 1249,-1274.88 1255,-1274.88 1261,-1280.88 1261,-1286.88 1261,-1286.88 1261,-1315.88 1261,-1315.88 1261,-1321.88 1255,-1327.88 1249,-1327.88"/>
<text text-anchor="middle" x="1170" y="-1312.68" font-family="Helvetica,sans-Serif" font-size="14.00">KV Buffer</text>
<text text-anchor="middle" x="1170" y="-1297.68" font-family="Helvetica,sans-Serif" font-size="14.00">Size: [128, 6250, 4096]</text>
<text text-anchor="middle" x="1170" y="-1282.68" font-family="Helvetica,sans-Serif" font-size="14.00">Local K,V</text>
</g>
<!-- D0_L0_QKV_proj&#45;&gt;D0_L0_KV_buffer -->
<g id="edge5" class="edge">
<title>D0_L0_QKV_proj&#45;&gt;D0_L0_KV_buffer</title>
<path fill="none" stroke="black" d="M1170,-1386.08C1170,-1371.16 1170,-1353.53 1170,-1338.3"/>
<polygon fill="black" stroke="black" points="1173.5,-1338.21 1170,-1328.21 1166.5,-1338.21 1173.5,-1338.21"/>
</g>
<!-- D0_L0_Q -->
<g id="node7" class="node">
<title>D0_L0_Q</title>
<path fill="#fff9c4" stroke="black" d="M942,-1327.88C942,-1327.88 784,-1327.88 784,-1327.88 778,-1327.88 772,-1321.88 772,-1315.88 772,-1315.88 772,-1286.88 772,-1286.88 772,-1280.88 778,-1274.88 784,-1274.88 784,-1274.88 942,-1274.88 942,-1274.88 948,-1274.88 954,-1280.88 954,-1286.88 954,-1286.88 954,-1315.88 954,-1315.88 954,-1321.88 948,-1327.88 942,-1327.88"/>
<text text-anchor="middle" x="863" y="-1312.68" font-family="Helvetica,sans-Serif" font-size="14.00">Q Tensor</text>
<text text-anchor="middle" x="863" y="-1297.68" font-family="Helvetica,sans-Serif" font-size="14.00">Size: [128, 6250, 4096]</text>
<text text-anchor="middle" x="863" y="-1282.68" font-family="Helvetica,sans-Serif" font-size="14.00">Local Q</text>
</g>
<!-- D0_L0_QKV_proj&#45;&gt;D0_L0_Q -->
<g id="edge6" class="edge">
<title>D0_L0_QKV_proj&#45;&gt;D0_L0_Q</title>
<path fill="none" stroke="black" d="M1083.26,-1386.23C1037.99,-1369 983.12,-1348.11 939.46,-1331.49"/>
<polygon fill="black" stroke="black" points="940.63,-1328.19 930.04,-1327.9 938.14,-1334.73 940.63,-1328.19"/>
</g>
<!-- D0_L0_send_next -->
<g id="node9" class="node">
<title>D0_L0_send_next</title>
<ellipse fill="#ff8a65" stroke="black" cx="1170" cy="-1179.43" rx="120.42" ry="37.45"/>
<text text-anchor="middle" x="1170" y="-1190.73" font-family="Helvetica,sans-Serif" font-size="14.00">Send</text>
<text text-anchor="middle" x="1170" y="-1175.73" font-family="Helvetica,sans-Serif" font-size="14.00">To Device 1</text>
<text text-anchor="middle" x="1170" y="-1160.73" font-family="Helvetica,sans-Serif" font-size="14.00">KV: [128, 6250, 4096]</text>
</g>
<!-- D0_L0_KV_buffer&#45;&gt;D0_L0_send_next -->
<g id="edge10" class="edge">
<title>D0_L0_KV_buffer&#45;&gt;D0_L0_send_next</title>
<path fill="none" stroke="black" d="M1170,-1274.65C1170,-1260.87 1170,-1243.47 1170,-1227.38"/>
<polygon fill="black" stroke="black" points="1173.5,-1227.04 1170,-1217.04 1166.5,-1227.04 1173.5,-1227.04"/>
</g>
<!-- D0_L0_attention_stage0 -->
<g id="node10" class="node">
<title>D0_L0_attention_stage0</title>
<path fill="#c8e6c9" stroke="black" d="M1020,-1213.43C1020,-1213.43 706,-1213.43 706,-1213.43 700,-1213.43 694,-1207.43 694,-1201.43 694,-1201.43 694,-1157.43 694,-1157.43 694,-1151.43 700,-1145.43 706,-1145.43 706,-1145.43 1020,-1145.43 1020,-1145.43 1026,-1145.43 1032,-1151.43 1032,-1157.43 1032,-1157.43 1032,-1201.43 1032,-1201.43 1032,-1207.43 1026,-1213.43 1020,-1213.43"/>
<text text-anchor="middle" x="863" y="-1198.23" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Stage 0</text>
<text text-anchor="middle" x="863" y="-1183.23" font-family="Helvetica,sans-Serif" font-size="14.00">Q×Local KV</text>
<text text-anchor="middle" x="863" y="-1168.23" font-family="Helvetica,sans-Serif" font-size="14.00">Input: Q[128,6250,4096], KV[128,6250,4096]</text>
<text text-anchor="middle" x="863" y="-1153.23" font-family="Helvetica,sans-Serif" font-size="14.00">Output: [128,6250,4096]</text>
</g>
<!-- D0_L0_KV_buffer&#45;&gt;D0_L0_attention_stage0 -->
<g id="edge7" class="edge">
<title>D0_L0_KV_buffer&#45;&gt;D0_L0_attention_stage0</title>
<path fill="none" stroke="black" d="M1104.52,-1274.8C1061.59,-1258.03 1004.8,-1235.84 957.07,-1217.19"/>
<polygon fill="black" stroke="black" points="958.24,-1213.89 947.65,-1213.51 955.69,-1220.41 958.24,-1213.89"/>
</g>
<!-- Ring0 -->
<g id="node20" class="node">
<title>Ring0</title>
<ellipse fill="#f8bbd0" stroke="black" cx="1397" cy="-1301.38" rx="82.96" ry="26.74"/>
<text text-anchor="middle" x="1397" y="-1305.18" font-family="Helvetica,sans-Serif" font-size="14.00">Ring Step 0</text>
<text text-anchor="middle" x="1397" y="-1290.18" font-family="Helvetica,sans-Serif" font-size="14.00">Local compute</text>
</g>
<!-- D0_L0_KV_buffer&#45;&gt;Ring0 -->
<g id="edge27" class="edge">
<title>D0_L0_KV_buffer&#45;&gt;Ring0</title>
<path fill="none" stroke="black" d="M1261.33,-1301.38C1275.48,-1301.38 1289.62,-1301.38 1303.76,-1301.38"/>
<polygon fill="black" stroke="black" points="1304.06,-1304.88 1314.06,-1301.38 1304.06,-1297.88 1304.06,-1304.88"/>
</g>
<!-- D0_L0_Q&#45;&gt;D0_L0_attention_stage0 -->
<g id="edge8" class="edge">
<title>D0_L0_Q&#45;&gt;D0_L0_attention_stage0</title>
<path fill="none" stroke="black" d="M863,-1274.65C863,-1259.94 863,-1241.1 863,-1224.14"/>
<polygon fill="black" stroke="black" points="866.5,-1223.87 863,-1213.87 859.5,-1223.87 866.5,-1223.87"/>
</g>
<!-- D0_L0_attention_stage15 -->
<g id="node12" class="node">
<title>D0_L0_attention_stage15</title>
<path fill="#c8e6c9" stroke="black" d="M664,-1213.43C664,-1213.43 350,-1213.43 350,-1213.43 344,-1213.43 338,-1207.43 338,-1201.43 338,-1201.43 338,-1157.43 338,-1157.43 338,-1151.43 344,-1145.43 350,-1145.43 350,-1145.43 664,-1145.43 664,-1145.43 670,-1145.43 676,-1151.43 676,-1157.43 676,-1157.43 676,-1201.43 676,-1201.43 676,-1207.43 670,-1213.43 664,-1213.43"/>
<text text-anchor="middle" x="507" y="-1198.23" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Stage 15</text>
<text text-anchor="middle" x="507" y="-1183.23" font-family="Helvetica,sans-Serif" font-size="14.00">Q×Device 1 KV</text>
<text text-anchor="middle" x="507" y="-1168.23" font-family="Helvetica,sans-Serif" font-size="14.00">Input: Q[128,6250,4096], KV[128,6250,4096]</text>
<text text-anchor="middle" x="507" y="-1153.23" font-family="Helvetica,sans-Serif" font-size="14.00">Output: [128,6250,4096]</text>
</g>
<!-- D0_L0_Q&#45;&gt;D0_L0_attention_stage15 -->
<g id="edge12" class="edge">
<title>D0_L0_Q&#45;&gt;D0_L0_attention_stage15</title>
<path fill="none" stroke="black" d="M787.07,-1274.8C736.88,-1257.89 670.33,-1235.46 614.71,-1216.72"/>
<polygon fill="black" stroke="black" points="615.76,-1213.38 605.17,-1213.51 613.52,-1220.02 615.76,-1213.38"/>
</g>
<!-- D0_L0_recv_prev -->
<g id="node8" class="node">
<title>D0_L0_recv_prev</title>
<ellipse fill="#ff8a65" stroke="black" cx="507" cy="-1301.38" rx="120.42" ry="37.45"/>
<text text-anchor="middle" x="507" y="-1312.68" font-family="Helvetica,sans-Serif" font-size="14.00">Receive</text>
<text text-anchor="middle" x="507" y="-1297.68" font-family="Helvetica,sans-Serif" font-size="14.00">From Device 15</text>
<text text-anchor="middle" x="507" y="-1282.68" font-family="Helvetica,sans-Serif" font-size="14.00">KV: [128, 6250, 4096]</text>
</g>
<!-- D0_L0_recv_prev&#45;&gt;D0_L0_attention_stage15 -->
<g id="edge11" class="edge">
<title>D0_L0_recv_prev&#45;&gt;D0_L0_attention_stage15</title>
<path fill="none" stroke="black" d="M507,-1263.74C507,-1251.13 507,-1236.88 507,-1223.79"/>
<polygon fill="black" stroke="black" points="510.5,-1223.58 507,-1213.58 503.5,-1223.58 510.5,-1223.58"/>
</g>
<!-- Ring15 -->
<g id="node22" class="node">
<title>Ring15</title>
<ellipse fill="#f8bbd0" stroke="black" cx="1404" cy="-1041.95" rx="79.81" ry="26.74"/>
<text text-anchor="middle" x="1404" y="-1045.75" font-family="Helvetica,sans-Serif" font-size="14.00">Ring Step 15</text>
<text text-anchor="middle" x="1404" y="-1030.75" font-family="Helvetica,sans-Serif" font-size="14.00">Final compute</text>
</g>
<!-- D0_L0_recv_prev&#45;&gt;Ring15 -->
<g id="edge29" class="edge">
<title>D0_L0_recv_prev&#45;&gt;Ring15</title>
<path fill="none" stroke="black" d="M613.64,-1283.87C659.53,-1277.11 713.83,-1269.56 763,-1263.91 881.79,-1250.25 1199.95,-1283.88 1299,-1216.91 1329.94,-1195.99 1318.05,-1174.14 1337,-1141.95 1350.15,-1119.62 1366.41,-1095.52 1379.62,-1076.69"/>
<polygon fill="black" stroke="black" points="1382.54,-1078.62 1385.45,-1068.43 1376.83,-1074.58 1382.54,-1078.62"/>
</g>
<!-- Device1 -->
<g id="node23" class="node">
<title>Device1</title>
<polygon fill="#f5f5f5" stroke="black" points="308,-1068.45 174,-1068.45 174,-1015.45 314,-1015.45 314,-1062.45 308,-1068.45"/>
<polyline fill="none" stroke="black" points="308,-1068.45 308,-1062.45 "/>
<polyline fill="none" stroke="black" points="314,-1062.45 308,-1062.45 "/>
<text text-anchor="middle" x="244" y="-1053.25" font-family="Helvetica,sans-Serif" font-size="14.00">Device 1</text>
<text text-anchor="middle" x="244" y="-1038.25" font-family="Helvetica,sans-Serif" font-size="14.00">Same as Device 0</text>
<text text-anchor="middle" x="244" y="-1023.25" font-family="Helvetica,sans-Serif" font-size="14.00">Ring Position 1</text>
</g>
<!-- D0_L0_send_next&#45;&gt;Device1 -->
<g id="edge21" class="edge">
<title>D0_L0_send_next&#45;&gt;Device1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1087.33,-1152.21C1072.06,-1148.18 1056.15,-1144.51 1041,-1141.95 884.06,-1115.42 476.51,-1151.23 326,-1099.45 310.18,-1094.01 294.59,-1084.6 281.34,-1075.01"/>
<polygon fill="black" stroke="black" points="283.07,-1071.94 272.98,-1068.72 278.86,-1077.53 283.07,-1071.94"/>
<text text-anchor="middle" x="479" y="-1115.95" font-family="Helvetica,sans-Serif" font-size="10.00">KV</text>
</g>
<!-- D0_L0_accumulate -->
<g id="node13" class="node">
<title>D0_L0_accumulate</title>
<path fill="#ffccbc" stroke="black" d="M851.54,-1091.38C851.54,-1091.38 704.46,-1045.52 704.46,-1045.52 698.73,-1043.74 698.73,-1040.17 704.46,-1038.38 704.46,-1038.38 851.54,-992.52 851.54,-992.52 857.27,-990.74 868.73,-990.74 874.46,-992.52 874.46,-992.52 1021.54,-1038.38 1021.54,-1038.38 1027.27,-1040.17 1027.27,-1043.74 1021.54,-1045.52 1021.54,-1045.52 874.46,-1091.38 874.46,-1091.38 868.73,-1093.17 857.27,-1093.17 851.54,-1091.38"/>
<text text-anchor="middle" x="863" y="-1053.25" font-family="Helvetica,sans-Serif" font-size="14.00">Accumulate</text>
<text text-anchor="middle" x="863" y="-1038.25" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Outputs</text>
<text text-anchor="middle" x="863" y="-1023.25" font-family="Helvetica,sans-Serif" font-size="14.00">Sum 16 partial results</text>
</g>
<!-- D0_L0_attention_stage0&#45;&gt;D0_L0_accumulate -->
<g id="edge9" class="edge">
<title>D0_L0_attention_stage0&#45;&gt;D0_L0_accumulate</title>
<path fill="none" stroke="black" d="M863,-1145.29C863,-1133.12 863,-1118.92 863,-1105.04"/>
<polygon fill="black" stroke="black" points="866.5,-1105.02 863,-1095.02 859.5,-1105.02 866.5,-1105.02"/>
</g>
<!-- D0_L0_attention_stage1 -->
<g id="node11" class="node">
<title>D0_L0_attention_stage1</title>
<path fill="#c8e6c9" stroke="black" d="M852,-1454.25C852,-1454.25 538,-1454.25 538,-1454.25 532,-1454.25 526,-1448.25 526,-1442.25 526,-1442.25 526,-1398.25 526,-1398.25 526,-1392.25 532,-1386.25 538,-1386.25 538,-1386.25 852,-1386.25 852,-1386.25 858,-1386.25 864,-1392.25 864,-1398.25 864,-1398.25 864,-1442.25 864,-1442.25 864,-1448.25 858,-1454.25 852,-1454.25"/>
<text text-anchor="middle" x="695" y="-1439.05" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Stage 1</text>
<text text-anchor="middle" x="695" y="-1424.05" font-family="Helvetica,sans-Serif" font-size="14.00">Q×Recv KV</text>
<text text-anchor="middle" x="695" y="-1409.05" font-family="Helvetica,sans-Serif" font-size="14.00">Input: Q[128,6250,4096], KV[128,6250,4096]</text>
<text text-anchor="middle" x="695" y="-1394.05" font-family="Helvetica,sans-Serif" font-size="14.00">Output: [128,6250,4096]</text>
</g>
<!-- D0_L0_attention_stage15&#45;&gt;D0_L0_accumulate -->
<g id="edge13" class="edge">
<title>D0_L0_attention_stage15&#45;&gt;D0_L0_accumulate</title>
<path fill="none" stroke="black" d="M594.09,-1145.29C650.13,-1123.96 722.61,-1096.38 778.19,-1075.23"/>
<polygon fill="black" stroke="black" points="779.56,-1078.45 787.66,-1071.62 777.07,-1071.91 779.56,-1078.45"/>
</g>
<!-- D0_L0_output_proj -->
<g id="node14" class="node">
<title>D0_L0_output_proj</title>
<path fill="#c8e6c9" stroke="black" d="M1160,-951.95C1160,-951.95 982,-951.95 982,-951.95 976,-951.95 970,-945.95 970,-939.95 970,-939.95 970,-910.95 970,-910.95 970,-904.95 976,-898.95 982,-898.95 982,-898.95 1160,-898.95 1160,-898.95 1166,-898.95 1172,-904.95 1172,-910.95 1172,-910.95 1172,-939.95 1172,-939.95 1172,-945.95 1166,-951.95 1160,-951.95"/>
<text text-anchor="middle" x="1071" y="-936.75" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1071" y="-921.75" font-family="Helvetica,sans-Serif" font-size="14.00">Input: [128, 6250, 4096]</text>
<text text-anchor="middle" x="1071" y="-906.75" font-family="Helvetica,sans-Serif" font-size="14.00">Output: [128, 6250, 4096]</text>
</g>
<!-- D0_L0_accumulate&#45;&gt;D0_L0_output_proj -->
<g id="edge14" class="edge">
<title>D0_L0_accumulate&#45;&gt;D0_L0_output_proj</title>
<path fill="none" stroke="black" d="M923.44,-1007.68C952.56,-991.65 987.23,-972.57 1015.65,-956.92"/>
<polygon fill="black" stroke="black" points="1017.57,-959.86 1024.64,-951.97 1014.19,-953.73 1017.57,-959.86"/>
</g>
<!-- D0_L0_output_proj&#45;&gt;D0_L0_residual1 -->
<g id="edge15" class="edge">
<title>D0_L0_output_proj&#45;&gt;D0_L0_residual1</title>
<path fill="none" stroke="black" d="M1100.36,-898.83C1115.67,-885.47 1134.48,-869.05 1150.48,-855.08"/>
<polygon fill="black" stroke="black" points="1152.85,-857.66 1158.09,-848.44 1148.25,-852.38 1152.85,-857.66"/>
</g>
<!-- D0_L0_MLP_gate -->
<g id="node16" class="node">
<title>D0_L0_MLP_gate</title>
<path fill="#c8e6c9" stroke="black" d="M1180.5,-748.95C1180.5,-748.95 993.5,-748.95 993.5,-748.95 987.5,-748.95 981.5,-742.95 981.5,-736.95 981.5,-736.95 981.5,-707.95 981.5,-707.95 981.5,-701.95 987.5,-695.95 993.5,-695.95 993.5,-695.95 1180.5,-695.95 1180.5,-695.95 1186.5,-695.95 1192.5,-701.95 1192.5,-707.95 1192.5,-707.95 1192.5,-736.95 1192.5,-736.95 1192.5,-742.95 1186.5,-748.95 1180.5,-748.95"/>
<text text-anchor="middle" x="1087" y="-733.75" font-family="Helvetica,sans-Serif" font-size="14.00">MLP Gate</text>
<text text-anchor="middle" x="1087" y="-718.75" font-family="Helvetica,sans-Serif" font-size="14.00">Input: [128, 6250, 4096]</text>
<text text-anchor="middle" x="1087" y="-703.75" font-family="Helvetica,sans-Serif" font-size="14.00">Output: [128, 6250, 16384]</text>
</g>
<!-- D0_L0_residual1&#45;&gt;D0_L0_MLP_gate -->
<g id="edge16" class="edge">
<title>D0_L0_residual1&#45;&gt;D0_L0_MLP_gate</title>
<path fill="none" stroke="black" d="M1160.52,-798.1C1148.09,-785.47 1132.81,-769.96 1119.41,-756.36"/>
<polygon fill="black" stroke="black" points="1121.7,-753.7 1112.19,-749.03 1116.71,-758.61 1121.7,-753.7"/>
</g>
<!-- D0_L0_residual2 -->
<g id="node19" class="node">
<title>D0_L0_residual2</title>
<path fill="#ffccbc" stroke="black" d="M1181.3,-473.53C1181.3,-473.53 1127.7,-446.38 1127.7,-446.38 1122.35,-443.67 1122.35,-438.24 1127.7,-435.53 1127.7,-435.53 1181.3,-408.38 1181.3,-408.38 1186.65,-405.67 1197.35,-405.67 1202.7,-408.38 1202.7,-408.38 1256.3,-435.53 1256.3,-435.53 1261.65,-438.24 1261.65,-443.67 1256.3,-446.38 1256.3,-446.38 1202.7,-473.53 1202.7,-473.53 1197.35,-476.24 1186.65,-476.24 1181.3,-473.53"/>
<text text-anchor="middle" x="1192" y="-444.75" font-family="Helvetica,sans-Serif" font-size="14.00">Add</text>
<text text-anchor="middle" x="1192" y="-429.75" font-family="Helvetica,sans-Serif" font-size="14.00">Residual</text>
</g>
<!-- D0_L0_residual1&#45;&gt;D0_L0_residual2 -->
<g id="edge26" class="edge">
<title>D0_L0_residual1&#45;&gt;D0_L0_residual2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1201.07,-793.85C1210.27,-774.49 1220,-748.17 1220,-723.45 1220,-723.45 1220,-723.45 1220,-541.45 1220,-521.47 1214.7,-500.04 1208.71,-482.2"/>
<polygon fill="black" stroke="black" points="1211.98,-480.96 1205.34,-472.7 1205.39,-483.29 1211.98,-480.96"/>
<text text-anchor="middle" x="1241.5" y="-629.95" font-family="Helvetica,sans-Serif" font-size="10.00">Residual</text>
</g>
<!-- D0_L0_MLP_up -->
<g id="node17" class="node">
<title>D0_L0_MLP_up</title>
<path fill="#c8e6c9" stroke="black" d="M1171.5,-658.95C1171.5,-658.95 984.5,-658.95 984.5,-658.95 978.5,-658.95 972.5,-652.95 972.5,-646.95 972.5,-646.95 972.5,-617.95 972.5,-617.95 972.5,-611.95 978.5,-605.95 984.5,-605.95 984.5,-605.95 1171.5,-605.95 1171.5,-605.95 1177.5,-605.95 1183.5,-611.95 1183.5,-617.95 1183.5,-617.95 1183.5,-646.95 1183.5,-646.95 1183.5,-652.95 1177.5,-658.95 1171.5,-658.95"/>
<text text-anchor="middle" x="1078" y="-643.75" font-family="Helvetica,sans-Serif" font-size="14.00">MLP Up</text>
<text text-anchor="middle" x="1078" y="-628.75" font-family="Helvetica,sans-Serif" font-size="14.00">Input: [128, 6250, 4096]</text>
<text text-anchor="middle" x="1078" y="-613.75" font-family="Helvetica,sans-Serif" font-size="14.00">Output: [128, 6250, 16384]</text>
</g>
<!-- D0_L0_MLP_gate&#45;&gt;D0_L0_MLP_up -->
<g id="edge17" class="edge">
<title>D0_L0_MLP_gate&#45;&gt;D0_L0_MLP_up</title>
<path fill="none" stroke="black" d="M1084.35,-695.53C1083.51,-687.29 1082.56,-678.03 1081.66,-669.23"/>
<polygon fill="black" stroke="black" points="1085.13,-668.79 1080.63,-659.19 1078.17,-669.5 1085.13,-668.79"/>
</g>
<!-- D0_L0_MLP_down -->
<g id="node18" class="node">
<title>D0_L0_MLP_down</title>
<path fill="#c8e6c9" stroke="black" d="M1183,-568.95C1183,-568.95 1005,-568.95 1005,-568.95 999,-568.95 993,-562.95 993,-556.95 993,-556.95 993,-527.95 993,-527.95 993,-521.95 999,-515.95 1005,-515.95 1005,-515.95 1183,-515.95 1183,-515.95 1189,-515.95 1195,-521.95 1195,-527.95 1195,-527.95 1195,-556.95 1195,-556.95 1195,-562.95 1189,-568.95 1183,-568.95"/>
<text text-anchor="middle" x="1094" y="-553.75" font-family="Helvetica,sans-Serif" font-size="14.00">MLP Down</text>
<text text-anchor="middle" x="1094" y="-538.75" font-family="Helvetica,sans-Serif" font-size="14.00">Input: [128, 6250, 16384]</text>
<text text-anchor="middle" x="1094" y="-523.75" font-family="Helvetica,sans-Serif" font-size="14.00">Output: [128, 6250, 4096]</text>
</g>
<!-- D0_L0_MLP_up&#45;&gt;D0_L0_MLP_down -->
<g id="edge18" class="edge">
<title>D0_L0_MLP_up&#45;&gt;D0_L0_MLP_down</title>
<path fill="none" stroke="black" d="M1082.71,-605.53C1084.21,-597.29 1085.89,-588.03 1087.5,-579.23"/>
<polygon fill="black" stroke="black" points="1090.97,-579.66 1089.32,-569.19 1084.09,-578.41 1090.97,-579.66"/>
</g>
<!-- D0_L0_MLP_down&#45;&gt;D0_L0_residual2 -->
<g id="edge19" class="edge">
<title>D0_L0_MLP_down&#45;&gt;D0_L0_residual2</title>
<path fill="none" stroke="black" d="M1119.24,-515.83C1131.77,-503.1 1147.05,-487.59 1160.36,-474.08"/>
<polygon fill="black" stroke="black" points="1163,-476.38 1167.53,-466.8 1158.01,-471.47 1163,-476.38"/>
</g>
<!-- NoteLayers -->
<g id="node25" class="node">
<title>NoteLayers</title>
<polygon fill="#f5f5f5" stroke="black" points="1317.5,-344.95 1060.5,-344.95 1060.5,-291.95 1323.5,-291.95 1323.5,-338.95 1317.5,-344.95"/>
<polyline fill="none" stroke="black" points="1317.5,-344.95 1317.5,-338.95 "/>
<polyline fill="none" stroke="black" points="1323.5,-338.95 1317.5,-338.95 "/>
<text text-anchor="middle" x="1192" y="-329.75" font-family="Helvetica,sans-Serif" font-size="14.00">Layers 1&#45;15</text>
<text text-anchor="middle" x="1192" y="-314.75" font-family="Helvetica,sans-Serif" font-size="14.00">(Same structure as Layer 0)</text>
<text text-anchor="middle" x="1192" y="-299.75" font-family="Helvetica,sans-Serif" font-size="14.00">Each device processes all 16 layers</text>
</g>
<!-- D0_L0_residual2&#45;&gt;NoteLayers -->
<g id="edge20" class="edge">
<title>D0_L0_residual2&#45;&gt;NoteLayers</title>
<path fill="none" stroke="black" d="M1192,-402.82C1192,-387.79 1192,-370.51 1192,-355.59"/>
<polygon fill="black" stroke="black" points="1195.5,-355.21 1192,-345.21 1188.5,-355.21 1195.5,-355.21"/>
</g>
<!-- Ring0&#45;&gt;D0_L0_send_next -->
<g id="edge28" class="edge">
<title>Ring0&#45;&gt;D0_L0_send_next</title>
<path fill="none" stroke="black" d="M1354.84,-1278.1C1322.31,-1260.92 1276.65,-1236.78 1238.84,-1216.81"/>
<polygon fill="black" stroke="black" points="1240.39,-1213.67 1229.91,-1212.09 1237.12,-1219.86 1240.39,-1213.67"/>
</g>
<!-- Ring1 -->
<g id="node21" class="node">
<title>Ring1</title>
<ellipse fill="#f8bbd0" stroke="black" cx="1415" cy="-1179.43" rx="69.09" ry="26.74"/>
<text text-anchor="middle" x="1415" y="-1183.23" font-family="Helvetica,sans-Serif" font-size="14.00">Ring Step 1</text>
<text text-anchor="middle" x="1415" y="-1168.23" font-family="Helvetica,sans-Serif" font-size="14.00">Send/Recv</text>
</g>
<!-- Ring0&#45;&gt;Ring1 -->
<g id="edge1" class="edge">
<title>Ring0&#45;&gt;Ring1</title>
<path fill="none" stroke="black" d="M1400.91,-1274.36C1403.45,-1257.38 1406.81,-1234.99 1409.61,-1216.33"/>
<polygon fill="black" stroke="black" points="1413.08,-1216.82 1411.1,-1206.41 1406.16,-1215.78 1413.08,-1216.82"/>
<text text-anchor="middle" x="1433.5" y="-1237.91" font-family="Helvetica,sans-Serif" font-size="10.00">KV transfer</text>
</g>
<!-- Ring1&#45;&gt;Ring15 -->
<g id="edge2" class="edge">
<title>Ring1&#45;&gt;Ring15</title>
<path fill="none" stroke="black" d="M1412.88,-1152.31C1411.19,-1131.51 1408.81,-1102.15 1406.93,-1079.09"/>
<polygon fill="black" stroke="black" points="1410.41,-1078.68 1406.11,-1068.99 1403.44,-1079.24 1410.41,-1078.68"/>
<text text-anchor="middle" x="1415" y="-1115.95" font-family="Helvetica,sans-Serif" font-size="10.00">...</text>
</g>
<!-- Device15 -->
<g id="node24" class="node">
<title>Device15</title>
<polygon fill="#f5f5f5" stroke="black" points="150,-1068.45 16,-1068.45 16,-1015.45 156,-1015.45 156,-1062.45 150,-1068.45"/>
<polyline fill="none" stroke="black" points="150,-1068.45 150,-1062.45 "/>
<polyline fill="none" stroke="black" points="156,-1062.45 150,-1062.45 "/>
<text text-anchor="middle" x="86" y="-1053.25" font-family="Helvetica,sans-Serif" font-size="14.00">Device 15</text>
<text text-anchor="middle" x="86" y="-1038.25" font-family="Helvetica,sans-Serif" font-size="14.00">Same as Device 0</text>
<text text-anchor="middle" x="86" y="-1023.25" font-family="Helvetica,sans-Serif" font-size="14.00">Ring Position 15</text>
</g>
<!-- Device15&#45;&gt;D0_L0_recv_prev -->
<g id="edge22" class="edge">
<title>Device15&#45;&gt;D0_L0_recv_prev</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M115.11,-1068.74C157.11,-1105.06 238.1,-1171.86 315,-1216.91 348.54,-1236.55 387.57,-1254.35 421.64,-1268.42"/>
<polygon fill="black" stroke="black" points="420.53,-1271.75 431.11,-1272.29 423.18,-1265.27 420.53,-1271.75"/>
<text text-anchor="middle" x="322" y="-1176.93" font-family="Helvetica,sans-Serif" font-size="10.00">KV</text>
</g>
<!-- MergeAll -->
<g id="node26" class="node">
<title>MergeAll</title>
<path fill="#ffecb3" stroke="black" d="M1358.14,-233.95C1358.14,-233.95 1098.76,-233.95 1098.76,-233.95 1092.76,-233.95 1083.36,-229.01 1079.96,-224.07 1079.96,-224.07 1020.66,-137.84 1020.66,-137.84 1017.26,-132.9 1019.86,-127.95 1025.86,-127.95 1025.86,-127.95 1285.24,-127.95 1285.24,-127.95 1291.24,-127.95 1300.64,-132.9 1304.04,-137.84 1304.04,-137.84 1363.34,-224.07 1363.34,-224.07 1366.74,-229.01 1364.14,-233.95 1358.14,-233.95"/>
<text text-anchor="middle" x="1192" y="-192.25" font-family="Helvetica,sans-Serif" font-size="14.00">Merge</text>
<text text-anchor="middle" x="1192" y="-177.25" font-family="Helvetica,sans-Serif" font-size="14.00">16 Device Outputs</text>
<text text-anchor="middle" x="1192" y="-162.25" font-family="Helvetica,sans-Serif" font-size="14.00">Sequence: [0:100000]</text>
</g>
<!-- NoteLayers&#45;&gt;MergeAll -->
<g id="edge23" class="edge">
<title>NoteLayers&#45;&gt;MergeAll</title>
<path fill="none" stroke="black" d="M1192,-291.65C1192,-278.17 1192,-261.03 1192,-244.34"/>
<polygon fill="black" stroke="black" points="1195.5,-244.04 1192,-234.04 1188.5,-244.04 1195.5,-244.04"/>
</g>
<!-- Output -->
<g id="node27" class="node">
<title>Output</title>
<ellipse fill="#e3f2fd" stroke="black" cx="1192" cy="-53.48" rx="139.1" ry="37.45"/>
<text text-anchor="middle" x="1192" y="-64.78" font-family="Helvetica,sans-Serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="1192" y="-49.78" font-family="Helvetica,sans-Serif" font-size="14.00">Sequence</text>
<text text-anchor="middle" x="1192" y="-34.78" font-family="Helvetica,sans-Serif" font-size="14.00">B=128, L=100K, D=4096</text>
</g>
<!-- MergeAll&#45;&gt;Output -->
<g id="edge24" class="edge">
<title>MergeAll&#45;&gt;Output</title>
<path fill="none" stroke="black" d="M1192,-127.83C1192,-118.93 1192,-109.73 1192,-100.98"/>
<polygon fill="black" stroke="black" points="1195.5,-100.96 1192,-90.96 1188.5,-100.96 1195.5,-100.96"/>
</g>
</g>
</svg>
