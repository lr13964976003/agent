<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="687pt" height="1686pt"
 viewBox="0.00 0.00 686.76 1685.95" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1681.95)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1681.95 682.76,-1681.95 682.76,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<path fill="lightgray" stroke="black" d="M335.5,-1677.95C335.5,-1677.95 75.5,-1677.95 75.5,-1677.95 69.5,-1677.95 63.5,-1671.95 63.5,-1665.95 63.5,-1665.95 63.5,-1651.95 63.5,-1651.95 63.5,-1645.95 69.5,-1639.95 75.5,-1639.95 75.5,-1639.95 335.5,-1639.95 335.5,-1639.95 341.5,-1639.95 347.5,-1645.95 347.5,-1651.95 347.5,-1651.95 347.5,-1665.95 347.5,-1665.95 347.5,-1671.95 341.5,-1677.95 335.5,-1677.95"/>
<text text-anchor="middle" x="205.5" y="-1662.75" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="205.5" y="-1647.75" font-family="Times,serif" font-size="14.00">[batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- stage0_embed -->
<g id="node2" class="node">
<title>stage0_embed</title>
<polygon fill="lightyellow" stroke="black" points="328,-1567.95 83,-1567.95 83,-1529.95 328,-1529.95 328,-1567.95"/>
<text text-anchor="middle" x="205.5" y="-1552.75" font-family="Times,serif" font-size="14.00">Embedding + Pos Enc (GPU0&#45;3)</text>
<text text-anchor="middle" x="205.5" y="-1537.75" font-family="Times,serif" font-size="14.00">TP4 All&#45;Reduce</text>
</g>
<!-- input&#45;&gt;stage0_embed -->
<g id="edge7" class="edge">
<title>input&#45;&gt;stage0_embed</title>
<path fill="none" stroke="black" d="M205.5,-1639.79C205.5,-1639.79 205.5,-1578.26 205.5,-1578.26"/>
<polygon fill="black" stroke="black" points="209,-1578.26 205.5,-1568.26 202,-1578.26 209,-1578.26"/>
</g>
<!-- stage0_layer10 -->
<g id="node3" class="node">
<title>stage0_layer10</title>
<polygon fill="lightyellow" stroke="black" points="306,-1457.95 105,-1457.95 105,-1404.95 306,-1404.95 306,-1457.95"/>
<text text-anchor="middle" x="205.5" y="-1442.75" font-family="Times,serif" font-size="14.00">Layer 10 (GPU0&#45;3)</text>
<text text-anchor="middle" x="205.5" y="-1427.75" font-family="Times,serif" font-size="14.00">RMSNorm + MHA + FFN</text>
<text text-anchor="middle" x="205.5" y="-1412.75" font-family="Times,serif" font-size="14.00">TP4 All&#45;Reduce</text>
</g>
<!-- stage0_embed&#45;&gt;stage0_layer10 -->
<g id="edge8" class="edge">
<title>stage0_embed&#45;&gt;stage0_layer10</title>
<path fill="none" stroke="black" d="M205.5,-1529.81C205.5,-1529.81 205.5,-1468.04 205.5,-1468.04"/>
<polygon fill="black" stroke="black" points="209,-1468.04 205.5,-1458.04 202,-1468.04 209,-1468.04"/>
</g>
<!-- stage0_layer20 -->
<g id="node4" class="node">
<title>stage0_layer20</title>
<polygon fill="lightyellow" stroke="black" points="306,-1332.95 105,-1332.95 105,-1279.95 306,-1279.95 306,-1332.95"/>
<text text-anchor="middle" x="205.5" y="-1317.75" font-family="Times,serif" font-size="14.00">Layer 20 (GPU0&#45;3)</text>
<text text-anchor="middle" x="205.5" y="-1302.75" font-family="Times,serif" font-size="14.00">RMSNorm + MHA + FFN</text>
<text text-anchor="middle" x="205.5" y="-1287.75" font-family="Times,serif" font-size="14.00">TP4 All&#45;Reduce</text>
</g>
<!-- stage0_layer10&#45;&gt;stage0_layer20 -->
<g id="edge1" class="edge">
<title>stage0_layer10&#45;&gt;stage0_layer20</title>
<path fill="none" stroke="black" d="M205.5,-1404.94C205.5,-1404.94 205.5,-1343.36 205.5,-1343.36"/>
<polygon fill="black" stroke="black" points="209,-1343.36 205.5,-1333.36 202,-1343.36 209,-1343.36"/>
</g>
<!-- stage0_layer30 -->
<g id="node5" class="node">
<title>stage0_layer30</title>
<polygon fill="lightyellow" stroke="black" points="306,-1207.95 105,-1207.95 105,-1154.95 306,-1154.95 306,-1207.95"/>
<text text-anchor="middle" x="205.5" y="-1192.75" font-family="Times,serif" font-size="14.00">Layer 30 (GPU0&#45;3)</text>
<text text-anchor="middle" x="205.5" y="-1177.75" font-family="Times,serif" font-size="14.00">RMSNorm + MHA + FFN</text>
<text text-anchor="middle" x="205.5" y="-1162.75" font-family="Times,serif" font-size="14.00">TP4 All&#45;Reduce</text>
</g>
<!-- stage0_layer20&#45;&gt;stage0_layer30 -->
<g id="edge2" class="edge">
<title>stage0_layer20&#45;&gt;stage0_layer30</title>
<path fill="none" stroke="black" d="M205.5,-1279.94C205.5,-1279.94 205.5,-1218.36 205.5,-1218.36"/>
<polygon fill="black" stroke="black" points="209,-1218.36 205.5,-1208.36 202,-1218.36 209,-1218.36"/>
</g>
<!-- stage0_layer40 -->
<g id="node6" class="node">
<title>stage0_layer40</title>
<polygon fill="lightyellow" stroke="black" points="201,-1082.95 0,-1082.95 0,-1029.95 201,-1029.95 201,-1082.95"/>
<text text-anchor="middle" x="100.5" y="-1067.75" font-family="Times,serif" font-size="14.00">Layer 40 (GPU0&#45;3)</text>
<text text-anchor="middle" x="100.5" y="-1052.75" font-family="Times,serif" font-size="14.00">RMSNorm + MHA + FFN</text>
<text text-anchor="middle" x="100.5" y="-1037.75" font-family="Times,serif" font-size="14.00">TP4 All&#45;Reduce</text>
</g>
<!-- stage0_layer30&#45;&gt;stage0_layer40 -->
<g id="edge3" class="edge">
<title>stage0_layer30&#45;&gt;stage0_layer40</title>
<path fill="none" stroke="black" d="M153,-1154.94C153,-1154.94 153,-1093.36 153,-1093.36"/>
<polygon fill="black" stroke="black" points="156.5,-1093.36 153,-1083.36 149.5,-1093.36 156.5,-1093.36"/>
</g>
<!-- stage0_final -->
<g id="node7" class="node">
<title>stage0_final</title>
<polygon fill="lightyellow" stroke="black" points="386,-1075.45 237,-1075.45 237,-1037.45 386,-1037.45 386,-1075.45"/>
<text text-anchor="middle" x="311.5" y="-1060.25" font-family="Times,serif" font-size="14.00">Layer 39 (GPU0&#45;3)</text>
<text text-anchor="middle" x="311.5" y="-1045.25" font-family="Times,serif" font-size="14.00">Final RMSNorm</text>
</g>
<!-- stage0_layer30&#45;&gt;stage0_final -->
<g id="edge9" class="edge">
<title>stage0_layer30&#45;&gt;stage0_final</title>
<path fill="none" stroke="black" d="M271.5,-1154.94C271.5,-1154.94 271.5,-1085.59 271.5,-1085.59"/>
<polygon fill="black" stroke="black" points="275,-1085.59 271.5,-1075.59 268,-1085.59 275,-1085.59"/>
</g>
<!-- pp_comm -->
<g id="node8" class="node">
<title>pp_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="311.5" cy="-920.48" rx="135.11" ry="37.45"/>
<text text-anchor="middle" x="311.5" y="-931.78" font-family="Times,serif" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="311.5" y="-916.78" font-family="Times,serif" font-size="14.00">Stage 0 → Stage 1</text>
<text text-anchor="middle" x="311.5" y="-901.78" font-family="Times,serif" font-size="14.00">GPU0&#45;3 → GPU4&#45;7</text>
</g>
<!-- stage0_final&#45;&gt;pp_comm -->
<g id="edge10" class="edge">
<title>stage0_final&#45;&gt;pp_comm</title>
<path fill="none" stroke="black" d="M311.5,-1037.26C311.5,-1037.26 311.5,-968.05 311.5,-968.05"/>
<polygon fill="black" stroke="black" points="315,-968.05 311.5,-958.05 308,-968.05 315,-968.05"/>
</g>
<!-- stage1_first -->
<g id="node9" class="node">
<title>stage1_first</title>
<polygon fill="lightpink" stroke="black" points="401,-811 222,-811 222,-758 401,-758 401,-811"/>
<text text-anchor="middle" x="311.5" y="-795.8" font-family="Times,serif" font-size="14.00">Layer 40 (GPU4&#45;7)</text>
<text text-anchor="middle" x="311.5" y="-780.8" font-family="Times,serif" font-size="14.00">First Layer Processing</text>
<text text-anchor="middle" x="311.5" y="-765.8" font-family="Times,serif" font-size="14.00">TP4 All&#45;Reduce</text>
</g>
<!-- pp_comm&#45;&gt;stage1_first -->
<g id="edge11" class="edge">
<title>pp_comm&#45;&gt;stage1_first</title>
<path fill="none" stroke="black" d="M311.5,-882.96C311.5,-882.96 311.5,-821.12 311.5,-821.12"/>
<polygon fill="black" stroke="black" points="315,-821.12 311.5,-811.12 308,-821.12 315,-821.12"/>
</g>
<!-- stage1_layer50 -->
<g id="node10" class="node">
<title>stage1_layer50</title>
<polygon fill="lightpink" stroke="black" points="412,-686 211,-686 211,-633 412,-633 412,-686"/>
<text text-anchor="middle" x="311.5" y="-670.8" font-family="Times,serif" font-size="14.00">Layer 50 (GPU4&#45;7)</text>
<text text-anchor="middle" x="311.5" y="-655.8" font-family="Times,serif" font-size="14.00">RMSNorm + MHA + FFN</text>
<text text-anchor="middle" x="311.5" y="-640.8" font-family="Times,serif" font-size="14.00">TP4 All&#45;Reduce</text>
</g>
<!-- stage1_first&#45;&gt;stage1_layer50 -->
<g id="edge12" class="edge">
<title>stage1_first&#45;&gt;stage1_layer50</title>
<path fill="none" stroke="black" d="M311.5,-757.99C311.5,-757.99 311.5,-696.4 311.5,-696.4"/>
<polygon fill="black" stroke="black" points="315,-696.4 311.5,-686.4 308,-696.4 315,-696.4"/>
</g>
<!-- stage1_layer60 -->
<g id="node11" class="node">
<title>stage1_layer60</title>
<polygon fill="lightpink" stroke="black" points="412,-561 211,-561 211,-508 412,-508 412,-561"/>
<text text-anchor="middle" x="311.5" y="-545.8" font-family="Times,serif" font-size="14.00">Layer 60 (GPU4&#45;7)</text>
<text text-anchor="middle" x="311.5" y="-530.8" font-family="Times,serif" font-size="14.00">RMSNorm + MHA + FFN</text>
<text text-anchor="middle" x="311.5" y="-515.8" font-family="Times,serif" font-size="14.00">TP4 All&#45;Reduce</text>
</g>
<!-- stage1_layer50&#45;&gt;stage1_layer60 -->
<g id="edge4" class="edge">
<title>stage1_layer50&#45;&gt;stage1_layer60</title>
<path fill="none" stroke="black" d="M311.5,-632.99C311.5,-632.99 311.5,-571.4 311.5,-571.4"/>
<polygon fill="black" stroke="black" points="315,-571.4 311.5,-561.4 308,-571.4 315,-571.4"/>
</g>
<!-- stage1_layer70 -->
<g id="node12" class="node">
<title>stage1_layer70</title>
<polygon fill="lightpink" stroke="black" points="412,-436 211,-436 211,-383 412,-383 412,-436"/>
<text text-anchor="middle" x="311.5" y="-420.8" font-family="Times,serif" font-size="14.00">Layer 70 (GPU4&#45;7)</text>
<text text-anchor="middle" x="311.5" y="-405.8" font-family="Times,serif" font-size="14.00">RMSNorm + MHA + FFN</text>
<text text-anchor="middle" x="311.5" y="-390.8" font-family="Times,serif" font-size="14.00">TP4 All&#45;Reduce</text>
</g>
<!-- stage1_layer60&#45;&gt;stage1_layer70 -->
<g id="edge5" class="edge">
<title>stage1_layer60&#45;&gt;stage1_layer70</title>
<path fill="none" stroke="black" d="M311.5,-507.99C311.5,-507.99 311.5,-446.4 311.5,-446.4"/>
<polygon fill="black" stroke="black" points="315,-446.4 311.5,-436.4 308,-446.4 315,-446.4"/>
</g>
<!-- stage1_layer80 -->
<g id="node13" class="node">
<title>stage1_layer80</title>
<polygon fill="lightpink" stroke="black" points="307,-311 106,-311 106,-258 307,-258 307,-311"/>
<text text-anchor="middle" x="206.5" y="-295.8" font-family="Times,serif" font-size="14.00">Layer 80 (GPU4&#45;7)</text>
<text text-anchor="middle" x="206.5" y="-280.8" font-family="Times,serif" font-size="14.00">RMSNorm + MHA + FFN</text>
<text text-anchor="middle" x="206.5" y="-265.8" font-family="Times,serif" font-size="14.00">TP4 All&#45;Reduce</text>
</g>
<!-- stage1_layer70&#45;&gt;stage1_layer80 -->
<g id="edge6" class="edge">
<title>stage1_layer70&#45;&gt;stage1_layer80</title>
<path fill="none" stroke="black" d="M259,-382.99C259,-382.99 259,-321.4 259,-321.4"/>
<polygon fill="black" stroke="black" points="262.5,-321.4 259,-311.4 255.5,-321.4 262.5,-321.4"/>
</g>
<!-- stage1_final -->
<g id="node14" class="node">
<title>stage1_final</title>
<polygon fill="lightpink" stroke="black" points="492,-303.5 343,-303.5 343,-265.5 492,-265.5 492,-303.5"/>
<text text-anchor="middle" x="417.5" y="-288.3" font-family="Times,serif" font-size="14.00">Layer 79 (GPU4&#45;7)</text>
<text text-anchor="middle" x="417.5" y="-273.3" font-family="Times,serif" font-size="14.00">Final RMSNorm</text>
</g>
<!-- stage1_layer70&#45;&gt;stage1_final -->
<g id="edge13" class="edge">
<title>stage1_layer70&#45;&gt;stage1_final</title>
<path fill="none" stroke="black" d="M377.5,-382.99C377.5,-382.99 377.5,-313.64 377.5,-313.64"/>
<polygon fill="black" stroke="black" points="381,-313.64 377.5,-303.64 374,-313.64 381,-313.64"/>
</g>
<!-- lm_head -->
<g id="node15" class="node">
<title>lm_head</title>
<polygon fill="lightyellow" stroke="black" points="678.52,-186 263.29,-186 156.48,-110 571.71,-110 678.52,-186"/>
<text text-anchor="middle" x="417.5" y="-151.8" font-family="Times,serif" font-size="14.00">LM Head (GPU4&#45;7)</text>
<text text-anchor="middle" x="417.5" y="-136.8" font-family="Times,serif" font-size="14.00">[hidden=8192 → vocab=128256]</text>
</g>
<!-- stage1_final&#45;&gt;lm_head -->
<g id="edge14" class="edge">
<title>stage1_final&#45;&gt;lm_head</title>
<path fill="none" stroke="black" d="M417.5,-265.23C417.5,-265.23 417.5,-196.28 417.5,-196.28"/>
<polygon fill="black" stroke="black" points="421,-196.28 417.5,-186.28 414,-196.28 421,-196.28"/>
</g>
<!-- output -->
<g id="node16" class="node">
<title>output</title>
<path fill="lightgray" stroke="black" d="M553,-38C553,-38 282,-38 282,-38 276,-38 270,-32 270,-26 270,-26 270,-12 270,-12 270,-6 276,0 282,0 282,0 553,0 553,0 559,0 565,-6 565,-12 565,-12 565,-26 565,-26 565,-32 559,-38 553,-38"/>
<text text-anchor="middle" x="417.5" y="-22.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="417.5" y="-7.8" font-family="Times,serif" font-size="14.00">[batch=32, seq=2048, vocab=128256]</text>
</g>
<!-- lm_head&#45;&gt;output -->
<g id="edge15" class="edge">
<title>lm_head&#45;&gt;output</title>
<path fill="none" stroke="black" d="M417.5,-109.99C417.5,-109.99 417.5,-48.11 417.5,-48.11"/>
<polygon fill="black" stroke="black" points="421,-48.11 417.5,-38.11 414,-48.11 421,-48.11"/>
</g>
</g>
</svg>
