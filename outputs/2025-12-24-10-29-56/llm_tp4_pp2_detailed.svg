<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="13653pt" height="1914pt"
 viewBox="0.00 0.00 13653.00 1913.87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1909.87)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1909.87 13649,-1909.87 13649,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="27,-1805.5 27,-1897.5 451,-1897.5 451,-1805.5 27,-1805.5"/>
<text text-anchor="middle" x="239" y="-1882.3" font-family="Times,serif" font-size="14.00">Input</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_attn_1_s0</title>
<polygon fill="lightgray" stroke="lightgray" points="8,-844.22 8,-1414.46 470,-1414.46 470,-844.22 8,-844.22"/>
<text text-anchor="middle" x="239" y="-1399.26" font-family="Times,serif" font-size="14.00">Layer 1: Multi&#45;Head Attention (TP4)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_ffn_1_s0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="42,-286.74 42,-797.22 436,-797.22 436,-286.74 42,-286.74"/>
<text text-anchor="middle" x="239" y="-782.02" font-family="Times,serif" font-size="14.00">Layer 1: FFN (TP4)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_attn_2_s0</title>
<polygon fill="lightgray" stroke="lightgray" points="2931,-1805.13 2931,-1897.87 4759,-1897.87 4759,-1805.13 2931,-1805.13"/>
<text text-anchor="middle" x="3845" y="-1882.67" font-family="Times,serif" font-size="14.00">Layer 2: Multi&#45;Head Attention (TP4)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_ffn_2_s0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4801,-1805.13 4801,-1897.87 6393,-1897.87 6393,-1805.13 4801,-1805.13"/>
<text text-anchor="middle" x="5597" y="-1882.67" font-family="Times,serif" font-size="14.00">Layer 2: FFN (TP4)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_attn_3_s0</title>
<polygon fill="lightgray" stroke="lightgray" points="6435,-1805.13 6435,-1897.87 8263,-1897.87 8263,-1805.13 6435,-1805.13"/>
<text text-anchor="middle" x="7349" y="-1882.67" font-family="Times,serif" font-size="14.00">Layer 3: Multi&#45;Head Attention (TP4)</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_ffn_3_s0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1297,-1805.13 1297,-1897.87 2889,-1897.87 2889,-1805.13 1297,-1805.13"/>
<text text-anchor="middle" x="2093" y="-1882.67" font-family="Times,serif" font-size="14.00">Layer 3: FFN (TP4)</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_stage0</title>
<polygon fill="lightblue" stroke="lightblue" points="59,-1490.54 59,-1758.13 1625,-1758.13 1625,-1490.54 59,-1490.54"/>
<text text-anchor="middle" x="842" y="-1742.93" font-family="Times,serif" font-size="14.00">PP Stage 0: GPUs 0&#45;3 (TP4)</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_attn_41_s1</title>
<polygon fill="lightgray" stroke="lightgray" points="2867,-565.48 2867,-1075.96 3329,-1075.96 3329,-565.48 2867,-565.48"/>
<text text-anchor="middle" x="3098" y="-1060.76" font-family="Times,serif" font-size="14.00">Layer 41: Multi&#45;Head Attention (TP4)</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_ffn_41_s1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2901,-8 2901,-518.48 3295,-518.48 3295,-8 2901,-8"/>
<text text-anchor="middle" x="3098" y="-503.28" font-family="Times,serif" font-size="14.00">Layer 41: FFN (TP4)</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_attn_42_s1</title>
<polygon fill="lightgray" stroke="lightgray" points="8305,-1805.13 8305,-1897.87 10133,-1897.87 10133,-1805.13 8305,-1805.13"/>
<text text-anchor="middle" x="9219" y="-1882.67" font-family="Times,serif" font-size="14.00">Layer 42: Multi&#45;Head Attention (TP4)</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_ffn_42_s1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="10175,-1805.13 10175,-1897.87 11767,-1897.87 11767,-1805.13 10175,-1805.13"/>
<text text-anchor="middle" x="10971" y="-1882.67" font-family="Times,serif" font-size="14.00">Layer 42: FFN (TP4)</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_attn_43_s1</title>
<polygon fill="lightgray" stroke="lightgray" points="11809,-1805.13 11809,-1897.87 13637,-1897.87 13637,-1805.13 11809,-1805.13"/>
<text text-anchor="middle" x="12723" y="-1882.67" font-family="Times,serif" font-size="14.00">Layer 43: Multi&#45;Head Attention (TP4)</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_ffn_43_s1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2187,-1490.17 2187,-1582.91 3779,-1582.91 3779,-1490.17 2187,-1490.17"/>
<text text-anchor="middle" x="2983" y="-1567.71" font-family="Times,serif" font-size="14.00">Layer 43: FFN (TP4)</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_stage1</title>
<polygon fill="lightpink" stroke="lightpink" points="1712,-1149.46 1712,-1421.96 3278,-1421.96 3278,-1149.46 1712,-1149.46"/>
<text text-anchor="middle" x="2495" y="-1406.76" font-family="Times,serif" font-size="14.00">PP Stage 1: GPUs 4&#45;7 (TP4)</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_output</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="954,-983.96 954,-1267.96 1704,-1267.96 1704,-983.96 954,-983.96"/>
<text text-anchor="middle" x="1329" y="-1252.76" font-family="Times,serif" font-size="14.00">Output</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<path fill="lightgray" stroke="black" d="M430.5,-1866.5C430.5,-1866.5 47.5,-1866.5 47.5,-1866.5 41.5,-1866.5 35.5,-1860.5 35.5,-1854.5 35.5,-1854.5 35.5,-1825.5 35.5,-1825.5 35.5,-1819.5 41.5,-1813.5 47.5,-1813.5 47.5,-1813.5 430.5,-1813.5 430.5,-1813.5 436.5,-1813.5 442.5,-1819.5 442.5,-1825.5 442.5,-1825.5 442.5,-1854.5 442.5,-1854.5 442.5,-1860.5 436.5,-1866.5 430.5,-1866.5"/>
<text text-anchor="middle" x="239" y="-1851.3" font-family="Times,serif" font-size="14.00">Input Layer</text>
<text text-anchor="middle" x="239" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=2048, hidden=8192]</text>
<text text-anchor="middle" x="239" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=2048, hidden=8192]</text>
</g>
<!-- embed_0 -->
<g id="node26" class="node">
<title>embed_0</title>
<polygon fill="lightyellow" stroke="black" points="411,-1719.63 67,-1719.63 67,-1666.63 411,-1666.63 411,-1719.63"/>
<text text-anchor="middle" x="239" y="-1704.43" font-family="Times,serif" font-size="14.00">Embedding + Pos Encoding (GPU0&#45;3)</text>
<text text-anchor="middle" x="239" y="-1689.43" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="239" y="-1674.43" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- input&#45;&gt;embed_0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;embed_0</title>
<path fill="none" stroke="black" d="M239,-1813.4C239,-1813.4 239,-1730.02 239,-1730.02"/>
<polygon fill="black" stroke="black" points="242.5,-1730.02 239,-1720.02 235.5,-1730.02 242.5,-1730.02"/>
</g>
<!-- qkv_proj_1_s0 -->
<g id="node2" class="node">
<title>qkv_proj_1_s0</title>
<polygon fill="lightyellow" stroke="black" points="453,-1383.46 25,-1383.46 25,-1330.46 453,-1330.46 453,-1383.46"/>
<text text-anchor="middle" x="239" y="-1368.26" font-family="Times,serif" font-size="14.00">QKV Projection (GPU0&#45;3)</text>
<text text-anchor="middle" x="239" y="-1353.26" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="239" y="-1338.26" font-family="Times,serif" font-size="14.00">Output: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
</g>
<!-- attn_scores_1_s0 -->
<g id="node3" class="node">
<title>attn_scores_1_s0</title>
<polygon fill="lightyellow" stroke="black" points="462,-1210.46 16,-1210.46 16,-1157.46 462,-1157.46 462,-1210.46"/>
<text text-anchor="middle" x="239" y="-1195.26" font-family="Times,serif" font-size="14.00">Attention Scores (GPU0&#45;3)</text>
<text text-anchor="middle" x="239" y="-1180.26" font-family="Times,serif" font-size="14.00">Input: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
<text text-anchor="middle" x="239" y="-1165.26" font-family="Times,serif" font-size="14.00">Output: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
</g>
<!-- qkv_proj_1_s0&#45;&gt;attn_scores_1_s0 -->
<g id="edge4" class="edge">
<title>qkv_proj_1_s0&#45;&gt;attn_scores_1_s0</title>
<path fill="none" stroke="black" d="M239,-1330.31C239,-1330.31 239,-1220.64 239,-1220.64"/>
<polygon fill="black" stroke="black" points="242.5,-1220.64 239,-1210.64 235.5,-1220.64 242.5,-1220.64"/>
</g>
<!-- attn_out_1_s0 -->
<g id="node4" class="node">
<title>attn_out_1_s0</title>
<polygon fill="lightyellow" stroke="black" points="456,-1044.96 22,-1044.96 22,-991.96 456,-991.96 456,-1044.96"/>
<text text-anchor="middle" x="239" y="-1029.76" font-family="Times,serif" font-size="14.00">Attention Output (GPU0&#45;3)</text>
<text text-anchor="middle" x="239" y="-1014.76" font-family="Times,serif" font-size="14.00">Input: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
<text text-anchor="middle" x="239" y="-999.76" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- attn_scores_1_s0&#45;&gt;attn_out_1_s0 -->
<g id="edge5" class="edge">
<title>attn_scores_1_s0&#45;&gt;attn_out_1_s0</title>
<path fill="none" stroke="black" d="M239,-1157.37C239,-1157.37 239,-1054.98 239,-1054.98"/>
<polygon fill="black" stroke="black" points="242.5,-1054.98 239,-1044.98 235.5,-1054.98 242.5,-1054.98"/>
</g>
<!-- attn_ar_1_s0 -->
<g id="node5" class="node">
<title>attn_ar_1_s0</title>
<ellipse fill="lightgreen" stroke="black" cx="239" cy="-879.09" rx="164.51" ry="26.74"/>
<text text-anchor="middle" x="239" y="-882.89" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce (GPU0&#45;3)</text>
<text text-anchor="middle" x="239" y="-867.89" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- attn_out_1_s0&#45;&gt;attn_ar_1_s0 -->
<g id="edge6" class="edge">
<title>attn_out_1_s0&#45;&gt;attn_ar_1_s0</title>
<path fill="none" stroke="black" d="M239,-991.92C239,-991.92 239,-916.01 239,-916.01"/>
<polygon fill="black" stroke="black" points="242.5,-916.01 239,-906.01 235.5,-916.01 242.5,-916.01"/>
</g>
<!-- ffn_gate_up_1_s0 -->
<g id="node6" class="node">
<title>ffn_gate_up_1_s0</title>
<polygon fill="lightyellow" stroke="black" points="428,-766.22 50,-766.22 50,-713.22 428,-713.22 428,-766.22"/>
<text text-anchor="middle" x="239" y="-751.02" font-family="Times,serif" font-size="14.00">FFN Gate+Up Projection (GPU0&#45;3)</text>
<text text-anchor="middle" x="239" y="-736.02" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="239" y="-721.02" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- attn_ar_1_s0&#45;&gt;ffn_gate_up_1_s0 -->
<g id="edge7" class="edge">
<title>attn_ar_1_s0&#45;&gt;ffn_gate_up_1_s0</title>
<path fill="none" stroke="black" d="M239,-852.22C239,-852.22 239,-776.51 239,-776.51"/>
<polygon fill="black" stroke="black" points="242.5,-776.51 239,-766.51 235.5,-776.51 242.5,-776.51"/>
</g>
<!-- ffn_silu_1_s0 -->
<g id="node7" class="node">
<title>ffn_silu_1_s0</title>
<polygon fill="lightyellow" stroke="black" points="428,-626.85 50,-626.85 50,-573.85 428,-573.85 428,-626.85"/>
<text text-anchor="middle" x="239" y="-611.65" font-family="Times,serif" font-size="14.00">SiLU Activation (GPU0&#45;3)</text>
<text text-anchor="middle" x="239" y="-596.65" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="239" y="-581.65" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- ffn_gate_up_1_s0&#45;&gt;ffn_silu_1_s0 -->
<g id="edge8" class="edge">
<title>ffn_gate_up_1_s0&#45;&gt;ffn_silu_1_s0</title>
<path fill="none" stroke="black" d="M239,-713.18C239,-713.18 239,-637.27 239,-637.27"/>
<polygon fill="black" stroke="black" points="242.5,-637.27 239,-627.27 235.5,-637.27 242.5,-637.27"/>
</g>
<!-- ffn_down_1_s0 -->
<g id="node8" class="node">
<title>ffn_down_1_s0</title>
<polygon fill="lightyellow" stroke="black" points="422,-487.48 56,-487.48 56,-434.48 422,-434.48 422,-487.48"/>
<text text-anchor="middle" x="239" y="-472.28" font-family="Times,serif" font-size="14.00">FFN Down Projection (GPU0&#45;3)</text>
<text text-anchor="middle" x="239" y="-457.28" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="239" y="-442.28" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- ffn_silu_1_s0&#45;&gt;ffn_down_1_s0 -->
<g id="edge9" class="edge">
<title>ffn_silu_1_s0&#45;&gt;ffn_down_1_s0</title>
<path fill="none" stroke="black" d="M239,-573.81C239,-573.81 239,-497.9 239,-497.9"/>
<polygon fill="black" stroke="black" points="242.5,-497.9 239,-487.9 235.5,-497.9 242.5,-497.9"/>
</g>
<!-- ffn_ar_1_s0 -->
<g id="node9" class="node">
<title>ffn_ar_1_s0</title>
<ellipse fill="lightgreen" stroke="black" cx="239" cy="-321.61" rx="140.01" ry="26.74"/>
<text text-anchor="middle" x="239" y="-325.41" font-family="Times,serif" font-size="14.00">FFN All&#45;Reduce (GPU0&#45;3)</text>
<text text-anchor="middle" x="239" y="-310.41" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- ffn_down_1_s0&#45;&gt;ffn_ar_1_s0 -->
<g id="edge10" class="edge">
<title>ffn_down_1_s0&#45;&gt;ffn_ar_1_s0</title>
<path fill="none" stroke="black" d="M239,-434.44C239,-434.44 239,-358.53 239,-358.53"/>
<polygon fill="black" stroke="black" points="242.5,-358.53 239,-348.53 235.5,-358.53 242.5,-358.53"/>
</g>
<!-- qkv_proj_2_s0 -->
<g id="node10" class="node">
<title>qkv_proj_2_s0</title>
<polygon fill="lightyellow" stroke="black" points="4751,-1866.5 4323,-1866.5 4323,-1813.5 4751,-1813.5 4751,-1866.5"/>
<text text-anchor="middle" x="4537" y="-1851.3" font-family="Times,serif" font-size="14.00">QKV Projection (GPU0&#45;3)</text>
<text text-anchor="middle" x="4537" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="4537" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
</g>
<!-- attn_scores_2_s0 -->
<g id="node11" class="node">
<title>attn_scores_2_s0</title>
<polygon fill="lightyellow" stroke="black" points="4265,-1866.5 3819,-1866.5 3819,-1813.5 4265,-1813.5 4265,-1866.5"/>
<text text-anchor="middle" x="4042" y="-1851.3" font-family="Times,serif" font-size="14.00">Attention Scores (GPU0&#45;3)</text>
<text text-anchor="middle" x="4042" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
<text text-anchor="middle" x="4042" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
</g>
<!-- attn_out_2_s0 -->
<g id="node12" class="node">
<title>attn_out_2_s0</title>
<polygon fill="lightyellow" stroke="black" points="3761,-1866.5 3327,-1866.5 3327,-1813.5 3761,-1813.5 3761,-1866.5"/>
<text text-anchor="middle" x="3544" y="-1851.3" font-family="Times,serif" font-size="14.00">Attention Output (GPU0&#45;3)</text>
<text text-anchor="middle" x="3544" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
<text text-anchor="middle" x="3544" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- attn_ar_2_s0 -->
<g id="node13" class="node">
<title>attn_ar_2_s0</title>
<ellipse fill="lightgreen" stroke="black" cx="3104" cy="-1840" rx="164.51" ry="26.74"/>
<text text-anchor="middle" x="3104" y="-1843.8" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce (GPU0&#45;3)</text>
<text text-anchor="middle" x="3104" y="-1828.8" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- ffn_gate_up_2_s0 -->
<g id="node14" class="node">
<title>ffn_gate_up_2_s0</title>
<polygon fill="lightyellow" stroke="black" points="6385,-1866.5 6007,-1866.5 6007,-1813.5 6385,-1813.5 6385,-1866.5"/>
<text text-anchor="middle" x="6196" y="-1851.3" font-family="Times,serif" font-size="14.00">FFN Gate+Up Projection (GPU0&#45;3)</text>
<text text-anchor="middle" x="6196" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="6196" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- ffn_silu_2_s0 -->
<g id="node15" class="node">
<title>ffn_silu_2_s0</title>
<polygon fill="lightyellow" stroke="black" points="5949,-1866.5 5571,-1866.5 5571,-1813.5 5949,-1813.5 5949,-1866.5"/>
<text text-anchor="middle" x="5760" y="-1851.3" font-family="Times,serif" font-size="14.00">SiLU Activation (GPU0&#45;3)</text>
<text text-anchor="middle" x="5760" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="5760" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- ffn_down_2_s0 -->
<g id="node16" class="node">
<title>ffn_down_2_s0</title>
<polygon fill="lightyellow" stroke="black" points="5513,-1866.5 5147,-1866.5 5147,-1813.5 5513,-1813.5 5513,-1866.5"/>
<text text-anchor="middle" x="5330" y="-1851.3" font-family="Times,serif" font-size="14.00">FFN Down Projection (GPU0&#45;3)</text>
<text text-anchor="middle" x="5330" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="5330" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- ffn_ar_2_s0 -->
<g id="node17" class="node">
<title>ffn_ar_2_s0</title>
<ellipse fill="lightgreen" stroke="black" cx="4949" cy="-1840" rx="140.01" ry="26.74"/>
<text text-anchor="middle" x="4949" y="-1843.8" font-family="Times,serif" font-size="14.00">FFN All&#45;Reduce (GPU0&#45;3)</text>
<text text-anchor="middle" x="4949" y="-1828.8" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- qkv_proj_3_s0 -->
<g id="node18" class="node">
<title>qkv_proj_3_s0</title>
<polygon fill="lightyellow" stroke="black" points="8255,-1866.5 7827,-1866.5 7827,-1813.5 8255,-1813.5 8255,-1866.5"/>
<text text-anchor="middle" x="8041" y="-1851.3" font-family="Times,serif" font-size="14.00">QKV Projection (GPU0&#45;3)</text>
<text text-anchor="middle" x="8041" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="8041" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
</g>
<!-- attn_scores_3_s0 -->
<g id="node19" class="node">
<title>attn_scores_3_s0</title>
<polygon fill="lightyellow" stroke="black" points="7769,-1866.5 7323,-1866.5 7323,-1813.5 7769,-1813.5 7769,-1866.5"/>
<text text-anchor="middle" x="7546" y="-1851.3" font-family="Times,serif" font-size="14.00">Attention Scores (GPU0&#45;3)</text>
<text text-anchor="middle" x="7546" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
<text text-anchor="middle" x="7546" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
</g>
<!-- attn_out_3_s0 -->
<g id="node20" class="node">
<title>attn_out_3_s0</title>
<polygon fill="lightyellow" stroke="black" points="7265,-1866.5 6831,-1866.5 6831,-1813.5 7265,-1813.5 7265,-1866.5"/>
<text text-anchor="middle" x="7048" y="-1851.3" font-family="Times,serif" font-size="14.00">Attention Output (GPU0&#45;3)</text>
<text text-anchor="middle" x="7048" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
<text text-anchor="middle" x="7048" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- attn_ar_3_s0 -->
<g id="node21" class="node">
<title>attn_ar_3_s0</title>
<ellipse fill="lightgreen" stroke="black" cx="6608" cy="-1840" rx="164.51" ry="26.74"/>
<text text-anchor="middle" x="6608" y="-1843.8" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce (GPU0&#45;3)</text>
<text text-anchor="middle" x="6608" y="-1828.8" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- ffn_gate_up_3_s0 -->
<g id="node22" class="node">
<title>ffn_gate_up_3_s0</title>
<polygon fill="lightyellow" stroke="black" points="2881,-1866.5 2503,-1866.5 2503,-1813.5 2881,-1813.5 2881,-1866.5"/>
<text text-anchor="middle" x="2692" y="-1851.3" font-family="Times,serif" font-size="14.00">FFN Gate+Up Projection (GPU0&#45;3)</text>
<text text-anchor="middle" x="2692" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="2692" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- ffn_silu_3_s0 -->
<g id="node23" class="node">
<title>ffn_silu_3_s0</title>
<polygon fill="lightyellow" stroke="black" points="2445,-1866.5 2067,-1866.5 2067,-1813.5 2445,-1813.5 2445,-1866.5"/>
<text text-anchor="middle" x="2256" y="-1851.3" font-family="Times,serif" font-size="14.00">SiLU Activation (GPU0&#45;3)</text>
<text text-anchor="middle" x="2256" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="2256" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- ffn_down_3_s0 -->
<g id="node24" class="node">
<title>ffn_down_3_s0</title>
<polygon fill="lightyellow" stroke="black" points="2009,-1866.5 1643,-1866.5 1643,-1813.5 2009,-1813.5 2009,-1866.5"/>
<text text-anchor="middle" x="1826" y="-1851.3" font-family="Times,serif" font-size="14.00">FFN Down Projection (GPU0&#45;3)</text>
<text text-anchor="middle" x="1826" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="1826" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- ffn_ar_3_s0 -->
<g id="node25" class="node">
<title>ffn_ar_3_s0</title>
<ellipse fill="lightgreen" stroke="black" cx="1445" cy="-1840" rx="140.01" ry="26.74"/>
<text text-anchor="middle" x="1445" y="-1843.8" font-family="Times,serif" font-size="14.00">FFN All&#45;Reduce (GPU0&#45;3)</text>
<text text-anchor="middle" x="1445" y="-1828.8" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- stage0_final -->
<g id="node30" class="node">
<title>stage0_final</title>
<polygon fill="lightblue" stroke="black" points="1617,-1727.13 1273,-1727.13 1273,-1659.13 1617,-1659.13 1617,-1727.13"/>
<text text-anchor="middle" x="1445" y="-1711.93" font-family="Times,serif" font-size="14.00">Stage 0 Final Layer (GPU0&#45;3)</text>
<text text-anchor="middle" x="1445" y="-1696.93" font-family="Times,serif" font-size="14.00">Layer 39: RMSNorm + Attention + FFN</text>
<text text-anchor="middle" x="1445" y="-1681.93" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="1445" y="-1666.93" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- ffn_ar_3_s0&#45;&gt;stage0_final -->
<g id="edge11" class="edge">
<title>ffn_ar_3_s0&#45;&gt;stage0_final</title>
<path fill="none" stroke="black" d="M1445,-1813.06C1445,-1813.06 1445,-1737.13 1445,-1737.13"/>
<polygon fill="black" stroke="black" points="1448.5,-1737.13 1445,-1727.13 1441.5,-1737.13 1448.5,-1737.13"/>
</g>
<!-- rmsnorm_1_s0 -->
<g id="node27" class="node">
<title>rmsnorm_1_s0</title>
<polygon fill="lightyellow" stroke="black" points="411,-1551.54 67,-1551.54 67,-1498.54 411,-1498.54 411,-1551.54"/>
<text text-anchor="middle" x="239" y="-1536.34" font-family="Times,serif" font-size="14.00">Layer 1: RMSNorm (GPU0&#45;3)</text>
<text text-anchor="middle" x="239" y="-1521.34" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="239" y="-1506.34" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- embed_0&#45;&gt;rmsnorm_1_s0 -->
<g id="edge2" class="edge">
<title>embed_0&#45;&gt;rmsnorm_1_s0</title>
<path fill="none" stroke="black" d="M239,-1666.49C239,-1666.49 239,-1561.55 239,-1561.55"/>
<polygon fill="black" stroke="black" points="242.5,-1561.55 239,-1551.55 235.5,-1561.55 242.5,-1561.55"/>
</g>
<!-- rmsnorm_1_s0&#45;&gt;qkv_proj_1_s0 -->
<g id="edge3" class="edge">
<title>rmsnorm_1_s0&#45;&gt;qkv_proj_1_s0</title>
<path fill="none" stroke="black" d="M239,-1498.41C239,-1498.41 239,-1393.47 239,-1393.47"/>
<polygon fill="black" stroke="black" points="242.5,-1393.47 239,-1383.47 235.5,-1393.47 242.5,-1393.47"/>
</g>
<!-- rmsnorm_2_s0 -->
<g id="node28" class="node">
<title>rmsnorm_2_s0</title>
<polygon fill="lightyellow" stroke="black" points="1215,-1719.63 871,-1719.63 871,-1666.63 1215,-1666.63 1215,-1719.63"/>
<text text-anchor="middle" x="1043" y="-1704.43" font-family="Times,serif" font-size="14.00">Layer 2: RMSNorm (GPU0&#45;3)</text>
<text text-anchor="middle" x="1043" y="-1689.43" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="1043" y="-1674.43" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- rmsnorm_3_s0 -->
<g id="node29" class="node">
<title>rmsnorm_3_s0</title>
<polygon fill="lightyellow" stroke="black" points="813,-1719.63 469,-1719.63 469,-1666.63 813,-1666.63 813,-1719.63"/>
<text text-anchor="middle" x="641" y="-1704.43" font-family="Times,serif" font-size="14.00">Layer 3: RMSNorm (GPU0&#45;3)</text>
<text text-anchor="middle" x="641" y="-1689.43" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="641" y="-1674.43" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- pp_comm_s0_s1 -->
<g id="node31" class="node">
<title>pp_comm_s0_s1</title>
<ellipse fill="lightgreen" stroke="black" cx="1885" cy="-1525.04" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1885" y="-1543.84" font-family="Times,serif" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="1885" y="-1528.84" font-family="Times,serif" font-size="14.00">Stage 0 → Stage 1</text>
<text text-anchor="middle" x="1885" y="-1513.84" font-family="Times,serif" font-size="14.00">GPU0&#45;3 → GPU4&#45;7</text>
<text text-anchor="middle" x="1885" y="-1498.84" font-family="Times,serif" font-size="14.00">Message: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- stage0_final&#45;&gt;pp_comm_s0_s1 -->
<g id="edge12" class="edge">
<title>stage0_final&#45;&gt;pp_comm_s0_s1</title>
<path fill="none" stroke="black" d="M1617.1,-1693C1630.01,-1693 1638.13,-1693 1638.13,-1693 1638.13,-1693 1638.13,-1544.56 1638.13,-1544.56"/>
<polygon fill="black" stroke="black" points="1641.64,-1544.55 1638.13,-1534.56 1634.64,-1544.56 1641.64,-1544.55"/>
</g>
<!-- stage1_first -->
<g id="node56" class="node">
<title>stage1_first</title>
<polygon fill="lightpink" stroke="black" points="3270,-1390.96 2926,-1390.96 2926,-1322.96 3270,-1322.96 3270,-1390.96"/>
<text text-anchor="middle" x="3098" y="-1375.76" font-family="Times,serif" font-size="14.00">Stage 1 First Layer (GPU4&#45;7)</text>
<text text-anchor="middle" x="3098" y="-1360.76" font-family="Times,serif" font-size="14.00">Layer 40: RMSNorm + Attention + FFN</text>
<text text-anchor="middle" x="3098" y="-1345.76" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="3098" y="-1330.76" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- pp_comm_s0_s1&#45;&gt;stage1_first -->
<g id="edge13" class="edge">
<title>pp_comm_s0_s1&#45;&gt;stage1_first</title>
<path fill="none" stroke="black" d="M2129.37,-1513.36C2129.37,-1480.22 2129.37,-1388 2129.37,-1388 2129.37,-1388 2915.94,-1388 2915.94,-1388"/>
<polygon fill="black" stroke="black" points="2915.94,-1391.5 2925.94,-1388 2915.94,-1384.5 2915.94,-1391.5"/>
</g>
<!-- qkv_proj_41_s1 -->
<g id="node32" class="node">
<title>qkv_proj_41_s1</title>
<polygon fill="lightyellow" stroke="black" points="3312,-1044.96 2884,-1044.96 2884,-991.96 3312,-991.96 3312,-1044.96"/>
<text text-anchor="middle" x="3098" y="-1029.76" font-family="Times,serif" font-size="14.00">QKV Projection (GPU4&#45;7)</text>
<text text-anchor="middle" x="3098" y="-1014.76" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="3098" y="-999.76" font-family="Times,serif" font-size="14.00">Output: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
</g>
<!-- attn_scores_41_s1 -->
<g id="node33" class="node">
<title>attn_scores_41_s1</title>
<polygon fill="lightyellow" stroke="black" points="3321,-905.59 2875,-905.59 2875,-852.59 3321,-852.59 3321,-905.59"/>
<text text-anchor="middle" x="3098" y="-890.39" font-family="Times,serif" font-size="14.00">Attention Scores (GPU4&#45;7)</text>
<text text-anchor="middle" x="3098" y="-875.39" font-family="Times,serif" font-size="14.00">Input: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
<text text-anchor="middle" x="3098" y="-860.39" font-family="Times,serif" font-size="14.00">Output: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
</g>
<!-- qkv_proj_41_s1&#45;&gt;attn_scores_41_s1 -->
<g id="edge16" class="edge">
<title>qkv_proj_41_s1&#45;&gt;attn_scores_41_s1</title>
<path fill="none" stroke="black" d="M3098,-991.92C3098,-991.92 3098,-916.01 3098,-916.01"/>
<polygon fill="black" stroke="black" points="3101.5,-916.01 3098,-906.01 3094.5,-916.01 3101.5,-916.01"/>
</g>
<!-- attn_out_41_s1 -->
<g id="node34" class="node">
<title>attn_out_41_s1</title>
<polygon fill="lightyellow" stroke="black" points="3315,-766.22 2881,-766.22 2881,-713.22 3315,-713.22 3315,-766.22"/>
<text text-anchor="middle" x="3098" y="-751.02" font-family="Times,serif" font-size="14.00">Attention Output (GPU4&#45;7)</text>
<text text-anchor="middle" x="3098" y="-736.02" font-family="Times,serif" font-size="14.00">Input: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
<text text-anchor="middle" x="3098" y="-721.02" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- attn_scores_41_s1&#45;&gt;attn_out_41_s1 -->
<g id="edge17" class="edge">
<title>attn_scores_41_s1&#45;&gt;attn_out_41_s1</title>
<path fill="none" stroke="black" d="M3098,-852.55C3098,-852.55 3098,-776.64 3098,-776.64"/>
<polygon fill="black" stroke="black" points="3101.5,-776.64 3098,-766.64 3094.5,-776.64 3101.5,-776.64"/>
</g>
<!-- attn_ar_41_s1 -->
<g id="node35" class="node">
<title>attn_ar_41_s1</title>
<ellipse fill="lightgreen" stroke="black" cx="3098" cy="-600.35" rx="164.51" ry="26.74"/>
<text text-anchor="middle" x="3098" y="-604.15" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce (GPU4&#45;7)</text>
<text text-anchor="middle" x="3098" y="-589.15" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- attn_out_41_s1&#45;&gt;attn_ar_41_s1 -->
<g id="edge18" class="edge">
<title>attn_out_41_s1&#45;&gt;attn_ar_41_s1</title>
<path fill="none" stroke="black" d="M3098,-713.18C3098,-713.18 3098,-637.27 3098,-637.27"/>
<polygon fill="black" stroke="black" points="3101.5,-637.27 3098,-627.27 3094.5,-637.27 3101.5,-637.27"/>
</g>
<!-- ffn_gate_up_41_s1 -->
<g id="node36" class="node">
<title>ffn_gate_up_41_s1</title>
<polygon fill="lightyellow" stroke="black" points="3287,-487.48 2909,-487.48 2909,-434.48 3287,-434.48 3287,-487.48"/>
<text text-anchor="middle" x="3098" y="-472.28" font-family="Times,serif" font-size="14.00">FFN Gate+Up Projection (GPU4&#45;7)</text>
<text text-anchor="middle" x="3098" y="-457.28" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="3098" y="-442.28" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- attn_ar_41_s1&#45;&gt;ffn_gate_up_41_s1 -->
<g id="edge19" class="edge">
<title>attn_ar_41_s1&#45;&gt;ffn_gate_up_41_s1</title>
<path fill="none" stroke="black" d="M3098,-573.48C3098,-573.48 3098,-497.77 3098,-497.77"/>
<polygon fill="black" stroke="black" points="3101.5,-497.77 3098,-487.77 3094.5,-497.77 3101.5,-497.77"/>
</g>
<!-- ffn_silu_41_s1 -->
<g id="node37" class="node">
<title>ffn_silu_41_s1</title>
<polygon fill="lightyellow" stroke="black" points="3287,-348.11 2909,-348.11 2909,-295.11 3287,-295.11 3287,-348.11"/>
<text text-anchor="middle" x="3098" y="-332.91" font-family="Times,serif" font-size="14.00">SiLU Activation (GPU4&#45;7)</text>
<text text-anchor="middle" x="3098" y="-317.91" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="3098" y="-302.91" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- ffn_gate_up_41_s1&#45;&gt;ffn_silu_41_s1 -->
<g id="edge20" class="edge">
<title>ffn_gate_up_41_s1&#45;&gt;ffn_silu_41_s1</title>
<path fill="none" stroke="black" d="M3098,-434.44C3098,-434.44 3098,-358.53 3098,-358.53"/>
<polygon fill="black" stroke="black" points="3101.5,-358.53 3098,-348.53 3094.5,-358.53 3101.5,-358.53"/>
</g>
<!-- ffn_down_41_s1 -->
<g id="node38" class="node">
<title>ffn_down_41_s1</title>
<polygon fill="lightyellow" stroke="black" points="3281,-208.74 2915,-208.74 2915,-155.74 3281,-155.74 3281,-208.74"/>
<text text-anchor="middle" x="3098" y="-193.54" font-family="Times,serif" font-size="14.00">FFN Down Projection (GPU4&#45;7)</text>
<text text-anchor="middle" x="3098" y="-178.54" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="3098" y="-163.54" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- ffn_silu_41_s1&#45;&gt;ffn_down_41_s1 -->
<g id="edge21" class="edge">
<title>ffn_silu_41_s1&#45;&gt;ffn_down_41_s1</title>
<path fill="none" stroke="black" d="M3098,-295.07C3098,-295.07 3098,-219.16 3098,-219.16"/>
<polygon fill="black" stroke="black" points="3101.5,-219.16 3098,-209.16 3094.5,-219.16 3101.5,-219.16"/>
</g>
<!-- ffn_ar_41_s1 -->
<g id="node39" class="node">
<title>ffn_ar_41_s1</title>
<ellipse fill="lightgreen" stroke="black" cx="3098" cy="-42.87" rx="140.01" ry="26.74"/>
<text text-anchor="middle" x="3098" y="-46.67" font-family="Times,serif" font-size="14.00">FFN All&#45;Reduce (GPU4&#45;7)</text>
<text text-anchor="middle" x="3098" y="-31.67" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- ffn_down_41_s1&#45;&gt;ffn_ar_41_s1 -->
<g id="edge22" class="edge">
<title>ffn_down_41_s1&#45;&gt;ffn_ar_41_s1</title>
<path fill="none" stroke="black" d="M3098,-155.7C3098,-155.7 3098,-79.79 3098,-79.79"/>
<polygon fill="black" stroke="black" points="3101.5,-79.79 3098,-69.79 3094.5,-79.79 3101.5,-79.79"/>
</g>
<!-- qkv_proj_42_s1 -->
<g id="node40" class="node">
<title>qkv_proj_42_s1</title>
<polygon fill="lightyellow" stroke="black" points="10125,-1866.5 9697,-1866.5 9697,-1813.5 10125,-1813.5 10125,-1866.5"/>
<text text-anchor="middle" x="9911" y="-1851.3" font-family="Times,serif" font-size="14.00">QKV Projection (GPU4&#45;7)</text>
<text text-anchor="middle" x="9911" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="9911" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
</g>
<!-- attn_scores_42_s1 -->
<g id="node41" class="node">
<title>attn_scores_42_s1</title>
<polygon fill="lightyellow" stroke="black" points="9639,-1866.5 9193,-1866.5 9193,-1813.5 9639,-1813.5 9639,-1866.5"/>
<text text-anchor="middle" x="9416" y="-1851.3" font-family="Times,serif" font-size="14.00">Attention Scores (GPU4&#45;7)</text>
<text text-anchor="middle" x="9416" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
<text text-anchor="middle" x="9416" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
</g>
<!-- attn_out_42_s1 -->
<g id="node42" class="node">
<title>attn_out_42_s1</title>
<polygon fill="lightyellow" stroke="black" points="9135,-1866.5 8701,-1866.5 8701,-1813.5 9135,-1813.5 9135,-1866.5"/>
<text text-anchor="middle" x="8918" y="-1851.3" font-family="Times,serif" font-size="14.00">Attention Output (GPU4&#45;7)</text>
<text text-anchor="middle" x="8918" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
<text text-anchor="middle" x="8918" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- attn_ar_42_s1 -->
<g id="node43" class="node">
<title>attn_ar_42_s1</title>
<ellipse fill="lightgreen" stroke="black" cx="8478" cy="-1840" rx="164.51" ry="26.74"/>
<text text-anchor="middle" x="8478" y="-1843.8" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce (GPU4&#45;7)</text>
<text text-anchor="middle" x="8478" y="-1828.8" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- ffn_gate_up_42_s1 -->
<g id="node44" class="node">
<title>ffn_gate_up_42_s1</title>
<polygon fill="lightyellow" stroke="black" points="11759,-1866.5 11381,-1866.5 11381,-1813.5 11759,-1813.5 11759,-1866.5"/>
<text text-anchor="middle" x="11570" y="-1851.3" font-family="Times,serif" font-size="14.00">FFN Gate+Up Projection (GPU4&#45;7)</text>
<text text-anchor="middle" x="11570" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="11570" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- ffn_silu_42_s1 -->
<g id="node45" class="node">
<title>ffn_silu_42_s1</title>
<polygon fill="lightyellow" stroke="black" points="11323,-1866.5 10945,-1866.5 10945,-1813.5 11323,-1813.5 11323,-1866.5"/>
<text text-anchor="middle" x="11134" y="-1851.3" font-family="Times,serif" font-size="14.00">SiLU Activation (GPU4&#45;7)</text>
<text text-anchor="middle" x="11134" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="11134" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- ffn_down_42_s1 -->
<g id="node46" class="node">
<title>ffn_down_42_s1</title>
<polygon fill="lightyellow" stroke="black" points="10887,-1866.5 10521,-1866.5 10521,-1813.5 10887,-1813.5 10887,-1866.5"/>
<text text-anchor="middle" x="10704" y="-1851.3" font-family="Times,serif" font-size="14.00">FFN Down Projection (GPU4&#45;7)</text>
<text text-anchor="middle" x="10704" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="10704" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- ffn_ar_42_s1 -->
<g id="node47" class="node">
<title>ffn_ar_42_s1</title>
<ellipse fill="lightgreen" stroke="black" cx="10323" cy="-1840" rx="140.01" ry="26.74"/>
<text text-anchor="middle" x="10323" y="-1843.8" font-family="Times,serif" font-size="14.00">FFN All&#45;Reduce (GPU4&#45;7)</text>
<text text-anchor="middle" x="10323" y="-1828.8" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- qkv_proj_43_s1 -->
<g id="node48" class="node">
<title>qkv_proj_43_s1</title>
<polygon fill="lightyellow" stroke="black" points="13629,-1866.5 13201,-1866.5 13201,-1813.5 13629,-1813.5 13629,-1866.5"/>
<text text-anchor="middle" x="13415" y="-1851.3" font-family="Times,serif" font-size="14.00">QKV Projection (GPU4&#45;7)</text>
<text text-anchor="middle" x="13415" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="13415" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
</g>
<!-- attn_scores_43_s1 -->
<g id="node49" class="node">
<title>attn_scores_43_s1</title>
<polygon fill="lightyellow" stroke="black" points="13143,-1866.5 12697,-1866.5 12697,-1813.5 13143,-1813.5 13143,-1866.5"/>
<text text-anchor="middle" x="12920" y="-1851.3" font-family="Times,serif" font-size="14.00">Attention Scores (GPU4&#45;7)</text>
<text text-anchor="middle" x="12920" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: Q,K,V [batch=32, seq=2048, head=64, d_k=128]</text>
<text text-anchor="middle" x="12920" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
</g>
<!-- attn_out_43_s1 -->
<g id="node50" class="node">
<title>attn_out_43_s1</title>
<polygon fill="lightyellow" stroke="black" points="12639,-1866.5 12205,-1866.5 12205,-1813.5 12639,-1813.5 12639,-1866.5"/>
<text text-anchor="middle" x="12422" y="-1851.3" font-family="Times,serif" font-size="14.00">Attention Output (GPU4&#45;7)</text>
<text text-anchor="middle" x="12422" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: Scores [batch=32, head=64, seq=2048, seq=2048]</text>
<text text-anchor="middle" x="12422" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- attn_ar_43_s1 -->
<g id="node51" class="node">
<title>attn_ar_43_s1</title>
<ellipse fill="lightgreen" stroke="black" cx="11982" cy="-1840" rx="164.51" ry="26.74"/>
<text text-anchor="middle" x="11982" y="-1843.8" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce (GPU4&#45;7)</text>
<text text-anchor="middle" x="11982" y="-1828.8" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- ffn_gate_up_43_s1 -->
<g id="node52" class="node">
<title>ffn_gate_up_43_s1</title>
<polygon fill="lightyellow" stroke="black" points="3771,-1551.54 3393,-1551.54 3393,-1498.54 3771,-1498.54 3771,-1551.54"/>
<text text-anchor="middle" x="3582" y="-1536.34" font-family="Times,serif" font-size="14.00">FFN Gate+Up Projection (GPU4&#45;7)</text>
<text text-anchor="middle" x="3582" y="-1521.34" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="3582" y="-1506.34" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- ffn_silu_43_s1 -->
<g id="node53" class="node">
<title>ffn_silu_43_s1</title>
<polygon fill="lightyellow" stroke="black" points="3335,-1551.54 2957,-1551.54 2957,-1498.54 3335,-1498.54 3335,-1551.54"/>
<text text-anchor="middle" x="3146" y="-1536.34" font-family="Times,serif" font-size="14.00">SiLU Activation (GPU4&#45;7)</text>
<text text-anchor="middle" x="3146" y="-1521.34" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="3146" y="-1506.34" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, ffn_hidden=28672]</text>
</g>
<!-- ffn_down_43_s1 -->
<g id="node54" class="node">
<title>ffn_down_43_s1</title>
<polygon fill="lightyellow" stroke="black" points="2899,-1551.54 2533,-1551.54 2533,-1498.54 2899,-1498.54 2899,-1551.54"/>
<text text-anchor="middle" x="2716" y="-1536.34" font-family="Times,serif" font-size="14.00">FFN Down Projection (GPU4&#45;7)</text>
<text text-anchor="middle" x="2716" y="-1521.34" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, ffn_hidden=28672]</text>
<text text-anchor="middle" x="2716" y="-1506.34" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- ffn_ar_43_s1 -->
<g id="node55" class="node">
<title>ffn_ar_43_s1</title>
<ellipse fill="lightgreen" stroke="black" cx="2335" cy="-1525.04" rx="140.01" ry="26.74"/>
<text text-anchor="middle" x="2335" y="-1528.84" font-family="Times,serif" font-size="14.00">FFN All&#45;Reduce (GPU4&#45;7)</text>
<text text-anchor="middle" x="2335" y="-1513.84" font-family="Times,serif" font-size="14.00">TP4 Collective Operation</text>
</g>
<!-- stage1_final -->
<g id="node60" class="node">
<title>stage1_final</title>
<polygon fill="lightpink" stroke="black" points="2064,-1390.96 1720,-1390.96 1720,-1322.96 2064,-1322.96 2064,-1390.96"/>
<text text-anchor="middle" x="1892" y="-1375.76" font-family="Times,serif" font-size="14.00">Stage 1 Final Layer (GPU4&#45;7)</text>
<text text-anchor="middle" x="1892" y="-1360.76" font-family="Times,serif" font-size="14.00">Layer 79: RMSNorm</text>
<text text-anchor="middle" x="1892" y="-1345.76" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="1892" y="-1330.76" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- ffn_ar_43_s1&#45;&gt;stage1_final -->
<g id="edge23" class="edge">
<title>ffn_ar_43_s1&#45;&gt;stage1_final</title>
<path fill="none" stroke="black" d="M2330.5,-1498.04C2330.5,-1457.35 2330.5,-1385 2330.5,-1385 2330.5,-1385 2074.05,-1385 2074.05,-1385"/>
<polygon fill="black" stroke="black" points="2074.05,-1381.5 2064.05,-1385 2074.05,-1388.5 2074.05,-1381.5"/>
</g>
<!-- rmsnorm_41_s1 -->
<g id="node57" class="node">
<title>rmsnorm_41_s1</title>
<polygon fill="lightyellow" stroke="black" points="3270,-1210.46 2926,-1210.46 2926,-1157.46 3270,-1157.46 3270,-1210.46"/>
<text text-anchor="middle" x="3098" y="-1195.26" font-family="Times,serif" font-size="14.00">Layer 41: RMSNorm (GPU4&#45;7)</text>
<text text-anchor="middle" x="3098" y="-1180.26" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="3098" y="-1165.26" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- stage1_first&#45;&gt;rmsnorm_41_s1 -->
<g id="edge14" class="edge">
<title>stage1_first&#45;&gt;rmsnorm_41_s1</title>
<path fill="none" stroke="black" d="M3098,-1322.78C3098,-1322.78 3098,-1220.7 3098,-1220.7"/>
<polygon fill="black" stroke="black" points="3101.5,-1220.7 3098,-1210.7 3094.5,-1220.7 3101.5,-1220.7"/>
</g>
<!-- rmsnorm_41_s1&#45;&gt;qkv_proj_41_s1 -->
<g id="edge15" class="edge">
<title>rmsnorm_41_s1&#45;&gt;qkv_proj_41_s1</title>
<path fill="none" stroke="black" d="M3098,-1157.37C3098,-1157.37 3098,-1054.98 3098,-1054.98"/>
<polygon fill="black" stroke="black" points="3101.5,-1054.98 3098,-1044.98 3094.5,-1054.98 3101.5,-1054.98"/>
</g>
<!-- rmsnorm_42_s1 -->
<g id="node58" class="node">
<title>rmsnorm_42_s1</title>
<polygon fill="lightyellow" stroke="black" points="2868,-1383.46 2524,-1383.46 2524,-1330.46 2868,-1330.46 2868,-1383.46"/>
<text text-anchor="middle" x="2696" y="-1368.26" font-family="Times,serif" font-size="14.00">Layer 42: RMSNorm (GPU4&#45;7)</text>
<text text-anchor="middle" x="2696" y="-1353.26" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="2696" y="-1338.26" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- rmsnorm_43_s1 -->
<g id="node59" class="node">
<title>rmsnorm_43_s1</title>
<polygon fill="lightyellow" stroke="black" points="2466,-1383.46 2122,-1383.46 2122,-1330.46 2466,-1330.46 2466,-1383.46"/>
<text text-anchor="middle" x="2294" y="-1368.26" font-family="Times,serif" font-size="14.00">Layer 43: RMSNorm (GPU4&#45;7)</text>
<text text-anchor="middle" x="2294" y="-1353.26" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="2294" y="-1338.26" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, hidden=8192]</text>
</g>
<!-- lm_head -->
<g id="node61" class="node">
<title>lm_head</title>
<polygon fill="lightyellow" stroke="black" points="1696.02,-1236.96 1112.17,-1236.96 961.98,-1130.96 1545.83,-1130.96 1696.02,-1236.96"/>
<text text-anchor="middle" x="1329" y="-1195.26" font-family="Times,serif" font-size="14.00">LM Head (GPU4&#45;7)</text>
<text text-anchor="middle" x="1329" y="-1180.26" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, hidden=8192]</text>
<text text-anchor="middle" x="1329" y="-1165.26" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, vocab=128256]</text>
</g>
<!-- stage1_final&#45;&gt;lm_head -->
<g id="edge24" class="edge">
<title>stage1_final&#45;&gt;lm_head</title>
<path fill="none" stroke="black" d="M1719.97,-1326C1688.11,-1326 1664.64,-1326 1664.64,-1326 1664.64,-1326 1664.64,-1194.06 1664.64,-1194.06"/>
<polygon fill="black" stroke="black" points="1668.14,-1194.06 1664.64,-1184.06 1661.14,-1194.06 1668.14,-1194.06"/>
</g>
<!-- output -->
<g id="node62" class="node">
<title>output</title>
<path fill="lightgray" stroke="black" d="M1494,-1044.96C1494,-1044.96 1164,-1044.96 1164,-1044.96 1158,-1044.96 1152,-1038.96 1152,-1032.96 1152,-1032.96 1152,-1003.96 1152,-1003.96 1152,-997.96 1158,-991.96 1164,-991.96 1164,-991.96 1494,-991.96 1494,-991.96 1500,-991.96 1506,-997.96 1506,-1003.96 1506,-1003.96 1506,-1032.96 1506,-1032.96 1506,-1038.96 1500,-1044.96 1494,-1044.96"/>
<text text-anchor="middle" x="1329" y="-1029.76" font-family="Times,serif" font-size="14.00">Output Layer</text>
<text text-anchor="middle" x="1329" y="-1014.76" font-family="Times,serif" font-size="14.00">Input: [batch=32, seq=2048, vocab=128256]</text>
<text text-anchor="middle" x="1329" y="-999.76" font-family="Times,serif" font-size="14.00">Output: [batch=32, seq=2048, vocab=128256]</text>
</g>
<!-- lm_head&#45;&gt;output -->
<g id="edge25" class="edge">
<title>lm_head&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1329,-1130.68C1329,-1130.68 1329,-1055.21 1329,-1055.21"/>
<polygon fill="black" stroke="black" points="1332.5,-1055.21 1329,-1045.21 1325.5,-1055.21 1332.5,-1055.21"/>
</g>
</g>
</svg>
