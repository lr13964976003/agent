<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: LLM_TP4_PP2_Simplified_Corrected Pages: 1 -->
<svg width="384pt" height="1453pt"
 viewBox="0.00 0.00 383.59 1452.74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1448.74)">
<title>LLM_TP4_PP2_Simplified_Corrected</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1448.74 379.59,-1448.74 379.59,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightcoral" stroke="black" points="375.38,-1418.61 281.59,-1444.87 94,-1444.87 0.21,-1418.61 94,-1392.35 281.59,-1392.35 375.38,-1418.61"/>
<text text-anchor="middle" x="187.79" y="-1421.81" font-family="Arial" font-size="11.00">INPUT</text>
<text text-anchor="middle" x="187.79" y="-1409.81" font-family="Arial" font-size="11.00">[batch_size=1, seq_len=2048, hidden=8192]</text>
</g>
<!-- stage0_overview -->
<g id="node2" class="node">
<title>stage0_overview</title>
<path fill="lightgray" stroke="black" d="M238.29,-1320.48C238.29,-1320.48 137.29,-1320.48 137.29,-1320.48 131.29,-1320.48 125.29,-1314.48 125.29,-1308.48 125.29,-1308.48 125.29,-1285.48 125.29,-1285.48 125.29,-1279.48 131.29,-1273.48 137.29,-1273.48 137.29,-1273.48 238.29,-1273.48 238.29,-1273.48 244.29,-1273.48 250.29,-1279.48 250.29,-1285.48 250.29,-1285.48 250.29,-1308.48 250.29,-1308.48 250.29,-1314.48 244.29,-1320.48 238.29,-1320.48"/>
<text text-anchor="middle" x="187.79" y="-1306.88" font-family="Arial" font-size="12.00">PIPELINE STAGE 0</text>
<text text-anchor="middle" x="187.79" y="-1293.88" font-family="Arial" font-size="12.00">GPUs 0&#45;3 (TP4)</text>
<text text-anchor="middle" x="187.79" y="-1280.88" font-family="Arial" font-size="12.00">Layers 0&#45;39</text>
</g>
<!-- input&#45;&gt;stage0_overview -->
<g id="edge1" class="edge">
<title>input&#45;&gt;stage0_overview</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M187.79,-1392.24C187.79,-1374.3 187.79,-1350.09 187.79,-1330.7"/>
<polygon fill="black" stroke="black" points="191.29,-1330.49 187.79,-1320.49 184.29,-1330.49 191.29,-1330.49"/>
</g>
<!-- embed_s0 -->
<g id="node3" class="node">
<title>embed_s0</title>
<polygon fill="lightblue" stroke="black" points="234.29,-1201.48 141.29,-1201.48 141.29,-1165.48 234.29,-1165.48 234.29,-1201.48"/>
<text text-anchor="middle" x="187.79" y="-1186.68" font-family="Arial" font-size="11.00">Embedding</text>
<text text-anchor="middle" x="187.79" y="-1174.68" font-family="Arial" font-size="11.00">GPU: 0&#45;3 (TP4)</text>
</g>
<!-- stage0_overview&#45;&gt;embed_s0 -->
<g id="edge2" class="edge">
<title>stage0_overview&#45;&gt;embed_s0</title>
<path fill="none" stroke="black" d="M187.79,-1273.42C187.79,-1255.57 187.79,-1230.58 187.79,-1211.64"/>
<polygon fill="black" stroke="black" points="191.29,-1211.55 187.79,-1201.55 184.29,-1211.55 191.29,-1211.55"/>
</g>
<!-- attn_block_s0 -->
<g id="node4" class="node">
<title>attn_block_s0</title>
<polygon fill="lightblue" stroke="black" points="290.79,-1093.48 84.79,-1093.48 84.79,-1049.48 290.79,-1049.48 290.79,-1093.48"/>
<text text-anchor="middle" x="187.79" y="-1080.68" font-family="Arial" font-size="11.00">Attention Block</text>
<text text-anchor="middle" x="187.79" y="-1068.68" font-family="Arial" font-size="11.00">(QKV→Split→Compute→AR→Output)</text>
<text text-anchor="middle" x="187.79" y="-1056.68" font-family="Arial" font-size="11.00">GPU: 0&#45;3 (TP4)</text>
</g>
<!-- embed_s0&#45;&gt;attn_block_s0 -->
<g id="edge3" class="edge">
<title>embed_s0&#45;&gt;attn_block_s0</title>
<path fill="none" stroke="black" d="M187.79,-1165.29C187.79,-1148.9 187.79,-1123.83 187.79,-1103.87"/>
<polygon fill="black" stroke="black" points="191.29,-1103.69 187.79,-1093.69 184.29,-1103.69 191.29,-1103.69"/>
</g>
<!-- ffn_block_s0 -->
<g id="node5" class="node">
<title>ffn_block_s0</title>
<polygon fill="lightblue" stroke="black" points="253.79,-977.48 121.79,-977.48 121.79,-933.48 253.79,-933.48 253.79,-977.48"/>
<text text-anchor="middle" x="187.79" y="-964.68" font-family="Arial" font-size="11.00">FFN Block</text>
<text text-anchor="middle" x="187.79" y="-952.68" font-family="Arial" font-size="11.00">(Up→Act→Down→AR)</text>
<text text-anchor="middle" x="187.79" y="-940.68" font-family="Arial" font-size="11.00">GPU: 0&#45;3 (TP4)</text>
</g>
<!-- attn_block_s0&#45;&gt;ffn_block_s0 -->
<g id="edge4" class="edge">
<title>attn_block_s0&#45;&gt;ffn_block_s0</title>
<path fill="none" stroke="black" d="M187.79,-1049.31C187.79,-1032.03 187.79,-1007.37 187.79,-987.81"/>
<polygon fill="black" stroke="black" points="191.29,-987.54 187.79,-977.54 184.29,-987.54 191.29,-987.54"/>
</g>
<!-- layers_1_38_s0 -->
<g id="node6" class="node">
<title>layers_1_38_s0</title>
<polygon fill="lightblue" stroke="black" points="241.79,-861.48 133.79,-861.48 133.79,-817.48 241.79,-817.48 241.79,-861.48"/>
<text text-anchor="middle" x="187.79" y="-848.68" font-family="Arial" font-size="11.00">Layers 1&#45;38</text>
<text text-anchor="middle" x="187.79" y="-836.68" font-family="Arial" font-size="11.00">[Repeated Pattern]</text>
<text text-anchor="middle" x="187.79" y="-824.68" font-family="Arial" font-size="11.00">GPU: 0&#45;3 (TP4)</text>
</g>
<!-- ffn_block_s0&#45;&gt;layers_1_38_s0 -->
<g id="edge5" class="edge">
<title>ffn_block_s0&#45;&gt;layers_1_38_s0</title>
<path fill="none" stroke="black" d="M187.79,-933.31C187.79,-916.03 187.79,-891.37 187.79,-871.81"/>
<polygon fill="black" stroke="black" points="191.29,-871.54 187.79,-861.54 184.29,-871.54 191.29,-871.54"/>
</g>
<!-- layer_39_s0 -->
<g id="node7" class="node">
<title>layer_39_s0</title>
<polygon fill="lightblue" stroke="black" points="234.29,-745.48 141.29,-745.48 141.29,-709.48 234.29,-709.48 234.29,-745.48"/>
<text text-anchor="middle" x="187.79" y="-730.68" font-family="Arial" font-size="11.00">Layer 39 (Final)</text>
<text text-anchor="middle" x="187.79" y="-718.68" font-family="Arial" font-size="11.00">GPU: 0&#45;3 (TP4)</text>
</g>
<!-- layers_1_38_s0&#45;&gt;layer_39_s0 -->
<g id="edge6" class="edge">
<title>layers_1_38_s0&#45;&gt;layer_39_s0</title>
<path fill="none" stroke="black" d="M187.79,-817.27C187.79,-799.76 187.79,-774.78 187.79,-755.78"/>
<polygon fill="black" stroke="black" points="191.29,-755.65 187.79,-745.65 184.29,-755.65 191.29,-755.65"/>
</g>
<!-- pipe_comm -->
<g id="node8" class="node">
<title>pipe_comm</title>
<ellipse fill="lightyellow" stroke="black" cx="187.79" cy="-606.37" rx="94.09" ry="31.23"/>
<text text-anchor="middle" x="187.79" y="-615.57" font-family="Arial" font-size="11.00">Pipeline Communication</text>
<text text-anchor="middle" x="187.79" y="-603.57" font-family="Arial" font-size="11.00">Stage 0 → Stage 1</text>
<text text-anchor="middle" x="187.79" y="-591.57" font-family="Arial" font-size="11.00">GPU: 0&#45;3 → 4&#45;7</text>
</g>
<!-- layer_39_s0&#45;&gt;pipe_comm -->
<g id="edge7" class="edge">
<title>layer_39_s0&#45;&gt;pipe_comm</title>
<path fill="none" stroke="black" d="M187.79,-709.42C187.79,-693.46 187.79,-669 187.79,-648.04"/>
<polygon fill="black" stroke="black" points="191.29,-647.77 187.79,-637.77 184.29,-647.77 191.29,-647.77"/>
</g>
<!-- stage1_overview -->
<g id="node9" class="node">
<title>stage1_overview</title>
<path fill="lightgray" stroke="black" d="M238.29,-503.26C238.29,-503.26 137.29,-503.26 137.29,-503.26 131.29,-503.26 125.29,-497.26 125.29,-491.26 125.29,-491.26 125.29,-468.26 125.29,-468.26 125.29,-462.26 131.29,-456.26 137.29,-456.26 137.29,-456.26 238.29,-456.26 238.29,-456.26 244.29,-456.26 250.29,-462.26 250.29,-468.26 250.29,-468.26 250.29,-491.26 250.29,-491.26 250.29,-497.26 244.29,-503.26 238.29,-503.26"/>
<text text-anchor="middle" x="187.79" y="-489.66" font-family="Arial" font-size="12.00">PIPELINE STAGE 1</text>
<text text-anchor="middle" x="187.79" y="-476.66" font-family="Arial" font-size="12.00">GPUs 4&#45;7 (TP4)</text>
<text text-anchor="middle" x="187.79" y="-463.66" font-family="Arial" font-size="12.00">Layers 40&#45;79</text>
</g>
<!-- pipe_comm&#45;&gt;stage1_overview -->
<g id="edge8" class="edge">
<title>pipe_comm&#45;&gt;stage1_overview</title>
<path fill="none" stroke="black" d="M187.79,-575.2C187.79,-556.61 187.79,-532.75 187.79,-513.66"/>
<polygon fill="black" stroke="black" points="191.29,-513.62 187.79,-503.62 184.29,-513.62 191.29,-513.62"/>
</g>
<!-- layer_40_s1 -->
<g id="node10" class="node">
<title>layer_40_s1</title>
<polygon fill="lightblue" stroke="black" points="234.29,-384.26 141.29,-384.26 141.29,-348.26 234.29,-348.26 234.29,-384.26"/>
<text text-anchor="middle" x="187.79" y="-369.46" font-family="Arial" font-size="11.00">Layer 40 (First)</text>
<text text-anchor="middle" x="187.79" y="-357.46" font-family="Arial" font-size="11.00">GPU: 4&#45;7 (TP4)</text>
</g>
<!-- stage1_overview&#45;&gt;layer_40_s1 -->
<g id="edge9" class="edge">
<title>stage1_overview&#45;&gt;layer_40_s1</title>
<path fill="none" stroke="black" d="M187.79,-456.19C187.79,-438.34 187.79,-413.36 187.79,-394.41"/>
<polygon fill="black" stroke="black" points="191.29,-394.32 187.79,-384.32 184.29,-394.32 191.29,-394.32"/>
</g>
<!-- layers_41_78_s1 -->
<g id="node11" class="node">
<title>layers_41_78_s1</title>
<polygon fill="lightblue" stroke="black" points="241.79,-276.26 133.79,-276.26 133.79,-232.26 241.79,-232.26 241.79,-276.26"/>
<text text-anchor="middle" x="187.79" y="-263.46" font-family="Arial" font-size="11.00">Layers 41&#45;78</text>
<text text-anchor="middle" x="187.79" y="-251.46" font-family="Arial" font-size="11.00">[Repeated Pattern]</text>
<text text-anchor="middle" x="187.79" y="-239.46" font-family="Arial" font-size="11.00">GPU: 4&#45;7 (TP4)</text>
</g>
<!-- layer_40_s1&#45;&gt;layers_41_78_s1 -->
<g id="edge10" class="edge">
<title>layer_40_s1&#45;&gt;layers_41_78_s1</title>
<path fill="none" stroke="black" d="M187.79,-348.07C187.79,-331.68 187.79,-306.6 187.79,-286.65"/>
<polygon fill="black" stroke="black" points="191.29,-286.46 187.79,-276.46 184.29,-286.46 191.29,-286.46"/>
</g>
<!-- layer_79_s1 -->
<g id="node12" class="node">
<title>layer_79_s1</title>
<polygon fill="lightblue" stroke="black" points="234.29,-160.26 141.29,-160.26 141.29,-124.26 234.29,-124.26 234.29,-160.26"/>
<text text-anchor="middle" x="187.79" y="-145.46" font-family="Arial" font-size="11.00">Layer 79 (Final)</text>
<text text-anchor="middle" x="187.79" y="-133.46" font-family="Arial" font-size="11.00">GPU: 4&#45;7 (TP4)</text>
</g>
<!-- layers_41_78_s1&#45;&gt;layer_79_s1 -->
<g id="edge11" class="edge">
<title>layers_41_78_s1&#45;&gt;layer_79_s1</title>
<path fill="none" stroke="black" d="M187.79,-232.05C187.79,-214.53 187.79,-189.56 187.79,-170.56"/>
<polygon fill="black" stroke="black" points="191.29,-170.43 187.79,-160.43 184.29,-170.43 191.29,-170.43"/>
</g>
<!-- output -->
<g id="node13" class="node">
<title>output</title>
<polygon fill="lightcoral" stroke="black" points="375.38,-26.13 281.59,-52.38 94,-52.38 0.21,-26.13 94,0.13 281.59,0.13 375.38,-26.13"/>
<text text-anchor="middle" x="187.79" y="-29.33" font-family="Arial" font-size="11.00">OUTPUT</text>
<text text-anchor="middle" x="187.79" y="-17.33" font-family="Arial" font-size="11.00">[batch_size=1, seq_len=2048, hidden=8192]</text>
</g>
<!-- layer_79_s1&#45;&gt;output -->
<g id="edge12" class="edge">
<title>layer_79_s1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M187.79,-123.92C187.79,-107.67 187.79,-82.89 187.79,-62.47"/>
<polygon fill="black" stroke="black" points="191.29,-62.26 187.79,-52.26 184.29,-62.26 191.29,-62.26"/>
</g>
</g>
</svg>
