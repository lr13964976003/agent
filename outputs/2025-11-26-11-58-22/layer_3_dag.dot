// Layer 3
digraph {
	rankdir=TB size="50,100"
	input [label="Input\nbatch_size=32, seq_len=2048, hidden_size=7168\nGPU: 3712"]
	ln1 [label="LayerNorm\nGPU: 3712"]
	qkv [label="QKV Projection\nGPU: 3712"]
	attn [label="MHA Attention\nGPU: 3712"]
	out [label="Output Projection\nGPU: 3712"]
	res1 [label="Residual Add\nGPU: 3712"]
	gate [label="Expert Gate\nGPU: 3712" shape=parallelogram]
	route [label="Expert Router\nGPU: All" shape=ellipse]
	expert0 [label="Expert 0\nGPU: 0"]
	expert1 [label="Expert 1\nGPU: 1"]
	expert2 [label="Expert 2\nGPU: 2"]
	expert3 [label="Expert 3\nGPU: 3"]
	expert4 [label="Expert 4\nGPU: 4"]
	expert5 [label="Expert 5\nGPU: 5"]
	expert6 [label="Expert 6\nGPU: 6"]
	expert7 [label="Expert 7\nGPU: 7"]
	expert8 [label="Expert 8\nGPU: 8"]
	expert9 [label="Expert 9\nGPU: 9"]
	expert10 [label="Expert 10\nGPU: 10"]
	expert11 [label="Expert 11\nGPU: 11"]
	expert12 [label="Expert 12\nGPU: 12"]
	expert13 [label="Expert 13\nGPU: 13"]
	expert14 [label="Expert 14\nGPU: 14"]
	expert15 [label="Expert 15\nGPU: 15"]
	expert16 [label="Expert 16\nGPU: 16"]
	expert17 [label="Expert 17\nGPU: 17"]
	expert18 [label="Expert 18\nGPU: 18"]
	expert19 [label="Expert 19\nGPU: 19"]
	expert20 [label="Expert 20\nGPU: 20"]
	expert21 [label="Expert 21\nGPU: 21"]
	expert22 [label="Expert 22\nGPU: 22"]
	expert23 [label="Expert 23\nGPU: 23"]
	expert24 [label="Expert 24\nGPU: 24"]
	expert25 [label="Expert 25\nGPU: 25"]
	expert26 [label="Expert 26\nGPU: 26"]
	expert27 [label="Expert 27\nGPU: 27"]
	expert28 [label="Expert 28\nGPU: 28"]
	expert29 [label="Expert 29\nGPU: 29"]
	expert30 [label="Expert 30\nGPU: 30"]
	expert31 [label="Expert 31\nGPU: 31"]
	expert32 [label="Expert 32\nGPU: 32"]
	expert33 [label="Expert 33\nGPU: 33"]
	expert34 [label="Expert 34\nGPU: 34"]
	expert35 [label="Expert 35\nGPU: 35"]
	expert36 [label="Expert 36\nGPU: 36"]
	expert37 [label="Expert 37\nGPU: 37"]
	expert38 [label="Expert 38\nGPU: 38"]
	expert39 [label="Expert 39\nGPU: 39"]
	expert40 [label="Expert 40\nGPU: 40"]
	expert41 [label="Expert 41\nGPU: 41"]
	expert42 [label="Expert 42\nGPU: 42"]
	expert43 [label="Expert 43\nGPU: 43"]
	expert44 [label="Expert 44\nGPU: 44"]
	expert45 [label="Expert 45\nGPU: 45"]
	expert46 [label="Expert 46\nGPU: 46"]
	expert47 [label="Expert 47\nGPU: 47"]
	expert48 [label="Expert 48\nGPU: 48"]
	expert49 [label="Expert 49\nGPU: 49"]
	expert50 [label="Expert 50\nGPU: 50"]
	expert51 [label="Expert 51\nGPU: 51"]
	expert52 [label="Expert 52\nGPU: 52"]
	expert53 [label="Expert 53\nGPU: 53"]
	expert54 [label="Expert 54\nGPU: 54"]
	expert55 [label="Expert 55\nGPU: 55"]
	expert56 [label="Expert 56\nGPU: 56"]
	expert57 [label="Expert 57\nGPU: 57"]
	expert58 [label="Expert 58\nGPU: 58"]
	expert59 [label="Expert 59\nGPU: 59"]
	expert60 [label="Expert 60\nGPU: 60"]
	expert61 [label="Expert 61\nGPU: 61"]
	expert62 [label="Expert 62\nGPU: 62"]
	expert63 [label="Expert 63\nGPU: 63"]
	agg [label="Expert Aggregation\nGPU: 3712" shape=parallelogram]
	final [label="Final Residual Add\nGPU: 3712"]
	input -> ln1
	ln1 -> qkv
	qkv -> attn
	attn -> out
	out -> res1
	input -> res1
	res1 -> gate
	gate -> route [style=dashed]
	res1 -> route
	route -> expert0
	expert0 -> agg
	route -> expert1
	expert1 -> agg
	route -> expert2
	expert2 -> agg
	route -> expert3
	expert3 -> agg
	route -> expert4
	expert4 -> agg
	route -> expert5
	expert5 -> agg
	route -> expert6
	expert6 -> agg
	route -> expert7
	expert7 -> agg
	route -> expert8
	expert8 -> agg
	route -> expert9
	expert9 -> agg
	route -> expert10
	expert10 -> agg
	route -> expert11
	expert11 -> agg
	route -> expert12
	expert12 -> agg
	route -> expert13
	expert13 -> agg
	route -> expert14
	expert14 -> agg
	route -> expert15
	expert15 -> agg
	route -> expert16
	expert16 -> agg
	route -> expert17
	expert17 -> agg
	route -> expert18
	expert18 -> agg
	route -> expert19
	expert19 -> agg
	route -> expert20
	expert20 -> agg
	route -> expert21
	expert21 -> agg
	route -> expert22
	expert22 -> agg
	route -> expert23
	expert23 -> agg
	route -> expert24
	expert24 -> agg
	route -> expert25
	expert25 -> agg
	route -> expert26
	expert26 -> agg
	route -> expert27
	expert27 -> agg
	route -> expert28
	expert28 -> agg
	route -> expert29
	expert29 -> agg
	route -> expert30
	expert30 -> agg
	route -> expert31
	expert31 -> agg
	route -> expert32
	expert32 -> agg
	route -> expert33
	expert33 -> agg
	route -> expert34
	expert34 -> agg
	route -> expert35
	expert35 -> agg
	route -> expert36
	expert36 -> agg
	route -> expert37
	expert37 -> agg
	route -> expert38
	expert38 -> agg
	route -> expert39
	expert39 -> agg
	route -> expert40
	expert40 -> agg
	route -> expert41
	expert41 -> agg
	route -> expert42
	expert42 -> agg
	route -> expert43
	expert43 -> agg
	route -> expert44
	expert44 -> agg
	route -> expert45
	expert45 -> agg
	route -> expert46
	expert46 -> agg
	route -> expert47
	expert47 -> agg
	route -> expert48
	expert48 -> agg
	route -> expert49
	expert49 -> agg
	route -> expert50
	expert50 -> agg
	route -> expert51
	expert51 -> agg
	route -> expert52
	expert52 -> agg
	route -> expert53
	expert53 -> agg
	route -> expert54
	expert54 -> agg
	route -> expert55
	expert55 -> agg
	route -> expert56
	expert56 -> agg
	route -> expert57
	expert57 -> agg
	route -> expert58
	expert58 -> agg
	route -> expert59
	expert59 -> agg
	route -> expert60
	expert60 -> agg
	route -> expert61
	expert61 -> agg
	route -> expert62
	expert62 -> agg
	route -> expert63
	expert63 -> agg
	agg -> final
	res1 -> final
}
