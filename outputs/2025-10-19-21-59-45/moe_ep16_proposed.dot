digraph MoE_EP16_Proposed {
	node [shape=rectangle]
	bgcolor=white rankdir=TB
	input [label="Input
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightgreen shape=ellipse style=filled]
	layer_1_input [label="Layer 1 Input
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightgreen shape=ellipse style=filled]
	layer_1_mha_norm [label="MHA LayerNorm 1
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightcoral style=filled]
	layer_1_mha_q [label="MHA Q Proj 1
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_1_mha_k [label="MHA K Proj 1
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_1_mha_v [label="MHA V Proj 1
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_1_mha_attn [label="MHA 1
[batch=1024, seq=10000, heads=16, dim=512]
GPU: all" fillcolor=lightgreen style=filled]
	layer_1_mha_o [label="MHA O Proj 1
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_1_mha_res [label="MHA Residual 1
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightyellow style=filled]
	layer_1_exp_norm [label="Expert Norm 1
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightcoral style=filled]
	layer_1_global_gate [label="Global Gate 1
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=yellow shape=diamond style=filled]
	layer_1_token_dist [label="Token Distribution 1
[batch=1024, seq=10000, hidden=8192]
GPU: all to 0-15" fillcolor=orange shape=parallelogram style=filled]
	layer_1_expert0_recv [label="Expert 0 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert0_gate [label="Expert 0 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert0 [label="Expert 0
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightpink style=filled]
	layer_1_expert0_send [label="Expert 0 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert0_recv
	layer_1_expert0_recv -> layer_1_expert0_gate
	layer_1_expert0_gate -> layer_1_expert0 [style=dashed]
	layer_1_expert0 -> layer_1_expert0_send
	layer_1_expert1_recv [label="Expert 1 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert1_gate [label="Expert 1 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert1 [label="Expert 1
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightpink style=filled]
	layer_1_expert1_send [label="Expert 1 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert1_recv
	layer_1_expert1_recv -> layer_1_expert1_gate
	layer_1_expert1_gate -> layer_1_expert1 [style=dashed]
	layer_1_expert1 -> layer_1_expert1_send
	layer_1_expert2_recv [label="Expert 2 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert2_gate [label="Expert 2 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert2 [label="Expert 2
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightpink style=filled]
	layer_1_expert2_send [label="Expert 2 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert2_recv
	layer_1_expert2_recv -> layer_1_expert2_gate
	layer_1_expert2_gate -> layer_1_expert2 [style=dashed]
	layer_1_expert2 -> layer_1_expert2_send
	layer_1_expert3_recv [label="Expert 3 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert3_gate [label="Expert 3 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert3 [label="Expert 3
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightpink style=filled]
	layer_1_expert3_send [label="Expert 3 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert3_recv
	layer_1_expert3_recv -> layer_1_expert3_gate
	layer_1_expert3_gate -> layer_1_expert3 [style=dashed]
	layer_1_expert3 -> layer_1_expert3_send
	layer_1_expert4_recv [label="Expert 4 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert4_gate [label="Expert 4 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert4 [label="Expert 4
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightpink style=filled]
	layer_1_expert4_send [label="Expert 4 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert4_recv
	layer_1_expert4_recv -> layer_1_expert4_gate
	layer_1_expert4_gate -> layer_1_expert4 [style=dashed]
	layer_1_expert4 -> layer_1_expert4_send
	layer_1_expert5_recv [label="Expert 5 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert5_gate [label="Expert 5 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert5 [label="Expert 5
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightpink style=filled]
	layer_1_expert5_send [label="Expert 5 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert5_recv
	layer_1_expert5_recv -> layer_1_expert5_gate
	layer_1_expert5_gate -> layer_1_expert5 [style=dashed]
	layer_1_expert5 -> layer_1_expert5_send
	layer_1_expert6_recv [label="Expert 6 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert6_gate [label="Expert 6 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert6 [label="Expert 6
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightpink style=filled]
	layer_1_expert6_send [label="Expert 6 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert6_recv
	layer_1_expert6_recv -> layer_1_expert6_gate
	layer_1_expert6_gate -> layer_1_expert6 [style=dashed]
	layer_1_expert6 -> layer_1_expert6_send
	layer_1_expert7_recv [label="Expert 7 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert7_gate [label="Expert 7 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert7 [label="Expert 7
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightpink style=filled]
	layer_1_expert7_send [label="Expert 7 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert7_recv
	layer_1_expert7_recv -> layer_1_expert7_gate
	layer_1_expert7_gate -> layer_1_expert7 [style=dashed]
	layer_1_expert7 -> layer_1_expert7_send
	layer_1_expert8_recv [label="Expert 8 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert8_gate [label="Expert 8 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert8 [label="Expert 8
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightpink style=filled]
	layer_1_expert8_send [label="Expert 8 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert8_recv
	layer_1_expert8_recv -> layer_1_expert8_gate
	layer_1_expert8_gate -> layer_1_expert8 [style=dashed]
	layer_1_expert8 -> layer_1_expert8_send
	layer_1_expert9_recv [label="Expert 9 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert9_gate [label="Expert 9 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert9 [label="Expert 9
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightpink style=filled]
	layer_1_expert9_send [label="Expert 9 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert9_recv
	layer_1_expert9_recv -> layer_1_expert9_gate
	layer_1_expert9_gate -> layer_1_expert9 [style=dashed]
	layer_1_expert9 -> layer_1_expert9_send
	layer_1_expert10_recv [label="Expert 10 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert10_gate [label="Expert 10 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert10 [label="Expert 10
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightpink style=filled]
	layer_1_expert10_send [label="Expert 10 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert10_recv
	layer_1_expert10_recv -> layer_1_expert10_gate
	layer_1_expert10_gate -> layer_1_expert10 [style=dashed]
	layer_1_expert10 -> layer_1_expert10_send
	layer_1_expert11_recv [label="Expert 11 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert11_gate [label="Expert 11 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert11 [label="Expert 11
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightpink style=filled]
	layer_1_expert11_send [label="Expert 11 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert11_recv
	layer_1_expert11_recv -> layer_1_expert11_gate
	layer_1_expert11_gate -> layer_1_expert11 [style=dashed]
	layer_1_expert11 -> layer_1_expert11_send
	layer_1_expert12_recv [label="Expert 12 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert12_gate [label="Expert 12 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert12 [label="Expert 12
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightpink style=filled]
	layer_1_expert12_send [label="Expert 12 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert12_recv
	layer_1_expert12_recv -> layer_1_expert12_gate
	layer_1_expert12_gate -> layer_1_expert12 [style=dashed]
	layer_1_expert12 -> layer_1_expert12_send
	layer_1_expert13_recv [label="Expert 13 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert13_gate [label="Expert 13 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert13 [label="Expert 13
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightpink style=filled]
	layer_1_expert13_send [label="Expert 13 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert13_recv
	layer_1_expert13_recv -> layer_1_expert13_gate
	layer_1_expert13_gate -> layer_1_expert13 [style=dashed]
	layer_1_expert13 -> layer_1_expert13_send
	layer_1_expert14_recv [label="Expert 14 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert14_gate [label="Expert 14 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert14 [label="Expert 14
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightpink style=filled]
	layer_1_expert14_send [label="Expert 14 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert14_recv
	layer_1_expert14_recv -> layer_1_expert14_gate
	layer_1_expert14_gate -> layer_1_expert14 [style=dashed]
	layer_1_expert14 -> layer_1_expert14_send
	layer_1_expert15_recv [label="Expert 15 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_expert15_gate [label="Expert 15 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=yellow shape=diamond style=filled]
	layer_1_expert15 [label="Expert 15
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightpink style=filled]
	layer_1_expert15_send [label="Expert 15 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_1_token_dist -> layer_1_expert15_recv
	layer_1_expert15_recv -> layer_1_expert15_gate
	layer_1_expert15_gate -> layer_1_expert15 [style=dashed]
	layer_1_expert15 -> layer_1_expert15_send
	layer_1_exp_agg [label="Expert Aggregation 1
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=orange shape=parallelogram style=filled]
	layer_1_exp_res [label="Expert Residual 1
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightyellow style=filled]
	layer_1_output [label="Layer 1 Output
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightgreen shape=ellipse style=filled]
	input -> layer_1_input
	layer_1_input -> layer_1_mha_norm
	layer_1_mha_norm -> layer_1_mha_q
	layer_1_mha_norm -> layer_1_mha_k
	layer_1_mha_norm -> layer_1_mha_v
	layer_1_mha_q -> layer_1_mha_attn
	layer_1_mha_k -> layer_1_mha_attn
	layer_1_mha_v -> layer_1_mha_attn
	layer_1_mha_attn -> layer_1_mha_o
	layer_1_mha_o -> layer_1_mha_res
	layer_1_input -> layer_1_mha_res
	layer_1_mha_res -> layer_1_exp_norm
	layer_1_exp_norm -> layer_1_global_gate
	layer_1_global_gate -> layer_1_token_dist
	layer_1_exp_norm -> layer_1_token_dist
	layer_1_expert0_send -> layer_1_exp_agg
	layer_1_expert1_send -> layer_1_exp_agg
	layer_1_expert2_send -> layer_1_exp_agg
	layer_1_expert3_send -> layer_1_exp_agg
	layer_1_expert4_send -> layer_1_exp_agg
	layer_1_expert5_send -> layer_1_exp_agg
	layer_1_expert6_send -> layer_1_exp_agg
	layer_1_expert7_send -> layer_1_exp_agg
	layer_1_expert8_send -> layer_1_exp_agg
	layer_1_expert9_send -> layer_1_exp_agg
	layer_1_expert10_send -> layer_1_exp_agg
	layer_1_expert11_send -> layer_1_exp_agg
	layer_1_expert12_send -> layer_1_exp_agg
	layer_1_expert13_send -> layer_1_exp_agg
	layer_1_expert14_send -> layer_1_exp_agg
	layer_1_expert15_send -> layer_1_exp_agg
	layer_1_exp_agg -> layer_1_exp_res
	layer_1_mha_res -> layer_1_exp_res
	layer_1_exp_res -> layer_1_output
	layer_2_input [label="Layer 2 Input
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightgreen shape=ellipse style=filled]
	layer_2_mha_norm [label="MHA LayerNorm 2
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightcoral style=filled]
	layer_2_mha_q [label="MHA Q Proj 2
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_2_mha_k [label="MHA K Proj 2
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_2_mha_v [label="MHA V Proj 2
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_2_mha_attn [label="MHA 2
[batch=1024, seq=10000, heads=16, dim=512]
GPU: all" fillcolor=lightgreen style=filled]
	layer_2_mha_o [label="MHA O Proj 2
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_2_mha_res [label="MHA Residual 2
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightyellow style=filled]
	layer_2_exp_norm [label="Expert Norm 2
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightcoral style=filled]
	layer_2_global_gate [label="Global Gate 2
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=yellow shape=diamond style=filled]
	layer_2_token_dist [label="Token Distribution 2
[batch=1024, seq=10000, hidden=8192]
GPU: all to 0-15" fillcolor=orange shape=parallelogram style=filled]
	layer_2_expert0_recv [label="Expert 0 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert0_gate [label="Expert 0 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert0 [label="Expert 0
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightpink style=filled]
	layer_2_expert0_send [label="Expert 0 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert0_recv
	layer_2_expert0_recv -> layer_2_expert0_gate
	layer_2_expert0_gate -> layer_2_expert0 [style=dashed]
	layer_2_expert0 -> layer_2_expert0_send
	layer_2_expert1_recv [label="Expert 1 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert1_gate [label="Expert 1 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert1 [label="Expert 1
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightpink style=filled]
	layer_2_expert1_send [label="Expert 1 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert1_recv
	layer_2_expert1_recv -> layer_2_expert1_gate
	layer_2_expert1_gate -> layer_2_expert1 [style=dashed]
	layer_2_expert1 -> layer_2_expert1_send
	layer_2_expert2_recv [label="Expert 2 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert2_gate [label="Expert 2 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert2 [label="Expert 2
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightpink style=filled]
	layer_2_expert2_send [label="Expert 2 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert2_recv
	layer_2_expert2_recv -> layer_2_expert2_gate
	layer_2_expert2_gate -> layer_2_expert2 [style=dashed]
	layer_2_expert2 -> layer_2_expert2_send
	layer_2_expert3_recv [label="Expert 3 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert3_gate [label="Expert 3 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert3 [label="Expert 3
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightpink style=filled]
	layer_2_expert3_send [label="Expert 3 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert3_recv
	layer_2_expert3_recv -> layer_2_expert3_gate
	layer_2_expert3_gate -> layer_2_expert3 [style=dashed]
	layer_2_expert3 -> layer_2_expert3_send
	layer_2_expert4_recv [label="Expert 4 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert4_gate [label="Expert 4 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert4 [label="Expert 4
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightpink style=filled]
	layer_2_expert4_send [label="Expert 4 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert4_recv
	layer_2_expert4_recv -> layer_2_expert4_gate
	layer_2_expert4_gate -> layer_2_expert4 [style=dashed]
	layer_2_expert4 -> layer_2_expert4_send
	layer_2_expert5_recv [label="Expert 5 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert5_gate [label="Expert 5 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert5 [label="Expert 5
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightpink style=filled]
	layer_2_expert5_send [label="Expert 5 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert5_recv
	layer_2_expert5_recv -> layer_2_expert5_gate
	layer_2_expert5_gate -> layer_2_expert5 [style=dashed]
	layer_2_expert5 -> layer_2_expert5_send
	layer_2_expert6_recv [label="Expert 6 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert6_gate [label="Expert 6 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert6 [label="Expert 6
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightpink style=filled]
	layer_2_expert6_send [label="Expert 6 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert6_recv
	layer_2_expert6_recv -> layer_2_expert6_gate
	layer_2_expert6_gate -> layer_2_expert6 [style=dashed]
	layer_2_expert6 -> layer_2_expert6_send
	layer_2_expert7_recv [label="Expert 7 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert7_gate [label="Expert 7 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert7 [label="Expert 7
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightpink style=filled]
	layer_2_expert7_send [label="Expert 7 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert7_recv
	layer_2_expert7_recv -> layer_2_expert7_gate
	layer_2_expert7_gate -> layer_2_expert7 [style=dashed]
	layer_2_expert7 -> layer_2_expert7_send
	layer_2_expert8_recv [label="Expert 8 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert8_gate [label="Expert 8 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert8 [label="Expert 8
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightpink style=filled]
	layer_2_expert8_send [label="Expert 8 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert8_recv
	layer_2_expert8_recv -> layer_2_expert8_gate
	layer_2_expert8_gate -> layer_2_expert8 [style=dashed]
	layer_2_expert8 -> layer_2_expert8_send
	layer_2_expert9_recv [label="Expert 9 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert9_gate [label="Expert 9 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert9 [label="Expert 9
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightpink style=filled]
	layer_2_expert9_send [label="Expert 9 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert9_recv
	layer_2_expert9_recv -> layer_2_expert9_gate
	layer_2_expert9_gate -> layer_2_expert9 [style=dashed]
	layer_2_expert9 -> layer_2_expert9_send
	layer_2_expert10_recv [label="Expert 10 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert10_gate [label="Expert 10 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert10 [label="Expert 10
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightpink style=filled]
	layer_2_expert10_send [label="Expert 10 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert10_recv
	layer_2_expert10_recv -> layer_2_expert10_gate
	layer_2_expert10_gate -> layer_2_expert10 [style=dashed]
	layer_2_expert10 -> layer_2_expert10_send
	layer_2_expert11_recv [label="Expert 11 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert11_gate [label="Expert 11 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert11 [label="Expert 11
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightpink style=filled]
	layer_2_expert11_send [label="Expert 11 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert11_recv
	layer_2_expert11_recv -> layer_2_expert11_gate
	layer_2_expert11_gate -> layer_2_expert11 [style=dashed]
	layer_2_expert11 -> layer_2_expert11_send
	layer_2_expert12_recv [label="Expert 12 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert12_gate [label="Expert 12 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert12 [label="Expert 12
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightpink style=filled]
	layer_2_expert12_send [label="Expert 12 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert12_recv
	layer_2_expert12_recv -> layer_2_expert12_gate
	layer_2_expert12_gate -> layer_2_expert12 [style=dashed]
	layer_2_expert12 -> layer_2_expert12_send
	layer_2_expert13_recv [label="Expert 13 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert13_gate [label="Expert 13 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert13 [label="Expert 13
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightpink style=filled]
	layer_2_expert13_send [label="Expert 13 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert13_recv
	layer_2_expert13_recv -> layer_2_expert13_gate
	layer_2_expert13_gate -> layer_2_expert13 [style=dashed]
	layer_2_expert13 -> layer_2_expert13_send
	layer_2_expert14_recv [label="Expert 14 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert14_gate [label="Expert 14 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert14 [label="Expert 14
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightpink style=filled]
	layer_2_expert14_send [label="Expert 14 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert14_recv
	layer_2_expert14_recv -> layer_2_expert14_gate
	layer_2_expert14_gate -> layer_2_expert14 [style=dashed]
	layer_2_expert14 -> layer_2_expert14_send
	layer_2_expert15_recv [label="Expert 15 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_expert15_gate [label="Expert 15 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=yellow shape=diamond style=filled]
	layer_2_expert15 [label="Expert 15
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightpink style=filled]
	layer_2_expert15_send [label="Expert 15 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_2_token_dist -> layer_2_expert15_recv
	layer_2_expert15_recv -> layer_2_expert15_gate
	layer_2_expert15_gate -> layer_2_expert15 [style=dashed]
	layer_2_expert15 -> layer_2_expert15_send
	layer_2_exp_agg [label="Expert Aggregation 2
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=orange shape=parallelogram style=filled]
	layer_2_exp_res [label="Expert Residual 2
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightyellow style=filled]
	layer_2_output [label="Layer 2 Output
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightgreen shape=ellipse style=filled]
	layer_1_output -> layer_2_input
	layer_2_input -> layer_2_mha_norm
	layer_2_mha_norm -> layer_2_mha_q
	layer_2_mha_norm -> layer_2_mha_k
	layer_2_mha_norm -> layer_2_mha_v
	layer_2_mha_q -> layer_2_mha_attn
	layer_2_mha_k -> layer_2_mha_attn
	layer_2_mha_v -> layer_2_mha_attn
	layer_2_mha_attn -> layer_2_mha_o
	layer_2_mha_o -> layer_2_mha_res
	layer_2_input -> layer_2_mha_res
	layer_2_mha_res -> layer_2_exp_norm
	layer_2_exp_norm -> layer_2_global_gate
	layer_2_global_gate -> layer_2_token_dist
	layer_2_exp_norm -> layer_2_token_dist
	layer_2_expert0_send -> layer_2_exp_agg
	layer_2_expert1_send -> layer_2_exp_agg
	layer_2_expert2_send -> layer_2_exp_agg
	layer_2_expert3_send -> layer_2_exp_agg
	layer_2_expert4_send -> layer_2_exp_agg
	layer_2_expert5_send -> layer_2_exp_agg
	layer_2_expert6_send -> layer_2_exp_agg
	layer_2_expert7_send -> layer_2_exp_agg
	layer_2_expert8_send -> layer_2_exp_agg
	layer_2_expert9_send -> layer_2_exp_agg
	layer_2_expert10_send -> layer_2_exp_agg
	layer_2_expert11_send -> layer_2_exp_agg
	layer_2_expert12_send -> layer_2_exp_agg
	layer_2_expert13_send -> layer_2_exp_agg
	layer_2_expert14_send -> layer_2_exp_agg
	layer_2_expert15_send -> layer_2_exp_agg
	layer_2_exp_agg -> layer_2_exp_res
	layer_2_mha_res -> layer_2_exp_res
	layer_2_exp_res -> layer_2_output
	layer_3_input [label="Layer 3 Input
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightgreen shape=ellipse style=filled]
	layer_3_mha_norm [label="MHA LayerNorm 3
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightcoral style=filled]
	layer_3_mha_q [label="MHA Q Proj 3
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_3_mha_k [label="MHA K Proj 3
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_3_mha_v [label="MHA V Proj 3
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_3_mha_attn [label="MHA 3
[batch=1024, seq=10000, heads=16, dim=512]
GPU: all" fillcolor=lightgreen style=filled]
	layer_3_mha_o [label="MHA O Proj 3
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_3_mha_res [label="MHA Residual 3
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightyellow style=filled]
	layer_3_exp_norm [label="Expert Norm 3
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightcoral style=filled]
	layer_3_global_gate [label="Global Gate 3
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=yellow shape=diamond style=filled]
	layer_3_token_dist [label="Token Distribution 3
[batch=1024, seq=10000, hidden=8192]
GPU: all to 0-15" fillcolor=orange shape=parallelogram style=filled]
	layer_3_expert0_recv [label="Expert 0 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert0_gate [label="Expert 0 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert0 [label="Expert 0
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightpink style=filled]
	layer_3_expert0_send [label="Expert 0 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert0_recv
	layer_3_expert0_recv -> layer_3_expert0_gate
	layer_3_expert0_gate -> layer_3_expert0 [style=dashed]
	layer_3_expert0 -> layer_3_expert0_send
	layer_3_expert1_recv [label="Expert 1 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert1_gate [label="Expert 1 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert1 [label="Expert 1
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightpink style=filled]
	layer_3_expert1_send [label="Expert 1 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert1_recv
	layer_3_expert1_recv -> layer_3_expert1_gate
	layer_3_expert1_gate -> layer_3_expert1 [style=dashed]
	layer_3_expert1 -> layer_3_expert1_send
	layer_3_expert2_recv [label="Expert 2 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert2_gate [label="Expert 2 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert2 [label="Expert 2
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightpink style=filled]
	layer_3_expert2_send [label="Expert 2 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert2_recv
	layer_3_expert2_recv -> layer_3_expert2_gate
	layer_3_expert2_gate -> layer_3_expert2 [style=dashed]
	layer_3_expert2 -> layer_3_expert2_send
	layer_3_expert3_recv [label="Expert 3 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert3_gate [label="Expert 3 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert3 [label="Expert 3
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightpink style=filled]
	layer_3_expert3_send [label="Expert 3 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert3_recv
	layer_3_expert3_recv -> layer_3_expert3_gate
	layer_3_expert3_gate -> layer_3_expert3 [style=dashed]
	layer_3_expert3 -> layer_3_expert3_send
	layer_3_expert4_recv [label="Expert 4 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert4_gate [label="Expert 4 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert4 [label="Expert 4
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightpink style=filled]
	layer_3_expert4_send [label="Expert 4 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert4_recv
	layer_3_expert4_recv -> layer_3_expert4_gate
	layer_3_expert4_gate -> layer_3_expert4 [style=dashed]
	layer_3_expert4 -> layer_3_expert4_send
	layer_3_expert5_recv [label="Expert 5 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert5_gate [label="Expert 5 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert5 [label="Expert 5
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightpink style=filled]
	layer_3_expert5_send [label="Expert 5 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert5_recv
	layer_3_expert5_recv -> layer_3_expert5_gate
	layer_3_expert5_gate -> layer_3_expert5 [style=dashed]
	layer_3_expert5 -> layer_3_expert5_send
	layer_3_expert6_recv [label="Expert 6 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert6_gate [label="Expert 6 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert6 [label="Expert 6
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightpink style=filled]
	layer_3_expert6_send [label="Expert 6 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert6_recv
	layer_3_expert6_recv -> layer_3_expert6_gate
	layer_3_expert6_gate -> layer_3_expert6 [style=dashed]
	layer_3_expert6 -> layer_3_expert6_send
	layer_3_expert7_recv [label="Expert 7 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert7_gate [label="Expert 7 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert7 [label="Expert 7
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightpink style=filled]
	layer_3_expert7_send [label="Expert 7 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert7_recv
	layer_3_expert7_recv -> layer_3_expert7_gate
	layer_3_expert7_gate -> layer_3_expert7 [style=dashed]
	layer_3_expert7 -> layer_3_expert7_send
	layer_3_expert8_recv [label="Expert 8 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert8_gate [label="Expert 8 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert8 [label="Expert 8
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightpink style=filled]
	layer_3_expert8_send [label="Expert 8 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert8_recv
	layer_3_expert8_recv -> layer_3_expert8_gate
	layer_3_expert8_gate -> layer_3_expert8 [style=dashed]
	layer_3_expert8 -> layer_3_expert8_send
	layer_3_expert9_recv [label="Expert 9 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert9_gate [label="Expert 9 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert9 [label="Expert 9
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightpink style=filled]
	layer_3_expert9_send [label="Expert 9 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert9_recv
	layer_3_expert9_recv -> layer_3_expert9_gate
	layer_3_expert9_gate -> layer_3_expert9 [style=dashed]
	layer_3_expert9 -> layer_3_expert9_send
	layer_3_expert10_recv [label="Expert 10 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert10_gate [label="Expert 10 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert10 [label="Expert 10
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightpink style=filled]
	layer_3_expert10_send [label="Expert 10 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert10_recv
	layer_3_expert10_recv -> layer_3_expert10_gate
	layer_3_expert10_gate -> layer_3_expert10 [style=dashed]
	layer_3_expert10 -> layer_3_expert10_send
	layer_3_expert11_recv [label="Expert 11 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert11_gate [label="Expert 11 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert11 [label="Expert 11
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightpink style=filled]
	layer_3_expert11_send [label="Expert 11 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert11_recv
	layer_3_expert11_recv -> layer_3_expert11_gate
	layer_3_expert11_gate -> layer_3_expert11 [style=dashed]
	layer_3_expert11 -> layer_3_expert11_send
	layer_3_expert12_recv [label="Expert 12 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert12_gate [label="Expert 12 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert12 [label="Expert 12
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightpink style=filled]
	layer_3_expert12_send [label="Expert 12 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert12_recv
	layer_3_expert12_recv -> layer_3_expert12_gate
	layer_3_expert12_gate -> layer_3_expert12 [style=dashed]
	layer_3_expert12 -> layer_3_expert12_send
	layer_3_expert13_recv [label="Expert 13 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert13_gate [label="Expert 13 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert13 [label="Expert 13
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightpink style=filled]
	layer_3_expert13_send [label="Expert 13 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert13_recv
	layer_3_expert13_recv -> layer_3_expert13_gate
	layer_3_expert13_gate -> layer_3_expert13 [style=dashed]
	layer_3_expert13 -> layer_3_expert13_send
	layer_3_expert14_recv [label="Expert 14 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert14_gate [label="Expert 14 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert14 [label="Expert 14
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightpink style=filled]
	layer_3_expert14_send [label="Expert 14 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert14_recv
	layer_3_expert14_recv -> layer_3_expert14_gate
	layer_3_expert14_gate -> layer_3_expert14 [style=dashed]
	layer_3_expert14 -> layer_3_expert14_send
	layer_3_expert15_recv [label="Expert 15 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_expert15_gate [label="Expert 15 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=yellow shape=diamond style=filled]
	layer_3_expert15 [label="Expert 15
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightpink style=filled]
	layer_3_expert15_send [label="Expert 15 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_3_token_dist -> layer_3_expert15_recv
	layer_3_expert15_recv -> layer_3_expert15_gate
	layer_3_expert15_gate -> layer_3_expert15 [style=dashed]
	layer_3_expert15 -> layer_3_expert15_send
	layer_3_exp_agg [label="Expert Aggregation 3
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=orange shape=parallelogram style=filled]
	layer_3_exp_res [label="Expert Residual 3
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightyellow style=filled]
	layer_3_output [label="Layer 3 Output
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightgreen shape=ellipse style=filled]
	layer_2_output -> layer_3_input
	layer_3_input -> layer_3_mha_norm
	layer_3_mha_norm -> layer_3_mha_q
	layer_3_mha_norm -> layer_3_mha_k
	layer_3_mha_norm -> layer_3_mha_v
	layer_3_mha_q -> layer_3_mha_attn
	layer_3_mha_k -> layer_3_mha_attn
	layer_3_mha_v -> layer_3_mha_attn
	layer_3_mha_attn -> layer_3_mha_o
	layer_3_mha_o -> layer_3_mha_res
	layer_3_input -> layer_3_mha_res
	layer_3_mha_res -> layer_3_exp_norm
	layer_3_exp_norm -> layer_3_global_gate
	layer_3_global_gate -> layer_3_token_dist
	layer_3_exp_norm -> layer_3_token_dist
	layer_3_expert0_send -> layer_3_exp_agg
	layer_3_expert1_send -> layer_3_exp_agg
	layer_3_expert2_send -> layer_3_exp_agg
	layer_3_expert3_send -> layer_3_exp_agg
	layer_3_expert4_send -> layer_3_exp_agg
	layer_3_expert5_send -> layer_3_exp_agg
	layer_3_expert6_send -> layer_3_exp_agg
	layer_3_expert7_send -> layer_3_exp_agg
	layer_3_expert8_send -> layer_3_exp_agg
	layer_3_expert9_send -> layer_3_exp_agg
	layer_3_expert10_send -> layer_3_exp_agg
	layer_3_expert11_send -> layer_3_exp_agg
	layer_3_expert12_send -> layer_3_exp_agg
	layer_3_expert13_send -> layer_3_exp_agg
	layer_3_expert14_send -> layer_3_exp_agg
	layer_3_expert15_send -> layer_3_exp_agg
	layer_3_exp_agg -> layer_3_exp_res
	layer_3_mha_res -> layer_3_exp_res
	layer_3_exp_res -> layer_3_output
	layer_4_input [label="Layer 4 Input
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightgreen shape=ellipse style=filled]
	layer_4_mha_norm [label="MHA LayerNorm 4
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightcoral style=filled]
	layer_4_mha_q [label="MHA Q Proj 4
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_4_mha_k [label="MHA K Proj 4
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_4_mha_v [label="MHA V Proj 4
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_4_mha_attn [label="MHA 4
[batch=1024, seq=10000, heads=16, dim=512]
GPU: all" fillcolor=lightgreen style=filled]
	layer_4_mha_o [label="MHA O Proj 4
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightblue style=filled]
	layer_4_mha_res [label="MHA Residual 4
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightyellow style=filled]
	layer_4_exp_norm [label="Expert Norm 4
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightcoral style=filled]
	layer_4_global_gate [label="Global Gate 4
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=yellow shape=diamond style=filled]
	layer_4_token_dist [label="Token Distribution 4
[batch=1024, seq=10000, hidden=8192]
GPU: all to 0-15" fillcolor=orange shape=parallelogram style=filled]
	layer_4_expert0_recv [label="Expert 0 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert0_gate [label="Expert 0 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert0 [label="Expert 0
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightpink style=filled]
	layer_4_expert0_send [label="Expert 0 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 0" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert0_recv
	layer_4_expert0_recv -> layer_4_expert0_gate
	layer_4_expert0_gate -> layer_4_expert0 [style=dashed]
	layer_4_expert0 -> layer_4_expert0_send
	layer_4_expert1_recv [label="Expert 1 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert1_gate [label="Expert 1 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert1 [label="Expert 1
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightpink style=filled]
	layer_4_expert1_send [label="Expert 1 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 1" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert1_recv
	layer_4_expert1_recv -> layer_4_expert1_gate
	layer_4_expert1_gate -> layer_4_expert1 [style=dashed]
	layer_4_expert1 -> layer_4_expert1_send
	layer_4_expert2_recv [label="Expert 2 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert2_gate [label="Expert 2 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert2 [label="Expert 2
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightpink style=filled]
	layer_4_expert2_send [label="Expert 2 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 2" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert2_recv
	layer_4_expert2_recv -> layer_4_expert2_gate
	layer_4_expert2_gate -> layer_4_expert2 [style=dashed]
	layer_4_expert2 -> layer_4_expert2_send
	layer_4_expert3_recv [label="Expert 3 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert3_gate [label="Expert 3 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert3 [label="Expert 3
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightpink style=filled]
	layer_4_expert3_send [label="Expert 3 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 3" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert3_recv
	layer_4_expert3_recv -> layer_4_expert3_gate
	layer_4_expert3_gate -> layer_4_expert3 [style=dashed]
	layer_4_expert3 -> layer_4_expert3_send
	layer_4_expert4_recv [label="Expert 4 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert4_gate [label="Expert 4 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert4 [label="Expert 4
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightpink style=filled]
	layer_4_expert4_send [label="Expert 4 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 4" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert4_recv
	layer_4_expert4_recv -> layer_4_expert4_gate
	layer_4_expert4_gate -> layer_4_expert4 [style=dashed]
	layer_4_expert4 -> layer_4_expert4_send
	layer_4_expert5_recv [label="Expert 5 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert5_gate [label="Expert 5 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert5 [label="Expert 5
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightpink style=filled]
	layer_4_expert5_send [label="Expert 5 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 5" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert5_recv
	layer_4_expert5_recv -> layer_4_expert5_gate
	layer_4_expert5_gate -> layer_4_expert5 [style=dashed]
	layer_4_expert5 -> layer_4_expert5_send
	layer_4_expert6_recv [label="Expert 6 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert6_gate [label="Expert 6 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert6 [label="Expert 6
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightpink style=filled]
	layer_4_expert6_send [label="Expert 6 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 6" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert6_recv
	layer_4_expert6_recv -> layer_4_expert6_gate
	layer_4_expert6_gate -> layer_4_expert6 [style=dashed]
	layer_4_expert6 -> layer_4_expert6_send
	layer_4_expert7_recv [label="Expert 7 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert7_gate [label="Expert 7 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert7 [label="Expert 7
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightpink style=filled]
	layer_4_expert7_send [label="Expert 7 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 7" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert7_recv
	layer_4_expert7_recv -> layer_4_expert7_gate
	layer_4_expert7_gate -> layer_4_expert7 [style=dashed]
	layer_4_expert7 -> layer_4_expert7_send
	layer_4_expert8_recv [label="Expert 8 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert8_gate [label="Expert 8 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert8 [label="Expert 8
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightpink style=filled]
	layer_4_expert8_send [label="Expert 8 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 8" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert8_recv
	layer_4_expert8_recv -> layer_4_expert8_gate
	layer_4_expert8_gate -> layer_4_expert8 [style=dashed]
	layer_4_expert8 -> layer_4_expert8_send
	layer_4_expert9_recv [label="Expert 9 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert9_gate [label="Expert 9 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert9 [label="Expert 9
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightpink style=filled]
	layer_4_expert9_send [label="Expert 9 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 9" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert9_recv
	layer_4_expert9_recv -> layer_4_expert9_gate
	layer_4_expert9_gate -> layer_4_expert9 [style=dashed]
	layer_4_expert9 -> layer_4_expert9_send
	layer_4_expert10_recv [label="Expert 10 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert10_gate [label="Expert 10 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert10 [label="Expert 10
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightpink style=filled]
	layer_4_expert10_send [label="Expert 10 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 10" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert10_recv
	layer_4_expert10_recv -> layer_4_expert10_gate
	layer_4_expert10_gate -> layer_4_expert10 [style=dashed]
	layer_4_expert10 -> layer_4_expert10_send
	layer_4_expert11_recv [label="Expert 11 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert11_gate [label="Expert 11 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert11 [label="Expert 11
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightpink style=filled]
	layer_4_expert11_send [label="Expert 11 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 11" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert11_recv
	layer_4_expert11_recv -> layer_4_expert11_gate
	layer_4_expert11_gate -> layer_4_expert11 [style=dashed]
	layer_4_expert11 -> layer_4_expert11_send
	layer_4_expert12_recv [label="Expert 12 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert12_gate [label="Expert 12 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert12 [label="Expert 12
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightpink style=filled]
	layer_4_expert12_send [label="Expert 12 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 12" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert12_recv
	layer_4_expert12_recv -> layer_4_expert12_gate
	layer_4_expert12_gate -> layer_4_expert12 [style=dashed]
	layer_4_expert12 -> layer_4_expert12_send
	layer_4_expert13_recv [label="Expert 13 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert13_gate [label="Expert 13 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert13 [label="Expert 13
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightpink style=filled]
	layer_4_expert13_send [label="Expert 13 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 13" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert13_recv
	layer_4_expert13_recv -> layer_4_expert13_gate
	layer_4_expert13_gate -> layer_4_expert13 [style=dashed]
	layer_4_expert13 -> layer_4_expert13_send
	layer_4_expert14_recv [label="Expert 14 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert14_gate [label="Expert 14 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert14 [label="Expert 14
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightpink style=filled]
	layer_4_expert14_send [label="Expert 14 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 14" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert14_recv
	layer_4_expert14_recv -> layer_4_expert14_gate
	layer_4_expert14_gate -> layer_4_expert14 [style=dashed]
	layer_4_expert14 -> layer_4_expert14_send
	layer_4_expert15_recv [label="Expert 15 Recv
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_expert15_gate [label="Expert 15 Gate
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=yellow shape=diamond style=filled]
	layer_4_expert15 [label="Expert 15
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightpink style=filled]
	layer_4_expert15_send [label="Expert 15 Send
[batch=variable, seq=variable, hidden=8192]
GPU: 15" fillcolor=lightgreen shape=parallelogram style=filled]
	layer_4_token_dist -> layer_4_expert15_recv
	layer_4_expert15_recv -> layer_4_expert15_gate
	layer_4_expert15_gate -> layer_4_expert15 [style=dashed]
	layer_4_expert15 -> layer_4_expert15_send
	layer_4_exp_agg [label="Expert Aggregation 4
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=orange shape=parallelogram style=filled]
	layer_4_exp_res [label="Expert Residual 4
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightyellow style=filled]
	layer_4_output [label="Layer 4 Output
[batch=1024, seq=10000, hidden=8192]
GPU: all" fillcolor=lightgreen shape=ellipse style=filled]
	layer_3_output -> layer_4_input
	layer_4_input -> layer_4_mha_norm
	layer_4_mha_norm -> layer_4_mha_q
	layer_4_mha_norm -> layer_4_mha_k
	layer_4_mha_norm -> layer_4_mha_v
	layer_4_mha_q -> layer_4_mha_attn
	layer_4_mha_k -> layer_4_mha_attn
	layer_4_mha_v -> layer_4_mha_attn
	layer_4_mha_attn -> layer_4_mha_o
	layer_4_mha_o -> layer_4_mha_res
	layer_4_input -> layer_4_mha_res
	layer_4_mha_res -> layer_4_exp_norm
	layer_4_exp_norm -> layer_4_global_gate
	layer_4_global_gate -> layer_4_token_dist
	layer_4_exp_norm -> layer_4_token_dist
	layer_4_expert0_send -> layer_4_exp_agg
	layer_4_expert1_send -> layer_4_exp_agg
	layer_4_expert2_send -> layer_4_exp_agg
	layer_4_expert3_send -> layer_4_exp_agg
	layer_4_expert4_send -> layer_4_exp_agg
	layer_4_expert5_send -> layer_4_exp_agg
	layer_4_expert6_send -> layer_4_exp_agg
	layer_4_expert7_send -> layer_4_exp_agg
	layer_4_expert8_send -> layer_4_exp_agg
	layer_4_expert9_send -> layer_4_exp_agg
	layer_4_expert10_send -> layer_4_exp_agg
	layer_4_expert11_send -> layer_4_exp_agg
	layer_4_expert12_send -> layer_4_exp_agg
	layer_4_expert13_send -> layer_4_exp_agg
	layer_4_expert14_send -> layer_4_exp_agg
	layer_4_expert15_send -> layer_4_exp_agg
	layer_4_exp_agg -> layer_4_exp_res
	layer_4_mha_res -> layer_4_exp_res
	layer_4_exp_res -> layer_4_output
	layer_4_output -> output
}
