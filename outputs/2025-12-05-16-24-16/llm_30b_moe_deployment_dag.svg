<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1335pt" height="12000pt"
 viewBox="0.00 0.00 320.44 2880.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.61 0.61) rotate(0) translate(4 19625.22)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-19625.22 2180,-19625.22 2180,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage_0</title>
<path fill="lightgray" stroke="black" d="M20,-14691.92C20,-14691.92 1875,-14691.92 1875,-14691.92 1881,-14691.92 1887,-14697.92 1887,-14703.92 1887,-14703.92 1887,-19543.23 1887,-19543.23 1887,-19549.23 1881,-19555.23 1875,-19555.23 1875,-19555.23 20,-19555.23 20,-19555.23 14,-19555.23 8,-19549.23 8,-19543.23 8,-19543.23 8,-14703.92 8,-14703.92 8,-14697.92 14,-14691.92 20,-14691.92"/>
<text text-anchor="middle" x="947.5" y="-19540.03" font-family="Arial Bold" font-size="14.00">Pipeline Stage 0 (GPUs 0&#45;1)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer_0</title>
<path fill="white" stroke="black" d="M28,-18324.16C28,-18324.16 1867,-18324.16 1867,-18324.16 1873,-18324.16 1879,-18330.16 1879,-18336.16 1879,-18336.16 1879,-19512.23 1879,-19512.23 1879,-19518.23 1873,-19524.23 1867,-19524.23 1867,-19524.23 28,-19524.23 28,-19524.23 22,-19524.23 16,-19518.23 16,-19512.23 16,-19512.23 16,-18336.16 16,-18336.16 16,-18330.16 22,-18324.16 28,-18324.16"/>
<text text-anchor="middle" x="947.5" y="-19509.03" font-family="Arial Bold" font-size="14.00">Layer 0</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer_1</title>
<path fill="white" stroke="black" d="M28,-17116.08C28,-17116.08 1867,-17116.08 1867,-17116.08 1873,-17116.08 1879,-17122.08 1879,-17128.08 1879,-17128.08 1879,-18304.16 1879,-18304.16 1879,-18310.16 1873,-18316.16 1867,-18316.16 1867,-18316.16 28,-18316.16 28,-18316.16 22,-18316.16 16,-18310.16 16,-18304.16 16,-18304.16 16,-17128.08 16,-17128.08 16,-17122.08 22,-17116.08 28,-17116.08"/>
<text text-anchor="middle" x="947.5" y="-18300.96" font-family="Arial Bold" font-size="14.00">Layer 1</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_layer_2</title>
<path fill="white" stroke="black" d="M28,-15908C28,-15908 1867,-15908 1867,-15908 1873,-15908 1879,-15914 1879,-15920 1879,-15920 1879,-17096.08 1879,-17096.08 1879,-17102.08 1873,-17108.08 1867,-17108.08 1867,-17108.08 28,-17108.08 28,-17108.08 22,-17108.08 16,-17102.08 16,-17096.08 16,-17096.08 16,-15920 16,-15920 16,-15914 22,-15908 28,-15908"/>
<text text-anchor="middle" x="947.5" y="-17092.88" font-family="Arial Bold" font-size="14.00">Layer 2</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_layer_3</title>
<path fill="white" stroke="black" d="M28,-14699.92C28,-14699.92 1867,-14699.92 1867,-14699.92 1873,-14699.92 1879,-14705.92 1879,-14711.92 1879,-14711.92 1879,-15888 1879,-15888 1879,-15894 1873,-15900 1867,-15900 1867,-15900 28,-15900 28,-15900 22,-15900 16,-15894 16,-15888 16,-15888 16,-14711.92 16,-14711.92 16,-14705.92 22,-14699.92 28,-14699.92"/>
<text text-anchor="middle" x="947.5" y="-15884.8" font-family="Arial Bold" font-size="14.00">Layer 3</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_stage_1</title>
<path fill="lightgray" stroke="black" d="M28,-9820.61C28,-9820.61 1883,-9820.61 1883,-9820.61 1889,-9820.61 1895,-9826.61 1895,-9832.61 1895,-9832.61 1895,-14671.92 1895,-14671.92 1895,-14677.92 1889,-14683.92 1883,-14683.92 1883,-14683.92 28,-14683.92 28,-14683.92 22,-14683.92 16,-14677.92 16,-14671.92 16,-14671.92 16,-9832.61 16,-9832.61 16,-9826.61 22,-9820.61 28,-9820.61"/>
<text text-anchor="middle" x="955.5" y="-14668.72" font-family="Arial Bold" font-size="14.00">Pipeline Stage 1 (GPUs 2&#45;3)</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_layer_4</title>
<path fill="white" stroke="black" d="M36,-13452.84C36,-13452.84 1875,-13452.84 1875,-13452.84 1881,-13452.84 1887,-13458.84 1887,-13464.84 1887,-13464.84 1887,-14640.92 1887,-14640.92 1887,-14646.92 1881,-14652.92 1875,-14652.92 1875,-14652.92 36,-14652.92 36,-14652.92 30,-14652.92 24,-14646.92 24,-14640.92 24,-14640.92 24,-13464.84 24,-13464.84 24,-13458.84 30,-13452.84 36,-13452.84"/>
<text text-anchor="middle" x="955.5" y="-14637.72" font-family="Arial Bold" font-size="14.00">Layer 4</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_layer_5</title>
<path fill="white" stroke="black" d="M36,-12244.76C36,-12244.76 1875,-12244.76 1875,-12244.76 1881,-12244.76 1887,-12250.76 1887,-12256.76 1887,-12256.76 1887,-13432.84 1887,-13432.84 1887,-13438.84 1881,-13444.84 1875,-13444.84 1875,-13444.84 36,-13444.84 36,-13444.84 30,-13444.84 24,-13438.84 24,-13432.84 24,-13432.84 24,-12256.76 24,-12256.76 24,-12250.76 30,-12244.76 36,-12244.76"/>
<text text-anchor="middle" x="955.5" y="-13429.64" font-family="Arial Bold" font-size="14.00">Layer 5</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_layer_6</title>
<path fill="white" stroke="black" d="M36,-11036.69C36,-11036.69 1875,-11036.69 1875,-11036.69 1881,-11036.69 1887,-11042.69 1887,-11048.69 1887,-11048.69 1887,-12224.76 1887,-12224.76 1887,-12230.76 1881,-12236.76 1875,-12236.76 1875,-12236.76 36,-12236.76 36,-12236.76 30,-12236.76 24,-12230.76 24,-12224.76 24,-12224.76 24,-11048.69 24,-11048.69 24,-11042.69 30,-11036.69 36,-11036.69"/>
<text text-anchor="middle" x="955.5" y="-12221.56" font-family="Arial Bold" font-size="14.00">Layer 6</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_layer_7</title>
<path fill="white" stroke="black" d="M36,-9828.61C36,-9828.61 1875,-9828.61 1875,-9828.61 1881,-9828.61 1887,-9834.61 1887,-9840.61 1887,-9840.61 1887,-11016.69 1887,-11016.69 1887,-11022.69 1881,-11028.69 1875,-11028.69 1875,-11028.69 36,-11028.69 36,-11028.69 30,-11028.69 24,-11022.69 24,-11016.69 24,-11016.69 24,-9840.61 24,-9840.61 24,-9834.61 30,-9828.61 36,-9828.61"/>
<text text-anchor="middle" x="955.5" y="-11013.49" font-family="Arial Bold" font-size="14.00">Layer 7</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_stage_2</title>
<path fill="lightgray" stroke="black" d="M185,-4949.3C185,-4949.3 2040,-4949.3 2040,-4949.3 2046,-4949.3 2052,-4955.3 2052,-4961.3 2052,-4961.3 2052,-9800.61 2052,-9800.61 2052,-9806.61 2046,-9812.61 2040,-9812.61 2040,-9812.61 185,-9812.61 185,-9812.61 179,-9812.61 173,-9806.61 173,-9800.61 173,-9800.61 173,-4961.3 173,-4961.3 173,-4955.3 179,-4949.3 185,-4949.3"/>
<text text-anchor="middle" x="1112.5" y="-9797.41" font-family="Arial Bold" font-size="14.00">Pipeline Stage 2 (GPUs 4&#45;5)</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_layer_8</title>
<path fill="white" stroke="black" d="M193,-8581.53C193,-8581.53 2032,-8581.53 2032,-8581.53 2038,-8581.53 2044,-8587.53 2044,-8593.53 2044,-8593.53 2044,-9769.61 2044,-9769.61 2044,-9775.61 2038,-9781.61 2032,-9781.61 2032,-9781.61 193,-9781.61 193,-9781.61 187,-9781.61 181,-9775.61 181,-9769.61 181,-9769.61 181,-8593.53 181,-8593.53 181,-8587.53 187,-8581.53 193,-8581.53"/>
<text text-anchor="middle" x="1112.5" y="-9766.41" font-family="Arial Bold" font-size="14.00">Layer 8</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_layer_9</title>
<path fill="white" stroke="black" d="M193,-7373.45C193,-7373.45 2032,-7373.45 2032,-7373.45 2038,-7373.45 2044,-7379.45 2044,-7385.45 2044,-7385.45 2044,-8561.53 2044,-8561.53 2044,-8567.53 2038,-8573.53 2032,-8573.53 2032,-8573.53 193,-8573.53 193,-8573.53 187,-8573.53 181,-8567.53 181,-8561.53 181,-8561.53 181,-7385.45 181,-7385.45 181,-7379.45 187,-7373.45 193,-7373.45"/>
<text text-anchor="middle" x="1112.5" y="-8558.33" font-family="Arial Bold" font-size="14.00">Layer 9</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_layer_10</title>
<path fill="white" stroke="black" d="M193,-6165.37C193,-6165.37 2032,-6165.37 2032,-6165.37 2038,-6165.37 2044,-6171.37 2044,-6177.37 2044,-6177.37 2044,-7353.45 2044,-7353.45 2044,-7359.45 2038,-7365.45 2032,-7365.45 2032,-7365.45 193,-7365.45 193,-7365.45 187,-7365.45 181,-7359.45 181,-7353.45 181,-7353.45 181,-6177.37 181,-6177.37 181,-6171.37 187,-6165.37 193,-6165.37"/>
<text text-anchor="middle" x="1112.5" y="-7350.25" font-family="Arial Bold" font-size="14.00">Layer 10</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_layer_11</title>
<path fill="white" stroke="black" d="M193,-4957.3C193,-4957.3 2032,-4957.3 2032,-4957.3 2038,-4957.3 2044,-4963.3 2044,-4969.3 2044,-4969.3 2044,-6145.37 2044,-6145.37 2044,-6151.37 2038,-6157.37 2032,-6157.37 2032,-6157.37 193,-6157.37 193,-6157.37 187,-6157.37 181,-6151.37 181,-6145.37 181,-6145.37 181,-4969.3 181,-4969.3 181,-4963.3 187,-4957.3 193,-4957.3"/>
<text text-anchor="middle" x="1112.5" y="-6142.17" font-family="Arial Bold" font-size="14.00">Layer 11</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_stage_3</title>
<path fill="lightgray" stroke="black" d="M301,-77.98C301,-77.98 2156,-77.98 2156,-77.98 2162,-77.98 2168,-83.98 2168,-89.98 2168,-89.98 2168,-4929.3 2168,-4929.3 2168,-4935.3 2162,-4941.3 2156,-4941.3 2156,-4941.3 301,-4941.3 301,-4941.3 295,-4941.3 289,-4935.3 289,-4929.3 289,-4929.3 289,-89.98 289,-89.98 289,-83.98 295,-77.98 301,-77.98"/>
<text text-anchor="middle" x="1228.5" y="-4926.1" font-family="Arial Bold" font-size="14.00">Pipeline Stage 3 (GPUs 6&#45;7)</text>
</g>
<g id="clust17" class="cluster">
<title>cluster_layer_12</title>
<path fill="white" stroke="black" d="M309,-3710.22C309,-3710.22 2148,-3710.22 2148,-3710.22 2154,-3710.22 2160,-3716.22 2160,-3722.22 2160,-3722.22 2160,-4898.3 2160,-4898.3 2160,-4904.3 2154,-4910.3 2148,-4910.3 2148,-4910.3 309,-4910.3 309,-4910.3 303,-4910.3 297,-4904.3 297,-4898.3 297,-4898.3 297,-3722.22 297,-3722.22 297,-3716.22 303,-3710.22 309,-3710.22"/>
<text text-anchor="middle" x="1228.5" y="-4895.1" font-family="Arial Bold" font-size="14.00">Layer 12</text>
</g>
<g id="clust18" class="cluster">
<title>cluster_layer_13</title>
<path fill="white" stroke="black" d="M309,-2502.14C309,-2502.14 2148,-2502.14 2148,-2502.14 2154,-2502.14 2160,-2508.14 2160,-2514.14 2160,-2514.14 2160,-3690.22 2160,-3690.22 2160,-3696.22 2154,-3702.22 2148,-3702.22 2148,-3702.22 309,-3702.22 309,-3702.22 303,-3702.22 297,-3696.22 297,-3690.22 297,-3690.22 297,-2514.14 297,-2514.14 297,-2508.14 303,-2502.14 309,-2502.14"/>
<text text-anchor="middle" x="1228.5" y="-3687.02" font-family="Arial Bold" font-size="14.00">Layer 13</text>
</g>
<g id="clust19" class="cluster">
<title>cluster_layer_14</title>
<path fill="white" stroke="black" d="M309,-1294.06C309,-1294.06 2148,-1294.06 2148,-1294.06 2154,-1294.06 2160,-1300.06 2160,-1306.06 2160,-1306.06 2160,-2482.14 2160,-2482.14 2160,-2488.14 2154,-2494.14 2148,-2494.14 2148,-2494.14 309,-2494.14 309,-2494.14 303,-2494.14 297,-2488.14 297,-2482.14 297,-2482.14 297,-1306.06 297,-1306.06 297,-1300.06 303,-1294.06 309,-1294.06"/>
<text text-anchor="middle" x="1228.5" y="-2478.94" font-family="Arial Bold" font-size="14.00">Layer 14</text>
</g>
<g id="clust20" class="cluster">
<title>cluster_layer_15</title>
<path fill="white" stroke="black" d="M309,-85.98C309,-85.98 2148,-85.98 2148,-85.98 2154,-85.98 2160,-91.98 2160,-97.98 2160,-97.98 2160,-1274.06 2160,-1274.06 2160,-1280.06 2154,-1286.06 2148,-1286.06 2148,-1286.06 309,-1286.06 309,-1286.06 303,-1286.06 297,-1280.06 297,-1274.06 297,-1274.06 297,-97.98 297,-97.98 297,-91.98 303,-85.98 309,-85.98"/>
<text text-anchor="middle" x="1228.5" y="-1270.86" font-family="Arial Bold" font-size="14.00">Layer 15</text>
</g>
<!-- input_0 -->
<g id="node1" class="node">
<title>input_0</title>
<ellipse fill="lightblue" stroke="black" cx="947" cy="-19592.23" rx="180.12" ry="28.98"/>
<text text-anchor="middle" x="947" y="-19600.73" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="947" y="-19589.73" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="947" y="-19578.73" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_0_input -->
<g id="node2" class="node">
<title>layer_0_input</title>
<polygon fill="lightyellow" stroke="black" points="1211.24,-19493.23 790.89,-19493.23 682.76,-19411.23 1103.11,-19411.23 1211.24,-19493.23"/>
<text text-anchor="middle" x="947" y="-19460.73" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="947" y="-19449.73" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="947" y="-19438.73" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- input_0&#45;&gt;layer_0_input -->
<g id="edge1" class="edge">
<title>input_0&#45;&gt;layer_0_input</title>
<path fill="none" stroke="black" d="M947,-19562.97C947,-19545.91 947,-19523.68 947,-19503.7"/>
<polygon fill="black" stroke="black" points="950.5,-19503.49 947,-19493.49 943.5,-19503.49 950.5,-19503.49"/>
</g>
<!-- layer_0_qkv_tp0 -->
<g id="node3" class="node">
<title>layer_0_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="938.5,-19375.23 663.5,-19375.23 663.5,-19323.23 938.5,-19323.23 938.5,-19375.23"/>
<text text-anchor="middle" x="801" y="-19363.23" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="801" y="-19352.23" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="801" y="-19341.23" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="801" y="-19330.23" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_0_input&#45;&gt;layer_0_qkv_tp0 -->
<g id="edge2" class="edge">
<title>layer_0_input&#45;&gt;layer_0_qkv_tp0</title>
<path fill="none" stroke="black" d="M888.88,-19411.03C874.52,-19401.09 859.36,-19390.61 845.75,-19381.19"/>
<polygon fill="black" stroke="black" points="847.72,-19378.3 837.5,-19375.49 843.73,-19384.05 847.72,-19378.3"/>
</g>
<!-- layer_0_qkv_tp1 -->
<g id="node4" class="node">
<title>layer_0_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1231.5,-19375.23 956.5,-19375.23 956.5,-19323.23 1231.5,-19323.23 1231.5,-19375.23"/>
<text text-anchor="middle" x="1094" y="-19363.23" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1094" y="-19352.23" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1094" y="-19341.23" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1094" y="-19330.23" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_0_input&#45;&gt;layer_0_qkv_tp1 -->
<g id="edge3" class="edge">
<title>layer_0_input&#45;&gt;layer_0_qkv_tp1</title>
<path fill="none" stroke="black" d="M1005.52,-19411.03C1019.98,-19401.09 1035.24,-19390.61 1048.94,-19381.19"/>
<polygon fill="black" stroke="black" points="1050.99,-19384.03 1057.25,-19375.49 1047.02,-19378.26 1050.99,-19384.03"/>
</g>
<!-- layer_0_attn_tp0 -->
<g id="node5" class="node">
<title>layer_0_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="935,-19287.23 673,-19287.23 673,-19235.23 935,-19235.23 935,-19287.23"/>
<text text-anchor="middle" x="804" y="-19275.23" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="804" y="-19264.23" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="804" y="-19253.23" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="804" y="-19242.23" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_0_qkv_tp0&#45;&gt;layer_0_attn_tp0 -->
<g id="edge4" class="edge">
<title>layer_0_qkv_tp0&#45;&gt;layer_0_attn_tp0</title>
<path fill="none" stroke="black" d="M801.88,-19322.9C802.16,-19314.94 802.47,-19306 802.77,-19297.48"/>
<polygon fill="black" stroke="black" points="806.27,-19297.51 803.12,-19287.39 799.28,-19297.26 806.27,-19297.51"/>
</g>
<!-- layer_0_attn_tp1 -->
<g id="node6" class="node">
<title>layer_0_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1221,-19287.23 959,-19287.23 959,-19235.23 1221,-19235.23 1221,-19287.23"/>
<text text-anchor="middle" x="1090" y="-19275.23" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1090" y="-19264.23" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1090" y="-19253.23" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1090" y="-19242.23" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_0_qkv_tp1&#45;&gt;layer_0_attn_tp1 -->
<g id="edge5" class="edge">
<title>layer_0_qkv_tp1&#45;&gt;layer_0_attn_tp1</title>
<path fill="none" stroke="black" d="M1092.82,-19322.9C1092.45,-19314.94 1092.04,-19306 1091.64,-19297.48"/>
<polygon fill="black" stroke="black" points="1095.13,-19297.22 1091.17,-19287.39 1088.14,-19297.54 1095.13,-19297.22"/>
</g>
<!-- layer_0_attn_comm -->
<g id="node7" class="node">
<title>layer_0_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="947" cy="-19162.46" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="947" y="-19176.46" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="947" y="-19165.46" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="947" y="-19154.46" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="947" y="-19143.46" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_0_attn_tp0&#45;&gt;layer_0_attn_comm -->
<g id="edge6" class="edge">
<title>layer_0_attn_tp0&#45;&gt;layer_0_attn_comm</title>
<path fill="none" stroke="black" d="M841.2,-19235.06C855.51,-19225.38 872.23,-19214.06 888.09,-19203.33"/>
<polygon fill="black" stroke="black" points="890.48,-19205.94 896.8,-19197.44 886.55,-19200.14 890.48,-19205.94"/>
</g>
<!-- layer_0_attn_tp1&#45;&gt;layer_0_attn_comm -->
<g id="edge7" class="edge">
<title>layer_0_attn_tp1&#45;&gt;layer_0_attn_comm</title>
<path fill="none" stroke="black" d="M1052.8,-19235.06C1038.49,-19225.38 1021.77,-19214.06 1005.91,-19203.33"/>
<polygon fill="black" stroke="black" points="1007.45,-19200.14 997.2,-19197.44 1003.52,-19205.94 1007.45,-19200.14"/>
</g>
<!-- layer_0_attn_out -->
<g id="node8" class="node">
<title>layer_0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1057.5,-19089.7 836.5,-19089.7 836.5,-19037.7 1057.5,-19037.7 1057.5,-19089.7"/>
<text text-anchor="middle" x="947" y="-19077.7" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="947" y="-19066.7" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="947" y="-19055.7" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="947" y="-19044.7" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_0_attn_comm&#45;&gt;layer_0_attn_out -->
<g id="edge8" class="edge">
<title>layer_0_attn_comm&#45;&gt;layer_0_attn_out</title>
<path fill="none" stroke="black" d="M947,-19125.43C947,-19117.12 947,-19108.29 947,-19100"/>
<polygon fill="black" stroke="black" points="950.5,-19099.89 947,-19089.89 943.5,-19099.89 950.5,-19099.89"/>
</g>
<!-- layer_0_gate -->
<g id="node9" class="node">
<title>layer_0_gate</title>
<polygon fill="lightyellow" stroke="black" points="1201.01,-19001.7 796.94,-19001.7 692.99,-18897.7 1097.06,-18897.7 1201.01,-19001.7"/>
<text text-anchor="middle" x="947" y="-18963.7" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="947" y="-18952.7" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="947" y="-18941.7" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="947" y="-18930.7" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_0_attn_out&#45;&gt;layer_0_gate -->
<g id="edge9" class="edge">
<title>layer_0_attn_out&#45;&gt;layer_0_gate</title>
<path fill="none" stroke="black" d="M947,-19037.56C947,-19029.88 947,-19021.06 947,-19012.06"/>
<polygon fill="black" stroke="black" points="950.5,-19011.87 947,-19001.87 943.5,-19011.87 950.5,-19011.87"/>
</g>
<!-- layer_0_expert_select -->
<g id="node10" class="node">
<title>layer_0_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1213.39,-18861.7 789.62,-18861.7 680.61,-18757.7 1104.38,-18757.7 1213.39,-18861.7"/>
<text text-anchor="middle" x="947" y="-18823.7" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="947" y="-18812.7" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="947" y="-18801.7" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="947" y="-18790.7" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_0_gate&#45;&gt;layer_0_expert_select -->
<g id="edge10" class="edge">
<title>layer_0_gate&#45;&gt;layer_0_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M947,-18897.31C947,-18889.14 947,-18880.61 947,-18872.23"/>
<polygon fill="black" stroke="black" points="950.5,-18872.12 947,-18862.12 943.5,-18872.12 950.5,-18872.12"/>
</g>
<!-- layer_0_experts_gpu0 -->
<g id="node11" class="node">
<title>layer_0_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="239.5,-18721.7 24.5,-18721.7 24.5,-18669.7 239.5,-18669.7 239.5,-18721.7"/>
<text text-anchor="middle" x="132" y="-18709.7" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="132" y="-18698.7" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="132" y="-18687.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="132" y="-18676.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_0_expert_select&#45;&gt;layer_0_experts_gpu0 -->
<g id="edge11" class="edge">
<title>layer_0_expert_select&#45;&gt;layer_0_experts_gpu0</title>
<path fill="none" stroke="black" d="M708.44,-18784.29C575.76,-18769.43 407.58,-18748.45 249.59,-18721.92"/>
<polygon fill="black" stroke="black" points="250.13,-18718.46 239.68,-18720.24 248.96,-18725.36 250.13,-18718.46"/>
</g>
<!-- layer_0_experts_gpu1 -->
<g id="node12" class="node">
<title>layer_0_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="472.5,-18721.7 257.5,-18721.7 257.5,-18669.7 472.5,-18669.7 472.5,-18721.7"/>
<text text-anchor="middle" x="365" y="-18709.7" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="365" y="-18698.7" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="365" y="-18687.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="365" y="-18676.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_0_expert_select&#45;&gt;layer_0_experts_gpu1 -->
<g id="edge12" class="edge">
<title>layer_0_expert_select&#45;&gt;layer_0_experts_gpu1</title>
<path fill="none" stroke="black" d="M683.97,-18760.91C620.64,-18749.05 553.03,-18736.12 482.67,-18722.02"/>
<polygon fill="black" stroke="black" points="483.22,-18718.56 472.73,-18720.02 481.84,-18725.42 483.22,-18718.56"/>
</g>
<!-- layer_0_experts_gpu2 -->
<g id="node13" class="node">
<title>layer_0_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="705.5,-18721.7 490.5,-18721.7 490.5,-18669.7 705.5,-18669.7 705.5,-18721.7"/>
<text text-anchor="middle" x="598" y="-18709.7" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="598" y="-18698.7" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="598" y="-18687.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="598" y="-18676.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_0_expert_select&#45;&gt;layer_0_experts_gpu2 -->
<g id="edge13" class="edge">
<title>layer_0_expert_select&#45;&gt;layer_0_experts_gpu2</title>
<path fill="none" stroke="black" d="M788.07,-18757.69C753.01,-18746.44 717.09,-18734.91 686.06,-18724.95"/>
<polygon fill="black" stroke="black" points="686.75,-18721.5 676.16,-18721.78 684.62,-18728.17 686.75,-18721.5"/>
</g>
<!-- layer_0_experts_gpu3 -->
<g id="node14" class="node">
<title>layer_0_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="938.5,-18721.7 723.5,-18721.7 723.5,-18669.7 938.5,-18669.7 938.5,-18721.7"/>
<text text-anchor="middle" x="831" y="-18709.7" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="831" y="-18698.7" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="831" y="-18687.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="831" y="-18676.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_0_expert_select&#45;&gt;layer_0_experts_gpu3 -->
<g id="edge14" class="edge">
<title>layer_0_expert_select&#45;&gt;layer_0_experts_gpu3</title>
<path fill="none" stroke="black" d="M894.09,-18757.61C883.91,-18747.78 873.51,-18737.74 864.18,-18728.73"/>
<polygon fill="black" stroke="black" points="866.56,-18726.17 856.94,-18721.74 861.7,-18731.2 866.56,-18726.17"/>
</g>
<!-- layer_0_experts_gpu4 -->
<g id="node15" class="node">
<title>layer_0_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1171.5,-18721.7 956.5,-18721.7 956.5,-18669.7 1171.5,-18669.7 1171.5,-18721.7"/>
<text text-anchor="middle" x="1064" y="-18709.7" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1064" y="-18698.7" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1064" y="-18687.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1064" y="-18676.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_0_expert_select&#45;&gt;layer_0_experts_gpu4 -->
<g id="edge15" class="edge">
<title>layer_0_expert_select&#45;&gt;layer_0_experts_gpu4</title>
<path fill="none" stroke="black" d="M1000.36,-18757.61C1010.64,-18747.78 1021.12,-18737.74 1030.54,-18728.73"/>
<polygon fill="black" stroke="black" points="1033.04,-18731.18 1037.84,-18721.74 1028.19,-18726.13 1033.04,-18731.18"/>
</g>
<!-- layer_0_experts_gpu5 -->
<g id="node16" class="node">
<title>layer_0_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1404.5,-18721.7 1189.5,-18721.7 1189.5,-18669.7 1404.5,-18669.7 1404.5,-18721.7"/>
<text text-anchor="middle" x="1297" y="-18709.7" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1297" y="-18698.7" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1297" y="-18687.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1297" y="-18676.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_0_expert_select&#45;&gt;layer_0_experts_gpu5 -->
<g id="edge16" class="edge">
<title>layer_0_expert_select&#45;&gt;layer_0_experts_gpu5</title>
<path fill="none" stroke="black" d="M1105.1,-18758.1C1140.73,-18746.7 1177.3,-18735 1208.83,-18724.91"/>
<polygon fill="black" stroke="black" points="1209.99,-18728.21 1218.45,-18721.83 1207.86,-18721.55 1209.99,-18728.21"/>
</g>
<!-- layer_0_experts_gpu6 -->
<g id="node17" class="node">
<title>layer_0_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1637.5,-18721.7 1422.5,-18721.7 1422.5,-18669.7 1637.5,-18669.7 1637.5,-18721.7"/>
<text text-anchor="middle" x="1530" y="-18709.7" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1530" y="-18698.7" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1530" y="-18687.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1530" y="-18676.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_0_expert_select&#45;&gt;layer_0_experts_gpu6 -->
<g id="edge17" class="edge">
<title>layer_0_expert_select&#45;&gt;layer_0_experts_gpu6</title>
<path fill="none" stroke="black" d="M1124.63,-18776.81C1209.1,-18761.36 1311.73,-18742.14 1412.24,-18722.03"/>
<polygon fill="black" stroke="black" points="1413.16,-18725.42 1422.27,-18720.02 1411.78,-18718.55 1413.16,-18725.42"/>
</g>
<!-- layer_0_experts_gpu7 -->
<g id="node18" class="node">
<title>layer_0_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1870.5,-18721.7 1655.5,-18721.7 1655.5,-18669.7 1870.5,-18669.7 1870.5,-18721.7"/>
<text text-anchor="middle" x="1763" y="-18709.7" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1763" y="-18698.7" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1763" y="-18687.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1763" y="-18676.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_0_expert_select&#45;&gt;layer_0_experts_gpu7 -->
<g id="edge18" class="edge">
<title>layer_0_expert_select&#45;&gt;layer_0_experts_gpu7</title>
<path fill="none" stroke="black" d="M1138.18,-18789.56C1276.66,-18774.6 1468.43,-18751.61 1645.3,-18721.93"/>
<polygon fill="black" stroke="black" points="1646.04,-18725.36 1655.32,-18720.24 1644.87,-18718.46 1646.04,-18725.36"/>
</g>
<!-- layer_0_expert_comm -->
<g id="node19" class="node">
<title>layer_0_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="941" cy="-18596.93" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="941" y="-18610.93" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="941" y="-18599.93" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="941" y="-18588.93" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="941" y="-18577.93" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_0_experts_gpu0&#45;&gt;layer_0_expert_comm -->
<g id="edge19" class="edge">
<title>layer_0_experts_gpu0&#45;&gt;layer_0_expert_comm</title>
<path fill="none" stroke="black" d="M239.67,-18671.07C242.47,-18670.59 245.25,-18670.13 248,-18669.7 430.42,-18640.68 641.8,-18620.74 782.68,-18609.38"/>
<polygon fill="black" stroke="black" points="783.01,-18612.86 792.7,-18608.57 782.45,-18605.89 783.01,-18612.86"/>
</g>
<!-- layer_0_experts_gpu1&#45;&gt;layer_0_expert_comm -->
<g id="edge20" class="edge">
<title>layer_0_experts_gpu1&#45;&gt;layer_0_expert_comm</title>
<path fill="none" stroke="black" d="M472.71,-18671.26C475.5,-18670.73 478.27,-18670.2 481,-18669.7 586.9,-18650.04 707.19,-18631.4 798.19,-18618.05"/>
<polygon fill="black" stroke="black" points="798.91,-18621.48 808.3,-18616.57 797.9,-18614.55 798.91,-18621.48"/>
</g>
<!-- layer_0_experts_gpu2&#45;&gt;layer_0_expert_comm -->
<g id="edge21" class="edge">
<title>layer_0_experts_gpu2&#45;&gt;layer_0_expert_comm</title>
<path fill="none" stroke="black" d="M686.78,-18669.65C731.53,-18657.02 786.17,-18641.61 833.31,-18628.31"/>
<polygon fill="black" stroke="black" points="834.26,-18631.68 842.94,-18625.59 832.36,-18624.94 834.26,-18631.68"/>
</g>
<!-- layer_0_experts_gpu3&#45;&gt;layer_0_expert_comm -->
<g id="edge22" class="edge">
<title>layer_0_experts_gpu3&#45;&gt;layer_0_expert_comm</title>
<path fill="none" stroke="black" d="M859.61,-18669.52C870.06,-18660.33 882.17,-18649.68 893.8,-18639.45"/>
<polygon fill="black" stroke="black" points="896.15,-18642.04 901.35,-18632.81 891.53,-18636.78 896.15,-18642.04"/>
</g>
<!-- layer_0_experts_gpu4&#45;&gt;layer_0_expert_comm -->
<g id="edge23" class="edge">
<title>layer_0_experts_gpu4&#45;&gt;layer_0_expert_comm</title>
<path fill="none" stroke="black" d="M1032,-18669.52C1020.1,-18660.15 1006.26,-18649.27 993.02,-18638.85"/>
<polygon fill="black" stroke="black" points="994.9,-18635.87 984.87,-18632.44 990.57,-18641.38 994.9,-18635.87"/>
</g>
<!-- layer_0_experts_gpu5&#45;&gt;layer_0_expert_comm -->
<g id="edge24" class="edge">
<title>layer_0_experts_gpu5&#45;&gt;layer_0_expert_comm</title>
<path fill="none" stroke="black" d="M1204.86,-18669.65C1157.83,-18656.86 1100.28,-18641.22 1050.95,-18627.81"/>
<polygon fill="black" stroke="black" points="1051.76,-18624.41 1041.2,-18625.16 1049.93,-18631.16 1051.76,-18624.41"/>
</g>
<!-- layer_0_experts_gpu6&#45;&gt;layer_0_expert_comm -->
<g id="edge25" class="edge">
<title>layer_0_experts_gpu6&#45;&gt;layer_0_expert_comm</title>
<path fill="none" stroke="black" d="M1422.3,-18671.25C1419.51,-18670.72 1416.74,-18670.2 1414,-18669.7 1304.04,-18649.52 1178.96,-18630.72 1085.05,-18617.43"/>
<polygon fill="black" stroke="black" points="1085.3,-18613.93 1074.91,-18616 1084.32,-18620.86 1085.3,-18613.93"/>
</g>
<!-- layer_0_experts_gpu7&#45;&gt;layer_0_expert_comm -->
<g id="edge26" class="edge">
<title>layer_0_experts_gpu7&#45;&gt;layer_0_expert_comm</title>
<path fill="none" stroke="black" d="M1655.33,-18671.07C1652.53,-18670.59 1649.75,-18670.13 1647,-18669.7 1460.28,-18640.18 1243.75,-18620.26 1100.23,-18609.04"/>
<polygon fill="black" stroke="black" points="1100.27,-18605.53 1090.03,-18608.25 1099.73,-18612.51 1100.27,-18605.53"/>
</g>
<!-- layer_0_moe_out -->
<g id="node20" class="node">
<title>layer_0_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1170.24,-18524.16 805.57,-18524.16 711.76,-18420.16 1076.43,-18420.16 1170.24,-18524.16"/>
<text text-anchor="middle" x="941" y="-18486.16" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="941" y="-18475.16" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="941" y="-18464.16" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="941" y="-18453.16" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_0_expert_comm&#45;&gt;layer_0_moe_out -->
<g id="edge27" class="edge">
<title>layer_0_expert_comm&#45;&gt;layer_0_moe_out</title>
<path fill="none" stroke="black" d="M941,-18560.09C941,-18552.05 941,-18543.3 941,-18534.55"/>
<polygon fill="black" stroke="black" points="944.5,-18534.32 941,-18524.32 937.5,-18534.32 944.5,-18534.32"/>
</g>
<!-- layer_0_norm -->
<g id="node21" class="node">
<title>layer_0_norm</title>
<polygon fill="lightgreen" stroke="black" points="1051.5,-18384.16 830.5,-18384.16 830.5,-18332.16 1051.5,-18332.16 1051.5,-18384.16"/>
<text text-anchor="middle" x="941" y="-18372.16" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="941" y="-18361.16" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="941" y="-18350.16" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="941" y="-18339.16" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_0_moe_out&#45;&gt;layer_0_norm -->
<g id="edge28" class="edge">
<title>layer_0_moe_out&#45;&gt;layer_0_norm</title>
<path fill="none" stroke="black" d="M941,-18420.07C941,-18411.41 941,-18402.58 941,-18394.44"/>
<polygon fill="black" stroke="black" points="944.5,-18394.2 941,-18384.2 937.5,-18394.2 944.5,-18394.2"/>
</g>
<!-- layer_1_input -->
<g id="node22" class="node">
<title>layer_1_input</title>
<polygon fill="lightyellow" stroke="black" points="1205.24,-18285.16 784.89,-18285.16 676.76,-18203.16 1097.11,-18203.16 1205.24,-18285.16"/>
<text text-anchor="middle" x="941" y="-18252.66" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="941" y="-18241.66" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="941" y="-18230.66" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_0_norm&#45;&gt;layer_1_input -->
<g id="edge29" class="edge">
<title>layer_0_norm&#45;&gt;layer_1_input</title>
<path fill="none" stroke="black" d="M941,-18332.02C941,-18321.34 941,-18308.48 941,-18295.97"/>
<polygon fill="black" stroke="black" points="944.5,-18295.59 941,-18285.59 937.5,-18295.59 944.5,-18295.59"/>
</g>
<!-- layer_1_qkv_tp0 -->
<g id="node23" class="node">
<title>layer_1_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="895.5,-18167.16 620.5,-18167.16 620.5,-18115.16 895.5,-18115.16 895.5,-18167.16"/>
<text text-anchor="middle" x="758" y="-18155.16" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="758" y="-18144.16" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="758" y="-18133.16" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="758" y="-18122.16" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_1_input&#45;&gt;layer_1_qkv_tp0 -->
<g id="edge30" class="edge">
<title>layer_1_input&#45;&gt;layer_1_qkv_tp0</title>
<path fill="none" stroke="black" d="M868.41,-18203.09C849.72,-18192.77 829.92,-18181.85 812.33,-18172.14"/>
<polygon fill="black" stroke="black" points="813.8,-18168.95 803.35,-18167.19 810.42,-18175.08 813.8,-18168.95"/>
</g>
<!-- layer_1_qkv_tp1 -->
<g id="node24" class="node">
<title>layer_1_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1188.5,-18167.16 913.5,-18167.16 913.5,-18115.16 1188.5,-18115.16 1188.5,-18167.16"/>
<text text-anchor="middle" x="1051" y="-18155.16" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1051" y="-18144.16" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1051" y="-18133.16" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1051" y="-18122.16" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_1_input&#45;&gt;layer_1_qkv_tp1 -->
<g id="edge31" class="edge">
<title>layer_1_input&#45;&gt;layer_1_qkv_tp1</title>
<path fill="none" stroke="black" d="M984.79,-18202.95C995.2,-18193.39 1006.17,-18183.32 1016.12,-18174.19"/>
<polygon fill="black" stroke="black" points="1018.5,-18176.75 1023.5,-18167.41 1013.77,-18171.59 1018.5,-18176.75"/>
</g>
<!-- layer_1_attn_tp0 -->
<g id="node25" class="node">
<title>layer_1_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="892,-18079.16 630,-18079.16 630,-18027.16 892,-18027.16 892,-18079.16"/>
<text text-anchor="middle" x="761" y="-18067.16" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="761" y="-18056.16" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="761" y="-18045.16" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="761" y="-18034.16" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_1_qkv_tp0&#45;&gt;layer_1_attn_tp0 -->
<g id="edge32" class="edge">
<title>layer_1_qkv_tp0&#45;&gt;layer_1_attn_tp0</title>
<path fill="none" stroke="black" d="M758.88,-18114.82C759.16,-18106.86 759.47,-18097.92 759.77,-18089.4"/>
<polygon fill="black" stroke="black" points="763.27,-18089.43 760.12,-18079.31 756.28,-18089.18 763.27,-18089.43"/>
</g>
<!-- layer_1_attn_tp1 -->
<g id="node26" class="node">
<title>layer_1_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1178,-18079.16 916,-18079.16 916,-18027.16 1178,-18027.16 1178,-18079.16"/>
<text text-anchor="middle" x="1047" y="-18067.16" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1047" y="-18056.16" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1047" y="-18045.16" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1047" y="-18034.16" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_1_qkv_tp1&#45;&gt;layer_1_attn_tp1 -->
<g id="edge33" class="edge">
<title>layer_1_qkv_tp1&#45;&gt;layer_1_attn_tp1</title>
<path fill="none" stroke="black" d="M1049.82,-18114.82C1049.45,-18106.86 1049.04,-18097.92 1048.64,-18089.4"/>
<polygon fill="black" stroke="black" points="1052.13,-18089.14 1048.17,-18079.31 1045.14,-18089.46 1052.13,-18089.14"/>
</g>
<!-- layer_1_attn_comm -->
<g id="node27" class="node">
<title>layer_1_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="901" cy="-17954.39" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="901" y="-17968.39" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="901" y="-17957.39" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="901" y="-17946.39" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="901" y="-17935.39" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_1_attn_tp0&#45;&gt;layer_1_attn_comm -->
<g id="edge34" class="edge">
<title>layer_1_attn_tp0&#45;&gt;layer_1_attn_comm</title>
<path fill="none" stroke="black" d="M797.42,-18026.98C811.43,-18017.3 827.8,-18005.98 843.33,-17995.25"/>
<polygon fill="black" stroke="black" points="845.62,-17997.92 851.85,-17989.36 841.63,-17992.17 845.62,-17997.92"/>
</g>
<!-- layer_1_attn_tp1&#45;&gt;layer_1_attn_comm -->
<g id="edge35" class="edge">
<title>layer_1_attn_tp1&#45;&gt;layer_1_attn_comm</title>
<path fill="none" stroke="black" d="M1009.02,-18026.98C994.2,-18017.16 976.85,-18005.66 960.45,-17994.79"/>
<polygon fill="black" stroke="black" points="962.25,-17991.78 951.98,-17989.18 958.38,-17997.62 962.25,-17991.78"/>
</g>
<!-- layer_1_attn_out -->
<g id="node28" class="node">
<title>layer_1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1011.5,-17881.62 790.5,-17881.62 790.5,-17829.62 1011.5,-17829.62 1011.5,-17881.62"/>
<text text-anchor="middle" x="901" y="-17869.62" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="901" y="-17858.62" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="901" y="-17847.62" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="901" y="-17836.62" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_1_attn_comm&#45;&gt;layer_1_attn_out -->
<g id="edge36" class="edge">
<title>layer_1_attn_comm&#45;&gt;layer_1_attn_out</title>
<path fill="none" stroke="black" d="M901,-17917.35C901,-17909.04 901,-17900.21 901,-17891.93"/>
<polygon fill="black" stroke="black" points="904.5,-17891.81 901,-17881.81 897.5,-17891.81 904.5,-17891.81"/>
</g>
<!-- layer_1_gate -->
<g id="node29" class="node">
<title>layer_1_gate</title>
<polygon fill="lightyellow" stroke="black" points="1155.01,-17793.62 750.94,-17793.62 646.99,-17689.62 1051.06,-17689.62 1155.01,-17793.62"/>
<text text-anchor="middle" x="901" y="-17755.62" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="901" y="-17744.62" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="901" y="-17733.62" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="901" y="-17722.62" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_1_attn_out&#45;&gt;layer_1_gate -->
<g id="edge37" class="edge">
<title>layer_1_attn_out&#45;&gt;layer_1_gate</title>
<path fill="none" stroke="black" d="M901,-17829.48C901,-17821.8 901,-17812.98 901,-17803.98"/>
<polygon fill="black" stroke="black" points="904.5,-17803.8 901,-17793.8 897.5,-17803.8 904.5,-17803.8"/>
</g>
<!-- layer_1_expert_select -->
<g id="node30" class="node">
<title>layer_1_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1167.39,-17653.62 743.62,-17653.62 634.61,-17549.62 1058.38,-17549.62 1167.39,-17653.62"/>
<text text-anchor="middle" x="901" y="-17615.62" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="901" y="-17604.62" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="901" y="-17593.62" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="901" y="-17582.62" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_1_gate&#45;&gt;layer_1_expert_select -->
<g id="edge38" class="edge">
<title>layer_1_gate&#45;&gt;layer_1_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M901,-17689.23C901,-17681.06 901,-17672.53 901,-17664.16"/>
<polygon fill="black" stroke="black" points="904.5,-17664.05 901,-17654.05 897.5,-17664.05 904.5,-17664.05"/>
</g>
<!-- layer_1_experts_gpu0 -->
<g id="node31" class="node">
<title>layer_1_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="239.5,-17513.62 24.5,-17513.62 24.5,-17461.62 239.5,-17461.62 239.5,-17513.62"/>
<text text-anchor="middle" x="132" y="-17501.62" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="132" y="-17490.62" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="132" y="-17479.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="132" y="-17468.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_1_expert_select&#45;&gt;layer_1_experts_gpu0 -->
<g id="edge39" class="edge">
<title>layer_1_expert_select&#45;&gt;layer_1_experts_gpu0</title>
<path fill="none" stroke="black" d="M659.18,-17573.07C538.67,-17558.19 390.61,-17538.17 249.81,-17513.89"/>
<polygon fill="black" stroke="black" points="250.14,-17510.39 239.69,-17512.13 248.95,-17517.29 250.14,-17510.39"/>
</g>
<!-- layer_1_experts_gpu1 -->
<g id="node32" class="node">
<title>layer_1_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="472.5,-17513.62 257.5,-17513.62 257.5,-17461.62 472.5,-17461.62 472.5,-17513.62"/>
<text text-anchor="middle" x="365" y="-17501.62" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="365" y="-17490.62" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="365" y="-17479.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="365" y="-17468.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_1_expert_select&#45;&gt;layer_1_experts_gpu1 -->
<g id="edge40" class="edge">
<title>layer_1_expert_select&#45;&gt;layer_1_experts_gpu1</title>
<path fill="none" stroke="black" d="M653.03,-17549.59C599.45,-17538.48 542.94,-17526.69 482.82,-17514"/>
<polygon fill="black" stroke="black" points="483.25,-17510.51 472.74,-17511.87 481.8,-17517.36 483.25,-17510.51"/>
</g>
<!-- layer_1_experts_gpu2 -->
<g id="node33" class="node">
<title>layer_1_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="705.5,-17513.62 490.5,-17513.62 490.5,-17461.62 705.5,-17461.62 705.5,-17513.62"/>
<text text-anchor="middle" x="598" y="-17501.62" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="598" y="-17490.62" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="598" y="-17479.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="598" y="-17468.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_1_expert_select&#45;&gt;layer_1_experts_gpu2 -->
<g id="edge41" class="edge">
<title>layer_1_expert_select&#45;&gt;layer_1_experts_gpu2</title>
<path fill="none" stroke="black" d="M762.8,-17549.53C732.77,-17538.43 702.05,-17527.08 675.38,-17517.22"/>
<polygon fill="black" stroke="black" points="676.34,-17513.84 665.75,-17513.66 673.92,-17520.41 676.34,-17513.84"/>
</g>
<!-- layer_1_experts_gpu3 -->
<g id="node34" class="node">
<title>layer_1_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="938.5,-17513.62 723.5,-17513.62 723.5,-17461.62 938.5,-17461.62 938.5,-17513.62"/>
<text text-anchor="middle" x="831" y="-17501.62" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="831" y="-17490.62" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="831" y="-17479.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="831" y="-17468.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_1_expert_select&#45;&gt;layer_1_experts_gpu3 -->
<g id="edge42" class="edge">
<title>layer_1_expert_select&#45;&gt;layer_1_experts_gpu3</title>
<path fill="none" stroke="black" d="M869.07,-17549.53C863.29,-17540.28 857.4,-17530.85 852.03,-17522.27"/>
<polygon fill="black" stroke="black" points="854.92,-17520.29 846.65,-17513.66 848.98,-17524 854.92,-17520.29"/>
</g>
<!-- layer_1_experts_gpu4 -->
<g id="node35" class="node">
<title>layer_1_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1171.5,-17513.62 956.5,-17513.62 956.5,-17461.62 1171.5,-17461.62 1171.5,-17513.62"/>
<text text-anchor="middle" x="1064" y="-17501.62" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1064" y="-17490.62" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1064" y="-17479.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1064" y="-17468.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_1_expert_select&#45;&gt;layer_1_experts_gpu4 -->
<g id="edge43" class="edge">
<title>layer_1_expert_select&#45;&gt;layer_1_experts_gpu4</title>
<path fill="none" stroke="black" d="M975.35,-17549.53C990.22,-17539.31 1005.42,-17528.87 1018.94,-17519.58"/>
<polygon fill="black" stroke="black" points="1021.29,-17522.21 1027.55,-17513.66 1017.33,-17516.44 1021.29,-17522.21"/>
</g>
<!-- layer_1_experts_gpu5 -->
<g id="node36" class="node">
<title>layer_1_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1404.5,-17513.62 1189.5,-17513.62 1189.5,-17461.62 1404.5,-17461.62 1404.5,-17513.62"/>
<text text-anchor="middle" x="1297" y="-17501.62" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1297" y="-17490.62" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1297" y="-17479.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1297" y="-17468.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_1_expert_select&#45;&gt;layer_1_experts_gpu5 -->
<g id="edge44" class="edge">
<title>layer_1_expert_select&#45;&gt;layer_1_experts_gpu5</title>
<path fill="none" stroke="black" d="M1063.78,-17554.58C1109.6,-17541.62 1158.02,-17527.92 1198.79,-17516.39"/>
<polygon fill="black" stroke="black" points="1199.78,-17519.75 1208.45,-17513.66 1197.87,-17513.02 1199.78,-17519.75"/>
</g>
<!-- layer_1_experts_gpu6 -->
<g id="node37" class="node">
<title>layer_1_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1637.5,-17513.62 1422.5,-17513.62 1422.5,-17461.62 1637.5,-17461.62 1637.5,-17513.62"/>
<text text-anchor="middle" x="1530" y="-17501.62" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1530" y="-17490.62" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1530" y="-17479.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1530" y="-17468.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_1_expert_select&#45;&gt;layer_1_experts_gpu6 -->
<g id="edge45" class="edge">
<title>layer_1_expert_select&#45;&gt;layer_1_experts_gpu6</title>
<path fill="none" stroke="black" d="M1082.08,-17571.91C1177.67,-17556.27 1297.13,-17535.95 1412.23,-17513.93"/>
<polygon fill="black" stroke="black" points="1413.12,-17517.32 1422.29,-17512 1411.8,-17510.45 1413.12,-17517.32"/>
</g>
<!-- layer_1_experts_gpu7 -->
<g id="node38" class="node">
<title>layer_1_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1870.5,-17513.62 1655.5,-17513.62 1655.5,-17461.62 1870.5,-17461.62 1870.5,-17513.62"/>
<text text-anchor="middle" x="1763" y="-17501.62" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1763" y="-17490.62" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1763" y="-17479.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1763" y="-17468.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_1_expert_select&#45;&gt;layer_1_experts_gpu7 -->
<g id="edge46" class="edge">
<title>layer_1_expert_select&#45;&gt;layer_1_experts_gpu7</title>
<path fill="none" stroke="black" d="M1093.76,-17583.28C1242.23,-17568.7 1452.66,-17545.41 1645.29,-17513.85"/>
<polygon fill="black" stroke="black" points="1646.02,-17517.27 1655.32,-17512.19 1644.88,-17510.37 1646.02,-17517.27"/>
</g>
<!-- layer_1_expert_comm -->
<g id="node39" class="node">
<title>layer_1_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="948" cy="-17388.85" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="948" y="-17402.85" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="948" y="-17391.85" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="948" y="-17380.85" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="948" y="-17369.85" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_1_experts_gpu0&#45;&gt;layer_1_expert_comm -->
<g id="edge47" class="edge">
<title>layer_1_experts_gpu0&#45;&gt;layer_1_expert_comm</title>
<path fill="none" stroke="black" d="M239.67,-17462.99C242.47,-17462.51 245.25,-17462.05 248,-17461.62 432.7,-17432.34 646.8,-17412.41 789.1,-17401.12"/>
<polygon fill="black" stroke="black" points="789.53,-17404.6 799.22,-17400.33 788.98,-17397.62 789.53,-17404.6"/>
</g>
<!-- layer_1_experts_gpu1&#45;&gt;layer_1_expert_comm -->
<g id="edge48" class="edge">
<title>layer_1_experts_gpu1&#45;&gt;layer_1_expert_comm</title>
<path fill="none" stroke="black" d="M472.7,-17463.18C475.5,-17462.64 478.26,-17462.12 481,-17461.62 589.19,-17441.66 712.19,-17422.92 804.79,-17409.59"/>
<polygon fill="black" stroke="black" points="805.39,-17413.04 814.79,-17408.16 804.39,-17406.12 805.39,-17413.04"/>
</g>
<!-- layer_1_experts_gpu2&#45;&gt;layer_1_expert_comm -->
<g id="edge49" class="edge">
<title>layer_1_experts_gpu2&#45;&gt;layer_1_expert_comm</title>
<path fill="none" stroke="black" d="M688.59,-17461.57C734.45,-17448.89 790.47,-17433.4 838.71,-17420.07"/>
<polygon fill="black" stroke="black" points="839.85,-17423.38 848.56,-17417.34 837.99,-17416.63 839.85,-17423.38"/>
</g>
<!-- layer_1_experts_gpu3&#45;&gt;layer_1_expert_comm -->
<g id="edge50" class="edge">
<title>layer_1_experts_gpu3&#45;&gt;layer_1_expert_comm</title>
<path fill="none" stroke="black" d="M861.43,-17461.44C872.76,-17452.08 885.93,-17441.19 898.52,-17430.77"/>
<polygon fill="black" stroke="black" points="900.79,-17433.43 906.27,-17424.36 896.33,-17428.04 900.79,-17433.43"/>
</g>
<!-- layer_1_experts_gpu4&#45;&gt;layer_1_expert_comm -->
<g id="edge51" class="edge">
<title>layer_1_experts_gpu4&#45;&gt;layer_1_expert_comm</title>
<path fill="none" stroke="black" d="M1033.83,-17461.44C1022.6,-17452.08 1009.54,-17441.19 997.06,-17430.77"/>
<polygon fill="black" stroke="black" points="999.3,-17428.08 989.38,-17424.36 994.81,-17433.46 999.3,-17428.08"/>
</g>
<!-- layer_1_experts_gpu5&#45;&gt;layer_1_expert_comm -->
<g id="edge52" class="edge">
<title>layer_1_experts_gpu5&#45;&gt;layer_1_expert_comm</title>
<path fill="none" stroke="black" d="M1206.67,-17461.57C1160.94,-17448.89 1105.08,-17433.4 1056.98,-17420.07"/>
<polygon fill="black" stroke="black" points="1057.73,-17416.64 1047.16,-17417.34 1055.86,-17423.39 1057.73,-17416.64"/>
</g>
<!-- layer_1_experts_gpu6&#45;&gt;layer_1_expert_comm -->
<g id="edge53" class="edge">
<title>layer_1_experts_gpu6&#45;&gt;layer_1_expert_comm</title>
<path fill="none" stroke="black" d="M1422.3,-17463.18C1419.5,-17462.64 1416.73,-17462.12 1414,-17461.62 1306.14,-17441.71 1183.53,-17422.98 1091.15,-17409.65"/>
<polygon fill="black" stroke="black" points="1091.57,-17406.17 1081.18,-17408.21 1090.58,-17413.1 1091.57,-17406.17"/>
</g>
<!-- layer_1_experts_gpu7&#45;&gt;layer_1_expert_comm -->
<g id="edge54" class="edge">
<title>layer_1_experts_gpu7&#45;&gt;layer_1_expert_comm</title>
<path fill="none" stroke="black" d="M1655.33,-17462.99C1652.53,-17462.51 1649.75,-17462.05 1647,-17461.62 1462.56,-17432.36 1248.77,-17412.43 1106.67,-17401.14"/>
<polygon fill="black" stroke="black" points="1106.81,-17397.64 1096.57,-17400.34 1106.26,-17404.62 1106.81,-17397.64"/>
</g>
<!-- layer_1_moe_out -->
<g id="node40" class="node">
<title>layer_1_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1177.24,-17316.08 812.57,-17316.08 718.76,-17212.08 1083.43,-17212.08 1177.24,-17316.08"/>
<text text-anchor="middle" x="948" y="-17278.08" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="948" y="-17267.08" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="948" y="-17256.08" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="948" y="-17245.08" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_1_expert_comm&#45;&gt;layer_1_moe_out -->
<g id="edge55" class="edge">
<title>layer_1_expert_comm&#45;&gt;layer_1_moe_out</title>
<path fill="none" stroke="black" d="M948,-17352.01C948,-17343.97 948,-17335.22 948,-17326.47"/>
<polygon fill="black" stroke="black" points="951.5,-17326.24 948,-17316.24 944.5,-17326.24 951.5,-17326.24"/>
</g>
<!-- layer_1_norm -->
<g id="node41" class="node">
<title>layer_1_norm</title>
<polygon fill="lightgreen" stroke="black" points="1058.5,-17176.08 837.5,-17176.08 837.5,-17124.08 1058.5,-17124.08 1058.5,-17176.08"/>
<text text-anchor="middle" x="948" y="-17164.08" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="948" y="-17153.08" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="948" y="-17142.08" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="948" y="-17131.08" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_1_moe_out&#45;&gt;layer_1_norm -->
<g id="edge56" class="edge">
<title>layer_1_moe_out&#45;&gt;layer_1_norm</title>
<path fill="none" stroke="black" d="M948,-17211.99C948,-17203.33 948,-17194.51 948,-17186.36"/>
<polygon fill="black" stroke="black" points="951.5,-17186.12 948,-17176.12 944.5,-17186.12 951.5,-17186.12"/>
</g>
<!-- layer_2_input -->
<g id="node42" class="node">
<title>layer_2_input</title>
<polygon fill="lightyellow" stroke="black" points="1212.24,-17077.08 791.89,-17077.08 683.76,-16995.08 1104.11,-16995.08 1212.24,-17077.08"/>
<text text-anchor="middle" x="948" y="-17044.58" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="948" y="-17033.58" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="948" y="-17022.58" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_1_norm&#45;&gt;layer_2_input -->
<g id="edge57" class="edge">
<title>layer_1_norm&#45;&gt;layer_2_input</title>
<path fill="none" stroke="black" d="M948,-17123.94C948,-17113.26 948,-17100.4 948,-17087.89"/>
<polygon fill="black" stroke="black" points="951.5,-17087.51 948,-17077.51 944.5,-17087.51 951.5,-17087.51"/>
</g>
<!-- layer_2_qkv_tp0 -->
<g id="node43" class="node">
<title>layer_2_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1014.5,-16959.08 739.5,-16959.08 739.5,-16907.08 1014.5,-16907.08 1014.5,-16959.08"/>
<text text-anchor="middle" x="877" y="-16947.08" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="877" y="-16936.08" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="877" y="-16925.08" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="877" y="-16914.08" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_2_input&#45;&gt;layer_2_qkv_tp0 -->
<g id="edge58" class="edge">
<title>layer_2_input&#45;&gt;layer_2_qkv_tp0</title>
<path fill="none" stroke="black" d="M919.73,-16994.87C913.41,-16985.88 906.77,-16976.43 900.66,-16967.73"/>
<polygon fill="black" stroke="black" points="903.37,-16965.5 894.75,-16959.33 897.64,-16969.52 903.37,-16965.5"/>
</g>
<!-- layer_2_qkv_tp1 -->
<g id="node44" class="node">
<title>layer_2_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1307.5,-16959.08 1032.5,-16959.08 1032.5,-16907.08 1307.5,-16907.08 1307.5,-16959.08"/>
<text text-anchor="middle" x="1170" y="-16947.08" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1170" y="-16936.08" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1170" y="-16925.08" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1170" y="-16914.08" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_2_input&#45;&gt;layer_2_qkv_tp1 -->
<g id="edge59" class="edge">
<title>layer_2_input&#45;&gt;layer_2_qkv_tp1</title>
<path fill="none" stroke="black" d="M1036.06,-16995.01C1059.36,-16984.41 1084.08,-16973.17 1105.85,-16963.26"/>
<polygon fill="black" stroke="black" points="1107.33,-16966.43 1114.98,-16959.11 1104.43,-16960.06 1107.33,-16966.43"/>
</g>
<!-- layer_2_attn_tp0 -->
<g id="node45" class="node">
<title>layer_2_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1012,-16871.08 750,-16871.08 750,-16819.08 1012,-16819.08 1012,-16871.08"/>
<text text-anchor="middle" x="881" y="-16859.08" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="881" y="-16848.08" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="881" y="-16837.08" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="881" y="-16826.08" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_2_qkv_tp0&#45;&gt;layer_2_attn_tp0 -->
<g id="edge60" class="edge">
<title>layer_2_qkv_tp0&#45;&gt;layer_2_attn_tp0</title>
<path fill="none" stroke="black" d="M878.18,-16906.74C878.55,-16898.78 878.96,-16889.84 879.36,-16881.32"/>
<polygon fill="black" stroke="black" points="882.86,-16881.39 879.83,-16871.23 875.87,-16881.06 882.86,-16881.39"/>
</g>
<!-- layer_2_attn_tp1 -->
<g id="node46" class="node">
<title>layer_2_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1298,-16871.08 1036,-16871.08 1036,-16819.08 1298,-16819.08 1298,-16871.08"/>
<text text-anchor="middle" x="1167" y="-16859.08" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1167" y="-16848.08" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1167" y="-16837.08" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1167" y="-16826.08" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_2_qkv_tp1&#45;&gt;layer_2_attn_tp1 -->
<g id="edge61" class="edge">
<title>layer_2_qkv_tp1&#45;&gt;layer_2_attn_tp1</title>
<path fill="none" stroke="black" d="M1169.12,-16906.74C1168.84,-16898.78 1168.53,-16889.84 1168.23,-16881.32"/>
<polygon fill="black" stroke="black" points="1171.72,-16881.11 1167.88,-16871.23 1164.73,-16881.35 1171.72,-16881.11"/>
</g>
<!-- layer_2_attn_comm -->
<g id="node47" class="node">
<title>layer_2_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="904" cy="-16746.31" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="904" y="-16760.31" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="904" y="-16749.31" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="904" y="-16738.31" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="904" y="-16727.31" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_2_attn_tp0&#45;&gt;layer_2_attn_comm -->
<g id="edge62" class="edge">
<title>layer_2_attn_tp0&#45;&gt;layer_2_attn_comm</title>
<path fill="none" stroke="black" d="M886.98,-16818.91C888.86,-16811.01 890.99,-16802.04 893.1,-16793.18"/>
<polygon fill="black" stroke="black" points="896.54,-16793.82 895.45,-16783.28 889.73,-16792.2 896.54,-16793.82"/>
</g>
<!-- layer_2_attn_tp1&#45;&gt;layer_2_attn_comm -->
<g id="edge63" class="edge">
<title>layer_2_attn_tp1&#45;&gt;layer_2_attn_comm</title>
<path fill="none" stroke="black" d="M1098.93,-16819.03C1067.49,-16807.46 1029.69,-16793.55 995.77,-16781.08"/>
<polygon fill="black" stroke="black" points="996.91,-16777.77 986.32,-16777.6 994.5,-16784.34 996.91,-16777.77"/>
</g>
<!-- layer_2_attn_out -->
<g id="node48" class="node">
<title>layer_2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1014.5,-16673.54 793.5,-16673.54 793.5,-16621.54 1014.5,-16621.54 1014.5,-16673.54"/>
<text text-anchor="middle" x="904" y="-16661.54" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="904" y="-16650.54" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="904" y="-16639.54" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="904" y="-16628.54" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_2_attn_comm&#45;&gt;layer_2_attn_out -->
<g id="edge64" class="edge">
<title>layer_2_attn_comm&#45;&gt;layer_2_attn_out</title>
<path fill="none" stroke="black" d="M904,-16709.27C904,-16700.96 904,-16692.13 904,-16683.85"/>
<polygon fill="black" stroke="black" points="907.5,-16683.73 904,-16673.73 900.5,-16683.73 907.5,-16683.73"/>
</g>
<!-- layer_2_gate -->
<g id="node49" class="node">
<title>layer_2_gate</title>
<polygon fill="lightyellow" stroke="black" points="1158.01,-16585.54 753.94,-16585.54 649.99,-16481.54 1054.06,-16481.54 1158.01,-16585.54"/>
<text text-anchor="middle" x="904" y="-16547.54" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="904" y="-16536.54" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="904" y="-16525.54" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="904" y="-16514.54" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_2_attn_out&#45;&gt;layer_2_gate -->
<g id="edge65" class="edge">
<title>layer_2_attn_out&#45;&gt;layer_2_gate</title>
<path fill="none" stroke="black" d="M904,-16621.4C904,-16613.72 904,-16604.91 904,-16595.91"/>
<polygon fill="black" stroke="black" points="907.5,-16595.72 904,-16585.72 900.5,-16595.72 907.5,-16595.72"/>
</g>
<!-- layer_2_expert_select -->
<g id="node50" class="node">
<title>layer_2_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1170.39,-16445.54 746.62,-16445.54 637.61,-16341.54 1061.38,-16341.54 1170.39,-16445.54"/>
<text text-anchor="middle" x="904" y="-16407.54" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="904" y="-16396.54" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="904" y="-16385.54" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="904" y="-16374.54" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_2_gate&#45;&gt;layer_2_expert_select -->
<g id="edge66" class="edge">
<title>layer_2_gate&#45;&gt;layer_2_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M904,-16481.15C904,-16472.98 904,-16464.46 904,-16456.08"/>
<polygon fill="black" stroke="black" points="907.5,-16455.97 904,-16445.97 900.5,-16455.97 907.5,-16455.97"/>
</g>
<!-- layer_2_experts_gpu0 -->
<g id="node51" class="node">
<title>layer_2_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="239.5,-16305.54 24.5,-16305.54 24.5,-16253.54 239.5,-16253.54 239.5,-16305.54"/>
<text text-anchor="middle" x="132" y="-16293.54" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="132" y="-16282.54" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="132" y="-16271.54" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="132" y="-16260.54" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_2_expert_select&#45;&gt;layer_2_experts_gpu0 -->
<g id="edge67" class="edge">
<title>layer_2_expert_select&#45;&gt;layer_2_experts_gpu0</title>
<path fill="none" stroke="black" d="M662.23,-16365.19C540.96,-16350.31 391.71,-16330.23 249.89,-16305.82"/>
<polygon fill="black" stroke="black" points="250.14,-16302.31 239.69,-16304.06 248.95,-16309.21 250.14,-16302.31"/>
</g>
<!-- layer_2_experts_gpu1 -->
<g id="node52" class="node">
<title>layer_2_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="472.5,-16305.54 257.5,-16305.54 257.5,-16253.54 472.5,-16253.54 472.5,-16305.54"/>
<text text-anchor="middle" x="365" y="-16293.54" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="365" y="-16282.54" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="365" y="-16271.54" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="365" y="-16260.54" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_2_expert_select&#45;&gt;layer_2_experts_gpu1 -->
<g id="edge68" class="edge">
<title>layer_2_expert_select&#45;&gt;layer_2_experts_gpu1</title>
<path fill="none" stroke="black" d="M653.96,-16341.52C600.08,-16330.42 543.28,-16318.63 482.86,-16305.93"/>
<polygon fill="black" stroke="black" points="483.25,-16302.43 472.74,-16303.79 481.8,-16309.28 483.25,-16302.43"/>
</g>
<!-- layer_2_experts_gpu2 -->
<g id="node53" class="node">
<title>layer_2_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="705.5,-16305.54 490.5,-16305.54 490.5,-16253.54 705.5,-16253.54 705.5,-16305.54"/>
<text text-anchor="middle" x="598" y="-16293.54" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="598" y="-16282.54" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="598" y="-16271.54" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="598" y="-16260.54" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_2_expert_select&#45;&gt;layer_2_experts_gpu2 -->
<g id="edge69" class="edge">
<title>layer_2_expert_select&#45;&gt;layer_2_experts_gpu2</title>
<path fill="none" stroke="black" d="M764.43,-16341.45C734.11,-16330.36 703.08,-16319 676.15,-16309.14"/>
<polygon fill="black" stroke="black" points="677.02,-16305.73 666.42,-16305.58 674.61,-16312.31 677.02,-16305.73"/>
</g>
<!-- layer_2_experts_gpu3 -->
<g id="node54" class="node">
<title>layer_2_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="938.5,-16305.54 723.5,-16305.54 723.5,-16253.54 938.5,-16253.54 938.5,-16305.54"/>
<text text-anchor="middle" x="831" y="-16293.54" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="831" y="-16282.54" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="831" y="-16271.54" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="831" y="-16260.54" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_2_expert_select&#45;&gt;layer_2_experts_gpu3 -->
<g id="edge70" class="edge">
<title>layer_2_expert_select&#45;&gt;layer_2_experts_gpu3</title>
<path fill="none" stroke="black" d="M870.7,-16341.45C864.68,-16332.21 858.53,-16322.78 852.93,-16314.19"/>
<polygon fill="black" stroke="black" points="855.72,-16312.05 847.32,-16305.58 849.85,-16315.87 855.72,-16312.05"/>
</g>
<!-- layer_2_experts_gpu4 -->
<g id="node55" class="node">
<title>layer_2_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1171.5,-16305.54 956.5,-16305.54 956.5,-16253.54 1171.5,-16253.54 1171.5,-16305.54"/>
<text text-anchor="middle" x="1064" y="-16293.54" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1064" y="-16282.54" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1064" y="-16271.54" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1064" y="-16260.54" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_2_expert_select&#45;&gt;layer_2_experts_gpu4 -->
<g id="edge71" class="edge">
<title>layer_2_expert_select&#45;&gt;layer_2_experts_gpu4</title>
<path fill="none" stroke="black" d="M976.98,-16341.45C991.58,-16331.23 1006.5,-16320.79 1019.76,-16311.5"/>
<polygon fill="black" stroke="black" points="1022.04,-16314.18 1028.22,-16305.58 1018.02,-16308.45 1022.04,-16314.18"/>
</g>
<!-- layer_2_experts_gpu5 -->
<g id="node56" class="node">
<title>layer_2_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1404.5,-16305.54 1189.5,-16305.54 1189.5,-16253.54 1404.5,-16253.54 1404.5,-16305.54"/>
<text text-anchor="middle" x="1297" y="-16293.54" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1297" y="-16282.54" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1297" y="-16271.54" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1297" y="-16260.54" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_2_expert_select&#45;&gt;layer_2_experts_gpu5 -->
<g id="edge72" class="edge">
<title>layer_2_expert_select&#45;&gt;layer_2_experts_gpu5</title>
<path fill="none" stroke="black" d="M1066.4,-16346.26C1111.59,-16333.38 1159.26,-16319.79 1199.46,-16308.34"/>
<polygon fill="black" stroke="black" points="1200.59,-16311.65 1209.24,-16305.55 1198.67,-16304.92 1200.59,-16311.65"/>
</g>
<!-- layer_2_experts_gpu6 -->
<g id="node57" class="node">
<title>layer_2_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1637.5,-16305.54 1422.5,-16305.54 1422.5,-16253.54 1637.5,-16253.54 1637.5,-16305.54"/>
<text text-anchor="middle" x="1530" y="-16293.54" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1530" y="-16282.54" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1530" y="-16271.54" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1530" y="-16260.54" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_2_expert_select&#45;&gt;layer_2_experts_gpu6 -->
<g id="edge73" class="edge">
<title>layer_2_expert_select&#45;&gt;layer_2_experts_gpu6</title>
<path fill="none" stroke="black" d="M1084.61,-16363.68C1179.54,-16348.04 1298.04,-16327.76 1412.31,-16305.84"/>
<polygon fill="black" stroke="black" points="1413.13,-16309.25 1422.28,-16303.92 1411.8,-16302.37 1413.13,-16309.25"/>
</g>
<!-- layer_2_experts_gpu7 -->
<g id="node58" class="node">
<title>layer_2_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1870.5,-16305.54 1655.5,-16305.54 1655.5,-16253.54 1870.5,-16253.54 1870.5,-16305.54"/>
<text text-anchor="middle" x="1763" y="-16293.54" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1763" y="-16282.54" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1763" y="-16271.54" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1763" y="-16260.54" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_2_expert_select&#45;&gt;layer_2_experts_gpu7 -->
<g id="edge74" class="edge">
<title>layer_2_expert_select&#45;&gt;layer_2_experts_gpu7</title>
<path fill="none" stroke="black" d="M1096.76,-16375.08C1244.59,-16360.47 1453.77,-16337.2 1645.34,-16305.76"/>
<polygon fill="black" stroke="black" points="1646.02,-16309.19 1655.32,-16304.11 1644.88,-16302.29 1646.02,-16309.19"/>
</g>
<!-- layer_2_expert_comm -->
<g id="node59" class="node">
<title>layer_2_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="993" cy="-16180.77" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="993" y="-16194.77" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="993" y="-16183.77" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="993" y="-16172.77" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="993" y="-16161.77" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_2_experts_gpu0&#45;&gt;layer_2_expert_comm -->
<g id="edge75" class="edge">
<title>layer_2_experts_gpu0&#45;&gt;layer_2_expert_comm</title>
<path fill="none" stroke="black" d="M239.67,-16254.89C242.47,-16254.42 245.25,-16253.97 248,-16253.54 448.35,-16222.41 681.25,-16202.56 832.58,-16191.81"/>
<polygon fill="black" stroke="black" points="833.16,-16195.28 842.88,-16191.08 832.66,-16188.3 833.16,-16195.28"/>
</g>
<!-- layer_2_experts_gpu1&#45;&gt;layer_2_expert_comm -->
<g id="edge76" class="edge">
<title>layer_2_experts_gpu1&#45;&gt;layer_2_expert_comm</title>
<path fill="none" stroke="black" d="M472.69,-16255.05C475.49,-16254.53 478.26,-16254.02 481,-16253.54 603.2,-16231.84 742.76,-16212.64 845.28,-16199.57"/>
<polygon fill="black" stroke="black" points="845.91,-16203.02 855.39,-16198.29 845.03,-16196.08 845.91,-16203.02"/>
</g>
<!-- layer_2_experts_gpu2&#45;&gt;layer_2_expert_comm -->
<g id="edge77" class="edge">
<title>layer_2_experts_gpu2&#45;&gt;layer_2_expert_comm</title>
<path fill="none" stroke="black" d="M700.24,-16253.49C754.25,-16240.26 820.77,-16223.96 876.75,-16210.25"/>
<polygon fill="black" stroke="black" points="877.83,-16213.59 886.71,-16207.81 876.17,-16206.79 877.83,-16213.59"/>
</g>
<!-- layer_2_experts_gpu3&#45;&gt;layer_2_expert_comm -->
<g id="edge78" class="edge">
<title>layer_2_experts_gpu3&#45;&gt;layer_2_expert_comm</title>
<path fill="none" stroke="black" d="M873.14,-16253.37C889.97,-16243.31 909.74,-16231.5 928.32,-16220.41"/>
<polygon fill="black" stroke="black" points="930.25,-16223.33 937.04,-16215.2 926.66,-16217.32 930.25,-16223.33"/>
</g>
<!-- layer_2_experts_gpu4&#45;&gt;layer_2_expert_comm -->
<g id="edge79" class="edge">
<title>layer_2_experts_gpu4&#45;&gt;layer_2_expert_comm</title>
<path fill="none" stroke="black" d="M1045.53,-16253.37C1039.3,-16244.88 1032.16,-16235.14 1025.18,-16225.63"/>
<polygon fill="black" stroke="black" points="1027.86,-16223.37 1019.13,-16217.38 1022.22,-16227.51 1027.86,-16223.37"/>
</g>
<!-- layer_2_experts_gpu5&#45;&gt;layer_2_expert_comm -->
<g id="edge80" class="edge">
<title>layer_2_experts_gpu5&#45;&gt;layer_2_expert_comm</title>
<path fill="none" stroke="black" d="M1218.32,-16253.49C1180.29,-16241.39 1134.21,-16226.72 1093.65,-16213.81"/>
<polygon fill="black" stroke="black" points="1094.6,-16210.44 1084.01,-16210.74 1092.48,-16217.11 1094.6,-16210.44"/>
</g>
<!-- layer_2_experts_gpu6&#45;&gt;layer_2_expert_comm -->
<g id="edge81" class="edge">
<title>layer_2_experts_gpu6&#45;&gt;layer_2_expert_comm</title>
<path fill="none" stroke="black" d="M1422.28,-16255.16C1419.5,-16254.61 1416.73,-16254.07 1414,-16253.54 1319.73,-16235.35 1213.12,-16217.2 1130.76,-16203.71"/>
<polygon fill="black" stroke="black" points="1131.28,-16200.24 1120.84,-16202.08 1130.15,-16207.15 1131.28,-16200.24"/>
</g>
<!-- layer_2_experts_gpu7&#45;&gt;layer_2_expert_comm -->
<g id="edge82" class="edge">
<title>layer_2_experts_gpu7&#45;&gt;layer_2_expert_comm</title>
<path fill="none" stroke="black" d="M1655.32,-16254.94C1652.52,-16254.45 1649.75,-16253.98 1647,-16253.54 1478.05,-16226.14 1282.81,-16206.22 1149.95,-16194.42"/>
<polygon fill="black" stroke="black" points="1149.96,-16190.91 1139.69,-16193.52 1149.34,-16197.88 1149.96,-16190.91"/>
</g>
<!-- layer_2_moe_out -->
<g id="node60" class="node">
<title>layer_2_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1222.24,-16108 857.57,-16108 763.76,-16004 1128.43,-16004 1222.24,-16108"/>
<text text-anchor="middle" x="993" y="-16070" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="993" y="-16059" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="993" y="-16048" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="993" y="-16037" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_2_expert_comm&#45;&gt;layer_2_moe_out -->
<g id="edge83" class="edge">
<title>layer_2_expert_comm&#45;&gt;layer_2_moe_out</title>
<path fill="none" stroke="black" d="M993,-16143.93C993,-16135.89 993,-16127.14 993,-16118.39"/>
<polygon fill="black" stroke="black" points="996.5,-16118.17 993,-16108.17 989.5,-16118.17 996.5,-16118.17"/>
</g>
<!-- layer_2_norm -->
<g id="node61" class="node">
<title>layer_2_norm</title>
<polygon fill="lightgreen" stroke="black" points="1103.5,-15968 882.5,-15968 882.5,-15916 1103.5,-15916 1103.5,-15968"/>
<text text-anchor="middle" x="993" y="-15956" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="993" y="-15945" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="993" y="-15934" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="993" y="-15923" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_2_moe_out&#45;&gt;layer_2_norm -->
<g id="edge84" class="edge">
<title>layer_2_moe_out&#45;&gt;layer_2_norm</title>
<path fill="none" stroke="black" d="M993,-16003.92C993,-15995.25 993,-15986.43 993,-15978.29"/>
<polygon fill="black" stroke="black" points="996.5,-15978.04 993,-15968.04 989.5,-15978.04 996.5,-15978.04"/>
</g>
<!-- layer_3_input -->
<g id="node62" class="node">
<title>layer_3_input</title>
<polygon fill="lightyellow" stroke="black" points="1257.24,-15869 836.89,-15869 728.76,-15787 1149.11,-15787 1257.24,-15869"/>
<text text-anchor="middle" x="993" y="-15836.5" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="993" y="-15825.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="993" y="-15814.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_2_norm&#45;&gt;layer_3_input -->
<g id="edge85" class="edge">
<title>layer_2_norm&#45;&gt;layer_3_input</title>
<path fill="none" stroke="black" d="M993,-15915.86C993,-15905.18 993,-15892.32 993,-15879.81"/>
<polygon fill="black" stroke="black" points="996.5,-15879.44 993,-15869.44 989.5,-15879.44 996.5,-15879.44"/>
</g>
<!-- layer_3_qkv_tp0 -->
<g id="node63" class="node">
<title>layer_3_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="867.5,-15751 592.5,-15751 592.5,-15699 867.5,-15699 867.5,-15751"/>
<text text-anchor="middle" x="730" y="-15739" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="730" y="-15728" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="730" y="-15717" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="730" y="-15706" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_3_input&#45;&gt;layer_3_qkv_tp0 -->
<g id="edge86" class="edge">
<title>layer_3_input&#45;&gt;layer_3_qkv_tp0</title>
<path fill="none" stroke="black" d="M888.68,-15786.94C860.58,-15776.15 830.75,-15764.69 804.62,-15754.66"/>
<polygon fill="black" stroke="black" points="805.77,-15751.35 795.18,-15751.03 803.26,-15757.88 805.77,-15751.35"/>
</g>
<!-- layer_3_qkv_tp1 -->
<g id="node64" class="node">
<title>layer_3_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1160.5,-15751 885.5,-15751 885.5,-15699 1160.5,-15699 1160.5,-15751"/>
<text text-anchor="middle" x="1023" y="-15739" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1023" y="-15728" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1023" y="-15717" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1023" y="-15706" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_3_input&#45;&gt;layer_3_qkv_tp1 -->
<g id="edge87" class="edge">
<title>layer_3_input&#45;&gt;layer_3_qkv_tp1</title>
<path fill="none" stroke="black" d="M1004.94,-15786.79C1007.48,-15778.27 1010.13,-15769.33 1012.6,-15761.02"/>
<polygon fill="black" stroke="black" points="1016.01,-15761.83 1015.5,-15751.25 1009.3,-15759.84 1016.01,-15761.83"/>
</g>
<!-- layer_3_attn_tp0 -->
<g id="node65" class="node">
<title>layer_3_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="864,-15663 602,-15663 602,-15611 864,-15611 864,-15663"/>
<text text-anchor="middle" x="733" y="-15651" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="733" y="-15640" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="733" y="-15629" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="733" y="-15618" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_3_qkv_tp0&#45;&gt;layer_3_attn_tp0 -->
<g id="edge88" class="edge">
<title>layer_3_qkv_tp0&#45;&gt;layer_3_attn_tp0</title>
<path fill="none" stroke="black" d="M730.88,-15698.66C731.16,-15690.7 731.47,-15681.76 731.77,-15673.24"/>
<polygon fill="black" stroke="black" points="735.27,-15673.27 732.12,-15663.16 728.28,-15673.03 735.27,-15673.27"/>
</g>
<!-- layer_3_attn_tp1 -->
<g id="node66" class="node">
<title>layer_3_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1150,-15663 888,-15663 888,-15611 1150,-15611 1150,-15663"/>
<text text-anchor="middle" x="1019" y="-15651" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1019" y="-15640" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1019" y="-15629" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1019" y="-15618" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_3_qkv_tp1&#45;&gt;layer_3_attn_tp1 -->
<g id="edge89" class="edge">
<title>layer_3_qkv_tp1&#45;&gt;layer_3_attn_tp1</title>
<path fill="none" stroke="black" d="M1021.82,-15698.66C1021.45,-15690.7 1021.04,-15681.76 1020.64,-15673.24"/>
<polygon fill="black" stroke="black" points="1024.13,-15672.98 1020.17,-15663.16 1017.14,-15673.31 1024.13,-15672.98"/>
</g>
<!-- layer_3_attn_comm -->
<g id="node67" class="node">
<title>layer_3_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="947" cy="-15538.23" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="947" y="-15552.23" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="947" y="-15541.23" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="947" y="-15530.23" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="947" y="-15519.23" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_3_attn_tp0&#45;&gt;layer_3_attn_comm -->
<g id="edge90" class="edge">
<title>layer_3_attn_tp0&#45;&gt;layer_3_attn_comm</title>
<path fill="none" stroke="black" d="M788.39,-15610.95C812.43,-15600.08 841.04,-15587.15 867.3,-15575.27"/>
<polygon fill="black" stroke="black" points="868.81,-15578.43 876.48,-15571.12 865.92,-15572.05 868.81,-15578.43"/>
</g>
<!-- layer_3_attn_tp1&#45;&gt;layer_3_attn_comm -->
<g id="edge91" class="edge">
<title>layer_3_attn_tp1&#45;&gt;layer_3_attn_comm</title>
<path fill="none" stroke="black" d="M1000.27,-15610.83C993.95,-15602.34 986.71,-15592.6 979.64,-15583.09"/>
<polygon fill="black" stroke="black" points="982.27,-15580.77 973.5,-15574.84 976.66,-15584.95 982.27,-15580.77"/>
</g>
<!-- layer_3_attn_out -->
<g id="node68" class="node">
<title>layer_3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1057.5,-15465.46 836.5,-15465.46 836.5,-15413.46 1057.5,-15413.46 1057.5,-15465.46"/>
<text text-anchor="middle" x="947" y="-15453.46" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="947" y="-15442.46" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="947" y="-15431.46" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="947" y="-15420.46" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_3_attn_comm&#45;&gt;layer_3_attn_out -->
<g id="edge92" class="edge">
<title>layer_3_attn_comm&#45;&gt;layer_3_attn_out</title>
<path fill="none" stroke="black" d="M947,-15501.2C947,-15492.88 947,-15484.05 947,-15475.77"/>
<polygon fill="black" stroke="black" points="950.5,-15475.66 947,-15465.66 943.5,-15475.66 950.5,-15475.66"/>
</g>
<!-- layer_3_gate -->
<g id="node69" class="node">
<title>layer_3_gate</title>
<polygon fill="lightyellow" stroke="black" points="1201.01,-15377.46 796.94,-15377.46 692.99,-15273.46 1097.06,-15273.46 1201.01,-15377.46"/>
<text text-anchor="middle" x="947" y="-15339.46" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="947" y="-15328.46" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="947" y="-15317.46" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="947" y="-15306.46" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_3_attn_out&#45;&gt;layer_3_gate -->
<g id="edge93" class="edge">
<title>layer_3_attn_out&#45;&gt;layer_3_gate</title>
<path fill="none" stroke="black" d="M947,-15413.33C947,-15405.64 947,-15396.83 947,-15387.83"/>
<polygon fill="black" stroke="black" points="950.5,-15387.64 947,-15377.64 943.5,-15387.64 950.5,-15387.64"/>
</g>
<!-- layer_3_expert_select -->
<g id="node70" class="node">
<title>layer_3_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1213.39,-15237.46 789.62,-15237.46 680.61,-15133.46 1104.38,-15133.46 1213.39,-15237.46"/>
<text text-anchor="middle" x="947" y="-15199.46" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="947" y="-15188.46" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="947" y="-15177.46" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="947" y="-15166.46" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_3_gate&#45;&gt;layer_3_expert_select -->
<g id="edge94" class="edge">
<title>layer_3_gate&#45;&gt;layer_3_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M947,-15273.07C947,-15264.9 947,-15256.38 947,-15248"/>
<polygon fill="black" stroke="black" points="950.5,-15247.89 947,-15237.89 943.5,-15247.89 950.5,-15247.89"/>
</g>
<!-- layer_3_experts_gpu0 -->
<g id="node71" class="node">
<title>layer_3_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="239.5,-15097.46 24.5,-15097.46 24.5,-15045.46 239.5,-15045.46 239.5,-15097.46"/>
<text text-anchor="middle" x="132" y="-15085.46" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="132" y="-15074.46" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="132" y="-15063.46" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="132" y="-15052.46" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_3_expert_select&#45;&gt;layer_3_experts_gpu0 -->
<g id="edge95" class="edge">
<title>layer_3_expert_select&#45;&gt;layer_3_experts_gpu0</title>
<path fill="none" stroke="black" d="M708.44,-15160.06C575.76,-15145.19 407.58,-15124.22 249.59,-15097.68"/>
<polygon fill="black" stroke="black" points="250.13,-15094.22 239.68,-15096.01 248.96,-15101.12 250.13,-15094.22"/>
</g>
<!-- layer_3_experts_gpu1 -->
<g id="node72" class="node">
<title>layer_3_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="472.5,-15097.46 257.5,-15097.46 257.5,-15045.46 472.5,-15045.46 472.5,-15097.46"/>
<text text-anchor="middle" x="365" y="-15085.46" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="365" y="-15074.46" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="365" y="-15063.46" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="365" y="-15052.46" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_3_expert_select&#45;&gt;layer_3_experts_gpu1 -->
<g id="edge96" class="edge">
<title>layer_3_expert_select&#45;&gt;layer_3_experts_gpu1</title>
<path fill="none" stroke="black" d="M683.97,-15136.67C620.64,-15124.82 553.03,-15111.88 482.67,-15097.78"/>
<polygon fill="black" stroke="black" points="483.22,-15094.32 472.73,-15095.78 481.84,-15101.18 483.22,-15094.32"/>
</g>
<!-- layer_3_experts_gpu2 -->
<g id="node73" class="node">
<title>layer_3_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="705.5,-15097.46 490.5,-15097.46 490.5,-15045.46 705.5,-15045.46 705.5,-15097.46"/>
<text text-anchor="middle" x="598" y="-15085.46" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="598" y="-15074.46" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="598" y="-15063.46" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="598" y="-15052.46" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_3_expert_select&#45;&gt;layer_3_experts_gpu2 -->
<g id="edge97" class="edge">
<title>layer_3_expert_select&#45;&gt;layer_3_experts_gpu2</title>
<path fill="none" stroke="black" d="M788.07,-15133.46C753.01,-15122.2 717.09,-15110.68 686.06,-15100.72"/>
<polygon fill="black" stroke="black" points="686.75,-15097.27 676.16,-15097.54 684.62,-15103.93 686.75,-15097.27"/>
</g>
<!-- layer_3_experts_gpu3 -->
<g id="node74" class="node">
<title>layer_3_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="938.5,-15097.46 723.5,-15097.46 723.5,-15045.46 938.5,-15045.46 938.5,-15097.46"/>
<text text-anchor="middle" x="831" y="-15085.46" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="831" y="-15074.46" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="831" y="-15063.46" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="831" y="-15052.46" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_3_expert_select&#45;&gt;layer_3_experts_gpu3 -->
<g id="edge98" class="edge">
<title>layer_3_expert_select&#45;&gt;layer_3_experts_gpu3</title>
<path fill="none" stroke="black" d="M894.09,-15133.38C883.91,-15123.54 873.51,-15113.51 864.18,-15104.49"/>
<polygon fill="black" stroke="black" points="866.56,-15101.93 856.94,-15097.5 861.7,-15106.97 866.56,-15101.93"/>
</g>
<!-- layer_3_experts_gpu4 -->
<g id="node75" class="node">
<title>layer_3_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1171.5,-15097.46 956.5,-15097.46 956.5,-15045.46 1171.5,-15045.46 1171.5,-15097.46"/>
<text text-anchor="middle" x="1064" y="-15085.46" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1064" y="-15074.46" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1064" y="-15063.46" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1064" y="-15052.46" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_3_expert_select&#45;&gt;layer_3_experts_gpu4 -->
<g id="edge99" class="edge">
<title>layer_3_expert_select&#45;&gt;layer_3_experts_gpu4</title>
<path fill="none" stroke="black" d="M1000.36,-15133.38C1010.64,-15123.54 1021.12,-15113.51 1030.54,-15104.49"/>
<polygon fill="black" stroke="black" points="1033.04,-15106.95 1037.84,-15097.5 1028.19,-15101.89 1033.04,-15106.95"/>
</g>
<!-- layer_3_experts_gpu5 -->
<g id="node76" class="node">
<title>layer_3_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1404.5,-15097.46 1189.5,-15097.46 1189.5,-15045.46 1404.5,-15045.46 1404.5,-15097.46"/>
<text text-anchor="middle" x="1297" y="-15085.46" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1297" y="-15074.46" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1297" y="-15063.46" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1297" y="-15052.46" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_3_expert_select&#45;&gt;layer_3_experts_gpu5 -->
<g id="edge100" class="edge">
<title>layer_3_expert_select&#45;&gt;layer_3_experts_gpu5</title>
<path fill="none" stroke="black" d="M1105.1,-15133.87C1140.73,-15122.47 1177.3,-15110.76 1208.83,-15100.67"/>
<polygon fill="black" stroke="black" points="1209.99,-15103.98 1218.45,-15097.6 1207.86,-15097.31 1209.99,-15103.98"/>
</g>
<!-- layer_3_experts_gpu6 -->
<g id="node77" class="node">
<title>layer_3_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1637.5,-15097.46 1422.5,-15097.46 1422.5,-15045.46 1637.5,-15045.46 1637.5,-15097.46"/>
<text text-anchor="middle" x="1530" y="-15085.46" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1530" y="-15074.46" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1530" y="-15063.46" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1530" y="-15052.46" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_3_expert_select&#45;&gt;layer_3_experts_gpu6 -->
<g id="edge101" class="edge">
<title>layer_3_expert_select&#45;&gt;layer_3_experts_gpu6</title>
<path fill="none" stroke="black" d="M1124.63,-15152.58C1209.1,-15137.12 1311.73,-15117.91 1412.24,-15097.8"/>
<polygon fill="black" stroke="black" points="1413.16,-15101.18 1422.27,-15095.78 1411.78,-15094.32 1413.16,-15101.18"/>
</g>
<!-- layer_3_experts_gpu7 -->
<g id="node78" class="node">
<title>layer_3_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1870.5,-15097.46 1655.5,-15097.46 1655.5,-15045.46 1870.5,-15045.46 1870.5,-15097.46"/>
<text text-anchor="middle" x="1763" y="-15085.46" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1763" y="-15074.46" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1763" y="-15063.46" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1763" y="-15052.46" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_3_expert_select&#45;&gt;layer_3_experts_gpu7 -->
<g id="edge102" class="edge">
<title>layer_3_expert_select&#45;&gt;layer_3_experts_gpu7</title>
<path fill="none" stroke="black" d="M1138.18,-15165.32C1276.66,-15150.36 1468.43,-15127.38 1645.3,-15097.7"/>
<polygon fill="black" stroke="black" points="1646.04,-15101.12 1655.32,-15096.01 1644.87,-15094.22 1646.04,-15101.12"/>
</g>
<!-- layer_3_expert_comm -->
<g id="node79" class="node">
<title>layer_3_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="906" cy="-14972.69" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="906" y="-14986.69" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="906" y="-14975.69" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="906" y="-14964.69" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="906" y="-14953.69" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_3_experts_gpu0&#45;&gt;layer_3_expert_comm -->
<g id="edge103" class="edge">
<title>layer_3_experts_gpu0&#45;&gt;layer_3_expert_comm</title>
<path fill="none" stroke="black" d="M239.68,-15046.86C242.48,-15046.37 245.25,-15045.9 248,-15045.46 418.26,-15017.9 615.05,-14997.99 748.74,-14986.23"/>
<polygon fill="black" stroke="black" points="749.41,-14989.68 759.06,-14985.33 748.8,-14982.71 749.41,-14989.68"/>
</g>
<!-- layer_3_experts_gpu1&#45;&gt;layer_3_expert_comm -->
<g id="edge104" class="edge">
<title>layer_3_experts_gpu1&#45;&gt;layer_3_expert_comm</title>
<path fill="none" stroke="black" d="M472.71,-15047.07C475.5,-15046.52 478.27,-15045.99 481,-15045.46 576.51,-15027.11 684.58,-15008.9 767.84,-14995.41"/>
<polygon fill="black" stroke="black" points="768.56,-14998.84 777.87,-14993.79 767.44,-14991.93 768.56,-14998.84"/>
</g>
<!-- layer_3_experts_gpu2&#45;&gt;layer_3_expert_comm -->
<g id="edge105" class="edge">
<title>layer_3_experts_gpu2&#45;&gt;layer_3_expert_comm</title>
<path fill="none" stroke="black" d="M677.72,-15045.41C716.41,-15033.26 763.34,-15018.51 804.55,-15005.56"/>
<polygon fill="black" stroke="black" points="805.86,-15008.82 814.35,-15002.49 803.76,-15002.14 805.86,-15008.82"/>
</g>
<!-- layer_3_experts_gpu3&#45;&gt;layer_3_expert_comm -->
<g id="edge106" class="edge">
<title>layer_3_experts_gpu3&#45;&gt;layer_3_expert_comm</title>
<path fill="none" stroke="black" d="M850.51,-15045.29C857.22,-15036.63 864.95,-15026.66 872.45,-15016.97"/>
<polygon fill="black" stroke="black" points="875.32,-15018.98 878.68,-15008.94 869.79,-15014.7 875.32,-15018.98"/>
</g>
<!-- layer_3_experts_gpu4&#45;&gt;layer_3_expert_comm -->
<g id="edge107" class="edge">
<title>layer_3_experts_gpu4&#45;&gt;layer_3_expert_comm</title>
<path fill="none" stroke="black" d="M1022.9,-15045.29C1006.63,-15035.33 987.56,-15023.64 969.59,-15012.64"/>
<polygon fill="black" stroke="black" points="971.23,-15009.54 960.88,-15007.3 967.58,-15015.51 971.23,-15009.54"/>
</g>
<!-- layer_3_experts_gpu5&#45;&gt;layer_3_expert_comm -->
<g id="edge108" class="edge">
<title>layer_3_experts_gpu5&#45;&gt;layer_3_expert_comm</title>
<path fill="none" stroke="black" d="M1195.8,-15045.41C1142.44,-15032.21 1076.74,-15015.95 1021.41,-15002.25"/>
<polygon fill="black" stroke="black" points="1022.1,-14998.82 1011.55,-14999.81 1020.42,-15005.61 1022.1,-14998.82"/>
</g>
<!-- layer_3_experts_gpu6&#45;&gt;layer_3_expert_comm -->
<g id="edge109" class="edge">
<title>layer_3_experts_gpu6&#45;&gt;layer_3_expert_comm</title>
<path fill="none" stroke="black" d="M1422.3,-15046.97C1419.51,-15046.45 1416.74,-15045.95 1414,-15045.46 1293.07,-15023.92 1155.01,-15004.76 1053.37,-14991.66"/>
<polygon fill="black" stroke="black" points="1053.7,-14988.18 1043.34,-14990.38 1052.81,-14995.12 1053.7,-14988.18"/>
</g>
<!-- layer_3_experts_gpu7&#45;&gt;layer_3_expert_comm -->
<g id="edge110" class="edge">
<title>layer_3_experts_gpu7&#45;&gt;layer_3_expert_comm</title>
<path fill="none" stroke="black" d="M1655.33,-15046.81C1652.53,-15046.34 1649.75,-15045.89 1647,-15045.46 1448.03,-15014.49 1216.8,-14994.64 1066.26,-14983.84"/>
<polygon fill="black" stroke="black" points="1066.24,-14980.33 1056.02,-14983.11 1065.74,-14987.31 1066.24,-14980.33"/>
</g>
<!-- layer_3_moe_out -->
<g id="node80" class="node">
<title>layer_3_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1135.24,-14899.92 770.57,-14899.92 676.76,-14795.92 1041.43,-14795.92 1135.24,-14899.92"/>
<text text-anchor="middle" x="906" y="-14861.92" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="906" y="-14850.92" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="906" y="-14839.92" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="906" y="-14828.92" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_3_expert_comm&#45;&gt;layer_3_moe_out -->
<g id="edge111" class="edge">
<title>layer_3_expert_comm&#45;&gt;layer_3_moe_out</title>
<path fill="none" stroke="black" d="M906,-14935.85C906,-14927.81 906,-14919.06 906,-14910.32"/>
<polygon fill="black" stroke="black" points="909.5,-14910.09 906,-14900.09 902.5,-14910.09 909.5,-14910.09"/>
</g>
<!-- layer_3_norm -->
<g id="node81" class="node">
<title>layer_3_norm</title>
<polygon fill="lightgreen" stroke="black" points="1016.5,-14759.92 795.5,-14759.92 795.5,-14707.92 1016.5,-14707.92 1016.5,-14759.92"/>
<text text-anchor="middle" x="906" y="-14747.92" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="906" y="-14736.92" font-family="Arial" font-size="10.00">GPUs 0&#45;1</text>
<text text-anchor="middle" x="906" y="-14725.92" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="906" y="-14714.92" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_3_moe_out&#45;&gt;layer_3_norm -->
<g id="edge112" class="edge">
<title>layer_3_moe_out&#45;&gt;layer_3_norm</title>
<path fill="none" stroke="black" d="M906,-14795.84C906,-14787.17 906,-14778.35 906,-14770.21"/>
<polygon fill="black" stroke="black" points="909.5,-14769.96 906,-14759.96 902.5,-14769.96 909.5,-14769.96"/>
</g>
<!-- layer_4_input -->
<g id="node82" class="node">
<title>layer_4_input</title>
<polygon fill="lightyellow" stroke="black" points="1170.24,-14621.92 749.89,-14621.92 641.76,-14539.92 1062.11,-14539.92 1170.24,-14621.92"/>
<text text-anchor="middle" x="906" y="-14589.42" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="906" y="-14578.42" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="906" y="-14567.42" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_3_norm&#45;&gt;layer_4_input -->
<g id="edge113" class="edge">
<title>layer_3_norm&#45;&gt;layer_4_input</title>
<path fill="none" stroke="black" d="M906,-14707.65C906,-14687.13 906,-14657.57 906,-14632.26"/>
<polygon fill="black" stroke="black" points="909.5,-14632.08 906,-14622.08 902.5,-14632.08 909.5,-14632.08"/>
</g>
<!-- layer_4_qkv_tp0 -->
<g id="node83" class="node">
<title>layer_4_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="826.5,-14503.92 551.5,-14503.92 551.5,-14451.92 826.5,-14451.92 826.5,-14503.92"/>
<text text-anchor="middle" x="689" y="-14491.92" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="689" y="-14480.92" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="689" y="-14469.92" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="689" y="-14458.92" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_4_input&#45;&gt;layer_4_qkv_tp0 -->
<g id="edge114" class="edge">
<title>layer_4_input&#45;&gt;layer_4_qkv_tp0</title>
<path fill="none" stroke="black" d="M819.92,-14539.86C797.25,-14529.3 773.2,-14518.11 751.99,-14508.24"/>
<polygon fill="black" stroke="black" points="753.32,-14505 742.78,-14503.95 750.37,-14511.34 753.32,-14505"/>
</g>
<!-- layer_4_qkv_tp1 -->
<g id="node84" class="node">
<title>layer_4_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1119.5,-14503.92 844.5,-14503.92 844.5,-14451.92 1119.5,-14451.92 1119.5,-14503.92"/>
<text text-anchor="middle" x="982" y="-14491.92" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="982" y="-14480.92" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="982" y="-14469.92" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="982" y="-14458.92" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_4_input&#45;&gt;layer_4_qkv_tp1 -->
<g id="edge115" class="edge">
<title>layer_4_input&#45;&gt;layer_4_qkv_tp1</title>
<path fill="none" stroke="black" d="M936.26,-14539.71C943.09,-14530.63 950.28,-14521.07 956.88,-14512.3"/>
<polygon fill="black" stroke="black" points="959.78,-14514.27 963,-14504.17 954.19,-14510.06 959.78,-14514.27"/>
</g>
<!-- layer_4_attn_tp0 -->
<g id="node85" class="node">
<title>layer_4_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="823,-14415.92 561,-14415.92 561,-14363.92 823,-14363.92 823,-14415.92"/>
<text text-anchor="middle" x="692" y="-14403.92" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="692" y="-14392.92" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="692" y="-14381.92" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="692" y="-14370.92" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_4_qkv_tp0&#45;&gt;layer_4_attn_tp0 -->
<g id="edge116" class="edge">
<title>layer_4_qkv_tp0&#45;&gt;layer_4_attn_tp0</title>
<path fill="none" stroke="black" d="M689.88,-14451.58C690.16,-14443.62 690.47,-14434.68 690.77,-14426.17"/>
<polygon fill="black" stroke="black" points="694.27,-14426.19 691.12,-14416.08 687.28,-14425.95 694.27,-14426.19"/>
</g>
<!-- layer_4_attn_tp1 -->
<g id="node86" class="node">
<title>layer_4_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1109,-14415.92 847,-14415.92 847,-14363.92 1109,-14363.92 1109,-14415.92"/>
<text text-anchor="middle" x="978" y="-14403.92" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="978" y="-14392.92" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="978" y="-14381.92" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="978" y="-14370.92" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_4_qkv_tp1&#45;&gt;layer_4_attn_tp1 -->
<g id="edge117" class="edge">
<title>layer_4_qkv_tp1&#45;&gt;layer_4_attn_tp1</title>
<path fill="none" stroke="black" d="M980.82,-14451.58C980.45,-14443.62 980.04,-14434.68 979.64,-14426.17"/>
<polygon fill="black" stroke="black" points="983.13,-14425.9 979.17,-14416.08 976.14,-14426.23 983.13,-14425.9"/>
</g>
<!-- layer_4_attn_comm -->
<g id="node87" class="node">
<title>layer_4_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="956" cy="-14291.15" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="956" y="-14305.15" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="956" y="-14294.15" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="956" y="-14283.15" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="956" y="-14272.15" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_4_attn_tp0&#45;&gt;layer_4_attn_comm -->
<g id="edge118" class="edge">
<title>layer_4_attn_tp0&#45;&gt;layer_4_attn_comm</title>
<path fill="none" stroke="black" d="M760.33,-14363.87C791.89,-14352.31 829.84,-14338.4 863.88,-14325.92"/>
<polygon fill="black" stroke="black" points="865.18,-14329.17 873.37,-14322.44 862.77,-14322.6 865.18,-14329.17"/>
</g>
<!-- layer_4_attn_tp1&#45;&gt;layer_4_attn_comm -->
<g id="edge119" class="edge">
<title>layer_4_attn_tp1&#45;&gt;layer_4_attn_comm</title>
<path fill="none" stroke="black" d="M972.28,-14363.75C970.48,-14355.86 968.44,-14346.88 966.43,-14338.02"/>
<polygon fill="black" stroke="black" points="969.81,-14337.1 964.18,-14328.13 962.98,-14338.66 969.81,-14337.1"/>
</g>
<!-- layer_4_attn_out -->
<g id="node88" class="node">
<title>layer_4_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1066.5,-14218.38 845.5,-14218.38 845.5,-14166.38 1066.5,-14166.38 1066.5,-14218.38"/>
<text text-anchor="middle" x="956" y="-14206.38" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="956" y="-14195.38" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="956" y="-14184.38" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="956" y="-14173.38" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_4_attn_comm&#45;&gt;layer_4_attn_out -->
<g id="edge120" class="edge">
<title>layer_4_attn_comm&#45;&gt;layer_4_attn_out</title>
<path fill="none" stroke="black" d="M956,-14254.12C956,-14245.81 956,-14236.97 956,-14228.69"/>
<polygon fill="black" stroke="black" points="959.5,-14228.58 956,-14218.58 952.5,-14228.58 959.5,-14228.58"/>
</g>
<!-- layer_4_gate -->
<g id="node89" class="node">
<title>layer_4_gate</title>
<polygon fill="lightyellow" stroke="black" points="1210.01,-14130.38 805.94,-14130.38 701.99,-14026.38 1106.06,-14026.38 1210.01,-14130.38"/>
<text text-anchor="middle" x="956" y="-14092.38" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="956" y="-14081.38" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="956" y="-14070.38" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="956" y="-14059.38" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_4_attn_out&#45;&gt;layer_4_gate -->
<g id="edge121" class="edge">
<title>layer_4_attn_out&#45;&gt;layer_4_gate</title>
<path fill="none" stroke="black" d="M956,-14166.25C956,-14158.56 956,-14149.75 956,-14140.75"/>
<polygon fill="black" stroke="black" points="959.5,-14140.56 956,-14130.56 952.5,-14140.56 959.5,-14140.56"/>
</g>
<!-- layer_4_expert_select -->
<g id="node90" class="node">
<title>layer_4_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1222.39,-13990.38 798.62,-13990.38 689.61,-13886.38 1113.38,-13886.38 1222.39,-13990.38"/>
<text text-anchor="middle" x="956" y="-13952.38" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="956" y="-13941.38" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="956" y="-13930.38" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="956" y="-13919.38" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_4_gate&#45;&gt;layer_4_expert_select -->
<g id="edge122" class="edge">
<title>layer_4_gate&#45;&gt;layer_4_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M956,-14026C956,-14017.82 956,-14009.3 956,-14000.92"/>
<polygon fill="black" stroke="black" points="959.5,-14000.81 956,-13990.81 952.5,-14000.81 959.5,-14000.81"/>
</g>
<!-- layer_4_experts_gpu0 -->
<g id="node91" class="node">
<title>layer_4_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="247.5,-13850.38 32.5,-13850.38 32.5,-13798.38 247.5,-13798.38 247.5,-13850.38"/>
<text text-anchor="middle" x="140" y="-13838.38" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="140" y="-13827.38" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="140" y="-13816.38" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="140" y="-13805.38" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_4_expert_select&#45;&gt;layer_4_experts_gpu0 -->
<g id="edge123" class="edge">
<title>layer_4_expert_select&#45;&gt;layer_4_experts_gpu0</title>
<path fill="none" stroke="black" d="M717.5,-13913.04C584.57,-13898.18 415.96,-13877.19 257.62,-13850.61"/>
<polygon fill="black" stroke="black" points="258.13,-13847.14 247.68,-13848.93 256.96,-13854.05 258.13,-13847.14"/>
</g>
<!-- layer_4_experts_gpu1 -->
<g id="node92" class="node">
<title>layer_4_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="480.5,-13850.38 265.5,-13850.38 265.5,-13798.38 480.5,-13798.38 480.5,-13850.38"/>
<text text-anchor="middle" x="373" y="-13838.38" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="373" y="-13827.38" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="373" y="-13816.38" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="373" y="-13805.38" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_4_expert_select&#45;&gt;layer_4_experts_gpu1 -->
<g id="edge124" class="edge">
<title>layer_4_expert_select&#45;&gt;layer_4_experts_gpu1</title>
<path fill="none" stroke="black" d="M693.02,-13889.73C629.38,-13877.85 561.4,-13864.86 490.72,-13850.71"/>
<polygon fill="black" stroke="black" points="491.22,-13847.24 480.73,-13848.71 489.84,-13854.11 491.22,-13847.24"/>
</g>
<!-- layer_4_experts_gpu2 -->
<g id="node93" class="node">
<title>layer_4_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="713.5,-13850.38 498.5,-13850.38 498.5,-13798.38 713.5,-13798.38 713.5,-13850.38"/>
<text text-anchor="middle" x="606" y="-13838.38" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="606" y="-13827.38" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="606" y="-13816.38" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="606" y="-13805.38" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_4_expert_select&#45;&gt;layer_4_experts_gpu2 -->
<g id="edge125" class="edge">
<title>layer_4_expert_select&#45;&gt;layer_4_experts_gpu2</title>
<path fill="none" stroke="black" d="M796.62,-13886.38C761.45,-13875.13 725.43,-13863.6 694.31,-13853.64"/>
<polygon fill="black" stroke="black" points="694.98,-13850.18 684.39,-13850.47 692.84,-13856.85 694.98,-13850.18"/>
</g>
<!-- layer_4_experts_gpu3 -->
<g id="node94" class="node">
<title>layer_4_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="946.5,-13850.38 731.5,-13850.38 731.5,-13798.38 946.5,-13798.38 946.5,-13850.38"/>
<text text-anchor="middle" x="839" y="-13838.38" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="839" y="-13827.38" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="839" y="-13816.38" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="839" y="-13805.38" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_4_expert_select&#45;&gt;layer_4_experts_gpu3 -->
<g id="edge126" class="edge">
<title>layer_4_expert_select&#45;&gt;layer_4_experts_gpu3</title>
<path fill="none" stroke="black" d="M902.64,-13886.3C892.36,-13876.47 881.88,-13866.43 872.46,-13857.41"/>
<polygon fill="black" stroke="black" points="874.81,-13854.81 865.16,-13850.43 869.96,-13859.87 874.81,-13854.81"/>
</g>
<!-- layer_4_experts_gpu4 -->
<g id="node95" class="node">
<title>layer_4_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1179.5,-13850.38 964.5,-13850.38 964.5,-13798.38 1179.5,-13798.38 1179.5,-13850.38"/>
<text text-anchor="middle" x="1072" y="-13838.38" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1072" y="-13827.38" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1072" y="-13816.38" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1072" y="-13805.38" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_4_expert_select&#45;&gt;layer_4_experts_gpu4 -->
<g id="edge127" class="edge">
<title>layer_4_expert_select&#45;&gt;layer_4_experts_gpu4</title>
<path fill="none" stroke="black" d="M1008.91,-13886.3C1019.09,-13876.47 1029.49,-13866.43 1038.82,-13857.41"/>
<polygon fill="black" stroke="black" points="1041.3,-13859.89 1046.06,-13850.43 1036.44,-13854.85 1041.3,-13859.89"/>
</g>
<!-- layer_4_experts_gpu5 -->
<g id="node96" class="node">
<title>layer_4_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1412.5,-13850.38 1197.5,-13850.38 1197.5,-13798.38 1412.5,-13798.38 1412.5,-13850.38"/>
<text text-anchor="middle" x="1305" y="-13838.38" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1305" y="-13827.38" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1305" y="-13816.38" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1305" y="-13805.38" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_4_expert_select&#45;&gt;layer_4_experts_gpu5 -->
<g id="edge128" class="edge">
<title>layer_4_expert_select&#45;&gt;layer_4_experts_gpu5</title>
<path fill="none" stroke="black" d="M1113.91,-13886.71C1149.4,-13875.32 1185.82,-13863.63 1217.22,-13853.55"/>
<polygon fill="black" stroke="black" points="1218.34,-13856.87 1226.8,-13850.48 1216.21,-13850.2 1218.34,-13856.87"/>
</g>
<!-- layer_4_experts_gpu6 -->
<g id="node97" class="node">
<title>layer_4_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1645.5,-13850.38 1430.5,-13850.38 1430.5,-13798.38 1645.5,-13798.38 1645.5,-13850.38"/>
<text text-anchor="middle" x="1538" y="-13838.38" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1538" y="-13827.38" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1538" y="-13816.38" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1538" y="-13805.38" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_4_expert_select&#45;&gt;layer_4_experts_gpu6 -->
<g id="edge129" class="edge">
<title>layer_4_expert_select&#45;&gt;layer_4_experts_gpu6</title>
<path fill="none" stroke="black" d="M1133.53,-13905.43C1217.76,-13889.98 1320.06,-13870.79 1420.27,-13850.71"/>
<polygon fill="black" stroke="black" points="1421.16,-13854.11 1430.27,-13848.71 1419.78,-13847.24 1421.16,-13854.11"/>
</g>
<!-- layer_4_experts_gpu7 -->
<g id="node98" class="node">
<title>layer_4_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1878.5,-13850.38 1663.5,-13850.38 1663.5,-13798.38 1878.5,-13798.38 1878.5,-13850.38"/>
<text text-anchor="middle" x="1771" y="-13838.38" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1771" y="-13827.38" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1771" y="-13816.38" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1771" y="-13805.38" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_4_expert_select&#45;&gt;layer_4_experts_gpu7 -->
<g id="edge130" class="edge">
<title>layer_4_expert_select&#45;&gt;layer_4_experts_gpu7</title>
<path fill="none" stroke="black" d="M1146.91,-13918.23C1285.18,-13903.26 1476.68,-13880.27 1653.31,-13850.62"/>
<polygon fill="black" stroke="black" points="1654.04,-13854.05 1663.32,-13848.93 1652.87,-13847.14 1654.04,-13854.05"/>
</g>
<!-- layer_4_expert_comm -->
<g id="node99" class="node">
<title>layer_4_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="949" cy="-13725.61" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="949" y="-13739.61" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="949" y="-13728.61" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="949" y="-13717.61" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="949" y="-13706.61" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_4_experts_gpu0&#45;&gt;layer_4_expert_comm -->
<g id="edge131" class="edge">
<title>layer_4_experts_gpu0&#45;&gt;layer_4_expert_comm</title>
<path fill="none" stroke="black" d="M247.67,-13799.76C250.47,-13799.28 253.25,-13798.82 256,-13798.38 438.42,-13769.37 649.8,-13749.43 790.68,-13738.07"/>
<polygon fill="black" stroke="black" points="791.01,-13741.55 800.7,-13737.26 790.45,-13734.57 791.01,-13741.55"/>
</g>
<!-- layer_4_experts_gpu1&#45;&gt;layer_4_expert_comm -->
<g id="edge132" class="edge">
<title>layer_4_experts_gpu1&#45;&gt;layer_4_expert_comm</title>
<path fill="none" stroke="black" d="M480.71,-13799.95C483.5,-13799.41 486.27,-13798.89 489,-13798.38 594.9,-13778.73 715.19,-13760.09 806.19,-13746.73"/>
<polygon fill="black" stroke="black" points="806.91,-13750.16 816.3,-13745.25 805.9,-13743.24 806.91,-13750.16"/>
</g>
<!-- layer_4_experts_gpu2&#45;&gt;layer_4_expert_comm -->
<g id="edge133" class="edge">
<title>layer_4_experts_gpu2&#45;&gt;layer_4_expert_comm</title>
<path fill="none" stroke="black" d="M694.78,-13798.34C739.53,-13785.71 794.17,-13770.29 841.31,-13757"/>
<polygon fill="black" stroke="black" points="842.26,-13760.36 850.94,-13754.28 840.36,-13753.63 842.26,-13760.36"/>
</g>
<!-- layer_4_experts_gpu3&#45;&gt;layer_4_expert_comm -->
<g id="edge134" class="edge">
<title>layer_4_experts_gpu3&#45;&gt;layer_4_expert_comm</title>
<path fill="none" stroke="black" d="M867.61,-13798.21C878.06,-13789.02 890.17,-13778.37 901.8,-13768.14"/>
<polygon fill="black" stroke="black" points="904.15,-13770.73 909.35,-13761.49 899.53,-13765.47 904.15,-13770.73"/>
</g>
<!-- layer_4_experts_gpu4&#45;&gt;layer_4_expert_comm -->
<g id="edge135" class="edge">
<title>layer_4_experts_gpu4&#45;&gt;layer_4_expert_comm</title>
<path fill="none" stroke="black" d="M1040,-13798.21C1028.1,-13788.84 1014.26,-13777.95 1001.02,-13767.54"/>
<polygon fill="black" stroke="black" points="1002.9,-13764.56 992.87,-13761.13 998.57,-13770.06 1002.9,-13764.56"/>
</g>
<!-- layer_4_experts_gpu5&#45;&gt;layer_4_expert_comm -->
<g id="edge136" class="edge">
<title>layer_4_experts_gpu5&#45;&gt;layer_4_expert_comm</title>
<path fill="none" stroke="black" d="M1212.86,-13798.34C1165.83,-13785.55 1108.28,-13769.91 1058.95,-13756.5"/>
<polygon fill="black" stroke="black" points="1059.76,-13753.09 1049.2,-13753.85 1057.93,-13759.85 1059.76,-13753.09"/>
</g>
<!-- layer_4_experts_gpu6&#45;&gt;layer_4_expert_comm -->
<g id="edge137" class="edge">
<title>layer_4_experts_gpu6&#45;&gt;layer_4_expert_comm</title>
<path fill="none" stroke="black" d="M1430.3,-13799.93C1427.51,-13799.4 1424.74,-13798.88 1422,-13798.38 1312.04,-13778.21 1186.96,-13759.41 1093.05,-13746.12"/>
<polygon fill="black" stroke="black" points="1093.3,-13742.62 1082.91,-13744.69 1092.32,-13749.55 1093.3,-13742.62"/>
</g>
<!-- layer_4_experts_gpu7&#45;&gt;layer_4_expert_comm -->
<g id="edge138" class="edge">
<title>layer_4_experts_gpu7&#45;&gt;layer_4_expert_comm</title>
<path fill="none" stroke="black" d="M1663.33,-13799.75C1660.53,-13799.27 1657.75,-13798.82 1655,-13798.38 1468.28,-13768.86 1251.75,-13748.95 1108.23,-13737.73"/>
<polygon fill="black" stroke="black" points="1108.27,-13734.22 1098.03,-13736.93 1107.73,-13741.2 1108.27,-13734.22"/>
</g>
<!-- layer_4_moe_out -->
<g id="node100" class="node">
<title>layer_4_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1178.24,-13652.84 813.57,-13652.84 719.76,-13548.84 1084.43,-13548.84 1178.24,-13652.84"/>
<text text-anchor="middle" x="949" y="-13614.84" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="949" y="-13603.84" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="949" y="-13592.84" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="949" y="-13581.84" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_4_expert_comm&#45;&gt;layer_4_moe_out -->
<g id="edge139" class="edge">
<title>layer_4_expert_comm&#45;&gt;layer_4_moe_out</title>
<path fill="none" stroke="black" d="M949,-13688.77C949,-13680.74 949,-13671.99 949,-13663.24"/>
<polygon fill="black" stroke="black" points="952.5,-13663.01 949,-13653.01 945.5,-13663.01 952.5,-13663.01"/>
</g>
<!-- layer_4_norm -->
<g id="node101" class="node">
<title>layer_4_norm</title>
<polygon fill="lightgreen" stroke="black" points="1059.5,-13512.84 838.5,-13512.84 838.5,-13460.84 1059.5,-13460.84 1059.5,-13512.84"/>
<text text-anchor="middle" x="949" y="-13500.84" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="949" y="-13489.84" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="949" y="-13478.84" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="949" y="-13467.84" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_4_moe_out&#45;&gt;layer_4_norm -->
<g id="edge140" class="edge">
<title>layer_4_moe_out&#45;&gt;layer_4_norm</title>
<path fill="none" stroke="black" d="M949,-13548.76C949,-13540.09 949,-13531.27 949,-13523.13"/>
<polygon fill="black" stroke="black" points="952.5,-13522.89 949,-13512.89 945.5,-13522.89 952.5,-13522.89"/>
</g>
<!-- layer_5_input -->
<g id="node102" class="node">
<title>layer_5_input</title>
<polygon fill="lightyellow" stroke="black" points="1213.24,-13413.84 792.89,-13413.84 684.76,-13331.84 1105.11,-13331.84 1213.24,-13413.84"/>
<text text-anchor="middle" x="949" y="-13381.34" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="949" y="-13370.34" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="949" y="-13359.34" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_4_norm&#45;&gt;layer_5_input -->
<g id="edge141" class="edge">
<title>layer_4_norm&#45;&gt;layer_5_input</title>
<path fill="none" stroke="black" d="M949,-13460.71C949,-13450.03 949,-13437.17 949,-13424.65"/>
<polygon fill="black" stroke="black" points="952.5,-13424.28 949,-13414.28 945.5,-13424.28 952.5,-13424.28"/>
</g>
<!-- layer_5_qkv_tp0 -->
<g id="node103" class="node">
<title>layer_5_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="904.5,-13295.84 629.5,-13295.84 629.5,-13243.84 904.5,-13243.84 904.5,-13295.84"/>
<text text-anchor="middle" x="767" y="-13283.84" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="767" y="-13272.84" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="767" y="-13261.84" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="767" y="-13250.84" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_5_input&#45;&gt;layer_5_qkv_tp0 -->
<g id="edge142" class="edge">
<title>layer_5_input&#45;&gt;layer_5_qkv_tp0</title>
<path fill="none" stroke="black" d="M876.81,-13331.78C858.21,-13321.46 838.53,-13310.54 821.03,-13300.83"/>
<polygon fill="black" stroke="black" points="822.55,-13297.67 812.1,-13295.87 819.15,-13303.79 822.55,-13297.67"/>
</g>
<!-- layer_5_qkv_tp1 -->
<g id="node104" class="node">
<title>layer_5_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1197.5,-13295.84 922.5,-13295.84 922.5,-13243.84 1197.5,-13243.84 1197.5,-13295.84"/>
<text text-anchor="middle" x="1060" y="-13283.84" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1060" y="-13272.84" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1060" y="-13261.84" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1060" y="-13250.84" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_5_input&#45;&gt;layer_5_qkv_tp1 -->
<g id="edge143" class="edge">
<title>layer_5_input&#45;&gt;layer_5_qkv_tp1</title>
<path fill="none" stroke="black" d="M993.19,-13331.63C1003.69,-13322.08 1014.76,-13312.01 1024.8,-13302.87"/>
<polygon fill="black" stroke="black" points="1027.21,-13305.41 1032.25,-13296.09 1022.5,-13300.24 1027.21,-13305.41"/>
</g>
<!-- layer_5_attn_tp0 -->
<g id="node105" class="node">
<title>layer_5_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="902,-13207.84 640,-13207.84 640,-13155.84 902,-13155.84 902,-13207.84"/>
<text text-anchor="middle" x="771" y="-13195.84" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="771" y="-13184.84" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="771" y="-13173.84" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="771" y="-13162.84" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_5_qkv_tp0&#45;&gt;layer_5_attn_tp0 -->
<g id="edge144" class="edge">
<title>layer_5_qkv_tp0&#45;&gt;layer_5_attn_tp0</title>
<path fill="none" stroke="black" d="M768.18,-13243.51C768.55,-13235.54 768.96,-13226.61 769.36,-13218.09"/>
<polygon fill="black" stroke="black" points="772.86,-13218.15 769.83,-13208 765.87,-13217.83 772.86,-13218.15"/>
</g>
<!-- layer_5_attn_tp1 -->
<g id="node106" class="node">
<title>layer_5_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1188,-13207.84 926,-13207.84 926,-13155.84 1188,-13155.84 1188,-13207.84"/>
<text text-anchor="middle" x="1057" y="-13195.84" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1057" y="-13184.84" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1057" y="-13173.84" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1057" y="-13162.84" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_5_qkv_tp1&#45;&gt;layer_5_attn_tp1 -->
<g id="edge145" class="edge">
<title>layer_5_qkv_tp1&#45;&gt;layer_5_attn_tp1</title>
<path fill="none" stroke="black" d="M1059.12,-13243.51C1058.84,-13235.54 1058.53,-13226.61 1058.23,-13218.09"/>
<polygon fill="black" stroke="black" points="1061.72,-13217.87 1057.88,-13208 1054.73,-13218.12 1061.72,-13217.87"/>
</g>
<!-- layer_5_attn_comm -->
<g id="node107" class="node">
<title>layer_5_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="914" cy="-13083.07" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="914" y="-13097.07" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="914" y="-13086.07" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="914" y="-13075.07" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="914" y="-13064.07" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_5_attn_tp0&#45;&gt;layer_5_attn_comm -->
<g id="edge146" class="edge">
<title>layer_5_attn_tp0&#45;&gt;layer_5_attn_comm</title>
<path fill="none" stroke="black" d="M808.2,-13155.67C822.51,-13145.98 839.23,-13134.67 855.09,-13123.94"/>
<polygon fill="black" stroke="black" points="857.48,-13126.55 863.8,-13118.05 853.55,-13120.75 857.48,-13126.55"/>
</g>
<!-- layer_5_attn_tp1&#45;&gt;layer_5_attn_comm -->
<g id="edge147" class="edge">
<title>layer_5_attn_tp1&#45;&gt;layer_5_attn_comm</title>
<path fill="none" stroke="black" d="M1019.8,-13155.67C1005.49,-13145.98 988.77,-13134.67 972.91,-13123.94"/>
<polygon fill="black" stroke="black" points="974.45,-13120.75 964.2,-13118.05 970.52,-13126.55 974.45,-13120.75"/>
</g>
<!-- layer_5_attn_out -->
<g id="node108" class="node">
<title>layer_5_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1024.5,-13010.3 803.5,-13010.3 803.5,-12958.3 1024.5,-12958.3 1024.5,-13010.3"/>
<text text-anchor="middle" x="914" y="-12998.3" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="914" y="-12987.3" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="914" y="-12976.3" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="914" y="-12965.3" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_5_attn_comm&#45;&gt;layer_5_attn_out -->
<g id="edge148" class="edge">
<title>layer_5_attn_comm&#45;&gt;layer_5_attn_out</title>
<path fill="none" stroke="black" d="M914,-13046.04C914,-13037.73 914,-13028.89 914,-13020.61"/>
<polygon fill="black" stroke="black" points="917.5,-13020.5 914,-13010.5 910.5,-13020.5 917.5,-13020.5"/>
</g>
<!-- layer_5_gate -->
<g id="node109" class="node">
<title>layer_5_gate</title>
<polygon fill="lightyellow" stroke="black" points="1168.01,-12922.3 763.94,-12922.3 659.99,-12818.3 1064.06,-12818.3 1168.01,-12922.3"/>
<text text-anchor="middle" x="914" y="-12884.3" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="914" y="-12873.3" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="914" y="-12862.3" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="914" y="-12851.3" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_5_attn_out&#45;&gt;layer_5_gate -->
<g id="edge149" class="edge">
<title>layer_5_attn_out&#45;&gt;layer_5_gate</title>
<path fill="none" stroke="black" d="M914,-12958.17C914,-12950.48 914,-12941.67 914,-12932.67"/>
<polygon fill="black" stroke="black" points="917.5,-12932.48 914,-12922.48 910.5,-12932.48 917.5,-12932.48"/>
</g>
<!-- layer_5_expert_select -->
<g id="node110" class="node">
<title>layer_5_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1180.39,-12782.3 756.62,-12782.3 647.61,-12678.3 1071.38,-12678.3 1180.39,-12782.3"/>
<text text-anchor="middle" x="914" y="-12744.3" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="914" y="-12733.3" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="914" y="-12722.3" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="914" y="-12711.3" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_5_gate&#45;&gt;layer_5_expert_select -->
<g id="edge150" class="edge">
<title>layer_5_gate&#45;&gt;layer_5_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M914,-12817.92C914,-12809.75 914,-12801.22 914,-12792.84"/>
<polygon fill="black" stroke="black" points="917.5,-12792.73 914,-12782.73 910.5,-12792.73 917.5,-12792.73"/>
</g>
<!-- layer_5_experts_gpu0 -->
<g id="node111" class="node">
<title>layer_5_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="247.5,-12642.3 32.5,-12642.3 32.5,-12590.3 247.5,-12590.3 247.5,-12642.3"/>
<text text-anchor="middle" x="140" y="-12630.3" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="140" y="-12619.3" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="140" y="-12608.3" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="140" y="-12597.3" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_5_expert_select&#45;&gt;layer_5_experts_gpu0 -->
<g id="edge151" class="edge">
<title>layer_5_expert_select&#45;&gt;layer_5_experts_gpu0</title>
<path fill="none" stroke="black" d="M672.26,-12702.09C550.49,-12687.2 400.45,-12667.09 257.94,-12642.59"/>
<polygon fill="black" stroke="black" points="258.14,-12639.08 247.69,-12640.82 256.95,-12645.97 258.14,-12639.08"/>
</g>
<!-- layer_5_experts_gpu1 -->
<g id="node112" class="node">
<title>layer_5_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="480.5,-12642.3 265.5,-12642.3 265.5,-12590.3 480.5,-12590.3 480.5,-12642.3"/>
<text text-anchor="middle" x="373" y="-12630.3" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="373" y="-12619.3" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="373" y="-12608.3" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="373" y="-12597.3" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_5_expert_select&#45;&gt;layer_5_experts_gpu1 -->
<g id="edge152" class="edge">
<title>layer_5_expert_select&#45;&gt;layer_5_experts_gpu1</title>
<path fill="none" stroke="black" d="M662.49,-12678.27C608.44,-12667.18 551.46,-12655.41 490.89,-12642.69"/>
<polygon fill="black" stroke="black" points="491.25,-12639.19 480.74,-12640.56 489.81,-12646.04 491.25,-12639.19"/>
</g>
<!-- layer_5_experts_gpu2 -->
<g id="node113" class="node">
<title>layer_5_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="713.5,-12642.3 498.5,-12642.3 498.5,-12590.3 713.5,-12590.3 713.5,-12642.3"/>
<text text-anchor="middle" x="606" y="-12630.3" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="606" y="-12619.3" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="606" y="-12608.3" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="606" y="-12597.3" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_5_expert_select&#45;&gt;layer_5_experts_gpu2 -->
<g id="edge153" class="edge">
<title>layer_5_expert_select&#45;&gt;layer_5_experts_gpu2</title>
<path fill="none" stroke="black" d="M773.52,-12678.22C742.86,-12667.07 711.49,-12655.66 684.3,-12645.78"/>
<polygon fill="black" stroke="black" points="685.46,-12642.48 674.87,-12642.35 683.07,-12649.05 685.46,-12642.48"/>
</g>
<!-- layer_5_experts_gpu3 -->
<g id="node114" class="node">
<title>layer_5_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="946.5,-12642.3 731.5,-12642.3 731.5,-12590.3 946.5,-12590.3 946.5,-12642.3"/>
<text text-anchor="middle" x="839" y="-12630.3" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="839" y="-12619.3" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="839" y="-12608.3" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="839" y="-12597.3" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_5_expert_select&#45;&gt;layer_5_experts_gpu3 -->
<g id="edge154" class="edge">
<title>layer_5_expert_select&#45;&gt;layer_5_experts_gpu3</title>
<path fill="none" stroke="black" d="M879.79,-12678.22C873.53,-12668.87 867.15,-12659.34 861.35,-12650.68"/>
<polygon fill="black" stroke="black" points="864.24,-12648.71 855.77,-12642.35 858.43,-12652.6 864.24,-12648.71"/>
</g>
<!-- layer_5_experts_gpu4 -->
<g id="node115" class="node">
<title>layer_5_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1179.5,-12642.3 964.5,-12642.3 964.5,-12590.3 1179.5,-12590.3 1179.5,-12642.3"/>
<text text-anchor="middle" x="1072" y="-12630.3" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1072" y="-12619.3" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1072" y="-12608.3" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1072" y="-12597.3" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_5_expert_select&#45;&gt;layer_5_experts_gpu4 -->
<g id="edge155" class="edge">
<title>layer_5_expert_select&#45;&gt;layer_5_experts_gpu4</title>
<path fill="none" stroke="black" d="M986.06,-12678.22C1000.49,-12668 1015.22,-12657.56 1028.32,-12648.27"/>
<polygon fill="black" stroke="black" points="1030.54,-12650.99 1036.67,-12642.35 1026.49,-12645.28 1030.54,-12650.99"/>
</g>
<!-- layer_5_experts_gpu5 -->
<g id="node116" class="node">
<title>layer_5_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1412.5,-12642.3 1197.5,-12642.3 1197.5,-12590.3 1412.5,-12590.3 1412.5,-12642.3"/>
<text text-anchor="middle" x="1305" y="-12630.3" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1305" y="-12619.3" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1305" y="-12608.3" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1305" y="-12597.3" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_5_expert_select&#45;&gt;layer_5_experts_gpu5 -->
<g id="edge156" class="edge">
<title>layer_5_expert_select&#45;&gt;layer_5_experts_gpu5</title>
<path fill="none" stroke="black" d="M1076.42,-12682.78C1121.1,-12669.98 1168.15,-12656.5 1207.88,-12645.12"/>
<polygon fill="black" stroke="black" points="1208.9,-12648.47 1217.55,-12642.35 1206.97,-12641.74 1208.9,-12648.47"/>
</g>
<!-- layer_5_experts_gpu6 -->
<g id="node117" class="node">
<title>layer_5_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1645.5,-12642.3 1430.5,-12642.3 1430.5,-12590.3 1645.5,-12590.3 1645.5,-12642.3"/>
<text text-anchor="middle" x="1538" y="-12630.3" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1538" y="-12619.3" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1538" y="-12608.3" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1538" y="-12597.3" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_5_expert_select&#45;&gt;layer_5_experts_gpu6 -->
<g id="edge157" class="edge">
<title>layer_5_expert_select&#45;&gt;layer_5_experts_gpu6</title>
<path fill="none" stroke="black" d="M1094.49,-12700.32C1188.95,-12684.67 1306.73,-12664.44 1420.36,-12642.6"/>
<polygon fill="black" stroke="black" points="1421.13,-12646.01 1430.28,-12640.68 1419.8,-12639.14 1421.13,-12646.01"/>
</g>
<!-- layer_5_experts_gpu7 -->
<g id="node118" class="node">
<title>layer_5_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1878.5,-12642.3 1663.5,-12642.3 1663.5,-12590.3 1878.5,-12590.3 1878.5,-12642.3"/>
<text text-anchor="middle" x="1771" y="-12630.3" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1771" y="-12619.3" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1771" y="-12608.3" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1771" y="-12597.3" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_5_expert_select&#45;&gt;layer_5_experts_gpu7 -->
<g id="edge158" class="edge">
<title>layer_5_expert_select&#45;&gt;layer_5_experts_gpu7</title>
<path fill="none" stroke="black" d="M1106.62,-12711.77C1254.04,-12697.15 1462.45,-12673.89 1653.38,-12642.52"/>
<polygon fill="black" stroke="black" points="1654.02,-12645.96 1663.32,-12640.88 1652.88,-12639.05 1654.02,-12645.96"/>
</g>
<!-- layer_5_expert_comm -->
<g id="node119" class="node">
<title>layer_5_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1000" cy="-12517.53" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1000" y="-12531.53" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1000" y="-12520.53" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="1000" y="-12509.53" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1000" y="-12498.53" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_5_experts_gpu0&#45;&gt;layer_5_expert_comm -->
<g id="edge159" class="edge">
<title>layer_5_experts_gpu0&#45;&gt;layer_5_expert_comm</title>
<path fill="none" stroke="black" d="M247.67,-12591.66C250.47,-12591.18 253.25,-12590.73 256,-12590.3 455.93,-12559.22 688.31,-12539.38 839.44,-12528.61"/>
<polygon fill="black" stroke="black" points="840,-12532.08 849.73,-12527.89 839.51,-12525.1 840,-12532.08"/>
</g>
<!-- layer_5_experts_gpu1&#45;&gt;layer_5_expert_comm -->
<g id="edge160" class="edge">
<title>layer_5_experts_gpu1&#45;&gt;layer_5_expert_comm</title>
<path fill="none" stroke="black" d="M480.7,-12591.82C483.49,-12591.3 486.26,-12590.79 489,-12590.3 610.85,-12568.65 750,-12549.46 852.3,-12536.39"/>
<polygon fill="black" stroke="black" points="852.91,-12539.84 862.39,-12535.1 852.03,-12532.9 852.91,-12539.84"/>
</g>
<!-- layer_5_experts_gpu2&#45;&gt;layer_5_expert_comm -->
<g id="edge161" class="edge">
<title>layer_5_experts_gpu2&#45;&gt;layer_5_expert_comm</title>
<path fill="none" stroke="black" d="M707.98,-12590.26C761.86,-12577.02 828.21,-12560.73 884.04,-12547.01"/>
<polygon fill="black" stroke="black" points="885.1,-12550.36 893.98,-12544.57 883.44,-12543.56 885.1,-12550.36"/>
</g>
<!-- layer_5_experts_gpu3&#45;&gt;layer_5_expert_comm -->
<g id="edge162" class="edge">
<title>layer_5_experts_gpu3&#45;&gt;layer_5_expert_comm</title>
<path fill="none" stroke="black" d="M880.88,-12590.13C897.61,-12580.08 917.26,-12568.27 935.72,-12557.17"/>
<polygon fill="black" stroke="black" points="937.61,-12560.12 944.38,-12551.96 934.01,-12554.12 937.61,-12560.12"/>
</g>
<!-- layer_5_experts_gpu4&#45;&gt;layer_5_expert_comm -->
<g id="edge163" class="edge">
<title>layer_5_experts_gpu4&#45;&gt;layer_5_expert_comm</title>
<path fill="none" stroke="black" d="M1053.27,-12590.13C1046.95,-12581.64 1039.71,-12571.9 1032.64,-12562.4"/>
<polygon fill="black" stroke="black" points="1035.27,-12560.08 1026.5,-12554.14 1029.66,-12564.26 1035.27,-12560.08"/>
</g>
<!-- layer_5_experts_gpu5&#45;&gt;layer_5_expert_comm -->
<g id="edge164" class="edge">
<title>layer_5_experts_gpu5&#45;&gt;layer_5_expert_comm</title>
<path fill="none" stroke="black" d="M1226.06,-12590.26C1187.9,-12578.15 1141.67,-12563.48 1100.98,-12550.57"/>
<polygon fill="black" stroke="black" points="1101.9,-12547.19 1091.31,-12547.5 1099.78,-12553.87 1101.9,-12547.19"/>
</g>
<!-- layer_5_experts_gpu6&#45;&gt;layer_5_expert_comm -->
<g id="edge165" class="edge">
<title>layer_5_experts_gpu6&#45;&gt;layer_5_expert_comm</title>
<path fill="none" stroke="black" d="M1430.29,-12591.92C1427.5,-12591.37 1424.73,-12590.83 1422,-12590.3 1327.33,-12572.06 1220.25,-12553.88 1137.63,-12540.38"/>
<polygon fill="black" stroke="black" points="1138.12,-12536.91 1127.68,-12538.76 1136.99,-12543.82 1138.12,-12536.91"/>
</g>
<!-- layer_5_experts_gpu7&#45;&gt;layer_5_expert_comm -->
<g id="edge166" class="edge">
<title>layer_5_experts_gpu7&#45;&gt;layer_5_expert_comm</title>
<path fill="none" stroke="black" d="M1663.32,-12591.7C1660.52,-12591.22 1657.75,-12590.75 1655,-12590.3 1485.79,-12562.87 1290.25,-12542.97 1157.19,-12531.17"/>
<polygon fill="black" stroke="black" points="1157.18,-12527.66 1146.92,-12530.27 1156.57,-12534.63 1157.18,-12527.66"/>
</g>
<!-- layer_5_moe_out -->
<g id="node120" class="node">
<title>layer_5_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1229.24,-12444.76 864.57,-12444.76 770.76,-12340.76 1135.43,-12340.76 1229.24,-12444.76"/>
<text text-anchor="middle" x="1000" y="-12406.76" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="1000" y="-12395.76" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="1000" y="-12384.76" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1000" y="-12373.76" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_5_expert_comm&#45;&gt;layer_5_moe_out -->
<g id="edge167" class="edge">
<title>layer_5_expert_comm&#45;&gt;layer_5_moe_out</title>
<path fill="none" stroke="black" d="M1000,-12480.69C1000,-12472.66 1000,-12463.91 1000,-12455.16"/>
<polygon fill="black" stroke="black" points="1003.5,-12454.93 1000,-12444.93 996.5,-12454.93 1003.5,-12454.93"/>
</g>
<!-- layer_5_norm -->
<g id="node121" class="node">
<title>layer_5_norm</title>
<polygon fill="lightgreen" stroke="black" points="1110.5,-12304.76 889.5,-12304.76 889.5,-12252.76 1110.5,-12252.76 1110.5,-12304.76"/>
<text text-anchor="middle" x="1000" y="-12292.76" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="1000" y="-12281.76" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="1000" y="-12270.76" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1000" y="-12259.76" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_5_moe_out&#45;&gt;layer_5_norm -->
<g id="edge168" class="edge">
<title>layer_5_moe_out&#45;&gt;layer_5_norm</title>
<path fill="none" stroke="black" d="M1000,-12340.68C1000,-12332.02 1000,-12323.19 1000,-12315.05"/>
<polygon fill="black" stroke="black" points="1003.5,-12314.81 1000,-12304.81 996.5,-12314.81 1003.5,-12314.81"/>
</g>
<!-- layer_6_input -->
<g id="node122" class="node">
<title>layer_6_input</title>
<polygon fill="lightyellow" stroke="black" points="1264.24,-12205.76 843.89,-12205.76 735.76,-12123.76 1156.11,-12123.76 1264.24,-12205.76"/>
<text text-anchor="middle" x="1000" y="-12173.26" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="1000" y="-12162.26" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1000" y="-12151.26" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_5_norm&#45;&gt;layer_6_input -->
<g id="edge169" class="edge">
<title>layer_5_norm&#45;&gt;layer_6_input</title>
<path fill="none" stroke="black" d="M1000,-12252.63C1000,-12241.95 1000,-12229.09 1000,-12216.57"/>
<polygon fill="black" stroke="black" points="1003.5,-12216.2 1000,-12206.2 996.5,-12216.2 1003.5,-12216.2"/>
</g>
<!-- layer_6_qkv_tp0 -->
<g id="node123" class="node">
<title>layer_6_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1065.5,-12087.76 790.5,-12087.76 790.5,-12035.76 1065.5,-12035.76 1065.5,-12087.76"/>
<text text-anchor="middle" x="928" y="-12075.76" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="928" y="-12064.76" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="928" y="-12053.76" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="928" y="-12042.76" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_6_input&#45;&gt;layer_6_qkv_tp0 -->
<g id="edge170" class="edge">
<title>layer_6_input&#45;&gt;layer_6_qkv_tp0</title>
<path fill="none" stroke="black" d="M971.34,-12123.56C964.93,-12114.56 958.19,-12105.11 951.99,-12096.42"/>
<polygon fill="black" stroke="black" points="954.66,-12094.13 946,-12088.02 948.96,-12098.19 954.66,-12094.13"/>
</g>
<!-- layer_6_qkv_tp1 -->
<g id="node124" class="node">
<title>layer_6_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1358.5,-12087.76 1083.5,-12087.76 1083.5,-12035.76 1358.5,-12035.76 1358.5,-12087.76"/>
<text text-anchor="middle" x="1221" y="-12075.76" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1221" y="-12064.76" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1221" y="-12053.76" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1221" y="-12042.76" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_6_input&#45;&gt;layer_6_qkv_tp1 -->
<g id="edge171" class="edge">
<title>layer_6_input&#45;&gt;layer_6_qkv_tp1</title>
<path fill="none" stroke="black" d="M1087.66,-12123.7C1110.86,-12113.1 1135.46,-12101.86 1157.14,-12091.95"/>
<polygon fill="black" stroke="black" points="1158.59,-12095.14 1166.23,-12087.8 1155.68,-12088.77 1158.59,-12095.14"/>
</g>
<!-- layer_6_attn_tp0 -->
<g id="node125" class="node">
<title>layer_6_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1063,-11999.76 801,-11999.76 801,-11947.76 1063,-11947.76 1063,-11999.76"/>
<text text-anchor="middle" x="932" y="-11987.76" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="932" y="-11976.76" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="932" y="-11965.76" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="932" y="-11954.76" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_6_qkv_tp0&#45;&gt;layer_6_attn_tp0 -->
<g id="edge172" class="edge">
<title>layer_6_qkv_tp0&#45;&gt;layer_6_attn_tp0</title>
<path fill="none" stroke="black" d="M929.18,-12035.43C929.55,-12027.47 929.96,-12018.53 930.36,-12010.01"/>
<polygon fill="black" stroke="black" points="933.86,-12010.07 930.83,-11999.92 926.87,-12009.75 933.86,-12010.07"/>
</g>
<!-- layer_6_attn_tp1 -->
<g id="node126" class="node">
<title>layer_6_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1349,-11999.76 1087,-11999.76 1087,-11947.76 1349,-11947.76 1349,-11999.76"/>
<text text-anchor="middle" x="1218" y="-11987.76" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1218" y="-11976.76" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1218" y="-11965.76" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1218" y="-11954.76" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_6_qkv_tp1&#45;&gt;layer_6_attn_tp1 -->
<g id="edge173" class="edge">
<title>layer_6_qkv_tp1&#45;&gt;layer_6_attn_tp1</title>
<path fill="none" stroke="black" d="M1220.12,-12035.43C1219.84,-12027.47 1219.53,-12018.53 1219.23,-12010.01"/>
<polygon fill="black" stroke="black" points="1222.72,-12009.79 1218.88,-11999.92 1215.73,-12010.04 1222.72,-12009.79"/>
</g>
<!-- layer_6_attn_comm -->
<g id="node127" class="node">
<title>layer_6_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="955" cy="-11875" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="955" y="-11889" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="955" y="-11878" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="955" y="-11867" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="955" y="-11856" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_6_attn_tp0&#45;&gt;layer_6_attn_comm -->
<g id="edge174" class="edge">
<title>layer_6_attn_tp0&#45;&gt;layer_6_attn_comm</title>
<path fill="none" stroke="black" d="M937.98,-11947.59C939.86,-11939.7 941.99,-11930.73 944.1,-11921.86"/>
<polygon fill="black" stroke="black" points="947.54,-11922.51 946.45,-11911.97 940.73,-11920.89 947.54,-11922.51"/>
</g>
<!-- layer_6_attn_tp1&#45;&gt;layer_6_attn_comm -->
<g id="edge175" class="edge">
<title>layer_6_attn_tp1&#45;&gt;layer_6_attn_comm</title>
<path fill="none" stroke="black" d="M1149.93,-11947.72C1118.49,-11936.15 1080.69,-11922.24 1046.77,-11909.76"/>
<polygon fill="black" stroke="black" points="1047.91,-11906.45 1037.32,-11906.28 1045.5,-11913.02 1047.91,-11906.45"/>
</g>
<!-- layer_6_attn_out -->
<g id="node128" class="node">
<title>layer_6_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1065.5,-11802.23 844.5,-11802.23 844.5,-11750.23 1065.5,-11750.23 1065.5,-11802.23"/>
<text text-anchor="middle" x="955" y="-11790.23" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="955" y="-11779.23" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="955" y="-11768.23" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="955" y="-11757.23" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_6_attn_comm&#45;&gt;layer_6_attn_out -->
<g id="edge176" class="edge">
<title>layer_6_attn_comm&#45;&gt;layer_6_attn_out</title>
<path fill="none" stroke="black" d="M955,-11837.96C955,-11829.65 955,-11820.82 955,-11812.53"/>
<polygon fill="black" stroke="black" points="958.5,-11812.42 955,-11802.42 951.5,-11812.42 958.5,-11812.42"/>
</g>
<!-- layer_6_gate -->
<g id="node129" class="node">
<title>layer_6_gate</title>
<polygon fill="lightyellow" stroke="black" points="1209.01,-11714.23 804.94,-11714.23 700.99,-11610.23 1105.06,-11610.23 1209.01,-11714.23"/>
<text text-anchor="middle" x="955" y="-11676.23" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="955" y="-11665.23" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="955" y="-11654.23" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="955" y="-11643.23" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_6_attn_out&#45;&gt;layer_6_gate -->
<g id="edge177" class="edge">
<title>layer_6_attn_out&#45;&gt;layer_6_gate</title>
<path fill="none" stroke="black" d="M955,-11750.09C955,-11742.41 955,-11733.59 955,-11724.59"/>
<polygon fill="black" stroke="black" points="958.5,-11724.4 955,-11714.4 951.5,-11724.4 958.5,-11724.4"/>
</g>
<!-- layer_6_expert_select -->
<g id="node130" class="node">
<title>layer_6_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1221.39,-11574.23 797.62,-11574.23 688.61,-11470.23 1112.38,-11470.23 1221.39,-11574.23"/>
<text text-anchor="middle" x="955" y="-11536.23" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="955" y="-11525.23" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="955" y="-11514.23" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="955" y="-11503.23" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_6_gate&#45;&gt;layer_6_expert_select -->
<g id="edge178" class="edge">
<title>layer_6_gate&#45;&gt;layer_6_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M955,-11609.84C955,-11601.67 955,-11593.14 955,-11584.77"/>
<polygon fill="black" stroke="black" points="958.5,-11584.65 955,-11574.65 951.5,-11584.65 958.5,-11584.65"/>
</g>
<!-- layer_6_experts_gpu0 -->
<g id="node131" class="node">
<title>layer_6_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="247.5,-11434.23 32.5,-11434.23 32.5,-11382.23 247.5,-11382.23 247.5,-11434.23"/>
<text text-anchor="middle" x="140" y="-11422.23" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="140" y="-11411.23" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="140" y="-11400.23" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="140" y="-11389.23" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_6_expert_select&#45;&gt;layer_6_experts_gpu0 -->
<g id="edge179" class="edge">
<title>layer_6_expert_select&#45;&gt;layer_6_experts_gpu0</title>
<path fill="none" stroke="black" d="M716.44,-11496.82C583.76,-11481.96 415.58,-11460.98 257.59,-11434.45"/>
<polygon fill="black" stroke="black" points="258.13,-11430.99 247.68,-11432.77 256.96,-11437.89 258.13,-11430.99"/>
</g>
<!-- layer_6_experts_gpu1 -->
<g id="node132" class="node">
<title>layer_6_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="480.5,-11434.23 265.5,-11434.23 265.5,-11382.23 480.5,-11382.23 480.5,-11434.23"/>
<text text-anchor="middle" x="373" y="-11422.23" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="373" y="-11411.23" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="373" y="-11400.23" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="373" y="-11389.23" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_6_expert_select&#45;&gt;layer_6_experts_gpu1 -->
<g id="edge180" class="edge">
<title>layer_6_expert_select&#45;&gt;layer_6_experts_gpu1</title>
<path fill="none" stroke="black" d="M691.97,-11473.44C628.64,-11461.58 561.03,-11448.65 490.67,-11434.55"/>
<polygon fill="black" stroke="black" points="491.22,-11431.09 480.73,-11432.55 489.84,-11437.95 491.22,-11431.09"/>
</g>
<!-- layer_6_experts_gpu2 -->
<g id="node133" class="node">
<title>layer_6_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="713.5,-11434.23 498.5,-11434.23 498.5,-11382.23 713.5,-11382.23 713.5,-11434.23"/>
<text text-anchor="middle" x="606" y="-11422.23" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="606" y="-11411.23" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="606" y="-11400.23" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="606" y="-11389.23" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_6_expert_select&#45;&gt;layer_6_experts_gpu2 -->
<g id="edge181" class="edge">
<title>layer_6_expert_select&#45;&gt;layer_6_experts_gpu2</title>
<path fill="none" stroke="black" d="M796.07,-11470.22C761.01,-11458.97 725.09,-11447.44 694.06,-11437.49"/>
<polygon fill="black" stroke="black" points="694.75,-11434.03 684.16,-11434.31 692.62,-11440.7 694.75,-11434.03"/>
</g>
<!-- layer_6_experts_gpu3 -->
<g id="node134" class="node">
<title>layer_6_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="946.5,-11434.23 731.5,-11434.23 731.5,-11382.23 946.5,-11382.23 946.5,-11434.23"/>
<text text-anchor="middle" x="839" y="-11422.23" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="839" y="-11411.23" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="839" y="-11400.23" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="839" y="-11389.23" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_6_expert_select&#45;&gt;layer_6_experts_gpu3 -->
<g id="edge182" class="edge">
<title>layer_6_expert_select&#45;&gt;layer_6_experts_gpu3</title>
<path fill="none" stroke="black" d="M902.09,-11470.14C891.91,-11460.31 881.51,-11450.27 872.18,-11441.26"/>
<polygon fill="black" stroke="black" points="874.56,-11438.7 864.94,-11434.27 869.7,-11443.73 874.56,-11438.7"/>
</g>
<!-- layer_6_experts_gpu4 -->
<g id="node135" class="node">
<title>layer_6_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1179.5,-11434.23 964.5,-11434.23 964.5,-11382.23 1179.5,-11382.23 1179.5,-11434.23"/>
<text text-anchor="middle" x="1072" y="-11422.23" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1072" y="-11411.23" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1072" y="-11400.23" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1072" y="-11389.23" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_6_expert_select&#45;&gt;layer_6_experts_gpu4 -->
<g id="edge183" class="edge">
<title>layer_6_expert_select&#45;&gt;layer_6_experts_gpu4</title>
<path fill="none" stroke="black" d="M1008.36,-11470.14C1018.64,-11460.31 1029.12,-11450.27 1038.54,-11441.26"/>
<polygon fill="black" stroke="black" points="1041.04,-11443.71 1045.84,-11434.27 1036.19,-11438.66 1041.04,-11443.71"/>
</g>
<!-- layer_6_experts_gpu5 -->
<g id="node136" class="node">
<title>layer_6_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1412.5,-11434.23 1197.5,-11434.23 1197.5,-11382.23 1412.5,-11382.23 1412.5,-11434.23"/>
<text text-anchor="middle" x="1305" y="-11422.23" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1305" y="-11411.23" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1305" y="-11400.23" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1305" y="-11389.23" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_6_expert_select&#45;&gt;layer_6_experts_gpu5 -->
<g id="edge184" class="edge">
<title>layer_6_expert_select&#45;&gt;layer_6_experts_gpu5</title>
<path fill="none" stroke="black" d="M1113.1,-11470.63C1148.73,-11459.23 1185.3,-11447.53 1216.83,-11437.44"/>
<polygon fill="black" stroke="black" points="1217.99,-11440.74 1226.45,-11434.36 1215.86,-11434.08 1217.99,-11440.74"/>
</g>
<!-- layer_6_experts_gpu6 -->
<g id="node137" class="node">
<title>layer_6_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1645.5,-11434.23 1430.5,-11434.23 1430.5,-11382.23 1645.5,-11382.23 1645.5,-11434.23"/>
<text text-anchor="middle" x="1538" y="-11422.23" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1538" y="-11411.23" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1538" y="-11400.23" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1538" y="-11389.23" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_6_expert_select&#45;&gt;layer_6_experts_gpu6 -->
<g id="edge185" class="edge">
<title>layer_6_expert_select&#45;&gt;layer_6_experts_gpu6</title>
<path fill="none" stroke="black" d="M1132.63,-11489.35C1217.1,-11473.89 1319.73,-11454.67 1420.24,-11434.56"/>
<polygon fill="black" stroke="black" points="1421.16,-11437.95 1430.27,-11432.55 1419.78,-11431.08 1421.16,-11437.95"/>
</g>
<!-- layer_6_experts_gpu7 -->
<g id="node138" class="node">
<title>layer_6_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1878.5,-11434.23 1663.5,-11434.23 1663.5,-11382.23 1878.5,-11382.23 1878.5,-11434.23"/>
<text text-anchor="middle" x="1771" y="-11422.23" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1771" y="-11411.23" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1771" y="-11400.23" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1771" y="-11389.23" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_6_expert_select&#45;&gt;layer_6_experts_gpu7 -->
<g id="edge186" class="edge">
<title>layer_6_expert_select&#45;&gt;layer_6_experts_gpu7</title>
<path fill="none" stroke="black" d="M1146.18,-11502.09C1284.66,-11487.13 1476.43,-11464.14 1653.3,-11434.46"/>
<polygon fill="black" stroke="black" points="1654.04,-11437.89 1663.32,-11432.77 1652.87,-11430.99 1654.04,-11437.89"/>
</g>
<!-- layer_6_expert_comm -->
<g id="node139" class="node">
<title>layer_6_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1000" cy="-11309.46" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1000" y="-11323.46" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1000" y="-11312.46" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="1000" y="-11301.46" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1000" y="-11290.46" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_6_experts_gpu0&#45;&gt;layer_6_expert_comm -->
<g id="edge187" class="edge">
<title>layer_6_experts_gpu0&#45;&gt;layer_6_expert_comm</title>
<path fill="none" stroke="black" d="M247.67,-11383.58C250.47,-11383.1 253.25,-11382.65 256,-11382.23 455.93,-11351.15 688.31,-11331.3 839.44,-11320.54"/>
<polygon fill="black" stroke="black" points="840,-11324.01 849.73,-11319.81 839.51,-11317.02 840,-11324.01"/>
</g>
<!-- layer_6_experts_gpu1&#45;&gt;layer_6_expert_comm -->
<g id="edge188" class="edge">
<title>layer_6_experts_gpu1&#45;&gt;layer_6_expert_comm</title>
<path fill="none" stroke="black" d="M480.7,-11383.74C483.49,-11383.22 486.26,-11382.71 489,-11382.23 610.85,-11360.57 750,-11341.38 852.3,-11328.31"/>
<polygon fill="black" stroke="black" points="852.91,-11331.76 862.39,-11327.03 852.03,-11324.82 852.91,-11331.76"/>
</g>
<!-- layer_6_experts_gpu2&#45;&gt;layer_6_expert_comm -->
<g id="edge189" class="edge">
<title>layer_6_experts_gpu2&#45;&gt;layer_6_expert_comm</title>
<path fill="none" stroke="black" d="M707.98,-11382.18C761.86,-11368.95 828.21,-11352.65 884.04,-11338.94"/>
<polygon fill="black" stroke="black" points="885.1,-11342.28 893.98,-11336.5 883.44,-11335.48 885.1,-11342.28"/>
</g>
<!-- layer_6_experts_gpu3&#45;&gt;layer_6_expert_comm -->
<g id="edge190" class="edge">
<title>layer_6_experts_gpu3&#45;&gt;layer_6_expert_comm</title>
<path fill="none" stroke="black" d="M880.88,-11382.05C897.61,-11372 917.26,-11360.19 935.72,-11349.09"/>
<polygon fill="black" stroke="black" points="937.61,-11352.04 944.38,-11343.89 934.01,-11346.04 937.61,-11352.04"/>
</g>
<!-- layer_6_experts_gpu4&#45;&gt;layer_6_expert_comm -->
<g id="edge191" class="edge">
<title>layer_6_experts_gpu4&#45;&gt;layer_6_expert_comm</title>
<path fill="none" stroke="black" d="M1053.27,-11382.05C1046.95,-11373.56 1039.71,-11363.83 1032.64,-11354.32"/>
<polygon fill="black" stroke="black" points="1035.27,-11352 1026.5,-11346.07 1029.66,-11356.18 1035.27,-11352"/>
</g>
<!-- layer_6_experts_gpu5&#45;&gt;layer_6_expert_comm -->
<g id="edge192" class="edge">
<title>layer_6_experts_gpu5&#45;&gt;layer_6_expert_comm</title>
<path fill="none" stroke="black" d="M1226.06,-11382.18C1187.9,-11370.07 1141.67,-11355.4 1100.98,-11342.5"/>
<polygon fill="black" stroke="black" points="1101.9,-11339.11 1091.31,-11339.43 1099.78,-11345.79 1101.9,-11339.11"/>
</g>
<!-- layer_6_experts_gpu6&#45;&gt;layer_6_expert_comm -->
<g id="edge193" class="edge">
<title>layer_6_experts_gpu6&#45;&gt;layer_6_expert_comm</title>
<path fill="none" stroke="black" d="M1430.29,-11383.84C1427.5,-11383.29 1424.73,-11382.75 1422,-11382.23 1327.33,-11363.98 1220.25,-11345.8 1137.63,-11332.3"/>
<polygon fill="black" stroke="black" points="1138.12,-11328.83 1127.68,-11330.68 1136.99,-11335.74 1138.12,-11328.83"/>
</g>
<!-- layer_6_experts_gpu7&#45;&gt;layer_6_expert_comm -->
<g id="edge194" class="edge">
<title>layer_6_experts_gpu7&#45;&gt;layer_6_expert_comm</title>
<path fill="none" stroke="black" d="M1663.32,-11383.62C1660.52,-11383.14 1657.75,-11382.67 1655,-11382.23 1485.79,-11354.8 1290.25,-11334.89 1157.19,-11323.09"/>
<polygon fill="black" stroke="black" points="1157.18,-11319.58 1146.92,-11322.19 1156.57,-11326.55 1157.18,-11319.58"/>
</g>
<!-- layer_6_moe_out -->
<g id="node140" class="node">
<title>layer_6_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1229.24,-11236.69 864.57,-11236.69 770.76,-11132.69 1135.43,-11132.69 1229.24,-11236.69"/>
<text text-anchor="middle" x="1000" y="-11198.69" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="1000" y="-11187.69" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="1000" y="-11176.69" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1000" y="-11165.69" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_6_expert_comm&#45;&gt;layer_6_moe_out -->
<g id="edge195" class="edge">
<title>layer_6_expert_comm&#45;&gt;layer_6_moe_out</title>
<path fill="none" stroke="black" d="M1000,-11272.62C1000,-11264.58 1000,-11255.83 1000,-11247.08"/>
<polygon fill="black" stroke="black" points="1003.5,-11246.85 1000,-11236.85 996.5,-11246.85 1003.5,-11246.85"/>
</g>
<!-- layer_6_norm -->
<g id="node141" class="node">
<title>layer_6_norm</title>
<polygon fill="lightgreen" stroke="black" points="1110.5,-11096.69 889.5,-11096.69 889.5,-11044.69 1110.5,-11044.69 1110.5,-11096.69"/>
<text text-anchor="middle" x="1000" y="-11084.69" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="1000" y="-11073.69" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="1000" y="-11062.69" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1000" y="-11051.69" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_6_moe_out&#45;&gt;layer_6_norm -->
<g id="edge196" class="edge">
<title>layer_6_moe_out&#45;&gt;layer_6_norm</title>
<path fill="none" stroke="black" d="M1000,-11132.6C1000,-11123.94 1000,-11115.12 1000,-11106.97"/>
<polygon fill="black" stroke="black" points="1003.5,-11106.73 1000,-11096.73 996.5,-11106.73 1003.5,-11106.73"/>
</g>
<!-- layer_7_input -->
<g id="node142" class="node">
<title>layer_7_input</title>
<polygon fill="lightyellow" stroke="black" points="1264.24,-10997.69 843.89,-10997.69 735.76,-10915.69 1156.11,-10915.69 1264.24,-10997.69"/>
<text text-anchor="middle" x="1000" y="-10965.19" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="1000" y="-10954.19" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1000" y="-10943.19" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_6_norm&#45;&gt;layer_7_input -->
<g id="edge197" class="edge">
<title>layer_6_norm&#45;&gt;layer_7_input</title>
<path fill="none" stroke="black" d="M1000,-11044.55C1000,-11033.87 1000,-11021.01 1000,-11008.5"/>
<polygon fill="black" stroke="black" points="1003.5,-11008.12 1000,-10998.12 996.5,-11008.12 1003.5,-11008.12"/>
</g>
<!-- layer_7_qkv_tp0 -->
<g id="node143" class="node">
<title>layer_7_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1065.5,-10879.69 790.5,-10879.69 790.5,-10827.69 1065.5,-10827.69 1065.5,-10879.69"/>
<text text-anchor="middle" x="928" y="-10867.69" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="928" y="-10856.69" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="928" y="-10845.69" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="928" y="-10834.69" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_7_input&#45;&gt;layer_7_qkv_tp0 -->
<g id="edge198" class="edge">
<title>layer_7_input&#45;&gt;layer_7_qkv_tp0</title>
<path fill="none" stroke="black" d="M971.34,-10915.48C964.93,-10906.48 958.19,-10897.04 951.99,-10888.34"/>
<polygon fill="black" stroke="black" points="954.66,-10886.05 946,-10879.94 948.96,-10890.11 954.66,-10886.05"/>
</g>
<!-- layer_7_qkv_tp1 -->
<g id="node144" class="node">
<title>layer_7_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1358.5,-10879.69 1083.5,-10879.69 1083.5,-10827.69 1358.5,-10827.69 1358.5,-10879.69"/>
<text text-anchor="middle" x="1221" y="-10867.69" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1221" y="-10856.69" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1221" y="-10845.69" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1221" y="-10834.69" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_7_input&#45;&gt;layer_7_qkv_tp1 -->
<g id="edge199" class="edge">
<title>layer_7_input&#45;&gt;layer_7_qkv_tp1</title>
<path fill="none" stroke="black" d="M1087.66,-10915.62C1110.86,-10905.02 1135.46,-10893.78 1157.14,-10883.87"/>
<polygon fill="black" stroke="black" points="1158.59,-10887.06 1166.23,-10879.72 1155.68,-10880.69 1158.59,-10887.06"/>
</g>
<!-- layer_7_attn_tp0 -->
<g id="node145" class="node">
<title>layer_7_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1063,-10791.69 801,-10791.69 801,-10739.69 1063,-10739.69 1063,-10791.69"/>
<text text-anchor="middle" x="932" y="-10779.69" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="932" y="-10768.69" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="932" y="-10757.69" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="932" y="-10746.69" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_7_qkv_tp0&#45;&gt;layer_7_attn_tp0 -->
<g id="edge200" class="edge">
<title>layer_7_qkv_tp0&#45;&gt;layer_7_attn_tp0</title>
<path fill="none" stroke="black" d="M929.18,-10827.35C929.55,-10819.39 929.96,-10810.45 930.36,-10801.93"/>
<polygon fill="black" stroke="black" points="933.86,-10802 930.83,-10791.84 926.87,-10801.67 933.86,-10802"/>
</g>
<!-- layer_7_attn_tp1 -->
<g id="node146" class="node">
<title>layer_7_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1349,-10791.69 1087,-10791.69 1087,-10739.69 1349,-10739.69 1349,-10791.69"/>
<text text-anchor="middle" x="1218" y="-10779.69" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1218" y="-10768.69" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1218" y="-10757.69" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1218" y="-10746.69" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_7_qkv_tp1&#45;&gt;layer_7_attn_tp1 -->
<g id="edge201" class="edge">
<title>layer_7_qkv_tp1&#45;&gt;layer_7_attn_tp1</title>
<path fill="none" stroke="black" d="M1220.12,-10827.35C1219.84,-10819.39 1219.53,-10810.45 1219.23,-10801.93"/>
<polygon fill="black" stroke="black" points="1222.72,-10801.72 1218.88,-10791.84 1215.73,-10801.96 1222.72,-10801.72"/>
</g>
<!-- layer_7_attn_comm -->
<g id="node147" class="node">
<title>layer_7_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="955" cy="-10666.92" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="955" y="-10680.92" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="955" y="-10669.92" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="955" y="-10658.92" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="955" y="-10647.92" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_7_attn_tp0&#45;&gt;layer_7_attn_comm -->
<g id="edge202" class="edge">
<title>layer_7_attn_tp0&#45;&gt;layer_7_attn_comm</title>
<path fill="none" stroke="black" d="M937.98,-10739.51C939.86,-10731.62 941.99,-10722.65 944.1,-10713.79"/>
<polygon fill="black" stroke="black" points="947.54,-10714.43 946.45,-10703.89 940.73,-10712.81 947.54,-10714.43"/>
</g>
<!-- layer_7_attn_tp1&#45;&gt;layer_7_attn_comm -->
<g id="edge203" class="edge">
<title>layer_7_attn_tp1&#45;&gt;layer_7_attn_comm</title>
<path fill="none" stroke="black" d="M1149.93,-10739.64C1118.49,-10728.07 1080.69,-10714.16 1046.77,-10701.68"/>
<polygon fill="black" stroke="black" points="1047.91,-10698.37 1037.32,-10698.21 1045.5,-10704.94 1047.91,-10698.37"/>
</g>
<!-- layer_7_attn_out -->
<g id="node148" class="node">
<title>layer_7_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1065.5,-10594.15 844.5,-10594.15 844.5,-10542.15 1065.5,-10542.15 1065.5,-10594.15"/>
<text text-anchor="middle" x="955" y="-10582.15" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="955" y="-10571.15" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="955" y="-10560.15" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="955" y="-10549.15" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_7_attn_comm&#45;&gt;layer_7_attn_out -->
<g id="edge204" class="edge">
<title>layer_7_attn_comm&#45;&gt;layer_7_attn_out</title>
<path fill="none" stroke="black" d="M955,-10629.88C955,-10621.57 955,-10612.74 955,-10604.46"/>
<polygon fill="black" stroke="black" points="958.5,-10604.34 955,-10594.34 951.5,-10604.34 958.5,-10604.34"/>
</g>
<!-- layer_7_gate -->
<g id="node149" class="node">
<title>layer_7_gate</title>
<polygon fill="lightyellow" stroke="black" points="1209.01,-10506.15 804.94,-10506.15 700.99,-10402.15 1105.06,-10402.15 1209.01,-10506.15"/>
<text text-anchor="middle" x="955" y="-10468.15" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="955" y="-10457.15" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="955" y="-10446.15" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="955" y="-10435.15" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_7_attn_out&#45;&gt;layer_7_gate -->
<g id="edge205" class="edge">
<title>layer_7_attn_out&#45;&gt;layer_7_gate</title>
<path fill="none" stroke="black" d="M955,-10542.01C955,-10534.33 955,-10525.51 955,-10516.52"/>
<polygon fill="black" stroke="black" points="958.5,-10516.33 955,-10506.33 951.5,-10516.33 958.5,-10516.33"/>
</g>
<!-- layer_7_expert_select -->
<g id="node150" class="node">
<title>layer_7_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1221.39,-10366.15 797.62,-10366.15 688.61,-10262.15 1112.38,-10262.15 1221.39,-10366.15"/>
<text text-anchor="middle" x="955" y="-10328.15" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="955" y="-10317.15" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="955" y="-10306.15" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="955" y="-10295.15" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_7_gate&#45;&gt;layer_7_expert_select -->
<g id="edge206" class="edge">
<title>layer_7_gate&#45;&gt;layer_7_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M955,-10401.76C955,-10393.59 955,-10385.06 955,-10376.69"/>
<polygon fill="black" stroke="black" points="958.5,-10376.58 955,-10366.58 951.5,-10376.58 958.5,-10376.58"/>
</g>
<!-- layer_7_experts_gpu0 -->
<g id="node151" class="node">
<title>layer_7_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="247.5,-10226.15 32.5,-10226.15 32.5,-10174.15 247.5,-10174.15 247.5,-10226.15"/>
<text text-anchor="middle" x="140" y="-10214.15" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="140" y="-10203.15" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="140" y="-10192.15" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="140" y="-10181.15" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_7_expert_select&#45;&gt;layer_7_experts_gpu0 -->
<g id="edge207" class="edge">
<title>layer_7_expert_select&#45;&gt;layer_7_experts_gpu0</title>
<path fill="none" stroke="black" d="M716.44,-10288.75C583.76,-10273.88 415.58,-10252.9 257.59,-10226.37"/>
<polygon fill="black" stroke="black" points="258.13,-10222.91 247.68,-10224.69 256.96,-10229.81 258.13,-10222.91"/>
</g>
<!-- layer_7_experts_gpu1 -->
<g id="node152" class="node">
<title>layer_7_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="480.5,-10226.15 265.5,-10226.15 265.5,-10174.15 480.5,-10174.15 480.5,-10226.15"/>
<text text-anchor="middle" x="373" y="-10214.15" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="373" y="-10203.15" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="373" y="-10192.15" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="373" y="-10181.15" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_7_expert_select&#45;&gt;layer_7_experts_gpu1 -->
<g id="edge208" class="edge">
<title>layer_7_expert_select&#45;&gt;layer_7_experts_gpu1</title>
<path fill="none" stroke="black" d="M691.97,-10265.36C628.64,-10253.51 561.03,-10240.57 490.67,-10226.47"/>
<polygon fill="black" stroke="black" points="491.22,-10223.01 480.73,-10224.47 489.84,-10229.87 491.22,-10223.01"/>
</g>
<!-- layer_7_experts_gpu2 -->
<g id="node153" class="node">
<title>layer_7_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="713.5,-10226.15 498.5,-10226.15 498.5,-10174.15 713.5,-10174.15 713.5,-10226.15"/>
<text text-anchor="middle" x="606" y="-10214.15" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="606" y="-10203.15" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="606" y="-10192.15" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="606" y="-10181.15" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_7_expert_select&#45;&gt;layer_7_experts_gpu2 -->
<g id="edge209" class="edge">
<title>layer_7_expert_select&#45;&gt;layer_7_experts_gpu2</title>
<path fill="none" stroke="black" d="M796.07,-10262.15C761.01,-10250.89 725.09,-10239.37 694.06,-10229.41"/>
<polygon fill="black" stroke="black" points="694.75,-10225.95 684.16,-10226.23 692.62,-10232.62 694.75,-10225.95"/>
</g>
<!-- layer_7_experts_gpu3 -->
<g id="node154" class="node">
<title>layer_7_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="946.5,-10226.15 731.5,-10226.15 731.5,-10174.15 946.5,-10174.15 946.5,-10226.15"/>
<text text-anchor="middle" x="839" y="-10214.15" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="839" y="-10203.15" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="839" y="-10192.15" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="839" y="-10181.15" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_7_expert_select&#45;&gt;layer_7_experts_gpu3 -->
<g id="edge210" class="edge">
<title>layer_7_expert_select&#45;&gt;layer_7_experts_gpu3</title>
<path fill="none" stroke="black" d="M902.09,-10262.06C891.91,-10252.23 881.51,-10242.19 872.18,-10233.18"/>
<polygon fill="black" stroke="black" points="874.56,-10230.62 864.94,-10226.19 869.7,-10235.65 874.56,-10230.62"/>
</g>
<!-- layer_7_experts_gpu4 -->
<g id="node155" class="node">
<title>layer_7_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1179.5,-10226.15 964.5,-10226.15 964.5,-10174.15 1179.5,-10174.15 1179.5,-10226.15"/>
<text text-anchor="middle" x="1072" y="-10214.15" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1072" y="-10203.15" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1072" y="-10192.15" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1072" y="-10181.15" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_7_expert_select&#45;&gt;layer_7_experts_gpu4 -->
<g id="edge211" class="edge">
<title>layer_7_expert_select&#45;&gt;layer_7_experts_gpu4</title>
<path fill="none" stroke="black" d="M1008.36,-10262.06C1018.64,-10252.23 1029.12,-10242.19 1038.54,-10233.18"/>
<polygon fill="black" stroke="black" points="1041.04,-10235.63 1045.84,-10226.19 1036.19,-10230.58 1041.04,-10235.63"/>
</g>
<!-- layer_7_experts_gpu5 -->
<g id="node156" class="node">
<title>layer_7_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1412.5,-10226.15 1197.5,-10226.15 1197.5,-10174.15 1412.5,-10174.15 1412.5,-10226.15"/>
<text text-anchor="middle" x="1305" y="-10214.15" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1305" y="-10203.15" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1305" y="-10192.15" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1305" y="-10181.15" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_7_expert_select&#45;&gt;layer_7_experts_gpu5 -->
<g id="edge212" class="edge">
<title>layer_7_expert_select&#45;&gt;layer_7_experts_gpu5</title>
<path fill="none" stroke="black" d="M1113.1,-10262.55C1148.73,-10251.15 1185.3,-10239.45 1216.83,-10229.36"/>
<polygon fill="black" stroke="black" points="1217.99,-10232.67 1226.45,-10226.28 1215.86,-10226 1217.99,-10232.67"/>
</g>
<!-- layer_7_experts_gpu6 -->
<g id="node157" class="node">
<title>layer_7_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1645.5,-10226.15 1430.5,-10226.15 1430.5,-10174.15 1645.5,-10174.15 1645.5,-10226.15"/>
<text text-anchor="middle" x="1538" y="-10214.15" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1538" y="-10203.15" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1538" y="-10192.15" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1538" y="-10181.15" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_7_expert_select&#45;&gt;layer_7_experts_gpu6 -->
<g id="edge213" class="edge">
<title>layer_7_expert_select&#45;&gt;layer_7_experts_gpu6</title>
<path fill="none" stroke="black" d="M1132.63,-10281.27C1217.1,-10265.81 1319.73,-10246.6 1420.24,-10226.48"/>
<polygon fill="black" stroke="black" points="1421.16,-10229.87 1430.27,-10224.47 1419.78,-10223.01 1421.16,-10229.87"/>
</g>
<!-- layer_7_experts_gpu7 -->
<g id="node158" class="node">
<title>layer_7_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1878.5,-10226.15 1663.5,-10226.15 1663.5,-10174.15 1878.5,-10174.15 1878.5,-10226.15"/>
<text text-anchor="middle" x="1771" y="-10214.15" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1771" y="-10203.15" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1771" y="-10192.15" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1771" y="-10181.15" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_7_expert_select&#45;&gt;layer_7_experts_gpu7 -->
<g id="edge214" class="edge">
<title>layer_7_expert_select&#45;&gt;layer_7_experts_gpu7</title>
<path fill="none" stroke="black" d="M1146.18,-10294.01C1284.66,-10279.05 1476.43,-10256.06 1653.3,-10226.39"/>
<polygon fill="black" stroke="black" points="1654.04,-10229.81 1663.32,-10224.69 1652.87,-10222.91 1654.04,-10229.81"/>
</g>
<!-- layer_7_expert_comm -->
<g id="node159" class="node">
<title>layer_7_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="955" cy="-10101.38" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="955" y="-10115.38" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="955" y="-10104.38" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="955" y="-10093.38" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="955" y="-10082.38" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_7_experts_gpu0&#45;&gt;layer_7_expert_comm -->
<g id="edge215" class="edge">
<title>layer_7_experts_gpu0&#45;&gt;layer_7_expert_comm</title>
<path fill="none" stroke="black" d="M247.67,-10175.52C250.47,-10175.04 253.25,-10174.58 256,-10174.15 440.44,-10144.9 654.23,-10124.97 796.33,-10113.67"/>
<polygon fill="black" stroke="black" points="796.74,-10117.15 806.43,-10112.87 796.19,-10110.17 796.74,-10117.15"/>
</g>
<!-- layer_7_experts_gpu1&#45;&gt;layer_7_expert_comm -->
<g id="edge216" class="edge">
<title>layer_7_experts_gpu1&#45;&gt;layer_7_expert_comm</title>
<path fill="none" stroke="black" d="M480.7,-10175.71C483.5,-10175.17 486.27,-10174.65 489,-10174.15 596.86,-10154.24 719.47,-10135.51 811.85,-10122.18"/>
<polygon fill="black" stroke="black" points="812.42,-10125.63 821.82,-10120.74 811.43,-10118.7 812.42,-10125.63"/>
</g>
<!-- layer_7_experts_gpu2&#45;&gt;layer_7_expert_comm -->
<g id="edge217" class="edge">
<title>layer_7_experts_gpu2&#45;&gt;layer_7_expert_comm</title>
<path fill="none" stroke="black" d="M696.33,-10174.1C742.06,-10161.42 797.92,-10145.93 846.02,-10132.6"/>
<polygon fill="black" stroke="black" points="847.14,-10135.92 855.84,-10129.87 845.27,-10129.17 847.14,-10135.92"/>
</g>
<!-- layer_7_experts_gpu3&#45;&gt;layer_7_expert_comm -->
<g id="edge218" class="edge">
<title>layer_7_experts_gpu3&#45;&gt;layer_7_expert_comm</title>
<path fill="none" stroke="black" d="M869.17,-10173.98C880.4,-10164.61 893.46,-10153.72 905.94,-10143.3"/>
<polygon fill="black" stroke="black" points="908.19,-10145.99 913.62,-10136.89 903.7,-10140.61 908.19,-10145.99"/>
</g>
<!-- layer_7_experts_gpu4&#45;&gt;layer_7_expert_comm -->
<g id="edge219" class="edge">
<title>layer_7_experts_gpu4&#45;&gt;layer_7_expert_comm</title>
<path fill="none" stroke="black" d="M1041.57,-10173.98C1030.24,-10164.61 1017.07,-10153.72 1004.48,-10143.3"/>
<polygon fill="black" stroke="black" points="1006.67,-10140.57 996.73,-10136.89 1002.21,-10145.97 1006.67,-10140.57"/>
</g>
<!-- layer_7_experts_gpu5&#45;&gt;layer_7_expert_comm -->
<g id="edge220" class="edge">
<title>layer_7_experts_gpu5&#45;&gt;layer_7_expert_comm</title>
<path fill="none" stroke="black" d="M1214.41,-10174.1C1168.55,-10161.42 1112.53,-10145.93 1064.29,-10132.6"/>
<polygon fill="black" stroke="black" points="1065.01,-10129.16 1054.44,-10129.87 1063.15,-10135.91 1065.01,-10129.16"/>
</g>
<!-- layer_7_experts_gpu6&#45;&gt;layer_7_expert_comm -->
<g id="edge221" class="edge">
<title>layer_7_experts_gpu6&#45;&gt;layer_7_expert_comm</title>
<path fill="none" stroke="black" d="M1430.3,-10175.71C1427.5,-10175.17 1424.74,-10174.65 1422,-10174.15 1313.81,-10154.19 1190.81,-10135.45 1098.21,-10122.12"/>
<polygon fill="black" stroke="black" points="1098.61,-10118.65 1088.21,-10120.69 1097.61,-10125.57 1098.61,-10118.65"/>
</g>
<!-- layer_7_experts_gpu7&#45;&gt;layer_7_expert_comm -->
<g id="edge222" class="edge">
<title>layer_7_experts_gpu7&#45;&gt;layer_7_expert_comm</title>
<path fill="none" stroke="black" d="M1663.33,-10175.52C1660.53,-10175.04 1657.75,-10174.58 1655,-10174.15 1470.3,-10144.87 1256.2,-10124.94 1113.9,-10113.65"/>
<polygon fill="black" stroke="black" points="1114.02,-10110.15 1103.78,-10112.86 1113.47,-10117.13 1114.02,-10110.15"/>
</g>
<!-- layer_7_moe_out -->
<g id="node160" class="node">
<title>layer_7_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1184.24,-10028.61 819.57,-10028.61 725.76,-9924.61 1090.43,-9924.61 1184.24,-10028.61"/>
<text text-anchor="middle" x="955" y="-9990.61" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="955" y="-9979.61" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="955" y="-9968.61" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="955" y="-9957.61" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_7_expert_comm&#45;&gt;layer_7_moe_out -->
<g id="edge223" class="edge">
<title>layer_7_expert_comm&#45;&gt;layer_7_moe_out</title>
<path fill="none" stroke="black" d="M955,-10064.54C955,-10056.5 955,-10047.75 955,-10039"/>
<polygon fill="black" stroke="black" points="958.5,-10038.78 955,-10028.78 951.5,-10038.78 958.5,-10038.78"/>
</g>
<!-- layer_7_norm -->
<g id="node161" class="node">
<title>layer_7_norm</title>
<polygon fill="lightgreen" stroke="black" points="1065.5,-9888.61 844.5,-9888.61 844.5,-9836.61 1065.5,-9836.61 1065.5,-9888.61"/>
<text text-anchor="middle" x="955" y="-9876.61" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="955" y="-9865.61" font-family="Arial" font-size="10.00">GPUs 2&#45;3</text>
<text text-anchor="middle" x="955" y="-9854.61" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="955" y="-9843.61" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_7_moe_out&#45;&gt;layer_7_norm -->
<g id="edge224" class="edge">
<title>layer_7_moe_out&#45;&gt;layer_7_norm</title>
<path fill="none" stroke="black" d="M955,-9924.52C955,-9915.86 955,-9907.04 955,-9898.89"/>
<polygon fill="black" stroke="black" points="958.5,-9898.65 955,-9888.65 951.5,-9898.65 958.5,-9898.65"/>
</g>
<!-- layer_8_input -->
<g id="node162" class="node">
<title>layer_8_input</title>
<polygon fill="lightyellow" stroke="black" points="1219.24,-9750.61 798.89,-9750.61 690.76,-9668.61 1111.11,-9668.61 1219.24,-9750.61"/>
<text text-anchor="middle" x="955" y="-9718.11" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="955" y="-9707.11" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="955" y="-9696.11" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_7_norm&#45;&gt;layer_8_input -->
<g id="edge225" class="edge">
<title>layer_7_norm&#45;&gt;layer_8_input</title>
<path fill="none" stroke="black" d="M955,-9836.33C955,-9815.82 955,-9786.25 955,-9760.95"/>
<polygon fill="black" stroke="black" points="958.5,-9760.76 955,-9750.76 951.5,-9760.76 958.5,-9760.76"/>
</g>
<!-- layer_8_qkv_tp0 -->
<g id="node163" class="node">
<title>layer_8_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1004.5,-9632.61 729.5,-9632.61 729.5,-9580.61 1004.5,-9580.61 1004.5,-9632.61"/>
<text text-anchor="middle" x="867" y="-9620.61" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="867" y="-9609.61" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="867" y="-9598.61" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="867" y="-9587.61" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_8_input&#45;&gt;layer_8_qkv_tp0 -->
<g id="edge226" class="edge">
<title>layer_8_input&#45;&gt;layer_8_qkv_tp0</title>
<path fill="none" stroke="black" d="M919.97,-9668.4C911.89,-9659.12 903.38,-9649.37 895.61,-9640.45"/>
<polygon fill="black" stroke="black" points="898.21,-9638.1 889,-9632.86 892.93,-9642.7 898.21,-9638.1"/>
</g>
<!-- layer_8_qkv_tp1 -->
<g id="node164" class="node">
<title>layer_8_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1297.5,-9632.61 1022.5,-9632.61 1022.5,-9580.61 1297.5,-9580.61 1297.5,-9632.61"/>
<text text-anchor="middle" x="1160" y="-9620.61" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1160" y="-9609.61" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1160" y="-9598.61" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1160" y="-9587.61" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_8_input&#45;&gt;layer_8_qkv_tp1 -->
<g id="edge227" class="edge">
<title>layer_8_input&#45;&gt;layer_8_qkv_tp1</title>
<path fill="none" stroke="black" d="M1036.32,-9668.55C1057.64,-9658.04 1080.25,-9646.9 1100.22,-9637.06"/>
<polygon fill="black" stroke="black" points="1101.77,-9640.2 1109.2,-9632.64 1098.68,-9633.92 1101.77,-9640.2"/>
</g>
<!-- layer_8_attn_tp0 -->
<g id="node165" class="node">
<title>layer_8_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1001,-9544.61 739,-9544.61 739,-9492.61 1001,-9492.61 1001,-9544.61"/>
<text text-anchor="middle" x="870" y="-9532.61" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="870" y="-9521.61" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="870" y="-9510.61" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="870" y="-9499.61" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_8_qkv_tp0&#45;&gt;layer_8_attn_tp0 -->
<g id="edge228" class="edge">
<title>layer_8_qkv_tp0&#45;&gt;layer_8_attn_tp0</title>
<path fill="none" stroke="black" d="M867.88,-9580.27C868.16,-9572.31 868.47,-9563.37 868.77,-9554.85"/>
<polygon fill="black" stroke="black" points="872.27,-9554.88 869.12,-9544.77 865.28,-9554.64 872.27,-9554.88"/>
</g>
<!-- layer_8_attn_tp1 -->
<g id="node166" class="node">
<title>layer_8_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1285,-9544.61 1023,-9544.61 1023,-9492.61 1285,-9492.61 1285,-9544.61"/>
<text text-anchor="middle" x="1154" y="-9532.61" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1154" y="-9521.61" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1154" y="-9510.61" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1154" y="-9499.61" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_8_qkv_tp1&#45;&gt;layer_8_attn_tp1 -->
<g id="edge229" class="edge">
<title>layer_8_qkv_tp1&#45;&gt;layer_8_attn_tp1</title>
<path fill="none" stroke="black" d="M1158.23,-9580.27C1157.68,-9572.31 1157.05,-9563.37 1156.46,-9554.85"/>
<polygon fill="black" stroke="black" points="1159.94,-9554.5 1155.76,-9544.77 1152.96,-9554.98 1159.94,-9554.5"/>
</g>
<!-- layer_8_attn_comm -->
<g id="node167" class="node">
<title>layer_8_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1113" cy="-9419.84" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1113" y="-9433.84" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="1113" y="-9422.84" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1113" y="-9411.84" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1113" y="-9400.84" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_8_attn_tp0&#45;&gt;layer_8_attn_comm -->
<g id="edge230" class="edge">
<title>layer_8_attn_tp0&#45;&gt;layer_8_attn_comm</title>
<path fill="none" stroke="black" d="M932.89,-9492.56C961.19,-9481.3 995.05,-9467.81 1025.75,-9455.59"/>
<polygon fill="black" stroke="black" points="1027.16,-9458.79 1035.16,-9451.84 1024.57,-9452.29 1027.16,-9458.79"/>
</g>
<!-- layer_8_attn_tp1&#45;&gt;layer_8_attn_comm -->
<g id="edge231" class="edge">
<title>layer_8_attn_tp1&#45;&gt;layer_8_attn_comm</title>
<path fill="none" stroke="black" d="M1143.33,-9492.44C1139.88,-9484.29 1135.94,-9474.99 1132.07,-9465.86"/>
<polygon fill="black" stroke="black" points="1135.21,-9464.29 1128.09,-9456.45 1128.77,-9467.02 1135.21,-9464.29"/>
</g>
<!-- layer_8_attn_out -->
<g id="node168" class="node">
<title>layer_8_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1223.5,-9347.07 1002.5,-9347.07 1002.5,-9295.07 1223.5,-9295.07 1223.5,-9347.07"/>
<text text-anchor="middle" x="1113" y="-9335.07" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="1113" y="-9324.07" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1113" y="-9313.07" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1113" y="-9302.07" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_8_attn_comm&#45;&gt;layer_8_attn_out -->
<g id="edge232" class="edge">
<title>layer_8_attn_comm&#45;&gt;layer_8_attn_out</title>
<path fill="none" stroke="black" d="M1113,-9382.81C1113,-9374.49 1113,-9365.66 1113,-9357.38"/>
<polygon fill="black" stroke="black" points="1116.5,-9357.27 1113,-9347.27 1109.5,-9357.27 1116.5,-9357.27"/>
</g>
<!-- layer_8_gate -->
<g id="node169" class="node">
<title>layer_8_gate</title>
<polygon fill="lightyellow" stroke="black" points="1367.01,-9259.07 962.94,-9259.07 858.99,-9155.07 1263.06,-9155.07 1367.01,-9259.07"/>
<text text-anchor="middle" x="1113" y="-9221.07" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="1113" y="-9210.07" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1113" y="-9199.07" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1113" y="-9188.07" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_8_attn_out&#45;&gt;layer_8_gate -->
<g id="edge233" class="edge">
<title>layer_8_attn_out&#45;&gt;layer_8_gate</title>
<path fill="none" stroke="black" d="M1113,-9294.93C1113,-9287.25 1113,-9278.44 1113,-9269.44"/>
<polygon fill="black" stroke="black" points="1116.5,-9269.25 1113,-9259.25 1109.5,-9269.25 1116.5,-9269.25"/>
</g>
<!-- layer_8_expert_select -->
<g id="node170" class="node">
<title>layer_8_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1379.39,-9119.07 955.62,-9119.07 846.61,-9015.07 1270.38,-9015.07 1379.39,-9119.07"/>
<text text-anchor="middle" x="1113" y="-9081.07" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="1113" y="-9070.07" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1113" y="-9059.07" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="1113" y="-9048.07" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_8_gate&#45;&gt;layer_8_expert_select -->
<g id="edge234" class="edge">
<title>layer_8_gate&#45;&gt;layer_8_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1113,-9154.68C1113,-9146.51 1113,-9137.99 1113,-9129.61"/>
<polygon fill="black" stroke="black" points="1116.5,-9129.5 1113,-9119.5 1109.5,-9129.5 1116.5,-9129.5"/>
</g>
<!-- layer_8_experts_gpu0 -->
<g id="node171" class="node">
<title>layer_8_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="404.5,-8979.07 189.5,-8979.07 189.5,-8927.07 404.5,-8927.07 404.5,-8979.07"/>
<text text-anchor="middle" x="297" y="-8967.07" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="297" y="-8956.07" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="297" y="-8945.07" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="297" y="-8934.07" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_8_expert_select&#45;&gt;layer_8_experts_gpu0 -->
<g id="edge235" class="edge">
<title>layer_8_expert_select&#45;&gt;layer_8_experts_gpu0</title>
<path fill="none" stroke="black" d="M874.5,-9041.73C741.57,-9026.87 572.96,-9005.87 414.62,-8979.29"/>
<polygon fill="black" stroke="black" points="415.13,-8975.83 404.68,-8977.62 413.96,-8982.73 415.13,-8975.83"/>
</g>
<!-- layer_8_experts_gpu1 -->
<g id="node172" class="node">
<title>layer_8_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="637.5,-8979.07 422.5,-8979.07 422.5,-8927.07 637.5,-8927.07 637.5,-8979.07"/>
<text text-anchor="middle" x="530" y="-8967.07" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="530" y="-8956.07" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="530" y="-8945.07" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="530" y="-8934.07" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_8_expert_select&#45;&gt;layer_8_experts_gpu1 -->
<g id="edge236" class="edge">
<title>layer_8_expert_select&#45;&gt;layer_8_experts_gpu1</title>
<path fill="none" stroke="black" d="M849.69,-9018.14C786.43,-9006.31 718.93,-8993.41 647.78,-8979.21"/>
<polygon fill="black" stroke="black" points="648.21,-8975.73 637.72,-8977.2 646.84,-8982.59 648.21,-8975.73"/>
</g>
<!-- layer_8_experts_gpu2 -->
<g id="node173" class="node">
<title>layer_8_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="870.5,-8979.07 655.5,-8979.07 655.5,-8927.07 870.5,-8927.07 870.5,-8979.07"/>
<text text-anchor="middle" x="763" y="-8967.07" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="763" y="-8956.07" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="763" y="-8945.07" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="763" y="-8934.07" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_8_expert_select&#45;&gt;layer_8_experts_gpu2 -->
<g id="edge237" class="edge">
<title>layer_8_expert_select&#45;&gt;layer_8_experts_gpu2</title>
<path fill="none" stroke="black" d="M953.62,-9015.07C918.45,-9003.81 882.43,-8992.29 851.31,-8982.33"/>
<polygon fill="black" stroke="black" points="851.98,-8978.87 841.39,-8979.15 849.84,-8985.53 851.98,-8978.87"/>
</g>
<!-- layer_8_experts_gpu3 -->
<g id="node174" class="node">
<title>layer_8_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1103.5,-8979.07 888.5,-8979.07 888.5,-8927.07 1103.5,-8927.07 1103.5,-8979.07"/>
<text text-anchor="middle" x="996" y="-8967.07" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="996" y="-8956.07" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="996" y="-8945.07" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="996" y="-8934.07" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_8_expert_select&#45;&gt;layer_8_experts_gpu3 -->
<g id="edge238" class="edge">
<title>layer_8_expert_select&#45;&gt;layer_8_experts_gpu3</title>
<path fill="none" stroke="black" d="M1059.64,-9014.99C1049.36,-9005.15 1038.88,-8995.12 1029.46,-8986.1"/>
<polygon fill="black" stroke="black" points="1031.81,-8983.5 1022.16,-8979.11 1026.96,-8988.56 1031.81,-8983.5"/>
</g>
<!-- layer_8_experts_gpu4 -->
<g id="node175" class="node">
<title>layer_8_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1336.5,-8979.07 1121.5,-8979.07 1121.5,-8927.07 1336.5,-8927.07 1336.5,-8979.07"/>
<text text-anchor="middle" x="1229" y="-8967.07" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1229" y="-8956.07" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1229" y="-8945.07" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1229" y="-8934.07" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_8_expert_select&#45;&gt;layer_8_experts_gpu4 -->
<g id="edge239" class="edge">
<title>layer_8_expert_select&#45;&gt;layer_8_experts_gpu4</title>
<path fill="none" stroke="black" d="M1165.91,-9014.99C1176.09,-9005.15 1186.49,-8995.12 1195.82,-8986.1"/>
<polygon fill="black" stroke="black" points="1198.3,-8988.58 1203.06,-8979.11 1193.44,-8983.54 1198.3,-8988.58"/>
</g>
<!-- layer_8_experts_gpu5 -->
<g id="node176" class="node">
<title>layer_8_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1569.5,-8979.07 1354.5,-8979.07 1354.5,-8927.07 1569.5,-8927.07 1569.5,-8979.07"/>
<text text-anchor="middle" x="1462" y="-8967.07" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1462" y="-8956.07" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1462" y="-8945.07" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1462" y="-8934.07" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_8_expert_select&#45;&gt;layer_8_experts_gpu5 -->
<g id="edge240" class="edge">
<title>layer_8_expert_select&#45;&gt;layer_8_experts_gpu5</title>
<path fill="none" stroke="black" d="M1270.91,-9015.39C1306.4,-9004 1342.82,-8992.32 1374.22,-8982.24"/>
<polygon fill="black" stroke="black" points="1375.34,-8985.55 1383.8,-8979.17 1373.21,-8978.89 1375.34,-8985.55"/>
</g>
<!-- layer_8_experts_gpu6 -->
<g id="node177" class="node">
<title>layer_8_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1802.5,-8979.07 1587.5,-8979.07 1587.5,-8927.07 1802.5,-8927.07 1802.5,-8979.07"/>
<text text-anchor="middle" x="1695" y="-8967.07" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1695" y="-8956.07" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1695" y="-8945.07" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1695" y="-8934.07" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_8_expert_select&#45;&gt;layer_8_experts_gpu6 -->
<g id="edge241" class="edge">
<title>layer_8_expert_select&#45;&gt;layer_8_experts_gpu6</title>
<path fill="none" stroke="black" d="M1290.53,-9034.12C1374.76,-9018.66 1477.06,-8999.47 1577.27,-8979.4"/>
<polygon fill="black" stroke="black" points="1578.16,-8982.79 1587.27,-8977.39 1576.78,-8975.93 1578.16,-8982.79"/>
</g>
<!-- layer_8_experts_gpu7 -->
<g id="node178" class="node">
<title>layer_8_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2035.5,-8979.07 1820.5,-8979.07 1820.5,-8927.07 2035.5,-8927.07 2035.5,-8979.07"/>
<text text-anchor="middle" x="1928" y="-8967.07" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1928" y="-8956.07" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1928" y="-8945.07" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1928" y="-8934.07" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_8_expert_select&#45;&gt;layer_8_experts_gpu7 -->
<g id="edge242" class="edge">
<title>layer_8_expert_select&#45;&gt;layer_8_experts_gpu7</title>
<path fill="none" stroke="black" d="M1303.91,-9046.92C1442.18,-9031.95 1633.68,-9008.96 1810.31,-8979.3"/>
<polygon fill="black" stroke="black" points="1811.04,-8982.73 1820.32,-8977.62 1809.87,-8975.83 1811.04,-8982.73"/>
</g>
<!-- layer_8_expert_comm -->
<g id="node179" class="node">
<title>layer_8_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1104" cy="-8854.3" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1104" y="-8868.3" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1104" y="-8857.3" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="1104" y="-8846.3" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1104" y="-8835.3" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_8_experts_gpu0&#45;&gt;layer_8_expert_comm -->
<g id="edge243" class="edge">
<title>layer_8_experts_gpu0&#45;&gt;layer_8_expert_comm</title>
<path fill="none" stroke="black" d="M404.67,-8928.45C407.47,-8927.97 410.25,-8927.51 413,-8927.07 594.75,-8898.13 805.33,-8878.19 945.8,-8866.81"/>
<polygon fill="black" stroke="black" points="946.1,-8870.29 955.79,-8866 945.54,-8863.32 946.1,-8870.29"/>
</g>
<!-- layer_8_experts_gpu1&#45;&gt;layer_8_expert_comm -->
<g id="edge244" class="edge">
<title>layer_8_experts_gpu1&#45;&gt;layer_8_expert_comm</title>
<path fill="none" stroke="black" d="M637.7,-8928.83C640.83,-8928.22 643.94,-8927.64 647,-8927.07 752.23,-8907.58 871.73,-8888.93 962.14,-8875.53"/>
<polygon fill="black" stroke="black" points="962.8,-8878.97 972.18,-8874.05 961.78,-8872.05 962.8,-8878.97"/>
</g>
<!-- layer_8_experts_gpu2&#45;&gt;layer_8_expert_comm -->
<g id="edge245" class="edge">
<title>layer_8_experts_gpu2&#45;&gt;layer_8_expert_comm</title>
<path fill="none" stroke="black" d="M851.26,-8927.02C895.57,-8914.45 949.62,-8899.11 996.35,-8885.85"/>
<polygon fill="black" stroke="black" points="997.54,-8889.15 1006.2,-8883.05 995.63,-8882.42 997.54,-8889.15"/>
</g>
<!-- layer_8_experts_gpu3&#45;&gt;layer_8_expert_comm -->
<g id="edge246" class="edge">
<title>layer_8_experts_gpu3&#45;&gt;layer_8_expert_comm</title>
<path fill="none" stroke="black" d="M1024.09,-8926.9C1034.25,-8917.8 1046.01,-8907.26 1057.33,-8897.12"/>
<polygon fill="black" stroke="black" points="1059.96,-8899.46 1065.07,-8890.18 1055.29,-8894.25 1059.96,-8899.46"/>
</g>
<!-- layer_8_experts_gpu4&#45;&gt;layer_8_expert_comm -->
<g id="edge247" class="edge">
<title>layer_8_experts_gpu4&#45;&gt;layer_8_expert_comm</title>
<path fill="none" stroke="black" d="M1196.48,-8926.9C1184.38,-8917.53 1170.32,-8906.64 1156.86,-8896.22"/>
<polygon fill="black" stroke="black" points="1158.64,-8893.17 1148.59,-8889.82 1154.35,-8898.71 1158.64,-8893.17"/>
</g>
<!-- layer_8_experts_gpu5&#45;&gt;layer_8_expert_comm -->
<g id="edge248" class="edge">
<title>layer_8_experts_gpu5&#45;&gt;layer_8_expert_comm</title>
<path fill="none" stroke="black" d="M1369.34,-8927.02C1322.05,-8914.24 1264.18,-8898.6 1214.57,-8885.19"/>
<polygon fill="black" stroke="black" points="1215.33,-8881.77 1204.76,-8882.54 1213.5,-8888.52 1215.33,-8881.77"/>
</g>
<!-- layer_8_experts_gpu6&#45;&gt;layer_8_expert_comm -->
<g id="edge249" class="edge">
<title>layer_8_experts_gpu6&#45;&gt;layer_8_expert_comm</title>
<path fill="none" stroke="black" d="M1587.3,-8928.62C1584.51,-8928.09 1581.74,-8927.57 1579,-8927.07 1468.38,-8906.81 1342.52,-8887.98 1248.15,-8874.7"/>
<polygon fill="black" stroke="black" points="1248.36,-8871.19 1237.97,-8873.27 1247.38,-8878.13 1248.36,-8871.19"/>
</g>
<!-- layer_8_experts_gpu7&#45;&gt;layer_8_expert_comm -->
<g id="edge250" class="edge">
<title>layer_8_experts_gpu7&#45;&gt;layer_8_expert_comm</title>
<path fill="none" stroke="black" d="M1820.33,-8928.44C1817.53,-8927.96 1814.75,-8927.5 1812,-8927.07 1624.6,-8897.47 1407.27,-8877.56 1263.34,-8866.36"/>
<polygon fill="black" stroke="black" points="1263.35,-8862.85 1253.11,-8865.57 1262.81,-8869.83 1263.35,-8862.85"/>
</g>
<!-- layer_8_moe_out -->
<g id="node180" class="node">
<title>layer_8_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1333.24,-8781.53 968.57,-8781.53 874.76,-8677.53 1239.43,-8677.53 1333.24,-8781.53"/>
<text text-anchor="middle" x="1104" y="-8743.53" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="1104" y="-8732.53" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1104" y="-8721.53" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1104" y="-8710.53" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_8_expert_comm&#45;&gt;layer_8_moe_out -->
<g id="edge251" class="edge">
<title>layer_8_expert_comm&#45;&gt;layer_8_moe_out</title>
<path fill="none" stroke="black" d="M1104,-8817.46C1104,-8809.42 1104,-8800.67 1104,-8791.92"/>
<polygon fill="black" stroke="black" points="1107.5,-8791.7 1104,-8781.7 1100.5,-8791.7 1107.5,-8791.7"/>
</g>
<!-- layer_8_norm -->
<g id="node181" class="node">
<title>layer_8_norm</title>
<polygon fill="lightgreen" stroke="black" points="1214.5,-8641.53 993.5,-8641.53 993.5,-8589.53 1214.5,-8589.53 1214.5,-8641.53"/>
<text text-anchor="middle" x="1104" y="-8629.53" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="1104" y="-8618.53" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1104" y="-8607.53" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1104" y="-8596.53" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_8_moe_out&#45;&gt;layer_8_norm -->
<g id="edge252" class="edge">
<title>layer_8_moe_out&#45;&gt;layer_8_norm</title>
<path fill="none" stroke="black" d="M1104,-8677.45C1104,-8668.78 1104,-8659.96 1104,-8651.82"/>
<polygon fill="black" stroke="black" points="1107.5,-8651.57 1104,-8641.57 1100.5,-8651.57 1107.5,-8651.57"/>
</g>
<!-- layer_9_input -->
<g id="node182" class="node">
<title>layer_9_input</title>
<polygon fill="lightyellow" stroke="black" points="1368.24,-8542.53 947.89,-8542.53 839.76,-8460.53 1260.11,-8460.53 1368.24,-8542.53"/>
<text text-anchor="middle" x="1104" y="-8510.03" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="1104" y="-8499.03" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1104" y="-8488.03" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_8_norm&#45;&gt;layer_9_input -->
<g id="edge253" class="edge">
<title>layer_8_norm&#45;&gt;layer_9_input</title>
<path fill="none" stroke="black" d="M1104,-8589.4C1104,-8578.71 1104,-8565.85 1104,-8553.34"/>
<polygon fill="black" stroke="black" points="1107.5,-8552.97 1104,-8542.97 1100.5,-8552.97 1107.5,-8552.97"/>
</g>
<!-- layer_9_qkv_tp0 -->
<g id="node183" class="node">
<title>layer_9_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1057.5,-8424.53 782.5,-8424.53 782.5,-8372.53 1057.5,-8372.53 1057.5,-8424.53"/>
<text text-anchor="middle" x="920" y="-8412.53" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="920" y="-8401.53" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="920" y="-8390.53" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="920" y="-8379.53" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_9_input&#45;&gt;layer_9_qkv_tp0 -->
<g id="edge254" class="edge">
<title>layer_9_input&#45;&gt;layer_9_qkv_tp0</title>
<path fill="none" stroke="black" d="M1031.01,-8460.47C1012.22,-8450.15 992.31,-8439.22 974.63,-8429.52"/>
<polygon fill="black" stroke="black" points="976.05,-8426.3 965.6,-8424.56 972.68,-8432.44 976.05,-8426.3"/>
</g>
<!-- layer_9_qkv_tp1 -->
<g id="node184" class="node">
<title>layer_9_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1350.5,-8424.53 1075.5,-8424.53 1075.5,-8372.53 1350.5,-8372.53 1350.5,-8424.53"/>
<text text-anchor="middle" x="1213" y="-8412.53" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1213" y="-8401.53" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1213" y="-8390.53" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1213" y="-8379.53" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_9_input&#45;&gt;layer_9_qkv_tp1 -->
<g id="edge255" class="edge">
<title>layer_9_input&#45;&gt;layer_9_qkv_tp1</title>
<path fill="none" stroke="black" d="M1147.39,-8460.32C1157.61,-8450.86 1168.36,-8440.89 1178.14,-8431.83"/>
<polygon fill="black" stroke="black" points="1180.79,-8434.15 1185.75,-8424.78 1176.03,-8429.01 1180.79,-8434.15"/>
</g>
<!-- layer_9_attn_tp0 -->
<g id="node185" class="node">
<title>layer_9_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1054,-8336.53 792,-8336.53 792,-8284.53 1054,-8284.53 1054,-8336.53"/>
<text text-anchor="middle" x="923" y="-8324.53" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="923" y="-8313.53" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="923" y="-8302.53" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="923" y="-8291.53" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_9_qkv_tp0&#45;&gt;layer_9_attn_tp0 -->
<g id="edge256" class="edge">
<title>layer_9_qkv_tp0&#45;&gt;layer_9_attn_tp0</title>
<path fill="none" stroke="black" d="M920.88,-8372.19C921.16,-8364.23 921.47,-8355.29 921.77,-8346.78"/>
<polygon fill="black" stroke="black" points="925.27,-8346.8 922.12,-8336.69 918.28,-8346.56 925.27,-8346.8"/>
</g>
<!-- layer_9_attn_tp1 -->
<g id="node186" class="node">
<title>layer_9_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1340,-8336.53 1078,-8336.53 1078,-8284.53 1340,-8284.53 1340,-8336.53"/>
<text text-anchor="middle" x="1209" y="-8324.53" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1209" y="-8313.53" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1209" y="-8302.53" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1209" y="-8291.53" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_9_qkv_tp1&#45;&gt;layer_9_attn_tp1 -->
<g id="edge257" class="edge">
<title>layer_9_qkv_tp1&#45;&gt;layer_9_attn_tp1</title>
<path fill="none" stroke="black" d="M1211.82,-8372.19C1211.45,-8364.23 1211.04,-8355.29 1210.64,-8346.78"/>
<polygon fill="black" stroke="black" points="1214.13,-8346.51 1210.17,-8336.69 1207.14,-8346.84 1214.13,-8346.51"/>
</g>
<!-- layer_9_attn_comm -->
<g id="node187" class="node">
<title>layer_9_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1069" cy="-8211.76" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1069" y="-8225.76" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="1069" y="-8214.76" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1069" y="-8203.76" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1069" y="-8192.76" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_9_attn_tp0&#45;&gt;layer_9_attn_comm -->
<g id="edge258" class="edge">
<title>layer_9_attn_tp0&#45;&gt;layer_9_attn_comm</title>
<path fill="none" stroke="black" d="M960.98,-8284.36C975.8,-8274.53 993.15,-8263.04 1009.55,-8252.17"/>
<polygon fill="black" stroke="black" points="1011.62,-8254.99 1018.02,-8246.55 1007.75,-8249.16 1011.62,-8254.99"/>
</g>
<!-- layer_9_attn_tp1&#45;&gt;layer_9_attn_comm -->
<g id="edge259" class="edge">
<title>layer_9_attn_tp1&#45;&gt;layer_9_attn_comm</title>
<path fill="none" stroke="black" d="M1172.58,-8284.36C1158.57,-8274.67 1142.2,-8263.36 1126.67,-8252.62"/>
<polygon fill="black" stroke="black" points="1128.37,-8249.54 1118.15,-8246.73 1124.38,-8255.3 1128.37,-8249.54"/>
</g>
<!-- layer_9_attn_out -->
<g id="node188" class="node">
<title>layer_9_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1179.5,-8138.99 958.5,-8138.99 958.5,-8086.99 1179.5,-8086.99 1179.5,-8138.99"/>
<text text-anchor="middle" x="1069" y="-8126.99" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="1069" y="-8115.99" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1069" y="-8104.99" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1069" y="-8093.99" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_9_attn_comm&#45;&gt;layer_9_attn_out -->
<g id="edge260" class="edge">
<title>layer_9_attn_comm&#45;&gt;layer_9_attn_out</title>
<path fill="none" stroke="black" d="M1069,-8174.73C1069,-8166.41 1069,-8157.58 1069,-8149.3"/>
<polygon fill="black" stroke="black" points="1072.5,-8149.19 1069,-8139.19 1065.5,-8149.19 1072.5,-8149.19"/>
</g>
<!-- layer_9_gate -->
<g id="node189" class="node">
<title>layer_9_gate</title>
<polygon fill="lightyellow" stroke="black" points="1323.01,-8050.99 918.94,-8050.99 814.99,-7946.99 1219.06,-7946.99 1323.01,-8050.99"/>
<text text-anchor="middle" x="1069" y="-8012.99" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="1069" y="-8001.99" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1069" y="-7990.99" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1069" y="-7979.99" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_9_attn_out&#45;&gt;layer_9_gate -->
<g id="edge261" class="edge">
<title>layer_9_attn_out&#45;&gt;layer_9_gate</title>
<path fill="none" stroke="black" d="M1069,-8086.86C1069,-8079.17 1069,-8070.36 1069,-8061.36"/>
<polygon fill="black" stroke="black" points="1072.5,-8061.17 1069,-8051.17 1065.5,-8061.17 1072.5,-8061.17"/>
</g>
<!-- layer_9_expert_select -->
<g id="node190" class="node">
<title>layer_9_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1335.39,-7910.99 911.62,-7910.99 802.61,-7806.99 1226.38,-7806.99 1335.39,-7910.99"/>
<text text-anchor="middle" x="1069" y="-7872.99" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="1069" y="-7861.99" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1069" y="-7850.99" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="1069" y="-7839.99" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_9_gate&#45;&gt;layer_9_expert_select -->
<g id="edge262" class="edge">
<title>layer_9_gate&#45;&gt;layer_9_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1069,-7946.61C1069,-7938.43 1069,-7929.91 1069,-7921.53"/>
<polygon fill="black" stroke="black" points="1072.5,-7921.42 1069,-7911.42 1065.5,-7921.42 1072.5,-7921.42"/>
</g>
<!-- layer_9_experts_gpu0 -->
<g id="node191" class="node">
<title>layer_9_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="404.5,-7770.99 189.5,-7770.99 189.5,-7718.99 404.5,-7718.99 404.5,-7770.99"/>
<text text-anchor="middle" x="297" y="-7758.99" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="297" y="-7747.99" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="297" y="-7736.99" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="297" y="-7725.99" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_9_expert_select&#45;&gt;layer_9_experts_gpu0 -->
<g id="edge263" class="edge">
<title>layer_9_expert_select&#45;&gt;layer_9_experts_gpu0</title>
<path fill="none" stroke="black" d="M827.23,-7830.64C705.96,-7815.76 556.71,-7795.68 414.89,-7771.27"/>
<polygon fill="black" stroke="black" points="415.14,-7767.76 404.69,-7769.51 413.95,-7774.66 415.14,-7767.76"/>
</g>
<!-- layer_9_experts_gpu1 -->
<g id="node192" class="node">
<title>layer_9_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="637.5,-7770.99 422.5,-7770.99 422.5,-7718.99 637.5,-7718.99 637.5,-7770.99"/>
<text text-anchor="middle" x="530" y="-7758.99" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="530" y="-7747.99" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="530" y="-7736.99" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="530" y="-7725.99" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_9_expert_select&#45;&gt;layer_9_experts_gpu1 -->
<g id="edge264" class="edge">
<title>layer_9_expert_select&#45;&gt;layer_9_experts_gpu1</title>
<path fill="none" stroke="black" d="M819.85,-7806.94C765.91,-7795.8 709.01,-7783.99 647.63,-7771.12"/>
<polygon fill="black" stroke="black" points="648.24,-7767.67 637.73,-7769.04 646.8,-7774.52 648.24,-7767.67"/>
</g>
<!-- layer_9_experts_gpu2 -->
<g id="node193" class="node">
<title>layer_9_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="870.5,-7770.99 655.5,-7770.99 655.5,-7718.99 870.5,-7718.99 870.5,-7770.99"/>
<text text-anchor="middle" x="763" y="-7758.99" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="763" y="-7747.99" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="763" y="-7736.99" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="763" y="-7725.99" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_9_expert_select&#45;&gt;layer_9_experts_gpu2 -->
<g id="edge265" class="edge">
<title>layer_9_expert_select&#45;&gt;layer_9_experts_gpu2</title>
<path fill="none" stroke="black" d="M929.43,-7806.91C899.11,-7795.81 868.08,-7784.45 841.15,-7774.59"/>
<polygon fill="black" stroke="black" points="842.02,-7771.19 831.42,-7771.03 839.61,-7777.76 842.02,-7771.19"/>
</g>
<!-- layer_9_experts_gpu3 -->
<g id="node194" class="node">
<title>layer_9_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1103.5,-7770.99 888.5,-7770.99 888.5,-7718.99 1103.5,-7718.99 1103.5,-7770.99"/>
<text text-anchor="middle" x="996" y="-7758.99" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="996" y="-7747.99" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="996" y="-7736.99" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="996" y="-7725.99" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_9_expert_select&#45;&gt;layer_9_experts_gpu3 -->
<g id="edge266" class="edge">
<title>layer_9_expert_select&#45;&gt;layer_9_experts_gpu3</title>
<path fill="none" stroke="black" d="M1035.7,-7806.91C1029.68,-7797.66 1023.53,-7788.23 1017.93,-7779.64"/>
<polygon fill="black" stroke="black" points="1020.72,-7777.5 1012.32,-7771.03 1014.85,-7781.32 1020.72,-7777.5"/>
</g>
<!-- layer_9_experts_gpu4 -->
<g id="node195" class="node">
<title>layer_9_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1336.5,-7770.99 1121.5,-7770.99 1121.5,-7718.99 1336.5,-7718.99 1336.5,-7770.99"/>
<text text-anchor="middle" x="1229" y="-7758.99" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1229" y="-7747.99" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1229" y="-7736.99" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1229" y="-7725.99" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_9_expert_select&#45;&gt;layer_9_experts_gpu4 -->
<g id="edge267" class="edge">
<title>layer_9_expert_select&#45;&gt;layer_9_experts_gpu4</title>
<path fill="none" stroke="black" d="M1141.98,-7806.91C1156.58,-7796.68 1171.5,-7786.24 1184.76,-7776.96"/>
<polygon fill="black" stroke="black" points="1187.04,-7779.64 1193.22,-7771.03 1183.02,-7773.9 1187.04,-7779.64"/>
</g>
<!-- layer_9_experts_gpu5 -->
<g id="node196" class="node">
<title>layer_9_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1569.5,-7770.99 1354.5,-7770.99 1354.5,-7718.99 1569.5,-7718.99 1569.5,-7770.99"/>
<text text-anchor="middle" x="1462" y="-7758.99" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1462" y="-7747.99" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1462" y="-7736.99" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1462" y="-7725.99" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_9_expert_select&#45;&gt;layer_9_experts_gpu5 -->
<g id="edge268" class="edge">
<title>layer_9_expert_select&#45;&gt;layer_9_experts_gpu5</title>
<path fill="none" stroke="black" d="M1231.4,-7811.71C1276.59,-7798.83 1324.26,-7785.24 1364.46,-7773.79"/>
<polygon fill="black" stroke="black" points="1365.59,-7777.11 1374.24,-7771 1363.67,-7770.38 1365.59,-7777.11"/>
</g>
<!-- layer_9_experts_gpu6 -->
<g id="node197" class="node">
<title>layer_9_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1802.5,-7770.99 1587.5,-7770.99 1587.5,-7718.99 1802.5,-7718.99 1802.5,-7770.99"/>
<text text-anchor="middle" x="1695" y="-7758.99" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1695" y="-7747.99" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1695" y="-7736.99" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1695" y="-7725.99" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_9_expert_select&#45;&gt;layer_9_experts_gpu6 -->
<g id="edge269" class="edge">
<title>layer_9_expert_select&#45;&gt;layer_9_experts_gpu6</title>
<path fill="none" stroke="black" d="M1249.61,-7829.14C1344.54,-7813.49 1463.04,-7793.22 1577.31,-7771.29"/>
<polygon fill="black" stroke="black" points="1578.13,-7774.7 1587.28,-7769.37 1576.8,-7767.82 1578.13,-7774.7"/>
</g>
<!-- layer_9_experts_gpu7 -->
<g id="node198" class="node">
<title>layer_9_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2035.5,-7770.99 1820.5,-7770.99 1820.5,-7718.99 2035.5,-7718.99 2035.5,-7770.99"/>
<text text-anchor="middle" x="1928" y="-7758.99" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1928" y="-7747.99" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1928" y="-7736.99" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1928" y="-7725.99" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_9_expert_select&#45;&gt;layer_9_experts_gpu7 -->
<g id="edge270" class="edge">
<title>layer_9_expert_select&#45;&gt;layer_9_experts_gpu7</title>
<path fill="none" stroke="black" d="M1261.76,-7840.53C1409.59,-7825.93 1618.77,-7802.65 1810.34,-7771.21"/>
<polygon fill="black" stroke="black" points="1811.02,-7774.65 1820.32,-7769.56 1809.88,-7767.74 1811.02,-7774.65"/>
</g>
<!-- layer_9_expert_comm -->
<g id="node199" class="node">
<title>layer_9_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1157" cy="-7646.22" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1157" y="-7660.22" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1157" y="-7649.22" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="1157" y="-7638.22" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1157" y="-7627.22" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_9_experts_gpu0&#45;&gt;layer_9_expert_comm -->
<g id="edge271" class="edge">
<title>layer_9_experts_gpu0&#45;&gt;layer_9_expert_comm</title>
<path fill="none" stroke="black" d="M404.67,-7720.34C407.47,-7719.87 410.25,-7719.42 413,-7718.99 612.93,-7687.91 845.31,-7668.07 996.44,-7657.3"/>
<polygon fill="black" stroke="black" points="997,-7660.77 1006.73,-7656.57 996.51,-7653.79 997,-7660.77"/>
</g>
<!-- layer_9_experts_gpu1&#45;&gt;layer_9_expert_comm -->
<g id="edge272" class="edge">
<title>layer_9_experts_gpu1&#45;&gt;layer_9_expert_comm</title>
<path fill="none" stroke="black" d="M637.69,-7720.68C640.82,-7720.1 643.93,-7719.53 647,-7718.99 768.64,-7697.47 907.51,-7678.27 1009.6,-7665.16"/>
<polygon fill="black" stroke="black" points="1010.2,-7668.61 1019.67,-7663.87 1009.31,-7661.67 1010.2,-7668.61"/>
</g>
<!-- layer_9_experts_gpu2&#45;&gt;layer_9_expert_comm -->
<g id="edge273" class="edge">
<title>layer_9_experts_gpu2&#45;&gt;layer_9_expert_comm</title>
<path fill="none" stroke="black" d="M864.98,-7718.94C918.86,-7705.71 985.21,-7689.41 1041.04,-7675.7"/>
<polygon fill="black" stroke="black" points="1042.1,-7679.04 1050.98,-7673.26 1040.44,-7672.25 1042.1,-7679.04"/>
</g>
<!-- layer_9_experts_gpu3&#45;&gt;layer_9_expert_comm -->
<g id="edge274" class="edge">
<title>layer_9_experts_gpu3&#45;&gt;layer_9_expert_comm</title>
<path fill="none" stroke="black" d="M1037.88,-7718.82C1054.61,-7708.76 1074.26,-7696.95 1092.72,-7685.86"/>
<polygon fill="black" stroke="black" points="1094.61,-7688.8 1101.38,-7680.65 1091.01,-7682.8 1094.61,-7688.8"/>
</g>
<!-- layer_9_experts_gpu4&#45;&gt;layer_9_expert_comm -->
<g id="edge275" class="edge">
<title>layer_9_experts_gpu4&#45;&gt;layer_9_expert_comm</title>
<path fill="none" stroke="black" d="M1210.27,-7718.82C1203.95,-7710.33 1196.71,-7700.59 1189.64,-7691.09"/>
<polygon fill="black" stroke="black" points="1192.27,-7688.77 1183.5,-7682.83 1186.66,-7692.94 1192.27,-7688.77"/>
</g>
<!-- layer_9_experts_gpu5&#45;&gt;layer_9_expert_comm -->
<g id="edge276" class="edge">
<title>layer_9_experts_gpu5&#45;&gt;layer_9_expert_comm</title>
<path fill="none" stroke="black" d="M1383.06,-7718.94C1344.9,-7706.84 1298.67,-7692.17 1257.98,-7679.26"/>
<polygon fill="black" stroke="black" points="1258.9,-7675.88 1248.31,-7676.19 1256.78,-7682.55 1258.9,-7675.88"/>
</g>
<!-- layer_9_experts_gpu6&#45;&gt;layer_9_expert_comm -->
<g id="edge277" class="edge">
<title>layer_9_experts_gpu6&#45;&gt;layer_9_expert_comm</title>
<path fill="none" stroke="black" d="M1587.29,-7720.61C1584.5,-7720.06 1581.73,-7719.52 1579,-7718.99 1484.33,-7700.75 1377.25,-7682.57 1294.63,-7669.07"/>
<polygon fill="black" stroke="black" points="1295.12,-7665.6 1284.68,-7667.44 1293.99,-7672.51 1295.12,-7665.6"/>
</g>
<!-- layer_9_experts_gpu7&#45;&gt;layer_9_expert_comm -->
<g id="edge278" class="edge">
<title>layer_9_experts_gpu7&#45;&gt;layer_9_expert_comm</title>
<path fill="none" stroke="black" d="M1820.32,-7720.39C1817.52,-7719.9 1814.75,-7719.44 1812,-7718.99 1642.79,-7691.56 1447.25,-7671.65 1314.19,-7659.86"/>
<polygon fill="black" stroke="black" points="1314.18,-7656.35 1303.92,-7658.95 1313.57,-7663.32 1314.18,-7656.35"/>
</g>
<!-- layer_9_moe_out -->
<g id="node200" class="node">
<title>layer_9_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1386.24,-7573.45 1021.57,-7573.45 927.76,-7469.45 1292.43,-7469.45 1386.24,-7573.45"/>
<text text-anchor="middle" x="1157" y="-7535.45" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="1157" y="-7524.45" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1157" y="-7513.45" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1157" y="-7502.45" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_9_expert_comm&#45;&gt;layer_9_moe_out -->
<g id="edge279" class="edge">
<title>layer_9_expert_comm&#45;&gt;layer_9_moe_out</title>
<path fill="none" stroke="black" d="M1157,-7609.38C1157,-7601.34 1157,-7592.6 1157,-7583.85"/>
<polygon fill="black" stroke="black" points="1160.5,-7583.62 1157,-7573.62 1153.5,-7583.62 1160.5,-7583.62"/>
</g>
<!-- layer_9_norm -->
<g id="node201" class="node">
<title>layer_9_norm</title>
<polygon fill="lightgreen" stroke="black" points="1267.5,-7433.45 1046.5,-7433.45 1046.5,-7381.45 1267.5,-7381.45 1267.5,-7433.45"/>
<text text-anchor="middle" x="1157" y="-7421.45" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="1157" y="-7410.45" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1157" y="-7399.45" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1157" y="-7388.45" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_9_moe_out&#45;&gt;layer_9_norm -->
<g id="edge280" class="edge">
<title>layer_9_moe_out&#45;&gt;layer_9_norm</title>
<path fill="none" stroke="black" d="M1157,-7469.37C1157,-7460.7 1157,-7451.88 1157,-7443.74"/>
<polygon fill="black" stroke="black" points="1160.5,-7443.5 1157,-7433.5 1153.5,-7443.5 1160.5,-7443.5"/>
</g>
<!-- layer_10_input -->
<g id="node202" class="node">
<title>layer_10_input</title>
<polygon fill="lightyellow" stroke="black" points="1421.24,-7334.45 1000.89,-7334.45 892.76,-7252.45 1313.11,-7252.45 1421.24,-7334.45"/>
<text text-anchor="middle" x="1157" y="-7301.95" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="1157" y="-7290.95" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1157" y="-7279.95" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_9_norm&#45;&gt;layer_10_input -->
<g id="edge281" class="edge">
<title>layer_9_norm&#45;&gt;layer_10_input</title>
<path fill="none" stroke="black" d="M1157,-7381.32C1157,-7370.64 1157,-7357.77 1157,-7345.26"/>
<polygon fill="black" stroke="black" points="1160.5,-7344.89 1157,-7334.89 1153.5,-7344.89 1160.5,-7344.89"/>
</g>
<!-- layer_10_qkv_tp0 -->
<g id="node203" class="node">
<title>layer_10_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1222.5,-7216.45 947.5,-7216.45 947.5,-7164.45 1222.5,-7164.45 1222.5,-7216.45"/>
<text text-anchor="middle" x="1085" y="-7204.45" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="1085" y="-7193.45" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1085" y="-7182.45" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1085" y="-7171.45" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_10_input&#45;&gt;layer_10_qkv_tp0 -->
<g id="edge282" class="edge">
<title>layer_10_input&#45;&gt;layer_10_qkv_tp0</title>
<path fill="none" stroke="black" d="M1128.34,-7252.24C1121.93,-7243.25 1115.19,-7233.8 1108.99,-7225.1"/>
<polygon fill="black" stroke="black" points="1111.66,-7222.81 1103,-7216.7 1105.96,-7226.88 1111.66,-7222.81"/>
</g>
<!-- layer_10_qkv_tp1 -->
<g id="node204" class="node">
<title>layer_10_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1515.5,-7216.45 1240.5,-7216.45 1240.5,-7164.45 1515.5,-7164.45 1515.5,-7216.45"/>
<text text-anchor="middle" x="1378" y="-7204.45" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1378" y="-7193.45" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1378" y="-7182.45" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-7171.45" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_10_input&#45;&gt;layer_10_qkv_tp1 -->
<g id="edge283" class="edge">
<title>layer_10_input&#45;&gt;layer_10_qkv_tp1</title>
<path fill="none" stroke="black" d="M1244.66,-7252.39C1267.86,-7241.79 1292.46,-7230.54 1314.14,-7220.64"/>
<polygon fill="black" stroke="black" points="1315.59,-7223.82 1323.23,-7216.48 1312.68,-7217.46 1315.59,-7223.82"/>
</g>
<!-- layer_10_attn_tp0 -->
<g id="node205" class="node">
<title>layer_10_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1220,-7128.45 958,-7128.45 958,-7076.45 1220,-7076.45 1220,-7128.45"/>
<text text-anchor="middle" x="1089" y="-7116.45" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="1089" y="-7105.45" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1089" y="-7094.45" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1089" y="-7083.45" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_10_qkv_tp0&#45;&gt;layer_10_attn_tp0 -->
<g id="edge284" class="edge">
<title>layer_10_qkv_tp0&#45;&gt;layer_10_attn_tp0</title>
<path fill="none" stroke="black" d="M1086.18,-7164.11C1086.55,-7156.15 1086.96,-7147.22 1087.36,-7138.7"/>
<polygon fill="black" stroke="black" points="1090.86,-7138.76 1087.83,-7128.61 1083.87,-7138.44 1090.86,-7138.76"/>
</g>
<!-- layer_10_attn_tp1 -->
<g id="node206" class="node">
<title>layer_10_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1506,-7128.45 1244,-7128.45 1244,-7076.45 1506,-7076.45 1506,-7128.45"/>
<text text-anchor="middle" x="1375" y="-7116.45" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1375" y="-7105.45" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1375" y="-7094.45" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1375" y="-7083.45" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_10_qkv_tp1&#45;&gt;layer_10_attn_tp1 -->
<g id="edge285" class="edge">
<title>layer_10_qkv_tp1&#45;&gt;layer_10_attn_tp1</title>
<path fill="none" stroke="black" d="M1377.12,-7164.11C1376.84,-7156.15 1376.53,-7147.22 1376.23,-7138.7"/>
<polygon fill="black" stroke="black" points="1379.72,-7138.48 1375.88,-7128.61 1372.73,-7138.72 1379.72,-7138.48"/>
</g>
<!-- layer_10_attn_comm -->
<g id="node207" class="node">
<title>layer_10_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1112" cy="-7003.68" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1112" y="-7017.68" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="1112" y="-7006.68" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1112" y="-6995.68" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1112" y="-6984.68" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_10_attn_tp0&#45;&gt;layer_10_attn_comm -->
<g id="edge286" class="edge">
<title>layer_10_attn_tp0&#45;&gt;layer_10_attn_comm</title>
<path fill="none" stroke="black" d="M1094.98,-7076.28C1096.86,-7068.39 1098.99,-7059.41 1101.1,-7050.55"/>
<polygon fill="black" stroke="black" points="1104.54,-7051.2 1103.45,-7040.66 1097.73,-7049.58 1104.54,-7051.2"/>
</g>
<!-- layer_10_attn_tp1&#45;&gt;layer_10_attn_comm -->
<g id="edge287" class="edge">
<title>layer_10_attn_tp1&#45;&gt;layer_10_attn_comm</title>
<path fill="none" stroke="black" d="M1306.93,-7076.41C1275.49,-7064.84 1237.69,-7050.93 1203.77,-7038.45"/>
<polygon fill="black" stroke="black" points="1204.91,-7035.14 1194.32,-7034.97 1202.5,-7041.71 1204.91,-7035.14"/>
</g>
<!-- layer_10_attn_out -->
<g id="node208" class="node">
<title>layer_10_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1222.5,-6930.91 1001.5,-6930.91 1001.5,-6878.91 1222.5,-6878.91 1222.5,-6930.91"/>
<text text-anchor="middle" x="1112" y="-6918.91" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="1112" y="-6907.91" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1112" y="-6896.91" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1112" y="-6885.91" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_10_attn_comm&#45;&gt;layer_10_attn_out -->
<g id="edge288" class="edge">
<title>layer_10_attn_comm&#45;&gt;layer_10_attn_out</title>
<path fill="none" stroke="black" d="M1112,-6966.65C1112,-6958.34 1112,-6949.5 1112,-6941.22"/>
<polygon fill="black" stroke="black" points="1115.5,-6941.11 1112,-6931.11 1108.5,-6941.11 1115.5,-6941.11"/>
</g>
<!-- layer_10_gate -->
<g id="node209" class="node">
<title>layer_10_gate</title>
<polygon fill="lightyellow" stroke="black" points="1366.01,-6842.91 961.94,-6842.91 857.99,-6738.91 1262.06,-6738.91 1366.01,-6842.91"/>
<text text-anchor="middle" x="1112" y="-6804.91" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="1112" y="-6793.91" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1112" y="-6782.91" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1112" y="-6771.91" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_10_attn_out&#45;&gt;layer_10_gate -->
<g id="edge289" class="edge">
<title>layer_10_attn_out&#45;&gt;layer_10_gate</title>
<path fill="none" stroke="black" d="M1112,-6878.78C1112,-6871.09 1112,-6862.28 1112,-6853.28"/>
<polygon fill="black" stroke="black" points="1115.5,-6853.09 1112,-6843.09 1108.5,-6853.09 1115.5,-6853.09"/>
</g>
<!-- layer_10_expert_select -->
<g id="node210" class="node">
<title>layer_10_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1378.39,-6702.91 954.62,-6702.91 845.61,-6598.91 1269.38,-6598.91 1378.39,-6702.91"/>
<text text-anchor="middle" x="1112" y="-6664.91" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="1112" y="-6653.91" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1112" y="-6642.91" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="1112" y="-6631.91" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_10_gate&#45;&gt;layer_10_expert_select -->
<g id="edge290" class="edge">
<title>layer_10_gate&#45;&gt;layer_10_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1112,-6738.53C1112,-6730.35 1112,-6721.83 1112,-6713.45"/>
<polygon fill="black" stroke="black" points="1115.5,-6713.34 1112,-6703.34 1108.5,-6713.34 1115.5,-6713.34"/>
</g>
<!-- layer_10_experts_gpu0 -->
<g id="node211" class="node">
<title>layer_10_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="404.5,-6562.91 189.5,-6562.91 189.5,-6510.91 404.5,-6510.91 404.5,-6562.91"/>
<text text-anchor="middle" x="297" y="-6550.91" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="297" y="-6539.91" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="297" y="-6528.91" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="297" y="-6517.91" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_10_expert_select&#45;&gt;layer_10_experts_gpu0 -->
<g id="edge291" class="edge">
<title>layer_10_expert_select&#45;&gt;layer_10_experts_gpu0</title>
<path fill="none" stroke="black" d="M873.44,-6625.51C740.76,-6610.65 572.58,-6589.67 414.59,-6563.13"/>
<polygon fill="black" stroke="black" points="415.13,-6559.67 404.68,-6561.46 413.96,-6566.58 415.13,-6559.67"/>
</g>
<!-- layer_10_experts_gpu1 -->
<g id="node212" class="node">
<title>layer_10_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="637.5,-6562.91 422.5,-6562.91 422.5,-6510.91 637.5,-6510.91 637.5,-6562.91"/>
<text text-anchor="middle" x="530" y="-6550.91" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="530" y="-6539.91" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="530" y="-6528.91" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="530" y="-6517.91" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_10_expert_select&#45;&gt;layer_10_experts_gpu1 -->
<g id="edge292" class="edge">
<title>layer_10_expert_select&#45;&gt;layer_10_experts_gpu1</title>
<path fill="none" stroke="black" d="M848.64,-6601.85C785.69,-6590.05 718.55,-6577.19 647.74,-6563.04"/>
<polygon fill="black" stroke="black" points="648.21,-6559.57 637.72,-6561.04 646.84,-6566.43 648.21,-6559.57"/>
</g>
<!-- layer_10_experts_gpu2 -->
<g id="node213" class="node">
<title>layer_10_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="870.5,-6562.91 655.5,-6562.91 655.5,-6510.91 870.5,-6510.91 870.5,-6562.91"/>
<text text-anchor="middle" x="763" y="-6550.91" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="763" y="-6539.91" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="763" y="-6528.91" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="763" y="-6517.91" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_10_expert_select&#45;&gt;layer_10_experts_gpu2 -->
<g id="edge293" class="edge">
<title>layer_10_expert_select&#45;&gt;layer_10_experts_gpu2</title>
<path fill="none" stroke="black" d="M953.07,-6598.91C918.01,-6587.66 882.09,-6576.13 851.06,-6566.17"/>
<polygon fill="black" stroke="black" points="851.75,-6562.72 841.16,-6563 849.62,-6569.39 851.75,-6562.72"/>
</g>
<!-- layer_10_experts_gpu3 -->
<g id="node214" class="node">
<title>layer_10_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1103.5,-6562.91 888.5,-6562.91 888.5,-6510.91 1103.5,-6510.91 1103.5,-6562.91"/>
<text text-anchor="middle" x="996" y="-6550.91" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="996" y="-6539.91" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="996" y="-6528.91" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="996" y="-6517.91" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_10_expert_select&#45;&gt;layer_10_experts_gpu3 -->
<g id="edge294" class="edge">
<title>layer_10_expert_select&#45;&gt;layer_10_experts_gpu3</title>
<path fill="none" stroke="black" d="M1059.09,-6598.83C1048.91,-6589 1038.51,-6578.96 1029.18,-6569.94"/>
<polygon fill="black" stroke="black" points="1031.56,-6567.38 1021.94,-6562.96 1026.7,-6572.42 1031.56,-6567.38"/>
</g>
<!-- layer_10_experts_gpu4 -->
<g id="node215" class="node">
<title>layer_10_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1336.5,-6562.91 1121.5,-6562.91 1121.5,-6510.91 1336.5,-6510.91 1336.5,-6562.91"/>
<text text-anchor="middle" x="1229" y="-6550.91" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1229" y="-6539.91" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1229" y="-6528.91" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1229" y="-6517.91" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_10_expert_select&#45;&gt;layer_10_experts_gpu4 -->
<g id="edge295" class="edge">
<title>layer_10_expert_select&#45;&gt;layer_10_experts_gpu4</title>
<path fill="none" stroke="black" d="M1165.36,-6598.83C1175.64,-6589 1186.12,-6578.96 1195.54,-6569.94"/>
<polygon fill="black" stroke="black" points="1198.04,-6572.4 1202.84,-6562.96 1193.19,-6567.34 1198.04,-6572.4"/>
</g>
<!-- layer_10_experts_gpu5 -->
<g id="node216" class="node">
<title>layer_10_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1569.5,-6562.91 1354.5,-6562.91 1354.5,-6510.91 1569.5,-6510.91 1569.5,-6562.91"/>
<text text-anchor="middle" x="1462" y="-6550.91" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1462" y="-6539.91" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1462" y="-6528.91" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1462" y="-6517.91" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_10_expert_select&#45;&gt;layer_10_experts_gpu5 -->
<g id="edge296" class="edge">
<title>layer_10_expert_select&#45;&gt;layer_10_experts_gpu5</title>
<path fill="none" stroke="black" d="M1270.1,-6599.32C1305.73,-6587.92 1342.3,-6576.22 1373.83,-6566.13"/>
<polygon fill="black" stroke="black" points="1374.99,-6569.43 1383.45,-6563.05 1372.86,-6562.76 1374.99,-6569.43"/>
</g>
<!-- layer_10_experts_gpu6 -->
<g id="node217" class="node">
<title>layer_10_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1802.5,-6562.91 1587.5,-6562.91 1587.5,-6510.91 1802.5,-6510.91 1802.5,-6562.91"/>
<text text-anchor="middle" x="1695" y="-6550.91" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1695" y="-6539.91" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1695" y="-6528.91" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1695" y="-6517.91" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_10_expert_select&#45;&gt;layer_10_experts_gpu6 -->
<g id="edge297" class="edge">
<title>layer_10_expert_select&#45;&gt;layer_10_experts_gpu6</title>
<path fill="none" stroke="black" d="M1289.63,-6618.03C1374.1,-6602.57 1476.73,-6583.36 1577.24,-6563.25"/>
<polygon fill="black" stroke="black" points="1578.16,-6566.64 1587.27,-6561.24 1576.78,-6559.77 1578.16,-6566.64"/>
</g>
<!-- layer_10_experts_gpu7 -->
<g id="node218" class="node">
<title>layer_10_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2035.5,-6562.91 1820.5,-6562.91 1820.5,-6510.91 2035.5,-6510.91 2035.5,-6562.91"/>
<text text-anchor="middle" x="1928" y="-6550.91" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1928" y="-6539.91" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1928" y="-6528.91" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1928" y="-6517.91" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_10_expert_select&#45;&gt;layer_10_experts_gpu7 -->
<g id="edge298" class="edge">
<title>layer_10_expert_select&#45;&gt;layer_10_experts_gpu7</title>
<path fill="none" stroke="black" d="M1303.18,-6630.78C1441.66,-6615.81 1633.43,-6592.83 1810.3,-6563.15"/>
<polygon fill="black" stroke="black" points="1811.04,-6566.58 1820.32,-6561.46 1809.87,-6559.67 1811.04,-6566.58"/>
</g>
<!-- layer_10_expert_comm -->
<g id="node219" class="node">
<title>layer_10_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1105" cy="-6438.14" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1105" y="-6452.14" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1105" y="-6441.14" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="1105" y="-6430.14" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1105" y="-6419.14" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_10_experts_gpu0&#45;&gt;layer_10_expert_comm -->
<g id="edge299" class="edge">
<title>layer_10_experts_gpu0&#45;&gt;layer_10_expert_comm</title>
<path fill="none" stroke="black" d="M404.67,-6512.29C407.47,-6511.81 410.25,-6511.35 413,-6510.91 595.01,-6481.95 805.9,-6462.02 946.57,-6450.64"/>
<polygon fill="black" stroke="black" points="946.89,-6454.12 956.58,-6449.83 946.33,-6447.15 946.89,-6454.12"/>
</g>
<!-- layer_10_experts_gpu1&#45;&gt;layer_10_expert_comm -->
<g id="edge300" class="edge">
<title>layer_10_experts_gpu1&#45;&gt;layer_10_expert_comm</title>
<path fill="none" stroke="black" d="M637.7,-6512.67C640.83,-6512.07 643.94,-6511.48 647,-6510.91 752.46,-6491.4 872.22,-6472.75 962.83,-6459.36"/>
<polygon fill="black" stroke="black" points="963.51,-6462.8 972.89,-6457.88 962.49,-6455.87 963.51,-6462.8"/>
</g>
<!-- layer_10_experts_gpu2&#45;&gt;layer_10_expert_comm -->
<g id="edge301" class="edge">
<title>layer_10_experts_gpu2&#45;&gt;layer_10_expert_comm</title>
<path fill="none" stroke="black" d="M851.52,-6510.87C895.96,-6498.29 950.17,-6482.95 997.03,-6469.69"/>
<polygon fill="black" stroke="black" points="998.25,-6472.99 1006.92,-6466.9 996.34,-6466.25 998.25,-6472.99"/>
</g>
<!-- layer_10_experts_gpu3&#45;&gt;layer_10_expert_comm -->
<g id="edge302" class="edge">
<title>layer_10_experts_gpu3&#45;&gt;layer_10_expert_comm</title>
<path fill="none" stroke="black" d="M1024.35,-6510.74C1034.7,-6501.55 1046.7,-6490.9 1058.23,-6480.67"/>
<polygon fill="black" stroke="black" points="1060.56,-6483.28 1065.71,-6474.02 1055.91,-6478.05 1060.56,-6483.28"/>
</g>
<!-- layer_10_experts_gpu4&#45;&gt;layer_10_expert_comm -->
<g id="edge303" class="edge">
<title>layer_10_experts_gpu4&#45;&gt;layer_10_expert_comm</title>
<path fill="none" stroke="black" d="M1196.74,-6510.74C1184.74,-6501.37 1170.79,-6490.48 1157.44,-6480.07"/>
<polygon fill="black" stroke="black" points="1159.27,-6477.05 1149.23,-6473.66 1154.96,-6482.57 1159.27,-6477.05"/>
</g>
<!-- layer_10_experts_gpu5&#45;&gt;layer_10_expert_comm -->
<g id="edge304" class="edge">
<title>layer_10_experts_gpu5&#45;&gt;layer_10_expert_comm</title>
<path fill="none" stroke="black" d="M1369.6,-6510.87C1322.44,-6498.08 1264.73,-6482.44 1215.26,-6469.03"/>
<polygon fill="black" stroke="black" points="1216.05,-6465.62 1205.48,-6466.38 1214.21,-6472.37 1216.05,-6465.62"/>
</g>
<!-- layer_10_experts_gpu6&#45;&gt;layer_10_expert_comm -->
<g id="edge305" class="edge">
<title>layer_10_experts_gpu6&#45;&gt;layer_10_expert_comm</title>
<path fill="none" stroke="black" d="M1587.3,-6512.46C1584.51,-6511.93 1581.74,-6511.41 1579,-6510.91 1468.71,-6490.7 1343.24,-6471.89 1249.1,-6458.6"/>
<polygon fill="black" stroke="black" points="1249.33,-6455.09 1238.94,-6457.16 1248.35,-6462.02 1249.33,-6455.09"/>
</g>
<!-- layer_10_experts_gpu7&#45;&gt;layer_10_expert_comm -->
<g id="edge306" class="edge">
<title>layer_10_experts_gpu7&#45;&gt;layer_10_expert_comm</title>
<path fill="none" stroke="black" d="M1820.33,-6512.28C1817.53,-6511.8 1814.75,-6511.35 1812,-6510.91 1624.86,-6481.34 1407.84,-6461.42 1264.12,-6450.22"/>
<polygon fill="black" stroke="black" points="1264.14,-6446.71 1253.9,-6449.43 1263.6,-6453.69 1264.14,-6446.71"/>
</g>
<!-- layer_10_moe_out -->
<g id="node220" class="node">
<title>layer_10_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1334.24,-6365.37 969.57,-6365.37 875.76,-6261.37 1240.43,-6261.37 1334.24,-6365.37"/>
<text text-anchor="middle" x="1105" y="-6327.37" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="1105" y="-6316.37" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1105" y="-6305.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1105" y="-6294.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_10_expert_comm&#45;&gt;layer_10_moe_out -->
<g id="edge307" class="edge">
<title>layer_10_expert_comm&#45;&gt;layer_10_moe_out</title>
<path fill="none" stroke="black" d="M1105,-6401.3C1105,-6393.27 1105,-6384.52 1105,-6375.77"/>
<polygon fill="black" stroke="black" points="1108.5,-6375.54 1105,-6365.54 1101.5,-6375.54 1108.5,-6375.54"/>
</g>
<!-- layer_10_norm -->
<g id="node221" class="node">
<title>layer_10_norm</title>
<polygon fill="lightgreen" stroke="black" points="1215.5,-6225.37 994.5,-6225.37 994.5,-6173.37 1215.5,-6173.37 1215.5,-6225.37"/>
<text text-anchor="middle" x="1105" y="-6213.37" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="1105" y="-6202.37" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1105" y="-6191.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1105" y="-6180.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_10_moe_out&#45;&gt;layer_10_norm -->
<g id="edge308" class="edge">
<title>layer_10_moe_out&#45;&gt;layer_10_norm</title>
<path fill="none" stroke="black" d="M1105,-6261.29C1105,-6252.63 1105,-6243.8 1105,-6235.66"/>
<polygon fill="black" stroke="black" points="1108.5,-6235.42 1105,-6225.42 1101.5,-6235.42 1108.5,-6235.42"/>
</g>
<!-- layer_11_input -->
<g id="node222" class="node">
<title>layer_11_input</title>
<polygon fill="lightyellow" stroke="black" points="1369.24,-6126.37 948.89,-6126.37 840.76,-6044.37 1261.11,-6044.37 1369.24,-6126.37"/>
<text text-anchor="middle" x="1105" y="-6093.87" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="1105" y="-6082.87" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1105" y="-6071.87" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_10_norm&#45;&gt;layer_11_input -->
<g id="edge309" class="edge">
<title>layer_10_norm&#45;&gt;layer_11_input</title>
<path fill="none" stroke="black" d="M1105,-6173.24C1105,-6162.56 1105,-6149.7 1105,-6137.18"/>
<polygon fill="black" stroke="black" points="1108.5,-6136.81 1105,-6126.81 1101.5,-6136.81 1108.5,-6136.81"/>
</g>
<!-- layer_11_qkv_tp0 -->
<g id="node223" class="node">
<title>layer_11_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1058.5,-6008.37 783.5,-6008.37 783.5,-5956.37 1058.5,-5956.37 1058.5,-6008.37"/>
<text text-anchor="middle" x="921" y="-5996.37" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="921" y="-5985.37" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="921" y="-5974.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="921" y="-5963.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_11_input&#45;&gt;layer_11_qkv_tp0 -->
<g id="edge310" class="edge">
<title>layer_11_input&#45;&gt;layer_11_qkv_tp0</title>
<path fill="none" stroke="black" d="M1032.01,-6044.31C1013.22,-6033.99 993.31,-6023.07 975.63,-6013.36"/>
<polygon fill="black" stroke="black" points="977.05,-6010.15 966.6,-6008.4 973.68,-6016.28 977.05,-6010.15"/>
</g>
<!-- layer_11_qkv_tp1 -->
<g id="node224" class="node">
<title>layer_11_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1351.5,-6008.37 1076.5,-6008.37 1076.5,-5956.37 1351.5,-5956.37 1351.5,-6008.37"/>
<text text-anchor="middle" x="1214" y="-5996.37" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1214" y="-5985.37" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1214" y="-5974.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1214" y="-5963.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_11_input&#45;&gt;layer_11_qkv_tp1 -->
<g id="edge311" class="edge">
<title>layer_11_input&#45;&gt;layer_11_qkv_tp1</title>
<path fill="none" stroke="black" d="M1148.39,-6044.17C1158.61,-6034.7 1169.36,-6024.74 1179.14,-6015.67"/>
<polygon fill="black" stroke="black" points="1181.79,-6017.99 1186.75,-6008.63 1177.03,-6012.85 1181.79,-6017.99"/>
</g>
<!-- layer_11_attn_tp0 -->
<g id="node225" class="node">
<title>layer_11_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1055,-5920.37 793,-5920.37 793,-5868.37 1055,-5868.37 1055,-5920.37"/>
<text text-anchor="middle" x="924" y="-5908.37" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="924" y="-5897.37" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="924" y="-5886.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="924" y="-5875.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_11_qkv_tp0&#45;&gt;layer_11_attn_tp0 -->
<g id="edge312" class="edge">
<title>layer_11_qkv_tp0&#45;&gt;layer_11_attn_tp0</title>
<path fill="none" stroke="black" d="M921.88,-5956.04C922.16,-5948.08 922.47,-5939.14 922.77,-5930.62"/>
<polygon fill="black" stroke="black" points="926.27,-5930.65 923.12,-5920.53 919.28,-5930.4 926.27,-5930.65"/>
</g>
<!-- layer_11_attn_tp1 -->
<g id="node226" class="node">
<title>layer_11_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1341,-5920.37 1079,-5920.37 1079,-5868.37 1341,-5868.37 1341,-5920.37"/>
<text text-anchor="middle" x="1210" y="-5908.37" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1210" y="-5897.37" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1210" y="-5886.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1210" y="-5875.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_11_qkv_tp1&#45;&gt;layer_11_attn_tp1 -->
<g id="edge313" class="edge">
<title>layer_11_qkv_tp1&#45;&gt;layer_11_attn_tp1</title>
<path fill="none" stroke="black" d="M1212.82,-5956.04C1212.45,-5948.08 1212.04,-5939.14 1211.64,-5930.62"/>
<polygon fill="black" stroke="black" points="1215.13,-5930.36 1211.17,-5920.53 1208.14,-5930.68 1215.13,-5930.36"/>
</g>
<!-- layer_11_attn_comm -->
<g id="node227" class="node">
<title>layer_11_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1067" cy="-5795.6" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1067" y="-5809.6" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="1067" y="-5798.6" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1067" y="-5787.6" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1067" y="-5776.6" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_11_attn_tp0&#45;&gt;layer_11_attn_comm -->
<g id="edge314" class="edge">
<title>layer_11_attn_tp0&#45;&gt;layer_11_attn_comm</title>
<path fill="none" stroke="black" d="M961.2,-5868.2C975.51,-5858.51 992.23,-5847.2 1008.09,-5836.47"/>
<polygon fill="black" stroke="black" points="1010.48,-5839.08 1016.8,-5830.58 1006.55,-5833.28 1010.48,-5839.08"/>
</g>
<!-- layer_11_attn_tp1&#45;&gt;layer_11_attn_comm -->
<g id="edge315" class="edge">
<title>layer_11_attn_tp1&#45;&gt;layer_11_attn_comm</title>
<path fill="none" stroke="black" d="M1172.8,-5868.2C1158.49,-5858.51 1141.77,-5847.2 1125.91,-5836.47"/>
<polygon fill="black" stroke="black" points="1127.45,-5833.28 1117.2,-5830.58 1123.52,-5839.08 1127.45,-5833.28"/>
</g>
<!-- layer_11_attn_out -->
<g id="node228" class="node">
<title>layer_11_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1177.5,-5722.83 956.5,-5722.83 956.5,-5670.83 1177.5,-5670.83 1177.5,-5722.83"/>
<text text-anchor="middle" x="1067" y="-5710.83" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="1067" y="-5699.83" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1067" y="-5688.83" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1067" y="-5677.83" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_11_attn_comm&#45;&gt;layer_11_attn_out -->
<g id="edge316" class="edge">
<title>layer_11_attn_comm&#45;&gt;layer_11_attn_out</title>
<path fill="none" stroke="black" d="M1067,-5758.57C1067,-5750.26 1067,-5741.42 1067,-5733.14"/>
<polygon fill="black" stroke="black" points="1070.5,-5733.03 1067,-5723.03 1063.5,-5733.03 1070.5,-5733.03"/>
</g>
<!-- layer_11_gate -->
<g id="node229" class="node">
<title>layer_11_gate</title>
<polygon fill="lightyellow" stroke="black" points="1321.01,-5634.83 916.94,-5634.83 812.99,-5530.83 1217.06,-5530.83 1321.01,-5634.83"/>
<text text-anchor="middle" x="1067" y="-5596.83" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="1067" y="-5585.83" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1067" y="-5574.83" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1067" y="-5563.83" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_11_attn_out&#45;&gt;layer_11_gate -->
<g id="edge317" class="edge">
<title>layer_11_attn_out&#45;&gt;layer_11_gate</title>
<path fill="none" stroke="black" d="M1067,-5670.7C1067,-5663.01 1067,-5654.2 1067,-5645.2"/>
<polygon fill="black" stroke="black" points="1070.5,-5645.01 1067,-5635.01 1063.5,-5645.01 1070.5,-5645.01"/>
</g>
<!-- layer_11_expert_select -->
<g id="node230" class="node">
<title>layer_11_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1333.39,-5494.83 909.62,-5494.83 800.61,-5390.83 1224.38,-5390.83 1333.39,-5494.83"/>
<text text-anchor="middle" x="1067" y="-5456.83" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="1067" y="-5445.83" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1067" y="-5434.83" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="1067" y="-5423.83" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_11_gate&#45;&gt;layer_11_expert_select -->
<g id="edge318" class="edge">
<title>layer_11_gate&#45;&gt;layer_11_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1067,-5530.45C1067,-5522.28 1067,-5513.75 1067,-5505.37"/>
<polygon fill="black" stroke="black" points="1070.5,-5505.26 1067,-5495.26 1063.5,-5505.26 1070.5,-5505.26"/>
</g>
<!-- layer_11_experts_gpu0 -->
<g id="node231" class="node">
<title>layer_11_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="404.5,-5354.83 189.5,-5354.83 189.5,-5302.83 404.5,-5302.83 404.5,-5354.83"/>
<text text-anchor="middle" x="297" y="-5342.83" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="297" y="-5331.83" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="297" y="-5320.83" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="297" y="-5309.83" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_11_expert_select&#45;&gt;layer_11_experts_gpu0 -->
<g id="edge319" class="edge">
<title>layer_11_expert_select&#45;&gt;layer_11_experts_gpu0</title>
<path fill="none" stroke="black" d="M825.19,-5414.35C704.43,-5399.47 555.98,-5379.43 414.84,-5355.11"/>
<polygon fill="black" stroke="black" points="415.14,-5351.61 404.69,-5353.35 413.95,-5358.51 415.14,-5351.61"/>
</g>
<!-- layer_11_experts_gpu1 -->
<g id="node232" class="node">
<title>layer_11_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="637.5,-5354.83 422.5,-5354.83 422.5,-5302.83 637.5,-5302.83 637.5,-5354.83"/>
<text text-anchor="middle" x="530" y="-5342.83" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="530" y="-5331.83" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="530" y="-5320.83" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="530" y="-5309.83" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_11_expert_select&#45;&gt;layer_11_experts_gpu1 -->
<g id="edge320" class="edge">
<title>layer_11_expert_select&#45;&gt;layer_11_experts_gpu1</title>
<path fill="none" stroke="black" d="M819.32,-5390.8C765.56,-5379.65 708.82,-5367.83 647.6,-5354.96"/>
<polygon fill="black" stroke="black" points="648.24,-5351.52 637.74,-5352.88 646.8,-5358.37 648.24,-5351.52"/>
</g>
<!-- layer_11_experts_gpu2 -->
<g id="node233" class="node">
<title>layer_11_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="870.5,-5354.83 655.5,-5354.83 655.5,-5302.83 870.5,-5302.83 870.5,-5354.83"/>
<text text-anchor="middle" x="763" y="-5342.83" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="763" y="-5331.83" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="763" y="-5320.83" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="763" y="-5309.83" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_11_expert_select&#45;&gt;layer_11_experts_gpu2 -->
<g id="edge321" class="edge">
<title>layer_11_expert_select&#45;&gt;layer_11_experts_gpu2</title>
<path fill="none" stroke="black" d="M928.34,-5390.75C898.22,-5379.65 867.39,-5368.29 840.64,-5358.44"/>
<polygon fill="black" stroke="black" points="841.57,-5355.05 830.98,-5354.88 839.15,-5361.62 841.57,-5355.05"/>
</g>
<!-- layer_11_experts_gpu3 -->
<g id="node234" class="node">
<title>layer_11_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1103.5,-5354.83 888.5,-5354.83 888.5,-5302.83 1103.5,-5302.83 1103.5,-5354.83"/>
<text text-anchor="middle" x="996" y="-5342.83" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="996" y="-5331.83" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="996" y="-5320.83" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="996" y="-5309.83" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_11_expert_select&#45;&gt;layer_11_experts_gpu3 -->
<g id="edge322" class="edge">
<title>layer_11_expert_select&#45;&gt;layer_11_experts_gpu3</title>
<path fill="none" stroke="black" d="M1034.62,-5390.75C1028.75,-5381.5 1022.78,-5372.07 1017.33,-5363.48"/>
<polygon fill="black" stroke="black" points="1020.19,-5361.45 1011.88,-5354.88 1014.27,-5365.2 1020.19,-5361.45"/>
</g>
<!-- layer_11_experts_gpu4 -->
<g id="node235" class="node">
<title>layer_11_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1336.5,-5354.83 1121.5,-5354.83 1121.5,-5302.83 1336.5,-5302.83 1336.5,-5354.83"/>
<text text-anchor="middle" x="1229" y="-5342.83" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1229" y="-5331.83" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1229" y="-5320.83" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1229" y="-5309.83" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_11_expert_select&#45;&gt;layer_11_experts_gpu4 -->
<g id="edge323" class="edge">
<title>layer_11_expert_select&#45;&gt;layer_11_experts_gpu4</title>
<path fill="none" stroke="black" d="M1140.89,-5390.75C1155.68,-5380.53 1170.78,-5370.09 1184.21,-5360.8"/>
<polygon fill="black" stroke="black" points="1186.54,-5363.44 1192.78,-5354.88 1182.56,-5357.69 1186.54,-5363.44"/>
</g>
<!-- layer_11_experts_gpu5 -->
<g id="node236" class="node">
<title>layer_11_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1569.5,-5354.83 1354.5,-5354.83 1354.5,-5302.83 1569.5,-5302.83 1569.5,-5354.83"/>
<text text-anchor="middle" x="1462" y="-5342.83" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1462" y="-5331.83" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1462" y="-5320.83" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1462" y="-5309.83" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_11_expert_select&#45;&gt;layer_11_experts_gpu5 -->
<g id="edge324" class="edge">
<title>layer_11_expert_select&#45;&gt;layer_11_experts_gpu5</title>
<path fill="none" stroke="black" d="M1229.66,-5395.71C1275.23,-5382.79 1323.37,-5369.14 1363.93,-5357.64"/>
<polygon fill="black" stroke="black" points="1365.14,-5360.94 1373.8,-5354.84 1363.23,-5354.2 1365.14,-5360.94"/>
</g>
<!-- layer_11_experts_gpu6 -->
<g id="node237" class="node">
<title>layer_11_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1802.5,-5354.83 1587.5,-5354.83 1587.5,-5302.83 1802.5,-5302.83 1802.5,-5354.83"/>
<text text-anchor="middle" x="1695" y="-5342.83" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1695" y="-5331.83" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1695" y="-5320.83" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1695" y="-5309.83" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_11_expert_select&#45;&gt;layer_11_experts_gpu6 -->
<g id="edge325" class="edge">
<title>layer_11_expert_select&#45;&gt;layer_11_experts_gpu6</title>
<path fill="none" stroke="black" d="M1248.03,-5413.07C1343.38,-5397.43 1462.47,-5377.13 1577.26,-5355.14"/>
<polygon fill="black" stroke="black" points="1578.13,-5358.54 1587.29,-5353.22 1576.8,-5351.67 1578.13,-5358.54"/>
</g>
<!-- layer_11_experts_gpu7 -->
<g id="node238" class="node">
<title>layer_11_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2035.5,-5354.83 1820.5,-5354.83 1820.5,-5302.83 2035.5,-5302.83 2035.5,-5354.83"/>
<text text-anchor="middle" x="1928" y="-5342.83" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="1928" y="-5331.83" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1928" y="-5320.83" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1928" y="-5309.83" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_11_expert_select&#45;&gt;layer_11_experts_gpu7 -->
<g id="edge326" class="edge">
<title>layer_11_expert_select&#45;&gt;layer_11_experts_gpu7</title>
<path fill="none" stroke="black" d="M1259.89,-5424.44C1408.14,-5409.86 1618.08,-5386.58 1810.31,-5355.06"/>
<polygon fill="black" stroke="black" points="1811.02,-5358.49 1820.32,-5353.41 1809.88,-5351.58 1811.02,-5358.49"/>
</g>
<!-- layer_11_expert_comm -->
<g id="node239" class="node">
<title>layer_11_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1202" cy="-5230.07" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1202" y="-5244.07" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1202" y="-5233.07" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="1202" y="-5222.07" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1202" y="-5211.07" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_11_experts_gpu0&#45;&gt;layer_11_expert_comm -->
<g id="edge327" class="edge">
<title>layer_11_experts_gpu0&#45;&gt;layer_11_expert_comm</title>
<path fill="none" stroke="black" d="M404.67,-5304.17C407.47,-5303.7 410.25,-5303.25 413,-5302.83 628.7,-5269.9 880.06,-5250.23 1040.05,-5240.02"/>
<polygon fill="black" stroke="black" points="1040.69,-5243.49 1050.45,-5239.36 1040.25,-5236.5 1040.69,-5243.49"/>
</g>
<!-- layer_11_experts_gpu1&#45;&gt;layer_11_expert_comm -->
<g id="edge328" class="edge">
<title>layer_11_experts_gpu1&#45;&gt;layer_11_expert_comm</title>
<path fill="none" stroke="black" d="M637.68,-5304.48C640.82,-5303.91 643.93,-5303.36 647,-5302.83 783.18,-5279.52 939.33,-5259.96 1051.24,-5247.18"/>
<polygon fill="black" stroke="black" points="1051.7,-5250.65 1061.24,-5246.04 1050.91,-5243.69 1051.7,-5250.65"/>
</g>
<!-- layer_11_experts_gpu2&#45;&gt;layer_11_expert_comm -->
<g id="edge329" class="edge">
<title>layer_11_experts_gpu2&#45;&gt;layer_11_expert_comm</title>
<path fill="none" stroke="black" d="M870.67,-5304.1C933.94,-5290.16 1014.11,-5272.48 1079.74,-5258.01"/>
<polygon fill="black" stroke="black" points="1080.72,-5261.38 1089.73,-5255.81 1079.21,-5254.55 1080.72,-5261.38"/>
</g>
<!-- layer_11_experts_gpu3&#45;&gt;layer_11_expert_comm -->
<g id="edge330" class="edge">
<title>layer_11_experts_gpu3&#45;&gt;layer_11_expert_comm</title>
<path fill="none" stroke="black" d="M1049.32,-5302.79C1072.15,-5292.07 1099.25,-5279.33 1124.25,-5267.59"/>
<polygon fill="black" stroke="black" points="1125.79,-5270.73 1133.35,-5263.31 1122.81,-5264.4 1125.79,-5270.73"/>
</g>
<!-- layer_11_experts_gpu4&#45;&gt;layer_11_expert_comm -->
<g id="edge331" class="edge">
<title>layer_11_experts_gpu4&#45;&gt;layer_11_expert_comm</title>
<path fill="none" stroke="black" d="M1221.98,-5302.66C1219.77,-5294.77 1217.27,-5285.8 1214.8,-5276.93"/>
<polygon fill="black" stroke="black" points="1218.1,-5275.73 1212.04,-5267.04 1211.35,-5277.61 1218.1,-5275.73"/>
</g>
<!-- layer_11_experts_gpu5&#45;&gt;layer_11_expert_comm -->
<g id="edge332" class="edge">
<title>layer_11_experts_gpu5&#45;&gt;layer_11_expert_comm</title>
<path fill="none" stroke="black" d="M1394.71,-5302.79C1363.89,-5291.32 1326.9,-5277.55 1293.6,-5265.16"/>
<polygon fill="black" stroke="black" points="1294.45,-5261.74 1283.86,-5261.53 1292.01,-5268.3 1294.45,-5261.74"/>
</g>
<!-- layer_11_experts_gpu6&#45;&gt;layer_11_expert_comm -->
<g id="edge333" class="edge">
<title>layer_11_experts_gpu6&#45;&gt;layer_11_expert_comm</title>
<path fill="none" stroke="black" d="M1587.27,-5304.52C1584.49,-5303.95 1581.73,-5303.39 1579,-5302.83 1497.46,-5286.29 1405.76,-5268.81 1333.22,-5255.24"/>
<polygon fill="black" stroke="black" points="1333.59,-5251.75 1323.12,-5253.35 1332.3,-5258.63 1333.59,-5251.75"/>
</g>
<!-- layer_11_experts_gpu7&#45;&gt;layer_11_expert_comm -->
<g id="edge334" class="edge">
<title>layer_11_experts_gpu7&#45;&gt;layer_11_expert_comm</title>
<path fill="none" stroke="black" d="M1820.32,-5304.26C1817.52,-5303.77 1814.74,-5303.29 1812,-5302.83 1657.89,-5277.22 1480.39,-5257.42 1356.74,-5245.17"/>
<polygon fill="black" stroke="black" points="1356.73,-5241.65 1346.44,-5244.15 1356.05,-5248.61 1356.73,-5241.65"/>
</g>
<!-- layer_11_moe_out -->
<g id="node240" class="node">
<title>layer_11_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1431.24,-5157.3 1066.57,-5157.3 972.76,-5053.3 1337.43,-5053.3 1431.24,-5157.3"/>
<text text-anchor="middle" x="1202" y="-5119.3" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="1202" y="-5108.3" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1202" y="-5097.3" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1202" y="-5086.3" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_11_expert_comm&#45;&gt;layer_11_moe_out -->
<g id="edge335" class="edge">
<title>layer_11_expert_comm&#45;&gt;layer_11_moe_out</title>
<path fill="none" stroke="black" d="M1202,-5193.23C1202,-5185.19 1202,-5176.44 1202,-5167.69"/>
<polygon fill="black" stroke="black" points="1205.5,-5167.46 1202,-5157.46 1198.5,-5167.46 1205.5,-5167.46"/>
</g>
<!-- layer_11_norm -->
<g id="node241" class="node">
<title>layer_11_norm</title>
<polygon fill="lightgreen" stroke="black" points="1312.5,-5017.3 1091.5,-5017.3 1091.5,-4965.3 1312.5,-4965.3 1312.5,-5017.3"/>
<text text-anchor="middle" x="1202" y="-5005.3" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="1202" y="-4994.3" font-family="Arial" font-size="10.00">GPUs 4&#45;5</text>
<text text-anchor="middle" x="1202" y="-4983.3" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1202" y="-4972.3" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_11_moe_out&#45;&gt;layer_11_norm -->
<g id="edge336" class="edge">
<title>layer_11_moe_out&#45;&gt;layer_11_norm</title>
<path fill="none" stroke="black" d="M1202,-5053.21C1202,-5044.55 1202,-5035.72 1202,-5027.58"/>
<polygon fill="black" stroke="black" points="1205.5,-5027.34 1202,-5017.34 1198.5,-5027.34 1205.5,-5027.34"/>
</g>
<!-- layer_12_input -->
<g id="node242" class="node">
<title>layer_12_input</title>
<polygon fill="lightyellow" stroke="black" points="1466.24,-4879.3 1045.89,-4879.3 937.76,-4797.3 1358.11,-4797.3 1466.24,-4879.3"/>
<text text-anchor="middle" x="1202" y="-4846.8" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="1202" y="-4835.8" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1202" y="-4824.8" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_11_norm&#45;&gt;layer_12_input -->
<g id="edge337" class="edge">
<title>layer_11_norm&#45;&gt;layer_12_input</title>
<path fill="none" stroke="black" d="M1202,-4965.02C1202,-4944.51 1202,-4914.94 1202,-4889.63"/>
<polygon fill="black" stroke="black" points="1205.5,-4889.45 1202,-4879.45 1198.5,-4889.45 1205.5,-4889.45"/>
</g>
<!-- layer_12_qkv_tp0 -->
<g id="node243" class="node">
<title>layer_12_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1046.5,-4761.3 771.5,-4761.3 771.5,-4709.3 1046.5,-4709.3 1046.5,-4761.3"/>
<text text-anchor="middle" x="909" y="-4749.3" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="909" y="-4738.3" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="909" y="-4727.3" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="909" y="-4716.3" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_12_input&#45;&gt;layer_12_qkv_tp0 -->
<g id="edge338" class="edge">
<title>layer_12_input&#45;&gt;layer_12_qkv_tp0</title>
<path fill="none" stroke="black" d="M1085.78,-4797.23C1054.2,-4786.35 1020.65,-4774.78 991.37,-4764.69"/>
<polygon fill="black" stroke="black" points="992.21,-4761.28 981.61,-4761.33 989.93,-4767.89 992.21,-4761.28"/>
</g>
<!-- layer_12_qkv_tp1 -->
<g id="node244" class="node">
<title>layer_12_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1339.5,-4761.3 1064.5,-4761.3 1064.5,-4709.3 1339.5,-4709.3 1339.5,-4761.3"/>
<text text-anchor="middle" x="1202" y="-4749.3" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1202" y="-4738.3" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1202" y="-4727.3" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1202" y="-4716.3" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_12_input&#45;&gt;layer_12_qkv_tp1 -->
<g id="edge339" class="edge">
<title>layer_12_input&#45;&gt;layer_12_qkv_tp1</title>
<path fill="none" stroke="black" d="M1202,-4797.09C1202,-4788.66 1202,-4779.82 1202,-4771.59"/>
<polygon fill="black" stroke="black" points="1205.5,-4771.55 1202,-4761.55 1198.5,-4771.55 1205.5,-4771.55"/>
</g>
<!-- layer_12_attn_tp0 -->
<g id="node245" class="node">
<title>layer_12_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1044,-4673.3 782,-4673.3 782,-4621.3 1044,-4621.3 1044,-4673.3"/>
<text text-anchor="middle" x="913" y="-4661.3" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="913" y="-4650.3" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="913" y="-4639.3" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="913" y="-4628.3" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_12_qkv_tp0&#45;&gt;layer_12_attn_tp0 -->
<g id="edge340" class="edge">
<title>layer_12_qkv_tp0&#45;&gt;layer_12_attn_tp0</title>
<path fill="none" stroke="black" d="M910.18,-4708.96C910.55,-4701 910.96,-4692.06 911.36,-4683.54"/>
<polygon fill="black" stroke="black" points="914.86,-4683.6 911.83,-4673.45 907.87,-4683.28 914.86,-4683.6"/>
</g>
<!-- layer_12_attn_tp1 -->
<g id="node246" class="node">
<title>layer_12_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1330,-4673.3 1068,-4673.3 1068,-4621.3 1330,-4621.3 1330,-4673.3"/>
<text text-anchor="middle" x="1199" y="-4661.3" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1199" y="-4650.3" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1199" y="-4639.3" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1199" y="-4628.3" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_12_qkv_tp1&#45;&gt;layer_12_attn_tp1 -->
<g id="edge341" class="edge">
<title>layer_12_qkv_tp1&#45;&gt;layer_12_attn_tp1</title>
<path fill="none" stroke="black" d="M1201.12,-4708.96C1200.84,-4701 1200.53,-4692.06 1200.23,-4683.54"/>
<polygon fill="black" stroke="black" points="1203.72,-4683.32 1199.88,-4673.45 1196.73,-4683.57 1203.72,-4683.32"/>
</g>
<!-- layer_12_attn_comm -->
<g id="node247" class="node">
<title>layer_12_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1141" cy="-4548.53" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1141" y="-4562.53" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="1141" y="-4551.53" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1141" y="-4540.53" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1141" y="-4529.53" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_12_attn_tp0&#45;&gt;layer_12_attn_comm -->
<g id="edge342" class="edge">
<title>layer_12_attn_tp0&#45;&gt;layer_12_attn_comm</title>
<path fill="none" stroke="black" d="M972.01,-4621.25C997.97,-4610.23 1028.94,-4597.09 1057.23,-4585.08"/>
<polygon fill="black" stroke="black" points="1058.87,-4588.19 1066.7,-4581.06 1056.13,-4581.74 1058.87,-4588.19"/>
</g>
<!-- layer_12_attn_tp1&#45;&gt;layer_12_attn_comm -->
<g id="edge343" class="edge">
<title>layer_12_attn_tp1&#45;&gt;layer_12_attn_comm</title>
<path fill="none" stroke="black" d="M1183.91,-4621.12C1178.93,-4612.81 1173.22,-4603.29 1167.64,-4593.97"/>
<polygon fill="black" stroke="black" points="1170.49,-4591.91 1162.34,-4585.14 1164.48,-4595.51 1170.49,-4591.91"/>
</g>
<!-- layer_12_attn_out -->
<g id="node248" class="node">
<title>layer_12_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1251.5,-4475.76 1030.5,-4475.76 1030.5,-4423.76 1251.5,-4423.76 1251.5,-4475.76"/>
<text text-anchor="middle" x="1141" y="-4463.76" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="1141" y="-4452.76" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1141" y="-4441.76" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1141" y="-4430.76" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_12_attn_comm&#45;&gt;layer_12_attn_out -->
<g id="edge344" class="edge">
<title>layer_12_attn_comm&#45;&gt;layer_12_attn_out</title>
<path fill="none" stroke="black" d="M1141,-4511.49C1141,-4503.18 1141,-4494.35 1141,-4486.07"/>
<polygon fill="black" stroke="black" points="1144.5,-4485.95 1141,-4475.95 1137.5,-4485.95 1144.5,-4485.95"/>
</g>
<!-- layer_12_gate -->
<g id="node249" class="node">
<title>layer_12_gate</title>
<polygon fill="lightyellow" stroke="black" points="1395.01,-4387.76 990.94,-4387.76 886.99,-4283.76 1291.06,-4283.76 1395.01,-4387.76"/>
<text text-anchor="middle" x="1141" y="-4349.76" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="1141" y="-4338.76" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1141" y="-4327.76" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1141" y="-4316.76" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_12_attn_out&#45;&gt;layer_12_gate -->
<g id="edge345" class="edge">
<title>layer_12_attn_out&#45;&gt;layer_12_gate</title>
<path fill="none" stroke="black" d="M1141,-4423.62C1141,-4415.94 1141,-4407.12 1141,-4398.12"/>
<polygon fill="black" stroke="black" points="1144.5,-4397.93 1141,-4387.93 1137.5,-4397.93 1144.5,-4397.93"/>
</g>
<!-- layer_12_expert_select -->
<g id="node250" class="node">
<title>layer_12_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1407.39,-4247.76 983.62,-4247.76 874.61,-4143.76 1298.38,-4143.76 1407.39,-4247.76"/>
<text text-anchor="middle" x="1141" y="-4209.76" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="1141" y="-4198.76" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1141" y="-4187.76" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="1141" y="-4176.76" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_12_gate&#45;&gt;layer_12_expert_select -->
<g id="edge346" class="edge">
<title>layer_12_gate&#45;&gt;layer_12_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1141,-4283.37C1141,-4275.2 1141,-4266.67 1141,-4258.3"/>
<polygon fill="black" stroke="black" points="1144.5,-4258.19 1141,-4248.19 1137.5,-4258.19 1144.5,-4258.19"/>
</g>
<!-- layer_12_experts_gpu0 -->
<g id="node251" class="node">
<title>layer_12_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="520.5,-4107.76 305.5,-4107.76 305.5,-4055.76 520.5,-4055.76 520.5,-4107.76"/>
<text text-anchor="middle" x="413" y="-4095.76" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="413" y="-4084.76" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="413" y="-4073.76" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="413" y="-4062.76" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_12_expert_select&#45;&gt;layer_12_experts_gpu0 -->
<g id="edge347" class="edge">
<title>layer_12_expert_select&#45;&gt;layer_12_experts_gpu0</title>
<path fill="none" stroke="black" d="M895.43,-4163.9C786.34,-4149.18 656.23,-4130.25 530.87,-4108.05"/>
<polygon fill="black" stroke="black" points="531.15,-4104.55 520.7,-4106.24 529.93,-4111.44 531.15,-4104.55"/>
</g>
<!-- layer_12_experts_gpu1 -->
<g id="node252" class="node">
<title>layer_12_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="753.5,-4107.76 538.5,-4107.76 538.5,-4055.76 753.5,-4055.76 753.5,-4107.76"/>
<text text-anchor="middle" x="646" y="-4095.76" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="646" y="-4084.76" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="646" y="-4073.76" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="646" y="-4062.76" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_12_expert_select&#45;&gt;layer_12_experts_gpu1 -->
<g id="edge348" class="edge">
<title>layer_12_expert_select&#45;&gt;layer_12_experts_gpu1</title>
<path fill="none" stroke="black" d="M915.59,-4143.75C863.05,-4131.87 809.17,-4119.68 763.52,-4109.35"/>
<polygon fill="black" stroke="black" points="764.14,-4105.9 753.61,-4107.11 762.59,-4112.73 764.14,-4105.9"/>
</g>
<!-- layer_12_experts_gpu2 -->
<g id="node253" class="node">
<title>layer_12_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="986.5,-4107.76 771.5,-4107.76 771.5,-4055.76 986.5,-4055.76 986.5,-4107.76"/>
<text text-anchor="middle" x="879" y="-4095.76" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="879" y="-4084.76" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="879" y="-4073.76" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="879" y="-4062.76" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_12_expert_select&#45;&gt;layer_12_experts_gpu2 -->
<g id="edge349" class="edge">
<title>layer_12_expert_select&#45;&gt;layer_12_experts_gpu2</title>
<path fill="none" stroke="black" d="M1021.5,-4143.67C995.88,-4132.72 969.67,-4121.51 946.82,-4111.75"/>
<polygon fill="black" stroke="black" points="948.15,-4108.51 937.58,-4107.8 945.4,-4114.95 948.15,-4108.51"/>
</g>
<!-- layer_12_experts_gpu3 -->
<g id="node254" class="node">
<title>layer_12_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1219.5,-4107.76 1004.5,-4107.76 1004.5,-4055.76 1219.5,-4055.76 1219.5,-4107.76"/>
<text text-anchor="middle" x="1112" y="-4095.76" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="1112" y="-4084.76" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1112" y="-4073.76" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1112" y="-4062.76" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_12_expert_select&#45;&gt;layer_12_experts_gpu3 -->
<g id="edge350" class="edge">
<title>layer_12_expert_select&#45;&gt;layer_12_experts_gpu3</title>
<path fill="none" stroke="black" d="M1127.77,-4143.67C1125.48,-4134.81 1123.14,-4125.79 1120.99,-4117.49"/>
<polygon fill="black" stroke="black" points="1124.38,-4116.6 1118.48,-4107.8 1117.6,-4118.36 1124.38,-4116.6"/>
</g>
<!-- layer_12_experts_gpu4 -->
<g id="node255" class="node">
<title>layer_12_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1452.5,-4107.76 1237.5,-4107.76 1237.5,-4055.76 1452.5,-4055.76 1452.5,-4107.76"/>
<text text-anchor="middle" x="1345" y="-4095.76" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1345" y="-4084.76" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1345" y="-4073.76" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1345" y="-4062.76" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_12_expert_select&#45;&gt;layer_12_experts_gpu4 -->
<g id="edge351" class="edge">
<title>layer_12_expert_select&#45;&gt;layer_12_experts_gpu4</title>
<path fill="none" stroke="black" d="M1234.05,-4143.67C1253.37,-4133.06 1273.14,-4122.21 1290.52,-4112.67"/>
<polygon fill="black" stroke="black" points="1292.3,-4115.68 1299.39,-4107.8 1288.93,-4109.54 1292.3,-4115.68"/>
</g>
<!-- layer_12_experts_gpu5 -->
<g id="node256" class="node">
<title>layer_12_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1685.5,-4107.76 1470.5,-4107.76 1470.5,-4055.76 1685.5,-4055.76 1685.5,-4107.76"/>
<text text-anchor="middle" x="1578" y="-4095.76" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1578" y="-4084.76" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1578" y="-4073.76" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1578" y="-4062.76" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_12_expert_select&#45;&gt;layer_12_experts_gpu5 -->
<g id="edge352" class="edge">
<title>layer_12_expert_select&#45;&gt;layer_12_experts_gpu5</title>
<path fill="none" stroke="black" d="M1307.46,-4152.09C1362.07,-4138.1 1421.28,-4122.92 1470.35,-4110.35"/>
<polygon fill="black" stroke="black" points="1471.52,-4113.66 1480.34,-4107.79 1469.79,-4106.88 1471.52,-4113.66"/>
</g>
<!-- layer_12_experts_gpu6 -->
<g id="node257" class="node">
<title>layer_12_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1918.5,-4107.76 1703.5,-4107.76 1703.5,-4055.76 1918.5,-4055.76 1918.5,-4107.76"/>
<text text-anchor="middle" x="1811" y="-4095.76" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1811" y="-4084.76" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1811" y="-4073.76" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1811" y="-4062.76" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_12_expert_select&#45;&gt;layer_12_experts_gpu6 -->
<g id="edge353" class="edge">
<title>layer_12_expert_select&#45;&gt;layer_12_experts_gpu6</title>
<path fill="none" stroke="black" d="M1324.54,-4168.59C1429.89,-4152.93 1564.83,-4131.78 1693.27,-4108.05"/>
<polygon fill="black" stroke="black" points="1694.1,-4111.45 1703.29,-4106.19 1692.82,-4104.57 1694.1,-4111.45"/>
</g>
<!-- layer_12_experts_gpu7 -->
<g id="node258" class="node">
<title>layer_12_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2151.5,-4107.76 1936.5,-4107.76 1936.5,-4055.76 2151.5,-4055.76 2151.5,-4107.76"/>
<text text-anchor="middle" x="2044" y="-4095.76" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="2044" y="-4084.76" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="2044" y="-4073.76" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="2044" y="-4062.76" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_12_expert_select&#45;&gt;layer_12_experts_gpu7 -->
<g id="edge354" class="edge">
<title>layer_12_expert_select&#45;&gt;layer_12_experts_gpu7</title>
<path fill="none" stroke="black" d="M1335.4,-4178.84C1492.56,-4164.66 1719.57,-4141.21 1926.19,-4107.99"/>
<polygon fill="black" stroke="black" points="1927.01,-4111.41 1936.32,-4106.35 1925.89,-4104.5 1927.01,-4111.41"/>
</g>
<!-- layer_12_expert_comm -->
<g id="node259" class="node">
<title>layer_12_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1273" cy="-3982.99" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1273" y="-3996.99" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1273" y="-3985.99" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="1273" y="-3974.99" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1273" y="-3963.99" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_12_experts_gpu0&#45;&gt;layer_12_expert_comm -->
<g id="edge355" class="edge">
<title>layer_12_experts_gpu0&#45;&gt;layer_12_expert_comm</title>
<path fill="none" stroke="black" d="M520.67,-4057.11C523.47,-4056.64 526.25,-4056.18 529,-4055.76 728.93,-4024.68 961.31,-4004.83 1112.44,-3994.07"/>
<polygon fill="black" stroke="black" points="1113,-3997.54 1122.73,-3993.34 1112.51,-3990.55 1113,-3997.54"/>
</g>
<!-- layer_12_experts_gpu1&#45;&gt;layer_12_expert_comm -->
<g id="edge356" class="edge">
<title>layer_12_experts_gpu1&#45;&gt;layer_12_expert_comm</title>
<path fill="none" stroke="black" d="M753.69,-4057.45C756.82,-4056.86 759.93,-4056.3 763,-4055.76 884.64,-4034.23 1023.51,-4015.04 1125.6,-4001.93"/>
<polygon fill="black" stroke="black" points="1126.2,-4005.38 1135.67,-4000.64 1125.31,-3998.44 1126.2,-4005.38"/>
</g>
<!-- layer_12_experts_gpu2&#45;&gt;layer_12_expert_comm -->
<g id="edge357" class="edge">
<title>layer_12_experts_gpu2&#45;&gt;layer_12_expert_comm</title>
<path fill="none" stroke="black" d="M980.98,-4055.71C1034.86,-4042.48 1101.21,-4026.18 1157.04,-4012.47"/>
<polygon fill="black" stroke="black" points="1158.1,-4015.81 1166.98,-4010.03 1156.44,-4009.01 1158.1,-4015.81"/>
</g>
<!-- layer_12_experts_gpu3&#45;&gt;layer_12_expert_comm -->
<g id="edge358" class="edge">
<title>layer_12_experts_gpu3&#45;&gt;layer_12_expert_comm</title>
<path fill="none" stroke="black" d="M1153.88,-4055.58C1170.61,-4045.53 1190.26,-4033.72 1208.72,-4022.62"/>
<polygon fill="black" stroke="black" points="1210.61,-4025.57 1217.38,-4017.42 1207.01,-4019.57 1210.61,-4025.57"/>
</g>
<!-- layer_12_experts_gpu4&#45;&gt;layer_12_expert_comm -->
<g id="edge359" class="edge">
<title>layer_12_experts_gpu4&#45;&gt;layer_12_expert_comm</title>
<path fill="none" stroke="black" d="M1326.27,-4055.58C1319.95,-4047.09 1312.71,-4037.36 1305.64,-4027.85"/>
<polygon fill="black" stroke="black" points="1308.27,-4025.53 1299.5,-4019.6 1302.66,-4029.71 1308.27,-4025.53"/>
</g>
<!-- layer_12_experts_gpu5&#45;&gt;layer_12_expert_comm -->
<g id="edge360" class="edge">
<title>layer_12_experts_gpu5&#45;&gt;layer_12_expert_comm</title>
<path fill="none" stroke="black" d="M1499.06,-4055.71C1460.9,-4043.6 1414.67,-4028.94 1373.98,-4016.03"/>
<polygon fill="black" stroke="black" points="1374.9,-4012.65 1364.31,-4012.96 1372.78,-4019.32 1374.9,-4012.65"/>
</g>
<!-- layer_12_experts_gpu6&#45;&gt;layer_12_expert_comm -->
<g id="edge361" class="edge">
<title>layer_12_experts_gpu6&#45;&gt;layer_12_expert_comm</title>
<path fill="none" stroke="black" d="M1703.29,-4057.37C1700.5,-4056.82 1697.73,-4056.28 1695,-4055.76 1600.33,-4037.51 1493.25,-4019.33 1410.63,-4005.83"/>
<polygon fill="black" stroke="black" points="1411.12,-4002.36 1400.68,-4004.21 1409.99,-4009.27 1411.12,-4002.36"/>
</g>
<!-- layer_12_experts_gpu7&#45;&gt;layer_12_expert_comm -->
<g id="edge362" class="edge">
<title>layer_12_experts_gpu7&#45;&gt;layer_12_expert_comm</title>
<path fill="none" stroke="black" d="M1936.32,-4057.16C1933.52,-4056.67 1930.75,-4056.2 1928,-4055.76 1758.79,-4028.33 1563.25,-4008.42 1430.19,-3996.63"/>
<polygon fill="black" stroke="black" points="1430.18,-3993.11 1419.92,-3995.72 1429.57,-4000.08 1430.18,-3993.11"/>
</g>
<!-- layer_12_moe_out -->
<g id="node260" class="node">
<title>layer_12_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1502.24,-3910.22 1137.57,-3910.22 1043.76,-3806.22 1408.43,-3806.22 1502.24,-3910.22"/>
<text text-anchor="middle" x="1273" y="-3872.22" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="1273" y="-3861.22" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1273" y="-3850.22" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1273" y="-3839.22" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_12_expert_comm&#45;&gt;layer_12_moe_out -->
<g id="edge363" class="edge">
<title>layer_12_expert_comm&#45;&gt;layer_12_moe_out</title>
<path fill="none" stroke="black" d="M1273,-3946.15C1273,-3938.11 1273,-3929.36 1273,-3920.61"/>
<polygon fill="black" stroke="black" points="1276.5,-3920.38 1273,-3910.38 1269.5,-3920.38 1276.5,-3920.38"/>
</g>
<!-- layer_12_norm -->
<g id="node261" class="node">
<title>layer_12_norm</title>
<polygon fill="lightgreen" stroke="black" points="1383.5,-3770.22 1162.5,-3770.22 1162.5,-3718.22 1383.5,-3718.22 1383.5,-3770.22"/>
<text text-anchor="middle" x="1273" y="-3758.22" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="1273" y="-3747.22" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1273" y="-3736.22" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1273" y="-3725.22" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_12_moe_out&#45;&gt;layer_12_norm -->
<g id="edge364" class="edge">
<title>layer_12_moe_out&#45;&gt;layer_12_norm</title>
<path fill="none" stroke="black" d="M1273,-3806.13C1273,-3797.47 1273,-3788.65 1273,-3780.5"/>
<polygon fill="black" stroke="black" points="1276.5,-3780.26 1273,-3770.26 1269.5,-3780.26 1276.5,-3780.26"/>
</g>
<!-- layer_13_input -->
<g id="node262" class="node">
<title>layer_13_input</title>
<polygon fill="lightyellow" stroke="black" points="1537.24,-3671.22 1116.89,-3671.22 1008.76,-3589.22 1429.11,-3589.22 1537.24,-3671.22"/>
<text text-anchor="middle" x="1273" y="-3638.72" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="1273" y="-3627.72" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1273" y="-3616.72" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_12_norm&#45;&gt;layer_13_input -->
<g id="edge365" class="edge">
<title>layer_12_norm&#45;&gt;layer_13_input</title>
<path fill="none" stroke="black" d="M1273,-3718.08C1273,-3707.4 1273,-3694.54 1273,-3682.03"/>
<polygon fill="black" stroke="black" points="1276.5,-3681.65 1273,-3671.65 1269.5,-3681.65 1276.5,-3681.65"/>
</g>
<!-- layer_13_qkv_tp0 -->
<g id="node263" class="node">
<title>layer_13_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1338.5,-3553.22 1063.5,-3553.22 1063.5,-3501.22 1338.5,-3501.22 1338.5,-3553.22"/>
<text text-anchor="middle" x="1201" y="-3541.22" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="1201" y="-3530.22" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1201" y="-3519.22" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1201" y="-3508.22" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_13_input&#45;&gt;layer_13_qkv_tp0 -->
<g id="edge366" class="edge">
<title>layer_13_input&#45;&gt;layer_13_qkv_tp0</title>
<path fill="none" stroke="black" d="M1244.34,-3589.01C1237.93,-3580.02 1231.19,-3570.57 1224.99,-3561.87"/>
<polygon fill="black" stroke="black" points="1227.66,-3559.58 1219,-3553.47 1221.96,-3563.64 1227.66,-3559.58"/>
</g>
<!-- layer_13_qkv_tp1 -->
<g id="node264" class="node">
<title>layer_13_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1631.5,-3553.22 1356.5,-3553.22 1356.5,-3501.22 1631.5,-3501.22 1631.5,-3553.22"/>
<text text-anchor="middle" x="1494" y="-3541.22" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1494" y="-3530.22" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1494" y="-3519.22" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1494" y="-3508.22" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_13_input&#45;&gt;layer_13_qkv_tp1 -->
<g id="edge367" class="edge">
<title>layer_13_input&#45;&gt;layer_13_qkv_tp1</title>
<path fill="none" stroke="black" d="M1360.66,-3589.15C1383.86,-3578.55 1408.46,-3567.31 1430.14,-3557.4"/>
<polygon fill="black" stroke="black" points="1431.59,-3560.59 1439.23,-3553.25 1428.68,-3554.22 1431.59,-3560.59"/>
</g>
<!-- layer_13_attn_tp0 -->
<g id="node265" class="node">
<title>layer_13_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1336,-3465.22 1074,-3465.22 1074,-3413.22 1336,-3413.22 1336,-3465.22"/>
<text text-anchor="middle" x="1205" y="-3453.22" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="1205" y="-3442.22" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1205" y="-3431.22" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1205" y="-3420.22" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_13_qkv_tp0&#45;&gt;layer_13_attn_tp0 -->
<g id="edge368" class="edge">
<title>layer_13_qkv_tp0&#45;&gt;layer_13_attn_tp0</title>
<path fill="none" stroke="black" d="M1202.18,-3500.88C1202.55,-3492.92 1202.96,-3483.98 1203.36,-3475.46"/>
<polygon fill="black" stroke="black" points="1206.86,-3475.53 1203.83,-3465.37 1199.87,-3475.2 1206.86,-3475.53"/>
</g>
<!-- layer_13_attn_tp1 -->
<g id="node266" class="node">
<title>layer_13_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1622,-3465.22 1360,-3465.22 1360,-3413.22 1622,-3413.22 1622,-3465.22"/>
<text text-anchor="middle" x="1491" y="-3453.22" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1491" y="-3442.22" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1491" y="-3431.22" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1491" y="-3420.22" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_13_qkv_tp1&#45;&gt;layer_13_attn_tp1 -->
<g id="edge369" class="edge">
<title>layer_13_qkv_tp1&#45;&gt;layer_13_attn_tp1</title>
<path fill="none" stroke="black" d="M1493.12,-3500.88C1492.84,-3492.92 1492.53,-3483.98 1492.23,-3475.46"/>
<polygon fill="black" stroke="black" points="1495.72,-3475.25 1491.88,-3465.37 1488.73,-3475.49 1495.72,-3475.25"/>
</g>
<!-- layer_13_attn_comm -->
<g id="node267" class="node">
<title>layer_13_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1228" cy="-3340.45" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1228" y="-3354.45" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="1228" y="-3343.45" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1228" y="-3332.45" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1228" y="-3321.45" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_13_attn_tp0&#45;&gt;layer_13_attn_comm -->
<g id="edge370" class="edge">
<title>layer_13_attn_tp0&#45;&gt;layer_13_attn_comm</title>
<path fill="none" stroke="black" d="M1210.98,-3413.04C1212.86,-3405.15 1214.99,-3396.18 1217.1,-3387.32"/>
<polygon fill="black" stroke="black" points="1220.54,-3387.96 1219.45,-3377.42 1213.73,-3386.34 1220.54,-3387.96"/>
</g>
<!-- layer_13_attn_tp1&#45;&gt;layer_13_attn_comm -->
<g id="edge371" class="edge">
<title>layer_13_attn_tp1&#45;&gt;layer_13_attn_comm</title>
<path fill="none" stroke="black" d="M1422.93,-3413.17C1391.49,-3401.6 1353.69,-3387.69 1319.77,-3375.22"/>
<polygon fill="black" stroke="black" points="1320.91,-3371.91 1310.32,-3371.74 1318.5,-3378.48 1320.91,-3371.91"/>
</g>
<!-- layer_13_attn_out -->
<g id="node268" class="node">
<title>layer_13_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1338.5,-3267.68 1117.5,-3267.68 1117.5,-3215.68 1338.5,-3215.68 1338.5,-3267.68"/>
<text text-anchor="middle" x="1228" y="-3255.68" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="1228" y="-3244.68" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1228" y="-3233.68" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1228" y="-3222.68" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_13_attn_comm&#45;&gt;layer_13_attn_out -->
<g id="edge372" class="edge">
<title>layer_13_attn_comm&#45;&gt;layer_13_attn_out</title>
<path fill="none" stroke="black" d="M1228,-3303.41C1228,-3295.1 1228,-3286.27 1228,-3277.99"/>
<polygon fill="black" stroke="black" points="1231.5,-3277.87 1228,-3267.87 1224.5,-3277.87 1231.5,-3277.87"/>
</g>
<!-- layer_13_gate -->
<g id="node269" class="node">
<title>layer_13_gate</title>
<polygon fill="lightyellow" stroke="black" points="1482.01,-3179.68 1077.94,-3179.68 973.99,-3075.68 1378.06,-3075.68 1482.01,-3179.68"/>
<text text-anchor="middle" x="1228" y="-3141.68" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="1228" y="-3130.68" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1228" y="-3119.68" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1228" y="-3108.68" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_13_attn_out&#45;&gt;layer_13_gate -->
<g id="edge373" class="edge">
<title>layer_13_attn_out&#45;&gt;layer_13_gate</title>
<path fill="none" stroke="black" d="M1228,-3215.54C1228,-3207.86 1228,-3199.05 1228,-3190.05"/>
<polygon fill="black" stroke="black" points="1231.5,-3189.86 1228,-3179.86 1224.5,-3189.86 1231.5,-3189.86"/>
</g>
<!-- layer_13_expert_select -->
<g id="node270" class="node">
<title>layer_13_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1494.39,-3039.68 1070.62,-3039.68 961.61,-2935.68 1385.38,-2935.68 1494.39,-3039.68"/>
<text text-anchor="middle" x="1228" y="-3001.68" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="1228" y="-2990.68" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1228" y="-2979.68" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="1228" y="-2968.68" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_13_gate&#45;&gt;layer_13_expert_select -->
<g id="edge374" class="edge">
<title>layer_13_gate&#45;&gt;layer_13_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1228,-3075.29C1228,-3067.12 1228,-3058.59 1228,-3050.22"/>
<polygon fill="black" stroke="black" points="1231.5,-3050.11 1228,-3040.11 1224.5,-3050.11 1231.5,-3050.11"/>
</g>
<!-- layer_13_experts_gpu0 -->
<g id="node271" class="node">
<title>layer_13_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="520.5,-2899.68 305.5,-2899.68 305.5,-2847.68 520.5,-2847.68 520.5,-2899.68"/>
<text text-anchor="middle" x="413" y="-2887.68" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="413" y="-2876.68" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="413" y="-2865.68" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="413" y="-2854.68" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_13_expert_select&#45;&gt;layer_13_experts_gpu0 -->
<g id="edge375" class="edge">
<title>layer_13_expert_select&#45;&gt;layer_13_experts_gpu0</title>
<path fill="none" stroke="black" d="M989.44,-2962.28C856.76,-2947.41 688.58,-2926.43 530.59,-2899.9"/>
<polygon fill="black" stroke="black" points="531.13,-2896.44 520.68,-2898.22 529.96,-2903.34 531.13,-2896.44"/>
</g>
<!-- layer_13_experts_gpu1 -->
<g id="node272" class="node">
<title>layer_13_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="753.5,-2899.68 538.5,-2899.68 538.5,-2847.68 753.5,-2847.68 753.5,-2899.68"/>
<text text-anchor="middle" x="646" y="-2887.68" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="646" y="-2876.68" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="646" y="-2865.68" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="646" y="-2854.68" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_13_expert_select&#45;&gt;layer_13_experts_gpu1 -->
<g id="edge376" class="edge">
<title>layer_13_expert_select&#45;&gt;layer_13_experts_gpu1</title>
<path fill="none" stroke="black" d="M964.64,-2938.62C901.69,-2926.81 834.55,-2913.96 763.74,-2899.81"/>
<polygon fill="black" stroke="black" points="764.21,-2896.33 753.72,-2897.8 762.84,-2903.2 764.21,-2896.33"/>
</g>
<!-- layer_13_experts_gpu2 -->
<g id="node273" class="node">
<title>layer_13_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="986.5,-2899.68 771.5,-2899.68 771.5,-2847.68 986.5,-2847.68 986.5,-2899.68"/>
<text text-anchor="middle" x="879" y="-2887.68" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="879" y="-2876.68" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="879" y="-2865.68" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="879" y="-2854.68" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_13_expert_select&#45;&gt;layer_13_experts_gpu2 -->
<g id="edge377" class="edge">
<title>layer_13_expert_select&#45;&gt;layer_13_experts_gpu2</title>
<path fill="none" stroke="black" d="M1069.07,-2935.68C1034.01,-2924.42 998.09,-2912.9 967.06,-2902.94"/>
<polygon fill="black" stroke="black" points="967.75,-2899.49 957.16,-2899.76 965.62,-2906.15 967.75,-2899.49"/>
</g>
<!-- layer_13_experts_gpu3 -->
<g id="node274" class="node">
<title>layer_13_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1219.5,-2899.68 1004.5,-2899.68 1004.5,-2847.68 1219.5,-2847.68 1219.5,-2899.68"/>
<text text-anchor="middle" x="1112" y="-2887.68" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="1112" y="-2876.68" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1112" y="-2865.68" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1112" y="-2854.68" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_13_expert_select&#45;&gt;layer_13_experts_gpu3 -->
<g id="edge378" class="edge">
<title>layer_13_expert_select&#45;&gt;layer_13_experts_gpu3</title>
<path fill="none" stroke="black" d="M1175.09,-2935.59C1164.91,-2925.76 1154.51,-2915.72 1145.18,-2906.71"/>
<polygon fill="black" stroke="black" points="1147.56,-2904.15 1137.94,-2899.72 1142.7,-2909.19 1147.56,-2904.15"/>
</g>
<!-- layer_13_experts_gpu4 -->
<g id="node275" class="node">
<title>layer_13_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1452.5,-2899.68 1237.5,-2899.68 1237.5,-2847.68 1452.5,-2847.68 1452.5,-2899.68"/>
<text text-anchor="middle" x="1345" y="-2887.68" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1345" y="-2876.68" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1345" y="-2865.68" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1345" y="-2854.68" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_13_expert_select&#45;&gt;layer_13_experts_gpu4 -->
<g id="edge379" class="edge">
<title>layer_13_expert_select&#45;&gt;layer_13_experts_gpu4</title>
<path fill="none" stroke="black" d="M1281.36,-2935.59C1291.64,-2925.76 1302.12,-2915.72 1311.54,-2906.71"/>
<polygon fill="black" stroke="black" points="1314.04,-2909.17 1318.84,-2899.72 1309.19,-2904.11 1314.04,-2909.17"/>
</g>
<!-- layer_13_experts_gpu5 -->
<g id="node276" class="node">
<title>layer_13_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1685.5,-2899.68 1470.5,-2899.68 1470.5,-2847.68 1685.5,-2847.68 1685.5,-2899.68"/>
<text text-anchor="middle" x="1578" y="-2887.68" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1578" y="-2876.68" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1578" y="-2865.68" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1578" y="-2854.68" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_13_expert_select&#45;&gt;layer_13_experts_gpu5 -->
<g id="edge380" class="edge">
<title>layer_13_expert_select&#45;&gt;layer_13_experts_gpu5</title>
<path fill="none" stroke="black" d="M1386.1,-2936.08C1421.73,-2924.68 1458.3,-2912.98 1489.83,-2902.89"/>
<polygon fill="black" stroke="black" points="1490.99,-2906.2 1499.45,-2899.82 1488.86,-2899.53 1490.99,-2906.2"/>
</g>
<!-- layer_13_experts_gpu6 -->
<g id="node277" class="node">
<title>layer_13_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1918.5,-2899.68 1703.5,-2899.68 1703.5,-2847.68 1918.5,-2847.68 1918.5,-2899.68"/>
<text text-anchor="middle" x="1811" y="-2887.68" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1811" y="-2876.68" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1811" y="-2865.68" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1811" y="-2854.68" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_13_expert_select&#45;&gt;layer_13_experts_gpu6 -->
<g id="edge381" class="edge">
<title>layer_13_expert_select&#45;&gt;layer_13_experts_gpu6</title>
<path fill="none" stroke="black" d="M1405.63,-2954.8C1490.1,-2939.34 1592.73,-2920.13 1693.24,-2900.01"/>
<polygon fill="black" stroke="black" points="1694.16,-2903.4 1703.27,-2898 1692.78,-2896.54 1694.16,-2903.4"/>
</g>
<!-- layer_13_experts_gpu7 -->
<g id="node278" class="node">
<title>layer_13_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2151.5,-2899.68 1936.5,-2899.68 1936.5,-2847.68 2151.5,-2847.68 2151.5,-2899.68"/>
<text text-anchor="middle" x="2044" y="-2887.68" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="2044" y="-2876.68" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="2044" y="-2865.68" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="2044" y="-2854.68" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_13_expert_select&#45;&gt;layer_13_experts_gpu7 -->
<g id="edge382" class="edge">
<title>layer_13_expert_select&#45;&gt;layer_13_experts_gpu7</title>
<path fill="none" stroke="black" d="M1419.18,-2967.54C1557.66,-2952.58 1749.43,-2929.6 1926.3,-2899.92"/>
<polygon fill="black" stroke="black" points="1927.04,-2903.34 1936.32,-2898.23 1925.87,-2896.44 1927.04,-2903.34"/>
</g>
<!-- layer_13_expert_comm -->
<g id="node279" class="node">
<title>layer_13_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1201" cy="-2774.91" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1201" y="-2788.91" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1201" y="-2777.91" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="1201" y="-2766.91" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1201" y="-2755.91" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_13_experts_gpu0&#45;&gt;layer_13_expert_comm -->
<g id="edge383" class="edge">
<title>layer_13_experts_gpu0&#45;&gt;layer_13_expert_comm</title>
<path fill="none" stroke="black" d="M520.67,-2849.07C523.48,-2848.58 526.25,-2848.12 529,-2847.68 704.17,-2819.53 906.87,-2799.59 1043.45,-2787.99"/>
<polygon fill="black" stroke="black" points="1043.91,-2791.46 1053.58,-2787.13 1043.32,-2784.49 1043.91,-2791.46"/>
</g>
<!-- layer_13_experts_gpu1&#45;&gt;layer_13_expert_comm -->
<g id="edge384" class="edge">
<title>layer_13_experts_gpu1&#45;&gt;layer_13_expert_comm</title>
<path fill="none" stroke="black" d="M753.7,-2849.46C756.83,-2848.85 759.94,-2848.26 763,-2847.68 862.42,-2828.92 975.08,-2810.53 1061.24,-2797.05"/>
<polygon fill="black" stroke="black" points="1062.01,-2800.48 1071.35,-2795.48 1060.93,-2793.56 1062.01,-2800.48"/>
</g>
<!-- layer_13_experts_gpu2&#45;&gt;layer_13_expert_comm -->
<g id="edge385" class="edge">
<title>layer_13_experts_gpu2&#45;&gt;layer_13_expert_comm</title>
<path fill="none" stroke="black" d="M962.34,-2847.63C1003.4,-2835.29 1053.32,-2820.29 1096.87,-2807.2"/>
<polygon fill="black" stroke="black" points="1098.06,-2810.5 1106.63,-2804.27 1096.05,-2803.8 1098.06,-2810.5"/>
</g>
<!-- layer_13_experts_gpu3&#45;&gt;layer_13_expert_comm -->
<g id="edge386" class="edge">
<title>layer_13_experts_gpu3&#45;&gt;layer_13_expert_comm</title>
<path fill="none" stroke="black" d="M1135.15,-2847.51C1143.28,-2838.67 1152.65,-2828.48 1161.73,-2818.61"/>
<polygon fill="black" stroke="black" points="1164.39,-2820.88 1168.58,-2811.15 1159.24,-2816.14 1164.39,-2820.88"/>
</g>
<!-- layer_13_experts_gpu4&#45;&gt;layer_13_expert_comm -->
<g id="edge387" class="edge">
<title>layer_13_experts_gpu4&#45;&gt;layer_13_expert_comm</title>
<path fill="none" stroke="black" d="M1307.54,-2847.51C1292.99,-2837.73 1275.98,-2826.3 1259.88,-2815.47"/>
<polygon fill="black" stroke="black" points="1261.81,-2812.55 1251.55,-2809.88 1257.9,-2818.36 1261.81,-2812.55"/>
</g>
<!-- layer_13_experts_gpu5&#45;&gt;layer_13_expert_comm -->
<g id="edge388" class="edge">
<title>layer_13_experts_gpu5&#45;&gt;layer_13_expert_comm</title>
<path fill="none" stroke="black" d="M1480.42,-2847.63C1429.69,-2834.61 1367.41,-2818.62 1314.53,-2805.05"/>
<polygon fill="black" stroke="black" points="1315.32,-2801.64 1304.77,-2802.54 1313.58,-2808.42 1315.32,-2801.64"/>
</g>
<!-- layer_13_experts_gpu6&#45;&gt;layer_13_expert_comm -->
<g id="edge389" class="edge">
<title>layer_13_experts_gpu6&#45;&gt;layer_13_expert_comm</title>
<path fill="none" stroke="black" d="M1703.3,-2849.21C1700.51,-2848.68 1697.74,-2848.17 1695,-2847.68 1578.42,-2826.67 1445.51,-2807.64 1346.94,-2794.46"/>
<polygon fill="black" stroke="black" points="1347.28,-2790.97 1336.9,-2793.12 1346.35,-2797.91 1347.28,-2790.97"/>
</g>
<!-- layer_13_experts_gpu7&#45;&gt;layer_13_expert_comm -->
<g id="edge390" class="edge">
<title>layer_13_experts_gpu7&#45;&gt;layer_13_expert_comm</title>
<path fill="none" stroke="black" d="M1936.33,-2849.04C1933.53,-2848.56 1930.75,-2848.11 1928,-2847.68 1733.86,-2817.28 1508.41,-2797.38 1360.67,-2786.42"/>
<polygon fill="black" stroke="black" points="1360.84,-2782.92 1350.61,-2785.68 1360.33,-2789.9 1360.84,-2782.92"/>
</g>
<!-- layer_13_moe_out -->
<g id="node280" class="node">
<title>layer_13_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1430.24,-2702.14 1065.57,-2702.14 971.76,-2598.14 1336.43,-2598.14 1430.24,-2702.14"/>
<text text-anchor="middle" x="1201" y="-2664.14" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="1201" y="-2653.14" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1201" y="-2642.14" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1201" y="-2631.14" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_13_expert_comm&#45;&gt;layer_13_moe_out -->
<g id="edge391" class="edge">
<title>layer_13_expert_comm&#45;&gt;layer_13_moe_out</title>
<path fill="none" stroke="black" d="M1201,-2738.07C1201,-2730.03 1201,-2721.28 1201,-2712.53"/>
<polygon fill="black" stroke="black" points="1204.5,-2712.31 1201,-2702.31 1197.5,-2712.31 1204.5,-2712.31"/>
</g>
<!-- layer_13_norm -->
<g id="node281" class="node">
<title>layer_13_norm</title>
<polygon fill="lightgreen" stroke="black" points="1311.5,-2562.14 1090.5,-2562.14 1090.5,-2510.14 1311.5,-2510.14 1311.5,-2562.14"/>
<text text-anchor="middle" x="1201" y="-2550.14" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="1201" y="-2539.14" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1201" y="-2528.14" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1201" y="-2517.14" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_13_moe_out&#45;&gt;layer_13_norm -->
<g id="edge392" class="edge">
<title>layer_13_moe_out&#45;&gt;layer_13_norm</title>
<path fill="none" stroke="black" d="M1201,-2598.06C1201,-2589.39 1201,-2580.57 1201,-2572.42"/>
<polygon fill="black" stroke="black" points="1204.5,-2572.18 1201,-2562.18 1197.5,-2572.18 1204.5,-2572.18"/>
</g>
<!-- layer_14_input -->
<g id="node282" class="node">
<title>layer_14_input</title>
<polygon fill="lightyellow" stroke="black" points="1465.24,-2463.14 1044.89,-2463.14 936.76,-2381.14 1357.11,-2381.14 1465.24,-2463.14"/>
<text text-anchor="middle" x="1201" y="-2430.64" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="1201" y="-2419.64" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1201" y="-2408.64" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_13_norm&#45;&gt;layer_14_input -->
<g id="edge393" class="edge">
<title>layer_13_norm&#45;&gt;layer_14_input</title>
<path fill="none" stroke="black" d="M1201,-2510C1201,-2499.32 1201,-2486.46 1201,-2473.95"/>
<polygon fill="black" stroke="black" points="1204.5,-2473.58 1201,-2463.58 1197.5,-2473.58 1204.5,-2473.58"/>
</g>
<!-- layer_14_qkv_tp0 -->
<g id="node283" class="node">
<title>layer_14_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1161.5,-2345.14 886.5,-2345.14 886.5,-2293.14 1161.5,-2293.14 1161.5,-2345.14"/>
<text text-anchor="middle" x="1024" y="-2333.14" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="1024" y="-2322.14" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1024" y="-2311.14" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1024" y="-2300.14" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_14_input&#45;&gt;layer_14_qkv_tp0 -->
<g id="edge394" class="edge">
<title>layer_14_input&#45;&gt;layer_14_qkv_tp0</title>
<path fill="none" stroke="black" d="M1130.79,-2381.08C1112.87,-2370.85 1093.91,-2360.03 1077.02,-2350.39"/>
<polygon fill="black" stroke="black" points="1078.28,-2347.09 1067.86,-2345.17 1074.82,-2353.17 1078.28,-2347.09"/>
</g>
<!-- layer_14_qkv_tp1 -->
<g id="node284" class="node">
<title>layer_14_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1454.5,-2345.14 1179.5,-2345.14 1179.5,-2293.14 1454.5,-2293.14 1454.5,-2345.14"/>
<text text-anchor="middle" x="1317" y="-2333.14" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1317" y="-2322.14" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1317" y="-2311.14" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1317" y="-2300.14" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_14_input&#45;&gt;layer_14_qkv_tp1 -->
<g id="edge395" class="edge">
<title>layer_14_input&#45;&gt;layer_14_qkv_tp1</title>
<path fill="none" stroke="black" d="M1247.18,-2380.93C1258.16,-2371.37 1269.72,-2361.3 1280.21,-2352.17"/>
<polygon fill="black" stroke="black" points="1282.75,-2354.6 1288,-2345.39 1278.16,-2349.32 1282.75,-2354.6"/>
</g>
<!-- layer_14_attn_tp0 -->
<g id="node285" class="node">
<title>layer_14_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1158,-2257.14 896,-2257.14 896,-2205.14 1158,-2205.14 1158,-2257.14"/>
<text text-anchor="middle" x="1027" y="-2245.14" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="1027" y="-2234.14" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1027" y="-2223.14" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1027" y="-2212.14" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_14_qkv_tp0&#45;&gt;layer_14_attn_tp0 -->
<g id="edge396" class="edge">
<title>layer_14_qkv_tp0&#45;&gt;layer_14_attn_tp0</title>
<path fill="none" stroke="black" d="M1024.88,-2292.8C1025.16,-2284.84 1025.47,-2275.9 1025.77,-2267.38"/>
<polygon fill="black" stroke="black" points="1029.27,-2267.41 1026.12,-2257.3 1022.28,-2267.17 1029.27,-2267.41"/>
</g>
<!-- layer_14_attn_tp1 -->
<g id="node286" class="node">
<title>layer_14_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1442,-2257.14 1180,-2257.14 1180,-2205.14 1442,-2205.14 1442,-2257.14"/>
<text text-anchor="middle" x="1311" y="-2245.14" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1311" y="-2234.14" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1311" y="-2223.14" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1311" y="-2212.14" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_14_qkv_tp1&#45;&gt;layer_14_attn_tp1 -->
<g id="edge397" class="edge">
<title>layer_14_qkv_tp1&#45;&gt;layer_14_attn_tp1</title>
<path fill="none" stroke="black" d="M1315.23,-2292.8C1314.68,-2284.84 1314.05,-2275.9 1313.46,-2267.38"/>
<polygon fill="black" stroke="black" points="1316.94,-2267.03 1312.76,-2257.3 1309.96,-2267.52 1316.94,-2267.03"/>
</g>
<!-- layer_14_attn_comm -->
<g id="node287" class="node">
<title>layer_14_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1256" cy="-2132.37" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1256" y="-2146.37" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="1256" y="-2135.37" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1256" y="-2124.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1256" y="-2113.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_14_attn_tp0&#45;&gt;layer_14_attn_comm -->
<g id="edge398" class="edge">
<title>layer_14_attn_tp0&#45;&gt;layer_14_attn_comm</title>
<path fill="none" stroke="black" d="M1086.27,-2205.09C1112.35,-2194.07 1143.45,-2180.93 1171.86,-2168.93"/>
<polygon fill="black" stroke="black" points="1173.53,-2172.02 1181.38,-2164.9 1170.81,-2165.57 1173.53,-2172.02"/>
</g>
<!-- layer_14_attn_tp1&#45;&gt;layer_14_attn_comm -->
<g id="edge399" class="edge">
<title>layer_14_attn_tp1&#45;&gt;layer_14_attn_comm</title>
<path fill="none" stroke="black" d="M1296.69,-2204.97C1291.97,-2196.65 1286.56,-2187.13 1281.26,-2177.81"/>
<polygon fill="black" stroke="black" points="1284.22,-2175.94 1276.24,-2168.98 1278.14,-2179.4 1284.22,-2175.94"/>
</g>
<!-- layer_14_attn_out -->
<g id="node288" class="node">
<title>layer_14_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1366.5,-2059.6 1145.5,-2059.6 1145.5,-2007.6 1366.5,-2007.6 1366.5,-2059.6"/>
<text text-anchor="middle" x="1256" y="-2047.6" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="1256" y="-2036.6" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1256" y="-2025.6" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1256" y="-2014.6" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_14_attn_comm&#45;&gt;layer_14_attn_out -->
<g id="edge400" class="edge">
<title>layer_14_attn_comm&#45;&gt;layer_14_attn_out</title>
<path fill="none" stroke="black" d="M1256,-2095.34C1256,-2087.02 1256,-2078.19 1256,-2069.91"/>
<polygon fill="black" stroke="black" points="1259.5,-2069.8 1256,-2059.8 1252.5,-2069.8 1259.5,-2069.8"/>
</g>
<!-- layer_14_gate -->
<g id="node289" class="node">
<title>layer_14_gate</title>
<polygon fill="lightyellow" stroke="black" points="1510.01,-1971.6 1105.94,-1971.6 1001.99,-1867.6 1406.06,-1867.6 1510.01,-1971.6"/>
<text text-anchor="middle" x="1256" y="-1933.6" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="1256" y="-1922.6" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1256" y="-1911.6" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1256" y="-1900.6" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_14_attn_out&#45;&gt;layer_14_gate -->
<g id="edge401" class="edge">
<title>layer_14_attn_out&#45;&gt;layer_14_gate</title>
<path fill="none" stroke="black" d="M1256,-2007.47C1256,-1999.78 1256,-1990.97 1256,-1981.97"/>
<polygon fill="black" stroke="black" points="1259.5,-1981.78 1256,-1971.78 1252.5,-1981.78 1259.5,-1981.78"/>
</g>
<!-- layer_14_expert_select -->
<g id="node290" class="node">
<title>layer_14_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1522.39,-1831.6 1098.62,-1831.6 989.61,-1727.6 1413.38,-1727.6 1522.39,-1831.6"/>
<text text-anchor="middle" x="1256" y="-1793.6" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="1256" y="-1782.6" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1256" y="-1771.6" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="1256" y="-1760.6" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_14_gate&#45;&gt;layer_14_expert_select -->
<g id="edge402" class="edge">
<title>layer_14_gate&#45;&gt;layer_14_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1256,-1867.21C1256,-1859.04 1256,-1850.52 1256,-1842.14"/>
<polygon fill="black" stroke="black" points="1259.5,-1842.03 1256,-1832.03 1252.5,-1842.03 1259.5,-1842.03"/>
</g>
<!-- layer_14_experts_gpu0 -->
<g id="node291" class="node">
<title>layer_14_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="520.5,-1691.6 305.5,-1691.6 305.5,-1639.6 520.5,-1639.6 520.5,-1691.6"/>
<text text-anchor="middle" x="413" y="-1679.6" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="413" y="-1668.6" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="413" y="-1657.6" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="413" y="-1646.6" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_14_expert_select&#45;&gt;layer_14_experts_gpu0 -->
<g id="edge403" class="edge">
<title>layer_14_expert_select&#45;&gt;layer_14_experts_gpu0</title>
<path fill="none" stroke="black" d="M1019.06,-1755.88C879.34,-1741.12 699.03,-1719.69 530.73,-1691.84"/>
<polygon fill="black" stroke="black" points="531.12,-1688.35 520.68,-1690.16 529.97,-1695.26 531.12,-1688.35"/>
</g>
<!-- layer_14_experts_gpu1 -->
<g id="node292" class="node">
<title>layer_14_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="753.5,-1691.6 538.5,-1691.6 538.5,-1639.6 753.5,-1639.6 753.5,-1691.6"/>
<text text-anchor="middle" x="646" y="-1679.6" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="646" y="-1668.6" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="646" y="-1657.6" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="646" y="-1646.6" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_14_expert_select&#45;&gt;layer_14_experts_gpu1 -->
<g id="edge404" class="edge">
<title>layer_14_expert_select&#45;&gt;layer_14_experts_gpu1</title>
<path fill="none" stroke="black" d="M996.94,-1734.68C924.36,-1721.91 845.26,-1707.55 763.67,-1691.71"/>
<polygon fill="black" stroke="black" points="764.2,-1688.24 753.71,-1689.77 762.86,-1695.11 764.2,-1688.24"/>
</g>
<!-- layer_14_experts_gpu2 -->
<g id="node293" class="node">
<title>layer_14_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="986.5,-1691.6 771.5,-1691.6 771.5,-1639.6 986.5,-1639.6 986.5,-1691.6"/>
<text text-anchor="middle" x="879" y="-1679.6" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="879" y="-1668.6" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="879" y="-1657.6" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="879" y="-1646.6" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_14_expert_select&#45;&gt;layer_14_experts_gpu2 -->
<g id="edge405" class="edge">
<title>layer_14_expert_select&#45;&gt;layer_14_experts_gpu2</title>
<path fill="none" stroke="black" d="M1084.32,-1727.6C1046.11,-1716.25 1006.98,-1704.62 973.26,-1694.6"/>
<polygon fill="black" stroke="black" points="974.02,-1691.18 963.43,-1691.68 972.02,-1697.89 974.02,-1691.18"/>
</g>
<!-- layer_14_experts_gpu3 -->
<g id="node294" class="node">
<title>layer_14_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1219.5,-1691.6 1004.5,-1691.6 1004.5,-1639.6 1219.5,-1639.6 1219.5,-1691.6"/>
<text text-anchor="middle" x="1112" y="-1679.6" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="1112" y="-1668.6" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1112" y="-1657.6" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1112" y="-1646.6" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_14_expert_select&#45;&gt;layer_14_experts_gpu3 -->
<g id="edge406" class="edge">
<title>layer_14_expert_select&#45;&gt;layer_14_experts_gpu3</title>
<path fill="none" stroke="black" d="M1190.32,-1727.52C1177.3,-1717.39 1164.01,-1707.05 1152.15,-1697.83"/>
<polygon fill="black" stroke="black" points="1154.24,-1695.02 1144.2,-1691.64 1149.94,-1700.55 1154.24,-1695.02"/>
</g>
<!-- layer_14_experts_gpu4 -->
<g id="node295" class="node">
<title>layer_14_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1452.5,-1691.6 1237.5,-1691.6 1237.5,-1639.6 1452.5,-1639.6 1452.5,-1691.6"/>
<text text-anchor="middle" x="1345" y="-1679.6" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1345" y="-1668.6" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1345" y="-1657.6" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1345" y="-1646.6" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_14_expert_select&#45;&gt;layer_14_experts_gpu4 -->
<g id="edge407" class="edge">
<title>layer_14_expert_select&#45;&gt;layer_14_experts_gpu4</title>
<path fill="none" stroke="black" d="M1296.59,-1727.52C1304.1,-1718.07 1311.75,-1708.44 1318.69,-1699.71"/>
<polygon fill="black" stroke="black" points="1321.62,-1701.65 1325.1,-1691.64 1316.14,-1697.3 1321.62,-1701.65"/>
</g>
<!-- layer_14_experts_gpu5 -->
<g id="node296" class="node">
<title>layer_14_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1685.5,-1691.6 1470.5,-1691.6 1470.5,-1639.6 1685.5,-1639.6 1685.5,-1691.6"/>
<text text-anchor="middle" x="1578" y="-1679.6" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1578" y="-1668.6" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1578" y="-1657.6" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1578" y="-1646.6" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_14_expert_select&#45;&gt;layer_14_experts_gpu5 -->
<g id="edge408" class="edge">
<title>layer_14_expert_select&#45;&gt;layer_14_experts_gpu5</title>
<path fill="none" stroke="black" d="M1402.87,-1727.52C1435.05,-1716.32 1468,-1704.86 1496.51,-1694.94"/>
<polygon fill="black" stroke="black" points="1497.7,-1698.23 1506,-1691.64 1495.41,-1691.62 1497.7,-1698.23"/>
</g>
<!-- layer_14_experts_gpu6 -->
<g id="node297" class="node">
<title>layer_14_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1918.5,-1691.6 1703.5,-1691.6 1703.5,-1639.6 1918.5,-1639.6 1918.5,-1691.6"/>
<text text-anchor="middle" x="1811" y="-1679.6" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1811" y="-1668.6" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1811" y="-1657.6" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1811" y="-1646.6" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_14_expert_select&#45;&gt;layer_14_experts_gpu6 -->
<g id="edge409" class="edge">
<title>layer_14_expert_select&#45;&gt;layer_14_experts_gpu6</title>
<path fill="none" stroke="black" d="M1431.3,-1744.55C1508.89,-1729.31 1601.49,-1710.89 1693.24,-1691.95"/>
<polygon fill="black" stroke="black" points="1694.18,-1695.33 1703.27,-1689.88 1692.76,-1688.48 1694.18,-1695.33"/>
</g>
<!-- layer_14_experts_gpu7 -->
<g id="node298" class="node">
<title>layer_14_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2151.5,-1691.6 1936.5,-1691.6 1936.5,-1639.6 2151.5,-1639.6 2151.5,-1691.6"/>
<text text-anchor="middle" x="2044" y="-1679.6" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="2044" y="-1668.6" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="2044" y="-1657.6" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="2044" y="-1646.6" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_14_expert_select&#45;&gt;layer_14_experts_gpu7 -->
<g id="edge410" class="edge">
<title>layer_14_expert_select&#45;&gt;layer_14_experts_gpu7</title>
<path fill="none" stroke="black" d="M1445.64,-1758.33C1577.96,-1743.16 1758.76,-1720.41 1926.31,-1691.84"/>
<polygon fill="black" stroke="black" points="1927.05,-1695.27 1936.31,-1690.13 1925.86,-1688.37 1927.05,-1695.27"/>
</g>
<!-- layer_14_expert_comm -->
<g id="node299" class="node">
<title>layer_14_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1273" cy="-1566.83" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1273" y="-1580.83" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1273" y="-1569.83" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="1273" y="-1558.83" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1273" y="-1547.83" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_14_experts_gpu0&#45;&gt;layer_14_expert_comm -->
<g id="edge411" class="edge">
<title>layer_14_experts_gpu0&#45;&gt;layer_14_expert_comm</title>
<path fill="none" stroke="black" d="M520.67,-1640.95C523.47,-1640.48 526.25,-1640.03 529,-1639.6 728.93,-1608.52 961.31,-1588.68 1112.44,-1577.91"/>
<polygon fill="black" stroke="black" points="1113,-1581.38 1122.73,-1577.18 1112.51,-1574.4 1113,-1581.38"/>
</g>
<!-- layer_14_experts_gpu1&#45;&gt;layer_14_expert_comm -->
<g id="edge412" class="edge">
<title>layer_14_experts_gpu1&#45;&gt;layer_14_expert_comm</title>
<path fill="none" stroke="black" d="M753.69,-1641.29C756.82,-1640.71 759.93,-1640.14 763,-1639.6 884.64,-1618.07 1023.51,-1598.88 1125.6,-1585.77"/>
<polygon fill="black" stroke="black" points="1126.2,-1589.22 1135.67,-1584.48 1125.31,-1582.28 1126.2,-1589.22"/>
</g>
<!-- layer_14_experts_gpu2&#45;&gt;layer_14_expert_comm -->
<g id="edge413" class="edge">
<title>layer_14_experts_gpu2&#45;&gt;layer_14_expert_comm</title>
<path fill="none" stroke="black" d="M980.98,-1639.55C1034.86,-1626.32 1101.21,-1610.02 1157.04,-1596.31"/>
<polygon fill="black" stroke="black" points="1158.1,-1599.65 1166.98,-1593.87 1156.44,-1592.86 1158.1,-1599.65"/>
</g>
<!-- layer_14_experts_gpu3&#45;&gt;layer_14_expert_comm -->
<g id="edge414" class="edge">
<title>layer_14_experts_gpu3&#45;&gt;layer_14_expert_comm</title>
<path fill="none" stroke="black" d="M1153.88,-1639.43C1170.61,-1629.37 1190.26,-1617.56 1208.72,-1606.47"/>
<polygon fill="black" stroke="black" points="1210.61,-1609.41 1217.38,-1601.26 1207.01,-1603.41 1210.61,-1609.41"/>
</g>
<!-- layer_14_experts_gpu4&#45;&gt;layer_14_expert_comm -->
<g id="edge415" class="edge">
<title>layer_14_experts_gpu4&#45;&gt;layer_14_expert_comm</title>
<path fill="none" stroke="black" d="M1326.27,-1639.43C1319.95,-1630.94 1312.71,-1621.2 1305.64,-1611.7"/>
<polygon fill="black" stroke="black" points="1308.27,-1609.37 1299.5,-1603.44 1302.66,-1613.55 1308.27,-1609.37"/>
</g>
<!-- layer_14_experts_gpu5&#45;&gt;layer_14_expert_comm -->
<g id="edge416" class="edge">
<title>layer_14_experts_gpu5&#45;&gt;layer_14_expert_comm</title>
<path fill="none" stroke="black" d="M1499.06,-1639.55C1460.9,-1627.45 1414.67,-1612.78 1373.98,-1599.87"/>
<polygon fill="black" stroke="black" points="1374.9,-1596.49 1364.31,-1596.8 1372.78,-1603.16 1374.9,-1596.49"/>
</g>
<!-- layer_14_experts_gpu6&#45;&gt;layer_14_expert_comm -->
<g id="edge417" class="edge">
<title>layer_14_experts_gpu6&#45;&gt;layer_14_expert_comm</title>
<path fill="none" stroke="black" d="M1703.29,-1641.22C1700.5,-1640.67 1697.73,-1640.13 1695,-1639.6 1600.33,-1621.36 1493.25,-1603.17 1410.63,-1589.67"/>
<polygon fill="black" stroke="black" points="1411.12,-1586.21 1400.68,-1588.05 1409.99,-1593.12 1411.12,-1586.21"/>
</g>
<!-- layer_14_experts_gpu7&#45;&gt;layer_14_expert_comm -->
<g id="edge418" class="edge">
<title>layer_14_experts_gpu7&#45;&gt;layer_14_expert_comm</title>
<path fill="none" stroke="black" d="M1936.32,-1641C1933.52,-1640.51 1930.75,-1640.05 1928,-1639.6 1758.79,-1612.17 1563.25,-1592.26 1430.19,-1580.47"/>
<polygon fill="black" stroke="black" points="1430.18,-1576.96 1419.92,-1579.56 1429.57,-1583.93 1430.18,-1576.96"/>
</g>
<!-- layer_14_moe_out -->
<g id="node300" class="node">
<title>layer_14_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1502.24,-1494.06 1137.57,-1494.06 1043.76,-1390.06 1408.43,-1390.06 1502.24,-1494.06"/>
<text text-anchor="middle" x="1273" y="-1456.06" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="1273" y="-1445.06" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1273" y="-1434.06" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1273" y="-1423.06" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_14_expert_comm&#45;&gt;layer_14_moe_out -->
<g id="edge419" class="edge">
<title>layer_14_expert_comm&#45;&gt;layer_14_moe_out</title>
<path fill="none" stroke="black" d="M1273,-1529.99C1273,-1521.95 1273,-1513.2 1273,-1504.46"/>
<polygon fill="black" stroke="black" points="1276.5,-1504.23 1273,-1494.23 1269.5,-1504.23 1276.5,-1504.23"/>
</g>
<!-- layer_14_norm -->
<g id="node301" class="node">
<title>layer_14_norm</title>
<polygon fill="lightgreen" stroke="black" points="1383.5,-1354.06 1162.5,-1354.06 1162.5,-1302.06 1383.5,-1302.06 1383.5,-1354.06"/>
<text text-anchor="middle" x="1273" y="-1342.06" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="1273" y="-1331.06" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1273" y="-1320.06" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1273" y="-1309.06" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_14_moe_out&#45;&gt;layer_14_norm -->
<g id="edge420" class="edge">
<title>layer_14_moe_out&#45;&gt;layer_14_norm</title>
<path fill="none" stroke="black" d="M1273,-1389.98C1273,-1381.31 1273,-1372.49 1273,-1364.35"/>
<polygon fill="black" stroke="black" points="1276.5,-1364.1 1273,-1354.1 1269.5,-1364.1 1276.5,-1364.1"/>
</g>
<!-- layer_15_input -->
<g id="node302" class="node">
<title>layer_15_input</title>
<polygon fill="lightyellow" stroke="black" points="1537.24,-1255.06 1116.89,-1255.06 1008.76,-1173.06 1429.11,-1173.06 1537.24,-1255.06"/>
<text text-anchor="middle" x="1273" y="-1222.56" font-family="Arial" font-size="10.00">Layer Input</text>
<text text-anchor="middle" x="1273" y="-1211.56" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1273" y="-1200.56" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_14_norm&#45;&gt;layer_15_input -->
<g id="edge421" class="edge">
<title>layer_14_norm&#45;&gt;layer_15_input</title>
<path fill="none" stroke="black" d="M1273,-1301.93C1273,-1291.24 1273,-1278.38 1273,-1265.87"/>
<polygon fill="black" stroke="black" points="1276.5,-1265.5 1273,-1255.5 1269.5,-1265.5 1276.5,-1265.5"/>
</g>
<!-- layer_15_qkv_tp0 -->
<g id="node303" class="node">
<title>layer_15_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1338.5,-1137.06 1063.5,-1137.06 1063.5,-1085.06 1338.5,-1085.06 1338.5,-1137.06"/>
<text text-anchor="middle" x="1201" y="-1125.06" font-family="Arial" font-size="10.00">QKV Projection TP0</text>
<text text-anchor="middle" x="1201" y="-1114.06" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1201" y="-1103.06" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1201" y="-1092.06" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_15_input&#45;&gt;layer_15_qkv_tp0 -->
<g id="edge422" class="edge">
<title>layer_15_input&#45;&gt;layer_15_qkv_tp0</title>
<path fill="none" stroke="black" d="M1244.34,-1172.85C1237.93,-1163.86 1231.19,-1154.41 1224.99,-1145.71"/>
<polygon fill="black" stroke="black" points="1227.66,-1143.42 1219,-1137.31 1221.96,-1147.49 1227.66,-1143.42"/>
</g>
<!-- layer_15_qkv_tp1 -->
<g id="node304" class="node">
<title>layer_15_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1631.5,-1137.06 1356.5,-1137.06 1356.5,-1085.06 1631.5,-1085.06 1631.5,-1137.06"/>
<text text-anchor="middle" x="1494" y="-1125.06" font-family="Arial" font-size="10.00">QKV Projection TP1</text>
<text text-anchor="middle" x="1494" y="-1114.06" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1494" y="-1103.06" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1494" y="-1092.06" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 16 heads, 64 d_k]</text>
</g>
<!-- layer_15_input&#45;&gt;layer_15_qkv_tp1 -->
<g id="edge423" class="edge">
<title>layer_15_input&#45;&gt;layer_15_qkv_tp1</title>
<path fill="none" stroke="black" d="M1360.66,-1173C1383.86,-1162.4 1408.46,-1151.15 1430.14,-1141.25"/>
<polygon fill="black" stroke="black" points="1431.59,-1144.43 1439.23,-1137.09 1428.68,-1138.06 1431.59,-1144.43"/>
</g>
<!-- layer_15_attn_tp0 -->
<g id="node305" class="node">
<title>layer_15_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1336,-1049.06 1074,-1049.06 1074,-997.06 1336,-997.06 1336,-1049.06"/>
<text text-anchor="middle" x="1205" y="-1037.06" font-family="Arial" font-size="10.00">Attention Score TP0</text>
<text text-anchor="middle" x="1205" y="-1026.06" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1205" y="-1015.06" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1205" y="-1004.06" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_15_qkv_tp0&#45;&gt;layer_15_attn_tp0 -->
<g id="edge424" class="edge">
<title>layer_15_qkv_tp0&#45;&gt;layer_15_attn_tp0</title>
<path fill="none" stroke="black" d="M1202.18,-1084.72C1202.55,-1076.76 1202.96,-1067.82 1203.36,-1059.31"/>
<polygon fill="black" stroke="black" points="1206.86,-1059.37 1203.83,-1049.22 1199.87,-1059.04 1206.86,-1059.37"/>
</g>
<!-- layer_15_attn_tp1 -->
<g id="node306" class="node">
<title>layer_15_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1622,-1049.06 1360,-1049.06 1360,-997.06 1622,-997.06 1622,-1049.06"/>
<text text-anchor="middle" x="1491" y="-1037.06" font-family="Arial" font-size="10.00">Attention Score TP1</text>
<text text-anchor="middle" x="1491" y="-1026.06" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="1491" y="-1015.06" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 8 heads, 64 d_k]</text>
<text text-anchor="middle" x="1491" y="-1004.06" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 8 heads, 1024]</text>
</g>
<!-- layer_15_qkv_tp1&#45;&gt;layer_15_attn_tp1 -->
<g id="edge425" class="edge">
<title>layer_15_qkv_tp1&#45;&gt;layer_15_attn_tp1</title>
<path fill="none" stroke="black" d="M1493.12,-1084.72C1492.84,-1076.76 1492.53,-1067.82 1492.23,-1059.31"/>
<polygon fill="black" stroke="black" points="1495.72,-1059.09 1491.88,-1049.22 1488.73,-1059.33 1495.72,-1059.09"/>
</g>
<!-- layer_15_attn_comm -->
<g id="node307" class="node">
<title>layer_15_attn_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1228" cy="-924.29" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1228" y="-938.29" font-family="Arial" font-size="10.00">Attention Output All&#45;Reduce</text>
<text text-anchor="middle" x="1228" y="-927.29" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1228" y="-916.29" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1228" y="-905.29" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_15_attn_tp0&#45;&gt;layer_15_attn_comm -->
<g id="edge426" class="edge">
<title>layer_15_attn_tp0&#45;&gt;layer_15_attn_comm</title>
<path fill="none" stroke="black" d="M1210.98,-996.89C1212.86,-989 1214.99,-980.02 1217.1,-971.16"/>
<polygon fill="black" stroke="black" points="1220.54,-971.81 1219.45,-961.27 1213.73,-970.19 1220.54,-971.81"/>
</g>
<!-- layer_15_attn_tp1&#45;&gt;layer_15_attn_comm -->
<g id="edge427" class="edge">
<title>layer_15_attn_tp1&#45;&gt;layer_15_attn_comm</title>
<path fill="none" stroke="black" d="M1422.93,-997.01C1391.49,-985.45 1353.69,-971.54 1319.77,-959.06"/>
<polygon fill="black" stroke="black" points="1320.91,-955.75 1310.32,-955.58 1318.5,-962.32 1320.91,-955.75"/>
</g>
<!-- layer_15_attn_out -->
<g id="node308" class="node">
<title>layer_15_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1338.5,-851.52 1117.5,-851.52 1117.5,-799.52 1338.5,-799.52 1338.5,-851.52"/>
<text text-anchor="middle" x="1228" y="-839.52" font-family="Arial" font-size="10.00">Attention Output Projection</text>
<text text-anchor="middle" x="1228" y="-828.52" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1228" y="-817.52" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1228" y="-806.52" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_15_attn_comm&#45;&gt;layer_15_attn_out -->
<g id="edge428" class="edge">
<title>layer_15_attn_comm&#45;&gt;layer_15_attn_out</title>
<path fill="none" stroke="black" d="M1228,-887.26C1228,-878.95 1228,-870.11 1228,-861.83"/>
<polygon fill="black" stroke="black" points="1231.5,-861.72 1228,-851.72 1224.5,-861.72 1231.5,-861.72"/>
</g>
<!-- layer_15_gate -->
<g id="node309" class="node">
<title>layer_15_gate</title>
<polygon fill="lightyellow" stroke="black" points="1482.01,-763.52 1077.94,-763.52 973.99,-659.52 1378.06,-659.52 1482.01,-763.52"/>
<text text-anchor="middle" x="1228" y="-725.52" font-family="Arial" font-size="10.00">MoE Gate Network</text>
<text text-anchor="middle" x="1228" y="-714.52" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1228" y="-703.52" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1228" y="-692.52" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 64 experts]</text>
</g>
<!-- layer_15_attn_out&#45;&gt;layer_15_gate -->
<g id="edge429" class="edge">
<title>layer_15_attn_out&#45;&gt;layer_15_gate</title>
<path fill="none" stroke="black" d="M1228,-799.39C1228,-791.7 1228,-782.89 1228,-773.89"/>
<polygon fill="black" stroke="black" points="1231.5,-773.7 1228,-763.7 1224.5,-773.7 1231.5,-773.7"/>
</g>
<!-- layer_15_expert_select -->
<g id="node310" class="node">
<title>layer_15_expert_select</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1494.39,-623.52 1070.62,-623.52 961.61,-519.52 1385.38,-519.52 1494.39,-623.52"/>
<text text-anchor="middle" x="1228" y="-585.52" font-family="Arial" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="1228" y="-574.52" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1228" y="-563.52" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 64 experts]</text>
<text text-anchor="middle" x="1228" y="-552.52" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, top&#45;2 experts]</text>
</g>
<!-- layer_15_gate&#45;&gt;layer_15_expert_select -->
<g id="edge430" class="edge">
<title>layer_15_gate&#45;&gt;layer_15_expert_select</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1228,-659.14C1228,-650.96 1228,-642.44 1228,-634.06"/>
<polygon fill="black" stroke="black" points="1231.5,-633.95 1228,-623.95 1224.5,-633.95 1231.5,-633.95"/>
</g>
<!-- layer_15_experts_gpu0 -->
<g id="node311" class="node">
<title>layer_15_experts_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="520.5,-483.52 305.5,-483.52 305.5,-431.52 520.5,-431.52 520.5,-483.52"/>
<text text-anchor="middle" x="413" y="-471.52" font-family="Arial" font-size="10.00">Experts 0&#45;7</text>
<text text-anchor="middle" x="413" y="-460.52" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="413" y="-449.52" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="413" y="-438.52" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_15_expert_select&#45;&gt;layer_15_experts_gpu0 -->
<g id="edge431" class="edge">
<title>layer_15_expert_select&#45;&gt;layer_15_experts_gpu0</title>
<path fill="none" stroke="black" d="M989.44,-546.12C856.76,-531.25 688.58,-510.28 530.59,-483.74"/>
<polygon fill="black" stroke="black" points="531.13,-480.28 520.68,-482.07 529.96,-487.19 531.13,-480.28"/>
</g>
<!-- layer_15_experts_gpu1 -->
<g id="node312" class="node">
<title>layer_15_experts_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="753.5,-483.52 538.5,-483.52 538.5,-431.52 753.5,-431.52 753.5,-483.52"/>
<text text-anchor="middle" x="646" y="-471.52" font-family="Arial" font-size="10.00">Experts 8&#45;15</text>
<text text-anchor="middle" x="646" y="-460.52" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="646" y="-449.52" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="646" y="-438.52" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_15_expert_select&#45;&gt;layer_15_experts_gpu1 -->
<g id="edge432" class="edge">
<title>layer_15_expert_select&#45;&gt;layer_15_experts_gpu1</title>
<path fill="none" stroke="black" d="M964.64,-522.46C901.69,-510.65 834.55,-497.8 763.74,-483.65"/>
<polygon fill="black" stroke="black" points="764.21,-480.18 753.72,-481.65 762.84,-487.04 764.21,-480.18"/>
</g>
<!-- layer_15_experts_gpu2 -->
<g id="node313" class="node">
<title>layer_15_experts_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="986.5,-483.52 771.5,-483.52 771.5,-431.52 986.5,-431.52 986.5,-483.52"/>
<text text-anchor="middle" x="879" y="-471.52" font-family="Arial" font-size="10.00">Experts 16&#45;23</text>
<text text-anchor="middle" x="879" y="-460.52" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="879" y="-449.52" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="879" y="-438.52" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_15_expert_select&#45;&gt;layer_15_experts_gpu2 -->
<g id="edge433" class="edge">
<title>layer_15_expert_select&#45;&gt;layer_15_experts_gpu2</title>
<path fill="none" stroke="black" d="M1069.07,-519.52C1034.01,-508.27 998.09,-496.74 967.06,-486.78"/>
<polygon fill="black" stroke="black" points="967.75,-483.33 957.16,-483.61 965.62,-489.99 967.75,-483.33"/>
</g>
<!-- layer_15_experts_gpu3 -->
<g id="node314" class="node">
<title>layer_15_experts_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1219.5,-483.52 1004.5,-483.52 1004.5,-431.52 1219.5,-431.52 1219.5,-483.52"/>
<text text-anchor="middle" x="1112" y="-471.52" font-family="Arial" font-size="10.00">Experts 24&#45;31</text>
<text text-anchor="middle" x="1112" y="-460.52" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1112" y="-449.52" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1112" y="-438.52" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_15_expert_select&#45;&gt;layer_15_experts_gpu3 -->
<g id="edge434" class="edge">
<title>layer_15_expert_select&#45;&gt;layer_15_experts_gpu3</title>
<path fill="none" stroke="black" d="M1175.09,-519.44C1164.91,-509.61 1154.51,-499.57 1145.18,-490.55"/>
<polygon fill="black" stroke="black" points="1147.56,-487.99 1137.94,-483.57 1142.7,-493.03 1147.56,-487.99"/>
</g>
<!-- layer_15_experts_gpu4 -->
<g id="node315" class="node">
<title>layer_15_experts_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1452.5,-483.52 1237.5,-483.52 1237.5,-431.52 1452.5,-431.52 1452.5,-483.52"/>
<text text-anchor="middle" x="1345" y="-471.52" font-family="Arial" font-size="10.00">Experts 32&#45;39</text>
<text text-anchor="middle" x="1345" y="-460.52" font-family="Arial" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="1345" y="-449.52" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1345" y="-438.52" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_15_expert_select&#45;&gt;layer_15_experts_gpu4 -->
<g id="edge435" class="edge">
<title>layer_15_expert_select&#45;&gt;layer_15_experts_gpu4</title>
<path fill="none" stroke="black" d="M1281.36,-519.44C1291.64,-509.61 1302.12,-499.57 1311.54,-490.55"/>
<polygon fill="black" stroke="black" points="1314.04,-493.01 1318.84,-483.57 1309.19,-487.95 1314.04,-493.01"/>
</g>
<!-- layer_15_experts_gpu5 -->
<g id="node316" class="node">
<title>layer_15_experts_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1685.5,-483.52 1470.5,-483.52 1470.5,-431.52 1685.5,-431.52 1685.5,-483.52"/>
<text text-anchor="middle" x="1578" y="-471.52" font-family="Arial" font-size="10.00">Experts 40&#45;47</text>
<text text-anchor="middle" x="1578" y="-460.52" font-family="Arial" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="1578" y="-449.52" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1578" y="-438.52" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_15_expert_select&#45;&gt;layer_15_experts_gpu5 -->
<g id="edge436" class="edge">
<title>layer_15_expert_select&#45;&gt;layer_15_experts_gpu5</title>
<path fill="none" stroke="black" d="M1386.1,-519.93C1421.73,-508.53 1458.3,-496.83 1489.83,-486.74"/>
<polygon fill="black" stroke="black" points="1490.99,-490.04 1499.45,-483.66 1488.86,-483.37 1490.99,-490.04"/>
</g>
<!-- layer_15_experts_gpu6 -->
<g id="node317" class="node">
<title>layer_15_experts_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1918.5,-483.52 1703.5,-483.52 1703.5,-431.52 1918.5,-431.52 1918.5,-483.52"/>
<text text-anchor="middle" x="1811" y="-471.52" font-family="Arial" font-size="10.00">Experts 48&#45;55</text>
<text text-anchor="middle" x="1811" y="-460.52" font-family="Arial" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="1811" y="-449.52" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1811" y="-438.52" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_15_expert_select&#45;&gt;layer_15_experts_gpu6 -->
<g id="edge437" class="edge">
<title>layer_15_expert_select&#45;&gt;layer_15_experts_gpu6</title>
<path fill="none" stroke="black" d="M1405.63,-538.64C1490.1,-523.18 1592.73,-503.97 1693.24,-483.86"/>
<polygon fill="black" stroke="black" points="1694.16,-487.24 1703.27,-481.85 1692.78,-480.38 1694.16,-487.24"/>
</g>
<!-- layer_15_experts_gpu7 -->
<g id="node318" class="node">
<title>layer_15_experts_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2151.5,-483.52 1936.5,-483.52 1936.5,-431.52 2151.5,-431.52 2151.5,-483.52"/>
<text text-anchor="middle" x="2044" y="-471.52" font-family="Arial" font-size="10.00">Experts 56&#45;63</text>
<text text-anchor="middle" x="2044" y="-460.52" font-family="Arial" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="2044" y="-449.52" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="2044" y="-438.52" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=1024, 2048]</text>
</g>
<!-- layer_15_expert_select&#45;&gt;layer_15_experts_gpu7 -->
<g id="edge438" class="edge">
<title>layer_15_expert_select&#45;&gt;layer_15_experts_gpu7</title>
<path fill="none" stroke="black" d="M1419.18,-551.38C1557.66,-536.42 1749.43,-513.44 1926.3,-483.76"/>
<polygon fill="black" stroke="black" points="1927.04,-487.18 1936.32,-482.07 1925.87,-480.28 1927.04,-487.18"/>
</g>
<!-- layer_15_expert_comm -->
<g id="node319" class="node">
<title>layer_15_expert_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1228" cy="-358.75" rx="156.04" ry="36.54"/>
<text text-anchor="middle" x="1228" y="-372.75" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1228" y="-361.75" font-family="Arial" font-size="10.00">All GPUs</text>
<text text-anchor="middle" x="1228" y="-350.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1228" y="-339.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 2048]</text>
</g>
<!-- layer_15_experts_gpu0&#45;&gt;layer_15_expert_comm -->
<g id="edge439" class="edge">
<title>layer_15_experts_gpu0&#45;&gt;layer_15_expert_comm</title>
<path fill="none" stroke="black" d="M520.67,-432.9C523.47,-432.42 526.25,-431.96 529,-431.52 713.44,-402.27 927.23,-382.34 1069.33,-371.04"/>
<polygon fill="black" stroke="black" points="1069.74,-374.52 1079.43,-370.24 1069.19,-367.54 1069.74,-374.52"/>
</g>
<!-- layer_15_experts_gpu1&#45;&gt;layer_15_expert_comm -->
<g id="edge440" class="edge">
<title>layer_15_experts_gpu1&#45;&gt;layer_15_expert_comm</title>
<path fill="none" stroke="black" d="M753.69,-433.27C756.83,-432.67 759.94,-432.09 763,-431.52 870.65,-411.73 993,-393 1085.17,-379.63"/>
<polygon fill="black" stroke="black" points="1085.73,-383.09 1095.12,-378.19 1084.72,-376.16 1085.73,-383.09"/>
</g>
<!-- layer_15_experts_gpu2&#45;&gt;layer_15_expert_comm -->
<g id="edge441" class="edge">
<title>layer_15_experts_gpu2&#45;&gt;layer_15_expert_comm</title>
<path fill="none" stroke="black" d="M969.33,-431.48C1015.06,-418.8 1070.92,-403.31 1119.02,-389.97"/>
<polygon fill="black" stroke="black" points="1120.14,-393.29 1128.84,-387.25 1118.27,-386.55 1120.14,-393.29"/>
</g>
<!-- layer_15_experts_gpu3&#45;&gt;layer_15_expert_comm -->
<g id="edge442" class="edge">
<title>layer_15_experts_gpu3&#45;&gt;layer_15_expert_comm</title>
<path fill="none" stroke="black" d="M1142.17,-431.35C1153.4,-421.98 1166.46,-411.09 1178.94,-400.68"/>
<polygon fill="black" stroke="black" points="1181.19,-403.36 1186.62,-394.27 1176.7,-397.99 1181.19,-403.36"/>
</g>
<!-- layer_15_experts_gpu4&#45;&gt;layer_15_expert_comm -->
<g id="edge443" class="edge">
<title>layer_15_experts_gpu4&#45;&gt;layer_15_expert_comm</title>
<path fill="none" stroke="black" d="M1314.57,-431.35C1303.24,-421.98 1290.07,-411.09 1277.48,-400.68"/>
<polygon fill="black" stroke="black" points="1279.67,-397.95 1269.73,-394.27 1275.21,-403.34 1279.67,-397.95"/>
</g>
<!-- layer_15_experts_gpu5&#45;&gt;layer_15_expert_comm -->
<g id="edge444" class="edge">
<title>layer_15_experts_gpu5&#45;&gt;layer_15_expert_comm</title>
<path fill="none" stroke="black" d="M1487.41,-431.48C1441.55,-418.8 1385.53,-403.31 1337.29,-389.97"/>
<polygon fill="black" stroke="black" points="1338.01,-386.54 1327.44,-387.25 1336.15,-393.28 1338.01,-386.54"/>
</g>
<!-- layer_15_experts_gpu6&#45;&gt;layer_15_expert_comm -->
<g id="edge445" class="edge">
<title>layer_15_experts_gpu6&#45;&gt;layer_15_expert_comm</title>
<path fill="none" stroke="black" d="M1703.3,-433.08C1700.5,-432.55 1697.74,-432.03 1695,-431.52 1586.81,-411.57 1463.81,-392.82 1371.21,-379.5"/>
<polygon fill="black" stroke="black" points="1371.61,-376.02 1361.21,-378.06 1370.61,-382.95 1371.61,-376.02"/>
</g>
<!-- layer_15_experts_gpu7&#45;&gt;layer_15_expert_comm -->
<g id="edge446" class="edge">
<title>layer_15_experts_gpu7&#45;&gt;layer_15_expert_comm</title>
<path fill="none" stroke="black" d="M1936.33,-432.9C1933.53,-432.42 1930.75,-431.96 1928,-431.52 1743.3,-402.24 1529.2,-382.32 1386.9,-371.03"/>
<polygon fill="black" stroke="black" points="1387.02,-367.53 1376.78,-370.23 1386.47,-374.51 1387.02,-367.53"/>
</g>
<!-- layer_15_moe_out -->
<g id="node320" class="node">
<title>layer_15_moe_out</title>
<polygon fill="lightyellow" stroke="black" points="1457.24,-285.98 1092.57,-285.98 998.76,-181.98 1363.43,-181.98 1457.24,-285.98"/>
<text text-anchor="middle" x="1228" y="-247.98" font-family="Arial" font-size="10.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="1228" y="-236.98" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1228" y="-225.98" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 2048]</text>
<text text-anchor="middle" x="1228" y="-214.98" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_15_expert_comm&#45;&gt;layer_15_moe_out -->
<g id="edge447" class="edge">
<title>layer_15_expert_comm&#45;&gt;layer_15_moe_out</title>
<path fill="none" stroke="black" d="M1228,-321.91C1228,-313.87 1228,-305.13 1228,-296.38"/>
<polygon fill="black" stroke="black" points="1231.5,-296.15 1228,-286.15 1224.5,-296.15 1231.5,-296.15"/>
</g>
<!-- layer_15_norm -->
<g id="node321" class="node">
<title>layer_15_norm</title>
<polygon fill="lightgreen" stroke="black" points="1338.5,-145.98 1117.5,-145.98 1117.5,-93.98 1338.5,-93.98 1338.5,-145.98"/>
<text text-anchor="middle" x="1228" y="-133.98" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="1228" y="-122.98" font-family="Arial" font-size="10.00">GPUs 6&#45;7</text>
<text text-anchor="middle" x="1228" y="-111.98" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, 1024]</text>
<text text-anchor="middle" x="1228" y="-100.98" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, 1024]</text>
</g>
<!-- layer_15_moe_out&#45;&gt;layer_15_norm -->
<g id="edge448" class="edge">
<title>layer_15_moe_out&#45;&gt;layer_15_norm</title>
<path fill="none" stroke="black" d="M1228,-181.9C1228,-173.23 1228,-164.41 1228,-156.27"/>
<polygon fill="black" stroke="black" points="1231.5,-156.03 1228,-146.03 1224.5,-156.03 1231.5,-156.03"/>
</g>
<!-- output_1 -->
<g id="node322" class="node">
<title>output_1</title>
<ellipse fill="lightblue" stroke="black" cx="1228" cy="-28.99" rx="180.12" ry="28.98"/>
<text text-anchor="middle" x="1228" y="-37.49" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="1228" y="-26.49" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1228" y="-15.49" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- layer_15_norm&#45;&gt;output_1 -->
<g id="edge449" class="edge">
<title>layer_15_norm&#45;&gt;output_1</title>
<path fill="none" stroke="black" d="M1228,-93.72C1228,-85.83 1228,-76.94 1228,-68.36"/>
<polygon fill="black" stroke="black" points="1231.5,-68.13 1228,-58.13 1224.5,-68.13 1231.5,-68.13"/>
</g>
</g>
</svg>
