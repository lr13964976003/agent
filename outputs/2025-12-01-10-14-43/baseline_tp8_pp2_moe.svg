<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="272pt" height="2880pt"
 viewBox="0.00 0.00 272.08 2880.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.1 0.1) rotate(0) translate(4 30079.28)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-30079.28 2838,-30079.28 2838,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0_layer0</title>
<path fill="lightgray" stroke="black" d="M20,-28119.61C20,-28119.61 2698,-28119.61 2698,-28119.61 2704,-28119.61 2710,-28125.61 2710,-28131.61 2710,-28131.61 2710,-29959.11 2710,-29959.11 2710,-29965.11 2704,-29971.11 2698,-29971.11 2698,-29971.11 20,-29971.11 20,-29971.11 14,-29971.11 8,-29965.11 8,-29959.11 8,-29959.11 8,-28131.61 8,-28131.61 8,-28125.61 14,-28119.61 20,-28119.61"/>
<text text-anchor="middle" x="1359" y="-29955.91" font-family="Times,serif" font-size="14.00">Pipeline Stage 0, Layer 0</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage0_layer1</title>
<path fill="lightgray" stroke="black" d="M20,-26260.11C20,-26260.11 2698,-26260.11 2698,-26260.11 2704,-26260.11 2710,-26266.11 2710,-26272.11 2710,-26272.11 2710,-28099.61 2710,-28099.61 2710,-28105.61 2704,-28111.61 2698,-28111.61 2698,-28111.61 20,-28111.61 20,-28111.61 14,-28111.61 8,-28105.61 8,-28099.61 8,-28099.61 8,-26272.11 8,-26272.11 8,-26266.11 14,-26260.11 20,-26260.11"/>
<text text-anchor="middle" x="1359" y="-28096.41" font-family="Times,serif" font-size="14.00">Pipeline Stage 0, Layer 1</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_stage0_layer2</title>
<path fill="lightgray" stroke="black" d="M20,-24400.61C20,-24400.61 2698,-24400.61 2698,-24400.61 2704,-24400.61 2710,-24406.61 2710,-24412.61 2710,-24412.61 2710,-26240.11 2710,-26240.11 2710,-26246.11 2704,-26252.11 2698,-26252.11 2698,-26252.11 20,-26252.11 20,-26252.11 14,-26252.11 8,-26246.11 8,-26240.11 8,-26240.11 8,-24412.61 8,-24412.61 8,-24406.61 14,-24400.61 20,-24400.61"/>
<text text-anchor="middle" x="1359" y="-26236.91" font-family="Times,serif" font-size="14.00">Pipeline Stage 0, Layer 2</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage0_layer3</title>
<path fill="lightgray" stroke="black" d="M20,-22541.11C20,-22541.11 2698,-22541.11 2698,-22541.11 2704,-22541.11 2710,-22547.11 2710,-22553.11 2710,-22553.11 2710,-24380.61 2710,-24380.61 2710,-24386.61 2704,-24392.61 2698,-24392.61 2698,-24392.61 20,-24392.61 20,-24392.61 14,-24392.61 8,-24386.61 8,-24380.61 8,-24380.61 8,-22553.11 8,-22553.11 8,-22547.11 14,-22541.11 20,-22541.11"/>
<text text-anchor="middle" x="1359" y="-24377.41" font-family="Times,serif" font-size="14.00">Pipeline Stage 0, Layer 3</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_stage0_layer4</title>
<path fill="lightgray" stroke="black" d="M20,-20681.62C20,-20681.62 2698,-20681.62 2698,-20681.62 2704,-20681.62 2710,-20687.62 2710,-20693.62 2710,-20693.62 2710,-22521.11 2710,-22521.11 2710,-22527.11 2704,-22533.11 2698,-22533.11 2698,-22533.11 20,-22533.11 20,-22533.11 14,-22533.11 8,-22527.11 8,-22521.11 8,-22521.11 8,-20693.62 8,-20693.62 8,-20687.62 14,-20681.62 20,-20681.62"/>
<text text-anchor="middle" x="1359" y="-22517.91" font-family="Times,serif" font-size="14.00">Pipeline Stage 0, Layer 4</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_stage0_layer5</title>
<path fill="lightgray" stroke="black" d="M20,-18822.12C20,-18822.12 2698,-18822.12 2698,-18822.12 2704,-18822.12 2710,-18828.12 2710,-18834.12 2710,-18834.12 2710,-20661.62 2710,-20661.62 2710,-20667.62 2704,-20673.62 2698,-20673.62 2698,-20673.62 20,-20673.62 20,-20673.62 14,-20673.62 8,-20667.62 8,-20661.62 8,-20661.62 8,-18834.12 8,-18834.12 8,-18828.12 14,-18822.12 20,-18822.12"/>
<text text-anchor="middle" x="1359" y="-20658.42" font-family="Times,serif" font-size="14.00">Pipeline Stage 0, Layer 5</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_stage0_layer6</title>
<path fill="lightgray" stroke="black" d="M20,-16962.62C20,-16962.62 2698,-16962.62 2698,-16962.62 2704,-16962.62 2710,-16968.62 2710,-16974.62 2710,-16974.62 2710,-18802.12 2710,-18802.12 2710,-18808.12 2704,-18814.12 2698,-18814.12 2698,-18814.12 20,-18814.12 20,-18814.12 14,-18814.12 8,-18808.12 8,-18802.12 8,-18802.12 8,-16974.62 8,-16974.62 8,-16968.62 14,-16962.62 20,-16962.62"/>
<text text-anchor="middle" x="1359" y="-18798.92" font-family="Times,serif" font-size="14.00">Pipeline Stage 0, Layer 6</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_stage0_layer7</title>
<path fill="lightgray" stroke="black" d="M78,-15103.12C78,-15103.12 2756,-15103.12 2756,-15103.12 2762,-15103.12 2768,-15109.12 2768,-15115.12 2768,-15115.12 2768,-16942.62 2768,-16942.62 2768,-16948.62 2762,-16954.62 2756,-16954.62 2756,-16954.62 78,-16954.62 78,-16954.62 72,-16954.62 66,-16948.62 66,-16942.62 66,-16942.62 66,-15115.12 66,-15115.12 66,-15109.12 72,-15103.12 78,-15103.12"/>
<text text-anchor="middle" x="1417" y="-16939.42" font-family="Times,serif" font-size="14.00">Pipeline Stage 0, Layer 7</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_stage1_layer0</title>
<path fill="lightgray" stroke="black" d="M20,-13140.66C20,-13140.66 2698,-13140.66 2698,-13140.66 2704,-13140.66 2710,-13146.66 2710,-13152.66 2710,-13152.66 2710,-14980.16 2710,-14980.16 2710,-14986.16 2704,-14992.16 2698,-14992.16 2698,-14992.16 20,-14992.16 20,-14992.16 14,-14992.16 8,-14986.16 8,-14980.16 8,-14980.16 8,-13152.66 8,-13152.66 8,-13146.66 14,-13140.66 20,-13140.66"/>
<text text-anchor="middle" x="1359" y="-14976.96" font-family="Times,serif" font-size="14.00">Pipeline Stage 1, Layer 8</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_stage1_layer1</title>
<path fill="lightgray" stroke="black" d="M20,-11281.16C20,-11281.16 2698,-11281.16 2698,-11281.16 2704,-11281.16 2710,-11287.16 2710,-11293.16 2710,-11293.16 2710,-13120.66 2710,-13120.66 2710,-13126.66 2704,-13132.66 2698,-13132.66 2698,-13132.66 20,-13132.66 20,-13132.66 14,-13132.66 8,-13126.66 8,-13120.66 8,-13120.66 8,-11293.16 8,-11293.16 8,-11287.16 14,-11281.16 20,-11281.16"/>
<text text-anchor="middle" x="1359" y="-13117.46" font-family="Times,serif" font-size="14.00">Pipeline Stage 1, Layer 9</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_stage1_layer2</title>
<path fill="lightgray" stroke="black" d="M20,-9421.66C20,-9421.66 2698,-9421.66 2698,-9421.66 2704,-9421.66 2710,-9427.66 2710,-9433.66 2710,-9433.66 2710,-11261.16 2710,-11261.16 2710,-11267.16 2704,-11273.16 2698,-11273.16 2698,-11273.16 20,-11273.16 20,-11273.16 14,-11273.16 8,-11267.16 8,-11261.16 8,-11261.16 8,-9433.66 8,-9433.66 8,-9427.66 14,-9421.66 20,-9421.66"/>
<text text-anchor="middle" x="1359" y="-11257.96" font-family="Times,serif" font-size="14.00">Pipeline Stage 1, Layer 10</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_stage1_layer3</title>
<path fill="lightgray" stroke="black" d="M20,-7562.16C20,-7562.16 2698,-7562.16 2698,-7562.16 2704,-7562.16 2710,-7568.16 2710,-7574.16 2710,-7574.16 2710,-9401.66 2710,-9401.66 2710,-9407.66 2704,-9413.66 2698,-9413.66 2698,-9413.66 20,-9413.66 20,-9413.66 14,-9413.66 8,-9407.66 8,-9401.66 8,-9401.66 8,-7574.16 8,-7574.16 8,-7568.16 14,-7562.16 20,-7562.16"/>
<text text-anchor="middle" x="1359" y="-9398.46" font-family="Times,serif" font-size="14.00">Pipeline Stage 1, Layer 11</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_stage1_layer4</title>
<path fill="lightgray" stroke="black" d="M29,-5702.67C29,-5702.67 2707,-5702.67 2707,-5702.67 2713,-5702.67 2719,-5708.67 2719,-5714.67 2719,-5714.67 2719,-7542.16 2719,-7542.16 2719,-7548.16 2713,-7554.16 2707,-7554.16 2707,-7554.16 29,-7554.16 29,-7554.16 23,-7554.16 17,-7548.16 17,-7542.16 17,-7542.16 17,-5714.67 17,-5714.67 17,-5708.67 23,-5702.67 29,-5702.67"/>
<text text-anchor="middle" x="1368" y="-7538.96" font-family="Times,serif" font-size="14.00">Pipeline Stage 1, Layer 12</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_stage1_layer5</title>
<path fill="lightgray" stroke="black" d="M46,-3843.17C46,-3843.17 2724,-3843.17 2724,-3843.17 2730,-3843.17 2736,-3849.17 2736,-3855.17 2736,-3855.17 2736,-5682.67 2736,-5682.67 2736,-5688.67 2730,-5694.67 2724,-5694.67 2724,-5694.67 46,-5694.67 46,-5694.67 40,-5694.67 34,-5688.67 34,-5682.67 34,-5682.67 34,-3855.17 34,-3855.17 34,-3849.17 40,-3843.17 46,-3843.17"/>
<text text-anchor="middle" x="1385" y="-5679.47" font-family="Times,serif" font-size="14.00">Pipeline Stage 1, Layer 13</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_stage1_layer6</title>
<path fill="lightgray" stroke="black" d="M136,-1983.67C136,-1983.67 2814,-1983.67 2814,-1983.67 2820,-1983.67 2826,-1989.67 2826,-1995.67 2826,-1995.67 2826,-3823.17 2826,-3823.17 2826,-3829.17 2820,-3835.17 2814,-3835.17 2814,-3835.17 136,-3835.17 136,-3835.17 130,-3835.17 124,-3829.17 124,-3823.17 124,-3823.17 124,-1995.67 124,-1995.67 124,-1989.67 130,-1983.67 136,-1983.67"/>
<text text-anchor="middle" x="1475" y="-3819.97" font-family="Times,serif" font-size="14.00">Pipeline Stage 1, Layer 14</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_stage1_layer7</title>
<path fill="lightgray" stroke="black" d="M20,-124.17C20,-124.17 2698,-124.17 2698,-124.17 2704,-124.17 2710,-130.17 2710,-136.17 2710,-136.17 2710,-1963.67 2710,-1963.67 2710,-1969.67 2704,-1975.67 2698,-1975.67 2698,-1975.67 20,-1975.67 20,-1975.67 14,-1975.67 8,-1969.67 8,-1963.67 8,-1963.67 8,-136.17 8,-136.17 8,-130.17 14,-124.17 20,-124.17"/>
<text text-anchor="middle" x="1359" y="-1960.47" font-family="Times,serif" font-size="14.00">Pipeline Stage 1, Layer 15</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-30027.2" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-30046" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="1378" y="-30031" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-30016" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-30001" font-family="Times,serif" font-size="14.00">GPU: All</text>
</g>
<!-- stage0_layer0_layernorm -->
<g id="node2" class="node">
<title>stage0_layer0_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-29940.11 1174.5,-29940.11 1174.5,-29872.11 1581.5,-29872.11 1581.5,-29940.11"/>
<text text-anchor="middle" x="1378" y="-29924.91" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1378" y="-29909.91" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-29894.91" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-29879.91" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- input&#45;&gt;stage0_layer0_layernorm -->
<g id="edge1" class="edge">
<title>input&#45;&gt;stage0_layer0_layernorm</title>
<path fill="none" stroke="black" d="M1378,-29978.79C1378,-29969.46 1378,-29959.71 1378,-29950.52"/>
<polygon fill="black" stroke="black" points="1381.5,-29950.43 1378,-29940.43 1374.5,-29950.43 1381.5,-29950.43"/>
</g>
<!-- stage0_layer0_qkv_proj -->
<g id="node3" class="node">
<title>stage0_layer0_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-29836.11 1120.5,-29836.11 1120.5,-29768.11 1635.5,-29768.11 1635.5,-29836.11"/>
<text text-anchor="middle" x="1378" y="-29820.91" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-29805.91" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-29790.91" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-29775.91" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_layernorm&#45;&gt;stage0_layer0_qkv_proj -->
<g id="edge2" class="edge">
<title>stage0_layer0_layernorm&#45;&gt;stage0_layer0_qkv_proj</title>
<path fill="none" stroke="black" d="M1378,-29872C1378,-29863.89 1378,-29855.09 1378,-29846.59"/>
<polygon fill="black" stroke="black" points="1381.5,-29846.41 1378,-29836.41 1374.5,-29846.41 1381.5,-29846.41"/>
</g>
<!-- stage0_layer0_qkv_gather -->
<g id="node4" class="node">
<title>stage0_layer0_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-29684.03" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-29702.83" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1378" y="-29687.83" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1378" y="-29672.83" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-29657.83" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_qkv_proj&#45;&gt;stage0_layer0_qkv_gather -->
<g id="edge3" class="edge">
<title>stage0_layer0_qkv_proj&#45;&gt;stage0_layer0_qkv_gather</title>
<path fill="none" stroke="black" d="M1378,-29767.85C1378,-29759.85 1378,-29751.09 1378,-29742.35"/>
<polygon fill="black" stroke="black" points="1381.5,-29742.14 1378,-29732.14 1374.5,-29742.14 1381.5,-29742.14"/>
</g>
<!-- stage0_layer0_attention -->
<g id="node5" class="node">
<title>stage0_layer0_attention</title>
<polygon fill="lightgreen" stroke="black" points="1629.5,-29599.95 1126.5,-29599.95 1126.5,-29531.95 1629.5,-29531.95 1629.5,-29599.95"/>
<text text-anchor="middle" x="1378" y="-29584.75" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1378" y="-29569.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-29554.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-29539.75" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_qkv_gather&#45;&gt;stage0_layer0_attention -->
<g id="edge4" class="edge">
<title>stage0_layer0_qkv_gather&#45;&gt;stage0_layer0_attention</title>
<path fill="none" stroke="black" d="M1378,-29635.81C1378,-29627.43 1378,-29618.73 1378,-29610.45"/>
<polygon fill="black" stroke="black" points="1381.5,-29610.25 1378,-29600.25 1374.5,-29610.25 1381.5,-29610.25"/>
</g>
<!-- stage0_layer0_attn_out -->
<g id="node6" class="node">
<title>stage0_layer0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1616.5,-29495.95 1139.5,-29495.95 1139.5,-29427.95 1616.5,-29427.95 1616.5,-29495.95"/>
<text text-anchor="middle" x="1378" y="-29480.75" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-29465.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-29450.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-29435.75" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_attention&#45;&gt;stage0_layer0_attn_out -->
<g id="edge5" class="edge">
<title>stage0_layer0_attention&#45;&gt;stage0_layer0_attn_out</title>
<path fill="none" stroke="black" d="M1378,-29531.83C1378,-29523.72 1378,-29514.93 1378,-29506.42"/>
<polygon fill="black" stroke="black" points="1381.5,-29506.25 1378,-29496.25 1374.5,-29506.25 1381.5,-29506.25"/>
</g>
<!-- stage0_layer0_attn_reduce -->
<g id="node7" class="node">
<title>stage0_layer0_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-29343.86" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-29362.66" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1378" y="-29347.66" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-29332.66" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-29317.66" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_attn_out&#45;&gt;stage0_layer0_attn_reduce -->
<g id="edge6" class="edge">
<title>stage0_layer0_attn_out&#45;&gt;stage0_layer0_attn_reduce</title>
<path fill="none" stroke="black" d="M1378,-29427.68C1378,-29419.69 1378,-29410.92 1378,-29402.18"/>
<polygon fill="black" stroke="black" points="1381.5,-29401.97 1378,-29391.97 1374.5,-29401.97 1381.5,-29401.97"/>
</g>
<!-- stage0_layer0_residual1 -->
<g id="node8" class="node">
<title>stage0_layer0_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-29259.78 1116.35,-29259.78 935.11,-29123.78 1639.65,-29123.78 1820.89,-29259.78"/>
<text text-anchor="middle" x="1378" y="-29210.58" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1378" y="-29195.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-29180.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-29165.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_attn_reduce&#45;&gt;stage0_layer0_residual1 -->
<g id="edge7" class="edge">
<title>stage0_layer0_attn_reduce&#45;&gt;stage0_layer0_residual1</title>
<path fill="none" stroke="black" d="M1378,-29295.38C1378,-29287.29 1378,-29278.71 1378,-29270.09"/>
<polygon fill="black" stroke="black" points="1381.5,-29269.97 1378,-29259.97 1374.5,-29269.97 1381.5,-29269.97"/>
</g>
<!-- stage0_layer0_layernorm2 -->
<g id="node9" class="node">
<title>stage0_layer0_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-29087.78 1174.5,-29087.78 1174.5,-29019.78 1581.5,-29019.78 1581.5,-29087.78"/>
<text text-anchor="middle" x="1378" y="-29072.58" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1378" y="-29057.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-29042.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-29027.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_residual1&#45;&gt;stage0_layer0_layernorm2 -->
<g id="edge8" class="edge">
<title>stage0_layer0_residual1&#45;&gt;stage0_layer0_layernorm2</title>
<path fill="none" stroke="black" d="M1378,-29123.58C1378,-29114.82 1378,-29106.06 1378,-29097.85"/>
<polygon fill="black" stroke="black" points="1381.5,-29097.8 1378,-29087.8 1374.5,-29097.8 1381.5,-29097.8"/>
</g>
<!-- stage0_layer0_expert0_gate -->
<g id="node10" class="node">
<title>stage0_layer0_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="805.5,-28983.78 382.5,-28983.78 382.5,-28915.78 805.5,-28915.78 805.5,-28983.78"/>
<text text-anchor="middle" x="594" y="-28968.58" font-family="Times,serif" font-size="14.00">Expert Gate 0</text>
<text text-anchor="middle" x="594" y="-28953.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="594" y="-28938.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="594" y="-28923.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_layernorm2&#45;&gt;stage0_layer0_expert0_gate -->
<g id="edge9" class="edge">
<title>stage0_layer0_layernorm2&#45;&gt;stage0_layer0_expert0_gate</title>
<path fill="none" stroke="black" d="M1174.32,-29026.28C1064.32,-29011.97 928.38,-28994.28 815.73,-28979.63"/>
<polygon fill="black" stroke="black" points="815.96,-28976.13 805.6,-28978.31 815.06,-28983.07 815.96,-28976.13"/>
</g>
<!-- stage0_layer0_expert1_gate -->
<g id="node15" class="node">
<title>stage0_layer0_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1363.5,-28983.78 940.5,-28983.78 940.5,-28915.78 1363.5,-28915.78 1363.5,-28983.78"/>
<text text-anchor="middle" x="1152" y="-28968.58" font-family="Times,serif" font-size="14.00">Expert Gate 1</text>
<text text-anchor="middle" x="1152" y="-28953.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1152" y="-28938.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1152" y="-28923.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_layernorm2&#45;&gt;stage0_layer0_expert1_gate -->
<g id="edge15" class="edge">
<title>stage0_layer0_layernorm2&#45;&gt;stage0_layer0_expert1_gate</title>
<path fill="none" stroke="black" d="M1304.62,-29019.66C1282.31,-29009.59 1257.63,-28998.45 1234.74,-28988.12"/>
<polygon fill="black" stroke="black" points="1235.95,-28984.83 1225.39,-28983.9 1233.07,-28991.21 1235.95,-28984.83"/>
</g>
<!-- stage0_layer0_expert2_gate -->
<g id="node20" class="node">
<title>stage0_layer0_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1816.5,-28983.78 1393.5,-28983.78 1393.5,-28915.78 1816.5,-28915.78 1816.5,-28983.78"/>
<text text-anchor="middle" x="1605" y="-28968.58" font-family="Times,serif" font-size="14.00">Expert Gate 2</text>
<text text-anchor="middle" x="1605" y="-28953.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1605" y="-28938.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1605" y="-28923.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_layernorm2&#45;&gt;stage0_layer0_expert2_gate -->
<g id="edge21" class="edge">
<title>stage0_layer0_layernorm2&#45;&gt;stage0_layer0_expert2_gate</title>
<path fill="none" stroke="black" d="M1451.7,-29019.66C1474.12,-29009.59 1498.9,-28998.45 1521.89,-28988.12"/>
<polygon fill="black" stroke="black" points="1523.59,-28991.2 1531.28,-28983.9 1520.73,-28984.81 1523.59,-28991.2"/>
</g>
<!-- stage0_layer0_expert3_gate -->
<g id="node25" class="node">
<title>stage0_layer0_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2275.5,-28983.78 1852.5,-28983.78 1852.5,-28915.78 2275.5,-28915.78 2275.5,-28983.78"/>
<text text-anchor="middle" x="2064" y="-28968.58" font-family="Times,serif" font-size="14.00">Expert Gate 3</text>
<text text-anchor="middle" x="2064" y="-28953.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2064" y="-28938.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2064" y="-28923.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_layernorm2&#45;&gt;stage0_layer0_expert3_gate -->
<g id="edge27" class="edge">
<title>stage0_layer0_layernorm2&#45;&gt;stage0_layer0_expert3_gate</title>
<path fill="none" stroke="black" d="M1581.5,-29022.52C1663.58,-29010.32 1758.5,-28996.2 1842.32,-28983.74"/>
<polygon fill="black" stroke="black" points="1842.84,-28987.2 1852.22,-28982.27 1841.82,-28980.28 1842.84,-28987.2"/>
</g>
<!-- stage0_layer0_expert0_mlp1 -->
<g id="node11" class="node">
<title>stage0_layer0_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="761.5,-28879.78 314.5,-28879.78 314.5,-28811.78 761.5,-28811.78 761.5,-28879.78"/>
<text text-anchor="middle" x="538" y="-28864.58" font-family="Times,serif" font-size="14.00">Expert 0 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="538" y="-28849.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="538" y="-28834.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="538" y="-28819.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert0_gate&#45;&gt;stage0_layer0_expert0_mlp1 -->
<g id="edge10" class="edge">
<title>stage0_layer0_expert0_gate&#45;&gt;stage0_layer0_expert0_mlp1</title>
<path fill="none" stroke="black" d="M575.82,-28915.66C571.12,-28907.11 566.01,-28897.79 561.1,-28888.85"/>
<polygon fill="black" stroke="black" points="564.16,-28887.16 556.28,-28880.08 558.03,-28890.53 564.16,-28887.16"/>
</g>
<!-- stage0_layer0_expert0_act -->
<g id="node12" class="node">
<title>stage0_layer0_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="715.5,-28775.78 268.5,-28775.78 268.5,-28707.78 715.5,-28707.78 715.5,-28775.78"/>
<text text-anchor="middle" x="492" y="-28760.58" font-family="Times,serif" font-size="14.00">Expert 0 Activation</text>
<text text-anchor="middle" x="492" y="-28745.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="492" y="-28730.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="492" y="-28715.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert0_mlp1&#45;&gt;stage0_layer0_expert0_act -->
<g id="edge11" class="edge">
<title>stage0_layer0_expert0_mlp1&#45;&gt;stage0_layer0_expert0_act</title>
<path fill="none" stroke="black" d="M523.07,-28811.66C519.29,-28803.29 515.18,-28794.18 511.23,-28785.41"/>
<polygon fill="black" stroke="black" points="514.32,-28783.76 507.02,-28776.08 507.94,-28786.63 514.32,-28783.76"/>
</g>
<!-- stage0_layer0_expert0_mlp2 -->
<g id="node13" class="node">
<title>stage0_layer0_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="664.5,-28671.78 187.5,-28671.78 187.5,-28603.78 664.5,-28603.78 664.5,-28671.78"/>
<text text-anchor="middle" x="426" y="-28656.58" font-family="Times,serif" font-size="14.00">Expert 0 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="426" y="-28641.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="426" y="-28626.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="426" y="-28611.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert0_act&#45;&gt;stage0_layer0_expert0_mlp2 -->
<g id="edge12" class="edge">
<title>stage0_layer0_expert0_act&#45;&gt;stage0_layer0_expert0_mlp2</title>
<path fill="none" stroke="black" d="M470.57,-28707.66C464.98,-28699.02 458.88,-28689.6 453.04,-28680.57"/>
<polygon fill="black" stroke="black" points="455.92,-28678.57 447.55,-28672.08 450.04,-28682.38 455.92,-28678.57"/>
</g>
<!-- stage0_layer0_expert0_reduce -->
<g id="node14" class="node">
<title>stage0_layer0_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-28519.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-28538.5" font-family="Times,serif" font-size="14.00">Expert 0 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-28523.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-28508.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-28493.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert0_mlp2&#45;&gt;stage0_layer0_expert0_reduce -->
<g id="edge13" class="edge">
<title>stage0_layer0_expert0_mlp2&#45;&gt;stage0_layer0_expert0_reduce</title>
<path fill="none" stroke="black" d="M402.79,-28603.52C396.79,-28594.91 390.16,-28585.42 383.6,-28576.02"/>
<polygon fill="black" stroke="black" points="386.46,-28574 377.87,-28567.81 380.72,-28578.01 386.46,-28574"/>
</g>
<!-- stage0_layer0_expert_agg -->
<g id="node30" class="node">
<title>stage0_layer0_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-28435.61 1116.35,-28435.61 935.11,-28299.61 1639.65,-28299.61 1820.89,-28435.61"/>
<text text-anchor="middle" x="1378" y="-28386.41" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1378" y="-28371.41" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1378" y="-28356.41" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-28341.41" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert0_reduce&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge14" class="edge">
<title>stage0_layer0_expert0_reduce&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M574.9,-28485.3C721.93,-28463.93 914.31,-28435.98 1073.92,-28412.79"/>
<polygon fill="black" stroke="black" points="1074.51,-28416.24 1083.9,-28411.34 1073.5,-28409.32 1074.51,-28416.24"/>
</g>
<!-- stage0_layer0_expert1_mlp1 -->
<g id="node16" class="node">
<title>stage0_layer0_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1366.5,-28879.78 919.5,-28879.78 919.5,-28811.78 1366.5,-28811.78 1366.5,-28879.78"/>
<text text-anchor="middle" x="1143" y="-28864.58" font-family="Times,serif" font-size="14.00">Expert 1 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1143" y="-28849.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1143" y="-28834.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1143" y="-28819.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert1_gate&#45;&gt;stage0_layer0_expert1_mlp1 -->
<g id="edge16" class="edge">
<title>stage0_layer0_expert1_gate&#45;&gt;stage0_layer0_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1149.08,-28915.66C1148.36,-28907.56 1147.59,-28898.76 1146.84,-28890.25"/>
<polygon fill="black" stroke="black" points="1150.3,-28889.73 1145.94,-28880.08 1143.33,-28890.35 1150.3,-28889.73"/>
</g>
<!-- stage0_layer0_expert1_act -->
<g id="node17" class="node">
<title>stage0_layer0_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1340.5,-28775.78 893.5,-28775.78 893.5,-28707.78 1340.5,-28707.78 1340.5,-28775.78"/>
<text text-anchor="middle" x="1117" y="-28760.58" font-family="Times,serif" font-size="14.00">Expert 1 Activation</text>
<text text-anchor="middle" x="1117" y="-28745.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-28730.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-28715.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert1_mlp1&#45;&gt;stage0_layer0_expert1_act -->
<g id="edge17" class="edge">
<title>stage0_layer0_expert1_mlp1&#45;&gt;stage0_layer0_expert1_act</title>
<path fill="none" stroke="black" d="M1134.56,-28811.66C1132.47,-28803.47 1130.2,-28794.57 1128.01,-28785.97"/>
<polygon fill="black" stroke="black" points="1131.35,-28784.9 1125.49,-28776.08 1124.57,-28786.63 1131.35,-28784.9"/>
</g>
<!-- stage0_layer0_expert1_mlp2 -->
<g id="node18" class="node">
<title>stage0_layer0_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-28671.78 827.5,-28671.78 827.5,-28603.78 1304.5,-28603.78 1304.5,-28671.78"/>
<text text-anchor="middle" x="1066" y="-28656.58" font-family="Times,serif" font-size="14.00">Expert 1 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-28641.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-28626.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-28611.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert1_act&#45;&gt;stage0_layer0_expert1_mlp2 -->
<g id="edge18" class="edge">
<title>stage0_layer0_expert1_act&#45;&gt;stage0_layer0_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1100.44,-28707.66C1096.21,-28699.2 1091.6,-28689.99 1087.18,-28681.13"/>
<polygon fill="black" stroke="black" points="1090.25,-28679.46 1082.65,-28672.08 1083.99,-28682.59 1090.25,-28679.46"/>
</g>
<!-- stage0_layer0_expert1_reduce -->
<g id="node19" class="node">
<title>stage0_layer0_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-28519.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-28538.5" font-family="Times,serif" font-size="14.00">Expert 1 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-28523.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-28508.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-28493.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert1_mlp2&#45;&gt;stage0_layer0_expert1_reduce -->
<g id="edge19" class="edge">
<title>stage0_layer0_expert1_mlp2&#45;&gt;stage0_layer0_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.1,-28603.52C1049.91,-28595.26 1046.39,-28586.18 1042.89,-28577.16"/>
<polygon fill="black" stroke="black" points="1046.14,-28575.87 1039.26,-28567.81 1039.61,-28578.4 1046.14,-28575.87"/>
</g>
<!-- stage0_layer0_expert1_reduce&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge20" class="edge">
<title>stage0_layer0_expert1_reduce&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M1127.15,-28474.07C1152.91,-28463.24 1181.09,-28451.4 1208.96,-28439.68"/>
<polygon fill="black" stroke="black" points="1210.53,-28442.81 1218.39,-28435.71 1207.82,-28436.36 1210.53,-28442.81"/>
</g>
<!-- stage0_layer0_expert2_mlp1 -->
<g id="node21" class="node">
<title>stage0_layer0_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1838.5,-28879.78 1391.5,-28879.78 1391.5,-28811.78 1838.5,-28811.78 1838.5,-28879.78"/>
<text text-anchor="middle" x="1615" y="-28864.58" font-family="Times,serif" font-size="14.00">Expert 2 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1615" y="-28849.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1615" y="-28834.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1615" y="-28819.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert2_gate&#45;&gt;stage0_layer0_expert2_mlp1 -->
<g id="edge22" class="edge">
<title>stage0_layer0_expert2_gate&#45;&gt;stage0_layer0_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1608.25,-28915.66C1609.04,-28907.56 1609.9,-28898.76 1610.74,-28890.25"/>
<polygon fill="black" stroke="black" points="1614.24,-28890.37 1611.74,-28880.08 1607.28,-28889.69 1614.24,-28890.37"/>
</g>
<!-- stage0_layer0_expert2_act -->
<g id="node22" class="node">
<title>stage0_layer0_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1848.5,-28775.78 1401.5,-28775.78 1401.5,-28707.78 1848.5,-28707.78 1848.5,-28775.78"/>
<text text-anchor="middle" x="1625" y="-28760.58" font-family="Times,serif" font-size="14.00">Expert 2 Activation</text>
<text text-anchor="middle" x="1625" y="-28745.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-28730.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-28715.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert2_mlp1&#45;&gt;stage0_layer0_expert2_act -->
<g id="edge23" class="edge">
<title>stage0_layer0_expert2_mlp1&#45;&gt;stage0_layer0_expert2_act</title>
<path fill="none" stroke="black" d="M1618.25,-28811.66C1619.04,-28803.56 1619.9,-28794.76 1620.74,-28786.25"/>
<polygon fill="black" stroke="black" points="1624.24,-28786.37 1621.74,-28776.08 1617.28,-28785.69 1624.24,-28786.37"/>
</g>
<!-- stage0_layer0_expert2_mlp2 -->
<g id="node23" class="node">
<title>stage0_layer0_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1889.5,-28671.78 1412.5,-28671.78 1412.5,-28603.78 1889.5,-28603.78 1889.5,-28671.78"/>
<text text-anchor="middle" x="1651" y="-28656.58" font-family="Times,serif" font-size="14.00">Expert 2 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1651" y="-28641.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1651" y="-28626.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1651" y="-28611.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert2_act&#45;&gt;stage0_layer0_expert2_mlp2 -->
<g id="edge24" class="edge">
<title>stage0_layer0_expert2_act&#45;&gt;stage0_layer0_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1633.44,-28707.66C1635.53,-28699.47 1637.8,-28690.57 1639.99,-28681.97"/>
<polygon fill="black" stroke="black" points="1643.43,-28682.63 1642.51,-28672.08 1636.65,-28680.9 1643.43,-28682.63"/>
</g>
<!-- stage0_layer0_expert2_reduce -->
<g id="node24" class="node">
<title>stage0_layer0_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-28519.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-28538.5" font-family="Times,serif" font-size="14.00">Expert 2 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-28523.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-28508.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-28493.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert2_mlp2&#45;&gt;stage0_layer0_expert2_reduce -->
<g id="edge25" class="edge">
<title>stage0_layer0_expert2_mlp2&#45;&gt;stage0_layer0_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.18,-28603.52C1667.45,-28595.26 1671.05,-28586.18 1674.63,-28577.16"/>
<polygon fill="black" stroke="black" points="1677.9,-28578.39 1678.33,-28567.81 1671.39,-28575.81 1677.9,-28578.39"/>
</g>
<!-- stage0_layer0_expert2_reduce&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge26" class="edge">
<title>stage0_layer0_expert2_reduce&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M1601.29,-28473.67C1578.75,-28463.06 1554.18,-28451.5 1529.84,-28440.05"/>
<polygon fill="black" stroke="black" points="1531.07,-28436.76 1520.53,-28435.67 1528.09,-28443.1 1531.07,-28436.76"/>
</g>
<!-- stage0_layer0_expert3_mlp1 -->
<g id="node26" class="node">
<title>stage0_layer0_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2307.5,-28879.78 1860.5,-28879.78 1860.5,-28811.78 2307.5,-28811.78 2307.5,-28879.78"/>
<text text-anchor="middle" x="2084" y="-28864.58" font-family="Times,serif" font-size="14.00">Expert 3 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2084" y="-28849.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2084" y="-28834.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2084" y="-28819.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert3_gate&#45;&gt;stage0_layer0_expert3_mlp1 -->
<g id="edge28" class="edge">
<title>stage0_layer0_expert3_gate&#45;&gt;stage0_layer0_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2070.49,-28915.66C2072.1,-28907.47 2073.85,-28898.57 2075.53,-28889.97"/>
<polygon fill="black" stroke="black" points="2078.98,-28890.57 2077.47,-28880.08 2072.11,-28889.22 2078.98,-28890.57"/>
</g>
<!-- stage0_layer0_expert3_act -->
<g id="node27" class="node">
<title>stage0_layer0_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2322.5,-28775.78 1875.5,-28775.78 1875.5,-28707.78 2322.5,-28707.78 2322.5,-28775.78"/>
<text text-anchor="middle" x="2099" y="-28760.58" font-family="Times,serif" font-size="14.00">Expert 3 Activation</text>
<text text-anchor="middle" x="2099" y="-28745.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-28730.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-28715.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert3_mlp1&#45;&gt;stage0_layer0_expert3_act -->
<g id="edge29" class="edge">
<title>stage0_layer0_expert3_mlp1&#45;&gt;stage0_layer0_expert3_act</title>
<path fill="none" stroke="black" d="M2088.87,-28811.66C2090.06,-28803.56 2091.36,-28794.76 2092.61,-28786.25"/>
<polygon fill="black" stroke="black" points="2096.11,-28786.48 2094.1,-28776.08 2089.19,-28785.46 2096.11,-28786.48"/>
</g>
<!-- stage0_layer0_expert3_mlp2 -->
<g id="node28" class="node">
<title>stage0_layer0_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2520.5,-28671.78 2043.5,-28671.78 2043.5,-28603.78 2520.5,-28603.78 2520.5,-28671.78"/>
<text text-anchor="middle" x="2282" y="-28656.58" font-family="Times,serif" font-size="14.00">Expert 3 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2282" y="-28641.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2282" y="-28626.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2282" y="-28611.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert3_act&#45;&gt;stage0_layer0_expert3_mlp2 -->
<g id="edge30" class="edge">
<title>stage0_layer0_expert3_act&#45;&gt;stage0_layer0_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2158.41,-28707.66C2176.08,-28697.82 2195.58,-28686.95 2213.76,-28676.81"/>
<polygon fill="black" stroke="black" points="2215.54,-28679.83 2222.57,-28671.9 2212.13,-28673.72 2215.54,-28679.83"/>
</g>
<!-- stage0_layer0_expert3_reduce -->
<g id="node29" class="node">
<title>stage0_layer0_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-28519.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-28538.5" font-family="Times,serif" font-size="14.00">Expert 3 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-28523.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-28508.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-28493.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert3_mlp2&#45;&gt;stage0_layer0_expert3_reduce -->
<g id="edge31" class="edge">
<title>stage0_layer0_expert3_mlp2&#45;&gt;stage0_layer0_expert3_reduce</title>
<path fill="none" stroke="black" d="M2308.08,-28603.52C2314.89,-28594.83 2322.41,-28585.23 2329.86,-28575.73"/>
<polygon fill="black" stroke="black" points="2332.65,-28577.84 2336.07,-28567.81 2327.15,-28573.52 2332.65,-28577.84"/>
</g>
<!-- stage0_layer0_expert3_reduce&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge32" class="edge">
<title>stage0_layer0_expert3_reduce&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M2147.53,-28484.69C2053.41,-28470.49 1940.53,-28453.46 1830.59,-28436.88"/>
<polygon fill="black" stroke="black" points="1831.06,-28433.41 1820.65,-28435.38 1830.02,-28440.33 1831.06,-28433.41"/>
</g>
<!-- stage0_layer0_residual2 -->
<g id="node31" class="node">
<title>stage0_layer0_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-28263.61 1116.35,-28263.61 935.11,-28127.61 1639.65,-28127.61 1820.89,-28263.61"/>
<text text-anchor="middle" x="1378" y="-28214.41" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1378" y="-28199.41" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-28184.41" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-28169.41" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_expert_agg&#45;&gt;stage0_layer0_residual2 -->
<g id="edge33" class="edge">
<title>stage0_layer0_expert_agg&#45;&gt;stage0_layer0_residual2</title>
<path fill="none" stroke="black" d="M1378,-28299.42C1378,-28291.11 1378,-28282.56 1378,-28274.11"/>
<polygon fill="black" stroke="black" points="1381.5,-28273.87 1378,-28263.87 1374.5,-28273.87 1381.5,-28273.87"/>
</g>
<!-- stage0_layer1_layernorm -->
<g id="node32" class="node">
<title>stage0_layer1_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-28080.61 1174.5,-28080.61 1174.5,-28012.61 1581.5,-28012.61 1581.5,-28080.61"/>
<text text-anchor="middle" x="1378" y="-28065.41" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1378" y="-28050.41" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-28035.41" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-28020.41" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer0_residual2&#45;&gt;stage0_layer1_layernorm -->
<g id="edge34" class="edge">
<title>stage0_layer0_residual2&#45;&gt;stage0_layer1_layernorm</title>
<path fill="none" stroke="black" d="M1378,-28127.57C1378,-28115.16 1378,-28102.51 1378,-28091.03"/>
<polygon fill="black" stroke="black" points="1381.5,-28090.87 1378,-28080.87 1374.5,-28090.87 1381.5,-28090.87"/>
</g>
<!-- stage0_layer1_qkv_proj -->
<g id="node33" class="node">
<title>stage0_layer1_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-27976.61 1120.5,-27976.61 1120.5,-27908.61 1635.5,-27908.61 1635.5,-27976.61"/>
<text text-anchor="middle" x="1378" y="-27961.41" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-27946.41" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-27931.41" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-27916.41" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_layernorm&#45;&gt;stage0_layer1_qkv_proj -->
<g id="edge35" class="edge">
<title>stage0_layer1_layernorm&#45;&gt;stage0_layer1_qkv_proj</title>
<path fill="none" stroke="black" d="M1378,-28012.5C1378,-28004.39 1378,-27995.6 1378,-27987.09"/>
<polygon fill="black" stroke="black" points="1381.5,-27986.91 1378,-27976.91 1374.5,-27986.91 1381.5,-27986.91"/>
</g>
<!-- stage0_layer1_qkv_gather -->
<g id="node34" class="node">
<title>stage0_layer1_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-27824.53" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-27843.33" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1378" y="-27828.33" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1378" y="-27813.33" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-27798.33" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_qkv_proj&#45;&gt;stage0_layer1_qkv_gather -->
<g id="edge36" class="edge">
<title>stage0_layer1_qkv_proj&#45;&gt;stage0_layer1_qkv_gather</title>
<path fill="none" stroke="black" d="M1378,-27908.35C1378,-27900.35 1378,-27891.59 1378,-27882.85"/>
<polygon fill="black" stroke="black" points="1381.5,-27882.64 1378,-27872.64 1374.5,-27882.64 1381.5,-27882.64"/>
</g>
<!-- stage0_layer1_attention -->
<g id="node35" class="node">
<title>stage0_layer1_attention</title>
<polygon fill="lightgreen" stroke="black" points="1629.5,-27740.45 1126.5,-27740.45 1126.5,-27672.45 1629.5,-27672.45 1629.5,-27740.45"/>
<text text-anchor="middle" x="1378" y="-27725.25" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1378" y="-27710.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-27695.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-27680.25" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_qkv_gather&#45;&gt;stage0_layer1_attention -->
<g id="edge37" class="edge">
<title>stage0_layer1_qkv_gather&#45;&gt;stage0_layer1_attention</title>
<path fill="none" stroke="black" d="M1378,-27776.31C1378,-27767.93 1378,-27759.23 1378,-27750.95"/>
<polygon fill="black" stroke="black" points="1381.5,-27750.75 1378,-27740.75 1374.5,-27750.75 1381.5,-27750.75"/>
</g>
<!-- stage0_layer1_attn_out -->
<g id="node36" class="node">
<title>stage0_layer1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1616.5,-27636.45 1139.5,-27636.45 1139.5,-27568.45 1616.5,-27568.45 1616.5,-27636.45"/>
<text text-anchor="middle" x="1378" y="-27621.25" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-27606.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-27591.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-27576.25" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_attention&#45;&gt;stage0_layer1_attn_out -->
<g id="edge38" class="edge">
<title>stage0_layer1_attention&#45;&gt;stage0_layer1_attn_out</title>
<path fill="none" stroke="black" d="M1378,-27672.33C1378,-27664.22 1378,-27655.43 1378,-27646.92"/>
<polygon fill="black" stroke="black" points="1381.5,-27646.75 1378,-27636.75 1374.5,-27646.75 1381.5,-27646.75"/>
</g>
<!-- stage0_layer1_attn_reduce -->
<g id="node37" class="node">
<title>stage0_layer1_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-27484.36" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-27503.16" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1378" y="-27488.16" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-27473.16" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-27458.16" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_attn_out&#45;&gt;stage0_layer1_attn_reduce -->
<g id="edge39" class="edge">
<title>stage0_layer1_attn_out&#45;&gt;stage0_layer1_attn_reduce</title>
<path fill="none" stroke="black" d="M1378,-27568.18C1378,-27560.19 1378,-27551.42 1378,-27542.68"/>
<polygon fill="black" stroke="black" points="1381.5,-27542.47 1378,-27532.47 1374.5,-27542.47 1381.5,-27542.47"/>
</g>
<!-- stage0_layer1_residual1 -->
<g id="node38" class="node">
<title>stage0_layer1_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-27400.28 1116.35,-27400.28 935.11,-27264.28 1639.65,-27264.28 1820.89,-27400.28"/>
<text text-anchor="middle" x="1378" y="-27351.08" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1378" y="-27336.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-27321.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-27306.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_attn_reduce&#45;&gt;stage0_layer1_residual1 -->
<g id="edge40" class="edge">
<title>stage0_layer1_attn_reduce&#45;&gt;stage0_layer1_residual1</title>
<path fill="none" stroke="black" d="M1378,-27435.88C1378,-27427.79 1378,-27419.21 1378,-27410.59"/>
<polygon fill="black" stroke="black" points="1381.5,-27410.48 1378,-27400.48 1374.5,-27410.48 1381.5,-27410.48"/>
</g>
<!-- stage0_layer1_layernorm2 -->
<g id="node39" class="node">
<title>stage0_layer1_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-27228.28 1174.5,-27228.28 1174.5,-27160.28 1581.5,-27160.28 1581.5,-27228.28"/>
<text text-anchor="middle" x="1378" y="-27213.08" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1378" y="-27198.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-27183.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-27168.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_residual1&#45;&gt;stage0_layer1_layernorm2 -->
<g id="edge41" class="edge">
<title>stage0_layer1_residual1&#45;&gt;stage0_layer1_layernorm2</title>
<path fill="none" stroke="black" d="M1378,-27264.08C1378,-27255.33 1378,-27246.56 1378,-27238.35"/>
<polygon fill="black" stroke="black" points="1381.5,-27238.3 1378,-27228.3 1374.5,-27238.3 1381.5,-27238.3"/>
</g>
<!-- stage0_layer1_expert0_gate -->
<g id="node40" class="node">
<title>stage0_layer1_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="910.5,-27124.28 487.5,-27124.28 487.5,-27056.28 910.5,-27056.28 910.5,-27124.28"/>
<text text-anchor="middle" x="699" y="-27109.08" font-family="Times,serif" font-size="14.00">Expert Gate 16</text>
<text text-anchor="middle" x="699" y="-27094.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="699" y="-27079.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="699" y="-27064.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_layernorm2&#45;&gt;stage0_layer1_expert0_gate -->
<g id="edge42" class="edge">
<title>stage0_layer1_layernorm2&#45;&gt;stage0_layer1_expert0_gate</title>
<path fill="none" stroke="black" d="M1174.28,-27162.68C1094.23,-27150.65 1002.12,-27136.82 920.43,-27124.54"/>
<polygon fill="black" stroke="black" points="920.93,-27121.08 910.53,-27123.06 919.9,-27128 920.93,-27121.08"/>
</g>
<!-- stage0_layer1_expert1_gate -->
<g id="node45" class="node">
<title>stage0_layer1_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1363.5,-27124.28 940.5,-27124.28 940.5,-27056.28 1363.5,-27056.28 1363.5,-27124.28"/>
<text text-anchor="middle" x="1152" y="-27109.08" font-family="Times,serif" font-size="14.00">Expert Gate 17</text>
<text text-anchor="middle" x="1152" y="-27094.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1152" y="-27079.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1152" y="-27064.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_layernorm2&#45;&gt;stage0_layer1_expert1_gate -->
<g id="edge48" class="edge">
<title>stage0_layer1_layernorm2&#45;&gt;stage0_layer1_expert1_gate</title>
<path fill="none" stroke="black" d="M1304.62,-27160.16C1282.31,-27150.09 1257.63,-27138.95 1234.74,-27128.62"/>
<polygon fill="black" stroke="black" points="1235.95,-27125.33 1225.39,-27124.41 1233.07,-27131.71 1235.95,-27125.33"/>
</g>
<!-- stage0_layer1_expert2_gate -->
<g id="node50" class="node">
<title>stage0_layer1_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1816.5,-27124.28 1393.5,-27124.28 1393.5,-27056.28 1816.5,-27056.28 1816.5,-27124.28"/>
<text text-anchor="middle" x="1605" y="-27109.08" font-family="Times,serif" font-size="14.00">Expert Gate 18</text>
<text text-anchor="middle" x="1605" y="-27094.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1605" y="-27079.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1605" y="-27064.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_layernorm2&#45;&gt;stage0_layer1_expert2_gate -->
<g id="edge54" class="edge">
<title>stage0_layer1_layernorm2&#45;&gt;stage0_layer1_expert2_gate</title>
<path fill="none" stroke="black" d="M1451.7,-27160.16C1474.12,-27150.09 1498.9,-27138.95 1521.89,-27128.62"/>
<polygon fill="black" stroke="black" points="1523.59,-27131.7 1531.28,-27124.41 1520.73,-27125.31 1523.59,-27131.7"/>
</g>
<!-- stage0_layer1_expert3_gate -->
<g id="node55" class="node">
<title>stage0_layer1_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2275.5,-27124.28 1852.5,-27124.28 1852.5,-27056.28 2275.5,-27056.28 2275.5,-27124.28"/>
<text text-anchor="middle" x="2064" y="-27109.08" font-family="Times,serif" font-size="14.00">Expert Gate 19</text>
<text text-anchor="middle" x="2064" y="-27094.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2064" y="-27079.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2064" y="-27064.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_layernorm2&#45;&gt;stage0_layer1_expert3_gate -->
<g id="edge60" class="edge">
<title>stage0_layer1_layernorm2&#45;&gt;stage0_layer1_expert3_gate</title>
<path fill="none" stroke="black" d="M1581.5,-27163.02C1663.58,-27150.82 1758.5,-27136.71 1842.32,-27124.24"/>
<polygon fill="black" stroke="black" points="1842.84,-27127.7 1852.22,-27122.77 1841.82,-27120.78 1842.84,-27127.7"/>
</g>
<!-- stage0_layer1_expert0_mlp1 -->
<g id="node41" class="node">
<title>stage0_layer1_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="901.5,-27020.28 454.5,-27020.28 454.5,-26952.28 901.5,-26952.28 901.5,-27020.28"/>
<text text-anchor="middle" x="678" y="-27005.08" font-family="Times,serif" font-size="14.00">Expert 16 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="678" y="-26990.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="678" y="-26975.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="678" y="-26960.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert0_gate&#45;&gt;stage0_layer1_expert0_mlp1 -->
<g id="edge43" class="edge">
<title>stage0_layer1_expert0_gate&#45;&gt;stage0_layer1_expert0_mlp1</title>
<path fill="none" stroke="black" d="M692.18,-27056.16C690.49,-27047.97 688.66,-27039.07 686.89,-27030.47"/>
<polygon fill="black" stroke="black" points="690.3,-27029.67 684.86,-27020.58 683.44,-27031.08 690.3,-27029.67"/>
</g>
<!-- stage0_layer1_expert0_act -->
<g id="node42" class="node">
<title>stage0_layer1_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="860.5,-26916.28 413.5,-26916.28 413.5,-26848.28 860.5,-26848.28 860.5,-26916.28"/>
<text text-anchor="middle" x="637" y="-26901.08" font-family="Times,serif" font-size="14.00">Expert 16 Activation</text>
<text text-anchor="middle" x="637" y="-26886.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-26871.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-26856.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert0_mlp1&#45;&gt;stage0_layer1_expert0_act -->
<g id="edge44" class="edge">
<title>stage0_layer1_expert0_mlp1&#45;&gt;stage0_layer1_expert0_act</title>
<path fill="none" stroke="black" d="M664.69,-26952.16C661.32,-26943.79 657.66,-26934.68 654.14,-26925.91"/>
<polygon fill="black" stroke="black" points="657.36,-26924.55 650.39,-26916.58 650.87,-26927.16 657.36,-26924.55"/>
</g>
<!-- stage0_layer1_expert0_mlp2 -->
<g id="node43" class="node">
<title>stage0_layer1_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="719.5,-26812.28 242.5,-26812.28 242.5,-26744.28 719.5,-26744.28 719.5,-26812.28"/>
<text text-anchor="middle" x="481" y="-26797.08" font-family="Times,serif" font-size="14.00">Expert 16 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="481" y="-26782.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="481" y="-26767.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="481" y="-26752.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert0_act&#45;&gt;stage0_layer1_expert0_mlp2 -->
<g id="edge45" class="edge">
<title>stage0_layer1_expert0_act&#45;&gt;stage0_layer1_expert0_mlp2</title>
<path fill="none" stroke="black" d="M586.35,-26848.16C571.7,-26838.58 555.58,-26828.04 540.44,-26818.14"/>
<polygon fill="black" stroke="black" points="541.95,-26814.95 531.66,-26812.41 538.12,-26820.81 541.95,-26814.95"/>
</g>
<!-- stage0_layer1_expert0_reduce -->
<g id="node44" class="node">
<title>stage0_layer1_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-26660.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-26679" font-family="Times,serif" font-size="14.00">Expert 16 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-26664" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-26649" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-26634" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert0_mlp2&#45;&gt;stage0_layer1_expert0_reduce -->
<g id="edge46" class="edge">
<title>stage0_layer1_expert0_mlp2&#45;&gt;stage0_layer1_expert0_reduce</title>
<path fill="none" stroke="black" d="M442.03,-26744.02C431.15,-26734.73 419.04,-26724.4 407.18,-26714.27"/>
<polygon fill="black" stroke="black" points="409.31,-26711.49 399.43,-26707.66 404.77,-26716.81 409.31,-26711.49"/>
</g>
<!-- stage0_layer1_expert_agg -->
<g id="node60" class="node">
<title>stage0_layer1_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-26576.11 1116.35,-26576.11 935.11,-26440.11 1639.65,-26440.11 1820.89,-26576.11"/>
<text text-anchor="middle" x="1378" y="-26526.91" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1378" y="-26511.91" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1378" y="-26496.91" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-26481.91" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert0_reduce&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge47" class="edge">
<title>stage0_layer1_expert0_reduce&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M574.9,-26625.8C721.93,-26604.43 914.31,-26576.48 1073.92,-26553.29"/>
<polygon fill="black" stroke="black" points="1074.51,-26556.74 1083.9,-26551.84 1073.5,-26549.82 1074.51,-26556.74"/>
</g>
<!-- stage0_layer1_expert1_mlp1 -->
<g id="node46" class="node">
<title>stage0_layer1_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1366.5,-27020.28 919.5,-27020.28 919.5,-26952.28 1366.5,-26952.28 1366.5,-27020.28"/>
<text text-anchor="middle" x="1143" y="-27005.08" font-family="Times,serif" font-size="14.00">Expert 17 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1143" y="-26990.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1143" y="-26975.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1143" y="-26960.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert1_gate&#45;&gt;stage0_layer1_expert1_mlp1 -->
<g id="edge49" class="edge">
<title>stage0_layer1_expert1_gate&#45;&gt;stage0_layer1_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1149.08,-27056.16C1148.36,-27048.06 1147.59,-27039.26 1146.84,-27030.75"/>
<polygon fill="black" stroke="black" points="1150.3,-27030.23 1145.94,-27020.58 1143.33,-27030.85 1150.3,-27030.23"/>
</g>
<!-- stage0_layer1_expert1_act -->
<g id="node47" class="node">
<title>stage0_layer1_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1340.5,-26916.28 893.5,-26916.28 893.5,-26848.28 1340.5,-26848.28 1340.5,-26916.28"/>
<text text-anchor="middle" x="1117" y="-26901.08" font-family="Times,serif" font-size="14.00">Expert 17 Activation</text>
<text text-anchor="middle" x="1117" y="-26886.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-26871.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-26856.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert1_mlp1&#45;&gt;stage0_layer1_expert1_act -->
<g id="edge50" class="edge">
<title>stage0_layer1_expert1_mlp1&#45;&gt;stage0_layer1_expert1_act</title>
<path fill="none" stroke="black" d="M1134.56,-26952.16C1132.47,-26943.97 1130.2,-26935.07 1128.01,-26926.47"/>
<polygon fill="black" stroke="black" points="1131.35,-26925.41 1125.49,-26916.58 1124.57,-26927.13 1131.35,-26925.41"/>
</g>
<!-- stage0_layer1_expert1_mlp2 -->
<g id="node48" class="node">
<title>stage0_layer1_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-26812.28 827.5,-26812.28 827.5,-26744.28 1304.5,-26744.28 1304.5,-26812.28"/>
<text text-anchor="middle" x="1066" y="-26797.08" font-family="Times,serif" font-size="14.00">Expert 17 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-26782.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-26767.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-26752.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert1_act&#45;&gt;stage0_layer1_expert1_mlp2 -->
<g id="edge51" class="edge">
<title>stage0_layer1_expert1_act&#45;&gt;stage0_layer1_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1100.44,-26848.16C1096.21,-26839.7 1091.6,-26830.49 1087.18,-26821.63"/>
<polygon fill="black" stroke="black" points="1090.25,-26819.96 1082.65,-26812.58 1083.99,-26823.09 1090.25,-26819.96"/>
</g>
<!-- stage0_layer1_expert1_reduce -->
<g id="node49" class="node">
<title>stage0_layer1_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-26660.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-26679" font-family="Times,serif" font-size="14.00">Expert 17 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-26664" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-26649" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-26634" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert1_mlp2&#45;&gt;stage0_layer1_expert1_reduce -->
<g id="edge52" class="edge">
<title>stage0_layer1_expert1_mlp2&#45;&gt;stage0_layer1_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.1,-26744.02C1049.91,-26735.76 1046.39,-26726.68 1042.89,-26717.66"/>
<polygon fill="black" stroke="black" points="1046.14,-26716.37 1039.26,-26708.31 1039.61,-26718.9 1046.14,-26716.37"/>
</g>
<!-- stage0_layer1_expert1_reduce&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge53" class="edge">
<title>stage0_layer1_expert1_reduce&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M1127.15,-26614.57C1152.91,-26603.74 1181.09,-26591.9 1208.96,-26580.18"/>
<polygon fill="black" stroke="black" points="1210.53,-26583.31 1218.39,-26576.21 1207.82,-26576.86 1210.53,-26583.31"/>
</g>
<!-- stage0_layer1_expert2_mlp1 -->
<g id="node51" class="node">
<title>stage0_layer1_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1838.5,-27020.28 1391.5,-27020.28 1391.5,-26952.28 1838.5,-26952.28 1838.5,-27020.28"/>
<text text-anchor="middle" x="1615" y="-27005.08" font-family="Times,serif" font-size="14.00">Expert 18 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1615" y="-26990.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1615" y="-26975.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1615" y="-26960.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert2_gate&#45;&gt;stage0_layer1_expert2_mlp1 -->
<g id="edge55" class="edge">
<title>stage0_layer1_expert2_gate&#45;&gt;stage0_layer1_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1608.25,-27056.16C1609.04,-27048.06 1609.9,-27039.26 1610.74,-27030.75"/>
<polygon fill="black" stroke="black" points="1614.24,-27030.87 1611.74,-27020.58 1607.28,-27030.19 1614.24,-27030.87"/>
</g>
<!-- stage0_layer1_expert2_act -->
<g id="node52" class="node">
<title>stage0_layer1_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1848.5,-26916.28 1401.5,-26916.28 1401.5,-26848.28 1848.5,-26848.28 1848.5,-26916.28"/>
<text text-anchor="middle" x="1625" y="-26901.08" font-family="Times,serif" font-size="14.00">Expert 18 Activation</text>
<text text-anchor="middle" x="1625" y="-26886.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-26871.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-26856.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert2_mlp1&#45;&gt;stage0_layer1_expert2_act -->
<g id="edge56" class="edge">
<title>stage0_layer1_expert2_mlp1&#45;&gt;stage0_layer1_expert2_act</title>
<path fill="none" stroke="black" d="M1618.25,-26952.16C1619.04,-26944.06 1619.9,-26935.26 1620.74,-26926.75"/>
<polygon fill="black" stroke="black" points="1624.24,-26926.87 1621.74,-26916.58 1617.28,-26926.19 1624.24,-26926.87"/>
</g>
<!-- stage0_layer1_expert2_mlp2 -->
<g id="node53" class="node">
<title>stage0_layer1_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1889.5,-26812.28 1412.5,-26812.28 1412.5,-26744.28 1889.5,-26744.28 1889.5,-26812.28"/>
<text text-anchor="middle" x="1651" y="-26797.08" font-family="Times,serif" font-size="14.00">Expert 18 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1651" y="-26782.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1651" y="-26767.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1651" y="-26752.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert2_act&#45;&gt;stage0_layer1_expert2_mlp2 -->
<g id="edge57" class="edge">
<title>stage0_layer1_expert2_act&#45;&gt;stage0_layer1_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1633.44,-26848.16C1635.53,-26839.97 1637.8,-26831.07 1639.99,-26822.47"/>
<polygon fill="black" stroke="black" points="1643.43,-26823.13 1642.51,-26812.58 1636.65,-26821.41 1643.43,-26823.13"/>
</g>
<!-- stage0_layer1_expert2_reduce -->
<g id="node54" class="node">
<title>stage0_layer1_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-26660.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-26679" font-family="Times,serif" font-size="14.00">Expert 18 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-26664" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-26649" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-26634" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert2_mlp2&#45;&gt;stage0_layer1_expert2_reduce -->
<g id="edge58" class="edge">
<title>stage0_layer1_expert2_mlp2&#45;&gt;stage0_layer1_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.18,-26744.02C1667.45,-26735.76 1671.05,-26726.68 1674.63,-26717.66"/>
<polygon fill="black" stroke="black" points="1677.9,-26718.89 1678.33,-26708.31 1671.39,-26716.31 1677.9,-26718.89"/>
</g>
<!-- stage0_layer1_expert2_reduce&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge59" class="edge">
<title>stage0_layer1_expert2_reduce&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M1601.29,-26614.17C1578.75,-26603.56 1554.18,-26592 1529.84,-26580.55"/>
<polygon fill="black" stroke="black" points="1531.07,-26577.26 1520.53,-26576.17 1528.09,-26583.6 1531.07,-26577.26"/>
</g>
<!-- stage0_layer1_expert3_mlp1 -->
<g id="node56" class="node">
<title>stage0_layer1_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2307.5,-27020.28 1860.5,-27020.28 1860.5,-26952.28 2307.5,-26952.28 2307.5,-27020.28"/>
<text text-anchor="middle" x="2084" y="-27005.08" font-family="Times,serif" font-size="14.00">Expert 19 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2084" y="-26990.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2084" y="-26975.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2084" y="-26960.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert3_gate&#45;&gt;stage0_layer1_expert3_mlp1 -->
<g id="edge61" class="edge">
<title>stage0_layer1_expert3_gate&#45;&gt;stage0_layer1_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2070.49,-27056.16C2072.1,-27047.97 2073.85,-27039.07 2075.53,-27030.47"/>
<polygon fill="black" stroke="black" points="2078.98,-27031.07 2077.47,-27020.58 2072.11,-27029.72 2078.98,-27031.07"/>
</g>
<!-- stage0_layer1_expert3_act -->
<g id="node57" class="node">
<title>stage0_layer1_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2322.5,-26916.28 1875.5,-26916.28 1875.5,-26848.28 2322.5,-26848.28 2322.5,-26916.28"/>
<text text-anchor="middle" x="2099" y="-26901.08" font-family="Times,serif" font-size="14.00">Expert 19 Activation</text>
<text text-anchor="middle" x="2099" y="-26886.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-26871.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-26856.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert3_mlp1&#45;&gt;stage0_layer1_expert3_act -->
<g id="edge62" class="edge">
<title>stage0_layer1_expert3_mlp1&#45;&gt;stage0_layer1_expert3_act</title>
<path fill="none" stroke="black" d="M2088.87,-26952.16C2090.06,-26944.06 2091.36,-26935.26 2092.61,-26926.75"/>
<polygon fill="black" stroke="black" points="2096.11,-26926.98 2094.1,-26916.58 2089.19,-26925.96 2096.11,-26926.98"/>
</g>
<!-- stage0_layer1_expert3_mlp2 -->
<g id="node58" class="node">
<title>stage0_layer1_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2520.5,-26812.28 2043.5,-26812.28 2043.5,-26744.28 2520.5,-26744.28 2520.5,-26812.28"/>
<text text-anchor="middle" x="2282" y="-26797.08" font-family="Times,serif" font-size="14.00">Expert 19 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2282" y="-26782.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2282" y="-26767.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2282" y="-26752.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert3_act&#45;&gt;stage0_layer1_expert3_mlp2 -->
<g id="edge63" class="edge">
<title>stage0_layer1_expert3_act&#45;&gt;stage0_layer1_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2158.41,-26848.16C2176.08,-26838.32 2195.58,-26827.45 2213.76,-26817.31"/>
<polygon fill="black" stroke="black" points="2215.54,-26820.33 2222.57,-26812.41 2212.13,-26814.22 2215.54,-26820.33"/>
</g>
<!-- stage0_layer1_expert3_reduce -->
<g id="node59" class="node">
<title>stage0_layer1_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-26660.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-26679" font-family="Times,serif" font-size="14.00">Expert 19 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-26664" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-26649" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-26634" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert3_mlp2&#45;&gt;stage0_layer1_expert3_reduce -->
<g id="edge64" class="edge">
<title>stage0_layer1_expert3_mlp2&#45;&gt;stage0_layer1_expert3_reduce</title>
<path fill="none" stroke="black" d="M2308.08,-26744.02C2314.89,-26735.33 2322.41,-26725.73 2329.86,-26716.23"/>
<polygon fill="black" stroke="black" points="2332.65,-26718.34 2336.07,-26708.31 2327.15,-26714.02 2332.65,-26718.34"/>
</g>
<!-- stage0_layer1_expert3_reduce&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge65" class="edge">
<title>stage0_layer1_expert3_reduce&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M2147.53,-26625.19C2053.41,-26610.99 1940.53,-26593.96 1830.59,-26577.38"/>
<polygon fill="black" stroke="black" points="1831.06,-26573.91 1820.65,-26575.88 1830.02,-26580.83 1831.06,-26573.91"/>
</g>
<!-- stage0_layer1_residual2 -->
<g id="node61" class="node">
<title>stage0_layer1_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-26404.11 1116.35,-26404.11 935.11,-26268.11 1639.65,-26268.11 1820.89,-26404.11"/>
<text text-anchor="middle" x="1378" y="-26354.91" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1378" y="-26339.91" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-26324.91" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-26309.91" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_expert_agg&#45;&gt;stage0_layer1_residual2 -->
<g id="edge66" class="edge">
<title>stage0_layer1_expert_agg&#45;&gt;stage0_layer1_residual2</title>
<path fill="none" stroke="black" d="M1378,-26439.93C1378,-26431.61 1378,-26423.06 1378,-26414.61"/>
<polygon fill="black" stroke="black" points="1381.5,-26414.37 1378,-26404.37 1374.5,-26414.37 1381.5,-26414.37"/>
</g>
<!-- stage0_layer2_layernorm -->
<g id="node62" class="node">
<title>stage0_layer2_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-26221.11 1174.5,-26221.11 1174.5,-26153.11 1581.5,-26153.11 1581.5,-26221.11"/>
<text text-anchor="middle" x="1378" y="-26205.91" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1378" y="-26190.91" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-26175.91" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-26160.91" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer1_residual2&#45;&gt;stage0_layer2_layernorm -->
<g id="edge67" class="edge">
<title>stage0_layer1_residual2&#45;&gt;stage0_layer2_layernorm</title>
<path fill="none" stroke="black" d="M1378,-26268.07C1378,-26255.66 1378,-26243.01 1378,-26231.53"/>
<polygon fill="black" stroke="black" points="1381.5,-26231.37 1378,-26221.37 1374.5,-26231.37 1381.5,-26231.37"/>
</g>
<!-- stage0_layer2_qkv_proj -->
<g id="node63" class="node">
<title>stage0_layer2_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-26117.11 1120.5,-26117.11 1120.5,-26049.11 1635.5,-26049.11 1635.5,-26117.11"/>
<text text-anchor="middle" x="1378" y="-26101.91" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-26086.91" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-26071.91" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-26056.91" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_layernorm&#45;&gt;stage0_layer2_qkv_proj -->
<g id="edge68" class="edge">
<title>stage0_layer2_layernorm&#45;&gt;stage0_layer2_qkv_proj</title>
<path fill="none" stroke="black" d="M1378,-26153C1378,-26144.89 1378,-26136.1 1378,-26127.59"/>
<polygon fill="black" stroke="black" points="1381.5,-26127.41 1378,-26117.41 1374.5,-26127.41 1381.5,-26127.41"/>
</g>
<!-- stage0_layer2_qkv_gather -->
<g id="node64" class="node">
<title>stage0_layer2_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-25965.03" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-25983.83" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1378" y="-25968.83" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1378" y="-25953.83" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-25938.83" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_qkv_proj&#45;&gt;stage0_layer2_qkv_gather -->
<g id="edge69" class="edge">
<title>stage0_layer2_qkv_proj&#45;&gt;stage0_layer2_qkv_gather</title>
<path fill="none" stroke="black" d="M1378,-26048.85C1378,-26040.86 1378,-26032.09 1378,-26023.35"/>
<polygon fill="black" stroke="black" points="1381.5,-26023.14 1378,-26013.14 1374.5,-26023.14 1381.5,-26023.14"/>
</g>
<!-- stage0_layer2_attention -->
<g id="node65" class="node">
<title>stage0_layer2_attention</title>
<polygon fill="lightgreen" stroke="black" points="1629.5,-25880.95 1126.5,-25880.95 1126.5,-25812.95 1629.5,-25812.95 1629.5,-25880.95"/>
<text text-anchor="middle" x="1378" y="-25865.75" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1378" y="-25850.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-25835.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-25820.75" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_qkv_gather&#45;&gt;stage0_layer2_attention -->
<g id="edge70" class="edge">
<title>stage0_layer2_qkv_gather&#45;&gt;stage0_layer2_attention</title>
<path fill="none" stroke="black" d="M1378,-25916.82C1378,-25908.43 1378,-25899.73 1378,-25891.45"/>
<polygon fill="black" stroke="black" points="1381.5,-25891.25 1378,-25881.25 1374.5,-25891.25 1381.5,-25891.25"/>
</g>
<!-- stage0_layer2_attn_out -->
<g id="node66" class="node">
<title>stage0_layer2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1616.5,-25776.95 1139.5,-25776.95 1139.5,-25708.95 1616.5,-25708.95 1616.5,-25776.95"/>
<text text-anchor="middle" x="1378" y="-25761.75" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-25746.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-25731.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-25716.75" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_attention&#45;&gt;stage0_layer2_attn_out -->
<g id="edge71" class="edge">
<title>stage0_layer2_attention&#45;&gt;stage0_layer2_attn_out</title>
<path fill="none" stroke="black" d="M1378,-25812.83C1378,-25804.73 1378,-25795.93 1378,-25787.42"/>
<polygon fill="black" stroke="black" points="1381.5,-25787.25 1378,-25777.25 1374.5,-25787.25 1381.5,-25787.25"/>
</g>
<!-- stage0_layer2_attn_reduce -->
<g id="node67" class="node">
<title>stage0_layer2_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-25624.86" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-25643.66" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1378" y="-25628.66" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-25613.66" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-25598.66" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_attn_out&#45;&gt;stage0_layer2_attn_reduce -->
<g id="edge72" class="edge">
<title>stage0_layer2_attn_out&#45;&gt;stage0_layer2_attn_reduce</title>
<path fill="none" stroke="black" d="M1378,-25708.68C1378,-25700.69 1378,-25691.92 1378,-25683.18"/>
<polygon fill="black" stroke="black" points="1381.5,-25682.97 1378,-25672.97 1374.5,-25682.97 1381.5,-25682.97"/>
</g>
<!-- stage0_layer2_residual1 -->
<g id="node68" class="node">
<title>stage0_layer2_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-25540.78 1116.35,-25540.78 935.11,-25404.78 1639.65,-25404.78 1820.89,-25540.78"/>
<text text-anchor="middle" x="1378" y="-25491.58" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1378" y="-25476.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-25461.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-25446.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_attn_reduce&#45;&gt;stage0_layer2_residual1 -->
<g id="edge73" class="edge">
<title>stage0_layer2_attn_reduce&#45;&gt;stage0_layer2_residual1</title>
<path fill="none" stroke="black" d="M1378,-25576.38C1378,-25568.29 1378,-25559.71 1378,-25551.09"/>
<polygon fill="black" stroke="black" points="1381.5,-25550.98 1378,-25540.98 1374.5,-25550.98 1381.5,-25550.98"/>
</g>
<!-- stage0_layer2_layernorm2 -->
<g id="node69" class="node">
<title>stage0_layer2_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-25368.78 1174.5,-25368.78 1174.5,-25300.78 1581.5,-25300.78 1581.5,-25368.78"/>
<text text-anchor="middle" x="1378" y="-25353.58" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1378" y="-25338.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-25323.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-25308.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_residual1&#45;&gt;stage0_layer2_layernorm2 -->
<g id="edge74" class="edge">
<title>stage0_layer2_residual1&#45;&gt;stage0_layer2_layernorm2</title>
<path fill="none" stroke="black" d="M1378,-25404.58C1378,-25395.83 1378,-25387.06 1378,-25378.85"/>
<polygon fill="black" stroke="black" points="1381.5,-25378.8 1378,-25368.8 1374.5,-25378.8 1381.5,-25378.8"/>
</g>
<!-- stage0_layer2_expert0_gate -->
<g id="node70" class="node">
<title>stage0_layer2_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="910.5,-25264.78 487.5,-25264.78 487.5,-25196.78 910.5,-25196.78 910.5,-25264.78"/>
<text text-anchor="middle" x="699" y="-25249.58" font-family="Times,serif" font-size="14.00">Expert Gate 32</text>
<text text-anchor="middle" x="699" y="-25234.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="699" y="-25219.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="699" y="-25204.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_layernorm2&#45;&gt;stage0_layer2_expert0_gate -->
<g id="edge75" class="edge">
<title>stage0_layer2_layernorm2&#45;&gt;stage0_layer2_expert0_gate</title>
<path fill="none" stroke="black" d="M1174.28,-25303.18C1094.23,-25291.15 1002.12,-25277.32 920.43,-25265.04"/>
<polygon fill="black" stroke="black" points="920.93,-25261.58 910.53,-25263.56 919.9,-25268.5 920.93,-25261.58"/>
</g>
<!-- stage0_layer2_expert1_gate -->
<g id="node75" class="node">
<title>stage0_layer2_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1363.5,-25264.78 940.5,-25264.78 940.5,-25196.78 1363.5,-25196.78 1363.5,-25264.78"/>
<text text-anchor="middle" x="1152" y="-25249.58" font-family="Times,serif" font-size="14.00">Expert Gate 33</text>
<text text-anchor="middle" x="1152" y="-25234.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1152" y="-25219.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1152" y="-25204.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_layernorm2&#45;&gt;stage0_layer2_expert1_gate -->
<g id="edge81" class="edge">
<title>stage0_layer2_layernorm2&#45;&gt;stage0_layer2_expert1_gate</title>
<path fill="none" stroke="black" d="M1304.62,-25300.66C1282.31,-25290.59 1257.63,-25279.45 1234.74,-25269.12"/>
<polygon fill="black" stroke="black" points="1235.95,-25265.83 1225.39,-25264.91 1233.07,-25272.21 1235.95,-25265.83"/>
</g>
<!-- stage0_layer2_expert2_gate -->
<g id="node80" class="node">
<title>stage0_layer2_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1816.5,-25264.78 1393.5,-25264.78 1393.5,-25196.78 1816.5,-25196.78 1816.5,-25264.78"/>
<text text-anchor="middle" x="1605" y="-25249.58" font-family="Times,serif" font-size="14.00">Expert Gate 34</text>
<text text-anchor="middle" x="1605" y="-25234.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1605" y="-25219.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1605" y="-25204.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_layernorm2&#45;&gt;stage0_layer2_expert2_gate -->
<g id="edge87" class="edge">
<title>stage0_layer2_layernorm2&#45;&gt;stage0_layer2_expert2_gate</title>
<path fill="none" stroke="black" d="M1451.7,-25300.66C1474.12,-25290.59 1498.9,-25279.45 1521.89,-25269.12"/>
<polygon fill="black" stroke="black" points="1523.59,-25272.2 1531.28,-25264.91 1520.73,-25265.81 1523.59,-25272.2"/>
</g>
<!-- stage0_layer2_expert3_gate -->
<g id="node85" class="node">
<title>stage0_layer2_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2275.5,-25264.78 1852.5,-25264.78 1852.5,-25196.78 2275.5,-25196.78 2275.5,-25264.78"/>
<text text-anchor="middle" x="2064" y="-25249.58" font-family="Times,serif" font-size="14.00">Expert Gate 35</text>
<text text-anchor="middle" x="2064" y="-25234.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2064" y="-25219.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2064" y="-25204.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_layernorm2&#45;&gt;stage0_layer2_expert3_gate -->
<g id="edge93" class="edge">
<title>stage0_layer2_layernorm2&#45;&gt;stage0_layer2_expert3_gate</title>
<path fill="none" stroke="black" d="M1581.5,-25303.52C1663.58,-25291.32 1758.5,-25277.21 1842.32,-25264.74"/>
<polygon fill="black" stroke="black" points="1842.84,-25268.2 1852.22,-25263.27 1841.82,-25261.28 1842.84,-25268.2"/>
</g>
<!-- stage0_layer2_expert0_mlp1 -->
<g id="node71" class="node">
<title>stage0_layer2_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="901.5,-25160.78 454.5,-25160.78 454.5,-25092.78 901.5,-25092.78 901.5,-25160.78"/>
<text text-anchor="middle" x="678" y="-25145.58" font-family="Times,serif" font-size="14.00">Expert 32 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="678" y="-25130.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="678" y="-25115.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="678" y="-25100.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert0_gate&#45;&gt;stage0_layer2_expert0_mlp1 -->
<g id="edge76" class="edge">
<title>stage0_layer2_expert0_gate&#45;&gt;stage0_layer2_expert0_mlp1</title>
<path fill="none" stroke="black" d="M692.18,-25196.66C690.49,-25188.47 688.66,-25179.57 686.89,-25170.97"/>
<polygon fill="black" stroke="black" points="690.3,-25170.17 684.86,-25161.08 683.44,-25171.58 690.3,-25170.17"/>
</g>
<!-- stage0_layer2_expert0_act -->
<g id="node72" class="node">
<title>stage0_layer2_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="860.5,-25056.78 413.5,-25056.78 413.5,-24988.78 860.5,-24988.78 860.5,-25056.78"/>
<text text-anchor="middle" x="637" y="-25041.58" font-family="Times,serif" font-size="14.00">Expert 32 Activation</text>
<text text-anchor="middle" x="637" y="-25026.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-25011.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-24996.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert0_mlp1&#45;&gt;stage0_layer2_expert0_act -->
<g id="edge77" class="edge">
<title>stage0_layer2_expert0_mlp1&#45;&gt;stage0_layer2_expert0_act</title>
<path fill="none" stroke="black" d="M664.69,-25092.66C661.32,-25084.29 657.66,-25075.18 654.14,-25066.41"/>
<polygon fill="black" stroke="black" points="657.36,-25065.05 650.39,-25057.08 650.87,-25067.66 657.36,-25065.05"/>
</g>
<!-- stage0_layer2_expert0_mlp2 -->
<g id="node73" class="node">
<title>stage0_layer2_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="719.5,-24952.78 242.5,-24952.78 242.5,-24884.78 719.5,-24884.78 719.5,-24952.78"/>
<text text-anchor="middle" x="481" y="-24937.58" font-family="Times,serif" font-size="14.00">Expert 32 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="481" y="-24922.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="481" y="-24907.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="481" y="-24892.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert0_act&#45;&gt;stage0_layer2_expert0_mlp2 -->
<g id="edge78" class="edge">
<title>stage0_layer2_expert0_act&#45;&gt;stage0_layer2_expert0_mlp2</title>
<path fill="none" stroke="black" d="M586.35,-24988.66C571.7,-24979.08 555.58,-24968.54 540.44,-24958.65"/>
<polygon fill="black" stroke="black" points="541.95,-24955.45 531.66,-24952.91 538.12,-24961.31 541.95,-24955.45"/>
</g>
<!-- stage0_layer2_expert0_reduce -->
<g id="node74" class="node">
<title>stage0_layer2_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-24800.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-24819.5" font-family="Times,serif" font-size="14.00">Expert 32 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-24804.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-24789.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-24774.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert0_mlp2&#45;&gt;stage0_layer2_expert0_reduce -->
<g id="edge79" class="edge">
<title>stage0_layer2_expert0_mlp2&#45;&gt;stage0_layer2_expert0_reduce</title>
<path fill="none" stroke="black" d="M442.03,-24884.52C431.15,-24875.23 419.04,-24864.9 407.18,-24854.77"/>
<polygon fill="black" stroke="black" points="409.31,-24851.99 399.43,-24848.16 404.77,-24857.31 409.31,-24851.99"/>
</g>
<!-- stage0_layer2_expert_agg -->
<g id="node90" class="node">
<title>stage0_layer2_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-24716.61 1116.35,-24716.61 935.11,-24580.61 1639.65,-24580.61 1820.89,-24716.61"/>
<text text-anchor="middle" x="1378" y="-24667.41" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1378" y="-24652.41" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1378" y="-24637.41" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-24622.41" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert0_reduce&#45;&gt;stage0_layer2_expert_agg -->
<g id="edge80" class="edge">
<title>stage0_layer2_expert0_reduce&#45;&gt;stage0_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M574.9,-24766.3C721.93,-24744.93 914.31,-24716.98 1073.92,-24693.79"/>
<polygon fill="black" stroke="black" points="1074.51,-24697.25 1083.9,-24692.34 1073.5,-24690.32 1074.51,-24697.25"/>
</g>
<!-- stage0_layer2_expert1_mlp1 -->
<g id="node76" class="node">
<title>stage0_layer2_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1366.5,-25160.78 919.5,-25160.78 919.5,-25092.78 1366.5,-25092.78 1366.5,-25160.78"/>
<text text-anchor="middle" x="1143" y="-25145.58" font-family="Times,serif" font-size="14.00">Expert 33 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1143" y="-25130.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1143" y="-25115.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1143" y="-25100.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert1_gate&#45;&gt;stage0_layer2_expert1_mlp1 -->
<g id="edge82" class="edge">
<title>stage0_layer2_expert1_gate&#45;&gt;stage0_layer2_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1149.08,-25196.66C1148.36,-25188.56 1147.59,-25179.76 1146.84,-25171.25"/>
<polygon fill="black" stroke="black" points="1150.3,-25170.73 1145.94,-25161.08 1143.33,-25171.35 1150.3,-25170.73"/>
</g>
<!-- stage0_layer2_expert1_act -->
<g id="node77" class="node">
<title>stage0_layer2_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1340.5,-25056.78 893.5,-25056.78 893.5,-24988.78 1340.5,-24988.78 1340.5,-25056.78"/>
<text text-anchor="middle" x="1117" y="-25041.58" font-family="Times,serif" font-size="14.00">Expert 33 Activation</text>
<text text-anchor="middle" x="1117" y="-25026.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-25011.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-24996.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert1_mlp1&#45;&gt;stage0_layer2_expert1_act -->
<g id="edge83" class="edge">
<title>stage0_layer2_expert1_mlp1&#45;&gt;stage0_layer2_expert1_act</title>
<path fill="none" stroke="black" d="M1134.56,-25092.66C1132.47,-25084.47 1130.2,-25075.57 1128.01,-25066.97"/>
<polygon fill="black" stroke="black" points="1131.35,-25065.91 1125.49,-25057.08 1124.57,-25067.63 1131.35,-25065.91"/>
</g>
<!-- stage0_layer2_expert1_mlp2 -->
<g id="node78" class="node">
<title>stage0_layer2_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-24952.78 827.5,-24952.78 827.5,-24884.78 1304.5,-24884.78 1304.5,-24952.78"/>
<text text-anchor="middle" x="1066" y="-24937.58" font-family="Times,serif" font-size="14.00">Expert 33 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-24922.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-24907.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-24892.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert1_act&#45;&gt;stage0_layer2_expert1_mlp2 -->
<g id="edge84" class="edge">
<title>stage0_layer2_expert1_act&#45;&gt;stage0_layer2_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1100.44,-24988.66C1096.21,-24980.2 1091.6,-24970.99 1087.18,-24962.13"/>
<polygon fill="black" stroke="black" points="1090.25,-24960.46 1082.65,-24953.08 1083.99,-24963.59 1090.25,-24960.46"/>
</g>
<!-- stage0_layer2_expert1_reduce -->
<g id="node79" class="node">
<title>stage0_layer2_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-24800.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-24819.5" font-family="Times,serif" font-size="14.00">Expert 33 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-24804.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-24789.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-24774.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert1_mlp2&#45;&gt;stage0_layer2_expert1_reduce -->
<g id="edge85" class="edge">
<title>stage0_layer2_expert1_mlp2&#45;&gt;stage0_layer2_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.1,-24884.52C1049.91,-24876.26 1046.39,-24867.18 1042.89,-24858.16"/>
<polygon fill="black" stroke="black" points="1046.14,-24856.87 1039.26,-24848.81 1039.61,-24859.4 1046.14,-24856.87"/>
</g>
<!-- stage0_layer2_expert1_reduce&#45;&gt;stage0_layer2_expert_agg -->
<g id="edge86" class="edge">
<title>stage0_layer2_expert1_reduce&#45;&gt;stage0_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M1127.15,-24755.07C1152.91,-24744.24 1181.09,-24732.4 1208.96,-24720.68"/>
<polygon fill="black" stroke="black" points="1210.53,-24723.81 1218.39,-24716.71 1207.82,-24717.36 1210.53,-24723.81"/>
</g>
<!-- stage0_layer2_expert2_mlp1 -->
<g id="node81" class="node">
<title>stage0_layer2_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1838.5,-25160.78 1391.5,-25160.78 1391.5,-25092.78 1838.5,-25092.78 1838.5,-25160.78"/>
<text text-anchor="middle" x="1615" y="-25145.58" font-family="Times,serif" font-size="14.00">Expert 34 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1615" y="-25130.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1615" y="-25115.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1615" y="-25100.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert2_gate&#45;&gt;stage0_layer2_expert2_mlp1 -->
<g id="edge88" class="edge">
<title>stage0_layer2_expert2_gate&#45;&gt;stage0_layer2_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1608.25,-25196.66C1609.04,-25188.56 1609.9,-25179.76 1610.74,-25171.25"/>
<polygon fill="black" stroke="black" points="1614.24,-25171.37 1611.74,-25161.08 1607.28,-25170.69 1614.24,-25171.37"/>
</g>
<!-- stage0_layer2_expert2_act -->
<g id="node82" class="node">
<title>stage0_layer2_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1848.5,-25056.78 1401.5,-25056.78 1401.5,-24988.78 1848.5,-24988.78 1848.5,-25056.78"/>
<text text-anchor="middle" x="1625" y="-25041.58" font-family="Times,serif" font-size="14.00">Expert 34 Activation</text>
<text text-anchor="middle" x="1625" y="-25026.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-25011.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-24996.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert2_mlp1&#45;&gt;stage0_layer2_expert2_act -->
<g id="edge89" class="edge">
<title>stage0_layer2_expert2_mlp1&#45;&gt;stage0_layer2_expert2_act</title>
<path fill="none" stroke="black" d="M1618.25,-25092.66C1619.04,-25084.56 1619.9,-25075.76 1620.74,-25067.25"/>
<polygon fill="black" stroke="black" points="1624.24,-25067.37 1621.74,-25057.08 1617.28,-25066.69 1624.24,-25067.37"/>
</g>
<!-- stage0_layer2_expert2_mlp2 -->
<g id="node83" class="node">
<title>stage0_layer2_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1889.5,-24952.78 1412.5,-24952.78 1412.5,-24884.78 1889.5,-24884.78 1889.5,-24952.78"/>
<text text-anchor="middle" x="1651" y="-24937.58" font-family="Times,serif" font-size="14.00">Expert 34 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1651" y="-24922.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1651" y="-24907.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1651" y="-24892.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert2_act&#45;&gt;stage0_layer2_expert2_mlp2 -->
<g id="edge90" class="edge">
<title>stage0_layer2_expert2_act&#45;&gt;stage0_layer2_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1633.44,-24988.66C1635.53,-24980.47 1637.8,-24971.57 1639.99,-24962.97"/>
<polygon fill="black" stroke="black" points="1643.43,-24963.63 1642.51,-24953.08 1636.65,-24961.91 1643.43,-24963.63"/>
</g>
<!-- stage0_layer2_expert2_reduce -->
<g id="node84" class="node">
<title>stage0_layer2_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-24800.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-24819.5" font-family="Times,serif" font-size="14.00">Expert 34 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-24804.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-24789.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-24774.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert2_mlp2&#45;&gt;stage0_layer2_expert2_reduce -->
<g id="edge91" class="edge">
<title>stage0_layer2_expert2_mlp2&#45;&gt;stage0_layer2_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.18,-24884.52C1667.45,-24876.26 1671.05,-24867.18 1674.63,-24858.16"/>
<polygon fill="black" stroke="black" points="1677.9,-24859.39 1678.33,-24848.81 1671.39,-24856.81 1677.9,-24859.39"/>
</g>
<!-- stage0_layer2_expert2_reduce&#45;&gt;stage0_layer2_expert_agg -->
<g id="edge92" class="edge">
<title>stage0_layer2_expert2_reduce&#45;&gt;stage0_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M1601.29,-24754.67C1578.75,-24744.06 1554.18,-24732.5 1529.84,-24721.05"/>
<polygon fill="black" stroke="black" points="1531.07,-24717.76 1520.53,-24716.67 1528.09,-24724.1 1531.07,-24717.76"/>
</g>
<!-- stage0_layer2_expert3_mlp1 -->
<g id="node86" class="node">
<title>stage0_layer2_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2307.5,-25160.78 1860.5,-25160.78 1860.5,-25092.78 2307.5,-25092.78 2307.5,-25160.78"/>
<text text-anchor="middle" x="2084" y="-25145.58" font-family="Times,serif" font-size="14.00">Expert 35 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2084" y="-25130.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2084" y="-25115.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2084" y="-25100.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert3_gate&#45;&gt;stage0_layer2_expert3_mlp1 -->
<g id="edge94" class="edge">
<title>stage0_layer2_expert3_gate&#45;&gt;stage0_layer2_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2070.49,-25196.66C2072.1,-25188.47 2073.85,-25179.57 2075.53,-25170.97"/>
<polygon fill="black" stroke="black" points="2078.98,-25171.57 2077.47,-25161.08 2072.11,-25170.22 2078.98,-25171.57"/>
</g>
<!-- stage0_layer2_expert3_act -->
<g id="node87" class="node">
<title>stage0_layer2_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2322.5,-25056.78 1875.5,-25056.78 1875.5,-24988.78 2322.5,-24988.78 2322.5,-25056.78"/>
<text text-anchor="middle" x="2099" y="-25041.58" font-family="Times,serif" font-size="14.00">Expert 35 Activation</text>
<text text-anchor="middle" x="2099" y="-25026.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-25011.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-24996.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert3_mlp1&#45;&gt;stage0_layer2_expert3_act -->
<g id="edge95" class="edge">
<title>stage0_layer2_expert3_mlp1&#45;&gt;stage0_layer2_expert3_act</title>
<path fill="none" stroke="black" d="M2088.87,-25092.66C2090.06,-25084.56 2091.36,-25075.76 2092.61,-25067.25"/>
<polygon fill="black" stroke="black" points="2096.11,-25067.48 2094.1,-25057.08 2089.19,-25066.46 2096.11,-25067.48"/>
</g>
<!-- stage0_layer2_expert3_mlp2 -->
<g id="node88" class="node">
<title>stage0_layer2_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2520.5,-24952.78 2043.5,-24952.78 2043.5,-24884.78 2520.5,-24884.78 2520.5,-24952.78"/>
<text text-anchor="middle" x="2282" y="-24937.58" font-family="Times,serif" font-size="14.00">Expert 35 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2282" y="-24922.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2282" y="-24907.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2282" y="-24892.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert3_act&#45;&gt;stage0_layer2_expert3_mlp2 -->
<g id="edge96" class="edge">
<title>stage0_layer2_expert3_act&#45;&gt;stage0_layer2_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2158.41,-24988.66C2176.08,-24978.82 2195.58,-24967.95 2213.76,-24957.81"/>
<polygon fill="black" stroke="black" points="2215.54,-24960.83 2222.57,-24952.91 2212.13,-24954.72 2215.54,-24960.83"/>
</g>
<!-- stage0_layer2_expert3_reduce -->
<g id="node89" class="node">
<title>stage0_layer2_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-24800.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-24819.5" font-family="Times,serif" font-size="14.00">Expert 35 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-24804.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-24789.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-24774.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert3_mlp2&#45;&gt;stage0_layer2_expert3_reduce -->
<g id="edge97" class="edge">
<title>stage0_layer2_expert3_mlp2&#45;&gt;stage0_layer2_expert3_reduce</title>
<path fill="none" stroke="black" d="M2308.08,-24884.52C2314.89,-24875.83 2322.41,-24866.23 2329.86,-24856.73"/>
<polygon fill="black" stroke="black" points="2332.65,-24858.84 2336.07,-24848.81 2327.15,-24854.52 2332.65,-24858.84"/>
</g>
<!-- stage0_layer2_expert3_reduce&#45;&gt;stage0_layer2_expert_agg -->
<g id="edge98" class="edge">
<title>stage0_layer2_expert3_reduce&#45;&gt;stage0_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M2147.53,-24765.69C2053.41,-24751.49 1940.53,-24734.46 1830.59,-24717.88"/>
<polygon fill="black" stroke="black" points="1831.06,-24714.41 1820.65,-24716.38 1830.02,-24721.33 1831.06,-24714.41"/>
</g>
<!-- stage0_layer2_residual2 -->
<g id="node91" class="node">
<title>stage0_layer2_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-24544.61 1116.35,-24544.61 935.11,-24408.61 1639.65,-24408.61 1820.89,-24544.61"/>
<text text-anchor="middle" x="1378" y="-24495.41" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1378" y="-24480.41" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-24465.41" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-24450.41" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_expert_agg&#45;&gt;stage0_layer2_residual2 -->
<g id="edge99" class="edge">
<title>stage0_layer2_expert_agg&#45;&gt;stage0_layer2_residual2</title>
<path fill="none" stroke="black" d="M1378,-24580.43C1378,-24572.11 1378,-24563.56 1378,-24555.11"/>
<polygon fill="black" stroke="black" points="1381.5,-24554.87 1378,-24544.87 1374.5,-24554.87 1381.5,-24554.87"/>
</g>
<!-- stage0_layer3_layernorm -->
<g id="node92" class="node">
<title>stage0_layer3_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-24361.61 1174.5,-24361.61 1174.5,-24293.61 1581.5,-24293.61 1581.5,-24361.61"/>
<text text-anchor="middle" x="1378" y="-24346.41" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1378" y="-24331.41" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-24316.41" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-24301.41" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer2_residual2&#45;&gt;stage0_layer3_layernorm -->
<g id="edge100" class="edge">
<title>stage0_layer2_residual2&#45;&gt;stage0_layer3_layernorm</title>
<path fill="none" stroke="black" d="M1378,-24408.57C1378,-24396.16 1378,-24383.51 1378,-24372.03"/>
<polygon fill="black" stroke="black" points="1381.5,-24371.87 1378,-24361.87 1374.5,-24371.87 1381.5,-24371.87"/>
</g>
<!-- stage0_layer3_qkv_proj -->
<g id="node93" class="node">
<title>stage0_layer3_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-24257.61 1120.5,-24257.61 1120.5,-24189.61 1635.5,-24189.61 1635.5,-24257.61"/>
<text text-anchor="middle" x="1378" y="-24242.41" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-24227.41" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-24212.41" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-24197.41" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_layernorm&#45;&gt;stage0_layer3_qkv_proj -->
<g id="edge101" class="edge">
<title>stage0_layer3_layernorm&#45;&gt;stage0_layer3_qkv_proj</title>
<path fill="none" stroke="black" d="M1378,-24293.5C1378,-24285.39 1378,-24276.6 1378,-24268.09"/>
<polygon fill="black" stroke="black" points="1381.5,-24267.91 1378,-24257.91 1374.5,-24267.91 1381.5,-24267.91"/>
</g>
<!-- stage0_layer3_qkv_gather -->
<g id="node94" class="node">
<title>stage0_layer3_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-24105.53" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-24124.33" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1378" y="-24109.33" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1378" y="-24094.33" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-24079.33" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_qkv_proj&#45;&gt;stage0_layer3_qkv_gather -->
<g id="edge102" class="edge">
<title>stage0_layer3_qkv_proj&#45;&gt;stage0_layer3_qkv_gather</title>
<path fill="none" stroke="black" d="M1378,-24189.35C1378,-24181.36 1378,-24172.59 1378,-24163.85"/>
<polygon fill="black" stroke="black" points="1381.5,-24163.64 1378,-24153.64 1374.5,-24163.64 1381.5,-24163.64"/>
</g>
<!-- stage0_layer3_attention -->
<g id="node95" class="node">
<title>stage0_layer3_attention</title>
<polygon fill="lightgreen" stroke="black" points="1629.5,-24021.45 1126.5,-24021.45 1126.5,-23953.45 1629.5,-23953.45 1629.5,-24021.45"/>
<text text-anchor="middle" x="1378" y="-24006.25" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1378" y="-23991.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-23976.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-23961.25" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_qkv_gather&#45;&gt;stage0_layer3_attention -->
<g id="edge103" class="edge">
<title>stage0_layer3_qkv_gather&#45;&gt;stage0_layer3_attention</title>
<path fill="none" stroke="black" d="M1378,-24057.32C1378,-24048.93 1378,-24040.23 1378,-24031.95"/>
<polygon fill="black" stroke="black" points="1381.5,-24031.75 1378,-24021.75 1374.5,-24031.75 1381.5,-24031.75"/>
</g>
<!-- stage0_layer3_attn_out -->
<g id="node96" class="node">
<title>stage0_layer3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1616.5,-23917.45 1139.5,-23917.45 1139.5,-23849.45 1616.5,-23849.45 1616.5,-23917.45"/>
<text text-anchor="middle" x="1378" y="-23902.25" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-23887.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-23872.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-23857.25" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_attention&#45;&gt;stage0_layer3_attn_out -->
<g id="edge104" class="edge">
<title>stage0_layer3_attention&#45;&gt;stage0_layer3_attn_out</title>
<path fill="none" stroke="black" d="M1378,-23953.33C1378,-23945.23 1378,-23936.43 1378,-23927.92"/>
<polygon fill="black" stroke="black" points="1381.5,-23927.75 1378,-23917.75 1374.5,-23927.75 1381.5,-23927.75"/>
</g>
<!-- stage0_layer3_attn_reduce -->
<g id="node97" class="node">
<title>stage0_layer3_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-23765.36" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-23784.16" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1378" y="-23769.16" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-23754.16" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-23739.16" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_attn_out&#45;&gt;stage0_layer3_attn_reduce -->
<g id="edge105" class="edge">
<title>stage0_layer3_attn_out&#45;&gt;stage0_layer3_attn_reduce</title>
<path fill="none" stroke="black" d="M1378,-23849.18C1378,-23841.19 1378,-23832.42 1378,-23823.68"/>
<polygon fill="black" stroke="black" points="1381.5,-23823.47 1378,-23813.47 1374.5,-23823.47 1381.5,-23823.47"/>
</g>
<!-- stage0_layer3_residual1 -->
<g id="node98" class="node">
<title>stage0_layer3_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-23681.28 1116.35,-23681.28 935.11,-23545.28 1639.65,-23545.28 1820.89,-23681.28"/>
<text text-anchor="middle" x="1378" y="-23632.08" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1378" y="-23617.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-23602.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-23587.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_attn_reduce&#45;&gt;stage0_layer3_residual1 -->
<g id="edge106" class="edge">
<title>stage0_layer3_attn_reduce&#45;&gt;stage0_layer3_residual1</title>
<path fill="none" stroke="black" d="M1378,-23716.88C1378,-23708.79 1378,-23700.21 1378,-23691.59"/>
<polygon fill="black" stroke="black" points="1381.5,-23691.48 1378,-23681.48 1374.5,-23691.48 1381.5,-23691.48"/>
</g>
<!-- stage0_layer3_layernorm2 -->
<g id="node99" class="node">
<title>stage0_layer3_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-23509.28 1174.5,-23509.28 1174.5,-23441.28 1581.5,-23441.28 1581.5,-23509.28"/>
<text text-anchor="middle" x="1378" y="-23494.08" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1378" y="-23479.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-23464.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-23449.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_residual1&#45;&gt;stage0_layer3_layernorm2 -->
<g id="edge107" class="edge">
<title>stage0_layer3_residual1&#45;&gt;stage0_layer3_layernorm2</title>
<path fill="none" stroke="black" d="M1378,-23545.08C1378,-23536.33 1378,-23527.56 1378,-23519.35"/>
<polygon fill="black" stroke="black" points="1381.5,-23519.3 1378,-23509.3 1374.5,-23519.3 1381.5,-23519.3"/>
</g>
<!-- stage0_layer3_expert0_gate -->
<g id="node100" class="node">
<title>stage0_layer3_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="910.5,-23405.28 487.5,-23405.28 487.5,-23337.28 910.5,-23337.28 910.5,-23405.28"/>
<text text-anchor="middle" x="699" y="-23390.08" font-family="Times,serif" font-size="14.00">Expert Gate 48</text>
<text text-anchor="middle" x="699" y="-23375.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="699" y="-23360.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="699" y="-23345.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_layernorm2&#45;&gt;stage0_layer3_expert0_gate -->
<g id="edge108" class="edge">
<title>stage0_layer3_layernorm2&#45;&gt;stage0_layer3_expert0_gate</title>
<path fill="none" stroke="black" d="M1174.28,-23443.68C1094.23,-23431.65 1002.12,-23417.82 920.43,-23405.55"/>
<polygon fill="black" stroke="black" points="920.93,-23402.08 910.53,-23404.06 919.9,-23409 920.93,-23402.08"/>
</g>
<!-- stage0_layer3_expert1_gate -->
<g id="node105" class="node">
<title>stage0_layer3_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1363.5,-23405.28 940.5,-23405.28 940.5,-23337.28 1363.5,-23337.28 1363.5,-23405.28"/>
<text text-anchor="middle" x="1152" y="-23390.08" font-family="Times,serif" font-size="14.00">Expert Gate 49</text>
<text text-anchor="middle" x="1152" y="-23375.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1152" y="-23360.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1152" y="-23345.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_layernorm2&#45;&gt;stage0_layer3_expert1_gate -->
<g id="edge114" class="edge">
<title>stage0_layer3_layernorm2&#45;&gt;stage0_layer3_expert1_gate</title>
<path fill="none" stroke="black" d="M1304.62,-23441.16C1282.31,-23431.09 1257.63,-23419.96 1234.74,-23409.62"/>
<polygon fill="black" stroke="black" points="1235.95,-23406.33 1225.39,-23405.41 1233.07,-23412.71 1235.95,-23406.33"/>
</g>
<!-- stage0_layer3_expert2_gate -->
<g id="node110" class="node">
<title>stage0_layer3_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1816.5,-23405.28 1393.5,-23405.28 1393.5,-23337.28 1816.5,-23337.28 1816.5,-23405.28"/>
<text text-anchor="middle" x="1605" y="-23390.08" font-family="Times,serif" font-size="14.00">Expert Gate 50</text>
<text text-anchor="middle" x="1605" y="-23375.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1605" y="-23360.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1605" y="-23345.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_layernorm2&#45;&gt;stage0_layer3_expert2_gate -->
<g id="edge120" class="edge">
<title>stage0_layer3_layernorm2&#45;&gt;stage0_layer3_expert2_gate</title>
<path fill="none" stroke="black" d="M1451.7,-23441.16C1474.12,-23431.09 1498.9,-23419.96 1521.89,-23409.62"/>
<polygon fill="black" stroke="black" points="1523.59,-23412.7 1531.28,-23405.41 1520.73,-23406.31 1523.59,-23412.7"/>
</g>
<!-- stage0_layer3_expert3_gate -->
<g id="node115" class="node">
<title>stage0_layer3_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2275.5,-23405.28 1852.5,-23405.28 1852.5,-23337.28 2275.5,-23337.28 2275.5,-23405.28"/>
<text text-anchor="middle" x="2064" y="-23390.08" font-family="Times,serif" font-size="14.00">Expert Gate 51</text>
<text text-anchor="middle" x="2064" y="-23375.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2064" y="-23360.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2064" y="-23345.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_layernorm2&#45;&gt;stage0_layer3_expert3_gate -->
<g id="edge126" class="edge">
<title>stage0_layer3_layernorm2&#45;&gt;stage0_layer3_expert3_gate</title>
<path fill="none" stroke="black" d="M1581.5,-23444.02C1663.58,-23431.82 1758.5,-23417.71 1842.32,-23405.24"/>
<polygon fill="black" stroke="black" points="1842.84,-23408.7 1852.22,-23403.77 1841.82,-23401.78 1842.84,-23408.7"/>
</g>
<!-- stage0_layer3_expert0_mlp1 -->
<g id="node101" class="node">
<title>stage0_layer3_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="901.5,-23301.28 454.5,-23301.28 454.5,-23233.28 901.5,-23233.28 901.5,-23301.28"/>
<text text-anchor="middle" x="678" y="-23286.08" font-family="Times,serif" font-size="14.00">Expert 48 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="678" y="-23271.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="678" y="-23256.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="678" y="-23241.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert0_gate&#45;&gt;stage0_layer3_expert0_mlp1 -->
<g id="edge109" class="edge">
<title>stage0_layer3_expert0_gate&#45;&gt;stage0_layer3_expert0_mlp1</title>
<path fill="none" stroke="black" d="M692.18,-23337.16C690.49,-23328.97 688.66,-23320.07 686.89,-23311.47"/>
<polygon fill="black" stroke="black" points="690.3,-23310.67 684.86,-23301.58 683.44,-23312.08 690.3,-23310.67"/>
</g>
<!-- stage0_layer3_expert0_act -->
<g id="node102" class="node">
<title>stage0_layer3_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="860.5,-23197.28 413.5,-23197.28 413.5,-23129.28 860.5,-23129.28 860.5,-23197.28"/>
<text text-anchor="middle" x="637" y="-23182.08" font-family="Times,serif" font-size="14.00">Expert 48 Activation</text>
<text text-anchor="middle" x="637" y="-23167.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-23152.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-23137.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert0_mlp1&#45;&gt;stage0_layer3_expert0_act -->
<g id="edge110" class="edge">
<title>stage0_layer3_expert0_mlp1&#45;&gt;stage0_layer3_expert0_act</title>
<path fill="none" stroke="black" d="M664.69,-23233.16C661.32,-23224.79 657.66,-23215.68 654.14,-23206.91"/>
<polygon fill="black" stroke="black" points="657.36,-23205.55 650.39,-23197.58 650.87,-23208.16 657.36,-23205.55"/>
</g>
<!-- stage0_layer3_expert0_mlp2 -->
<g id="node103" class="node">
<title>stage0_layer3_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="719.5,-23093.28 242.5,-23093.28 242.5,-23025.28 719.5,-23025.28 719.5,-23093.28"/>
<text text-anchor="middle" x="481" y="-23078.08" font-family="Times,serif" font-size="14.00">Expert 48 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="481" y="-23063.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="481" y="-23048.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="481" y="-23033.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert0_act&#45;&gt;stage0_layer3_expert0_mlp2 -->
<g id="edge111" class="edge">
<title>stage0_layer3_expert0_act&#45;&gt;stage0_layer3_expert0_mlp2</title>
<path fill="none" stroke="black" d="M586.35,-23129.16C571.7,-23119.59 555.58,-23109.04 540.44,-23099.15"/>
<polygon fill="black" stroke="black" points="541.95,-23095.95 531.66,-23093.41 538.12,-23101.81 541.95,-23095.95"/>
</g>
<!-- stage0_layer3_expert0_reduce -->
<g id="node104" class="node">
<title>stage0_layer3_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-22941.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-22960" font-family="Times,serif" font-size="14.00">Expert 48 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-22945" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-22930" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-22915" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert0_mlp2&#45;&gt;stage0_layer3_expert0_reduce -->
<g id="edge112" class="edge">
<title>stage0_layer3_expert0_mlp2&#45;&gt;stage0_layer3_expert0_reduce</title>
<path fill="none" stroke="black" d="M442.03,-23025.02C431.15,-23015.73 419.04,-23005.4 407.18,-22995.27"/>
<polygon fill="black" stroke="black" points="409.31,-22992.49 399.43,-22988.66 404.77,-22997.81 409.31,-22992.49"/>
</g>
<!-- stage0_layer3_expert_agg -->
<g id="node120" class="node">
<title>stage0_layer3_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-22857.11 1116.35,-22857.11 935.11,-22721.11 1639.65,-22721.11 1820.89,-22857.11"/>
<text text-anchor="middle" x="1378" y="-22807.91" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1378" y="-22792.91" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1378" y="-22777.91" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-22762.91" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert0_reduce&#45;&gt;stage0_layer3_expert_agg -->
<g id="edge113" class="edge">
<title>stage0_layer3_expert0_reduce&#45;&gt;stage0_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M574.9,-22906.8C721.93,-22885.43 914.31,-22857.48 1073.92,-22834.29"/>
<polygon fill="black" stroke="black" points="1074.51,-22837.75 1083.9,-22832.84 1073.5,-22830.82 1074.51,-22837.75"/>
</g>
<!-- stage0_layer3_expert1_mlp1 -->
<g id="node106" class="node">
<title>stage0_layer3_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1366.5,-23301.28 919.5,-23301.28 919.5,-23233.28 1366.5,-23233.28 1366.5,-23301.28"/>
<text text-anchor="middle" x="1143" y="-23286.08" font-family="Times,serif" font-size="14.00">Expert 49 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1143" y="-23271.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1143" y="-23256.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1143" y="-23241.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert1_gate&#45;&gt;stage0_layer3_expert1_mlp1 -->
<g id="edge115" class="edge">
<title>stage0_layer3_expert1_gate&#45;&gt;stage0_layer3_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1149.08,-23337.16C1148.36,-23329.06 1147.59,-23320.26 1146.84,-23311.75"/>
<polygon fill="black" stroke="black" points="1150.3,-23311.23 1145.94,-23301.58 1143.33,-23311.85 1150.3,-23311.23"/>
</g>
<!-- stage0_layer3_expert1_act -->
<g id="node107" class="node">
<title>stage0_layer3_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1340.5,-23197.28 893.5,-23197.28 893.5,-23129.28 1340.5,-23129.28 1340.5,-23197.28"/>
<text text-anchor="middle" x="1117" y="-23182.08" font-family="Times,serif" font-size="14.00">Expert 49 Activation</text>
<text text-anchor="middle" x="1117" y="-23167.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-23152.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-23137.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert1_mlp1&#45;&gt;stage0_layer3_expert1_act -->
<g id="edge116" class="edge">
<title>stage0_layer3_expert1_mlp1&#45;&gt;stage0_layer3_expert1_act</title>
<path fill="none" stroke="black" d="M1134.56,-23233.16C1132.47,-23224.97 1130.2,-23216.07 1128.01,-23207.47"/>
<polygon fill="black" stroke="black" points="1131.35,-23206.41 1125.49,-23197.58 1124.57,-23208.14 1131.35,-23206.41"/>
</g>
<!-- stage0_layer3_expert1_mlp2 -->
<g id="node108" class="node">
<title>stage0_layer3_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-23093.28 827.5,-23093.28 827.5,-23025.28 1304.5,-23025.28 1304.5,-23093.28"/>
<text text-anchor="middle" x="1066" y="-23078.08" font-family="Times,serif" font-size="14.00">Expert 49 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-23063.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-23048.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-23033.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert1_act&#45;&gt;stage0_layer3_expert1_mlp2 -->
<g id="edge117" class="edge">
<title>stage0_layer3_expert1_act&#45;&gt;stage0_layer3_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1100.44,-23129.16C1096.21,-23120.7 1091.6,-23111.49 1087.18,-23102.63"/>
<polygon fill="black" stroke="black" points="1090.25,-23100.96 1082.65,-23093.58 1083.99,-23104.09 1090.25,-23100.96"/>
</g>
<!-- stage0_layer3_expert1_reduce -->
<g id="node109" class="node">
<title>stage0_layer3_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-22941.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-22960" font-family="Times,serif" font-size="14.00">Expert 49 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-22945" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-22930" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-22915" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert1_mlp2&#45;&gt;stage0_layer3_expert1_reduce -->
<g id="edge118" class="edge">
<title>stage0_layer3_expert1_mlp2&#45;&gt;stage0_layer3_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.1,-23025.02C1049.91,-23016.76 1046.39,-23007.68 1042.89,-22998.66"/>
<polygon fill="black" stroke="black" points="1046.14,-22997.37 1039.26,-22989.31 1039.61,-22999.9 1046.14,-22997.37"/>
</g>
<!-- stage0_layer3_expert1_reduce&#45;&gt;stage0_layer3_expert_agg -->
<g id="edge119" class="edge">
<title>stage0_layer3_expert1_reduce&#45;&gt;stage0_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M1127.15,-22895.57C1152.91,-22884.74 1181.09,-22872.9 1208.96,-22861.18"/>
<polygon fill="black" stroke="black" points="1210.53,-22864.32 1218.39,-22857.21 1207.82,-22857.86 1210.53,-22864.32"/>
</g>
<!-- stage0_layer3_expert2_mlp1 -->
<g id="node111" class="node">
<title>stage0_layer3_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1838.5,-23301.28 1391.5,-23301.28 1391.5,-23233.28 1838.5,-23233.28 1838.5,-23301.28"/>
<text text-anchor="middle" x="1615" y="-23286.08" font-family="Times,serif" font-size="14.00">Expert 50 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1615" y="-23271.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1615" y="-23256.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1615" y="-23241.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert2_gate&#45;&gt;stage0_layer3_expert2_mlp1 -->
<g id="edge121" class="edge">
<title>stage0_layer3_expert2_gate&#45;&gt;stage0_layer3_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1608.25,-23337.16C1609.04,-23329.06 1609.9,-23320.26 1610.74,-23311.75"/>
<polygon fill="black" stroke="black" points="1614.24,-23311.87 1611.74,-23301.58 1607.28,-23311.19 1614.24,-23311.87"/>
</g>
<!-- stage0_layer3_expert2_act -->
<g id="node112" class="node">
<title>stage0_layer3_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1848.5,-23197.28 1401.5,-23197.28 1401.5,-23129.28 1848.5,-23129.28 1848.5,-23197.28"/>
<text text-anchor="middle" x="1625" y="-23182.08" font-family="Times,serif" font-size="14.00">Expert 50 Activation</text>
<text text-anchor="middle" x="1625" y="-23167.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-23152.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-23137.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert2_mlp1&#45;&gt;stage0_layer3_expert2_act -->
<g id="edge122" class="edge">
<title>stage0_layer3_expert2_mlp1&#45;&gt;stage0_layer3_expert2_act</title>
<path fill="none" stroke="black" d="M1618.25,-23233.16C1619.04,-23225.06 1619.9,-23216.26 1620.74,-23207.75"/>
<polygon fill="black" stroke="black" points="1624.24,-23207.87 1621.74,-23197.58 1617.28,-23207.19 1624.24,-23207.87"/>
</g>
<!-- stage0_layer3_expert2_mlp2 -->
<g id="node113" class="node">
<title>stage0_layer3_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1889.5,-23093.28 1412.5,-23093.28 1412.5,-23025.28 1889.5,-23025.28 1889.5,-23093.28"/>
<text text-anchor="middle" x="1651" y="-23078.08" font-family="Times,serif" font-size="14.00">Expert 50 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1651" y="-23063.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1651" y="-23048.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1651" y="-23033.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert2_act&#45;&gt;stage0_layer3_expert2_mlp2 -->
<g id="edge123" class="edge">
<title>stage0_layer3_expert2_act&#45;&gt;stage0_layer3_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1633.44,-23129.16C1635.53,-23120.97 1637.8,-23112.07 1639.99,-23103.47"/>
<polygon fill="black" stroke="black" points="1643.43,-23104.14 1642.51,-23093.58 1636.65,-23102.41 1643.43,-23104.14"/>
</g>
<!-- stage0_layer3_expert2_reduce -->
<g id="node114" class="node">
<title>stage0_layer3_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-22941.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-22960" font-family="Times,serif" font-size="14.00">Expert 50 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-22945" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-22930" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-22915" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert2_mlp2&#45;&gt;stage0_layer3_expert2_reduce -->
<g id="edge124" class="edge">
<title>stage0_layer3_expert2_mlp2&#45;&gt;stage0_layer3_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.18,-23025.02C1667.45,-23016.76 1671.05,-23007.68 1674.63,-22998.66"/>
<polygon fill="black" stroke="black" points="1677.9,-22999.89 1678.33,-22989.31 1671.39,-22997.31 1677.9,-22999.89"/>
</g>
<!-- stage0_layer3_expert2_reduce&#45;&gt;stage0_layer3_expert_agg -->
<g id="edge125" class="edge">
<title>stage0_layer3_expert2_reduce&#45;&gt;stage0_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M1601.29,-22895.17C1578.75,-22884.56 1554.18,-22873 1529.84,-22861.55"/>
<polygon fill="black" stroke="black" points="1531.07,-22858.26 1520.53,-22857.17 1528.09,-22864.6 1531.07,-22858.26"/>
</g>
<!-- stage0_layer3_expert3_mlp1 -->
<g id="node116" class="node">
<title>stage0_layer3_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2307.5,-23301.28 1860.5,-23301.28 1860.5,-23233.28 2307.5,-23233.28 2307.5,-23301.28"/>
<text text-anchor="middle" x="2084" y="-23286.08" font-family="Times,serif" font-size="14.00">Expert 51 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2084" y="-23271.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2084" y="-23256.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2084" y="-23241.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert3_gate&#45;&gt;stage0_layer3_expert3_mlp1 -->
<g id="edge127" class="edge">
<title>stage0_layer3_expert3_gate&#45;&gt;stage0_layer3_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2070.49,-23337.16C2072.1,-23328.97 2073.85,-23320.07 2075.53,-23311.47"/>
<polygon fill="black" stroke="black" points="2078.98,-23312.07 2077.47,-23301.58 2072.11,-23310.72 2078.98,-23312.07"/>
</g>
<!-- stage0_layer3_expert3_act -->
<g id="node117" class="node">
<title>stage0_layer3_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2322.5,-23197.28 1875.5,-23197.28 1875.5,-23129.28 2322.5,-23129.28 2322.5,-23197.28"/>
<text text-anchor="middle" x="2099" y="-23182.08" font-family="Times,serif" font-size="14.00">Expert 51 Activation</text>
<text text-anchor="middle" x="2099" y="-23167.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-23152.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-23137.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert3_mlp1&#45;&gt;stage0_layer3_expert3_act -->
<g id="edge128" class="edge">
<title>stage0_layer3_expert3_mlp1&#45;&gt;stage0_layer3_expert3_act</title>
<path fill="none" stroke="black" d="M2088.87,-23233.16C2090.06,-23225.06 2091.36,-23216.26 2092.61,-23207.75"/>
<polygon fill="black" stroke="black" points="2096.11,-23207.98 2094.1,-23197.58 2089.19,-23206.96 2096.11,-23207.98"/>
</g>
<!-- stage0_layer3_expert3_mlp2 -->
<g id="node118" class="node">
<title>stage0_layer3_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2520.5,-23093.28 2043.5,-23093.28 2043.5,-23025.28 2520.5,-23025.28 2520.5,-23093.28"/>
<text text-anchor="middle" x="2282" y="-23078.08" font-family="Times,serif" font-size="14.00">Expert 51 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2282" y="-23063.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2282" y="-23048.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2282" y="-23033.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert3_act&#45;&gt;stage0_layer3_expert3_mlp2 -->
<g id="edge129" class="edge">
<title>stage0_layer3_expert3_act&#45;&gt;stage0_layer3_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2158.41,-23129.16C2176.08,-23119.32 2195.58,-23108.45 2213.76,-23098.31"/>
<polygon fill="black" stroke="black" points="2215.54,-23101.33 2222.57,-23093.41 2212.13,-23095.22 2215.54,-23101.33"/>
</g>
<!-- stage0_layer3_expert3_reduce -->
<g id="node119" class="node">
<title>stage0_layer3_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-22941.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-22960" font-family="Times,serif" font-size="14.00">Expert 51 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-22945" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-22930" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-22915" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert3_mlp2&#45;&gt;stage0_layer3_expert3_reduce -->
<g id="edge130" class="edge">
<title>stage0_layer3_expert3_mlp2&#45;&gt;stage0_layer3_expert3_reduce</title>
<path fill="none" stroke="black" d="M2308.08,-23025.02C2314.89,-23016.33 2322.41,-23006.73 2329.86,-22997.23"/>
<polygon fill="black" stroke="black" points="2332.65,-22999.34 2336.07,-22989.31 2327.15,-22995.02 2332.65,-22999.34"/>
</g>
<!-- stage0_layer3_expert3_reduce&#45;&gt;stage0_layer3_expert_agg -->
<g id="edge131" class="edge">
<title>stage0_layer3_expert3_reduce&#45;&gt;stage0_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M2147.53,-22906.19C2053.41,-22891.99 1940.53,-22874.96 1830.59,-22858.38"/>
<polygon fill="black" stroke="black" points="1831.06,-22854.91 1820.65,-22856.88 1830.02,-22861.84 1831.06,-22854.91"/>
</g>
<!-- stage0_layer3_residual2 -->
<g id="node121" class="node">
<title>stage0_layer3_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-22685.11 1116.35,-22685.11 935.11,-22549.11 1639.65,-22549.11 1820.89,-22685.11"/>
<text text-anchor="middle" x="1378" y="-22635.91" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1378" y="-22620.91" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-22605.91" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-22590.91" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_expert_agg&#45;&gt;stage0_layer3_residual2 -->
<g id="edge132" class="edge">
<title>stage0_layer3_expert_agg&#45;&gt;stage0_layer3_residual2</title>
<path fill="none" stroke="black" d="M1378,-22720.93C1378,-22712.61 1378,-22704.06 1378,-22695.61"/>
<polygon fill="black" stroke="black" points="1381.5,-22695.37 1378,-22685.37 1374.5,-22695.37 1381.5,-22695.37"/>
</g>
<!-- stage0_layer4_layernorm -->
<g id="node122" class="node">
<title>stage0_layer4_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-22502.11 1174.5,-22502.11 1174.5,-22434.11 1581.5,-22434.11 1581.5,-22502.11"/>
<text text-anchor="middle" x="1378" y="-22486.91" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1378" y="-22471.91" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-22456.91" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-22441.91" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer3_residual2&#45;&gt;stage0_layer4_layernorm -->
<g id="edge133" class="edge">
<title>stage0_layer3_residual2&#45;&gt;stage0_layer4_layernorm</title>
<path fill="none" stroke="black" d="M1378,-22549.07C1378,-22536.66 1378,-22524.01 1378,-22512.53"/>
<polygon fill="black" stroke="black" points="1381.5,-22512.37 1378,-22502.37 1374.5,-22512.37 1381.5,-22512.37"/>
</g>
<!-- stage0_layer4_qkv_proj -->
<g id="node123" class="node">
<title>stage0_layer4_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-22398.11 1120.5,-22398.11 1120.5,-22330.11 1635.5,-22330.11 1635.5,-22398.11"/>
<text text-anchor="middle" x="1378" y="-22382.91" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-22367.91" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-22352.91" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-22337.91" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_layernorm&#45;&gt;stage0_layer4_qkv_proj -->
<g id="edge134" class="edge">
<title>stage0_layer4_layernorm&#45;&gt;stage0_layer4_qkv_proj</title>
<path fill="none" stroke="black" d="M1378,-22434C1378,-22425.89 1378,-22417.1 1378,-22408.59"/>
<polygon fill="black" stroke="black" points="1381.5,-22408.41 1378,-22398.41 1374.5,-22408.41 1381.5,-22408.41"/>
</g>
<!-- stage0_layer4_qkv_gather -->
<g id="node124" class="node">
<title>stage0_layer4_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-22246.03" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-22264.83" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1378" y="-22249.83" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1378" y="-22234.83" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-22219.83" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_qkv_proj&#45;&gt;stage0_layer4_qkv_gather -->
<g id="edge135" class="edge">
<title>stage0_layer4_qkv_proj&#45;&gt;stage0_layer4_qkv_gather</title>
<path fill="none" stroke="black" d="M1378,-22329.85C1378,-22321.86 1378,-22313.09 1378,-22304.35"/>
<polygon fill="black" stroke="black" points="1381.5,-22304.14 1378,-22294.14 1374.5,-22304.14 1381.5,-22304.14"/>
</g>
<!-- stage0_layer4_attention -->
<g id="node125" class="node">
<title>stage0_layer4_attention</title>
<polygon fill="lightgreen" stroke="black" points="1629.5,-22161.95 1126.5,-22161.95 1126.5,-22093.95 1629.5,-22093.95 1629.5,-22161.95"/>
<text text-anchor="middle" x="1378" y="-22146.75" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1378" y="-22131.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-22116.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-22101.75" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_qkv_gather&#45;&gt;stage0_layer4_attention -->
<g id="edge136" class="edge">
<title>stage0_layer4_qkv_gather&#45;&gt;stage0_layer4_attention</title>
<path fill="none" stroke="black" d="M1378,-22197.82C1378,-22189.43 1378,-22180.73 1378,-22172.46"/>
<polygon fill="black" stroke="black" points="1381.5,-22172.25 1378,-22162.25 1374.5,-22172.25 1381.5,-22172.25"/>
</g>
<!-- stage0_layer4_attn_out -->
<g id="node126" class="node">
<title>stage0_layer4_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1616.5,-22057.95 1139.5,-22057.95 1139.5,-21989.95 1616.5,-21989.95 1616.5,-22057.95"/>
<text text-anchor="middle" x="1378" y="-22042.75" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-22027.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-22012.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-21997.75" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_attention&#45;&gt;stage0_layer4_attn_out -->
<g id="edge137" class="edge">
<title>stage0_layer4_attention&#45;&gt;stage0_layer4_attn_out</title>
<path fill="none" stroke="black" d="M1378,-22093.83C1378,-22085.73 1378,-22076.93 1378,-22068.42"/>
<polygon fill="black" stroke="black" points="1381.5,-22068.25 1378,-22058.25 1374.5,-22068.25 1381.5,-22068.25"/>
</g>
<!-- stage0_layer4_attn_reduce -->
<g id="node127" class="node">
<title>stage0_layer4_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-21905.86" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-21924.66" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1378" y="-21909.66" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-21894.66" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-21879.66" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_attn_out&#45;&gt;stage0_layer4_attn_reduce -->
<g id="edge138" class="edge">
<title>stage0_layer4_attn_out&#45;&gt;stage0_layer4_attn_reduce</title>
<path fill="none" stroke="black" d="M1378,-21989.68C1378,-21981.69 1378,-21972.92 1378,-21964.18"/>
<polygon fill="black" stroke="black" points="1381.5,-21963.97 1378,-21953.97 1374.5,-21963.97 1381.5,-21963.97"/>
</g>
<!-- stage0_layer4_residual1 -->
<g id="node128" class="node">
<title>stage0_layer4_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-21821.78 1116.35,-21821.78 935.11,-21685.78 1639.65,-21685.78 1820.89,-21821.78"/>
<text text-anchor="middle" x="1378" y="-21772.58" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1378" y="-21757.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-21742.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-21727.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_attn_reduce&#45;&gt;stage0_layer4_residual1 -->
<g id="edge139" class="edge">
<title>stage0_layer4_attn_reduce&#45;&gt;stage0_layer4_residual1</title>
<path fill="none" stroke="black" d="M1378,-21857.38C1378,-21849.29 1378,-21840.71 1378,-21832.09"/>
<polygon fill="black" stroke="black" points="1381.5,-21831.98 1378,-21821.98 1374.5,-21831.98 1381.5,-21831.98"/>
</g>
<!-- stage0_layer4_layernorm2 -->
<g id="node129" class="node">
<title>stage0_layer4_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-21649.78 1174.5,-21649.78 1174.5,-21581.78 1581.5,-21581.78 1581.5,-21649.78"/>
<text text-anchor="middle" x="1378" y="-21634.58" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1378" y="-21619.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-21604.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-21589.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_residual1&#45;&gt;stage0_layer4_layernorm2 -->
<g id="edge140" class="edge">
<title>stage0_layer4_residual1&#45;&gt;stage0_layer4_layernorm2</title>
<path fill="none" stroke="black" d="M1378,-21685.58C1378,-21676.83 1378,-21668.06 1378,-21659.85"/>
<polygon fill="black" stroke="black" points="1381.5,-21659.8 1378,-21649.8 1374.5,-21659.8 1381.5,-21659.8"/>
</g>
<!-- stage0_layer4_expert0_gate -->
<g id="node130" class="node">
<title>stage0_layer4_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="910.5,-21545.78 487.5,-21545.78 487.5,-21477.78 910.5,-21477.78 910.5,-21545.78"/>
<text text-anchor="middle" x="699" y="-21530.58" font-family="Times,serif" font-size="14.00">Expert Gate 64</text>
<text text-anchor="middle" x="699" y="-21515.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="699" y="-21500.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="699" y="-21485.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_layernorm2&#45;&gt;stage0_layer4_expert0_gate -->
<g id="edge141" class="edge">
<title>stage0_layer4_layernorm2&#45;&gt;stage0_layer4_expert0_gate</title>
<path fill="none" stroke="black" d="M1174.28,-21584.18C1094.23,-21572.15 1002.12,-21558.32 920.43,-21546.05"/>
<polygon fill="black" stroke="black" points="920.93,-21542.58 910.53,-21544.56 919.9,-21549.5 920.93,-21542.58"/>
</g>
<!-- stage0_layer4_expert1_gate -->
<g id="node135" class="node">
<title>stage0_layer4_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1363.5,-21545.78 940.5,-21545.78 940.5,-21477.78 1363.5,-21477.78 1363.5,-21545.78"/>
<text text-anchor="middle" x="1152" y="-21530.58" font-family="Times,serif" font-size="14.00">Expert Gate 65</text>
<text text-anchor="middle" x="1152" y="-21515.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1152" y="-21500.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1152" y="-21485.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_layernorm2&#45;&gt;stage0_layer4_expert1_gate -->
<g id="edge147" class="edge">
<title>stage0_layer4_layernorm2&#45;&gt;stage0_layer4_expert1_gate</title>
<path fill="none" stroke="black" d="M1304.62,-21581.67C1282.31,-21571.59 1257.63,-21560.46 1234.74,-21550.13"/>
<polygon fill="black" stroke="black" points="1235.95,-21546.83 1225.39,-21545.91 1233.07,-21553.21 1235.95,-21546.83"/>
</g>
<!-- stage0_layer4_expert2_gate -->
<g id="node140" class="node">
<title>stage0_layer4_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1816.5,-21545.78 1393.5,-21545.78 1393.5,-21477.78 1816.5,-21477.78 1816.5,-21545.78"/>
<text text-anchor="middle" x="1605" y="-21530.58" font-family="Times,serif" font-size="14.00">Expert Gate 66</text>
<text text-anchor="middle" x="1605" y="-21515.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1605" y="-21500.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1605" y="-21485.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_layernorm2&#45;&gt;stage0_layer4_expert2_gate -->
<g id="edge153" class="edge">
<title>stage0_layer4_layernorm2&#45;&gt;stage0_layer4_expert2_gate</title>
<path fill="none" stroke="black" d="M1451.7,-21581.67C1474.12,-21571.59 1498.9,-21560.46 1521.89,-21550.13"/>
<polygon fill="black" stroke="black" points="1523.59,-21553.2 1531.28,-21545.91 1520.73,-21546.81 1523.59,-21553.2"/>
</g>
<!-- stage0_layer4_expert3_gate -->
<g id="node145" class="node">
<title>stage0_layer4_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2275.5,-21545.78 1852.5,-21545.78 1852.5,-21477.78 2275.5,-21477.78 2275.5,-21545.78"/>
<text text-anchor="middle" x="2064" y="-21530.58" font-family="Times,serif" font-size="14.00">Expert Gate 67</text>
<text text-anchor="middle" x="2064" y="-21515.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2064" y="-21500.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2064" y="-21485.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_layernorm2&#45;&gt;stage0_layer4_expert3_gate -->
<g id="edge159" class="edge">
<title>stage0_layer4_layernorm2&#45;&gt;stage0_layer4_expert3_gate</title>
<path fill="none" stroke="black" d="M1581.5,-21584.52C1663.58,-21572.32 1758.5,-21558.21 1842.32,-21545.74"/>
<polygon fill="black" stroke="black" points="1842.84,-21549.2 1852.22,-21544.27 1841.82,-21542.28 1842.84,-21549.2"/>
</g>
<!-- stage0_layer4_expert0_mlp1 -->
<g id="node131" class="node">
<title>stage0_layer4_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="880.5,-21441.78 433.5,-21441.78 433.5,-21373.78 880.5,-21373.78 880.5,-21441.78"/>
<text text-anchor="middle" x="657" y="-21426.58" font-family="Times,serif" font-size="14.00">Expert 64 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="657" y="-21411.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="657" y="-21396.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="657" y="-21381.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert0_gate&#45;&gt;stage0_layer4_expert0_mlp1 -->
<g id="edge142" class="edge">
<title>stage0_layer4_expert0_gate&#45;&gt;stage0_layer4_expert0_mlp1</title>
<path fill="none" stroke="black" d="M685.36,-21477.67C681.92,-21469.29 678.17,-21460.18 674.55,-21451.41"/>
<polygon fill="black" stroke="black" points="677.76,-21450 670.71,-21442.08 671.28,-21452.66 677.76,-21450"/>
</g>
<!-- stage0_layer4_expert0_act -->
<g id="node132" class="node">
<title>stage0_layer4_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="860.5,-21337.78 413.5,-21337.78 413.5,-21269.78 860.5,-21269.78 860.5,-21337.78"/>
<text text-anchor="middle" x="637" y="-21322.58" font-family="Times,serif" font-size="14.00">Expert 64 Activation</text>
<text text-anchor="middle" x="637" y="-21307.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-21292.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-21277.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert0_mlp1&#45;&gt;stage0_layer4_expert0_act -->
<g id="edge143" class="edge">
<title>stage0_layer4_expert0_mlp1&#45;&gt;stage0_layer4_expert0_act</title>
<path fill="none" stroke="black" d="M650.51,-21373.67C648.9,-21365.47 647.15,-21356.57 645.47,-21347.97"/>
<polygon fill="black" stroke="black" points="648.89,-21347.22 643.53,-21338.08 642.02,-21348.57 648.89,-21347.22"/>
</g>
<!-- stage0_layer4_expert0_mlp2 -->
<g id="node133" class="node">
<title>stage0_layer4_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="719.5,-21233.78 242.5,-21233.78 242.5,-21165.78 719.5,-21165.78 719.5,-21233.78"/>
<text text-anchor="middle" x="481" y="-21218.58" font-family="Times,serif" font-size="14.00">Expert 64 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="481" y="-21203.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="481" y="-21188.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="481" y="-21173.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert0_act&#45;&gt;stage0_layer4_expert0_mlp2 -->
<g id="edge144" class="edge">
<title>stage0_layer4_expert0_act&#45;&gt;stage0_layer4_expert0_mlp2</title>
<path fill="none" stroke="black" d="M586.35,-21269.67C571.7,-21260.09 555.58,-21249.54 540.44,-21239.65"/>
<polygon fill="black" stroke="black" points="541.95,-21236.45 531.66,-21233.91 538.12,-21242.31 541.95,-21236.45"/>
</g>
<!-- stage0_layer4_expert0_reduce -->
<g id="node134" class="node">
<title>stage0_layer4_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-21081.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-21100.5" font-family="Times,serif" font-size="14.00">Expert 64 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-21085.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-21070.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-21055.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert0_mlp2&#45;&gt;stage0_layer4_expert0_reduce -->
<g id="edge145" class="edge">
<title>stage0_layer4_expert0_mlp2&#45;&gt;stage0_layer4_expert0_reduce</title>
<path fill="none" stroke="black" d="M442.03,-21165.52C431.15,-21156.23 419.04,-21145.9 407.18,-21135.77"/>
<polygon fill="black" stroke="black" points="409.31,-21132.99 399.43,-21129.16 404.77,-21138.31 409.31,-21132.99"/>
</g>
<!-- stage0_layer4_expert_agg -->
<g id="node150" class="node">
<title>stage0_layer4_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-20997.62 1116.35,-20997.62 935.11,-20861.62 1639.65,-20861.62 1820.89,-20997.62"/>
<text text-anchor="middle" x="1378" y="-20948.42" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1378" y="-20933.42" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1378" y="-20918.42" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-20903.42" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert0_reduce&#45;&gt;stage0_layer4_expert_agg -->
<g id="edge146" class="edge">
<title>stage0_layer4_expert0_reduce&#45;&gt;stage0_layer4_expert_agg</title>
<path fill="none" stroke="black" d="M574.9,-21047.3C721.93,-21025.93 914.31,-20997.98 1073.92,-20974.79"/>
<polygon fill="black" stroke="black" points="1074.51,-20978.25 1083.9,-20973.34 1073.5,-20971.32 1074.51,-20978.25"/>
</g>
<!-- stage0_layer4_expert1_mlp1 -->
<g id="node136" class="node">
<title>stage0_layer4_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1366.5,-21441.78 919.5,-21441.78 919.5,-21373.78 1366.5,-21373.78 1366.5,-21441.78"/>
<text text-anchor="middle" x="1143" y="-21426.58" font-family="Times,serif" font-size="14.00">Expert 65 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1143" y="-21411.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1143" y="-21396.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1143" y="-21381.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert1_gate&#45;&gt;stage0_layer4_expert1_mlp1 -->
<g id="edge148" class="edge">
<title>stage0_layer4_expert1_gate&#45;&gt;stage0_layer4_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1149.08,-21477.67C1148.36,-21469.56 1147.59,-21460.76 1146.84,-21452.25"/>
<polygon fill="black" stroke="black" points="1150.3,-21451.73 1145.94,-21442.08 1143.33,-21452.35 1150.3,-21451.73"/>
</g>
<!-- stage0_layer4_expert1_act -->
<g id="node137" class="node">
<title>stage0_layer4_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1340.5,-21337.78 893.5,-21337.78 893.5,-21269.78 1340.5,-21269.78 1340.5,-21337.78"/>
<text text-anchor="middle" x="1117" y="-21322.58" font-family="Times,serif" font-size="14.00">Expert 65 Activation</text>
<text text-anchor="middle" x="1117" y="-21307.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-21292.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-21277.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert1_mlp1&#45;&gt;stage0_layer4_expert1_act -->
<g id="edge149" class="edge">
<title>stage0_layer4_expert1_mlp1&#45;&gt;stage0_layer4_expert1_act</title>
<path fill="none" stroke="black" d="M1134.56,-21373.67C1132.47,-21365.47 1130.2,-21356.57 1128.01,-21347.97"/>
<polygon fill="black" stroke="black" points="1131.35,-21346.91 1125.49,-21338.08 1124.57,-21348.64 1131.35,-21346.91"/>
</g>
<!-- stage0_layer4_expert1_mlp2 -->
<g id="node138" class="node">
<title>stage0_layer4_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-21233.78 827.5,-21233.78 827.5,-21165.78 1304.5,-21165.78 1304.5,-21233.78"/>
<text text-anchor="middle" x="1066" y="-21218.58" font-family="Times,serif" font-size="14.00">Expert 65 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-21203.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-21188.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-21173.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert1_act&#45;&gt;stage0_layer4_expert1_mlp2 -->
<g id="edge150" class="edge">
<title>stage0_layer4_expert1_act&#45;&gt;stage0_layer4_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1100.44,-21269.67C1096.21,-21261.2 1091.6,-21251.99 1087.18,-21243.13"/>
<polygon fill="black" stroke="black" points="1090.25,-21241.46 1082.65,-21234.08 1083.99,-21244.59 1090.25,-21241.46"/>
</g>
<!-- stage0_layer4_expert1_reduce -->
<g id="node139" class="node">
<title>stage0_layer4_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-21081.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-21100.5" font-family="Times,serif" font-size="14.00">Expert 65 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-21085.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-21070.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-21055.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert1_mlp2&#45;&gt;stage0_layer4_expert1_reduce -->
<g id="edge151" class="edge">
<title>stage0_layer4_expert1_mlp2&#45;&gt;stage0_layer4_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.1,-21165.52C1049.91,-21157.26 1046.39,-21148.19 1042.89,-21139.16"/>
<polygon fill="black" stroke="black" points="1046.14,-21137.87 1039.26,-21129.81 1039.61,-21140.4 1046.14,-21137.87"/>
</g>
<!-- stage0_layer4_expert1_reduce&#45;&gt;stage0_layer4_expert_agg -->
<g id="edge152" class="edge">
<title>stage0_layer4_expert1_reduce&#45;&gt;stage0_layer4_expert_agg</title>
<path fill="none" stroke="black" d="M1127.15,-21036.07C1152.91,-21025.25 1181.09,-21013.4 1208.96,-21001.68"/>
<polygon fill="black" stroke="black" points="1210.53,-21004.82 1218.39,-20997.71 1207.82,-20998.36 1210.53,-21004.82"/>
</g>
<!-- stage0_layer4_expert2_mlp1 -->
<g id="node141" class="node">
<title>stage0_layer4_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1838.5,-21441.78 1391.5,-21441.78 1391.5,-21373.78 1838.5,-21373.78 1838.5,-21441.78"/>
<text text-anchor="middle" x="1615" y="-21426.58" font-family="Times,serif" font-size="14.00">Expert 66 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1615" y="-21411.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1615" y="-21396.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1615" y="-21381.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert2_gate&#45;&gt;stage0_layer4_expert2_mlp1 -->
<g id="edge154" class="edge">
<title>stage0_layer4_expert2_gate&#45;&gt;stage0_layer4_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1608.25,-21477.67C1609.04,-21469.56 1609.9,-21460.76 1610.74,-21452.25"/>
<polygon fill="black" stroke="black" points="1614.24,-21452.37 1611.74,-21442.08 1607.28,-21451.69 1614.24,-21452.37"/>
</g>
<!-- stage0_layer4_expert2_act -->
<g id="node142" class="node">
<title>stage0_layer4_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1848.5,-21337.78 1401.5,-21337.78 1401.5,-21269.78 1848.5,-21269.78 1848.5,-21337.78"/>
<text text-anchor="middle" x="1625" y="-21322.58" font-family="Times,serif" font-size="14.00">Expert 66 Activation</text>
<text text-anchor="middle" x="1625" y="-21307.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-21292.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-21277.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert2_mlp1&#45;&gt;stage0_layer4_expert2_act -->
<g id="edge155" class="edge">
<title>stage0_layer4_expert2_mlp1&#45;&gt;stage0_layer4_expert2_act</title>
<path fill="none" stroke="black" d="M1618.25,-21373.67C1619.04,-21365.56 1619.9,-21356.76 1620.74,-21348.25"/>
<polygon fill="black" stroke="black" points="1624.24,-21348.37 1621.74,-21338.08 1617.28,-21347.69 1624.24,-21348.37"/>
</g>
<!-- stage0_layer4_expert2_mlp2 -->
<g id="node143" class="node">
<title>stage0_layer4_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1889.5,-21233.78 1412.5,-21233.78 1412.5,-21165.78 1889.5,-21165.78 1889.5,-21233.78"/>
<text text-anchor="middle" x="1651" y="-21218.58" font-family="Times,serif" font-size="14.00">Expert 66 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1651" y="-21203.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1651" y="-21188.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1651" y="-21173.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert2_act&#45;&gt;stage0_layer4_expert2_mlp2 -->
<g id="edge156" class="edge">
<title>stage0_layer4_expert2_act&#45;&gt;stage0_layer4_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1633.44,-21269.67C1635.53,-21261.47 1637.8,-21252.57 1639.99,-21243.97"/>
<polygon fill="black" stroke="black" points="1643.43,-21244.64 1642.51,-21234.08 1636.65,-21242.91 1643.43,-21244.64"/>
</g>
<!-- stage0_layer4_expert2_reduce -->
<g id="node144" class="node">
<title>stage0_layer4_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-21081.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-21100.5" font-family="Times,serif" font-size="14.00">Expert 66 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-21085.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-21070.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-21055.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert2_mlp2&#45;&gt;stage0_layer4_expert2_reduce -->
<g id="edge157" class="edge">
<title>stage0_layer4_expert2_mlp2&#45;&gt;stage0_layer4_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.18,-21165.52C1667.45,-21157.26 1671.05,-21148.19 1674.63,-21139.16"/>
<polygon fill="black" stroke="black" points="1677.9,-21140.39 1678.33,-21129.81 1671.39,-21137.82 1677.9,-21140.39"/>
</g>
<!-- stage0_layer4_expert2_reduce&#45;&gt;stage0_layer4_expert_agg -->
<g id="edge158" class="edge">
<title>stage0_layer4_expert2_reduce&#45;&gt;stage0_layer4_expert_agg</title>
<path fill="none" stroke="black" d="M1601.29,-21035.67C1578.75,-21025.06 1554.18,-21013.5 1529.84,-21002.05"/>
<polygon fill="black" stroke="black" points="1531.07,-20998.76 1520.53,-20997.67 1528.09,-21005.1 1531.07,-20998.76"/>
</g>
<!-- stage0_layer4_expert3_mlp1 -->
<g id="node146" class="node">
<title>stage0_layer4_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2307.5,-21441.78 1860.5,-21441.78 1860.5,-21373.78 2307.5,-21373.78 2307.5,-21441.78"/>
<text text-anchor="middle" x="2084" y="-21426.58" font-family="Times,serif" font-size="14.00">Expert 67 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2084" y="-21411.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2084" y="-21396.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2084" y="-21381.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert3_gate&#45;&gt;stage0_layer4_expert3_mlp1 -->
<g id="edge160" class="edge">
<title>stage0_layer4_expert3_gate&#45;&gt;stage0_layer4_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2070.49,-21477.67C2072.1,-21469.47 2073.85,-21460.57 2075.53,-21451.97"/>
<polygon fill="black" stroke="black" points="2078.98,-21452.57 2077.47,-21442.08 2072.11,-21451.22 2078.98,-21452.57"/>
</g>
<!-- stage0_layer4_expert3_act -->
<g id="node147" class="node">
<title>stage0_layer4_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2322.5,-21337.78 1875.5,-21337.78 1875.5,-21269.78 2322.5,-21269.78 2322.5,-21337.78"/>
<text text-anchor="middle" x="2099" y="-21322.58" font-family="Times,serif" font-size="14.00">Expert 67 Activation</text>
<text text-anchor="middle" x="2099" y="-21307.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-21292.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-21277.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert3_mlp1&#45;&gt;stage0_layer4_expert3_act -->
<g id="edge161" class="edge">
<title>stage0_layer4_expert3_mlp1&#45;&gt;stage0_layer4_expert3_act</title>
<path fill="none" stroke="black" d="M2088.87,-21373.67C2090.06,-21365.56 2091.36,-21356.76 2092.61,-21348.25"/>
<polygon fill="black" stroke="black" points="2096.11,-21348.48 2094.1,-21338.08 2089.19,-21347.47 2096.11,-21348.48"/>
</g>
<!-- stage0_layer4_expert3_mlp2 -->
<g id="node148" class="node">
<title>stage0_layer4_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2520.5,-21233.78 2043.5,-21233.78 2043.5,-21165.78 2520.5,-21165.78 2520.5,-21233.78"/>
<text text-anchor="middle" x="2282" y="-21218.58" font-family="Times,serif" font-size="14.00">Expert 67 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2282" y="-21203.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2282" y="-21188.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2282" y="-21173.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert3_act&#45;&gt;stage0_layer4_expert3_mlp2 -->
<g id="edge162" class="edge">
<title>stage0_layer4_expert3_act&#45;&gt;stage0_layer4_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2158.41,-21269.67C2176.08,-21259.82 2195.58,-21248.95 2213.76,-21238.82"/>
<polygon fill="black" stroke="black" points="2215.54,-21241.83 2222.57,-21233.91 2212.13,-21235.72 2215.54,-21241.83"/>
</g>
<!-- stage0_layer4_expert3_reduce -->
<g id="node149" class="node">
<title>stage0_layer4_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-21081.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-21100.5" font-family="Times,serif" font-size="14.00">Expert 67 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-21085.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-21070.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-21055.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert3_mlp2&#45;&gt;stage0_layer4_expert3_reduce -->
<g id="edge163" class="edge">
<title>stage0_layer4_expert3_mlp2&#45;&gt;stage0_layer4_expert3_reduce</title>
<path fill="none" stroke="black" d="M2308.08,-21165.52C2314.89,-21156.83 2322.41,-21147.23 2329.86,-21137.73"/>
<polygon fill="black" stroke="black" points="2332.65,-21139.84 2336.07,-21129.81 2327.15,-21135.52 2332.65,-21139.84"/>
</g>
<!-- stage0_layer4_expert3_reduce&#45;&gt;stage0_layer4_expert_agg -->
<g id="edge164" class="edge">
<title>stage0_layer4_expert3_reduce&#45;&gt;stage0_layer4_expert_agg</title>
<path fill="none" stroke="black" d="M2147.53,-21046.69C2053.41,-21032.49 1940.53,-21015.47 1830.59,-20998.88"/>
<polygon fill="black" stroke="black" points="1831.06,-20995.41 1820.65,-20997.38 1830.02,-21002.34 1831.06,-20995.41"/>
</g>
<!-- stage0_layer4_residual2 -->
<g id="node151" class="node">
<title>stage0_layer4_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-20825.62 1116.35,-20825.62 935.11,-20689.62 1639.65,-20689.62 1820.89,-20825.62"/>
<text text-anchor="middle" x="1378" y="-20776.42" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1378" y="-20761.42" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-20746.42" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-20731.42" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_expert_agg&#45;&gt;stage0_layer4_residual2 -->
<g id="edge165" class="edge">
<title>stage0_layer4_expert_agg&#45;&gt;stage0_layer4_residual2</title>
<path fill="none" stroke="black" d="M1378,-20861.43C1378,-20853.11 1378,-20844.56 1378,-20836.11"/>
<polygon fill="black" stroke="black" points="1381.5,-20835.87 1378,-20825.87 1374.5,-20835.87 1381.5,-20835.87"/>
</g>
<!-- stage0_layer5_layernorm -->
<g id="node152" class="node">
<title>stage0_layer5_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-20642.62 1174.5,-20642.62 1174.5,-20574.62 1581.5,-20574.62 1581.5,-20642.62"/>
<text text-anchor="middle" x="1378" y="-20627.42" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1378" y="-20612.42" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-20597.42" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-20582.42" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer4_residual2&#45;&gt;stage0_layer5_layernorm -->
<g id="edge166" class="edge">
<title>stage0_layer4_residual2&#45;&gt;stage0_layer5_layernorm</title>
<path fill="none" stroke="black" d="M1378,-20689.57C1378,-20677.16 1378,-20664.51 1378,-20653.04"/>
<polygon fill="black" stroke="black" points="1381.5,-20652.87 1378,-20642.87 1374.5,-20652.87 1381.5,-20652.87"/>
</g>
<!-- stage0_layer5_qkv_proj -->
<g id="node153" class="node">
<title>stage0_layer5_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-20538.62 1120.5,-20538.62 1120.5,-20470.62 1635.5,-20470.62 1635.5,-20538.62"/>
<text text-anchor="middle" x="1378" y="-20523.42" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-20508.42" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-20493.42" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-20478.42" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_layernorm&#45;&gt;stage0_layer5_qkv_proj -->
<g id="edge167" class="edge">
<title>stage0_layer5_layernorm&#45;&gt;stage0_layer5_qkv_proj</title>
<path fill="none" stroke="black" d="M1378,-20574.5C1378,-20566.39 1378,-20557.6 1378,-20549.09"/>
<polygon fill="black" stroke="black" points="1381.5,-20548.91 1378,-20538.91 1374.5,-20548.91 1381.5,-20548.91"/>
</g>
<!-- stage0_layer5_qkv_gather -->
<g id="node154" class="node">
<title>stage0_layer5_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-20386.53" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-20405.33" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1378" y="-20390.33" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1378" y="-20375.33" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-20360.33" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_qkv_proj&#45;&gt;stage0_layer5_qkv_gather -->
<g id="edge168" class="edge">
<title>stage0_layer5_qkv_proj&#45;&gt;stage0_layer5_qkv_gather</title>
<path fill="none" stroke="black" d="M1378,-20470.35C1378,-20462.36 1378,-20453.59 1378,-20444.85"/>
<polygon fill="black" stroke="black" points="1381.5,-20444.64 1378,-20434.64 1374.5,-20444.64 1381.5,-20444.64"/>
</g>
<!-- stage0_layer5_attention -->
<g id="node155" class="node">
<title>stage0_layer5_attention</title>
<polygon fill="lightgreen" stroke="black" points="1629.5,-20302.45 1126.5,-20302.45 1126.5,-20234.45 1629.5,-20234.45 1629.5,-20302.45"/>
<text text-anchor="middle" x="1378" y="-20287.25" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1378" y="-20272.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-20257.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-20242.25" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_qkv_gather&#45;&gt;stage0_layer5_attention -->
<g id="edge169" class="edge">
<title>stage0_layer5_qkv_gather&#45;&gt;stage0_layer5_attention</title>
<path fill="none" stroke="black" d="M1378,-20338.32C1378,-20329.93 1378,-20321.23 1378,-20312.96"/>
<polygon fill="black" stroke="black" points="1381.5,-20312.75 1378,-20302.75 1374.5,-20312.75 1381.5,-20312.75"/>
</g>
<!-- stage0_layer5_attn_out -->
<g id="node156" class="node">
<title>stage0_layer5_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1616.5,-20198.45 1139.5,-20198.45 1139.5,-20130.45 1616.5,-20130.45 1616.5,-20198.45"/>
<text text-anchor="middle" x="1378" y="-20183.25" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-20168.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-20153.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-20138.25" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_attention&#45;&gt;stage0_layer5_attn_out -->
<g id="edge170" class="edge">
<title>stage0_layer5_attention&#45;&gt;stage0_layer5_attn_out</title>
<path fill="none" stroke="black" d="M1378,-20234.33C1378,-20226.23 1378,-20217.43 1378,-20208.92"/>
<polygon fill="black" stroke="black" points="1381.5,-20208.75 1378,-20198.75 1374.5,-20208.75 1381.5,-20208.75"/>
</g>
<!-- stage0_layer5_attn_reduce -->
<g id="node157" class="node">
<title>stage0_layer5_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-20046.37" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-20065.17" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1378" y="-20050.17" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-20035.17" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-20020.17" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_attn_out&#45;&gt;stage0_layer5_attn_reduce -->
<g id="edge171" class="edge">
<title>stage0_layer5_attn_out&#45;&gt;stage0_layer5_attn_reduce</title>
<path fill="none" stroke="black" d="M1378,-20130.18C1378,-20122.19 1378,-20113.42 1378,-20104.68"/>
<polygon fill="black" stroke="black" points="1381.5,-20104.47 1378,-20094.47 1374.5,-20104.47 1381.5,-20104.47"/>
</g>
<!-- stage0_layer5_residual1 -->
<g id="node158" class="node">
<title>stage0_layer5_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-19962.28 1116.35,-19962.28 935.11,-19826.28 1639.65,-19826.28 1820.89,-19962.28"/>
<text text-anchor="middle" x="1378" y="-19913.08" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1378" y="-19898.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-19883.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-19868.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_attn_reduce&#45;&gt;stage0_layer5_residual1 -->
<g id="edge172" class="edge">
<title>stage0_layer5_attn_reduce&#45;&gt;stage0_layer5_residual1</title>
<path fill="none" stroke="black" d="M1378,-19997.88C1378,-19989.79 1378,-19981.21 1378,-19972.59"/>
<polygon fill="black" stroke="black" points="1381.5,-19972.48 1378,-19962.48 1374.5,-19972.48 1381.5,-19972.48"/>
</g>
<!-- stage0_layer5_layernorm2 -->
<g id="node159" class="node">
<title>stage0_layer5_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-19790.28 1174.5,-19790.28 1174.5,-19722.28 1581.5,-19722.28 1581.5,-19790.28"/>
<text text-anchor="middle" x="1378" y="-19775.08" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1378" y="-19760.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-19745.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-19730.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_residual1&#45;&gt;stage0_layer5_layernorm2 -->
<g id="edge173" class="edge">
<title>stage0_layer5_residual1&#45;&gt;stage0_layer5_layernorm2</title>
<path fill="none" stroke="black" d="M1378,-19826.08C1378,-19817.33 1378,-19808.56 1378,-19800.35"/>
<polygon fill="black" stroke="black" points="1381.5,-19800.3 1378,-19790.3 1374.5,-19800.3 1381.5,-19800.3"/>
</g>
<!-- stage0_layer5_expert0_gate -->
<g id="node160" class="node">
<title>stage0_layer5_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="910.5,-19686.28 487.5,-19686.28 487.5,-19618.28 910.5,-19618.28 910.5,-19686.28"/>
<text text-anchor="middle" x="699" y="-19671.08" font-family="Times,serif" font-size="14.00">Expert Gate 80</text>
<text text-anchor="middle" x="699" y="-19656.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="699" y="-19641.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="699" y="-19626.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_layernorm2&#45;&gt;stage0_layer5_expert0_gate -->
<g id="edge174" class="edge">
<title>stage0_layer5_layernorm2&#45;&gt;stage0_layer5_expert0_gate</title>
<path fill="none" stroke="black" d="M1174.28,-19724.68C1094.23,-19712.65 1002.12,-19698.82 920.43,-19686.55"/>
<polygon fill="black" stroke="black" points="920.93,-19683.08 910.53,-19685.06 919.9,-19690 920.93,-19683.08"/>
</g>
<!-- stage0_layer5_expert1_gate -->
<g id="node165" class="node">
<title>stage0_layer5_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1363.5,-19686.28 940.5,-19686.28 940.5,-19618.28 1363.5,-19618.28 1363.5,-19686.28"/>
<text text-anchor="middle" x="1152" y="-19671.08" font-family="Times,serif" font-size="14.00">Expert Gate 81</text>
<text text-anchor="middle" x="1152" y="-19656.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1152" y="-19641.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1152" y="-19626.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_layernorm2&#45;&gt;stage0_layer5_expert1_gate -->
<g id="edge180" class="edge">
<title>stage0_layer5_layernorm2&#45;&gt;stage0_layer5_expert1_gate</title>
<path fill="none" stroke="black" d="M1304.62,-19722.17C1282.31,-19712.09 1257.63,-19700.96 1234.74,-19690.63"/>
<polygon fill="black" stroke="black" points="1235.95,-19687.33 1225.39,-19686.41 1233.07,-19693.71 1235.95,-19687.33"/>
</g>
<!-- stage0_layer5_expert2_gate -->
<g id="node170" class="node">
<title>stage0_layer5_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1816.5,-19686.28 1393.5,-19686.28 1393.5,-19618.28 1816.5,-19618.28 1816.5,-19686.28"/>
<text text-anchor="middle" x="1605" y="-19671.08" font-family="Times,serif" font-size="14.00">Expert Gate 82</text>
<text text-anchor="middle" x="1605" y="-19656.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1605" y="-19641.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1605" y="-19626.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_layernorm2&#45;&gt;stage0_layer5_expert2_gate -->
<g id="edge186" class="edge">
<title>stage0_layer5_layernorm2&#45;&gt;stage0_layer5_expert2_gate</title>
<path fill="none" stroke="black" d="M1451.7,-19722.17C1474.12,-19712.09 1498.9,-19700.96 1521.89,-19690.63"/>
<polygon fill="black" stroke="black" points="1523.59,-19693.7 1531.28,-19686.41 1520.73,-19687.31 1523.59,-19693.7"/>
</g>
<!-- stage0_layer5_expert3_gate -->
<g id="node175" class="node">
<title>stage0_layer5_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2275.5,-19686.28 1852.5,-19686.28 1852.5,-19618.28 2275.5,-19618.28 2275.5,-19686.28"/>
<text text-anchor="middle" x="2064" y="-19671.08" font-family="Times,serif" font-size="14.00">Expert Gate 83</text>
<text text-anchor="middle" x="2064" y="-19656.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2064" y="-19641.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2064" y="-19626.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_layernorm2&#45;&gt;stage0_layer5_expert3_gate -->
<g id="edge192" class="edge">
<title>stage0_layer5_layernorm2&#45;&gt;stage0_layer5_expert3_gate</title>
<path fill="none" stroke="black" d="M1581.5,-19725.02C1663.58,-19712.82 1758.5,-19698.71 1842.32,-19686.24"/>
<polygon fill="black" stroke="black" points="1842.84,-19689.7 1852.22,-19684.77 1841.82,-19682.78 1842.84,-19689.7"/>
</g>
<!-- stage0_layer5_expert0_mlp1 -->
<g id="node161" class="node">
<title>stage0_layer5_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="901.5,-19582.28 454.5,-19582.28 454.5,-19514.28 901.5,-19514.28 901.5,-19582.28"/>
<text text-anchor="middle" x="678" y="-19567.08" font-family="Times,serif" font-size="14.00">Expert 80 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="678" y="-19552.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="678" y="-19537.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="678" y="-19522.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert0_gate&#45;&gt;stage0_layer5_expert0_mlp1 -->
<g id="edge175" class="edge">
<title>stage0_layer5_expert0_gate&#45;&gt;stage0_layer5_expert0_mlp1</title>
<path fill="none" stroke="black" d="M692.18,-19618.17C690.49,-19609.97 688.66,-19601.07 686.89,-19592.47"/>
<polygon fill="black" stroke="black" points="690.3,-19591.67 684.86,-19582.58 683.44,-19593.08 690.3,-19591.67"/>
</g>
<!-- stage0_layer5_expert0_act -->
<g id="node162" class="node">
<title>stage0_layer5_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="860.5,-19478.28 413.5,-19478.28 413.5,-19410.28 860.5,-19410.28 860.5,-19478.28"/>
<text text-anchor="middle" x="637" y="-19463.08" font-family="Times,serif" font-size="14.00">Expert 80 Activation</text>
<text text-anchor="middle" x="637" y="-19448.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-19433.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-19418.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert0_mlp1&#45;&gt;stage0_layer5_expert0_act -->
<g id="edge176" class="edge">
<title>stage0_layer5_expert0_mlp1&#45;&gt;stage0_layer5_expert0_act</title>
<path fill="none" stroke="black" d="M664.69,-19514.17C661.32,-19505.79 657.66,-19496.68 654.14,-19487.91"/>
<polygon fill="black" stroke="black" points="657.36,-19486.55 650.39,-19478.58 650.87,-19489.17 657.36,-19486.55"/>
</g>
<!-- stage0_layer5_expert0_mlp2 -->
<g id="node163" class="node">
<title>stage0_layer5_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="719.5,-19374.28 242.5,-19374.28 242.5,-19306.28 719.5,-19306.28 719.5,-19374.28"/>
<text text-anchor="middle" x="481" y="-19359.08" font-family="Times,serif" font-size="14.00">Expert 80 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="481" y="-19344.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="481" y="-19329.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="481" y="-19314.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert0_act&#45;&gt;stage0_layer5_expert0_mlp2 -->
<g id="edge177" class="edge">
<title>stage0_layer5_expert0_act&#45;&gt;stage0_layer5_expert0_mlp2</title>
<path fill="none" stroke="black" d="M586.35,-19410.17C571.7,-19400.59 555.58,-19390.04 540.44,-19380.15"/>
<polygon fill="black" stroke="black" points="541.95,-19376.95 531.66,-19374.41 538.12,-19382.81 541.95,-19376.95"/>
</g>
<!-- stage0_layer5_expert0_reduce -->
<g id="node164" class="node">
<title>stage0_layer5_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-19222.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-19241" font-family="Times,serif" font-size="14.00">Expert 80 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-19226" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-19211" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-19196" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert0_mlp2&#45;&gt;stage0_layer5_expert0_reduce -->
<g id="edge178" class="edge">
<title>stage0_layer5_expert0_mlp2&#45;&gt;stage0_layer5_expert0_reduce</title>
<path fill="none" stroke="black" d="M442.03,-19306.02C431.15,-19296.73 419.04,-19286.4 407.18,-19276.27"/>
<polygon fill="black" stroke="black" points="409.31,-19273.49 399.43,-19269.66 404.77,-19278.81 409.31,-19273.49"/>
</g>
<!-- stage0_layer5_expert_agg -->
<g id="node180" class="node">
<title>stage0_layer5_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-19138.12 1116.35,-19138.12 935.11,-19002.12 1639.65,-19002.12 1820.89,-19138.12"/>
<text text-anchor="middle" x="1378" y="-19088.92" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1378" y="-19073.92" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1378" y="-19058.92" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-19043.92" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert0_reduce&#45;&gt;stage0_layer5_expert_agg -->
<g id="edge179" class="edge">
<title>stage0_layer5_expert0_reduce&#45;&gt;stage0_layer5_expert_agg</title>
<path fill="none" stroke="black" d="M574.9,-19187.8C721.93,-19166.43 914.31,-19138.48 1073.92,-19115.3"/>
<polygon fill="black" stroke="black" points="1074.51,-19118.75 1083.9,-19113.84 1073.5,-19111.82 1074.51,-19118.75"/>
</g>
<!-- stage0_layer5_expert1_mlp1 -->
<g id="node166" class="node">
<title>stage0_layer5_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1366.5,-19582.28 919.5,-19582.28 919.5,-19514.28 1366.5,-19514.28 1366.5,-19582.28"/>
<text text-anchor="middle" x="1143" y="-19567.08" font-family="Times,serif" font-size="14.00">Expert 81 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1143" y="-19552.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1143" y="-19537.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1143" y="-19522.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert1_gate&#45;&gt;stage0_layer5_expert1_mlp1 -->
<g id="edge181" class="edge">
<title>stage0_layer5_expert1_gate&#45;&gt;stage0_layer5_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1149.08,-19618.17C1148.36,-19610.06 1147.59,-19601.26 1146.84,-19592.75"/>
<polygon fill="black" stroke="black" points="1150.3,-19592.24 1145.94,-19582.58 1143.33,-19592.85 1150.3,-19592.24"/>
</g>
<!-- stage0_layer5_expert1_act -->
<g id="node167" class="node">
<title>stage0_layer5_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1340.5,-19478.28 893.5,-19478.28 893.5,-19410.28 1340.5,-19410.28 1340.5,-19478.28"/>
<text text-anchor="middle" x="1117" y="-19463.08" font-family="Times,serif" font-size="14.00">Expert 81 Activation</text>
<text text-anchor="middle" x="1117" y="-19448.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-19433.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-19418.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert1_mlp1&#45;&gt;stage0_layer5_expert1_act -->
<g id="edge182" class="edge">
<title>stage0_layer5_expert1_mlp1&#45;&gt;stage0_layer5_expert1_act</title>
<path fill="none" stroke="black" d="M1134.56,-19514.17C1132.47,-19505.97 1130.2,-19497.07 1128.01,-19488.47"/>
<polygon fill="black" stroke="black" points="1131.35,-19487.41 1125.49,-19478.58 1124.57,-19489.14 1131.35,-19487.41"/>
</g>
<!-- stage0_layer5_expert1_mlp2 -->
<g id="node168" class="node">
<title>stage0_layer5_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-19374.28 827.5,-19374.28 827.5,-19306.28 1304.5,-19306.28 1304.5,-19374.28"/>
<text text-anchor="middle" x="1066" y="-19359.08" font-family="Times,serif" font-size="14.00">Expert 81 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-19344.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-19329.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-19314.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert1_act&#45;&gt;stage0_layer5_expert1_mlp2 -->
<g id="edge183" class="edge">
<title>stage0_layer5_expert1_act&#45;&gt;stage0_layer5_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1100.44,-19410.17C1096.21,-19401.7 1091.6,-19392.49 1087.18,-19383.63"/>
<polygon fill="black" stroke="black" points="1090.25,-19381.96 1082.65,-19374.58 1083.99,-19385.09 1090.25,-19381.96"/>
</g>
<!-- stage0_layer5_expert1_reduce -->
<g id="node169" class="node">
<title>stage0_layer5_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-19222.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-19241" font-family="Times,serif" font-size="14.00">Expert 81 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-19226" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-19211" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-19196" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert1_mlp2&#45;&gt;stage0_layer5_expert1_reduce -->
<g id="edge184" class="edge">
<title>stage0_layer5_expert1_mlp2&#45;&gt;stage0_layer5_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.1,-19306.02C1049.91,-19297.76 1046.39,-19288.69 1042.89,-19279.66"/>
<polygon fill="black" stroke="black" points="1046.14,-19278.37 1039.26,-19270.31 1039.61,-19280.9 1046.14,-19278.37"/>
</g>
<!-- stage0_layer5_expert1_reduce&#45;&gt;stage0_layer5_expert_agg -->
<g id="edge185" class="edge">
<title>stage0_layer5_expert1_reduce&#45;&gt;stage0_layer5_expert_agg</title>
<path fill="none" stroke="black" d="M1127.15,-19176.58C1152.91,-19165.75 1181.09,-19153.9 1208.96,-19142.18"/>
<polygon fill="black" stroke="black" points="1210.53,-19145.32 1218.39,-19138.21 1207.82,-19138.86 1210.53,-19145.32"/>
</g>
<!-- stage0_layer5_expert2_mlp1 -->
<g id="node171" class="node">
<title>stage0_layer5_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1838.5,-19582.28 1391.5,-19582.28 1391.5,-19514.28 1838.5,-19514.28 1838.5,-19582.28"/>
<text text-anchor="middle" x="1615" y="-19567.08" font-family="Times,serif" font-size="14.00">Expert 82 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1615" y="-19552.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1615" y="-19537.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1615" y="-19522.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert2_gate&#45;&gt;stage0_layer5_expert2_mlp1 -->
<g id="edge187" class="edge">
<title>stage0_layer5_expert2_gate&#45;&gt;stage0_layer5_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1608.25,-19618.17C1609.04,-19610.06 1609.9,-19601.26 1610.74,-19592.75"/>
<polygon fill="black" stroke="black" points="1614.24,-19592.88 1611.74,-19582.58 1607.28,-19592.19 1614.24,-19592.88"/>
</g>
<!-- stage0_layer5_expert2_act -->
<g id="node172" class="node">
<title>stage0_layer5_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1848.5,-19478.28 1401.5,-19478.28 1401.5,-19410.28 1848.5,-19410.28 1848.5,-19478.28"/>
<text text-anchor="middle" x="1625" y="-19463.08" font-family="Times,serif" font-size="14.00">Expert 82 Activation</text>
<text text-anchor="middle" x="1625" y="-19448.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-19433.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-19418.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert2_mlp1&#45;&gt;stage0_layer5_expert2_act -->
<g id="edge188" class="edge">
<title>stage0_layer5_expert2_mlp1&#45;&gt;stage0_layer5_expert2_act</title>
<path fill="none" stroke="black" d="M1618.25,-19514.17C1619.04,-19506.06 1619.9,-19497.26 1620.74,-19488.75"/>
<polygon fill="black" stroke="black" points="1624.24,-19488.88 1621.74,-19478.58 1617.28,-19488.19 1624.24,-19488.88"/>
</g>
<!-- stage0_layer5_expert2_mlp2 -->
<g id="node173" class="node">
<title>stage0_layer5_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1889.5,-19374.28 1412.5,-19374.28 1412.5,-19306.28 1889.5,-19306.28 1889.5,-19374.28"/>
<text text-anchor="middle" x="1651" y="-19359.08" font-family="Times,serif" font-size="14.00">Expert 82 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1651" y="-19344.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1651" y="-19329.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1651" y="-19314.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert2_act&#45;&gt;stage0_layer5_expert2_mlp2 -->
<g id="edge189" class="edge">
<title>stage0_layer5_expert2_act&#45;&gt;stage0_layer5_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1633.44,-19410.17C1635.53,-19401.97 1637.8,-19393.07 1639.99,-19384.47"/>
<polygon fill="black" stroke="black" points="1643.43,-19385.14 1642.51,-19374.58 1636.65,-19383.41 1643.43,-19385.14"/>
</g>
<!-- stage0_layer5_expert2_reduce -->
<g id="node174" class="node">
<title>stage0_layer5_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-19222.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-19241" font-family="Times,serif" font-size="14.00">Expert 82 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-19226" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-19211" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-19196" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert2_mlp2&#45;&gt;stage0_layer5_expert2_reduce -->
<g id="edge190" class="edge">
<title>stage0_layer5_expert2_mlp2&#45;&gt;stage0_layer5_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.18,-19306.02C1667.45,-19297.76 1671.05,-19288.69 1674.63,-19279.66"/>
<polygon fill="black" stroke="black" points="1677.9,-19280.89 1678.33,-19270.31 1671.39,-19278.32 1677.9,-19280.89"/>
</g>
<!-- stage0_layer5_expert2_reduce&#45;&gt;stage0_layer5_expert_agg -->
<g id="edge191" class="edge">
<title>stage0_layer5_expert2_reduce&#45;&gt;stage0_layer5_expert_agg</title>
<path fill="none" stroke="black" d="M1601.29,-19176.17C1578.75,-19165.56 1554.18,-19154 1529.84,-19142.55"/>
<polygon fill="black" stroke="black" points="1531.07,-19139.26 1520.53,-19138.17 1528.09,-19145.6 1531.07,-19139.26"/>
</g>
<!-- stage0_layer5_expert3_mlp1 -->
<g id="node176" class="node">
<title>stage0_layer5_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2307.5,-19582.28 1860.5,-19582.28 1860.5,-19514.28 2307.5,-19514.28 2307.5,-19582.28"/>
<text text-anchor="middle" x="2084" y="-19567.08" font-family="Times,serif" font-size="14.00">Expert 83 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2084" y="-19552.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2084" y="-19537.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2084" y="-19522.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert3_gate&#45;&gt;stage0_layer5_expert3_mlp1 -->
<g id="edge193" class="edge">
<title>stage0_layer5_expert3_gate&#45;&gt;stage0_layer5_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2070.49,-19618.17C2072.1,-19609.97 2073.85,-19601.07 2075.53,-19592.47"/>
<polygon fill="black" stroke="black" points="2078.98,-19593.07 2077.47,-19582.58 2072.11,-19591.72 2078.98,-19593.07"/>
</g>
<!-- stage0_layer5_expert3_act -->
<g id="node177" class="node">
<title>stage0_layer5_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2322.5,-19478.28 1875.5,-19478.28 1875.5,-19410.28 2322.5,-19410.28 2322.5,-19478.28"/>
<text text-anchor="middle" x="2099" y="-19463.08" font-family="Times,serif" font-size="14.00">Expert 83 Activation</text>
<text text-anchor="middle" x="2099" y="-19448.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-19433.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-19418.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert3_mlp1&#45;&gt;stage0_layer5_expert3_act -->
<g id="edge194" class="edge">
<title>stage0_layer5_expert3_mlp1&#45;&gt;stage0_layer5_expert3_act</title>
<path fill="none" stroke="black" d="M2088.87,-19514.17C2090.06,-19506.06 2091.36,-19497.26 2092.61,-19488.75"/>
<polygon fill="black" stroke="black" points="2096.11,-19488.98 2094.1,-19478.58 2089.19,-19487.97 2096.11,-19488.98"/>
</g>
<!-- stage0_layer5_expert3_mlp2 -->
<g id="node178" class="node">
<title>stage0_layer5_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2520.5,-19374.28 2043.5,-19374.28 2043.5,-19306.28 2520.5,-19306.28 2520.5,-19374.28"/>
<text text-anchor="middle" x="2282" y="-19359.08" font-family="Times,serif" font-size="14.00">Expert 83 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2282" y="-19344.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2282" y="-19329.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2282" y="-19314.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert3_act&#45;&gt;stage0_layer5_expert3_mlp2 -->
<g id="edge195" class="edge">
<title>stage0_layer5_expert3_act&#45;&gt;stage0_layer5_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2158.41,-19410.17C2176.08,-19400.32 2195.58,-19389.45 2213.76,-19379.32"/>
<polygon fill="black" stroke="black" points="2215.54,-19382.33 2222.57,-19374.41 2212.13,-19376.22 2215.54,-19382.33"/>
</g>
<!-- stage0_layer5_expert3_reduce -->
<g id="node179" class="node">
<title>stage0_layer5_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-19222.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-19241" font-family="Times,serif" font-size="14.00">Expert 83 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-19226" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-19211" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-19196" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert3_mlp2&#45;&gt;stage0_layer5_expert3_reduce -->
<g id="edge196" class="edge">
<title>stage0_layer5_expert3_mlp2&#45;&gt;stage0_layer5_expert3_reduce</title>
<path fill="none" stroke="black" d="M2308.08,-19306.02C2314.89,-19297.33 2322.41,-19287.73 2329.86,-19278.23"/>
<polygon fill="black" stroke="black" points="2332.65,-19280.34 2336.07,-19270.31 2327.15,-19276.02 2332.65,-19280.34"/>
</g>
<!-- stage0_layer5_expert3_reduce&#45;&gt;stage0_layer5_expert_agg -->
<g id="edge197" class="edge">
<title>stage0_layer5_expert3_reduce&#45;&gt;stage0_layer5_expert_agg</title>
<path fill="none" stroke="black" d="M2147.53,-19187.19C2053.41,-19172.99 1940.53,-19155.97 1830.59,-19139.38"/>
<polygon fill="black" stroke="black" points="1831.06,-19135.91 1820.65,-19137.88 1830.02,-19142.84 1831.06,-19135.91"/>
</g>
<!-- stage0_layer5_residual2 -->
<g id="node181" class="node">
<title>stage0_layer5_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-18966.12 1116.35,-18966.12 935.11,-18830.12 1639.65,-18830.12 1820.89,-18966.12"/>
<text text-anchor="middle" x="1378" y="-18916.92" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1378" y="-18901.92" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-18886.92" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-18871.92" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_expert_agg&#45;&gt;stage0_layer5_residual2 -->
<g id="edge198" class="edge">
<title>stage0_layer5_expert_agg&#45;&gt;stage0_layer5_residual2</title>
<path fill="none" stroke="black" d="M1378,-19001.93C1378,-18993.61 1378,-18985.06 1378,-18976.61"/>
<polygon fill="black" stroke="black" points="1381.5,-18976.37 1378,-18966.37 1374.5,-18976.37 1381.5,-18976.37"/>
</g>
<!-- stage0_layer6_layernorm -->
<g id="node182" class="node">
<title>stage0_layer6_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-18783.12 1174.5,-18783.12 1174.5,-18715.12 1581.5,-18715.12 1581.5,-18783.12"/>
<text text-anchor="middle" x="1378" y="-18767.92" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1378" y="-18752.92" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-18737.92" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-18722.92" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer5_residual2&#45;&gt;stage0_layer6_layernorm -->
<g id="edge199" class="edge">
<title>stage0_layer5_residual2&#45;&gt;stage0_layer6_layernorm</title>
<path fill="none" stroke="black" d="M1378,-18830.07C1378,-18817.66 1378,-18805.01 1378,-18793.54"/>
<polygon fill="black" stroke="black" points="1381.5,-18793.37 1378,-18783.37 1374.5,-18793.37 1381.5,-18793.37"/>
</g>
<!-- stage0_layer6_qkv_proj -->
<g id="node183" class="node">
<title>stage0_layer6_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-18679.12 1120.5,-18679.12 1120.5,-18611.12 1635.5,-18611.12 1635.5,-18679.12"/>
<text text-anchor="middle" x="1378" y="-18663.92" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-18648.92" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-18633.92" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-18618.92" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_layernorm&#45;&gt;stage0_layer6_qkv_proj -->
<g id="edge200" class="edge">
<title>stage0_layer6_layernorm&#45;&gt;stage0_layer6_qkv_proj</title>
<path fill="none" stroke="black" d="M1378,-18715C1378,-18706.89 1378,-18698.1 1378,-18689.59"/>
<polygon fill="black" stroke="black" points="1381.5,-18689.41 1378,-18679.41 1374.5,-18689.41 1381.5,-18689.41"/>
</g>
<!-- stage0_layer6_qkv_gather -->
<g id="node184" class="node">
<title>stage0_layer6_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-18527.03" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-18545.83" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1378" y="-18530.83" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1378" y="-18515.83" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-18500.83" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_qkv_proj&#45;&gt;stage0_layer6_qkv_gather -->
<g id="edge201" class="edge">
<title>stage0_layer6_qkv_proj&#45;&gt;stage0_layer6_qkv_gather</title>
<path fill="none" stroke="black" d="M1378,-18610.85C1378,-18602.86 1378,-18594.09 1378,-18585.35"/>
<polygon fill="black" stroke="black" points="1381.5,-18585.14 1378,-18575.14 1374.5,-18585.14 1381.5,-18585.14"/>
</g>
<!-- stage0_layer6_attention -->
<g id="node185" class="node">
<title>stage0_layer6_attention</title>
<polygon fill="lightgreen" stroke="black" points="1629.5,-18442.95 1126.5,-18442.95 1126.5,-18374.95 1629.5,-18374.95 1629.5,-18442.95"/>
<text text-anchor="middle" x="1378" y="-18427.75" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1378" y="-18412.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-18397.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-18382.75" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_qkv_gather&#45;&gt;stage0_layer6_attention -->
<g id="edge202" class="edge">
<title>stage0_layer6_qkv_gather&#45;&gt;stage0_layer6_attention</title>
<path fill="none" stroke="black" d="M1378,-18478.82C1378,-18470.43 1378,-18461.73 1378,-18453.46"/>
<polygon fill="black" stroke="black" points="1381.5,-18453.25 1378,-18443.25 1374.5,-18453.25 1381.5,-18453.25"/>
</g>
<!-- stage0_layer6_attn_out -->
<g id="node186" class="node">
<title>stage0_layer6_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1616.5,-18338.95 1139.5,-18338.95 1139.5,-18270.95 1616.5,-18270.95 1616.5,-18338.95"/>
<text text-anchor="middle" x="1378" y="-18323.75" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-18308.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-18293.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-18278.75" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_attention&#45;&gt;stage0_layer6_attn_out -->
<g id="edge203" class="edge">
<title>stage0_layer6_attention&#45;&gt;stage0_layer6_attn_out</title>
<path fill="none" stroke="black" d="M1378,-18374.83C1378,-18366.73 1378,-18357.93 1378,-18349.42"/>
<polygon fill="black" stroke="black" points="1381.5,-18349.25 1378,-18339.25 1374.5,-18349.25 1381.5,-18349.25"/>
</g>
<!-- stage0_layer6_attn_reduce -->
<g id="node187" class="node">
<title>stage0_layer6_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-18186.87" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-18205.67" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1378" y="-18190.67" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-18175.67" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-18160.67" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_attn_out&#45;&gt;stage0_layer6_attn_reduce -->
<g id="edge204" class="edge">
<title>stage0_layer6_attn_out&#45;&gt;stage0_layer6_attn_reduce</title>
<path fill="none" stroke="black" d="M1378,-18270.68C1378,-18262.69 1378,-18253.93 1378,-18245.18"/>
<polygon fill="black" stroke="black" points="1381.5,-18244.98 1378,-18234.98 1374.5,-18244.98 1381.5,-18244.98"/>
</g>
<!-- stage0_layer6_residual1 -->
<g id="node188" class="node">
<title>stage0_layer6_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-18102.78 1116.35,-18102.78 935.11,-17966.78 1639.65,-17966.78 1820.89,-18102.78"/>
<text text-anchor="middle" x="1378" y="-18053.58" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1378" y="-18038.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-18023.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-18008.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_attn_reduce&#45;&gt;stage0_layer6_residual1 -->
<g id="edge205" class="edge">
<title>stage0_layer6_attn_reduce&#45;&gt;stage0_layer6_residual1</title>
<path fill="none" stroke="black" d="M1378,-18138.38C1378,-18130.29 1378,-18121.71 1378,-18113.09"/>
<polygon fill="black" stroke="black" points="1381.5,-18112.98 1378,-18102.98 1374.5,-18112.98 1381.5,-18112.98"/>
</g>
<!-- stage0_layer6_layernorm2 -->
<g id="node189" class="node">
<title>stage0_layer6_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-17930.78 1174.5,-17930.78 1174.5,-17862.78 1581.5,-17862.78 1581.5,-17930.78"/>
<text text-anchor="middle" x="1378" y="-17915.58" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1378" y="-17900.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-17885.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-17870.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_residual1&#45;&gt;stage0_layer6_layernorm2 -->
<g id="edge206" class="edge">
<title>stage0_layer6_residual1&#45;&gt;stage0_layer6_layernorm2</title>
<path fill="none" stroke="black" d="M1378,-17966.58C1378,-17957.83 1378,-17949.06 1378,-17940.85"/>
<polygon fill="black" stroke="black" points="1381.5,-17940.8 1378,-17930.8 1374.5,-17940.8 1381.5,-17940.8"/>
</g>
<!-- stage0_layer6_expert0_gate -->
<g id="node190" class="node">
<title>stage0_layer6_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="910.5,-17826.78 487.5,-17826.78 487.5,-17758.78 910.5,-17758.78 910.5,-17826.78"/>
<text text-anchor="middle" x="699" y="-17811.58" font-family="Times,serif" font-size="14.00">Expert Gate 96</text>
<text text-anchor="middle" x="699" y="-17796.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="699" y="-17781.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="699" y="-17766.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_layernorm2&#45;&gt;stage0_layer6_expert0_gate -->
<g id="edge207" class="edge">
<title>stage0_layer6_layernorm2&#45;&gt;stage0_layer6_expert0_gate</title>
<path fill="none" stroke="black" d="M1174.28,-17865.18C1094.23,-17853.15 1002.12,-17839.32 920.43,-17827.05"/>
<polygon fill="black" stroke="black" points="920.93,-17823.58 910.53,-17825.56 919.9,-17830.5 920.93,-17823.58"/>
</g>
<!-- stage0_layer6_expert1_gate -->
<g id="node195" class="node">
<title>stage0_layer6_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1363.5,-17826.78 940.5,-17826.78 940.5,-17758.78 1363.5,-17758.78 1363.5,-17826.78"/>
<text text-anchor="middle" x="1152" y="-17811.58" font-family="Times,serif" font-size="14.00">Expert Gate 97</text>
<text text-anchor="middle" x="1152" y="-17796.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1152" y="-17781.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1152" y="-17766.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_layernorm2&#45;&gt;stage0_layer6_expert1_gate -->
<g id="edge213" class="edge">
<title>stage0_layer6_layernorm2&#45;&gt;stage0_layer6_expert1_gate</title>
<path fill="none" stroke="black" d="M1304.62,-17862.67C1282.31,-17852.59 1257.63,-17841.46 1234.74,-17831.13"/>
<polygon fill="black" stroke="black" points="1235.95,-17827.83 1225.39,-17826.91 1233.07,-17834.21 1235.95,-17827.83"/>
</g>
<!-- stage0_layer6_expert2_gate -->
<g id="node200" class="node">
<title>stage0_layer6_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1816.5,-17826.78 1393.5,-17826.78 1393.5,-17758.78 1816.5,-17758.78 1816.5,-17826.78"/>
<text text-anchor="middle" x="1605" y="-17811.58" font-family="Times,serif" font-size="14.00">Expert Gate 98</text>
<text text-anchor="middle" x="1605" y="-17796.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1605" y="-17781.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1605" y="-17766.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_layernorm2&#45;&gt;stage0_layer6_expert2_gate -->
<g id="edge219" class="edge">
<title>stage0_layer6_layernorm2&#45;&gt;stage0_layer6_expert2_gate</title>
<path fill="none" stroke="black" d="M1451.7,-17862.67C1474.12,-17852.59 1498.9,-17841.46 1521.89,-17831.13"/>
<polygon fill="black" stroke="black" points="1523.59,-17834.2 1531.28,-17826.91 1520.73,-17827.81 1523.59,-17834.2"/>
</g>
<!-- stage0_layer6_expert3_gate -->
<g id="node205" class="node">
<title>stage0_layer6_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2275.5,-17826.78 1852.5,-17826.78 1852.5,-17758.78 2275.5,-17758.78 2275.5,-17826.78"/>
<text text-anchor="middle" x="2064" y="-17811.58" font-family="Times,serif" font-size="14.00">Expert Gate 99</text>
<text text-anchor="middle" x="2064" y="-17796.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2064" y="-17781.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2064" y="-17766.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_layernorm2&#45;&gt;stage0_layer6_expert3_gate -->
<g id="edge225" class="edge">
<title>stage0_layer6_layernorm2&#45;&gt;stage0_layer6_expert3_gate</title>
<path fill="none" stroke="black" d="M1581.5,-17865.52C1663.58,-17853.32 1758.5,-17839.21 1842.32,-17826.74"/>
<polygon fill="black" stroke="black" points="1842.84,-17830.2 1852.22,-17825.27 1841.82,-17823.28 1842.84,-17830.2"/>
</g>
<!-- stage0_layer6_expert0_mlp1 -->
<g id="node191" class="node">
<title>stage0_layer6_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="901.5,-17722.78 454.5,-17722.78 454.5,-17654.78 901.5,-17654.78 901.5,-17722.78"/>
<text text-anchor="middle" x="678" y="-17707.58" font-family="Times,serif" font-size="14.00">Expert 96 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="678" y="-17692.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="678" y="-17677.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="678" y="-17662.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert0_gate&#45;&gt;stage0_layer6_expert0_mlp1 -->
<g id="edge208" class="edge">
<title>stage0_layer6_expert0_gate&#45;&gt;stage0_layer6_expert0_mlp1</title>
<path fill="none" stroke="black" d="M692.18,-17758.67C690.49,-17750.47 688.66,-17741.57 686.89,-17732.97"/>
<polygon fill="black" stroke="black" points="690.3,-17732.17 684.86,-17723.08 683.44,-17733.58 690.3,-17732.17"/>
</g>
<!-- stage0_layer6_expert0_act -->
<g id="node192" class="node">
<title>stage0_layer6_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="860.5,-17618.78 413.5,-17618.78 413.5,-17550.78 860.5,-17550.78 860.5,-17618.78"/>
<text text-anchor="middle" x="637" y="-17603.58" font-family="Times,serif" font-size="14.00">Expert 96 Activation</text>
<text text-anchor="middle" x="637" y="-17588.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-17573.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-17558.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert0_mlp1&#45;&gt;stage0_layer6_expert0_act -->
<g id="edge209" class="edge">
<title>stage0_layer6_expert0_mlp1&#45;&gt;stage0_layer6_expert0_act</title>
<path fill="none" stroke="black" d="M664.69,-17654.67C661.32,-17646.29 657.66,-17637.18 654.14,-17628.41"/>
<polygon fill="black" stroke="black" points="657.36,-17627.05 650.39,-17619.08 650.87,-17629.67 657.36,-17627.05"/>
</g>
<!-- stage0_layer6_expert0_mlp2 -->
<g id="node193" class="node">
<title>stage0_layer6_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="719.5,-17514.78 242.5,-17514.78 242.5,-17446.78 719.5,-17446.78 719.5,-17514.78"/>
<text text-anchor="middle" x="481" y="-17499.58" font-family="Times,serif" font-size="14.00">Expert 96 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="481" y="-17484.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="481" y="-17469.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="481" y="-17454.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert0_act&#45;&gt;stage0_layer6_expert0_mlp2 -->
<g id="edge210" class="edge">
<title>stage0_layer6_expert0_act&#45;&gt;stage0_layer6_expert0_mlp2</title>
<path fill="none" stroke="black" d="M586.35,-17550.67C571.7,-17541.09 555.58,-17530.54 540.44,-17520.65"/>
<polygon fill="black" stroke="black" points="541.95,-17517.45 531.66,-17514.91 538.12,-17523.31 541.95,-17517.45"/>
</g>
<!-- stage0_layer6_expert0_reduce -->
<g id="node194" class="node">
<title>stage0_layer6_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-17362.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-17381.5" font-family="Times,serif" font-size="14.00">Expert 96 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-17366.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-17351.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-17336.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert0_mlp2&#45;&gt;stage0_layer6_expert0_reduce -->
<g id="edge211" class="edge">
<title>stage0_layer6_expert0_mlp2&#45;&gt;stage0_layer6_expert0_reduce</title>
<path fill="none" stroke="black" d="M442.03,-17446.52C431.15,-17437.23 419.04,-17426.9 407.18,-17416.77"/>
<polygon fill="black" stroke="black" points="409.31,-17413.99 399.43,-17410.16 404.77,-17419.31 409.31,-17413.99"/>
</g>
<!-- stage0_layer6_expert_agg -->
<g id="node210" class="node">
<title>stage0_layer6_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1874.89,-17278.62 1170.35,-17278.62 989.11,-17142.62 1693.65,-17142.62 1874.89,-17278.62"/>
<text text-anchor="middle" x="1432" y="-17229.42" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1432" y="-17214.42" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1432" y="-17199.42" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1432" y="-17184.42" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert0_reduce&#45;&gt;stage0_layer6_expert_agg -->
<g id="edge212" class="edge">
<title>stage0_layer6_expert0_reduce&#45;&gt;stage0_layer6_expert_agg</title>
<path fill="none" stroke="black" d="M579.55,-17328.97C614.24,-17324.15 649.55,-17319.25 683,-17314.62 828.24,-17294.51 989.34,-17272.34 1124.8,-17253.74"/>
<polygon fill="black" stroke="black" points="1125.49,-17257.18 1134.92,-17252.35 1124.54,-17250.24 1125.49,-17257.18"/>
</g>
<!-- stage0_layer6_expert1_mlp1 -->
<g id="node196" class="node">
<title>stage0_layer6_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1366.5,-17722.78 919.5,-17722.78 919.5,-17654.78 1366.5,-17654.78 1366.5,-17722.78"/>
<text text-anchor="middle" x="1143" y="-17707.58" font-family="Times,serif" font-size="14.00">Expert 97 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1143" y="-17692.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1143" y="-17677.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1143" y="-17662.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert1_gate&#45;&gt;stage0_layer6_expert1_mlp1 -->
<g id="edge214" class="edge">
<title>stage0_layer6_expert1_gate&#45;&gt;stage0_layer6_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1149.08,-17758.67C1148.36,-17750.56 1147.59,-17741.76 1146.84,-17733.25"/>
<polygon fill="black" stroke="black" points="1150.3,-17732.74 1145.94,-17723.08 1143.33,-17733.35 1150.3,-17732.74"/>
</g>
<!-- stage0_layer6_expert1_act -->
<g id="node197" class="node">
<title>stage0_layer6_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1340.5,-17618.78 893.5,-17618.78 893.5,-17550.78 1340.5,-17550.78 1340.5,-17618.78"/>
<text text-anchor="middle" x="1117" y="-17603.58" font-family="Times,serif" font-size="14.00">Expert 97 Activation</text>
<text text-anchor="middle" x="1117" y="-17588.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-17573.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-17558.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert1_mlp1&#45;&gt;stage0_layer6_expert1_act -->
<g id="edge215" class="edge">
<title>stage0_layer6_expert1_mlp1&#45;&gt;stage0_layer6_expert1_act</title>
<path fill="none" stroke="black" d="M1134.56,-17654.67C1132.47,-17646.47 1130.2,-17637.57 1128.01,-17628.97"/>
<polygon fill="black" stroke="black" points="1131.35,-17627.91 1125.49,-17619.08 1124.57,-17629.64 1131.35,-17627.91"/>
</g>
<!-- stage0_layer6_expert1_mlp2 -->
<g id="node198" class="node">
<title>stage0_layer6_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-17514.78 827.5,-17514.78 827.5,-17446.78 1304.5,-17446.78 1304.5,-17514.78"/>
<text text-anchor="middle" x="1066" y="-17499.58" font-family="Times,serif" font-size="14.00">Expert 97 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-17484.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-17469.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-17454.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert1_act&#45;&gt;stage0_layer6_expert1_mlp2 -->
<g id="edge216" class="edge">
<title>stage0_layer6_expert1_act&#45;&gt;stage0_layer6_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1100.44,-17550.67C1096.21,-17542.2 1091.6,-17532.99 1087.18,-17524.13"/>
<polygon fill="black" stroke="black" points="1090.25,-17522.46 1082.65,-17515.08 1083.99,-17525.59 1090.25,-17522.46"/>
</g>
<!-- stage0_layer6_expert1_reduce -->
<g id="node199" class="node">
<title>stage0_layer6_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-17362.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-17381.5" font-family="Times,serif" font-size="14.00">Expert 97 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-17366.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-17351.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-17336.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert1_mlp2&#45;&gt;stage0_layer6_expert1_reduce -->
<g id="edge217" class="edge">
<title>stage0_layer6_expert1_mlp2&#45;&gt;stage0_layer6_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.1,-17446.52C1049.91,-17438.26 1046.39,-17429.19 1042.89,-17420.16"/>
<polygon fill="black" stroke="black" points="1046.14,-17418.87 1039.26,-17410.81 1039.61,-17421.4 1046.14,-17418.87"/>
</g>
<!-- stage0_layer6_expert1_reduce&#45;&gt;stage0_layer6_expert_agg -->
<g id="edge218" class="edge">
<title>stage0_layer6_expert1_reduce&#45;&gt;stage0_layer6_expert_agg</title>
<path fill="none" stroke="black" d="M1140.98,-17317.89C1171.74,-17306.66 1205.6,-17294.29 1239.02,-17282.09"/>
<polygon fill="black" stroke="black" points="1240.24,-17285.37 1248.43,-17278.65 1237.84,-17278.79 1240.24,-17285.37"/>
</g>
<!-- stage0_layer6_expert2_mlp1 -->
<g id="node201" class="node">
<title>stage0_layer6_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1838.5,-17722.78 1391.5,-17722.78 1391.5,-17654.78 1838.5,-17654.78 1838.5,-17722.78"/>
<text text-anchor="middle" x="1615" y="-17707.58" font-family="Times,serif" font-size="14.00">Expert 98 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1615" y="-17692.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1615" y="-17677.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1615" y="-17662.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert2_gate&#45;&gt;stage0_layer6_expert2_mlp1 -->
<g id="edge220" class="edge">
<title>stage0_layer6_expert2_gate&#45;&gt;stage0_layer6_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1608.25,-17758.67C1609.04,-17750.56 1609.9,-17741.76 1610.74,-17733.25"/>
<polygon fill="black" stroke="black" points="1614.24,-17733.38 1611.74,-17723.08 1607.28,-17732.69 1614.24,-17733.38"/>
</g>
<!-- stage0_layer6_expert2_act -->
<g id="node202" class="node">
<title>stage0_layer6_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1848.5,-17618.78 1401.5,-17618.78 1401.5,-17550.78 1848.5,-17550.78 1848.5,-17618.78"/>
<text text-anchor="middle" x="1625" y="-17603.58" font-family="Times,serif" font-size="14.00">Expert 98 Activation</text>
<text text-anchor="middle" x="1625" y="-17588.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-17573.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-17558.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert2_mlp1&#45;&gt;stage0_layer6_expert2_act -->
<g id="edge221" class="edge">
<title>stage0_layer6_expert2_mlp1&#45;&gt;stage0_layer6_expert2_act</title>
<path fill="none" stroke="black" d="M1618.25,-17654.67C1619.04,-17646.56 1619.9,-17637.76 1620.74,-17629.25"/>
<polygon fill="black" stroke="black" points="1624.24,-17629.38 1621.74,-17619.08 1617.28,-17628.69 1624.24,-17629.38"/>
</g>
<!-- stage0_layer6_expert2_mlp2 -->
<g id="node203" class="node">
<title>stage0_layer6_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1889.5,-17514.78 1412.5,-17514.78 1412.5,-17446.78 1889.5,-17446.78 1889.5,-17514.78"/>
<text text-anchor="middle" x="1651" y="-17499.58" font-family="Times,serif" font-size="14.00">Expert 98 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1651" y="-17484.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1651" y="-17469.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1651" y="-17454.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert2_act&#45;&gt;stage0_layer6_expert2_mlp2 -->
<g id="edge222" class="edge">
<title>stage0_layer6_expert2_act&#45;&gt;stage0_layer6_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1633.44,-17550.67C1635.53,-17542.47 1637.8,-17533.57 1639.99,-17524.97"/>
<polygon fill="black" stroke="black" points="1643.43,-17525.64 1642.51,-17515.08 1636.65,-17523.91 1643.43,-17525.64"/>
</g>
<!-- stage0_layer6_expert2_reduce -->
<g id="node204" class="node">
<title>stage0_layer6_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-17362.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-17381.5" font-family="Times,serif" font-size="14.00">Expert 98 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-17366.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-17351.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-17336.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert2_mlp2&#45;&gt;stage0_layer6_expert2_reduce -->
<g id="edge223" class="edge">
<title>stage0_layer6_expert2_mlp2&#45;&gt;stage0_layer6_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.18,-17446.52C1667.45,-17438.26 1671.05,-17429.19 1674.63,-17420.16"/>
<polygon fill="black" stroke="black" points="1677.9,-17421.39 1678.33,-17410.81 1671.39,-17418.82 1677.9,-17421.39"/>
</g>
<!-- stage0_layer6_expert2_reduce&#45;&gt;stage0_layer6_expert_agg -->
<g id="edge224" class="edge">
<title>stage0_layer6_expert2_reduce&#45;&gt;stage0_layer6_expert_agg</title>
<path fill="none" stroke="black" d="M1616.41,-17316.06C1598.45,-17305.89 1578.98,-17294.86 1559.65,-17283.91"/>
<polygon fill="black" stroke="black" points="1561.21,-17280.77 1550.78,-17278.89 1557.76,-17286.86 1561.21,-17280.77"/>
</g>
<!-- stage0_layer6_expert3_mlp1 -->
<g id="node206" class="node">
<title>stage0_layer6_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2307.5,-17722.78 1860.5,-17722.78 1860.5,-17654.78 2307.5,-17654.78 2307.5,-17722.78"/>
<text text-anchor="middle" x="2084" y="-17707.58" font-family="Times,serif" font-size="14.00">Expert 99 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2084" y="-17692.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2084" y="-17677.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2084" y="-17662.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert3_gate&#45;&gt;stage0_layer6_expert3_mlp1 -->
<g id="edge226" class="edge">
<title>stage0_layer6_expert3_gate&#45;&gt;stage0_layer6_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2070.49,-17758.67C2072.1,-17750.47 2073.85,-17741.57 2075.53,-17732.97"/>
<polygon fill="black" stroke="black" points="2078.98,-17733.57 2077.47,-17723.08 2072.11,-17732.22 2078.98,-17733.57"/>
</g>
<!-- stage0_layer6_expert3_act -->
<g id="node207" class="node">
<title>stage0_layer6_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2322.5,-17618.78 1875.5,-17618.78 1875.5,-17550.78 2322.5,-17550.78 2322.5,-17618.78"/>
<text text-anchor="middle" x="2099" y="-17603.58" font-family="Times,serif" font-size="14.00">Expert 99 Activation</text>
<text text-anchor="middle" x="2099" y="-17588.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-17573.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-17558.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert3_mlp1&#45;&gt;stage0_layer6_expert3_act -->
<g id="edge227" class="edge">
<title>stage0_layer6_expert3_mlp1&#45;&gt;stage0_layer6_expert3_act</title>
<path fill="none" stroke="black" d="M2088.87,-17654.67C2090.06,-17646.56 2091.36,-17637.76 2092.61,-17629.25"/>
<polygon fill="black" stroke="black" points="2096.11,-17629.48 2094.1,-17619.08 2089.19,-17628.47 2096.11,-17629.48"/>
</g>
<!-- stage0_layer6_expert3_mlp2 -->
<g id="node208" class="node">
<title>stage0_layer6_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2520.5,-17514.78 2043.5,-17514.78 2043.5,-17446.78 2520.5,-17446.78 2520.5,-17514.78"/>
<text text-anchor="middle" x="2282" y="-17499.58" font-family="Times,serif" font-size="14.00">Expert 99 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2282" y="-17484.58" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2282" y="-17469.58" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2282" y="-17454.58" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert3_act&#45;&gt;stage0_layer6_expert3_mlp2 -->
<g id="edge228" class="edge">
<title>stage0_layer6_expert3_act&#45;&gt;stage0_layer6_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2158.41,-17550.67C2176.08,-17540.82 2195.58,-17529.95 2213.76,-17519.82"/>
<polygon fill="black" stroke="black" points="2215.54,-17522.83 2222.57,-17514.91 2212.13,-17516.72 2215.54,-17522.83"/>
</g>
<!-- stage0_layer6_expert3_reduce -->
<g id="node209" class="node">
<title>stage0_layer6_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-17362.7" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-17381.5" font-family="Times,serif" font-size="14.00">Expert 99 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-17366.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-17351.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-17336.5" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert3_mlp2&#45;&gt;stage0_layer6_expert3_reduce -->
<g id="edge229" class="edge">
<title>stage0_layer6_expert3_mlp2&#45;&gt;stage0_layer6_expert3_reduce</title>
<path fill="none" stroke="black" d="M2308.08,-17446.52C2314.89,-17437.83 2322.41,-17428.23 2329.86,-17418.74"/>
<polygon fill="black" stroke="black" points="2332.65,-17420.84 2336.07,-17410.81 2327.15,-17416.52 2332.65,-17420.84"/>
</g>
<!-- stage0_layer6_expert3_reduce&#45;&gt;stage0_layer6_expert_agg -->
<g id="edge230" class="edge">
<title>stage0_layer6_expert3_reduce&#45;&gt;stage0_layer6_expert_agg</title>
<path fill="none" stroke="black" d="M2154.16,-17326.8C2066.92,-17312.88 1963.33,-17296.36 1862.24,-17280.24"/>
<polygon fill="black" stroke="black" points="1862.58,-17276.75 1852.15,-17278.63 1861.48,-17283.66 1862.58,-17276.75"/>
</g>
<!-- stage0_layer6_residual2 -->
<g id="node211" class="node">
<title>stage0_layer6_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1874.89,-17106.62 1170.35,-17106.62 989.11,-16970.62 1693.65,-16970.62 1874.89,-17106.62"/>
<text text-anchor="middle" x="1432" y="-17057.42" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1432" y="-17042.42" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1432" y="-17027.42" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1432" y="-17012.42" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_expert_agg&#45;&gt;stage0_layer6_residual2 -->
<g id="edge231" class="edge">
<title>stage0_layer6_expert_agg&#45;&gt;stage0_layer6_residual2</title>
<path fill="none" stroke="black" d="M1432,-17142.43C1432,-17134.11 1432,-17125.56 1432,-17117.11"/>
<polygon fill="black" stroke="black" points="1435.5,-17116.87 1432,-17106.87 1428.5,-17116.87 1435.5,-17116.87"/>
</g>
<!-- stage0_layer7_layernorm -->
<g id="node212" class="node">
<title>stage0_layer7_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-16923.62 1228.5,-16923.62 1228.5,-16855.62 1635.5,-16855.62 1635.5,-16923.62"/>
<text text-anchor="middle" x="1432" y="-16908.42" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1432" y="-16893.42" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1432" y="-16878.42" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1432" y="-16863.42" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer6_residual2&#45;&gt;stage0_layer7_layernorm -->
<g id="edge232" class="edge">
<title>stage0_layer6_residual2&#45;&gt;stage0_layer7_layernorm</title>
<path fill="none" stroke="black" d="M1432,-16970.57C1432,-16958.16 1432,-16945.51 1432,-16934.04"/>
<polygon fill="black" stroke="black" points="1435.5,-16933.87 1432,-16923.87 1428.5,-16933.87 1435.5,-16933.87"/>
</g>
<!-- stage0_layer7_qkv_proj -->
<g id="node213" class="node">
<title>stage0_layer7_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1689.5,-16819.62 1174.5,-16819.62 1174.5,-16751.62 1689.5,-16751.62 1689.5,-16819.62"/>
<text text-anchor="middle" x="1432" y="-16804.42" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1432" y="-16789.42" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1432" y="-16774.42" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1432" y="-16759.42" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_layernorm&#45;&gt;stage0_layer7_qkv_proj -->
<g id="edge233" class="edge">
<title>stage0_layer7_layernorm&#45;&gt;stage0_layer7_qkv_proj</title>
<path fill="none" stroke="black" d="M1432,-16855.5C1432,-16847.39 1432,-16838.6 1432,-16830.09"/>
<polygon fill="black" stroke="black" points="1435.5,-16829.92 1432,-16819.92 1428.5,-16829.92 1435.5,-16829.92"/>
</g>
<!-- stage0_layer7_qkv_gather -->
<g id="node214" class="node">
<title>stage0_layer7_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1432" cy="-16667.53" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1432" y="-16686.33" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1432" y="-16671.33" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1432" y="-16656.33" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1432" y="-16641.33" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_qkv_proj&#45;&gt;stage0_layer7_qkv_gather -->
<g id="edge234" class="edge">
<title>stage0_layer7_qkv_proj&#45;&gt;stage0_layer7_qkv_gather</title>
<path fill="none" stroke="black" d="M1432,-16751.35C1432,-16743.36 1432,-16734.59 1432,-16725.85"/>
<polygon fill="black" stroke="black" points="1435.5,-16725.64 1432,-16715.64 1428.5,-16725.64 1435.5,-16725.64"/>
</g>
<!-- stage0_layer7_attention -->
<g id="node215" class="node">
<title>stage0_layer7_attention</title>
<polygon fill="lightgreen" stroke="black" points="1683.5,-16583.45 1180.5,-16583.45 1180.5,-16515.45 1683.5,-16515.45 1683.5,-16583.45"/>
<text text-anchor="middle" x="1432" y="-16568.25" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1432" y="-16553.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1432" y="-16538.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1432" y="-16523.25" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_qkv_gather&#45;&gt;stage0_layer7_attention -->
<g id="edge235" class="edge">
<title>stage0_layer7_qkv_gather&#45;&gt;stage0_layer7_attention</title>
<path fill="none" stroke="black" d="M1432,-16619.32C1432,-16610.93 1432,-16602.23 1432,-16593.96"/>
<polygon fill="black" stroke="black" points="1435.5,-16593.75 1432,-16583.75 1428.5,-16593.75 1435.5,-16593.75"/>
</g>
<!-- stage0_layer7_attn_out -->
<g id="node216" class="node">
<title>stage0_layer7_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1670.5,-16479.45 1193.5,-16479.45 1193.5,-16411.45 1670.5,-16411.45 1670.5,-16479.45"/>
<text text-anchor="middle" x="1432" y="-16464.25" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1432" y="-16449.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1432" y="-16434.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1432" y="-16419.25" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_attention&#45;&gt;stage0_layer7_attn_out -->
<g id="edge236" class="edge">
<title>stage0_layer7_attention&#45;&gt;stage0_layer7_attn_out</title>
<path fill="none" stroke="black" d="M1432,-16515.33C1432,-16507.23 1432,-16498.43 1432,-16489.92"/>
<polygon fill="black" stroke="black" points="1435.5,-16489.75 1432,-16479.75 1428.5,-16489.75 1435.5,-16489.75"/>
</g>
<!-- stage0_layer7_attn_reduce -->
<g id="node217" class="node">
<title>stage0_layer7_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1432" cy="-16327.37" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1432" y="-16346.17" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1432" y="-16331.17" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1432" y="-16316.17" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1432" y="-16301.17" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_attn_out&#45;&gt;stage0_layer7_attn_reduce -->
<g id="edge237" class="edge">
<title>stage0_layer7_attn_out&#45;&gt;stage0_layer7_attn_reduce</title>
<path fill="none" stroke="black" d="M1432,-16411.18C1432,-16403.19 1432,-16394.43 1432,-16385.68"/>
<polygon fill="black" stroke="black" points="1435.5,-16385.48 1432,-16375.48 1428.5,-16385.48 1435.5,-16385.48"/>
</g>
<!-- stage0_layer7_residual1 -->
<g id="node218" class="node">
<title>stage0_layer7_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1874.89,-16243.28 1170.35,-16243.28 989.11,-16107.28 1693.65,-16107.28 1874.89,-16243.28"/>
<text text-anchor="middle" x="1432" y="-16194.08" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1432" y="-16179.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1432" y="-16164.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1432" y="-16149.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_attn_reduce&#45;&gt;stage0_layer7_residual1 -->
<g id="edge238" class="edge">
<title>stage0_layer7_attn_reduce&#45;&gt;stage0_layer7_residual1</title>
<path fill="none" stroke="black" d="M1432,-16278.88C1432,-16270.79 1432,-16262.21 1432,-16253.59"/>
<polygon fill="black" stroke="black" points="1435.5,-16253.48 1432,-16243.48 1428.5,-16253.48 1435.5,-16253.48"/>
</g>
<!-- stage0_layer7_layernorm2 -->
<g id="node219" class="node">
<title>stage0_layer7_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-16071.28 1228.5,-16071.28 1228.5,-16003.28 1635.5,-16003.28 1635.5,-16071.28"/>
<text text-anchor="middle" x="1432" y="-16056.08" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1432" y="-16041.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1432" y="-16026.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1432" y="-16011.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_residual1&#45;&gt;stage0_layer7_layernorm2 -->
<g id="edge239" class="edge">
<title>stage0_layer7_residual1&#45;&gt;stage0_layer7_layernorm2</title>
<path fill="none" stroke="black" d="M1432,-16107.08C1432,-16098.33 1432,-16089.56 1432,-16081.35"/>
<polygon fill="black" stroke="black" points="1435.5,-16081.3 1432,-16071.3 1428.5,-16081.3 1435.5,-16081.3"/>
</g>
<!-- stage0_layer7_expert0_gate -->
<g id="node220" class="node">
<title>stage0_layer7_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="949.5,-15967.28 526.5,-15967.28 526.5,-15899.28 949.5,-15899.28 949.5,-15967.28"/>
<text text-anchor="middle" x="738" y="-15952.08" font-family="Times,serif" font-size="14.00">Expert Gate 112</text>
<text text-anchor="middle" x="738" y="-15937.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="738" y="-15922.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="738" y="-15907.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_layernorm2&#45;&gt;stage0_layer7_expert0_gate -->
<g id="edge240" class="edge">
<title>stage0_layer7_layernorm2&#45;&gt;stage0_layer7_expert0_gate</title>
<path fill="none" stroke="black" d="M1228.47,-16006.37C1144.03,-15993.96 1045.84,-15979.53 959.59,-15966.85"/>
<polygon fill="black" stroke="black" points="960.07,-15963.38 949.67,-15965.39 959.06,-15970.31 960.07,-15963.38"/>
</g>
<!-- stage0_layer7_expert1_gate -->
<g id="node225" class="node">
<title>stage0_layer7_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1417.5,-15967.28 994.5,-15967.28 994.5,-15899.28 1417.5,-15899.28 1417.5,-15967.28"/>
<text text-anchor="middle" x="1206" y="-15952.08" font-family="Times,serif" font-size="14.00">Expert Gate 113</text>
<text text-anchor="middle" x="1206" y="-15937.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1206" y="-15922.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1206" y="-15907.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_layernorm2&#45;&gt;stage0_layer7_expert1_gate -->
<g id="edge246" class="edge">
<title>stage0_layer7_layernorm2&#45;&gt;stage0_layer7_expert1_gate</title>
<path fill="none" stroke="black" d="M1358.62,-16003.17C1336.31,-15993.09 1311.63,-15981.96 1288.74,-15971.63"/>
<polygon fill="black" stroke="black" points="1289.95,-15968.33 1279.39,-15967.41 1287.07,-15974.71 1289.95,-15968.33"/>
</g>
<!-- stage0_layer7_expert2_gate -->
<g id="node230" class="node">
<title>stage0_layer7_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1870.5,-15967.28 1447.5,-15967.28 1447.5,-15899.28 1870.5,-15899.28 1870.5,-15967.28"/>
<text text-anchor="middle" x="1659" y="-15952.08" font-family="Times,serif" font-size="14.00">Expert Gate 114</text>
<text text-anchor="middle" x="1659" y="-15937.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1659" y="-15922.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1659" y="-15907.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_layernorm2&#45;&gt;stage0_layer7_expert2_gate -->
<g id="edge252" class="edge">
<title>stage0_layer7_layernorm2&#45;&gt;stage0_layer7_expert2_gate</title>
<path fill="none" stroke="black" d="M1505.7,-16003.17C1528.12,-15993.09 1552.9,-15981.96 1575.89,-15971.63"/>
<polygon fill="black" stroke="black" points="1577.59,-15974.7 1585.28,-15967.41 1574.73,-15968.31 1577.59,-15974.7"/>
</g>
<!-- stage0_layer7_expert3_gate -->
<g id="node235" class="node">
<title>stage0_layer7_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2329.5,-15967.28 1906.5,-15967.28 1906.5,-15899.28 2329.5,-15899.28 2329.5,-15967.28"/>
<text text-anchor="middle" x="2118" y="-15952.08" font-family="Times,serif" font-size="14.00">Expert Gate 115</text>
<text text-anchor="middle" x="2118" y="-15937.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2118" y="-15922.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2118" y="-15907.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_layernorm2&#45;&gt;stage0_layer7_expert3_gate -->
<g id="edge258" class="edge">
<title>stage0_layer7_layernorm2&#45;&gt;stage0_layer7_expert3_gate</title>
<path fill="none" stroke="black" d="M1635.5,-16006.02C1717.58,-15993.82 1812.5,-15979.71 1896.32,-15967.24"/>
<polygon fill="black" stroke="black" points="1896.84,-15970.7 1906.22,-15965.77 1895.82,-15963.78 1896.84,-15970.7"/>
</g>
<!-- stage0_layer7_expert0_mlp1 -->
<g id="node221" class="node">
<title>stage0_layer7_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="935.5,-15863.28 488.5,-15863.28 488.5,-15795.28 935.5,-15795.28 935.5,-15863.28"/>
<text text-anchor="middle" x="712" y="-15848.08" font-family="Times,serif" font-size="14.00">Expert 112 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="712" y="-15833.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="712" y="-15818.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="712" y="-15803.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert0_gate&#45;&gt;stage0_layer7_expert0_mlp1 -->
<g id="edge241" class="edge">
<title>stage0_layer7_expert0_gate&#45;&gt;stage0_layer7_expert0_mlp1</title>
<path fill="none" stroke="black" d="M729.56,-15899.17C727.47,-15890.97 725.2,-15882.07 723.01,-15873.47"/>
<polygon fill="black" stroke="black" points="726.35,-15872.41 720.49,-15863.58 719.57,-15874.14 726.35,-15872.41"/>
</g>
<!-- stage0_layer7_expert0_act -->
<g id="node222" class="node">
<title>stage0_layer7_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="916.5,-15759.28 469.5,-15759.28 469.5,-15691.28 916.5,-15691.28 916.5,-15759.28"/>
<text text-anchor="middle" x="693" y="-15744.08" font-family="Times,serif" font-size="14.00">Expert 112 Activation</text>
<text text-anchor="middle" x="693" y="-15729.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="693" y="-15714.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="693" y="-15699.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert0_mlp1&#45;&gt;stage0_layer7_expert0_act -->
<g id="edge242" class="edge">
<title>stage0_layer7_expert0_mlp1&#45;&gt;stage0_layer7_expert0_act</title>
<path fill="none" stroke="black" d="M705.83,-15795.17C704.3,-15786.97 702.65,-15778.07 701.05,-15769.47"/>
<polygon fill="black" stroke="black" points="704.47,-15768.77 699.2,-15759.58 697.59,-15770.05 704.47,-15768.77"/>
</g>
<!-- stage0_layer7_expert0_mlp2 -->
<g id="node223" class="node">
<title>stage0_layer7_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="777.5,-15655.28 300.5,-15655.28 300.5,-15587.28 777.5,-15587.28 777.5,-15655.28"/>
<text text-anchor="middle" x="539" y="-15640.08" font-family="Times,serif" font-size="14.00">Expert 112 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="539" y="-15625.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="539" y="-15610.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="539" y="-15595.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert0_act&#45;&gt;stage0_layer7_expert0_mlp2 -->
<g id="edge243" class="edge">
<title>stage0_layer7_expert0_act&#45;&gt;stage0_layer7_expert0_mlp2</title>
<path fill="none" stroke="black" d="M643,-15691.17C628.54,-15681.59 612.62,-15671.04 597.68,-15661.15"/>
<polygon fill="black" stroke="black" points="599.28,-15658.01 589.01,-15655.41 595.42,-15663.85 599.28,-15658.01"/>
</g>
<!-- stage0_layer7_expert0_reduce -->
<g id="node224" class="node">
<title>stage0_layer7_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="403" cy="-15503.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="403" y="-15522" font-family="Times,serif" font-size="14.00">Expert 112 All&#45;Reduce</text>
<text text-anchor="middle" x="403" y="-15507" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="403" y="-15492" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="403" y="-15477" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert0_mlp2&#45;&gt;stage0_layer7_expert0_reduce -->
<g id="edge244" class="edge">
<title>stage0_layer7_expert0_mlp2&#45;&gt;stage0_layer7_expert0_reduce</title>
<path fill="none" stroke="black" d="M500.03,-15587.02C489.15,-15577.73 477.04,-15567.4 465.18,-15557.27"/>
<polygon fill="black" stroke="black" points="467.31,-15554.49 457.43,-15550.66 462.77,-15559.82 467.31,-15554.49"/>
</g>
<!-- stage0_layer7_expert_agg -->
<g id="node240" class="node">
<title>stage0_layer7_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1783.89,-15419.12 1079.35,-15419.12 898.11,-15283.12 1602.65,-15283.12 1783.89,-15419.12"/>
<text text-anchor="middle" x="1341" y="-15369.92" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1341" y="-15354.92" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1341" y="-15339.92" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1341" y="-15324.92" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert0_reduce&#45;&gt;stage0_layer7_expert_agg -->
<g id="edge245" class="edge">
<title>stage0_layer7_expert0_reduce&#45;&gt;stage0_layer7_expert_agg</title>
<path fill="none" stroke="black" d="M621.44,-15467.25C746.34,-15447.26 904.79,-15421.91 1041.19,-15400.09"/>
<polygon fill="black" stroke="black" points="1042.07,-15403.49 1051.39,-15398.45 1040.96,-15396.58 1042.07,-15403.49"/>
</g>
<!-- stage0_layer7_expert1_mlp1 -->
<g id="node226" class="node">
<title>stage0_layer7_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1420.5,-15863.28 973.5,-15863.28 973.5,-15795.28 1420.5,-15795.28 1420.5,-15863.28"/>
<text text-anchor="middle" x="1197" y="-15848.08" font-family="Times,serif" font-size="14.00">Expert 113 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1197" y="-15833.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1197" y="-15818.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1197" y="-15803.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert1_gate&#45;&gt;stage0_layer7_expert1_mlp1 -->
<g id="edge247" class="edge">
<title>stage0_layer7_expert1_gate&#45;&gt;stage0_layer7_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1203.08,-15899.17C1202.36,-15891.06 1201.59,-15882.26 1200.84,-15873.76"/>
<polygon fill="black" stroke="black" points="1204.3,-15873.24 1199.94,-15863.58 1197.33,-15873.85 1204.3,-15873.24"/>
</g>
<!-- stage0_layer7_expert1_act -->
<g id="node227" class="node">
<title>stage0_layer7_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1396.5,-15759.28 949.5,-15759.28 949.5,-15691.28 1396.5,-15691.28 1396.5,-15759.28"/>
<text text-anchor="middle" x="1173" y="-15744.08" font-family="Times,serif" font-size="14.00">Expert 113 Activation</text>
<text text-anchor="middle" x="1173" y="-15729.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1173" y="-15714.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1173" y="-15699.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert1_mlp1&#45;&gt;stage0_layer7_expert1_act -->
<g id="edge248" class="edge">
<title>stage0_layer7_expert1_mlp1&#45;&gt;stage0_layer7_expert1_act</title>
<path fill="none" stroke="black" d="M1189.21,-15795.17C1187.28,-15786.97 1185.19,-15778.07 1183.16,-15769.47"/>
<polygon fill="black" stroke="black" points="1186.53,-15768.51 1180.84,-15759.58 1179.72,-15770.12 1186.53,-15768.51"/>
</g>
<!-- stage0_layer7_expert1_mlp2 -->
<g id="node228" class="node">
<title>stage0_layer7_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1362.5,-15655.28 885.5,-15655.28 885.5,-15587.28 1362.5,-15587.28 1362.5,-15655.28"/>
<text text-anchor="middle" x="1124" y="-15640.08" font-family="Times,serif" font-size="14.00">Expert 113 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1124" y="-15625.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1124" y="-15610.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1124" y="-15595.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert1_act&#45;&gt;stage0_layer7_expert1_mlp2 -->
<g id="edge249" class="edge">
<title>stage0_layer7_expert1_act&#45;&gt;stage0_layer7_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1157.09,-15691.17C1153.03,-15682.7 1148.6,-15673.49 1144.35,-15664.63"/>
<polygon fill="black" stroke="black" points="1147.48,-15663.08 1140,-15655.58 1141.17,-15666.11 1147.48,-15663.08"/>
</g>
<!-- stage0_layer7_expert1_reduce -->
<g id="node229" class="node">
<title>stage0_layer7_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1079" cy="-15503.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1079" y="-15522" font-family="Times,serif" font-size="14.00">Expert 113 All&#45;Reduce</text>
<text text-anchor="middle" x="1079" y="-15507" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1079" y="-15492" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1079" y="-15477" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert1_mlp2&#45;&gt;stage0_layer7_expert1_reduce -->
<g id="edge250" class="edge">
<title>stage0_layer7_expert1_mlp2&#45;&gt;stage0_layer7_expert1_reduce</title>
<path fill="none" stroke="black" d="M1111.1,-15587.02C1107.91,-15578.76 1104.39,-15569.69 1100.89,-15560.66"/>
<polygon fill="black" stroke="black" points="1104.14,-15559.37 1097.26,-15551.31 1097.61,-15561.9 1104.14,-15559.37"/>
</g>
<!-- stage0_layer7_expert1_reduce&#45;&gt;stage0_layer7_expert_agg -->
<g id="edge251" class="edge">
<title>stage0_layer7_expert1_reduce&#45;&gt;stage0_layer7_expert_agg</title>
<path fill="none" stroke="black" d="M1159.03,-15456.35C1176.78,-15446.19 1196.01,-15435.17 1215.09,-15424.24"/>
<polygon fill="black" stroke="black" points="1216.9,-15427.24 1223.84,-15419.23 1213.42,-15421.16 1216.9,-15427.24"/>
</g>
<!-- stage0_layer7_expert2_mlp1 -->
<g id="node231" class="node">
<title>stage0_layer7_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1892.5,-15863.28 1445.5,-15863.28 1445.5,-15795.28 1892.5,-15795.28 1892.5,-15863.28"/>
<text text-anchor="middle" x="1669" y="-15848.08" font-family="Times,serif" font-size="14.00">Expert 114 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1669" y="-15833.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1669" y="-15818.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1669" y="-15803.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert2_gate&#45;&gt;stage0_layer7_expert2_mlp1 -->
<g id="edge253" class="edge">
<title>stage0_layer7_expert2_gate&#45;&gt;stage0_layer7_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1662.25,-15899.17C1663.04,-15891.06 1663.9,-15882.26 1664.74,-15873.76"/>
<polygon fill="black" stroke="black" points="1668.24,-15873.88 1665.74,-15863.58 1661.28,-15873.19 1668.24,-15873.88"/>
</g>
<!-- stage0_layer7_expert2_act -->
<g id="node232" class="node">
<title>stage0_layer7_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1907.5,-15759.28 1460.5,-15759.28 1460.5,-15691.28 1907.5,-15691.28 1907.5,-15759.28"/>
<text text-anchor="middle" x="1684" y="-15744.08" font-family="Times,serif" font-size="14.00">Expert 114 Activation</text>
<text text-anchor="middle" x="1684" y="-15729.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1684" y="-15714.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1684" y="-15699.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert2_mlp1&#45;&gt;stage0_layer7_expert2_act -->
<g id="edge254" class="edge">
<title>stage0_layer7_expert2_mlp1&#45;&gt;stage0_layer7_expert2_act</title>
<path fill="none" stroke="black" d="M1673.87,-15795.17C1675.06,-15787.06 1676.36,-15778.26 1677.61,-15769.76"/>
<polygon fill="black" stroke="black" points="1681.11,-15769.99 1679.1,-15759.58 1674.19,-15768.97 1681.11,-15769.99"/>
</g>
<!-- stage0_layer7_expert2_mlp2 -->
<g id="node233" class="node">
<title>stage0_layer7_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1947.5,-15655.28 1470.5,-15655.28 1470.5,-15587.28 1947.5,-15587.28 1947.5,-15655.28"/>
<text text-anchor="middle" x="1709" y="-15640.08" font-family="Times,serif" font-size="14.00">Expert 114 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1709" y="-15625.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1709" y="-15610.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1709" y="-15595.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert2_act&#45;&gt;stage0_layer7_expert2_mlp2 -->
<g id="edge255" class="edge">
<title>stage0_layer7_expert2_act&#45;&gt;stage0_layer7_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1692.12,-15691.17C1694.13,-15682.97 1696.31,-15674.07 1698.41,-15665.47"/>
<polygon fill="black" stroke="black" points="1701.86,-15666.13 1700.84,-15655.58 1695.06,-15664.46 1701.86,-15666.13"/>
</g>
<!-- stage0_layer7_expert2_reduce -->
<g id="node234" class="node">
<title>stage0_layer7_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1755" cy="-15503.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1755" y="-15522" font-family="Times,serif" font-size="14.00">Expert 114 All&#45;Reduce</text>
<text text-anchor="middle" x="1755" y="-15507" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1755" y="-15492" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1755" y="-15477" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert2_mlp2&#45;&gt;stage0_layer7_expert2_reduce -->
<g id="edge256" class="edge">
<title>stage0_layer7_expert2_mlp2&#45;&gt;stage0_layer7_expert2_reduce</title>
<path fill="none" stroke="black" d="M1722.18,-15587.02C1725.45,-15578.76 1729.05,-15569.69 1732.63,-15560.66"/>
<polygon fill="black" stroke="black" points="1735.9,-15561.9 1736.33,-15551.31 1729.39,-15559.32 1735.9,-15561.9"/>
</g>
<!-- stage0_layer7_expert2_reduce&#45;&gt;stage0_layer7_expert_agg -->
<g id="edge257" class="edge">
<title>stage0_layer7_expert2_reduce&#45;&gt;stage0_layer7_expert_agg</title>
<path fill="none" stroke="black" d="M1634.14,-15458.39C1603.16,-15447.16 1569.05,-15434.79 1535.39,-15422.59"/>
<polygon fill="black" stroke="black" points="1536.5,-15419.27 1525.91,-15419.15 1534.12,-15425.85 1536.5,-15419.27"/>
</g>
<!-- stage0_layer7_expert3_mlp1 -->
<g id="node236" class="node">
<title>stage0_layer7_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2368.5,-15863.28 1921.5,-15863.28 1921.5,-15795.28 2368.5,-15795.28 2368.5,-15863.28"/>
<text text-anchor="middle" x="2145" y="-15848.08" font-family="Times,serif" font-size="14.00">Expert 115 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2145" y="-15833.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2145" y="-15818.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2145" y="-15803.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert3_gate&#45;&gt;stage0_layer7_expert3_mlp1 -->
<g id="edge259" class="edge">
<title>stage0_layer7_expert3_gate&#45;&gt;stage0_layer7_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2126.77,-15899.17C2128.94,-15890.97 2131.29,-15882.07 2133.57,-15873.47"/>
<polygon fill="black" stroke="black" points="2137.01,-15874.14 2136.19,-15863.58 2130.24,-15872.35 2137.01,-15874.14"/>
</g>
<!-- stage0_layer7_expert3_act -->
<g id="node237" class="node">
<title>stage0_layer7_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2398.5,-15759.28 1951.5,-15759.28 1951.5,-15691.28 2398.5,-15691.28 2398.5,-15759.28"/>
<text text-anchor="middle" x="2175" y="-15744.08" font-family="Times,serif" font-size="14.00">Expert 115 Activation</text>
<text text-anchor="middle" x="2175" y="-15729.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2175" y="-15714.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2175" y="-15699.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert3_mlp1&#45;&gt;stage0_layer7_expert3_act -->
<g id="edge260" class="edge">
<title>stage0_layer7_expert3_mlp1&#45;&gt;stage0_layer7_expert3_act</title>
<path fill="none" stroke="black" d="M2154.74,-15795.17C2157.18,-15786.88 2159.82,-15777.88 2162.38,-15769.19"/>
<polygon fill="black" stroke="black" points="2165.74,-15770.16 2165.21,-15759.58 2159.03,-15768.19 2165.74,-15770.16"/>
</g>
<!-- stage0_layer7_expert3_mlp2 -->
<g id="node238" class="node">
<title>stage0_layer7_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2578.5,-15655.28 2101.5,-15655.28 2101.5,-15587.28 2578.5,-15587.28 2578.5,-15655.28"/>
<text text-anchor="middle" x="2340" y="-15640.08" font-family="Times,serif" font-size="14.00">Expert 115 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2340" y="-15625.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2340" y="-15610.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2340" y="-15595.08" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert3_act&#45;&gt;stage0_layer7_expert3_mlp2 -->
<g id="edge261" class="edge">
<title>stage0_layer7_expert3_act&#45;&gt;stage0_layer7_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2228.57,-15691.17C2244.21,-15681.5 2261.44,-15670.85 2277.58,-15660.87"/>
<polygon fill="black" stroke="black" points="2279.75,-15663.64 2286.42,-15655.41 2276.07,-15657.69 2279.75,-15663.64"/>
</g>
<!-- stage0_layer7_expert3_reduce -->
<g id="node239" class="node">
<title>stage0_layer7_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2431" cy="-15503.2" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2431" y="-15522" font-family="Times,serif" font-size="14.00">Expert 115 All&#45;Reduce</text>
<text text-anchor="middle" x="2431" y="-15507" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2431" y="-15492" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2431" y="-15477" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert3_mlp2&#45;&gt;stage0_layer7_expert3_reduce -->
<g id="edge262" class="edge">
<title>stage0_layer7_expert3_mlp2&#45;&gt;stage0_layer7_expert3_reduce</title>
<path fill="none" stroke="black" d="M2366.08,-15587.02C2372.89,-15578.33 2380.41,-15568.73 2387.86,-15559.24"/>
<polygon fill="black" stroke="black" points="2390.65,-15561.34 2394.07,-15551.31 2385.15,-15557.02 2390.65,-15561.34"/>
</g>
<!-- stage0_layer7_expert3_reduce&#45;&gt;stage0_layer7_expert_agg -->
<g id="edge263" class="edge">
<title>stage0_layer7_expert3_reduce&#45;&gt;stage0_layer7_expert_agg</title>
<path fill="none" stroke="black" d="M2196.45,-15469.46C2161.77,-15464.63 2126.45,-15459.74 2093,-15455.12 1992.88,-15441.29 1885.26,-15426.5 1783.61,-15412.57"/>
<polygon fill="black" stroke="black" points="1783.86,-15409.07 1773.48,-15411.18 1782.91,-15416.01 1783.86,-15409.07"/>
</g>
<!-- stage0_layer7_residual2 -->
<g id="node241" class="node">
<title>stage0_layer7_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1783.89,-15247.12 1079.35,-15247.12 898.11,-15111.12 1602.65,-15111.12 1783.89,-15247.12"/>
<text text-anchor="middle" x="1341" y="-15197.92" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1341" y="-15182.92" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1341" y="-15167.92" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1341" y="-15152.92" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7]</text>
</g>
<!-- stage0_layer7_expert_agg&#45;&gt;stage0_layer7_residual2 -->
<g id="edge264" class="edge">
<title>stage0_layer7_expert_agg&#45;&gt;stage0_layer7_residual2</title>
<path fill="none" stroke="black" d="M1341,-15282.93C1341,-15274.61 1341,-15266.06 1341,-15257.61"/>
<polygon fill="black" stroke="black" points="1344.5,-15257.37 1341,-15247.37 1337.5,-15257.37 1344.5,-15257.37"/>
</g>
<!-- pipeline_stage0_to_1 -->
<g id="node482" class="node">
<title>pipeline_stage0_to_1</title>
<ellipse fill="lightblue" stroke="black" cx="1341" cy="-15037.64" rx="302.78" ry="37.45"/>
<text text-anchor="middle" x="1341" y="-15048.94" font-family="Times,serif" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="1341" y="-15033.94" font-family="Times,serif" font-size="14.00">Stage 0 &#45;&gt; Stage 1</text>
<text text-anchor="middle" x="1341" y="-15018.94" font-family="Times,serif" font-size="14.00">GPU: [0, 1, 2, 3, 4, 5, 6, 7] &#45;&gt; [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage0_layer7_residual2&#45;&gt;pipeline_stage0_to_1 -->
<g id="edge265" class="edge">
<title>stage0_layer7_residual2&#45;&gt;pipeline_stage0_to_1</title>
<path fill="none" stroke="black" d="M1341,-15110.83C1341,-15102.21 1341,-15093.54 1341,-15085.35"/>
<polygon fill="black" stroke="black" points="1344.5,-15085.26 1341,-15075.26 1337.5,-15085.26 1344.5,-15085.26"/>
</g>
<!-- stage1_layer0_layernorm -->
<g id="node242" class="node">
<title>stage1_layer0_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1544.5,-14961.16 1137.5,-14961.16 1137.5,-14893.16 1544.5,-14893.16 1544.5,-14961.16"/>
<text text-anchor="middle" x="1341" y="-14945.96" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1341" y="-14930.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1341" y="-14915.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1341" y="-14900.96" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_qkv_proj -->
<g id="node243" class="node">
<title>stage1_layer0_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1598.5,-14857.16 1083.5,-14857.16 1083.5,-14789.16 1598.5,-14789.16 1598.5,-14857.16"/>
<text text-anchor="middle" x="1341" y="-14841.96" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1341" y="-14826.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1341" y="-14811.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1341" y="-14796.96" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_layernorm&#45;&gt;stage1_layer0_qkv_proj -->
<g id="edge267" class="edge">
<title>stage1_layer0_layernorm&#45;&gt;stage1_layer0_qkv_proj</title>
<path fill="none" stroke="black" d="M1341,-14893.05C1341,-14884.94 1341,-14876.15 1341,-14867.64"/>
<polygon fill="black" stroke="black" points="1344.5,-14867.46 1341,-14857.46 1337.5,-14867.46 1344.5,-14867.46"/>
</g>
<!-- stage1_layer0_qkv_gather -->
<g id="node244" class="node">
<title>stage1_layer0_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1341" cy="-14705.08" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1341" y="-14723.88" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1341" y="-14708.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1341" y="-14693.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1341" y="-14678.88" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_qkv_proj&#45;&gt;stage1_layer0_qkv_gather -->
<g id="edge268" class="edge">
<title>stage1_layer0_qkv_proj&#45;&gt;stage1_layer0_qkv_gather</title>
<path fill="none" stroke="black" d="M1341,-14788.9C1341,-14780.9 1341,-14772.14 1341,-14763.4"/>
<polygon fill="black" stroke="black" points="1344.5,-14763.19 1341,-14753.19 1337.5,-14763.19 1344.5,-14763.19"/>
</g>
<!-- stage1_layer0_attention -->
<g id="node245" class="node">
<title>stage1_layer0_attention</title>
<polygon fill="lightgreen" stroke="black" points="1592.5,-14621 1089.5,-14621 1089.5,-14553 1592.5,-14553 1592.5,-14621"/>
<text text-anchor="middle" x="1341" y="-14605.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1341" y="-14590.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1341" y="-14575.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1341" y="-14560.8" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_qkv_gather&#45;&gt;stage1_layer0_attention -->
<g id="edge269" class="edge">
<title>stage1_layer0_qkv_gather&#45;&gt;stage1_layer0_attention</title>
<path fill="none" stroke="black" d="M1341,-14656.86C1341,-14648.48 1341,-14639.78 1341,-14631.5"/>
<polygon fill="black" stroke="black" points="1344.5,-14631.3 1341,-14621.3 1337.5,-14631.3 1344.5,-14631.3"/>
</g>
<!-- stage1_layer0_attn_out -->
<g id="node246" class="node">
<title>stage1_layer0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1579.5,-14517 1102.5,-14517 1102.5,-14449 1579.5,-14449 1579.5,-14517"/>
<text text-anchor="middle" x="1341" y="-14501.8" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1341" y="-14486.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1341" y="-14471.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1341" y="-14456.8" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_attention&#45;&gt;stage1_layer0_attn_out -->
<g id="edge270" class="edge">
<title>stage1_layer0_attention&#45;&gt;stage1_layer0_attn_out</title>
<path fill="none" stroke="black" d="M1341,-14552.88C1341,-14544.77 1341,-14535.98 1341,-14527.47"/>
<polygon fill="black" stroke="black" points="1344.5,-14527.3 1341,-14517.3 1337.5,-14527.3 1344.5,-14527.3"/>
</g>
<!-- stage1_layer0_attn_reduce -->
<g id="node247" class="node">
<title>stage1_layer0_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1341" cy="-14364.91" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1341" y="-14383.71" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1341" y="-14368.71" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1341" y="-14353.71" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1341" y="-14338.71" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_attn_out&#45;&gt;stage1_layer0_attn_reduce -->
<g id="edge271" class="edge">
<title>stage1_layer0_attn_out&#45;&gt;stage1_layer0_attn_reduce</title>
<path fill="none" stroke="black" d="M1341,-14448.73C1341,-14440.74 1341,-14431.97 1341,-14423.23"/>
<polygon fill="black" stroke="black" points="1344.5,-14423.02 1341,-14413.02 1337.5,-14423.02 1344.5,-14423.02"/>
</g>
<!-- stage1_layer0_residual1 -->
<g id="node248" class="node">
<title>stage1_layer0_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1783.89,-14280.83 1079.35,-14280.83 898.11,-14144.83 1602.65,-14144.83 1783.89,-14280.83"/>
<text text-anchor="middle" x="1341" y="-14231.63" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1341" y="-14216.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1341" y="-14201.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1341" y="-14186.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_attn_reduce&#45;&gt;stage1_layer0_residual1 -->
<g id="edge272" class="edge">
<title>stage1_layer0_attn_reduce&#45;&gt;stage1_layer0_residual1</title>
<path fill="none" stroke="black" d="M1341,-14316.43C1341,-14308.34 1341,-14299.76 1341,-14291.14"/>
<polygon fill="black" stroke="black" points="1344.5,-14291.02 1341,-14281.02 1337.5,-14291.02 1344.5,-14291.02"/>
</g>
<!-- stage1_layer0_layernorm2 -->
<g id="node249" class="node">
<title>stage1_layer0_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1544.5,-14108.83 1137.5,-14108.83 1137.5,-14040.83 1544.5,-14040.83 1544.5,-14108.83"/>
<text text-anchor="middle" x="1341" y="-14093.63" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1341" y="-14078.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1341" y="-14063.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1341" y="-14048.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_residual1&#45;&gt;stage1_layer0_layernorm2 -->
<g id="edge273" class="edge">
<title>stage1_layer0_residual1&#45;&gt;stage1_layer0_layernorm2</title>
<path fill="none" stroke="black" d="M1341,-14144.63C1341,-14135.87 1341,-14127.11 1341,-14118.9"/>
<polygon fill="black" stroke="black" points="1344.5,-14118.85 1341,-14108.85 1337.5,-14118.85 1344.5,-14118.85"/>
</g>
<!-- stage1_layer0_expert0_gate -->
<g id="node250" class="node">
<title>stage1_layer0_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="873.5,-14004.83 450.5,-14004.83 450.5,-13936.83 873.5,-13936.83 873.5,-14004.83"/>
<text text-anchor="middle" x="662" y="-13989.63" font-family="Times,serif" font-size="14.00">Expert Gate 136</text>
<text text-anchor="middle" x="662" y="-13974.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="662" y="-13959.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="662" y="-13944.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_layernorm2&#45;&gt;stage1_layer0_expert0_gate -->
<g id="edge274" class="edge">
<title>stage1_layer0_layernorm2&#45;&gt;stage1_layer0_expert0_gate</title>
<path fill="none" stroke="black" d="M1137.28,-14043.23C1057.23,-14031.2 965.12,-14017.37 883.43,-14005.09"/>
<polygon fill="black" stroke="black" points="883.93,-14001.63 873.53,-14003.61 882.9,-14008.55 883.93,-14001.63"/>
</g>
<!-- stage1_layer0_expert1_gate -->
<g id="node255" class="node">
<title>stage1_layer0_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1326.5,-14004.83 903.5,-14004.83 903.5,-13936.83 1326.5,-13936.83 1326.5,-14004.83"/>
<text text-anchor="middle" x="1115" y="-13989.63" font-family="Times,serif" font-size="14.00">Expert Gate 137</text>
<text text-anchor="middle" x="1115" y="-13974.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1115" y="-13959.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1115" y="-13944.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_layernorm2&#45;&gt;stage1_layer0_expert1_gate -->
<g id="edge280" class="edge">
<title>stage1_layer0_layernorm2&#45;&gt;stage1_layer0_expert1_gate</title>
<path fill="none" stroke="black" d="M1267.62,-14040.71C1245.31,-14030.64 1220.63,-14019.5 1197.74,-14009.17"/>
<polygon fill="black" stroke="black" points="1198.95,-14005.88 1188.39,-14004.95 1196.07,-14012.26 1198.95,-14005.88"/>
</g>
<!-- stage1_layer0_expert2_gate -->
<g id="node260" class="node">
<title>stage1_layer0_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1779.5,-14004.83 1356.5,-14004.83 1356.5,-13936.83 1779.5,-13936.83 1779.5,-14004.83"/>
<text text-anchor="middle" x="1568" y="-13989.63" font-family="Times,serif" font-size="14.00">Expert Gate 138</text>
<text text-anchor="middle" x="1568" y="-13974.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1568" y="-13959.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1568" y="-13944.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_layernorm2&#45;&gt;stage1_layer0_expert2_gate -->
<g id="edge286" class="edge">
<title>stage1_layer0_layernorm2&#45;&gt;stage1_layer0_expert2_gate</title>
<path fill="none" stroke="black" d="M1414.7,-14040.71C1437.12,-14030.64 1461.9,-14019.5 1484.89,-14009.17"/>
<polygon fill="black" stroke="black" points="1486.59,-14012.25 1494.28,-14004.95 1483.73,-14005.86 1486.59,-14012.25"/>
</g>
<!-- stage1_layer0_expert3_gate -->
<g id="node265" class="node">
<title>stage1_layer0_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2238.5,-14004.83 1815.5,-14004.83 1815.5,-13936.83 2238.5,-13936.83 2238.5,-14004.83"/>
<text text-anchor="middle" x="2027" y="-13989.63" font-family="Times,serif" font-size="14.00">Expert Gate 139</text>
<text text-anchor="middle" x="2027" y="-13974.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2027" y="-13959.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2027" y="-13944.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_layernorm2&#45;&gt;stage1_layer0_expert3_gate -->
<g id="edge292" class="edge">
<title>stage1_layer0_layernorm2&#45;&gt;stage1_layer0_expert3_gate</title>
<path fill="none" stroke="black" d="M1544.5,-14043.57C1626.58,-14031.37 1721.5,-14017.25 1805.32,-14004.79"/>
<polygon fill="black" stroke="black" points="1805.84,-14008.25 1815.22,-14003.32 1804.82,-14001.33 1805.84,-14008.25"/>
</g>
<!-- stage1_layer0_expert0_mlp1 -->
<g id="node251" class="node">
<title>stage1_layer0_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="864.5,-13900.83 417.5,-13900.83 417.5,-13832.83 864.5,-13832.83 864.5,-13900.83"/>
<text text-anchor="middle" x="641" y="-13885.63" font-family="Times,serif" font-size="14.00">Expert 136 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="641" y="-13870.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="641" y="-13855.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="641" y="-13840.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert0_gate&#45;&gt;stage1_layer0_expert0_mlp1 -->
<g id="edge275" class="edge">
<title>stage1_layer0_expert0_gate&#45;&gt;stage1_layer0_expert0_mlp1</title>
<path fill="none" stroke="black" d="M655.18,-13936.71C653.49,-13928.52 651.66,-13919.62 649.89,-13911.02"/>
<polygon fill="black" stroke="black" points="653.3,-13910.22 647.86,-13901.13 646.44,-13911.63 653.3,-13910.22"/>
</g>
<!-- stage1_layer0_expert0_act -->
<g id="node252" class="node">
<title>stage1_layer0_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="818.5,-13796.83 371.5,-13796.83 371.5,-13728.83 818.5,-13728.83 818.5,-13796.83"/>
<text text-anchor="middle" x="595" y="-13781.63" font-family="Times,serif" font-size="14.00">Expert 136 Activation</text>
<text text-anchor="middle" x="595" y="-13766.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="595" y="-13751.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="595" y="-13736.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert0_mlp1&#45;&gt;stage1_layer0_expert0_act -->
<g id="edge276" class="edge">
<title>stage1_layer0_expert0_mlp1&#45;&gt;stage1_layer0_expert0_act</title>
<path fill="none" stroke="black" d="M626.07,-13832.71C622.29,-13824.34 618.18,-13815.23 614.23,-13806.46"/>
<polygon fill="black" stroke="black" points="617.32,-13804.81 610.02,-13797.13 610.94,-13807.68 617.32,-13804.81"/>
</g>
<!-- stage1_layer0_expert0_mlp2 -->
<g id="node253" class="node">
<title>stage1_layer0_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="629.5,-13692.83 152.5,-13692.83 152.5,-13624.83 629.5,-13624.83 629.5,-13692.83"/>
<text text-anchor="middle" x="391" y="-13677.63" font-family="Times,serif" font-size="14.00">Expert 136 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="391" y="-13662.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="391" y="-13647.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="391" y="-13632.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert0_act&#45;&gt;stage1_layer0_expert0_mlp2 -->
<g id="edge277" class="edge">
<title>stage1_layer0_expert0_act&#45;&gt;stage1_layer0_expert0_mlp2</title>
<path fill="none" stroke="black" d="M528.77,-13728.71C508.8,-13718.73 486.74,-13707.7 466.24,-13697.45"/>
<polygon fill="black" stroke="black" points="467.76,-13694.3 457.25,-13692.95 464.63,-13700.56 467.76,-13694.3"/>
</g>
<!-- stage1_layer0_expert0_reduce -->
<g id="node254" class="node">
<title>stage1_layer0_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-13540.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-13559.55" font-family="Times,serif" font-size="14.00">Expert 136 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-13544.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-13529.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-13514.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert0_mlp2&#45;&gt;stage1_layer0_expert0_reduce -->
<g id="edge278" class="edge">
<title>stage1_layer0_expert0_mlp2&#45;&gt;stage1_layer0_expert0_reduce</title>
<path fill="none" stroke="black" d="M377.82,-13624.57C374.55,-13616.31 370.95,-13607.23 367.37,-13598.21"/>
<polygon fill="black" stroke="black" points="370.61,-13596.86 363.67,-13588.86 364.1,-13599.44 370.61,-13596.86"/>
</g>
<!-- stage1_layer0_expert_agg -->
<g id="node270" class="node">
<title>stage1_layer0_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-13456.66 1116.35,-13456.66 935.11,-13320.66 1639.65,-13320.66 1820.89,-13456.66"/>
<text text-anchor="middle" x="1378" y="-13407.46" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1378" y="-13392.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1378" y="-13377.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-13362.46" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert0_reduce&#45;&gt;stage1_layer0_expert_agg -->
<g id="edge279" class="edge">
<title>stage1_layer0_expert0_reduce&#45;&gt;stage1_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M574.9,-13506.35C721.93,-13484.98 914.31,-13457.03 1073.92,-13433.84"/>
<polygon fill="black" stroke="black" points="1074.51,-13437.29 1083.9,-13432.39 1073.5,-13430.37 1074.51,-13437.29"/>
</g>
<!-- stage1_layer0_expert1_mlp1 -->
<g id="node256" class="node">
<title>stage1_layer0_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1329.5,-13900.83 882.5,-13900.83 882.5,-13832.83 1329.5,-13832.83 1329.5,-13900.83"/>
<text text-anchor="middle" x="1106" y="-13885.63" font-family="Times,serif" font-size="14.00">Expert 137 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1106" y="-13870.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1106" y="-13855.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1106" y="-13840.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert1_gate&#45;&gt;stage1_layer0_expert1_mlp1 -->
<g id="edge281" class="edge">
<title>stage1_layer0_expert1_gate&#45;&gt;stage1_layer0_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1112.08,-13936.71C1111.36,-13928.61 1110.59,-13919.81 1109.84,-13911.3"/>
<polygon fill="black" stroke="black" points="1113.3,-13910.78 1108.94,-13901.13 1106.33,-13911.4 1113.3,-13910.78"/>
</g>
<!-- stage1_layer0_expert1_act -->
<g id="node257" class="node">
<title>stage1_layer0_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1305.5,-13796.83 858.5,-13796.83 858.5,-13728.83 1305.5,-13728.83 1305.5,-13796.83"/>
<text text-anchor="middle" x="1082" y="-13781.63" font-family="Times,serif" font-size="14.00">Expert 137 Activation</text>
<text text-anchor="middle" x="1082" y="-13766.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1082" y="-13751.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1082" y="-13736.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert1_mlp1&#45;&gt;stage1_layer0_expert1_act -->
<g id="edge282" class="edge">
<title>stage1_layer0_expert1_mlp1&#45;&gt;stage1_layer0_expert1_act</title>
<path fill="none" stroke="black" d="M1098.21,-13832.71C1096.28,-13824.52 1094.19,-13815.62 1092.16,-13807.02"/>
<polygon fill="black" stroke="black" points="1095.53,-13806.06 1089.84,-13797.13 1088.72,-13807.67 1095.53,-13806.06"/>
</g>
<!-- stage1_layer0_expert1_mlp2 -->
<g id="node258" class="node">
<title>stage1_layer0_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1305.5,-13692.83 828.5,-13692.83 828.5,-13624.83 1305.5,-13624.83 1305.5,-13692.83"/>
<text text-anchor="middle" x="1067" y="-13677.63" font-family="Times,serif" font-size="14.00">Expert 137 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1067" y="-13662.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1067" y="-13647.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1067" y="-13632.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert1_act&#45;&gt;stage1_layer0_expert1_mlp2 -->
<g id="edge283" class="edge">
<title>stage1_layer0_expert1_act&#45;&gt;stage1_layer0_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1077.13,-13728.71C1075.94,-13720.61 1074.64,-13711.81 1073.39,-13703.3"/>
<polygon fill="black" stroke="black" points="1076.81,-13702.51 1071.9,-13693.13 1069.89,-13703.53 1076.81,-13702.51"/>
</g>
<!-- stage1_layer0_expert1_reduce -->
<g id="node259" class="node">
<title>stage1_layer0_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-13540.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-13559.55" font-family="Times,serif" font-size="14.00">Expert 137 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-13544.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-13529.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-13514.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert1_mlp2&#45;&gt;stage1_layer0_expert1_reduce -->
<g id="edge284" class="edge">
<title>stage1_layer0_expert1_mlp2&#45;&gt;stage1_layer0_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.82,-13624.57C1050.55,-13616.31 1046.95,-13607.23 1043.37,-13598.21"/>
<polygon fill="black" stroke="black" points="1046.61,-13596.86 1039.67,-13588.86 1040.1,-13599.44 1046.61,-13596.86"/>
</g>
<!-- stage1_layer0_expert1_reduce&#45;&gt;stage1_layer0_expert_agg -->
<g id="edge285" class="edge">
<title>stage1_layer0_expert1_reduce&#45;&gt;stage1_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M1127.15,-13495.12C1152.91,-13484.29 1181.09,-13472.45 1208.96,-13460.73"/>
<polygon fill="black" stroke="black" points="1210.53,-13463.86 1218.39,-13456.76 1207.82,-13457.41 1210.53,-13463.86"/>
</g>
<!-- stage1_layer0_expert2_mlp1 -->
<g id="node261" class="node">
<title>stage1_layer0_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1801.5,-13900.83 1354.5,-13900.83 1354.5,-13832.83 1801.5,-13832.83 1801.5,-13900.83"/>
<text text-anchor="middle" x="1578" y="-13885.63" font-family="Times,serif" font-size="14.00">Expert 138 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1578" y="-13870.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1578" y="-13855.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1578" y="-13840.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert2_gate&#45;&gt;stage1_layer0_expert2_mlp1 -->
<g id="edge287" class="edge">
<title>stage1_layer0_expert2_gate&#45;&gt;stage1_layer0_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1571.25,-13936.71C1572.04,-13928.61 1572.9,-13919.81 1573.74,-13911.3"/>
<polygon fill="black" stroke="black" points="1577.24,-13911.42 1574.74,-13901.13 1570.28,-13910.74 1577.24,-13911.42"/>
</g>
<!-- stage1_layer0_expert2_act -->
<g id="node262" class="node">
<title>stage1_layer0_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1826.5,-13796.83 1379.5,-13796.83 1379.5,-13728.83 1826.5,-13728.83 1826.5,-13796.83"/>
<text text-anchor="middle" x="1603" y="-13781.63" font-family="Times,serif" font-size="14.00">Expert 138 Activation</text>
<text text-anchor="middle" x="1603" y="-13766.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1603" y="-13751.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1603" y="-13736.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert2_mlp1&#45;&gt;stage1_layer0_expert2_act -->
<g id="edge288" class="edge">
<title>stage1_layer0_expert2_mlp1&#45;&gt;stage1_layer0_expert2_act</title>
<path fill="none" stroke="black" d="M1586.12,-13832.71C1588.13,-13824.52 1590.31,-13815.62 1592.41,-13807.02"/>
<polygon fill="black" stroke="black" points="1595.86,-13807.68 1594.84,-13797.13 1589.06,-13806.01 1595.86,-13807.68"/>
</g>
<!-- stage1_layer0_expert2_mlp2 -->
<g id="node263" class="node">
<title>stage1_layer0_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1890.5,-13692.83 1413.5,-13692.83 1413.5,-13624.83 1890.5,-13624.83 1890.5,-13692.83"/>
<text text-anchor="middle" x="1652" y="-13677.63" font-family="Times,serif" font-size="14.00">Expert 138 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1652" y="-13662.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1652" y="-13647.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1652" y="-13632.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert2_act&#45;&gt;stage1_layer0_expert2_mlp2 -->
<g id="edge289" class="edge">
<title>stage1_layer0_expert2_act&#45;&gt;stage1_layer0_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1618.91,-13728.71C1622.97,-13720.25 1627.4,-13711.04 1631.65,-13702.18"/>
<polygon fill="black" stroke="black" points="1634.83,-13703.66 1636,-13693.13 1628.52,-13700.63 1634.83,-13703.66"/>
</g>
<!-- stage1_layer0_expert2_reduce -->
<g id="node264" class="node">
<title>stage1_layer0_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-13540.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-13559.55" font-family="Times,serif" font-size="14.00">Expert 138 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-13544.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-13529.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-13514.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert2_mlp2&#45;&gt;stage1_layer0_expert2_reduce -->
<g id="edge290" class="edge">
<title>stage1_layer0_expert2_mlp2&#45;&gt;stage1_layer0_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.9,-13624.57C1668.09,-13616.31 1671.61,-13607.23 1675.11,-13598.21"/>
<polygon fill="black" stroke="black" points="1678.39,-13599.45 1678.74,-13588.86 1671.86,-13596.92 1678.39,-13599.45"/>
</g>
<!-- stage1_layer0_expert2_reduce&#45;&gt;stage1_layer0_expert_agg -->
<g id="edge291" class="edge">
<title>stage1_layer0_expert2_reduce&#45;&gt;stage1_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M1601.29,-13494.72C1578.75,-13484.11 1554.18,-13472.55 1529.84,-13461.1"/>
<polygon fill="black" stroke="black" points="1531.07,-13457.81 1520.53,-13456.72 1528.09,-13464.15 1531.07,-13457.81"/>
</g>
<!-- stage1_layer0_expert3_mlp1 -->
<g id="node266" class="node">
<title>stage1_layer0_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2270.5,-13900.83 1823.5,-13900.83 1823.5,-13832.83 2270.5,-13832.83 2270.5,-13900.83"/>
<text text-anchor="middle" x="2047" y="-13885.63" font-family="Times,serif" font-size="14.00">Expert 139 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2047" y="-13870.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2047" y="-13855.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2047" y="-13840.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert3_gate&#45;&gt;stage1_layer0_expert3_mlp1 -->
<g id="edge293" class="edge">
<title>stage1_layer0_expert3_gate&#45;&gt;stage1_layer0_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2033.49,-13936.71C2035.1,-13928.52 2036.85,-13919.62 2038.53,-13911.02"/>
<polygon fill="black" stroke="black" points="2041.98,-13911.62 2040.47,-13901.13 2035.11,-13910.27 2041.98,-13911.62"/>
</g>
<!-- stage1_layer0_expert3_act -->
<g id="node267" class="node">
<title>stage1_layer0_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2306.5,-13796.83 1859.5,-13796.83 1859.5,-13728.83 2306.5,-13728.83 2306.5,-13796.83"/>
<text text-anchor="middle" x="2083" y="-13781.63" font-family="Times,serif" font-size="14.00">Expert 139 Activation</text>
<text text-anchor="middle" x="2083" y="-13766.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2083" y="-13751.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2083" y="-13736.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert3_mlp1&#45;&gt;stage1_layer0_expert3_act -->
<g id="edge294" class="edge">
<title>stage1_layer0_expert3_mlp1&#45;&gt;stage1_layer0_expert3_act</title>
<path fill="none" stroke="black" d="M2058.69,-13832.71C2061.61,-13824.43 2064.79,-13815.43 2067.85,-13806.74"/>
<polygon fill="black" stroke="black" points="2071.22,-13807.72 2071.25,-13797.13 2064.62,-13805.39 2071.22,-13807.72"/>
</g>
<!-- stage1_layer0_expert3_mlp2 -->
<g id="node268" class="node">
<title>stage1_layer0_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2475.5,-13692.83 1998.5,-13692.83 1998.5,-13624.83 2475.5,-13624.83 2475.5,-13692.83"/>
<text text-anchor="middle" x="2237" y="-13677.63" font-family="Times,serif" font-size="14.00">Expert 139 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2237" y="-13662.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2237" y="-13647.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2237" y="-13632.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert3_act&#45;&gt;stage1_layer0_expert3_mlp2 -->
<g id="edge295" class="edge">
<title>stage1_layer0_expert3_act&#45;&gt;stage1_layer0_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2133,-13728.71C2147.46,-13719.13 2163.38,-13708.59 2178.32,-13698.69"/>
<polygon fill="black" stroke="black" points="2180.58,-13701.39 2186.99,-13692.95 2176.72,-13695.56 2180.58,-13701.39"/>
</g>
<!-- stage1_layer0_expert3_reduce -->
<g id="node269" class="node">
<title>stage1_layer0_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-13540.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-13559.55" font-family="Times,serif" font-size="14.00">Expert 139 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-13544.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-13529.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-13514.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert3_mlp2&#45;&gt;stage1_layer0_expert3_reduce -->
<g id="edge296" class="edge">
<title>stage1_layer0_expert3_mlp2&#45;&gt;stage1_layer0_expert3_reduce</title>
<path fill="none" stroke="black" d="M2275.97,-13624.57C2286.85,-13615.28 2298.96,-13604.95 2310.82,-13594.82"/>
<polygon fill="black" stroke="black" points="2313.23,-13597.36 2318.57,-13588.21 2308.69,-13592.04 2313.23,-13597.36"/>
</g>
<!-- stage1_layer0_expert3_reduce&#45;&gt;stage1_layer0_expert_agg -->
<g id="edge297" class="edge">
<title>stage1_layer0_expert3_reduce&#45;&gt;stage1_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M2147.53,-13505.74C2053.41,-13491.54 1940.53,-13474.51 1830.59,-13457.93"/>
<polygon fill="black" stroke="black" points="1831.06,-13454.46 1820.65,-13456.43 1830.02,-13461.38 1831.06,-13454.46"/>
</g>
<!-- stage1_layer0_residual2 -->
<g id="node271" class="node">
<title>stage1_layer0_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-13284.66 1116.35,-13284.66 935.11,-13148.66 1639.65,-13148.66 1820.89,-13284.66"/>
<text text-anchor="middle" x="1378" y="-13235.46" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1378" y="-13220.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-13205.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-13190.46" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_expert_agg&#45;&gt;stage1_layer0_residual2 -->
<g id="edge298" class="edge">
<title>stage1_layer0_expert_agg&#45;&gt;stage1_layer0_residual2</title>
<path fill="none" stroke="black" d="M1378,-13320.47C1378,-13312.16 1378,-13303.61 1378,-13295.16"/>
<polygon fill="black" stroke="black" points="1381.5,-13294.92 1378,-13284.92 1374.5,-13294.92 1381.5,-13294.92"/>
</g>
<!-- stage1_layer1_layernorm -->
<g id="node272" class="node">
<title>stage1_layer1_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-13101.66 1174.5,-13101.66 1174.5,-13033.66 1581.5,-13033.66 1581.5,-13101.66"/>
<text text-anchor="middle" x="1378" y="-13086.46" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1378" y="-13071.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-13056.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-13041.46" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer0_residual2&#45;&gt;stage1_layer1_layernorm -->
<g id="edge299" class="edge">
<title>stage1_layer0_residual2&#45;&gt;stage1_layer1_layernorm</title>
<path fill="none" stroke="black" d="M1378,-13148.62C1378,-13136.21 1378,-13123.56 1378,-13112.08"/>
<polygon fill="black" stroke="black" points="1381.5,-13111.92 1378,-13101.92 1374.5,-13111.92 1381.5,-13111.92"/>
</g>
<!-- stage1_layer1_qkv_proj -->
<g id="node273" class="node">
<title>stage1_layer1_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-12997.66 1120.5,-12997.66 1120.5,-12929.66 1635.5,-12929.66 1635.5,-12997.66"/>
<text text-anchor="middle" x="1378" y="-12982.46" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-12967.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-12952.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-12937.46" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_layernorm&#45;&gt;stage1_layer1_qkv_proj -->
<g id="edge300" class="edge">
<title>stage1_layer1_layernorm&#45;&gt;stage1_layer1_qkv_proj</title>
<path fill="none" stroke="black" d="M1378,-13033.55C1378,-13025.44 1378,-13016.65 1378,-13008.14"/>
<polygon fill="black" stroke="black" points="1381.5,-13007.96 1378,-12997.96 1374.5,-13007.96 1381.5,-13007.96"/>
</g>
<!-- stage1_layer1_qkv_gather -->
<g id="node274" class="node">
<title>stage1_layer1_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-12845.58" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-12864.38" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1378" y="-12849.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1378" y="-12834.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-12819.38" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_qkv_proj&#45;&gt;stage1_layer1_qkv_gather -->
<g id="edge301" class="edge">
<title>stage1_layer1_qkv_proj&#45;&gt;stage1_layer1_qkv_gather</title>
<path fill="none" stroke="black" d="M1378,-12929.4C1378,-12921.41 1378,-12912.64 1378,-12903.9"/>
<polygon fill="black" stroke="black" points="1381.5,-12903.69 1378,-12893.69 1374.5,-12903.69 1381.5,-12903.69"/>
</g>
<!-- stage1_layer1_attention -->
<g id="node275" class="node">
<title>stage1_layer1_attention</title>
<polygon fill="lightgreen" stroke="black" points="1629.5,-12761.5 1126.5,-12761.5 1126.5,-12693.5 1629.5,-12693.5 1629.5,-12761.5"/>
<text text-anchor="middle" x="1378" y="-12746.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1378" y="-12731.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-12716.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-12701.3" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_qkv_gather&#45;&gt;stage1_layer1_attention -->
<g id="edge302" class="edge">
<title>stage1_layer1_qkv_gather&#45;&gt;stage1_layer1_attention</title>
<path fill="none" stroke="black" d="M1378,-12797.36C1378,-12788.98 1378,-12780.28 1378,-12772"/>
<polygon fill="black" stroke="black" points="1381.5,-12771.8 1378,-12761.8 1374.5,-12771.8 1381.5,-12771.8"/>
</g>
<!-- stage1_layer1_attn_out -->
<g id="node276" class="node">
<title>stage1_layer1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1616.5,-12657.5 1139.5,-12657.5 1139.5,-12589.5 1616.5,-12589.5 1616.5,-12657.5"/>
<text text-anchor="middle" x="1378" y="-12642.3" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-12627.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-12612.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-12597.3" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_attention&#45;&gt;stage1_layer1_attn_out -->
<g id="edge303" class="edge">
<title>stage1_layer1_attention&#45;&gt;stage1_layer1_attn_out</title>
<path fill="none" stroke="black" d="M1378,-12693.38C1378,-12685.27 1378,-12676.48 1378,-12667.97"/>
<polygon fill="black" stroke="black" points="1381.5,-12667.8 1378,-12657.8 1374.5,-12667.8 1381.5,-12667.8"/>
</g>
<!-- stage1_layer1_attn_reduce -->
<g id="node277" class="node">
<title>stage1_layer1_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-12505.41" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-12524.21" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1378" y="-12509.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-12494.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-12479.21" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_attn_out&#45;&gt;stage1_layer1_attn_reduce -->
<g id="edge304" class="edge">
<title>stage1_layer1_attn_out&#45;&gt;stage1_layer1_attn_reduce</title>
<path fill="none" stroke="black" d="M1378,-12589.23C1378,-12581.24 1378,-12572.47 1378,-12563.73"/>
<polygon fill="black" stroke="black" points="1381.5,-12563.52 1378,-12553.52 1374.5,-12563.52 1381.5,-12563.52"/>
</g>
<!-- stage1_layer1_residual1 -->
<g id="node278" class="node">
<title>stage1_layer1_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-12421.33 1116.35,-12421.33 935.11,-12285.33 1639.65,-12285.33 1820.89,-12421.33"/>
<text text-anchor="middle" x="1378" y="-12372.13" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1378" y="-12357.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-12342.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-12327.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_attn_reduce&#45;&gt;stage1_layer1_residual1 -->
<g id="edge305" class="edge">
<title>stage1_layer1_attn_reduce&#45;&gt;stage1_layer1_residual1</title>
<path fill="none" stroke="black" d="M1378,-12456.93C1378,-12448.84 1378,-12440.26 1378,-12431.64"/>
<polygon fill="black" stroke="black" points="1381.5,-12431.53 1378,-12421.53 1374.5,-12431.53 1381.5,-12431.53"/>
</g>
<!-- stage1_layer1_layernorm2 -->
<g id="node279" class="node">
<title>stage1_layer1_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-12249.33 1174.5,-12249.33 1174.5,-12181.33 1581.5,-12181.33 1581.5,-12249.33"/>
<text text-anchor="middle" x="1378" y="-12234.13" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1378" y="-12219.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-12204.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-12189.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_residual1&#45;&gt;stage1_layer1_layernorm2 -->
<g id="edge306" class="edge">
<title>stage1_layer1_residual1&#45;&gt;stage1_layer1_layernorm2</title>
<path fill="none" stroke="black" d="M1378,-12285.13C1378,-12276.38 1378,-12267.61 1378,-12259.4"/>
<polygon fill="black" stroke="black" points="1381.5,-12259.35 1378,-12249.35 1374.5,-12259.35 1381.5,-12259.35"/>
</g>
<!-- stage1_layer1_expert0_gate -->
<g id="node280" class="node">
<title>stage1_layer1_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="910.5,-12145.33 487.5,-12145.33 487.5,-12077.33 910.5,-12077.33 910.5,-12145.33"/>
<text text-anchor="middle" x="699" y="-12130.13" font-family="Times,serif" font-size="14.00">Expert Gate 152</text>
<text text-anchor="middle" x="699" y="-12115.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="699" y="-12100.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="699" y="-12085.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_layernorm2&#45;&gt;stage1_layer1_expert0_gate -->
<g id="edge307" class="edge">
<title>stage1_layer1_layernorm2&#45;&gt;stage1_layer1_expert0_gate</title>
<path fill="none" stroke="black" d="M1174.28,-12183.73C1094.23,-12171.7 1002.12,-12157.87 920.43,-12145.59"/>
<polygon fill="black" stroke="black" points="920.93,-12142.13 910.53,-12144.11 919.9,-12149.05 920.93,-12142.13"/>
</g>
<!-- stage1_layer1_expert1_gate -->
<g id="node285" class="node">
<title>stage1_layer1_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1363.5,-12145.33 940.5,-12145.33 940.5,-12077.33 1363.5,-12077.33 1363.5,-12145.33"/>
<text text-anchor="middle" x="1152" y="-12130.13" font-family="Times,serif" font-size="14.00">Expert Gate 153</text>
<text text-anchor="middle" x="1152" y="-12115.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1152" y="-12100.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1152" y="-12085.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_layernorm2&#45;&gt;stage1_layer1_expert1_gate -->
<g id="edge313" class="edge">
<title>stage1_layer1_layernorm2&#45;&gt;stage1_layer1_expert1_gate</title>
<path fill="none" stroke="black" d="M1304.62,-12181.21C1282.31,-12171.14 1257.63,-12160 1234.74,-12149.67"/>
<polygon fill="black" stroke="black" points="1235.95,-12146.38 1225.39,-12145.46 1233.07,-12152.76 1235.95,-12146.38"/>
</g>
<!-- stage1_layer1_expert2_gate -->
<g id="node290" class="node">
<title>stage1_layer1_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1816.5,-12145.33 1393.5,-12145.33 1393.5,-12077.33 1816.5,-12077.33 1816.5,-12145.33"/>
<text text-anchor="middle" x="1605" y="-12130.13" font-family="Times,serif" font-size="14.00">Expert Gate 154</text>
<text text-anchor="middle" x="1605" y="-12115.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1605" y="-12100.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1605" y="-12085.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_layernorm2&#45;&gt;stage1_layer1_expert2_gate -->
<g id="edge319" class="edge">
<title>stage1_layer1_layernorm2&#45;&gt;stage1_layer1_expert2_gate</title>
<path fill="none" stroke="black" d="M1451.7,-12181.21C1474.12,-12171.14 1498.9,-12160 1521.89,-12149.67"/>
<polygon fill="black" stroke="black" points="1523.59,-12152.75 1531.28,-12145.46 1520.73,-12146.36 1523.59,-12152.75"/>
</g>
<!-- stage1_layer1_expert3_gate -->
<g id="node295" class="node">
<title>stage1_layer1_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2275.5,-12145.33 1852.5,-12145.33 1852.5,-12077.33 2275.5,-12077.33 2275.5,-12145.33"/>
<text text-anchor="middle" x="2064" y="-12130.13" font-family="Times,serif" font-size="14.00">Expert Gate 155</text>
<text text-anchor="middle" x="2064" y="-12115.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2064" y="-12100.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2064" y="-12085.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_layernorm2&#45;&gt;stage1_layer1_expert3_gate -->
<g id="edge325" class="edge">
<title>stage1_layer1_layernorm2&#45;&gt;stage1_layer1_expert3_gate</title>
<path fill="none" stroke="black" d="M1581.5,-12184.07C1663.58,-12171.87 1758.5,-12157.76 1842.32,-12145.29"/>
<polygon fill="black" stroke="black" points="1842.84,-12148.75 1852.22,-12143.82 1841.82,-12141.83 1842.84,-12148.75"/>
</g>
<!-- stage1_layer1_expert0_mlp1 -->
<g id="node281" class="node">
<title>stage1_layer1_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="901.5,-12041.33 454.5,-12041.33 454.5,-11973.33 901.5,-11973.33 901.5,-12041.33"/>
<text text-anchor="middle" x="678" y="-12026.13" font-family="Times,serif" font-size="14.00">Expert 152 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="678" y="-12011.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="678" y="-11996.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="678" y="-11981.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert0_gate&#45;&gt;stage1_layer1_expert0_mlp1 -->
<g id="edge308" class="edge">
<title>stage1_layer1_expert0_gate&#45;&gt;stage1_layer1_expert0_mlp1</title>
<path fill="none" stroke="black" d="M692.18,-12077.21C690.49,-12069.02 688.66,-12060.12 686.89,-12051.52"/>
<polygon fill="black" stroke="black" points="690.3,-12050.72 684.86,-12041.63 683.44,-12052.13 690.3,-12050.72"/>
</g>
<!-- stage1_layer1_expert0_act -->
<g id="node282" class="node">
<title>stage1_layer1_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="860.5,-11937.33 413.5,-11937.33 413.5,-11869.33 860.5,-11869.33 860.5,-11937.33"/>
<text text-anchor="middle" x="637" y="-11922.13" font-family="Times,serif" font-size="14.00">Expert 152 Activation</text>
<text text-anchor="middle" x="637" y="-11907.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-11892.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-11877.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert0_mlp1&#45;&gt;stage1_layer1_expert0_act -->
<g id="edge309" class="edge">
<title>stage1_layer1_expert0_mlp1&#45;&gt;stage1_layer1_expert0_act</title>
<path fill="none" stroke="black" d="M664.69,-11973.21C661.32,-11964.84 657.66,-11955.73 654.14,-11946.96"/>
<polygon fill="black" stroke="black" points="657.36,-11945.6 650.39,-11937.63 650.87,-11948.21 657.36,-11945.6"/>
</g>
<!-- stage1_layer1_expert0_mlp2 -->
<g id="node283" class="node">
<title>stage1_layer1_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="719.5,-11833.33 242.5,-11833.33 242.5,-11765.33 719.5,-11765.33 719.5,-11833.33"/>
<text text-anchor="middle" x="481" y="-11818.13" font-family="Times,serif" font-size="14.00">Expert 152 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="481" y="-11803.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="481" y="-11788.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="481" y="-11773.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert0_act&#45;&gt;stage1_layer1_expert0_mlp2 -->
<g id="edge310" class="edge">
<title>stage1_layer1_expert0_act&#45;&gt;stage1_layer1_expert0_mlp2</title>
<path fill="none" stroke="black" d="M586.35,-11869.21C571.7,-11859.63 555.58,-11849.09 540.44,-11839.19"/>
<polygon fill="black" stroke="black" points="541.95,-11836 531.66,-11833.46 538.12,-11841.86 541.95,-11836"/>
</g>
<!-- stage1_layer1_expert0_reduce -->
<g id="node284" class="node">
<title>stage1_layer1_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-11681.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-11700.05" font-family="Times,serif" font-size="14.00">Expert 152 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-11685.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-11670.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-11655.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert0_mlp2&#45;&gt;stage1_layer1_expert0_reduce -->
<g id="edge311" class="edge">
<title>stage1_layer1_expert0_mlp2&#45;&gt;stage1_layer1_expert0_reduce</title>
<path fill="none" stroke="black" d="M442.03,-11765.07C431.15,-11755.78 419.04,-11745.45 407.18,-11735.32"/>
<polygon fill="black" stroke="black" points="409.31,-11732.54 399.43,-11728.71 404.77,-11737.86 409.31,-11732.54"/>
</g>
<!-- stage1_layer1_expert_agg -->
<g id="node300" class="node">
<title>stage1_layer1_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-11597.16 1116.35,-11597.16 935.11,-11461.16 1639.65,-11461.16 1820.89,-11597.16"/>
<text text-anchor="middle" x="1378" y="-11547.96" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1378" y="-11532.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1378" y="-11517.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-11502.96" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert0_reduce&#45;&gt;stage1_layer1_expert_agg -->
<g id="edge312" class="edge">
<title>stage1_layer1_expert0_reduce&#45;&gt;stage1_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M574.9,-11646.85C721.93,-11625.48 914.31,-11597.53 1073.92,-11574.34"/>
<polygon fill="black" stroke="black" points="1074.51,-11577.79 1083.9,-11572.89 1073.5,-11570.87 1074.51,-11577.79"/>
</g>
<!-- stage1_layer1_expert1_mlp1 -->
<g id="node286" class="node">
<title>stage1_layer1_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1366.5,-12041.33 919.5,-12041.33 919.5,-11973.33 1366.5,-11973.33 1366.5,-12041.33"/>
<text text-anchor="middle" x="1143" y="-12026.13" font-family="Times,serif" font-size="14.00">Expert 153 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1143" y="-12011.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1143" y="-11996.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1143" y="-11981.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert1_gate&#45;&gt;stage1_layer1_expert1_mlp1 -->
<g id="edge314" class="edge">
<title>stage1_layer1_expert1_gate&#45;&gt;stage1_layer1_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1149.08,-12077.21C1148.36,-12069.11 1147.59,-12060.31 1146.84,-12051.8"/>
<polygon fill="black" stroke="black" points="1150.3,-12051.28 1145.94,-12041.63 1143.33,-12051.9 1150.3,-12051.28"/>
</g>
<!-- stage1_layer1_expert1_act -->
<g id="node287" class="node">
<title>stage1_layer1_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1340.5,-11937.33 893.5,-11937.33 893.5,-11869.33 1340.5,-11869.33 1340.5,-11937.33"/>
<text text-anchor="middle" x="1117" y="-11922.13" font-family="Times,serif" font-size="14.00">Expert 153 Activation</text>
<text text-anchor="middle" x="1117" y="-11907.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-11892.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-11877.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert1_mlp1&#45;&gt;stage1_layer1_expert1_act -->
<g id="edge315" class="edge">
<title>stage1_layer1_expert1_mlp1&#45;&gt;stage1_layer1_expert1_act</title>
<path fill="none" stroke="black" d="M1134.56,-11973.21C1132.47,-11965.02 1130.2,-11956.12 1128.01,-11947.52"/>
<polygon fill="black" stroke="black" points="1131.35,-11946.46 1125.49,-11937.63 1124.57,-11948.18 1131.35,-11946.46"/>
</g>
<!-- stage1_layer1_expert1_mlp2 -->
<g id="node288" class="node">
<title>stage1_layer1_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-11833.33 827.5,-11833.33 827.5,-11765.33 1304.5,-11765.33 1304.5,-11833.33"/>
<text text-anchor="middle" x="1066" y="-11818.13" font-family="Times,serif" font-size="14.00">Expert 153 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-11803.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-11788.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-11773.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert1_act&#45;&gt;stage1_layer1_expert1_mlp2 -->
<g id="edge316" class="edge">
<title>stage1_layer1_expert1_act&#45;&gt;stage1_layer1_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1100.44,-11869.21C1096.21,-11860.75 1091.6,-11851.54 1087.18,-11842.68"/>
<polygon fill="black" stroke="black" points="1090.25,-11841.01 1082.65,-11833.63 1083.99,-11844.14 1090.25,-11841.01"/>
</g>
<!-- stage1_layer1_expert1_reduce -->
<g id="node289" class="node">
<title>stage1_layer1_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-11681.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-11700.05" font-family="Times,serif" font-size="14.00">Expert 153 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-11685.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-11670.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-11655.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert1_mlp2&#45;&gt;stage1_layer1_expert1_reduce -->
<g id="edge317" class="edge">
<title>stage1_layer1_expert1_mlp2&#45;&gt;stage1_layer1_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.1,-11765.07C1049.91,-11756.81 1046.39,-11747.73 1042.89,-11738.71"/>
<polygon fill="black" stroke="black" points="1046.14,-11737.42 1039.26,-11729.36 1039.61,-11739.95 1046.14,-11737.42"/>
</g>
<!-- stage1_layer1_expert1_reduce&#45;&gt;stage1_layer1_expert_agg -->
<g id="edge318" class="edge">
<title>stage1_layer1_expert1_reduce&#45;&gt;stage1_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M1127.15,-11635.62C1152.91,-11624.79 1181.09,-11612.95 1208.96,-11601.23"/>
<polygon fill="black" stroke="black" points="1210.53,-11604.36 1218.39,-11597.26 1207.82,-11597.91 1210.53,-11604.36"/>
</g>
<!-- stage1_layer1_expert2_mlp1 -->
<g id="node291" class="node">
<title>stage1_layer1_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1838.5,-12041.33 1391.5,-12041.33 1391.5,-11973.33 1838.5,-11973.33 1838.5,-12041.33"/>
<text text-anchor="middle" x="1615" y="-12026.13" font-family="Times,serif" font-size="14.00">Expert 154 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1615" y="-12011.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1615" y="-11996.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1615" y="-11981.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert2_gate&#45;&gt;stage1_layer1_expert2_mlp1 -->
<g id="edge320" class="edge">
<title>stage1_layer1_expert2_gate&#45;&gt;stage1_layer1_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1608.25,-12077.21C1609.04,-12069.11 1609.9,-12060.31 1610.74,-12051.8"/>
<polygon fill="black" stroke="black" points="1614.24,-12051.92 1611.74,-12041.63 1607.28,-12051.24 1614.24,-12051.92"/>
</g>
<!-- stage1_layer1_expert2_act -->
<g id="node292" class="node">
<title>stage1_layer1_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1848.5,-11937.33 1401.5,-11937.33 1401.5,-11869.33 1848.5,-11869.33 1848.5,-11937.33"/>
<text text-anchor="middle" x="1625" y="-11922.13" font-family="Times,serif" font-size="14.00">Expert 154 Activation</text>
<text text-anchor="middle" x="1625" y="-11907.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-11892.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-11877.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert2_mlp1&#45;&gt;stage1_layer1_expert2_act -->
<g id="edge321" class="edge">
<title>stage1_layer1_expert2_mlp1&#45;&gt;stage1_layer1_expert2_act</title>
<path fill="none" stroke="black" d="M1618.25,-11973.21C1619.04,-11965.11 1619.9,-11956.31 1620.74,-11947.8"/>
<polygon fill="black" stroke="black" points="1624.24,-11947.92 1621.74,-11937.63 1617.28,-11947.24 1624.24,-11947.92"/>
</g>
<!-- stage1_layer1_expert2_mlp2 -->
<g id="node293" class="node">
<title>stage1_layer1_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1889.5,-11833.33 1412.5,-11833.33 1412.5,-11765.33 1889.5,-11765.33 1889.5,-11833.33"/>
<text text-anchor="middle" x="1651" y="-11818.13" font-family="Times,serif" font-size="14.00">Expert 154 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1651" y="-11803.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1651" y="-11788.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1651" y="-11773.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert2_act&#45;&gt;stage1_layer1_expert2_mlp2 -->
<g id="edge322" class="edge">
<title>stage1_layer1_expert2_act&#45;&gt;stage1_layer1_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1633.44,-11869.21C1635.53,-11861.02 1637.8,-11852.12 1639.99,-11843.52"/>
<polygon fill="black" stroke="black" points="1643.43,-11844.18 1642.51,-11833.63 1636.65,-11842.46 1643.43,-11844.18"/>
</g>
<!-- stage1_layer1_expert2_reduce -->
<g id="node294" class="node">
<title>stage1_layer1_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-11681.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-11700.05" font-family="Times,serif" font-size="14.00">Expert 154 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-11685.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-11670.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-11655.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert2_mlp2&#45;&gt;stage1_layer1_expert2_reduce -->
<g id="edge323" class="edge">
<title>stage1_layer1_expert2_mlp2&#45;&gt;stage1_layer1_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.18,-11765.07C1667.45,-11756.81 1671.05,-11747.73 1674.63,-11738.71"/>
<polygon fill="black" stroke="black" points="1677.9,-11739.94 1678.33,-11729.36 1671.39,-11737.36 1677.9,-11739.94"/>
</g>
<!-- stage1_layer1_expert2_reduce&#45;&gt;stage1_layer1_expert_agg -->
<g id="edge324" class="edge">
<title>stage1_layer1_expert2_reduce&#45;&gt;stage1_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M1601.29,-11635.22C1578.75,-11624.61 1554.18,-11613.05 1529.84,-11601.6"/>
<polygon fill="black" stroke="black" points="1531.07,-11598.31 1520.53,-11597.22 1528.09,-11604.65 1531.07,-11598.31"/>
</g>
<!-- stage1_layer1_expert3_mlp1 -->
<g id="node296" class="node">
<title>stage1_layer1_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2307.5,-12041.33 1860.5,-12041.33 1860.5,-11973.33 2307.5,-11973.33 2307.5,-12041.33"/>
<text text-anchor="middle" x="2084" y="-12026.13" font-family="Times,serif" font-size="14.00">Expert 155 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2084" y="-12011.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2084" y="-11996.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2084" y="-11981.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert3_gate&#45;&gt;stage1_layer1_expert3_mlp1 -->
<g id="edge326" class="edge">
<title>stage1_layer1_expert3_gate&#45;&gt;stage1_layer1_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2070.49,-12077.21C2072.1,-12069.02 2073.85,-12060.12 2075.53,-12051.52"/>
<polygon fill="black" stroke="black" points="2078.98,-12052.12 2077.47,-12041.63 2072.11,-12050.77 2078.98,-12052.12"/>
</g>
<!-- stage1_layer1_expert3_act -->
<g id="node297" class="node">
<title>stage1_layer1_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2322.5,-11937.33 1875.5,-11937.33 1875.5,-11869.33 2322.5,-11869.33 2322.5,-11937.33"/>
<text text-anchor="middle" x="2099" y="-11922.13" font-family="Times,serif" font-size="14.00">Expert 155 Activation</text>
<text text-anchor="middle" x="2099" y="-11907.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-11892.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-11877.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert3_mlp1&#45;&gt;stage1_layer1_expert3_act -->
<g id="edge327" class="edge">
<title>stage1_layer1_expert3_mlp1&#45;&gt;stage1_layer1_expert3_act</title>
<path fill="none" stroke="black" d="M2088.87,-11973.21C2090.06,-11965.11 2091.36,-11956.31 2092.61,-11947.8"/>
<polygon fill="black" stroke="black" points="2096.11,-11948.03 2094.1,-11937.63 2089.19,-11947.01 2096.11,-11948.03"/>
</g>
<!-- stage1_layer1_expert3_mlp2 -->
<g id="node298" class="node">
<title>stage1_layer1_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2520.5,-11833.33 2043.5,-11833.33 2043.5,-11765.33 2520.5,-11765.33 2520.5,-11833.33"/>
<text text-anchor="middle" x="2282" y="-11818.13" font-family="Times,serif" font-size="14.00">Expert 155 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2282" y="-11803.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2282" y="-11788.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2282" y="-11773.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert3_act&#45;&gt;stage1_layer1_expert3_mlp2 -->
<g id="edge328" class="edge">
<title>stage1_layer1_expert3_act&#45;&gt;stage1_layer1_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2158.41,-11869.21C2176.08,-11859.37 2195.58,-11848.5 2213.76,-11838.36"/>
<polygon fill="black" stroke="black" points="2215.54,-11841.38 2222.57,-11833.46 2212.13,-11835.27 2215.54,-11841.38"/>
</g>
<!-- stage1_layer1_expert3_reduce -->
<g id="node299" class="node">
<title>stage1_layer1_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-11681.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-11700.05" font-family="Times,serif" font-size="14.00">Expert 155 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-11685.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-11670.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-11655.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert3_mlp2&#45;&gt;stage1_layer1_expert3_reduce -->
<g id="edge329" class="edge">
<title>stage1_layer1_expert3_mlp2&#45;&gt;stage1_layer1_expert3_reduce</title>
<path fill="none" stroke="black" d="M2308.08,-11765.07C2314.89,-11756.38 2322.41,-11746.78 2329.86,-11737.28"/>
<polygon fill="black" stroke="black" points="2332.65,-11739.39 2336.07,-11729.36 2327.15,-11735.07 2332.65,-11739.39"/>
</g>
<!-- stage1_layer1_expert3_reduce&#45;&gt;stage1_layer1_expert_agg -->
<g id="edge330" class="edge">
<title>stage1_layer1_expert3_reduce&#45;&gt;stage1_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M2147.53,-11646.24C2053.41,-11632.04 1940.53,-11615.01 1830.59,-11598.43"/>
<polygon fill="black" stroke="black" points="1831.06,-11594.96 1820.65,-11596.93 1830.02,-11601.88 1831.06,-11594.96"/>
</g>
<!-- stage1_layer1_residual2 -->
<g id="node301" class="node">
<title>stage1_layer1_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-11425.16 1116.35,-11425.16 935.11,-11289.16 1639.65,-11289.16 1820.89,-11425.16"/>
<text text-anchor="middle" x="1378" y="-11375.96" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1378" y="-11360.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-11345.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-11330.96" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_expert_agg&#45;&gt;stage1_layer1_residual2 -->
<g id="edge331" class="edge">
<title>stage1_layer1_expert_agg&#45;&gt;stage1_layer1_residual2</title>
<path fill="none" stroke="black" d="M1378,-11460.98C1378,-11452.66 1378,-11444.11 1378,-11435.66"/>
<polygon fill="black" stroke="black" points="1381.5,-11435.42 1378,-11425.42 1374.5,-11435.42 1381.5,-11435.42"/>
</g>
<!-- stage1_layer2_layernorm -->
<g id="node302" class="node">
<title>stage1_layer2_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-11242.16 1174.5,-11242.16 1174.5,-11174.16 1581.5,-11174.16 1581.5,-11242.16"/>
<text text-anchor="middle" x="1378" y="-11226.96" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1378" y="-11211.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-11196.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-11181.96" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer1_residual2&#45;&gt;stage1_layer2_layernorm -->
<g id="edge332" class="edge">
<title>stage1_layer1_residual2&#45;&gt;stage1_layer2_layernorm</title>
<path fill="none" stroke="black" d="M1378,-11289.12C1378,-11276.71 1378,-11264.06 1378,-11252.58"/>
<polygon fill="black" stroke="black" points="1381.5,-11252.42 1378,-11242.42 1374.5,-11252.42 1381.5,-11252.42"/>
</g>
<!-- stage1_layer2_qkv_proj -->
<g id="node303" class="node">
<title>stage1_layer2_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1635.5,-11138.16 1120.5,-11138.16 1120.5,-11070.16 1635.5,-11070.16 1635.5,-11138.16"/>
<text text-anchor="middle" x="1378" y="-11122.96" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-11107.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-11092.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-11077.96" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_layernorm&#45;&gt;stage1_layer2_qkv_proj -->
<g id="edge333" class="edge">
<title>stage1_layer2_layernorm&#45;&gt;stage1_layer2_qkv_proj</title>
<path fill="none" stroke="black" d="M1378,-11174.05C1378,-11165.94 1378,-11157.15 1378,-11148.64"/>
<polygon fill="black" stroke="black" points="1381.5,-11148.46 1378,-11138.46 1374.5,-11148.46 1381.5,-11148.46"/>
</g>
<!-- stage1_layer2_qkv_gather -->
<g id="node304" class="node">
<title>stage1_layer2_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-10986.08" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-11004.88" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1378" y="-10989.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1378" y="-10974.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-10959.88" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_qkv_proj&#45;&gt;stage1_layer2_qkv_gather -->
<g id="edge334" class="edge">
<title>stage1_layer2_qkv_proj&#45;&gt;stage1_layer2_qkv_gather</title>
<path fill="none" stroke="black" d="M1378,-11069.9C1378,-11061.91 1378,-11053.14 1378,-11044.4"/>
<polygon fill="black" stroke="black" points="1381.5,-11044.19 1378,-11034.19 1374.5,-11044.19 1381.5,-11044.19"/>
</g>
<!-- stage1_layer2_attention -->
<g id="node305" class="node">
<title>stage1_layer2_attention</title>
<polygon fill="lightgreen" stroke="black" points="1629.5,-10902 1126.5,-10902 1126.5,-10834 1629.5,-10834 1629.5,-10902"/>
<text text-anchor="middle" x="1378" y="-10886.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1378" y="-10871.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1378" y="-10856.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-10841.8" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_qkv_gather&#45;&gt;stage1_layer2_attention -->
<g id="edge335" class="edge">
<title>stage1_layer2_qkv_gather&#45;&gt;stage1_layer2_attention</title>
<path fill="none" stroke="black" d="M1378,-10937.87C1378,-10929.48 1378,-10920.78 1378,-10912.5"/>
<polygon fill="black" stroke="black" points="1381.5,-10912.3 1378,-10902.3 1374.5,-10912.3 1381.5,-10912.3"/>
</g>
<!-- stage1_layer2_attn_out -->
<g id="node306" class="node">
<title>stage1_layer2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1616.5,-10798 1139.5,-10798 1139.5,-10730 1616.5,-10730 1616.5,-10798"/>
<text text-anchor="middle" x="1378" y="-10782.8" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1378" y="-10767.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1378" y="-10752.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-10737.8" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_attention&#45;&gt;stage1_layer2_attn_out -->
<g id="edge336" class="edge">
<title>stage1_layer2_attention&#45;&gt;stage1_layer2_attn_out</title>
<path fill="none" stroke="black" d="M1378,-10833.88C1378,-10825.78 1378,-10816.98 1378,-10808.47"/>
<polygon fill="black" stroke="black" points="1381.5,-10808.3 1378,-10798.3 1374.5,-10808.3 1381.5,-10808.3"/>
</g>
<!-- stage1_layer2_attn_reduce -->
<g id="node307" class="node">
<title>stage1_layer2_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1378" cy="-10645.91" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1378" y="-10664.71" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1378" y="-10649.71" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1378" y="-10634.71" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-10619.71" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_attn_out&#45;&gt;stage1_layer2_attn_reduce -->
<g id="edge337" class="edge">
<title>stage1_layer2_attn_out&#45;&gt;stage1_layer2_attn_reduce</title>
<path fill="none" stroke="black" d="M1378,-10729.73C1378,-10721.74 1378,-10712.97 1378,-10704.23"/>
<polygon fill="black" stroke="black" points="1381.5,-10704.02 1378,-10694.02 1374.5,-10704.02 1381.5,-10704.02"/>
</g>
<!-- stage1_layer2_residual1 -->
<g id="node308" class="node">
<title>stage1_layer2_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1820.89,-10561.83 1116.35,-10561.83 935.11,-10425.83 1639.65,-10425.83 1820.89,-10561.83"/>
<text text-anchor="middle" x="1378" y="-10512.63" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1378" y="-10497.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1378" y="-10482.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-10467.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_attn_reduce&#45;&gt;stage1_layer2_residual1 -->
<g id="edge338" class="edge">
<title>stage1_layer2_attn_reduce&#45;&gt;stage1_layer2_residual1</title>
<path fill="none" stroke="black" d="M1378,-10597.43C1378,-10589.34 1378,-10580.76 1378,-10572.14"/>
<polygon fill="black" stroke="black" points="1381.5,-10572.03 1378,-10562.03 1374.5,-10572.03 1381.5,-10572.03"/>
</g>
<!-- stage1_layer2_layernorm2 -->
<g id="node309" class="node">
<title>stage1_layer2_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1581.5,-10389.83 1174.5,-10389.83 1174.5,-10321.83 1581.5,-10321.83 1581.5,-10389.83"/>
<text text-anchor="middle" x="1378" y="-10374.63" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1378" y="-10359.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-10344.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1378" y="-10329.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_residual1&#45;&gt;stage1_layer2_layernorm2 -->
<g id="edge339" class="edge">
<title>stage1_layer2_residual1&#45;&gt;stage1_layer2_layernorm2</title>
<path fill="none" stroke="black" d="M1378,-10425.63C1378,-10416.88 1378,-10408.11 1378,-10399.9"/>
<polygon fill="black" stroke="black" points="1381.5,-10399.85 1378,-10389.85 1374.5,-10399.85 1381.5,-10399.85"/>
</g>
<!-- stage1_layer2_expert0_gate -->
<g id="node310" class="node">
<title>stage1_layer2_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="910.5,-10285.83 487.5,-10285.83 487.5,-10217.83 910.5,-10217.83 910.5,-10285.83"/>
<text text-anchor="middle" x="699" y="-10270.63" font-family="Times,serif" font-size="14.00">Expert Gate 168</text>
<text text-anchor="middle" x="699" y="-10255.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="699" y="-10240.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="699" y="-10225.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_layernorm2&#45;&gt;stage1_layer2_expert0_gate -->
<g id="edge340" class="edge">
<title>stage1_layer2_layernorm2&#45;&gt;stage1_layer2_expert0_gate</title>
<path fill="none" stroke="black" d="M1174.28,-10324.23C1094.23,-10312.2 1002.12,-10298.37 920.43,-10286.1"/>
<polygon fill="black" stroke="black" points="920.93,-10282.63 910.53,-10284.61 919.9,-10289.55 920.93,-10282.63"/>
</g>
<!-- stage1_layer2_expert1_gate -->
<g id="node315" class="node">
<title>stage1_layer2_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1363.5,-10285.83 940.5,-10285.83 940.5,-10217.83 1363.5,-10217.83 1363.5,-10285.83"/>
<text text-anchor="middle" x="1152" y="-10270.63" font-family="Times,serif" font-size="14.00">Expert Gate 169</text>
<text text-anchor="middle" x="1152" y="-10255.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1152" y="-10240.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1152" y="-10225.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_layernorm2&#45;&gt;stage1_layer2_expert1_gate -->
<g id="edge346" class="edge">
<title>stage1_layer2_layernorm2&#45;&gt;stage1_layer2_expert1_gate</title>
<path fill="none" stroke="black" d="M1304.62,-10321.71C1282.31,-10311.64 1257.63,-10300.51 1234.74,-10290.17"/>
<polygon fill="black" stroke="black" points="1235.95,-10286.88 1225.39,-10285.96 1233.07,-10293.26 1235.95,-10286.88"/>
</g>
<!-- stage1_layer2_expert2_gate -->
<g id="node320" class="node">
<title>stage1_layer2_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1816.5,-10285.83 1393.5,-10285.83 1393.5,-10217.83 1816.5,-10217.83 1816.5,-10285.83"/>
<text text-anchor="middle" x="1605" y="-10270.63" font-family="Times,serif" font-size="14.00">Expert Gate 170</text>
<text text-anchor="middle" x="1605" y="-10255.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1605" y="-10240.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1605" y="-10225.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_layernorm2&#45;&gt;stage1_layer2_expert2_gate -->
<g id="edge352" class="edge">
<title>stage1_layer2_layernorm2&#45;&gt;stage1_layer2_expert2_gate</title>
<path fill="none" stroke="black" d="M1451.7,-10321.71C1474.12,-10311.64 1498.9,-10300.51 1521.89,-10290.17"/>
<polygon fill="black" stroke="black" points="1523.59,-10293.25 1531.28,-10285.96 1520.73,-10286.86 1523.59,-10293.25"/>
</g>
<!-- stage1_layer2_expert3_gate -->
<g id="node325" class="node">
<title>stage1_layer2_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2275.5,-10285.83 1852.5,-10285.83 1852.5,-10217.83 2275.5,-10217.83 2275.5,-10285.83"/>
<text text-anchor="middle" x="2064" y="-10270.63" font-family="Times,serif" font-size="14.00">Expert Gate 171</text>
<text text-anchor="middle" x="2064" y="-10255.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2064" y="-10240.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2064" y="-10225.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_layernorm2&#45;&gt;stage1_layer2_expert3_gate -->
<g id="edge358" class="edge">
<title>stage1_layer2_layernorm2&#45;&gt;stage1_layer2_expert3_gate</title>
<path fill="none" stroke="black" d="M1581.5,-10324.57C1663.58,-10312.37 1758.5,-10298.26 1842.32,-10285.79"/>
<polygon fill="black" stroke="black" points="1842.84,-10289.25 1852.22,-10284.32 1841.82,-10282.33 1842.84,-10289.25"/>
</g>
<!-- stage1_layer2_expert0_mlp1 -->
<g id="node311" class="node">
<title>stage1_layer2_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="901.5,-10181.83 454.5,-10181.83 454.5,-10113.83 901.5,-10113.83 901.5,-10181.83"/>
<text text-anchor="middle" x="678" y="-10166.63" font-family="Times,serif" font-size="14.00">Expert 168 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="678" y="-10151.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="678" y="-10136.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="678" y="-10121.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert0_gate&#45;&gt;stage1_layer2_expert0_mlp1 -->
<g id="edge341" class="edge">
<title>stage1_layer2_expert0_gate&#45;&gt;stage1_layer2_expert0_mlp1</title>
<path fill="none" stroke="black" d="M692.18,-10217.71C690.49,-10209.52 688.66,-10200.62 686.89,-10192.02"/>
<polygon fill="black" stroke="black" points="690.3,-10191.22 684.86,-10182.13 683.44,-10192.63 690.3,-10191.22"/>
</g>
<!-- stage1_layer2_expert0_act -->
<g id="node312" class="node">
<title>stage1_layer2_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="860.5,-10077.83 413.5,-10077.83 413.5,-10009.83 860.5,-10009.83 860.5,-10077.83"/>
<text text-anchor="middle" x="637" y="-10062.63" font-family="Times,serif" font-size="14.00">Expert 168 Activation</text>
<text text-anchor="middle" x="637" y="-10047.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-10032.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="637" y="-10017.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert0_mlp1&#45;&gt;stage1_layer2_expert0_act -->
<g id="edge342" class="edge">
<title>stage1_layer2_expert0_mlp1&#45;&gt;stage1_layer2_expert0_act</title>
<path fill="none" stroke="black" d="M664.69,-10113.71C661.32,-10105.34 657.66,-10096.23 654.14,-10087.46"/>
<polygon fill="black" stroke="black" points="657.36,-10086.1 650.39,-10078.13 650.87,-10088.71 657.36,-10086.1"/>
</g>
<!-- stage1_layer2_expert0_mlp2 -->
<g id="node313" class="node">
<title>stage1_layer2_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="719.5,-9973.83 242.5,-9973.83 242.5,-9905.83 719.5,-9905.83 719.5,-9973.83"/>
<text text-anchor="middle" x="481" y="-9958.63" font-family="Times,serif" font-size="14.00">Expert 168 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="481" y="-9943.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="481" y="-9928.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="481" y="-9913.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert0_act&#45;&gt;stage1_layer2_expert0_mlp2 -->
<g id="edge343" class="edge">
<title>stage1_layer2_expert0_act&#45;&gt;stage1_layer2_expert0_mlp2</title>
<path fill="none" stroke="black" d="M586.35,-10009.71C571.7,-10000.13 555.58,-9989.59 540.44,-9979.7"/>
<polygon fill="black" stroke="black" points="541.95,-9976.5 531.66,-9973.96 538.12,-9982.36 541.95,-9976.5"/>
</g>
<!-- stage1_layer2_expert0_reduce -->
<g id="node314" class="node">
<title>stage1_layer2_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-9821.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-9840.55" font-family="Times,serif" font-size="14.00">Expert 168 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-9825.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-9810.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-9795.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert0_mlp2&#45;&gt;stage1_layer2_expert0_reduce -->
<g id="edge344" class="edge">
<title>stage1_layer2_expert0_mlp2&#45;&gt;stage1_layer2_expert0_reduce</title>
<path fill="none" stroke="black" d="M442.03,-9905.57C431.15,-9896.28 419.04,-9885.95 407.18,-9875.82"/>
<polygon fill="black" stroke="black" points="409.31,-9873.04 399.43,-9869.21 404.77,-9878.36 409.31,-9873.04"/>
</g>
<!-- stage1_layer2_expert_agg -->
<g id="node330" class="node">
<title>stage1_layer2_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1508.89,-9737.66 804.35,-9737.66 623.11,-9601.66 1327.65,-9601.66 1508.89,-9737.66"/>
<text text-anchor="middle" x="1066" y="-9688.46" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1066" y="-9673.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1066" y="-9658.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-9643.46" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert0_reduce&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge345" class="edge">
<title>stage1_layer2_expert0_reduce&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M531.14,-9782C607.3,-9766.15 697.13,-9747.45 781.21,-9729.95"/>
<polygon fill="black" stroke="black" points="782.09,-9733.34 791.17,-9727.87 780.66,-9726.48 782.09,-9733.34"/>
</g>
<!-- stage1_layer2_expert1_mlp1 -->
<g id="node316" class="node">
<title>stage1_layer2_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1366.5,-10181.83 919.5,-10181.83 919.5,-10113.83 1366.5,-10113.83 1366.5,-10181.83"/>
<text text-anchor="middle" x="1143" y="-10166.63" font-family="Times,serif" font-size="14.00">Expert 169 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1143" y="-10151.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1143" y="-10136.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1143" y="-10121.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert1_gate&#45;&gt;stage1_layer2_expert1_mlp1 -->
<g id="edge347" class="edge">
<title>stage1_layer2_expert1_gate&#45;&gt;stage1_layer2_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1149.08,-10217.71C1148.36,-10209.61 1147.59,-10200.81 1146.84,-10192.3"/>
<polygon fill="black" stroke="black" points="1150.3,-10191.78 1145.94,-10182.13 1143.33,-10192.4 1150.3,-10191.78"/>
</g>
<!-- stage1_layer2_expert1_act -->
<g id="node317" class="node">
<title>stage1_layer2_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1340.5,-10077.83 893.5,-10077.83 893.5,-10009.83 1340.5,-10009.83 1340.5,-10077.83"/>
<text text-anchor="middle" x="1117" y="-10062.63" font-family="Times,serif" font-size="14.00">Expert 169 Activation</text>
<text text-anchor="middle" x="1117" y="-10047.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-10032.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1117" y="-10017.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert1_mlp1&#45;&gt;stage1_layer2_expert1_act -->
<g id="edge348" class="edge">
<title>stage1_layer2_expert1_mlp1&#45;&gt;stage1_layer2_expert1_act</title>
<path fill="none" stroke="black" d="M1134.56,-10113.71C1132.47,-10105.52 1130.2,-10096.62 1128.01,-10088.02"/>
<polygon fill="black" stroke="black" points="1131.35,-10086.96 1125.49,-10078.13 1124.57,-10088.68 1131.35,-10086.96"/>
</g>
<!-- stage1_layer2_expert1_mlp2 -->
<g id="node318" class="node">
<title>stage1_layer2_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-9973.83 827.5,-9973.83 827.5,-9905.83 1304.5,-9905.83 1304.5,-9973.83"/>
<text text-anchor="middle" x="1066" y="-9958.63" font-family="Times,serif" font-size="14.00">Expert 169 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-9943.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-9928.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-9913.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert1_act&#45;&gt;stage1_layer2_expert1_mlp2 -->
<g id="edge349" class="edge">
<title>stage1_layer2_expert1_act&#45;&gt;stage1_layer2_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1100.44,-10009.71C1096.21,-10001.25 1091.6,-9992.04 1087.18,-9983.18"/>
<polygon fill="black" stroke="black" points="1090.25,-9981.51 1082.65,-9974.13 1083.99,-9984.64 1090.25,-9981.51"/>
</g>
<!-- stage1_layer2_expert1_reduce -->
<g id="node319" class="node">
<title>stage1_layer2_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-9821.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-9840.55" font-family="Times,serif" font-size="14.00">Expert 169 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-9825.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-9810.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-9795.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert1_mlp2&#45;&gt;stage1_layer2_expert1_reduce -->
<g id="edge350" class="edge">
<title>stage1_layer2_expert1_mlp2&#45;&gt;stage1_layer2_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.1,-9905.57C1049.91,-9897.31 1046.39,-9888.23 1042.89,-9879.21"/>
<polygon fill="black" stroke="black" points="1046.14,-9877.92 1039.26,-9869.86 1039.61,-9880.45 1046.14,-9877.92"/>
</g>
<!-- stage1_layer2_expert1_reduce&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge351" class="edge">
<title>stage1_layer2_expert1_reduce&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M1035.11,-9773.67C1037.61,-9765.34 1040.27,-9756.47 1042.94,-9747.56"/>
<polygon fill="black" stroke="black" points="1046.32,-9748.49 1045.84,-9737.91 1039.61,-9746.48 1046.32,-9748.49"/>
</g>
<!-- stage1_layer2_expert2_mlp1 -->
<g id="node321" class="node">
<title>stage1_layer2_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1838.5,-10181.83 1391.5,-10181.83 1391.5,-10113.83 1838.5,-10113.83 1838.5,-10181.83"/>
<text text-anchor="middle" x="1615" y="-10166.63" font-family="Times,serif" font-size="14.00">Expert 170 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1615" y="-10151.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1615" y="-10136.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1615" y="-10121.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert2_gate&#45;&gt;stage1_layer2_expert2_mlp1 -->
<g id="edge353" class="edge">
<title>stage1_layer2_expert2_gate&#45;&gt;stage1_layer2_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1608.25,-10217.71C1609.04,-10209.61 1609.9,-10200.81 1610.74,-10192.3"/>
<polygon fill="black" stroke="black" points="1614.24,-10192.42 1611.74,-10182.13 1607.28,-10191.74 1614.24,-10192.42"/>
</g>
<!-- stage1_layer2_expert2_act -->
<g id="node322" class="node">
<title>stage1_layer2_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1848.5,-10077.83 1401.5,-10077.83 1401.5,-10009.83 1848.5,-10009.83 1848.5,-10077.83"/>
<text text-anchor="middle" x="1625" y="-10062.63" font-family="Times,serif" font-size="14.00">Expert 170 Activation</text>
<text text-anchor="middle" x="1625" y="-10047.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-10032.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1625" y="-10017.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert2_mlp1&#45;&gt;stage1_layer2_expert2_act -->
<g id="edge354" class="edge">
<title>stage1_layer2_expert2_mlp1&#45;&gt;stage1_layer2_expert2_act</title>
<path fill="none" stroke="black" d="M1618.25,-10113.71C1619.04,-10105.61 1619.9,-10096.81 1620.74,-10088.3"/>
<polygon fill="black" stroke="black" points="1624.24,-10088.42 1621.74,-10078.13 1617.28,-10087.74 1624.24,-10088.42"/>
</g>
<!-- stage1_layer2_expert2_mlp2 -->
<g id="node323" class="node">
<title>stage1_layer2_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1889.5,-9973.83 1412.5,-9973.83 1412.5,-9905.83 1889.5,-9905.83 1889.5,-9973.83"/>
<text text-anchor="middle" x="1651" y="-9958.63" font-family="Times,serif" font-size="14.00">Expert 170 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1651" y="-9943.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1651" y="-9928.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1651" y="-9913.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert2_act&#45;&gt;stage1_layer2_expert2_mlp2 -->
<g id="edge355" class="edge">
<title>stage1_layer2_expert2_act&#45;&gt;stage1_layer2_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1633.44,-10009.71C1635.53,-10001.52 1637.8,-9992.62 1639.99,-9984.02"/>
<polygon fill="black" stroke="black" points="1643.43,-9984.68 1642.51,-9974.13 1636.65,-9982.96 1643.43,-9984.68"/>
</g>
<!-- stage1_layer2_expert2_reduce -->
<g id="node324" class="node">
<title>stage1_layer2_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-9821.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-9840.55" font-family="Times,serif" font-size="14.00">Expert 170 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-9825.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-9810.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-9795.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert2_mlp2&#45;&gt;stage1_layer2_expert2_reduce -->
<g id="edge356" class="edge">
<title>stage1_layer2_expert2_mlp2&#45;&gt;stage1_layer2_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.18,-9905.57C1667.45,-9897.31 1671.05,-9888.23 1674.63,-9879.21"/>
<polygon fill="black" stroke="black" points="1677.9,-9880.44 1678.33,-9869.86 1671.39,-9877.86 1677.9,-9880.44"/>
</g>
<!-- stage1_layer2_expert2_reduce&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge357" class="edge">
<title>stage1_layer2_expert2_reduce&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M1527.49,-9780.43C1475.21,-9767.99 1416.07,-9753.93 1358,-9740.12"/>
<polygon fill="black" stroke="black" points="1358.47,-9736.63 1347.93,-9737.72 1356.85,-9743.44 1358.47,-9736.63"/>
</g>
<!-- stage1_layer2_expert3_mlp1 -->
<g id="node326" class="node">
<title>stage1_layer2_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2307.5,-10181.83 1860.5,-10181.83 1860.5,-10113.83 2307.5,-10113.83 2307.5,-10181.83"/>
<text text-anchor="middle" x="2084" y="-10166.63" font-family="Times,serif" font-size="14.00">Expert 171 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2084" y="-10151.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2084" y="-10136.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2084" y="-10121.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert3_gate&#45;&gt;stage1_layer2_expert3_mlp1 -->
<g id="edge359" class="edge">
<title>stage1_layer2_expert3_gate&#45;&gt;stage1_layer2_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2070.49,-10217.71C2072.1,-10209.52 2073.85,-10200.62 2075.53,-10192.02"/>
<polygon fill="black" stroke="black" points="2078.98,-10192.62 2077.47,-10182.13 2072.11,-10191.27 2078.98,-10192.62"/>
</g>
<!-- stage1_layer2_expert3_act -->
<g id="node327" class="node">
<title>stage1_layer2_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2322.5,-10077.83 1875.5,-10077.83 1875.5,-10009.83 2322.5,-10009.83 2322.5,-10077.83"/>
<text text-anchor="middle" x="2099" y="-10062.63" font-family="Times,serif" font-size="14.00">Expert 171 Activation</text>
<text text-anchor="middle" x="2099" y="-10047.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-10032.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2099" y="-10017.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert3_mlp1&#45;&gt;stage1_layer2_expert3_act -->
<g id="edge360" class="edge">
<title>stage1_layer2_expert3_mlp1&#45;&gt;stage1_layer2_expert3_act</title>
<path fill="none" stroke="black" d="M2088.87,-10113.71C2090.06,-10105.61 2091.36,-10096.81 2092.61,-10088.3"/>
<polygon fill="black" stroke="black" points="2096.11,-10088.53 2094.1,-10078.13 2089.19,-10087.51 2096.11,-10088.53"/>
</g>
<!-- stage1_layer2_expert3_mlp2 -->
<g id="node328" class="node">
<title>stage1_layer2_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2520.5,-9973.83 2043.5,-9973.83 2043.5,-9905.83 2520.5,-9905.83 2520.5,-9973.83"/>
<text text-anchor="middle" x="2282" y="-9958.63" font-family="Times,serif" font-size="14.00">Expert 171 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2282" y="-9943.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2282" y="-9928.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2282" y="-9913.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert3_act&#45;&gt;stage1_layer2_expert3_mlp2 -->
<g id="edge361" class="edge">
<title>stage1_layer2_expert3_act&#45;&gt;stage1_layer2_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2158.41,-10009.71C2176.08,-9999.87 2195.58,-9989 2213.76,-9978.86"/>
<polygon fill="black" stroke="black" points="2215.54,-9981.88 2222.57,-9973.96 2212.13,-9975.77 2215.54,-9981.88"/>
</g>
<!-- stage1_layer2_expert3_reduce -->
<g id="node329" class="node">
<title>stage1_layer2_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-9821.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-9840.55" font-family="Times,serif" font-size="14.00">Expert 171 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-9825.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-9810.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-9795.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert3_mlp2&#45;&gt;stage1_layer2_expert3_reduce -->
<g id="edge362" class="edge">
<title>stage1_layer2_expert3_mlp2&#45;&gt;stage1_layer2_expert3_reduce</title>
<path fill="none" stroke="black" d="M2308.08,-9905.57C2314.89,-9896.88 2322.41,-9887.28 2329.86,-9877.78"/>
<polygon fill="black" stroke="black" points="2332.65,-9879.89 2336.07,-9869.86 2327.15,-9875.57 2332.65,-9879.89"/>
</g>
<!-- stage1_layer2_expert3_reduce&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge363" class="edge">
<title>stage1_layer2_expert3_reduce&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M2141.77,-9787.52C2106.04,-9782.68 2069.55,-9777.91 2035,-9773.66 1854.52,-9751.51 1654.77,-9729.8 1483.76,-9712.07"/>
<polygon fill="black" stroke="black" points="1483.88,-9708.56 1473.57,-9711.01 1483.16,-9715.53 1483.88,-9708.56"/>
</g>
<!-- stage1_layer2_residual2 -->
<g id="node331" class="node">
<title>stage1_layer2_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1508.89,-9565.66 804.35,-9565.66 623.11,-9429.66 1327.65,-9429.66 1508.89,-9565.66"/>
<text text-anchor="middle" x="1066" y="-9516.46" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1066" y="-9501.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1066" y="-9486.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-9471.46" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_expert_agg&#45;&gt;stage1_layer2_residual2 -->
<g id="edge364" class="edge">
<title>stage1_layer2_expert_agg&#45;&gt;stage1_layer2_residual2</title>
<path fill="none" stroke="black" d="M1066,-9601.48C1066,-9593.16 1066,-9584.61 1066,-9576.16"/>
<polygon fill="black" stroke="black" points="1069.5,-9575.92 1066,-9565.92 1062.5,-9575.92 1069.5,-9575.92"/>
</g>
<!-- stage1_layer3_layernorm -->
<g id="node332" class="node">
<title>stage1_layer3_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1269.5,-9382.66 862.5,-9382.66 862.5,-9314.66 1269.5,-9314.66 1269.5,-9382.66"/>
<text text-anchor="middle" x="1066" y="-9367.46" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1066" y="-9352.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-9337.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-9322.46" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer2_residual2&#45;&gt;stage1_layer3_layernorm -->
<g id="edge365" class="edge">
<title>stage1_layer2_residual2&#45;&gt;stage1_layer3_layernorm</title>
<path fill="none" stroke="black" d="M1066,-9429.62C1066,-9417.21 1066,-9404.56 1066,-9393.08"/>
<polygon fill="black" stroke="black" points="1069.5,-9392.92 1066,-9382.92 1062.5,-9392.92 1069.5,-9392.92"/>
</g>
<!-- stage1_layer3_qkv_proj -->
<g id="node333" class="node">
<title>stage1_layer3_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1323.5,-9278.66 808.5,-9278.66 808.5,-9210.66 1323.5,-9210.66 1323.5,-9278.66"/>
<text text-anchor="middle" x="1066" y="-9263.46" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-9248.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-9233.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1066" y="-9218.46" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_layernorm&#45;&gt;stage1_layer3_qkv_proj -->
<g id="edge366" class="edge">
<title>stage1_layer3_layernorm&#45;&gt;stage1_layer3_qkv_proj</title>
<path fill="none" stroke="black" d="M1066,-9314.55C1066,-9306.44 1066,-9297.65 1066,-9289.14"/>
<polygon fill="black" stroke="black" points="1069.5,-9288.96 1066,-9278.96 1062.5,-9288.96 1069.5,-9288.96"/>
</g>
<!-- stage1_layer3_qkv_gather -->
<g id="node334" class="node">
<title>stage1_layer3_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1066" cy="-9126.58" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1066" y="-9145.38" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1066" y="-9130.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1066" y="-9115.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1066" y="-9100.38" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_qkv_proj&#45;&gt;stage1_layer3_qkv_gather -->
<g id="edge367" class="edge">
<title>stage1_layer3_qkv_proj&#45;&gt;stage1_layer3_qkv_gather</title>
<path fill="none" stroke="black" d="M1066,-9210.4C1066,-9202.41 1066,-9193.64 1066,-9184.9"/>
<polygon fill="black" stroke="black" points="1069.5,-9184.69 1066,-9174.69 1062.5,-9184.69 1069.5,-9184.69"/>
</g>
<!-- stage1_layer3_attention -->
<g id="node335" class="node">
<title>stage1_layer3_attention</title>
<polygon fill="lightgreen" stroke="black" points="1317.5,-9042.5 814.5,-9042.5 814.5,-8974.5 1317.5,-8974.5 1317.5,-9042.5"/>
<text text-anchor="middle" x="1066" y="-9027.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1066" y="-9012.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1066" y="-8997.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1066" y="-8982.3" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_qkv_gather&#45;&gt;stage1_layer3_attention -->
<g id="edge368" class="edge">
<title>stage1_layer3_qkv_gather&#45;&gt;stage1_layer3_attention</title>
<path fill="none" stroke="black" d="M1066,-9078.37C1066,-9069.98 1066,-9061.28 1066,-9053"/>
<polygon fill="black" stroke="black" points="1069.5,-9052.8 1066,-9042.8 1062.5,-9052.8 1069.5,-9052.8"/>
</g>
<!-- stage1_layer3_attn_out -->
<g id="node336" class="node">
<title>stage1_layer3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-8938.5 827.5,-8938.5 827.5,-8870.5 1304.5,-8870.5 1304.5,-8938.5"/>
<text text-anchor="middle" x="1066" y="-8923.3" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-8908.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1066" y="-8893.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-8878.3" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_attention&#45;&gt;stage1_layer3_attn_out -->
<g id="edge369" class="edge">
<title>stage1_layer3_attention&#45;&gt;stage1_layer3_attn_out</title>
<path fill="none" stroke="black" d="M1066,-8974.38C1066,-8966.28 1066,-8957.48 1066,-8948.97"/>
<polygon fill="black" stroke="black" points="1069.5,-8948.8 1066,-8938.8 1062.5,-8948.8 1069.5,-8948.8"/>
</g>
<!-- stage1_layer3_attn_reduce -->
<g id="node337" class="node">
<title>stage1_layer3_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1066" cy="-8786.41" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1066" y="-8805.21" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1066" y="-8790.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-8775.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-8760.21" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_attn_out&#45;&gt;stage1_layer3_attn_reduce -->
<g id="edge370" class="edge">
<title>stage1_layer3_attn_out&#45;&gt;stage1_layer3_attn_reduce</title>
<path fill="none" stroke="black" d="M1066,-8870.23C1066,-8862.24 1066,-8853.47 1066,-8844.73"/>
<polygon fill="black" stroke="black" points="1069.5,-8844.52 1066,-8834.52 1062.5,-8844.52 1069.5,-8844.52"/>
</g>
<!-- stage1_layer3_residual1 -->
<g id="node338" class="node">
<title>stage1_layer3_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1508.89,-8702.33 804.35,-8702.33 623.11,-8566.33 1327.65,-8566.33 1508.89,-8702.33"/>
<text text-anchor="middle" x="1066" y="-8653.13" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1066" y="-8638.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1066" y="-8623.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-8608.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_attn_reduce&#45;&gt;stage1_layer3_residual1 -->
<g id="edge371" class="edge">
<title>stage1_layer3_attn_reduce&#45;&gt;stage1_layer3_residual1</title>
<path fill="none" stroke="black" d="M1066,-8737.93C1066,-8729.84 1066,-8721.26 1066,-8712.64"/>
<polygon fill="black" stroke="black" points="1069.5,-8712.53 1066,-8702.53 1062.5,-8712.53 1069.5,-8712.53"/>
</g>
<!-- stage1_layer3_layernorm2 -->
<g id="node339" class="node">
<title>stage1_layer3_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1269.5,-8530.33 862.5,-8530.33 862.5,-8462.33 1269.5,-8462.33 1269.5,-8530.33"/>
<text text-anchor="middle" x="1066" y="-8515.13" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1066" y="-8500.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-8485.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-8470.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_residual1&#45;&gt;stage1_layer3_layernorm2 -->
<g id="edge372" class="edge">
<title>stage1_layer3_residual1&#45;&gt;stage1_layer3_layernorm2</title>
<path fill="none" stroke="black" d="M1066,-8566.13C1066,-8557.38 1066,-8548.61 1066,-8540.4"/>
<polygon fill="black" stroke="black" points="1069.5,-8540.35 1066,-8530.35 1062.5,-8540.35 1069.5,-8540.35"/>
</g>
<!-- stage1_layer3_expert0_gate -->
<g id="node340" class="node">
<title>stage1_layer3_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="824.5,-8426.33 401.5,-8426.33 401.5,-8358.33 824.5,-8358.33 824.5,-8426.33"/>
<text text-anchor="middle" x="613" y="-8411.13" font-family="Times,serif" font-size="14.00">Expert Gate 184</text>
<text text-anchor="middle" x="613" y="-8396.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="613" y="-8381.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="613" y="-8366.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_layernorm2&#45;&gt;stage1_layer3_expert0_gate -->
<g id="edge373" class="edge">
<title>stage1_layer3_layernorm2&#45;&gt;stage1_layer3_expert0_gate</title>
<path fill="none" stroke="black" d="M919.24,-8462.29C871.49,-8451.53 818.32,-8439.56 769.86,-8428.65"/>
<polygon fill="black" stroke="black" points="770.44,-8425.19 759.92,-8426.41 768.9,-8432.02 770.44,-8425.19"/>
</g>
<!-- stage1_layer3_expert1_gate -->
<g id="node345" class="node">
<title>stage1_layer3_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1277.5,-8426.33 854.5,-8426.33 854.5,-8358.33 1277.5,-8358.33 1277.5,-8426.33"/>
<text text-anchor="middle" x="1066" y="-8411.13" font-family="Times,serif" font-size="14.00">Expert Gate 185</text>
<text text-anchor="middle" x="1066" y="-8396.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-8381.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1066" y="-8366.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_layernorm2&#45;&gt;stage1_layer3_expert1_gate -->
<g id="edge379" class="edge">
<title>stage1_layer3_layernorm2&#45;&gt;stage1_layer3_expert1_gate</title>
<path fill="none" stroke="black" d="M1066,-8462.21C1066,-8454.11 1066,-8445.31 1066,-8436.8"/>
<polygon fill="black" stroke="black" points="1069.5,-8436.63 1066,-8426.63 1062.5,-8436.63 1069.5,-8436.63"/>
</g>
<!-- stage1_layer3_expert2_gate -->
<g id="node350" class="node">
<title>stage1_layer3_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1730.5,-8426.33 1307.5,-8426.33 1307.5,-8358.33 1730.5,-8358.33 1730.5,-8426.33"/>
<text text-anchor="middle" x="1519" y="-8411.13" font-family="Times,serif" font-size="14.00">Expert Gate 186</text>
<text text-anchor="middle" x="1519" y="-8396.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1519" y="-8381.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1519" y="-8366.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_layernorm2&#45;&gt;stage1_layer3_expert2_gate -->
<g id="edge385" class="edge">
<title>stage1_layer3_layernorm2&#45;&gt;stage1_layer3_expert2_gate</title>
<path fill="none" stroke="black" d="M1212.76,-8462.29C1260.51,-8451.53 1313.68,-8439.56 1362.14,-8428.65"/>
<polygon fill="black" stroke="black" points="1363.1,-8432.02 1372.08,-8426.41 1361.56,-8425.19 1363.1,-8432.02"/>
</g>
<!-- stage1_layer3_expert3_gate -->
<g id="node355" class="node">
<title>stage1_layer3_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2189.5,-8426.33 1766.5,-8426.33 1766.5,-8358.33 2189.5,-8358.33 2189.5,-8426.33"/>
<text text-anchor="middle" x="1978" y="-8411.13" font-family="Times,serif" font-size="14.00">Expert Gate 187</text>
<text text-anchor="middle" x="1978" y="-8396.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1978" y="-8381.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1978" y="-8366.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_layernorm2&#45;&gt;stage1_layer3_expert3_gate -->
<g id="edge391" class="edge">
<title>stage1_layer3_layernorm2&#45;&gt;stage1_layer3_expert3_gate</title>
<path fill="none" stroke="black" d="M1269.72,-8476.39C1403.53,-8463.47 1582.35,-8445.32 1740,-8426.33 1745.24,-8425.7 1750.54,-8425.05 1755.88,-8424.39"/>
<polygon fill="black" stroke="black" points="1756.72,-8427.81 1766.21,-8423.09 1755.85,-8420.86 1756.72,-8427.81"/>
</g>
<!-- stage1_layer3_expert0_mlp1 -->
<g id="node341" class="node">
<title>stage1_layer3_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="719.5,-8322.33 272.5,-8322.33 272.5,-8254.33 719.5,-8254.33 719.5,-8322.33"/>
<text text-anchor="middle" x="496" y="-8307.13" font-family="Times,serif" font-size="14.00">Expert 184 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="496" y="-8292.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="496" y="-8277.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="496" y="-8262.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert0_gate&#45;&gt;stage1_layer3_expert0_mlp1 -->
<g id="edge374" class="edge">
<title>stage1_layer3_expert0_gate&#45;&gt;stage1_layer3_expert0_mlp1</title>
<path fill="none" stroke="black" d="M575.01,-8358.21C564.49,-8349.04 552.95,-8338.98 542.02,-8329.45"/>
<polygon fill="black" stroke="black" points="544.03,-8326.56 534.2,-8322.63 539.43,-8331.84 544.03,-8326.56"/>
</g>
<!-- stage1_layer3_expert0_act -->
<g id="node342" class="node">
<title>stage1_layer3_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="647.5,-8218.33 200.5,-8218.33 200.5,-8150.33 647.5,-8150.33 647.5,-8218.33"/>
<text text-anchor="middle" x="424" y="-8203.13" font-family="Times,serif" font-size="14.00">Expert 184 Activation</text>
<text text-anchor="middle" x="424" y="-8188.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="424" y="-8173.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="424" y="-8158.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert0_mlp1&#45;&gt;stage1_layer3_expert0_act -->
<g id="edge375" class="edge">
<title>stage1_layer3_expert0_mlp1&#45;&gt;stage1_layer3_expert0_act</title>
<path fill="none" stroke="black" d="M472.62,-8254.21C466.46,-8245.49 459.74,-8235.96 453.3,-8226.85"/>
<polygon fill="black" stroke="black" points="456.13,-8224.78 447.51,-8218.63 450.41,-8228.82 456.13,-8224.78"/>
</g>
<!-- stage1_layer3_expert0_mlp2 -->
<g id="node343" class="node">
<title>stage1_layer3_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="636.5,-8114.33 159.5,-8114.33 159.5,-8046.33 636.5,-8046.33 636.5,-8114.33"/>
<text text-anchor="middle" x="398" y="-8099.13" font-family="Times,serif" font-size="14.00">Expert 184 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="398" y="-8084.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="398" y="-8069.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="398" y="-8054.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert0_act&#45;&gt;stage1_layer3_expert0_mlp2 -->
<g id="edge376" class="edge">
<title>stage1_layer3_expert0_act&#45;&gt;stage1_layer3_expert0_mlp2</title>
<path fill="none" stroke="black" d="M415.56,-8150.21C413.47,-8142.02 411.2,-8133.12 409.01,-8124.52"/>
<polygon fill="black" stroke="black" points="412.35,-8123.46 406.49,-8114.63 405.57,-8125.19 412.35,-8123.46"/>
</g>
<!-- stage1_layer3_expert0_reduce -->
<g id="node344" class="node">
<title>stage1_layer3_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-7962.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-7981.05" font-family="Times,serif" font-size="14.00">Expert 184 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-7966.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-7951.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-7936.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert0_mlp2&#45;&gt;stage1_layer3_expert0_reduce -->
<g id="edge377" class="edge">
<title>stage1_layer3_expert0_mlp2&#45;&gt;stage1_layer3_expert0_reduce</title>
<path fill="none" stroke="black" d="M382.81,-8046.07C379.04,-8037.81 374.9,-8028.74 370.78,-8019.71"/>
<polygon fill="black" stroke="black" points="373.85,-8018 366.51,-8010.36 367.48,-8020.91 373.85,-8018"/>
</g>
<!-- stage1_layer3_expert_agg -->
<g id="node360" class="node">
<title>stage1_layer3_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1472.89,-7878.16 768.35,-7878.16 587.11,-7742.16 1291.65,-7742.16 1472.89,-7878.16"/>
<text text-anchor="middle" x="1030" y="-7828.96" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1030" y="-7813.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1030" y="-7798.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-7783.96" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert0_reduce&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge378" class="edge">
<title>stage1_layer3_expert0_reduce&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M524.53,-7921.91C592.91,-7906.93 672.59,-7889.47 748.2,-7872.91"/>
<polygon fill="black" stroke="black" points="749.34,-7876.24 758.36,-7870.68 747.84,-7869.4 749.34,-7876.24"/>
</g>
<!-- stage1_layer3_expert1_mlp1 -->
<g id="node346" class="node">
<title>stage1_layer3_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1289.5,-8322.33 842.5,-8322.33 842.5,-8254.33 1289.5,-8254.33 1289.5,-8322.33"/>
<text text-anchor="middle" x="1066" y="-8307.13" font-family="Times,serif" font-size="14.00">Expert 185 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-8292.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1066" y="-8277.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-8262.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert1_gate&#45;&gt;stage1_layer3_expert1_mlp1 -->
<g id="edge380" class="edge">
<title>stage1_layer3_expert1_gate&#45;&gt;stage1_layer3_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1066,-8358.21C1066,-8350.11 1066,-8341.31 1066,-8332.8"/>
<polygon fill="black" stroke="black" points="1069.5,-8332.63 1066,-8322.63 1062.5,-8332.63 1069.5,-8332.63"/>
</g>
<!-- stage1_layer3_expert1_act -->
<g id="node347" class="node">
<title>stage1_layer3_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1289.5,-8218.33 842.5,-8218.33 842.5,-8150.33 1289.5,-8150.33 1289.5,-8218.33"/>
<text text-anchor="middle" x="1066" y="-8203.13" font-family="Times,serif" font-size="14.00">Expert 185 Activation</text>
<text text-anchor="middle" x="1066" y="-8188.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-8173.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-8158.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert1_mlp1&#45;&gt;stage1_layer3_expert1_act -->
<g id="edge381" class="edge">
<title>stage1_layer3_expert1_mlp1&#45;&gt;stage1_layer3_expert1_act</title>
<path fill="none" stroke="black" d="M1066,-8254.21C1066,-8246.11 1066,-8237.31 1066,-8228.8"/>
<polygon fill="black" stroke="black" points="1069.5,-8228.63 1066,-8218.63 1062.5,-8228.63 1069.5,-8228.63"/>
</g>
<!-- stage1_layer3_expert1_mlp2 -->
<g id="node348" class="node">
<title>stage1_layer3_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-8114.33 827.5,-8114.33 827.5,-8046.33 1304.5,-8046.33 1304.5,-8114.33"/>
<text text-anchor="middle" x="1066" y="-8099.13" font-family="Times,serif" font-size="14.00">Expert 185 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1066" y="-8084.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1066" y="-8069.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1066" y="-8054.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert1_act&#45;&gt;stage1_layer3_expert1_mlp2 -->
<g id="edge382" class="edge">
<title>stage1_layer3_expert1_act&#45;&gt;stage1_layer3_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1066,-8150.21C1066,-8142.11 1066,-8133.31 1066,-8124.8"/>
<polygon fill="black" stroke="black" points="1069.5,-8124.63 1066,-8114.63 1062.5,-8124.63 1069.5,-8124.63"/>
</g>
<!-- stage1_layer3_expert1_reduce -->
<g id="node349" class="node">
<title>stage1_layer3_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-7962.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-7981.05" font-family="Times,serif" font-size="14.00">Expert 185 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-7966.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-7951.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-7936.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert1_mlp2&#45;&gt;stage1_layer3_expert1_reduce -->
<g id="edge383" class="edge">
<title>stage1_layer3_expert1_mlp2&#45;&gt;stage1_layer3_expert1_reduce</title>
<path fill="none" stroke="black" d="M1053.1,-8046.07C1049.91,-8037.81 1046.39,-8028.74 1042.89,-8019.71"/>
<polygon fill="black" stroke="black" points="1046.14,-8018.42 1039.26,-8010.36 1039.61,-8020.95 1046.14,-8018.42"/>
</g>
<!-- stage1_layer3_expert1_reduce&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge384" class="edge">
<title>stage1_layer3_expert1_reduce&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M1023.85,-7913.76C1024.33,-7905.67 1024.85,-7897.09 1025.36,-7888.47"/>
<polygon fill="black" stroke="black" points="1028.87,-7888.55 1025.97,-7878.36 1021.88,-7888.13 1028.87,-7888.55"/>
</g>
<!-- stage1_layer3_expert2_mlp1 -->
<g id="node351" class="node">
<title>stage1_layer3_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1761.5,-8322.33 1314.5,-8322.33 1314.5,-8254.33 1761.5,-8254.33 1761.5,-8322.33"/>
<text text-anchor="middle" x="1538" y="-8307.13" font-family="Times,serif" font-size="14.00">Expert 186 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1538" y="-8292.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1538" y="-8277.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1538" y="-8262.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert2_gate&#45;&gt;stage1_layer3_expert2_mlp1 -->
<g id="edge386" class="edge">
<title>stage1_layer3_expert2_gate&#45;&gt;stage1_layer3_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1525.17,-8358.21C1526.7,-8350.02 1528.35,-8341.12 1529.95,-8332.52"/>
<polygon fill="black" stroke="black" points="1533.41,-8333.1 1531.8,-8322.63 1526.53,-8331.82 1533.41,-8333.1"/>
</g>
<!-- stage1_layer3_expert2_act -->
<g id="node352" class="node">
<title>stage1_layer3_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1771.5,-8218.33 1324.5,-8218.33 1324.5,-8150.33 1771.5,-8150.33 1771.5,-8218.33"/>
<text text-anchor="middle" x="1548" y="-8203.13" font-family="Times,serif" font-size="14.00">Expert 186 Activation</text>
<text text-anchor="middle" x="1548" y="-8188.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1548" y="-8173.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1548" y="-8158.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert2_mlp1&#45;&gt;stage1_layer3_expert2_act -->
<g id="edge387" class="edge">
<title>stage1_layer3_expert2_mlp1&#45;&gt;stage1_layer3_expert2_act</title>
<path fill="none" stroke="black" d="M1541.25,-8254.21C1542.04,-8246.11 1542.9,-8237.31 1543.74,-8228.8"/>
<polygon fill="black" stroke="black" points="1547.24,-8228.92 1544.74,-8218.63 1540.28,-8228.24 1547.24,-8228.92"/>
</g>
<!-- stage1_layer3_expert2_mlp2 -->
<g id="node353" class="node">
<title>stage1_layer3_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1889.5,-8114.33 1412.5,-8114.33 1412.5,-8046.33 1889.5,-8046.33 1889.5,-8114.33"/>
<text text-anchor="middle" x="1651" y="-8099.13" font-family="Times,serif" font-size="14.00">Expert 186 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1651" y="-8084.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1651" y="-8069.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1651" y="-8054.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert2_act&#45;&gt;stage1_layer3_expert2_mlp2 -->
<g id="edge388" class="edge">
<title>stage1_layer3_expert2_act&#45;&gt;stage1_layer3_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1581.44,-8150.21C1590.62,-8141.13 1600.67,-8131.18 1610.2,-8121.73"/>
<polygon fill="black" stroke="black" points="1612.73,-8124.15 1617.37,-8114.63 1607.81,-8119.18 1612.73,-8124.15"/>
</g>
<!-- stage1_layer3_expert2_reduce -->
<g id="node354" class="node">
<title>stage1_layer3_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-7962.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-7981.05" font-family="Times,serif" font-size="14.00">Expert 186 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-7966.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-7951.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-7936.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert2_mlp2&#45;&gt;stage1_layer3_expert2_reduce -->
<g id="edge389" class="edge">
<title>stage1_layer3_expert2_mlp2&#45;&gt;stage1_layer3_expert2_reduce</title>
<path fill="none" stroke="black" d="M1664.18,-8046.07C1667.45,-8037.81 1671.05,-8028.74 1674.63,-8019.71"/>
<polygon fill="black" stroke="black" points="1677.9,-8020.94 1678.33,-8010.36 1671.39,-8018.36 1677.9,-8020.94"/>
</g>
<!-- stage1_layer3_expert2_reduce&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge390" class="edge">
<title>stage1_layer3_expert2_reduce&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M1520.88,-7921.62C1464.64,-7908.97 1400.66,-7894.57 1337.89,-7880.44"/>
<polygon fill="black" stroke="black" points="1338.36,-7876.96 1327.83,-7878.18 1336.82,-7883.79 1338.36,-7876.96"/>
</g>
<!-- stage1_layer3_expert3_mlp1 -->
<g id="node356" class="node">
<title>stage1_layer3_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2230.5,-8322.33 1783.5,-8322.33 1783.5,-8254.33 2230.5,-8254.33 2230.5,-8322.33"/>
<text text-anchor="middle" x="2007" y="-8307.13" font-family="Times,serif" font-size="14.00">Expert 187 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2007" y="-8292.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2007" y="-8277.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2007" y="-8262.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert3_gate&#45;&gt;stage1_layer3_expert3_mlp1 -->
<g id="edge392" class="edge">
<title>stage1_layer3_expert3_gate&#45;&gt;stage1_layer3_expert3_mlp1</title>
<path fill="none" stroke="black" d="M1987.42,-8358.21C1989.75,-8350.02 1992.28,-8341.12 1994.72,-8332.52"/>
<polygon fill="black" stroke="black" points="1998.16,-8333.21 1997.53,-8322.63 1991.43,-8331.29 1998.16,-8333.21"/>
</g>
<!-- stage1_layer3_expert3_act -->
<g id="node357" class="node">
<title>stage1_layer3_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2245.5,-8218.33 1798.5,-8218.33 1798.5,-8150.33 2245.5,-8150.33 2245.5,-8218.33"/>
<text text-anchor="middle" x="2022" y="-8203.13" font-family="Times,serif" font-size="14.00">Expert 187 Activation</text>
<text text-anchor="middle" x="2022" y="-8188.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2022" y="-8173.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2022" y="-8158.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert3_mlp1&#45;&gt;stage1_layer3_expert3_act -->
<g id="edge393" class="edge">
<title>stage1_layer3_expert3_mlp1&#45;&gt;stage1_layer3_expert3_act</title>
<path fill="none" stroke="black" d="M2011.87,-8254.21C2013.06,-8246.11 2014.36,-8237.31 2015.61,-8228.8"/>
<polygon fill="black" stroke="black" points="2019.11,-8229.03 2017.1,-8218.63 2012.19,-8228.02 2019.11,-8229.03"/>
</g>
<!-- stage1_layer3_expert3_mlp2 -->
<g id="node358" class="node">
<title>stage1_layer3_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2520.5,-8114.33 2043.5,-8114.33 2043.5,-8046.33 2520.5,-8046.33 2520.5,-8114.33"/>
<text text-anchor="middle" x="2282" y="-8099.13" font-family="Times,serif" font-size="14.00">Expert 187 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2282" y="-8084.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2282" y="-8069.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2282" y="-8054.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert3_act&#45;&gt;stage1_layer3_expert3_mlp2 -->
<g id="edge394" class="edge">
<title>stage1_layer3_expert3_act&#45;&gt;stage1_layer3_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2106.41,-8150.21C2132.54,-8139.96 2161.49,-8128.61 2188.21,-8118.12"/>
<polygon fill="black" stroke="black" points="2189.53,-8121.37 2197.56,-8114.46 2186.98,-8114.85 2189.53,-8121.37"/>
</g>
<!-- stage1_layer3_expert3_reduce -->
<g id="node359" class="node">
<title>stage1_layer3_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-7962.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-7981.05" font-family="Times,serif" font-size="14.00">Expert 187 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-7966.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-7951.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-7936.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert3_mlp2&#45;&gt;stage1_layer3_expert3_reduce -->
<g id="edge395" class="edge">
<title>stage1_layer3_expert3_mlp2&#45;&gt;stage1_layer3_expert3_reduce</title>
<path fill="none" stroke="black" d="M2308.08,-8046.07C2314.89,-8037.38 2322.41,-8027.78 2329.86,-8018.28"/>
<polygon fill="black" stroke="black" points="2332.65,-8020.39 2336.07,-8010.36 2327.15,-8016.07 2332.65,-8020.39"/>
</g>
<!-- stage1_layer3_expert3_reduce&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge396" class="edge">
<title>stage1_layer3_expert3_reduce&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M2142.24,-7927.97C2106.36,-7923.12 2069.7,-7918.36 2035,-7914.16 1841.15,-7890.74 1625.84,-7868.21 1444.4,-7850.22"/>
<polygon fill="black" stroke="black" points="1444.71,-7846.74 1434.42,-7849.24 1444.02,-7853.7 1444.71,-7846.74"/>
</g>
<!-- stage1_layer3_residual2 -->
<g id="node361" class="node">
<title>stage1_layer3_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1472.89,-7706.16 768.35,-7706.16 587.11,-7570.16 1291.65,-7570.16 1472.89,-7706.16"/>
<text text-anchor="middle" x="1030" y="-7656.96" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1030" y="-7641.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1030" y="-7626.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-7611.96" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_expert_agg&#45;&gt;stage1_layer3_residual2 -->
<g id="edge397" class="edge">
<title>stage1_layer3_expert_agg&#45;&gt;stage1_layer3_residual2</title>
<path fill="none" stroke="black" d="M1030,-7741.98C1030,-7733.66 1030,-7725.11 1030,-7716.66"/>
<polygon fill="black" stroke="black" points="1033.5,-7716.42 1030,-7706.42 1026.5,-7716.42 1033.5,-7716.42"/>
</g>
<!-- stage1_layer4_layernorm -->
<g id="node362" class="node">
<title>stage1_layer4_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1233.5,-7523.16 826.5,-7523.16 826.5,-7455.16 1233.5,-7455.16 1233.5,-7523.16"/>
<text text-anchor="middle" x="1030" y="-7507.96" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1030" y="-7492.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-7477.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-7462.96" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer3_residual2&#45;&gt;stage1_layer4_layernorm -->
<g id="edge398" class="edge">
<title>stage1_layer3_residual2&#45;&gt;stage1_layer4_layernorm</title>
<path fill="none" stroke="black" d="M1030,-7570.12C1030,-7557.71 1030,-7545.06 1030,-7533.58"/>
<polygon fill="black" stroke="black" points="1033.5,-7533.42 1030,-7523.42 1026.5,-7533.42 1033.5,-7533.42"/>
</g>
<!-- stage1_layer4_qkv_proj -->
<g id="node363" class="node">
<title>stage1_layer4_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1287.5,-7419.16 772.5,-7419.16 772.5,-7351.16 1287.5,-7351.16 1287.5,-7419.16"/>
<text text-anchor="middle" x="1030" y="-7403.96" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1030" y="-7388.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-7373.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1030" y="-7358.96" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_layernorm&#45;&gt;stage1_layer4_qkv_proj -->
<g id="edge399" class="edge">
<title>stage1_layer4_layernorm&#45;&gt;stage1_layer4_qkv_proj</title>
<path fill="none" stroke="black" d="M1030,-7455.05C1030,-7446.94 1030,-7438.15 1030,-7429.64"/>
<polygon fill="black" stroke="black" points="1033.5,-7429.46 1030,-7419.46 1026.5,-7429.46 1033.5,-7429.46"/>
</g>
<!-- stage1_layer4_qkv_gather -->
<g id="node364" class="node">
<title>stage1_layer4_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1030" cy="-7267.08" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1030" y="-7285.88" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1030" y="-7270.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1030" y="-7255.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1030" y="-7240.88" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_qkv_proj&#45;&gt;stage1_layer4_qkv_gather -->
<g id="edge400" class="edge">
<title>stage1_layer4_qkv_proj&#45;&gt;stage1_layer4_qkv_gather</title>
<path fill="none" stroke="black" d="M1030,-7350.9C1030,-7342.91 1030,-7334.14 1030,-7325.4"/>
<polygon fill="black" stroke="black" points="1033.5,-7325.19 1030,-7315.19 1026.5,-7325.19 1033.5,-7325.19"/>
</g>
<!-- stage1_layer4_attention -->
<g id="node365" class="node">
<title>stage1_layer4_attention</title>
<polygon fill="lightgreen" stroke="black" points="1281.5,-7183 778.5,-7183 778.5,-7115 1281.5,-7115 1281.5,-7183"/>
<text text-anchor="middle" x="1030" y="-7167.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1030" y="-7152.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1030" y="-7137.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1030" y="-7122.8" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_qkv_gather&#45;&gt;stage1_layer4_attention -->
<g id="edge401" class="edge">
<title>stage1_layer4_qkv_gather&#45;&gt;stage1_layer4_attention</title>
<path fill="none" stroke="black" d="M1030,-7218.87C1030,-7210.48 1030,-7201.78 1030,-7193.51"/>
<polygon fill="black" stroke="black" points="1033.5,-7193.3 1030,-7183.3 1026.5,-7193.3 1033.5,-7193.3"/>
</g>
<!-- stage1_layer4_attn_out -->
<g id="node366" class="node">
<title>stage1_layer4_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1268.5,-7079 791.5,-7079 791.5,-7011 1268.5,-7011 1268.5,-7079"/>
<text text-anchor="middle" x="1030" y="-7063.8" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1030" y="-7048.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1030" y="-7033.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1030" y="-7018.8" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_attention&#45;&gt;stage1_layer4_attn_out -->
<g id="edge402" class="edge">
<title>stage1_layer4_attention&#45;&gt;stage1_layer4_attn_out</title>
<path fill="none" stroke="black" d="M1030,-7114.88C1030,-7106.78 1030,-7097.98 1030,-7089.47"/>
<polygon fill="black" stroke="black" points="1033.5,-7089.3 1030,-7079.3 1026.5,-7089.3 1033.5,-7089.3"/>
</g>
<!-- stage1_layer4_attn_reduce -->
<g id="node367" class="node">
<title>stage1_layer4_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1030" cy="-6926.92" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1030" y="-6945.72" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1030" y="-6930.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1030" y="-6915.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-6900.72" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_attn_out&#45;&gt;stage1_layer4_attn_reduce -->
<g id="edge403" class="edge">
<title>stage1_layer4_attn_out&#45;&gt;stage1_layer4_attn_reduce</title>
<path fill="none" stroke="black" d="M1030,-7010.73C1030,-7002.74 1030,-6993.97 1030,-6985.23"/>
<polygon fill="black" stroke="black" points="1033.5,-6985.02 1030,-6975.02 1026.5,-6985.02 1033.5,-6985.02"/>
</g>
<!-- stage1_layer4_residual1 -->
<g id="node368" class="node">
<title>stage1_layer4_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1472.89,-6842.83 768.35,-6842.83 587.11,-6706.83 1291.65,-6706.83 1472.89,-6842.83"/>
<text text-anchor="middle" x="1030" y="-6793.63" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1030" y="-6778.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1030" y="-6763.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-6748.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_attn_reduce&#45;&gt;stage1_layer4_residual1 -->
<g id="edge404" class="edge">
<title>stage1_layer4_attn_reduce&#45;&gt;stage1_layer4_residual1</title>
<path fill="none" stroke="black" d="M1030,-6878.43C1030,-6870.34 1030,-6861.76 1030,-6853.14"/>
<polygon fill="black" stroke="black" points="1033.5,-6853.03 1030,-6843.03 1026.5,-6853.03 1033.5,-6853.03"/>
</g>
<!-- stage1_layer4_layernorm2 -->
<g id="node369" class="node">
<title>stage1_layer4_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1233.5,-6670.83 826.5,-6670.83 826.5,-6602.83 1233.5,-6602.83 1233.5,-6670.83"/>
<text text-anchor="middle" x="1030" y="-6655.63" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1030" y="-6640.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-6625.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-6610.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_residual1&#45;&gt;stage1_layer4_layernorm2 -->
<g id="edge405" class="edge">
<title>stage1_layer4_residual1&#45;&gt;stage1_layer4_layernorm2</title>
<path fill="none" stroke="black" d="M1030,-6706.63C1030,-6697.88 1030,-6689.11 1030,-6680.9"/>
<polygon fill="black" stroke="black" points="1033.5,-6680.85 1030,-6670.85 1026.5,-6680.85 1033.5,-6680.85"/>
</g>
<!-- stage1_layer4_expert0_gate -->
<g id="node370" class="node">
<title>stage1_layer4_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="788.5,-6566.83 365.5,-6566.83 365.5,-6498.83 788.5,-6498.83 788.5,-6566.83"/>
<text text-anchor="middle" x="577" y="-6551.63" font-family="Times,serif" font-size="14.00">Expert Gate 200</text>
<text text-anchor="middle" x="577" y="-6536.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="577" y="-6521.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="577" y="-6506.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_layernorm2&#45;&gt;stage1_layer4_expert0_gate -->
<g id="edge406" class="edge">
<title>stage1_layer4_layernorm2&#45;&gt;stage1_layer4_expert0_gate</title>
<path fill="none" stroke="black" d="M883.24,-6602.79C835.49,-6592.03 782.32,-6580.06 733.86,-6569.15"/>
<polygon fill="black" stroke="black" points="734.44,-6565.69 723.92,-6566.91 732.9,-6572.52 734.44,-6565.69"/>
</g>
<!-- stage1_layer4_expert1_gate -->
<g id="node375" class="node">
<title>stage1_layer4_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1241.5,-6566.83 818.5,-6566.83 818.5,-6498.83 1241.5,-6498.83 1241.5,-6566.83"/>
<text text-anchor="middle" x="1030" y="-6551.63" font-family="Times,serif" font-size="14.00">Expert Gate 201</text>
<text text-anchor="middle" x="1030" y="-6536.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-6521.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1030" y="-6506.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_layernorm2&#45;&gt;stage1_layer4_expert1_gate -->
<g id="edge412" class="edge">
<title>stage1_layer4_layernorm2&#45;&gt;stage1_layer4_expert1_gate</title>
<path fill="none" stroke="black" d="M1030,-6602.72C1030,-6594.61 1030,-6585.81 1030,-6577.3"/>
<polygon fill="black" stroke="black" points="1033.5,-6577.13 1030,-6567.13 1026.5,-6577.13 1033.5,-6577.13"/>
</g>
<!-- stage1_layer4_expert2_gate -->
<g id="node380" class="node">
<title>stage1_layer4_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1694.5,-6566.83 1271.5,-6566.83 1271.5,-6498.83 1694.5,-6498.83 1694.5,-6566.83"/>
<text text-anchor="middle" x="1483" y="-6551.63" font-family="Times,serif" font-size="14.00">Expert Gate 202</text>
<text text-anchor="middle" x="1483" y="-6536.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1483" y="-6521.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1483" y="-6506.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_layernorm2&#45;&gt;stage1_layer4_expert2_gate -->
<g id="edge418" class="edge">
<title>stage1_layer4_layernorm2&#45;&gt;stage1_layer4_expert2_gate</title>
<path fill="none" stroke="black" d="M1176.76,-6602.79C1224.51,-6592.03 1277.68,-6580.06 1326.14,-6569.15"/>
<polygon fill="black" stroke="black" points="1327.1,-6572.52 1336.08,-6566.91 1325.56,-6565.69 1327.1,-6572.52"/>
</g>
<!-- stage1_layer4_expert3_gate -->
<g id="node385" class="node">
<title>stage1_layer4_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2153.5,-6566.83 1730.5,-6566.83 1730.5,-6498.83 2153.5,-6498.83 2153.5,-6566.83"/>
<text text-anchor="middle" x="1942" y="-6551.63" font-family="Times,serif" font-size="14.00">Expert Gate 203</text>
<text text-anchor="middle" x="1942" y="-6536.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1942" y="-6521.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1942" y="-6506.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_layernorm2&#45;&gt;stage1_layer4_expert3_gate -->
<g id="edge424" class="edge">
<title>stage1_layer4_layernorm2&#45;&gt;stage1_layer4_expert3_gate</title>
<path fill="none" stroke="black" d="M1233.72,-6616.89C1367.53,-6603.97 1546.35,-6585.83 1704,-6566.83 1709.24,-6566.2 1714.54,-6565.55 1719.88,-6564.89"/>
<polygon fill="black" stroke="black" points="1720.72,-6568.31 1730.21,-6563.59 1719.85,-6561.36 1720.72,-6568.31"/>
</g>
<!-- stage1_layer4_expert0_mlp1 -->
<g id="node371" class="node">
<title>stage1_layer4_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="788.5,-6462.83 341.5,-6462.83 341.5,-6394.83 788.5,-6394.83 788.5,-6462.83"/>
<text text-anchor="middle" x="565" y="-6447.63" font-family="Times,serif" font-size="14.00">Expert 200 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="565" y="-6432.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="565" y="-6417.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="565" y="-6402.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert0_gate&#45;&gt;stage1_layer4_expert0_mlp1 -->
<g id="edge407" class="edge">
<title>stage1_layer4_expert0_gate&#45;&gt;stage1_layer4_expert0_mlp1</title>
<path fill="none" stroke="black" d="M573.1,-6498.72C572.15,-6490.61 571.12,-6481.81 570.11,-6473.3"/>
<polygon fill="black" stroke="black" points="573.56,-6472.65 568.92,-6463.13 566.61,-6473.47 573.56,-6472.65"/>
</g>
<!-- stage1_layer4_expert0_act -->
<g id="node372" class="node">
<title>stage1_layer4_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="773.5,-6358.83 326.5,-6358.83 326.5,-6290.83 773.5,-6290.83 773.5,-6358.83"/>
<text text-anchor="middle" x="550" y="-6343.63" font-family="Times,serif" font-size="14.00">Expert 200 Activation</text>
<text text-anchor="middle" x="550" y="-6328.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="550" y="-6313.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="550" y="-6298.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert0_mlp1&#45;&gt;stage1_layer4_expert0_act -->
<g id="edge408" class="edge">
<title>stage1_layer4_expert0_mlp1&#45;&gt;stage1_layer4_expert0_act</title>
<path fill="none" stroke="black" d="M560.13,-6394.72C558.94,-6386.61 557.64,-6377.81 556.39,-6369.3"/>
<polygon fill="black" stroke="black" points="559.81,-6368.52 554.9,-6359.13 552.89,-6369.53 559.81,-6368.52"/>
</g>
<!-- stage1_layer4_expert0_mlp2 -->
<g id="node373" class="node">
<title>stage1_layer4_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="683.5,-6254.83 206.5,-6254.83 206.5,-6186.83 683.5,-6186.83 683.5,-6254.83"/>
<text text-anchor="middle" x="445" y="-6239.63" font-family="Times,serif" font-size="14.00">Expert 200 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="445" y="-6224.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="445" y="-6209.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="445" y="-6194.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert0_act&#45;&gt;stage1_layer4_expert0_mlp2 -->
<g id="edge409" class="edge">
<title>stage1_layer4_expert0_act&#45;&gt;stage1_layer4_expert0_mlp2</title>
<path fill="none" stroke="black" d="M515.91,-6290.72C506.56,-6281.63 496.31,-6271.68 486.59,-6262.23"/>
<polygon fill="black" stroke="black" points="488.89,-6259.59 479.28,-6255.13 484.01,-6264.61 488.89,-6259.59"/>
</g>
<!-- stage1_layer4_expert0_reduce -->
<g id="node374" class="node">
<title>stage1_layer4_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="354" cy="-6102.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="354" y="-6121.55" font-family="Times,serif" font-size="14.00">Expert 200 All&#45;Reduce</text>
<text text-anchor="middle" x="354" y="-6106.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="354" y="-6091.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="354" y="-6076.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert0_mlp2&#45;&gt;stage1_layer4_expert0_reduce -->
<g id="edge410" class="edge">
<title>stage1_layer4_expert0_mlp2&#45;&gt;stage1_layer4_expert0_reduce</title>
<path fill="none" stroke="black" d="M418.92,-6186.57C412.11,-6177.88 404.59,-6168.28 397.14,-6158.78"/>
<polygon fill="black" stroke="black" points="399.85,-6156.57 390.93,-6150.86 394.35,-6160.89 399.85,-6156.57"/>
</g>
<!-- stage1_layer4_expert_agg -->
<g id="node390" class="node">
<title>stage1_layer4_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1489.89,-6018.67 785.35,-6018.67 604.11,-5882.67 1308.65,-5882.67 1489.89,-6018.67"/>
<text text-anchor="middle" x="1047" y="-5969.47" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1047" y="-5954.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1047" y="-5939.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-5924.47" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert0_reduce&#45;&gt;stage1_layer4_expert_agg -->
<g id="edge411" class="edge">
<title>stage1_layer4_expert0_reduce&#45;&gt;stage1_layer4_expert_agg</title>
<path fill="none" stroke="black" d="M535.17,-6062.51C605.26,-6047.33 687.14,-6029.6 764.59,-6012.83"/>
<polygon fill="black" stroke="black" points="765.47,-6016.22 774.51,-6010.68 763.99,-6009.38 765.47,-6016.22"/>
</g>
<!-- stage1_layer4_expert1_mlp1 -->
<g id="node376" class="node">
<title>stage1_layer4_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1253.5,-6462.83 806.5,-6462.83 806.5,-6394.83 1253.5,-6394.83 1253.5,-6462.83"/>
<text text-anchor="middle" x="1030" y="-6447.63" font-family="Times,serif" font-size="14.00">Expert 201 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1030" y="-6432.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-6417.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1030" y="-6402.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert1_gate&#45;&gt;stage1_layer4_expert1_mlp1 -->
<g id="edge413" class="edge">
<title>stage1_layer4_expert1_gate&#45;&gt;stage1_layer4_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1030,-6498.72C1030,-6490.61 1030,-6481.81 1030,-6473.3"/>
<polygon fill="black" stroke="black" points="1033.5,-6473.13 1030,-6463.13 1026.5,-6473.13 1033.5,-6473.13"/>
</g>
<!-- stage1_layer4_expert1_act -->
<g id="node377" class="node">
<title>stage1_layer4_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1253.5,-6358.83 806.5,-6358.83 806.5,-6290.83 1253.5,-6290.83 1253.5,-6358.83"/>
<text text-anchor="middle" x="1030" y="-6343.63" font-family="Times,serif" font-size="14.00">Expert 201 Activation</text>
<text text-anchor="middle" x="1030" y="-6328.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1030" y="-6313.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1030" y="-6298.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert1_mlp1&#45;&gt;stage1_layer4_expert1_act -->
<g id="edge414" class="edge">
<title>stage1_layer4_expert1_mlp1&#45;&gt;stage1_layer4_expert1_act</title>
<path fill="none" stroke="black" d="M1030,-6394.72C1030,-6386.61 1030,-6377.81 1030,-6369.3"/>
<polygon fill="black" stroke="black" points="1033.5,-6369.13 1030,-6359.13 1026.5,-6369.13 1033.5,-6369.13"/>
</g>
<!-- stage1_layer4_expert1_mlp2 -->
<g id="node378" class="node">
<title>stage1_layer4_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1268.5,-6254.83 791.5,-6254.83 791.5,-6186.83 1268.5,-6186.83 1268.5,-6254.83"/>
<text text-anchor="middle" x="1030" y="-6239.63" font-family="Times,serif" font-size="14.00">Expert 201 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1030" y="-6224.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1030" y="-6209.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1030" y="-6194.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert1_act&#45;&gt;stage1_layer4_expert1_mlp2 -->
<g id="edge415" class="edge">
<title>stage1_layer4_expert1_act&#45;&gt;stage1_layer4_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1030,-6290.72C1030,-6282.61 1030,-6273.81 1030,-6265.3"/>
<polygon fill="black" stroke="black" points="1033.5,-6265.13 1030,-6255.13 1026.5,-6265.13 1033.5,-6265.13"/>
</g>
<!-- stage1_layer4_expert1_reduce -->
<g id="node379" class="node">
<title>stage1_layer4_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1030" cy="-6102.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1030" y="-6121.55" font-family="Times,serif" font-size="14.00">Expert 201 All&#45;Reduce</text>
<text text-anchor="middle" x="1030" y="-6106.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1030" y="-6091.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1030" y="-6076.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert1_mlp2&#45;&gt;stage1_layer4_expert1_reduce -->
<g id="edge416" class="edge">
<title>stage1_layer4_expert1_mlp2&#45;&gt;stage1_layer4_expert1_reduce</title>
<path fill="none" stroke="black" d="M1030,-6186.57C1030,-6178.57 1030,-6169.81 1030,-6161.06"/>
<polygon fill="black" stroke="black" points="1033.5,-6160.86 1030,-6150.86 1026.5,-6160.86 1033.5,-6160.86"/>
</g>
<!-- stage1_layer4_expert1_reduce&#45;&gt;stage1_layer4_expert_agg -->
<g id="edge417" class="edge">
<title>stage1_layer4_expert1_reduce&#45;&gt;stage1_layer4_expert_agg</title>
<path fill="none" stroke="black" d="M1035.38,-6054.26C1036.29,-6046.18 1037.27,-6037.59 1038.24,-6028.97"/>
<polygon fill="black" stroke="black" points="1041.74,-6029.19 1039.39,-6018.86 1034.79,-6028.4 1041.74,-6029.19"/>
</g>
<!-- stage1_layer4_expert2_mlp1 -->
<g id="node381" class="node">
<title>stage1_layer4_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1733.5,-6462.83 1286.5,-6462.83 1286.5,-6394.83 1733.5,-6394.83 1733.5,-6462.83"/>
<text text-anchor="middle" x="1510" y="-6447.63" font-family="Times,serif" font-size="14.00">Expert 202 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1510" y="-6432.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1510" y="-6417.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1510" y="-6402.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert2_gate&#45;&gt;stage1_layer4_expert2_mlp1 -->
<g id="edge419" class="edge">
<title>stage1_layer4_expert2_gate&#45;&gt;stage1_layer4_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1491.77,-6498.72C1493.94,-6490.52 1496.29,-6481.62 1498.57,-6473.02"/>
<polygon fill="black" stroke="black" points="1502.01,-6473.69 1501.19,-6463.13 1495.24,-6471.9 1502.01,-6473.69"/>
</g>
<!-- stage1_layer4_expert2_act -->
<g id="node382" class="node">
<title>stage1_layer4_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1751.5,-6358.83 1304.5,-6358.83 1304.5,-6290.83 1751.5,-6290.83 1751.5,-6358.83"/>
<text text-anchor="middle" x="1528" y="-6343.63" font-family="Times,serif" font-size="14.00">Expert 202 Activation</text>
<text text-anchor="middle" x="1528" y="-6328.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1528" y="-6313.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1528" y="-6298.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert2_mlp1&#45;&gt;stage1_layer4_expert2_act -->
<g id="edge420" class="edge">
<title>stage1_layer4_expert2_mlp1&#45;&gt;stage1_layer4_expert2_act</title>
<path fill="none" stroke="black" d="M1515.84,-6394.72C1517.29,-6386.52 1518.86,-6377.62 1520.38,-6369.02"/>
<polygon fill="black" stroke="black" points="1523.83,-6369.59 1522.12,-6359.13 1516.94,-6368.37 1523.83,-6369.59"/>
</g>
<!-- stage1_layer4_expert2_mlp2 -->
<g id="node383" class="node">
<title>stage1_layer4_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1853.5,-6254.83 1376.5,-6254.83 1376.5,-6186.83 1853.5,-6186.83 1853.5,-6254.83"/>
<text text-anchor="middle" x="1615" y="-6239.63" font-family="Times,serif" font-size="14.00">Expert 202 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1615" y="-6224.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1615" y="-6209.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1615" y="-6194.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert2_act&#45;&gt;stage1_layer4_expert2_mlp2 -->
<g id="edge421" class="edge">
<title>stage1_layer4_expert2_act&#45;&gt;stage1_layer4_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1556.25,-6290.72C1563.84,-6281.81 1572.15,-6272.07 1580.07,-6262.79"/>
<polygon fill="black" stroke="black" points="1582.77,-6265.01 1586.6,-6255.13 1577.45,-6260.47 1582.77,-6265.01"/>
</g>
<!-- stage1_layer4_expert2_reduce -->
<g id="node384" class="node">
<title>stage1_layer4_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1706" cy="-6102.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1706" y="-6121.55" font-family="Times,serif" font-size="14.00">Expert 202 All&#45;Reduce</text>
<text text-anchor="middle" x="1706" y="-6106.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1706" y="-6091.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1706" y="-6076.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert2_mlp2&#45;&gt;stage1_layer4_expert2_reduce -->
<g id="edge422" class="edge">
<title>stage1_layer4_expert2_mlp2&#45;&gt;stage1_layer4_expert2_reduce</title>
<path fill="none" stroke="black" d="M1641.08,-6186.57C1647.89,-6177.88 1655.41,-6168.28 1662.86,-6158.78"/>
<polygon fill="black" stroke="black" points="1665.65,-6160.89 1669.07,-6150.86 1660.15,-6156.57 1665.65,-6160.89"/>
</g>
<!-- stage1_layer4_expert2_reduce&#45;&gt;stage1_layer4_expert_agg -->
<g id="edge423" class="edge">
<title>stage1_layer4_expert2_reduce&#45;&gt;stage1_layer4_expert_agg</title>
<path fill="none" stroke="black" d="M1531.13,-6061.92C1475.75,-6049.31 1412.84,-6034.98 1351.12,-6020.93"/>
<polygon fill="black" stroke="black" points="1351.75,-6017.48 1341.22,-6018.67 1350.2,-6024.31 1351.75,-6017.48"/>
</g>
<!-- stage1_layer4_expert3_mlp1 -->
<g id="node386" class="node">
<title>stage1_layer4_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2205.5,-6462.83 1758.5,-6462.83 1758.5,-6394.83 2205.5,-6394.83 2205.5,-6462.83"/>
<text text-anchor="middle" x="1982" y="-6447.63" font-family="Times,serif" font-size="14.00">Expert 203 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1982" y="-6432.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1982" y="-6417.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1982" y="-6402.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert3_gate&#45;&gt;stage1_layer4_expert3_mlp1 -->
<g id="edge425" class="edge">
<title>stage1_layer4_expert3_gate&#45;&gt;stage1_layer4_expert3_mlp1</title>
<path fill="none" stroke="black" d="M1954.99,-6498.72C1958.27,-6490.34 1961.84,-6481.23 1965.28,-6472.46"/>
<polygon fill="black" stroke="black" points="1968.55,-6473.72 1968.94,-6463.13 1962.03,-6471.16 1968.55,-6473.72"/>
</g>
<!-- stage1_layer4_expert3_act -->
<g id="node387" class="node">
<title>stage1_layer4_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2235.5,-6358.83 1788.5,-6358.83 1788.5,-6290.83 2235.5,-6290.83 2235.5,-6358.83"/>
<text text-anchor="middle" x="2012" y="-6343.63" font-family="Times,serif" font-size="14.00">Expert 203 Activation</text>
<text text-anchor="middle" x="2012" y="-6328.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2012" y="-6313.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2012" y="-6298.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert3_mlp1&#45;&gt;stage1_layer4_expert3_act -->
<g id="edge426" class="edge">
<title>stage1_layer4_expert3_mlp1&#45;&gt;stage1_layer4_expert3_act</title>
<path fill="none" stroke="black" d="M1991.74,-6394.72C1994.18,-6386.43 1996.82,-6377.43 1999.38,-6368.74"/>
<polygon fill="black" stroke="black" points="2002.74,-6369.71 2002.21,-6359.13 1996.03,-6367.74 2002.74,-6369.71"/>
</g>
<!-- stage1_layer4_expert3_mlp2 -->
<g id="node388" class="node">
<title>stage1_layer4_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2484.5,-6254.83 2007.5,-6254.83 2007.5,-6186.83 2484.5,-6186.83 2484.5,-6254.83"/>
<text text-anchor="middle" x="2246" y="-6239.63" font-family="Times,serif" font-size="14.00">Expert 203 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2246" y="-6224.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2246" y="-6209.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2246" y="-6194.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert3_act&#45;&gt;stage1_layer4_expert3_mlp2 -->
<g id="edge427" class="edge">
<title>stage1_layer4_expert3_act&#45;&gt;stage1_layer4_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2087.97,-6290.72C2111.18,-6280.6 2136.86,-6269.41 2160.64,-6259.04"/>
<polygon fill="black" stroke="black" points="2162.24,-6262.16 2170.01,-6254.96 2159.44,-6255.74 2162.24,-6262.16"/>
</g>
<!-- stage1_layer4_expert3_reduce -->
<g id="node389" class="node">
<title>stage1_layer4_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2382" cy="-6102.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2382" y="-6121.55" font-family="Times,serif" font-size="14.00">Expert 203 All&#45;Reduce</text>
<text text-anchor="middle" x="2382" y="-6106.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2382" y="-6091.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2382" y="-6076.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert3_mlp2&#45;&gt;stage1_layer4_expert3_reduce -->
<g id="edge428" class="edge">
<title>stage1_layer4_expert3_mlp2&#45;&gt;stage1_layer4_expert3_reduce</title>
<path fill="none" stroke="black" d="M2284.97,-6186.57C2295.85,-6177.28 2307.96,-6166.95 2319.82,-6156.82"/>
<polygon fill="black" stroke="black" points="2322.23,-6159.36 2327.57,-6150.21 2317.69,-6154.04 2322.23,-6159.36"/>
</g>
<!-- stage1_layer4_expert3_reduce&#45;&gt;stage1_layer4_expert_agg -->
<g id="edge429" class="edge">
<title>stage1_layer4_expert3_reduce&#45;&gt;stage1_layer4_expert_agg</title>
<path fill="none" stroke="black" d="M2151.23,-6068.49C2115.36,-6063.64 2078.7,-6058.87 2044,-6054.67 1853.16,-6031.52 1641.36,-6009.17 1462.24,-5991.24"/>
<polygon fill="black" stroke="black" points="1462.41,-5987.74 1452.11,-5990.23 1461.71,-5994.71 1462.41,-5987.74"/>
</g>
<!-- stage1_layer4_residual2 -->
<g id="node391" class="node">
<title>stage1_layer4_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1489.89,-5846.67 785.35,-5846.67 604.11,-5710.67 1308.65,-5710.67 1489.89,-5846.67"/>
<text text-anchor="middle" x="1047" y="-5797.47" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1047" y="-5782.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1047" y="-5767.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-5752.47" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_expert_agg&#45;&gt;stage1_layer4_residual2 -->
<g id="edge430" class="edge">
<title>stage1_layer4_expert_agg&#45;&gt;stage1_layer4_residual2</title>
<path fill="none" stroke="black" d="M1047,-5882.48C1047,-5874.16 1047,-5865.61 1047,-5857.16"/>
<polygon fill="black" stroke="black" points="1050.5,-5856.92 1047,-5846.92 1043.5,-5856.92 1050.5,-5856.92"/>
</g>
<!-- stage1_layer5_layernorm -->
<g id="node392" class="node">
<title>stage1_layer5_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1250.5,-5663.67 843.5,-5663.67 843.5,-5595.67 1250.5,-5595.67 1250.5,-5663.67"/>
<text text-anchor="middle" x="1047" y="-5648.47" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1047" y="-5633.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-5618.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-5603.47" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer4_residual2&#45;&gt;stage1_layer5_layernorm -->
<g id="edge431" class="edge">
<title>stage1_layer4_residual2&#45;&gt;stage1_layer5_layernorm</title>
<path fill="none" stroke="black" d="M1047,-5710.62C1047,-5698.21 1047,-5685.56 1047,-5674.09"/>
<polygon fill="black" stroke="black" points="1050.5,-5673.92 1047,-5663.92 1043.5,-5673.92 1050.5,-5673.92"/>
</g>
<!-- stage1_layer5_qkv_proj -->
<g id="node393" class="node">
<title>stage1_layer5_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-5559.67 789.5,-5559.67 789.5,-5491.67 1304.5,-5491.67 1304.5,-5559.67"/>
<text text-anchor="middle" x="1047" y="-5544.47" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1047" y="-5529.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-5514.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1047" y="-5499.47" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_layernorm&#45;&gt;stage1_layer5_qkv_proj -->
<g id="edge432" class="edge">
<title>stage1_layer5_layernorm&#45;&gt;stage1_layer5_qkv_proj</title>
<path fill="none" stroke="black" d="M1047,-5595.55C1047,-5587.44 1047,-5578.65 1047,-5570.14"/>
<polygon fill="black" stroke="black" points="1050.5,-5569.96 1047,-5559.96 1043.5,-5569.96 1050.5,-5569.96"/>
</g>
<!-- stage1_layer5_qkv_gather -->
<g id="node394" class="node">
<title>stage1_layer5_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1047" cy="-5407.58" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1047" y="-5426.38" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1047" y="-5411.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1047" y="-5396.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1047" y="-5381.38" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_qkv_proj&#45;&gt;stage1_layer5_qkv_gather -->
<g id="edge433" class="edge">
<title>stage1_layer5_qkv_proj&#45;&gt;stage1_layer5_qkv_gather</title>
<path fill="none" stroke="black" d="M1047,-5491.4C1047,-5483.41 1047,-5474.64 1047,-5465.9"/>
<polygon fill="black" stroke="black" points="1050.5,-5465.69 1047,-5455.69 1043.5,-5465.69 1050.5,-5465.69"/>
</g>
<!-- stage1_layer5_attention -->
<g id="node395" class="node">
<title>stage1_layer5_attention</title>
<polygon fill="lightgreen" stroke="black" points="1298.5,-5323.5 795.5,-5323.5 795.5,-5255.5 1298.5,-5255.5 1298.5,-5323.5"/>
<text text-anchor="middle" x="1047" y="-5308.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1047" y="-5293.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1047" y="-5278.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1047" y="-5263.3" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_qkv_gather&#45;&gt;stage1_layer5_attention -->
<g id="edge434" class="edge">
<title>stage1_layer5_qkv_gather&#45;&gt;stage1_layer5_attention</title>
<path fill="none" stroke="black" d="M1047,-5359.37C1047,-5350.98 1047,-5342.28 1047,-5334.01"/>
<polygon fill="black" stroke="black" points="1050.5,-5333.8 1047,-5323.8 1043.5,-5333.8 1050.5,-5333.8"/>
</g>
<!-- stage1_layer5_attn_out -->
<g id="node396" class="node">
<title>stage1_layer5_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1285.5,-5219.5 808.5,-5219.5 808.5,-5151.5 1285.5,-5151.5 1285.5,-5219.5"/>
<text text-anchor="middle" x="1047" y="-5204.3" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1047" y="-5189.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1047" y="-5174.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1047" y="-5159.3" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_attention&#45;&gt;stage1_layer5_attn_out -->
<g id="edge435" class="edge">
<title>stage1_layer5_attention&#45;&gt;stage1_layer5_attn_out</title>
<path fill="none" stroke="black" d="M1047,-5255.38C1047,-5247.28 1047,-5238.48 1047,-5229.97"/>
<polygon fill="black" stroke="black" points="1050.5,-5229.8 1047,-5219.8 1043.5,-5229.8 1050.5,-5229.8"/>
</g>
<!-- stage1_layer5_attn_reduce -->
<g id="node397" class="node">
<title>stage1_layer5_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1047" cy="-5067.42" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1047" y="-5086.22" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1047" y="-5071.22" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1047" y="-5056.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-5041.22" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_attn_out&#45;&gt;stage1_layer5_attn_reduce -->
<g id="edge436" class="edge">
<title>stage1_layer5_attn_out&#45;&gt;stage1_layer5_attn_reduce</title>
<path fill="none" stroke="black" d="M1047,-5151.23C1047,-5143.24 1047,-5134.47 1047,-5125.73"/>
<polygon fill="black" stroke="black" points="1050.5,-5125.53 1047,-5115.53 1043.5,-5125.53 1050.5,-5125.53"/>
</g>
<!-- stage1_layer5_residual1 -->
<g id="node398" class="node">
<title>stage1_layer5_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1489.89,-4983.33 785.35,-4983.33 604.11,-4847.33 1308.65,-4847.33 1489.89,-4983.33"/>
<text text-anchor="middle" x="1047" y="-4934.13" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1047" y="-4919.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1047" y="-4904.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-4889.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_attn_reduce&#45;&gt;stage1_layer5_residual1 -->
<g id="edge437" class="edge">
<title>stage1_layer5_attn_reduce&#45;&gt;stage1_layer5_residual1</title>
<path fill="none" stroke="black" d="M1047,-5018.93C1047,-5010.84 1047,-5002.26 1047,-4993.64"/>
<polygon fill="black" stroke="black" points="1050.5,-4993.53 1047,-4983.53 1043.5,-4993.53 1050.5,-4993.53"/>
</g>
<!-- stage1_layer5_layernorm2 -->
<g id="node399" class="node">
<title>stage1_layer5_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1250.5,-4811.33 843.5,-4811.33 843.5,-4743.33 1250.5,-4743.33 1250.5,-4811.33"/>
<text text-anchor="middle" x="1047" y="-4796.13" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1047" y="-4781.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-4766.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-4751.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_residual1&#45;&gt;stage1_layer5_layernorm2 -->
<g id="edge438" class="edge">
<title>stage1_layer5_residual1&#45;&gt;stage1_layer5_layernorm2</title>
<path fill="none" stroke="black" d="M1047,-4847.13C1047,-4838.38 1047,-4829.61 1047,-4821.4"/>
<polygon fill="black" stroke="black" points="1050.5,-4821.35 1047,-4811.35 1043.5,-4821.35 1050.5,-4821.35"/>
</g>
<!-- stage1_layer5_expert0_gate -->
<g id="node400" class="node">
<title>stage1_layer5_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="805.5,-4707.33 382.5,-4707.33 382.5,-4639.33 805.5,-4639.33 805.5,-4707.33"/>
<text text-anchor="middle" x="594" y="-4692.13" font-family="Times,serif" font-size="14.00">Expert Gate 216</text>
<text text-anchor="middle" x="594" y="-4677.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="594" y="-4662.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="594" y="-4647.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_layernorm2&#45;&gt;stage1_layer5_expert0_gate -->
<g id="edge439" class="edge">
<title>stage1_layer5_layernorm2&#45;&gt;stage1_layer5_expert0_gate</title>
<path fill="none" stroke="black" d="M900.24,-4743.29C852.49,-4732.53 799.32,-4720.56 750.86,-4709.65"/>
<polygon fill="black" stroke="black" points="751.44,-4706.2 740.92,-4707.41 749.9,-4713.02 751.44,-4706.2"/>
</g>
<!-- stage1_layer5_expert1_gate -->
<g id="node405" class="node">
<title>stage1_layer5_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1258.5,-4707.33 835.5,-4707.33 835.5,-4639.33 1258.5,-4639.33 1258.5,-4707.33"/>
<text text-anchor="middle" x="1047" y="-4692.13" font-family="Times,serif" font-size="14.00">Expert Gate 217</text>
<text text-anchor="middle" x="1047" y="-4677.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-4662.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1047" y="-4647.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_layernorm2&#45;&gt;stage1_layer5_expert1_gate -->
<g id="edge445" class="edge">
<title>stage1_layer5_layernorm2&#45;&gt;stage1_layer5_expert1_gate</title>
<path fill="none" stroke="black" d="M1047,-4743.22C1047,-4735.11 1047,-4726.31 1047,-4717.8"/>
<polygon fill="black" stroke="black" points="1050.5,-4717.63 1047,-4707.63 1043.5,-4717.63 1050.5,-4717.63"/>
</g>
<!-- stage1_layer5_expert2_gate -->
<g id="node410" class="node">
<title>stage1_layer5_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1711.5,-4707.33 1288.5,-4707.33 1288.5,-4639.33 1711.5,-4639.33 1711.5,-4707.33"/>
<text text-anchor="middle" x="1500" y="-4692.13" font-family="Times,serif" font-size="14.00">Expert Gate 218</text>
<text text-anchor="middle" x="1500" y="-4677.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1500" y="-4662.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1500" y="-4647.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_layernorm2&#45;&gt;stage1_layer5_expert2_gate -->
<g id="edge451" class="edge">
<title>stage1_layer5_layernorm2&#45;&gt;stage1_layer5_expert2_gate</title>
<path fill="none" stroke="black" d="M1193.76,-4743.29C1241.51,-4732.53 1294.68,-4720.56 1343.14,-4709.65"/>
<polygon fill="black" stroke="black" points="1344.1,-4713.02 1353.08,-4707.41 1342.56,-4706.2 1344.1,-4713.02"/>
</g>
<!-- stage1_layer5_expert3_gate -->
<g id="node415" class="node">
<title>stage1_layer5_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2170.5,-4707.33 1747.5,-4707.33 1747.5,-4639.33 2170.5,-4639.33 2170.5,-4707.33"/>
<text text-anchor="middle" x="1959" y="-4692.13" font-family="Times,serif" font-size="14.00">Expert Gate 219</text>
<text text-anchor="middle" x="1959" y="-4677.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1959" y="-4662.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1959" y="-4647.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_layernorm2&#45;&gt;stage1_layer5_expert3_gate -->
<g id="edge457" class="edge">
<title>stage1_layer5_layernorm2&#45;&gt;stage1_layer5_expert3_gate</title>
<path fill="none" stroke="black" d="M1250.72,-4757.39C1384.53,-4744.48 1563.35,-4726.33 1721,-4707.33 1726.24,-4706.7 1731.54,-4706.05 1736.88,-4705.39"/>
<polygon fill="black" stroke="black" points="1737.72,-4708.81 1747.21,-4704.09 1736.85,-4701.86 1737.72,-4708.81"/>
</g>
<!-- stage1_layer5_expert0_mlp1 -->
<g id="node401" class="node">
<title>stage1_layer5_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="797.5,-4603.33 350.5,-4603.33 350.5,-4535.33 797.5,-4535.33 797.5,-4603.33"/>
<text text-anchor="middle" x="574" y="-4588.13" font-family="Times,serif" font-size="14.00">Expert 216 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="574" y="-4573.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="574" y="-4558.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="574" y="-4543.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert0_gate&#45;&gt;stage1_layer5_expert0_mlp1 -->
<g id="edge440" class="edge">
<title>stage1_layer5_expert0_gate&#45;&gt;stage1_layer5_expert0_mlp1</title>
<path fill="none" stroke="black" d="M587.51,-4639.22C585.9,-4631.02 584.15,-4622.12 582.47,-4613.52"/>
<polygon fill="black" stroke="black" points="585.89,-4612.77 580.53,-4603.63 579.02,-4614.12 585.89,-4612.77"/>
</g>
<!-- stage1_layer5_expert0_act -->
<g id="node402" class="node">
<title>stage1_layer5_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="790.5,-4499.33 343.5,-4499.33 343.5,-4431.33 790.5,-4431.33 790.5,-4499.33"/>
<text text-anchor="middle" x="567" y="-4484.13" font-family="Times,serif" font-size="14.00">Expert 216 Activation</text>
<text text-anchor="middle" x="567" y="-4469.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="567" y="-4454.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="567" y="-4439.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert0_mlp1&#45;&gt;stage1_layer5_expert0_act -->
<g id="edge441" class="edge">
<title>stage1_layer5_expert0_mlp1&#45;&gt;stage1_layer5_expert0_act</title>
<path fill="none" stroke="black" d="M571.73,-4535.22C571.17,-4527.11 570.57,-4518.31 569.98,-4509.8"/>
<polygon fill="black" stroke="black" points="573.46,-4509.37 569.29,-4499.63 566.48,-4509.85 573.46,-4509.37"/>
</g>
<!-- stage1_layer5_expert0_mlp2 -->
<g id="node403" class="node">
<title>stage1_layer5_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="700.5,-4395.33 223.5,-4395.33 223.5,-4327.33 700.5,-4327.33 700.5,-4395.33"/>
<text text-anchor="middle" x="462" y="-4380.13" font-family="Times,serif" font-size="14.00">Expert 216 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="462" y="-4365.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="462" y="-4350.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="462" y="-4335.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert0_act&#45;&gt;stage1_layer5_expert0_mlp2 -->
<g id="edge442" class="edge">
<title>stage1_layer5_expert0_act&#45;&gt;stage1_layer5_expert0_mlp2</title>
<path fill="none" stroke="black" d="M532.91,-4431.22C523.56,-4422.13 513.31,-4412.18 503.59,-4402.73"/>
<polygon fill="black" stroke="black" points="505.89,-4400.09 496.28,-4395.63 501.01,-4405.11 505.89,-4400.09"/>
</g>
<!-- stage1_layer5_expert0_reduce -->
<g id="node404" class="node">
<title>stage1_layer5_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="371" cy="-4243.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="371" y="-4262.05" font-family="Times,serif" font-size="14.00">Expert 216 All&#45;Reduce</text>
<text text-anchor="middle" x="371" y="-4247.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="371" y="-4232.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="371" y="-4217.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert0_mlp2&#45;&gt;stage1_layer5_expert0_reduce -->
<g id="edge443" class="edge">
<title>stage1_layer5_expert0_mlp2&#45;&gt;stage1_layer5_expert0_reduce</title>
<path fill="none" stroke="black" d="M435.92,-4327.07C429.11,-4318.38 421.59,-4308.78 414.14,-4299.29"/>
<polygon fill="black" stroke="black" points="416.85,-4297.07 407.93,-4291.36 411.35,-4301.39 416.85,-4297.07"/>
</g>
<!-- stage1_layer5_expert_agg -->
<g id="node420" class="node">
<title>stage1_layer5_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1932.89,-4159.17 1228.35,-4159.17 1047.11,-4023.17 1751.65,-4023.17 1932.89,-4159.17"/>
<text text-anchor="middle" x="1490" y="-4109.97" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1490" y="-4094.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1490" y="-4079.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1490" y="-4064.97" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert0_reduce&#45;&gt;stage1_layer5_expert_agg -->
<g id="edge444" class="edge">
<title>stage1_layer5_expert0_reduce&#45;&gt;stage1_layer5_expert_agg</title>
<path fill="none" stroke="black" d="M605.07,-4209.42C639.91,-4204.6 675.39,-4199.72 709,-4195.17 864.34,-4174.1 1037.15,-4151.25 1180.64,-4132.44"/>
<polygon fill="black" stroke="black" points="1181.46,-4135.86 1190.92,-4131.09 1180.55,-4128.92 1181.46,-4135.86"/>
</g>
<!-- stage1_layer5_expert1_mlp1 -->
<g id="node406" class="node">
<title>stage1_layer5_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1270.5,-4603.33 823.5,-4603.33 823.5,-4535.33 1270.5,-4535.33 1270.5,-4603.33"/>
<text text-anchor="middle" x="1047" y="-4588.13" font-family="Times,serif" font-size="14.00">Expert 217 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1047" y="-4573.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-4558.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1047" y="-4543.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert1_gate&#45;&gt;stage1_layer5_expert1_mlp1 -->
<g id="edge446" class="edge">
<title>stage1_layer5_expert1_gate&#45;&gt;stage1_layer5_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1047,-4639.22C1047,-4631.11 1047,-4622.31 1047,-4613.8"/>
<polygon fill="black" stroke="black" points="1050.5,-4613.63 1047,-4603.63 1043.5,-4613.63 1050.5,-4613.63"/>
</g>
<!-- stage1_layer5_expert1_act -->
<g id="node407" class="node">
<title>stage1_layer5_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1270.5,-4499.33 823.5,-4499.33 823.5,-4431.33 1270.5,-4431.33 1270.5,-4499.33"/>
<text text-anchor="middle" x="1047" y="-4484.13" font-family="Times,serif" font-size="14.00">Expert 217 Activation</text>
<text text-anchor="middle" x="1047" y="-4469.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1047" y="-4454.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1047" y="-4439.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert1_mlp1&#45;&gt;stage1_layer5_expert1_act -->
<g id="edge447" class="edge">
<title>stage1_layer5_expert1_mlp1&#45;&gt;stage1_layer5_expert1_act</title>
<path fill="none" stroke="black" d="M1047,-4535.22C1047,-4527.11 1047,-4518.31 1047,-4509.8"/>
<polygon fill="black" stroke="black" points="1050.5,-4509.63 1047,-4499.63 1043.5,-4509.63 1050.5,-4509.63"/>
</g>
<!-- stage1_layer5_expert1_mlp2 -->
<g id="node408" class="node">
<title>stage1_layer5_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1285.5,-4395.33 808.5,-4395.33 808.5,-4327.33 1285.5,-4327.33 1285.5,-4395.33"/>
<text text-anchor="middle" x="1047" y="-4380.13" font-family="Times,serif" font-size="14.00">Expert 217 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1047" y="-4365.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1047" y="-4350.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1047" y="-4335.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert1_act&#45;&gt;stage1_layer5_expert1_mlp2 -->
<g id="edge448" class="edge">
<title>stage1_layer5_expert1_act&#45;&gt;stage1_layer5_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1047,-4431.22C1047,-4423.11 1047,-4414.31 1047,-4405.8"/>
<polygon fill="black" stroke="black" points="1050.5,-4405.63 1047,-4395.63 1043.5,-4405.63 1050.5,-4405.63"/>
</g>
<!-- stage1_layer5_expert1_reduce -->
<g id="node409" class="node">
<title>stage1_layer5_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1047" cy="-4243.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1047" y="-4262.05" font-family="Times,serif" font-size="14.00">Expert 217 All&#45;Reduce</text>
<text text-anchor="middle" x="1047" y="-4247.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1047" y="-4232.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1047" y="-4217.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert1_mlp2&#45;&gt;stage1_layer5_expert1_reduce -->
<g id="edge449" class="edge">
<title>stage1_layer5_expert1_mlp2&#45;&gt;stage1_layer5_expert1_reduce</title>
<path fill="none" stroke="black" d="M1047,-4327.07C1047,-4319.07 1047,-4310.31 1047,-4301.56"/>
<polygon fill="black" stroke="black" points="1050.5,-4301.36 1047,-4291.36 1043.5,-4301.36 1050.5,-4301.36"/>
</g>
<!-- stage1_layer5_expert1_reduce&#45;&gt;stage1_layer5_expert_agg -->
<g id="edge450" class="edge">
<title>stage1_layer5_expert1_reduce&#45;&gt;stage1_layer5_expert_agg</title>
<path fill="none" stroke="black" d="M1174.84,-4198.94C1208.5,-4187.53 1245.71,-4174.93 1282.4,-4162.5"/>
<polygon fill="black" stroke="black" points="1283.88,-4165.69 1292.22,-4159.17 1281.63,-4159.06 1283.88,-4165.69"/>
</g>
<!-- stage1_layer5_expert2_mlp1 -->
<g id="node411" class="node">
<title>stage1_layer5_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1742.5,-4603.33 1295.5,-4603.33 1295.5,-4535.33 1742.5,-4535.33 1742.5,-4603.33"/>
<text text-anchor="middle" x="1519" y="-4588.13" font-family="Times,serif" font-size="14.00">Expert 218 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1519" y="-4573.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1519" y="-4558.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1519" y="-4543.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert2_gate&#45;&gt;stage1_layer5_expert2_mlp1 -->
<g id="edge452" class="edge">
<title>stage1_layer5_expert2_gate&#45;&gt;stage1_layer5_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1506.17,-4639.22C1507.7,-4631.02 1509.35,-4622.12 1510.95,-4613.52"/>
<polygon fill="black" stroke="black" points="1514.41,-4614.1 1512.8,-4603.63 1507.53,-4612.82 1514.41,-4614.1"/>
</g>
<!-- stage1_layer5_expert2_act -->
<g id="node412" class="node">
<title>stage1_layer5_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1752.5,-4499.33 1305.5,-4499.33 1305.5,-4431.33 1752.5,-4431.33 1752.5,-4499.33"/>
<text text-anchor="middle" x="1529" y="-4484.13" font-family="Times,serif" font-size="14.00">Expert 218 Activation</text>
<text text-anchor="middle" x="1529" y="-4469.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1529" y="-4454.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1529" y="-4439.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert2_mlp1&#45;&gt;stage1_layer5_expert2_act -->
<g id="edge453" class="edge">
<title>stage1_layer5_expert2_mlp1&#45;&gt;stage1_layer5_expert2_act</title>
<path fill="none" stroke="black" d="M1522.25,-4535.22C1523.04,-4527.11 1523.9,-4518.31 1524.74,-4509.8"/>
<polygon fill="black" stroke="black" points="1528.24,-4509.93 1525.74,-4499.63 1521.28,-4509.24 1528.24,-4509.93"/>
</g>
<!-- stage1_layer5_expert2_mlp2 -->
<g id="node413" class="node">
<title>stage1_layer5_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1870.5,-4395.33 1393.5,-4395.33 1393.5,-4327.33 1870.5,-4327.33 1870.5,-4395.33"/>
<text text-anchor="middle" x="1632" y="-4380.13" font-family="Times,serif" font-size="14.00">Expert 218 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1632" y="-4365.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1632" y="-4350.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1632" y="-4335.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert2_act&#45;&gt;stage1_layer5_expert2_mlp2 -->
<g id="edge454" class="edge">
<title>stage1_layer5_expert2_act&#45;&gt;stage1_layer5_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1562.44,-4431.22C1571.62,-4422.13 1581.67,-4412.18 1591.2,-4402.73"/>
<polygon fill="black" stroke="black" points="1593.73,-4405.15 1598.37,-4395.63 1588.81,-4400.18 1593.73,-4405.15"/>
</g>
<!-- stage1_layer5_expert2_reduce -->
<g id="node414" class="node">
<title>stage1_layer5_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1723" cy="-4243.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1723" y="-4262.05" font-family="Times,serif" font-size="14.00">Expert 218 All&#45;Reduce</text>
<text text-anchor="middle" x="1723" y="-4247.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1723" y="-4232.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1723" y="-4217.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert2_mlp2&#45;&gt;stage1_layer5_expert2_reduce -->
<g id="edge455" class="edge">
<title>stage1_layer5_expert2_mlp2&#45;&gt;stage1_layer5_expert2_reduce</title>
<path fill="none" stroke="black" d="M1658.08,-4327.07C1664.89,-4318.38 1672.41,-4308.78 1679.86,-4299.29"/>
<polygon fill="black" stroke="black" points="1682.65,-4301.39 1686.07,-4291.36 1677.15,-4297.07 1682.65,-4301.39"/>
</g>
<!-- stage1_layer5_expert2_reduce&#45;&gt;stage1_layer5_expert_agg -->
<g id="edge456" class="edge">
<title>stage1_layer5_expert2_reduce&#45;&gt;stage1_layer5_expert_agg</title>
<path fill="none" stroke="black" d="M1651.51,-4196.2C1636.13,-4186.29 1619.52,-4175.59 1602.99,-4164.95"/>
<polygon fill="black" stroke="black" points="1604.67,-4161.87 1594.37,-4159.39 1600.88,-4167.75 1604.67,-4161.87"/>
</g>
<!-- stage1_layer5_expert3_mlp1 -->
<g id="node416" class="node">
<title>stage1_layer5_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2211.5,-4603.33 1764.5,-4603.33 1764.5,-4535.33 2211.5,-4535.33 2211.5,-4603.33"/>
<text text-anchor="middle" x="1988" y="-4588.13" font-family="Times,serif" font-size="14.00">Expert 219 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1988" y="-4573.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1988" y="-4558.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1988" y="-4543.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert3_gate&#45;&gt;stage1_layer5_expert3_mlp1 -->
<g id="edge458" class="edge">
<title>stage1_layer5_expert3_gate&#45;&gt;stage1_layer5_expert3_mlp1</title>
<path fill="none" stroke="black" d="M1968.42,-4639.22C1970.75,-4631.02 1973.28,-4622.12 1975.72,-4613.52"/>
<polygon fill="black" stroke="black" points="1979.16,-4614.21 1978.53,-4603.63 1972.43,-4612.29 1979.16,-4614.21"/>
</g>
<!-- stage1_layer5_expert3_act -->
<g id="node417" class="node">
<title>stage1_layer5_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2226.5,-4499.33 1779.5,-4499.33 1779.5,-4431.33 2226.5,-4431.33 2226.5,-4499.33"/>
<text text-anchor="middle" x="2003" y="-4484.13" font-family="Times,serif" font-size="14.00">Expert 219 Activation</text>
<text text-anchor="middle" x="2003" y="-4469.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2003" y="-4454.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2003" y="-4439.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert3_mlp1&#45;&gt;stage1_layer5_expert3_act -->
<g id="edge459" class="edge">
<title>stage1_layer5_expert3_mlp1&#45;&gt;stage1_layer5_expert3_act</title>
<path fill="none" stroke="black" d="M1992.87,-4535.22C1994.06,-4527.11 1995.36,-4518.31 1996.61,-4509.8"/>
<polygon fill="black" stroke="black" points="2000.11,-4510.03 1998.1,-4499.63 1993.19,-4509.02 2000.11,-4510.03"/>
</g>
<!-- stage1_layer5_expert3_mlp2 -->
<g id="node418" class="node">
<title>stage1_layer5_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2501.5,-4395.33 2024.5,-4395.33 2024.5,-4327.33 2501.5,-4327.33 2501.5,-4395.33"/>
<text text-anchor="middle" x="2263" y="-4380.13" font-family="Times,serif" font-size="14.00">Expert 219 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2263" y="-4365.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2263" y="-4350.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2263" y="-4335.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert3_act&#45;&gt;stage1_layer5_expert3_mlp2 -->
<g id="edge460" class="edge">
<title>stage1_layer5_expert3_act&#45;&gt;stage1_layer5_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2087.41,-4431.22C2113.54,-4420.96 2142.49,-4409.61 2169.21,-4399.13"/>
<polygon fill="black" stroke="black" points="2170.53,-4402.37 2178.56,-4395.46 2167.98,-4395.85 2170.53,-4402.37"/>
</g>
<!-- stage1_layer5_expert3_reduce -->
<g id="node419" class="node">
<title>stage1_layer5_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2399" cy="-4243.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2399" y="-4262.05" font-family="Times,serif" font-size="14.00">Expert 219 All&#45;Reduce</text>
<text text-anchor="middle" x="2399" y="-4247.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2399" y="-4232.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2399" y="-4217.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert3_mlp2&#45;&gt;stage1_layer5_expert3_reduce -->
<g id="edge461" class="edge">
<title>stage1_layer5_expert3_mlp2&#45;&gt;stage1_layer5_expert3_reduce</title>
<path fill="none" stroke="black" d="M2301.97,-4327.07C2312.85,-4317.78 2324.96,-4307.45 2336.82,-4297.32"/>
<polygon fill="black" stroke="black" points="2339.23,-4299.86 2344.57,-4290.71 2334.69,-4294.54 2339.23,-4299.86"/>
</g>
<!-- stage1_layer5_expert3_reduce&#45;&gt;stage1_layer5_expert_agg -->
<g id="edge462" class="edge">
<title>stage1_layer5_expert3_reduce&#45;&gt;stage1_layer5_expert_agg</title>
<path fill="none" stroke="black" d="M2184.16,-4206.78C2100.67,-4192.99 2002.07,-4176.71 1905.81,-4160.82"/>
<polygon fill="black" stroke="black" points="1906.33,-4157.36 1895.9,-4159.18 1905.19,-4164.26 1906.33,-4157.36"/>
</g>
<!-- stage1_layer5_residual2 -->
<g id="node421" class="node">
<title>stage1_layer5_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1932.89,-3987.17 1228.35,-3987.17 1047.11,-3851.17 1751.65,-3851.17 1932.89,-3987.17"/>
<text text-anchor="middle" x="1490" y="-3937.97" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1490" y="-3922.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1490" y="-3907.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1490" y="-3892.97" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_expert_agg&#45;&gt;stage1_layer5_residual2 -->
<g id="edge463" class="edge">
<title>stage1_layer5_expert_agg&#45;&gt;stage1_layer5_residual2</title>
<path fill="none" stroke="black" d="M1490,-4022.98C1490,-4014.66 1490,-4006.11 1490,-3997.66"/>
<polygon fill="black" stroke="black" points="1493.5,-3997.42 1490,-3987.42 1486.5,-3997.42 1493.5,-3997.42"/>
</g>
<!-- stage1_layer6_layernorm -->
<g id="node422" class="node">
<title>stage1_layer6_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1693.5,-3804.17 1286.5,-3804.17 1286.5,-3736.17 1693.5,-3736.17 1693.5,-3804.17"/>
<text text-anchor="middle" x="1490" y="-3788.97" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1490" y="-3773.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1490" y="-3758.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1490" y="-3743.97" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer5_residual2&#45;&gt;stage1_layer6_layernorm -->
<g id="edge464" class="edge">
<title>stage1_layer5_residual2&#45;&gt;stage1_layer6_layernorm</title>
<path fill="none" stroke="black" d="M1490,-3851.12C1490,-3838.71 1490,-3826.06 1490,-3814.59"/>
<polygon fill="black" stroke="black" points="1493.5,-3814.42 1490,-3804.42 1486.5,-3814.42 1493.5,-3814.42"/>
</g>
<!-- stage1_layer6_qkv_proj -->
<g id="node423" class="node">
<title>stage1_layer6_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1747.5,-3700.17 1232.5,-3700.17 1232.5,-3632.17 1747.5,-3632.17 1747.5,-3700.17"/>
<text text-anchor="middle" x="1490" y="-3684.97" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1490" y="-3669.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1490" y="-3654.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1490" y="-3639.97" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_layernorm&#45;&gt;stage1_layer6_qkv_proj -->
<g id="edge465" class="edge">
<title>stage1_layer6_layernorm&#45;&gt;stage1_layer6_qkv_proj</title>
<path fill="none" stroke="black" d="M1490,-3736.05C1490,-3727.94 1490,-3719.15 1490,-3710.64"/>
<polygon fill="black" stroke="black" points="1493.5,-3710.46 1490,-3700.47 1486.5,-3710.47 1493.5,-3710.46"/>
</g>
<!-- stage1_layer6_qkv_gather -->
<g id="node424" class="node">
<title>stage1_layer6_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1490" cy="-3548.08" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1490" y="-3566.88" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1490" y="-3551.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1490" y="-3536.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1490" y="-3521.88" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_qkv_proj&#45;&gt;stage1_layer6_qkv_gather -->
<g id="edge466" class="edge">
<title>stage1_layer6_qkv_proj&#45;&gt;stage1_layer6_qkv_gather</title>
<path fill="none" stroke="black" d="M1490,-3631.9C1490,-3623.91 1490,-3615.14 1490,-3606.4"/>
<polygon fill="black" stroke="black" points="1493.5,-3606.19 1490,-3596.19 1486.5,-3606.19 1493.5,-3606.19"/>
</g>
<!-- stage1_layer6_attention -->
<g id="node425" class="node">
<title>stage1_layer6_attention</title>
<polygon fill="lightgreen" stroke="black" points="1741.5,-3464 1238.5,-3464 1238.5,-3396 1741.5,-3396 1741.5,-3464"/>
<text text-anchor="middle" x="1490" y="-3448.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1490" y="-3433.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1490" y="-3418.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1490" y="-3403.8" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_qkv_gather&#45;&gt;stage1_layer6_attention -->
<g id="edge467" class="edge">
<title>stage1_layer6_qkv_gather&#45;&gt;stage1_layer6_attention</title>
<path fill="none" stroke="black" d="M1490,-3499.87C1490,-3491.48 1490,-3482.78 1490,-3474.51"/>
<polygon fill="black" stroke="black" points="1493.5,-3474.3 1490,-3464.3 1486.5,-3474.3 1493.5,-3474.3"/>
</g>
<!-- stage1_layer6_attn_out -->
<g id="node426" class="node">
<title>stage1_layer6_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1728.5,-3360 1251.5,-3360 1251.5,-3292 1728.5,-3292 1728.5,-3360"/>
<text text-anchor="middle" x="1490" y="-3344.8" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1490" y="-3329.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1490" y="-3314.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1490" y="-3299.8" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_attention&#45;&gt;stage1_layer6_attn_out -->
<g id="edge468" class="edge">
<title>stage1_layer6_attention&#45;&gt;stage1_layer6_attn_out</title>
<path fill="none" stroke="black" d="M1490,-3395.88C1490,-3387.78 1490,-3378.98 1490,-3370.47"/>
<polygon fill="black" stroke="black" points="1493.5,-3370.3 1490,-3360.3 1486.5,-3370.3 1493.5,-3370.3"/>
</g>
<!-- stage1_layer6_attn_reduce -->
<g id="node427" class="node">
<title>stage1_layer6_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1490" cy="-3207.92" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1490" y="-3226.72" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1490" y="-3211.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1490" y="-3196.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1490" y="-3181.72" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_attn_out&#45;&gt;stage1_layer6_attn_reduce -->
<g id="edge469" class="edge">
<title>stage1_layer6_attn_out&#45;&gt;stage1_layer6_attn_reduce</title>
<path fill="none" stroke="black" d="M1490,-3291.73C1490,-3283.74 1490,-3274.98 1490,-3266.23"/>
<polygon fill="black" stroke="black" points="1493.5,-3266.03 1490,-3256.03 1486.5,-3266.03 1493.5,-3266.03"/>
</g>
<!-- stage1_layer6_residual1 -->
<g id="node428" class="node">
<title>stage1_layer6_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1932.89,-3123.83 1228.35,-3123.83 1047.11,-2987.83 1751.65,-2987.83 1932.89,-3123.83"/>
<text text-anchor="middle" x="1490" y="-3074.63" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1490" y="-3059.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1490" y="-3044.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1490" y="-3029.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_attn_reduce&#45;&gt;stage1_layer6_residual1 -->
<g id="edge470" class="edge">
<title>stage1_layer6_attn_reduce&#45;&gt;stage1_layer6_residual1</title>
<path fill="none" stroke="black" d="M1490,-3159.43C1490,-3151.34 1490,-3142.76 1490,-3134.14"/>
<polygon fill="black" stroke="black" points="1493.5,-3134.03 1490,-3124.03 1486.5,-3134.03 1493.5,-3134.03"/>
</g>
<!-- stage1_layer6_layernorm2 -->
<g id="node429" class="node">
<title>stage1_layer6_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1693.5,-2951.83 1286.5,-2951.83 1286.5,-2883.83 1693.5,-2883.83 1693.5,-2951.83"/>
<text text-anchor="middle" x="1490" y="-2936.63" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1490" y="-2921.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1490" y="-2906.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1490" y="-2891.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_residual1&#45;&gt;stage1_layer6_layernorm2 -->
<g id="edge471" class="edge">
<title>stage1_layer6_residual1&#45;&gt;stage1_layer6_layernorm2</title>
<path fill="none" stroke="black" d="M1490,-2987.63C1490,-2978.88 1490,-2970.11 1490,-2961.9"/>
<polygon fill="black" stroke="black" points="1493.5,-2961.85 1490,-2951.85 1486.5,-2961.85 1493.5,-2961.85"/>
</g>
<!-- stage1_layer6_expert0_gate -->
<g id="node430" class="node">
<title>stage1_layer6_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="990.5,-2847.83 567.5,-2847.83 567.5,-2779.83 990.5,-2779.83 990.5,-2847.83"/>
<text text-anchor="middle" x="779" y="-2832.63" font-family="Times,serif" font-size="14.00">Expert Gate 232</text>
<text text-anchor="middle" x="779" y="-2817.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="779" y="-2802.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="779" y="-2787.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_layernorm2&#45;&gt;stage1_layer6_expert0_gate -->
<g id="edge472" class="edge">
<title>stage1_layer6_layernorm2&#45;&gt;stage1_layer6_expert0_gate</title>
<path fill="none" stroke="black" d="M1286.26,-2887.6C1196.88,-2874.78 1091.74,-2859.7 1000.43,-2846.6"/>
<polygon fill="black" stroke="black" points="1000.9,-2843.13 990.51,-2845.18 999.91,-2850.06 1000.9,-2843.13"/>
</g>
<!-- stage1_layer6_expert1_gate -->
<g id="node435" class="node">
<title>stage1_layer6_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1475.5,-2847.83 1052.5,-2847.83 1052.5,-2779.83 1475.5,-2779.83 1475.5,-2847.83"/>
<text text-anchor="middle" x="1264" y="-2832.63" font-family="Times,serif" font-size="14.00">Expert Gate 233</text>
<text text-anchor="middle" x="1264" y="-2817.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1264" y="-2802.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1264" y="-2787.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_layernorm2&#45;&gt;stage1_layer6_expert1_gate -->
<g id="edge478" class="edge">
<title>stage1_layer6_layernorm2&#45;&gt;stage1_layer6_expert1_gate</title>
<path fill="none" stroke="black" d="M1416.62,-2883.72C1394.31,-2873.64 1369.63,-2862.51 1346.74,-2852.18"/>
<polygon fill="black" stroke="black" points="1347.95,-2848.88 1337.39,-2847.96 1345.07,-2855.26 1347.95,-2848.88"/>
</g>
<!-- stage1_layer6_expert2_gate -->
<g id="node440" class="node">
<title>stage1_layer6_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1928.5,-2847.83 1505.5,-2847.83 1505.5,-2779.83 1928.5,-2779.83 1928.5,-2847.83"/>
<text text-anchor="middle" x="1717" y="-2832.63" font-family="Times,serif" font-size="14.00">Expert Gate 234</text>
<text text-anchor="middle" x="1717" y="-2817.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1717" y="-2802.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1717" y="-2787.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_layernorm2&#45;&gt;stage1_layer6_expert2_gate -->
<g id="edge484" class="edge">
<title>stage1_layer6_layernorm2&#45;&gt;stage1_layer6_expert2_gate</title>
<path fill="none" stroke="black" d="M1563.7,-2883.72C1586.12,-2873.64 1610.9,-2862.51 1633.89,-2852.18"/>
<polygon fill="black" stroke="black" points="1635.59,-2855.25 1643.28,-2847.96 1632.73,-2848.86 1635.59,-2855.25"/>
</g>
<!-- stage1_layer6_expert3_gate -->
<g id="node445" class="node">
<title>stage1_layer6_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2387.5,-2847.83 1964.5,-2847.83 1964.5,-2779.83 2387.5,-2779.83 2387.5,-2847.83"/>
<text text-anchor="middle" x="2176" y="-2832.63" font-family="Times,serif" font-size="14.00">Expert Gate 235</text>
<text text-anchor="middle" x="2176" y="-2817.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2176" y="-2802.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2176" y="-2787.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_layernorm2&#45;&gt;stage1_layer6_expert3_gate -->
<g id="edge490" class="edge">
<title>stage1_layer6_layernorm2&#45;&gt;stage1_layer6_expert3_gate</title>
<path fill="none" stroke="black" d="M1693.5,-2886.57C1775.58,-2874.37 1870.5,-2860.26 1954.32,-2847.79"/>
<polygon fill="black" stroke="black" points="1954.84,-2851.25 1964.22,-2846.32 1953.82,-2844.33 1954.84,-2851.25"/>
</g>
<!-- stage1_layer6_expert0_mlp1 -->
<g id="node431" class="node">
<title>stage1_layer6_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="958.5,-2743.83 511.5,-2743.83 511.5,-2675.83 958.5,-2675.83 958.5,-2743.83"/>
<text text-anchor="middle" x="735" y="-2728.63" font-family="Times,serif" font-size="14.00">Expert 232 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="735" y="-2713.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="735" y="-2698.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="735" y="-2683.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert0_gate&#45;&gt;stage1_layer6_expert0_mlp1 -->
<g id="edge473" class="edge">
<title>stage1_layer6_expert0_gate&#45;&gt;stage1_layer6_expert0_mlp1</title>
<path fill="none" stroke="black" d="M764.71,-2779.72C761.1,-2771.34 757.17,-2762.23 753.39,-2753.46"/>
<polygon fill="black" stroke="black" points="756.54,-2751.93 749.36,-2744.13 750.11,-2754.7 756.54,-2751.93"/>
</g>
<!-- stage1_layer6_expert0_act -->
<g id="node432" class="node">
<title>stage1_layer6_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="904.5,-2639.83 457.5,-2639.83 457.5,-2571.83 904.5,-2571.83 904.5,-2639.83"/>
<text text-anchor="middle" x="681" y="-2624.63" font-family="Times,serif" font-size="14.00">Expert 232 Activation</text>
<text text-anchor="middle" x="681" y="-2609.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="681" y="-2594.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="681" y="-2579.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert0_mlp1&#45;&gt;stage1_layer6_expert0_act -->
<g id="edge474" class="edge">
<title>stage1_layer6_expert0_mlp1&#45;&gt;stage1_layer6_expert0_act</title>
<path fill="none" stroke="black" d="M717.47,-2675.72C712.99,-2667.25 708.11,-2658.04 703.42,-2649.18"/>
<polygon fill="black" stroke="black" points="706.4,-2647.33 698.63,-2640.13 700.21,-2650.61 706.4,-2647.33"/>
</g>
<!-- stage1_layer6_expert0_mlp2 -->
<g id="node433" class="node">
<title>stage1_layer6_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="835.5,-2535.83 358.5,-2535.83 358.5,-2467.83 835.5,-2467.83 835.5,-2535.83"/>
<text text-anchor="middle" x="597" y="-2520.63" font-family="Times,serif" font-size="14.00">Expert 232 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="597" y="-2505.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="597" y="-2490.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="597" y="-2475.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert0_act&#45;&gt;stage1_layer6_expert0_mlp2 -->
<g id="edge475" class="edge">
<title>stage1_layer6_expert0_act&#45;&gt;stage1_layer6_expert0_mlp2</title>
<path fill="none" stroke="black" d="M653.73,-2571.72C646.47,-2562.9 638.53,-2553.26 630.96,-2544.07"/>
<polygon fill="black" stroke="black" points="633.48,-2541.63 624.42,-2536.13 628.08,-2546.08 633.48,-2541.63"/>
</g>
<!-- stage1_layer6_expert0_reduce -->
<g id="node434" class="node">
<title>stage1_layer6_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="461" cy="-2383.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="461" y="-2402.55" font-family="Times,serif" font-size="14.00">Expert 232 All&#45;Reduce</text>
<text text-anchor="middle" x="461" y="-2387.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="461" y="-2372.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="461" y="-2357.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert0_mlp2&#45;&gt;stage1_layer6_expert0_reduce -->
<g id="edge476" class="edge">
<title>stage1_layer6_expert0_mlp2&#45;&gt;stage1_layer6_expert0_reduce</title>
<path fill="none" stroke="black" d="M558.03,-2467.57C547.15,-2458.28 535.04,-2447.95 523.18,-2437.82"/>
<polygon fill="black" stroke="black" points="525.31,-2435.04 515.43,-2431.21 520.77,-2440.36 525.31,-2435.04"/>
</g>
<!-- stage1_layer6_expert_agg -->
<g id="node450" class="node">
<title>stage1_layer6_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1614.89,-2299.67 910.35,-2299.67 729.11,-2163.67 1433.65,-2163.67 1614.89,-2299.67"/>
<text text-anchor="middle" x="1172" y="-2250.47" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1172" y="-2235.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1172" y="-2220.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1172" y="-2205.47" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert0_reduce&#45;&gt;stage1_layer6_expert_agg -->
<g id="edge477" class="edge">
<title>stage1_layer6_expert0_reduce&#45;&gt;stage1_layer6_expert_agg</title>
<path fill="none" stroke="black" d="M645.49,-2343.81C719.42,-2328.2 806.32,-2309.86 887.96,-2292.62"/>
<polygon fill="black" stroke="black" points="888.83,-2296.02 897.89,-2290.53 887.39,-2289.17 888.83,-2296.02"/>
</g>
<!-- stage1_layer6_expert1_mlp1 -->
<g id="node436" class="node">
<title>stage1_layer6_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1478.5,-2743.83 1031.5,-2743.83 1031.5,-2675.83 1478.5,-2675.83 1478.5,-2743.83"/>
<text text-anchor="middle" x="1255" y="-2728.63" font-family="Times,serif" font-size="14.00">Expert 233 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1255" y="-2713.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1255" y="-2698.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1255" y="-2683.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert1_gate&#45;&gt;stage1_layer6_expert1_mlp1 -->
<g id="edge479" class="edge">
<title>stage1_layer6_expert1_gate&#45;&gt;stage1_layer6_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1261.08,-2779.72C1260.36,-2771.61 1259.59,-2762.81 1258.84,-2754.3"/>
<polygon fill="black" stroke="black" points="1262.3,-2753.79 1257.94,-2744.13 1255.33,-2754.4 1262.3,-2753.79"/>
</g>
<!-- stage1_layer6_expert1_act -->
<g id="node437" class="node">
<title>stage1_layer6_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1454.5,-2639.83 1007.5,-2639.83 1007.5,-2571.83 1454.5,-2571.83 1454.5,-2639.83"/>
<text text-anchor="middle" x="1231" y="-2624.63" font-family="Times,serif" font-size="14.00">Expert 233 Activation</text>
<text text-anchor="middle" x="1231" y="-2609.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1231" y="-2594.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1231" y="-2579.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert1_mlp1&#45;&gt;stage1_layer6_expert1_act -->
<g id="edge480" class="edge">
<title>stage1_layer6_expert1_mlp1&#45;&gt;stage1_layer6_expert1_act</title>
<path fill="none" stroke="black" d="M1247.21,-2675.72C1245.28,-2667.52 1243.19,-2658.62 1241.16,-2650.02"/>
<polygon fill="black" stroke="black" points="1244.53,-2649.06 1238.84,-2640.13 1237.72,-2650.67 1244.53,-2649.06"/>
</g>
<!-- stage1_layer6_expert1_mlp2 -->
<g id="node438" class="node">
<title>stage1_layer6_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1420.5,-2535.83 943.5,-2535.83 943.5,-2467.83 1420.5,-2467.83 1420.5,-2535.83"/>
<text text-anchor="middle" x="1182" y="-2520.63" font-family="Times,serif" font-size="14.00">Expert 233 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1182" y="-2505.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1182" y="-2490.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1182" y="-2475.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert1_act&#45;&gt;stage1_layer6_expert1_mlp2 -->
<g id="edge481" class="edge">
<title>stage1_layer6_expert1_act&#45;&gt;stage1_layer6_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1215.09,-2571.72C1211.03,-2563.25 1206.6,-2554.04 1202.35,-2545.18"/>
<polygon fill="black" stroke="black" points="1205.48,-2543.63 1198,-2536.13 1199.17,-2546.66 1205.48,-2543.63"/>
</g>
<!-- stage1_layer6_expert1_reduce -->
<g id="node439" class="node">
<title>stage1_layer6_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1137" cy="-2383.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1137" y="-2402.55" font-family="Times,serif" font-size="14.00">Expert 233 All&#45;Reduce</text>
<text text-anchor="middle" x="1137" y="-2387.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1137" y="-2372.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1137" y="-2357.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert1_mlp2&#45;&gt;stage1_layer6_expert1_reduce -->
<g id="edge482" class="edge">
<title>stage1_layer6_expert1_mlp2&#45;&gt;stage1_layer6_expert1_reduce</title>
<path fill="none" stroke="black" d="M1169.1,-2467.57C1165.91,-2459.31 1162.39,-2450.24 1158.89,-2441.21"/>
<polygon fill="black" stroke="black" points="1162.14,-2439.92 1155.26,-2431.86 1155.61,-2442.45 1162.14,-2439.92"/>
</g>
<!-- stage1_layer6_expert1_reduce&#45;&gt;stage1_layer6_expert_agg -->
<g id="edge483" class="edge">
<title>stage1_layer6_expert1_reduce&#45;&gt;stage1_layer6_expert_agg</title>
<path fill="none" stroke="black" d="M1147.98,-2335.67C1149.9,-2327.43 1151.95,-2318.66 1154,-2309.85"/>
<polygon fill="black" stroke="black" points="1157.46,-2310.45 1156.32,-2299.91 1150.64,-2308.86 1157.46,-2310.45"/>
</g>
<!-- stage1_layer6_expert2_mlp1 -->
<g id="node441" class="node">
<title>stage1_layer6_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1950.5,-2743.83 1503.5,-2743.83 1503.5,-2675.83 1950.5,-2675.83 1950.5,-2743.83"/>
<text text-anchor="middle" x="1727" y="-2728.63" font-family="Times,serif" font-size="14.00">Expert 234 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1727" y="-2713.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1727" y="-2698.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1727" y="-2683.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert2_gate&#45;&gt;stage1_layer6_expert2_mlp1 -->
<g id="edge485" class="edge">
<title>stage1_layer6_expert2_gate&#45;&gt;stage1_layer6_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1720.25,-2779.72C1721.04,-2771.61 1721.9,-2762.81 1722.74,-2754.3"/>
<polygon fill="black" stroke="black" points="1726.24,-2754.43 1723.74,-2744.13 1719.28,-2753.74 1726.24,-2754.43"/>
</g>
<!-- stage1_layer6_expert2_act -->
<g id="node442" class="node">
<title>stage1_layer6_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1965.5,-2639.83 1518.5,-2639.83 1518.5,-2571.83 1965.5,-2571.83 1965.5,-2639.83"/>
<text text-anchor="middle" x="1742" y="-2624.63" font-family="Times,serif" font-size="14.00">Expert 234 Activation</text>
<text text-anchor="middle" x="1742" y="-2609.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1742" y="-2594.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1742" y="-2579.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert2_mlp1&#45;&gt;stage1_layer6_expert2_act -->
<g id="edge486" class="edge">
<title>stage1_layer6_expert2_mlp1&#45;&gt;stage1_layer6_expert2_act</title>
<path fill="none" stroke="black" d="M1731.87,-2675.72C1733.06,-2667.61 1734.36,-2658.81 1735.61,-2650.3"/>
<polygon fill="black" stroke="black" points="1739.11,-2650.53 1737.1,-2640.13 1732.19,-2649.52 1739.11,-2650.53"/>
</g>
<!-- stage1_layer6_expert2_mlp2 -->
<g id="node443" class="node">
<title>stage1_layer6_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2005.5,-2535.83 1528.5,-2535.83 1528.5,-2467.83 2005.5,-2467.83 2005.5,-2535.83"/>
<text text-anchor="middle" x="1767" y="-2520.63" font-family="Times,serif" font-size="14.00">Expert 234 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1767" y="-2505.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1767" y="-2490.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1767" y="-2475.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert2_act&#45;&gt;stage1_layer6_expert2_mlp2 -->
<g id="edge487" class="edge">
<title>stage1_layer6_expert2_act&#45;&gt;stage1_layer6_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1750.12,-2571.72C1752.13,-2563.52 1754.31,-2554.62 1756.41,-2546.02"/>
<polygon fill="black" stroke="black" points="1759.86,-2546.68 1758.84,-2536.13 1753.06,-2545.01 1759.86,-2546.68"/>
</g>
<!-- stage1_layer6_expert2_reduce -->
<g id="node444" class="node">
<title>stage1_layer6_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1813" cy="-2383.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1813" y="-2402.55" font-family="Times,serif" font-size="14.00">Expert 234 All&#45;Reduce</text>
<text text-anchor="middle" x="1813" y="-2387.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1813" y="-2372.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1813" y="-2357.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert2_mlp2&#45;&gt;stage1_layer6_expert2_reduce -->
<g id="edge488" class="edge">
<title>stage1_layer6_expert2_mlp2&#45;&gt;stage1_layer6_expert2_reduce</title>
<path fill="none" stroke="black" d="M1780.18,-2467.57C1783.45,-2459.31 1787.05,-2450.24 1790.63,-2441.21"/>
<polygon fill="black" stroke="black" points="1793.9,-2442.45 1794.33,-2431.86 1787.39,-2439.87 1793.9,-2442.45"/>
</g>
<!-- stage1_layer6_expert2_reduce&#45;&gt;stage1_layer6_expert_agg -->
<g id="edge489" class="edge">
<title>stage1_layer6_expert2_reduce&#45;&gt;stage1_layer6_expert_agg</title>
<path fill="none" stroke="black" d="M1641.64,-2342.63C1588.25,-2330.13 1527.74,-2315.96 1468.35,-2302.05"/>
<polygon fill="black" stroke="black" points="1468.97,-2298.6 1458.44,-2299.73 1467.38,-2305.42 1468.97,-2298.6"/>
</g>
<!-- stage1_layer6_expert3_mlp1 -->
<g id="node446" class="node">
<title>stage1_layer6_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2426.5,-2743.83 1979.5,-2743.83 1979.5,-2675.83 2426.5,-2675.83 2426.5,-2743.83"/>
<text text-anchor="middle" x="2203" y="-2728.63" font-family="Times,serif" font-size="14.00">Expert 235 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2203" y="-2713.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2203" y="-2698.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2203" y="-2683.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert3_gate&#45;&gt;stage1_layer6_expert3_mlp1 -->
<g id="edge491" class="edge">
<title>stage1_layer6_expert3_gate&#45;&gt;stage1_layer6_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2184.77,-2779.72C2186.94,-2771.52 2189.29,-2762.62 2191.57,-2754.02"/>
<polygon fill="black" stroke="black" points="2195.01,-2754.69 2194.19,-2744.13 2188.24,-2752.9 2195.01,-2754.69"/>
</g>
<!-- stage1_layer6_expert3_act -->
<g id="node447" class="node">
<title>stage1_layer6_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2456.5,-2639.83 2009.5,-2639.83 2009.5,-2571.83 2456.5,-2571.83 2456.5,-2639.83"/>
<text text-anchor="middle" x="2233" y="-2624.63" font-family="Times,serif" font-size="14.00">Expert 235 Activation</text>
<text text-anchor="middle" x="2233" y="-2609.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2233" y="-2594.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2233" y="-2579.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert3_mlp1&#45;&gt;stage1_layer6_expert3_act -->
<g id="edge492" class="edge">
<title>stage1_layer6_expert3_mlp1&#45;&gt;stage1_layer6_expert3_act</title>
<path fill="none" stroke="black" d="M2212.74,-2675.72C2215.18,-2667.43 2217.82,-2658.43 2220.38,-2649.74"/>
<polygon fill="black" stroke="black" points="2223.74,-2650.71 2223.21,-2640.13 2217.03,-2648.74 2223.74,-2650.71"/>
</g>
<!-- stage1_layer6_expert3_mlp2 -->
<g id="node448" class="node">
<title>stage1_layer6_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2636.5,-2535.83 2159.5,-2535.83 2159.5,-2467.83 2636.5,-2467.83 2636.5,-2535.83"/>
<text text-anchor="middle" x="2398" y="-2520.63" font-family="Times,serif" font-size="14.00">Expert 235 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2398" y="-2505.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2398" y="-2490.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2398" y="-2475.63" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert3_act&#45;&gt;stage1_layer6_expert3_mlp2 -->
<g id="edge493" class="edge">
<title>stage1_layer6_expert3_act&#45;&gt;stage1_layer6_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2286.57,-2571.72C2302.21,-2562.05 2319.44,-2551.4 2335.58,-2541.42"/>
<polygon fill="black" stroke="black" points="2337.75,-2544.19 2344.42,-2535.96 2334.07,-2538.24 2337.75,-2544.19"/>
</g>
<!-- stage1_layer6_expert3_reduce -->
<g id="node449" class="node">
<title>stage1_layer6_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2489" cy="-2383.75" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2489" y="-2402.55" font-family="Times,serif" font-size="14.00">Expert 235 All&#45;Reduce</text>
<text text-anchor="middle" x="2489" y="-2387.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2489" y="-2372.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2489" y="-2357.55" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert3_mlp2&#45;&gt;stage1_layer6_expert3_reduce -->
<g id="edge494" class="edge">
<title>stage1_layer6_expert3_mlp2&#45;&gt;stage1_layer6_expert3_reduce</title>
<path fill="none" stroke="black" d="M2424.08,-2467.57C2430.89,-2458.88 2438.41,-2449.28 2445.86,-2439.79"/>
<polygon fill="black" stroke="black" points="2448.65,-2441.89 2452.07,-2431.86 2443.15,-2437.57 2448.65,-2441.89"/>
</g>
<!-- stage1_layer6_expert3_reduce&#45;&gt;stage1_layer6_expert_agg -->
<g id="edge495" class="edge">
<title>stage1_layer6_expert3_reduce&#45;&gt;stage1_layer6_expert_agg</title>
<path fill="none" stroke="black" d="M2257.77,-2349.49C2222.04,-2344.65 2185.55,-2339.89 2151,-2335.67 1966.8,-2313.15 1762.74,-2291.21 1588.8,-2273.4"/>
<polygon fill="black" stroke="black" points="1589.01,-2269.9 1578.7,-2272.37 1588.3,-2276.87 1589.01,-2269.9"/>
</g>
<!-- stage1_layer6_residual2 -->
<g id="node451" class="node">
<title>stage1_layer6_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1614.89,-2127.67 910.35,-2127.67 729.11,-1991.67 1433.65,-1991.67 1614.89,-2127.67"/>
<text text-anchor="middle" x="1172" y="-2078.47" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1172" y="-2063.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1172" y="-2048.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1172" y="-2033.47" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_expert_agg&#45;&gt;stage1_layer6_residual2 -->
<g id="edge496" class="edge">
<title>stage1_layer6_expert_agg&#45;&gt;stage1_layer6_residual2</title>
<path fill="none" stroke="black" d="M1172,-2163.48C1172,-2155.16 1172,-2146.61 1172,-2138.16"/>
<polygon fill="black" stroke="black" points="1175.5,-2137.92 1172,-2127.92 1168.5,-2137.92 1175.5,-2137.92"/>
</g>
<!-- stage1_layer7_layernorm -->
<g id="node452" class="node">
<title>stage1_layer7_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="1375.5,-1944.67 968.5,-1944.67 968.5,-1876.67 1375.5,-1876.67 1375.5,-1944.67"/>
<text text-anchor="middle" x="1172" y="-1929.47" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1172" y="-1914.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1172" y="-1899.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1172" y="-1884.47" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer6_residual2&#45;&gt;stage1_layer7_layernorm -->
<g id="edge497" class="edge">
<title>stage1_layer6_residual2&#45;&gt;stage1_layer7_layernorm</title>
<path fill="none" stroke="black" d="M1172,-1991.62C1172,-1979.21 1172,-1966.56 1172,-1955.09"/>
<polygon fill="black" stroke="black" points="1175.5,-1954.92 1172,-1944.92 1168.5,-1954.92 1175.5,-1954.92"/>
</g>
<!-- stage1_layer7_qkv_proj -->
<g id="node453" class="node">
<title>stage1_layer7_qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="1429.5,-1840.67 914.5,-1840.67 914.5,-1772.67 1429.5,-1772.67 1429.5,-1840.67"/>
<text text-anchor="middle" x="1172" y="-1825.47" font-family="Times,serif" font-size="14.00">QKV Projection (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1172" y="-1810.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1172" y="-1795.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1172" y="-1780.47" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_layernorm&#45;&gt;stage1_layer7_qkv_proj -->
<g id="edge498" class="edge">
<title>stage1_layer7_layernorm&#45;&gt;stage1_layer7_qkv_proj</title>
<path fill="none" stroke="black" d="M1172,-1876.55C1172,-1868.44 1172,-1859.65 1172,-1851.14"/>
<polygon fill="black" stroke="black" points="1175.5,-1850.97 1172,-1840.97 1168.5,-1850.97 1175.5,-1850.97"/>
</g>
<!-- stage1_layer7_qkv_gather -->
<g id="node454" class="node">
<title>stage1_layer7_qkv_gather</title>
<ellipse fill="lightblue" stroke="black" cx="1172" cy="-1688.58" rx="405.76" ry="48.17"/>
<text text-anchor="middle" x="1172" y="-1707.38" font-family="Times,serif" font-size="14.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="1172" y="-1692.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x, shard=8]</text>
<text text-anchor="middle" x="1172" y="-1677.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1172" y="-1662.38" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_qkv_proj&#45;&gt;stage1_layer7_qkv_gather -->
<g id="edge499" class="edge">
<title>stage1_layer7_qkv_proj&#45;&gt;stage1_layer7_qkv_gather</title>
<path fill="none" stroke="black" d="M1172,-1772.4C1172,-1764.41 1172,-1755.64 1172,-1746.9"/>
<polygon fill="black" stroke="black" points="1175.5,-1746.69 1172,-1736.69 1168.5,-1746.69 1175.5,-1746.69"/>
</g>
<!-- stage1_layer7_attention -->
<g id="node455" class="node">
<title>stage1_layer7_attention</title>
<polygon fill="lightgreen" stroke="black" points="1423.5,-1604.5 920.5,-1604.5 920.5,-1536.5 1423.5,-1536.5 1423.5,-1604.5"/>
<text text-anchor="middle" x="1172" y="-1589.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1172" y="-1574.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64, 3x]</text>
<text text-anchor="middle" x="1172" y="-1559.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1172" y="-1544.3" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_qkv_gather&#45;&gt;stage1_layer7_attention -->
<g id="edge500" class="edge">
<title>stage1_layer7_qkv_gather&#45;&gt;stage1_layer7_attention</title>
<path fill="none" stroke="black" d="M1172,-1640.37C1172,-1631.98 1172,-1623.28 1172,-1615.01"/>
<polygon fill="black" stroke="black" points="1175.5,-1614.8 1172,-1604.8 1168.5,-1614.8 1175.5,-1614.8"/>
</g>
<!-- stage1_layer7_attn_out -->
<g id="node456" class="node">
<title>stage1_layer7_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1410.5,-1500.5 933.5,-1500.5 933.5,-1432.5 1410.5,-1432.5 1410.5,-1500.5"/>
<text text-anchor="middle" x="1172" y="-1485.3" font-family="Times,serif" font-size="14.00">Attention Output (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1172" y="-1470.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, heads=16, head_dim=64]</text>
<text text-anchor="middle" x="1172" y="-1455.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1172" y="-1440.3" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_attention&#45;&gt;stage1_layer7_attn_out -->
<g id="edge501" class="edge">
<title>stage1_layer7_attention&#45;&gt;stage1_layer7_attn_out</title>
<path fill="none" stroke="black" d="M1172,-1536.38C1172,-1528.28 1172,-1519.48 1172,-1510.97"/>
<polygon fill="black" stroke="black" points="1175.5,-1510.8 1172,-1500.8 1168.5,-1510.8 1175.5,-1510.8"/>
</g>
<!-- stage1_layer7_attn_reduce -->
<g id="node457" class="node">
<title>stage1_layer7_attn_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1172" cy="-1348.42" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1172" y="-1367.22" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention Output</text>
<text text-anchor="middle" x="1172" y="-1352.22" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1172" y="-1337.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1172" y="-1322.22" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_attn_out&#45;&gt;stage1_layer7_attn_reduce -->
<g id="edge502" class="edge">
<title>stage1_layer7_attn_out&#45;&gt;stage1_layer7_attn_reduce</title>
<path fill="none" stroke="black" d="M1172,-1432.23C1172,-1424.24 1172,-1415.48 1172,-1406.73"/>
<polygon fill="black" stroke="black" points="1175.5,-1406.53 1172,-1396.53 1168.5,-1406.53 1175.5,-1406.53"/>
</g>
<!-- stage1_layer7_residual1 -->
<g id="node458" class="node">
<title>stage1_layer7_residual1</title>
<polygon fill="lightyellow" stroke="black" points="1614.89,-1264.33 910.35,-1264.33 729.11,-1128.33 1433.65,-1128.33 1614.89,-1264.33"/>
<text text-anchor="middle" x="1172" y="-1215.13" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="1172" y="-1200.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1172" y="-1185.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1172" y="-1170.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_attn_reduce&#45;&gt;stage1_layer7_residual1 -->
<g id="edge503" class="edge">
<title>stage1_layer7_attn_reduce&#45;&gt;stage1_layer7_residual1</title>
<path fill="none" stroke="black" d="M1172,-1299.93C1172,-1291.84 1172,-1283.26 1172,-1274.64"/>
<polygon fill="black" stroke="black" points="1175.5,-1274.53 1172,-1264.53 1168.5,-1274.53 1175.5,-1274.53"/>
</g>
<!-- stage1_layer7_layernorm2 -->
<g id="node459" class="node">
<title>stage1_layer7_layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1375.5,-1092.33 968.5,-1092.33 968.5,-1024.33 1375.5,-1024.33 1375.5,-1092.33"/>
<text text-anchor="middle" x="1172" y="-1077.13" font-family="Times,serif" font-size="14.00">LayerNorm 2</text>
<text text-anchor="middle" x="1172" y="-1062.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1172" y="-1047.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1172" y="-1032.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_residual1&#45;&gt;stage1_layer7_layernorm2 -->
<g id="edge504" class="edge">
<title>stage1_layer7_residual1&#45;&gt;stage1_layer7_layernorm2</title>
<path fill="none" stroke="black" d="M1172,-1128.13C1172,-1119.38 1172,-1110.61 1172,-1102.4"/>
<polygon fill="black" stroke="black" points="1175.5,-1102.35 1172,-1092.35 1168.5,-1102.35 1175.5,-1102.35"/>
</g>
<!-- stage1_layer7_expert0_gate -->
<g id="node460" class="node">
<title>stage1_layer7_expert0_gate</title>
<polygon fill="lightgreen" stroke="black" points="924.5,-988.33 501.5,-988.33 501.5,-920.33 924.5,-920.33 924.5,-988.33"/>
<text text-anchor="middle" x="713" y="-973.13" font-family="Times,serif" font-size="14.00">Expert Gate 248</text>
<text text-anchor="middle" x="713" y="-958.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="713" y="-943.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="713" y="-928.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_layernorm2&#45;&gt;stage1_layer7_expert0_gate -->
<g id="edge505" class="edge">
<title>stage1_layer7_layernorm2&#45;&gt;stage1_layer7_expert0_gate</title>
<path fill="none" stroke="black" d="M1023.29,-1024.29C974.81,-1013.51 920.81,-1001.51 871.63,-990.58"/>
<polygon fill="black" stroke="black" points="872.38,-987.17 861.86,-988.41 870.87,-994 872.38,-987.17"/>
</g>
<!-- stage1_layer7_expert1_gate -->
<g id="node465" class="node">
<title>stage1_layer7_expert1_gate</title>
<polygon fill="lightgreen" stroke="black" points="1377.5,-988.33 954.5,-988.33 954.5,-920.33 1377.5,-920.33 1377.5,-988.33"/>
<text text-anchor="middle" x="1166" y="-973.13" font-family="Times,serif" font-size="14.00">Expert Gate 249</text>
<text text-anchor="middle" x="1166" y="-958.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1166" y="-943.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1166" y="-928.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_layernorm2&#45;&gt;stage1_layer7_expert1_gate -->
<g id="edge511" class="edge">
<title>stage1_layer7_layernorm2&#45;&gt;stage1_layer7_expert1_gate</title>
<path fill="none" stroke="black" d="M1170.05,-1024.22C1169.58,-1016.11 1169.06,-1007.32 1168.56,-998.81"/>
<polygon fill="black" stroke="black" points="1172.04,-998.41 1167.96,-988.63 1165.05,-998.82 1172.04,-998.41"/>
</g>
<!-- stage1_layer7_expert2_gate -->
<g id="node470" class="node">
<title>stage1_layer7_expert2_gate</title>
<polygon fill="lightgreen" stroke="black" points="1830.5,-988.33 1407.5,-988.33 1407.5,-920.33 1830.5,-920.33 1830.5,-988.33"/>
<text text-anchor="middle" x="1619" y="-973.13" font-family="Times,serif" font-size="14.00">Expert Gate 250</text>
<text text-anchor="middle" x="1619" y="-958.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1619" y="-943.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="1619" y="-928.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_layernorm2&#45;&gt;stage1_layer7_expert2_gate -->
<g id="edge517" class="edge">
<title>stage1_layer7_layernorm2&#45;&gt;stage1_layer7_expert2_gate</title>
<path fill="none" stroke="black" d="M1316.82,-1024.29C1363.94,-1013.54 1416.4,-1001.56 1464.22,-990.65"/>
<polygon fill="black" stroke="black" points="1465.06,-994.05 1474.03,-988.41 1463.5,-987.23 1465.06,-994.05"/>
</g>
<!-- stage1_layer7_expert3_gate -->
<g id="node475" class="node">
<title>stage1_layer7_expert3_gate</title>
<polygon fill="lightgreen" stroke="black" points="2289.5,-988.33 1866.5,-988.33 1866.5,-920.33 2289.5,-920.33 2289.5,-988.33"/>
<text text-anchor="middle" x="2078" y="-973.13" font-family="Times,serif" font-size="14.00">Expert Gate 251</text>
<text text-anchor="middle" x="2078" y="-958.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2078" y="-943.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, num_experts=1]</text>
<text text-anchor="middle" x="2078" y="-928.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_layernorm2&#45;&gt;stage1_layer7_expert3_gate -->
<g id="edge523" class="edge">
<title>stage1_layer7_layernorm2&#45;&gt;stage1_layer7_expert3_gate</title>
<path fill="none" stroke="black" d="M1375.75,-1038.15C1508.16,-1025.22 1684.47,-1007.14 1840,-988.33 1845.24,-987.7 1850.54,-987.05 1855.88,-986.38"/>
<polygon fill="black" stroke="black" points="1856.72,-989.8 1866.21,-985.08 1855.85,-982.86 1856.72,-989.8"/>
</g>
<!-- stage1_layer7_expert0_mlp1 -->
<g id="node461" class="node">
<title>stage1_layer7_expert0_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="898.5,-884.33 451.5,-884.33 451.5,-816.33 898.5,-816.33 898.5,-884.33"/>
<text text-anchor="middle" x="675" y="-869.13" font-family="Times,serif" font-size="14.00">Expert 248 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="675" y="-854.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="675" y="-839.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="675" y="-824.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert0_gate&#45;&gt;stage1_layer7_expert0_mlp1 -->
<g id="edge506" class="edge">
<title>stage1_layer7_expert0_gate&#45;&gt;stage1_layer7_expert0_mlp1</title>
<path fill="none" stroke="black" d="M700.66,-920.22C697.58,-911.93 694.22,-902.93 690.99,-894.24"/>
<polygon fill="black" stroke="black" points="694.18,-892.78 687.41,-884.63 687.62,-895.23 694.18,-892.78"/>
</g>
<!-- stage1_layer7_expert0_act -->
<g id="node462" class="node">
<title>stage1_layer7_expert0_act</title>
<polygon fill="lightgreen" stroke="black" points="778.5,-780.33 331.5,-780.33 331.5,-712.33 778.5,-712.33 778.5,-780.33"/>
<text text-anchor="middle" x="555" y="-765.13" font-family="Times,serif" font-size="14.00">Expert 248 Activation</text>
<text text-anchor="middle" x="555" y="-750.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="555" y="-735.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="555" y="-720.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert0_mlp1&#45;&gt;stage1_layer7_expert0_act -->
<g id="edge507" class="edge">
<title>stage1_layer7_expert0_mlp1&#45;&gt;stage1_layer7_expert0_act</title>
<path fill="none" stroke="black" d="M636.04,-816.22C625.14,-806.95 613.18,-796.79 601.88,-787.18"/>
<polygon fill="black" stroke="black" points="604.06,-784.44 594.18,-780.63 599.53,-789.78 604.06,-784.44"/>
</g>
<!-- stage1_layer7_expert0_mlp2 -->
<g id="node463" class="node">
<title>stage1_layer7_expert0_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="696.5,-676.33 219.5,-676.33 219.5,-608.33 696.5,-608.33 696.5,-676.33"/>
<text text-anchor="middle" x="458" y="-661.13" font-family="Times,serif" font-size="14.00">Expert 248 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="458" y="-646.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="458" y="-631.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="458" y="-616.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert0_act&#45;&gt;stage1_layer7_expert0_mlp2 -->
<g id="edge508" class="edge">
<title>stage1_layer7_expert0_act&#45;&gt;stage1_layer7_expert0_mlp2</title>
<path fill="none" stroke="black" d="M523.51,-712.22C514.95,-703.22 505.59,-693.37 496.68,-684.01"/>
<polygon fill="black" stroke="black" points="499.09,-681.47 489.67,-676.63 494.02,-686.29 499.09,-681.47"/>
</g>
<!-- stage1_layer7_expert0_reduce -->
<g id="node464" class="node">
<title>stage1_layer7_expert0_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="345" cy="-524.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="345" y="-543.05" font-family="Times,serif" font-size="14.00">Expert 248 All&#45;Reduce</text>
<text text-anchor="middle" x="345" y="-528.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="345" y="-513.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-498.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert0_mlp2&#45;&gt;stage1_layer7_expert0_reduce -->
<g id="edge509" class="edge">
<title>stage1_layer7_expert0_mlp2&#45;&gt;stage1_layer7_expert0_reduce</title>
<path fill="none" stroke="black" d="M425.62,-608.07C416.89,-599.1 407.21,-589.16 397.68,-579.37"/>
<polygon fill="black" stroke="black" points="399.92,-576.65 390.44,-571.93 394.9,-581.53 399.92,-576.65"/>
</g>
<!-- stage1_layer7_expert_agg -->
<g id="node480" class="node">
<title>stage1_layer7_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1801.89,-440.17 1097.35,-440.17 916.11,-304.17 1620.65,-304.17 1801.89,-440.17"/>
<text text-anchor="middle" x="1359" y="-390.97" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1359" y="-375.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x4)</text>
<text text-anchor="middle" x="1359" y="-360.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1359" y="-345.97" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert0_reduce&#45;&gt;stage1_layer7_expert_agg -->
<g id="edge510" class="edge">
<title>stage1_layer7_expert0_reduce&#45;&gt;stage1_layer7_expert_agg</title>
<path fill="none" stroke="black" d="M572.88,-489.52C715.45,-468.42 900.79,-440.99 1055.71,-418.06"/>
<polygon fill="black" stroke="black" points="1056.49,-421.48 1065.87,-416.55 1055.46,-414.56 1056.49,-421.48"/>
</g>
<!-- stage1_layer7_expert1_mlp1 -->
<g id="node466" class="node">
<title>stage1_layer7_expert1_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1378.5,-884.33 931.5,-884.33 931.5,-816.33 1378.5,-816.33 1378.5,-884.33"/>
<text text-anchor="middle" x="1155" y="-869.13" font-family="Times,serif" font-size="14.00">Expert 249 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1155" y="-854.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1155" y="-839.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1155" y="-824.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert1_gate&#45;&gt;stage1_layer7_expert1_mlp1 -->
<g id="edge512" class="edge">
<title>stage1_layer7_expert1_gate&#45;&gt;stage1_layer7_expert1_mlp1</title>
<path fill="none" stroke="black" d="M1162.43,-920.22C1161.55,-912.11 1160.61,-903.32 1159.69,-894.81"/>
<polygon fill="black" stroke="black" points="1163.14,-894.2 1158.59,-884.63 1156.18,-894.95 1163.14,-894.2"/>
</g>
<!-- stage1_layer7_expert1_act -->
<g id="node467" class="node">
<title>stage1_layer7_expert1_act</title>
<polygon fill="lightgreen" stroke="black" points="1356.5,-780.33 909.5,-780.33 909.5,-712.33 1356.5,-712.33 1356.5,-780.33"/>
<text text-anchor="middle" x="1133" y="-765.13" font-family="Times,serif" font-size="14.00">Expert 249 Activation</text>
<text text-anchor="middle" x="1133" y="-750.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1133" y="-735.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1133" y="-720.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert1_mlp1&#45;&gt;stage1_layer7_expert1_act -->
<g id="edge513" class="edge">
<title>stage1_layer7_expert1_mlp1&#45;&gt;stage1_layer7_expert1_act</title>
<path fill="none" stroke="black" d="M1147.86,-816.22C1146.09,-808.02 1144.17,-799.12 1142.32,-790.52"/>
<polygon fill="black" stroke="black" points="1145.71,-789.67 1140.18,-780.63 1138.87,-791.15 1145.71,-789.67"/>
</g>
<!-- stage1_layer7_expert1_mlp2 -->
<g id="node468" class="node">
<title>stage1_layer7_expert1_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1326.5,-676.33 849.5,-676.33 849.5,-608.33 1326.5,-608.33 1326.5,-676.33"/>
<text text-anchor="middle" x="1088" y="-661.13" font-family="Times,serif" font-size="14.00">Expert 249 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1088" y="-646.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1088" y="-631.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1088" y="-616.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert1_act&#45;&gt;stage1_layer7_expert1_mlp2 -->
<g id="edge514" class="edge">
<title>stage1_layer7_expert1_act&#45;&gt;stage1_layer7_expert1_mlp2</title>
<path fill="none" stroke="black" d="M1118.39,-712.22C1114.7,-703.84 1110.68,-694.73 1106.81,-685.96"/>
<polygon fill="black" stroke="black" points="1109.93,-684.37 1102.69,-676.63 1103.53,-687.19 1109.93,-684.37"/>
</g>
<!-- stage1_layer7_expert1_reduce -->
<g id="node469" class="node">
<title>stage1_layer7_expert1_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1021" cy="-524.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1021" y="-543.05" font-family="Times,serif" font-size="14.00">Expert 249 All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-528.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1021" y="-513.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1021" y="-498.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert1_mlp2&#45;&gt;stage1_layer7_expert1_reduce -->
<g id="edge515" class="edge">
<title>stage1_layer7_expert1_mlp2&#45;&gt;stage1_layer7_expert1_reduce</title>
<path fill="none" stroke="black" d="M1068.8,-608.07C1063.94,-599.64 1058.58,-590.35 1053.26,-581.14"/>
<polygon fill="black" stroke="black" points="1056.22,-579.27 1048.19,-572.36 1050.16,-582.77 1056.22,-579.27"/>
</g>
<!-- stage1_layer7_expert1_reduce&#45;&gt;stage1_layer7_expert_agg -->
<g id="edge516" class="edge">
<title>stage1_layer7_expert1_reduce&#45;&gt;stage1_layer7_expert_agg</title>
<path fill="none" stroke="black" d="M1121.95,-478.42C1146.14,-467.68 1172.56,-455.95 1198.7,-444.34"/>
<polygon fill="black" stroke="black" points="1200.21,-447.5 1207.93,-440.25 1197.37,-441.11 1200.21,-447.5"/>
</g>
<!-- stage1_layer7_expert2_mlp1 -->
<g id="node471" class="node">
<title>stage1_layer7_expert2_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="1873.5,-884.33 1426.5,-884.33 1426.5,-816.33 1873.5,-816.33 1873.5,-884.33"/>
<text text-anchor="middle" x="1650" y="-869.13" font-family="Times,serif" font-size="14.00">Expert 250 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="1650" y="-854.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1650" y="-839.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1650" y="-824.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert2_gate&#45;&gt;stage1_layer7_expert2_mlp1 -->
<g id="edge518" class="edge">
<title>stage1_layer7_expert2_gate&#45;&gt;stage1_layer7_expert2_mlp1</title>
<path fill="none" stroke="black" d="M1629.06,-920.22C1631.58,-911.93 1634.32,-902.93 1636.96,-894.24"/>
<polygon fill="black" stroke="black" points="1640.32,-895.22 1639.88,-884.63 1633.62,-893.18 1640.32,-895.22"/>
</g>
<!-- stage1_layer7_expert2_act -->
<g id="node472" class="node">
<title>stage1_layer7_expert2_act</title>
<polygon fill="lightgreen" stroke="black" points="1911.5,-780.33 1464.5,-780.33 1464.5,-712.33 1911.5,-712.33 1911.5,-780.33"/>
<text text-anchor="middle" x="1688" y="-765.13" font-family="Times,serif" font-size="14.00">Expert 250 Activation</text>
<text text-anchor="middle" x="1688" y="-750.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1688" y="-735.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1688" y="-720.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert2_mlp1&#45;&gt;stage1_layer7_expert2_act -->
<g id="edge519" class="edge">
<title>stage1_layer7_expert2_mlp1&#45;&gt;stage1_layer7_expert2_act</title>
<path fill="none" stroke="black" d="M1662.34,-816.22C1665.42,-807.93 1668.78,-798.93 1672.01,-790.24"/>
<polygon fill="black" stroke="black" points="1675.38,-791.23 1675.59,-780.63 1668.82,-788.78 1675.38,-791.23"/>
</g>
<!-- stage1_layer7_expert2_mlp2 -->
<g id="node473" class="node">
<title>stage1_layer7_expert2_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="1931.5,-676.33 1454.5,-676.33 1454.5,-608.33 1931.5,-608.33 1931.5,-676.33"/>
<text text-anchor="middle" x="1693" y="-661.13" font-family="Times,serif" font-size="14.00">Expert 250 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="1693" y="-646.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="1693" y="-631.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1693" y="-616.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert2_act&#45;&gt;stage1_layer7_expert2_mlp2 -->
<g id="edge520" class="edge">
<title>stage1_layer7_expert2_act&#45;&gt;stage1_layer7_expert2_mlp2</title>
<path fill="none" stroke="black" d="M1689.62,-712.22C1690.02,-704.11 1690.45,-695.32 1690.87,-686.81"/>
<polygon fill="black" stroke="black" points="1694.37,-686.79 1691.37,-676.63 1687.38,-686.45 1694.37,-686.79"/>
</g>
<!-- stage1_layer7_expert2_reduce -->
<g id="node474" class="node">
<title>stage1_layer7_expert2_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="1697" cy="-524.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="1697" y="-543.05" font-family="Times,serif" font-size="14.00">Expert 250 All&#45;Reduce</text>
<text text-anchor="middle" x="1697" y="-528.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="1697" y="-513.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1697" y="-498.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert2_mlp2&#45;&gt;stage1_layer7_expert2_reduce -->
<g id="edge521" class="edge">
<title>stage1_layer7_expert2_mlp2&#45;&gt;stage1_layer7_expert2_reduce</title>
<path fill="none" stroke="black" d="M1694.15,-608.07C1694.42,-600.07 1694.72,-591.31 1695.03,-582.57"/>
<polygon fill="black" stroke="black" points="1698.53,-582.47 1695.38,-572.36 1691.53,-582.23 1698.53,-582.47"/>
</g>
<!-- stage1_layer7_expert2_reduce&#45;&gt;stage1_layer7_expert_agg -->
<g id="edge522" class="edge">
<title>stage1_layer7_expert2_reduce&#45;&gt;stage1_layer7_expert_agg</title>
<path fill="none" stroke="black" d="M1596.05,-478.42C1571.86,-467.68 1545.44,-455.95 1519.3,-444.34"/>
<polygon fill="black" stroke="black" points="1520.63,-441.11 1510.07,-440.25 1517.79,-447.5 1520.63,-441.11"/>
</g>
<!-- stage1_layer7_expert3_mlp1 -->
<g id="node476" class="node">
<title>stage1_layer7_expert3_mlp1</title>
<polygon fill="lightgreen" stroke="black" points="2353.5,-884.33 1906.5,-884.33 1906.5,-816.33 2353.5,-816.33 2353.5,-884.33"/>
<text text-anchor="middle" x="2130" y="-869.13" font-family="Times,serif" font-size="14.00">Expert 251 MLP1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="2130" y="-854.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2130" y="-839.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2130" y="-824.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert3_gate&#45;&gt;stage1_layer7_expert3_mlp1 -->
<g id="edge524" class="edge">
<title>stage1_layer7_expert3_gate&#45;&gt;stage1_layer7_expert3_mlp1</title>
<path fill="none" stroke="black" d="M2094.88,-920.22C2099.2,-911.75 2103.89,-902.54 2108.41,-893.68"/>
<polygon fill="black" stroke="black" points="2111.6,-895.13 2113.02,-884.63 2105.36,-891.95 2111.6,-895.13"/>
</g>
<!-- stage1_layer7_expert3_act -->
<g id="node477" class="node">
<title>stage1_layer7_expert3_act</title>
<polygon fill="lightgreen" stroke="black" points="2413.5,-780.33 1966.5,-780.33 1966.5,-712.33 2413.5,-712.33 2413.5,-780.33"/>
<text text-anchor="middle" x="2190" y="-765.13" font-family="Times,serif" font-size="14.00">Expert 251 Activation</text>
<text text-anchor="middle" x="2190" y="-750.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2190" y="-735.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2190" y="-720.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert3_mlp1&#45;&gt;stage1_layer7_expert3_act -->
<g id="edge525" class="edge">
<title>stage1_layer7_expert3_mlp1&#45;&gt;stage1_layer7_expert3_act</title>
<path fill="none" stroke="black" d="M2149.48,-816.22C2154.51,-807.67 2159.99,-798.35 2165.25,-789.41"/>
<polygon fill="black" stroke="black" points="2168.36,-791.03 2170.41,-780.63 2162.33,-787.48 2168.36,-791.03"/>
</g>
<!-- stage1_layer7_expert3_mlp2 -->
<g id="node478" class="node">
<title>stage1_layer7_expert3_mlp2</title>
<polygon fill="lightgreen" stroke="black" points="2516.5,-676.33 2039.5,-676.33 2039.5,-608.33 2516.5,-608.33 2516.5,-676.33"/>
<text text-anchor="middle" x="2278" y="-661.13" font-family="Times,serif" font-size="14.00">Expert 251 MLP2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="2278" y="-646.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, ffn=2048, shard=8]</text>
<text text-anchor="middle" x="2278" y="-631.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2278" y="-616.13" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert3_act&#45;&gt;stage1_layer7_expert3_mlp2 -->
<g id="edge526" class="edge">
<title>stage1_layer7_expert3_act&#45;&gt;stage1_layer7_expert3_mlp2</title>
<path fill="none" stroke="black" d="M2218.57,-712.22C2226.26,-703.31 2234.66,-693.57 2242.66,-684.29"/>
<polygon fill="black" stroke="black" points="2245.39,-686.49 2249.27,-676.63 2240.09,-681.92 2245.39,-686.49"/>
</g>
<!-- stage1_layer7_expert3_reduce -->
<g id="node479" class="node">
<title>stage1_layer7_expert3_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="2373" cy="-524.25" rx="328.61" ry="48.17"/>
<text text-anchor="middle" x="2373" y="-543.05" font-family="Times,serif" font-size="14.00">Expert 251 All&#45;Reduce</text>
<text text-anchor="middle" x="2373" y="-528.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024, shard=8]</text>
<text text-anchor="middle" x="2373" y="-513.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="2373" y="-498.05" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert3_mlp2&#45;&gt;stage1_layer7_expert3_reduce -->
<g id="edge527" class="edge">
<title>stage1_layer7_expert3_mlp2&#45;&gt;stage1_layer7_expert3_reduce</title>
<path fill="none" stroke="black" d="M2305.22,-608.07C2312.33,-599.38 2320.19,-589.78 2327.96,-580.29"/>
<polygon fill="black" stroke="black" points="2330.82,-582.31 2334.45,-572.36 2325.4,-577.88 2330.82,-582.31"/>
</g>
<!-- stage1_layer7_expert3_reduce&#45;&gt;stage1_layer7_expert_agg -->
<g id="edge528" class="edge">
<title>stage1_layer7_expert3_reduce&#45;&gt;stage1_layer7_expert_agg</title>
<path fill="none" stroke="black" d="M2145.12,-489.52C2045.82,-474.82 1925.77,-457.06 1809.7,-439.88"/>
<polygon fill="black" stroke="black" points="1809.97,-436.38 1799.57,-438.38 1808.95,-443.3 1809.97,-436.38"/>
</g>
<!-- stage1_layer7_residual2 -->
<g id="node481" class="node">
<title>stage1_layer7_residual2</title>
<polygon fill="lightyellow" stroke="black" points="1801.89,-268.17 1097.35,-268.17 916.11,-132.17 1620.65,-132.17 1801.89,-268.17"/>
<text text-anchor="middle" x="1359" y="-218.97" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1359" y="-203.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024] (x2)</text>
<text text-anchor="middle" x="1359" y="-188.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1359" y="-173.97" font-family="Times,serif" font-size="14.00">GPU: [8, 9, 10, 11, 12, 13, 14, 15]</text>
</g>
<!-- stage1_layer7_expert_agg&#45;&gt;stage1_layer7_residual2 -->
<g id="edge529" class="edge">
<title>stage1_layer7_expert_agg&#45;&gt;stage1_layer7_residual2</title>
<path fill="none" stroke="black" d="M1359,-303.98C1359,-295.66 1359,-287.11 1359,-278.66"/>
<polygon fill="black" stroke="black" points="1362.5,-278.42 1359,-268.42 1355.5,-278.42 1362.5,-278.42"/>
</g>
<!-- output -->
<g id="node483" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="1359" cy="-48.08" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="1359" y="-66.88" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="1359" y="-51.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1359" y="-36.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=128, hidden=1024]</text>
<text text-anchor="middle" x="1359" y="-21.88" font-family="Times,serif" font-size="14.00">GPU: All</text>
</g>
<!-- stage1_layer7_residual2&#45;&gt;output -->
<g id="edge530" class="edge">
<title>stage1_layer7_residual2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1359,-132.03C1359,-123.48 1359,-114.8 1359,-106.43"/>
<polygon fill="black" stroke="black" points="1362.5,-106.4 1359,-96.4 1355.5,-106.4 1362.5,-106.4"/>
</g>
<!-- pipeline_stage0_to_1&#45;&gt;stage1_layer0_layernorm -->
<g id="edge266" class="edge">
<title>pipeline_stage0_to_1&#45;&gt;stage1_layer0_layernorm</title>
<path fill="none" stroke="black" d="M1341,-14999.91C1341,-14990.71 1341,-14980.74 1341,-14971.26"/>
<polygon fill="black" stroke="black" points="1344.5,-14971.21 1341,-14961.21 1337.5,-14971.21 1344.5,-14971.21"/>
</g>
</g>
</svg>
