<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Tensor_Parallel_DAG Pages: 1 -->
<svg width="14273pt" height="10441pt"
 viewBox="0.00 0.00 14272.76 10440.83" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 10436.83)">
<title>Tensor_Parallel_DAG</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-10436.83 14268.76,-10436.83 14268.76,4 -4,4"/>
<!-- tp_input -->
<g id="node1" class="node">
<title>tp_input</title>
<ellipse fill="lightblue" stroke="black" cx="10455.26" cy="-10384.75" rx="252.37" ry="48.17"/>
<text text-anchor="middle" x="10455.26" y="-10403.55" font-family="Times,serif" font-size="14.00">Model Input</text>
<text text-anchor="middle" x="10455.26" y="-10388.55" font-family="Times,serif" font-size="14.00">Input: Raw tokens</text>
<text text-anchor="middle" x="10455.26" y="-10373.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048]</text>
<text text-anchor="middle" x="10455.26" y="-10358.55" font-family="Times,serif" font-size="14.00">GPU: CPU</text>
</g>
<!-- tp_embed -->
<g id="node2" class="node">
<title>tp_embed</title>
<polygon fill="lightyellow" stroke="black" points="10703.76,-10250.66 10206.76,-10250.66 10206.76,-10182.66 10703.76,-10182.66 10703.76,-10250.66"/>
<text text-anchor="middle" x="10455.26" y="-10235.46" font-family="Times,serif" font-size="14.00">Token + Position Embedding</text>
<text text-anchor="middle" x="10455.26" y="-10220.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048]</text>
<text text-anchor="middle" x="10455.26" y="-10205.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10455.26" y="-10190.46" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_input&#45;&gt;tp_embed -->
<g id="edge1" class="edge">
<title>tp_input&#45;&gt;tp_embed</title>
<path fill="none" stroke="black" d="M10455.26,-10336.58C10455.26,-10336.58 10455.26,-10260.69 10455.26,-10260.69"/>
<polygon fill="black" stroke="black" points="10458.76,-10260.69 10455.26,-10250.69 10451.76,-10260.69 10458.76,-10260.69"/>
</g>
<!-- tp_layer0_norm -->
<g id="node3" class="node">
<title>tp_layer0_norm</title>
<polygon fill="lightyellow" stroke="black" points="7459.76,-10096.66 6962.76,-10096.66 6962.76,-10028.66 7459.76,-10028.66 7459.76,-10096.66"/>
<text text-anchor="middle" x="7211.26" y="-10081.46" font-family="Times,serif" font-size="14.00">Layer Norm</text>
<text text-anchor="middle" x="7211.26" y="-10066.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7211.26" y="-10051.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7211.26" y="-10036.46" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_embed&#45;&gt;tp_layer0_norm -->
<g id="edge2" class="edge">
<title>tp_embed&#45;&gt;tp_layer0_norm</title>
<path fill="none" stroke="black" d="M10231.76,-10182.66C10231.76,-10145.44 10231.76,-10091 10231.76,-10091 10231.76,-10091 7470.05,-10091 7470.05,-10091"/>
<polygon fill="black" stroke="black" points="7470.05,-10087.5 7460.05,-10091 7470.05,-10094.5 7470.05,-10087.5"/>
</g>
<!-- tp_layer0_attn_residual -->
<g id="node85" class="node">
<title>tp_layer0_attn_residual</title>
<ellipse fill="lightblue" stroke="black" cx="10673.26" cy="-8703.91" rx="646.09" ry="48.17"/>
<text text-anchor="middle" x="10673.26" y="-8722.71" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="10673.26" y="-8707.71" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096], [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10673.26" y="-8692.71" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10673.26" y="-8677.71" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_embed&#45;&gt;tp_layer0_attn_residual -->
<g id="edge107" class="edge">
<title>tp_embed&#45;&gt;tp_layer0_attn_residual</title>
<path fill="none" stroke="black" d="M10703.89,-10216C10778.72,-10216 10841.38,-10216 10841.38,-10216 10841.38,-10216 10841.38,-9599 10841.38,-9599 10841.38,-9599 10313.14,-9599 10313.14,-9599 10313.14,-9599 10313.14,-8754.11 10313.14,-8754.11"/>
<polygon fill="black" stroke="black" points="10316.64,-8754.11 10313.14,-8744.11 10309.64,-8754.11 10316.64,-8754.11"/>
</g>
<!-- tp_layer0_q_proj_gpu0 -->
<g id="node4" class="node">
<title>tp_layer0_q_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="750.76,-9942.66 249.76,-9942.66 249.76,-9874.66 750.76,-9874.66 750.76,-9942.66"/>
<text text-anchor="middle" x="500.26" y="-9927.46" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="500.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="500.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="500.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu0 -->
<g id="edge3" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu0</title>
<path fill="none" stroke="black" d="M6962.7,-10091C5748.63,-10091 500.26,-10091 500.26,-10091 500.26,-10091 500.26,-9952.96 500.26,-9952.96"/>
<polygon fill="black" stroke="black" points="503.76,-9952.96 500.26,-9942.96 496.76,-9952.96 503.76,-9952.96"/>
</g>
<!-- tp_layer0_k_proj_gpu0 -->
<g id="node5" class="node">
<title>tp_layer0_k_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="1312.76,-9942.66 811.76,-9942.66 811.76,-9874.66 1312.76,-9874.66 1312.76,-9942.66"/>
<text text-anchor="middle" x="1062.26" y="-9927.46" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="1062.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="1062.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1062.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu0 -->
<g id="edge4" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu0</title>
<path fill="none" stroke="black" d="M6962.6,-10086C5812.22,-10086 1062.26,-10086 1062.26,-10086 1062.26,-10086 1062.26,-9952.86 1062.26,-9952.86"/>
<polygon fill="black" stroke="black" points="1065.76,-9952.86 1062.26,-9942.86 1058.76,-9952.86 1065.76,-9952.86"/>
</g>
<!-- tp_layer0_v_proj_gpu0 -->
<g id="node6" class="node">
<title>tp_layer0_v_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="1871.76,-9942.66 1370.76,-9942.66 1370.76,-9874.66 1871.76,-9874.66 1871.76,-9942.66"/>
<text text-anchor="middle" x="1621.26" y="-9927.46" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="1621.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="1621.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1621.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu0 -->
<g id="edge5" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu0</title>
<path fill="none" stroke="black" d="M6962.49,-10080C5878.45,-10080 1621.26,-10080 1621.26,-10080 1621.26,-10080 1621.26,-9952.92 1621.26,-9952.92"/>
<polygon fill="black" stroke="black" points="1624.76,-9952.92 1621.26,-9942.92 1617.76,-9952.92 1624.76,-9952.92"/>
</g>
<!-- tp_layer0_q_proj_gpu1 -->
<g id="node14" class="node">
<title>tp_layer0_q_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="2430.76,-9942.66 1929.76,-9942.66 1929.76,-9874.66 2430.76,-9874.66 2430.76,-9942.66"/>
<text text-anchor="middle" x="2180.26" y="-9927.46" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="2180.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="2180.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2180.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu1 -->
<g id="edge15" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu1</title>
<path fill="none" stroke="black" d="M6962.63,-10075C5948.75,-10075 2180.26,-10075 2180.26,-10075 2180.26,-10075 2180.26,-9952.72 2180.26,-9952.72"/>
<polygon fill="black" stroke="black" points="2183.76,-9952.72 2180.26,-9942.72 2176.76,-9952.72 2183.76,-9952.72"/>
</g>
<!-- tp_layer0_k_proj_gpu1 -->
<g id="node15" class="node">
<title>tp_layer0_k_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="2989.76,-9942.66 2488.76,-9942.66 2488.76,-9874.66 2989.76,-9874.66 2989.76,-9942.66"/>
<text text-anchor="middle" x="2739.26" y="-9927.46" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="2739.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="2739.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2739.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu1 -->
<g id="edge16" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu1</title>
<path fill="none" stroke="black" d="M6962.45,-10070C6022.27,-10070 2739.26,-10070 2739.26,-10070 2739.26,-10070 2739.26,-9952.88 2739.26,-9952.88"/>
<polygon fill="black" stroke="black" points="2742.76,-9952.88 2739.26,-9942.88 2735.76,-9952.88 2742.76,-9952.88"/>
</g>
<!-- tp_layer0_v_proj_gpu1 -->
<g id="node16" class="node">
<title>tp_layer0_v_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="3548.76,-9942.66 3047.76,-9942.66 3047.76,-9874.66 3548.76,-9874.66 3548.76,-9942.66"/>
<text text-anchor="middle" x="3298.26" y="-9927.46" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="3298.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="3298.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3298.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu1 -->
<g id="edge17" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu1</title>
<path fill="none" stroke="black" d="M6962.4,-10065C6100.93,-10065 3298.26,-10065 3298.26,-10065 3298.26,-10065 3298.26,-9952.97 3298.26,-9952.97"/>
<polygon fill="black" stroke="black" points="3301.76,-9952.97 3298.26,-9942.97 3294.76,-9952.97 3301.76,-9952.97"/>
</g>
<!-- tp_layer0_q_proj_gpu2 -->
<g id="node24" class="node">
<title>tp_layer0_q_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="4107.76,-9942.66 3606.76,-9942.66 3606.76,-9874.66 4107.76,-9874.66 4107.76,-9942.66"/>
<text text-anchor="middle" x="3857.26" y="-9927.46" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="3857.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="3857.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3857.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu2 -->
<g id="edge27" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu2</title>
<path fill="none" stroke="black" d="M6962.59,-10060C6185.97,-10060 3857.26,-10060 3857.26,-10060 3857.26,-10060 3857.26,-9953 3857.26,-9953"/>
<polygon fill="black" stroke="black" points="3860.76,-9953 3857.26,-9943 3853.76,-9953 3860.76,-9953"/>
</g>
<!-- tp_layer0_k_proj_gpu2 -->
<g id="node25" class="node">
<title>tp_layer0_k_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="4666.76,-9942.66 4165.76,-9942.66 4165.76,-9874.66 4666.76,-9874.66 4666.76,-9942.66"/>
<text text-anchor="middle" x="4416.26" y="-9927.46" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="4416.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4416.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4416.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu2 -->
<g id="edge28" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu2</title>
<path fill="none" stroke="black" d="M6962.61,-10054C6278.07,-10054 4416.26,-10054 4416.26,-10054 4416.26,-10054 4416.26,-9952.74 4416.26,-9952.74"/>
<polygon fill="black" stroke="black" points="4419.76,-9952.74 4416.26,-9942.74 4412.76,-9952.74 4419.76,-9952.74"/>
</g>
<!-- tp_layer0_v_proj_gpu2 -->
<g id="node26" class="node">
<title>tp_layer0_v_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="5225.76,-9942.66 4724.76,-9942.66 4724.76,-9874.66 5225.76,-9874.66 5225.76,-9942.66"/>
<text text-anchor="middle" x="4975.26" y="-9927.46" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="4975.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4975.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4975.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu2 -->
<g id="edge29" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu2</title>
<path fill="none" stroke="black" d="M6962.62,-10049C6379.96,-10049 4975.26,-10049 4975.26,-10049 4975.26,-10049 4975.26,-9952.99 4975.26,-9952.99"/>
<polygon fill="black" stroke="black" points="4978.76,-9952.99 4975.26,-9942.99 4971.76,-9952.99 4978.76,-9952.99"/>
</g>
<!-- tp_layer0_q_proj_gpu3 -->
<g id="node34" class="node">
<title>tp_layer0_q_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="5784.76,-9942.66 5283.76,-9942.66 5283.76,-9874.66 5784.76,-9874.66 5784.76,-9942.66"/>
<text text-anchor="middle" x="5534.26" y="-9927.46" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="5534.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5534.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5534.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu3 -->
<g id="edge39" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu3</title>
<path fill="none" stroke="black" d="M6962.46,-10044C6495.47,-10044 5534.26,-10044 5534.26,-10044 5534.26,-10044 5534.26,-9952.81 5534.26,-9952.81"/>
<polygon fill="black" stroke="black" points="5537.76,-9952.81 5534.26,-9942.81 5530.76,-9952.81 5537.76,-9952.81"/>
</g>
<!-- tp_layer0_k_proj_gpu3 -->
<g id="node35" class="node">
<title>tp_layer0_k_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="6343.76,-9942.66 5842.76,-9942.66 5842.76,-9874.66 6343.76,-9874.66 6343.76,-9942.66"/>
<text text-anchor="middle" x="6093.26" y="-9927.46" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="6093.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6093.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6093.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu3 -->
<g id="edge40" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu3</title>
<path fill="none" stroke="black" d="M6962.45,-10039C6633.01,-10039 6093.26,-10039 6093.26,-10039 6093.26,-10039 6093.26,-9952.91 6093.26,-9952.91"/>
<polygon fill="black" stroke="black" points="6096.76,-9952.91 6093.26,-9942.91 6089.76,-9952.91 6096.76,-9952.91"/>
</g>
<!-- tp_layer0_v_proj_gpu3 -->
<g id="node36" class="node">
<title>tp_layer0_v_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="6902.76,-9942.66 6401.76,-9942.66 6401.76,-9874.66 6902.76,-9874.66 6902.76,-9942.66"/>
<text text-anchor="middle" x="6652.26" y="-9927.46" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="6652.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6652.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6652.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu3 -->
<g id="edge41" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu3</title>
<path fill="none" stroke="black" d="M6962.41,-10033C6813.23,-10033 6652.26,-10033 6652.26,-10033 6652.26,-10033 6652.26,-9952.97 6652.26,-9952.97"/>
<polygon fill="black" stroke="black" points="6655.76,-9952.97 6652.26,-9942.97 6648.76,-9952.97 6655.76,-9952.97"/>
</g>
<!-- tp_layer0_q_proj_gpu4 -->
<g id="node44" class="node">
<title>tp_layer0_q_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="7461.76,-9942.66 6960.76,-9942.66 6960.76,-9874.66 7461.76,-9874.66 7461.76,-9942.66"/>
<text text-anchor="middle" x="7211.26" y="-9927.46" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="7211.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7211.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7211.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu4 -->
<g id="edge51" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu4</title>
<path fill="none" stroke="black" d="M7211.26,-10028.49C7211.26,-10028.49 7211.26,-9952.74 7211.26,-9952.74"/>
<polygon fill="black" stroke="black" points="7214.76,-9952.74 7211.26,-9942.74 7207.76,-9952.74 7214.76,-9952.74"/>
</g>
<!-- tp_layer0_k_proj_gpu4 -->
<g id="node45" class="node">
<title>tp_layer0_k_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="8020.76,-9942.66 7519.76,-9942.66 7519.76,-9874.66 8020.76,-9874.66 8020.76,-9942.66"/>
<text text-anchor="middle" x="7770.26" y="-9927.46" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="7770.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7770.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7770.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu4 -->
<g id="edge52" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu4</title>
<path fill="none" stroke="black" d="M7460.11,-10033C7609.29,-10033 7770.26,-10033 7770.26,-10033 7770.26,-10033 7770.26,-9952.97 7770.26,-9952.97"/>
<polygon fill="black" stroke="black" points="7773.76,-9952.97 7770.26,-9942.97 7766.76,-9952.97 7773.76,-9952.97"/>
</g>
<!-- tp_layer0_v_proj_gpu4 -->
<g id="node46" class="node">
<title>tp_layer0_v_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="8579.76,-9942.66 8078.76,-9942.66 8078.76,-9874.66 8579.76,-9874.66 8579.76,-9942.66"/>
<text text-anchor="middle" x="8329.26" y="-9927.46" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="8329.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8329.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8329.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu4 -->
<g id="edge53" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu4</title>
<path fill="none" stroke="black" d="M7460.08,-10039C7789.51,-10039 8329.26,-10039 8329.26,-10039 8329.26,-10039 8329.26,-9952.91 8329.26,-9952.91"/>
<polygon fill="black" stroke="black" points="8332.76,-9952.91 8329.26,-9942.91 8325.76,-9952.91 8332.76,-9952.91"/>
</g>
<!-- tp_layer0_q_proj_gpu5 -->
<g id="node54" class="node">
<title>tp_layer0_q_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="9138.76,-9942.66 8637.76,-9942.66 8637.76,-9874.66 9138.76,-9874.66 9138.76,-9942.66"/>
<text text-anchor="middle" x="8888.26" y="-9927.46" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="8888.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8888.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8888.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu5 -->
<g id="edge63" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu5</title>
<path fill="none" stroke="black" d="M7460.06,-10044C7927.05,-10044 8888.26,-10044 8888.26,-10044 8888.26,-10044 8888.26,-9952.81 8888.26,-9952.81"/>
<polygon fill="black" stroke="black" points="8891.76,-9952.81 8888.26,-9942.81 8884.76,-9952.81 8891.76,-9952.81"/>
</g>
<!-- tp_layer0_k_proj_gpu5 -->
<g id="node55" class="node">
<title>tp_layer0_k_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="9697.76,-9942.66 9196.76,-9942.66 9196.76,-9874.66 9697.76,-9874.66 9697.76,-9942.66"/>
<text text-anchor="middle" x="9447.26" y="-9927.46" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="9447.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9447.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9447.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu5 -->
<g id="edge64" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu5</title>
<path fill="none" stroke="black" d="M7459.9,-10049C8042.56,-10049 9447.26,-10049 9447.26,-10049 9447.26,-10049 9447.26,-9952.99 9447.26,-9952.99"/>
<polygon fill="black" stroke="black" points="9450.76,-9952.99 9447.26,-9942.99 9443.76,-9952.99 9450.76,-9952.99"/>
</g>
<!-- tp_layer0_v_proj_gpu5 -->
<g id="node56" class="node">
<title>tp_layer0_v_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="10256.76,-9942.66 9755.76,-9942.66 9755.76,-9874.66 10256.76,-9874.66 10256.76,-9942.66"/>
<text text-anchor="middle" x="10006.26" y="-9927.46" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="10006.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10006.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10006.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu5 -->
<g id="edge65" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu5</title>
<path fill="none" stroke="black" d="M7459.95,-10054C8139.86,-10054 9979.29,-10054 9979.29,-10054 9979.29,-10054 9979.29,-9952.74 9979.29,-9952.74"/>
<polygon fill="black" stroke="black" points="9982.79,-9952.74 9979.29,-9942.74 9975.79,-9952.74 9982.79,-9952.74"/>
</g>
<!-- tp_layer0_q_proj_gpu6 -->
<g id="node64" class="node">
<title>tp_layer0_q_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="10815.76,-9942.66 10314.76,-9942.66 10314.76,-9874.66 10815.76,-9874.66 10815.76,-9942.66"/>
<text text-anchor="middle" x="10565.26" y="-9927.46" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="10565.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10565.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10565.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu6 -->
<g id="edge75" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu6</title>
<path fill="none" stroke="black" d="M7459.82,-10060C8227.47,-10060 10509.26,-10060 10509.26,-10060 10509.26,-10060 10509.26,-9953 10509.26,-9953"/>
<polygon fill="black" stroke="black" points="10512.76,-9953 10509.26,-9943 10505.76,-9953 10512.76,-9953"/>
</g>
<!-- tp_layer0_k_proj_gpu6 -->
<g id="node65" class="node">
<title>tp_layer0_k_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="11374.76,-9942.66 10873.76,-9942.66 10873.76,-9874.66 11374.76,-9874.66 11374.76,-9942.66"/>
<text text-anchor="middle" x="11124.26" y="-9927.46" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="11124.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11124.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11124.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu6 -->
<g id="edge76" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu6</title>
<path fill="none" stroke="black" d="M7460.12,-10065C8321.59,-10065 11124.26,-10065 11124.26,-10065 11124.26,-10065 11124.26,-9952.97 11124.26,-9952.97"/>
<polygon fill="black" stroke="black" points="11127.76,-9952.97 11124.26,-9942.97 11120.76,-9952.97 11127.76,-9952.97"/>
</g>
<!-- tp_layer0_v_proj_gpu6 -->
<g id="node66" class="node">
<title>tp_layer0_v_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="11933.76,-9942.66 11432.76,-9942.66 11432.76,-9874.66 11933.76,-9874.66 11933.76,-9942.66"/>
<text text-anchor="middle" x="11683.26" y="-9927.46" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="11683.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11683.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11683.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu6 -->
<g id="edge77" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu6</title>
<path fill="none" stroke="black" d="M7460.07,-10070C8400.25,-10070 11683.26,-10070 11683.26,-10070 11683.26,-10070 11683.26,-9952.88 11683.26,-9952.88"/>
<polygon fill="black" stroke="black" points="11686.76,-9952.88 11683.26,-9942.88 11679.76,-9952.88 11686.76,-9952.88"/>
</g>
<!-- tp_layer0_q_proj_gpu7 -->
<g id="node74" class="node">
<title>tp_layer0_q_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="12492.76,-9942.66 11991.76,-9942.66 11991.76,-9874.66 12492.76,-9874.66 12492.76,-9942.66"/>
<text text-anchor="middle" x="12242.26" y="-9927.46" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="12242.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12242.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12242.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu7 -->
<g id="edge87" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_q_proj_gpu7</title>
<path fill="none" stroke="black" d="M7459.89,-10075C8473.77,-10075 12242.26,-10075 12242.26,-10075 12242.26,-10075 12242.26,-9952.72 12242.26,-9952.72"/>
<polygon fill="black" stroke="black" points="12245.76,-9952.72 12242.26,-9942.72 12238.76,-9952.72 12245.76,-9952.72"/>
</g>
<!-- tp_layer0_k_proj_gpu7 -->
<g id="node75" class="node">
<title>tp_layer0_k_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="13051.76,-9942.66 12550.76,-9942.66 12550.76,-9874.66 13051.76,-9874.66 13051.76,-9942.66"/>
<text text-anchor="middle" x="12801.26" y="-9927.46" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="12801.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12801.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12801.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu7 -->
<g id="edge88" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_k_proj_gpu7</title>
<path fill="none" stroke="black" d="M7460.03,-10080C8544.08,-10080 12801.26,-10080 12801.26,-10080 12801.26,-10080 12801.26,-9952.92 12801.26,-9952.92"/>
<polygon fill="black" stroke="black" points="12804.76,-9952.92 12801.26,-9942.92 12797.76,-9952.92 12804.76,-9952.92"/>
</g>
<!-- tp_layer0_v_proj_gpu7 -->
<g id="node76" class="node">
<title>tp_layer0_v_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="13610.76,-9942.66 13109.76,-9942.66 13109.76,-9874.66 13610.76,-9874.66 13610.76,-9942.66"/>
<text text-anchor="middle" x="13360.26" y="-9927.46" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="13360.26" y="-9912.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="13360.26" y="-9897.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13360.26" y="-9882.46" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu7 -->
<g id="edge89" class="edge">
<title>tp_layer0_norm&#45;&gt;tp_layer0_v_proj_gpu7</title>
<path fill="none" stroke="black" d="M7459.92,-10086C8610.3,-10086 13360.26,-10086 13360.26,-10086 13360.26,-10086 13360.26,-9952.86 13360.26,-9952.86"/>
<polygon fill="black" stroke="black" points="13363.76,-9952.86 13360.26,-9942.86 13356.76,-9952.86 13363.76,-9952.86"/>
</g>
<!-- tp_layer0_gather_q_gpu0 -->
<g id="node9" class="node">
<title>tp_layer0_gather_q_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="354.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="354.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="354.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="354.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="354.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_q_proj_gpu0&#45;&gt;tp_layer0_gather_q_gpu0 -->
<g id="edge6" class="edge">
<title>tp_layer0_q_proj_gpu0&#45;&gt;tp_layer0_gather_q_gpu0</title>
<path fill="none" stroke="black" d="M479.14,-9874.65C479.14,-9874.65 479.14,-9795.7 479.14,-9795.7"/>
<polygon fill="black" stroke="black" points="482.64,-9795.7 479.14,-9785.7 475.64,-9795.7 482.64,-9795.7"/>
</g>
<!-- tp_layer0_gather_k_gpu0 -->
<g id="node8" class="node">
<title>tp_layer0_gather_k_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="1121.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="1121.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="1121.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1121.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1121.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_k_proj_gpu0&#45;&gt;tp_layer0_gather_k_gpu0 -->
<g id="edge7" class="edge">
<title>tp_layer0_k_proj_gpu0&#45;&gt;tp_layer0_gather_k_gpu0</title>
<path fill="none" stroke="black" d="M1062.26,-9874.65C1062.26,-9874.65 1062.26,-9798.24 1062.26,-9798.24"/>
<polygon fill="black" stroke="black" points="1065.76,-9798.24 1062.26,-9788.24 1058.76,-9798.24 1065.76,-9798.24"/>
</g>
<!-- tp_layer0_gather_v_gpu0 -->
<g id="node12" class="node">
<title>tp_layer0_gather_v_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="1683.26" cy="-9376.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="1683.26" y="-9395.05" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="1683.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1683.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1683.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_v_proj_gpu0&#45;&gt;tp_layer0_gather_v_gpu0 -->
<g id="edge11" class="edge">
<title>tp_layer0_v_proj_gpu0&#45;&gt;tp_layer0_gather_v_gpu0</title>
<path fill="none" stroke="black" d="M1614.26,-9874.55C1614.26,-9874.55 1614.26,-9433.77 1614.26,-9433.77"/>
<polygon fill="black" stroke="black" points="1617.76,-9433.77 1614.26,-9423.77 1610.76,-9433.77 1617.76,-9433.77"/>
</g>
<!-- tp_layer0_attn_scores_gpu0 -->
<g id="node7" class="node">
<title>tp_layer0_attn_scores_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="1270.76,-9592.41 731.76,-9592.41 731.76,-9524.41 1270.76,-9524.41 1270.76,-9592.41"/>
<text text-anchor="middle" x="1001.26" y="-9577.21" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="1001.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1001.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1001.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_softmax_gpu0 -->
<g id="node10" class="node">
<title>tp_layer0_softmax_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="1270.76,-9410.25 731.76,-9410.25 731.76,-9342.25 1270.76,-9342.25 1270.76,-9410.25"/>
<text text-anchor="middle" x="1001.26" y="-9395.05" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="1001.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1001.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1001.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_attn_scores_gpu0&#45;&gt;tp_layer0_softmax_gpu0 -->
<g id="edge10" class="edge">
<title>tp_layer0_attn_scores_gpu0&#45;&gt;tp_layer0_softmax_gpu0</title>
<path fill="none" stroke="black" d="M1001.26,-9524.15C1001.26,-9524.15 1001.26,-9420.36 1001.26,-9420.36"/>
<polygon fill="black" stroke="black" points="1004.76,-9420.36 1001.26,-9410.36 997.76,-9420.36 1004.76,-9420.36"/>
</g>
<!-- tp_layer0_gather_k_gpu0&#45;&gt;tp_layer0_attn_scores_gpu0 -->
<g id="edge9" class="edge">
<title>tp_layer0_gather_k_gpu0&#45;&gt;tp_layer0_attn_scores_gpu0</title>
<path fill="none" stroke="black" d="M1018.88,-9694.14C1018.88,-9694.14 1018.88,-9602.69 1018.88,-9602.69"/>
<polygon fill="black" stroke="black" points="1022.38,-9602.69 1018.88,-9592.69 1015.38,-9602.69 1022.38,-9602.69"/>
</g>
<!-- tp_layer0_gather_q_gpu0&#45;&gt;tp_layer0_attn_scores_gpu0 -->
<g id="edge8" class="edge">
<title>tp_layer0_gather_q_gpu0&#45;&gt;tp_layer0_attn_scores_gpu0</title>
<path fill="none" stroke="black" d="M708.6,-9740C728.9,-9740 741.26,-9740 741.26,-9740 741.26,-9740 741.26,-9602.57 741.26,-9602.57"/>
<polygon fill="black" stroke="black" points="744.76,-9602.57 741.26,-9592.57 737.76,-9602.57 744.76,-9602.57"/>
</g>
<!-- tp_layer0_attn_out_gpu0 -->
<g id="node11" class="node">
<title>tp_layer0_attn_out_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="1946.76,-9242.16 1419.76,-9242.16 1419.76,-9174.16 1946.76,-9174.16 1946.76,-9242.16"/>
<text text-anchor="middle" x="1683.26" y="-9226.96" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="1683.26" y="-9211.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1683.26" y="-9196.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1683.26" y="-9181.96" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_softmax_gpu0&#45;&gt;tp_layer0_attn_out_gpu0 -->
<g id="edge12" class="edge">
<title>tp_layer0_softmax_gpu0&#45;&gt;tp_layer0_attn_out_gpu0</title>
<path fill="none" stroke="black" d="M1150.26,-9342.2C1150.26,-9293.04 1150.26,-9208 1150.26,-9208 1150.26,-9208 1409.49,-9208 1409.49,-9208"/>
<polygon fill="black" stroke="black" points="1409.49,-9211.5 1419.49,-9208 1409.49,-9204.5 1409.49,-9211.5"/>
</g>
<!-- tp_layer0_out_proj_gpu0 -->
<g id="node13" class="node">
<title>tp_layer0_out_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="3096.76,-9088.16 2607.76,-9088.16 2607.76,-9020.16 3096.76,-9020.16 3096.76,-9088.16"/>
<text text-anchor="middle" x="2852.26" y="-9072.96" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="2852.26" y="-9057.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2852.26" y="-9042.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2852.26" y="-9027.96" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_attn_out_gpu0&#45;&gt;tp_layer0_out_proj_gpu0 -->
<g id="edge14" class="edge">
<title>tp_layer0_attn_out_gpu0&#45;&gt;tp_layer0_out_proj_gpu0</title>
<path fill="none" stroke="black" d="M1946.98,-9208C2227.81,-9208 2632.26,-9208 2632.26,-9208 2632.26,-9208 2632.26,-9098.3 2632.26,-9098.3"/>
<polygon fill="black" stroke="black" points="2635.76,-9098.3 2632.26,-9088.3 2628.76,-9098.3 2635.76,-9098.3"/>
</g>
<!-- tp_layer0_gather_v_gpu0&#45;&gt;tp_layer0_attn_out_gpu0 -->
<g id="edge13" class="edge">
<title>tp_layer0_gather_v_gpu0&#45;&gt;tp_layer0_attn_out_gpu0</title>
<path fill="none" stroke="black" d="M1683.26,-9328.08C1683.26,-9328.08 1683.26,-9252.2 1683.26,-9252.2"/>
<polygon fill="black" stroke="black" points="1686.76,-9252.2 1683.26,-9242.2 1679.76,-9252.2 1686.76,-9252.2"/>
</g>
<!-- tp_layer0_attn_all_reduce -->
<g id="node84" class="node">
<title>tp_layer0_attn_all_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="7988.26" cy="-8886.08" rx="351.36" ry="48.17"/>
<text text-anchor="middle" x="7988.26" y="-8904.88" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention</text>
<text text-anchor="middle" x="7988.26" y="-8889.88" font-family="Times,serif" font-size="14.00">Input: 8×[512]</text>
<text text-anchor="middle" x="7988.26" y="-8874.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7988.26" y="-8859.88" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer0_out_proj_gpu0&#45;&gt;tp_layer0_attn_all_reduce -->
<g id="edge99" class="edge">
<title>tp_layer0_out_proj_gpu0&#45;&gt;tp_layer0_attn_all_reduce</title>
<path fill="none" stroke="black" d="M2901.76,-9019.81C2901.76,-8964.54 2901.76,-8862 2901.76,-8862 2901.76,-8862 7673.9,-8862 7673.9,-8862"/>
<polygon fill="black" stroke="black" points="7673.9,-8865.5 7683.9,-8862 7673.9,-8858.5 7673.9,-8865.5"/>
</g>
<!-- tp_layer0_gather_q_gpu1 -->
<g id="node19" class="node">
<title>tp_layer0_gather_q_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="2107.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="2107.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="2107.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2107.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2107.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_q_proj_gpu1&#45;&gt;tp_layer0_gather_q_gpu1 -->
<g id="edge18" class="edge">
<title>tp_layer0_q_proj_gpu1&#45;&gt;tp_layer0_gather_q_gpu1</title>
<path fill="none" stroke="black" d="M2180.26,-9874.65C2180.26,-9874.65 2180.26,-9797.92 2180.26,-9797.92"/>
<polygon fill="black" stroke="black" points="2183.76,-9797.92 2180.26,-9787.92 2176.76,-9797.92 2183.76,-9797.92"/>
</g>
<!-- tp_layer0_gather_k_gpu1 -->
<g id="node18" class="node">
<title>tp_layer0_gather_k_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="2874.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="2874.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="2874.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2874.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2874.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_k_proj_gpu1&#45;&gt;tp_layer0_gather_k_gpu1 -->
<g id="edge19" class="edge">
<title>tp_layer0_k_proj_gpu1&#45;&gt;tp_layer0_gather_k_gpu1</title>
<path fill="none" stroke="black" d="M2754.88,-9874.65C2754.88,-9874.65 2754.88,-9796.02 2754.88,-9796.02"/>
<polygon fill="black" stroke="black" points="2758.38,-9796.02 2754.88,-9786.02 2751.38,-9796.02 2758.38,-9796.02"/>
</g>
<!-- tp_layer0_gather_v_gpu1 -->
<g id="node22" class="node">
<title>tp_layer0_gather_v_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="3446.26" cy="-9558.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="3446.26" y="-9577.21" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="3446.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3446.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3446.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_v_proj_gpu1&#45;&gt;tp_layer0_gather_v_gpu1 -->
<g id="edge23" class="edge">
<title>tp_layer0_v_proj_gpu1&#45;&gt;tp_layer0_gather_v_gpu1</title>
<path fill="none" stroke="black" d="M3327.26,-9874.44C3327.26,-9874.44 3327.26,-9613.74 3327.26,-9613.74"/>
<polygon fill="black" stroke="black" points="3330.76,-9613.73 3327.26,-9603.74 3323.76,-9613.74 3330.76,-9613.73"/>
</g>
<!-- tp_layer0_attn_scores_gpu1 -->
<g id="node17" class="node">
<title>tp_layer0_attn_scores_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="3033.76,-9592.41 2494.76,-9592.41 2494.76,-9524.41 3033.76,-9524.41 3033.76,-9592.41"/>
<text text-anchor="middle" x="2764.26" y="-9577.21" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="2764.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2764.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="2764.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_softmax_gpu1 -->
<g id="node20" class="node">
<title>tp_layer0_softmax_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="3195.76,-9410.25 2656.76,-9410.25 2656.76,-9342.25 3195.76,-9342.25 3195.76,-9410.25"/>
<text text-anchor="middle" x="2926.26" y="-9395.05" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="2926.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="2926.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="2926.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_attn_scores_gpu1&#45;&gt;tp_layer0_softmax_gpu1 -->
<g id="edge22" class="edge">
<title>tp_layer0_attn_scores_gpu1&#45;&gt;tp_layer0_softmax_gpu1</title>
<path fill="none" stroke="black" d="M2845.26,-9524.15C2845.26,-9524.15 2845.26,-9420.36 2845.26,-9420.36"/>
<polygon fill="black" stroke="black" points="2848.76,-9420.36 2845.26,-9410.36 2841.76,-9420.36 2848.76,-9420.36"/>
</g>
<!-- tp_layer0_gather_k_gpu1&#45;&gt;tp_layer0_attn_scores_gpu1 -->
<g id="edge21" class="edge">
<title>tp_layer0_gather_k_gpu1&#45;&gt;tp_layer0_attn_scores_gpu1</title>
<path fill="none" stroke="black" d="M2776.88,-9694.14C2776.88,-9694.14 2776.88,-9602.69 2776.88,-9602.69"/>
<polygon fill="black" stroke="black" points="2780.38,-9602.69 2776.88,-9592.69 2773.38,-9602.69 2780.38,-9602.69"/>
</g>
<!-- tp_layer0_gather_q_gpu1&#45;&gt;tp_layer0_attn_scores_gpu1 -->
<g id="edge20" class="edge">
<title>tp_layer0_gather_q_gpu1&#45;&gt;tp_layer0_attn_scores_gpu1</title>
<path fill="none" stroke="black" d="M2461.87,-9740C2489.74,-9740 2507.38,-9740 2507.38,-9740 2507.38,-9740 2507.38,-9602.57 2507.38,-9602.57"/>
<polygon fill="black" stroke="black" points="2510.88,-9602.57 2507.38,-9592.57 2503.88,-9602.57 2510.88,-9602.57"/>
</g>
<!-- tp_layer0_attn_out_gpu1 -->
<g id="node21" class="node">
<title>tp_layer0_attn_out_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="3709.76,-9242.16 3182.76,-9242.16 3182.76,-9174.16 3709.76,-9174.16 3709.76,-9242.16"/>
<text text-anchor="middle" x="3446.26" y="-9226.96" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="3446.26" y="-9211.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3446.26" y="-9196.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3446.26" y="-9181.96" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_softmax_gpu1&#45;&gt;tp_layer0_attn_out_gpu1 -->
<g id="edge24" class="edge">
<title>tp_layer0_softmax_gpu1&#45;&gt;tp_layer0_attn_out_gpu1</title>
<path fill="none" stroke="black" d="M3189.26,-9342.23C3189.26,-9342.23 3189.26,-9252.41 3189.26,-9252.41"/>
<polygon fill="black" stroke="black" points="3192.76,-9252.41 3189.26,-9242.41 3185.76,-9252.41 3192.76,-9252.41"/>
</g>
<!-- tp_layer0_out_proj_gpu1 -->
<g id="node23" class="node">
<title>tp_layer0_out_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="4754.76,-9088.16 4265.76,-9088.16 4265.76,-9020.16 4754.76,-9020.16 4754.76,-9088.16"/>
<text text-anchor="middle" x="4510.26" y="-9072.96" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="4510.26" y="-9057.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4510.26" y="-9042.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4510.26" y="-9027.96" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_attn_out_gpu1&#45;&gt;tp_layer0_out_proj_gpu1 -->
<g id="edge26" class="edge">
<title>tp_layer0_attn_out_gpu1&#45;&gt;tp_layer0_out_proj_gpu1</title>
<path fill="none" stroke="black" d="M3709.91,-9196C3995.57,-9196 4411.09,-9196 4411.09,-9196 4411.09,-9196 4411.09,-9098.5 4411.09,-9098.5"/>
<polygon fill="black" stroke="black" points="4414.59,-9098.5 4411.09,-9088.5 4407.59,-9098.5 4414.59,-9098.5"/>
</g>
<!-- tp_layer0_gather_v_gpu1&#45;&gt;tp_layer0_attn_out_gpu1 -->
<g id="edge25" class="edge">
<title>tp_layer0_gather_v_gpu1&#45;&gt;tp_layer0_attn_out_gpu1</title>
<path fill="none" stroke="black" d="M3452.76,-9510.08C3452.76,-9510.08 3452.76,-9252.31 3452.76,-9252.31"/>
<polygon fill="black" stroke="black" points="3456.26,-9252.31 3452.76,-9242.31 3449.26,-9252.31 3456.26,-9252.31"/>
</g>
<!-- tp_layer0_out_proj_gpu1&#45;&gt;tp_layer0_attn_all_reduce -->
<g id="edge100" class="edge">
<title>tp_layer0_out_proj_gpu1&#45;&gt;tp_layer0_attn_all_reduce</title>
<path fill="none" stroke="black" d="M4541.51,-9020.13C4541.51,-8971 4541.51,-8886 4541.51,-8886 4541.51,-8886 7626.8,-8886 7626.8,-8886"/>
<polygon fill="black" stroke="black" points="7626.8,-8889.5 7636.8,-8886 7626.8,-8882.5 7626.8,-8889.5"/>
</g>
<!-- tp_layer0_gather_q_gpu2 -->
<g id="node29" class="node">
<title>tp_layer0_gather_q_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="3780.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="3780.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="3780.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3780.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3780.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_q_proj_gpu2&#45;&gt;tp_layer0_gather_q_gpu2 -->
<g id="edge30" class="edge">
<title>tp_layer0_q_proj_gpu2&#45;&gt;tp_layer0_gather_q_gpu2</title>
<path fill="none" stroke="black" d="M3857.26,-9874.65C3857.26,-9874.65 3857.26,-9797.6 3857.26,-9797.6"/>
<polygon fill="black" stroke="black" points="3860.76,-9797.6 3857.26,-9787.6 3853.76,-9797.6 3860.76,-9797.6"/>
</g>
<!-- tp_layer0_gather_k_gpu2 -->
<g id="node28" class="node">
<title>tp_layer0_gather_k_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="4547.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="4547.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="4547.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4547.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4547.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_k_proj_gpu2&#45;&gt;tp_layer0_gather_k_gpu2 -->
<g id="edge31" class="edge">
<title>tp_layer0_k_proj_gpu2&#45;&gt;tp_layer0_gather_k_gpu2</title>
<path fill="none" stroke="black" d="M4429.88,-9874.65C4429.88,-9874.65 4429.88,-9796.02 4429.88,-9796.02"/>
<polygon fill="black" stroke="black" points="4433.38,-9796.02 4429.88,-9786.02 4426.38,-9796.02 4433.38,-9796.02"/>
</g>
<!-- tp_layer0_gather_v_gpu2 -->
<g id="node32" class="node">
<title>tp_layer0_gather_v_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="5114.26" cy="-9376.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="5114.26" y="-9395.05" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="5114.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5114.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5114.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_v_proj_gpu2&#45;&gt;tp_layer0_gather_v_gpu2 -->
<g id="edge35" class="edge">
<title>tp_layer0_v_proj_gpu2&#45;&gt;tp_layer0_gather_v_gpu2</title>
<path fill="none" stroke="black" d="M4996.76,-9874.55C4996.76,-9874.55 4996.76,-9431.81 4996.76,-9431.81"/>
<polygon fill="black" stroke="black" points="5000.26,-9431.81 4996.76,-9421.81 4993.26,-9431.81 5000.26,-9431.81"/>
</g>
<!-- tp_layer0_attn_scores_gpu2 -->
<g id="node27" class="node">
<title>tp_layer0_attn_scores_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="4701.76,-9592.41 4162.76,-9592.41 4162.76,-9524.41 4701.76,-9524.41 4701.76,-9592.41"/>
<text text-anchor="middle" x="4432.26" y="-9577.21" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="4432.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4432.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="4432.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_softmax_gpu2 -->
<g id="node30" class="node">
<title>tp_layer0_softmax_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="4701.76,-9410.25 4162.76,-9410.25 4162.76,-9342.25 4701.76,-9342.25 4701.76,-9410.25"/>
<text text-anchor="middle" x="4432.26" y="-9395.05" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="4432.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="4432.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="4432.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_attn_scores_gpu2&#45;&gt;tp_layer0_softmax_gpu2 -->
<g id="edge34" class="edge">
<title>tp_layer0_attn_scores_gpu2&#45;&gt;tp_layer0_softmax_gpu2</title>
<path fill="none" stroke="black" d="M4432.26,-9524.15C4432.26,-9524.15 4432.26,-9420.36 4432.26,-9420.36"/>
<polygon fill="black" stroke="black" points="4435.76,-9420.36 4432.26,-9410.36 4428.76,-9420.36 4435.76,-9420.36"/>
</g>
<!-- tp_layer0_gather_k_gpu2&#45;&gt;tp_layer0_attn_scores_gpu2 -->
<g id="edge33" class="edge">
<title>tp_layer0_gather_k_gpu2&#45;&gt;tp_layer0_attn_scores_gpu2</title>
<path fill="none" stroke="black" d="M4447.38,-9694.14C4447.38,-9694.14 4447.38,-9602.69 4447.38,-9602.69"/>
<polygon fill="black" stroke="black" points="4450.88,-9602.69 4447.38,-9592.69 4443.88,-9602.69 4450.88,-9602.69"/>
</g>
<!-- tp_layer0_gather_q_gpu2&#45;&gt;tp_layer0_attn_scores_gpu2 -->
<g id="edge32" class="edge">
<title>tp_layer0_gather_q_gpu2&#45;&gt;tp_layer0_attn_scores_gpu2</title>
<path fill="none" stroke="black" d="M4134.76,-9740C4162.11,-9740 4179.38,-9740 4179.38,-9740 4179.38,-9740 4179.38,-9602.57 4179.38,-9602.57"/>
<polygon fill="black" stroke="black" points="4182.88,-9602.57 4179.38,-9592.57 4175.88,-9602.57 4182.88,-9602.57"/>
</g>
<!-- tp_layer0_attn_out_gpu2 -->
<g id="node31" class="node">
<title>tp_layer0_attn_out_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="5377.76,-9242.16 4850.76,-9242.16 4850.76,-9174.16 5377.76,-9174.16 5377.76,-9242.16"/>
<text text-anchor="middle" x="5114.26" y="-9226.96" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="5114.26" y="-9211.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="5114.26" y="-9196.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5114.26" y="-9181.96" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_softmax_gpu2&#45;&gt;tp_layer0_attn_out_gpu2 -->
<g id="edge36" class="edge">
<title>tp_layer0_softmax_gpu2&#45;&gt;tp_layer0_attn_out_gpu2</title>
<path fill="none" stroke="black" d="M4556.43,-9342.13C4556.43,-9295.88 4556.43,-9219 4556.43,-9219 4556.43,-9219 4840.45,-9219 4840.45,-9219"/>
<polygon fill="black" stroke="black" points="4840.45,-9222.5 4850.45,-9219 4840.45,-9215.5 4840.45,-9222.5"/>
</g>
<!-- tp_layer0_out_proj_gpu2 -->
<g id="node33" class="node">
<title>tp_layer0_out_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="5856.76,-9088.16 5367.76,-9088.16 5367.76,-9020.16 5856.76,-9020.16 5856.76,-9088.16"/>
<text text-anchor="middle" x="5612.26" y="-9072.96" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5612.26" y="-9057.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5612.26" y="-9042.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5612.26" y="-9027.96" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_attn_out_gpu2&#45;&gt;tp_layer0_out_proj_gpu2 -->
<g id="edge38" class="edge">
<title>tp_layer0_attn_out_gpu2&#45;&gt;tp_layer0_out_proj_gpu2</title>
<path fill="none" stroke="black" d="M5372.76,-9173.99C5372.76,-9173.99 5372.76,-9098.25 5372.76,-9098.25"/>
<polygon fill="black" stroke="black" points="5376.26,-9098.25 5372.76,-9088.25 5369.26,-9098.25 5376.26,-9098.25"/>
</g>
<!-- tp_layer0_gather_v_gpu2&#45;&gt;tp_layer0_attn_out_gpu2 -->
<g id="edge37" class="edge">
<title>tp_layer0_gather_v_gpu2&#45;&gt;tp_layer0_attn_out_gpu2</title>
<path fill="none" stroke="black" d="M5114.26,-9328.08C5114.26,-9328.08 5114.26,-9252.2 5114.26,-9252.2"/>
<polygon fill="black" stroke="black" points="5117.76,-9252.2 5114.26,-9242.2 5110.76,-9252.2 5117.76,-9252.2"/>
</g>
<!-- tp_layer0_out_proj_gpu2&#45;&gt;tp_layer0_attn_all_reduce -->
<g id="edge101" class="edge">
<title>tp_layer0_out_proj_gpu2&#45;&gt;tp_layer0_attn_all_reduce</title>
<path fill="none" stroke="black" d="M5656.51,-9020C5656.51,-8977.37 5656.51,-8910 5656.51,-8910 5656.51,-8910 7673.13,-8910 7673.13,-8910"/>
<polygon fill="black" stroke="black" points="7673.13,-8913.5 7683.13,-8910 7673.13,-8906.5 7673.13,-8913.5"/>
</g>
<!-- tp_layer0_gather_q_gpu3 -->
<g id="node39" class="node">
<title>tp_layer0_gather_q_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="5446.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="5446.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="5446.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5446.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5446.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_q_proj_gpu3&#45;&gt;tp_layer0_gather_q_gpu3 -->
<g id="edge42" class="edge">
<title>tp_layer0_q_proj_gpu3&#45;&gt;tp_layer0_gather_q_gpu3</title>
<path fill="none" stroke="black" d="M5534.26,-9874.65C5534.26,-9874.65 5534.26,-9797.28 5534.26,-9797.28"/>
<polygon fill="black" stroke="black" points="5537.76,-9797.28 5534.26,-9787.28 5530.76,-9797.28 5537.76,-9797.28"/>
</g>
<!-- tp_layer0_gather_k_gpu3 -->
<g id="node38" class="node">
<title>tp_layer0_gather_k_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="6213.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="6213.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="6213.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6213.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6213.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_k_proj_gpu3&#45;&gt;tp_layer0_gather_k_gpu3 -->
<g id="edge43" class="edge">
<title>tp_layer0_k_proj_gpu3&#45;&gt;tp_layer0_gather_k_gpu3</title>
<path fill="none" stroke="black" d="M6101.38,-9874.65C6101.38,-9874.65 6101.38,-9796.33 6101.38,-9796.33"/>
<polygon fill="black" stroke="black" points="6104.88,-9796.33 6101.38,-9786.33 6097.88,-9796.33 6104.88,-9796.33"/>
</g>
<!-- tp_layer0_gather_v_gpu3 -->
<g id="node42" class="node">
<title>tp_layer0_gather_v_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="6776.26" cy="-9558.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="6776.26" y="-9577.21" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="6776.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6776.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6776.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_v_proj_gpu3&#45;&gt;tp_layer0_gather_v_gpu3 -->
<g id="edge47" class="edge">
<title>tp_layer0_v_proj_gpu3&#45;&gt;tp_layer0_gather_v_gpu3</title>
<path fill="none" stroke="black" d="M6661.76,-9874.44C6661.76,-9874.44 6661.76,-9614.02 6661.76,-9614.02"/>
<polygon fill="black" stroke="black" points="6665.26,-9614.02 6661.76,-9604.02 6658.26,-9614.02 6665.26,-9614.02"/>
</g>
<!-- tp_layer0_attn_scores_gpu3 -->
<g id="node37" class="node">
<title>tp_layer0_attn_scores_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="6363.76,-9592.41 5824.76,-9592.41 5824.76,-9524.41 6363.76,-9524.41 6363.76,-9592.41"/>
<text text-anchor="middle" x="6094.26" y="-9577.21" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="6094.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6094.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6094.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_softmax_gpu3 -->
<g id="node40" class="node">
<title>tp_layer0_softmax_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="6525.76,-9410.25 5986.76,-9410.25 5986.76,-9342.25 6525.76,-9342.25 6525.76,-9410.25"/>
<text text-anchor="middle" x="6256.26" y="-9395.05" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="6256.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6256.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6256.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_attn_scores_gpu3&#45;&gt;tp_layer0_softmax_gpu3 -->
<g id="edge46" class="edge">
<title>tp_layer0_attn_scores_gpu3&#45;&gt;tp_layer0_softmax_gpu3</title>
<path fill="none" stroke="black" d="M6175.26,-9524.15C6175.26,-9524.15 6175.26,-9420.36 6175.26,-9420.36"/>
<polygon fill="black" stroke="black" points="6178.76,-9420.36 6175.26,-9410.36 6171.76,-9420.36 6178.76,-9420.36"/>
</g>
<!-- tp_layer0_gather_k_gpu3&#45;&gt;tp_layer0_attn_scores_gpu3 -->
<g id="edge45" class="edge">
<title>tp_layer0_gather_k_gpu3&#45;&gt;tp_layer0_attn_scores_gpu3</title>
<path fill="none" stroke="black" d="M6111.38,-9694.14C6111.38,-9694.14 6111.38,-9602.69 6111.38,-9602.69"/>
<polygon fill="black" stroke="black" points="6114.88,-9602.69 6111.38,-9592.69 6107.88,-9602.69 6114.88,-9602.69"/>
</g>
<!-- tp_layer0_gather_q_gpu3&#45;&gt;tp_layer0_attn_scores_gpu3 -->
<g id="edge44" class="edge">
<title>tp_layer0_gather_q_gpu3&#45;&gt;tp_layer0_attn_scores_gpu3</title>
<path fill="none" stroke="black" d="M5800.72,-9740C5821.25,-9740 5833.76,-9740 5833.76,-9740 5833.76,-9740 5833.76,-9602.57 5833.76,-9602.57"/>
<polygon fill="black" stroke="black" points="5837.26,-9602.57 5833.76,-9592.57 5830.26,-9602.57 5837.26,-9602.57"/>
</g>
<!-- tp_layer0_attn_out_gpu3 -->
<g id="node41" class="node">
<title>tp_layer0_attn_out_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="7039.76,-9242.16 6512.76,-9242.16 6512.76,-9174.16 7039.76,-9174.16 7039.76,-9242.16"/>
<text text-anchor="middle" x="6776.26" y="-9226.96" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="6776.26" y="-9211.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6776.26" y="-9196.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6776.26" y="-9181.96" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_softmax_gpu3&#45;&gt;tp_layer0_attn_out_gpu3 -->
<g id="edge48" class="edge">
<title>tp_layer0_softmax_gpu3&#45;&gt;tp_layer0_attn_out_gpu3</title>
<path fill="none" stroke="black" d="M6519.26,-9342.23C6519.26,-9342.23 6519.26,-9252.41 6519.26,-9252.41"/>
<polygon fill="black" stroke="black" points="6522.76,-9252.41 6519.26,-9242.41 6515.76,-9252.41 6522.76,-9252.41"/>
</g>
<!-- tp_layer0_out_proj_gpu3 -->
<g id="node43" class="node">
<title>tp_layer0_out_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="7411.76,-9088.16 6922.76,-9088.16 6922.76,-9020.16 7411.76,-9020.16 7411.76,-9088.16"/>
<text text-anchor="middle" x="7167.26" y="-9072.96" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="7167.26" y="-9057.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7167.26" y="-9042.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7167.26" y="-9027.96" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_attn_out_gpu3&#45;&gt;tp_layer0_out_proj_gpu3 -->
<g id="edge50" class="edge">
<title>tp_layer0_attn_out_gpu3&#45;&gt;tp_layer0_out_proj_gpu3</title>
<path fill="none" stroke="black" d="M6981.26,-9173.99C6981.26,-9173.99 6981.26,-9098.25 6981.26,-9098.25"/>
<polygon fill="black" stroke="black" points="6984.76,-9098.25 6981.26,-9088.25 6977.76,-9098.25 6984.76,-9098.25"/>
</g>
<!-- tp_layer0_gather_v_gpu3&#45;&gt;tp_layer0_attn_out_gpu3 -->
<g id="edge49" class="edge">
<title>tp_layer0_gather_v_gpu3&#45;&gt;tp_layer0_attn_out_gpu3</title>
<path fill="none" stroke="black" d="M6782.76,-9510.08C6782.76,-9510.08 6782.76,-9252.31 6782.76,-9252.31"/>
<polygon fill="black" stroke="black" points="6786.26,-9252.31 6782.76,-9242.31 6779.26,-9252.31 6786.26,-9252.31"/>
</g>
<!-- tp_layer0_out_proj_gpu3&#45;&gt;tp_layer0_attn_all_reduce -->
<g id="edge102" class="edge">
<title>tp_layer0_out_proj_gpu3&#45;&gt;tp_layer0_attn_all_reduce</title>
<path fill="none" stroke="black" d="M7412,-9054C7544.26,-9054 7680.79,-9054 7680.79,-9054 7680.79,-9054 7680.79,-8919.43 7680.79,-8919.43"/>
<polygon fill="black" stroke="black" points="7684.29,-8919.43 7680.79,-8909.43 7677.29,-8919.43 7684.29,-8919.43"/>
</g>
<!-- tp_layer0_gather_q_gpu4 -->
<g id="node49" class="node">
<title>tp_layer0_gather_q_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="7110.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="7110.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="7110.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7110.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7110.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_q_proj_gpu4&#45;&gt;tp_layer0_gather_q_gpu4 -->
<g id="edge54" class="edge">
<title>tp_layer0_q_proj_gpu4&#45;&gt;tp_layer0_gather_q_gpu4</title>
<path fill="none" stroke="black" d="M7211.26,-9874.65C7211.26,-9874.65 7211.26,-9796.96 7211.26,-9796.96"/>
<polygon fill="black" stroke="black" points="7214.76,-9796.96 7211.26,-9786.96 7207.76,-9796.96 7214.76,-9796.96"/>
</g>
<!-- tp_layer0_gather_k_gpu4 -->
<g id="node48" class="node">
<title>tp_layer0_gather_k_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="7877.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="7877.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="7877.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7877.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7877.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_k_proj_gpu4&#45;&gt;tp_layer0_gather_k_gpu4 -->
<g id="edge55" class="edge">
<title>tp_layer0_k_proj_gpu4&#45;&gt;tp_layer0_gather_k_gpu4</title>
<path fill="none" stroke="black" d="M7771.88,-9874.65C7771.88,-9874.65 7771.88,-9796.65 7771.88,-9796.65"/>
<polygon fill="black" stroke="black" points="7775.38,-9796.65 7771.88,-9786.65 7768.38,-9796.65 7775.38,-9796.65"/>
</g>
<!-- tp_layer0_gather_v_gpu4 -->
<g id="node52" class="node">
<title>tp_layer0_gather_v_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="8329.26" cy="-9376.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="8329.26" y="-9395.05" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="8329.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8329.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8329.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_v_proj_gpu4&#45;&gt;tp_layer0_gather_v_gpu4 -->
<g id="edge59" class="edge">
<title>tp_layer0_v_proj_gpu4&#45;&gt;tp_layer0_gather_v_gpu4</title>
<path fill="none" stroke="black" d="M8327.76,-9874.55C8327.76,-9874.55 8327.76,-9434.57 8327.76,-9434.57"/>
<polygon fill="black" stroke="black" points="8331.26,-9434.57 8327.76,-9424.57 8324.26,-9434.57 8331.26,-9434.57"/>
</g>
<!-- tp_layer0_attn_scores_gpu4 -->
<g id="node47" class="node">
<title>tp_layer0_attn_scores_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="7916.76,-9592.41 7377.76,-9592.41 7377.76,-9524.41 7916.76,-9524.41 7916.76,-9592.41"/>
<text text-anchor="middle" x="7647.26" y="-9577.21" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="7647.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7647.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="7647.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_softmax_gpu4 -->
<g id="node50" class="node">
<title>tp_layer0_softmax_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="7916.76,-9410.25 7377.76,-9410.25 7377.76,-9342.25 7916.76,-9342.25 7916.76,-9410.25"/>
<text text-anchor="middle" x="7647.26" y="-9395.05" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="7647.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="7647.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="7647.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_attn_scores_gpu4&#45;&gt;tp_layer0_softmax_gpu4 -->
<g id="edge58" class="edge">
<title>tp_layer0_attn_scores_gpu4&#45;&gt;tp_layer0_softmax_gpu4</title>
<path fill="none" stroke="black" d="M7647.26,-9524.15C7647.26,-9524.15 7647.26,-9420.36 7647.26,-9420.36"/>
<polygon fill="black" stroke="black" points="7650.76,-9420.36 7647.26,-9410.36 7643.76,-9420.36 7650.76,-9420.36"/>
</g>
<!-- tp_layer0_gather_k_gpu4&#45;&gt;tp_layer0_attn_scores_gpu4 -->
<g id="edge57" class="edge">
<title>tp_layer0_gather_k_gpu4&#45;&gt;tp_layer0_attn_scores_gpu4</title>
<path fill="none" stroke="black" d="M7719.88,-9697.41C7719.88,-9697.41 7719.88,-9602.46 7719.88,-9602.46"/>
<polygon fill="black" stroke="black" points="7723.38,-9602.46 7719.88,-9592.46 7716.38,-9602.46 7723.38,-9602.46"/>
</g>
<!-- tp_layer0_gather_q_gpu4&#45;&gt;tp_layer0_attn_scores_gpu4 -->
<g id="edge56" class="edge">
<title>tp_layer0_gather_q_gpu4&#45;&gt;tp_layer0_attn_scores_gpu4</title>
<path fill="none" stroke="black" d="M7421.14,-9717.51C7421.14,-9717.51 7421.14,-9602.45 7421.14,-9602.45"/>
<polygon fill="black" stroke="black" points="7424.64,-9602.45 7421.14,-9592.45 7417.64,-9602.45 7424.64,-9602.45"/>
</g>
<!-- tp_layer0_attn_out_gpu4 -->
<g id="node51" class="node">
<title>tp_layer0_attn_out_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="8251.76,-9242.16 7724.76,-9242.16 7724.76,-9174.16 8251.76,-9174.16 8251.76,-9242.16"/>
<text text-anchor="middle" x="7988.26" y="-9226.96" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="7988.26" y="-9211.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="7988.26" y="-9196.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7988.26" y="-9181.96" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_softmax_gpu4&#45;&gt;tp_layer0_attn_out_gpu4 -->
<g id="edge60" class="edge">
<title>tp_layer0_softmax_gpu4&#45;&gt;tp_layer0_attn_out_gpu4</title>
<path fill="none" stroke="black" d="M7820.76,-9342.23C7820.76,-9342.23 7820.76,-9252.41 7820.76,-9252.41"/>
<polygon fill="black" stroke="black" points="7824.26,-9252.41 7820.76,-9242.41 7817.26,-9252.41 7824.26,-9252.41"/>
</g>
<!-- tp_layer0_out_proj_gpu4 -->
<g id="node53" class="node">
<title>tp_layer0_out_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="8232.76,-9088.16 7743.76,-9088.16 7743.76,-9020.16 8232.76,-9020.16 8232.76,-9088.16"/>
<text text-anchor="middle" x="7988.26" y="-9072.96" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="7988.26" y="-9057.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7988.26" y="-9042.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7988.26" y="-9027.96" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_attn_out_gpu4&#45;&gt;tp_layer0_out_proj_gpu4 -->
<g id="edge62" class="edge">
<title>tp_layer0_attn_out_gpu4&#45;&gt;tp_layer0_out_proj_gpu4</title>
<path fill="none" stroke="black" d="M7988.26,-9173.99C7988.26,-9173.99 7988.26,-9098.25 7988.26,-9098.25"/>
<polygon fill="black" stroke="black" points="7991.76,-9098.25 7988.26,-9088.25 7984.76,-9098.25 7991.76,-9098.25"/>
</g>
<!-- tp_layer0_gather_v_gpu4&#45;&gt;tp_layer0_attn_out_gpu4 -->
<g id="edge61" class="edge">
<title>tp_layer0_gather_v_gpu4&#45;&gt;tp_layer0_attn_out_gpu4</title>
<path fill="none" stroke="black" d="M8113.38,-9338.11C8113.38,-9338.11 8113.38,-9252.44 8113.38,-9252.44"/>
<polygon fill="black" stroke="black" points="8116.88,-9252.44 8113.38,-9242.44 8109.88,-9252.44 8116.88,-9252.44"/>
</g>
<!-- tp_layer0_out_proj_gpu4&#45;&gt;tp_layer0_attn_all_reduce -->
<g id="edge103" class="edge">
<title>tp_layer0_out_proj_gpu4&#45;&gt;tp_layer0_attn_all_reduce</title>
<path fill="none" stroke="black" d="M7988.26,-9020.15C7988.26,-9020.15 7988.26,-8944.38 7988.26,-8944.38"/>
<polygon fill="black" stroke="black" points="7991.76,-8944.38 7988.26,-8934.38 7984.76,-8944.38 7991.76,-8944.38"/>
</g>
<!-- tp_layer0_gather_q_gpu5 -->
<g id="node59" class="node">
<title>tp_layer0_gather_q_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="8778.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="8778.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="8778.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8778.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8778.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_q_proj_gpu5&#45;&gt;tp_layer0_gather_q_gpu5 -->
<g id="edge66" class="edge">
<title>tp_layer0_q_proj_gpu5&#45;&gt;tp_layer0_gather_q_gpu5</title>
<path fill="none" stroke="black" d="M8885.14,-9874.65C8885.14,-9874.65 8885.14,-9796.65 8885.14,-9796.65"/>
<polygon fill="black" stroke="black" points="8888.64,-9796.65 8885.14,-9786.65 8881.64,-9796.65 8888.64,-9796.65"/>
</g>
<!-- tp_layer0_gather_k_gpu5 -->
<g id="node58" class="node">
<title>tp_layer0_gather_k_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="9545.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="9545.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="9545.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9545.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9545.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_k_proj_gpu5&#45;&gt;tp_layer0_gather_k_gpu5 -->
<g id="edge67" class="edge">
<title>tp_layer0_k_proj_gpu5&#45;&gt;tp_layer0_gather_k_gpu5</title>
<path fill="none" stroke="black" d="M9447.26,-9874.65C9447.26,-9874.65 9447.26,-9796.96 9447.26,-9796.96"/>
<polygon fill="black" stroke="black" points="9450.76,-9796.96 9447.26,-9786.96 9443.76,-9796.96 9450.76,-9796.96"/>
</g>
<!-- tp_layer0_gather_v_gpu5 -->
<g id="node62" class="node">
<title>tp_layer0_gather_v_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="9918.26" cy="-9558.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="9918.26" y="-9577.21" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="9918.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9918.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9918.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_v_proj_gpu5&#45;&gt;tp_layer0_gather_v_gpu5 -->
<g id="edge71" class="edge">
<title>tp_layer0_v_proj_gpu5&#45;&gt;tp_layer0_gather_v_gpu5</title>
<path fill="none" stroke="black" d="M9999.76,-9874.44C9999.76,-9874.44 9999.76,-9615.48 9999.76,-9615.48"/>
<polygon fill="black" stroke="black" points="10003.26,-9615.48 9999.76,-9605.48 9996.26,-9615.48 10003.26,-9615.48"/>
</g>
<!-- tp_layer0_attn_scores_gpu5 -->
<g id="node57" class="node">
<title>tp_layer0_attn_scores_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="9430.76,-9592.41 8891.76,-9592.41 8891.76,-9524.41 9430.76,-9524.41 9430.76,-9592.41"/>
<text text-anchor="middle" x="9161.26" y="-9577.21" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="9161.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9161.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9161.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_softmax_gpu5 -->
<g id="node60" class="node">
<title>tp_layer0_softmax_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="9430.76,-9410.25 8891.76,-9410.25 8891.76,-9342.25 9430.76,-9342.25 9430.76,-9410.25"/>
<text text-anchor="middle" x="9161.26" y="-9395.05" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="9161.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9161.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9161.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_attn_scores_gpu5&#45;&gt;tp_layer0_softmax_gpu5 -->
<g id="edge70" class="edge">
<title>tp_layer0_attn_scores_gpu5&#45;&gt;tp_layer0_softmax_gpu5</title>
<path fill="none" stroke="black" d="M9161.26,-9524.15C9161.26,-9524.15 9161.26,-9420.36 9161.26,-9420.36"/>
<polygon fill="black" stroke="black" points="9164.76,-9420.36 9161.26,-9410.36 9157.76,-9420.36 9164.76,-9420.36"/>
</g>
<!-- tp_layer0_gather_k_gpu5&#45;&gt;tp_layer0_attn_scores_gpu5 -->
<g id="edge69" class="edge">
<title>tp_layer0_gather_k_gpu5&#45;&gt;tp_layer0_attn_scores_gpu5</title>
<path fill="none" stroke="black" d="M9310.88,-9704.15C9310.88,-9704.15 9310.88,-9602.62 9310.88,-9602.62"/>
<polygon fill="black" stroke="black" points="9314.38,-9602.62 9310.88,-9592.62 9307.38,-9602.62 9314.38,-9602.62"/>
</g>
<!-- tp_layer0_gather_q_gpu5&#45;&gt;tp_layer0_attn_scores_gpu5 -->
<g id="edge68" class="edge">
<title>tp_layer0_gather_q_gpu5&#45;&gt;tp_layer0_attn_scores_gpu5</title>
<path fill="none" stroke="black" d="M9012.14,-9704.15C9012.14,-9704.15 9012.14,-9602.62 9012.14,-9602.62"/>
<polygon fill="black" stroke="black" points="9015.64,-9602.62 9012.14,-9592.62 9008.64,-9602.62 9015.64,-9602.62"/>
</g>
<!-- tp_layer0_attn_out_gpu5 -->
<g id="node61" class="node">
<title>tp_layer0_attn_out_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="9424.76,-9242.16 8897.76,-9242.16 8897.76,-9174.16 9424.76,-9174.16 9424.76,-9242.16"/>
<text text-anchor="middle" x="9161.26" y="-9226.96" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="9161.26" y="-9211.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9161.26" y="-9196.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9161.26" y="-9181.96" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_softmax_gpu5&#45;&gt;tp_layer0_attn_out_gpu5 -->
<g id="edge72" class="edge">
<title>tp_layer0_softmax_gpu5&#45;&gt;tp_layer0_attn_out_gpu5</title>
<path fill="none" stroke="black" d="M9161.26,-9342.23C9161.26,-9342.23 9161.26,-9252.41 9161.26,-9252.41"/>
<polygon fill="black" stroke="black" points="9164.76,-9252.41 9161.26,-9242.41 9157.76,-9252.41 9164.76,-9252.41"/>
</g>
<!-- tp_layer0_out_proj_gpu5 -->
<g id="node63" class="node">
<title>tp_layer0_out_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="8846.76,-9088.16 8357.76,-9088.16 8357.76,-9020.16 8846.76,-9020.16 8846.76,-9088.16"/>
<text text-anchor="middle" x="8602.26" y="-9072.96" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="8602.26" y="-9057.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8602.26" y="-9042.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8602.26" y="-9027.96" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_attn_out_gpu5&#45;&gt;tp_layer0_out_proj_gpu5 -->
<g id="edge74" class="edge">
<title>tp_layer0_attn_out_gpu5&#45;&gt;tp_layer0_out_proj_gpu5</title>
<path fill="none" stroke="black" d="M8897.59,-9208C8824.68,-9208 8765.14,-9208 8765.14,-9208 8765.14,-9208 8765.14,-9098.3 8765.14,-9098.3"/>
<polygon fill="black" stroke="black" points="8768.64,-9098.3 8765.14,-9088.3 8761.64,-9098.3 8768.64,-9098.3"/>
</g>
<!-- tp_layer0_gather_v_gpu5&#45;&gt;tp_layer0_attn_out_gpu5 -->
<g id="edge73" class="edge">
<title>tp_layer0_gather_v_gpu5&#45;&gt;tp_layer0_attn_out_gpu5</title>
<path fill="none" stroke="black" d="M9704.59,-9519.81C9704.59,-9430.85 9704.59,-9219 9704.59,-9219 9704.59,-9219 9434.97,-9219 9434.97,-9219"/>
<polygon fill="black" stroke="black" points="9434.97,-9215.5 9424.97,-9219 9434.97,-9222.5 9434.97,-9215.5"/>
</g>
<!-- tp_layer0_out_proj_gpu5&#45;&gt;tp_layer0_attn_all_reduce -->
<g id="edge104" class="edge">
<title>tp_layer0_out_proj_gpu5&#45;&gt;tp_layer0_attn_all_reduce</title>
<path fill="none" stroke="black" d="M8357.76,-9054C8321.34,-9054 8295.73,-9054 8295.73,-9054 8295.73,-9054 8295.73,-8919.43 8295.73,-8919.43"/>
<polygon fill="black" stroke="black" points="8299.23,-8919.43 8295.73,-8909.43 8292.23,-8919.43 8299.23,-8919.43"/>
</g>
<!-- tp_layer0_gather_q_gpu6 -->
<g id="node69" class="node">
<title>tp_layer0_gather_q_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="10454.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="10454.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="10454.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10454.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10454.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_q_proj_gpu6&#45;&gt;tp_layer0_gather_q_gpu6 -->
<g id="edge78" class="edge">
<title>tp_layer0_q_proj_gpu6&#45;&gt;tp_layer0_gather_q_gpu6</title>
<path fill="none" stroke="black" d="M10561.64,-9874.65C10561.64,-9874.65 10561.64,-9796.65 10561.64,-9796.65"/>
<polygon fill="black" stroke="black" points="10565.14,-9796.65 10561.64,-9786.65 10558.14,-9796.65 10565.14,-9796.65"/>
</g>
<!-- tp_layer0_gather_k_gpu6 -->
<g id="node68" class="node">
<title>tp_layer0_gather_k_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="11221.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="11221.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="11221.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11221.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11221.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_k_proj_gpu6&#45;&gt;tp_layer0_gather_k_gpu6 -->
<g id="edge79" class="edge">
<title>tp_layer0_k_proj_gpu6&#45;&gt;tp_layer0_gather_k_gpu6</title>
<path fill="none" stroke="black" d="M11124.26,-9874.65C11124.26,-9874.65 11124.26,-9796.96 11124.26,-9796.96"/>
<polygon fill="black" stroke="black" points="11127.76,-9796.96 11124.26,-9786.96 11120.76,-9796.96 11127.76,-9796.96"/>
</g>
<!-- tp_layer0_gather_v_gpu6 -->
<g id="node72" class="node">
<title>tp_layer0_gather_v_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="11352.26" cy="-9376.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="11352.26" y="-9395.05" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="11352.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11352.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11352.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_v_proj_gpu6&#45;&gt;tp_layer0_gather_v_gpu6 -->
<g id="edge83" class="edge">
<title>tp_layer0_v_proj_gpu6&#45;&gt;tp_layer0_gather_v_gpu6</title>
<path fill="none" stroke="black" d="M11641.02,-9874.55C11641.02,-9874.55 11641.02,-9414.15 11641.02,-9414.15"/>
<polygon fill="black" stroke="black" points="11644.52,-9414.15 11641.02,-9404.15 11637.52,-9414.15 11644.52,-9414.15"/>
</g>
<!-- tp_layer0_attn_scores_gpu6 -->
<g id="node67" class="node">
<title>tp_layer0_attn_scores_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="10892.76,-9592.41 10353.76,-9592.41 10353.76,-9524.41 10892.76,-9524.41 10892.76,-9592.41"/>
<text text-anchor="middle" x="10623.26" y="-9577.21" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="10623.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10623.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="10623.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_softmax_gpu6 -->
<g id="node70" class="node">
<title>tp_layer0_softmax_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="10892.76,-9410.25 10353.76,-9410.25 10353.76,-9342.25 10892.76,-9342.25 10892.76,-9410.25"/>
<text text-anchor="middle" x="10623.26" y="-9395.05" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="10623.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="10623.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="10623.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_attn_scores_gpu6&#45;&gt;tp_layer0_softmax_gpu6 -->
<g id="edge82" class="edge">
<title>tp_layer0_attn_scores_gpu6&#45;&gt;tp_layer0_softmax_gpu6</title>
<path fill="none" stroke="black" d="M10623.26,-9524.15C10623.26,-9524.15 10623.26,-9420.36 10623.26,-9420.36"/>
<polygon fill="black" stroke="black" points="10626.76,-9420.36 10623.26,-9410.36 10619.76,-9420.36 10626.76,-9420.36"/>
</g>
<!-- tp_layer0_gather_k_gpu6&#45;&gt;tp_layer0_attn_scores_gpu6 -->
<g id="edge81" class="edge">
<title>tp_layer0_gather_k_gpu6&#45;&gt;tp_layer0_attn_scores_gpu6</title>
<path fill="none" stroke="black" d="M10879.88,-9727.48C10879.88,-9727.48 10879.88,-9602.72 10879.88,-9602.72"/>
<polygon fill="black" stroke="black" points="10883.38,-9602.72 10879.88,-9592.72 10876.38,-9602.72 10883.38,-9602.72"/>
</g>
<!-- tp_layer0_gather_q_gpu6&#45;&gt;tp_layer0_attn_scores_gpu6 -->
<g id="edge80" class="edge">
<title>tp_layer0_gather_q_gpu6&#45;&gt;tp_layer0_attn_scores_gpu6</title>
<path fill="none" stroke="black" d="M10581.14,-9695.55C10581.14,-9695.55 10581.14,-9602.64 10581.14,-9602.64"/>
<polygon fill="black" stroke="black" points="10584.64,-9602.64 10581.14,-9592.64 10577.64,-9602.64 10584.64,-9602.64"/>
</g>
<!-- tp_layer0_attn_out_gpu6 -->
<g id="node71" class="node">
<title>tp_layer0_attn_out_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="10886.76,-9242.16 10359.76,-9242.16 10359.76,-9174.16 10886.76,-9174.16 10886.76,-9242.16"/>
<text text-anchor="middle" x="10623.26" y="-9226.96" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="10623.26" y="-9211.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="10623.26" y="-9196.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10623.26" y="-9181.96" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_softmax_gpu6&#45;&gt;tp_layer0_attn_out_gpu6 -->
<g id="edge84" class="edge">
<title>tp_layer0_softmax_gpu6&#45;&gt;tp_layer0_attn_out_gpu6</title>
<path fill="none" stroke="black" d="M10623.26,-9342.23C10623.26,-9342.23 10623.26,-9252.41 10623.26,-9252.41"/>
<polygon fill="black" stroke="black" points="10626.76,-9252.41 10623.26,-9242.41 10619.76,-9252.41 10626.76,-9252.41"/>
</g>
<!-- tp_layer0_out_proj_gpu6 -->
<g id="node73" class="node">
<title>tp_layer0_out_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="9985.76,-9088.16 9496.76,-9088.16 9496.76,-9020.16 9985.76,-9020.16 9985.76,-9088.16"/>
<text text-anchor="middle" x="9741.26" y="-9072.96" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="9741.26" y="-9057.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9741.26" y="-9042.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9741.26" y="-9027.96" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_attn_out_gpu6&#45;&gt;tp_layer0_out_proj_gpu6 -->
<g id="edge86" class="edge">
<title>tp_layer0_attn_out_gpu6&#45;&gt;tp_layer0_out_proj_gpu6</title>
<path fill="none" stroke="black" d="M10359.56,-9196C10133.88,-9196 9845.17,-9196 9845.17,-9196 9845.17,-9196 9845.17,-9098.5 9845.17,-9098.5"/>
<polygon fill="black" stroke="black" points="9848.67,-9098.5 9845.17,-9088.5 9841.67,-9098.5 9848.67,-9098.5"/>
</g>
<!-- tp_layer0_gather_v_gpu6&#45;&gt;tp_layer0_attn_out_gpu6 -->
<g id="edge85" class="edge">
<title>tp_layer0_gather_v_gpu6&#45;&gt;tp_layer0_attn_out_gpu6</title>
<path fill="none" stroke="black" d="M11141.38,-9337.22C11141.38,-9287.52 11141.38,-9208 11141.38,-9208 11141.38,-9208 10896.87,-9208 10896.87,-9208"/>
<polygon fill="black" stroke="black" points="10896.87,-9204.5 10886.87,-9208 10896.87,-9211.5 10896.87,-9204.5"/>
</g>
<!-- tp_layer0_out_proj_gpu6&#45;&gt;tp_layer0_attn_all_reduce -->
<g id="edge105" class="edge">
<title>tp_layer0_out_proj_gpu6&#45;&gt;tp_layer0_attn_all_reduce</title>
<path fill="none" stroke="black" d="M9703.51,-9020.01C9703.51,-8975.15 9703.51,-8902 9703.51,-8902 9703.51,-8902 8329.99,-8902 8329.99,-8902"/>
<polygon fill="black" stroke="black" points="8329.99,-8898.5 8319.99,-8902 8329.99,-8905.5 8329.99,-8898.5"/>
</g>
<!-- tp_layer0_gather_q_gpu7 -->
<g id="node79" class="node">
<title>tp_layer0_gather_q_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="12133.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="12133.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="12133.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12133.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12133.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_q_proj_gpu7&#45;&gt;tp_layer0_gather_q_gpu7 -->
<g id="edge90" class="edge">
<title>tp_layer0_q_proj_gpu7&#45;&gt;tp_layer0_gather_q_gpu7</title>
<path fill="none" stroke="black" d="M12239.64,-9874.65C12239.64,-9874.65 12239.64,-9796.65 12239.64,-9796.65"/>
<polygon fill="black" stroke="black" points="12243.14,-9796.65 12239.64,-9786.65 12236.14,-9796.65 12243.14,-9796.65"/>
</g>
<!-- tp_layer0_gather_k_gpu7 -->
<g id="node78" class="node">
<title>tp_layer0_gather_k_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="12900.26" cy="-9740.58" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="12900.26" y="-9759.38" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="12900.26" y="-9744.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12900.26" y="-9729.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12900.26" y="-9714.38" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_k_proj_gpu7&#45;&gt;tp_layer0_gather_k_gpu7 -->
<g id="edge91" class="edge">
<title>tp_layer0_k_proj_gpu7&#45;&gt;tp_layer0_gather_k_gpu7</title>
<path fill="none" stroke="black" d="M12801.26,-9874.65C12801.26,-9874.65 12801.26,-9796.96 12801.26,-9796.96"/>
<polygon fill="black" stroke="black" points="12804.76,-9796.96 12801.26,-9786.96 12797.76,-9796.96 12804.76,-9796.96"/>
</g>
<!-- tp_layer0_gather_v_gpu7 -->
<g id="node82" class="node">
<title>tp_layer0_gather_v_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="13036.26" cy="-9558.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="13036.26" y="-9577.21" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="13036.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13036.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13036.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_v_proj_gpu7&#45;&gt;tp_layer0_gather_v_gpu7 -->
<g id="edge95" class="edge">
<title>tp_layer0_v_proj_gpu7&#45;&gt;tp_layer0_gather_v_gpu7</title>
<path fill="none" stroke="black" d="M13322.52,-9874.44C13322.52,-9874.44 13322.52,-9596.8 13322.52,-9596.8"/>
<polygon fill="black" stroke="black" points="13326.02,-9596.8 13322.52,-9586.8 13319.02,-9596.8 13326.02,-9596.8"/>
</g>
<!-- tp_layer0_attn_scores_gpu7 -->
<g id="node77" class="node">
<title>tp_layer0_attn_scores_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="12512.76,-9592.41 11973.76,-9592.41 11973.76,-9524.41 12512.76,-9524.41 12512.76,-9592.41"/>
<text text-anchor="middle" x="12243.26" y="-9577.21" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="12243.26" y="-9562.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12243.26" y="-9547.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12243.26" y="-9532.21" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_softmax_gpu7 -->
<g id="node80" class="node">
<title>tp_layer0_softmax_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="12512.76,-9410.25 11973.76,-9410.25 11973.76,-9342.25 12512.76,-9342.25 12512.76,-9410.25"/>
<text text-anchor="middle" x="12243.26" y="-9395.05" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="12243.26" y="-9380.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12243.26" y="-9365.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12243.26" y="-9350.05" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_attn_scores_gpu7&#45;&gt;tp_layer0_softmax_gpu7 -->
<g id="edge94" class="edge">
<title>tp_layer0_attn_scores_gpu7&#45;&gt;tp_layer0_softmax_gpu7</title>
<path fill="none" stroke="black" d="M12243.26,-9524.15C12243.26,-9524.15 12243.26,-9420.36 12243.26,-9420.36"/>
<polygon fill="black" stroke="black" points="12246.76,-9420.36 12243.26,-9410.36 12239.76,-9420.36 12246.76,-9420.36"/>
</g>
<!-- tp_layer0_gather_k_gpu7&#45;&gt;tp_layer0_attn_scores_gpu7 -->
<g id="edge93" class="edge">
<title>tp_layer0_gather_k_gpu7&#45;&gt;tp_layer0_attn_scores_gpu7</title>
<path fill="none" stroke="black" d="M12545.68,-9740C12519.32,-9740 12502.76,-9740 12502.76,-9740 12502.76,-9740 12502.76,-9602.57 12502.76,-9602.57"/>
<polygon fill="black" stroke="black" points="12506.26,-9602.57 12502.76,-9592.57 12499.26,-9602.57 12506.26,-9602.57"/>
</g>
<!-- tp_layer0_gather_q_gpu7&#45;&gt;tp_layer0_attn_scores_gpu7 -->
<g id="edge92" class="edge">
<title>tp_layer0_gather_q_gpu7&#45;&gt;tp_layer0_attn_scores_gpu7</title>
<path fill="none" stroke="black" d="M12230.64,-9694.14C12230.64,-9694.14 12230.64,-9602.69 12230.64,-9602.69"/>
<polygon fill="black" stroke="black" points="12234.14,-9602.69 12230.64,-9592.69 12227.14,-9602.69 12234.14,-9602.69"/>
</g>
<!-- tp_layer0_attn_out_gpu7 -->
<g id="node81" class="node">
<title>tp_layer0_attn_out_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="12506.76,-9242.16 11979.76,-9242.16 11979.76,-9174.16 12506.76,-9174.16 12506.76,-9242.16"/>
<text text-anchor="middle" x="12243.26" y="-9226.96" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="12243.26" y="-9211.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12243.26" y="-9196.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12243.26" y="-9181.96" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_softmax_gpu7&#45;&gt;tp_layer0_attn_out_gpu7 -->
<g id="edge96" class="edge">
<title>tp_layer0_softmax_gpu7&#45;&gt;tp_layer0_attn_out_gpu7</title>
<path fill="none" stroke="black" d="M12243.26,-9342.23C12243.26,-9342.23 12243.26,-9252.41 12243.26,-9252.41"/>
<polygon fill="black" stroke="black" points="12246.76,-9252.41 12243.26,-9242.41 12239.76,-9252.41 12246.76,-9252.41"/>
</g>
<!-- tp_layer0_out_proj_gpu7 -->
<g id="node83" class="node">
<title>tp_layer0_out_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="11284.76,-9088.16 10795.76,-9088.16 10795.76,-9020.16 11284.76,-9020.16 11284.76,-9088.16"/>
<text text-anchor="middle" x="11040.26" y="-9072.96" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="11040.26" y="-9057.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11040.26" y="-9042.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="11040.26" y="-9027.96" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_attn_out_gpu7&#45;&gt;tp_layer0_out_proj_gpu7 -->
<g id="edge98" class="edge">
<title>tp_layer0_attn_out_gpu7&#45;&gt;tp_layer0_out_proj_gpu7</title>
<path fill="none" stroke="black" d="M12073.01,-9173.95C12073.01,-9128.53 12073.01,-9054 12073.01,-9054 12073.01,-9054 11295.01,-9054 11295.01,-9054"/>
<polygon fill="black" stroke="black" points="11295.01,-9050.5 11285.01,-9054 11295.01,-9057.5 11295.01,-9050.5"/>
</g>
<!-- tp_layer0_gather_v_gpu7&#45;&gt;tp_layer0_attn_out_gpu7 -->
<g id="edge97" class="edge">
<title>tp_layer0_gather_v_gpu7&#45;&gt;tp_layer0_attn_out_gpu7</title>
<path fill="none" stroke="black" d="M12706.13,-9540.55C12706.13,-9469.15 12706.13,-9208 12706.13,-9208 12706.13,-9208 12516.81,-9208 12516.81,-9208"/>
<polygon fill="black" stroke="black" points="12516.81,-9204.5 12506.81,-9208 12516.81,-9211.5 12516.81,-9204.5"/>
</g>
<!-- tp_layer0_out_proj_gpu7&#45;&gt;tp_layer0_attn_all_reduce -->
<g id="edge106" class="edge">
<title>tp_layer0_out_proj_gpu7&#45;&gt;tp_layer0_attn_all_reduce</title>
<path fill="none" stroke="black" d="M11040.26,-9019.96C11040.26,-8966.7 11040.26,-8870 11040.26,-8870 11040.26,-8870 8329.6,-8870 8329.6,-8870"/>
<polygon fill="black" stroke="black" points="8329.6,-8866.5 8319.6,-8870 8329.6,-8873.5 8329.6,-8866.5"/>
</g>
<!-- tp_layer0_attn_all_reduce&#45;&gt;tp_layer0_attn_residual -->
<g id="edge108" class="edge">
<title>tp_layer0_attn_all_reduce&#45;&gt;tp_layer0_attn_residual</title>
<path fill="none" stroke="black" d="M8310.23,-8866.49C8310.23,-8819.26 8310.23,-8703 8310.23,-8703 8310.23,-8703 10016.77,-8703 10016.77,-8703"/>
<polygon fill="black" stroke="black" points="10016.77,-8706.5 10026.77,-8703 10016.77,-8699.5 10016.77,-8706.5"/>
</g>
<!-- tp_layer0_moe_norm -->
<g id="node86" class="node">
<title>tp_layer0_moe_norm</title>
<polygon fill="lightyellow" stroke="black" points="8777.76,-8569.83 8280.76,-8569.83 8280.76,-8501.83 8777.76,-8501.83 8777.76,-8569.83"/>
<text text-anchor="middle" x="8529.26" y="-8554.63" font-family="Times,serif" font-size="14.00">Layer Norm</text>
<text text-anchor="middle" x="8529.26" y="-8539.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8529.26" y="-8524.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8529.26" y="-8509.63" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer0_attn_residual&#45;&gt;tp_layer0_moe_norm -->
<g id="edge109" class="edge">
<title>tp_layer0_attn_residual&#45;&gt;tp_layer0_moe_norm</title>
<path fill="none" stroke="black" d="M10250.61,-8667.37C10250.61,-8625.32 10250.61,-8562 10250.61,-8562 10250.61,-8562 8788.18,-8562 8788.18,-8562"/>
<polygon fill="black" stroke="black" points="8788.18,-8558.5 8778.18,-8562 8788.18,-8565.5 8788.18,-8558.5"/>
</g>
<!-- tp_layer0_final_residual -->
<g id="node136" class="node">
<title>tp_layer0_final_residual</title>
<ellipse fill="lightblue" stroke="black" cx="10673.26" cy="-7723.58" rx="646.09" ry="48.17"/>
<text text-anchor="middle" x="10673.26" y="-7742.38" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="10673.26" y="-7727.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096], [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10673.26" y="-7712.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10673.26" y="-7697.38" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer0_attn_residual&#45;&gt;tp_layer0_final_residual -->
<g id="edge174" class="edge">
<title>tp_layer0_attn_residual&#45;&gt;tp_layer0_final_residual</title>
<path fill="none" stroke="black" d="M11064.76,-8665.48C11064.76,-8665.48 11064.76,-7772.01 11064.76,-7772.01"/>
<polygon fill="black" stroke="black" points="11068.26,-7772.01 11064.76,-7762.01 11061.26,-7772.01 11068.26,-7772.01"/>
</g>
<!-- tp_layer0_expert0_up -->
<g id="node87" class="node">
<title>tp_layer0_expert0_up</title>
<polygon fill="lightcoral" stroke="black" points="4270.26,-8415.83 3764.26,-8415.83 3764.26,-8347.83 4270.26,-8347.83 4270.26,-8415.83"/>
<text text-anchor="middle" x="4017.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 0 Up</text>
<text text-anchor="middle" x="4017.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4017.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4017.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert0_up -->
<g id="edge110" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert0_up</title>
<path fill="none" stroke="black" d="M8280.59,-8562C7362.19,-8562 4214.26,-8562 4214.26,-8562 4214.26,-8562 4214.26,-8426.14 4214.26,-8426.14"/>
<polygon fill="black" stroke="black" points="4217.76,-8426.14 4214.26,-8416.14 4210.76,-8426.14 4217.76,-8426.14"/>
</g>
<!-- tp_layer0_expert1_up -->
<g id="node90" class="node">
<title>tp_layer0_expert1_up</title>
<polygon fill="lightcoral" stroke="black" points="4834.26,-8415.83 4328.26,-8415.83 4328.26,-8347.83 4834.26,-8347.83 4834.26,-8415.83"/>
<text text-anchor="middle" x="4581.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 1 Up</text>
<text text-anchor="middle" x="4581.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4581.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4581.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert1_up -->
<g id="edge113" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert1_up</title>
<path fill="none" stroke="black" d="M8280.41,-8554C7445.64,-8554 4797.13,-8554 4797.13,-8554 4797.13,-8554 4797.13,-8425.85 4797.13,-8425.85"/>
<polygon fill="black" stroke="black" points="4800.63,-8425.85 4797.13,-8415.85 4793.63,-8425.85 4800.63,-8425.85"/>
</g>
<!-- tp_layer0_expert2_up -->
<g id="node93" class="node">
<title>tp_layer0_expert2_up</title>
<polygon fill="lightcoral" stroke="black" points="5398.26,-8415.83 4892.26,-8415.83 4892.26,-8347.83 5398.26,-8347.83 5398.26,-8415.83"/>
<text text-anchor="middle" x="5145.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 2 Up</text>
<text text-anchor="middle" x="5145.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5145.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5145.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert2_up -->
<g id="edge116" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert2_up</title>
<path fill="none" stroke="black" d="M8280.74,-8547C7537.5,-8547 5383.01,-8547 5383.01,-8547 5383.01,-8547 5383.01,-8426.05 5383.01,-8426.05"/>
<polygon fill="black" stroke="black" points="5386.51,-8426.05 5383.01,-8416.05 5379.51,-8426.05 5386.51,-8426.05"/>
</g>
<!-- tp_layer0_expert3_up -->
<g id="node96" class="node">
<title>tp_layer0_expert3_up</title>
<polygon fill="lightcoral" stroke="black" points="5962.26,-8415.83 5456.26,-8415.83 5456.26,-8347.83 5962.26,-8347.83 5962.26,-8415.83"/>
<text text-anchor="middle" x="5709.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 3 Up</text>
<text text-anchor="middle" x="5709.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5709.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5709.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert3_up -->
<g id="edge119" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert3_up</title>
<path fill="none" stroke="black" d="M8280.73,-8539C7627.02,-8539 5909.51,-8539 5909.51,-8539 5909.51,-8539 5909.51,-8425.93 5909.51,-8425.93"/>
<polygon fill="black" stroke="black" points="5913.01,-8425.93 5909.51,-8415.93 5906.01,-8425.93 5913.01,-8425.93"/>
</g>
<!-- tp_layer0_expert4_up -->
<g id="node99" class="node">
<title>tp_layer0_expert4_up</title>
<polygon fill="lightcoral" stroke="black" points="6526.26,-8415.83 6020.26,-8415.83 6020.26,-8347.83 6526.26,-8347.83 6526.26,-8415.83"/>
<text text-anchor="middle" x="6273.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 4 Up</text>
<text text-anchor="middle" x="6273.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6273.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6273.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert4_up -->
<g id="edge122" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert4_up</title>
<path fill="none" stroke="black" d="M8280.56,-8532C7742.72,-8532 6519.51,-8532 6519.51,-8532 6519.51,-8532 6519.51,-8425.91 6519.51,-8425.91"/>
<polygon fill="black" stroke="black" points="6523.01,-8425.91 6519.51,-8415.91 6516.01,-8425.91 6523.01,-8425.91"/>
</g>
<!-- tp_layer0_expert5_up -->
<g id="node102" class="node">
<title>tp_layer0_expert5_up</title>
<polygon fill="lightcoral" stroke="black" points="7090.26,-8415.83 6584.26,-8415.83 6584.26,-8347.83 7090.26,-8347.83 7090.26,-8415.83"/>
<text text-anchor="middle" x="6837.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 5 Up</text>
<text text-anchor="middle" x="6837.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6837.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6837.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert5_up -->
<g id="edge125" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert5_up</title>
<path fill="none" stroke="black" d="M8280.37,-8524C7848.62,-8524 7006.51,-8524 7006.51,-8524 7006.51,-8524 7006.51,-8425.88 7006.51,-8425.88"/>
<polygon fill="black" stroke="black" points="7010.01,-8425.88 7006.51,-8415.88 7003.01,-8425.88 7010.01,-8425.88"/>
</g>
<!-- tp_layer0_expert6_up -->
<g id="node105" class="node">
<title>tp_layer0_expert6_up</title>
<polygon fill="lightcoral" stroke="black" points="7654.26,-8415.83 7148.26,-8415.83 7148.26,-8347.83 7654.26,-8347.83 7654.26,-8415.83"/>
<text text-anchor="middle" x="7401.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 6 Up</text>
<text text-anchor="middle" x="7401.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7401.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7401.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert6_up -->
<g id="edge128" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert6_up</title>
<path fill="none" stroke="black" d="M8280.74,-8516C8019.36,-8516 7645.54,-8516 7645.54,-8516 7645.54,-8516 7645.54,-8426.03 7645.54,-8426.03"/>
<polygon fill="black" stroke="black" points="7649.04,-8426.03 7645.54,-8416.03 7642.04,-8426.03 7649.04,-8426.03"/>
</g>
<!-- tp_layer0_expert7_up -->
<g id="node108" class="node">
<title>tp_layer0_expert7_up</title>
<polygon fill="lightcoral" stroke="black" points="8218.26,-8415.83 7712.26,-8415.83 7712.26,-8347.83 8218.26,-8347.83 8218.26,-8415.83"/>
<text text-anchor="middle" x="7965.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 7 Up</text>
<text text-anchor="middle" x="7965.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7965.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7965.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert7_up -->
<g id="edge131" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert7_up</title>
<path fill="none" stroke="black" d="M8280.65,-8509C8129.45,-8509 7965.26,-8509 7965.26,-8509 7965.26,-8509 7965.26,-8425.91 7965.26,-8425.91"/>
<polygon fill="black" stroke="black" points="7968.76,-8425.91 7965.26,-8415.91 7961.76,-8425.91 7968.76,-8425.91"/>
</g>
<!-- tp_layer0_expert8_up -->
<g id="node111" class="node">
<title>tp_layer0_expert8_up</title>
<polygon fill="lightcoral" stroke="black" points="8782.26,-8415.83 8276.26,-8415.83 8276.26,-8347.83 8782.26,-8347.83 8782.26,-8415.83"/>
<text text-anchor="middle" x="8529.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 8 Up</text>
<text text-anchor="middle" x="8529.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8529.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8529.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert8_up -->
<g id="edge134" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert8_up</title>
<path fill="none" stroke="black" d="M8529.26,-8501.65C8529.26,-8501.65 8529.26,-8425.91 8529.26,-8425.91"/>
<polygon fill="black" stroke="black" points="8532.76,-8425.91 8529.26,-8415.91 8525.76,-8425.91 8532.76,-8425.91"/>
</g>
<!-- tp_layer0_expert9_up -->
<g id="node114" class="node">
<title>tp_layer0_expert9_up</title>
<polygon fill="lightcoral" stroke="black" points="9346.26,-8415.83 8840.26,-8415.83 8840.26,-8347.83 9346.26,-8347.83 9346.26,-8415.83"/>
<text text-anchor="middle" x="9093.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 9 Up</text>
<text text-anchor="middle" x="9093.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9093.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9093.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert9_up -->
<g id="edge137" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert9_up</title>
<path fill="none" stroke="black" d="M8778.15,-8509C8829.99,-8509 8869.26,-8509 8869.26,-8509 8869.26,-8509 8869.26,-8425.91 8869.26,-8425.91"/>
<polygon fill="black" stroke="black" points="8872.76,-8425.91 8869.26,-8415.91 8865.76,-8425.91 8872.76,-8425.91"/>
</g>
<!-- tp_layer0_expert10_up -->
<g id="node117" class="node">
<title>tp_layer0_expert10_up</title>
<polygon fill="lightcoral" stroke="black" points="9910.26,-8415.83 9404.26,-8415.83 9404.26,-8347.83 9910.26,-8347.83 9910.26,-8415.83"/>
<text text-anchor="middle" x="9657.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 10 Up</text>
<text text-anchor="middle" x="9657.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9657.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9657.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert10_up -->
<g id="edge140" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert10_up</title>
<path fill="none" stroke="black" d="M8777.91,-8516C9039.76,-8516 9414.51,-8516 9414.51,-8516 9414.51,-8516 9414.51,-8426.03 9414.51,-8426.03"/>
<polygon fill="black" stroke="black" points="9418.01,-8426.03 9414.51,-8416.03 9411.01,-8426.03 9418.01,-8426.03"/>
</g>
<!-- tp_layer0_expert11_up -->
<g id="node120" class="node">
<title>tp_layer0_expert11_up</title>
<polygon fill="lightcoral" stroke="black" points="10474.26,-8415.83 9968.26,-8415.83 9968.26,-8347.83 10474.26,-8347.83 10474.26,-8415.83"/>
<text text-anchor="middle" x="10221.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 11 Up</text>
<text text-anchor="middle" x="10221.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10221.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10221.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert11_up -->
<g id="edge143" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert11_up</title>
<path fill="none" stroke="black" d="M8778.14,-8524C9192.07,-8524 9977.01,-8524 9977.01,-8524 9977.01,-8524 9977.01,-8425.88 9977.01,-8425.88"/>
<polygon fill="black" stroke="black" points="9980.51,-8425.88 9977.01,-8415.88 9973.51,-8425.88 9980.51,-8425.88"/>
</g>
<!-- tp_layer0_expert12_up -->
<g id="node123" class="node">
<title>tp_layer0_expert12_up</title>
<polygon fill="lightcoral" stroke="black" points="11038.26,-8415.83 10532.26,-8415.83 10532.26,-8347.83 11038.26,-8347.83 11038.26,-8415.83"/>
<text text-anchor="middle" x="10785.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 12 Up</text>
<text text-anchor="middle" x="10785.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10785.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10785.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert12_up -->
<g id="edge146" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert12_up</title>
<path fill="none" stroke="black" d="M8777.96,-8532C9364.5,-8532 10785.26,-8532 10785.26,-8532 10785.26,-8532 10785.26,-8425.91 10785.26,-8425.91"/>
<polygon fill="black" stroke="black" points="10788.76,-8425.91 10785.26,-8415.91 10781.76,-8425.91 10788.76,-8425.91"/>
</g>
<!-- tp_layer0_expert13_up -->
<g id="node126" class="node">
<title>tp_layer0_expert13_up</title>
<polygon fill="lightcoral" stroke="black" points="11602.26,-8415.83 11096.26,-8415.83 11096.26,-8347.83 11602.26,-8347.83 11602.26,-8415.83"/>
<text text-anchor="middle" x="11349.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 13 Up</text>
<text text-anchor="middle" x="11349.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11349.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11349.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert13_up -->
<g id="edge149" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert13_up</title>
<path fill="none" stroke="black" d="M8777.96,-8539C9442.24,-8539 11207.91,-8539 11207.91,-8539 11207.91,-8539 11207.91,-8425.93 11207.91,-8425.93"/>
<polygon fill="black" stroke="black" points="11211.41,-8425.93 11207.91,-8415.93 11204.41,-8425.93 11211.41,-8425.93"/>
</g>
<!-- tp_layer0_expert14_up -->
<g id="node129" class="node">
<title>tp_layer0_expert14_up</title>
<polygon fill="lightcoral" stroke="black" points="12166.26,-8415.83 11660.26,-8415.83 11660.26,-8347.83 12166.26,-8347.83 12166.26,-8415.83"/>
<text text-anchor="middle" x="11913.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 14 Up</text>
<text text-anchor="middle" x="11913.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11913.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11913.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert14_up -->
<g id="edge152" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert14_up</title>
<path fill="none" stroke="black" d="M8778.08,-8547C9522.87,-8547 11683.39,-8547 11683.39,-8547 11683.39,-8547 11683.39,-8426.05 11683.39,-8426.05"/>
<polygon fill="black" stroke="black" points="11686.89,-8426.05 11683.39,-8416.05 11679.89,-8426.05 11686.89,-8426.05"/>
</g>
<!-- tp_layer0_expert15_up -->
<g id="node132" class="node">
<title>tp_layer0_expert15_up</title>
<polygon fill="lightcoral" stroke="black" points="12730.26,-8415.83 12224.26,-8415.83 12224.26,-8347.83 12730.26,-8347.83 12730.26,-8415.83"/>
<text text-anchor="middle" x="12477.26" y="-8400.63" font-family="Times,serif" font-size="14.00">Expert 15 Up</text>
<text text-anchor="middle" x="12477.26" y="-8385.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12477.26" y="-8370.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12477.26" y="-8355.63" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_moe_norm&#45;&gt;tp_layer0_expert15_up -->
<g id="edge155" class="edge">
<title>tp_layer0_moe_norm&#45;&gt;tp_layer0_expert15_up</title>
<path fill="none" stroke="black" d="M8778.01,-8554C9628.1,-8554 12365.51,-8554 12365.51,-8554 12365.51,-8554 12365.51,-8425.85 12365.51,-8425.85"/>
<polygon fill="black" stroke="black" points="12369.01,-8425.85 12365.51,-8415.85 12362.01,-8425.85 12369.01,-8425.85"/>
</g>
<!-- tp_layer0_expert0_activation -->
<g id="node88" class="node">
<title>tp_layer0_expert0_activation</title>
<polygon fill="lightyellow" stroke="black" points="4270.26,-8261.83 3764.26,-8261.83 3764.26,-8193.83 4270.26,-8193.83 4270.26,-8261.83"/>
<text text-anchor="middle" x="4017.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="4017.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4017.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4017.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_expert0_up&#45;&gt;tp_layer0_expert0_activation -->
<g id="edge111" class="edge">
<title>tp_layer0_expert0_up&#45;&gt;tp_layer0_expert0_activation</title>
<path fill="none" stroke="black" d="M4017.26,-8347.65C4017.26,-8347.65 4017.26,-8271.91 4017.26,-8271.91"/>
<polygon fill="black" stroke="black" points="4020.76,-8271.91 4017.26,-8261.91 4013.76,-8271.91 4020.76,-8271.91"/>
</g>
<!-- tp_layer0_expert0_down -->
<g id="node89" class="node">
<title>tp_layer0_expert0_down</title>
<polygon fill="lightcoral" stroke="black" points="4276.26,-8107.83 3782.26,-8107.83 3782.26,-8039.83 4276.26,-8039.83 4276.26,-8107.83"/>
<text text-anchor="middle" x="4029.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 0 Down</text>
<text text-anchor="middle" x="4029.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4029.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4029.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_expert0_activation&#45;&gt;tp_layer0_expert0_down -->
<g id="edge112" class="edge">
<title>tp_layer0_expert0_activation&#45;&gt;tp_layer0_expert0_down</title>
<path fill="none" stroke="black" d="M4026.26,-8193.65C4026.26,-8193.65 4026.26,-8117.91 4026.26,-8117.91"/>
<polygon fill="black" stroke="black" points="4029.76,-8117.91 4026.26,-8107.91 4022.76,-8117.91 4029.76,-8117.91"/>
</g>
<!-- tp_layer0_moe_all_reduce -->
<g id="node135" class="node">
<title>tp_layer0_moe_all_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="8529.26" cy="-7905.75" rx="351.36" ry="48.17"/>
<text text-anchor="middle" x="8529.26" y="-7924.55" font-family="Times,serif" font-size="14.00">All&#45;Reduce MoE</text>
<text text-anchor="middle" x="8529.26" y="-7909.55" font-family="Times,serif" font-size="14.00">Input: 8×[512]</text>
<text text-anchor="middle" x="8529.26" y="-7894.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8529.26" y="-7879.55" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer0_expert0_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge158" class="edge">
<title>tp_layer0_expert0_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M4050.51,-8039.55C4050.51,-7981.24 4050.51,-7869 4050.51,-7869 4050.51,-7869 8292.55,-7869 8292.55,-7869"/>
<polygon fill="black" stroke="black" points="8292.55,-7872.5 8302.55,-7869 8292.55,-7865.5 8292.55,-7872.5"/>
</g>
<!-- tp_layer0_expert1_activation -->
<g id="node91" class="node">
<title>tp_layer0_expert1_activation</title>
<polygon fill="lightyellow" stroke="black" points="4834.26,-8261.83 4328.26,-8261.83 4328.26,-8193.83 4834.26,-8193.83 4834.26,-8261.83"/>
<text text-anchor="middle" x="4581.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="4581.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4581.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4581.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_expert1_up&#45;&gt;tp_layer0_expert1_activation -->
<g id="edge114" class="edge">
<title>tp_layer0_expert1_up&#45;&gt;tp_layer0_expert1_activation</title>
<path fill="none" stroke="black" d="M4581.26,-8347.65C4581.26,-8347.65 4581.26,-8271.91 4581.26,-8271.91"/>
<polygon fill="black" stroke="black" points="4584.76,-8271.91 4581.26,-8261.91 4577.76,-8271.91 4584.76,-8271.91"/>
</g>
<!-- tp_layer0_expert1_down -->
<g id="node92" class="node">
<title>tp_layer0_expert1_down</title>
<polygon fill="lightcoral" stroke="black" points="4834.26,-8107.83 4340.26,-8107.83 4340.26,-8039.83 4834.26,-8039.83 4834.26,-8107.83"/>
<text text-anchor="middle" x="4587.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 1 Down</text>
<text text-anchor="middle" x="4587.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4587.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4587.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer0_expert1_activation&#45;&gt;tp_layer0_expert1_down -->
<g id="edge115" class="edge">
<title>tp_layer0_expert1_activation&#45;&gt;tp_layer0_expert1_down</title>
<path fill="none" stroke="black" d="M4587.26,-8193.65C4587.26,-8193.65 4587.26,-8117.91 4587.26,-8117.91"/>
<polygon fill="black" stroke="black" points="4590.76,-8117.91 4587.26,-8107.91 4583.76,-8117.91 4590.76,-8117.91"/>
</g>
<!-- tp_layer0_expert1_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge159" class="edge">
<title>tp_layer0_expert1_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M4609.01,-8039.8C4609.01,-7984.44 4609.01,-7881 4609.01,-7881 4609.01,-7881 8217.75,-7881 8217.75,-7881"/>
<polygon fill="black" stroke="black" points="8217.75,-7884.5 8227.75,-7881 8217.75,-7877.5 8217.75,-7884.5"/>
</g>
<!-- tp_layer0_expert2_activation -->
<g id="node94" class="node">
<title>tp_layer0_expert2_activation</title>
<polygon fill="lightyellow" stroke="black" points="5398.26,-8261.83 4892.26,-8261.83 4892.26,-8193.83 5398.26,-8193.83 5398.26,-8261.83"/>
<text text-anchor="middle" x="5145.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="5145.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5145.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5145.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_expert2_up&#45;&gt;tp_layer0_expert2_activation -->
<g id="edge117" class="edge">
<title>tp_layer0_expert2_up&#45;&gt;tp_layer0_expert2_activation</title>
<path fill="none" stroke="black" d="M5145.26,-8347.65C5145.26,-8347.65 5145.26,-8271.91 5145.26,-8271.91"/>
<polygon fill="black" stroke="black" points="5148.76,-8271.91 5145.26,-8261.91 5141.76,-8271.91 5148.76,-8271.91"/>
</g>
<!-- tp_layer0_expert2_down -->
<g id="node95" class="node">
<title>tp_layer0_expert2_down</title>
<polygon fill="lightcoral" stroke="black" points="5398.26,-8107.83 4904.26,-8107.83 4904.26,-8039.83 5398.26,-8039.83 5398.26,-8107.83"/>
<text text-anchor="middle" x="5151.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 2 Down</text>
<text text-anchor="middle" x="5151.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5151.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5151.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_expert2_activation&#45;&gt;tp_layer0_expert2_down -->
<g id="edge118" class="edge">
<title>tp_layer0_expert2_activation&#45;&gt;tp_layer0_expert2_down</title>
<path fill="none" stroke="black" d="M5151.26,-8193.65C5151.26,-8193.65 5151.26,-8117.91 5151.26,-8117.91"/>
<polygon fill="black" stroke="black" points="5154.76,-8117.91 5151.26,-8107.91 5147.76,-8117.91 5154.76,-8117.91"/>
</g>
<!-- tp_layer0_expert2_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge160" class="edge">
<title>tp_layer0_expert2_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M5170.51,-8039.82C5170.51,-7987.44 5170.51,-7893 5170.51,-7893 5170.51,-7893 8180.28,-7893 8180.28,-7893"/>
<polygon fill="black" stroke="black" points="8180.28,-7896.5 8190.28,-7893 8180.28,-7889.5 8180.28,-7896.5"/>
</g>
<!-- tp_layer0_expert3_activation -->
<g id="node97" class="node">
<title>tp_layer0_expert3_activation</title>
<polygon fill="lightyellow" stroke="black" points="5962.26,-8261.83 5456.26,-8261.83 5456.26,-8193.83 5962.26,-8193.83 5962.26,-8261.83"/>
<text text-anchor="middle" x="5709.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="5709.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5709.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5709.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_expert3_up&#45;&gt;tp_layer0_expert3_activation -->
<g id="edge120" class="edge">
<title>tp_layer0_expert3_up&#45;&gt;tp_layer0_expert3_activation</title>
<path fill="none" stroke="black" d="M5709.26,-8347.65C5709.26,-8347.65 5709.26,-8271.91 5709.26,-8271.91"/>
<polygon fill="black" stroke="black" points="5712.76,-8271.91 5709.26,-8261.91 5705.76,-8271.91 5712.76,-8271.91"/>
</g>
<!-- tp_layer0_expert3_down -->
<g id="node98" class="node">
<title>tp_layer0_expert3_down</title>
<polygon fill="lightcoral" stroke="black" points="5962.26,-8107.83 5468.26,-8107.83 5468.26,-8039.83 5962.26,-8039.83 5962.26,-8107.83"/>
<text text-anchor="middle" x="5715.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 3 Down</text>
<text text-anchor="middle" x="5715.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5715.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5715.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer0_expert3_activation&#45;&gt;tp_layer0_expert3_down -->
<g id="edge121" class="edge">
<title>tp_layer0_expert3_activation&#45;&gt;tp_layer0_expert3_down</title>
<path fill="none" stroke="black" d="M5715.26,-8193.65C5715.26,-8193.65 5715.26,-8117.91 5715.26,-8117.91"/>
<polygon fill="black" stroke="black" points="5718.76,-8117.91 5715.26,-8107.91 5711.76,-8117.91 5718.76,-8117.91"/>
</g>
<!-- tp_layer0_expert3_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge161" class="edge">
<title>tp_layer0_expert3_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M5732.01,-8039.66C5732.01,-7990.33 5732.01,-7905 5732.01,-7905 5732.01,-7905 8167.82,-7905 8167.82,-7905"/>
<polygon fill="black" stroke="black" points="8167.82,-7908.5 8177.82,-7905 8167.82,-7901.5 8167.82,-7908.5"/>
</g>
<!-- tp_layer0_expert4_activation -->
<g id="node100" class="node">
<title>tp_layer0_expert4_activation</title>
<polygon fill="lightyellow" stroke="black" points="6526.26,-8261.83 6020.26,-8261.83 6020.26,-8193.83 6526.26,-8193.83 6526.26,-8261.83"/>
<text text-anchor="middle" x="6273.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="6273.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6273.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6273.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_expert4_up&#45;&gt;tp_layer0_expert4_activation -->
<g id="edge123" class="edge">
<title>tp_layer0_expert4_up&#45;&gt;tp_layer0_expert4_activation</title>
<path fill="none" stroke="black" d="M6273.26,-8347.65C6273.26,-8347.65 6273.26,-8271.91 6273.26,-8271.91"/>
<polygon fill="black" stroke="black" points="6276.76,-8271.91 6273.26,-8261.91 6269.76,-8271.91 6276.76,-8271.91"/>
</g>
<!-- tp_layer0_expert4_down -->
<g id="node101" class="node">
<title>tp_layer0_expert4_down</title>
<polygon fill="lightcoral" stroke="black" points="6526.26,-8107.83 6032.26,-8107.83 6032.26,-8039.83 6526.26,-8039.83 6526.26,-8107.83"/>
<text text-anchor="middle" x="6279.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 4 Down</text>
<text text-anchor="middle" x="6279.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6279.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6279.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_expert4_activation&#45;&gt;tp_layer0_expert4_down -->
<g id="edge124" class="edge">
<title>tp_layer0_expert4_activation&#45;&gt;tp_layer0_expert4_down</title>
<path fill="none" stroke="black" d="M6279.26,-8193.65C6279.26,-8193.65 6279.26,-8117.91 6279.26,-8117.91"/>
<polygon fill="black" stroke="black" points="6282.76,-8117.91 6279.26,-8107.91 6275.76,-8117.91 6282.76,-8117.91"/>
</g>
<!-- tp_layer0_expert4_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge162" class="edge">
<title>tp_layer0_expert4_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M6293.51,-8039.8C6293.51,-7993.68 6293.51,-7917 6293.51,-7917 6293.51,-7917 8177.57,-7917 8177.57,-7917"/>
<polygon fill="black" stroke="black" points="8177.57,-7920.5 8187.57,-7917 8177.57,-7913.5 8177.57,-7920.5"/>
</g>
<!-- tp_layer0_expert5_activation -->
<g id="node103" class="node">
<title>tp_layer0_expert5_activation</title>
<polygon fill="lightyellow" stroke="black" points="7090.26,-8261.83 6584.26,-8261.83 6584.26,-8193.83 7090.26,-8193.83 7090.26,-8261.83"/>
<text text-anchor="middle" x="6837.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="6837.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6837.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6837.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_expert5_up&#45;&gt;tp_layer0_expert5_activation -->
<g id="edge126" class="edge">
<title>tp_layer0_expert5_up&#45;&gt;tp_layer0_expert5_activation</title>
<path fill="none" stroke="black" d="M6837.26,-8347.65C6837.26,-8347.65 6837.26,-8271.91 6837.26,-8271.91"/>
<polygon fill="black" stroke="black" points="6840.76,-8271.91 6837.26,-8261.91 6833.76,-8271.91 6840.76,-8271.91"/>
</g>
<!-- tp_layer0_expert5_down -->
<g id="node104" class="node">
<title>tp_layer0_expert5_down</title>
<polygon fill="lightcoral" stroke="black" points="7093.26,-8107.83 6599.26,-8107.83 6599.26,-8039.83 7093.26,-8039.83 7093.26,-8107.83"/>
<text text-anchor="middle" x="6846.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 5 Down</text>
<text text-anchor="middle" x="6846.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6846.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6846.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer0_expert5_activation&#45;&gt;tp_layer0_expert5_down -->
<g id="edge127" class="edge">
<title>tp_layer0_expert5_activation&#45;&gt;tp_layer0_expert5_down</title>
<path fill="none" stroke="black" d="M6844.76,-8193.65C6844.76,-8193.65 6844.76,-8117.91 6844.76,-8117.91"/>
<polygon fill="black" stroke="black" points="6848.26,-8117.91 6844.76,-8107.91 6841.26,-8117.91 6848.26,-8117.91"/>
</g>
<!-- tp_layer0_expert5_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge163" class="edge">
<title>tp_layer0_expert5_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M6856.51,-8039.51C6856.51,-7996.68 6856.51,-7929 6856.51,-7929 6856.51,-7929 8211.48,-7929 8211.48,-7929"/>
<polygon fill="black" stroke="black" points="8211.48,-7932.5 8221.48,-7929 8211.48,-7925.5 8211.48,-7932.5"/>
</g>
<!-- tp_layer0_expert6_activation -->
<g id="node106" class="node">
<title>tp_layer0_expert6_activation</title>
<polygon fill="lightyellow" stroke="black" points="7654.26,-8261.83 7148.26,-8261.83 7148.26,-8193.83 7654.26,-8193.83 7654.26,-8261.83"/>
<text text-anchor="middle" x="7401.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="7401.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7401.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7401.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_expert6_up&#45;&gt;tp_layer0_expert6_activation -->
<g id="edge129" class="edge">
<title>tp_layer0_expert6_up&#45;&gt;tp_layer0_expert6_activation</title>
<path fill="none" stroke="black" d="M7401.26,-8347.65C7401.26,-8347.65 7401.26,-8271.91 7401.26,-8271.91"/>
<polygon fill="black" stroke="black" points="7404.76,-8271.91 7401.26,-8261.91 7397.76,-8271.91 7404.76,-8271.91"/>
</g>
<!-- tp_layer0_expert6_down -->
<g id="node107" class="node">
<title>tp_layer0_expert6_down</title>
<polygon fill="lightcoral" stroke="black" points="7654.26,-8107.83 7160.26,-8107.83 7160.26,-8039.83 7654.26,-8039.83 7654.26,-8107.83"/>
<text text-anchor="middle" x="7407.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 6 Down</text>
<text text-anchor="middle" x="7407.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7407.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7407.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_expert6_activation&#45;&gt;tp_layer0_expert6_down -->
<g id="edge130" class="edge">
<title>tp_layer0_expert6_activation&#45;&gt;tp_layer0_expert6_down</title>
<path fill="none" stroke="black" d="M7407.26,-8193.65C7407.26,-8193.65 7407.26,-8117.91 7407.26,-8117.91"/>
<polygon fill="black" stroke="black" points="7410.76,-8117.91 7407.26,-8107.91 7403.76,-8117.91 7410.76,-8117.91"/>
</g>
<!-- tp_layer0_expert6_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge164" class="edge">
<title>tp_layer0_expert6_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M7417.51,-8039.62C7417.51,-8000.27 7417.51,-7941 7417.51,-7941 7417.51,-7941 8280.08,-7941 8280.08,-7941"/>
<polygon fill="black" stroke="black" points="8280.08,-7944.5 8290.08,-7941 8280.08,-7937.5 8280.08,-7944.5"/>
</g>
<!-- tp_layer0_expert7_activation -->
<g id="node109" class="node">
<title>tp_layer0_expert7_activation</title>
<polygon fill="lightyellow" stroke="black" points="8218.26,-8261.83 7712.26,-8261.83 7712.26,-8193.83 8218.26,-8193.83 8218.26,-8261.83"/>
<text text-anchor="middle" x="7965.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="7965.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7965.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7965.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_expert7_up&#45;&gt;tp_layer0_expert7_activation -->
<g id="edge132" class="edge">
<title>tp_layer0_expert7_up&#45;&gt;tp_layer0_expert7_activation</title>
<path fill="none" stroke="black" d="M7965.26,-8347.65C7965.26,-8347.65 7965.26,-8271.91 7965.26,-8271.91"/>
<polygon fill="black" stroke="black" points="7968.76,-8271.91 7965.26,-8261.91 7961.76,-8271.91 7968.76,-8271.91"/>
</g>
<!-- tp_layer0_expert7_down -->
<g id="node110" class="node">
<title>tp_layer0_expert7_down</title>
<polygon fill="lightcoral" stroke="black" points="8218.26,-8107.83 7724.26,-8107.83 7724.26,-8039.83 8218.26,-8039.83 8218.26,-8107.83"/>
<text text-anchor="middle" x="7971.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 7 Down</text>
<text text-anchor="middle" x="7971.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7971.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7971.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer0_expert7_activation&#45;&gt;tp_layer0_expert7_down -->
<g id="edge133" class="edge">
<title>tp_layer0_expert7_activation&#45;&gt;tp_layer0_expert7_down</title>
<path fill="none" stroke="black" d="M7971.26,-8193.65C7971.26,-8193.65 7971.26,-8117.91 7971.26,-8117.91"/>
<polygon fill="black" stroke="black" points="7974.76,-8117.91 7971.26,-8107.91 7967.76,-8117.91 7974.76,-8117.91"/>
</g>
<!-- tp_layer0_expert7_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge165" class="edge">
<title>tp_layer0_expert7_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M8198.04,-8039.82C8198.04,-8039.82 8198.04,-7931.9 8198.04,-7931.9"/>
<polygon fill="black" stroke="black" points="8201.54,-7931.9 8198.04,-7921.9 8194.54,-7931.9 8201.54,-7931.9"/>
</g>
<!-- tp_layer0_expert8_activation -->
<g id="node112" class="node">
<title>tp_layer0_expert8_activation</title>
<polygon fill="lightyellow" stroke="black" points="8782.26,-8261.83 8276.26,-8261.83 8276.26,-8193.83 8782.26,-8193.83 8782.26,-8261.83"/>
<text text-anchor="middle" x="8529.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="8529.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8529.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8529.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_expert8_up&#45;&gt;tp_layer0_expert8_activation -->
<g id="edge135" class="edge">
<title>tp_layer0_expert8_up&#45;&gt;tp_layer0_expert8_activation</title>
<path fill="none" stroke="black" d="M8529.26,-8347.65C8529.26,-8347.65 8529.26,-8271.91 8529.26,-8271.91"/>
<polygon fill="black" stroke="black" points="8532.76,-8271.91 8529.26,-8261.91 8525.76,-8271.91 8532.76,-8271.91"/>
</g>
<!-- tp_layer0_expert8_down -->
<g id="node113" class="node">
<title>tp_layer0_expert8_down</title>
<polygon fill="lightcoral" stroke="black" points="8776.26,-8107.83 8282.26,-8107.83 8282.26,-8039.83 8776.26,-8039.83 8776.26,-8107.83"/>
<text text-anchor="middle" x="8529.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 8 Down</text>
<text text-anchor="middle" x="8529.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8529.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8529.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_expert8_activation&#45;&gt;tp_layer0_expert8_down -->
<g id="edge136" class="edge">
<title>tp_layer0_expert8_activation&#45;&gt;tp_layer0_expert8_down</title>
<path fill="none" stroke="black" d="M8529.26,-8193.65C8529.26,-8193.65 8529.26,-8117.91 8529.26,-8117.91"/>
<polygon fill="black" stroke="black" points="8532.76,-8117.91 8529.26,-8107.91 8525.76,-8117.91 8532.76,-8117.91"/>
</g>
<!-- tp_layer0_expert8_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge166" class="edge">
<title>tp_layer0_expert8_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M8529.26,-8039.82C8529.26,-8039.82 8529.26,-7964.04 8529.26,-7964.04"/>
<polygon fill="black" stroke="black" points="8532.76,-7964.04 8529.26,-7954.04 8525.76,-7964.04 8532.76,-7964.04"/>
</g>
<!-- tp_layer0_expert9_activation -->
<g id="node115" class="node">
<title>tp_layer0_expert9_activation</title>
<polygon fill="lightyellow" stroke="black" points="9346.26,-8261.83 8840.26,-8261.83 8840.26,-8193.83 9346.26,-8193.83 9346.26,-8261.83"/>
<text text-anchor="middle" x="9093.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="9093.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9093.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9093.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_expert9_up&#45;&gt;tp_layer0_expert9_activation -->
<g id="edge138" class="edge">
<title>tp_layer0_expert9_up&#45;&gt;tp_layer0_expert9_activation</title>
<path fill="none" stroke="black" d="M9093.26,-8347.65C9093.26,-8347.65 9093.26,-8271.91 9093.26,-8271.91"/>
<polygon fill="black" stroke="black" points="9096.76,-8271.91 9093.26,-8261.91 9089.76,-8271.91 9096.76,-8271.91"/>
</g>
<!-- tp_layer0_expert9_down -->
<g id="node116" class="node">
<title>tp_layer0_expert9_down</title>
<polygon fill="lightcoral" stroke="black" points="9334.26,-8107.83 8840.26,-8107.83 8840.26,-8039.83 9334.26,-8039.83 9334.26,-8107.83"/>
<text text-anchor="middle" x="9087.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 9 Down</text>
<text text-anchor="middle" x="9087.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9087.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9087.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer0_expert9_activation&#45;&gt;tp_layer0_expert9_down -->
<g id="edge139" class="edge">
<title>tp_layer0_expert9_activation&#45;&gt;tp_layer0_expert9_down</title>
<path fill="none" stroke="black" d="M9087.26,-8193.65C9087.26,-8193.65 9087.26,-8117.91 9087.26,-8117.91"/>
<polygon fill="black" stroke="black" points="9090.76,-8117.91 9087.26,-8107.91 9083.76,-8117.91 9090.76,-8117.91"/>
</g>
<!-- tp_layer0_expert9_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge167" class="edge">
<title>tp_layer0_expert9_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M8860.48,-8039.82C8860.48,-8039.82 8860.48,-7931.9 8860.48,-7931.9"/>
<polygon fill="black" stroke="black" points="8863.98,-7931.9 8860.48,-7921.9 8856.98,-7931.9 8863.98,-7931.9"/>
</g>
<!-- tp_layer0_expert10_activation -->
<g id="node118" class="node">
<title>tp_layer0_expert10_activation</title>
<polygon fill="lightyellow" stroke="black" points="9910.26,-8261.83 9404.26,-8261.83 9404.26,-8193.83 9910.26,-8193.83 9910.26,-8261.83"/>
<text text-anchor="middle" x="9657.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="9657.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9657.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9657.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_expert10_up&#45;&gt;tp_layer0_expert10_activation -->
<g id="edge141" class="edge">
<title>tp_layer0_expert10_up&#45;&gt;tp_layer0_expert10_activation</title>
<path fill="none" stroke="black" d="M9657.26,-8347.65C9657.26,-8347.65 9657.26,-8271.91 9657.26,-8271.91"/>
<polygon fill="black" stroke="black" points="9660.76,-8271.91 9657.26,-8261.91 9653.76,-8271.91 9660.76,-8271.91"/>
</g>
<!-- tp_layer0_expert10_down -->
<g id="node119" class="node">
<title>tp_layer0_expert10_down</title>
<polygon fill="lightcoral" stroke="black" points="9895.26,-8107.83 9401.26,-8107.83 9401.26,-8039.83 9895.26,-8039.83 9895.26,-8107.83"/>
<text text-anchor="middle" x="9648.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 10 Down</text>
<text text-anchor="middle" x="9648.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9648.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9648.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_expert10_activation&#45;&gt;tp_layer0_expert10_down -->
<g id="edge142" class="edge">
<title>tp_layer0_expert10_activation&#45;&gt;tp_layer0_expert10_down</title>
<path fill="none" stroke="black" d="M9649.76,-8193.65C9649.76,-8193.65 9649.76,-8117.91 9649.76,-8117.91"/>
<polygon fill="black" stroke="black" points="9653.26,-8117.91 9649.76,-8107.91 9646.26,-8117.91 9653.26,-8117.91"/>
</g>
<!-- tp_layer0_expert10_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge168" class="edge">
<title>tp_layer0_expert10_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M9405.13,-8039.71C9405.13,-8000.06 9405.13,-7940 9405.13,-7940 9405.13,-7940 8786.15,-7940 8786.15,-7940"/>
<polygon fill="black" stroke="black" points="8786.15,-7936.5 8776.15,-7940 8786.15,-7943.5 8786.15,-7936.5"/>
</g>
<!-- tp_layer0_expert11_activation -->
<g id="node121" class="node">
<title>tp_layer0_expert11_activation</title>
<polygon fill="lightyellow" stroke="black" points="10474.26,-8261.83 9968.26,-8261.83 9968.26,-8193.83 10474.26,-8193.83 10474.26,-8261.83"/>
<text text-anchor="middle" x="10221.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="10221.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10221.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10221.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_expert11_up&#45;&gt;tp_layer0_expert11_activation -->
<g id="edge144" class="edge">
<title>tp_layer0_expert11_up&#45;&gt;tp_layer0_expert11_activation</title>
<path fill="none" stroke="black" d="M10221.26,-8347.65C10221.26,-8347.65 10221.26,-8271.91 10221.26,-8271.91"/>
<polygon fill="black" stroke="black" points="10224.76,-8271.91 10221.26,-8261.91 10217.76,-8271.91 10224.76,-8271.91"/>
</g>
<!-- tp_layer0_expert11_down -->
<g id="node122" class="node">
<title>tp_layer0_expert11_down</title>
<polygon fill="lightcoral" stroke="black" points="10457.26,-8107.83 9963.26,-8107.83 9963.26,-8039.83 10457.26,-8039.83 10457.26,-8107.83"/>
<text text-anchor="middle" x="10210.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 11 Down</text>
<text text-anchor="middle" x="10210.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10210.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="10210.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer0_expert11_activation&#45;&gt;tp_layer0_expert11_down -->
<g id="edge145" class="edge">
<title>tp_layer0_expert11_activation&#45;&gt;tp_layer0_expert11_down</title>
<path fill="none" stroke="black" d="M10212.76,-8193.65C10212.76,-8193.65 10212.76,-8117.91 10212.76,-8117.91"/>
<polygon fill="black" stroke="black" points="10216.26,-8117.91 10212.76,-8107.91 10209.26,-8117.91 10216.26,-8117.91"/>
</g>
<!-- tp_layer0_expert11_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge169" class="edge">
<title>tp_layer0_expert11_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M9968.51,-8039.54C9968.51,-7995.87 9968.51,-7926 9968.51,-7926 9968.51,-7926 8858.23,-7926 8858.23,-7926"/>
<polygon fill="black" stroke="black" points="8858.23,-7922.5 8848.23,-7926 8858.23,-7929.5 8858.23,-7922.5"/>
</g>
<!-- tp_layer0_expert12_activation -->
<g id="node124" class="node">
<title>tp_layer0_expert12_activation</title>
<polygon fill="lightyellow" stroke="black" points="11038.26,-8261.83 10532.26,-8261.83 10532.26,-8193.83 11038.26,-8193.83 11038.26,-8261.83"/>
<text text-anchor="middle" x="10785.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="10785.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10785.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10785.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_expert12_up&#45;&gt;tp_layer0_expert12_activation -->
<g id="edge147" class="edge">
<title>tp_layer0_expert12_up&#45;&gt;tp_layer0_expert12_activation</title>
<path fill="none" stroke="black" d="M10785.26,-8347.65C10785.26,-8347.65 10785.26,-8271.91 10785.26,-8271.91"/>
<polygon fill="black" stroke="black" points="10788.76,-8271.91 10785.26,-8261.91 10781.76,-8271.91 10788.76,-8271.91"/>
</g>
<!-- tp_layer0_expert12_down -->
<g id="node125" class="node">
<title>tp_layer0_expert12_down</title>
<polygon fill="lightcoral" stroke="black" points="11021.26,-8107.83 10527.26,-8107.83 10527.26,-8039.83 11021.26,-8039.83 11021.26,-8107.83"/>
<text text-anchor="middle" x="10774.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 12 Down</text>
<text text-anchor="middle" x="10774.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10774.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="10774.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_expert12_activation&#45;&gt;tp_layer0_expert12_down -->
<g id="edge148" class="edge">
<title>tp_layer0_expert12_activation&#45;&gt;tp_layer0_expert12_down</title>
<path fill="none" stroke="black" d="M10776.76,-8193.65C10776.76,-8193.65 10776.76,-8117.91 10776.76,-8117.91"/>
<polygon fill="black" stroke="black" points="10780.26,-8117.91 10776.76,-8107.91 10773.26,-8117.91 10780.26,-8117.91"/>
</g>
<!-- tp_layer0_expert12_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge170" class="edge">
<title>tp_layer0_expert12_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M10774.26,-8039.51C10774.26,-7992.01 10774.26,-7912 10774.26,-7912 10774.26,-7912 8887.89,-7912 8887.89,-7912"/>
<polygon fill="black" stroke="black" points="8887.89,-7908.5 8877.89,-7912 8887.89,-7915.5 8887.89,-7908.5"/>
</g>
<!-- tp_layer0_expert13_activation -->
<g id="node127" class="node">
<title>tp_layer0_expert13_activation</title>
<polygon fill="lightyellow" stroke="black" points="11602.26,-8261.83 11096.26,-8261.83 11096.26,-8193.83 11602.26,-8193.83 11602.26,-8261.83"/>
<text text-anchor="middle" x="11349.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="11349.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11349.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11349.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_expert13_up&#45;&gt;tp_layer0_expert13_activation -->
<g id="edge150" class="edge">
<title>tp_layer0_expert13_up&#45;&gt;tp_layer0_expert13_activation</title>
<path fill="none" stroke="black" d="M11349.26,-8347.65C11349.26,-8347.65 11349.26,-8271.91 11349.26,-8271.91"/>
<polygon fill="black" stroke="black" points="11352.76,-8271.91 11349.26,-8261.91 11345.76,-8271.91 11352.76,-8271.91"/>
</g>
<!-- tp_layer0_expert13_down -->
<g id="node128" class="node">
<title>tp_layer0_expert13_down</title>
<polygon fill="lightcoral" stroke="black" points="11585.26,-8107.83 11091.26,-8107.83 11091.26,-8039.83 11585.26,-8039.83 11585.26,-8107.83"/>
<text text-anchor="middle" x="11338.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 13 Down</text>
<text text-anchor="middle" x="11338.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11338.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="11338.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer0_expert13_activation&#45;&gt;tp_layer0_expert13_down -->
<g id="edge151" class="edge">
<title>tp_layer0_expert13_activation&#45;&gt;tp_layer0_expert13_down</title>
<path fill="none" stroke="black" d="M11340.76,-8193.65C11340.76,-8193.65 11340.76,-8117.91 11340.76,-8117.91"/>
<polygon fill="black" stroke="black" points="11344.26,-8117.91 11340.76,-8107.91 11337.26,-8117.91 11344.26,-8117.91"/>
</g>
<!-- tp_layer0_expert13_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge171" class="edge">
<title>tp_layer0_expert13_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M11205.41,-8039.51C11205.41,-7988.34 11205.41,-7898 11205.41,-7898 11205.41,-7898 8886.38,-7898 8886.38,-7898"/>
<polygon fill="black" stroke="black" points="8886.38,-7894.5 8876.38,-7898 8886.38,-7901.5 8886.38,-7894.5"/>
</g>
<!-- tp_layer0_expert14_activation -->
<g id="node130" class="node">
<title>tp_layer0_expert14_activation</title>
<polygon fill="lightyellow" stroke="black" points="12166.26,-8261.83 11660.26,-8261.83 11660.26,-8193.83 12166.26,-8193.83 12166.26,-8261.83"/>
<text text-anchor="middle" x="11913.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="11913.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11913.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11913.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_expert14_up&#45;&gt;tp_layer0_expert14_activation -->
<g id="edge153" class="edge">
<title>tp_layer0_expert14_up&#45;&gt;tp_layer0_expert14_activation</title>
<path fill="none" stroke="black" d="M11913.26,-8347.65C11913.26,-8347.65 11913.26,-8271.91 11913.26,-8271.91"/>
<polygon fill="black" stroke="black" points="11916.76,-8271.91 11913.26,-8261.91 11909.76,-8271.91 11916.76,-8271.91"/>
</g>
<!-- tp_layer0_expert14_down -->
<g id="node131" class="node">
<title>tp_layer0_expert14_down</title>
<polygon fill="lightcoral" stroke="black" points="12148.26,-8107.83 11654.26,-8107.83 11654.26,-8039.83 12148.26,-8039.83 12148.26,-8107.83"/>
<text text-anchor="middle" x="11901.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 14 Down</text>
<text text-anchor="middle" x="11901.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11901.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="11901.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_expert14_activation&#45;&gt;tp_layer0_expert14_down -->
<g id="edge154" class="edge">
<title>tp_layer0_expert14_activation&#45;&gt;tp_layer0_expert14_down</title>
<path fill="none" stroke="black" d="M11904.26,-8193.65C11904.26,-8193.65 11904.26,-8117.91 11904.26,-8117.91"/>
<polygon fill="black" stroke="black" points="11907.76,-8117.91 11904.26,-8107.91 11900.76,-8117.91 11907.76,-8117.91"/>
</g>
<!-- tp_layer0_expert14_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge172" class="edge">
<title>tp_layer0_expert14_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M11983.59,-8039.63C11983.59,-7985.22 11983.59,-7885 11983.59,-7885 11983.59,-7885 8856.5,-7885 8856.5,-7885"/>
<polygon fill="black" stroke="black" points="8856.5,-7881.5 8846.5,-7885 8856.5,-7888.5 8856.5,-7881.5"/>
</g>
<!-- tp_layer0_expert15_activation -->
<g id="node133" class="node">
<title>tp_layer0_expert15_activation</title>
<polygon fill="lightyellow" stroke="black" points="12730.26,-8261.83 12224.26,-8261.83 12224.26,-8193.83 12730.26,-8193.83 12730.26,-8261.83"/>
<text text-anchor="middle" x="12477.26" y="-8246.63" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="12477.26" y="-8231.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12477.26" y="-8216.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12477.26" y="-8201.63" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_expert15_up&#45;&gt;tp_layer0_expert15_activation -->
<g id="edge156" class="edge">
<title>tp_layer0_expert15_up&#45;&gt;tp_layer0_expert15_activation</title>
<path fill="none" stroke="black" d="M12477.26,-8347.65C12477.26,-8347.65 12477.26,-8271.91 12477.26,-8271.91"/>
<polygon fill="black" stroke="black" points="12480.76,-8271.91 12477.26,-8261.91 12473.76,-8271.91 12480.76,-8271.91"/>
</g>
<!-- tp_layer0_expert15_down -->
<g id="node134" class="node">
<title>tp_layer0_expert15_down</title>
<polygon fill="lightcoral" stroke="black" points="12712.26,-8107.83 12218.26,-8107.83 12218.26,-8039.83 12712.26,-8039.83 12712.26,-8107.83"/>
<text text-anchor="middle" x="12465.26" y="-8092.63" font-family="Times,serif" font-size="14.00">Expert 15 Down</text>
<text text-anchor="middle" x="12465.26" y="-8077.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12465.26" y="-8062.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="12465.26" y="-8047.63" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer0_expert15_activation&#45;&gt;tp_layer0_expert15_down -->
<g id="edge157" class="edge">
<title>tp_layer0_expert15_activation&#45;&gt;tp_layer0_expert15_down</title>
<path fill="none" stroke="black" d="M12468.26,-8193.65C12468.26,-8193.65 12468.26,-8117.91 12468.26,-8117.91"/>
<polygon fill="black" stroke="black" points="12471.76,-8117.91 12468.26,-8107.91 12464.76,-8117.91 12471.76,-8117.91"/>
</g>
<!-- tp_layer0_expert15_down&#45;&gt;tp_layer0_moe_all_reduce -->
<g id="edge173" class="edge">
<title>tp_layer0_expert15_down&#45;&gt;tp_layer0_moe_all_reduce</title>
<path fill="none" stroke="black" d="M12464.51,-8039.42C12464.51,-7981.55 12464.51,-7871 12464.51,-7871 12464.51,-7871 8782.46,-7871 8782.46,-7871"/>
<polygon fill="black" stroke="black" points="8782.46,-7867.5 8772.46,-7871 8782.46,-7874.5 8782.46,-7867.5"/>
</g>
<!-- tp_layer0_moe_all_reduce&#45;&gt;tp_layer0_final_residual -->
<g id="edge175" class="edge">
<title>tp_layer0_moe_all_reduce&#45;&gt;tp_layer0_final_residual</title>
<path fill="none" stroke="black" d="M8864.07,-7890.95C8864.07,-7850.14 8864.07,-7739 8864.07,-7739 8864.07,-7739 10051.07,-7739 10051.07,-7739"/>
<polygon fill="black" stroke="black" points="10051.07,-7742.5 10061.07,-7739 10051.07,-7735.5 10051.07,-7742.5"/>
</g>
<!-- tp_layer1_norm -->
<g id="node137" class="node">
<title>tp_layer1_norm</title>
<polygon fill="lightyellow" stroke="black" points="7677.76,-7589.5 7180.76,-7589.5 7180.76,-7521.5 7677.76,-7521.5 7677.76,-7589.5"/>
<text text-anchor="middle" x="7429.26" y="-7574.3" font-family="Times,serif" font-size="14.00">Layer Norm</text>
<text text-anchor="middle" x="7429.26" y="-7559.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7429.26" y="-7544.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7429.26" y="-7529.3" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer0_final_residual&#45;&gt;tp_layer1_norm -->
<g id="edge176" class="edge">
<title>tp_layer0_final_residual&#45;&gt;tp_layer1_norm</title>
<path fill="none" stroke="black" d="M10066.51,-7707C9188.06,-7707 7666.01,-7707 7666.01,-7707 7666.01,-7707 7666.01,-7599.5 7666.01,-7599.5"/>
<polygon fill="black" stroke="black" points="7669.51,-7599.5 7666.01,-7589.5 7662.51,-7599.5 7669.51,-7599.5"/>
</g>
<!-- tp_layer1_attn_residual -->
<g id="node219" class="node">
<title>tp_layer1_attn_residual</title>
<ellipse fill="lightblue" stroke="black" cx="10891.26" cy="-6196.75" rx="646.09" ry="48.17"/>
<text text-anchor="middle" x="10891.26" y="-6215.55" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="10891.26" y="-6200.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096], [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10891.26" y="-6185.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10891.26" y="-6170.55" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer0_final_residual&#45;&gt;tp_layer1_attn_residual -->
<g id="edge281" class="edge">
<title>tp_layer0_final_residual&#45;&gt;tp_layer1_attn_residual</title>
<path fill="none" stroke="black" d="M11059.38,-7684.97C11059.38,-7555.08 11059.38,-7142 11059.38,-7142 11059.38,-7142 11244.76,-7142 11244.76,-7142 11244.76,-7142 11244.76,-6247.06 11244.76,-6247.06"/>
<polygon fill="black" stroke="black" points="11248.26,-6247.06 11244.76,-6237.06 11241.26,-6247.06 11248.26,-6247.06"/>
</g>
<!-- tp_layer1_q_proj_gpu0 -->
<g id="node138" class="node">
<title>tp_layer1_q_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="959.76,-7435.5 458.76,-7435.5 458.76,-7367.5 959.76,-7367.5 959.76,-7435.5"/>
<text text-anchor="middle" x="709.26" y="-7420.3" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="709.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="709.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="709.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu0 -->
<g id="edge177" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu0</title>
<path fill="none" stroke="black" d="M7180.71,-7584C5980.92,-7584 845.76,-7584 845.76,-7584 845.76,-7584 845.76,-7445.82 845.76,-7445.82"/>
<polygon fill="black" stroke="black" points="849.26,-7445.82 845.76,-7435.82 842.26,-7445.82 849.26,-7445.82"/>
</g>
<!-- tp_layer1_k_proj_gpu0 -->
<g id="node139" class="node">
<title>tp_layer1_k_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="1530.76,-7435.5 1029.76,-7435.5 1029.76,-7367.5 1530.76,-7367.5 1530.76,-7435.5"/>
<text text-anchor="middle" x="1280.26" y="-7420.3" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="1280.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="1280.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1280.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu0 -->
<g id="edge178" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu0</title>
<path fill="none" stroke="black" d="M7180.53,-7579C6052.89,-7579 1475.26,-7579 1475.26,-7579 1475.26,-7579 1475.26,-7445.72 1475.26,-7445.72"/>
<polygon fill="black" stroke="black" points="1478.76,-7445.72 1475.26,-7435.72 1471.76,-7445.72 1478.76,-7445.72"/>
</g>
<!-- tp_layer1_v_proj_gpu0 -->
<g id="node140" class="node">
<title>tp_layer1_v_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="2089.76,-7435.5 1588.76,-7435.5 1588.76,-7367.5 2089.76,-7367.5 2089.76,-7435.5"/>
<text text-anchor="middle" x="1839.26" y="-7420.3" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="1839.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="1839.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1839.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu0 -->
<g id="edge179" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu0</title>
<path fill="none" stroke="black" d="M7180.34,-7573C6123.69,-7573 2063.64,-7573 2063.64,-7573 2063.64,-7573 2063.64,-7445.79 2063.64,-7445.79"/>
<polygon fill="black" stroke="black" points="2067.14,-7445.79 2063.64,-7435.79 2060.14,-7445.79 2067.14,-7445.79"/>
</g>
<!-- tp_layer1_q_proj_gpu1 -->
<g id="node148" class="node">
<title>tp_layer1_q_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="2648.76,-7435.5 2147.76,-7435.5 2147.76,-7367.5 2648.76,-7367.5 2648.76,-7435.5"/>
<text text-anchor="middle" x="2398.26" y="-7420.3" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="2398.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="2398.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2398.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu1 -->
<g id="edge189" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu1</title>
<path fill="none" stroke="black" d="M7180.41,-7568C6196.12,-7568 2628.26,-7568 2628.26,-7568 2628.26,-7568 2628.26,-7445.59 2628.26,-7445.59"/>
<polygon fill="black" stroke="black" points="2631.76,-7445.59 2628.26,-7435.59 2624.76,-7445.59 2631.76,-7445.59"/>
</g>
<!-- tp_layer1_k_proj_gpu1 -->
<g id="node149" class="node">
<title>tp_layer1_k_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="3207.76,-7435.5 2706.76,-7435.5 2706.76,-7367.5 3207.76,-7367.5 3207.76,-7435.5"/>
<text text-anchor="middle" x="2957.26" y="-7420.3" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="2957.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="2957.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2957.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu1 -->
<g id="edge190" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu1</title>
<path fill="none" stroke="black" d="M7180.6,-7563C6273.51,-7563 3195.26,-7563 3195.26,-7563 3195.26,-7563 3195.26,-7445.75 3195.26,-7445.75"/>
<polygon fill="black" stroke="black" points="3198.76,-7445.75 3195.26,-7435.75 3191.76,-7445.75 3198.76,-7445.75"/>
</g>
<!-- tp_layer1_v_proj_gpu1 -->
<g id="node150" class="node">
<title>tp_layer1_v_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="3766.76,-7435.5 3265.76,-7435.5 3265.76,-7367.5 3766.76,-7367.5 3766.76,-7435.5"/>
<text text-anchor="middle" x="3516.26" y="-7420.3" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="3516.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="3516.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3516.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu1 -->
<g id="edge191" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu1</title>
<path fill="none" stroke="black" d="M7180.55,-7558C6351.9,-7558 3737.01,-7558 3737.01,-7558 3737.01,-7558 3737.01,-7445.84 3737.01,-7445.84"/>
<polygon fill="black" stroke="black" points="3740.51,-7445.84 3737.01,-7435.84 3733.51,-7445.84 3740.51,-7445.84"/>
</g>
<!-- tp_layer1_q_proj_gpu2 -->
<g id="node158" class="node">
<title>tp_layer1_q_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="4325.76,-7435.5 3824.76,-7435.5 3824.76,-7367.5 4325.76,-7367.5 4325.76,-7435.5"/>
<text text-anchor="middle" x="4075.26" y="-7420.3" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="4075.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4075.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4075.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu2 -->
<g id="edge201" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu2</title>
<path fill="none" stroke="black" d="M7180.52,-7552C6440.02,-7552 4301.01,-7552 4301.01,-7552 4301.01,-7552 4301.01,-7445.65 4301.01,-7445.65"/>
<polygon fill="black" stroke="black" points="4304.51,-7445.65 4301.01,-7435.65 4297.51,-7445.65 4304.51,-7445.65"/>
</g>
<!-- tp_layer1_k_proj_gpu2 -->
<g id="node159" class="node">
<title>tp_layer1_k_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="4884.76,-7435.5 4383.76,-7435.5 4383.76,-7367.5 4884.76,-7367.5 4884.76,-7435.5"/>
<text text-anchor="middle" x="4634.26" y="-7420.3" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="4634.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4634.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4634.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu2 -->
<g id="edge202" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu2</title>
<path fill="none" stroke="black" d="M7180.74,-7547C6537.48,-7547 4867.76,-7547 4867.76,-7547 4867.76,-7547 4867.76,-7445.61 4867.76,-7445.61"/>
<polygon fill="black" stroke="black" points="4871.26,-7445.61 4867.76,-7435.61 4864.26,-7445.61 4871.26,-7445.61"/>
</g>
<!-- tp_layer1_v_proj_gpu2 -->
<g id="node160" class="node">
<title>tp_layer1_v_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="5443.76,-7435.5 4942.76,-7435.5 4942.76,-7367.5 5443.76,-7367.5 5443.76,-7435.5"/>
<text text-anchor="middle" x="5193.26" y="-7420.3" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="5193.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5193.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5193.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu2 -->
<g id="edge203" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu2</title>
<path fill="none" stroke="black" d="M7180.74,-7542C6643.3,-7542 5421.01,-7542 5421.01,-7542 5421.01,-7542 5421.01,-7445.51 5421.01,-7445.51"/>
<polygon fill="black" stroke="black" points="5424.51,-7445.51 5421.01,-7435.51 5417.51,-7445.51 5424.51,-7445.51"/>
</g>
<!-- tp_layer1_q_proj_gpu3 -->
<g id="node168" class="node">
<title>tp_layer1_q_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="6002.76,-7435.5 5501.76,-7435.5 5501.76,-7367.5 6002.76,-7367.5 6002.76,-7435.5"/>
<text text-anchor="middle" x="5752.26" y="-7420.3" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="5752.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5752.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5752.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu3 -->
<g id="edge213" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu3</title>
<path fill="none" stroke="black" d="M7180.62,-7537C6769.94,-7537 5994.76,-7537 5994.76,-7537 5994.76,-7537 5994.76,-7445.69 5994.76,-7445.69"/>
<polygon fill="black" stroke="black" points="5998.26,-7445.69 5994.76,-7435.69 5991.26,-7445.69 5998.26,-7445.69"/>
</g>
<!-- tp_layer1_k_proj_gpu3 -->
<g id="node169" class="node">
<title>tp_layer1_k_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="6561.76,-7435.5 6060.76,-7435.5 6060.76,-7367.5 6561.76,-7367.5 6561.76,-7435.5"/>
<text text-anchor="middle" x="6311.26" y="-7420.3" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="6311.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6311.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6311.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu3 -->
<g id="edge214" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu3</title>
<path fill="none" stroke="black" d="M7180.61,-7531C6918.76,-7531 6544.01,-7531 6544.01,-7531 6544.01,-7531 6544.01,-7445.52 6544.01,-7445.52"/>
<polygon fill="black" stroke="black" points="6547.51,-7445.52 6544.01,-7435.52 6540.51,-7445.52 6547.51,-7445.52"/>
</g>
<!-- tp_layer1_v_proj_gpu3 -->
<g id="node170" class="node">
<title>tp_layer1_v_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="7120.76,-7435.5 6619.76,-7435.5 6619.76,-7367.5 7120.76,-7367.5 7120.76,-7435.5"/>
<text text-anchor="middle" x="6870.26" y="-7420.3" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="6870.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6870.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6870.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu3 -->
<g id="edge215" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu3</title>
<path fill="none" stroke="black" d="M7180.54,-7526C7137.89,-7526 7107.01,-7526 7107.01,-7526 7107.01,-7526 7107.01,-7445.52 7107.01,-7445.52"/>
<polygon fill="black" stroke="black" points="7110.51,-7445.52 7107.01,-7435.52 7103.51,-7445.52 7110.51,-7445.52"/>
</g>
<!-- tp_layer1_q_proj_gpu4 -->
<g id="node178" class="node">
<title>tp_layer1_q_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="7679.76,-7435.5 7178.76,-7435.5 7178.76,-7367.5 7679.76,-7367.5 7679.76,-7435.5"/>
<text text-anchor="middle" x="7429.26" y="-7420.3" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="7429.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7429.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7429.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu4 -->
<g id="edge225" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu4</title>
<path fill="none" stroke="black" d="M7429.26,-7521.32C7429.26,-7521.32 7429.26,-7445.58 7429.26,-7445.58"/>
<polygon fill="black" stroke="black" points="7432.76,-7445.58 7429.26,-7435.58 7425.76,-7445.58 7432.76,-7445.58"/>
</g>
<!-- tp_layer1_k_proj_gpu4 -->
<g id="node179" class="node">
<title>tp_layer1_k_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="8238.76,-7435.5 7737.76,-7435.5 7737.76,-7367.5 8238.76,-7367.5 8238.76,-7435.5"/>
<text text-anchor="middle" x="7988.26" y="-7420.3" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="7988.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7988.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7988.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu4 -->
<g id="edge226" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu4</title>
<path fill="none" stroke="black" d="M7678.05,-7527C7815.14,-7527 7957.79,-7527 7957.79,-7527 7957.79,-7527 7957.79,-7445.79 7957.79,-7445.79"/>
<polygon fill="black" stroke="black" points="7961.29,-7445.79 7957.79,-7435.79 7954.29,-7445.79 7961.29,-7445.79"/>
</g>
<!-- tp_layer1_v_proj_gpu4 -->
<g id="node180" class="node">
<title>tp_layer1_v_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="8797.76,-7435.5 8296.76,-7435.5 8296.76,-7367.5 8797.76,-7367.5 8797.76,-7435.5"/>
<text text-anchor="middle" x="8547.26" y="-7420.3" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="8547.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8547.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8547.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu4 -->
<g id="edge227" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu4</title>
<path fill="none" stroke="black" d="M7678.08,-7532C8007.51,-7532 8547.26,-7532 8547.26,-7532 8547.26,-7532 8547.26,-7445.79 8547.26,-7445.79"/>
<polygon fill="black" stroke="black" points="8550.76,-7445.79 8547.26,-7435.79 8543.76,-7445.79 8550.76,-7445.79"/>
</g>
<!-- tp_layer1_q_proj_gpu5 -->
<g id="node188" class="node">
<title>tp_layer1_q_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="9356.76,-7435.5 8855.76,-7435.5 8855.76,-7367.5 9356.76,-7367.5 9356.76,-7435.5"/>
<text text-anchor="middle" x="9106.26" y="-7420.3" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="9106.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9106.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9106.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu5 -->
<g id="edge237" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu5</title>
<path fill="none" stroke="black" d="M7678.16,-7538C8090.99,-7538 8872.38,-7538 8872.38,-7538 8872.38,-7538 8872.38,-7445.59 8872.38,-7445.59"/>
<polygon fill="black" stroke="black" points="8875.88,-7445.59 8872.38,-7435.59 8868.88,-7445.59 8875.88,-7445.59"/>
</g>
<!-- tp_layer1_k_proj_gpu5 -->
<g id="node189" class="node">
<title>tp_layer1_k_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="9915.76,-7435.5 9414.76,-7435.5 9414.76,-7367.5 9915.76,-7367.5 9915.76,-7435.5"/>
<text text-anchor="middle" x="9665.26" y="-7420.3" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="9665.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9665.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9665.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu5 -->
<g id="edge238" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu5</title>
<path fill="none" stroke="black" d="M7677.84,-7544C8258.47,-7544 9655.01,-7544 9655.01,-7544 9655.01,-7544 9655.01,-7445.63 9655.01,-7445.63"/>
<polygon fill="black" stroke="black" points="9658.51,-7445.63 9655.01,-7435.63 9651.51,-7445.63 9658.51,-7445.63"/>
</g>
<!-- tp_layer1_v_proj_gpu5 -->
<g id="node190" class="node">
<title>tp_layer1_v_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="10474.76,-7435.5 9973.76,-7435.5 9973.76,-7367.5 10474.76,-7367.5 10474.76,-7435.5"/>
<text text-anchor="middle" x="10224.26" y="-7420.3" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="10224.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10224.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10224.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu5 -->
<g id="edge239" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu5</title>
<path fill="none" stroke="black" d="M7677.83,-7549C8322.87,-7549 10000.36,-7549 10000.36,-7549 10000.36,-7549 10000.36,-7445.71 10000.36,-7445.71"/>
<polygon fill="black" stroke="black" points="10003.86,-7445.71 10000.36,-7435.71 9996.86,-7445.71 10003.86,-7445.71"/>
</g>
<!-- tp_layer1_q_proj_gpu6 -->
<g id="node198" class="node">
<title>tp_layer1_q_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="11033.76,-7435.5 10532.76,-7435.5 10532.76,-7367.5 11033.76,-7367.5 11033.76,-7435.5"/>
<text text-anchor="middle" x="10783.26" y="-7420.3" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="10783.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10783.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10783.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu6 -->
<g id="edge249" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu6</title>
<path fill="none" stroke="black" d="M7677.93,-7555C8454.55,-7555 10783.26,-7555 10783.26,-7555 10783.26,-7555 10783.26,-7445.56 10783.26,-7445.56"/>
<polygon fill="black" stroke="black" points="10786.76,-7445.56 10783.26,-7435.56 10779.76,-7445.56 10786.76,-7445.56"/>
</g>
<!-- tp_layer1_k_proj_gpu6 -->
<g id="node199" class="node">
<title>tp_layer1_k_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="11592.76,-7435.5 11091.76,-7435.5 11091.76,-7367.5 11592.76,-7367.5 11592.76,-7435.5"/>
<text text-anchor="middle" x="11342.26" y="-7420.3" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="11342.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11342.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11342.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu6 -->
<g id="edge250" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu6</title>
<path fill="none" stroke="black" d="M7677.77,-7561C8518.74,-7561 11205.66,-7561 11205.66,-7561 11205.66,-7561 11205.66,-7445.71 11205.66,-7445.71"/>
<polygon fill="black" stroke="black" points="11209.16,-7445.71 11205.66,-7435.71 11202.16,-7445.71 11209.16,-7445.71"/>
</g>
<!-- tp_layer1_v_proj_gpu6 -->
<g id="node200" class="node">
<title>tp_layer1_v_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="12151.76,-7435.5 11650.76,-7435.5 11650.76,-7367.5 12151.76,-7367.5 12151.76,-7435.5"/>
<text text-anchor="middle" x="11901.26" y="-7420.3" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="11901.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11901.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11901.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu6 -->
<g id="edge251" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu6</title>
<path fill="none" stroke="black" d="M7677.85,-7566C8606.45,-7566 11818.93,-7566 11818.93,-7566 11818.93,-7566 11818.93,-7445.58 11818.93,-7445.58"/>
<polygon fill="black" stroke="black" points="11822.43,-7445.58 11818.93,-7435.58 11815.43,-7445.58 11822.43,-7445.58"/>
</g>
<!-- tp_layer1_q_proj_gpu7 -->
<g id="node208" class="node">
<title>tp_layer1_q_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="12710.76,-7435.5 12209.76,-7435.5 12209.76,-7367.5 12710.76,-7367.5 12710.76,-7435.5"/>
<text text-anchor="middle" x="12460.26" y="-7420.3" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="12460.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12460.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12460.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu7 -->
<g id="edge261" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_q_proj_gpu7</title>
<path fill="none" stroke="black" d="M7678.1,-7572C8660.25,-7572 12214.01,-7572 12214.01,-7572 12214.01,-7572 12214.01,-7445.59 12214.01,-7445.59"/>
<polygon fill="black" stroke="black" points="12217.51,-7445.59 12214.01,-7435.59 12210.51,-7445.59 12217.51,-7445.59"/>
</g>
<!-- tp_layer1_k_proj_gpu7 -->
<g id="node209" class="node">
<title>tp_layer1_k_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="13269.76,-7435.5 12768.76,-7435.5 12768.76,-7367.5 13269.76,-7367.5 13269.76,-7435.5"/>
<text text-anchor="middle" x="13019.26" y="-7420.3" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="13019.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="13019.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13019.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu7 -->
<g id="edge262" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_k_proj_gpu7</title>
<path fill="none" stroke="black" d="M7678.03,-7578C8762.08,-7578 13019.26,-7578 13019.26,-7578 13019.26,-7578 13019.26,-7445.53 13019.26,-7445.53"/>
<polygon fill="black" stroke="black" points="13022.76,-7445.53 13019.26,-7435.53 13015.76,-7445.53 13022.76,-7445.53"/>
</g>
<!-- tp_layer1_v_proj_gpu7 -->
<g id="node210" class="node">
<title>tp_layer1_v_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="13828.76,-7435.5 13327.76,-7435.5 13327.76,-7367.5 13828.76,-7367.5 13828.76,-7435.5"/>
<text text-anchor="middle" x="13578.26" y="-7420.3" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="13578.26" y="-7405.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="13578.26" y="-7390.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13578.26" y="-7375.3" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu7 -->
<g id="edge263" class="edge">
<title>tp_layer1_norm&#45;&gt;tp_layer1_v_proj_gpu7</title>
<path fill="none" stroke="black" d="M7677.92,-7583C8802.59,-7583 13359.14,-7583 13359.14,-7583 13359.14,-7583 13359.14,-7445.64 13359.14,-7445.64"/>
<polygon fill="black" stroke="black" points="13362.64,-7445.64 13359.14,-7435.64 13355.64,-7445.64 13362.64,-7445.64"/>
</g>
<!-- tp_layer1_gather_q_gpu0 -->
<g id="node143" class="node">
<title>tp_layer1_gather_q_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="703.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="703.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="703.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="703.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="703.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_q_proj_gpu0&#45;&gt;tp_layer1_gather_q_gpu0 -->
<g id="edge180" class="edge">
<title>tp_layer1_q_proj_gpu0&#45;&gt;tp_layer1_gather_q_gpu0</title>
<path fill="none" stroke="black" d="M709.26,-7367.48C709.26,-7367.48 709.26,-7291.71 709.26,-7291.71"/>
<polygon fill="black" stroke="black" points="712.76,-7291.71 709.26,-7281.71 705.76,-7291.71 712.76,-7291.71"/>
</g>
<!-- tp_layer1_gather_k_gpu0 -->
<g id="node142" class="node">
<title>tp_layer1_gather_k_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="1470.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="1470.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="1470.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1470.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1470.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_k_proj_gpu0&#45;&gt;tp_layer1_gather_k_gpu0 -->
<g id="edge181" class="edge">
<title>tp_layer1_k_proj_gpu0&#45;&gt;tp_layer1_gather_k_gpu0</title>
<path fill="none" stroke="black" d="M1323.38,-7367.48C1323.38,-7367.48 1323.38,-7287.28 1323.38,-7287.28"/>
<polygon fill="black" stroke="black" points="1326.88,-7287.28 1323.38,-7277.28 1319.88,-7287.28 1326.88,-7287.28"/>
</g>
<!-- tp_layer1_gather_v_gpu0 -->
<g id="node146" class="node">
<title>tp_layer1_gather_v_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="2032.26" cy="-6869.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="2032.26" y="-6887.88" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="2032.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2032.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2032.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_v_proj_gpu0&#45;&gt;tp_layer1_gather_v_gpu0 -->
<g id="edge185" class="edge">
<title>tp_layer1_v_proj_gpu0&#45;&gt;tp_layer1_gather_v_gpu0</title>
<path fill="none" stroke="black" d="M1919.26,-7367.38C1919.26,-7367.38 1919.26,-6925.03 1919.26,-6925.03"/>
<polygon fill="black" stroke="black" points="1922.76,-6925.03 1919.26,-6915.03 1915.76,-6925.03 1922.76,-6925.03"/>
</g>
<!-- tp_layer1_attn_scores_gpu0 -->
<g id="node141" class="node">
<title>tp_layer1_attn_scores_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="1619.76,-7085.25 1080.76,-7085.25 1080.76,-7017.25 1619.76,-7017.25 1619.76,-7085.25"/>
<text text-anchor="middle" x="1350.26" y="-7070.05" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="1350.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1350.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1350.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_softmax_gpu0 -->
<g id="node144" class="node">
<title>tp_layer1_softmax_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="1619.76,-6903.08 1080.76,-6903.08 1080.76,-6835.08 1619.76,-6835.08 1619.76,-6903.08"/>
<text text-anchor="middle" x="1350.26" y="-6887.88" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="1350.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1350.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1350.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_attn_scores_gpu0&#45;&gt;tp_layer1_softmax_gpu0 -->
<g id="edge184" class="edge">
<title>tp_layer1_attn_scores_gpu0&#45;&gt;tp_layer1_softmax_gpu0</title>
<path fill="none" stroke="black" d="M1350.26,-7016.98C1350.26,-7016.98 1350.26,-6913.19 1350.26,-6913.19"/>
<polygon fill="black" stroke="black" points="1353.76,-6913.19 1350.26,-6903.19 1346.76,-6913.19 1353.76,-6913.19"/>
</g>
<!-- tp_layer1_gather_k_gpu0&#45;&gt;tp_layer1_attn_scores_gpu0 -->
<g id="edge183" class="edge">
<title>tp_layer1_gather_k_gpu0&#45;&gt;tp_layer1_attn_scores_gpu0</title>
<path fill="none" stroke="black" d="M1367.88,-7186.97C1367.88,-7186.97 1367.88,-7095.52 1367.88,-7095.52"/>
<polygon fill="black" stroke="black" points="1371.38,-7095.52 1367.88,-7085.52 1364.38,-7095.52 1371.38,-7095.52"/>
</g>
<!-- tp_layer1_gather_q_gpu0&#45;&gt;tp_layer1_attn_scores_gpu0 -->
<g id="edge182" class="edge">
<title>tp_layer1_gather_q_gpu0&#45;&gt;tp_layer1_attn_scores_gpu0</title>
<path fill="none" stroke="black" d="M1057.58,-7233C1082.7,-7233 1098.38,-7233 1098.38,-7233 1098.38,-7233 1098.38,-7095.43 1098.38,-7095.43"/>
<polygon fill="black" stroke="black" points="1101.88,-7095.43 1098.38,-7085.43 1094.88,-7095.43 1101.88,-7095.43"/>
</g>
<!-- tp_layer1_attn_out_gpu0 -->
<g id="node145" class="node">
<title>tp_layer1_attn_out_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="2295.76,-6735 1768.76,-6735 1768.76,-6667 2295.76,-6667 2295.76,-6735"/>
<text text-anchor="middle" x="2032.26" y="-6719.8" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="2032.26" y="-6704.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="2032.26" y="-6689.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2032.26" y="-6674.8" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_softmax_gpu0&#45;&gt;tp_layer1_attn_out_gpu0 -->
<g id="edge186" class="edge">
<title>tp_layer1_softmax_gpu0&#45;&gt;tp_layer1_attn_out_gpu0</title>
<path fill="none" stroke="black" d="M1433.76,-6834.86C1433.76,-6785.46 1433.76,-6700 1433.76,-6700 1433.76,-6700 1758.44,-6700 1758.44,-6700"/>
<polygon fill="black" stroke="black" points="1758.44,-6703.5 1768.44,-6700 1758.44,-6696.5 1758.44,-6703.5"/>
</g>
<!-- tp_layer1_out_proj_gpu0 -->
<g id="node147" class="node">
<title>tp_layer1_out_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="3515.76,-6581 3026.76,-6581 3026.76,-6513 3515.76,-6513 3515.76,-6581"/>
<text text-anchor="middle" x="3271.26" y="-6565.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="3271.26" y="-6550.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3271.26" y="-6535.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3271.26" y="-6520.8" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_attn_out_gpu0&#45;&gt;tp_layer1_out_proj_gpu0 -->
<g id="edge188" class="edge">
<title>tp_layer1_attn_out_gpu0&#45;&gt;tp_layer1_out_proj_gpu0</title>
<path fill="none" stroke="black" d="M2296.02,-6700C2648.89,-6700 3230.76,-6700 3230.76,-6700 3230.76,-6700 3230.76,-6591.33 3230.76,-6591.33"/>
<polygon fill="black" stroke="black" points="3234.26,-6591.33 3230.76,-6581.33 3227.26,-6591.33 3234.26,-6591.33"/>
</g>
<!-- tp_layer1_gather_v_gpu0&#45;&gt;tp_layer1_attn_out_gpu0 -->
<g id="edge187" class="edge">
<title>tp_layer1_gather_v_gpu0&#45;&gt;tp_layer1_attn_out_gpu0</title>
<path fill="none" stroke="black" d="M2032.26,-6820.91C2032.26,-6820.91 2032.26,-6745.03 2032.26,-6745.03"/>
<polygon fill="black" stroke="black" points="2035.76,-6745.03 2032.26,-6735.03 2028.76,-6745.03 2035.76,-6745.03"/>
</g>
<!-- tp_layer1_attn_all_reduce -->
<g id="node218" class="node">
<title>tp_layer1_attn_all_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="8206.26" cy="-6378.91" rx="351.36" ry="48.17"/>
<text text-anchor="middle" x="8206.26" y="-6397.71" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention</text>
<text text-anchor="middle" x="8206.26" y="-6382.71" font-family="Times,serif" font-size="14.00">Input: 8×[512]</text>
<text text-anchor="middle" x="8206.26" y="-6367.71" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8206.26" y="-6352.71" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer1_out_proj_gpu0&#45;&gt;tp_layer1_attn_all_reduce -->
<g id="edge273" class="edge">
<title>tp_layer1_out_proj_gpu0&#45;&gt;tp_layer1_attn_all_reduce</title>
<path fill="none" stroke="black" d="M3499.76,-6512.94C3499.76,-6457.53 3499.76,-6354 3499.76,-6354 3499.76,-6354 7895.59,-6354 7895.59,-6354"/>
<polygon fill="black" stroke="black" points="7895.59,-6357.5 7905.59,-6354 7895.59,-6350.5 7895.59,-6357.5"/>
</g>
<!-- tp_layer1_gather_q_gpu1 -->
<g id="node153" class="node">
<title>tp_layer1_gather_q_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="2368.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="2368.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="2368.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2368.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2368.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_q_proj_gpu1&#45;&gt;tp_layer1_gather_q_gpu1 -->
<g id="edge192" class="edge">
<title>tp_layer1_q_proj_gpu1&#45;&gt;tp_layer1_gather_q_gpu1</title>
<path fill="none" stroke="black" d="M2398.26,-7367.48C2398.26,-7367.48 2398.26,-7291.39 2398.26,-7291.39"/>
<polygon fill="black" stroke="black" points="2401.76,-7291.39 2398.26,-7281.39 2394.76,-7291.39 2401.76,-7291.39"/>
</g>
<!-- tp_layer1_gather_k_gpu1 -->
<g id="node152" class="node">
<title>tp_layer1_gather_k_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="3135.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="3135.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="3135.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3135.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3135.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_k_proj_gpu1&#45;&gt;tp_layer1_gather_k_gpu1 -->
<g id="edge193" class="edge">
<title>tp_layer1_k_proj_gpu1&#45;&gt;tp_layer1_gather_k_gpu1</title>
<path fill="none" stroke="black" d="M2994.38,-7367.48C2994.38,-7367.48 2994.38,-7287.6 2994.38,-7287.6"/>
<polygon fill="black" stroke="black" points="2997.88,-7287.6 2994.38,-7277.6 2990.88,-7287.6 2997.88,-7287.6"/>
</g>
<!-- tp_layer1_gather_v_gpu1 -->
<g id="node156" class="node">
<title>tp_layer1_gather_v_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="3698.26" cy="-7051.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="3698.26" y="-7070.05" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="3698.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3698.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3698.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_v_proj_gpu1&#45;&gt;tp_layer1_gather_v_gpu1 -->
<g id="edge197" class="edge">
<title>tp_layer1_v_proj_gpu1&#45;&gt;tp_layer1_gather_v_gpu1</title>
<path fill="none" stroke="black" d="M3578.76,-7367.28C3578.76,-7367.28 3578.76,-7106.57 3578.76,-7106.57"/>
<polygon fill="black" stroke="black" points="3582.26,-7106.57 3578.76,-7096.57 3575.26,-7106.57 3582.26,-7106.57"/>
</g>
<!-- tp_layer1_attn_scores_gpu1 -->
<g id="node151" class="node">
<title>tp_layer1_attn_scores_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="3285.76,-7085.25 2746.76,-7085.25 2746.76,-7017.25 3285.76,-7017.25 3285.76,-7085.25"/>
<text text-anchor="middle" x="3016.26" y="-7070.05" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="3016.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3016.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3016.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_softmax_gpu1 -->
<g id="node154" class="node">
<title>tp_layer1_softmax_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="3447.76,-6903.08 2908.76,-6903.08 2908.76,-6835.08 3447.76,-6835.08 3447.76,-6903.08"/>
<text text-anchor="middle" x="3178.26" y="-6887.88" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="3178.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3178.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3178.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_attn_scores_gpu1&#45;&gt;tp_layer1_softmax_gpu1 -->
<g id="edge196" class="edge">
<title>tp_layer1_attn_scores_gpu1&#45;&gt;tp_layer1_softmax_gpu1</title>
<path fill="none" stroke="black" d="M3097.26,-7016.98C3097.26,-7016.98 3097.26,-6913.19 3097.26,-6913.19"/>
<polygon fill="black" stroke="black" points="3100.76,-6913.19 3097.26,-6903.19 3093.76,-6913.19 3100.76,-6913.19"/>
</g>
<!-- tp_layer1_gather_k_gpu1&#45;&gt;tp_layer1_attn_scores_gpu1 -->
<g id="edge195" class="edge">
<title>tp_layer1_gather_k_gpu1&#45;&gt;tp_layer1_attn_scores_gpu1</title>
<path fill="none" stroke="black" d="M3033.38,-7186.97C3033.38,-7186.97 3033.38,-7095.52 3033.38,-7095.52"/>
<polygon fill="black" stroke="black" points="3036.88,-7095.52 3033.38,-7085.52 3029.88,-7095.52 3036.88,-7095.52"/>
</g>
<!-- tp_layer1_gather_q_gpu1&#45;&gt;tp_layer1_attn_scores_gpu1 -->
<g id="edge194" class="edge">
<title>tp_layer1_gather_q_gpu1&#45;&gt;tp_layer1_attn_scores_gpu1</title>
<path fill="none" stroke="black" d="M2722.66,-7233C2748.02,-7233 2763.88,-7233 2763.88,-7233 2763.88,-7233 2763.88,-7095.43 2763.88,-7095.43"/>
<polygon fill="black" stroke="black" points="2767.38,-7095.43 2763.88,-7085.43 2760.38,-7095.43 2767.38,-7095.43"/>
</g>
<!-- tp_layer1_attn_out_gpu1 -->
<g id="node155" class="node">
<title>tp_layer1_attn_out_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="3961.76,-6735 3434.76,-6735 3434.76,-6667 3961.76,-6667 3961.76,-6735"/>
<text text-anchor="middle" x="3698.26" y="-6719.8" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="3698.26" y="-6704.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3698.26" y="-6689.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3698.26" y="-6674.8" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_softmax_gpu1&#45;&gt;tp_layer1_attn_out_gpu1 -->
<g id="edge198" class="edge">
<title>tp_layer1_softmax_gpu1&#45;&gt;tp_layer1_attn_out_gpu1</title>
<path fill="none" stroke="black" d="M3441.26,-6835.07C3441.26,-6835.07 3441.26,-6745.25 3441.26,-6745.25"/>
<polygon fill="black" stroke="black" points="3444.76,-6745.25 3441.26,-6735.25 3437.76,-6745.25 3444.76,-6745.25"/>
</g>
<!-- tp_layer1_out_proj_gpu1 -->
<g id="node157" class="node">
<title>tp_layer1_out_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="4554.76,-6581 4065.76,-6581 4065.76,-6513 4554.76,-6513 4554.76,-6581"/>
<text text-anchor="middle" x="4310.26" y="-6565.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="4310.26" y="-6550.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4310.26" y="-6535.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4310.26" y="-6520.8" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_attn_out_gpu1&#45;&gt;tp_layer1_out_proj_gpu1 -->
<g id="edge200" class="edge">
<title>tp_layer1_attn_out_gpu1&#45;&gt;tp_layer1_out_proj_gpu1</title>
<path fill="none" stroke="black" d="M3962,-6689C4091.95,-6689 4221.14,-6689 4221.14,-6689 4221.14,-6689 4221.14,-6591.01 4221.14,-6591.01"/>
<polygon fill="black" stroke="black" points="4224.64,-6591.01 4221.14,-6581.01 4217.64,-6591.01 4224.64,-6591.01"/>
</g>
<!-- tp_layer1_gather_v_gpu1&#45;&gt;tp_layer1_attn_out_gpu1 -->
<g id="edge199" class="edge">
<title>tp_layer1_gather_v_gpu1&#45;&gt;tp_layer1_attn_out_gpu1</title>
<path fill="none" stroke="black" d="M3704.76,-7002.91C3704.76,-7002.91 3704.76,-6745.15 3704.76,-6745.15"/>
<polygon fill="black" stroke="black" points="3708.26,-6745.15 3704.76,-6735.15 3701.26,-6745.15 3708.26,-6745.15"/>
</g>
<!-- tp_layer1_out_proj_gpu1&#45;&gt;tp_layer1_attn_all_reduce -->
<g id="edge274" class="edge">
<title>tp_layer1_out_proj_gpu1&#45;&gt;tp_layer1_attn_all_reduce</title>
<path fill="none" stroke="black" d="M4550.51,-6512.8C4550.51,-6463.42 4550.51,-6378 4550.51,-6378 4550.51,-6378 7844.49,-6378 7844.49,-6378"/>
<polygon fill="black" stroke="black" points="7844.49,-6381.5 7854.49,-6378 7844.49,-6374.5 7844.49,-6381.5"/>
</g>
<!-- tp_layer1_gather_q_gpu2 -->
<g id="node163" class="node">
<title>tp_layer1_gather_q_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="4022.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="4022.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="4022.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4022.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4022.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_q_proj_gpu2&#45;&gt;tp_layer1_gather_q_gpu2 -->
<g id="edge204" class="edge">
<title>tp_layer1_q_proj_gpu2&#45;&gt;tp_layer1_gather_q_gpu2</title>
<path fill="none" stroke="black" d="M4075.26,-7367.48C4075.26,-7367.48 4075.26,-7291.07 4075.26,-7291.07"/>
<polygon fill="black" stroke="black" points="4078.76,-7291.07 4075.26,-7281.07 4071.76,-7291.07 4078.76,-7291.07"/>
</g>
<!-- tp_layer1_gather_k_gpu2 -->
<g id="node162" class="node">
<title>tp_layer1_gather_k_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="4789.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="4789.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="4789.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4789.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4789.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_k_proj_gpu2&#45;&gt;tp_layer1_gather_k_gpu2 -->
<g id="edge205" class="edge">
<title>tp_layer1_k_proj_gpu2&#45;&gt;tp_layer1_gather_k_gpu2</title>
<path fill="none" stroke="black" d="M4659.88,-7367.48C4659.88,-7367.48 4659.88,-7288.22 4659.88,-7288.22"/>
<polygon fill="black" stroke="black" points="4663.38,-7288.22 4659.88,-7278.22 4656.38,-7288.22 4663.38,-7288.22"/>
</g>
<!-- tp_layer1_gather_v_gpu2 -->
<g id="node166" class="node">
<title>tp_layer1_gather_v_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="5351.26" cy="-6869.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="5351.26" y="-6887.88" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="5351.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5351.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5351.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_v_proj_gpu2&#45;&gt;tp_layer1_gather_v_gpu2 -->
<g id="edge209" class="edge">
<title>tp_layer1_v_proj_gpu2&#45;&gt;tp_layer1_gather_v_gpu2</title>
<path fill="none" stroke="black" d="M5231.76,-7367.38C5231.76,-7367.38 5231.76,-6924.64 5231.76,-6924.64"/>
<polygon fill="black" stroke="black" points="5235.26,-6924.64 5231.76,-6914.64 5228.26,-6924.64 5235.26,-6924.64"/>
</g>
<!-- tp_layer1_attn_scores_gpu2 -->
<g id="node161" class="node">
<title>tp_layer1_attn_scores_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="4938.76,-7085.25 4399.76,-7085.25 4399.76,-7017.25 4938.76,-7017.25 4938.76,-7085.25"/>
<text text-anchor="middle" x="4669.26" y="-7070.05" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="4669.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4669.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="4669.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_softmax_gpu2 -->
<g id="node164" class="node">
<title>tp_layer1_softmax_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="4938.76,-6903.08 4399.76,-6903.08 4399.76,-6835.08 4938.76,-6835.08 4938.76,-6903.08"/>
<text text-anchor="middle" x="4669.26" y="-6887.88" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="4669.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="4669.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="4669.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_attn_scores_gpu2&#45;&gt;tp_layer1_softmax_gpu2 -->
<g id="edge208" class="edge">
<title>tp_layer1_attn_scores_gpu2&#45;&gt;tp_layer1_softmax_gpu2</title>
<path fill="none" stroke="black" d="M4669.26,-7016.98C4669.26,-7016.98 4669.26,-6913.19 4669.26,-6913.19"/>
<polygon fill="black" stroke="black" points="4672.76,-6913.19 4669.26,-6903.19 4665.76,-6913.19 4672.76,-6913.19"/>
</g>
<!-- tp_layer1_gather_k_gpu2&#45;&gt;tp_layer1_attn_scores_gpu2 -->
<g id="edge207" class="edge">
<title>tp_layer1_gather_k_gpu2&#45;&gt;tp_layer1_attn_scores_gpu2</title>
<path fill="none" stroke="black" d="M4686.88,-7186.97C4686.88,-7186.97 4686.88,-7095.52 4686.88,-7095.52"/>
<polygon fill="black" stroke="black" points="4690.38,-7095.52 4686.88,-7085.52 4683.38,-7095.52 4690.38,-7095.52"/>
</g>
<!-- tp_layer1_gather_q_gpu2&#45;&gt;tp_layer1_attn_scores_gpu2 -->
<g id="edge206" class="edge">
<title>tp_layer1_gather_q_gpu2&#45;&gt;tp_layer1_attn_scores_gpu2</title>
<path fill="none" stroke="black" d="M4376.58,-7233C4401.7,-7233 4417.38,-7233 4417.38,-7233 4417.38,-7233 4417.38,-7095.43 4417.38,-7095.43"/>
<polygon fill="black" stroke="black" points="4420.88,-7095.43 4417.38,-7085.43 4413.88,-7095.43 4420.88,-7095.43"/>
</g>
<!-- tp_layer1_attn_out_gpu2 -->
<g id="node165" class="node">
<title>tp_layer1_attn_out_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="5614.76,-6735 5087.76,-6735 5087.76,-6667 5614.76,-6667 5614.76,-6735"/>
<text text-anchor="middle" x="5351.26" y="-6719.8" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="5351.26" y="-6704.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="5351.26" y="-6689.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5351.26" y="-6674.8" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_softmax_gpu2&#45;&gt;tp_layer1_attn_out_gpu2 -->
<g id="edge210" class="edge">
<title>tp_layer1_softmax_gpu2&#45;&gt;tp_layer1_attn_out_gpu2</title>
<path fill="none" stroke="black" d="M4746.76,-6835C4746.76,-6788.8 4746.76,-6712 4746.76,-6712 4746.76,-6712 5077.44,-6712 5077.44,-6712"/>
<polygon fill="black" stroke="black" points="5077.44,-6715.5 5087.44,-6712 5077.44,-6708.5 5077.44,-6715.5"/>
</g>
<!-- tp_layer1_out_proj_gpu2 -->
<g id="node167" class="node">
<title>tp_layer1_out_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="6087.76,-6581 5598.76,-6581 5598.76,-6513 6087.76,-6513 6087.76,-6581"/>
<text text-anchor="middle" x="5843.26" y="-6565.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5843.26" y="-6550.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5843.26" y="-6535.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5843.26" y="-6520.8" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_attn_out_gpu2&#45;&gt;tp_layer1_out_proj_gpu2 -->
<g id="edge212" class="edge">
<title>tp_layer1_attn_out_gpu2&#45;&gt;tp_layer1_out_proj_gpu2</title>
<path fill="none" stroke="black" d="M5606.76,-6666.82C5606.76,-6666.82 5606.76,-6591.08 5606.76,-6591.08"/>
<polygon fill="black" stroke="black" points="5610.26,-6591.08 5606.76,-6581.08 5603.26,-6591.08 5610.26,-6591.08"/>
</g>
<!-- tp_layer1_gather_v_gpu2&#45;&gt;tp_layer1_attn_out_gpu2 -->
<g id="edge211" class="edge">
<title>tp_layer1_gather_v_gpu2&#45;&gt;tp_layer1_attn_out_gpu2</title>
<path fill="none" stroke="black" d="M5351.26,-6820.91C5351.26,-6820.91 5351.26,-6745.03 5351.26,-6745.03"/>
<polygon fill="black" stroke="black" points="5354.76,-6745.03 5351.26,-6735.03 5347.76,-6745.03 5354.76,-6745.03"/>
</g>
<!-- tp_layer1_out_proj_gpu2&#45;&gt;tp_layer1_attn_all_reduce -->
<g id="edge275" class="edge">
<title>tp_layer1_out_proj_gpu2&#45;&gt;tp_layer1_attn_all_reduce</title>
<path fill="none" stroke="black" d="M5881.01,-6512.64C5881.01,-6469.76 5881.01,-6402 5881.01,-6402 5881.01,-6402 7887.79,-6402 7887.79,-6402"/>
<polygon fill="black" stroke="black" points="7887.79,-6405.5 7897.79,-6402 7887.79,-6398.5 7887.79,-6405.5"/>
</g>
<!-- tp_layer1_gather_q_gpu3 -->
<g id="node173" class="node">
<title>tp_layer1_gather_q_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="5674.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="5674.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="5674.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5674.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5674.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_q_proj_gpu3&#45;&gt;tp_layer1_gather_q_gpu3 -->
<g id="edge216" class="edge">
<title>tp_layer1_q_proj_gpu3&#45;&gt;tp_layer1_gather_q_gpu3</title>
<path fill="none" stroke="black" d="M5752.26,-7367.48C5752.26,-7367.48 5752.26,-7290.43 5752.26,-7290.43"/>
<polygon fill="black" stroke="black" points="5755.76,-7290.43 5752.26,-7280.43 5748.76,-7290.43 5755.76,-7290.43"/>
</g>
<!-- tp_layer1_gather_k_gpu3 -->
<g id="node172" class="node">
<title>tp_layer1_gather_k_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="6441.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="6441.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="6441.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6441.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6441.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_k_proj_gpu3&#45;&gt;tp_layer1_gather_k_gpu3 -->
<g id="edge217" class="edge">
<title>tp_layer1_k_proj_gpu3&#45;&gt;tp_layer1_gather_k_gpu3</title>
<path fill="none" stroke="black" d="M6324.38,-7367.48C6324.38,-7367.48 6324.38,-7288.85 6324.38,-7288.85"/>
<polygon fill="black" stroke="black" points="6327.88,-7288.85 6324.38,-7278.85 6320.88,-7288.85 6327.88,-7288.85"/>
</g>
<!-- tp_layer1_gather_v_gpu3 -->
<g id="node176" class="node">
<title>tp_layer1_gather_v_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="7003.26" cy="-7051.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="7003.26" y="-7070.05" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="7003.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7003.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7003.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_v_proj_gpu3&#45;&gt;tp_layer1_gather_v_gpu3 -->
<g id="edge221" class="edge">
<title>tp_layer1_v_proj_gpu3&#45;&gt;tp_layer1_gather_v_gpu3</title>
<path fill="none" stroke="black" d="M6889.76,-7367.28C6889.76,-7367.28 6889.76,-7106.86 6889.76,-7106.86"/>
<polygon fill="black" stroke="black" points="6893.26,-7106.86 6889.76,-7096.86 6886.26,-7106.86 6893.26,-7106.86"/>
</g>
<!-- tp_layer1_attn_scores_gpu3 -->
<g id="node171" class="node">
<title>tp_layer1_attn_scores_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="6590.76,-7085.25 6051.76,-7085.25 6051.76,-7017.25 6590.76,-7017.25 6590.76,-7085.25"/>
<text text-anchor="middle" x="6321.26" y="-7070.05" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="6321.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6321.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6321.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_softmax_gpu3 -->
<g id="node174" class="node">
<title>tp_layer1_softmax_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="6752.76,-6903.08 6213.76,-6903.08 6213.76,-6835.08 6752.76,-6835.08 6752.76,-6903.08"/>
<text text-anchor="middle" x="6483.26" y="-6887.88" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="6483.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6483.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6483.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_attn_scores_gpu3&#45;&gt;tp_layer1_softmax_gpu3 -->
<g id="edge220" class="edge">
<title>tp_layer1_attn_scores_gpu3&#45;&gt;tp_layer1_softmax_gpu3</title>
<path fill="none" stroke="black" d="M6402.26,-7016.98C6402.26,-7016.98 6402.26,-6913.19 6402.26,-6913.19"/>
<polygon fill="black" stroke="black" points="6405.76,-6913.19 6402.26,-6903.19 6398.76,-6913.19 6405.76,-6913.19"/>
</g>
<!-- tp_layer1_gather_k_gpu3&#45;&gt;tp_layer1_attn_scores_gpu3 -->
<g id="edge219" class="edge">
<title>tp_layer1_gather_k_gpu3&#45;&gt;tp_layer1_attn_scores_gpu3</title>
<path fill="none" stroke="black" d="M6338.88,-7186.97C6338.88,-7186.97 6338.88,-7095.52 6338.88,-7095.52"/>
<polygon fill="black" stroke="black" points="6342.38,-7095.52 6338.88,-7085.52 6335.38,-7095.52 6342.38,-7095.52"/>
</g>
<!-- tp_layer1_gather_q_gpu3&#45;&gt;tp_layer1_attn_scores_gpu3 -->
<g id="edge218" class="edge">
<title>tp_layer1_gather_q_gpu3&#45;&gt;tp_layer1_attn_scores_gpu3</title>
<path fill="none" stroke="black" d="M6028.79,-7233C6045.98,-7233 6056.26,-7233 6056.26,-7233 6056.26,-7233 6056.26,-7095.43 6056.26,-7095.43"/>
<polygon fill="black" stroke="black" points="6059.76,-7095.43 6056.26,-7085.43 6052.76,-7095.43 6059.76,-7095.43"/>
</g>
<!-- tp_layer1_attn_out_gpu3 -->
<g id="node175" class="node">
<title>tp_layer1_attn_out_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="7266.76,-6735 6739.76,-6735 6739.76,-6667 7266.76,-6667 7266.76,-6735"/>
<text text-anchor="middle" x="7003.26" y="-6719.8" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="7003.26" y="-6704.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="7003.26" y="-6689.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7003.26" y="-6674.8" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_softmax_gpu3&#45;&gt;tp_layer1_attn_out_gpu3 -->
<g id="edge222" class="edge">
<title>tp_layer1_softmax_gpu3&#45;&gt;tp_layer1_attn_out_gpu3</title>
<path fill="none" stroke="black" d="M6746.26,-6835.07C6746.26,-6835.07 6746.26,-6745.25 6746.26,-6745.25"/>
<polygon fill="black" stroke="black" points="6749.76,-6745.25 6746.26,-6735.25 6742.76,-6745.25 6749.76,-6745.25"/>
</g>
<!-- tp_layer1_out_proj_gpu3 -->
<g id="node177" class="node">
<title>tp_layer1_out_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="7635.76,-6581 7146.76,-6581 7146.76,-6513 7635.76,-6513 7635.76,-6581"/>
<text text-anchor="middle" x="7391.26" y="-6565.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="7391.26" y="-6550.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7391.26" y="-6535.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7391.26" y="-6520.8" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_attn_out_gpu3&#45;&gt;tp_layer1_out_proj_gpu3 -->
<g id="edge224" class="edge">
<title>tp_layer1_attn_out_gpu3&#45;&gt;tp_layer1_out_proj_gpu3</title>
<path fill="none" stroke="black" d="M7206.76,-6666.82C7206.76,-6666.82 7206.76,-6591.08 7206.76,-6591.08"/>
<polygon fill="black" stroke="black" points="7210.26,-6591.08 7206.76,-6581.08 7203.26,-6591.08 7210.26,-6591.08"/>
</g>
<!-- tp_layer1_gather_v_gpu3&#45;&gt;tp_layer1_attn_out_gpu3 -->
<g id="edge223" class="edge">
<title>tp_layer1_gather_v_gpu3&#45;&gt;tp_layer1_attn_out_gpu3</title>
<path fill="none" stroke="black" d="M7009.76,-7002.91C7009.76,-7002.91 7009.76,-6745.15 7009.76,-6745.15"/>
<polygon fill="black" stroke="black" points="7013.26,-6745.15 7009.76,-6735.15 7006.26,-6745.15 7013.26,-6745.15"/>
</g>
<!-- tp_layer1_out_proj_gpu3&#45;&gt;tp_layer1_attn_all_reduce -->
<g id="edge276" class="edge">
<title>tp_layer1_out_proj_gpu3&#45;&gt;tp_layer1_attn_all_reduce</title>
<path fill="none" stroke="black" d="M7636.11,-6546C7765.89,-6546 7898.79,-6546 7898.79,-6546 7898.79,-6546 7898.79,-6412.5 7898.79,-6412.5"/>
<polygon fill="black" stroke="black" points="7902.29,-6412.5 7898.79,-6402.5 7895.29,-6412.5 7902.29,-6412.5"/>
</g>
<!-- tp_layer1_gather_q_gpu4 -->
<g id="node183" class="node">
<title>tp_layer1_gather_q_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="7338.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="7338.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="7338.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7338.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7338.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_q_proj_gpu4&#45;&gt;tp_layer1_gather_q_gpu4 -->
<g id="edge228" class="edge">
<title>tp_layer1_q_proj_gpu4&#45;&gt;tp_layer1_gather_q_gpu4</title>
<path fill="none" stroke="black" d="M7429.26,-7367.48C7429.26,-7367.48 7429.26,-7290.12 7429.26,-7290.12"/>
<polygon fill="black" stroke="black" points="7432.76,-7290.12 7429.26,-7280.12 7425.76,-7290.12 7432.76,-7290.12"/>
</g>
<!-- tp_layer1_gather_k_gpu4 -->
<g id="node182" class="node">
<title>tp_layer1_gather_k_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="8105.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="8105.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="8105.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8105.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8105.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_k_proj_gpu4&#45;&gt;tp_layer1_gather_k_gpu4 -->
<g id="edge229" class="edge">
<title>tp_layer1_k_proj_gpu4&#45;&gt;tp_layer1_gather_k_gpu4</title>
<path fill="none" stroke="black" d="M7994.88,-7367.48C7994.88,-7367.48 7994.88,-7289.17 7994.88,-7289.17"/>
<polygon fill="black" stroke="black" points="7998.38,-7289.17 7994.88,-7279.17 7991.38,-7289.17 7998.38,-7289.17"/>
</g>
<!-- tp_layer1_gather_v_gpu4 -->
<g id="node186" class="node">
<title>tp_layer1_gather_v_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="8547.26" cy="-6869.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="8547.26" y="-6887.88" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="8547.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8547.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8547.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_v_proj_gpu4&#45;&gt;tp_layer1_gather_v_gpu4 -->
<g id="edge233" class="edge">
<title>tp_layer1_v_proj_gpu4&#45;&gt;tp_layer1_gather_v_gpu4</title>
<path fill="none" stroke="black" d="M8550.76,-7367.38C8550.76,-7367.38 8550.76,-6927.4 8550.76,-6927.4"/>
<polygon fill="black" stroke="black" points="8554.26,-6927.4 8550.76,-6917.4 8547.26,-6927.4 8554.26,-6927.4"/>
</g>
<!-- tp_layer1_attn_scores_gpu4 -->
<g id="node181" class="node">
<title>tp_layer1_attn_scores_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="8134.76,-7085.25 7595.76,-7085.25 7595.76,-7017.25 8134.76,-7017.25 8134.76,-7085.25"/>
<text text-anchor="middle" x="7865.26" y="-7070.05" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="7865.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7865.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="7865.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_softmax_gpu4 -->
<g id="node184" class="node">
<title>tp_layer1_softmax_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="8134.76,-6903.08 7595.76,-6903.08 7595.76,-6835.08 8134.76,-6835.08 8134.76,-6903.08"/>
<text text-anchor="middle" x="7865.26" y="-6887.88" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="7865.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="7865.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="7865.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_attn_scores_gpu4&#45;&gt;tp_layer1_softmax_gpu4 -->
<g id="edge232" class="edge">
<title>tp_layer1_attn_scores_gpu4&#45;&gt;tp_layer1_softmax_gpu4</title>
<path fill="none" stroke="black" d="M7865.26,-7016.98C7865.26,-7016.98 7865.26,-6913.19 7865.26,-6913.19"/>
<polygon fill="black" stroke="black" points="7868.76,-6913.19 7865.26,-6903.19 7861.76,-6913.19 7868.76,-6913.19"/>
</g>
<!-- tp_layer1_gather_k_gpu4&#45;&gt;tp_layer1_attn_scores_gpu4 -->
<g id="edge231" class="edge">
<title>tp_layer1_gather_k_gpu4&#45;&gt;tp_layer1_attn_scores_gpu4</title>
<path fill="none" stroke="black" d="M7942.88,-7190.24C7942.88,-7190.24 7942.88,-7095.3 7942.88,-7095.3"/>
<polygon fill="black" stroke="black" points="7946.38,-7095.3 7942.88,-7085.3 7939.38,-7095.3 7946.38,-7095.3"/>
</g>
<!-- tp_layer1_gather_q_gpu4&#45;&gt;tp_layer1_attn_scores_gpu4 -->
<g id="edge230" class="edge">
<title>tp_layer1_gather_q_gpu4&#45;&gt;tp_layer1_attn_scores_gpu4</title>
<path fill="none" stroke="black" d="M7644.14,-7208.85C7644.14,-7208.85 7644.14,-7095.34 7644.14,-7095.34"/>
<polygon fill="black" stroke="black" points="7647.64,-7095.34 7644.14,-7085.34 7640.64,-7095.34 7647.64,-7095.34"/>
</g>
<!-- tp_layer1_attn_out_gpu4 -->
<g id="node185" class="node">
<title>tp_layer1_attn_out_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="8469.76,-6735 7942.76,-6735 7942.76,-6667 8469.76,-6667 8469.76,-6735"/>
<text text-anchor="middle" x="8206.26" y="-6719.8" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="8206.26" y="-6704.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="8206.26" y="-6689.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8206.26" y="-6674.8" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_softmax_gpu4&#45;&gt;tp_layer1_attn_out_gpu4 -->
<g id="edge234" class="edge">
<title>tp_layer1_softmax_gpu4&#45;&gt;tp_layer1_attn_out_gpu4</title>
<path fill="none" stroke="black" d="M8038.76,-6835.07C8038.76,-6835.07 8038.76,-6745.25 8038.76,-6745.25"/>
<polygon fill="black" stroke="black" points="8042.26,-6745.25 8038.76,-6735.25 8035.26,-6745.25 8042.26,-6745.25"/>
</g>
<!-- tp_layer1_out_proj_gpu4 -->
<g id="node187" class="node">
<title>tp_layer1_out_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="8450.76,-6581 7961.76,-6581 7961.76,-6513 8450.76,-6513 8450.76,-6581"/>
<text text-anchor="middle" x="8206.26" y="-6565.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="8206.26" y="-6550.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8206.26" y="-6535.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8206.26" y="-6520.8" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_attn_out_gpu4&#45;&gt;tp_layer1_out_proj_gpu4 -->
<g id="edge236" class="edge">
<title>tp_layer1_attn_out_gpu4&#45;&gt;tp_layer1_out_proj_gpu4</title>
<path fill="none" stroke="black" d="M8206.26,-6666.82C8206.26,-6666.82 8206.26,-6591.08 8206.26,-6591.08"/>
<polygon fill="black" stroke="black" points="8209.76,-6591.08 8206.26,-6581.08 8202.76,-6591.08 8209.76,-6591.08"/>
</g>
<!-- tp_layer1_gather_v_gpu4&#45;&gt;tp_layer1_attn_out_gpu4 -->
<g id="edge235" class="edge">
<title>tp_layer1_gather_v_gpu4&#45;&gt;tp_layer1_attn_out_gpu4</title>
<path fill="none" stroke="black" d="M8331.38,-6830.94C8331.38,-6830.94 8331.38,-6745.28 8331.38,-6745.28"/>
<polygon fill="black" stroke="black" points="8334.88,-6745.28 8331.38,-6735.28 8327.88,-6745.28 8334.88,-6745.28"/>
</g>
<!-- tp_layer1_out_proj_gpu4&#45;&gt;tp_layer1_attn_all_reduce -->
<g id="edge277" class="edge">
<title>tp_layer1_out_proj_gpu4&#45;&gt;tp_layer1_attn_all_reduce</title>
<path fill="none" stroke="black" d="M8206.26,-6512.98C8206.26,-6512.98 8206.26,-6437.21 8206.26,-6437.21"/>
<polygon fill="black" stroke="black" points="8209.76,-6437.21 8206.26,-6427.21 8202.76,-6437.21 8209.76,-6437.21"/>
</g>
<!-- tp_layer1_gather_q_gpu5 -->
<g id="node193" class="node">
<title>tp_layer1_gather_q_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="8996.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="8996.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="8996.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8996.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8996.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_q_proj_gpu5&#45;&gt;tp_layer1_gather_q_gpu5 -->
<g id="edge240" class="edge">
<title>tp_layer1_q_proj_gpu5&#45;&gt;tp_layer1_gather_q_gpu5</title>
<path fill="none" stroke="black" d="M9103.14,-7367.48C9103.14,-7367.48 9103.14,-7289.48 9103.14,-7289.48"/>
<polygon fill="black" stroke="black" points="9106.64,-7289.48 9103.14,-7279.48 9099.64,-7289.48 9106.64,-7289.48"/>
</g>
<!-- tp_layer1_gather_k_gpu5 -->
<g id="node192" class="node">
<title>tp_layer1_gather_k_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="9763.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="9763.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="9763.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9763.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9763.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_k_proj_gpu5&#45;&gt;tp_layer1_gather_k_gpu5 -->
<g id="edge241" class="edge">
<title>tp_layer1_k_proj_gpu5&#45;&gt;tp_layer1_gather_k_gpu5</title>
<path fill="none" stroke="black" d="M9665.26,-7367.48C9665.26,-7367.48 9665.26,-7289.8 9665.26,-7289.8"/>
<polygon fill="black" stroke="black" points="9668.76,-7289.8 9665.26,-7279.8 9661.76,-7289.8 9668.76,-7289.8"/>
</g>
<!-- tp_layer1_gather_v_gpu5 -->
<g id="node196" class="node">
<title>tp_layer1_gather_v_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="10133.26" cy="-7051.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="10133.26" y="-7070.05" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="10133.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10133.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10133.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_v_proj_gpu5&#45;&gt;tp_layer1_gather_v_gpu5 -->
<g id="edge245" class="edge">
<title>tp_layer1_v_proj_gpu5&#45;&gt;tp_layer1_gather_v_gpu5</title>
<path fill="none" stroke="black" d="M10217.76,-7367.28C10217.76,-7367.28 10217.76,-7108.02 10217.76,-7108.02"/>
<polygon fill="black" stroke="black" points="10221.26,-7108.02 10217.76,-7098.02 10214.26,-7108.02 10221.26,-7108.02"/>
</g>
<!-- tp_layer1_attn_scores_gpu5 -->
<g id="node191" class="node">
<title>tp_layer1_attn_scores_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="9654.76,-7085.25 9115.76,-7085.25 9115.76,-7017.25 9654.76,-7017.25 9654.76,-7085.25"/>
<text text-anchor="middle" x="9385.26" y="-7070.05" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="9385.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9385.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9385.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_softmax_gpu5 -->
<g id="node194" class="node">
<title>tp_layer1_softmax_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="9654.76,-6903.08 9115.76,-6903.08 9115.76,-6835.08 9654.76,-6835.08 9654.76,-6903.08"/>
<text text-anchor="middle" x="9385.26" y="-6887.88" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="9385.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9385.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9385.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_attn_scores_gpu5&#45;&gt;tp_layer1_softmax_gpu5 -->
<g id="edge244" class="edge">
<title>tp_layer1_attn_scores_gpu5&#45;&gt;tp_layer1_softmax_gpu5</title>
<path fill="none" stroke="black" d="M9385.26,-7016.98C9385.26,-7016.98 9385.26,-6913.19 9385.26,-6913.19"/>
<polygon fill="black" stroke="black" points="9388.76,-6913.19 9385.26,-6903.19 9381.76,-6913.19 9388.76,-6913.19"/>
</g>
<!-- tp_layer1_gather_k_gpu5&#45;&gt;tp_layer1_attn_scores_gpu5 -->
<g id="edge243" class="edge">
<title>tp_layer1_gather_k_gpu5&#45;&gt;tp_layer1_attn_scores_gpu5</title>
<path fill="none" stroke="black" d="M9531.88,-7196.99C9531.88,-7196.99 9531.88,-7095.45 9531.88,-7095.45"/>
<polygon fill="black" stroke="black" points="9535.38,-7095.45 9531.88,-7085.45 9528.38,-7095.45 9535.38,-7095.45"/>
</g>
<!-- tp_layer1_gather_q_gpu5&#45;&gt;tp_layer1_attn_scores_gpu5 -->
<g id="edge242" class="edge">
<title>tp_layer1_gather_q_gpu5&#45;&gt;tp_layer1_attn_scores_gpu5</title>
<path fill="none" stroke="black" d="M9233.14,-7197.42C9233.14,-7197.42 9233.14,-7095.31 9233.14,-7095.31"/>
<polygon fill="black" stroke="black" points="9236.64,-7095.31 9233.14,-7085.31 9229.64,-7095.31 9236.64,-7095.31"/>
</g>
<!-- tp_layer1_attn_out_gpu5 -->
<g id="node195" class="node">
<title>tp_layer1_attn_out_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="9648.76,-6735 9121.76,-6735 9121.76,-6667 9648.76,-6667 9648.76,-6735"/>
<text text-anchor="middle" x="9385.26" y="-6719.8" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="9385.26" y="-6704.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9385.26" y="-6689.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9385.26" y="-6674.8" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_softmax_gpu5&#45;&gt;tp_layer1_attn_out_gpu5 -->
<g id="edge246" class="edge">
<title>tp_layer1_softmax_gpu5&#45;&gt;tp_layer1_attn_out_gpu5</title>
<path fill="none" stroke="black" d="M9385.26,-6835.07C9385.26,-6835.07 9385.26,-6745.25 9385.26,-6745.25"/>
<polygon fill="black" stroke="black" points="9388.76,-6745.25 9385.26,-6735.25 9381.76,-6745.25 9388.76,-6745.25"/>
</g>
<!-- tp_layer1_out_proj_gpu5 -->
<g id="node197" class="node">
<title>tp_layer1_out_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="9562.76,-6581 9073.76,-6581 9073.76,-6513 9562.76,-6513 9562.76,-6581"/>
<text text-anchor="middle" x="9318.26" y="-6565.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="9318.26" y="-6550.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9318.26" y="-6535.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9318.26" y="-6520.8" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_attn_out_gpu5&#45;&gt;tp_layer1_out_proj_gpu5 -->
<g id="edge248" class="edge">
<title>tp_layer1_attn_out_gpu5&#45;&gt;tp_layer1_out_proj_gpu5</title>
<path fill="none" stroke="black" d="M9342.26,-6666.82C9342.26,-6666.82 9342.26,-6591.08 9342.26,-6591.08"/>
<polygon fill="black" stroke="black" points="9345.76,-6591.08 9342.26,-6581.08 9338.76,-6591.08 9345.76,-6591.08"/>
</g>
<!-- tp_layer1_gather_v_gpu5&#45;&gt;tp_layer1_attn_out_gpu5 -->
<g id="edge247" class="edge">
<title>tp_layer1_gather_v_gpu5&#45;&gt;tp_layer1_attn_out_gpu5</title>
<path fill="none" stroke="black" d="M9953.63,-7009.58C9953.63,-6916.53 9953.63,-6700 9953.63,-6700 9953.63,-6700 9659.06,-6700 9659.06,-6700"/>
<polygon fill="black" stroke="black" points="9659.06,-6696.5 9649.06,-6700 9659.06,-6703.5 9659.06,-6696.5"/>
</g>
<!-- tp_layer1_out_proj_gpu5&#45;&gt;tp_layer1_attn_all_reduce -->
<g id="edge278" class="edge">
<title>tp_layer1_out_proj_gpu5&#45;&gt;tp_layer1_attn_all_reduce</title>
<path fill="none" stroke="black" d="M9073.6,-6546C8836.9,-6546 8513.73,-6546 8513.73,-6546 8513.73,-6546 8513.73,-6412.5 8513.73,-6412.5"/>
<polygon fill="black" stroke="black" points="8517.23,-6412.5 8513.73,-6402.5 8510.23,-6412.5 8517.23,-6412.5"/>
</g>
<!-- tp_layer1_gather_q_gpu6 -->
<g id="node203" class="node">
<title>tp_layer1_gather_q_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="10672.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="10672.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="10672.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10672.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10672.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_q_proj_gpu6&#45;&gt;tp_layer1_gather_q_gpu6 -->
<g id="edge252" class="edge">
<title>tp_layer1_q_proj_gpu6&#45;&gt;tp_layer1_gather_q_gpu6</title>
<path fill="none" stroke="black" d="M10779.64,-7367.48C10779.64,-7367.48 10779.64,-7289.48 10779.64,-7289.48"/>
<polygon fill="black" stroke="black" points="10783.14,-7289.48 10779.64,-7279.48 10776.14,-7289.48 10783.14,-7289.48"/>
</g>
<!-- tp_layer1_gather_k_gpu6 -->
<g id="node202" class="node">
<title>tp_layer1_gather_k_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="11439.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="11439.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="11439.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11439.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11439.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_k_proj_gpu6&#45;&gt;tp_layer1_gather_k_gpu6 -->
<g id="edge253" class="edge">
<title>tp_layer1_k_proj_gpu6&#45;&gt;tp_layer1_gather_k_gpu6</title>
<path fill="none" stroke="black" d="M11342.26,-7367.48C11342.26,-7367.48 11342.26,-7289.8 11342.26,-7289.8"/>
<polygon fill="black" stroke="black" points="11345.76,-7289.8 11342.26,-7279.8 11338.76,-7289.8 11345.76,-7289.8"/>
</g>
<!-- tp_layer1_gather_v_gpu6 -->
<g id="node206" class="node">
<title>tp_layer1_gather_v_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="11716.26" cy="-6869.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="11716.26" y="-6887.88" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="11716.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11716.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11716.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_v_proj_gpu6&#45;&gt;tp_layer1_gather_v_gpu6 -->
<g id="edge257" class="edge">
<title>tp_layer1_v_proj_gpu6&#45;&gt;tp_layer1_gather_v_gpu6</title>
<path fill="none" stroke="black" d="M11890.76,-7367.38C11890.76,-7367.38 11890.76,-6921.19 11890.76,-6921.19"/>
<polygon fill="black" stroke="black" points="11894.26,-6921.19 11890.76,-6911.19 11887.26,-6921.19 11894.26,-6921.19"/>
</g>
<!-- tp_layer1_attn_scores_gpu6 -->
<g id="node201" class="node">
<title>tp_layer1_attn_scores_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="11227.76,-7085.25 10688.76,-7085.25 10688.76,-7017.25 11227.76,-7017.25 11227.76,-7085.25"/>
<text text-anchor="middle" x="10958.26" y="-7070.05" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="10958.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10958.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="10958.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_softmax_gpu6 -->
<g id="node204" class="node">
<title>tp_layer1_softmax_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="11227.76,-6903.08 10688.76,-6903.08 10688.76,-6835.08 11227.76,-6835.08 11227.76,-6903.08"/>
<text text-anchor="middle" x="10958.26" y="-6887.88" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="10958.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="10958.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="10958.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_attn_scores_gpu6&#45;&gt;tp_layer1_softmax_gpu6 -->
<g id="edge256" class="edge">
<title>tp_layer1_attn_scores_gpu6&#45;&gt;tp_layer1_softmax_gpu6</title>
<path fill="none" stroke="black" d="M10958.26,-7016.98C10958.26,-7016.98 10958.26,-6913.19 10958.26,-6913.19"/>
<polygon fill="black" stroke="black" points="10961.76,-6913.19 10958.26,-6903.19 10954.76,-6913.19 10961.76,-6913.19"/>
</g>
<!-- tp_layer1_gather_k_gpu6&#45;&gt;tp_layer1_attn_scores_gpu6 -->
<g id="edge255" class="edge">
<title>tp_layer1_gather_k_gpu6&#45;&gt;tp_layer1_attn_scores_gpu6</title>
<path fill="none" stroke="black" d="M11156.38,-7204.15C11156.38,-7204.15 11156.38,-7095.41 11156.38,-7095.41"/>
<polygon fill="black" stroke="black" points="11159.88,-7095.41 11156.38,-7085.41 11152.88,-7095.41 11159.88,-7095.41"/>
</g>
<!-- tp_layer1_gather_q_gpu6&#45;&gt;tp_layer1_attn_scores_gpu6 -->
<g id="edge254" class="edge">
<title>tp_layer1_gather_q_gpu6&#45;&gt;tp_layer1_attn_scores_gpu6</title>
<path fill="none" stroke="black" d="M10857.64,-7192.08C10857.64,-7192.08 10857.64,-7095.4 10857.64,-7095.4"/>
<polygon fill="black" stroke="black" points="10861.14,-7095.4 10857.64,-7085.4 10854.14,-7095.4 10861.14,-7095.4"/>
</g>
<!-- tp_layer1_attn_out_gpu6 -->
<g id="node205" class="node">
<title>tp_layer1_attn_out_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="11221.76,-6735 10694.76,-6735 10694.76,-6667 11221.76,-6667 11221.76,-6735"/>
<text text-anchor="middle" x="10958.26" y="-6719.8" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="10958.26" y="-6704.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="10958.26" y="-6689.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10958.26" y="-6674.8" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_softmax_gpu6&#45;&gt;tp_layer1_attn_out_gpu6 -->
<g id="edge258" class="edge">
<title>tp_layer1_softmax_gpu6&#45;&gt;tp_layer1_attn_out_gpu6</title>
<path fill="none" stroke="black" d="M10958.26,-6835.07C10958.26,-6835.07 10958.26,-6745.25 10958.26,-6745.25"/>
<polygon fill="black" stroke="black" points="10961.76,-6745.25 10958.26,-6735.25 10954.76,-6745.25 10961.76,-6745.25"/>
</g>
<!-- tp_layer1_out_proj_gpu6 -->
<g id="node207" class="node">
<title>tp_layer1_out_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="10707.76,-6581 10218.76,-6581 10218.76,-6513 10707.76,-6513 10707.76,-6581"/>
<text text-anchor="middle" x="10463.26" y="-6565.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="10463.26" y="-6550.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10463.26" y="-6535.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="10463.26" y="-6520.8" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_attn_out_gpu6&#45;&gt;tp_layer1_out_proj_gpu6 -->
<g id="edge260" class="edge">
<title>tp_layer1_attn_out_gpu6&#45;&gt;tp_layer1_out_proj_gpu6</title>
<path fill="none" stroke="black" d="M10701.26,-6666.82C10701.26,-6666.82 10701.26,-6591.08 10701.26,-6591.08"/>
<polygon fill="black" stroke="black" points="10704.76,-6591.08 10701.26,-6581.08 10697.76,-6591.08 10704.76,-6591.08"/>
</g>
<!-- tp_layer1_gather_v_gpu6&#45;&gt;tp_layer1_attn_out_gpu6 -->
<g id="edge259" class="edge">
<title>tp_layer1_gather_v_gpu6&#45;&gt;tp_layer1_attn_out_gpu6</title>
<path fill="none" stroke="black" d="M11556.38,-6825.98C11556.38,-6775.88 11556.38,-6700 11556.38,-6700 11556.38,-6700 11231.91,-6700 11231.91,-6700"/>
<polygon fill="black" stroke="black" points="11231.91,-6696.5 11221.91,-6700 11231.91,-6703.5 11231.91,-6696.5"/>
</g>
<!-- tp_layer1_out_proj_gpu6&#45;&gt;tp_layer1_attn_all_reduce -->
<g id="edge279" class="edge">
<title>tp_layer1_out_proj_gpu6&#45;&gt;tp_layer1_attn_all_reduce</title>
<path fill="none" stroke="black" d="M10231.86,-6512.66C10231.86,-6467.55 10231.86,-6394 10231.86,-6394 10231.86,-6394 8550.18,-6394 8550.18,-6394"/>
<polygon fill="black" stroke="black" points="8550.18,-6390.5 8540.18,-6394 8550.18,-6397.5 8550.18,-6390.5"/>
</g>
<!-- tp_layer1_gather_q_gpu7 -->
<g id="node213" class="node">
<title>tp_layer1_gather_q_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="12342.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="12342.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="12342.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12342.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12342.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_q_proj_gpu7&#45;&gt;tp_layer1_gather_q_gpu7 -->
<g id="edge264" class="edge">
<title>tp_layer1_q_proj_gpu7&#45;&gt;tp_layer1_gather_q_gpu7</title>
<path fill="none" stroke="black" d="M12453.14,-7367.48C12453.14,-7367.48 12453.14,-7289.17 12453.14,-7289.17"/>
<polygon fill="black" stroke="black" points="12456.64,-7289.17 12453.14,-7279.17 12449.64,-7289.17 12456.64,-7289.17"/>
</g>
<!-- tp_layer1_gather_k_gpu7 -->
<g id="node212" class="node">
<title>tp_layer1_gather_k_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="13109.26" cy="-7233.41" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="13109.26" y="-7252.21" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="13109.26" y="-7237.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13109.26" y="-7222.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13109.26" y="-7207.21" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_k_proj_gpu7&#45;&gt;tp_layer1_gather_k_gpu7 -->
<g id="edge265" class="edge">
<title>tp_layer1_k_proj_gpu7&#45;&gt;tp_layer1_gather_k_gpu7</title>
<path fill="none" stroke="black" d="M13019.26,-7367.48C13019.26,-7367.48 13019.26,-7290.12 13019.26,-7290.12"/>
<polygon fill="black" stroke="black" points="13022.76,-7290.12 13019.26,-7280.12 13015.76,-7290.12 13022.76,-7290.12"/>
</g>
<!-- tp_layer1_gather_v_gpu7 -->
<g id="node216" class="node">
<title>tp_layer1_gather_v_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="13369.26" cy="-7051.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="13369.26" y="-7070.05" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="13369.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13369.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13369.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_v_proj_gpu7&#45;&gt;tp_layer1_gather_v_gpu7 -->
<g id="edge269" class="edge">
<title>tp_layer1_v_proj_gpu7&#45;&gt;tp_layer1_gather_v_gpu7</title>
<path fill="none" stroke="black" d="M13593.52,-7367.28C13593.52,-7367.28 13593.52,-7098.5 13593.52,-7098.5"/>
<polygon fill="black" stroke="black" points="13597.02,-7098.5 13593.52,-7088.5 13590.02,-7098.5 13597.02,-7098.5"/>
</g>
<!-- tp_layer1_attn_scores_gpu7 -->
<g id="node211" class="node">
<title>tp_layer1_attn_scores_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="12744.76,-7085.25 12205.76,-7085.25 12205.76,-7017.25 12744.76,-7017.25 12744.76,-7085.25"/>
<text text-anchor="middle" x="12475.26" y="-7070.05" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="12475.26" y="-7055.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12475.26" y="-7040.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12475.26" y="-7025.05" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_softmax_gpu7 -->
<g id="node214" class="node">
<title>tp_layer1_softmax_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="12744.76,-6903.08 12205.76,-6903.08 12205.76,-6835.08 12744.76,-6835.08 12744.76,-6903.08"/>
<text text-anchor="middle" x="12475.26" y="-6887.88" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="12475.26" y="-6872.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12475.26" y="-6857.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12475.26" y="-6842.88" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_attn_scores_gpu7&#45;&gt;tp_layer1_softmax_gpu7 -->
<g id="edge268" class="edge">
<title>tp_layer1_attn_scores_gpu7&#45;&gt;tp_layer1_softmax_gpu7</title>
<path fill="none" stroke="black" d="M12475.26,-7016.98C12475.26,-7016.98 12475.26,-6913.19 12475.26,-6913.19"/>
<polygon fill="black" stroke="black" points="12478.76,-6913.19 12475.26,-6903.19 12471.76,-6913.19 12478.76,-6913.19"/>
</g>
<!-- tp_layer1_gather_k_gpu7&#45;&gt;tp_layer1_attn_scores_gpu7 -->
<g id="edge267" class="edge">
<title>tp_layer1_gather_k_gpu7&#45;&gt;tp_layer1_attn_scores_gpu7</title>
<path fill="none" stroke="black" d="M12754.94,-7233C12743.88,-7233 12737.51,-7233 12737.51,-7233 12737.51,-7233 12737.51,-7095.43 12737.51,-7095.43"/>
<polygon fill="black" stroke="black" points="12741.01,-7095.43 12737.51,-7085.43 12734.01,-7095.43 12741.01,-7095.43"/>
</g>
<!-- tp_layer1_gather_q_gpu7&#45;&gt;tp_layer1_attn_scores_gpu7 -->
<g id="edge266" class="edge">
<title>tp_layer1_gather_q_gpu7&#45;&gt;tp_layer1_attn_scores_gpu7</title>
<path fill="none" stroke="black" d="M12451.14,-7187.45C12451.14,-7187.45 12451.14,-7095.41 12451.14,-7095.41"/>
<polygon fill="black" stroke="black" points="12454.64,-7095.41 12451.14,-7085.41 12447.64,-7095.41 12454.64,-7095.41"/>
</g>
<!-- tp_layer1_attn_out_gpu7 -->
<g id="node215" class="node">
<title>tp_layer1_attn_out_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="12738.76,-6735 12211.76,-6735 12211.76,-6667 12738.76,-6667 12738.76,-6735"/>
<text text-anchor="middle" x="12475.26" y="-6719.8" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="12475.26" y="-6704.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12475.26" y="-6689.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12475.26" y="-6674.8" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_softmax_gpu7&#45;&gt;tp_layer1_attn_out_gpu7 -->
<g id="edge270" class="edge">
<title>tp_layer1_softmax_gpu7&#45;&gt;tp_layer1_attn_out_gpu7</title>
<path fill="none" stroke="black" d="M12475.26,-6835.07C12475.26,-6835.07 12475.26,-6745.25 12475.26,-6745.25"/>
<polygon fill="black" stroke="black" points="12478.76,-6745.25 12475.26,-6735.25 12471.76,-6745.25 12478.76,-6745.25"/>
</g>
<!-- tp_layer1_out_proj_gpu7 -->
<g id="node217" class="node">
<title>tp_layer1_out_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="11750.76,-6581 11261.76,-6581 11261.76,-6513 11750.76,-6513 11750.76,-6581"/>
<text text-anchor="middle" x="11506.26" y="-6565.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="11506.26" y="-6550.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11506.26" y="-6535.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="11506.26" y="-6520.8" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_attn_out_gpu7&#45;&gt;tp_layer1_out_proj_gpu7 -->
<g id="edge272" class="edge">
<title>tp_layer1_attn_out_gpu7&#45;&gt;tp_layer1_out_proj_gpu7</title>
<path fill="none" stroke="black" d="M12298.01,-6666.98C12298.01,-6621.36 12298.01,-6546 12298.01,-6546 12298.01,-6546 11760.81,-6546 11760.81,-6546"/>
<polygon fill="black" stroke="black" points="11760.81,-6542.5 11750.81,-6546 11760.81,-6549.5 11760.81,-6542.5"/>
</g>
<!-- tp_layer1_gather_v_gpu7&#45;&gt;tp_layer1_attn_out_gpu7 -->
<g id="edge271" class="edge">
<title>tp_layer1_gather_v_gpu7&#45;&gt;tp_layer1_attn_out_gpu7</title>
<path fill="none" stroke="black" d="M13251.38,-7005.69C13251.38,-6910.65 13251.38,-6700 13251.38,-6700 13251.38,-6700 12748.83,-6700 12748.83,-6700"/>
<polygon fill="black" stroke="black" points="12748.83,-6696.5 12738.83,-6700 12748.83,-6703.5 12748.83,-6696.5"/>
</g>
<!-- tp_layer1_out_proj_gpu7&#45;&gt;tp_layer1_attn_all_reduce -->
<g id="edge280" class="edge">
<title>tp_layer1_out_proj_gpu7&#45;&gt;tp_layer1_attn_all_reduce</title>
<path fill="none" stroke="black" d="M11399.66,-6512.63C11399.66,-6459.13 11399.66,-6362 11399.66,-6362 11399.66,-6362 8545.24,-6362 8545.24,-6362"/>
<polygon fill="black" stroke="black" points="8545.24,-6358.5 8535.24,-6362 8545.24,-6365.5 8545.24,-6358.5"/>
</g>
<!-- tp_layer1_attn_all_reduce&#45;&gt;tp_layer1_attn_residual -->
<g id="edge282" class="edge">
<title>tp_layer1_attn_all_reduce&#45;&gt;tp_layer1_attn_residual</title>
<path fill="none" stroke="black" d="M8528.23,-6359.44C8528.23,-6315.41 8528.23,-6212 8528.23,-6212 8528.23,-6212 10268.11,-6212 10268.11,-6212"/>
<polygon fill="black" stroke="black" points="10268.11,-6215.5 10278.11,-6212 10268.11,-6208.5 10268.11,-6215.5"/>
</g>
<!-- tp_layer1_moe_norm -->
<g id="node220" class="node">
<title>tp_layer1_moe_norm</title>
<polygon fill="lightyellow" stroke="black" points="8995.76,-6062.66 8498.76,-6062.66 8498.76,-5994.66 8995.76,-5994.66 8995.76,-6062.66"/>
<text text-anchor="middle" x="8747.26" y="-6047.46" font-family="Times,serif" font-size="14.00">Layer Norm</text>
<text text-anchor="middle" x="8747.26" y="-6032.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8747.26" y="-6017.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8747.26" y="-6002.46" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer1_attn_residual&#45;&gt;tp_layer1_moe_norm -->
<g id="edge283" class="edge">
<title>tp_layer1_attn_residual&#45;&gt;tp_layer1_moe_norm</title>
<path fill="none" stroke="black" d="M10285.26,-6180C9715.2,-6180 8948.64,-6180 8948.64,-6180 8948.64,-6180 8948.64,-6073 8948.64,-6073"/>
<polygon fill="black" stroke="black" points="8952.14,-6073 8948.64,-6063 8945.14,-6073 8952.14,-6073"/>
</g>
<!-- tp_layer1_final_residual -->
<g id="node270" class="node">
<title>tp_layer1_final_residual</title>
<ellipse fill="lightblue" stroke="black" cx="10891.26" cy="-5216.41" rx="646.09" ry="48.17"/>
<text text-anchor="middle" x="10891.26" y="-5235.21" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="10891.26" y="-5220.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096], [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10891.26" y="-5205.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10891.26" y="-5190.21" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer1_attn_residual&#45;&gt;tp_layer1_final_residual -->
<g id="edge348" class="edge">
<title>tp_layer1_attn_residual&#45;&gt;tp_layer1_final_residual</title>
<path fill="none" stroke="black" d="M11282.26,-6158.32C11282.26,-6158.32 11282.26,-5264.84 11282.26,-5264.84"/>
<polygon fill="black" stroke="black" points="11285.76,-5264.84 11282.26,-5254.84 11278.76,-5264.84 11285.76,-5264.84"/>
</g>
<!-- tp_layer1_expert0_up -->
<g id="node221" class="node">
<title>tp_layer1_expert0_up</title>
<polygon fill="lightcoral" stroke="black" points="4488.26,-5908.66 3982.26,-5908.66 3982.26,-5840.66 4488.26,-5840.66 4488.26,-5908.66"/>
<text text-anchor="middle" x="4235.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 0 Up</text>
<text text-anchor="middle" x="4235.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4235.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4235.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert0_up -->
<g id="edge284" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert0_up</title>
<path fill="none" stroke="black" d="M8498.55,-6055C7558.74,-6055 4277.01,-6055 4277.01,-6055 4277.01,-6055 4277.01,-5919.01 4277.01,-5919.01"/>
<polygon fill="black" stroke="black" points="4280.51,-5919.01 4277.01,-5909.01 4273.51,-5919.01 4280.51,-5919.01"/>
</g>
<!-- tp_layer1_expert1_up -->
<g id="node224" class="node">
<title>tp_layer1_expert1_up</title>
<polygon fill="lightcoral" stroke="black" points="5052.26,-5908.66 4546.26,-5908.66 4546.26,-5840.66 5052.26,-5840.66 5052.26,-5908.66"/>
<text text-anchor="middle" x="4799.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 1 Up</text>
<text text-anchor="middle" x="4799.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4799.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4799.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert1_up -->
<g id="edge287" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert1_up</title>
<path fill="none" stroke="black" d="M8498.68,-6047C7665.63,-6047 5024.63,-6047 5024.63,-6047 5024.63,-6047 5024.63,-5918.71 5024.63,-5918.71"/>
<polygon fill="black" stroke="black" points="5028.13,-5918.71 5024.63,-5908.71 5021.13,-5918.71 5028.13,-5918.71"/>
</g>
<!-- tp_layer1_expert2_up -->
<g id="node227" class="node">
<title>tp_layer1_expert2_up</title>
<polygon fill="lightcoral" stroke="black" points="5616.26,-5908.66 5110.26,-5908.66 5110.26,-5840.66 5616.26,-5840.66 5616.26,-5908.66"/>
<text text-anchor="middle" x="5363.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 2 Up</text>
<text text-anchor="middle" x="5363.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5363.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5363.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert2_up -->
<g id="edge290" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert2_up</title>
<path fill="none" stroke="black" d="M8498.59,-6039C7756.28,-6039 5607.51,-6039 5607.51,-6039 5607.51,-6039 5607.51,-5918.71 5607.51,-5918.71"/>
<polygon fill="black" stroke="black" points="5611.01,-5918.71 5607.51,-5908.71 5604.01,-5918.71 5611.01,-5918.71"/>
</g>
<!-- tp_layer1_expert3_up -->
<g id="node230" class="node">
<title>tp_layer1_expert3_up</title>
<polygon fill="lightcoral" stroke="black" points="6180.26,-5908.66 5674.26,-5908.66 5674.26,-5840.66 6180.26,-5840.66 6180.26,-5908.66"/>
<text text-anchor="middle" x="5927.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 3 Up</text>
<text text-anchor="middle" x="5927.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5927.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5927.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert3_up -->
<g id="edge293" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert3_up</title>
<path fill="none" stroke="black" d="M8498.47,-6032C7845.71,-6032 6134.01,-6032 6134.01,-6032 6134.01,-6032 6134.01,-5918.8 6134.01,-5918.8"/>
<polygon fill="black" stroke="black" points="6137.51,-5918.8 6134.01,-5908.8 6130.51,-5918.8 6137.51,-5918.8"/>
</g>
<!-- tp_layer1_expert4_up -->
<g id="node233" class="node">
<title>tp_layer1_expert4_up</title>
<polygon fill="lightcoral" stroke="black" points="6744.26,-5908.66 6238.26,-5908.66 6238.26,-5840.66 6744.26,-5840.66 6744.26,-5908.66"/>
<text text-anchor="middle" x="6491.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 4 Up</text>
<text text-anchor="middle" x="6491.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6491.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6491.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert4_up -->
<g id="edge296" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert4_up</title>
<path fill="none" stroke="black" d="M8498.59,-6024C7911.62,-6024 6489.01,-6024 6489.01,-6024 6489.01,-6024 6489.01,-5918.92 6489.01,-5918.92"/>
<polygon fill="black" stroke="black" points="6492.51,-5918.92 6489.01,-5908.92 6485.51,-5918.93 6492.51,-5918.92"/>
</g>
<!-- tp_layer1_expert5_up -->
<g id="node236" class="node">
<title>tp_layer1_expert5_up</title>
<polygon fill="lightcoral" stroke="black" points="7308.26,-5908.66 6802.26,-5908.66 6802.26,-5840.66 7308.26,-5840.66 7308.26,-5908.66"/>
<text text-anchor="middle" x="7055.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 5 Up</text>
<text text-anchor="middle" x="7055.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7055.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7055.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert5_up -->
<g id="edge299" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert5_up</title>
<path fill="none" stroke="black" d="M8498.43,-6017C8067.41,-6017 7227.51,-6017 7227.51,-6017 7227.51,-6017 7227.51,-5918.76 7227.51,-5918.76"/>
<polygon fill="black" stroke="black" points="7231.01,-5918.76 7227.51,-5908.76 7224.01,-5918.76 7231.01,-5918.76"/>
</g>
<!-- tp_layer1_expert6_up -->
<g id="node239" class="node">
<title>tp_layer1_expert6_up</title>
<polygon fill="lightcoral" stroke="black" points="7872.26,-5908.66 7366.26,-5908.66 7366.26,-5840.66 7872.26,-5840.66 7872.26,-5908.66"/>
<text text-anchor="middle" x="7619.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 6 Up</text>
<text text-anchor="middle" x="7619.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7619.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7619.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert6_up -->
<g id="edge302" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert6_up</title>
<path fill="none" stroke="black" d="M8498.74,-6009C8237.36,-6009 7863.54,-6009 7863.54,-6009 7863.54,-6009 7863.54,-5918.91 7863.54,-5918.91"/>
<polygon fill="black" stroke="black" points="7867.04,-5918.91 7863.54,-5908.91 7860.04,-5918.91 7867.04,-5918.91"/>
</g>
<!-- tp_layer1_expert7_up -->
<g id="node242" class="node">
<title>tp_layer1_expert7_up</title>
<polygon fill="lightcoral" stroke="black" points="8436.26,-5908.66 7930.26,-5908.66 7930.26,-5840.66 8436.26,-5840.66 8436.26,-5908.66"/>
<text text-anchor="middle" x="8183.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 7 Up</text>
<text text-anchor="middle" x="8183.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8183.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8183.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert7_up -->
<g id="edge305" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert7_up</title>
<path fill="none" stroke="black" d="M8498.65,-6002C8347.45,-6002 8183.26,-6002 8183.26,-6002 8183.26,-6002 8183.26,-5918.79 8183.26,-5918.79"/>
<polygon fill="black" stroke="black" points="8186.76,-5918.79 8183.26,-5908.79 8179.76,-5918.79 8186.76,-5918.79"/>
</g>
<!-- tp_layer1_expert8_up -->
<g id="node245" class="node">
<title>tp_layer1_expert8_up</title>
<polygon fill="lightcoral" stroke="black" points="9000.26,-5908.66 8494.26,-5908.66 8494.26,-5840.66 9000.26,-5840.66 9000.26,-5908.66"/>
<text text-anchor="middle" x="8747.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 8 Up</text>
<text text-anchor="middle" x="8747.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8747.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8747.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert8_up -->
<g id="edge308" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert8_up</title>
<path fill="none" stroke="black" d="M8747.26,-5994.49C8747.26,-5994.49 8747.26,-5918.75 8747.26,-5918.75"/>
<polygon fill="black" stroke="black" points="8750.76,-5918.75 8747.26,-5908.75 8743.76,-5918.75 8750.76,-5918.75"/>
</g>
<!-- tp_layer1_expert9_up -->
<g id="node248" class="node">
<title>tp_layer1_expert9_up</title>
<polygon fill="lightcoral" stroke="black" points="9564.26,-5908.66 9058.26,-5908.66 9058.26,-5840.66 9564.26,-5840.66 9564.26,-5908.66"/>
<text text-anchor="middle" x="9311.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 9 Up</text>
<text text-anchor="middle" x="9311.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9311.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9311.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert9_up -->
<g id="edge311" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert9_up</title>
<path fill="none" stroke="black" d="M8996.06,-6003C9036.8,-6003 9066.01,-6003 9066.01,-6003 9066.01,-6003 9066.01,-5918.72 9066.01,-5918.72"/>
<polygon fill="black" stroke="black" points="9069.51,-5918.72 9066.01,-5908.72 9062.51,-5918.72 9069.51,-5918.72"/>
</g>
<!-- tp_layer1_expert10_up -->
<g id="node251" class="node">
<title>tp_layer1_expert10_up</title>
<polygon fill="lightcoral" stroke="black" points="10128.26,-5908.66 9622.26,-5908.66 9622.26,-5840.66 10128.26,-5840.66 10128.26,-5908.66"/>
<text text-anchor="middle" x="9875.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 10 Up</text>
<text text-anchor="middle" x="9875.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9875.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9875.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert10_up -->
<g id="edge314" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert10_up</title>
<path fill="none" stroke="black" d="M8995.87,-6011C9258.64,-6011 9635.51,-6011 9635.51,-6011 9635.51,-6011 9635.51,-5918.72 9635.51,-5918.72"/>
<polygon fill="black" stroke="black" points="9639.01,-5918.72 9635.51,-5908.72 9632.01,-5918.72 9639.01,-5918.72"/>
</g>
<!-- tp_layer1_expert11_up -->
<g id="node254" class="node">
<title>tp_layer1_expert11_up</title>
<polygon fill="lightcoral" stroke="black" points="10692.26,-5908.66 10186.26,-5908.66 10186.26,-5840.66 10692.26,-5840.66 10692.26,-5908.66"/>
<text text-anchor="middle" x="10439.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 11 Up</text>
<text text-anchor="middle" x="10439.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10439.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10439.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert11_up -->
<g id="edge317" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert11_up</title>
<path fill="none" stroke="black" d="M8995.77,-6020C9411.41,-6020 10202.51,-6020 10202.51,-6020 10202.51,-6020 10202.51,-5918.74 10202.51,-5918.74"/>
<polygon fill="black" stroke="black" points="10206.01,-5918.74 10202.51,-5908.74 10199.01,-5918.74 10206.01,-5918.74"/>
</g>
<!-- tp_layer1_expert12_up -->
<g id="node257" class="node">
<title>tp_layer1_expert12_up</title>
<polygon fill="lightcoral" stroke="black" points="11256.26,-5908.66 10750.26,-5908.66 10750.26,-5840.66 11256.26,-5840.66 11256.26,-5908.66"/>
<text text-anchor="middle" x="11003.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 12 Up</text>
<text text-anchor="middle" x="11003.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11003.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11003.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert12_up -->
<g id="edge320" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert12_up</title>
<path fill="none" stroke="black" d="M8995.96,-6028C9582.5,-6028 11003.26,-6028 11003.26,-6028 11003.26,-6028 11003.26,-5918.69 11003.26,-5918.69"/>
<polygon fill="black" stroke="black" points="11006.76,-5918.69 11003.26,-5908.69 10999.76,-5918.69 11006.76,-5918.69"/>
</g>
<!-- tp_layer1_expert13_up -->
<g id="node260" class="node">
<title>tp_layer1_expert13_up</title>
<polygon fill="lightcoral" stroke="black" points="11820.26,-5908.66 11314.26,-5908.66 11314.26,-5840.66 11820.26,-5840.66 11820.26,-5908.66"/>
<text text-anchor="middle" x="11567.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 13 Up</text>
<text text-anchor="middle" x="11567.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11567.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11567.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert13_up -->
<g id="edge323" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert13_up</title>
<path fill="none" stroke="black" d="M8995.96,-6037C9660.24,-6037 11425.91,-6037 11425.91,-6037 11425.91,-6037 11425.91,-5918.7 11425.91,-5918.7"/>
<polygon fill="black" stroke="black" points="11429.41,-5918.7 11425.91,-5908.7 11422.41,-5918.7 11429.41,-5918.7"/>
</g>
<!-- tp_layer1_expert14_up -->
<g id="node263" class="node">
<title>tp_layer1_expert14_up</title>
<polygon fill="lightcoral" stroke="black" points="12384.26,-5908.66 11878.26,-5908.66 11878.26,-5840.66 12384.26,-5840.66 12384.26,-5908.66"/>
<text text-anchor="middle" x="12131.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 14 Up</text>
<text text-anchor="middle" x="12131.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12131.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12131.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert14_up -->
<g id="edge326" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert14_up</title>
<path fill="none" stroke="black" d="M8995.8,-6045C9752.11,-6045 11974.39,-6045 11974.39,-6045 11974.39,-6045 11974.39,-5918.72 11974.39,-5918.72"/>
<polygon fill="black" stroke="black" points="11977.89,-5918.72 11974.39,-5908.72 11970.89,-5918.72 11977.89,-5918.72"/>
</g>
<!-- tp_layer1_expert15_up -->
<g id="node266" class="node">
<title>tp_layer1_expert15_up</title>
<polygon fill="lightcoral" stroke="black" points="12948.26,-5908.66 12442.26,-5908.66 12442.26,-5840.66 12948.26,-5840.66 12948.26,-5908.66"/>
<text text-anchor="middle" x="12695.26" y="-5893.46" font-family="Times,serif" font-size="14.00">Expert 15 Up</text>
<text text-anchor="middle" x="12695.26" y="-5878.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12695.26" y="-5863.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12695.26" y="-5848.46" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_moe_norm&#45;&gt;tp_layer1_expert15_up -->
<g id="edge329" class="edge">
<title>tp_layer1_moe_norm&#45;&gt;tp_layer1_expert15_up</title>
<path fill="none" stroke="black" d="M8996.1,-6054C9847.32,-6054 12590.51,-6054 12590.51,-6054 12590.51,-6054 12590.51,-5918.82 12590.51,-5918.82"/>
<polygon fill="black" stroke="black" points="12594.01,-5918.82 12590.51,-5908.82 12587.01,-5918.82 12594.01,-5918.82"/>
</g>
<!-- tp_layer1_expert0_activation -->
<g id="node222" class="node">
<title>tp_layer1_expert0_activation</title>
<polygon fill="lightyellow" stroke="black" points="4488.26,-5754.66 3982.26,-5754.66 3982.26,-5686.66 4488.26,-5686.66 4488.26,-5754.66"/>
<text text-anchor="middle" x="4235.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="4235.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4235.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4235.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_expert0_up&#45;&gt;tp_layer1_expert0_activation -->
<g id="edge285" class="edge">
<title>tp_layer1_expert0_up&#45;&gt;tp_layer1_expert0_activation</title>
<path fill="none" stroke="black" d="M4235.26,-5840.49C4235.26,-5840.49 4235.26,-5764.75 4235.26,-5764.75"/>
<polygon fill="black" stroke="black" points="4238.76,-5764.75 4235.26,-5754.75 4231.76,-5764.75 4238.76,-5764.75"/>
</g>
<!-- tp_layer1_expert0_down -->
<g id="node223" class="node">
<title>tp_layer1_expert0_down</title>
<polygon fill="lightcoral" stroke="black" points="4494.26,-5600.66 4000.26,-5600.66 4000.26,-5532.66 4494.26,-5532.66 4494.26,-5600.66"/>
<text text-anchor="middle" x="4247.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 0 Down</text>
<text text-anchor="middle" x="4247.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4247.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4247.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_expert0_activation&#45;&gt;tp_layer1_expert0_down -->
<g id="edge286" class="edge">
<title>tp_layer1_expert0_activation&#45;&gt;tp_layer1_expert0_down</title>
<path fill="none" stroke="black" d="M4244.26,-5686.49C4244.26,-5686.49 4244.26,-5610.75 4244.26,-5610.75"/>
<polygon fill="black" stroke="black" points="4247.76,-5610.75 4244.26,-5600.75 4240.76,-5610.75 4247.76,-5610.75"/>
</g>
<!-- tp_layer1_moe_all_reduce -->
<g id="node269" class="node">
<title>tp_layer1_moe_all_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="8747.26" cy="-5398.58" rx="351.36" ry="48.17"/>
<text text-anchor="middle" x="8747.26" y="-5417.38" font-family="Times,serif" font-size="14.00">All&#45;Reduce MoE</text>
<text text-anchor="middle" x="8747.26" y="-5402.38" font-family="Times,serif" font-size="14.00">Input: 8×[512]</text>
<text text-anchor="middle" x="8747.26" y="-5387.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8747.26" y="-5372.38" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer1_expert0_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge332" class="edge">
<title>tp_layer1_expert0_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M4268.51,-5532.41C4268.51,-5474.15 4268.51,-5362 4268.51,-5362 4268.51,-5362 8509,-5362 8509,-5362"/>
<polygon fill="black" stroke="black" points="8509,-5365.5 8519,-5362 8509,-5358.5 8509,-5365.5"/>
</g>
<!-- tp_layer1_expert1_activation -->
<g id="node225" class="node">
<title>tp_layer1_expert1_activation</title>
<polygon fill="lightyellow" stroke="black" points="5052.26,-5754.66 4546.26,-5754.66 4546.26,-5686.66 5052.26,-5686.66 5052.26,-5754.66"/>
<text text-anchor="middle" x="4799.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="4799.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4799.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4799.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_expert1_up&#45;&gt;tp_layer1_expert1_activation -->
<g id="edge288" class="edge">
<title>tp_layer1_expert1_up&#45;&gt;tp_layer1_expert1_activation</title>
<path fill="none" stroke="black" d="M4799.26,-5840.49C4799.26,-5840.49 4799.26,-5764.75 4799.26,-5764.75"/>
<polygon fill="black" stroke="black" points="4802.76,-5764.75 4799.26,-5754.75 4795.76,-5764.75 4802.76,-5764.75"/>
</g>
<!-- tp_layer1_expert1_down -->
<g id="node226" class="node">
<title>tp_layer1_expert1_down</title>
<polygon fill="lightcoral" stroke="black" points="5058.26,-5600.66 4564.26,-5600.66 4564.26,-5532.66 5058.26,-5532.66 5058.26,-5600.66"/>
<text text-anchor="middle" x="4811.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 1 Down</text>
<text text-anchor="middle" x="4811.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4811.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4811.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer1_expert1_activation&#45;&gt;tp_layer1_expert1_down -->
<g id="edge289" class="edge">
<title>tp_layer1_expert1_activation&#45;&gt;tp_layer1_expert1_down</title>
<path fill="none" stroke="black" d="M4808.26,-5686.49C4808.26,-5686.49 4808.26,-5610.75 4808.26,-5610.75"/>
<polygon fill="black" stroke="black" points="4811.76,-5610.75 4808.26,-5600.75 4804.76,-5610.75 4811.76,-5610.75"/>
</g>
<!-- tp_layer1_expert1_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge333" class="edge">
<title>tp_layer1_expert1_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M4830.01,-5532.66C4830.01,-5477.35 4830.01,-5374 4830.01,-5374 4830.01,-5374 8435.17,-5374 8435.17,-5374"/>
<polygon fill="black" stroke="black" points="8435.17,-5377.5 8445.17,-5374 8435.17,-5370.5 8435.17,-5377.5"/>
</g>
<!-- tp_layer1_expert2_activation -->
<g id="node228" class="node">
<title>tp_layer1_expert2_activation</title>
<polygon fill="lightyellow" stroke="black" points="5616.26,-5754.66 5110.26,-5754.66 5110.26,-5686.66 5616.26,-5686.66 5616.26,-5754.66"/>
<text text-anchor="middle" x="5363.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="5363.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5363.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5363.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_expert2_up&#45;&gt;tp_layer1_expert2_activation -->
<g id="edge291" class="edge">
<title>tp_layer1_expert2_up&#45;&gt;tp_layer1_expert2_activation</title>
<path fill="none" stroke="black" d="M5363.26,-5840.49C5363.26,-5840.49 5363.26,-5764.75 5363.26,-5764.75"/>
<polygon fill="black" stroke="black" points="5366.76,-5764.75 5363.26,-5754.75 5359.76,-5764.75 5366.76,-5764.75"/>
</g>
<!-- tp_layer1_expert2_down -->
<g id="node229" class="node">
<title>tp_layer1_expert2_down</title>
<polygon fill="lightcoral" stroke="black" points="5616.26,-5600.66 5122.26,-5600.66 5122.26,-5532.66 5616.26,-5532.66 5616.26,-5600.66"/>
<text text-anchor="middle" x="5369.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 2 Down</text>
<text text-anchor="middle" x="5369.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5369.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5369.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_expert2_activation&#45;&gt;tp_layer1_expert2_down -->
<g id="edge292" class="edge">
<title>tp_layer1_expert2_activation&#45;&gt;tp_layer1_expert2_down</title>
<path fill="none" stroke="black" d="M5369.26,-5686.49C5369.26,-5686.49 5369.26,-5610.75 5369.26,-5610.75"/>
<polygon fill="black" stroke="black" points="5372.76,-5610.75 5369.26,-5600.75 5365.76,-5610.75 5372.76,-5610.75"/>
</g>
<!-- tp_layer1_expert2_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge334" class="edge">
<title>tp_layer1_expert2_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M5388.51,-5532.26C5388.51,-5479.84 5388.51,-5386 5388.51,-5386 5388.51,-5386 8397.89,-5386 8397.89,-5386"/>
<polygon fill="black" stroke="black" points="8397.89,-5389.5 8407.89,-5386 8397.89,-5382.5 8397.89,-5389.5"/>
</g>
<!-- tp_layer1_expert3_activation -->
<g id="node231" class="node">
<title>tp_layer1_expert3_activation</title>
<polygon fill="lightyellow" stroke="black" points="6180.26,-5754.66 5674.26,-5754.66 5674.26,-5686.66 6180.26,-5686.66 6180.26,-5754.66"/>
<text text-anchor="middle" x="5927.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="5927.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5927.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5927.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_expert3_up&#45;&gt;tp_layer1_expert3_activation -->
<g id="edge294" class="edge">
<title>tp_layer1_expert3_up&#45;&gt;tp_layer1_expert3_activation</title>
<path fill="none" stroke="black" d="M5927.26,-5840.49C5927.26,-5840.49 5927.26,-5764.75 5927.26,-5764.75"/>
<polygon fill="black" stroke="black" points="5930.76,-5764.75 5927.26,-5754.75 5923.76,-5764.75 5930.76,-5764.75"/>
</g>
<!-- tp_layer1_expert3_down -->
<g id="node232" class="node">
<title>tp_layer1_expert3_down</title>
<polygon fill="lightcoral" stroke="black" points="6183.26,-5600.66 5689.26,-5600.66 5689.26,-5532.66 6183.26,-5532.66 6183.26,-5600.66"/>
<text text-anchor="middle" x="5936.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 3 Down</text>
<text text-anchor="middle" x="5936.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5936.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5936.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer1_expert3_activation&#45;&gt;tp_layer1_expert3_down -->
<g id="edge295" class="edge">
<title>tp_layer1_expert3_activation&#45;&gt;tp_layer1_expert3_down</title>
<path fill="none" stroke="black" d="M5934.76,-5686.49C5934.76,-5686.49 5934.76,-5610.75 5934.76,-5610.75"/>
<polygon fill="black" stroke="black" points="5938.26,-5610.75 5934.76,-5600.75 5931.26,-5610.75 5938.26,-5610.75"/>
</g>
<!-- tp_layer1_expert3_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge335" class="edge">
<title>tp_layer1_expert3_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M5951.51,-5532.53C5951.51,-5483.25 5951.51,-5398 5951.51,-5398 5951.51,-5398 8385.65,-5398 8385.65,-5398"/>
<polygon fill="black" stroke="black" points="8385.65,-5401.5 8395.65,-5398 8385.65,-5394.5 8385.65,-5401.5"/>
</g>
<!-- tp_layer1_expert4_activation -->
<g id="node234" class="node">
<title>tp_layer1_expert4_activation</title>
<polygon fill="lightyellow" stroke="black" points="6744.26,-5754.66 6238.26,-5754.66 6238.26,-5686.66 6744.26,-5686.66 6744.26,-5754.66"/>
<text text-anchor="middle" x="6491.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="6491.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6491.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6491.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_expert4_up&#45;&gt;tp_layer1_expert4_activation -->
<g id="edge297" class="edge">
<title>tp_layer1_expert4_up&#45;&gt;tp_layer1_expert4_activation</title>
<path fill="none" stroke="black" d="M6491.26,-5840.49C6491.26,-5840.49 6491.26,-5764.75 6491.26,-5764.75"/>
<polygon fill="black" stroke="black" points="6494.76,-5764.75 6491.26,-5754.75 6487.76,-5764.75 6494.76,-5764.75"/>
</g>
<!-- tp_layer1_expert4_down -->
<g id="node235" class="node">
<title>tp_layer1_expert4_down</title>
<polygon fill="lightcoral" stroke="black" points="6753.26,-5600.66 6259.26,-5600.66 6259.26,-5532.66 6753.26,-5532.66 6753.26,-5600.66"/>
<text text-anchor="middle" x="6506.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 4 Down</text>
<text text-anchor="middle" x="6506.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6506.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6506.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_expert4_activation&#45;&gt;tp_layer1_expert4_down -->
<g id="edge298" class="edge">
<title>tp_layer1_expert4_activation&#45;&gt;tp_layer1_expert4_down</title>
<path fill="none" stroke="black" d="M6501.76,-5686.49C6501.76,-5686.49 6501.76,-5610.75 6501.76,-5610.75"/>
<polygon fill="black" stroke="black" points="6505.26,-5610.75 6501.76,-5600.75 6498.26,-5610.75 6505.26,-5610.75"/>
</g>
<!-- tp_layer1_expert4_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge336" class="edge">
<title>tp_layer1_expert4_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M6516.01,-5532.28C6516.01,-5486.17 6516.01,-5410 6516.01,-5410 6516.01,-5410 8395.65,-5410 8395.65,-5410"/>
<polygon fill="black" stroke="black" points="8395.65,-5413.5 8405.65,-5410 8395.65,-5406.5 8395.65,-5413.5"/>
</g>
<!-- tp_layer1_expert5_activation -->
<g id="node237" class="node">
<title>tp_layer1_expert5_activation</title>
<polygon fill="lightyellow" stroke="black" points="7308.26,-5754.66 6802.26,-5754.66 6802.26,-5686.66 7308.26,-5686.66 7308.26,-5754.66"/>
<text text-anchor="middle" x="7055.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="7055.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7055.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7055.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_expert5_up&#45;&gt;tp_layer1_expert5_activation -->
<g id="edge300" class="edge">
<title>tp_layer1_expert5_up&#45;&gt;tp_layer1_expert5_activation</title>
<path fill="none" stroke="black" d="M7055.26,-5840.49C7055.26,-5840.49 7055.26,-5764.75 7055.26,-5764.75"/>
<polygon fill="black" stroke="black" points="7058.76,-5764.75 7055.26,-5754.75 7051.76,-5764.75 7058.76,-5764.75"/>
</g>
<!-- tp_layer1_expert5_down -->
<g id="node238" class="node">
<title>tp_layer1_expert5_down</title>
<polygon fill="lightcoral" stroke="black" points="7311.26,-5600.66 6817.26,-5600.66 6817.26,-5532.66 7311.26,-5532.66 7311.26,-5600.66"/>
<text text-anchor="middle" x="7064.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 5 Down</text>
<text text-anchor="middle" x="7064.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7064.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7064.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer1_expert5_activation&#45;&gt;tp_layer1_expert5_down -->
<g id="edge301" class="edge">
<title>tp_layer1_expert5_activation&#45;&gt;tp_layer1_expert5_down</title>
<path fill="none" stroke="black" d="M7062.76,-5686.49C7062.76,-5686.49 7062.76,-5610.75 7062.76,-5610.75"/>
<polygon fill="black" stroke="black" points="7066.26,-5610.75 7062.76,-5600.75 7059.26,-5610.75 7066.26,-5610.75"/>
</g>
<!-- tp_layer1_expert5_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge337" class="edge">
<title>tp_layer1_expert5_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M7074.51,-5532.38C7074.51,-5489.6 7074.51,-5422 7074.51,-5422 7074.51,-5422 8429.97,-5422 8429.97,-5422"/>
<polygon fill="black" stroke="black" points="8429.97,-5425.5 8439.97,-5422 8429.97,-5418.5 8429.97,-5425.5"/>
</g>
<!-- tp_layer1_expert6_activation -->
<g id="node240" class="node">
<title>tp_layer1_expert6_activation</title>
<polygon fill="lightyellow" stroke="black" points="7872.26,-5754.66 7366.26,-5754.66 7366.26,-5686.66 7872.26,-5686.66 7872.26,-5754.66"/>
<text text-anchor="middle" x="7619.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="7619.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7619.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7619.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_expert6_up&#45;&gt;tp_layer1_expert6_activation -->
<g id="edge303" class="edge">
<title>tp_layer1_expert6_up&#45;&gt;tp_layer1_expert6_activation</title>
<path fill="none" stroke="black" d="M7619.26,-5840.49C7619.26,-5840.49 7619.26,-5764.75 7619.26,-5764.75"/>
<polygon fill="black" stroke="black" points="7622.76,-5764.75 7619.26,-5754.75 7615.76,-5764.75 7622.76,-5764.75"/>
</g>
<!-- tp_layer1_expert6_down -->
<g id="node241" class="node">
<title>tp_layer1_expert6_down</title>
<polygon fill="lightcoral" stroke="black" points="7872.26,-5600.66 7378.26,-5600.66 7378.26,-5532.66 7872.26,-5532.66 7872.26,-5600.66"/>
<text text-anchor="middle" x="7625.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 6 Down</text>
<text text-anchor="middle" x="7625.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7625.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7625.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_expert6_activation&#45;&gt;tp_layer1_expert6_down -->
<g id="edge304" class="edge">
<title>tp_layer1_expert6_activation&#45;&gt;tp_layer1_expert6_down</title>
<path fill="none" stroke="black" d="M7625.26,-5686.49C7625.26,-5686.49 7625.26,-5610.75 7625.26,-5610.75"/>
<polygon fill="black" stroke="black" points="7628.76,-5610.75 7625.26,-5600.75 7621.76,-5610.75 7628.76,-5610.75"/>
</g>
<!-- tp_layer1_expert6_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge338" class="edge">
<title>tp_layer1_expert6_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M7635.51,-5532.5C7635.51,-5493.19 7635.51,-5434 7635.51,-5434 7635.51,-5434 8499.44,-5434 8499.44,-5434"/>
<polygon fill="black" stroke="black" points="8499.44,-5437.5 8509.44,-5434 8499.44,-5430.5 8499.44,-5437.5"/>
</g>
<!-- tp_layer1_expert7_activation -->
<g id="node243" class="node">
<title>tp_layer1_expert7_activation</title>
<polygon fill="lightyellow" stroke="black" points="8436.26,-5754.66 7930.26,-5754.66 7930.26,-5686.66 8436.26,-5686.66 8436.26,-5754.66"/>
<text text-anchor="middle" x="8183.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="8183.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8183.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8183.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_expert7_up&#45;&gt;tp_layer1_expert7_activation -->
<g id="edge306" class="edge">
<title>tp_layer1_expert7_up&#45;&gt;tp_layer1_expert7_activation</title>
<path fill="none" stroke="black" d="M8183.26,-5840.49C8183.26,-5840.49 8183.26,-5764.75 8183.26,-5764.75"/>
<polygon fill="black" stroke="black" points="8186.76,-5764.75 8183.26,-5754.75 8179.76,-5764.75 8186.76,-5764.75"/>
</g>
<!-- tp_layer1_expert7_down -->
<g id="node244" class="node">
<title>tp_layer1_expert7_down</title>
<polygon fill="lightcoral" stroke="black" points="8436.26,-5600.66 7942.26,-5600.66 7942.26,-5532.66 8436.26,-5532.66 8436.26,-5600.66"/>
<text text-anchor="middle" x="8189.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 7 Down</text>
<text text-anchor="middle" x="8189.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8189.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8189.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer1_expert7_activation&#45;&gt;tp_layer1_expert7_down -->
<g id="edge307" class="edge">
<title>tp_layer1_expert7_activation&#45;&gt;tp_layer1_expert7_down</title>
<path fill="none" stroke="black" d="M8189.26,-5686.49C8189.26,-5686.49 8189.26,-5610.75 8189.26,-5610.75"/>
<polygon fill="black" stroke="black" points="8192.76,-5610.75 8189.26,-5600.75 8185.76,-5610.75 8192.76,-5610.75"/>
</g>
<!-- tp_layer1_expert7_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge339" class="edge">
<title>tp_layer1_expert7_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M8416.04,-5532.65C8416.04,-5532.65 8416.04,-5424.73 8416.04,-5424.73"/>
<polygon fill="black" stroke="black" points="8419.54,-5424.73 8416.04,-5414.73 8412.54,-5424.73 8419.54,-5424.73"/>
</g>
<!-- tp_layer1_expert8_activation -->
<g id="node246" class="node">
<title>tp_layer1_expert8_activation</title>
<polygon fill="lightyellow" stroke="black" points="9000.26,-5754.66 8494.26,-5754.66 8494.26,-5686.66 9000.26,-5686.66 9000.26,-5754.66"/>
<text text-anchor="middle" x="8747.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="8747.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8747.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8747.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_expert8_up&#45;&gt;tp_layer1_expert8_activation -->
<g id="edge309" class="edge">
<title>tp_layer1_expert8_up&#45;&gt;tp_layer1_expert8_activation</title>
<path fill="none" stroke="black" d="M8747.26,-5840.49C8747.26,-5840.49 8747.26,-5764.75 8747.26,-5764.75"/>
<polygon fill="black" stroke="black" points="8750.76,-5764.75 8747.26,-5754.75 8743.76,-5764.75 8750.76,-5764.75"/>
</g>
<!-- tp_layer1_expert8_down -->
<g id="node247" class="node">
<title>tp_layer1_expert8_down</title>
<polygon fill="lightcoral" stroke="black" points="8994.26,-5600.66 8500.26,-5600.66 8500.26,-5532.66 8994.26,-5532.66 8994.26,-5600.66"/>
<text text-anchor="middle" x="8747.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 8 Down</text>
<text text-anchor="middle" x="8747.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8747.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8747.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_expert8_activation&#45;&gt;tp_layer1_expert8_down -->
<g id="edge310" class="edge">
<title>tp_layer1_expert8_activation&#45;&gt;tp_layer1_expert8_down</title>
<path fill="none" stroke="black" d="M8747.26,-5686.49C8747.26,-5686.49 8747.26,-5610.75 8747.26,-5610.75"/>
<polygon fill="black" stroke="black" points="8750.76,-5610.75 8747.26,-5600.75 8743.76,-5610.75 8750.76,-5610.75"/>
</g>
<!-- tp_layer1_expert8_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge340" class="edge">
<title>tp_layer1_expert8_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M8747.26,-5532.65C8747.26,-5532.65 8747.26,-5456.88 8747.26,-5456.88"/>
<polygon fill="black" stroke="black" points="8750.76,-5456.88 8747.26,-5446.88 8743.76,-5456.88 8750.76,-5456.88"/>
</g>
<!-- tp_layer1_expert9_activation -->
<g id="node249" class="node">
<title>tp_layer1_expert9_activation</title>
<polygon fill="lightyellow" stroke="black" points="9564.26,-5754.66 9058.26,-5754.66 9058.26,-5686.66 9564.26,-5686.66 9564.26,-5754.66"/>
<text text-anchor="middle" x="9311.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="9311.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9311.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9311.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_expert9_up&#45;&gt;tp_layer1_expert9_activation -->
<g id="edge312" class="edge">
<title>tp_layer1_expert9_up&#45;&gt;tp_layer1_expert9_activation</title>
<path fill="none" stroke="black" d="M9311.26,-5840.49C9311.26,-5840.49 9311.26,-5764.75 9311.26,-5764.75"/>
<polygon fill="black" stroke="black" points="9314.76,-5764.75 9311.26,-5754.75 9307.76,-5764.75 9314.76,-5764.75"/>
</g>
<!-- tp_layer1_expert9_down -->
<g id="node250" class="node">
<title>tp_layer1_expert9_down</title>
<polygon fill="lightcoral" stroke="black" points="9552.26,-5600.66 9058.26,-5600.66 9058.26,-5532.66 9552.26,-5532.66 9552.26,-5600.66"/>
<text text-anchor="middle" x="9305.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 9 Down</text>
<text text-anchor="middle" x="9305.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9305.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9305.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer1_expert9_activation&#45;&gt;tp_layer1_expert9_down -->
<g id="edge313" class="edge">
<title>tp_layer1_expert9_activation&#45;&gt;tp_layer1_expert9_down</title>
<path fill="none" stroke="black" d="M9305.26,-5686.49C9305.26,-5686.49 9305.26,-5610.75 9305.26,-5610.75"/>
<polygon fill="black" stroke="black" points="9308.76,-5610.75 9305.26,-5600.75 9301.76,-5610.75 9308.76,-5610.75"/>
</g>
<!-- tp_layer1_expert9_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge341" class="edge">
<title>tp_layer1_expert9_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M9078.48,-5532.65C9078.48,-5532.65 9078.48,-5424.73 9078.48,-5424.73"/>
<polygon fill="black" stroke="black" points="9081.98,-5424.73 9078.48,-5414.73 9074.98,-5424.73 9081.98,-5424.73"/>
</g>
<!-- tp_layer1_expert10_activation -->
<g id="node252" class="node">
<title>tp_layer1_expert10_activation</title>
<polygon fill="lightyellow" stroke="black" points="10128.26,-5754.66 9622.26,-5754.66 9622.26,-5686.66 10128.26,-5686.66 10128.26,-5754.66"/>
<text text-anchor="middle" x="9875.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="9875.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9875.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9875.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_expert10_up&#45;&gt;tp_layer1_expert10_activation -->
<g id="edge315" class="edge">
<title>tp_layer1_expert10_up&#45;&gt;tp_layer1_expert10_activation</title>
<path fill="none" stroke="black" d="M9875.26,-5840.49C9875.26,-5840.49 9875.26,-5764.75 9875.26,-5764.75"/>
<polygon fill="black" stroke="black" points="9878.76,-5764.75 9875.26,-5754.75 9871.76,-5764.75 9878.76,-5764.75"/>
</g>
<!-- tp_layer1_expert10_down -->
<g id="node253" class="node">
<title>tp_layer1_expert10_down</title>
<polygon fill="lightcoral" stroke="black" points="10113.26,-5600.66 9619.26,-5600.66 9619.26,-5532.66 10113.26,-5532.66 10113.26,-5600.66"/>
<text text-anchor="middle" x="9866.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 10 Down</text>
<text text-anchor="middle" x="9866.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9866.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9866.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_expert10_activation&#45;&gt;tp_layer1_expert10_down -->
<g id="edge316" class="edge">
<title>tp_layer1_expert10_activation&#45;&gt;tp_layer1_expert10_down</title>
<path fill="none" stroke="black" d="M9867.76,-5686.49C9867.76,-5686.49 9867.76,-5610.75 9867.76,-5610.75"/>
<polygon fill="black" stroke="black" points="9871.26,-5610.75 9867.76,-5600.75 9864.26,-5610.75 9871.26,-5610.75"/>
</g>
<!-- tp_layer1_expert10_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge342" class="edge">
<title>tp_layer1_expert10_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M9626.01,-5532.33C9626.01,-5492.44 9626.01,-5432 9626.01,-5432 9626.01,-5432 9009.96,-5432 9009.96,-5432"/>
<polygon fill="black" stroke="black" points="9009.96,-5428.5 8999.96,-5432 9009.96,-5435.5 9009.96,-5428.5"/>
</g>
<!-- tp_layer1_expert11_activation -->
<g id="node255" class="node">
<title>tp_layer1_expert11_activation</title>
<polygon fill="lightyellow" stroke="black" points="10692.26,-5754.66 10186.26,-5754.66 10186.26,-5686.66 10692.26,-5686.66 10692.26,-5754.66"/>
<text text-anchor="middle" x="10439.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="10439.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10439.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10439.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_expert11_up&#45;&gt;tp_layer1_expert11_activation -->
<g id="edge318" class="edge">
<title>tp_layer1_expert11_up&#45;&gt;tp_layer1_expert11_activation</title>
<path fill="none" stroke="black" d="M10439.26,-5840.49C10439.26,-5840.49 10439.26,-5764.75 10439.26,-5764.75"/>
<polygon fill="black" stroke="black" points="10442.76,-5764.75 10439.26,-5754.75 10435.76,-5764.75 10442.76,-5764.75"/>
</g>
<!-- tp_layer1_expert11_down -->
<g id="node256" class="node">
<title>tp_layer1_expert11_down</title>
<polygon fill="lightcoral" stroke="black" points="10675.26,-5600.66 10181.26,-5600.66 10181.26,-5532.66 10675.26,-5532.66 10675.26,-5600.66"/>
<text text-anchor="middle" x="10428.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 11 Down</text>
<text text-anchor="middle" x="10428.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10428.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="10428.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer1_expert11_activation&#45;&gt;tp_layer1_expert11_down -->
<g id="edge319" class="edge">
<title>tp_layer1_expert11_activation&#45;&gt;tp_layer1_expert11_down</title>
<path fill="none" stroke="black" d="M10430.76,-5686.49C10430.76,-5686.49 10430.76,-5610.75 10430.76,-5610.75"/>
<polygon fill="black" stroke="black" points="10434.26,-5610.75 10430.76,-5600.75 10427.26,-5610.75 10434.26,-5610.75"/>
</g>
<!-- tp_layer1_expert11_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge343" class="edge">
<title>tp_layer1_expert11_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M10186.51,-5532.42C10186.51,-5488.79 10186.51,-5419 10186.51,-5419 10186.51,-5419 9075.78,-5419 9075.78,-5419"/>
<polygon fill="black" stroke="black" points="9075.78,-5415.5 9065.78,-5419 9075.78,-5422.5 9075.78,-5415.5"/>
</g>
<!-- tp_layer1_expert12_activation -->
<g id="node258" class="node">
<title>tp_layer1_expert12_activation</title>
<polygon fill="lightyellow" stroke="black" points="11256.26,-5754.66 10750.26,-5754.66 10750.26,-5686.66 11256.26,-5686.66 11256.26,-5754.66"/>
<text text-anchor="middle" x="11003.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="11003.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11003.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11003.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_expert12_up&#45;&gt;tp_layer1_expert12_activation -->
<g id="edge321" class="edge">
<title>tp_layer1_expert12_up&#45;&gt;tp_layer1_expert12_activation</title>
<path fill="none" stroke="black" d="M11003.26,-5840.49C11003.26,-5840.49 11003.26,-5764.75 11003.26,-5764.75"/>
<polygon fill="black" stroke="black" points="11006.76,-5764.75 11003.26,-5754.75 10999.76,-5764.75 11006.76,-5764.75"/>
</g>
<!-- tp_layer1_expert12_down -->
<g id="node259" class="node">
<title>tp_layer1_expert12_down</title>
<polygon fill="lightcoral" stroke="black" points="11238.26,-5600.66 10744.26,-5600.66 10744.26,-5532.66 11238.26,-5532.66 11238.26,-5600.66"/>
<text text-anchor="middle" x="10991.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 12 Down</text>
<text text-anchor="middle" x="10991.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10991.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="10991.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_expert12_activation&#45;&gt;tp_layer1_expert12_down -->
<g id="edge322" class="edge">
<title>tp_layer1_expert12_activation&#45;&gt;tp_layer1_expert12_down</title>
<path fill="none" stroke="black" d="M10994.26,-5686.49C10994.26,-5686.49 10994.26,-5610.75 10994.26,-5610.75"/>
<polygon fill="black" stroke="black" points="10997.76,-5610.75 10994.26,-5600.75 10990.76,-5610.75 10997.76,-5610.75"/>
</g>
<!-- tp_layer1_expert12_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge344" class="edge">
<title>tp_layer1_expert12_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M10991.26,-5532.38C10991.26,-5484.92 10991.26,-5405 10991.26,-5405 10991.26,-5405 9105.73,-5405 9105.73,-5405"/>
<polygon fill="black" stroke="black" points="9105.73,-5401.5 9095.73,-5405 9105.73,-5408.5 9105.73,-5401.5"/>
</g>
<!-- tp_layer1_expert13_activation -->
<g id="node261" class="node">
<title>tp_layer1_expert13_activation</title>
<polygon fill="lightyellow" stroke="black" points="11820.26,-5754.66 11314.26,-5754.66 11314.26,-5686.66 11820.26,-5686.66 11820.26,-5754.66"/>
<text text-anchor="middle" x="11567.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="11567.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11567.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11567.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_expert13_up&#45;&gt;tp_layer1_expert13_activation -->
<g id="edge324" class="edge">
<title>tp_layer1_expert13_up&#45;&gt;tp_layer1_expert13_activation</title>
<path fill="none" stroke="black" d="M11567.26,-5840.49C11567.26,-5840.49 11567.26,-5764.75 11567.26,-5764.75"/>
<polygon fill="black" stroke="black" points="11570.76,-5764.75 11567.26,-5754.75 11563.76,-5764.75 11570.76,-5764.75"/>
</g>
<!-- tp_layer1_expert13_down -->
<g id="node262" class="node">
<title>tp_layer1_expert13_down</title>
<polygon fill="lightcoral" stroke="black" points="11802.26,-5600.66 11308.26,-5600.66 11308.26,-5532.66 11802.26,-5532.66 11802.26,-5600.66"/>
<text text-anchor="middle" x="11555.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 13 Down</text>
<text text-anchor="middle" x="11555.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11555.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="11555.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer1_expert13_activation&#45;&gt;tp_layer1_expert13_down -->
<g id="edge325" class="edge">
<title>tp_layer1_expert13_activation&#45;&gt;tp_layer1_expert13_down</title>
<path fill="none" stroke="black" d="M11558.26,-5686.49C11558.26,-5686.49 11558.26,-5610.75 11558.26,-5610.75"/>
<polygon fill="black" stroke="black" points="11561.76,-5610.75 11558.26,-5600.75 11554.76,-5610.75 11561.76,-5610.75"/>
</g>
<!-- tp_layer1_expert13_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge345" class="edge">
<title>tp_layer1_expert13_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M11422.91,-5532.38C11422.91,-5481.26 11422.91,-5391 11422.91,-5391 11422.91,-5391 9104.31,-5391 9104.31,-5391"/>
<polygon fill="black" stroke="black" points="9104.31,-5387.5 9094.31,-5391 9104.31,-5394.5 9104.31,-5387.5"/>
</g>
<!-- tp_layer1_expert14_activation -->
<g id="node264" class="node">
<title>tp_layer1_expert14_activation</title>
<polygon fill="lightyellow" stroke="black" points="12384.26,-5754.66 11878.26,-5754.66 11878.26,-5686.66 12384.26,-5686.66 12384.26,-5754.66"/>
<text text-anchor="middle" x="12131.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="12131.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12131.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12131.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_expert14_up&#45;&gt;tp_layer1_expert14_activation -->
<g id="edge327" class="edge">
<title>tp_layer1_expert14_up&#45;&gt;tp_layer1_expert14_activation</title>
<path fill="none" stroke="black" d="M12131.26,-5840.49C12131.26,-5840.49 12131.26,-5764.75 12131.26,-5764.75"/>
<polygon fill="black" stroke="black" points="12134.76,-5764.75 12131.26,-5754.75 12127.76,-5764.75 12134.76,-5764.75"/>
</g>
<!-- tp_layer1_expert14_down -->
<g id="node265" class="node">
<title>tp_layer1_expert14_down</title>
<polygon fill="lightcoral" stroke="black" points="12366.26,-5600.66 11872.26,-5600.66 11872.26,-5532.66 12366.26,-5532.66 12366.26,-5600.66"/>
<text text-anchor="middle" x="12119.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 14 Down</text>
<text text-anchor="middle" x="12119.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12119.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="12119.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_expert14_activation&#45;&gt;tp_layer1_expert14_down -->
<g id="edge328" class="edge">
<title>tp_layer1_expert14_activation&#45;&gt;tp_layer1_expert14_down</title>
<path fill="none" stroke="black" d="M12122.26,-5686.49C12122.26,-5686.49 12122.26,-5610.75 12122.26,-5610.75"/>
<polygon fill="black" stroke="black" points="12125.76,-5610.75 12122.26,-5600.75 12118.76,-5610.75 12125.76,-5610.75"/>
</g>
<!-- tp_layer1_expert14_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge346" class="edge">
<title>tp_layer1_expert14_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M12201.59,-5532.32C12201.59,-5477.66 12201.59,-5377 12201.59,-5377 12201.59,-5377 9071.43,-5377 9071.43,-5377"/>
<polygon fill="black" stroke="black" points="9071.43,-5373.5 9061.43,-5377 9071.43,-5380.5 9071.43,-5373.5"/>
</g>
<!-- tp_layer1_expert15_activation -->
<g id="node267" class="node">
<title>tp_layer1_expert15_activation</title>
<polygon fill="lightyellow" stroke="black" points="12948.26,-5754.66 12442.26,-5754.66 12442.26,-5686.66 12948.26,-5686.66 12948.26,-5754.66"/>
<text text-anchor="middle" x="12695.26" y="-5739.46" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="12695.26" y="-5724.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12695.26" y="-5709.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12695.26" y="-5694.46" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_expert15_up&#45;&gt;tp_layer1_expert15_activation -->
<g id="edge330" class="edge">
<title>tp_layer1_expert15_up&#45;&gt;tp_layer1_expert15_activation</title>
<path fill="none" stroke="black" d="M12695.26,-5840.49C12695.26,-5840.49 12695.26,-5764.75 12695.26,-5764.75"/>
<polygon fill="black" stroke="black" points="12698.76,-5764.75 12695.26,-5754.75 12691.76,-5764.75 12698.76,-5764.75"/>
</g>
<!-- tp_layer1_expert15_down -->
<g id="node268" class="node">
<title>tp_layer1_expert15_down</title>
<polygon fill="lightcoral" stroke="black" points="12930.26,-5600.66 12436.26,-5600.66 12436.26,-5532.66 12930.26,-5532.66 12930.26,-5600.66"/>
<text text-anchor="middle" x="12683.26" y="-5585.46" font-family="Times,serif" font-size="14.00">Expert 15 Down</text>
<text text-anchor="middle" x="12683.26" y="-5570.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12683.26" y="-5555.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="12683.26" y="-5540.46" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer1_expert15_activation&#45;&gt;tp_layer1_expert15_down -->
<g id="edge331" class="edge">
<title>tp_layer1_expert15_activation&#45;&gt;tp_layer1_expert15_down</title>
<path fill="none" stroke="black" d="M12686.26,-5686.49C12686.26,-5686.49 12686.26,-5610.75 12686.26,-5610.75"/>
<polygon fill="black" stroke="black" points="12689.76,-5610.75 12686.26,-5600.75 12682.76,-5610.75 12689.76,-5610.75"/>
</g>
<!-- tp_layer1_expert15_down&#45;&gt;tp_layer1_moe_all_reduce -->
<g id="edge347" class="edge">
<title>tp_layer1_expert15_down&#45;&gt;tp_layer1_moe_all_reduce</title>
<path fill="none" stroke="black" d="M12682.51,-5532.29C12682.51,-5474.46 12682.51,-5364 12682.51,-5364 12682.51,-5364 9001.57,-5364 9001.57,-5364"/>
<polygon fill="black" stroke="black" points="9001.57,-5360.5 8991.57,-5364 9001.57,-5367.5 9001.57,-5360.5"/>
</g>
<!-- tp_layer1_moe_all_reduce&#45;&gt;tp_layer1_final_residual -->
<g id="edge349" class="edge">
<title>tp_layer1_moe_all_reduce&#45;&gt;tp_layer1_final_residual</title>
<path fill="none" stroke="black" d="M9082.07,-5383.8C9082.07,-5343.03 9082.07,-5232 9082.07,-5232 9082.07,-5232 10269.7,-5232 10269.7,-5232"/>
<polygon fill="black" stroke="black" points="10269.7,-5235.5 10279.7,-5232 10269.7,-5228.5 10269.7,-5235.5"/>
</g>
<!-- tp_layer2_norm -->
<g id="node271" class="node">
<title>tp_layer2_norm</title>
<polygon fill="lightyellow" stroke="black" points="7895.76,-5082.33 7398.76,-5082.33 7398.76,-5014.33 7895.76,-5014.33 7895.76,-5082.33"/>
<text text-anchor="middle" x="7647.26" y="-5067.13" font-family="Times,serif" font-size="14.00">Layer Norm</text>
<text text-anchor="middle" x="7647.26" y="-5052.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7647.26" y="-5037.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7647.26" y="-5022.13" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer1_final_residual&#45;&gt;tp_layer2_norm -->
<g id="edge350" class="edge">
<title>tp_layer1_final_residual&#45;&gt;tp_layer2_norm</title>
<path fill="none" stroke="black" d="M10283.6,-5200C9405.02,-5200 7884.01,-5200 7884.01,-5200 7884.01,-5200 7884.01,-5092.37 7884.01,-5092.37"/>
<polygon fill="black" stroke="black" points="7887.51,-5092.37 7884.01,-5082.37 7880.51,-5092.37 7887.51,-5092.37"/>
</g>
<!-- tp_layer2_attn_residual -->
<g id="node353" class="node">
<title>tp_layer2_attn_residual</title>
<ellipse fill="lightblue" stroke="black" cx="11109.26" cy="-3689.58" rx="646.09" ry="48.17"/>
<text text-anchor="middle" x="11109.26" y="-3708.38" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="11109.26" y="-3693.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096], [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11109.26" y="-3678.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11109.26" y="-3663.38" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer1_final_residual&#45;&gt;tp_layer2_attn_residual -->
<g id="edge455" class="edge">
<title>tp_layer1_final_residual&#45;&gt;tp_layer2_attn_residual</title>
<path fill="none" stroke="black" d="M11277.88,-5177.82C11277.88,-5047.96 11277.88,-4635 11277.88,-4635 11277.88,-4635 11533.38,-4635 11533.38,-4635 11533.38,-4635 11533.38,-3736.06 11533.38,-3736.06"/>
<polygon fill="black" stroke="black" points="11536.88,-3736.06 11533.38,-3726.06 11529.88,-3736.06 11536.88,-3736.06"/>
</g>
<!-- tp_layer2_q_proj_gpu0 -->
<g id="node272" class="node">
<title>tp_layer2_q_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="1115.76,-4928.33 614.76,-4928.33 614.76,-4860.33 1115.76,-4860.33 1115.76,-4928.33"/>
<text text-anchor="middle" x="865.26" y="-4913.13" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="865.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="865.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="865.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu0 -->
<g id="edge351" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu0</title>
<path fill="none" stroke="black" d="M7398.53,-5077C6202.28,-5077 1098.26,-5077 1098.26,-5077 1098.26,-5077 1098.26,-4938.69 1098.26,-4938.69"/>
<polygon fill="black" stroke="black" points="1101.76,-4938.69 1098.26,-4928.69 1094.76,-4938.69 1101.76,-4938.69"/>
</g>
<!-- tp_layer2_k_proj_gpu0 -->
<g id="node273" class="node">
<title>tp_layer2_k_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="1748.76,-4928.33 1247.76,-4928.33 1247.76,-4860.33 1748.76,-4860.33 1748.76,-4928.33"/>
<text text-anchor="middle" x="1498.26" y="-4913.13" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="1498.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="1498.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1498.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu0 -->
<g id="edge352" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu0</title>
<path fill="none" stroke="black" d="M7398.44,-5071C6273,-5071 1713.38,-5071 1713.38,-5071 1713.38,-5071 1713.38,-4938.39 1713.38,-4938.39"/>
<polygon fill="black" stroke="black" points="1716.88,-4938.39 1713.38,-4928.39 1709.88,-4938.39 1716.88,-4938.39"/>
</g>
<!-- tp_layer2_v_proj_gpu0 -->
<g id="node274" class="node">
<title>tp_layer2_v_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="2307.76,-4928.33 1806.76,-4928.33 1806.76,-4860.33 2307.76,-4860.33 2307.76,-4928.33"/>
<text text-anchor="middle" x="2057.26" y="-4913.13" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="2057.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="2057.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2057.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu0 -->
<g id="edge353" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu0</title>
<path fill="none" stroke="black" d="M7398.38,-5066C6344.32,-5066 2301.76,-5066 2301.76,-5066 2301.76,-5066 2301.76,-4938.66 2301.76,-4938.66"/>
<polygon fill="black" stroke="black" points="2305.26,-4938.66 2301.76,-4928.66 2298.26,-4938.66 2305.26,-4938.66"/>
</g>
<!-- tp_layer2_q_proj_gpu1 -->
<g id="node282" class="node">
<title>tp_layer2_q_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="2866.76,-4928.33 2365.76,-4928.33 2365.76,-4860.33 2866.76,-4860.33 2866.76,-4928.33"/>
<text text-anchor="middle" x="2616.26" y="-4913.13" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="2616.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="2616.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2616.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu1 -->
<g id="edge363" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu1</title>
<path fill="none" stroke="black" d="M7398.47,-5061C6409.07,-5061 2806.76,-5061 2806.76,-5061 2806.76,-5061 2806.76,-4938.46 2806.76,-4938.46"/>
<polygon fill="black" stroke="black" points="2810.26,-4938.46 2806.76,-4928.46 2803.26,-4938.46 2810.26,-4938.46"/>
</g>
<!-- tp_layer2_k_proj_gpu1 -->
<g id="node283" class="node">
<title>tp_layer2_k_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="3425.76,-4928.33 2924.76,-4928.33 2924.76,-4860.33 3425.76,-4860.33 3425.76,-4928.33"/>
<text text-anchor="middle" x="3175.26" y="-4913.13" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="3175.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="3175.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3175.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu1 -->
<g id="edge364" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu1</title>
<path fill="none" stroke="black" d="M7398.5,-5056C6465.36,-5056 3226.26,-5056 3226.26,-5056 3226.26,-5056 3226.26,-4938.62 3226.26,-4938.62"/>
<polygon fill="black" stroke="black" points="3229.76,-4938.62 3226.26,-4928.62 3222.76,-4938.62 3229.76,-4938.62"/>
</g>
<!-- tp_layer2_v_proj_gpu1 -->
<g id="node284" class="node">
<title>tp_layer2_v_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="3984.76,-4928.33 3483.76,-4928.33 3483.76,-4860.33 3984.76,-4860.33 3984.76,-4928.33"/>
<text text-anchor="middle" x="3734.26" y="-4913.13" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="3734.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="3734.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3734.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu1 -->
<g id="edge365" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu1</title>
<path fill="none" stroke="black" d="M7398.61,-5050C6572.6,-5050 3972.01,-5050 3972.01,-5050 3972.01,-5050 3972.01,-4938.49 3972.01,-4938.49"/>
<polygon fill="black" stroke="black" points="3975.51,-4938.49 3972.01,-4928.49 3968.51,-4938.49 3975.51,-4938.49"/>
</g>
<!-- tp_layer2_q_proj_gpu2 -->
<g id="node292" class="node">
<title>tp_layer2_q_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="4543.76,-4928.33 4042.76,-4928.33 4042.76,-4860.33 4543.76,-4860.33 4543.76,-4928.33"/>
<text text-anchor="middle" x="4293.26" y="-4913.13" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="4293.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4293.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4293.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu2 -->
<g id="edge375" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu2</title>
<path fill="none" stroke="black" d="M7398.52,-5045C6658.02,-5045 4519.01,-5045 4519.01,-5045 4519.01,-5045 4519.01,-4938.52 4519.01,-4938.52"/>
<polygon fill="black" stroke="black" points="4522.51,-4938.52 4519.01,-4928.52 4515.51,-4938.52 4522.51,-4938.52"/>
</g>
<!-- tp_layer2_k_proj_gpu2 -->
<g id="node293" class="node">
<title>tp_layer2_k_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="5102.76,-4928.33 4601.76,-4928.33 4601.76,-4860.33 5102.76,-4860.33 5102.76,-4928.33"/>
<text text-anchor="middle" x="4852.26" y="-4913.13" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="4852.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4852.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4852.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu2 -->
<g id="edge376" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu2</title>
<path fill="none" stroke="black" d="M7398.5,-5040C6756.77,-5040 5095.26,-5040 5095.26,-5040 5095.26,-5040 5095.26,-4938.48 5095.26,-4938.48"/>
<polygon fill="black" stroke="black" points="5098.76,-4938.48 5095.26,-4928.48 5091.76,-4938.48 5098.76,-4938.48"/>
</g>
<!-- tp_layer2_v_proj_gpu2 -->
<g id="node294" class="node">
<title>tp_layer2_v_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="5661.76,-4928.33 5160.76,-4928.33 5160.76,-4860.33 5661.76,-4860.33 5661.76,-4928.33"/>
<text text-anchor="middle" x="5411.26" y="-4913.13" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="5411.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5411.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5411.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu2 -->
<g id="edge377" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu2</title>
<path fill="none" stroke="black" d="M7398.74,-5035C6861.3,-5035 5639.01,-5035 5639.01,-5035 5639.01,-5035 5639.01,-4938.38 5639.01,-4938.38"/>
<polygon fill="black" stroke="black" points="5642.51,-4938.38 5639.01,-4928.38 5635.51,-4938.38 5642.51,-4938.38"/>
</g>
<!-- tp_layer2_q_proj_gpu3 -->
<g id="node302" class="node">
<title>tp_layer2_q_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="6220.76,-4928.33 5719.76,-4928.33 5719.76,-4860.33 6220.76,-4860.33 6220.76,-4928.33"/>
<text text-anchor="middle" x="5970.26" y="-4913.13" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="5970.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5970.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5970.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu3 -->
<g id="edge387" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu3</title>
<path fill="none" stroke="black" d="M7398.58,-5030C6988.98,-5030 6217.26,-5030 6217.26,-5030 6217.26,-5030 6217.26,-4938.57 6217.26,-4938.57"/>
<polygon fill="black" stroke="black" points="6220.76,-4938.57 6217.26,-4928.57 6213.76,-4938.57 6220.76,-4938.57"/>
</g>
<!-- tp_layer2_k_proj_gpu3 -->
<g id="node303" class="node">
<title>tp_layer2_k_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="6779.76,-4928.33 6278.76,-4928.33 6278.76,-4860.33 6779.76,-4860.33 6779.76,-4928.33"/>
<text text-anchor="middle" x="6529.26" y="-4913.13" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="6529.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6529.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6529.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu3 -->
<g id="edge388" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu3</title>
<path fill="none" stroke="black" d="M7398.7,-5024C7138.24,-5024 6766.51,-5024 6766.51,-5024 6766.51,-5024 6766.51,-4938.4 6766.51,-4938.4"/>
<polygon fill="black" stroke="black" points="6770.01,-4938.4 6766.51,-4928.4 6763.01,-4938.4 6770.01,-4938.4"/>
</g>
<!-- tp_layer2_v_proj_gpu3 -->
<g id="node304" class="node">
<title>tp_layer2_v_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="7338.76,-4928.33 6837.76,-4928.33 6837.76,-4860.33 7338.76,-4860.33 7338.76,-4928.33"/>
<text text-anchor="middle" x="7088.26" y="-4913.13" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="7088.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7088.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7088.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu3 -->
<g id="edge389" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu3</title>
<path fill="none" stroke="black" d="M7398.54,-5019C7355.89,-5019 7325.01,-5019 7325.01,-5019 7325.01,-5019 7325.01,-4938.4 7325.01,-4938.4"/>
<polygon fill="black" stroke="black" points="7328.51,-4938.4 7325.01,-4928.4 7321.51,-4938.4 7328.51,-4938.4"/>
</g>
<!-- tp_layer2_q_proj_gpu4 -->
<g id="node312" class="node">
<title>tp_layer2_q_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="7897.76,-4928.33 7396.76,-4928.33 7396.76,-4860.33 7897.76,-4860.33 7897.76,-4928.33"/>
<text text-anchor="middle" x="7647.26" y="-4913.13" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="7647.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7647.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7647.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu4 -->
<g id="edge399" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu4</title>
<path fill="none" stroke="black" d="M7647.26,-5014.15C7647.26,-5014.15 7647.26,-4938.41 7647.26,-4938.41"/>
<polygon fill="black" stroke="black" points="7650.76,-4938.41 7647.26,-4928.41 7643.76,-4938.41 7650.76,-4938.41"/>
</g>
<!-- tp_layer2_k_proj_gpu4 -->
<g id="node313" class="node">
<title>tp_layer2_k_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="8456.76,-4928.33 7955.76,-4928.33 7955.76,-4860.33 8456.76,-4860.33 8456.76,-4928.33"/>
<text text-anchor="middle" x="8206.26" y="-4913.13" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="8206.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8206.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8206.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu4 -->
<g id="edge400" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu4</title>
<path fill="none" stroke="black" d="M7896.05,-5019C8033.14,-5019 8175.79,-5019 8175.79,-5019 8175.79,-5019 8175.79,-4938.4 8175.79,-4938.4"/>
<polygon fill="black" stroke="black" points="8179.29,-4938.4 8175.79,-4928.4 8172.29,-4938.4 8179.29,-4938.4"/>
</g>
<!-- tp_layer2_v_proj_gpu4 -->
<g id="node314" class="node">
<title>tp_layer2_v_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="9015.76,-4928.33 8514.76,-4928.33 8514.76,-4860.33 9015.76,-4860.33 9015.76,-4928.33"/>
<text text-anchor="middle" x="8765.26" y="-4913.13" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="8765.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8765.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8765.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu4 -->
<g id="edge401" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu4</title>
<path fill="none" stroke="black" d="M7896.08,-5025C8225.51,-5025 8765.26,-5025 8765.26,-5025 8765.26,-5025 8765.26,-4938.66 8765.26,-4938.66"/>
<polygon fill="black" stroke="black" points="8768.76,-4938.66 8765.26,-4928.66 8761.76,-4938.66 8768.76,-4938.66"/>
</g>
<!-- tp_layer2_q_proj_gpu5 -->
<g id="node322" class="node">
<title>tp_layer2_q_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="9574.76,-4928.33 9073.76,-4928.33 9073.76,-4860.33 9574.76,-4860.33 9574.76,-4928.33"/>
<text text-anchor="middle" x="9324.26" y="-4913.13" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="9324.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9324.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9324.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu5 -->
<g id="edge411" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu5</title>
<path fill="none" stroke="black" d="M7896.16,-5031C8308.99,-5031 9090.38,-5031 9090.38,-5031 9090.38,-5031 9090.38,-4938.47 9090.38,-4938.47"/>
<polygon fill="black" stroke="black" points="9093.88,-4938.47 9090.38,-4928.47 9086.88,-4938.47 9093.88,-4938.47"/>
</g>
<!-- tp_layer2_k_proj_gpu5 -->
<g id="node323" class="node">
<title>tp_layer2_k_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="10133.76,-4928.33 9632.76,-4928.33 9632.76,-4860.33 10133.76,-4860.33 10133.76,-4928.33"/>
<text text-anchor="middle" x="9883.26" y="-4913.13" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="9883.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9883.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9883.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu5 -->
<g id="edge412" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu5</title>
<path fill="none" stroke="black" d="M7895.84,-5036C8476.47,-5036 9873.01,-5036 9873.01,-5036 9873.01,-5036 9873.01,-4938.63 9873.01,-4938.63"/>
<polygon fill="black" stroke="black" points="9876.51,-4938.63 9873.01,-4928.63 9869.51,-4938.63 9876.51,-4938.63"/>
</g>
<!-- tp_layer2_v_proj_gpu5 -->
<g id="node324" class="node">
<title>tp_layer2_v_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="10692.76,-4928.33 10191.76,-4928.33 10191.76,-4860.33 10692.76,-4860.33 10692.76,-4928.33"/>
<text text-anchor="middle" x="10442.26" y="-4913.13" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="10442.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10442.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10442.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu5 -->
<g id="edge413" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu5</title>
<path fill="none" stroke="black" d="M7895.83,-5042C8540.87,-5042 10218.36,-5042 10218.36,-5042 10218.36,-5042 10218.36,-4938.58 10218.36,-4938.58"/>
<polygon fill="black" stroke="black" points="10221.86,-4938.58 10218.36,-4928.58 10214.86,-4938.58 10221.86,-4938.58"/>
</g>
<!-- tp_layer2_q_proj_gpu6 -->
<g id="node332" class="node">
<title>tp_layer2_q_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="11251.76,-4928.33 10750.76,-4928.33 10750.76,-4860.33 11251.76,-4860.33 11251.76,-4928.33"/>
<text text-anchor="middle" x="11001.26" y="-4913.13" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="11001.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11001.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11001.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu6 -->
<g id="edge423" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu6</title>
<path fill="none" stroke="black" d="M7895.93,-5048C8672.55,-5048 11001.26,-5048 11001.26,-5048 11001.26,-5048 11001.26,-4938.44 11001.26,-4938.44"/>
<polygon fill="black" stroke="black" points="11004.76,-4938.44 11001.26,-4928.44 10997.76,-4938.44 11004.76,-4938.44"/>
</g>
<!-- tp_layer2_k_proj_gpu6 -->
<g id="node333" class="node">
<title>tp_layer2_k_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="11810.76,-4928.33 11309.76,-4928.33 11309.76,-4860.33 11810.76,-4860.33 11810.76,-4928.33"/>
<text text-anchor="middle" x="11560.26" y="-4913.13" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="11560.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11560.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11560.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu6 -->
<g id="edge424" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu6</title>
<path fill="none" stroke="black" d="M7895.77,-5053C8736.74,-5053 11423.66,-5053 11423.66,-5053 11423.66,-5053 11423.66,-4938.37 11423.66,-4938.37"/>
<polygon fill="black" stroke="black" points="11427.16,-4938.37 11423.66,-4928.37 11420.16,-4938.37 11427.16,-4938.37"/>
</g>
<!-- tp_layer2_v_proj_gpu6 -->
<g id="node334" class="node">
<title>tp_layer2_v_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="12369.76,-4928.33 11868.76,-4928.33 11868.76,-4860.33 12369.76,-4860.33 12369.76,-4928.33"/>
<text text-anchor="middle" x="12119.26" y="-4913.13" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="12119.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12119.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12119.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu6 -->
<g id="edge425" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu6</title>
<path fill="none" stroke="black" d="M7895.85,-5059C8824.45,-5059 12036.93,-5059 12036.93,-5059 12036.93,-5059 12036.93,-4938.45 12036.93,-4938.45"/>
<polygon fill="black" stroke="black" points="12040.43,-4938.45 12036.93,-4928.45 12033.43,-4938.45 12040.43,-4938.45"/>
</g>
<!-- tp_layer2_q_proj_gpu7 -->
<g id="node342" class="node">
<title>tp_layer2_q_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="12928.76,-4928.33 12427.76,-4928.33 12427.76,-4860.33 12928.76,-4860.33 12928.76,-4928.33"/>
<text text-anchor="middle" x="12678.26" y="-4913.13" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="12678.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12678.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12678.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu7 -->
<g id="edge435" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_q_proj_gpu7</title>
<path fill="none" stroke="black" d="M7896.1,-5065C8878.25,-5065 12432.01,-5065 12432.01,-5065 12432.01,-5065 12432.01,-4938.46 12432.01,-4938.46"/>
<polygon fill="black" stroke="black" points="12435.51,-4938.46 12432.01,-4928.46 12428.51,-4938.46 12435.51,-4938.46"/>
</g>
<!-- tp_layer2_k_proj_gpu7 -->
<g id="node343" class="node">
<title>tp_layer2_k_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="13487.76,-4928.33 12986.76,-4928.33 12986.76,-4860.33 13487.76,-4860.33 13487.76,-4928.33"/>
<text text-anchor="middle" x="13237.26" y="-4913.13" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="13237.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="13237.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13237.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu7 -->
<g id="edge436" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_k_proj_gpu7</title>
<path fill="none" stroke="black" d="M7896.07,-5070C8951.04,-5070 13000.88,-5070 13000.88,-5070 13000.88,-5070 13000.88,-4938.62 13000.88,-4938.62"/>
<polygon fill="black" stroke="black" points="13004.38,-4938.62 13000.88,-4928.62 12997.38,-4938.62 13004.38,-4938.62"/>
</g>
<!-- tp_layer2_v_proj_gpu7 -->
<g id="node344" class="node">
<title>tp_layer2_v_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="14046.76,-4928.33 13545.76,-4928.33 13545.76,-4860.33 14046.76,-4860.33 14046.76,-4928.33"/>
<text text-anchor="middle" x="13796.26" y="-4913.13" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="13796.26" y="-4898.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="13796.26" y="-4883.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13796.26" y="-4868.13" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu7 -->
<g id="edge437" class="edge">
<title>tp_layer2_norm&#45;&gt;tp_layer2_v_proj_gpu7</title>
<path fill="none" stroke="black" d="M7895.96,-5076C9027.5,-5076 13634.64,-5076 13634.64,-5076 13634.64,-5076 13634.64,-4938.5 13634.64,-4938.5"/>
<polygon fill="black" stroke="black" points="13638.14,-4938.5 13634.64,-4928.5 13631.14,-4938.5 13638.14,-4938.5"/>
</g>
<!-- tp_layer2_gather_q_gpu0 -->
<g id="node277" class="node">
<title>tp_layer2_gather_q_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="790.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="790.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="790.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="790.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="790.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_q_proj_gpu0&#45;&gt;tp_layer2_gather_q_gpu0 -->
<g id="edge354" class="edge">
<title>tp_layer2_q_proj_gpu0&#45;&gt;tp_layer2_gather_q_gpu0</title>
<path fill="none" stroke="black" d="M865.26,-4860.32C865.26,-4860.32 865.26,-4783.27 865.26,-4783.27"/>
<polygon fill="black" stroke="black" points="868.76,-4783.27 865.26,-4773.27 861.76,-4783.27 868.76,-4783.27"/>
</g>
<!-- tp_layer2_gather_k_gpu0 -->
<g id="node276" class="node">
<title>tp_layer2_gather_k_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="1557.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="1557.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="1557.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1557.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1557.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_k_proj_gpu0&#45;&gt;tp_layer2_gather_k_gpu0 -->
<g id="edge355" class="edge">
<title>tp_layer2_k_proj_gpu0&#45;&gt;tp_layer2_gather_k_gpu0</title>
<path fill="none" stroke="black" d="M1498.26,-4860.32C1498.26,-4860.32 1498.26,-4783.9 1498.26,-4783.9"/>
<polygon fill="black" stroke="black" points="1501.76,-4783.9 1498.26,-4773.9 1494.76,-4783.9 1501.76,-4783.9"/>
</g>
<!-- tp_layer2_gather_v_gpu0 -->
<g id="node280" class="node">
<title>tp_layer2_gather_v_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="2119.26" cy="-4361.92" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="2119.26" y="-4380.72" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="2119.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2119.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2119.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_v_proj_gpu0&#45;&gt;tp_layer2_gather_v_gpu0 -->
<g id="edge359" class="edge">
<title>tp_layer2_v_proj_gpu0&#45;&gt;tp_layer2_gather_v_gpu0</title>
<path fill="none" stroke="black" d="M2050.26,-4860.22C2050.26,-4860.22 2050.26,-4419.44 2050.26,-4419.44"/>
<polygon fill="black" stroke="black" points="2053.76,-4419.44 2050.26,-4409.44 2046.76,-4419.44 2053.76,-4419.44"/>
</g>
<!-- tp_layer2_attn_scores_gpu0 -->
<g id="node275" class="node">
<title>tp_layer2_attn_scores_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="1706.76,-4578.08 1167.76,-4578.08 1167.76,-4510.08 1706.76,-4510.08 1706.76,-4578.08"/>
<text text-anchor="middle" x="1437.26" y="-4562.88" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="1437.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1437.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1437.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_softmax_gpu0 -->
<g id="node278" class="node">
<title>tp_layer2_softmax_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="1706.76,-4395.92 1167.76,-4395.92 1167.76,-4327.92 1706.76,-4327.92 1706.76,-4395.92"/>
<text text-anchor="middle" x="1437.26" y="-4380.72" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="1437.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1437.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1437.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_attn_scores_gpu0&#45;&gt;tp_layer2_softmax_gpu0 -->
<g id="edge358" class="edge">
<title>tp_layer2_attn_scores_gpu0&#45;&gt;tp_layer2_softmax_gpu0</title>
<path fill="none" stroke="black" d="M1437.26,-4509.82C1437.26,-4509.82 1437.26,-4406.03 1437.26,-4406.03"/>
<polygon fill="black" stroke="black" points="1440.76,-4406.03 1437.26,-4396.03 1433.76,-4406.03 1440.76,-4406.03"/>
</g>
<!-- tp_layer2_gather_k_gpu0&#45;&gt;tp_layer2_attn_scores_gpu0 -->
<g id="edge357" class="edge">
<title>tp_layer2_gather_k_gpu0&#45;&gt;tp_layer2_attn_scores_gpu0</title>
<path fill="none" stroke="black" d="M1454.88,-4679.81C1454.88,-4679.81 1454.88,-4588.36 1454.88,-4588.36"/>
<polygon fill="black" stroke="black" points="1458.38,-4588.36 1454.88,-4578.36 1451.38,-4588.36 1458.38,-4588.36"/>
</g>
<!-- tp_layer2_gather_q_gpu0&#45;&gt;tp_layer2_attn_scores_gpu0 -->
<g id="edge356" class="edge">
<title>tp_layer2_gather_q_gpu0&#45;&gt;tp_layer2_attn_scores_gpu0</title>
<path fill="none" stroke="black" d="M1144.58,-4726C1169.7,-4726 1185.38,-4726 1185.38,-4726 1185.38,-4726 1185.38,-4588.3 1185.38,-4588.3"/>
<polygon fill="black" stroke="black" points="1188.88,-4588.3 1185.38,-4578.3 1181.88,-4588.3 1188.88,-4588.3"/>
</g>
<!-- tp_layer2_attn_out_gpu0 -->
<g id="node279" class="node">
<title>tp_layer2_attn_out_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="2382.76,-4227.83 1855.76,-4227.83 1855.76,-4159.83 2382.76,-4159.83 2382.76,-4227.83"/>
<text text-anchor="middle" x="2119.26" y="-4212.63" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="2119.26" y="-4197.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="2119.26" y="-4182.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2119.26" y="-4167.63" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_softmax_gpu0&#45;&gt;tp_layer2_attn_out_gpu0 -->
<g id="edge360" class="edge">
<title>tp_layer2_softmax_gpu0&#45;&gt;tp_layer2_attn_out_gpu0</title>
<path fill="none" stroke="black" d="M1586.26,-4327.73C1586.26,-4278.38 1586.26,-4193 1586.26,-4193 1586.26,-4193 1845.49,-4193 1845.49,-4193"/>
<polygon fill="black" stroke="black" points="1845.49,-4196.5 1855.49,-4193 1845.49,-4189.5 1845.49,-4196.5"/>
</g>
<!-- tp_layer2_out_proj_gpu0 -->
<g id="node281" class="node">
<title>tp_layer2_out_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="3413.76,-4073.83 2924.76,-4073.83 2924.76,-4005.83 3413.76,-4005.83 3413.76,-4073.83"/>
<text text-anchor="middle" x="3169.26" y="-4058.63" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="3169.26" y="-4043.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3169.26" y="-4028.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3169.26" y="-4013.63" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_attn_out_gpu0&#45;&gt;tp_layer2_out_proj_gpu0 -->
<g id="edge362" class="edge">
<title>tp_layer2_attn_out_gpu0&#45;&gt;tp_layer2_out_proj_gpu0</title>
<path fill="none" stroke="black" d="M2382.98,-4193C2620.73,-4193 2933.26,-4193 2933.26,-4193 2933.26,-4193 2933.26,-4084.21 2933.26,-4084.21"/>
<polygon fill="black" stroke="black" points="2936.76,-4084.21 2933.26,-4074.21 2929.76,-4084.21 2936.76,-4084.21"/>
</g>
<!-- tp_layer2_gather_v_gpu0&#45;&gt;tp_layer2_attn_out_gpu0 -->
<g id="edge361" class="edge">
<title>tp_layer2_gather_v_gpu0&#45;&gt;tp_layer2_attn_out_gpu0</title>
<path fill="none" stroke="black" d="M2119.26,-4313.75C2119.26,-4313.75 2119.26,-4237.86 2119.26,-4237.86"/>
<polygon fill="black" stroke="black" points="2122.76,-4237.86 2119.26,-4227.86 2115.76,-4237.86 2122.76,-4237.86"/>
</g>
<!-- tp_layer2_attn_all_reduce -->
<g id="node352" class="node">
<title>tp_layer2_attn_all_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="8424.26" cy="-3871.75" rx="351.36" ry="48.17"/>
<text text-anchor="middle" x="8424.26" y="-3890.55" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention</text>
<text text-anchor="middle" x="8424.26" y="-3875.55" font-family="Times,serif" font-size="14.00">Input: 8×[512]</text>
<text text-anchor="middle" x="8424.26" y="-3860.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8424.26" y="-3845.55" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer2_out_proj_gpu0&#45;&gt;tp_layer2_attn_all_reduce -->
<g id="edge447" class="edge">
<title>tp_layer2_out_proj_gpu0&#45;&gt;tp_layer2_attn_all_reduce</title>
<path fill="none" stroke="black" d="M3278.26,-4005.8C3278.26,-3950.44 3278.26,-3847 3278.26,-3847 3278.26,-3847 8112.51,-3847 8112.51,-3847"/>
<polygon fill="black" stroke="black" points="8112.51,-3850.5 8122.51,-3847 8112.51,-3843.5 8112.51,-3850.5"/>
</g>
<!-- tp_layer2_gather_q_gpu1 -->
<g id="node287" class="node">
<title>tp_layer2_gather_q_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="2543.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="2543.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="2543.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2543.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2543.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_q_proj_gpu1&#45;&gt;tp_layer2_gather_q_gpu1 -->
<g id="edge366" class="edge">
<title>tp_layer2_q_proj_gpu1&#45;&gt;tp_layer2_gather_q_gpu1</title>
<path fill="none" stroke="black" d="M2616.26,-4860.32C2616.26,-4860.32 2616.26,-4783.59 2616.26,-4783.59"/>
<polygon fill="black" stroke="black" points="2619.76,-4783.59 2616.26,-4773.59 2612.76,-4783.59 2619.76,-4783.59"/>
</g>
<!-- tp_layer2_gather_k_gpu1 -->
<g id="node286" class="node">
<title>tp_layer2_gather_k_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="3310.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="3310.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="3310.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3310.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3310.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_k_proj_gpu1&#45;&gt;tp_layer2_gather_k_gpu1 -->
<g id="edge367" class="edge">
<title>tp_layer2_k_proj_gpu1&#45;&gt;tp_layer2_gather_k_gpu1</title>
<path fill="none" stroke="black" d="M3190.88,-4860.32C3190.88,-4860.32 3190.88,-4781.69 3190.88,-4781.69"/>
<polygon fill="black" stroke="black" points="3194.38,-4781.69 3190.88,-4771.69 3187.38,-4781.69 3194.38,-4781.69"/>
</g>
<!-- tp_layer2_gather_v_gpu1 -->
<g id="node290" class="node">
<title>tp_layer2_gather_v_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="3893.26" cy="-4544.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="3893.26" y="-4562.88" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="3893.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3893.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3893.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_v_proj_gpu1&#45;&gt;tp_layer2_gather_v_gpu1 -->
<g id="edge371" class="edge">
<title>tp_layer2_v_proj_gpu1&#45;&gt;tp_layer2_gather_v_gpu1</title>
<path fill="none" stroke="black" d="M3765.26,-4860.11C3765.26,-4860.11 3765.26,-4599.12 3765.26,-4599.12"/>
<polygon fill="black" stroke="black" points="3768.76,-4599.12 3765.26,-4589.12 3761.76,-4599.12 3768.76,-4599.12"/>
</g>
<!-- tp_layer2_attn_scores_gpu1 -->
<g id="node285" class="node">
<title>tp_layer2_attn_scores_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="3480.76,-4578.08 2941.76,-4578.08 2941.76,-4510.08 3480.76,-4510.08 3480.76,-4578.08"/>
<text text-anchor="middle" x="3211.26" y="-4562.88" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="3211.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3211.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3211.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_softmax_gpu1 -->
<g id="node288" class="node">
<title>tp_layer2_softmax_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="3642.76,-4395.92 3103.76,-4395.92 3103.76,-4327.92 3642.76,-4327.92 3642.76,-4395.92"/>
<text text-anchor="middle" x="3373.26" y="-4380.72" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="3373.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3373.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3373.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_attn_scores_gpu1&#45;&gt;tp_layer2_softmax_gpu1 -->
<g id="edge370" class="edge">
<title>tp_layer2_attn_scores_gpu1&#45;&gt;tp_layer2_softmax_gpu1</title>
<path fill="none" stroke="black" d="M3292.26,-4509.82C3292.26,-4509.82 3292.26,-4406.03 3292.26,-4406.03"/>
<polygon fill="black" stroke="black" points="3295.76,-4406.03 3292.26,-4396.03 3288.76,-4406.03 3295.76,-4406.03"/>
</g>
<!-- tp_layer2_gather_k_gpu1&#45;&gt;tp_layer2_attn_scores_gpu1 -->
<g id="edge369" class="edge">
<title>tp_layer2_gather_k_gpu1&#45;&gt;tp_layer2_attn_scores_gpu1</title>
<path fill="none" stroke="black" d="M3218.38,-4679.81C3218.38,-4679.81 3218.38,-4588.36 3218.38,-4588.36"/>
<polygon fill="black" stroke="black" points="3221.88,-4588.36 3218.38,-4578.36 3214.88,-4588.36 3221.88,-4588.36"/>
</g>
<!-- tp_layer2_gather_q_gpu1&#45;&gt;tp_layer2_attn_scores_gpu1 -->
<g id="edge368" class="edge">
<title>tp_layer2_gather_q_gpu1&#45;&gt;tp_layer2_attn_scores_gpu1</title>
<path fill="none" stroke="black" d="M2897.92,-4726C2928.95,-4726 2948.88,-4726 2948.88,-4726 2948.88,-4726 2948.88,-4588.3 2948.88,-4588.3"/>
<polygon fill="black" stroke="black" points="2952.38,-4588.3 2948.88,-4578.3 2945.38,-4588.3 2952.38,-4588.3"/>
</g>
<!-- tp_layer2_attn_out_gpu1 -->
<g id="node289" class="node">
<title>tp_layer2_attn_out_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="4156.76,-4227.83 3629.76,-4227.83 3629.76,-4159.83 4156.76,-4159.83 4156.76,-4227.83"/>
<text text-anchor="middle" x="3893.26" y="-4212.63" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="3893.26" y="-4197.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3893.26" y="-4182.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3893.26" y="-4167.63" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_softmax_gpu1&#45;&gt;tp_layer2_attn_out_gpu1 -->
<g id="edge372" class="edge">
<title>tp_layer2_softmax_gpu1&#45;&gt;tp_layer2_attn_out_gpu1</title>
<path fill="none" stroke="black" d="M3636.26,-4327.9C3636.26,-4327.9 3636.26,-4238.08 3636.26,-4238.08"/>
<polygon fill="black" stroke="black" points="3639.76,-4238.08 3636.26,-4228.08 3632.76,-4238.08 3639.76,-4238.08"/>
</g>
<!-- tp_layer2_out_proj_gpu1 -->
<g id="node291" class="node">
<title>tp_layer2_out_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="5556.76,-4073.83 5067.76,-4073.83 5067.76,-4005.83 5556.76,-4005.83 5556.76,-4073.83"/>
<text text-anchor="middle" x="5312.26" y="-4058.63" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5312.26" y="-4043.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5312.26" y="-4028.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5312.26" y="-4013.63" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_attn_out_gpu1&#45;&gt;tp_layer2_out_proj_gpu1 -->
<g id="edge374" class="edge">
<title>tp_layer2_attn_out_gpu1&#45;&gt;tp_layer2_out_proj_gpu1</title>
<path fill="none" stroke="black" d="M4156.79,-4182C4510.27,-4182 5094.09,-4182 5094.09,-4182 5094.09,-4182 5094.09,-4083.88 5094.09,-4083.88"/>
<polygon fill="black" stroke="black" points="5097.59,-4083.88 5094.09,-4073.88 5090.59,-4083.88 5097.59,-4083.88"/>
</g>
<!-- tp_layer2_gather_v_gpu1&#45;&gt;tp_layer2_attn_out_gpu1 -->
<g id="edge373" class="edge">
<title>tp_layer2_gather_v_gpu1&#45;&gt;tp_layer2_attn_out_gpu1</title>
<path fill="none" stroke="black" d="M3899.76,-4495.75C3899.76,-4495.75 3899.76,-4237.98 3899.76,-4237.98"/>
<polygon fill="black" stroke="black" points="3903.26,-4237.98 3899.76,-4227.98 3896.26,-4237.98 3903.26,-4237.98"/>
</g>
<!-- tp_layer2_out_proj_gpu1&#45;&gt;tp_layer2_attn_all_reduce -->
<g id="edge448" class="edge">
<title>tp_layer2_out_proj_gpu1&#45;&gt;tp_layer2_attn_all_reduce</title>
<path fill="none" stroke="black" d="M5442.51,-4005.67C5442.51,-3956.33 5442.51,-3871 5442.51,-3871 5442.51,-3871 8062.71,-3871 8062.71,-3871"/>
<polygon fill="black" stroke="black" points="8062.71,-3874.5 8072.71,-3871 8062.71,-3867.5 8062.71,-3874.5"/>
</g>
<!-- tp_layer2_gather_q_gpu2 -->
<g id="node297" class="node">
<title>tp_layer2_gather_q_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="4220.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="4220.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="4220.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4220.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4220.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_q_proj_gpu2&#45;&gt;tp_layer2_gather_q_gpu2 -->
<g id="edge378" class="edge">
<title>tp_layer2_q_proj_gpu2&#45;&gt;tp_layer2_gather_q_gpu2</title>
<path fill="none" stroke="black" d="M4293.26,-4860.32C4293.26,-4860.32 4293.26,-4783.59 4293.26,-4783.59"/>
<polygon fill="black" stroke="black" points="4296.76,-4783.59 4293.26,-4773.59 4289.76,-4783.59 4296.76,-4783.59"/>
</g>
<!-- tp_layer2_gather_k_gpu2 -->
<g id="node296" class="node">
<title>tp_layer2_gather_k_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="4987.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="4987.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="4987.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4987.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4987.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_k_proj_gpu2&#45;&gt;tp_layer2_gather_k_gpu2 -->
<g id="edge379" class="edge">
<title>tp_layer2_k_proj_gpu2&#45;&gt;tp_layer2_gather_k_gpu2</title>
<path fill="none" stroke="black" d="M4867.88,-4860.32C4867.88,-4860.32 4867.88,-4781.69 4867.88,-4781.69"/>
<polygon fill="black" stroke="black" points="4871.38,-4781.69 4867.88,-4771.69 4864.38,-4781.69 4871.38,-4781.69"/>
</g>
<!-- tp_layer2_gather_v_gpu2 -->
<g id="node300" class="node">
<title>tp_layer2_gather_v_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="5559.26" cy="-4361.92" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="5559.26" y="-4380.72" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="5559.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5559.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5559.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_v_proj_gpu2&#45;&gt;tp_layer2_gather_v_gpu2 -->
<g id="edge383" class="edge">
<title>tp_layer2_v_proj_gpu2&#45;&gt;tp_layer2_gather_v_gpu2</title>
<path fill="none" stroke="black" d="M5434.76,-4860.22C5434.76,-4860.22 5434.76,-4417.09 5434.76,-4417.09"/>
<polygon fill="black" stroke="black" points="5438.26,-4417.09 5434.76,-4407.09 5431.26,-4417.09 5438.26,-4417.09"/>
</g>
<!-- tp_layer2_attn_scores_gpu2 -->
<g id="node295" class="node">
<title>tp_layer2_attn_scores_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="5146.76,-4578.08 4607.76,-4578.08 4607.76,-4510.08 5146.76,-4510.08 5146.76,-4578.08"/>
<text text-anchor="middle" x="4877.26" y="-4562.88" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="4877.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4877.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="4877.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_softmax_gpu2 -->
<g id="node298" class="node">
<title>tp_layer2_softmax_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="5146.76,-4395.92 4607.76,-4395.92 4607.76,-4327.92 5146.76,-4327.92 5146.76,-4395.92"/>
<text text-anchor="middle" x="4877.26" y="-4380.72" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="4877.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="4877.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="4877.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_attn_scores_gpu2&#45;&gt;tp_layer2_softmax_gpu2 -->
<g id="edge382" class="edge">
<title>tp_layer2_attn_scores_gpu2&#45;&gt;tp_layer2_softmax_gpu2</title>
<path fill="none" stroke="black" d="M4877.26,-4509.82C4877.26,-4509.82 4877.26,-4406.03 4877.26,-4406.03"/>
<polygon fill="black" stroke="black" points="4880.76,-4406.03 4877.26,-4396.03 4873.76,-4406.03 4880.76,-4406.03"/>
</g>
<!-- tp_layer2_gather_k_gpu2&#45;&gt;tp_layer2_attn_scores_gpu2 -->
<g id="edge381" class="edge">
<title>tp_layer2_gather_k_gpu2&#45;&gt;tp_layer2_attn_scores_gpu2</title>
<path fill="none" stroke="black" d="M4889.88,-4679.81C4889.88,-4679.81 4889.88,-4588.36 4889.88,-4588.36"/>
<polygon fill="black" stroke="black" points="4893.38,-4588.36 4889.88,-4578.36 4886.38,-4588.36 4893.38,-4588.36"/>
</g>
<!-- tp_layer2_gather_q_gpu2&#45;&gt;tp_layer2_attn_scores_gpu2 -->
<g id="edge380" class="edge">
<title>tp_layer2_gather_q_gpu2&#45;&gt;tp_layer2_attn_scores_gpu2</title>
<path fill="none" stroke="black" d="M4574.87,-4726C4602.74,-4726 4620.38,-4726 4620.38,-4726 4620.38,-4726 4620.38,-4588.3 4620.38,-4588.3"/>
<polygon fill="black" stroke="black" points="4623.88,-4588.3 4620.38,-4578.3 4616.88,-4588.3 4623.88,-4588.3"/>
</g>
<!-- tp_layer2_attn_out_gpu2 -->
<g id="node299" class="node">
<title>tp_layer2_attn_out_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="5822.76,-4227.83 5295.76,-4227.83 5295.76,-4159.83 5822.76,-4159.83 5822.76,-4227.83"/>
<text text-anchor="middle" x="5559.26" y="-4212.63" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="5559.26" y="-4197.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="5559.26" y="-4182.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5559.26" y="-4167.63" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_softmax_gpu2&#45;&gt;tp_layer2_attn_out_gpu2 -->
<g id="edge384" class="edge">
<title>tp_layer2_softmax_gpu2&#45;&gt;tp_layer2_attn_out_gpu2</title>
<path fill="none" stroke="black" d="M5120.43,-4327.87C5120.43,-4281.72 5120.43,-4205 5120.43,-4205 5120.43,-4205 5285.76,-4205 5285.76,-4205"/>
<polygon fill="black" stroke="black" points="5285.76,-4208.5 5295.76,-4205 5285.76,-4201.5 5285.76,-4208.5"/>
</g>
<!-- tp_layer2_out_proj_gpu2 -->
<g id="node301" class="node">
<title>tp_layer2_out_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="6901.76,-4073.83 6412.76,-4073.83 6412.76,-4005.83 6901.76,-4005.83 6901.76,-4073.83"/>
<text text-anchor="middle" x="6657.26" y="-4058.63" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="6657.26" y="-4043.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6657.26" y="-4028.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6657.26" y="-4013.63" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_attn_out_gpu2&#45;&gt;tp_layer2_out_proj_gpu2 -->
<g id="edge386" class="edge">
<title>tp_layer2_attn_out_gpu2&#45;&gt;tp_layer2_out_proj_gpu2</title>
<path fill="none" stroke="black" d="M5822.97,-4193C6075.3,-4193 6417.76,-4193 6417.76,-4193 6417.76,-4193 6417.76,-4084.21 6417.76,-4084.21"/>
<polygon fill="black" stroke="black" points="6421.26,-4084.21 6417.76,-4074.21 6414.26,-4084.21 6421.26,-4084.21"/>
</g>
<!-- tp_layer2_gather_v_gpu2&#45;&gt;tp_layer2_attn_out_gpu2 -->
<g id="edge385" class="edge">
<title>tp_layer2_gather_v_gpu2&#45;&gt;tp_layer2_attn_out_gpu2</title>
<path fill="none" stroke="black" d="M5559.26,-4313.75C5559.26,-4313.75 5559.26,-4237.86 5559.26,-4237.86"/>
<polygon fill="black" stroke="black" points="5562.76,-4237.86 5559.26,-4227.86 5555.76,-4237.86 5562.76,-4237.86"/>
</g>
<!-- tp_layer2_out_proj_gpu2&#45;&gt;tp_layer2_attn_all_reduce -->
<g id="edge449" class="edge">
<title>tp_layer2_out_proj_gpu2&#45;&gt;tp_layer2_attn_all_reduce</title>
<path fill="none" stroke="black" d="M6679.01,-4005.51C6679.01,-3962.68 6679.01,-3895 6679.01,-3895 6679.01,-3895 8106.51,-3895 8106.51,-3895"/>
<polygon fill="black" stroke="black" points="8106.51,-3898.5 8116.51,-3895 8106.51,-3891.5 8106.51,-3898.5"/>
</g>
<!-- tp_layer2_gather_q_gpu3 -->
<g id="node307" class="node">
<title>tp_layer2_gather_q_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="5882.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="5882.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="5882.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5882.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5882.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_q_proj_gpu3&#45;&gt;tp_layer2_gather_q_gpu3 -->
<g id="edge390" class="edge">
<title>tp_layer2_q_proj_gpu3&#45;&gt;tp_layer2_gather_q_gpu3</title>
<path fill="none" stroke="black" d="M5970.26,-4860.32C5970.26,-4860.32 5970.26,-4782.95 5970.26,-4782.95"/>
<polygon fill="black" stroke="black" points="5973.76,-4782.95 5970.26,-4772.95 5966.76,-4782.95 5973.76,-4782.95"/>
</g>
<!-- tp_layer2_gather_k_gpu3 -->
<g id="node306" class="node">
<title>tp_layer2_gather_k_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="6649.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="6649.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="6649.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6649.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6649.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_k_proj_gpu3&#45;&gt;tp_layer2_gather_k_gpu3 -->
<g id="edge391" class="edge">
<title>tp_layer2_k_proj_gpu3&#45;&gt;tp_layer2_gather_k_gpu3</title>
<path fill="none" stroke="black" d="M6537.38,-4860.32C6537.38,-4860.32 6537.38,-4782 6537.38,-4782"/>
<polygon fill="black" stroke="black" points="6540.88,-4782 6537.38,-4772 6533.88,-4782 6540.88,-4782"/>
</g>
<!-- tp_layer2_gather_v_gpu3 -->
<g id="node310" class="node">
<title>tp_layer2_gather_v_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="7212.26" cy="-4544.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="7212.26" y="-4562.88" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="7212.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7212.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7212.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_v_proj_gpu3&#45;&gt;tp_layer2_gather_v_gpu3 -->
<g id="edge395" class="edge">
<title>tp_layer2_v_proj_gpu3&#45;&gt;tp_layer2_gather_v_gpu3</title>
<path fill="none" stroke="black" d="M7097.76,-4860.11C7097.76,-4860.11 7097.76,-4599.69 7097.76,-4599.69"/>
<polygon fill="black" stroke="black" points="7101.26,-4599.69 7097.76,-4589.69 7094.26,-4599.69 7101.26,-4599.69"/>
</g>
<!-- tp_layer2_attn_scores_gpu3 -->
<g id="node305" class="node">
<title>tp_layer2_attn_scores_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="6799.76,-4578.08 6260.76,-4578.08 6260.76,-4510.08 6799.76,-4510.08 6799.76,-4578.08"/>
<text text-anchor="middle" x="6530.26" y="-4562.88" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="6530.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6530.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6530.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_softmax_gpu3 -->
<g id="node308" class="node">
<title>tp_layer2_softmax_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="6961.76,-4395.92 6422.76,-4395.92 6422.76,-4327.92 6961.76,-4327.92 6961.76,-4395.92"/>
<text text-anchor="middle" x="6692.26" y="-4380.72" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="6692.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6692.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6692.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_attn_scores_gpu3&#45;&gt;tp_layer2_softmax_gpu3 -->
<g id="edge394" class="edge">
<title>tp_layer2_attn_scores_gpu3&#45;&gt;tp_layer2_softmax_gpu3</title>
<path fill="none" stroke="black" d="M6611.26,-4509.82C6611.26,-4509.82 6611.26,-4406.03 6611.26,-4406.03"/>
<polygon fill="black" stroke="black" points="6614.76,-4406.03 6611.26,-4396.03 6607.76,-4406.03 6614.76,-4406.03"/>
</g>
<!-- tp_layer2_gather_k_gpu3&#45;&gt;tp_layer2_attn_scores_gpu3 -->
<g id="edge393" class="edge">
<title>tp_layer2_gather_k_gpu3&#45;&gt;tp_layer2_attn_scores_gpu3</title>
<path fill="none" stroke="black" d="M6547.38,-4679.81C6547.38,-4679.81 6547.38,-4588.36 6547.38,-4588.36"/>
<polygon fill="black" stroke="black" points="6550.88,-4588.36 6547.38,-4578.36 6543.88,-4588.36 6550.88,-4588.36"/>
</g>
<!-- tp_layer2_gather_q_gpu3&#45;&gt;tp_layer2_attn_scores_gpu3 -->
<g id="edge392" class="edge">
<title>tp_layer2_gather_q_gpu3&#45;&gt;tp_layer2_attn_scores_gpu3</title>
<path fill="none" stroke="black" d="M6236.72,-4726C6257.25,-4726 6269.76,-4726 6269.76,-4726 6269.76,-4726 6269.76,-4588.3 6269.76,-4588.3"/>
<polygon fill="black" stroke="black" points="6273.26,-4588.3 6269.76,-4578.3 6266.26,-4588.3 6273.26,-4588.3"/>
</g>
<!-- tp_layer2_attn_out_gpu3 -->
<g id="node309" class="node">
<title>tp_layer2_attn_out_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="7475.76,-4227.83 6948.76,-4227.83 6948.76,-4159.83 7475.76,-4159.83 7475.76,-4227.83"/>
<text text-anchor="middle" x="7212.26" y="-4212.63" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="7212.26" y="-4197.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="7212.26" y="-4182.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7212.26" y="-4167.63" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_softmax_gpu3&#45;&gt;tp_layer2_attn_out_gpu3 -->
<g id="edge396" class="edge">
<title>tp_layer2_softmax_gpu3&#45;&gt;tp_layer2_attn_out_gpu3</title>
<path fill="none" stroke="black" d="M6955.26,-4327.9C6955.26,-4327.9 6955.26,-4238.08 6955.26,-4238.08"/>
<polygon fill="black" stroke="black" points="6958.76,-4238.08 6955.26,-4228.08 6951.76,-4238.08 6958.76,-4238.08"/>
</g>
<!-- tp_layer2_out_proj_gpu3 -->
<g id="node311" class="node">
<title>tp_layer2_out_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="7847.76,-4073.83 7358.76,-4073.83 7358.76,-4005.83 7847.76,-4005.83 7847.76,-4073.83"/>
<text text-anchor="middle" x="7603.26" y="-4058.63" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="7603.26" y="-4043.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7603.26" y="-4028.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7603.26" y="-4013.63" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_attn_out_gpu3&#45;&gt;tp_layer2_out_proj_gpu3 -->
<g id="edge398" class="edge">
<title>tp_layer2_attn_out_gpu3&#45;&gt;tp_layer2_out_proj_gpu3</title>
<path fill="none" stroke="black" d="M7417.26,-4159.65C7417.26,-4159.65 7417.26,-4083.91 7417.26,-4083.91"/>
<polygon fill="black" stroke="black" points="7420.76,-4083.91 7417.26,-4073.91 7413.76,-4083.91 7420.76,-4083.91"/>
</g>
<!-- tp_layer2_gather_v_gpu3&#45;&gt;tp_layer2_attn_out_gpu3 -->
<g id="edge397" class="edge">
<title>tp_layer2_gather_v_gpu3&#45;&gt;tp_layer2_attn_out_gpu3</title>
<path fill="none" stroke="black" d="M7218.76,-4495.75C7218.76,-4495.75 7218.76,-4237.98 7218.76,-4237.98"/>
<polygon fill="black" stroke="black" points="7222.26,-4237.98 7218.76,-4227.98 7215.26,-4237.98 7222.26,-4237.98"/>
</g>
<!-- tp_layer2_out_proj_gpu3&#45;&gt;tp_layer2_attn_all_reduce -->
<g id="edge450" class="edge">
<title>tp_layer2_out_proj_gpu3&#45;&gt;tp_layer2_attn_all_reduce</title>
<path fill="none" stroke="black" d="M7848,-4039C7980.26,-4039 8116.79,-4039 8116.79,-4039 8116.79,-4039 8116.79,-3905.36 8116.79,-3905.36"/>
<polygon fill="black" stroke="black" points="8120.29,-3905.36 8116.79,-3895.36 8113.29,-3905.36 8120.29,-3905.36"/>
</g>
<!-- tp_layer2_gather_q_gpu4 -->
<g id="node317" class="node">
<title>tp_layer2_gather_q_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="7546.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="7546.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="7546.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7546.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7546.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_q_proj_gpu4&#45;&gt;tp_layer2_gather_q_gpu4 -->
<g id="edge402" class="edge">
<title>tp_layer2_q_proj_gpu4&#45;&gt;tp_layer2_gather_q_gpu4</title>
<path fill="none" stroke="black" d="M7647.26,-4860.32C7647.26,-4860.32 7647.26,-4782.63 7647.26,-4782.63"/>
<polygon fill="black" stroke="black" points="7650.76,-4782.63 7647.26,-4772.63 7643.76,-4782.63 7650.76,-4782.63"/>
</g>
<!-- tp_layer2_gather_k_gpu4 -->
<g id="node316" class="node">
<title>tp_layer2_gather_k_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="8313.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="8313.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="8313.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8313.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8313.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_k_proj_gpu4&#45;&gt;tp_layer2_gather_k_gpu4 -->
<g id="edge403" class="edge">
<title>tp_layer2_k_proj_gpu4&#45;&gt;tp_layer2_gather_k_gpu4</title>
<path fill="none" stroke="black" d="M8207.88,-4860.32C8207.88,-4860.32 8207.88,-4782.32 8207.88,-4782.32"/>
<polygon fill="black" stroke="black" points="8211.38,-4782.32 8207.88,-4772.32 8204.38,-4782.32 8211.38,-4782.32"/>
</g>
<!-- tp_layer2_gather_v_gpu4 -->
<g id="node320" class="node">
<title>tp_layer2_gather_v_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="8765.26" cy="-4361.92" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="8765.26" y="-4380.72" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="8765.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8765.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8765.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_v_proj_gpu4&#45;&gt;tp_layer2_gather_v_gpu4 -->
<g id="edge407" class="edge">
<title>tp_layer2_v_proj_gpu4&#45;&gt;tp_layer2_gather_v_gpu4</title>
<path fill="none" stroke="black" d="M8766.76,-4860.22C8766.76,-4860.22 8766.76,-4420.24 8766.76,-4420.24"/>
<polygon fill="black" stroke="black" points="8770.26,-4420.24 8766.76,-4410.24 8763.26,-4420.24 8770.26,-4420.24"/>
</g>
<!-- tp_layer2_attn_scores_gpu4 -->
<g id="node315" class="node">
<title>tp_layer2_attn_scores_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="8352.76,-4578.08 7813.76,-4578.08 7813.76,-4510.08 8352.76,-4510.08 8352.76,-4578.08"/>
<text text-anchor="middle" x="8083.26" y="-4562.88" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="8083.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8083.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="8083.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_softmax_gpu4 -->
<g id="node318" class="node">
<title>tp_layer2_softmax_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="8352.76,-4395.92 7813.76,-4395.92 7813.76,-4327.92 8352.76,-4327.92 8352.76,-4395.92"/>
<text text-anchor="middle" x="8083.26" y="-4380.72" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="8083.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="8083.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="8083.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_attn_scores_gpu4&#45;&gt;tp_layer2_softmax_gpu4 -->
<g id="edge406" class="edge">
<title>tp_layer2_attn_scores_gpu4&#45;&gt;tp_layer2_softmax_gpu4</title>
<path fill="none" stroke="black" d="M8083.26,-4509.82C8083.26,-4509.82 8083.26,-4406.03 8083.26,-4406.03"/>
<polygon fill="black" stroke="black" points="8086.76,-4406.03 8083.26,-4396.03 8079.76,-4406.03 8086.76,-4406.03"/>
</g>
<!-- tp_layer2_gather_k_gpu4&#45;&gt;tp_layer2_attn_scores_gpu4 -->
<g id="edge405" class="edge">
<title>tp_layer2_gather_k_gpu4&#45;&gt;tp_layer2_attn_scores_gpu4</title>
<path fill="none" stroke="black" d="M8155.88,-4683.08C8155.88,-4683.08 8155.88,-4588.13 8155.88,-4588.13"/>
<polygon fill="black" stroke="black" points="8159.38,-4588.13 8155.88,-4578.13 8152.38,-4588.13 8159.38,-4588.13"/>
</g>
<!-- tp_layer2_gather_q_gpu4&#45;&gt;tp_layer2_attn_scores_gpu4 -->
<g id="edge404" class="edge">
<title>tp_layer2_gather_q_gpu4&#45;&gt;tp_layer2_attn_scores_gpu4</title>
<path fill="none" stroke="black" d="M7857.14,-4703.18C7857.14,-4703.18 7857.14,-4588.12 7857.14,-4588.12"/>
<polygon fill="black" stroke="black" points="7860.64,-4588.12 7857.14,-4578.12 7853.64,-4588.12 7860.64,-4588.12"/>
</g>
<!-- tp_layer2_attn_out_gpu4 -->
<g id="node319" class="node">
<title>tp_layer2_attn_out_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="8687.76,-4227.83 8160.76,-4227.83 8160.76,-4159.83 8687.76,-4159.83 8687.76,-4227.83"/>
<text text-anchor="middle" x="8424.26" y="-4212.63" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="8424.26" y="-4197.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="8424.26" y="-4182.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8424.26" y="-4167.63" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_softmax_gpu4&#45;&gt;tp_layer2_attn_out_gpu4 -->
<g id="edge408" class="edge">
<title>tp_layer2_softmax_gpu4&#45;&gt;tp_layer2_attn_out_gpu4</title>
<path fill="none" stroke="black" d="M8256.76,-4327.9C8256.76,-4327.9 8256.76,-4238.08 8256.76,-4238.08"/>
<polygon fill="black" stroke="black" points="8260.26,-4238.08 8256.76,-4228.08 8253.26,-4238.08 8260.26,-4238.08"/>
</g>
<!-- tp_layer2_out_proj_gpu4 -->
<g id="node321" class="node">
<title>tp_layer2_out_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="8668.76,-4073.83 8179.76,-4073.83 8179.76,-4005.83 8668.76,-4005.83 8668.76,-4073.83"/>
<text text-anchor="middle" x="8424.26" y="-4058.63" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="8424.26" y="-4043.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8424.26" y="-4028.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8424.26" y="-4013.63" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_attn_out_gpu4&#45;&gt;tp_layer2_out_proj_gpu4 -->
<g id="edge410" class="edge">
<title>tp_layer2_attn_out_gpu4&#45;&gt;tp_layer2_out_proj_gpu4</title>
<path fill="none" stroke="black" d="M8424.26,-4159.65C8424.26,-4159.65 8424.26,-4083.91 8424.26,-4083.91"/>
<polygon fill="black" stroke="black" points="8427.76,-4083.91 8424.26,-4073.91 8420.76,-4083.91 8427.76,-4083.91"/>
</g>
<!-- tp_layer2_gather_v_gpu4&#45;&gt;tp_layer2_attn_out_gpu4 -->
<g id="edge409" class="edge">
<title>tp_layer2_gather_v_gpu4&#45;&gt;tp_layer2_attn_out_gpu4</title>
<path fill="none" stroke="black" d="M8549.38,-4323.77C8549.38,-4323.77 8549.38,-4238.11 8549.38,-4238.11"/>
<polygon fill="black" stroke="black" points="8552.88,-4238.11 8549.38,-4228.11 8545.88,-4238.11 8552.88,-4238.11"/>
</g>
<!-- tp_layer2_out_proj_gpu4&#45;&gt;tp_layer2_attn_all_reduce -->
<g id="edge451" class="edge">
<title>tp_layer2_out_proj_gpu4&#45;&gt;tp_layer2_attn_all_reduce</title>
<path fill="none" stroke="black" d="M8424.26,-4005.82C8424.26,-4005.82 8424.26,-3930.04 8424.26,-3930.04"/>
<polygon fill="black" stroke="black" points="8427.76,-3930.04 8424.26,-3920.04 8420.76,-3930.04 8427.76,-3930.04"/>
</g>
<!-- tp_layer2_gather_q_gpu5 -->
<g id="node327" class="node">
<title>tp_layer2_gather_q_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="9220.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="9220.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="9220.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9220.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9220.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_q_proj_gpu5&#45;&gt;tp_layer2_gather_q_gpu5 -->
<g id="edge414" class="edge">
<title>tp_layer2_q_proj_gpu5&#45;&gt;tp_layer2_gather_q_gpu5</title>
<path fill="none" stroke="black" d="M9324.14,-4860.32C9324.14,-4860.32 9324.14,-4782.32 9324.14,-4782.32"/>
<polygon fill="black" stroke="black" points="9327.64,-4782.32 9324.14,-4772.32 9320.64,-4782.32 9327.64,-4782.32"/>
</g>
<!-- tp_layer2_gather_k_gpu5 -->
<g id="node326" class="node">
<title>tp_layer2_gather_k_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="9987.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="9987.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="9987.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9987.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9987.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_k_proj_gpu5&#45;&gt;tp_layer2_gather_k_gpu5 -->
<g id="edge415" class="edge">
<title>tp_layer2_k_proj_gpu5&#45;&gt;tp_layer2_gather_k_gpu5</title>
<path fill="none" stroke="black" d="M9883.38,-4860.32C9883.38,-4860.32 9883.38,-4782.32 9883.38,-4782.32"/>
<polygon fill="black" stroke="black" points="9886.88,-4782.32 9883.38,-4772.32 9879.88,-4782.32 9886.88,-4782.32"/>
</g>
<!-- tp_layer2_gather_v_gpu5 -->
<g id="node330" class="node">
<title>tp_layer2_gather_v_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="10363.26" cy="-4544.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="10363.26" y="-4562.88" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="10363.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10363.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10363.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_v_proj_gpu5&#45;&gt;tp_layer2_gather_v_gpu5 -->
<g id="edge419" class="edge">
<title>tp_layer2_v_proj_gpu5&#45;&gt;tp_layer2_gather_v_gpu5</title>
<path fill="none" stroke="black" d="M10439.26,-4860.11C10439.26,-4860.11 10439.26,-4601.15 10439.26,-4601.15"/>
<polygon fill="black" stroke="black" points="10442.76,-4601.15 10439.26,-4591.15 10435.76,-4601.15 10442.76,-4601.15"/>
</g>
<!-- tp_layer2_attn_scores_gpu5 -->
<g id="node325" class="node">
<title>tp_layer2_attn_scores_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="9872.76,-4578.08 9333.76,-4578.08 9333.76,-4510.08 9872.76,-4510.08 9872.76,-4578.08"/>
<text text-anchor="middle" x="9603.26" y="-4562.88" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="9603.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9603.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9603.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_softmax_gpu5 -->
<g id="node328" class="node">
<title>tp_layer2_softmax_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="9872.76,-4395.92 9333.76,-4395.92 9333.76,-4327.92 9872.76,-4327.92 9872.76,-4395.92"/>
<text text-anchor="middle" x="9603.26" y="-4380.72" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="9603.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9603.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9603.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_attn_scores_gpu5&#45;&gt;tp_layer2_softmax_gpu5 -->
<g id="edge418" class="edge">
<title>tp_layer2_attn_scores_gpu5&#45;&gt;tp_layer2_softmax_gpu5</title>
<path fill="none" stroke="black" d="M9603.26,-4509.82C9603.26,-4509.82 9603.26,-4406.03 9603.26,-4406.03"/>
<polygon fill="black" stroke="black" points="9606.76,-4406.03 9603.26,-4396.03 9599.76,-4406.03 9606.76,-4406.03"/>
</g>
<!-- tp_layer2_gather_k_gpu5&#45;&gt;tp_layer2_attn_scores_gpu5 -->
<g id="edge417" class="edge">
<title>tp_layer2_gather_k_gpu5&#45;&gt;tp_layer2_attn_scores_gpu5</title>
<path fill="none" stroke="black" d="M9752.88,-4689.82C9752.88,-4689.82 9752.88,-4588.29 9752.88,-4588.29"/>
<polygon fill="black" stroke="black" points="9756.38,-4588.29 9752.88,-4578.29 9749.38,-4588.29 9756.38,-4588.29"/>
</g>
<!-- tp_layer2_gather_q_gpu5&#45;&gt;tp_layer2_attn_scores_gpu5 -->
<g id="edge416" class="edge">
<title>tp_layer2_gather_q_gpu5&#45;&gt;tp_layer2_attn_scores_gpu5</title>
<path fill="none" stroke="black" d="M9454.14,-4689.82C9454.14,-4689.82 9454.14,-4588.29 9454.14,-4588.29"/>
<polygon fill="black" stroke="black" points="9457.64,-4588.29 9454.14,-4578.29 9450.64,-4588.29 9457.64,-4588.29"/>
</g>
<!-- tp_layer2_attn_out_gpu5 -->
<g id="node329" class="node">
<title>tp_layer2_attn_out_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="9866.76,-4227.83 9339.76,-4227.83 9339.76,-4159.83 9866.76,-4159.83 9866.76,-4227.83"/>
<text text-anchor="middle" x="9603.26" y="-4212.63" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="9603.26" y="-4197.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9603.26" y="-4182.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9603.26" y="-4167.63" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_softmax_gpu5&#45;&gt;tp_layer2_attn_out_gpu5 -->
<g id="edge420" class="edge">
<title>tp_layer2_softmax_gpu5&#45;&gt;tp_layer2_attn_out_gpu5</title>
<path fill="none" stroke="black" d="M9603.26,-4327.9C9603.26,-4327.9 9603.26,-4238.08 9603.26,-4238.08"/>
<polygon fill="black" stroke="black" points="9606.76,-4238.08 9603.26,-4228.08 9599.76,-4238.08 9606.76,-4238.08"/>
</g>
<!-- tp_layer2_out_proj_gpu5 -->
<g id="node331" class="node">
<title>tp_layer2_out_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="9282.76,-4073.83 8793.76,-4073.83 8793.76,-4005.83 9282.76,-4005.83 9282.76,-4073.83"/>
<text text-anchor="middle" x="9038.26" y="-4058.63" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="9038.26" y="-4043.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9038.26" y="-4028.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9038.26" y="-4013.63" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_attn_out_gpu5&#45;&gt;tp_layer2_out_proj_gpu5 -->
<g id="edge422" class="edge">
<title>tp_layer2_attn_out_gpu5&#45;&gt;tp_layer2_out_proj_gpu5</title>
<path fill="none" stroke="black" d="M9339.53,-4193C9263.73,-4193 9201.14,-4193 9201.14,-4193 9201.14,-4193 9201.14,-4084.21 9201.14,-4084.21"/>
<polygon fill="black" stroke="black" points="9204.64,-4084.21 9201.14,-4074.21 9197.64,-4084.21 9204.64,-4084.21"/>
</g>
<!-- tp_layer2_gather_v_gpu5&#45;&gt;tp_layer2_attn_out_gpu5 -->
<g id="edge421" class="edge">
<title>tp_layer2_gather_v_gpu5&#45;&gt;tp_layer2_attn_out_gpu5</title>
<path fill="none" stroke="black" d="M10063.38,-4518.32C10063.38,-4439.19 10063.38,-4205 10063.38,-4205 10063.38,-4205 9876.91,-4205 9876.91,-4205"/>
<polygon fill="black" stroke="black" points="9876.91,-4201.5 9866.91,-4205 9876.91,-4208.5 9876.91,-4201.5"/>
</g>
<!-- tp_layer2_out_proj_gpu5&#45;&gt;tp_layer2_attn_all_reduce -->
<g id="edge452" class="edge">
<title>tp_layer2_out_proj_gpu5&#45;&gt;tp_layer2_attn_all_reduce</title>
<path fill="none" stroke="black" d="M8793.76,-4039C8757.34,-4039 8731.73,-4039 8731.73,-4039 8731.73,-4039 8731.73,-3905.36 8731.73,-3905.36"/>
<polygon fill="black" stroke="black" points="8735.23,-3905.36 8731.73,-3895.36 8728.23,-3905.36 8735.23,-3905.36"/>
</g>
<!-- tp_layer2_gather_q_gpu6 -->
<g id="node337" class="node">
<title>tp_layer2_gather_q_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="10891.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="10891.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="10891.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10891.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10891.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_q_proj_gpu6&#45;&gt;tp_layer2_gather_q_gpu6 -->
<g id="edge426" class="edge">
<title>tp_layer2_q_proj_gpu6&#45;&gt;tp_layer2_gather_q_gpu6</title>
<path fill="none" stroke="black" d="M10998.14,-4860.32C10998.14,-4860.32 10998.14,-4782.32 10998.14,-4782.32"/>
<polygon fill="black" stroke="black" points="11001.64,-4782.32 10998.14,-4772.32 10994.64,-4782.32 11001.64,-4782.32"/>
</g>
<!-- tp_layer2_gather_k_gpu6 -->
<g id="node336" class="node">
<title>tp_layer2_gather_k_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="11658.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="11658.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="11658.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11658.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11658.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_k_proj_gpu6&#45;&gt;tp_layer2_gather_k_gpu6 -->
<g id="edge427" class="edge">
<title>tp_layer2_k_proj_gpu6&#45;&gt;tp_layer2_gather_k_gpu6</title>
<path fill="none" stroke="black" d="M11560.26,-4860.32C11560.26,-4860.32 11560.26,-4782.63 11560.26,-4782.63"/>
<polygon fill="black" stroke="black" points="11563.76,-4782.63 11560.26,-4772.63 11556.76,-4782.63 11563.76,-4782.63"/>
</g>
<!-- tp_layer2_gather_v_gpu6 -->
<g id="node340" class="node">
<title>tp_layer2_gather_v_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="12034.26" cy="-4361.92" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="12034.26" y="-4380.72" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="12034.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12034.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12034.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_v_proj_gpu6&#45;&gt;tp_layer2_gather_v_gpu6 -->
<g id="edge431" class="edge">
<title>tp_layer2_v_proj_gpu6&#45;&gt;tp_layer2_gather_v_gpu6</title>
<path fill="none" stroke="black" d="M12108.26,-4860.22C12108.26,-4860.22 12108.26,-4419.04 12108.26,-4419.04"/>
<polygon fill="black" stroke="black" points="12111.76,-4419.04 12108.26,-4409.04 12104.76,-4419.04 12111.76,-4419.04"/>
</g>
<!-- tp_layer2_attn_scores_gpu6 -->
<g id="node335" class="node">
<title>tp_layer2_attn_scores_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="11386.76,-4578.08 10847.76,-4578.08 10847.76,-4510.08 11386.76,-4510.08 11386.76,-4578.08"/>
<text text-anchor="middle" x="11117.26" y="-4562.88" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="11117.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11117.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="11117.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_softmax_gpu6 -->
<g id="node338" class="node">
<title>tp_layer2_softmax_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="11386.76,-4395.92 10847.76,-4395.92 10847.76,-4327.92 11386.76,-4327.92 11386.76,-4395.92"/>
<text text-anchor="middle" x="11117.26" y="-4380.72" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="11117.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="11117.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="11117.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_attn_scores_gpu6&#45;&gt;tp_layer2_softmax_gpu6 -->
<g id="edge430" class="edge">
<title>tp_layer2_attn_scores_gpu6&#45;&gt;tp_layer2_softmax_gpu6</title>
<path fill="none" stroke="black" d="M11117.26,-4509.82C11117.26,-4509.82 11117.26,-4406.03 11117.26,-4406.03"/>
<polygon fill="black" stroke="black" points="11120.76,-4406.03 11117.26,-4396.03 11113.76,-4406.03 11120.76,-4406.03"/>
</g>
<!-- tp_layer2_gather_k_gpu6&#45;&gt;tp_layer2_attn_scores_gpu6 -->
<g id="edge429" class="edge">
<title>tp_layer2_gather_k_gpu6&#45;&gt;tp_layer2_attn_scores_gpu6</title>
<path fill="none" stroke="black" d="M11345.38,-4703.54C11345.38,-4703.54 11345.38,-4588.27 11345.38,-4588.27"/>
<polygon fill="black" stroke="black" points="11348.88,-4588.27 11345.38,-4578.27 11341.88,-4588.27 11348.88,-4588.27"/>
</g>
<!-- tp_layer2_gather_q_gpu6&#45;&gt;tp_layer2_attn_scores_gpu6 -->
<g id="edge428" class="edge">
<title>tp_layer2_gather_q_gpu6&#45;&gt;tp_layer2_attn_scores_gpu6</title>
<path fill="none" stroke="black" d="M11046.64,-4682.61C11046.64,-4682.61 11046.64,-4588.25 11046.64,-4588.25"/>
<polygon fill="black" stroke="black" points="11050.14,-4588.25 11046.64,-4578.25 11043.14,-4588.25 11050.14,-4588.25"/>
</g>
<!-- tp_layer2_attn_out_gpu6 -->
<g id="node339" class="node">
<title>tp_layer2_attn_out_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="11380.76,-4227.83 10853.76,-4227.83 10853.76,-4159.83 11380.76,-4159.83 11380.76,-4227.83"/>
<text text-anchor="middle" x="11117.26" y="-4212.63" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="11117.26" y="-4197.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="11117.26" y="-4182.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11117.26" y="-4167.63" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_softmax_gpu6&#45;&gt;tp_layer2_attn_out_gpu6 -->
<g id="edge432" class="edge">
<title>tp_layer2_softmax_gpu6&#45;&gt;tp_layer2_attn_out_gpu6</title>
<path fill="none" stroke="black" d="M11117.26,-4327.9C11117.26,-4327.9 11117.26,-4238.08 11117.26,-4238.08"/>
<polygon fill="black" stroke="black" points="11120.76,-4238.08 11117.26,-4228.08 11113.76,-4238.08 11120.76,-4238.08"/>
</g>
<!-- tp_layer2_out_proj_gpu6 -->
<g id="node341" class="node">
<title>tp_layer2_out_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="10606.76,-4073.83 10117.76,-4073.83 10117.76,-4005.83 10606.76,-4005.83 10606.76,-4073.83"/>
<text text-anchor="middle" x="10362.26" y="-4058.63" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="10362.26" y="-4043.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10362.26" y="-4028.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="10362.26" y="-4013.63" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_attn_out_gpu6&#45;&gt;tp_layer2_out_proj_gpu6 -->
<g id="edge434" class="edge">
<title>tp_layer2_attn_out_gpu6&#45;&gt;tp_layer2_out_proj_gpu6</title>
<path fill="none" stroke="black" d="M10853.73,-4182C10635.92,-4182 10362.26,-4182 10362.26,-4182 10362.26,-4182 10362.26,-4083.88 10362.26,-4083.88"/>
<polygon fill="black" stroke="black" points="10365.76,-4083.88 10362.26,-4073.88 10358.76,-4083.88 10365.76,-4083.88"/>
</g>
<!-- tp_layer2_gather_v_gpu6&#45;&gt;tp_layer2_attn_out_gpu6 -->
<g id="edge433" class="edge">
<title>tp_layer2_gather_v_gpu6&#45;&gt;tp_layer2_attn_out_gpu6</title>
<path fill="none" stroke="black" d="M11699.38,-4346.02C11699.38,-4303.97 11699.38,-4193 11699.38,-4193 11699.38,-4193 11391.07,-4193 11391.07,-4193"/>
<polygon fill="black" stroke="black" points="11391.07,-4189.5 11381.07,-4193 11391.07,-4196.5 11391.07,-4189.5"/>
</g>
<!-- tp_layer2_out_proj_gpu6&#45;&gt;tp_layer2_attn_all_reduce -->
<g id="edge453" class="edge">
<title>tp_layer2_out_proj_gpu6&#45;&gt;tp_layer2_attn_all_reduce</title>
<path fill="none" stroke="black" d="M10232.01,-4005.53C10232.01,-3960.47 10232.01,-3887 10232.01,-3887 10232.01,-3887 8767.67,-3887 8767.67,-3887"/>
<polygon fill="black" stroke="black" points="8767.67,-3883.5 8757.67,-3887 8767.67,-3890.5 8767.67,-3883.5"/>
</g>
<!-- tp_layer2_gather_q_gpu7 -->
<g id="node347" class="node">
<title>tp_layer2_gather_q_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="12558.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="12558.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="12558.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12558.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12558.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_q_proj_gpu7&#45;&gt;tp_layer2_gather_q_gpu7 -->
<g id="edge438" class="edge">
<title>tp_layer2_q_proj_gpu7&#45;&gt;tp_layer2_gather_q_gpu7</title>
<path fill="none" stroke="black" d="M12670.14,-4860.32C12670.14,-4860.32 12670.14,-4782 12670.14,-4782"/>
<polygon fill="black" stroke="black" points="12673.64,-4782 12670.14,-4772 12666.64,-4782 12673.64,-4782"/>
</g>
<!-- tp_layer2_gather_k_gpu7 -->
<g id="node346" class="node">
<title>tp_layer2_gather_k_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="13325.26" cy="-4726.25" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="13325.26" y="-4745.05" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="13325.26" y="-4730.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13325.26" y="-4715.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13325.26" y="-4700.05" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_k_proj_gpu7&#45;&gt;tp_layer2_gather_k_gpu7 -->
<g id="edge439" class="edge">
<title>tp_layer2_k_proj_gpu7&#45;&gt;tp_layer2_gather_k_gpu7</title>
<path fill="none" stroke="black" d="M13237.26,-4860.32C13237.26,-4860.32 13237.26,-4782.95 13237.26,-4782.95"/>
<polygon fill="black" stroke="black" points="13240.76,-4782.95 13237.26,-4772.95 13233.76,-4782.95 13240.76,-4782.95"/>
</g>
<!-- tp_layer2_gather_v_gpu7 -->
<g id="node350" class="node">
<title>tp_layer2_gather_v_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="13641.26" cy="-4544.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="13641.26" y="-4562.88" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="13641.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13641.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13641.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_v_proj_gpu7&#45;&gt;tp_layer2_gather_v_gpu7 -->
<g id="edge443" class="edge">
<title>tp_layer2_v_proj_gpu7&#45;&gt;tp_layer2_gather_v_gpu7</title>
<path fill="none" stroke="black" d="M13837.52,-4860.11C13837.52,-4860.11 13837.52,-4594.32 13837.52,-4594.32"/>
<polygon fill="black" stroke="black" points="13841.02,-4594.32 13837.52,-4584.32 13834.02,-4594.32 13841.02,-4594.32"/>
</g>
<!-- tp_layer2_attn_scores_gpu7 -->
<g id="node345" class="node">
<title>tp_layer2_attn_scores_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="13123.76,-4578.08 12584.76,-4578.08 12584.76,-4510.08 13123.76,-4510.08 13123.76,-4578.08"/>
<text text-anchor="middle" x="12854.26" y="-4562.88" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="12854.26" y="-4547.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12854.26" y="-4532.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12854.26" y="-4517.88" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_softmax_gpu7 -->
<g id="node348" class="node">
<title>tp_layer2_softmax_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="13123.76,-4395.92 12584.76,-4395.92 12584.76,-4327.92 13123.76,-4327.92 13123.76,-4395.92"/>
<text text-anchor="middle" x="12854.26" y="-4380.72" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="12854.26" y="-4365.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12854.26" y="-4350.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12854.26" y="-4335.72" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_attn_scores_gpu7&#45;&gt;tp_layer2_softmax_gpu7 -->
<g id="edge442" class="edge">
<title>tp_layer2_attn_scores_gpu7&#45;&gt;tp_layer2_softmax_gpu7</title>
<path fill="none" stroke="black" d="M12854.26,-4509.82C12854.26,-4509.82 12854.26,-4406.03 12854.26,-4406.03"/>
<polygon fill="black" stroke="black" points="12857.76,-4406.03 12854.26,-4396.03 12850.76,-4406.03 12857.76,-4406.03"/>
</g>
<!-- tp_layer2_gather_k_gpu7&#45;&gt;tp_layer2_attn_scores_gpu7 -->
<g id="edge441" class="edge">
<title>tp_layer2_gather_k_gpu7&#45;&gt;tp_layer2_attn_scores_gpu7</title>
<path fill="none" stroke="black" d="M13047.38,-4696.17C13047.38,-4696.17 13047.38,-4588.24 13047.38,-4588.24"/>
<polygon fill="black" stroke="black" points="13050.88,-4588.24 13047.38,-4578.24 13043.88,-4588.24 13050.88,-4588.24"/>
</g>
<!-- tp_layer2_gather_q_gpu7&#45;&gt;tp_layer2_attn_scores_gpu7 -->
<g id="edge440" class="edge">
<title>tp_layer2_gather_q_gpu7&#45;&gt;tp_layer2_attn_scores_gpu7</title>
<path fill="none" stroke="black" d="M12748.64,-4685.37C12748.64,-4685.37 12748.64,-4588.11 12748.64,-4588.11"/>
<polygon fill="black" stroke="black" points="12752.14,-4588.11 12748.64,-4578.11 12745.14,-4588.11 12752.14,-4588.11"/>
</g>
<!-- tp_layer2_attn_out_gpu7 -->
<g id="node349" class="node">
<title>tp_layer2_attn_out_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="13117.76,-4227.83 12590.76,-4227.83 12590.76,-4159.83 13117.76,-4159.83 13117.76,-4227.83"/>
<text text-anchor="middle" x="12854.26" y="-4212.63" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="12854.26" y="-4197.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="12854.26" y="-4182.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12854.26" y="-4167.63" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_softmax_gpu7&#45;&gt;tp_layer2_attn_out_gpu7 -->
<g id="edge444" class="edge">
<title>tp_layer2_softmax_gpu7&#45;&gt;tp_layer2_attn_out_gpu7</title>
<path fill="none" stroke="black" d="M12854.26,-4327.9C12854.26,-4327.9 12854.26,-4238.08 12854.26,-4238.08"/>
<polygon fill="black" stroke="black" points="12857.76,-4238.08 12854.26,-4228.08 12850.76,-4238.08 12857.76,-4238.08"/>
</g>
<!-- tp_layer2_out_proj_gpu7 -->
<g id="node351" class="node">
<title>tp_layer2_out_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="12207.76,-4073.83 11718.76,-4073.83 11718.76,-4005.83 12207.76,-4005.83 12207.76,-4073.83"/>
<text text-anchor="middle" x="11963.26" y="-4058.63" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="11963.26" y="-4043.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11963.26" y="-4028.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="11963.26" y="-4013.63" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_attn_out_gpu7&#45;&gt;tp_layer2_out_proj_gpu7 -->
<g id="edge446" class="edge">
<title>tp_layer2_attn_out_gpu7&#45;&gt;tp_layer2_out_proj_gpu7</title>
<path fill="none" stroke="black" d="M12596.51,-4159.47C12596.51,-4113.85 12596.51,-4039 12596.51,-4039 12596.51,-4039 12218.09,-4039 12218.09,-4039"/>
<polygon fill="black" stroke="black" points="12218.09,-4035.5 12208.09,-4039 12218.09,-4042.5 12218.09,-4035.5"/>
</g>
<!-- tp_layer2_gather_v_gpu7&#45;&gt;tp_layer2_attn_out_gpu7 -->
<g id="edge445" class="edge">
<title>tp_layer2_gather_v_gpu7&#45;&gt;tp_layer2_attn_out_gpu7</title>
<path fill="none" stroke="black" d="M13496.38,-4499.97C13496.38,-4405.68 13496.38,-4193 13496.38,-4193 13496.38,-4193 13128.21,-4193 13128.21,-4193"/>
<polygon fill="black" stroke="black" points="13128.21,-4189.5 13118.21,-4193 13128.21,-4196.5 13128.21,-4189.5"/>
</g>
<!-- tp_layer2_out_proj_gpu7&#45;&gt;tp_layer2_attn_all_reduce -->
<g id="edge454" class="edge">
<title>tp_layer2_out_proj_gpu7&#45;&gt;tp_layer2_attn_all_reduce</title>
<path fill="none" stroke="black" d="M11737.16,-4005.5C11737.16,-3952.05 11737.16,-3855 11737.16,-3855 11737.16,-3855 8764.03,-3855 8764.03,-3855"/>
<polygon fill="black" stroke="black" points="8764.03,-3851.5 8754.03,-3855 8764.03,-3858.5 8764.03,-3851.5"/>
</g>
<!-- tp_layer2_attn_all_reduce&#45;&gt;tp_layer2_attn_residual -->
<g id="edge456" class="edge">
<title>tp_layer2_attn_all_reduce&#45;&gt;tp_layer2_attn_residual</title>
<path fill="none" stroke="black" d="M8746.23,-3852.19C8746.23,-3805.05 8746.23,-3689 8746.23,-3689 8746.23,-3689 10452.77,-3689 10452.77,-3689"/>
<polygon fill="black" stroke="black" points="10452.77,-3692.5 10462.77,-3689 10452.77,-3685.5 10452.77,-3692.5"/>
</g>
<!-- tp_layer2_moe_norm -->
<g id="node354" class="node">
<title>tp_layer2_moe_norm</title>
<polygon fill="lightyellow" stroke="black" points="9213.76,-3555.5 8716.76,-3555.5 8716.76,-3487.5 9213.76,-3487.5 9213.76,-3555.5"/>
<text text-anchor="middle" x="8965.26" y="-3540.3" font-family="Times,serif" font-size="14.00">Layer Norm</text>
<text text-anchor="middle" x="8965.26" y="-3525.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8965.26" y="-3510.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8965.26" y="-3495.3" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer2_attn_residual&#45;&gt;tp_layer2_moe_norm -->
<g id="edge457" class="edge">
<title>tp_layer2_attn_residual&#45;&gt;tp_layer2_moe_norm</title>
<path fill="none" stroke="black" d="M10686.61,-3652.86C10686.61,-3610.62 10686.61,-3547 10686.61,-3547 10686.61,-3547 9224.18,-3547 9224.18,-3547"/>
<polygon fill="black" stroke="black" points="9224.18,-3543.5 9214.18,-3547 9224.18,-3550.5 9224.18,-3543.5"/>
</g>
<!-- tp_layer2_final_residual -->
<g id="node404" class="node">
<title>tp_layer2_final_residual</title>
<ellipse fill="lightblue" stroke="black" cx="11109.26" cy="-2709.25" rx="646.09" ry="48.17"/>
<text text-anchor="middle" x="11109.26" y="-2728.05" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="11109.26" y="-2713.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096], [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11109.26" y="-2698.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11109.26" y="-2683.05" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer2_attn_residual&#45;&gt;tp_layer2_final_residual -->
<g id="edge522" class="edge">
<title>tp_layer2_attn_residual&#45;&gt;tp_layer2_final_residual</title>
<path fill="none" stroke="black" d="M11500.76,-3651.15C11500.76,-3651.15 11500.76,-2757.68 11500.76,-2757.68"/>
<polygon fill="black" stroke="black" points="11504.26,-2757.68 11500.76,-2747.68 11497.26,-2757.68 11504.26,-2757.68"/>
</g>
<!-- tp_layer2_expert0_up -->
<g id="node355" class="node">
<title>tp_layer2_expert0_up</title>
<polygon fill="lightcoral" stroke="black" points="4706.26,-3401.5 4200.26,-3401.5 4200.26,-3333.5 4706.26,-3333.5 4706.26,-3401.5"/>
<text text-anchor="middle" x="4453.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 0 Up</text>
<text text-anchor="middle" x="4453.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4453.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4453.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert0_up -->
<g id="edge458" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert0_up</title>
<path fill="none" stroke="black" d="M8716.58,-3547C7799.11,-3547 4657.01,-3547 4657.01,-3547 4657.01,-3547 4657.01,-3411.68 4657.01,-3411.68"/>
<polygon fill="black" stroke="black" points="4660.51,-3411.68 4657.01,-3401.68 4653.51,-3411.68 4660.51,-3411.68"/>
</g>
<!-- tp_layer2_expert1_up -->
<g id="node358" class="node">
<title>tp_layer2_expert1_up</title>
<polygon fill="lightcoral" stroke="black" points="5270.26,-3401.5 4764.26,-3401.5 4764.26,-3333.5 5270.26,-3333.5 5270.26,-3401.5"/>
<text text-anchor="middle" x="5017.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 1 Up</text>
<text text-anchor="middle" x="5017.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5017.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5017.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert1_up -->
<g id="edge461" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert1_up</title>
<path fill="none" stroke="black" d="M8716.54,-3540C7872.4,-3540 5169.01,-3540 5169.01,-3540 5169.01,-3540 5169.01,-3411.58 5169.01,-3411.58"/>
<polygon fill="black" stroke="black" points="5172.51,-3411.58 5169.01,-3401.58 5165.51,-3411.58 5172.51,-3411.58"/>
</g>
<!-- tp_layer2_expert2_up -->
<g id="node361" class="node">
<title>tp_layer2_expert2_up</title>
<polygon fill="lightcoral" stroke="black" points="5834.26,-3401.5 5328.26,-3401.5 5328.26,-3333.5 5834.26,-3333.5 5834.26,-3401.5"/>
<text text-anchor="middle" x="5581.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 2 Up</text>
<text text-anchor="middle" x="5581.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5581.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5581.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert2_up -->
<g id="edge464" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert2_up</title>
<path fill="none" stroke="black" d="M8716.5,-3532C7974.59,-3532 5828.51,-3532 5828.51,-3532 5828.51,-3532 5828.51,-3411.58 5828.51,-3411.58"/>
<polygon fill="black" stroke="black" points="5832.01,-3411.58 5828.51,-3401.58 5825.01,-3411.58 5832.01,-3411.58"/>
</g>
<!-- tp_layer2_expert3_up -->
<g id="node364" class="node">
<title>tp_layer2_expert3_up</title>
<polygon fill="lightcoral" stroke="black" points="6398.26,-3401.5 5892.26,-3401.5 5892.26,-3333.5 6398.26,-3333.5 6398.26,-3401.5"/>
<text text-anchor="middle" x="6145.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 3 Up</text>
<text text-anchor="middle" x="6145.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6145.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6145.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert3_up -->
<g id="edge467" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert3_up</title>
<path fill="none" stroke="black" d="M8716.7,-3525C8060.12,-3525 6329.51,-3525 6329.51,-3525 6329.51,-3525 6329.51,-3411.67 6329.51,-3411.67"/>
<polygon fill="black" stroke="black" points="6333.01,-3411.67 6329.51,-3401.67 6326.01,-3411.67 6333.01,-3411.67"/>
</g>
<!-- tp_layer2_expert4_up -->
<g id="node367" class="node">
<title>tp_layer2_expert4_up</title>
<polygon fill="lightcoral" stroke="black" points="6962.26,-3401.5 6456.26,-3401.5 6456.26,-3333.5 6962.26,-3333.5 6962.26,-3401.5"/>
<text text-anchor="middle" x="6709.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 4 Up</text>
<text text-anchor="middle" x="6709.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6709.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6709.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert4_up -->
<g id="edge470" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert4_up</title>
<path fill="none" stroke="black" d="M8716.56,-3517C8178.72,-3517 6955.51,-3517 6955.51,-3517 6955.51,-3517 6955.51,-3411.8 6955.51,-3411.8"/>
<polygon fill="black" stroke="black" points="6959.01,-3411.8 6955.51,-3401.8 6952.01,-3411.8 6959.01,-3411.8"/>
</g>
<!-- tp_layer2_expert5_up -->
<g id="node370" class="node">
<title>tp_layer2_expert5_up</title>
<polygon fill="lightcoral" stroke="black" points="7526.26,-3401.5 7020.26,-3401.5 7020.26,-3333.5 7526.26,-3333.5 7526.26,-3401.5"/>
<text text-anchor="middle" x="7273.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 5 Up</text>
<text text-anchor="middle" x="7273.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7273.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7273.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert5_up -->
<g id="edge473" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert5_up</title>
<path fill="none" stroke="black" d="M8716.37,-3510C8284.62,-3510 7442.51,-3510 7442.51,-3510 7442.51,-3510 7442.51,-3411.63 7442.51,-3411.63"/>
<polygon fill="black" stroke="black" points="7446.01,-3411.63 7442.51,-3401.63 7439.01,-3411.63 7446.01,-3411.63"/>
</g>
<!-- tp_layer2_expert6_up -->
<g id="node373" class="node">
<title>tp_layer2_expert6_up</title>
<polygon fill="lightcoral" stroke="black" points="8090.26,-3401.5 7584.26,-3401.5 7584.26,-3333.5 8090.26,-3333.5 8090.26,-3401.5"/>
<text text-anchor="middle" x="7837.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 6 Up</text>
<text text-anchor="middle" x="7837.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7837.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7837.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert6_up -->
<g id="edge476" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert6_up</title>
<path fill="none" stroke="black" d="M8716.74,-3502C8455.36,-3502 8081.54,-3502 8081.54,-3502 8081.54,-3502 8081.54,-3411.79 8081.54,-3411.79"/>
<polygon fill="black" stroke="black" points="8085.04,-3411.79 8081.54,-3401.79 8078.04,-3411.79 8085.04,-3411.79"/>
</g>
<!-- tp_layer2_expert7_up -->
<g id="node376" class="node">
<title>tp_layer2_expert7_up</title>
<polygon fill="lightcoral" stroke="black" points="8654.26,-3401.5 8148.26,-3401.5 8148.26,-3333.5 8654.26,-3333.5 8654.26,-3401.5"/>
<text text-anchor="middle" x="8401.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 7 Up</text>
<text text-anchor="middle" x="8401.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8401.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8401.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert7_up -->
<g id="edge479" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert7_up</title>
<path fill="none" stroke="black" d="M8716.65,-3495C8565.45,-3495 8401.26,-3495 8401.26,-3495 8401.26,-3495 8401.26,-3411.67 8401.26,-3411.67"/>
<polygon fill="black" stroke="black" points="8404.76,-3411.67 8401.26,-3401.67 8397.76,-3411.67 8404.76,-3411.67"/>
</g>
<!-- tp_layer2_expert8_up -->
<g id="node379" class="node">
<title>tp_layer2_expert8_up</title>
<polygon fill="lightcoral" stroke="black" points="9218.26,-3401.5 8712.26,-3401.5 8712.26,-3333.5 9218.26,-3333.5 9218.26,-3401.5"/>
<text text-anchor="middle" x="8965.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 8 Up</text>
<text text-anchor="middle" x="8965.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8965.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8965.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert8_up -->
<g id="edge482" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert8_up</title>
<path fill="none" stroke="black" d="M8965.26,-3487.32C8965.26,-3487.32 8965.26,-3411.58 8965.26,-3411.58"/>
<polygon fill="black" stroke="black" points="8968.76,-3411.58 8965.26,-3401.58 8961.76,-3411.58 8968.76,-3411.58"/>
</g>
<!-- tp_layer2_expert9_up -->
<g id="node382" class="node">
<title>tp_layer2_expert9_up</title>
<polygon fill="lightcoral" stroke="black" points="9782.26,-3401.5 9276.26,-3401.5 9276.26,-3333.5 9782.26,-3333.5 9782.26,-3401.5"/>
<text text-anchor="middle" x="9529.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 9 Up</text>
<text text-anchor="middle" x="9529.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9529.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9529.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert9_up -->
<g id="edge485" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert9_up</title>
<path fill="none" stroke="black" d="M9214.08,-3495C9267.5,-3495 9308.26,-3495 9308.26,-3495 9308.26,-3495 9308.26,-3411.67 9308.26,-3411.67"/>
<polygon fill="black" stroke="black" points="9311.76,-3411.67 9308.26,-3401.67 9304.76,-3411.67 9311.76,-3411.67"/>
</g>
<!-- tp_layer2_expert10_up -->
<g id="node385" class="node">
<title>tp_layer2_expert10_up</title>
<polygon fill="lightcoral" stroke="black" points="10346.26,-3401.5 9840.26,-3401.5 9840.26,-3333.5 10346.26,-3333.5 10346.26,-3401.5"/>
<text text-anchor="middle" x="10093.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 10 Up</text>
<text text-anchor="middle" x="10093.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10093.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10093.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert10_up -->
<g id="edge488" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert10_up</title>
<path fill="none" stroke="black" d="M9213.87,-3502C9476.64,-3502 9853.51,-3502 9853.51,-3502 9853.51,-3502 9853.51,-3411.79 9853.51,-3411.79"/>
<polygon fill="black" stroke="black" points="9857.01,-3411.79 9853.51,-3401.79 9850.01,-3411.79 9857.01,-3411.79"/>
</g>
<!-- tp_layer2_expert11_up -->
<g id="node388" class="node">
<title>tp_layer2_expert11_up</title>
<polygon fill="lightcoral" stroke="black" points="10910.26,-3401.5 10404.26,-3401.5 10404.26,-3333.5 10910.26,-3333.5 10910.26,-3401.5"/>
<text text-anchor="middle" x="10657.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 11 Up</text>
<text text-anchor="middle" x="10657.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10657.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10657.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert11_up -->
<g id="edge491" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert11_up</title>
<path fill="none" stroke="black" d="M9213.93,-3510C9632.74,-3510 10433.61,-3510 10433.61,-3510 10433.61,-3510 10433.61,-3411.63 10433.61,-3411.63"/>
<polygon fill="black" stroke="black" points="10437.11,-3411.63 10433.61,-3401.63 10430.11,-3411.63 10437.11,-3411.63"/>
</g>
<!-- tp_layer2_expert12_up -->
<g id="node391" class="node">
<title>tp_layer2_expert12_up</title>
<polygon fill="lightcoral" stroke="black" points="11474.26,-3401.5 10968.26,-3401.5 10968.26,-3333.5 11474.26,-3333.5 11474.26,-3401.5"/>
<text text-anchor="middle" x="11221.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 12 Up</text>
<text text-anchor="middle" x="11221.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11221.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11221.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert12_up -->
<g id="edge494" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert12_up</title>
<path fill="none" stroke="black" d="M9213.96,-3517C9800.5,-3517 11221.26,-3517 11221.26,-3517 11221.26,-3517 11221.26,-3411.8 11221.26,-3411.8"/>
<polygon fill="black" stroke="black" points="11224.76,-3411.8 11221.26,-3401.8 11217.76,-3411.8 11224.76,-3411.8"/>
</g>
<!-- tp_layer2_expert13_up -->
<g id="node394" class="node">
<title>tp_layer2_expert13_up</title>
<polygon fill="lightcoral" stroke="black" points="12038.26,-3401.5 11532.26,-3401.5 11532.26,-3333.5 12038.26,-3333.5 12038.26,-3401.5"/>
<text text-anchor="middle" x="11785.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 13 Up</text>
<text text-anchor="middle" x="11785.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11785.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11785.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert13_up -->
<g id="edge497" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert13_up</title>
<path fill="none" stroke="black" d="M9213.96,-3525C9878.24,-3525 11643.91,-3525 11643.91,-3525 11643.91,-3525 11643.91,-3411.67 11643.91,-3411.67"/>
<polygon fill="black" stroke="black" points="11647.41,-3411.67 11643.91,-3401.67 11640.41,-3411.67 11647.41,-3411.67"/>
</g>
<!-- tp_layer2_expert14_up -->
<g id="node397" class="node">
<title>tp_layer2_expert14_up</title>
<polygon fill="lightcoral" stroke="black" points="12602.26,-3401.5 12096.26,-3401.5 12096.26,-3333.5 12602.26,-3333.5 12602.26,-3401.5"/>
<text text-anchor="middle" x="12349.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 14 Up</text>
<text text-anchor="middle" x="12349.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12349.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12349.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert14_up -->
<g id="edge500" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert14_up</title>
<path fill="none" stroke="black" d="M9213.99,-3532C9963.99,-3532 12152.01,-3532 12152.01,-3532 12152.01,-3532 12152.01,-3411.58 12152.01,-3411.58"/>
<polygon fill="black" stroke="black" points="12155.51,-3411.58 12152.01,-3401.58 12148.51,-3411.58 12155.51,-3411.58"/>
</g>
<!-- tp_layer2_expert15_up -->
<g id="node400" class="node">
<title>tp_layer2_expert15_up</title>
<polygon fill="lightcoral" stroke="black" points="13166.26,-3401.5 12660.26,-3401.5 12660.26,-3333.5 13166.26,-3333.5 13166.26,-3401.5"/>
<text text-anchor="middle" x="12913.26" y="-3386.3" font-family="Times,serif" font-size="14.00">Expert 15 Up</text>
<text text-anchor="middle" x="12913.26" y="-3371.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12913.26" y="-3356.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12913.26" y="-3341.3" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_moe_norm&#45;&gt;tp_layer2_expert15_up -->
<g id="edge503" class="edge">
<title>tp_layer2_moe_norm&#45;&gt;tp_layer2_expert15_up</title>
<path fill="none" stroke="black" d="M9214.06,-3540C10077.02,-3540 12889.01,-3540 12889.01,-3540 12889.01,-3540 12889.01,-3411.58 12889.01,-3411.58"/>
<polygon fill="black" stroke="black" points="12892.51,-3411.58 12889.01,-3401.58 12885.51,-3411.58 12892.51,-3411.58"/>
</g>
<!-- tp_layer2_expert0_activation -->
<g id="node356" class="node">
<title>tp_layer2_expert0_activation</title>
<polygon fill="lightyellow" stroke="black" points="4706.26,-3247.5 4200.26,-3247.5 4200.26,-3179.5 4706.26,-3179.5 4706.26,-3247.5"/>
<text text-anchor="middle" x="4453.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="4453.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4453.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4453.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_expert0_up&#45;&gt;tp_layer2_expert0_activation -->
<g id="edge459" class="edge">
<title>tp_layer2_expert0_up&#45;&gt;tp_layer2_expert0_activation</title>
<path fill="none" stroke="black" d="M4453.26,-3333.32C4453.26,-3333.32 4453.26,-3257.58 4453.26,-3257.58"/>
<polygon fill="black" stroke="black" points="4456.76,-3257.58 4453.26,-3247.58 4449.76,-3257.58 4456.76,-3257.58"/>
</g>
<!-- tp_layer2_expert0_down -->
<g id="node357" class="node">
<title>tp_layer2_expert0_down</title>
<polygon fill="lightcoral" stroke="black" points="4712.26,-3093.5 4218.26,-3093.5 4218.26,-3025.5 4712.26,-3025.5 4712.26,-3093.5"/>
<text text-anchor="middle" x="4465.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 0 Down</text>
<text text-anchor="middle" x="4465.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4465.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4465.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_expert0_activation&#45;&gt;tp_layer2_expert0_down -->
<g id="edge460" class="edge">
<title>tp_layer2_expert0_activation&#45;&gt;tp_layer2_expert0_down</title>
<path fill="none" stroke="black" d="M4462.26,-3179.32C4462.26,-3179.32 4462.26,-3103.58 4462.26,-3103.58"/>
<polygon fill="black" stroke="black" points="4465.76,-3103.58 4462.26,-3093.58 4458.76,-3103.58 4465.76,-3103.58"/>
</g>
<!-- tp_layer2_moe_all_reduce -->
<g id="node403" class="node">
<title>tp_layer2_moe_all_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="8965.26" cy="-2891.42" rx="351.36" ry="48.17"/>
<text text-anchor="middle" x="8965.26" y="-2910.22" font-family="Times,serif" font-size="14.00">All&#45;Reduce MoE</text>
<text text-anchor="middle" x="8965.26" y="-2895.22" font-family="Times,serif" font-size="14.00">Input: 8×[512]</text>
<text text-anchor="middle" x="8965.26" y="-2880.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8965.26" y="-2865.22" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer2_expert0_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge506" class="edge">
<title>tp_layer2_expert0_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M4486.51,-3025.27C4486.51,-2967.05 4486.51,-2855 4486.51,-2855 4486.51,-2855 8725.45,-2855 8725.45,-2855"/>
<polygon fill="black" stroke="black" points="8725.45,-2858.5 8735.45,-2855 8725.45,-2851.5 8725.45,-2858.5"/>
</g>
<!-- tp_layer2_expert1_activation -->
<g id="node359" class="node">
<title>tp_layer2_expert1_activation</title>
<polygon fill="lightyellow" stroke="black" points="5270.26,-3247.5 4764.26,-3247.5 4764.26,-3179.5 5270.26,-3179.5 5270.26,-3247.5"/>
<text text-anchor="middle" x="5017.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="5017.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5017.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5017.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_expert1_up&#45;&gt;tp_layer2_expert1_activation -->
<g id="edge462" class="edge">
<title>tp_layer2_expert1_up&#45;&gt;tp_layer2_expert1_activation</title>
<path fill="none" stroke="black" d="M5017.26,-3333.32C5017.26,-3333.32 5017.26,-3257.58 5017.26,-3257.58"/>
<polygon fill="black" stroke="black" points="5020.76,-3257.58 5017.26,-3247.58 5013.76,-3257.58 5020.76,-3257.58"/>
</g>
<!-- tp_layer2_expert1_down -->
<g id="node360" class="node">
<title>tp_layer2_expert1_down</title>
<polygon fill="lightcoral" stroke="black" points="5276.26,-3093.5 4782.26,-3093.5 4782.26,-3025.5 5276.26,-3025.5 5276.26,-3093.5"/>
<text text-anchor="middle" x="5029.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 1 Down</text>
<text text-anchor="middle" x="5029.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5029.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5029.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer2_expert1_activation&#45;&gt;tp_layer2_expert1_down -->
<g id="edge463" class="edge">
<title>tp_layer2_expert1_activation&#45;&gt;tp_layer2_expert1_down</title>
<path fill="none" stroke="black" d="M5026.26,-3179.32C5026.26,-3179.32 5026.26,-3103.58 5026.26,-3103.58"/>
<polygon fill="black" stroke="black" points="5029.76,-3103.58 5026.26,-3093.58 5022.76,-3103.58 5029.76,-3103.58"/>
</g>
<!-- tp_layer2_expert1_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge507" class="edge">
<title>tp_layer2_expert1_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M5048.01,-3025.08C5048.01,-2969.71 5048.01,-2867 5048.01,-2867 5048.01,-2867 8652.36,-2867 8652.36,-2867"/>
<polygon fill="black" stroke="black" points="8652.36,-2870.5 8662.36,-2867 8652.36,-2863.5 8652.36,-2870.5"/>
</g>
<!-- tp_layer2_expert2_activation -->
<g id="node362" class="node">
<title>tp_layer2_expert2_activation</title>
<polygon fill="lightyellow" stroke="black" points="5834.26,-3247.5 5328.26,-3247.5 5328.26,-3179.5 5834.26,-3179.5 5834.26,-3247.5"/>
<text text-anchor="middle" x="5581.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="5581.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5581.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5581.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_expert2_up&#45;&gt;tp_layer2_expert2_activation -->
<g id="edge465" class="edge">
<title>tp_layer2_expert2_up&#45;&gt;tp_layer2_expert2_activation</title>
<path fill="none" stroke="black" d="M5581.26,-3333.32C5581.26,-3333.32 5581.26,-3257.58 5581.26,-3257.58"/>
<polygon fill="black" stroke="black" points="5584.76,-3257.58 5581.26,-3247.58 5577.76,-3257.58 5584.76,-3257.58"/>
</g>
<!-- tp_layer2_expert2_down -->
<g id="node363" class="node">
<title>tp_layer2_expert2_down</title>
<polygon fill="lightcoral" stroke="black" points="5834.26,-3093.5 5340.26,-3093.5 5340.26,-3025.5 5834.26,-3025.5 5834.26,-3093.5"/>
<text text-anchor="middle" x="5587.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 2 Down</text>
<text text-anchor="middle" x="5587.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5587.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5587.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_expert2_activation&#45;&gt;tp_layer2_expert2_down -->
<g id="edge466" class="edge">
<title>tp_layer2_expert2_activation&#45;&gt;tp_layer2_expert2_down</title>
<path fill="none" stroke="black" d="M5587.26,-3179.32C5587.26,-3179.32 5587.26,-3103.58 5587.26,-3103.58"/>
<polygon fill="black" stroke="black" points="5590.76,-3103.58 5587.26,-3093.58 5583.76,-3103.58 5590.76,-3103.58"/>
</g>
<!-- tp_layer2_expert2_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge508" class="edge">
<title>tp_layer2_expert2_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M5606.51,-3025.12C5606.51,-2972.75 5606.51,-2879 5606.51,-2879 5606.51,-2879 8615.5,-2879 8615.5,-2879"/>
<polygon fill="black" stroke="black" points="8615.5,-2882.5 8625.5,-2879 8615.5,-2875.5 8615.5,-2882.5"/>
</g>
<!-- tp_layer2_expert3_activation -->
<g id="node365" class="node">
<title>tp_layer2_expert3_activation</title>
<polygon fill="lightyellow" stroke="black" points="6398.26,-3247.5 5892.26,-3247.5 5892.26,-3179.5 6398.26,-3179.5 6398.26,-3247.5"/>
<text text-anchor="middle" x="6145.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="6145.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6145.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6145.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_expert3_up&#45;&gt;tp_layer2_expert3_activation -->
<g id="edge468" class="edge">
<title>tp_layer2_expert3_up&#45;&gt;tp_layer2_expert3_activation</title>
<path fill="none" stroke="black" d="M6145.26,-3333.32C6145.26,-3333.32 6145.26,-3257.58 6145.26,-3257.58"/>
<polygon fill="black" stroke="black" points="6148.76,-3257.58 6145.26,-3247.58 6141.76,-3257.58 6148.76,-3257.58"/>
</g>
<!-- tp_layer2_expert3_down -->
<g id="node366" class="node">
<title>tp_layer2_expert3_down</title>
<polygon fill="lightcoral" stroke="black" points="6398.26,-3093.5 5904.26,-3093.5 5904.26,-3025.5 6398.26,-3025.5 6398.26,-3093.5"/>
<text text-anchor="middle" x="6151.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 3 Down</text>
<text text-anchor="middle" x="6151.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6151.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6151.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer2_expert3_activation&#45;&gt;tp_layer2_expert3_down -->
<g id="edge469" class="edge">
<title>tp_layer2_expert3_activation&#45;&gt;tp_layer2_expert3_down</title>
<path fill="none" stroke="black" d="M6151.26,-3179.32C6151.26,-3179.32 6151.26,-3103.58 6151.26,-3103.58"/>
<polygon fill="black" stroke="black" points="6154.76,-3103.58 6151.26,-3093.58 6147.76,-3103.58 6154.76,-3103.58"/>
</g>
<!-- tp_layer2_expert3_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge509" class="edge">
<title>tp_layer2_expert3_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M6168.01,-3025.4C6168.01,-2976.16 6168.01,-2891 6168.01,-2891 6168.01,-2891 8603.82,-2891 8603.82,-2891"/>
<polygon fill="black" stroke="black" points="8603.82,-2894.5 8613.82,-2891 8603.82,-2887.5 8603.82,-2894.5"/>
</g>
<!-- tp_layer2_expert4_activation -->
<g id="node368" class="node">
<title>tp_layer2_expert4_activation</title>
<polygon fill="lightyellow" stroke="black" points="6962.26,-3247.5 6456.26,-3247.5 6456.26,-3179.5 6962.26,-3179.5 6962.26,-3247.5"/>
<text text-anchor="middle" x="6709.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="6709.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6709.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6709.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_expert4_up&#45;&gt;tp_layer2_expert4_activation -->
<g id="edge471" class="edge">
<title>tp_layer2_expert4_up&#45;&gt;tp_layer2_expert4_activation</title>
<path fill="none" stroke="black" d="M6709.26,-3333.32C6709.26,-3333.32 6709.26,-3257.58 6709.26,-3257.58"/>
<polygon fill="black" stroke="black" points="6712.76,-3257.58 6709.26,-3247.58 6705.76,-3257.58 6712.76,-3257.58"/>
</g>
<!-- tp_layer2_expert4_down -->
<g id="node369" class="node">
<title>tp_layer2_expert4_down</title>
<polygon fill="lightcoral" stroke="black" points="6962.26,-3093.5 6468.26,-3093.5 6468.26,-3025.5 6962.26,-3025.5 6962.26,-3093.5"/>
<text text-anchor="middle" x="6715.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 4 Down</text>
<text text-anchor="middle" x="6715.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6715.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6715.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_expert4_activation&#45;&gt;tp_layer2_expert4_down -->
<g id="edge472" class="edge">
<title>tp_layer2_expert4_activation&#45;&gt;tp_layer2_expert4_down</title>
<path fill="none" stroke="black" d="M6715.26,-3179.32C6715.26,-3179.32 6715.26,-3103.58 6715.26,-3103.58"/>
<polygon fill="black" stroke="black" points="6718.76,-3103.58 6715.26,-3093.58 6711.76,-3103.58 6718.76,-3103.58"/>
</g>
<!-- tp_layer2_expert4_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge510" class="edge">
<title>tp_layer2_expert4_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M6729.51,-3025.15C6729.51,-2979.09 6729.51,-2903 6729.51,-2903 6729.51,-2903 8614.18,-2903 8614.18,-2903"/>
<polygon fill="black" stroke="black" points="8614.18,-2906.5 8624.18,-2903 8614.18,-2899.5 8614.18,-2906.5"/>
</g>
<!-- tp_layer2_expert5_activation -->
<g id="node371" class="node">
<title>tp_layer2_expert5_activation</title>
<polygon fill="lightyellow" stroke="black" points="7526.26,-3247.5 7020.26,-3247.5 7020.26,-3179.5 7526.26,-3179.5 7526.26,-3247.5"/>
<text text-anchor="middle" x="7273.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="7273.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7273.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7273.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_expert5_up&#45;&gt;tp_layer2_expert5_activation -->
<g id="edge474" class="edge">
<title>tp_layer2_expert5_up&#45;&gt;tp_layer2_expert5_activation</title>
<path fill="none" stroke="black" d="M7273.26,-3333.32C7273.26,-3333.32 7273.26,-3257.58 7273.26,-3257.58"/>
<polygon fill="black" stroke="black" points="7276.76,-3257.58 7273.26,-3247.58 7269.76,-3257.58 7276.76,-3257.58"/>
</g>
<!-- tp_layer2_expert5_down -->
<g id="node372" class="node">
<title>tp_layer2_expert5_down</title>
<polygon fill="lightcoral" stroke="black" points="7526.26,-3093.5 7032.26,-3093.5 7032.26,-3025.5 7526.26,-3025.5 7526.26,-3093.5"/>
<text text-anchor="middle" x="7279.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 5 Down</text>
<text text-anchor="middle" x="7279.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7279.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7279.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer2_expert5_activation&#45;&gt;tp_layer2_expert5_down -->
<g id="edge475" class="edge">
<title>tp_layer2_expert5_activation&#45;&gt;tp_layer2_expert5_down</title>
<path fill="none" stroke="black" d="M7279.26,-3179.32C7279.26,-3179.32 7279.26,-3103.58 7279.26,-3103.58"/>
<polygon fill="black" stroke="black" points="7282.76,-3103.58 7279.26,-3093.58 7275.76,-3103.58 7282.76,-3103.58"/>
</g>
<!-- tp_layer2_expert5_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge511" class="edge">
<title>tp_layer2_expert5_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M7291.01,-3025.25C7291.01,-2982.52 7291.01,-2915 7291.01,-2915 7291.01,-2915 8648.66,-2915 8648.66,-2915"/>
<polygon fill="black" stroke="black" points="8648.66,-2918.5 8658.66,-2915 8648.66,-2911.5 8648.66,-2918.5"/>
</g>
<!-- tp_layer2_expert6_activation -->
<g id="node374" class="node">
<title>tp_layer2_expert6_activation</title>
<polygon fill="lightyellow" stroke="black" points="8090.26,-3247.5 7584.26,-3247.5 7584.26,-3179.5 8090.26,-3179.5 8090.26,-3247.5"/>
<text text-anchor="middle" x="7837.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="7837.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7837.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7837.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_expert6_up&#45;&gt;tp_layer2_expert6_activation -->
<g id="edge477" class="edge">
<title>tp_layer2_expert6_up&#45;&gt;tp_layer2_expert6_activation</title>
<path fill="none" stroke="black" d="M7837.26,-3333.32C7837.26,-3333.32 7837.26,-3257.58 7837.26,-3257.58"/>
<polygon fill="black" stroke="black" points="7840.76,-3257.58 7837.26,-3247.58 7833.76,-3257.58 7840.76,-3257.58"/>
</g>
<!-- tp_layer2_expert6_down -->
<g id="node375" class="node">
<title>tp_layer2_expert6_down</title>
<polygon fill="lightcoral" stroke="black" points="8090.26,-3093.5 7596.26,-3093.5 7596.26,-3025.5 8090.26,-3025.5 8090.26,-3093.5"/>
<text text-anchor="middle" x="7843.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 6 Down</text>
<text text-anchor="middle" x="7843.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7843.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7843.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_expert6_activation&#45;&gt;tp_layer2_expert6_down -->
<g id="edge478" class="edge">
<title>tp_layer2_expert6_activation&#45;&gt;tp_layer2_expert6_down</title>
<path fill="none" stroke="black" d="M7843.26,-3179.32C7843.26,-3179.32 7843.26,-3103.58 7843.26,-3103.58"/>
<polygon fill="black" stroke="black" points="7846.76,-3103.58 7843.26,-3093.58 7839.76,-3103.58 7846.76,-3103.58"/>
</g>
<!-- tp_layer2_expert6_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge512" class="edge">
<title>tp_layer2_expert6_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M7853.51,-3025.38C7853.51,-2986.12 7853.51,-2927 7853.51,-2927 7853.51,-2927 8718.81,-2927 8718.81,-2927"/>
<polygon fill="black" stroke="black" points="8718.81,-2930.5 8728.81,-2927 8718.81,-2923.5 8718.81,-2930.5"/>
</g>
<!-- tp_layer2_expert7_activation -->
<g id="node377" class="node">
<title>tp_layer2_expert7_activation</title>
<polygon fill="lightyellow" stroke="black" points="8654.26,-3247.5 8148.26,-3247.5 8148.26,-3179.5 8654.26,-3179.5 8654.26,-3247.5"/>
<text text-anchor="middle" x="8401.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="8401.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8401.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8401.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_expert7_up&#45;&gt;tp_layer2_expert7_activation -->
<g id="edge480" class="edge">
<title>tp_layer2_expert7_up&#45;&gt;tp_layer2_expert7_activation</title>
<path fill="none" stroke="black" d="M8401.26,-3333.32C8401.26,-3333.32 8401.26,-3257.58 8401.26,-3257.58"/>
<polygon fill="black" stroke="black" points="8404.76,-3257.58 8401.26,-3247.58 8397.76,-3257.58 8404.76,-3257.58"/>
</g>
<!-- tp_layer2_expert7_down -->
<g id="node378" class="node">
<title>tp_layer2_expert7_down</title>
<polygon fill="lightcoral" stroke="black" points="8654.26,-3093.5 8160.26,-3093.5 8160.26,-3025.5 8654.26,-3025.5 8654.26,-3093.5"/>
<text text-anchor="middle" x="8407.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 7 Down</text>
<text text-anchor="middle" x="8407.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8407.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8407.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer2_expert7_activation&#45;&gt;tp_layer2_expert7_down -->
<g id="edge481" class="edge">
<title>tp_layer2_expert7_activation&#45;&gt;tp_layer2_expert7_down</title>
<path fill="none" stroke="black" d="M8407.26,-3179.32C8407.26,-3179.32 8407.26,-3103.58 8407.26,-3103.58"/>
<polygon fill="black" stroke="black" points="8410.76,-3103.58 8407.26,-3093.58 8403.76,-3103.58 8410.76,-3103.58"/>
</g>
<!-- tp_layer2_expert7_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge513" class="edge">
<title>tp_layer2_expert7_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M8634.04,-3025.48C8634.04,-3025.48 8634.04,-2917.57 8634.04,-2917.57"/>
<polygon fill="black" stroke="black" points="8637.54,-2917.57 8634.04,-2907.57 8630.54,-2917.57 8637.54,-2917.57"/>
</g>
<!-- tp_layer2_expert8_activation -->
<g id="node380" class="node">
<title>tp_layer2_expert8_activation</title>
<polygon fill="lightyellow" stroke="black" points="9218.26,-3247.5 8712.26,-3247.5 8712.26,-3179.5 9218.26,-3179.5 9218.26,-3247.5"/>
<text text-anchor="middle" x="8965.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="8965.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8965.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8965.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_expert8_up&#45;&gt;tp_layer2_expert8_activation -->
<g id="edge483" class="edge">
<title>tp_layer2_expert8_up&#45;&gt;tp_layer2_expert8_activation</title>
<path fill="none" stroke="black" d="M8965.26,-3333.32C8965.26,-3333.32 8965.26,-3257.58 8965.26,-3257.58"/>
<polygon fill="black" stroke="black" points="8968.76,-3257.58 8965.26,-3247.58 8961.76,-3257.58 8968.76,-3257.58"/>
</g>
<!-- tp_layer2_expert8_down -->
<g id="node381" class="node">
<title>tp_layer2_expert8_down</title>
<polygon fill="lightcoral" stroke="black" points="9212.26,-3093.5 8718.26,-3093.5 8718.26,-3025.5 9212.26,-3025.5 9212.26,-3093.5"/>
<text text-anchor="middle" x="8965.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 8 Down</text>
<text text-anchor="middle" x="8965.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8965.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8965.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_expert8_activation&#45;&gt;tp_layer2_expert8_down -->
<g id="edge484" class="edge">
<title>tp_layer2_expert8_activation&#45;&gt;tp_layer2_expert8_down</title>
<path fill="none" stroke="black" d="M8965.26,-3179.32C8965.26,-3179.32 8965.26,-3103.58 8965.26,-3103.58"/>
<polygon fill="black" stroke="black" points="8968.76,-3103.58 8965.26,-3093.58 8961.76,-3103.58 8968.76,-3103.58"/>
</g>
<!-- tp_layer2_expert8_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge514" class="edge">
<title>tp_layer2_expert8_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M8965.26,-3025.48C8965.26,-3025.48 8965.26,-2949.71 8965.26,-2949.71"/>
<polygon fill="black" stroke="black" points="8968.76,-2949.71 8965.26,-2939.71 8961.76,-2949.71 8968.76,-2949.71"/>
</g>
<!-- tp_layer2_expert9_activation -->
<g id="node383" class="node">
<title>tp_layer2_expert9_activation</title>
<polygon fill="lightyellow" stroke="black" points="9782.26,-3247.5 9276.26,-3247.5 9276.26,-3179.5 9782.26,-3179.5 9782.26,-3247.5"/>
<text text-anchor="middle" x="9529.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="9529.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9529.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9529.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_expert9_up&#45;&gt;tp_layer2_expert9_activation -->
<g id="edge486" class="edge">
<title>tp_layer2_expert9_up&#45;&gt;tp_layer2_expert9_activation</title>
<path fill="none" stroke="black" d="M9529.26,-3333.32C9529.26,-3333.32 9529.26,-3257.58 9529.26,-3257.58"/>
<polygon fill="black" stroke="black" points="9532.76,-3257.58 9529.26,-3247.58 9525.76,-3257.58 9532.76,-3257.58"/>
</g>
<!-- tp_layer2_expert9_down -->
<g id="node384" class="node">
<title>tp_layer2_expert9_down</title>
<polygon fill="lightcoral" stroke="black" points="9770.26,-3093.5 9276.26,-3093.5 9276.26,-3025.5 9770.26,-3025.5 9770.26,-3093.5"/>
<text text-anchor="middle" x="9523.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 9 Down</text>
<text text-anchor="middle" x="9523.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9523.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9523.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer2_expert9_activation&#45;&gt;tp_layer2_expert9_down -->
<g id="edge487" class="edge">
<title>tp_layer2_expert9_activation&#45;&gt;tp_layer2_expert9_down</title>
<path fill="none" stroke="black" d="M9523.26,-3179.32C9523.26,-3179.32 9523.26,-3103.58 9523.26,-3103.58"/>
<polygon fill="black" stroke="black" points="9526.76,-3103.58 9523.26,-3093.58 9519.76,-3103.58 9526.76,-3103.58"/>
</g>
<!-- tp_layer2_expert9_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge515" class="edge">
<title>tp_layer2_expert9_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M9296.48,-3025.48C9296.48,-3025.48 9296.48,-2917.57 9296.48,-2917.57"/>
<polygon fill="black" stroke="black" points="9299.98,-2917.57 9296.48,-2907.57 9292.98,-2917.57 9299.98,-2917.57"/>
</g>
<!-- tp_layer2_expert10_activation -->
<g id="node386" class="node">
<title>tp_layer2_expert10_activation</title>
<polygon fill="lightyellow" stroke="black" points="10346.26,-3247.5 9840.26,-3247.5 9840.26,-3179.5 10346.26,-3179.5 10346.26,-3247.5"/>
<text text-anchor="middle" x="10093.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="10093.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10093.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10093.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_expert10_up&#45;&gt;tp_layer2_expert10_activation -->
<g id="edge489" class="edge">
<title>tp_layer2_expert10_up&#45;&gt;tp_layer2_expert10_activation</title>
<path fill="none" stroke="black" d="M10093.26,-3333.32C10093.26,-3333.32 10093.26,-3257.58 10093.26,-3257.58"/>
<polygon fill="black" stroke="black" points="10096.76,-3257.58 10093.26,-3247.58 10089.76,-3257.58 10096.76,-3257.58"/>
</g>
<!-- tp_layer2_expert10_down -->
<g id="node387" class="node">
<title>tp_layer2_expert10_down</title>
<polygon fill="lightcoral" stroke="black" points="10334.26,-3093.5 9840.26,-3093.5 9840.26,-3025.5 10334.26,-3025.5 10334.26,-3093.5"/>
<text text-anchor="middle" x="10087.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 10 Down</text>
<text text-anchor="middle" x="10087.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10087.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="10087.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_expert10_activation&#45;&gt;tp_layer2_expert10_down -->
<g id="edge490" class="edge">
<title>tp_layer2_expert10_activation&#45;&gt;tp_layer2_expert10_down</title>
<path fill="none" stroke="black" d="M10087.26,-3179.32C10087.26,-3179.32 10087.26,-3103.58 10087.26,-3103.58"/>
<polygon fill="black" stroke="black" points="10090.76,-3103.58 10087.26,-3093.58 10083.76,-3103.58 10090.76,-3103.58"/>
</g>
<!-- tp_layer2_expert10_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge516" class="edge">
<title>tp_layer2_expert10_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M9845.51,-3025.21C9845.51,-2985.36 9845.51,-2925 9845.51,-2925 9845.51,-2925 9226.92,-2925 9226.92,-2925"/>
<polygon fill="black" stroke="black" points="9226.92,-2921.5 9216.92,-2925 9226.92,-2928.5 9226.92,-2921.5"/>
</g>
<!-- tp_layer2_expert11_activation -->
<g id="node389" class="node">
<title>tp_layer2_expert11_activation</title>
<polygon fill="lightyellow" stroke="black" points="10910.26,-3247.5 10404.26,-3247.5 10404.26,-3179.5 10910.26,-3179.5 10910.26,-3247.5"/>
<text text-anchor="middle" x="10657.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="10657.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10657.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10657.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_expert11_up&#45;&gt;tp_layer2_expert11_activation -->
<g id="edge492" class="edge">
<title>tp_layer2_expert11_up&#45;&gt;tp_layer2_expert11_activation</title>
<path fill="none" stroke="black" d="M10657.26,-3333.32C10657.26,-3333.32 10657.26,-3257.58 10657.26,-3257.58"/>
<polygon fill="black" stroke="black" points="10660.76,-3257.58 10657.26,-3247.58 10653.76,-3257.58 10660.76,-3257.58"/>
</g>
<!-- tp_layer2_expert11_down -->
<g id="node390" class="node">
<title>tp_layer2_expert11_down</title>
<polygon fill="lightcoral" stroke="black" points="10895.26,-3093.5 10401.26,-3093.5 10401.26,-3025.5 10895.26,-3025.5 10895.26,-3093.5"/>
<text text-anchor="middle" x="10648.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 11 Down</text>
<text text-anchor="middle" x="10648.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10648.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="10648.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer2_expert11_activation&#45;&gt;tp_layer2_expert11_down -->
<g id="edge493" class="edge">
<title>tp_layer2_expert11_activation&#45;&gt;tp_layer2_expert11_down</title>
<path fill="none" stroke="black" d="M10649.76,-3179.32C10649.76,-3179.32 10649.76,-3103.58 10649.76,-3103.58"/>
<polygon fill="black" stroke="black" points="10653.26,-3103.58 10649.76,-3093.58 10646.26,-3103.58 10653.26,-3103.58"/>
</g>
<!-- tp_layer2_expert11_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge517" class="edge">
<title>tp_layer2_expert11_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M10405.51,-3025.29C10405.51,-2981.72 10405.51,-2912 10405.51,-2912 10405.51,-2912 9293.11,-2912 9293.11,-2912"/>
<polygon fill="black" stroke="black" points="9293.11,-2908.5 9283.11,-2912 9293.11,-2915.5 9293.11,-2908.5"/>
</g>
<!-- tp_layer2_expert12_activation -->
<g id="node392" class="node">
<title>tp_layer2_expert12_activation</title>
<polygon fill="lightyellow" stroke="black" points="11474.26,-3247.5 10968.26,-3247.5 10968.26,-3179.5 11474.26,-3179.5 11474.26,-3247.5"/>
<text text-anchor="middle" x="11221.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="11221.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11221.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11221.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_expert12_up&#45;&gt;tp_layer2_expert12_activation -->
<g id="edge495" class="edge">
<title>tp_layer2_expert12_up&#45;&gt;tp_layer2_expert12_activation</title>
<path fill="none" stroke="black" d="M11221.26,-3333.32C11221.26,-3333.32 11221.26,-3257.58 11221.26,-3257.58"/>
<polygon fill="black" stroke="black" points="11224.76,-3257.58 11221.26,-3247.58 11217.76,-3257.58 11224.76,-3257.58"/>
</g>
<!-- tp_layer2_expert12_down -->
<g id="node393" class="node">
<title>tp_layer2_expert12_down</title>
<polygon fill="lightcoral" stroke="black" points="11458.26,-3093.5 10964.26,-3093.5 10964.26,-3025.5 11458.26,-3025.5 11458.26,-3093.5"/>
<text text-anchor="middle" x="11211.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 12 Down</text>
<text text-anchor="middle" x="11211.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11211.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="11211.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_expert12_activation&#45;&gt;tp_layer2_expert12_down -->
<g id="edge496" class="edge">
<title>tp_layer2_expert12_activation&#45;&gt;tp_layer2_expert12_down</title>
<path fill="none" stroke="black" d="M11213.26,-3179.32C11213.26,-3179.32 11213.26,-3103.58 11213.26,-3103.58"/>
<polygon fill="black" stroke="black" points="11216.76,-3103.58 11213.26,-3093.58 11209.76,-3103.58 11216.76,-3103.58"/>
</g>
<!-- tp_layer2_expert12_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge518" class="edge">
<title>tp_layer2_expert12_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M11211.26,-3025.25C11211.26,-2977.84 11211.26,-2898 11211.26,-2898 11211.26,-2898 9323.43,-2898 9323.43,-2898"/>
<polygon fill="black" stroke="black" points="9323.43,-2894.5 9313.43,-2898 9323.43,-2901.5 9323.43,-2894.5"/>
</g>
<!-- tp_layer2_expert13_activation -->
<g id="node395" class="node">
<title>tp_layer2_expert13_activation</title>
<polygon fill="lightyellow" stroke="black" points="12038.26,-3247.5 11532.26,-3247.5 11532.26,-3179.5 12038.26,-3179.5 12038.26,-3247.5"/>
<text text-anchor="middle" x="11785.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="11785.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11785.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11785.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_expert13_up&#45;&gt;tp_layer2_expert13_activation -->
<g id="edge498" class="edge">
<title>tp_layer2_expert13_up&#45;&gt;tp_layer2_expert13_activation</title>
<path fill="none" stroke="black" d="M11785.26,-3333.32C11785.26,-3333.32 11785.26,-3257.58 11785.26,-3257.58"/>
<polygon fill="black" stroke="black" points="11788.76,-3257.58 11785.26,-3247.58 11781.76,-3257.58 11788.76,-3257.58"/>
</g>
<!-- tp_layer2_expert13_down -->
<g id="node396" class="node">
<title>tp_layer2_expert13_down</title>
<polygon fill="lightcoral" stroke="black" points="12021.26,-3093.5 11527.26,-3093.5 11527.26,-3025.5 12021.26,-3025.5 12021.26,-3093.5"/>
<text text-anchor="middle" x="11774.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 13 Down</text>
<text text-anchor="middle" x="11774.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11774.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="11774.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer2_expert13_activation&#45;&gt;tp_layer2_expert13_down -->
<g id="edge499" class="edge">
<title>tp_layer2_expert13_activation&#45;&gt;tp_layer2_expert13_down</title>
<path fill="none" stroke="black" d="M11776.76,-3179.32C11776.76,-3179.32 11776.76,-3103.58 11776.76,-3103.58"/>
<polygon fill="black" stroke="black" points="11780.26,-3103.58 11776.76,-3093.58 11773.26,-3103.58 11780.26,-3103.58"/>
</g>
<!-- tp_layer2_expert13_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge519" class="edge">
<title>tp_layer2_expert13_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M11641.41,-3025.24C11641.41,-2974.17 11641.41,-2884 11641.41,-2884 11641.41,-2884 9322.72,-2884 9322.72,-2884"/>
<polygon fill="black" stroke="black" points="9322.72,-2880.5 9312.72,-2884 9322.72,-2887.5 9322.72,-2880.5"/>
</g>
<!-- tp_layer2_expert14_activation -->
<g id="node398" class="node">
<title>tp_layer2_expert14_activation</title>
<polygon fill="lightyellow" stroke="black" points="12602.26,-3247.5 12096.26,-3247.5 12096.26,-3179.5 12602.26,-3179.5 12602.26,-3247.5"/>
<text text-anchor="middle" x="12349.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="12349.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12349.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12349.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_expert14_up&#45;&gt;tp_layer2_expert14_activation -->
<g id="edge501" class="edge">
<title>tp_layer2_expert14_up&#45;&gt;tp_layer2_expert14_activation</title>
<path fill="none" stroke="black" d="M12349.26,-3333.32C12349.26,-3333.32 12349.26,-3257.58 12349.26,-3257.58"/>
<polygon fill="black" stroke="black" points="12352.76,-3257.58 12349.26,-3247.58 12345.76,-3257.58 12352.76,-3257.58"/>
</g>
<!-- tp_layer2_expert14_down -->
<g id="node399" class="node">
<title>tp_layer2_expert14_down</title>
<polygon fill="lightcoral" stroke="black" points="12585.26,-3093.5 12091.26,-3093.5 12091.26,-3025.5 12585.26,-3025.5 12585.26,-3093.5"/>
<text text-anchor="middle" x="12338.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 14 Down</text>
<text text-anchor="middle" x="12338.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12338.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="12338.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_expert14_activation&#45;&gt;tp_layer2_expert14_down -->
<g id="edge502" class="edge">
<title>tp_layer2_expert14_activation&#45;&gt;tp_layer2_expert14_down</title>
<path fill="none" stroke="black" d="M12340.76,-3179.32C12340.76,-3179.32 12340.76,-3103.58 12340.76,-3103.58"/>
<polygon fill="black" stroke="black" points="12344.26,-3103.58 12340.76,-3093.58 12337.26,-3103.58 12344.26,-3103.58"/>
</g>
<!-- tp_layer2_expert14_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge520" class="edge">
<title>tp_layer2_expert14_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M12420.59,-3025.18C12420.59,-2970.57 12420.59,-2870 12420.59,-2870 12420.59,-2870 9290.29,-2870 9290.29,-2870"/>
<polygon fill="black" stroke="black" points="9290.29,-2866.5 9280.29,-2870 9290.29,-2873.5 9290.29,-2866.5"/>
</g>
<!-- tp_layer2_expert15_activation -->
<g id="node401" class="node">
<title>tp_layer2_expert15_activation</title>
<polygon fill="lightyellow" stroke="black" points="13166.26,-3247.5 12660.26,-3247.5 12660.26,-3179.5 13166.26,-3179.5 13166.26,-3247.5"/>
<text text-anchor="middle" x="12913.26" y="-3232.3" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="12913.26" y="-3217.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12913.26" y="-3202.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12913.26" y="-3187.3" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_expert15_up&#45;&gt;tp_layer2_expert15_activation -->
<g id="edge504" class="edge">
<title>tp_layer2_expert15_up&#45;&gt;tp_layer2_expert15_activation</title>
<path fill="none" stroke="black" d="M12913.26,-3333.32C12913.26,-3333.32 12913.26,-3257.58 12913.26,-3257.58"/>
<polygon fill="black" stroke="black" points="12916.76,-3257.58 12913.26,-3247.58 12909.76,-3257.58 12916.76,-3257.58"/>
</g>
<!-- tp_layer2_expert15_down -->
<g id="node402" class="node">
<title>tp_layer2_expert15_down</title>
<polygon fill="lightcoral" stroke="black" points="13149.26,-3093.5 12655.26,-3093.5 12655.26,-3025.5 13149.26,-3025.5 13149.26,-3093.5"/>
<text text-anchor="middle" x="12902.26" y="-3078.3" font-family="Times,serif" font-size="14.00">Expert 15 Down</text>
<text text-anchor="middle" x="12902.26" y="-3063.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12902.26" y="-3048.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="12902.26" y="-3033.3" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer2_expert15_activation&#45;&gt;tp_layer2_expert15_down -->
<g id="edge505" class="edge">
<title>tp_layer2_expert15_activation&#45;&gt;tp_layer2_expert15_down</title>
<path fill="none" stroke="black" d="M12904.76,-3179.32C12904.76,-3179.32 12904.76,-3103.58 12904.76,-3103.58"/>
<polygon fill="black" stroke="black" points="12908.26,-3103.58 12904.76,-3093.58 12901.26,-3103.58 12908.26,-3103.58"/>
</g>
<!-- tp_layer2_expert15_down&#45;&gt;tp_layer2_moe_all_reduce -->
<g id="edge521" class="edge">
<title>tp_layer2_expert15_down&#45;&gt;tp_layer2_moe_all_reduce</title>
<path fill="none" stroke="black" d="M12901.01,-3025.15C12901.01,-2967.37 12901.01,-2857 12901.01,-2857 12901.01,-2857 9220.72,-2857 9220.72,-2857"/>
<polygon fill="black" stroke="black" points="9220.72,-2853.5 9210.72,-2857 9220.72,-2860.5 9220.72,-2853.5"/>
</g>
<!-- tp_layer2_moe_all_reduce&#45;&gt;tp_layer2_final_residual -->
<g id="edge523" class="edge">
<title>tp_layer2_moe_all_reduce&#45;&gt;tp_layer2_final_residual</title>
<path fill="none" stroke="black" d="M9300.07,-2876.65C9300.07,-2835.92 9300.07,-2725 9300.07,-2725 9300.07,-2725 10488.33,-2725 10488.33,-2725"/>
<polygon fill="black" stroke="black" points="10488.33,-2728.5 10498.33,-2725 10488.33,-2721.5 10488.33,-2728.5"/>
</g>
<!-- tp_layer3_norm -->
<g id="node405" class="node">
<title>tp_layer3_norm</title>
<polygon fill="lightyellow" stroke="black" points="8113.76,-2575.17 7616.76,-2575.17 7616.76,-2507.17 8113.76,-2507.17 8113.76,-2575.17"/>
<text text-anchor="middle" x="7865.26" y="-2559.97" font-family="Times,serif" font-size="14.00">Layer Norm</text>
<text text-anchor="middle" x="7865.26" y="-2544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7865.26" y="-2529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7865.26" y="-2514.97" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer2_final_residual&#45;&gt;tp_layer3_norm -->
<g id="edge524" class="edge">
<title>tp_layer2_final_residual&#45;&gt;tp_layer3_norm</title>
<path fill="none" stroke="black" d="M10500.7,-2693C9621.97,-2693 8102.01,-2693 8102.01,-2693 8102.01,-2693 8102.01,-2585.24 8102.01,-2585.24"/>
<polygon fill="black" stroke="black" points="8105.51,-2585.24 8102.01,-2575.24 8098.51,-2585.24 8105.51,-2585.24"/>
</g>
<!-- tp_layer3_attn_residual -->
<g id="node487" class="node">
<title>tp_layer3_attn_residual</title>
<ellipse fill="lightblue" stroke="black" cx="11533.26" cy="-1182.42" rx="646.09" ry="48.17"/>
<text text-anchor="middle" x="11533.26" y="-1201.22" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="11533.26" y="-1186.22" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096], [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11533.26" y="-1171.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11533.26" y="-1156.22" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer2_final_residual&#45;&gt;tp_layer3_attn_residual -->
<g id="edge629" class="edge">
<title>tp_layer2_final_residual&#45;&gt;tp_layer3_attn_residual</title>
<path fill="none" stroke="black" d="M11493.38,-2670.14C11493.38,-2539.59 11493.38,-2127 11493.38,-2127 11493.38,-2127 11747.88,-2127 11747.88,-2127 11747.88,-2127 11747.88,-1237.98 11747.88,-1237.98"/>
<polygon fill="black" stroke="black" points="11751.38,-1237.98 11747.88,-1227.98 11744.38,-1237.98 11751.38,-1237.98"/>
</g>
<!-- tp_layer3_q_proj_gpu0 -->
<g id="node406" class="node">
<title>tp_layer3_q_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="1395.76,-2421.17 894.76,-2421.17 894.76,-2353.17 1395.76,-2353.17 1395.76,-2421.17"/>
<text text-anchor="middle" x="1145.26" y="-2405.97" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="1145.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="1145.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1145.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu0 -->
<g id="edge525" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu0</title>
<path fill="none" stroke="black" d="M7616.71,-2569C6416.92,-2569 1281.76,-2569 1281.76,-2569 1281.76,-2569 1281.76,-2431.37 1281.76,-2431.37"/>
<polygon fill="black" stroke="black" points="1285.26,-2431.37 1281.76,-2421.37 1278.26,-2431.37 1285.26,-2431.37"/>
</g>
<!-- tp_layer3_k_proj_gpu0 -->
<g id="node407" class="node">
<title>tp_layer3_k_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="1966.76,-2421.17 1465.76,-2421.17 1465.76,-2353.17 1966.76,-2353.17 1966.76,-2421.17"/>
<text text-anchor="middle" x="1716.26" y="-2405.97" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="1716.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="1716.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1716.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu0 -->
<g id="edge526" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu0</title>
<path fill="none" stroke="black" d="M7616.53,-2564C6488.89,-2564 1911.26,-2564 1911.26,-2564 1911.26,-2564 1911.26,-2431.26 1911.26,-2431.26"/>
<polygon fill="black" stroke="black" points="1914.76,-2431.26 1911.26,-2421.26 1907.76,-2431.26 1914.76,-2431.26"/>
</g>
<!-- tp_layer3_v_proj_gpu0 -->
<g id="node408" class="node">
<title>tp_layer3_v_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="2525.76,-2421.17 2024.76,-2421.17 2024.76,-2353.17 2525.76,-2353.17 2525.76,-2421.17"/>
<text text-anchor="middle" x="2275.26" y="-2405.97" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="2275.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="2275.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2275.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu0 -->
<g id="edge527" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu0</title>
<path fill="none" stroke="black" d="M7616.34,-2559C6559.69,-2559 2499.64,-2559 2499.64,-2559 2499.64,-2559 2499.64,-2431.53 2499.64,-2431.53"/>
<polygon fill="black" stroke="black" points="2503.14,-2431.53 2499.64,-2421.53 2496.14,-2431.53 2503.14,-2431.53"/>
</g>
<!-- tp_layer3_q_proj_gpu1 -->
<g id="node416" class="node">
<title>tp_layer3_q_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="3084.76,-2421.17 2583.76,-2421.17 2583.76,-2353.17 3084.76,-2353.17 3084.76,-2421.17"/>
<text text-anchor="middle" x="2834.26" y="-2405.97" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="2834.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="2834.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2834.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu1 -->
<g id="edge537" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu1</title>
<path fill="none" stroke="black" d="M7616.7,-2554C6625.02,-2554 3004.76,-2554 3004.76,-2554 3004.76,-2554 3004.76,-2431.33 3004.76,-2431.33"/>
<polygon fill="black" stroke="black" points="3008.26,-2431.33 3004.76,-2421.33 3001.26,-2431.33 3008.26,-2431.33"/>
</g>
<!-- tp_layer3_k_proj_gpu1 -->
<g id="node417" class="node">
<title>tp_layer3_k_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="3643.76,-2421.17 3142.76,-2421.17 3142.76,-2353.17 3643.76,-2353.17 3643.76,-2421.17"/>
<text text-anchor="middle" x="3393.26" y="-2405.97" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="3393.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="3393.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3393.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu1 -->
<g id="edge538" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu1</title>
<path fill="none" stroke="black" d="M7616.54,-2549C6710.13,-2549 3636.76,-2549 3636.76,-2549 3636.76,-2549 3636.76,-2431.49 3636.76,-2431.49"/>
<polygon fill="black" stroke="black" points="3640.26,-2431.49 3636.76,-2421.49 3633.26,-2431.49 3640.26,-2431.49"/>
</g>
<!-- tp_layer3_v_proj_gpu1 -->
<g id="node418" class="node">
<title>tp_layer3_v_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="4202.76,-2421.17 3701.76,-2421.17 3701.76,-2353.17 4202.76,-2353.17 4202.76,-2421.17"/>
<text text-anchor="middle" x="3952.26" y="-2405.97" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="3952.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="3952.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3952.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu1 -->
<g id="edge539" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu1</title>
<path fill="none" stroke="black" d="M7616.56,-2543C6788.75,-2543 4178.51,-2543 4178.51,-2543 4178.51,-2543 4178.51,-2431.36 4178.51,-2431.36"/>
<polygon fill="black" stroke="black" points="4182.01,-2431.36 4178.51,-2421.36 4175.01,-2431.36 4182.01,-2431.36"/>
</g>
<!-- tp_layer3_q_proj_gpu2 -->
<g id="node426" class="node">
<title>tp_layer3_q_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="4761.76,-2421.17 4260.76,-2421.17 4260.76,-2353.17 4761.76,-2353.17 4761.76,-2421.17"/>
<text text-anchor="middle" x="4511.26" y="-2405.97" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="4511.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4511.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4511.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu2 -->
<g id="edge549" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu2</title>
<path fill="none" stroke="black" d="M7616.52,-2538C6876.02,-2538 4737.01,-2538 4737.01,-2538 4737.01,-2538 4737.01,-2431.39 4737.01,-2431.39"/>
<polygon fill="black" stroke="black" points="4740.51,-2431.39 4737.01,-2421.39 4733.51,-2431.39 4740.51,-2431.39"/>
</g>
<!-- tp_layer3_k_proj_gpu2 -->
<g id="node427" class="node">
<title>tp_layer3_k_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="5320.76,-2421.17 4819.76,-2421.17 4819.76,-2353.17 5320.76,-2353.17 5320.76,-2421.17"/>
<text text-anchor="middle" x="5070.26" y="-2405.97" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="5070.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5070.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5070.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu2 -->
<g id="edge550" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu2</title>
<path fill="none" stroke="black" d="M7616.53,-2533C6972.16,-2533 5298.51,-2533 5298.51,-2533 5298.51,-2533 5298.51,-2431.36 5298.51,-2431.36"/>
<polygon fill="black" stroke="black" points="5302.01,-2431.36 5298.51,-2421.36 5295.01,-2431.36 5302.01,-2431.36"/>
</g>
<!-- tp_layer3_v_proj_gpu2 -->
<g id="node428" class="node">
<title>tp_layer3_v_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="5879.76,-2421.17 5378.76,-2421.17 5378.76,-2353.17 5879.76,-2353.17 5879.76,-2421.17"/>
<text text-anchor="middle" x="5629.26" y="-2405.97" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="5629.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5629.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5629.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu2 -->
<g id="edge551" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu2</title>
<path fill="none" stroke="black" d="M7616.74,-2528C7079.3,-2528 5857.01,-2528 5857.01,-2528 5857.01,-2528 5857.01,-2431.26 5857.01,-2431.26"/>
<polygon fill="black" stroke="black" points="5860.51,-2431.26 5857.01,-2421.26 5853.51,-2431.26 5860.51,-2431.26"/>
</g>
<!-- tp_layer3_q_proj_gpu3 -->
<g id="node436" class="node">
<title>tp_layer3_q_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="6438.76,-2421.17 5937.76,-2421.17 5937.76,-2353.17 6438.76,-2353.17 6438.76,-2421.17"/>
<text text-anchor="middle" x="6188.26" y="-2405.97" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="6188.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6188.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6188.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu3 -->
<g id="edge561" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu3</title>
<path fill="none" stroke="black" d="M7616.57,-2522C7204.68,-2522 6425.76,-2522 6425.76,-2522 6425.76,-2522 6425.76,-2431.19 6425.76,-2431.19"/>
<polygon fill="black" stroke="black" points="6429.26,-2431.19 6425.76,-2421.19 6422.26,-2431.19 6429.26,-2431.19"/>
</g>
<!-- tp_layer3_k_proj_gpu3 -->
<g id="node437" class="node">
<title>tp_layer3_k_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="6997.76,-2421.17 6496.76,-2421.17 6496.76,-2353.17 6997.76,-2353.17 6997.76,-2421.17"/>
<text text-anchor="middle" x="6747.26" y="-2405.97" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="6747.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6747.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6747.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu3 -->
<g id="edge562" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu3</title>
<path fill="none" stroke="black" d="M7616.61,-2517C7354.76,-2517 6980.01,-2517 6980.01,-2517 6980.01,-2517 6980.01,-2431.28 6980.01,-2431.28"/>
<polygon fill="black" stroke="black" points="6983.51,-2431.28 6980.01,-2421.28 6976.51,-2431.28 6983.51,-2431.28"/>
</g>
<!-- tp_layer3_v_proj_gpu3 -->
<g id="node438" class="node">
<title>tp_layer3_v_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="7556.76,-2421.17 7055.76,-2421.17 7055.76,-2353.17 7556.76,-2353.17 7556.76,-2421.17"/>
<text text-anchor="middle" x="7306.26" y="-2405.97" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="7306.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7306.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7306.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu3 -->
<g id="edge563" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu3</title>
<path fill="none" stroke="black" d="M7616.6,-2512C7573.13,-2512 7541.51,-2512 7541.51,-2512 7541.51,-2512 7541.51,-2431.28 7541.51,-2431.28"/>
<polygon fill="black" stroke="black" points="7545.01,-2431.28 7541.51,-2421.28 7538.01,-2431.28 7545.01,-2431.28"/>
</g>
<!-- tp_layer3_q_proj_gpu4 -->
<g id="node446" class="node">
<title>tp_layer3_q_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="8115.76,-2421.17 7614.76,-2421.17 7614.76,-2353.17 8115.76,-2353.17 8115.76,-2421.17"/>
<text text-anchor="middle" x="7865.26" y="-2405.97" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="7865.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7865.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7865.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu4 -->
<g id="edge573" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu4</title>
<path fill="none" stroke="black" d="M7865.26,-2506.99C7865.26,-2506.99 7865.26,-2431.25 7865.26,-2431.25"/>
<polygon fill="black" stroke="black" points="7868.76,-2431.25 7865.26,-2421.25 7861.76,-2431.25 7868.76,-2431.25"/>
</g>
<!-- tp_layer3_k_proj_gpu4 -->
<g id="node447" class="node">
<title>tp_layer3_k_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="8674.76,-2421.17 8173.76,-2421.17 8173.76,-2353.17 8674.76,-2353.17 8674.76,-2421.17"/>
<text text-anchor="middle" x="8424.26" y="-2405.97" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="8424.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8424.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8424.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu4 -->
<g id="edge574" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu4</title>
<path fill="none" stroke="black" d="M8114.05,-2512C8251.14,-2512 8393.79,-2512 8393.79,-2512 8393.79,-2512 8393.79,-2431.28 8393.79,-2431.28"/>
<polygon fill="black" stroke="black" points="8397.29,-2431.28 8393.79,-2421.28 8390.29,-2431.28 8397.29,-2431.28"/>
</g>
<!-- tp_layer3_v_proj_gpu4 -->
<g id="node448" class="node">
<title>tp_layer3_v_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="9233.76,-2421.17 8732.76,-2421.17 8732.76,-2353.17 9233.76,-2353.17 9233.76,-2421.17"/>
<text text-anchor="middle" x="8983.26" y="-2405.97" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="8983.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8983.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8983.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu4 -->
<g id="edge575" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu4</title>
<path fill="none" stroke="black" d="M8114.08,-2518C8443.51,-2518 8983.26,-2518 8983.26,-2518 8983.26,-2518 8983.26,-2431.2 8983.26,-2431.2"/>
<polygon fill="black" stroke="black" points="8986.76,-2431.2 8983.26,-2421.2 8979.76,-2431.2 8986.76,-2431.2"/>
</g>
<!-- tp_layer3_q_proj_gpu5 -->
<g id="node456" class="node">
<title>tp_layer3_q_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="9792.76,-2421.17 9291.76,-2421.17 9291.76,-2353.17 9792.76,-2353.17 9792.76,-2421.17"/>
<text text-anchor="middle" x="9542.26" y="-2405.97" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="9542.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9542.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9542.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu5 -->
<g id="edge585" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu5</title>
<path fill="none" stroke="black" d="M8114.16,-2524C8526.99,-2524 9308.38,-2524 9308.38,-2524 9308.38,-2524 9308.38,-2431.34 9308.38,-2431.34"/>
<polygon fill="black" stroke="black" points="9311.88,-2431.34 9308.38,-2421.34 9304.88,-2431.34 9311.88,-2431.34"/>
</g>
<!-- tp_layer3_k_proj_gpu5 -->
<g id="node457" class="node">
<title>tp_layer3_k_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="10351.76,-2421.17 9850.76,-2421.17 9850.76,-2353.17 10351.76,-2353.17 10351.76,-2421.17"/>
<text text-anchor="middle" x="10101.26" y="-2405.97" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="10101.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10101.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10101.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu5 -->
<g id="edge586" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu5</title>
<path fill="none" stroke="black" d="M8114,-2529C8695.03,-2529 10092.51,-2529 10092.51,-2529 10092.51,-2529 10092.51,-2431.5 10092.51,-2431.5"/>
<polygon fill="black" stroke="black" points="10096.01,-2431.5 10092.51,-2421.5 10089.01,-2431.5 10096.01,-2431.5"/>
</g>
<!-- tp_layer3_v_proj_gpu5 -->
<g id="node458" class="node">
<title>tp_layer3_v_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="10910.76,-2421.17 10409.76,-2421.17 10409.76,-2353.17 10910.76,-2353.17 10910.76,-2421.17"/>
<text text-anchor="middle" x="10660.26" y="-2405.97" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="10660.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10660.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10660.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu5 -->
<g id="edge587" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu5</title>
<path fill="none" stroke="black" d="M8113.83,-2535C8758.87,-2535 10436.36,-2535 10436.36,-2535 10436.36,-2535 10436.36,-2431.45 10436.36,-2431.45"/>
<polygon fill="black" stroke="black" points="10439.86,-2431.45 10436.36,-2421.45 10432.86,-2431.45 10439.86,-2431.45"/>
</g>
<!-- tp_layer3_q_proj_gpu6 -->
<g id="node466" class="node">
<title>tp_layer3_q_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="11469.76,-2421.17 10968.76,-2421.17 10968.76,-2353.17 11469.76,-2353.17 11469.76,-2421.17"/>
<text text-anchor="middle" x="11219.26" y="-2405.97" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="11219.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11219.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11219.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu6 -->
<g id="edge597" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu6</title>
<path fill="none" stroke="black" d="M8113.93,-2541C8890.55,-2541 11219.26,-2541 11219.26,-2541 11219.26,-2541 11219.26,-2431.31 11219.26,-2431.31"/>
<polygon fill="black" stroke="black" points="11222.76,-2431.31 11219.26,-2421.31 11215.76,-2431.31 11222.76,-2431.31"/>
</g>
<!-- tp_layer3_k_proj_gpu6 -->
<g id="node467" class="node">
<title>tp_layer3_k_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="12028.76,-2421.17 11527.76,-2421.17 11527.76,-2353.17 12028.76,-2353.17 12028.76,-2421.17"/>
<text text-anchor="middle" x="11778.26" y="-2405.97" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="11778.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11778.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11778.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu6 -->
<g id="edge598" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu6</title>
<path fill="none" stroke="black" d="M8113.77,-2546C8954.74,-2546 11641.66,-2546 11641.66,-2546 11641.66,-2546 11641.66,-2431.24 11641.66,-2431.24"/>
<polygon fill="black" stroke="black" points="11645.16,-2431.24 11641.66,-2421.24 11638.16,-2431.24 11645.16,-2431.24"/>
</g>
<!-- tp_layer3_v_proj_gpu6 -->
<g id="node468" class="node">
<title>tp_layer3_v_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="12587.76,-2421.17 12086.76,-2421.17 12086.76,-2353.17 12587.76,-2353.17 12587.76,-2421.17"/>
<text text-anchor="middle" x="12337.26" y="-2405.97" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="12337.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12337.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12337.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu6 -->
<g id="edge599" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu6</title>
<path fill="none" stroke="black" d="M8113.9,-2552C9042.72,-2552 12255.93,-2552 12255.93,-2552 12255.93,-2552 12255.93,-2431.32 12255.93,-2431.32"/>
<polygon fill="black" stroke="black" points="12259.43,-2431.32 12255.93,-2421.32 12252.43,-2431.32 12259.43,-2431.32"/>
</g>
<!-- tp_layer3_q_proj_gpu7 -->
<g id="node476" class="node">
<title>tp_layer3_q_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="13146.76,-2421.17 12645.76,-2421.17 12645.76,-2353.17 13146.76,-2353.17 13146.76,-2421.17"/>
<text text-anchor="middle" x="12896.26" y="-2405.97" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="12896.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12896.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12896.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu7 -->
<g id="edge609" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_q_proj_gpu7</title>
<path fill="none" stroke="black" d="M8114.13,-2558C9096.37,-2558 12650.51,-2558 12650.51,-2558 12650.51,-2558 12650.51,-2431.33 12650.51,-2431.33"/>
<polygon fill="black" stroke="black" points="12654.01,-2431.33 12650.51,-2421.33 12647.01,-2431.33 12654.01,-2431.33"/>
</g>
<!-- tp_layer3_k_proj_gpu7 -->
<g id="node477" class="node">
<title>tp_layer3_k_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="13705.76,-2421.17 13204.76,-2421.17 13204.76,-2353.17 13705.76,-2353.17 13705.76,-2421.17"/>
<text text-anchor="middle" x="13455.26" y="-2405.97" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="13455.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="13455.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13455.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu7 -->
<g id="edge610" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_k_proj_gpu7</title>
<path fill="none" stroke="black" d="M8113.99,-2563C9172.19,-2563 13245.88,-2563 13245.88,-2563 13245.88,-2563 13245.88,-2431.49 13245.88,-2431.49"/>
<polygon fill="black" stroke="black" points="13249.38,-2431.49 13245.88,-2421.49 13242.38,-2431.49 13249.38,-2431.49"/>
</g>
<!-- tp_layer3_v_proj_gpu7 -->
<g id="node478" class="node">
<title>tp_layer3_v_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="14264.76,-2421.17 13763.76,-2421.17 13763.76,-2353.17 14264.76,-2353.17 14264.76,-2421.17"/>
<text text-anchor="middle" x="14014.26" y="-2405.97" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="14014.26" y="-2390.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="14014.26" y="-2375.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="14014.26" y="-2360.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu7 -->
<g id="edge611" class="edge">
<title>tp_layer3_norm&#45;&gt;tp_layer3_v_proj_gpu7</title>
<path fill="none" stroke="black" d="M8114.14,-2569C9249.15,-2569 13879.64,-2569 13879.64,-2569 13879.64,-2569 13879.64,-2431.37 13879.64,-2431.37"/>
<polygon fill="black" stroke="black" points="13883.14,-2431.37 13879.64,-2421.37 13876.14,-2431.37 13883.14,-2431.37"/>
</g>
<!-- tp_layer3_gather_q_gpu0 -->
<g id="node411" class="node">
<title>tp_layer3_gather_q_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="1139.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="1139.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="1139.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1139.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1139.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_q_proj_gpu0&#45;&gt;tp_layer3_gather_q_gpu0 -->
<g id="edge528" class="edge">
<title>tp_layer3_q_proj_gpu0&#45;&gt;tp_layer3_gather_q_gpu0</title>
<path fill="none" stroke="black" d="M1145.26,-2353.15C1145.26,-2353.15 1145.26,-2277.38 1145.26,-2277.38"/>
<polygon fill="black" stroke="black" points="1148.76,-2277.38 1145.26,-2267.38 1141.76,-2277.38 1148.76,-2277.38"/>
</g>
<!-- tp_layer3_gather_k_gpu0 -->
<g id="node410" class="node">
<title>tp_layer3_gather_k_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="1906.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="1906.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="1906.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1906.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1906.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_k_proj_gpu0&#45;&gt;tp_layer3_gather_k_gpu0 -->
<g id="edge529" class="edge">
<title>tp_layer3_k_proj_gpu0&#45;&gt;tp_layer3_gather_k_gpu0</title>
<path fill="none" stroke="black" d="M1759.38,-2353.15C1759.38,-2353.15 1759.38,-2272.95 1759.38,-2272.95"/>
<polygon fill="black" stroke="black" points="1762.88,-2272.95 1759.38,-2262.95 1755.88,-2272.95 1762.88,-2272.95"/>
</g>
<!-- tp_layer3_gather_v_gpu0 -->
<g id="node414" class="node">
<title>tp_layer3_gather_v_gpu0</title>
<ellipse fill="lightblue" stroke="black" cx="2468.26" cy="-1854.75" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="2468.26" y="-1873.55" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="2468.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2468.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2468.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_v_proj_gpu0&#45;&gt;tp_layer3_gather_v_gpu0 -->
<g id="edge533" class="edge">
<title>tp_layer3_v_proj_gpu0&#45;&gt;tp_layer3_gather_v_gpu0</title>
<path fill="none" stroke="black" d="M2355.26,-2353.05C2355.26,-2353.05 2355.26,-1910.7 2355.26,-1910.7"/>
<polygon fill="black" stroke="black" points="2358.76,-1910.7 2355.26,-1900.7 2351.76,-1910.7 2358.76,-1910.7"/>
</g>
<!-- tp_layer3_attn_scores_gpu0 -->
<g id="node409" class="node">
<title>tp_layer3_attn_scores_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="2055.76,-2070.92 1516.76,-2070.92 1516.76,-2002.92 2055.76,-2002.92 2055.76,-2070.92"/>
<text text-anchor="middle" x="1786.26" y="-2055.72" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="1786.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="1786.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1786.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_softmax_gpu0 -->
<g id="node412" class="node">
<title>tp_layer3_softmax_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="2055.76,-1888.75 1516.76,-1888.75 1516.76,-1820.75 2055.76,-1820.75 2055.76,-1888.75"/>
<text text-anchor="middle" x="1786.26" y="-1873.55" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="1786.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1786.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="1786.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_attn_scores_gpu0&#45;&gt;tp_layer3_softmax_gpu0 -->
<g id="edge532" class="edge">
<title>tp_layer3_attn_scores_gpu0&#45;&gt;tp_layer3_softmax_gpu0</title>
<path fill="none" stroke="black" d="M1786.26,-2002.65C1786.26,-2002.65 1786.26,-1898.86 1786.26,-1898.86"/>
<polygon fill="black" stroke="black" points="1789.76,-1898.86 1786.26,-1888.86 1782.76,-1898.86 1789.76,-1898.86"/>
</g>
<!-- tp_layer3_gather_k_gpu0&#45;&gt;tp_layer3_attn_scores_gpu0 -->
<g id="edge531" class="edge">
<title>tp_layer3_gather_k_gpu0&#45;&gt;tp_layer3_attn_scores_gpu0</title>
<path fill="none" stroke="black" d="M1803.88,-2172.64C1803.88,-2172.64 1803.88,-2081.19 1803.88,-2081.19"/>
<polygon fill="black" stroke="black" points="1807.38,-2081.19 1803.88,-2071.19 1800.38,-2081.19 1807.38,-2081.19"/>
</g>
<!-- tp_layer3_gather_q_gpu0&#45;&gt;tp_layer3_attn_scores_gpu0 -->
<g id="edge530" class="edge">
<title>tp_layer3_gather_q_gpu0&#45;&gt;tp_layer3_attn_scores_gpu0</title>
<path fill="none" stroke="black" d="M1493.58,-2219C1518.7,-2219 1534.38,-2219 1534.38,-2219 1534.38,-2219 1534.38,-2081.16 1534.38,-2081.16"/>
<polygon fill="black" stroke="black" points="1537.88,-2081.16 1534.38,-2071.16 1530.88,-2081.16 1537.88,-2081.16"/>
</g>
<!-- tp_layer3_attn_out_gpu0 -->
<g id="node413" class="node">
<title>tp_layer3_attn_out_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="2731.76,-1720.67 2204.76,-1720.67 2204.76,-1652.67 2731.76,-1652.67 2731.76,-1720.67"/>
<text text-anchor="middle" x="2468.26" y="-1705.47" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="2468.26" y="-1690.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="2468.26" y="-1675.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2468.26" y="-1660.47" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_softmax_gpu0&#45;&gt;tp_layer3_attn_out_gpu0 -->
<g id="edge534" class="edge">
<title>tp_layer3_softmax_gpu0&#45;&gt;tp_layer3_attn_out_gpu0</title>
<path fill="none" stroke="black" d="M1786.26,-1820.6C1786.26,-1771.29 1786.26,-1686 1786.26,-1686 1786.26,-1686 2194.58,-1686 2194.58,-1686"/>
<polygon fill="black" stroke="black" points="2194.58,-1689.5 2204.58,-1686 2194.58,-1682.5 2194.58,-1689.5"/>
</g>
<!-- tp_layer3_out_proj_gpu0 -->
<g id="node415" class="node">
<title>tp_layer3_out_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="4869.76,-1566.67 4380.76,-1566.67 4380.76,-1498.67 4869.76,-1498.67 4869.76,-1566.67"/>
<text text-anchor="middle" x="4625.26" y="-1551.47" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="4625.26" y="-1536.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4625.26" y="-1521.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4625.26" y="-1506.47" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_attn_out_gpu0&#45;&gt;tp_layer3_out_proj_gpu0 -->
<g id="edge536" class="edge">
<title>tp_layer3_attn_out_gpu0&#45;&gt;tp_layer3_out_proj_gpu0</title>
<path fill="none" stroke="black" d="M2468.26,-1652.34C2468.26,-1606.77 2468.26,-1532 2468.26,-1532 2468.26,-1532 4370.71,-1532 4370.71,-1532"/>
<polygon fill="black" stroke="black" points="4370.71,-1535.5 4380.71,-1532 4370.71,-1528.5 4370.71,-1535.5"/>
</g>
<!-- tp_layer3_gather_v_gpu0&#45;&gt;tp_layer3_attn_out_gpu0 -->
<g id="edge535" class="edge">
<title>tp_layer3_gather_v_gpu0&#45;&gt;tp_layer3_attn_out_gpu0</title>
<path fill="none" stroke="black" d="M2468.26,-1806.58C2468.26,-1806.58 2468.26,-1730.7 2468.26,-1730.7"/>
<polygon fill="black" stroke="black" points="2471.76,-1730.7 2468.26,-1720.7 2464.76,-1730.7 2471.76,-1730.7"/>
</g>
<!-- tp_layer3_attn_all_reduce -->
<g id="node486" class="node">
<title>tp_layer3_attn_all_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="8848.26" cy="-1364.58" rx="351.36" ry="48.17"/>
<text text-anchor="middle" x="8848.26" y="-1383.38" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention</text>
<text text-anchor="middle" x="8848.26" y="-1368.38" font-family="Times,serif" font-size="14.00">Input: 8×[512]</text>
<text text-anchor="middle" x="8848.26" y="-1353.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8848.26" y="-1338.38" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer3_out_proj_gpu0&#45;&gt;tp_layer3_attn_all_reduce -->
<g id="edge621" class="edge">
<title>tp_layer3_out_proj_gpu0&#45;&gt;tp_layer3_attn_all_reduce</title>
<path fill="none" stroke="black" d="M4747.01,-1498.66C4747.01,-1443.35 4747.01,-1340 4747.01,-1340 4747.01,-1340 8535.85,-1340 8535.85,-1340"/>
<polygon fill="black" stroke="black" points="8535.85,-1343.5 8545.85,-1340 8535.85,-1336.5 8535.85,-1343.5"/>
</g>
<!-- tp_layer3_gather_q_gpu1 -->
<g id="node421" class="node">
<title>tp_layer3_gather_q_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="2804.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="2804.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="2804.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2804.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="2804.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_q_proj_gpu1&#45;&gt;tp_layer3_gather_q_gpu1 -->
<g id="edge540" class="edge">
<title>tp_layer3_q_proj_gpu1&#45;&gt;tp_layer3_gather_q_gpu1</title>
<path fill="none" stroke="black" d="M2834.26,-2353.15C2834.26,-2353.15 2834.26,-2277.06 2834.26,-2277.06"/>
<polygon fill="black" stroke="black" points="2837.76,-2277.06 2834.26,-2267.06 2830.76,-2277.06 2837.76,-2277.06"/>
</g>
<!-- tp_layer3_gather_k_gpu1 -->
<g id="node420" class="node">
<title>tp_layer3_gather_k_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="3571.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="3571.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="3571.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3571.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3571.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_k_proj_gpu1&#45;&gt;tp_layer3_gather_k_gpu1 -->
<g id="edge541" class="edge">
<title>tp_layer3_k_proj_gpu1&#45;&gt;tp_layer3_gather_k_gpu1</title>
<path fill="none" stroke="black" d="M3430.38,-2353.15C3430.38,-2353.15 3430.38,-2273.26 3430.38,-2273.26"/>
<polygon fill="black" stroke="black" points="3433.88,-2273.26 3430.38,-2263.26 3426.88,-2273.26 3433.88,-2273.26"/>
</g>
<!-- tp_layer3_gather_v_gpu1 -->
<g id="node424" class="node">
<title>tp_layer3_gather_v_gpu1</title>
<ellipse fill="lightblue" stroke="black" cx="4134.26" cy="-2036.92" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="4134.26" y="-2055.72" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="4134.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4134.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4134.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_v_proj_gpu1&#45;&gt;tp_layer3_gather_v_gpu1 -->
<g id="edge545" class="edge">
<title>tp_layer3_v_proj_gpu1&#45;&gt;tp_layer3_gather_v_gpu1</title>
<path fill="none" stroke="black" d="M4014.26,-2352.94C4014.26,-2352.94 4014.26,-2092.24 4014.26,-2092.24"/>
<polygon fill="black" stroke="black" points="4017.76,-2092.24 4014.26,-2082.24 4010.76,-2092.24 4017.76,-2092.24"/>
</g>
<!-- tp_layer3_attn_scores_gpu1 -->
<g id="node419" class="node">
<title>tp_layer3_attn_scores_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="3721.76,-2070.92 3182.76,-2070.92 3182.76,-2002.92 3721.76,-2002.92 3721.76,-2070.92"/>
<text text-anchor="middle" x="3452.26" y="-2055.72" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="3452.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="3452.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3452.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_softmax_gpu1 -->
<g id="node422" class="node">
<title>tp_layer3_softmax_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="3883.76,-1888.75 3344.76,-1888.75 3344.76,-1820.75 3883.76,-1820.75 3883.76,-1888.75"/>
<text text-anchor="middle" x="3614.26" y="-1873.55" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="3614.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3614.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="3614.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_attn_scores_gpu1&#45;&gt;tp_layer3_softmax_gpu1 -->
<g id="edge544" class="edge">
<title>tp_layer3_attn_scores_gpu1&#45;&gt;tp_layer3_softmax_gpu1</title>
<path fill="none" stroke="black" d="M3533.26,-2002.65C3533.26,-2002.65 3533.26,-1898.86 3533.26,-1898.86"/>
<polygon fill="black" stroke="black" points="3536.76,-1898.86 3533.26,-1888.86 3529.76,-1898.86 3536.76,-1898.86"/>
</g>
<!-- tp_layer3_gather_k_gpu1&#45;&gt;tp_layer3_attn_scores_gpu1 -->
<g id="edge543" class="edge">
<title>tp_layer3_gather_k_gpu1&#45;&gt;tp_layer3_attn_scores_gpu1</title>
<path fill="none" stroke="black" d="M3469.38,-2172.64C3469.38,-2172.64 3469.38,-2081.19 3469.38,-2081.19"/>
<polygon fill="black" stroke="black" points="3472.88,-2081.19 3469.38,-2071.19 3465.88,-2081.19 3472.88,-2081.19"/>
</g>
<!-- tp_layer3_gather_q_gpu1&#45;&gt;tp_layer3_attn_scores_gpu1 -->
<g id="edge542" class="edge">
<title>tp_layer3_gather_q_gpu1&#45;&gt;tp_layer3_attn_scores_gpu1</title>
<path fill="none" stroke="black" d="M3158.66,-2219C3184.02,-2219 3199.88,-2219 3199.88,-2219 3199.88,-2219 3199.88,-2081.16 3199.88,-2081.16"/>
<polygon fill="black" stroke="black" points="3203.38,-2081.16 3199.88,-2071.16 3196.38,-2081.16 3203.38,-2081.16"/>
</g>
<!-- tp_layer3_attn_out_gpu1 -->
<g id="node423" class="node">
<title>tp_layer3_attn_out_gpu1</title>
<polygon fill="lightyellow" stroke="black" points="4397.76,-1720.67 3870.76,-1720.67 3870.76,-1652.67 4397.76,-1652.67 4397.76,-1720.67"/>
<text text-anchor="middle" x="4134.26" y="-1705.47" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="4134.26" y="-1690.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="4134.26" y="-1675.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4134.26" y="-1660.47" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_softmax_gpu1&#45;&gt;tp_layer3_attn_out_gpu1 -->
<g id="edge546" class="edge">
<title>tp_layer3_softmax_gpu1&#45;&gt;tp_layer3_attn_out_gpu1</title>
<path fill="none" stroke="black" d="M3877.26,-1820.74C3877.26,-1820.74 3877.26,-1730.92 3877.26,-1730.92"/>
<polygon fill="black" stroke="black" points="3880.76,-1730.92 3877.26,-1720.92 3873.76,-1730.92 3880.76,-1730.92"/>
</g>
<!-- tp_layer3_out_proj_gpu1 -->
<g id="node425" class="node">
<title>tp_layer3_out_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="5563.76,-1566.67 5074.76,-1566.67 5074.76,-1498.67 5563.76,-1498.67 5563.76,-1566.67"/>
<text text-anchor="middle" x="5319.26" y="-1551.47" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5319.26" y="-1536.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5319.26" y="-1521.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5319.26" y="-1506.47" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_attn_out_gpu1&#45;&gt;tp_layer3_out_proj_gpu1 -->
<g id="edge548" class="edge">
<title>tp_layer3_attn_out_gpu1&#45;&gt;tp_layer3_out_proj_gpu1</title>
<path fill="none" stroke="black" d="M4398.08,-1675C4706.24,-1675 5174.43,-1675 5174.43,-1675 5174.43,-1675 5174.43,-1576.76 5174.43,-1576.76"/>
<polygon fill="black" stroke="black" points="5177.93,-1576.76 5174.43,-1566.76 5170.93,-1576.76 5177.93,-1576.76"/>
</g>
<!-- tp_layer3_gather_v_gpu1&#45;&gt;tp_layer3_attn_out_gpu1 -->
<g id="edge547" class="edge">
<title>tp_layer3_gather_v_gpu1&#45;&gt;tp_layer3_attn_out_gpu1</title>
<path fill="none" stroke="black" d="M4140.76,-1988.58C4140.76,-1988.58 4140.76,-1730.82 4140.76,-1730.82"/>
<polygon fill="black" stroke="black" points="4144.26,-1730.82 4140.76,-1720.82 4137.26,-1730.82 4144.26,-1730.82"/>
</g>
<!-- tp_layer3_out_proj_gpu1&#45;&gt;tp_layer3_attn_all_reduce -->
<g id="edge622" class="edge">
<title>tp_layer3_out_proj_gpu1&#45;&gt;tp_layer3_attn_all_reduce</title>
<path fill="none" stroke="black" d="M5376.01,-1498.53C5376.01,-1449.25 5376.01,-1364 5376.01,-1364 5376.01,-1364 8486.62,-1364 8486.62,-1364"/>
<polygon fill="black" stroke="black" points="8486.62,-1367.5 8496.62,-1364 8486.62,-1360.5 8486.62,-1367.5"/>
</g>
<!-- tp_layer3_gather_q_gpu2 -->
<g id="node431" class="node">
<title>tp_layer3_gather_q_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="4457.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="4457.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="4457.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4457.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="4457.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_q_proj_gpu2&#45;&gt;tp_layer3_gather_q_gpu2 -->
<g id="edge552" class="edge">
<title>tp_layer3_q_proj_gpu2&#45;&gt;tp_layer3_gather_q_gpu2</title>
<path fill="none" stroke="black" d="M4511.26,-2353.15C4511.26,-2353.15 4511.26,-2276.74 4511.26,-2276.74"/>
<polygon fill="black" stroke="black" points="4514.76,-2276.74 4511.26,-2266.74 4507.76,-2276.74 4514.76,-2276.74"/>
</g>
<!-- tp_layer3_gather_k_gpu2 -->
<g id="node430" class="node">
<title>tp_layer3_gather_k_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="5224.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="5224.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="5224.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5224.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5224.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_k_proj_gpu2&#45;&gt;tp_layer3_gather_k_gpu2 -->
<g id="edge553" class="edge">
<title>tp_layer3_k_proj_gpu2&#45;&gt;tp_layer3_gather_k_gpu2</title>
<path fill="none" stroke="black" d="M5095.38,-2353.15C5095.38,-2353.15 5095.38,-2273.89 5095.38,-2273.89"/>
<polygon fill="black" stroke="black" points="5098.88,-2273.89 5095.38,-2263.89 5091.88,-2273.89 5098.88,-2273.89"/>
</g>
<!-- tp_layer3_gather_v_gpu2 -->
<g id="node434" class="node">
<title>tp_layer3_gather_v_gpu2</title>
<ellipse fill="lightblue" stroke="black" cx="5786.26" cy="-1854.75" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="5786.26" y="-1873.55" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="5786.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5786.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5786.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_v_proj_gpu2&#45;&gt;tp_layer3_gather_v_gpu2 -->
<g id="edge557" class="edge">
<title>tp_layer3_v_proj_gpu2&#45;&gt;tp_layer3_gather_v_gpu2</title>
<path fill="none" stroke="black" d="M5667.26,-2353.05C5667.26,-2353.05 5667.26,-1910.31 5667.26,-1910.31"/>
<polygon fill="black" stroke="black" points="5670.76,-1910.31 5667.26,-1900.31 5663.76,-1910.31 5670.76,-1910.31"/>
</g>
<!-- tp_layer3_attn_scores_gpu2 -->
<g id="node429" class="node">
<title>tp_layer3_attn_scores_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="5373.76,-2070.92 4834.76,-2070.92 4834.76,-2002.92 5373.76,-2002.92 5373.76,-2070.92"/>
<text text-anchor="middle" x="5104.26" y="-2055.72" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="5104.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5104.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="5104.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_softmax_gpu2 -->
<g id="node432" class="node">
<title>tp_layer3_softmax_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="5373.76,-1888.75 4834.76,-1888.75 4834.76,-1820.75 5373.76,-1820.75 5373.76,-1888.75"/>
<text text-anchor="middle" x="5104.26" y="-1873.55" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="5104.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="5104.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="5104.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_attn_scores_gpu2&#45;&gt;tp_layer3_softmax_gpu2 -->
<g id="edge556" class="edge">
<title>tp_layer3_attn_scores_gpu2&#45;&gt;tp_layer3_softmax_gpu2</title>
<path fill="none" stroke="black" d="M5104.26,-2002.65C5104.26,-2002.65 5104.26,-1898.86 5104.26,-1898.86"/>
<polygon fill="black" stroke="black" points="5107.76,-1898.86 5104.26,-1888.86 5100.76,-1898.86 5107.76,-1898.86"/>
</g>
<!-- tp_layer3_gather_k_gpu2&#45;&gt;tp_layer3_attn_scores_gpu2 -->
<g id="edge555" class="edge">
<title>tp_layer3_gather_k_gpu2&#45;&gt;tp_layer3_attn_scores_gpu2</title>
<path fill="none" stroke="black" d="M5121.88,-2172.64C5121.88,-2172.64 5121.88,-2081.19 5121.88,-2081.19"/>
<polygon fill="black" stroke="black" points="5125.38,-2081.19 5121.88,-2071.19 5118.38,-2081.19 5125.38,-2081.19"/>
</g>
<!-- tp_layer3_gather_q_gpu2&#45;&gt;tp_layer3_attn_scores_gpu2 -->
<g id="edge554" class="edge">
<title>tp_layer3_gather_q_gpu2&#45;&gt;tp_layer3_attn_scores_gpu2</title>
<path fill="none" stroke="black" d="M4811.58,-2219C4836.7,-2219 4852.38,-2219 4852.38,-2219 4852.38,-2219 4852.38,-2081.16 4852.38,-2081.16"/>
<polygon fill="black" stroke="black" points="4855.88,-2081.16 4852.38,-2071.16 4848.88,-2081.16 4855.88,-2081.16"/>
</g>
<!-- tp_layer3_attn_out_gpu2 -->
<g id="node433" class="node">
<title>tp_layer3_attn_out_gpu2</title>
<polygon fill="lightyellow" stroke="black" points="6049.76,-1720.67 5522.76,-1720.67 5522.76,-1652.67 6049.76,-1652.67 6049.76,-1720.67"/>
<text text-anchor="middle" x="5786.26" y="-1705.47" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="5786.26" y="-1690.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="5786.26" y="-1675.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="5786.26" y="-1660.47" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_softmax_gpu2&#45;&gt;tp_layer3_attn_out_gpu2 -->
<g id="edge558" class="edge">
<title>tp_layer3_softmax_gpu2&#45;&gt;tp_layer3_attn_out_gpu2</title>
<path fill="none" stroke="black" d="M5274.09,-1820.52C5274.09,-1774.12 5274.09,-1697 5274.09,-1697 5274.09,-1697 5512.68,-1697 5512.68,-1697"/>
<polygon fill="black" stroke="black" points="5512.68,-1700.5 5522.68,-1697 5512.68,-1693.5 5512.68,-1700.5"/>
</g>
<!-- tp_layer3_out_proj_gpu2 -->
<g id="node435" class="node">
<title>tp_layer3_out_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="7189.76,-1566.67 6700.76,-1566.67 6700.76,-1498.67 7189.76,-1498.67 7189.76,-1566.67"/>
<text text-anchor="middle" x="6945.26" y="-1551.47" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="6945.26" y="-1536.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6945.26" y="-1521.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6945.26" y="-1506.47" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_attn_out_gpu2&#45;&gt;tp_layer3_out_proj_gpu2 -->
<g id="edge560" class="edge">
<title>tp_layer3_attn_out_gpu2&#45;&gt;tp_layer3_out_proj_gpu2</title>
<path fill="none" stroke="black" d="M5901.01,-1652.34C5901.01,-1606.77 5901.01,-1532 5901.01,-1532 5901.01,-1532 6690.76,-1532 6690.76,-1532"/>
<polygon fill="black" stroke="black" points="6690.76,-1535.5 6700.76,-1532 6690.76,-1528.5 6690.76,-1535.5"/>
</g>
<!-- tp_layer3_gather_v_gpu2&#45;&gt;tp_layer3_attn_out_gpu2 -->
<g id="edge559" class="edge">
<title>tp_layer3_gather_v_gpu2&#45;&gt;tp_layer3_attn_out_gpu2</title>
<path fill="none" stroke="black" d="M5786.26,-1806.58C5786.26,-1806.58 5786.26,-1730.7 5786.26,-1730.7"/>
<polygon fill="black" stroke="black" points="5789.76,-1730.7 5786.26,-1720.7 5782.76,-1730.7 5789.76,-1730.7"/>
</g>
<!-- tp_layer3_out_proj_gpu2&#45;&gt;tp_layer3_attn_all_reduce -->
<g id="edge623" class="edge">
<title>tp_layer3_out_proj_gpu2&#45;&gt;tp_layer3_attn_all_reduce</title>
<path fill="none" stroke="black" d="M7035.01,-1498.38C7035.01,-1455.6 7035.01,-1388 7035.01,-1388 7035.01,-1388 8531.18,-1388 8531.18,-1388"/>
<polygon fill="black" stroke="black" points="8531.18,-1391.5 8541.18,-1388 8531.18,-1384.5 8531.18,-1391.5"/>
</g>
<!-- tp_layer3_gather_q_gpu3 -->
<g id="node441" class="node">
<title>tp_layer3_gather_q_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="6110.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="6110.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="6110.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6110.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6110.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_q_proj_gpu3&#45;&gt;tp_layer3_gather_q_gpu3 -->
<g id="edge564" class="edge">
<title>tp_layer3_q_proj_gpu3&#45;&gt;tp_layer3_gather_q_gpu3</title>
<path fill="none" stroke="black" d="M6188.26,-2353.15C6188.26,-2353.15 6188.26,-2276.1 6188.26,-2276.1"/>
<polygon fill="black" stroke="black" points="6191.76,-2276.1 6188.26,-2266.1 6184.76,-2276.1 6191.76,-2276.1"/>
</g>
<!-- tp_layer3_gather_k_gpu3 -->
<g id="node440" class="node">
<title>tp_layer3_gather_k_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="6877.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="6877.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="6877.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6877.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6877.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_k_proj_gpu3&#45;&gt;tp_layer3_gather_k_gpu3 -->
<g id="edge565" class="edge">
<title>tp_layer3_k_proj_gpu3&#45;&gt;tp_layer3_gather_k_gpu3</title>
<path fill="none" stroke="black" d="M6760.38,-2353.15C6760.38,-2353.15 6760.38,-2274.52 6760.38,-2274.52"/>
<polygon fill="black" stroke="black" points="6763.88,-2274.52 6760.38,-2264.52 6756.88,-2274.52 6763.88,-2274.52"/>
</g>
<!-- tp_layer3_gather_v_gpu3 -->
<g id="node444" class="node">
<title>tp_layer3_gather_v_gpu3</title>
<ellipse fill="lightblue" stroke="black" cx="7439.26" cy="-2036.92" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="7439.26" y="-2055.72" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="7439.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7439.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7439.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_v_proj_gpu3&#45;&gt;tp_layer3_gather_v_gpu3 -->
<g id="edge569" class="edge">
<title>tp_layer3_v_proj_gpu3&#45;&gt;tp_layer3_gather_v_gpu3</title>
<path fill="none" stroke="black" d="M7325.76,-2352.94C7325.76,-2352.94 7325.76,-2092.53 7325.76,-2092.53"/>
<polygon fill="black" stroke="black" points="7329.26,-2092.53 7325.76,-2082.53 7322.26,-2092.53 7329.26,-2092.53"/>
</g>
<!-- tp_layer3_attn_scores_gpu3 -->
<g id="node439" class="node">
<title>tp_layer3_attn_scores_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="7026.76,-2070.92 6487.76,-2070.92 6487.76,-2002.92 7026.76,-2002.92 7026.76,-2070.92"/>
<text text-anchor="middle" x="6757.26" y="-2055.72" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="6757.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="6757.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6757.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_softmax_gpu3 -->
<g id="node442" class="node">
<title>tp_layer3_softmax_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="7188.76,-1888.75 6649.76,-1888.75 6649.76,-1820.75 7188.76,-1820.75 7188.76,-1888.75"/>
<text text-anchor="middle" x="6919.26" y="-1873.55" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="6919.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6919.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="6919.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_attn_scores_gpu3&#45;&gt;tp_layer3_softmax_gpu3 -->
<g id="edge568" class="edge">
<title>tp_layer3_attn_scores_gpu3&#45;&gt;tp_layer3_softmax_gpu3</title>
<path fill="none" stroke="black" d="M6838.26,-2002.65C6838.26,-2002.65 6838.26,-1898.86 6838.26,-1898.86"/>
<polygon fill="black" stroke="black" points="6841.76,-1898.86 6838.26,-1888.86 6834.76,-1898.86 6841.76,-1898.86"/>
</g>
<!-- tp_layer3_gather_k_gpu3&#45;&gt;tp_layer3_attn_scores_gpu3 -->
<g id="edge567" class="edge">
<title>tp_layer3_gather_k_gpu3&#45;&gt;tp_layer3_attn_scores_gpu3</title>
<path fill="none" stroke="black" d="M6774.88,-2172.64C6774.88,-2172.64 6774.88,-2081.19 6774.88,-2081.19"/>
<polygon fill="black" stroke="black" points="6778.38,-2081.19 6774.88,-2071.19 6771.38,-2081.19 6778.38,-2081.19"/>
</g>
<!-- tp_layer3_gather_q_gpu3&#45;&gt;tp_layer3_attn_scores_gpu3 -->
<g id="edge566" class="edge">
<title>tp_layer3_gather_q_gpu3&#45;&gt;tp_layer3_attn_scores_gpu3</title>
<path fill="none" stroke="black" d="M6464.79,-2219C6481.98,-2219 6492.26,-2219 6492.26,-2219 6492.26,-2219 6492.26,-2081.16 6492.26,-2081.16"/>
<polygon fill="black" stroke="black" points="6495.76,-2081.16 6492.26,-2071.16 6488.76,-2081.16 6495.76,-2081.16"/>
</g>
<!-- tp_layer3_attn_out_gpu3 -->
<g id="node443" class="node">
<title>tp_layer3_attn_out_gpu3</title>
<polygon fill="lightyellow" stroke="black" points="7702.76,-1720.67 7175.76,-1720.67 7175.76,-1652.67 7702.76,-1652.67 7702.76,-1720.67"/>
<text text-anchor="middle" x="7439.26" y="-1705.47" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="7439.26" y="-1690.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="7439.26" y="-1675.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7439.26" y="-1660.47" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_softmax_gpu3&#45;&gt;tp_layer3_attn_out_gpu3 -->
<g id="edge570" class="edge">
<title>tp_layer3_softmax_gpu3&#45;&gt;tp_layer3_attn_out_gpu3</title>
<path fill="none" stroke="black" d="M7182.26,-1820.74C7182.26,-1820.74 7182.26,-1730.92 7182.26,-1730.92"/>
<polygon fill="black" stroke="black" points="7185.76,-1730.92 7182.26,-1720.92 7178.76,-1730.92 7185.76,-1730.92"/>
</g>
<!-- tp_layer3_out_proj_gpu3 -->
<g id="node445" class="node">
<title>tp_layer3_out_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="8275.76,-1566.67 7786.76,-1566.67 7786.76,-1498.67 8275.76,-1498.67 8275.76,-1566.67"/>
<text text-anchor="middle" x="8031.26" y="-1551.47" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="8031.26" y="-1536.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8031.26" y="-1521.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8031.26" y="-1506.47" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_attn_out_gpu3&#45;&gt;tp_layer3_out_proj_gpu3 -->
<g id="edge572" class="edge">
<title>tp_layer3_attn_out_gpu3&#45;&gt;tp_layer3_out_proj_gpu3</title>
<path fill="none" stroke="black" d="M7702.94,-1686C7811.64,-1686 7912.64,-1686 7912.64,-1686 7912.64,-1686 7912.64,-1576.7 7912.64,-1576.7"/>
<polygon fill="black" stroke="black" points="7916.14,-1576.7 7912.64,-1566.7 7909.14,-1576.7 7916.14,-1576.7"/>
</g>
<!-- tp_layer3_gather_v_gpu3&#45;&gt;tp_layer3_attn_out_gpu3 -->
<g id="edge571" class="edge">
<title>tp_layer3_gather_v_gpu3&#45;&gt;tp_layer3_attn_out_gpu3</title>
<path fill="none" stroke="black" d="M7445.76,-1988.58C7445.76,-1988.58 7445.76,-1730.82 7445.76,-1730.82"/>
<polygon fill="black" stroke="black" points="7449.26,-1730.82 7445.76,-1720.82 7442.26,-1730.82 7449.26,-1730.82"/>
</g>
<!-- tp_layer3_out_proj_gpu3&#45;&gt;tp_layer3_attn_all_reduce -->
<g id="edge624" class="edge">
<title>tp_layer3_out_proj_gpu3&#45;&gt;tp_layer3_attn_all_reduce</title>
<path fill="none" stroke="black" d="M8275.9,-1532C8403.71,-1532 8533.79,-1532 8533.79,-1532 8533.79,-1532 8533.79,-1396.13 8533.79,-1396.13"/>
<polygon fill="black" stroke="black" points="8537.29,-1396.13 8533.79,-1386.13 8530.29,-1396.13 8537.29,-1396.13"/>
</g>
<!-- tp_layer3_gather_q_gpu4 -->
<g id="node451" class="node">
<title>tp_layer3_gather_q_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="7774.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="7774.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="7774.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7774.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="7774.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_q_proj_gpu4&#45;&gt;tp_layer3_gather_q_gpu4 -->
<g id="edge576" class="edge">
<title>tp_layer3_q_proj_gpu4&#45;&gt;tp_layer3_gather_q_gpu4</title>
<path fill="none" stroke="black" d="M7865.26,-2353.15C7865.26,-2353.15 7865.26,-2275.78 7865.26,-2275.78"/>
<polygon fill="black" stroke="black" points="7868.76,-2275.78 7865.26,-2265.78 7861.76,-2275.78 7868.76,-2275.78"/>
</g>
<!-- tp_layer3_gather_k_gpu4 -->
<g id="node450" class="node">
<title>tp_layer3_gather_k_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="8541.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="8541.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="8541.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8541.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8541.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_k_proj_gpu4&#45;&gt;tp_layer3_gather_k_gpu4 -->
<g id="edge577" class="edge">
<title>tp_layer3_k_proj_gpu4&#45;&gt;tp_layer3_gather_k_gpu4</title>
<path fill="none" stroke="black" d="M8430.88,-2353.15C8430.88,-2353.15 8430.88,-2274.83 8430.88,-2274.83"/>
<polygon fill="black" stroke="black" points="8434.38,-2274.83 8430.88,-2264.83 8427.38,-2274.83 8434.38,-2274.83"/>
</g>
<!-- tp_layer3_gather_v_gpu4 -->
<g id="node454" class="node">
<title>tp_layer3_gather_v_gpu4</title>
<ellipse fill="lightblue" stroke="black" cx="8983.26" cy="-1854.75" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="8983.26" y="-1873.55" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="8983.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8983.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8983.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_v_proj_gpu4&#45;&gt;tp_layer3_gather_v_gpu4 -->
<g id="edge581" class="edge">
<title>tp_layer3_v_proj_gpu4&#45;&gt;tp_layer3_gather_v_gpu4</title>
<path fill="none" stroke="black" d="M8989.76,-2353.05C8989.76,-2353.05 8989.76,-1913.07 8989.76,-1913.07"/>
<polygon fill="black" stroke="black" points="8993.26,-1913.07 8989.76,-1903.07 8986.26,-1913.07 8993.26,-1913.07"/>
</g>
<!-- tp_layer3_attn_scores_gpu4 -->
<g id="node449" class="node">
<title>tp_layer3_attn_scores_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="8570.76,-2070.92 8031.76,-2070.92 8031.76,-2002.92 8570.76,-2002.92 8570.76,-2070.92"/>
<text text-anchor="middle" x="8301.26" y="-2055.72" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="8301.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8301.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="8301.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_softmax_gpu4 -->
<g id="node452" class="node">
<title>tp_layer3_softmax_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="8570.76,-1888.75 8031.76,-1888.75 8031.76,-1820.75 8570.76,-1820.75 8570.76,-1888.75"/>
<text text-anchor="middle" x="8301.26" y="-1873.55" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="8301.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="8301.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="8301.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_attn_scores_gpu4&#45;&gt;tp_layer3_softmax_gpu4 -->
<g id="edge580" class="edge">
<title>tp_layer3_attn_scores_gpu4&#45;&gt;tp_layer3_softmax_gpu4</title>
<path fill="none" stroke="black" d="M8301.26,-2002.65C8301.26,-2002.65 8301.26,-1898.86 8301.26,-1898.86"/>
<polygon fill="black" stroke="black" points="8304.76,-1898.86 8301.26,-1888.86 8297.76,-1898.86 8304.76,-1898.86"/>
</g>
<!-- tp_layer3_gather_k_gpu4&#45;&gt;tp_layer3_attn_scores_gpu4 -->
<g id="edge579" class="edge">
<title>tp_layer3_gather_k_gpu4&#45;&gt;tp_layer3_attn_scores_gpu4</title>
<path fill="none" stroke="black" d="M8378.88,-2175.91C8378.88,-2175.91 8378.88,-2080.97 8378.88,-2080.97"/>
<polygon fill="black" stroke="black" points="8382.38,-2080.97 8378.88,-2070.97 8375.38,-2080.97 8382.38,-2080.97"/>
</g>
<!-- tp_layer3_gather_q_gpu4&#45;&gt;tp_layer3_attn_scores_gpu4 -->
<g id="edge578" class="edge">
<title>tp_layer3_gather_q_gpu4&#45;&gt;tp_layer3_attn_scores_gpu4</title>
<path fill="none" stroke="black" d="M8080.14,-2194.51C8080.14,-2194.51 8080.14,-2081.01 8080.14,-2081.01"/>
<polygon fill="black" stroke="black" points="8083.64,-2081.01 8080.14,-2071.01 8076.64,-2081.01 8083.64,-2081.01"/>
</g>
<!-- tp_layer3_attn_out_gpu4 -->
<g id="node453" class="node">
<title>tp_layer3_attn_out_gpu4</title>
<polygon fill="lightyellow" stroke="black" points="9111.76,-1720.67 8584.76,-1720.67 8584.76,-1652.67 9111.76,-1652.67 9111.76,-1720.67"/>
<text text-anchor="middle" x="8848.26" y="-1705.47" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="8848.26" y="-1690.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="8848.26" y="-1675.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8848.26" y="-1660.47" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_softmax_gpu4&#45;&gt;tp_layer3_attn_out_gpu4 -->
<g id="edge582" class="edge">
<title>tp_layer3_softmax_gpu4&#45;&gt;tp_layer3_attn_out_gpu4</title>
<path fill="none" stroke="black" d="M8570.92,-1854C8592.9,-1854 8606.88,-1854 8606.88,-1854 8606.88,-1854 8606.88,-1730.93 8606.88,-1730.93"/>
<polygon fill="black" stroke="black" points="8610.38,-1730.93 8606.88,-1720.93 8603.38,-1730.93 8610.38,-1730.93"/>
</g>
<!-- tp_layer3_out_proj_gpu4 -->
<g id="node455" class="node">
<title>tp_layer3_out_proj_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="9092.76,-1566.67 8603.76,-1566.67 8603.76,-1498.67 9092.76,-1498.67 9092.76,-1566.67"/>
<text text-anchor="middle" x="8848.26" y="-1551.47" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="8848.26" y="-1536.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="8848.26" y="-1521.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8848.26" y="-1506.47" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_attn_out_gpu4&#45;&gt;tp_layer3_out_proj_gpu4 -->
<g id="edge584" class="edge">
<title>tp_layer3_attn_out_gpu4&#45;&gt;tp_layer3_out_proj_gpu4</title>
<path fill="none" stroke="black" d="M8848.26,-1652.49C8848.26,-1652.49 8848.26,-1576.75 8848.26,-1576.75"/>
<polygon fill="black" stroke="black" points="8851.76,-1576.75 8848.26,-1566.75 8844.76,-1576.75 8851.76,-1576.75"/>
</g>
<!-- tp_layer3_gather_v_gpu4&#45;&gt;tp_layer3_attn_out_gpu4 -->
<g id="edge583" class="edge">
<title>tp_layer3_gather_v_gpu4&#45;&gt;tp_layer3_attn_out_gpu4</title>
<path fill="none" stroke="black" d="M8870.38,-1808.82C8870.38,-1808.82 8870.38,-1730.81 8870.38,-1730.81"/>
<polygon fill="black" stroke="black" points="8873.88,-1730.81 8870.38,-1720.81 8866.88,-1730.81 8873.88,-1730.81"/>
</g>
<!-- tp_layer3_out_proj_gpu4&#45;&gt;tp_layer3_attn_all_reduce -->
<g id="edge625" class="edge">
<title>tp_layer3_out_proj_gpu4&#45;&gt;tp_layer3_attn_all_reduce</title>
<path fill="none" stroke="black" d="M8848.26,-1498.65C8848.26,-1498.65 8848.26,-1422.88 8848.26,-1422.88"/>
<polygon fill="black" stroke="black" points="8851.76,-1422.88 8848.26,-1412.88 8844.76,-1422.88 8851.76,-1422.88"/>
</g>
<!-- tp_layer3_gather_q_gpu5 -->
<g id="node461" class="node">
<title>tp_layer3_gather_q_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="9438.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="9438.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="9438.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9438.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9438.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_q_proj_gpu5&#45;&gt;tp_layer3_gather_q_gpu5 -->
<g id="edge588" class="edge">
<title>tp_layer3_q_proj_gpu5&#45;&gt;tp_layer3_gather_q_gpu5</title>
<path fill="none" stroke="black" d="M9542.14,-2353.15C9542.14,-2353.15 9542.14,-2275.15 9542.14,-2275.15"/>
<polygon fill="black" stroke="black" points="9545.64,-2275.15 9542.14,-2265.15 9538.64,-2275.15 9545.64,-2275.15"/>
</g>
<!-- tp_layer3_gather_k_gpu5 -->
<g id="node460" class="node">
<title>tp_layer3_gather_k_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="10205.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="10205.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="10205.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10205.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10205.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_k_proj_gpu5&#45;&gt;tp_layer3_gather_k_gpu5 -->
<g id="edge589" class="edge">
<title>tp_layer3_k_proj_gpu5&#45;&gt;tp_layer3_gather_k_gpu5</title>
<path fill="none" stroke="black" d="M10101.38,-2353.15C10101.38,-2353.15 10101.38,-2275.15 10101.38,-2275.15"/>
<polygon fill="black" stroke="black" points="10104.88,-2275.15 10101.38,-2265.15 10097.88,-2275.15 10104.88,-2275.15"/>
</g>
<!-- tp_layer3_gather_v_gpu5 -->
<g id="node464" class="node">
<title>tp_layer3_gather_v_gpu5</title>
<ellipse fill="lightblue" stroke="black" cx="10576.26" cy="-2036.92" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="10576.26" y="-2055.72" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="10576.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10576.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10576.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_v_proj_gpu5&#45;&gt;tp_layer3_gather_v_gpu5 -->
<g id="edge593" class="edge">
<title>tp_layer3_v_proj_gpu5&#45;&gt;tp_layer3_gather_v_gpu5</title>
<path fill="none" stroke="black" d="M10654.76,-2352.94C10654.76,-2352.94 10654.76,-2093.98 10654.76,-2093.98"/>
<polygon fill="black" stroke="black" points="10658.26,-2093.98 10654.76,-2083.98 10651.26,-2093.98 10658.26,-2093.98"/>
</g>
<!-- tp_layer3_attn_scores_gpu5 -->
<g id="node459" class="node">
<title>tp_layer3_attn_scores_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="10090.76,-2070.92 9551.76,-2070.92 9551.76,-2002.92 10090.76,-2002.92 10090.76,-2070.92"/>
<text text-anchor="middle" x="9821.26" y="-2055.72" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="9821.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9821.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9821.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_softmax_gpu5 -->
<g id="node462" class="node">
<title>tp_layer3_softmax_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="10090.76,-1888.75 9551.76,-1888.75 9551.76,-1820.75 10090.76,-1820.75 10090.76,-1888.75"/>
<text text-anchor="middle" x="9821.26" y="-1873.55" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="9821.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9821.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9821.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_attn_scores_gpu5&#45;&gt;tp_layer3_softmax_gpu5 -->
<g id="edge592" class="edge">
<title>tp_layer3_attn_scores_gpu5&#45;&gt;tp_layer3_softmax_gpu5</title>
<path fill="none" stroke="black" d="M9821.26,-2002.65C9821.26,-2002.65 9821.26,-1898.86 9821.26,-1898.86"/>
<polygon fill="black" stroke="black" points="9824.76,-1898.86 9821.26,-1888.86 9817.76,-1898.86 9824.76,-1898.86"/>
</g>
<!-- tp_layer3_gather_k_gpu5&#45;&gt;tp_layer3_attn_scores_gpu5 -->
<g id="edge591" class="edge">
<title>tp_layer3_gather_k_gpu5&#45;&gt;tp_layer3_attn_scores_gpu5</title>
<path fill="none" stroke="black" d="M9970.88,-2182.66C9970.88,-2182.66 9970.88,-2081.12 9970.88,-2081.12"/>
<polygon fill="black" stroke="black" points="9974.38,-2081.12 9970.88,-2071.12 9967.38,-2081.12 9974.38,-2081.12"/>
</g>
<!-- tp_layer3_gather_q_gpu5&#45;&gt;tp_layer3_attn_scores_gpu5 -->
<g id="edge590" class="edge">
<title>tp_layer3_gather_q_gpu5&#45;&gt;tp_layer3_attn_scores_gpu5</title>
<path fill="none" stroke="black" d="M9672.14,-2182.66C9672.14,-2182.66 9672.14,-2081.12 9672.14,-2081.12"/>
<polygon fill="black" stroke="black" points="9675.64,-2081.12 9672.14,-2071.12 9668.64,-2081.12 9675.64,-2081.12"/>
</g>
<!-- tp_layer3_attn_out_gpu5 -->
<g id="node463" class="node">
<title>tp_layer3_attn_out_gpu5</title>
<polygon fill="lightyellow" stroke="black" points="10084.76,-1720.67 9557.76,-1720.67 9557.76,-1652.67 10084.76,-1652.67 10084.76,-1720.67"/>
<text text-anchor="middle" x="9821.26" y="-1705.47" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="9821.26" y="-1690.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="9821.26" y="-1675.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9821.26" y="-1660.47" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_softmax_gpu5&#45;&gt;tp_layer3_attn_out_gpu5 -->
<g id="edge594" class="edge">
<title>tp_layer3_softmax_gpu5&#45;&gt;tp_layer3_attn_out_gpu5</title>
<path fill="none" stroke="black" d="M9821.26,-1820.74C9821.26,-1820.74 9821.26,-1730.92 9821.26,-1730.92"/>
<polygon fill="black" stroke="black" points="9824.76,-1730.92 9821.26,-1720.92 9817.76,-1730.92 9824.76,-1730.92"/>
</g>
<!-- tp_layer3_out_proj_gpu5 -->
<g id="node465" class="node">
<title>tp_layer3_out_proj_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="9852.76,-1566.67 9363.76,-1566.67 9363.76,-1498.67 9852.76,-1498.67 9852.76,-1566.67"/>
<text text-anchor="middle" x="9608.26" y="-1551.47" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="9608.26" y="-1536.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="9608.26" y="-1521.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9608.26" y="-1506.47" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_attn_out_gpu5&#45;&gt;tp_layer3_out_proj_gpu5 -->
<g id="edge596" class="edge">
<title>tp_layer3_attn_out_gpu5&#45;&gt;tp_layer3_out_proj_gpu5</title>
<path fill="none" stroke="black" d="M9705.26,-1652.49C9705.26,-1652.49 9705.26,-1576.75 9705.26,-1576.75"/>
<polygon fill="black" stroke="black" points="9708.76,-1576.75 9705.26,-1566.75 9701.76,-1576.75 9708.76,-1576.75"/>
</g>
<!-- tp_layer3_gather_v_gpu5&#45;&gt;tp_layer3_attn_out_gpu5 -->
<g id="edge595" class="edge">
<title>tp_layer3_gather_v_gpu5&#45;&gt;tp_layer3_attn_out_gpu5</title>
<path fill="none" stroke="black" d="M10241.63,-2020.98C10241.63,-1953.77 10241.63,-1697 10241.63,-1697 10241.63,-1697 10094.8,-1697 10094.8,-1697"/>
<polygon fill="black" stroke="black" points="10094.8,-1693.5 10084.8,-1697 10094.8,-1700.5 10094.8,-1693.5"/>
</g>
<!-- tp_layer3_out_proj_gpu5&#45;&gt;tp_layer3_attn_all_reduce -->
<g id="edge626" class="edge">
<title>tp_layer3_out_proj_gpu5&#45;&gt;tp_layer3_attn_all_reduce</title>
<path fill="none" stroke="black" d="M9363.45,-1532C9256.82,-1532 9155.73,-1532 9155.73,-1532 9155.73,-1532 9155.73,-1398.21 9155.73,-1398.21"/>
<polygon fill="black" stroke="black" points="9159.23,-1398.21 9155.73,-1388.21 9152.23,-1398.21 9159.23,-1398.21"/>
</g>
<!-- tp_layer3_gather_q_gpu6 -->
<g id="node471" class="node">
<title>tp_layer3_gather_q_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="11104.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="11104.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="11104.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11104.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11104.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_q_proj_gpu6&#45;&gt;tp_layer3_gather_q_gpu6 -->
<g id="edge600" class="edge">
<title>tp_layer3_q_proj_gpu6&#45;&gt;tp_layer3_gather_q_gpu6</title>
<path fill="none" stroke="black" d="M11213.64,-2353.15C11213.64,-2353.15 11213.64,-2274.83 11213.64,-2274.83"/>
<polygon fill="black" stroke="black" points="11217.14,-2274.83 11213.64,-2264.83 11210.14,-2274.83 11217.14,-2274.83"/>
</g>
<!-- tp_layer3_gather_k_gpu6 -->
<g id="node470" class="node">
<title>tp_layer3_gather_k_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="11871.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="11871.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="11871.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11871.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11871.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_k_proj_gpu6&#45;&gt;tp_layer3_gather_k_gpu6 -->
<g id="edge601" class="edge">
<title>tp_layer3_k_proj_gpu6&#45;&gt;tp_layer3_gather_k_gpu6</title>
<path fill="none" stroke="black" d="M11778.26,-2353.15C11778.26,-2353.15 11778.26,-2275.78 11778.26,-2275.78"/>
<polygon fill="black" stroke="black" points="11781.76,-2275.78 11778.26,-2265.78 11774.76,-2275.78 11781.76,-2275.78"/>
</g>
<!-- tp_layer3_gather_v_gpu6 -->
<g id="node474" class="node">
<title>tp_layer3_gather_v_gpu6</title>
<ellipse fill="lightblue" stroke="black" cx="12209.26" cy="-1854.75" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="12209.26" y="-1873.55" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="12209.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12209.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12209.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_v_proj_gpu6&#45;&gt;tp_layer3_gather_v_gpu6 -->
<g id="edge605" class="edge">
<title>tp_layer3_v_proj_gpu6&#45;&gt;tp_layer3_gather_v_gpu6</title>
<path fill="none" stroke="black" d="M12322.76,-2353.05C12322.76,-2353.05 12322.76,-1910.31 12322.76,-1910.31"/>
<polygon fill="black" stroke="black" points="12326.26,-1910.31 12322.76,-1900.31 12319.26,-1910.31 12326.26,-1910.31"/>
</g>
<!-- tp_layer3_attn_scores_gpu6 -->
<g id="node469" class="node">
<title>tp_layer3_attn_scores_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="11640.76,-2070.92 11101.76,-2070.92 11101.76,-2002.92 11640.76,-2002.92 11640.76,-2070.92"/>
<text text-anchor="middle" x="11371.26" y="-2055.72" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="11371.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11371.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="11371.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_softmax_gpu6 -->
<g id="node472" class="node">
<title>tp_layer3_softmax_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="11640.76,-1888.75 11101.76,-1888.75 11101.76,-1820.75 11640.76,-1820.75 11640.76,-1888.75"/>
<text text-anchor="middle" x="11371.26" y="-1873.55" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="11371.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="11371.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="11371.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_attn_scores_gpu6&#45;&gt;tp_layer3_softmax_gpu6 -->
<g id="edge604" class="edge">
<title>tp_layer3_attn_scores_gpu6&#45;&gt;tp_layer3_softmax_gpu6</title>
<path fill="none" stroke="black" d="M11371.26,-2002.65C11371.26,-2002.65 11371.26,-1898.86 11371.26,-1898.86"/>
<polygon fill="black" stroke="black" points="11374.76,-1898.86 11371.26,-1888.86 11367.76,-1898.86 11374.76,-1898.86"/>
</g>
<!-- tp_layer3_gather_k_gpu6&#45;&gt;tp_layer3_attn_scores_gpu6 -->
<g id="edge603" class="edge">
<title>tp_layer3_gather_k_gpu6&#45;&gt;tp_layer3_attn_scores_gpu6</title>
<path fill="none" stroke="black" d="M11578.88,-2191.81C11578.88,-2191.81 11578.88,-2081.22 11578.88,-2081.22"/>
<polygon fill="black" stroke="black" points="11582.38,-2081.22 11578.88,-2071.22 11575.38,-2081.22 11582.38,-2081.22"/>
</g>
<!-- tp_layer3_gather_q_gpu6&#45;&gt;tp_layer3_attn_scores_gpu6 -->
<g id="edge602" class="edge">
<title>tp_layer3_gather_q_gpu6&#45;&gt;tp_layer3_attn_scores_gpu6</title>
<path fill="none" stroke="black" d="M11280.14,-2177.29C11280.14,-2177.29 11280.14,-2081.19 11280.14,-2081.19"/>
<polygon fill="black" stroke="black" points="11283.64,-2081.19 11280.14,-2071.19 11276.64,-2081.19 11283.64,-2081.19"/>
</g>
<!-- tp_layer3_attn_out_gpu6 -->
<g id="node473" class="node">
<title>tp_layer3_attn_out_gpu6</title>
<polygon fill="lightyellow" stroke="black" points="11634.76,-1720.67 11107.76,-1720.67 11107.76,-1652.67 11634.76,-1652.67 11634.76,-1720.67"/>
<text text-anchor="middle" x="11371.26" y="-1705.47" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="11371.26" y="-1690.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="11371.26" y="-1675.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="11371.26" y="-1660.47" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_softmax_gpu6&#45;&gt;tp_layer3_attn_out_gpu6 -->
<g id="edge606" class="edge">
<title>tp_layer3_softmax_gpu6&#45;&gt;tp_layer3_attn_out_gpu6</title>
<path fill="none" stroke="black" d="M11371.26,-1820.74C11371.26,-1820.74 11371.26,-1730.92 11371.26,-1730.92"/>
<polygon fill="black" stroke="black" points="11374.76,-1730.92 11371.26,-1720.92 11367.76,-1730.92 11374.76,-1730.92"/>
</g>
<!-- tp_layer3_out_proj_gpu6 -->
<g id="node475" class="node">
<title>tp_layer3_out_proj_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="10894.76,-1566.67 10405.76,-1566.67 10405.76,-1498.67 10894.76,-1498.67 10894.76,-1566.67"/>
<text text-anchor="middle" x="10650.26" y="-1551.47" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="10650.26" y="-1536.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="10650.26" y="-1521.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="10650.26" y="-1506.47" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_attn_out_gpu6&#45;&gt;tp_layer3_out_proj_gpu6 -->
<g id="edge608" class="edge">
<title>tp_layer3_attn_out_gpu6&#45;&gt;tp_layer3_out_proj_gpu6</title>
<path fill="none" stroke="black" d="M11107.65,-1675C10901.73,-1675 10650.26,-1675 10650.26,-1675 10650.26,-1675 10650.26,-1576.76 10650.26,-1576.76"/>
<polygon fill="black" stroke="black" points="10653.76,-1576.76 10650.26,-1566.76 10646.76,-1576.76 10653.76,-1576.76"/>
</g>
<!-- tp_layer3_gather_v_gpu6&#45;&gt;tp_layer3_attn_out_gpu6 -->
<g id="edge607" class="edge">
<title>tp_layer3_gather_v_gpu6&#45;&gt;tp_layer3_attn_out_gpu6</title>
<path fill="none" stroke="black" d="M11904.38,-1830.21C11904.38,-1783.41 11904.38,-1686 11904.38,-1686 11904.38,-1686 11645.09,-1686 11645.09,-1686"/>
<polygon fill="black" stroke="black" points="11645.09,-1682.5 11635.09,-1686 11645.09,-1689.5 11645.09,-1682.5"/>
</g>
<!-- tp_layer3_out_proj_gpu6&#45;&gt;tp_layer3_attn_all_reduce -->
<g id="edge627" class="edge">
<title>tp_layer3_out_proj_gpu6&#45;&gt;tp_layer3_attn_all_reduce</title>
<path fill="none" stroke="black" d="M10588.01,-1498.38C10588.01,-1455.6 10588.01,-1388 10588.01,-1388 10588.01,-1388 9165.29,-1388 9165.29,-1388"/>
<polygon fill="black" stroke="black" points="9165.29,-1384.5 9155.29,-1388 9165.29,-1391.5 9165.29,-1384.5"/>
</g>
<!-- tp_layer3_gather_q_gpu7 -->
<g id="node481" class="node">
<title>tp_layer3_gather_q_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="12774.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="12774.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="12774.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12774.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12774.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_q_proj_gpu7&#45;&gt;tp_layer3_gather_q_gpu7 -->
<g id="edge612" class="edge">
<title>tp_layer3_q_proj_gpu7&#45;&gt;tp_layer3_gather_q_gpu7</title>
<path fill="none" stroke="black" d="M12887.14,-2353.15C12887.14,-2353.15 12887.14,-2274.83 12887.14,-2274.83"/>
<polygon fill="black" stroke="black" points="12890.64,-2274.83 12887.14,-2264.83 12883.64,-2274.83 12890.64,-2274.83"/>
</g>
<!-- tp_layer3_gather_k_gpu7 -->
<g id="node480" class="node">
<title>tp_layer3_gather_k_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="13541.26" cy="-2219.08" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="13541.26" y="-2237.88" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="13541.26" y="-2222.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13541.26" y="-2207.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13541.26" y="-2192.88" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_k_proj_gpu7&#45;&gt;tp_layer3_gather_k_gpu7 -->
<g id="edge613" class="edge">
<title>tp_layer3_k_proj_gpu7&#45;&gt;tp_layer3_gather_k_gpu7</title>
<path fill="none" stroke="black" d="M13455.26,-2353.15C13455.26,-2353.15 13455.26,-2275.78 13455.26,-2275.78"/>
<polygon fill="black" stroke="black" points="13458.76,-2275.78 13455.26,-2265.78 13451.76,-2275.78 13458.76,-2275.78"/>
</g>
<!-- tp_layer3_gather_v_gpu7 -->
<g id="node484" class="node">
<title>tp_layer3_gather_v_gpu7</title>
<ellipse fill="lightblue" stroke="black" cx="13859.26" cy="-2036.92" rx="354.02" ry="48.17"/>
<text text-anchor="middle" x="13859.26" y="-2055.72" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="13859.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13859.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13859.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_v_proj_gpu7&#45;&gt;tp_layer3_gather_v_gpu7 -->
<g id="edge617" class="edge">
<title>tp_layer3_v_proj_gpu7&#45;&gt;tp_layer3_gather_v_gpu7</title>
<path fill="none" stroke="black" d="M14054.52,-2352.94C14054.52,-2352.94 14054.52,-2087.16 14054.52,-2087.16"/>
<polygon fill="black" stroke="black" points="14058.02,-2087.16 14054.52,-2077.16 14051.02,-2087.16 14058.02,-2087.16"/>
</g>
<!-- tp_layer3_attn_scores_gpu7 -->
<g id="node479" class="node">
<title>tp_layer3_attn_scores_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="13341.76,-2070.92 12802.76,-2070.92 12802.76,-2002.92 13341.76,-2002.92 13341.76,-2070.92"/>
<text text-anchor="middle" x="13072.26" y="-2055.72" font-family="Times,serif" font-size="14.00">QK^T / sqrt(d_k)</text>
<text text-anchor="middle" x="13072.26" y="-2040.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13072.26" y="-2025.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="13072.26" y="-2010.72" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_softmax_gpu7 -->
<g id="node482" class="node">
<title>tp_layer3_softmax_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="13341.76,-1888.75 12802.76,-1888.75 12802.76,-1820.75 13341.76,-1820.75 13341.76,-1888.75"/>
<text text-anchor="middle" x="13072.26" y="-1873.55" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="13072.26" y="-1858.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="13072.26" y="-1843.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="13072.26" y="-1828.55" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_attn_scores_gpu7&#45;&gt;tp_layer3_softmax_gpu7 -->
<g id="edge616" class="edge">
<title>tp_layer3_attn_scores_gpu7&#45;&gt;tp_layer3_softmax_gpu7</title>
<path fill="none" stroke="black" d="M13072.26,-2002.65C13072.26,-2002.65 13072.26,-1898.86 13072.26,-1898.86"/>
<polygon fill="black" stroke="black" points="13075.76,-1898.86 13072.26,-1888.86 13068.76,-1898.86 13075.76,-1898.86"/>
</g>
<!-- tp_layer3_gather_k_gpu7&#45;&gt;tp_layer3_attn_scores_gpu7 -->
<g id="edge615" class="edge">
<title>tp_layer3_gather_k_gpu7&#45;&gt;tp_layer3_attn_scores_gpu7</title>
<path fill="none" stroke="black" d="M13264.38,-2189C13264.38,-2189 13264.38,-2081.08 13264.38,-2081.08"/>
<polygon fill="black" stroke="black" points="13267.88,-2081.08 13264.38,-2071.08 13260.88,-2081.08 13267.88,-2081.08"/>
</g>
<!-- tp_layer3_gather_q_gpu7&#45;&gt;tp_layer3_attn_scores_gpu7 -->
<g id="edge614" class="edge">
<title>tp_layer3_gather_q_gpu7&#45;&gt;tp_layer3_attn_scores_gpu7</title>
<path fill="none" stroke="black" d="M12965.64,-2178.2C12965.64,-2178.2 12965.64,-2080.94 12965.64,-2080.94"/>
<polygon fill="black" stroke="black" points="12969.14,-2080.94 12965.64,-2070.94 12962.14,-2080.94 12969.14,-2080.94"/>
</g>
<!-- tp_layer3_attn_out_gpu7 -->
<g id="node483" class="node">
<title>tp_layer3_attn_out_gpu7</title>
<polygon fill="lightyellow" stroke="black" points="13335.76,-1720.67 12808.76,-1720.67 12808.76,-1652.67 13335.76,-1652.67 13335.76,-1720.67"/>
<text text-anchor="middle" x="13072.26" y="-1705.47" font-family="Times,serif" font-size="14.00">Attention×V</text>
<text text-anchor="middle" x="13072.26" y="-1690.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, heads=4, seq_len=2048, seq_len=2048]</text>
<text text-anchor="middle" x="13072.26" y="-1675.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="13072.26" y="-1660.47" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_softmax_gpu7&#45;&gt;tp_layer3_attn_out_gpu7 -->
<g id="edge618" class="edge">
<title>tp_layer3_softmax_gpu7&#45;&gt;tp_layer3_attn_out_gpu7</title>
<path fill="none" stroke="black" d="M13072.26,-1820.74C13072.26,-1820.74 13072.26,-1730.92 13072.26,-1730.92"/>
<polygon fill="black" stroke="black" points="13075.76,-1730.92 13072.26,-1720.92 13068.76,-1730.92 13075.76,-1730.92"/>
</g>
<!-- tp_layer3_out_proj_gpu7 -->
<g id="node485" class="node">
<title>tp_layer3_out_proj_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="12442.76,-1566.67 11953.76,-1566.67 11953.76,-1498.67 12442.76,-1498.67 12442.76,-1566.67"/>
<text text-anchor="middle" x="12198.26" y="-1551.47" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="12198.26" y="-1536.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, heads=4, d_k=128]</text>
<text text-anchor="middle" x="12198.26" y="-1521.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="12198.26" y="-1506.47" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_attn_out_gpu7&#45;&gt;tp_layer3_out_proj_gpu7 -->
<g id="edge620" class="edge">
<title>tp_layer3_attn_out_gpu7&#45;&gt;tp_layer3_out_proj_gpu7</title>
<path fill="none" stroke="black" d="M12917.51,-1652.34C12917.51,-1606.77 12917.51,-1532 12917.51,-1532 12917.51,-1532 12452.77,-1532 12452.77,-1532"/>
<polygon fill="black" stroke="black" points="12452.77,-1528.5 12442.77,-1532 12452.77,-1535.5 12452.77,-1528.5"/>
</g>
<!-- tp_layer3_gather_v_gpu7&#45;&gt;tp_layer3_attn_out_gpu7 -->
<g id="edge619" class="edge">
<title>tp_layer3_gather_v_gpu7&#45;&gt;tp_layer3_attn_out_gpu7</title>
<path fill="none" stroke="black" d="M13547.63,-2013.89C13547.63,-1935.82 13547.63,-1686 13547.63,-1686 13547.63,-1686 13346.01,-1686 13346.01,-1686"/>
<polygon fill="black" stroke="black" points="13346.01,-1682.5 13336.01,-1686 13346.01,-1689.5 13346.01,-1682.5"/>
</g>
<!-- tp_layer3_out_proj_gpu7&#45;&gt;tp_layer3_attn_all_reduce -->
<g id="edge628" class="edge">
<title>tp_layer3_out_proj_gpu7&#45;&gt;tp_layer3_attn_all_reduce</title>
<path fill="none" stroke="black" d="M12066.66,-1498.53C12066.66,-1449.25 12066.66,-1364 12066.66,-1364 12066.66,-1364 9209.97,-1364 9209.97,-1364"/>
<polygon fill="black" stroke="black" points="9209.97,-1360.5 9199.97,-1364 9209.97,-1367.5 9209.97,-1360.5"/>
</g>
<!-- tp_layer3_attn_all_reduce&#45;&gt;tp_layer3_attn_residual -->
<g id="edge630" class="edge">
<title>tp_layer3_attn_all_reduce&#45;&gt;tp_layer3_attn_residual</title>
<path fill="none" stroke="black" d="M9150.48,-1340C9718.97,-1340 10890.86,-1340 10890.86,-1340 10890.86,-1340 10890.86,-1198.02 10890.86,-1198.02"/>
<polygon fill="black" stroke="black" points="10894.36,-1198.02 10890.86,-1188.02 10887.36,-1198.02 10894.36,-1198.02"/>
</g>
<!-- tp_layer3_moe_norm -->
<g id="node488" class="node">
<title>tp_layer3_moe_norm</title>
<polygon fill="lightyellow" stroke="black" points="9637.76,-1048.33 9140.76,-1048.33 9140.76,-980.33 9637.76,-980.33 9637.76,-1048.33"/>
<text text-anchor="middle" x="9389.26" y="-1033.13" font-family="Times,serif" font-size="14.00">Layer Norm</text>
<text text-anchor="middle" x="9389.26" y="-1018.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9389.26" y="-1003.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9389.26" y="-988.13" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer3_attn_residual&#45;&gt;tp_layer3_moe_norm -->
<g id="edge631" class="edge">
<title>tp_layer3_attn_residual&#45;&gt;tp_layer3_moe_norm</title>
<path fill="none" stroke="black" d="M10886.67,-1182C10291.61,-1182 9500.76,-1182 9500.76,-1182 9500.76,-1182 9500.76,-1058.67 9500.76,-1058.67"/>
<polygon fill="black" stroke="black" points="9504.26,-1058.67 9500.76,-1048.67 9497.26,-1058.67 9504.26,-1058.67"/>
</g>
<!-- tp_layer3_final_residual -->
<g id="node538" class="node">
<title>tp_layer3_final_residual</title>
<ellipse fill="lightblue" stroke="black" cx="11533.26" cy="-202.08" rx="646.09" ry="48.17"/>
<text text-anchor="middle" x="11533.26" y="-220.88" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="11533.26" y="-205.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096], [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11533.26" y="-190.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11533.26" y="-175.88" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer3_attn_residual&#45;&gt;tp_layer3_final_residual -->
<g id="edge696" class="edge">
<title>tp_layer3_attn_residual&#45;&gt;tp_layer3_final_residual</title>
<path fill="none" stroke="black" d="M11360.26,-1135.79C11360.26,-1135.79 11360.26,-258.42 11360.26,-258.42"/>
<polygon fill="black" stroke="black" points="11363.76,-258.42 11360.26,-248.42 11356.76,-258.42 11363.76,-258.42"/>
</g>
<!-- tp_layer3_expert0_up -->
<g id="node489" class="node">
<title>tp_layer3_expert0_up</title>
<polygon fill="lightcoral" stroke="black" points="5130.26,-894.33 4624.26,-894.33 4624.26,-826.33 5130.26,-826.33 5130.26,-894.33"/>
<text text-anchor="middle" x="4877.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 0 Up</text>
<text text-anchor="middle" x="4877.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4877.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4877.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert0_up -->
<g id="edge632" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert0_up</title>
<path fill="none" stroke="black" d="M9140.65,-1040C8226.25,-1040 5102.51,-1040 5102.51,-1040 5102.51,-1040 5102.51,-904.55 5102.51,-904.55"/>
<polygon fill="black" stroke="black" points="5106.01,-904.55 5102.51,-894.55 5099.01,-904.55 5106.01,-904.55"/>
</g>
<!-- tp_layer3_expert1_up -->
<g id="node492" class="node">
<title>tp_layer3_expert1_up</title>
<polygon fill="lightcoral" stroke="black" points="5694.26,-894.33 5188.26,-894.33 5188.26,-826.33 5694.26,-826.33 5694.26,-894.33"/>
<text text-anchor="middle" x="5441.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 1 Up</text>
<text text-anchor="middle" x="5441.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5441.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5441.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert1_up -->
<g id="edge635" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert1_up</title>
<path fill="none" stroke="black" d="M9140.72,-1033C8302.11,-1033 5629.01,-1033 5629.01,-1033 5629.01,-1033 5629.01,-904.45 5629.01,-904.45"/>
<polygon fill="black" stroke="black" points="5632.51,-904.45 5629.01,-894.45 5625.51,-904.45 5632.51,-904.45"/>
</g>
<!-- tp_layer3_expert2_up -->
<g id="node495" class="node">
<title>tp_layer3_expert2_up</title>
<polygon fill="lightcoral" stroke="black" points="6258.26,-894.33 5752.26,-894.33 5752.26,-826.33 6258.26,-826.33 6258.26,-894.33"/>
<text text-anchor="middle" x="6005.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 2 Up</text>
<text text-anchor="middle" x="6005.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6005.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6005.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert2_up -->
<g id="edge638" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert2_up</title>
<path fill="none" stroke="black" d="M9140.62,-1025C8390.2,-1025 6199.39,-1025 6199.39,-1025 6199.39,-1025 6199.39,-904.45 6199.39,-904.45"/>
<polygon fill="black" stroke="black" points="6202.89,-904.45 6199.39,-894.45 6195.89,-904.45 6202.89,-904.45"/>
</g>
<!-- tp_layer3_expert3_up -->
<g id="node498" class="node">
<title>tp_layer3_expert3_up</title>
<polygon fill="lightcoral" stroke="black" points="6822.26,-894.33 6316.26,-894.33 6316.26,-826.33 6822.26,-826.33 6822.26,-894.33"/>
<text text-anchor="middle" x="6569.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 3 Up</text>
<text text-anchor="middle" x="6569.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6569.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6569.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert3_up -->
<g id="edge641" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert3_up</title>
<path fill="none" stroke="black" d="M9140.57,-1018C8485.31,-1018 6761.51,-1018 6761.51,-1018 6761.51,-1018 6761.51,-904.54 6761.51,-904.54"/>
<polygon fill="black" stroke="black" points="6765.01,-904.54 6761.51,-894.54 6758.01,-904.54 6765.01,-904.54"/>
</g>
<!-- tp_layer3_expert4_up -->
<g id="node501" class="node">
<title>tp_layer3_expert4_up</title>
<polygon fill="lightcoral" stroke="black" points="7386.26,-894.33 6880.26,-894.33 6880.26,-826.33 7386.26,-826.33 7386.26,-894.33"/>
<text text-anchor="middle" x="7133.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 4 Up</text>
<text text-anchor="middle" x="7133.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7133.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7133.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert4_up -->
<g id="edge644" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert4_up</title>
<path fill="none" stroke="black" d="M9140.75,-1010C8584.58,-1010 7288.01,-1010 7288.01,-1010 7288.01,-1010 7288.01,-904.67 7288.01,-904.67"/>
<polygon fill="black" stroke="black" points="7291.51,-904.67 7288.01,-894.67 7284.51,-904.67 7291.51,-904.67"/>
</g>
<!-- tp_layer3_expert5_up -->
<g id="node504" class="node">
<title>tp_layer3_expert5_up</title>
<polygon fill="lightcoral" stroke="black" points="7950.26,-894.33 7444.26,-894.33 7444.26,-826.33 7950.26,-826.33 7950.26,-894.33"/>
<text text-anchor="middle" x="7697.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 5 Up</text>
<text text-anchor="middle" x="7697.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7697.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7697.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert5_up -->
<g id="edge647" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert5_up</title>
<path fill="none" stroke="black" d="M9140.69,-1002C8709.51,-1002 7868.51,-1002 7868.51,-1002 7868.51,-1002 7868.51,-904.63 7868.51,-904.63"/>
<polygon fill="black" stroke="black" points="7872.01,-904.63 7868.51,-894.63 7865.01,-904.63 7872.01,-904.63"/>
</g>
<!-- tp_layer3_expert6_up -->
<g id="node507" class="node">
<title>tp_layer3_expert6_up</title>
<polygon fill="lightcoral" stroke="black" points="8514.26,-894.33 8008.26,-894.33 8008.26,-826.33 8514.26,-826.33 8514.26,-894.33"/>
<text text-anchor="middle" x="8261.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 6 Up</text>
<text text-anchor="middle" x="8261.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8261.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8261.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert6_up -->
<g id="edge650" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert6_up</title>
<path fill="none" stroke="black" d="M9140.74,-995C8879.36,-995 8505.54,-995 8505.54,-995 8505.54,-995 8505.54,-904.66 8505.54,-904.66"/>
<polygon fill="black" stroke="black" points="8509.04,-904.66 8505.54,-894.66 8502.04,-904.66 8509.04,-904.66"/>
</g>
<!-- tp_layer3_expert7_up -->
<g id="node510" class="node">
<title>tp_layer3_expert7_up</title>
<polygon fill="lightcoral" stroke="black" points="9078.26,-894.33 8572.26,-894.33 8572.26,-826.33 9078.26,-826.33 9078.26,-894.33"/>
<text text-anchor="middle" x="8825.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 7 Up</text>
<text text-anchor="middle" x="8825.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8825.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8825.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert7_up -->
<g id="edge653" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert7_up</title>
<path fill="none" stroke="black" d="M9140.65,-987C8989.45,-987 8825.26,-987 8825.26,-987 8825.26,-987 8825.26,-904.61 8825.26,-904.61"/>
<polygon fill="black" stroke="black" points="8828.76,-904.61 8825.26,-894.61 8821.76,-904.61 8828.76,-904.61"/>
</g>
<!-- tp_layer3_expert8_up -->
<g id="node513" class="node">
<title>tp_layer3_expert8_up</title>
<polygon fill="lightcoral" stroke="black" points="9642.26,-894.33 9136.26,-894.33 9136.26,-826.33 9642.26,-826.33 9642.26,-894.33"/>
<text text-anchor="middle" x="9389.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 8 Up</text>
<text text-anchor="middle" x="9389.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9389.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9389.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert8_up -->
<g id="edge656" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert8_up</title>
<path fill="none" stroke="black" d="M9389.26,-980.16C9389.26,-980.16 9389.26,-904.42 9389.26,-904.42"/>
<polygon fill="black" stroke="black" points="9392.76,-904.42 9389.26,-894.42 9385.76,-904.42 9392.76,-904.42"/>
</g>
<!-- tp_layer3_expert9_up -->
<g id="node516" class="node">
<title>tp_layer3_expert9_up</title>
<polygon fill="lightcoral" stroke="black" points="10206.26,-894.33 9700.26,-894.33 9700.26,-826.33 10206.26,-826.33 10206.26,-894.33"/>
<text text-anchor="middle" x="9953.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 9 Up</text>
<text text-anchor="middle" x="9953.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9953.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9953.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert9_up -->
<g id="edge659" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert9_up</title>
<path fill="none" stroke="black" d="M9637.8,-988C9713.21,-988 9776.51,-988 9776.51,-988 9776.51,-988 9776.51,-904.55 9776.51,-904.55"/>
<polygon fill="black" stroke="black" points="9780.01,-904.55 9776.51,-894.55 9773.01,-904.55 9780.01,-904.55"/>
</g>
<!-- tp_layer3_expert10_up -->
<g id="node519" class="node">
<title>tp_layer3_expert10_up</title>
<polygon fill="lightcoral" stroke="black" points="10770.26,-894.33 10264.26,-894.33 10264.26,-826.33 10770.26,-826.33 10770.26,-894.33"/>
<text text-anchor="middle" x="10517.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 10 Up</text>
<text text-anchor="middle" x="10517.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="10517.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10517.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert10_up -->
<g id="edge662" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert10_up</title>
<path fill="none" stroke="black" d="M9638.05,-997C9918.26,-997 10335.01,-997 10335.01,-997 10335.01,-997 10335.01,-904.47 10335.01,-904.47"/>
<polygon fill="black" stroke="black" points="10338.51,-904.47 10335.01,-894.47 10331.51,-904.47 10338.51,-904.47"/>
</g>
<!-- tp_layer3_expert11_up -->
<g id="node522" class="node">
<title>tp_layer3_expert11_up</title>
<polygon fill="lightcoral" stroke="black" points="11334.26,-894.33 10828.26,-894.33 10828.26,-826.33 11334.26,-826.33 11334.26,-894.33"/>
<text text-anchor="middle" x="11081.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 11 Up</text>
<text text-anchor="middle" x="11081.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11081.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11081.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert11_up -->
<g id="edge665" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert11_up</title>
<path fill="none" stroke="black" d="M9637.93,-1005C10056.74,-1005 10857.61,-1005 10857.61,-1005 10857.61,-1005 10857.61,-904.62 10857.61,-904.62"/>
<polygon fill="black" stroke="black" points="10861.11,-904.62 10857.61,-894.62 10854.11,-904.62 10861.11,-904.62"/>
</g>
<!-- tp_layer3_expert12_up -->
<g id="node525" class="node">
<title>tp_layer3_expert12_up</title>
<polygon fill="lightcoral" stroke="black" points="11898.26,-894.33 11392.26,-894.33 11392.26,-826.33 11898.26,-826.33 11898.26,-894.33"/>
<text text-anchor="middle" x="11645.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 12 Up</text>
<text text-anchor="middle" x="11645.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11645.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11645.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert12_up -->
<g id="edge668" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert12_up</title>
<path fill="none" stroke="black" d="M9637.96,-1014C10224.5,-1014 11645.26,-1014 11645.26,-1014 11645.26,-1014 11645.26,-904.44 11645.26,-904.44"/>
<polygon fill="black" stroke="black" points="11648.76,-904.44 11645.26,-894.44 11641.76,-904.44 11648.76,-904.44"/>
</g>
<!-- tp_layer3_expert13_up -->
<g id="node528" class="node">
<title>tp_layer3_expert13_up</title>
<polygon fill="lightcoral" stroke="black" points="12462.26,-894.33 11956.26,-894.33 11956.26,-826.33 12462.26,-826.33 12462.26,-894.33"/>
<text text-anchor="middle" x="12209.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 13 Up</text>
<text text-anchor="middle" x="12209.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12209.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12209.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert13_up -->
<g id="edge671" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert13_up</title>
<path fill="none" stroke="black" d="M9637.96,-1022C10302.24,-1022 12067.91,-1022 12067.91,-1022 12067.91,-1022 12067.91,-904.62 12067.91,-904.62"/>
<polygon fill="black" stroke="black" points="12071.41,-904.62 12067.91,-894.62 12064.41,-904.62 12071.41,-904.62"/>
</g>
<!-- tp_layer3_expert14_up -->
<g id="node531" class="node">
<title>tp_layer3_expert14_up</title>
<polygon fill="lightcoral" stroke="black" points="13026.26,-894.33 12520.26,-894.33 12520.26,-826.33 13026.26,-826.33 13026.26,-894.33"/>
<text text-anchor="middle" x="12773.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 14 Up</text>
<text text-anchor="middle" x="12773.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="12773.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12773.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert14_up -->
<g id="edge674" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert14_up</title>
<path fill="none" stroke="black" d="M9637.96,-1031C10382.39,-1031 12541.89,-1031 12541.89,-1031 12541.89,-1031 12541.89,-904.46 12541.89,-904.46"/>
<polygon fill="black" stroke="black" points="12545.39,-904.46 12541.89,-894.46 12538.39,-904.46 12545.39,-904.46"/>
</g>
<!-- tp_layer3_expert15_up -->
<g id="node534" class="node">
<title>tp_layer3_expert15_up</title>
<polygon fill="lightcoral" stroke="black" points="13590.26,-894.33 13084.26,-894.33 13084.26,-826.33 13590.26,-826.33 13590.26,-894.33"/>
<text text-anchor="middle" x="13337.26" y="-879.13" font-family="Times,serif" font-size="14.00">Expert 15 Up</text>
<text text-anchor="middle" x="13337.26" y="-864.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="13337.26" y="-849.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="13337.26" y="-834.13" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_moe_norm&#45;&gt;tp_layer3_expert15_up -->
<g id="edge677" class="edge">
<title>tp_layer3_moe_norm&#45;&gt;tp_layer3_expert15_up</title>
<path fill="none" stroke="black" d="M9638.11,-1039C10486.03,-1039 13210.01,-1039 13210.01,-1039 13210.01,-1039 13210.01,-904.36 13210.01,-904.36"/>
<polygon fill="black" stroke="black" points="13213.51,-904.36 13210.01,-894.36 13206.51,-904.36 13213.51,-904.36"/>
</g>
<!-- tp_layer3_expert0_activation -->
<g id="node490" class="node">
<title>tp_layer3_expert0_activation</title>
<polygon fill="lightyellow" stroke="black" points="5130.26,-740.33 4624.26,-740.33 4624.26,-672.33 5130.26,-672.33 5130.26,-740.33"/>
<text text-anchor="middle" x="4877.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="4877.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4877.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4877.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_expert0_up&#45;&gt;tp_layer3_expert0_activation -->
<g id="edge633" class="edge">
<title>tp_layer3_expert0_up&#45;&gt;tp_layer3_expert0_activation</title>
<path fill="none" stroke="black" d="M4877.26,-826.16C4877.26,-826.16 4877.26,-750.42 4877.26,-750.42"/>
<polygon fill="black" stroke="black" points="4880.76,-750.42 4877.26,-740.42 4873.76,-750.42 4880.76,-750.42"/>
</g>
<!-- tp_layer3_expert0_down -->
<g id="node491" class="node">
<title>tp_layer3_expert0_down</title>
<polygon fill="lightcoral" stroke="black" points="5138.26,-586.33 4644.26,-586.33 4644.26,-518.33 5138.26,-518.33 5138.26,-586.33"/>
<text text-anchor="middle" x="4891.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 0 Down</text>
<text text-anchor="middle" x="4891.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="4891.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4891.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_expert0_activation&#45;&gt;tp_layer3_expert0_down -->
<g id="edge634" class="edge">
<title>tp_layer3_expert0_activation&#45;&gt;tp_layer3_expert0_down</title>
<path fill="none" stroke="black" d="M4887.26,-672.16C4887.26,-672.16 4887.26,-596.42 4887.26,-596.42"/>
<polygon fill="black" stroke="black" points="4890.76,-596.42 4887.26,-586.42 4883.76,-596.42 4890.76,-596.42"/>
</g>
<!-- tp_layer3_moe_all_reduce -->
<g id="node537" class="node">
<title>tp_layer3_moe_all_reduce</title>
<ellipse fill="lightblue" stroke="black" cx="9389.26" cy="-384.25" rx="351.36" ry="48.17"/>
<text text-anchor="middle" x="9389.26" y="-403.05" font-family="Times,serif" font-size="14.00">All&#45;Reduce MoE</text>
<text text-anchor="middle" x="9389.26" y="-388.05" font-family="Times,serif" font-size="14.00">Input: 8×[512]</text>
<text text-anchor="middle" x="9389.26" y="-373.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="9389.26" y="-358.05" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer3_expert0_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge680" class="edge">
<title>tp_layer3_expert0_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M4891.26,-518.13C4891.26,-459.96 4891.26,-348 4891.26,-348 4891.26,-348 9148.07,-348 9148.07,-348"/>
<polygon fill="black" stroke="black" points="9148.07,-351.5 9158.07,-348 9148.07,-344.5 9148.07,-351.5"/>
</g>
<!-- tp_layer3_expert1_activation -->
<g id="node493" class="node">
<title>tp_layer3_expert1_activation</title>
<polygon fill="lightyellow" stroke="black" points="5694.26,-740.33 5188.26,-740.33 5188.26,-672.33 5694.26,-672.33 5694.26,-740.33"/>
<text text-anchor="middle" x="5441.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="5441.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5441.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5441.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_expert1_up&#45;&gt;tp_layer3_expert1_activation -->
<g id="edge636" class="edge">
<title>tp_layer3_expert1_up&#45;&gt;tp_layer3_expert1_activation</title>
<path fill="none" stroke="black" d="M5441.26,-826.16C5441.26,-826.16 5441.26,-750.42 5441.26,-750.42"/>
<polygon fill="black" stroke="black" points="5444.76,-750.42 5441.26,-740.42 5437.76,-750.42 5444.76,-750.42"/>
</g>
<!-- tp_layer3_expert1_down -->
<g id="node494" class="node">
<title>tp_layer3_expert1_down</title>
<polygon fill="lightcoral" stroke="black" points="5708.26,-586.33 5214.26,-586.33 5214.26,-518.33 5708.26,-518.33 5708.26,-586.33"/>
<text text-anchor="middle" x="5461.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 1 Down</text>
<text text-anchor="middle" x="5461.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="5461.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5461.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- tp_layer3_expert1_activation&#45;&gt;tp_layer3_expert1_down -->
<g id="edge637" class="edge">
<title>tp_layer3_expert1_activation&#45;&gt;tp_layer3_expert1_down</title>
<path fill="none" stroke="black" d="M5454.26,-672.16C5454.26,-672.16 5454.26,-596.42 5454.26,-596.42"/>
<polygon fill="black" stroke="black" points="5457.76,-596.42 5454.26,-586.42 5450.76,-596.42 5457.76,-596.42"/>
</g>
<!-- tp_layer3_expert1_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge681" class="edge">
<title>tp_layer3_expert1_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M5461.26,-517.95C5461.26,-462.63 5461.26,-360 5461.26,-360 5461.26,-360 9075.53,-360 9075.53,-360"/>
<polygon fill="black" stroke="black" points="9075.53,-363.5 9085.53,-360 9075.53,-356.5 9075.53,-363.5"/>
</g>
<!-- tp_layer3_expert2_activation -->
<g id="node496" class="node">
<title>tp_layer3_expert2_activation</title>
<polygon fill="lightyellow" stroke="black" points="6258.26,-740.33 5752.26,-740.33 5752.26,-672.33 6258.26,-672.33 6258.26,-740.33"/>
<text text-anchor="middle" x="6005.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="6005.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6005.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6005.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_expert2_up&#45;&gt;tp_layer3_expert2_activation -->
<g id="edge639" class="edge">
<title>tp_layer3_expert2_up&#45;&gt;tp_layer3_expert2_activation</title>
<path fill="none" stroke="black" d="M6005.26,-826.16C6005.26,-826.16 6005.26,-750.42 6005.26,-750.42"/>
<polygon fill="black" stroke="black" points="6008.76,-750.42 6005.26,-740.42 6001.76,-750.42 6008.76,-750.42"/>
</g>
<!-- tp_layer3_expert2_down -->
<g id="node497" class="node">
<title>tp_layer3_expert2_down</title>
<polygon fill="lightcoral" stroke="black" points="6269.26,-586.33 5775.26,-586.33 5775.26,-518.33 6269.26,-518.33 6269.26,-586.33"/>
<text text-anchor="middle" x="6022.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 2 Down</text>
<text text-anchor="middle" x="6022.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6022.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6022.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_expert2_activation&#45;&gt;tp_layer3_expert2_down -->
<g id="edge640" class="edge">
<title>tp_layer3_expert2_activation&#45;&gt;tp_layer3_expert2_down</title>
<path fill="none" stroke="black" d="M6016.76,-672.16C6016.76,-672.16 6016.76,-596.42 6016.76,-596.42"/>
<polygon fill="black" stroke="black" points="6020.26,-596.42 6016.76,-586.42 6013.26,-596.42 6020.26,-596.42"/>
</g>
<!-- tp_layer3_expert2_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge682" class="edge">
<title>tp_layer3_expert2_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M6022.26,-517.99C6022.26,-465.67 6022.26,-372 6022.26,-372 6022.26,-372 9039.06,-372 9039.06,-372"/>
<polygon fill="black" stroke="black" points="9039.06,-375.5 9049.06,-372 9039.06,-368.5 9039.06,-375.5"/>
</g>
<!-- tp_layer3_expert3_activation -->
<g id="node499" class="node">
<title>tp_layer3_expert3_activation</title>
<polygon fill="lightyellow" stroke="black" points="6822.26,-740.33 6316.26,-740.33 6316.26,-672.33 6822.26,-672.33 6822.26,-740.33"/>
<text text-anchor="middle" x="6569.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="6569.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6569.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6569.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_expert3_up&#45;&gt;tp_layer3_expert3_activation -->
<g id="edge642" class="edge">
<title>tp_layer3_expert3_up&#45;&gt;tp_layer3_expert3_activation</title>
<path fill="none" stroke="black" d="M6569.26,-826.16C6569.26,-826.16 6569.26,-750.42 6569.26,-750.42"/>
<polygon fill="black" stroke="black" points="6572.76,-750.42 6569.26,-740.42 6565.76,-750.42 6572.76,-750.42"/>
</g>
<!-- tp_layer3_expert3_down -->
<g id="node500" class="node">
<title>tp_layer3_expert3_down</title>
<polygon fill="lightcoral" stroke="black" points="6825.26,-586.33 6331.26,-586.33 6331.26,-518.33 6825.26,-518.33 6825.26,-586.33"/>
<text text-anchor="middle" x="6578.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 3 Down</text>
<text text-anchor="middle" x="6578.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="6578.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6578.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- tp_layer3_expert3_activation&#45;&gt;tp_layer3_expert3_down -->
<g id="edge643" class="edge">
<title>tp_layer3_expert3_activation&#45;&gt;tp_layer3_expert3_down</title>
<path fill="none" stroke="black" d="M6576.76,-672.16C6576.76,-672.16 6576.76,-596.42 6576.76,-596.42"/>
<polygon fill="black" stroke="black" points="6580.26,-596.42 6576.76,-586.42 6573.26,-596.42 6580.26,-596.42"/>
</g>
<!-- tp_layer3_expert3_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge683" class="edge">
<title>tp_layer3_expert3_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M6578.26,-518.27C6578.26,-469.08 6578.26,-384 6578.26,-384 6578.26,-384 9027.51,-384 9027.51,-384"/>
<polygon fill="black" stroke="black" points="9027.51,-387.5 9037.51,-384 9027.51,-380.5 9027.51,-387.5"/>
</g>
<!-- tp_layer3_expert4_activation -->
<g id="node502" class="node">
<title>tp_layer3_expert4_activation</title>
<polygon fill="lightyellow" stroke="black" points="7386.26,-740.33 6880.26,-740.33 6880.26,-672.33 7386.26,-672.33 7386.26,-740.33"/>
<text text-anchor="middle" x="7133.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="7133.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7133.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7133.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_expert4_up&#45;&gt;tp_layer3_expert4_activation -->
<g id="edge645" class="edge">
<title>tp_layer3_expert4_up&#45;&gt;tp_layer3_expert4_activation</title>
<path fill="none" stroke="black" d="M7133.26,-826.16C7133.26,-826.16 7133.26,-750.42 7133.26,-750.42"/>
<polygon fill="black" stroke="black" points="7136.76,-750.42 7133.26,-740.42 7129.76,-750.42 7136.76,-750.42"/>
</g>
<!-- tp_layer3_expert4_down -->
<g id="node503" class="node">
<title>tp_layer3_expert4_down</title>
<polygon fill="lightcoral" stroke="black" points="7395.26,-586.33 6901.26,-586.33 6901.26,-518.33 7395.26,-518.33 7395.26,-586.33"/>
<text text-anchor="middle" x="7148.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 4 Down</text>
<text text-anchor="middle" x="7148.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7148.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7148.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_expert4_activation&#45;&gt;tp_layer3_expert4_down -->
<g id="edge646" class="edge">
<title>tp_layer3_expert4_activation&#45;&gt;tp_layer3_expert4_down</title>
<path fill="none" stroke="black" d="M7143.76,-672.16C7143.76,-672.16 7143.76,-596.42 7143.76,-596.42"/>
<polygon fill="black" stroke="black" points="7147.26,-596.42 7143.76,-586.42 7140.26,-596.42 7147.26,-596.42"/>
</g>
<!-- tp_layer3_expert4_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge684" class="edge">
<title>tp_layer3_expert4_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M7148.26,-518.03C7148.26,-472.01 7148.26,-396 7148.26,-396 7148.26,-396 9038.29,-396 9038.29,-396"/>
<polygon fill="black" stroke="black" points="9038.29,-399.5 9048.29,-396 9038.29,-392.5 9038.29,-399.5"/>
</g>
<!-- tp_layer3_expert5_activation -->
<g id="node505" class="node">
<title>tp_layer3_expert5_activation</title>
<polygon fill="lightyellow" stroke="black" points="7950.26,-740.33 7444.26,-740.33 7444.26,-672.33 7950.26,-672.33 7950.26,-740.33"/>
<text text-anchor="middle" x="7697.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="7697.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7697.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7697.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_expert5_up&#45;&gt;tp_layer3_expert5_activation -->
<g id="edge648" class="edge">
<title>tp_layer3_expert5_up&#45;&gt;tp_layer3_expert5_activation</title>
<path fill="none" stroke="black" d="M7697.26,-826.16C7697.26,-826.16 7697.26,-750.42 7697.26,-750.42"/>
<polygon fill="black" stroke="black" points="7700.76,-750.42 7697.26,-740.42 7693.76,-750.42 7700.76,-750.42"/>
</g>
<!-- tp_layer3_expert5_down -->
<g id="node506" class="node">
<title>tp_layer3_expert5_down</title>
<polygon fill="lightcoral" stroke="black" points="7953.26,-586.33 7459.26,-586.33 7459.26,-518.33 7953.26,-518.33 7953.26,-586.33"/>
<text text-anchor="middle" x="7706.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 5 Down</text>
<text text-anchor="middle" x="7706.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="7706.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7706.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- tp_layer3_expert5_activation&#45;&gt;tp_layer3_expert5_down -->
<g id="edge649" class="edge">
<title>tp_layer3_expert5_activation&#45;&gt;tp_layer3_expert5_down</title>
<path fill="none" stroke="black" d="M7704.76,-672.16C7704.76,-672.16 7704.76,-596.42 7704.76,-596.42"/>
<polygon fill="black" stroke="black" points="7708.26,-596.42 7704.76,-586.42 7701.26,-596.42 7708.26,-596.42"/>
</g>
<!-- tp_layer3_expert5_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge685" class="edge">
<title>tp_layer3_expert5_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M7706.26,-518.13C7706.26,-475.45 7706.26,-408 7706.26,-408 7706.26,-408 9073.51,-408 9073.51,-408"/>
<polygon fill="black" stroke="black" points="9073.51,-411.5 9083.51,-408 9073.51,-404.5 9073.51,-411.5"/>
</g>
<!-- tp_layer3_expert6_activation -->
<g id="node508" class="node">
<title>tp_layer3_expert6_activation</title>
<polygon fill="lightyellow" stroke="black" points="8514.26,-740.33 8008.26,-740.33 8008.26,-672.33 8514.26,-672.33 8514.26,-740.33"/>
<text text-anchor="middle" x="8261.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="8261.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8261.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8261.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_expert6_up&#45;&gt;tp_layer3_expert6_activation -->
<g id="edge651" class="edge">
<title>tp_layer3_expert6_up&#45;&gt;tp_layer3_expert6_activation</title>
<path fill="none" stroke="black" d="M8261.26,-826.16C8261.26,-826.16 8261.26,-750.42 8261.26,-750.42"/>
<polygon fill="black" stroke="black" points="8264.76,-750.42 8261.26,-740.42 8257.76,-750.42 8264.76,-750.42"/>
</g>
<!-- tp_layer3_expert6_down -->
<g id="node509" class="node">
<title>tp_layer3_expert6_down</title>
<polygon fill="lightcoral" stroke="black" points="8514.26,-586.33 8020.26,-586.33 8020.26,-518.33 8514.26,-518.33 8514.26,-586.33"/>
<text text-anchor="middle" x="8267.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 6 Down</text>
<text text-anchor="middle" x="8267.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8267.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8267.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_expert6_activation&#45;&gt;tp_layer3_expert6_down -->
<g id="edge652" class="edge">
<title>tp_layer3_expert6_activation&#45;&gt;tp_layer3_expert6_down</title>
<path fill="none" stroke="black" d="M8267.26,-672.16C8267.26,-672.16 8267.26,-596.42 8267.26,-596.42"/>
<polygon fill="black" stroke="black" points="8270.76,-596.42 8267.26,-586.42 8263.76,-596.42 8270.76,-596.42"/>
</g>
<!-- tp_layer3_expert6_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge686" class="edge">
<title>tp_layer3_expert6_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M8267.26,-518.25C8267.26,-479.04 8267.26,-420 8267.26,-420 8267.26,-420 9144.05,-420 9144.05,-420"/>
<polygon fill="black" stroke="black" points="9144.05,-423.5 9154.05,-420 9144.05,-416.5 9144.05,-423.5"/>
</g>
<!-- tp_layer3_expert7_activation -->
<g id="node511" class="node">
<title>tp_layer3_expert7_activation</title>
<polygon fill="lightyellow" stroke="black" points="9078.26,-740.33 8572.26,-740.33 8572.26,-672.33 9078.26,-672.33 9078.26,-740.33"/>
<text text-anchor="middle" x="8825.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="8825.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8825.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8825.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_expert7_up&#45;&gt;tp_layer3_expert7_activation -->
<g id="edge654" class="edge">
<title>tp_layer3_expert7_up&#45;&gt;tp_layer3_expert7_activation</title>
<path fill="none" stroke="black" d="M8825.26,-826.16C8825.26,-826.16 8825.26,-750.42 8825.26,-750.42"/>
<polygon fill="black" stroke="black" points="8828.76,-750.42 8825.26,-740.42 8821.76,-750.42 8828.76,-750.42"/>
</g>
<!-- tp_layer3_expert7_down -->
<g id="node512" class="node">
<title>tp_layer3_expert7_down</title>
<polygon fill="lightcoral" stroke="black" points="9078.26,-586.33 8584.26,-586.33 8584.26,-518.33 9078.26,-518.33 9078.26,-586.33"/>
<text text-anchor="middle" x="8831.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 7 Down</text>
<text text-anchor="middle" x="8831.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="8831.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8831.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- tp_layer3_expert7_activation&#45;&gt;tp_layer3_expert7_down -->
<g id="edge655" class="edge">
<title>tp_layer3_expert7_activation&#45;&gt;tp_layer3_expert7_down</title>
<path fill="none" stroke="black" d="M8831.26,-672.16C8831.26,-672.16 8831.26,-596.42 8831.26,-596.42"/>
<polygon fill="black" stroke="black" points="8834.76,-596.42 8831.26,-586.42 8827.76,-596.42 8834.76,-596.42"/>
</g>
<!-- tp_layer3_expert7_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge687" class="edge">
<title>tp_layer3_expert7_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M9058.04,-518.32C9058.04,-518.32 9058.04,-410.4 9058.04,-410.4"/>
<polygon fill="black" stroke="black" points="9061.54,-410.4 9058.04,-400.4 9054.54,-410.4 9061.54,-410.4"/>
</g>
<!-- tp_layer3_expert8_activation -->
<g id="node514" class="node">
<title>tp_layer3_expert8_activation</title>
<polygon fill="lightyellow" stroke="black" points="9642.26,-740.33 9136.26,-740.33 9136.26,-672.33 9642.26,-672.33 9642.26,-740.33"/>
<text text-anchor="middle" x="9389.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="9389.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9389.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9389.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_expert8_up&#45;&gt;tp_layer3_expert8_activation -->
<g id="edge657" class="edge">
<title>tp_layer3_expert8_up&#45;&gt;tp_layer3_expert8_activation</title>
<path fill="none" stroke="black" d="M9389.26,-826.16C9389.26,-826.16 9389.26,-750.42 9389.26,-750.42"/>
<polygon fill="black" stroke="black" points="9392.76,-750.42 9389.26,-740.42 9385.76,-750.42 9392.76,-750.42"/>
</g>
<!-- tp_layer3_expert8_down -->
<g id="node515" class="node">
<title>tp_layer3_expert8_down</title>
<polygon fill="lightcoral" stroke="black" points="9636.26,-586.33 9142.26,-586.33 9142.26,-518.33 9636.26,-518.33 9636.26,-586.33"/>
<text text-anchor="middle" x="9389.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 8 Down</text>
<text text-anchor="middle" x="9389.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9389.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9389.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_expert8_activation&#45;&gt;tp_layer3_expert8_down -->
<g id="edge658" class="edge">
<title>tp_layer3_expert8_activation&#45;&gt;tp_layer3_expert8_down</title>
<path fill="none" stroke="black" d="M9389.26,-672.16C9389.26,-672.16 9389.26,-596.42 9389.26,-596.42"/>
<polygon fill="black" stroke="black" points="9392.76,-596.42 9389.26,-586.42 9385.76,-596.42 9392.76,-596.42"/>
</g>
<!-- tp_layer3_expert8_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge688" class="edge">
<title>tp_layer3_expert8_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M9389.26,-518.32C9389.26,-518.32 9389.26,-442.55 9389.26,-442.55"/>
<polygon fill="black" stroke="black" points="9392.76,-442.55 9389.26,-432.55 9385.76,-442.55 9392.76,-442.55"/>
</g>
<!-- tp_layer3_expert9_activation -->
<g id="node517" class="node">
<title>tp_layer3_expert9_activation</title>
<polygon fill="lightyellow" stroke="black" points="10206.26,-740.33 9700.26,-740.33 9700.26,-672.33 10206.26,-672.33 10206.26,-740.33"/>
<text text-anchor="middle" x="9953.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="9953.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9953.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9953.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_expert9_up&#45;&gt;tp_layer3_expert9_activation -->
<g id="edge660" class="edge">
<title>tp_layer3_expert9_up&#45;&gt;tp_layer3_expert9_activation</title>
<path fill="none" stroke="black" d="M9953.26,-826.16C9953.26,-826.16 9953.26,-750.42 9953.26,-750.42"/>
<polygon fill="black" stroke="black" points="9956.76,-750.42 9953.26,-740.42 9949.76,-750.42 9956.76,-750.42"/>
</g>
<!-- tp_layer3_expert9_down -->
<g id="node518" class="node">
<title>tp_layer3_expert9_down</title>
<polygon fill="lightcoral" stroke="black" points="10194.26,-586.33 9700.26,-586.33 9700.26,-518.33 10194.26,-518.33 10194.26,-586.33"/>
<text text-anchor="middle" x="9947.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 9 Down</text>
<text text-anchor="middle" x="9947.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="9947.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="9947.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- tp_layer3_expert9_activation&#45;&gt;tp_layer3_expert9_down -->
<g id="edge661" class="edge">
<title>tp_layer3_expert9_activation&#45;&gt;tp_layer3_expert9_down</title>
<path fill="none" stroke="black" d="M9947.26,-672.16C9947.26,-672.16 9947.26,-596.42 9947.26,-596.42"/>
<polygon fill="black" stroke="black" points="9950.76,-596.42 9947.26,-586.42 9943.76,-596.42 9950.76,-596.42"/>
</g>
<!-- tp_layer3_expert9_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge689" class="edge">
<title>tp_layer3_expert9_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M9720.48,-518.32C9720.48,-518.32 9720.48,-410.4 9720.48,-410.4"/>
<polygon fill="black" stroke="black" points="9723.98,-410.4 9720.48,-400.4 9716.98,-410.4 9723.98,-410.4"/>
</g>
<!-- tp_layer3_expert10_activation -->
<g id="node520" class="node">
<title>tp_layer3_expert10_activation</title>
<polygon fill="lightyellow" stroke="black" points="10770.26,-740.33 10264.26,-740.33 10264.26,-672.33 10770.26,-672.33 10770.26,-740.33"/>
<text text-anchor="middle" x="10517.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="10517.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10517.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10517.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_expert10_up&#45;&gt;tp_layer3_expert10_activation -->
<g id="edge663" class="edge">
<title>tp_layer3_expert10_up&#45;&gt;tp_layer3_expert10_activation</title>
<path fill="none" stroke="black" d="M10517.26,-826.16C10517.26,-826.16 10517.26,-750.42 10517.26,-750.42"/>
<polygon fill="black" stroke="black" points="10520.76,-750.42 10517.26,-740.42 10513.76,-750.42 10520.76,-750.42"/>
</g>
<!-- tp_layer3_expert10_down -->
<g id="node521" class="node">
<title>tp_layer3_expert10_down</title>
<polygon fill="lightcoral" stroke="black" points="10755.26,-586.33 10261.26,-586.33 10261.26,-518.33 10755.26,-518.33 10755.26,-586.33"/>
<text text-anchor="middle" x="10508.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 10 Down</text>
<text text-anchor="middle" x="10508.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="10508.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="10508.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_expert10_activation&#45;&gt;tp_layer3_expert10_down -->
<g id="edge664" class="edge">
<title>tp_layer3_expert10_activation&#45;&gt;tp_layer3_expert10_down</title>
<path fill="none" stroke="black" d="M10509.76,-672.16C10509.76,-672.16 10509.76,-596.42 10509.76,-596.42"/>
<polygon fill="black" stroke="black" points="10513.26,-596.42 10509.76,-586.42 10506.26,-596.42 10513.26,-596.42"/>
</g>
<!-- tp_layer3_expert10_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge690" class="edge">
<title>tp_layer3_expert10_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M10508.26,-518.25C10508.26,-479.04 10508.26,-420 10508.26,-420 10508.26,-420 9634.52,-420 9634.52,-420"/>
<polygon fill="black" stroke="black" points="9634.52,-416.5 9624.52,-420 9634.52,-423.5 9634.52,-416.5"/>
</g>
<!-- tp_layer3_expert11_activation -->
<g id="node523" class="node">
<title>tp_layer3_expert11_activation</title>
<polygon fill="lightyellow" stroke="black" points="11334.26,-740.33 10828.26,-740.33 10828.26,-672.33 11334.26,-672.33 11334.26,-740.33"/>
<text text-anchor="middle" x="11081.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="11081.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11081.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11081.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_expert11_up&#45;&gt;tp_layer3_expert11_activation -->
<g id="edge666" class="edge">
<title>tp_layer3_expert11_up&#45;&gt;tp_layer3_expert11_activation</title>
<path fill="none" stroke="black" d="M11081.26,-826.16C11081.26,-826.16 11081.26,-750.42 11081.26,-750.42"/>
<polygon fill="black" stroke="black" points="11084.76,-750.42 11081.26,-740.42 11077.76,-750.42 11084.76,-750.42"/>
</g>
<!-- tp_layer3_expert11_down -->
<g id="node524" class="node">
<title>tp_layer3_expert11_down</title>
<polygon fill="lightcoral" stroke="black" points="11317.26,-586.33 10823.26,-586.33 10823.26,-518.33 11317.26,-518.33 11317.26,-586.33"/>
<text text-anchor="middle" x="11070.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 11 Down</text>
<text text-anchor="middle" x="11070.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11070.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="11070.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- tp_layer3_expert11_activation&#45;&gt;tp_layer3_expert11_down -->
<g id="edge667" class="edge">
<title>tp_layer3_expert11_activation&#45;&gt;tp_layer3_expert11_down</title>
<path fill="none" stroke="black" d="M11072.76,-672.16C11072.76,-672.16 11072.76,-596.42 11072.76,-596.42"/>
<polygon fill="black" stroke="black" points="11076.26,-596.42 11072.76,-586.42 11069.26,-596.42 11076.26,-596.42"/>
</g>
<!-- tp_layer3_expert11_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge691" class="edge">
<title>tp_layer3_expert11_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M10855.11,-518.13C10855.11,-475.45 10855.11,-408 10855.11,-408 10855.11,-408 9705.21,-408 9705.21,-408"/>
<polygon fill="black" stroke="black" points="9705.21,-404.5 9695.21,-408 9705.21,-411.5 9705.21,-404.5"/>
</g>
<!-- tp_layer3_expert12_activation -->
<g id="node526" class="node">
<title>tp_layer3_expert12_activation</title>
<polygon fill="lightyellow" stroke="black" points="11898.26,-740.33 11392.26,-740.33 11392.26,-672.33 11898.26,-672.33 11898.26,-740.33"/>
<text text-anchor="middle" x="11645.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="11645.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11645.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11645.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_expert12_up&#45;&gt;tp_layer3_expert12_activation -->
<g id="edge669" class="edge">
<title>tp_layer3_expert12_up&#45;&gt;tp_layer3_expert12_activation</title>
<path fill="none" stroke="black" d="M11645.26,-826.16C11645.26,-826.16 11645.26,-750.42 11645.26,-750.42"/>
<polygon fill="black" stroke="black" points="11648.76,-750.42 11645.26,-740.42 11641.76,-750.42 11648.76,-750.42"/>
</g>
<!-- tp_layer3_expert12_down -->
<g id="node527" class="node">
<title>tp_layer3_expert12_down</title>
<polygon fill="lightcoral" stroke="black" points="11880.26,-586.33 11386.26,-586.33 11386.26,-518.33 11880.26,-518.33 11880.26,-586.33"/>
<text text-anchor="middle" x="11633.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 12 Down</text>
<text text-anchor="middle" x="11633.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="11633.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="11633.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_expert12_activation&#45;&gt;tp_layer3_expert12_down -->
<g id="edge670" class="edge">
<title>tp_layer3_expert12_activation&#45;&gt;tp_layer3_expert12_down</title>
<path fill="none" stroke="black" d="M11636.26,-672.16C11636.26,-672.16 11636.26,-596.42 11636.26,-596.42"/>
<polygon fill="black" stroke="black" points="11639.76,-596.42 11636.26,-586.42 11632.76,-596.42 11639.76,-596.42"/>
</g>
<!-- tp_layer3_expert12_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge692" class="edge">
<title>tp_layer3_expert12_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M11633.26,-518.03C11633.26,-472.01 11633.26,-396 11633.26,-396 11633.26,-396 9740.08,-396 9740.08,-396"/>
<polygon fill="black" stroke="black" points="9740.08,-392.5 9730.08,-396 9740.08,-399.5 9740.08,-392.5"/>
</g>
<!-- tp_layer3_expert13_activation -->
<g id="node529" class="node">
<title>tp_layer3_expert13_activation</title>
<polygon fill="lightyellow" stroke="black" points="12462.26,-740.33 11956.26,-740.33 11956.26,-672.33 12462.26,-672.33 12462.26,-740.33"/>
<text text-anchor="middle" x="12209.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="12209.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12209.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12209.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_expert13_up&#45;&gt;tp_layer3_expert13_activation -->
<g id="edge672" class="edge">
<title>tp_layer3_expert13_up&#45;&gt;tp_layer3_expert13_activation</title>
<path fill="none" stroke="black" d="M12209.26,-826.16C12209.26,-826.16 12209.26,-750.42 12209.26,-750.42"/>
<polygon fill="black" stroke="black" points="12212.76,-750.42 12209.26,-740.42 12205.76,-750.42 12212.76,-750.42"/>
</g>
<!-- tp_layer3_expert13_down -->
<g id="node530" class="node">
<title>tp_layer3_expert13_down</title>
<polygon fill="lightcoral" stroke="black" points="12444.26,-586.33 11950.26,-586.33 11950.26,-518.33 12444.26,-518.33 12444.26,-586.33"/>
<text text-anchor="middle" x="12197.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 13 Down</text>
<text text-anchor="middle" x="12197.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12197.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="12197.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- tp_layer3_expert13_activation&#45;&gt;tp_layer3_expert13_down -->
<g id="edge673" class="edge">
<title>tp_layer3_expert13_activation&#45;&gt;tp_layer3_expert13_down</title>
<path fill="none" stroke="black" d="M12200.26,-672.16C12200.26,-672.16 12200.26,-596.42 12200.26,-596.42"/>
<polygon fill="black" stroke="black" points="12203.76,-596.42 12200.26,-586.42 12196.76,-596.42 12203.76,-596.42"/>
</g>
<!-- tp_layer3_expert13_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge693" class="edge">
<title>tp_layer3_expert13_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M12064.91,-518.27C12064.91,-469.08 12064.91,-384 12064.91,-384 12064.91,-384 9750.77,-384 9750.77,-384"/>
<polygon fill="black" stroke="black" points="9750.77,-380.5 9740.77,-384 9750.77,-387.5 9750.77,-380.5"/>
</g>
<!-- tp_layer3_expert14_activation -->
<g id="node532" class="node">
<title>tp_layer3_expert14_activation</title>
<polygon fill="lightyellow" stroke="black" points="13026.26,-740.33 12520.26,-740.33 12520.26,-672.33 13026.26,-672.33 13026.26,-740.33"/>
<text text-anchor="middle" x="12773.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="12773.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12773.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12773.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_expert14_up&#45;&gt;tp_layer3_expert14_activation -->
<g id="edge675" class="edge">
<title>tp_layer3_expert14_up&#45;&gt;tp_layer3_expert14_activation</title>
<path fill="none" stroke="black" d="M12773.26,-826.16C12773.26,-826.16 12773.26,-750.42 12773.26,-750.42"/>
<polygon fill="black" stroke="black" points="12776.76,-750.42 12773.26,-740.42 12769.76,-750.42 12776.76,-750.42"/>
</g>
<!-- tp_layer3_expert14_down -->
<g id="node533" class="node">
<title>tp_layer3_expert14_down</title>
<polygon fill="lightcoral" stroke="black" points="13008.26,-586.33 12514.26,-586.33 12514.26,-518.33 13008.26,-518.33 13008.26,-586.33"/>
<text text-anchor="middle" x="12761.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 14 Down</text>
<text text-anchor="middle" x="12761.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="12761.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="12761.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_expert14_activation&#45;&gt;tp_layer3_expert14_down -->
<g id="edge676" class="edge">
<title>tp_layer3_expert14_activation&#45;&gt;tp_layer3_expert14_down</title>
<path fill="none" stroke="black" d="M12764.26,-672.16C12764.26,-672.16 12764.26,-596.42 12764.26,-596.42"/>
<polygon fill="black" stroke="black" points="12767.76,-596.42 12764.26,-586.42 12760.76,-596.42 12767.76,-596.42"/>
</g>
<!-- tp_layer3_expert14_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge694" class="edge">
<title>tp_layer3_expert14_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M12761.26,-517.99C12761.26,-465.67 12761.26,-372 12761.26,-372 12761.26,-372 9739.19,-372 9739.19,-372"/>
<polygon fill="black" stroke="black" points="9739.19,-368.5 9729.19,-372 9739.19,-375.5 9739.19,-368.5"/>
</g>
<!-- tp_layer3_expert15_activation -->
<g id="node535" class="node">
<title>tp_layer3_expert15_activation</title>
<polygon fill="lightyellow" stroke="black" points="13590.26,-740.33 13084.26,-740.33 13084.26,-672.33 13590.26,-672.33 13590.26,-740.33"/>
<text text-anchor="middle" x="13337.26" y="-725.13" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="13337.26" y="-710.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="13337.26" y="-695.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="13337.26" y="-680.13" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_expert15_up&#45;&gt;tp_layer3_expert15_activation -->
<g id="edge678" class="edge">
<title>tp_layer3_expert15_up&#45;&gt;tp_layer3_expert15_activation</title>
<path fill="none" stroke="black" d="M13337.26,-826.16C13337.26,-826.16 13337.26,-750.42 13337.26,-750.42"/>
<polygon fill="black" stroke="black" points="13340.76,-750.42 13337.26,-740.42 13333.76,-750.42 13340.76,-750.42"/>
</g>
<!-- tp_layer3_expert15_down -->
<g id="node536" class="node">
<title>tp_layer3_expert15_down</title>
<polygon fill="lightcoral" stroke="black" points="13572.26,-586.33 13078.26,-586.33 13078.26,-518.33 13572.26,-518.33 13572.26,-586.33"/>
<text text-anchor="middle" x="13325.26" y="-571.13" font-family="Times,serif" font-size="14.00">Expert 15 Down</text>
<text text-anchor="middle" x="13325.26" y="-556.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=16384]</text>
<text text-anchor="middle" x="13325.26" y="-541.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="13325.26" y="-526.13" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- tp_layer3_expert15_activation&#45;&gt;tp_layer3_expert15_down -->
<g id="edge679" class="edge">
<title>tp_layer3_expert15_activation&#45;&gt;tp_layer3_expert15_down</title>
<path fill="none" stroke="black" d="M13328.26,-672.16C13328.26,-672.16 13328.26,-596.42 13328.26,-596.42"/>
<polygon fill="black" stroke="black" points="13331.76,-596.42 13328.26,-586.42 13324.76,-596.42 13331.76,-596.42"/>
</g>
<!-- tp_layer3_expert15_down&#45;&gt;tp_layer3_moe_all_reduce -->
<g id="edge695" class="edge">
<title>tp_layer3_expert15_down&#45;&gt;tp_layer3_moe_all_reduce</title>
<path fill="none" stroke="black" d="M13325.26,-517.95C13325.26,-462.63 13325.26,-360 13325.26,-360 13325.26,-360 9702.8,-360 9702.8,-360"/>
<polygon fill="black" stroke="black" points="9702.8,-356.5 9692.8,-360 9702.8,-363.5 9702.8,-356.5"/>
</g>
<!-- tp_layer3_moe_all_reduce&#45;&gt;tp_layer3_final_residual -->
<g id="edge697" class="edge">
<title>tp_layer3_moe_all_reduce&#45;&gt;tp_layer3_final_residual</title>
<path fill="none" stroke="black" d="M9620.26,-348C10087.8,-348 11102.11,-348 11102.11,-348 11102.11,-348 11102.11,-248.15 11102.11,-248.15"/>
<polygon fill="black" stroke="black" points="11105.61,-248.15 11102.11,-238.15 11098.61,-248.15 11105.61,-248.15"/>
</g>
<!-- tp_output -->
<g id="node539" class="node">
<title>tp_output</title>
<polygon fill="lightgreen" stroke="black" points="11798.26,-68 11268.26,-68 11268.26,0 11798.26,0 11798.26,-68"/>
<text text-anchor="middle" x="11533.26" y="-52.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="11533.26" y="-37.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=batch_size, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="11533.26" y="-22.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=batch_size, seq_len=2048, vocab_size=vocab_size]</text>
<text text-anchor="middle" x="11533.26" y="-7.8" font-family="Times,serif" font-size="14.00">GPU: all GPUs</text>
</g>
<!-- tp_layer3_final_residual&#45;&gt;tp_output -->
<g id="edge698" class="edge">
<title>tp_layer3_final_residual&#45;&gt;tp_output</title>
<path fill="none" stroke="black" d="M11533.26,-153.92C11533.26,-153.92 11533.26,-78.03 11533.26,-78.03"/>
<polygon fill="black" stroke="black" points="11536.76,-78.03 11533.26,-68.03 11529.76,-78.03 11536.76,-78.03"/>
</g>
</g>
</svg>
