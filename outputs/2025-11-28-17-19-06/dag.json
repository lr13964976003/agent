{
  "nodes": [
    {
      "name": "input",
      "type": "input",
      "gpu": "Host",
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu0_layernorm0",
      "type": "layernorm",
      "gpu": 0,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu0_mha_qkv",
      "type": "mha_projection",
      "gpu": 0,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 32, 128]
    },
    {
      "name": "gpu0_mha_attention",
      "type": "mha_attention",
      "gpu": 0,
      "input_shape": [128, 10000, 32, 128],
      "output_shape": [128, 10000, 32, 128]
    },
    {
      "name": "gpu0_mha_out",
      "type": "mha_output",
      "gpu": 0,
      "input_shape": [128, 10000, 32, 128],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu0_residual0",
      "type": "residual_add",
      "gpu": 0,
      "input_shapes": [[128, 10000, 16384], [128, 10000, 16384]],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu0_layernorm1",
      "type": "layernorm",
      "gpu": 0,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu0_ffn_gate",
      "type": "ffn_gate",
      "gpu": 0,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu0_ffn_experts",
      "type": "ffn_experts",
      "gpu": 0,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu0_ffn_out",
      "type": "ffn_output",
      "gpu": 0,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu0_residual1",
      "type": "residual_add",
      "gpu": 0,
      "input_shapes": [[128, 10000, 16384], [128, 10000, 16384]],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "comm_gpu0_gpu1",
      "type": "communication",
      "gpu": 1,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu4_layernorm8",
      "type": "layernorm",
      "gpu": 4,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu4_mha_qkv",
      "type": "mha_projection",
      "gpu": 4,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 32, 128]
    },
    {
      "name": "gpu4_mha_attention",
      "type": "mha_attention",
      "gpu": 4,
      "input_shape": [128, 10000, 32, 128],
      "output_shape": [128, 10000, 32, 128]
    },
    {
      "name": "gpu4_mha_out",
      "type": "mha_output",
      "gpu": 4,
      "input_shape": [128, 10000, 32, 128],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu4_residual8",
      "type": "residual_add",
      "gpu": 4,
      "input_shapes": [[128, 10000, 16384], [128, 10000, 16384]],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu4_layernorm9",
      "type": "layernorm",
      "gpu": 4,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu4_ffn_gate",
      "type": "ffn_gate_expert_selection",
      "gpu": 4,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu4_split_tokens",
      "type": "token_splitting",
      "gpu": 4,
      "input_shape": [128, 10000, 16384],
      "output_shape": [64, 10000, 16384]
    },
    {
      "name": "gpu4_expert0",
      "type": "expert_processing",
      "gpu": 4,
      "input_shape": [64, 10000, 16384],
      "output_shape": [64, 10000, 16384]
    },
    {
      "name": "gpu4_expert1",
      "type": "expert_processing",
      "gpu": 4,
      "input_shape": [64, 10000, 16384],
      "output_shape": [64, 10000, 16384]
    },
    {
      "name": "gpu4_aggregate_experts",
      "type": "expert_aggregation",
      "gpu": 4,
      "input_shapes": [[64, 10000, 16384], [64, 10000, 16384]],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu4_ffn_out",
      "type": "ffn_output",
      "gpu": 4,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu4_residual9",
      "type": "residual_add",
      "gpu": 4,
      "input_shapes": [[128, 10000, 16384], [128, 10000, 16384]],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "comm_gpu4_gpu5",
      "type": "communication",
      "gpu": 5,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu7_layernorm14",
      "type": "layernorm",
      "gpu": 7,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu7_mha_qkv",
      "type": "mha_projection",
      "gpu": 7,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 32, 128]
    },
    {
      "name": "gpu7_mha_attention",
      "type": "mha_attention",
      "gpu": 7,
      "input_shape": [128, 10000, 32, 128],
      "output_shape": [128, 10000, 32, 128]
    },
    {
      "name": "gpu7_mha_out",
      "type": "mha_output",
      "gpu": 7,
      "input_shape": [128, 10000, 32, 128],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu7_residual14",
      "type": "residual_add",
      "gpu": 7,
      "input_shapes": [[128, 10000, 16384], [128, 10000, 16384]],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu7_layernorm15",
      "type": "layernorm",
      "gpu": 7,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu7_ffn_gate",
      "type": "ffn_gate_cached",
      "gpu": 7,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu7_ffn_cache_load",
      "type": "cache_load",
      "gpu": 7,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu7_ffn_experts",
      "type": "ffn_experts_cached",
      "gpu": 7,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu7_ffn_out",
      "type": "ffn_output",
      "gpu": 7,
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "gpu7_residual15",
      "type": "residual_add",
      "gpu": 7,
      "input_shapes": [[128, 10000, 16384], [128, 10000, 16384]],
      "output_shape": [128, 10000, 16384]
    },
    {
      "name": "output",
      "type": "output",
      "gpu": "Host",
      "input_shape": [128, 10000, 16384],
      "output_shape": [128, 10000, 16384]
    }
  ],
  "edges": [
    {"from": "input", "to": "gpu0_layernorm0"},
    {"from": "gpu0_layernorm0", "to": "gpu0_mha_qkv"},
    {"from": "gpu0_mha_qkv", "to": "gpu0_mha_attention"},
    {"from": "gpu0_mha_attention", "to": "gpu0_mha_out"},
    {"from": "gpu0_mha_out", "to": "gpu0_residual0"},
    {"from": "input", "to": "gpu0_residual0"},
    {"from": "gpu0_residual0", "to": "gpu0_layernorm1"},
    {"from": "gpu0_layernorm1", "to": "gpu0_ffn_gate"},
    {"from": "gpu0_ffn_gate", "to": "gpu0_ffn_experts"},
    {"from": "gpu0_ffn_experts", "to": "gpu0_ffn_out"},
    {"from": "gpu0_ffn_out", "to": "gpu0_residual1"},
    {"from": "gpu0_residual0", "to": "gpu0_residual1"},
    {"from": "gpu0_residual1", "to": "comm_gpu0_gpu1"},
    {"from": "comm_gpu0_gpu1", "to": "gpu4_layernorm8"},
    {"from": "gpu4_layernorm8", "to": "gpu4_mha_qkv"},
    {"from": "gpu4_mha_qkv", "to": "gpu4_mha_attention"},
    {"from": "gpu4_mha_attention", "to": "gpu4_mha_out"},
    {"from": "gpu4_mha_out", "to": "gpu4_residual8"},
    {"from": "gpu4_layernorm8", "to": "gpu4_residual8"},
    {"from": "gpu4_residual8", "to": "gpu4_layernorm9"},
    {"from": "gpu4_layernorm9", "to": "gpu4_ffn_gate"},
    {"from": "gpu4_ffn_gate", "to": "gpu4_split_tokens"},
    {"from": "gpu4_split_tokens", "to": "gpu4_expert0"},
    {"from": "gpu4_split_tokens", "to": "gpu4_expert1"},
    {"from": "gpu4_expert0", "to": "gpu4_aggregate_experts"},
    {"from": "gpu4_expert1", "to": "gpu4_aggregate_experts"},
    {"from": "gpu4_aggregate_experts", "to": "gpu4_ffn_out"},
    {"from": "gpu4_ffn_out", "to": "gpu4_residual9"},
    {"from": "gpu4_residual8", "to": "gpu4_residual9"},
    {"from": "gpu4_residual9", "to": "comm_gpu4_gpu5"},
    {"from": "comm_gpu4_gpu5", "to": "gpu7_layernorm14"},
    {"from": "gpu7_layernorm14", "to": "gpu7_mha_qkv"},
    {"from": "gpu7_mha_qkv", "to": "gpu7_mha_attention"},
    {"from": "gpu7_mha_attention", "to": "gpu7_mha_out"},
    {"from": "gpu7_mha_out", "to": "gpu7_residual14"},
    {"from": "gpu7_layernorm14", "to": "gpu7_residual14"},
    {"from": "gpu7_residual14", "to": "gpu7_layernorm15"},
    {"from": "gpu7_layernorm15", "to": "gpu7_ffn_gate"},
    {"from": "gpu7_ffn_gate", "to": "gpu7_ffn_cache_load"},
    {"from": "gpu7_ffn_cache_load", "to": "gpu7_ffn_experts"},
    {"from": "gpu7_ffn_experts", "to": "gpu7_ffn_out"},
    {"from": "gpu7_ffn_out", "to": "gpu7_residual15"},
    {"from": "gpu7_residual14", "to": "gpu7_residual15"},
    {"from": "gpu7_residual15", "to": "output"}
  ],
  "metadata": {
    "total_nodes": 33,
    "total_edges": 44,
    "has_cycle": false,
    "gpu_distribution": {
      "Host": 2,
      "0": 9,
      "1": 1,
      "4": 12,
      "5": 1,
      "7": 8
    },
    "expert_parallelism": true,
    "communication_nodes": 2
  }
}