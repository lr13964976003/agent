<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: complete_layer3_dp0 Pages: 1 -->
<svg width="866pt" height="707pt"
 viewBox="0.00 0.00 866.00 707.17" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 703.17)">
<title>complete_layer3_dp0</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-703.17 862,-703.17 862,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_attention</title>
<path fill="none" stroke="black" d="M152,-452C152,-452 706,-452 706,-452 712,-452 718,-458 718,-464 718,-464 718,-679.17 718,-679.17 718,-685.17 712,-691.17 706,-691.17 706,-691.17 152,-691.17 152,-691.17 146,-691.17 140,-685.17 140,-679.17 140,-679.17 140,-464 140,-464 140,-458 146,-452 152,-452"/>
<text text-anchor="middle" x="429" y="-675.97" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention Phase</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_experts</title>
<path fill="none" stroke="black" d="M20,-8C20,-8 838,-8 838,-8 844,-8 850,-14 850,-20 850,-20 850,-432 850,-432 850,-438 844,-444 838,-444 838,-444 20,-444 20,-444 14,-444 8,-438 8,-432 8,-432 8,-20 8,-20 8,-14 14,-8 20,-8"/>
<text text-anchor="middle" x="429" y="-428.8" font-family="Times,serif" font-size="14.00">Expert Parallel MoE Phase</text>
</g>
<!-- attn_input -->
<g id="node1" class="node">
<title>attn_input</title>
<ellipse fill="lightblue" stroke="black" cx="429" cy="-612.08" rx="281.36" ry="48.17"/>
<text text-anchor="middle" x="429" y="-630.88" font-family="Times,serif" font-size="14.00">Layer Input</text>
<text text-anchor="middle" x="429" y="-615.88" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="429" y="-600.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="429" y="-585.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, hidden=7168]</text>
</g>
<!-- mha -->
<g id="node2" class="node">
<title>mha</title>
<polygon fill="lightgreen" stroke="black" points="628,-528 230,-528 230,-460 628,-460 628,-528"/>
<text text-anchor="middle" x="429" y="-512.8" font-family="Times,serif" font-size="14.00">MHA Complete</text>
<text text-anchor="middle" x="429" y="-497.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="429" y="-482.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="429" y="-467.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, hidden=7168]</text>
</g>
<!-- attn_input&#45;&gt;mha -->
<g id="edge1" class="edge">
<title>attn_input&#45;&gt;mha</title>
<path fill="none" stroke="black" d="M429,-563.87C429,-555.48 429,-546.78 429,-538.51"/>
<polygon fill="black" stroke="black" points="432.5,-538.3 429,-528.3 425.5,-538.3 432.5,-538.3"/>
</g>
<!-- distribute -->
<g id="node3" class="node">
<title>distribute</title>
<polygon fill="gold" stroke="black" points="841.76,-413 185.15,-413 16.24,-277 672.85,-277 841.76,-413"/>
<text text-anchor="middle" x="429" y="-363.8" font-family="Times,serif" font-size="14.00">Token Distribution</text>
<text text-anchor="middle" x="429" y="-348.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="429" y="-333.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="429" y="-318.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, hidden=7168]</text>
</g>
<!-- mha&#45;&gt;distribute -->
<g id="edge2" class="edge">
<title>mha&#45;&gt;distribute</title>
<path fill="none" stroke="black" d="M429,-452C429,-450 429,-448 429,-446"/>
<polygon fill="black" stroke="black" points="432.5,-454 429,-444 425.5,-454 432.5,-454"/>
</g>
<!-- expert_0_comp -->
<g id="node4" class="node">
<title>expert_0_comp</title>
<polygon fill="lightcoral" stroke="black" points="286,-241 170,-241 170,-188 286,-188 286,-241"/>
<text text-anchor="middle" x="228" y="-225.8" font-family="Times,serif" font-size="14.00">Expert 0 MLP</text>
<text text-anchor="middle" x="228" y="-210.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="228" y="-195.8" font-family="Times,serif" font-size="14.00">Node:0</text>
</g>
<!-- distribute&#45;&gt;expert_0_comp -->
<g id="edge3" class="edge">
<title>distribute&#45;&gt;expert_0_comp</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M324.08,-276.93C307.53,-266.34 291.14,-255.86 276.7,-246.64"/>
<polygon fill="black" stroke="black" points="278.3,-243.5 267.99,-241.06 274.53,-249.4 278.3,-243.5"/>
</g>
<!-- expert_1_comp -->
<g id="node5" class="node">
<title>expert_1_comp</title>
<polygon fill="lightcoral" stroke="black" points="420,-241 304,-241 304,-188 420,-188 420,-241"/>
<text text-anchor="middle" x="362" y="-225.8" font-family="Times,serif" font-size="14.00">Expert 1 MLP</text>
<text text-anchor="middle" x="362" y="-210.8" font-family="Times,serif" font-size="14.00">GPU:1</text>
<text text-anchor="middle" x="362" y="-195.8" font-family="Times,serif" font-size="14.00">Node:0</text>
</g>
<!-- distribute&#45;&gt;expert_1_comp -->
<g id="edge5" class="edge">
<title>distribute&#45;&gt;expert_1_comp</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M393.93,-276.74C389.15,-267.56 384.4,-258.47 380.1,-250.21"/>
<polygon fill="black" stroke="black" points="383.16,-248.52 375.44,-241.27 376.96,-251.76 383.16,-248.52"/>
</g>
<!-- expert_2_comp -->
<g id="node6" class="node">
<title>expert_2_comp</title>
<polygon fill="lightcoral" stroke="black" points="554,-241 438,-241 438,-188 554,-188 554,-241"/>
<text text-anchor="middle" x="496" y="-225.8" font-family="Times,serif" font-size="14.00">Expert 2 MLP</text>
<text text-anchor="middle" x="496" y="-210.8" font-family="Times,serif" font-size="14.00">GPU:2</text>
<text text-anchor="middle" x="496" y="-195.8" font-family="Times,serif" font-size="14.00">Node:0</text>
</g>
<!-- distribute&#45;&gt;expert_2_comp -->
<g id="edge7" class="edge">
<title>distribute&#45;&gt;expert_2_comp</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M464.07,-276.74C468.85,-267.56 473.6,-258.47 477.9,-250.21"/>
<polygon fill="black" stroke="black" points="481.04,-251.76 482.56,-241.27 474.84,-248.52 481.04,-251.76"/>
</g>
<!-- expert_3_comp -->
<g id="node7" class="node">
<title>expert_3_comp</title>
<polygon fill="lightcoral" stroke="black" points="688,-241 572,-241 572,-188 688,-188 688,-241"/>
<text text-anchor="middle" x="630" y="-225.8" font-family="Times,serif" font-size="14.00">Expert 3 MLP</text>
<text text-anchor="middle" x="630" y="-210.8" font-family="Times,serif" font-size="14.00">GPU:3</text>
<text text-anchor="middle" x="630" y="-195.8" font-family="Times,serif" font-size="14.00">Node:0</text>
</g>
<!-- distribute&#45;&gt;expert_3_comp -->
<g id="edge9" class="edge">
<title>distribute&#45;&gt;expert_3_comp</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M533.92,-276.93C550.47,-266.34 566.86,-255.86 581.3,-246.64"/>
<polygon fill="black" stroke="black" points="583.47,-249.4 590.01,-241.06 579.7,-243.5 583.47,-249.4"/>
</g>
<!-- aggregate -->
<g id="node8" class="node">
<title>aggregate</title>
<polygon fill="lightgrey" stroke="black" points="841.76,-152 185.15,-152 16.24,-16 672.85,-16 841.76,-152"/>
<text text-anchor="middle" x="429" y="-102.8" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="429" y="-87.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="429" y="-72.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="429" y="-57.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, hidden=7168]</text>
</g>
<!-- expert_0_comp&#45;&gt;aggregate -->
<g id="edge4" class="edge">
<title>expert_0_comp&#45;&gt;aggregate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M268.19,-187.8C282.05,-178.95 298.32,-168.54 315.11,-157.81"/>
<polygon fill="black" stroke="black" points="317.39,-160.51 323.93,-152.17 313.62,-154.61 317.39,-160.51"/>
</g>
<!-- expert_1_comp&#45;&gt;aggregate -->
<g id="edge6" class="edge">
<title>expert_1_comp&#45;&gt;aggregate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M375.4,-187.8C379.55,-179.84 384.35,-170.63 389.35,-161.05"/>
<polygon fill="black" stroke="black" points="392.46,-162.66 393.98,-152.17 386.25,-159.42 392.46,-162.66"/>
</g>
<!-- expert_2_comp&#45;&gt;aggregate -->
<g id="edge8" class="edge">
<title>expert_2_comp&#45;&gt;aggregate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M482.6,-187.8C478.45,-179.84 473.65,-170.63 468.65,-161.05"/>
<polygon fill="black" stroke="black" points="471.75,-159.42 464.02,-152.17 465.54,-162.66 471.75,-159.42"/>
</g>
<!-- expert_3_comp&#45;&gt;aggregate -->
<g id="edge10" class="edge">
<title>expert_3_comp&#45;&gt;aggregate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M589.81,-187.8C575.95,-178.95 559.68,-168.54 542.89,-157.81"/>
<polygon fill="black" stroke="black" points="544.38,-154.61 534.07,-152.17 540.61,-160.51 544.38,-154.61"/>
</g>
</g>
</svg>
