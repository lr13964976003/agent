digraph token_routing {
	rankdir=LR
	distributor [label="Token Distributor\nLayer:3, DP:0\nInput: [batch_size=4, seq_len=2048, hidden=7168]\nOutput: [batch_size=4, seq_len=2048, hidden=7168]" fillcolor=gold shape=parallelogram style=filled]
	expert_0 [label="Expert 0\nGPU:0\nNode:0\nInput: [batch_size=var,seq_len=var,hidden=7168]\nOutput: [batch_size=var,seq_len=var,hidden=7168]" fillcolor=lightcoral shape=rectangle style=filled]
	distributor -> expert_0 [style=dashed]
	expert_1 [label="Expert 1\nGPU:1\nNode:0\nInput: [batch_size=var,seq_len=var,hidden=7168]\nOutput: [batch_size=var,seq_len=var,hidden=7168]" fillcolor=lightcoral shape=rectangle style=filled]
	distributor -> expert_1 [style=dashed]
	expert_2 [label="Expert 2\nGPU:2\nNode:0\nInput: [batch_size=var,seq_len=var,hidden=7168]\nOutput: [batch_size=var,seq_len=var,hidden=7168]" fillcolor=lightcoral shape=rectangle style=filled]
	distributor -> expert_2 [style=dashed]
	expert_3 [label="Expert 3\nGPU:3\nNode:0\nInput: [batch_size=var,seq_len=var,hidden=7168]\nOutput: [batch_size=var,seq_len=var,hidden=7168]" fillcolor=lightcoral shape=rectangle style=filled]
	distributor -> expert_3 [style=dashed]
	expert_4 [label="Expert 4\nGPU:4\nNode:0\nInput: [batch_size=var,seq_len=var,hidden=7168]\nOutput: [batch_size=var,seq_len=var,hidden=7168]" fillcolor=lightcoral shape=rectangle style=filled]
	distributor -> expert_4 [style=dashed]
	expert_5 [label="Expert 5\nGPU:5\nNode:0\nInput: [batch_size=var,seq_len=var,hidden=7168]\nOutput: [batch_size=var,seq_len=var,hidden=7168]" fillcolor=lightcoral shape=rectangle style=filled]
	distributor -> expert_5 [style=dashed]
	expert_6 [label="Expert 6\nGPU:6\nNode:0\nInput: [batch_size=var,seq_len=var,hidden=7168]\nOutput: [batch_size=var,seq_len=var,hidden=7168]" fillcolor=lightcoral shape=rectangle style=filled]
	distributor -> expert_6 [style=dashed]
	expert_7 [label="Expert 7\nGPU:7\nNode:0\nInput: [batch_size=var,seq_len=var,hidden=7168]\nOutput: [batch_size=var,seq_len=var,hidden=7168]" fillcolor=lightcoral shape=rectangle style=filled]
	distributor -> expert_7 [style=dashed]
	aggregator [label="Expert Aggregation\nLayer:3, DP:0\nInput: [batch_size=4, seq_len=2048, hidden=7168]\nOutput: [batch_size=4, seq_len=2048, hidden=7168]" fillcolor=lightgrey shape=parallelogram style=filled]
	expert_0 -> aggregator [style=dashed]
	expert_1 -> aggregator [style=dashed]
	expert_2 -> aggregator [style=dashed]
	expert_3 -> aggregator [style=dashed]
	expert_4 -> aggregator [style=dashed]
	expert_5 -> aggregator [style=dashed]
	expert_6 -> aggregator [style=dashed]
	expert_7 -> aggregator [style=dashed]
}
