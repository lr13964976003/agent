<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: detailed_attention Pages: 1 -->
<svg width="1189pt" height="804pt"
 viewBox="0.00 0.00 1189.00 804.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 800)">
<title>detailed_attention</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-800 1185,-800 1185,4 -4,4"/>
<!-- ln -->
<g id="node1" class="node">
<title>ln</title>
<polygon fill="lightblue" stroke="black" points="926,-796 472,-796 472,-728 926,-728 926,-796"/>
<text text-anchor="middle" x="699" y="-780.8" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="699" y="-765.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="699" y="-750.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
<text text-anchor="middle" x="699" y="-735.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
</g>
<!-- q_proj -->
<g id="node2" class="node">
<title>q_proj</title>
<polygon fill="lightgreen" stroke="black" points="454,-692 0,-692 0,-624 454,-624 454,-692"/>
<text text-anchor="middle" x="227" y="-676.8" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="227" y="-661.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="227" y="-646.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
<text text-anchor="middle" x="227" y="-631.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
</g>
<!-- ln&#45;&gt;q_proj -->
<g id="edge1" class="edge">
<title>ln&#45;&gt;q_proj</title>
<path fill="none" stroke="black" d="M546.08,-727.95C496.23,-717.18 440.7,-705.18 390.13,-694.25"/>
<polygon fill="black" stroke="black" points="390.59,-690.77 380.08,-692.08 389.11,-697.61 390.59,-690.77"/>
</g>
<!-- k_proj -->
<g id="node3" class="node">
<title>k_proj</title>
<polygon fill="lightgreen" stroke="black" points="926,-692 472,-692 472,-624 926,-624 926,-692"/>
<text text-anchor="middle" x="699" y="-676.8" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="699" y="-661.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="699" y="-646.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
<text text-anchor="middle" x="699" y="-631.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
</g>
<!-- ln&#45;&gt;k_proj -->
<g id="edge2" class="edge">
<title>ln&#45;&gt;k_proj</title>
<path fill="none" stroke="black" d="M699,-727.88C699,-719.78 699,-710.98 699,-702.47"/>
<polygon fill="black" stroke="black" points="702.5,-702.3 699,-692.3 695.5,-702.3 702.5,-702.3"/>
</g>
<!-- v_proj -->
<g id="node4" class="node">
<title>v_proj</title>
<polygon fill="lightgreen" stroke="black" points="1181,-588 727,-588 727,-520 1181,-520 1181,-588"/>
<text text-anchor="middle" x="954" y="-572.8" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="954" y="-557.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="954" y="-542.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
<text text-anchor="middle" x="954" y="-527.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
</g>
<!-- ln&#45;&gt;v_proj -->
<g id="edge3" class="edge">
<title>ln&#45;&gt;v_proj</title>
<path fill="none" stroke="black" d="M888.98,-727.89C906.33,-718.62 922.17,-706.86 935,-692 956.96,-666.55 960.59,-627.97 959.36,-598.22"/>
<polygon fill="black" stroke="black" points="962.85,-597.88 958.75,-588.11 955.86,-598.3 962.85,-597.88"/>
</g>
<!-- scale -->
<g id="node5" class="node">
<title>scale</title>
<polygon fill="yellow" stroke="black" points="563,-588 109,-588 109,-520 563,-520 563,-588"/>
<text text-anchor="middle" x="336" y="-572.8" font-family="Times,serif" font-size="14.00">Scale</text>
<text text-anchor="middle" x="336" y="-557.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="336" y="-542.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
<text text-anchor="middle" x="336" y="-527.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
</g>
<!-- q_proj&#45;&gt;scale -->
<g id="edge4" class="edge">
<title>q_proj&#45;&gt;scale</title>
<path fill="none" stroke="black" d="M262.39,-623.88C272.1,-614.8 282.73,-604.85 292.83,-595.4"/>
<polygon fill="black" stroke="black" points="295.51,-597.69 300.42,-588.3 290.72,-592.58 295.51,-597.69"/>
</g>
<!-- matmul1 -->
<g id="node6" class="node">
<title>matmul1</title>
<polygon fill="yellow" stroke="black" points="920,-484 478,-484 478,-416 920,-416 920,-484"/>
<text text-anchor="middle" x="699" y="-468.8" font-family="Times,serif" font-size="14.00">QK^T MatMul</text>
<text text-anchor="middle" x="699" y="-453.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="699" y="-438.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
<text text-anchor="middle" x="699" y="-423.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4,seq_len=2048,seq_len=2048]</text>
</g>
<!-- k_proj&#45;&gt;matmul1 -->
<g id="edge5" class="edge">
<title>k_proj&#45;&gt;matmul1</title>
<path fill="none" stroke="black" d="M699,-623.9C699,-588.76 699,-533.08 699,-494.43"/>
<polygon fill="black" stroke="black" points="702.5,-494.02 699,-484.02 695.5,-494.02 702.5,-494.02"/>
</g>
<!-- matmul2 -->
<g id="node8" class="node">
<title>matmul2</title>
<polygon fill="yellow" stroke="black" points="1053,-276 599,-276 599,-208 1053,-208 1053,-276"/>
<text text-anchor="middle" x="826" y="-260.8" font-family="Times,serif" font-size="14.00">Attention V MatMul</text>
<text text-anchor="middle" x="826" y="-245.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="826" y="-230.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4,seq_len=2048,seq_len=2048]</text>
<text text-anchor="middle" x="826" y="-215.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
</g>
<!-- v_proj&#45;&gt;matmul2 -->
<g id="edge9" class="edge">
<title>v_proj&#45;&gt;matmul2</title>
<path fill="none" stroke="black" d="M957.06,-519.97C959.99,-470.94 959.25,-377.64 920,-312 913.38,-300.92 904.22,-291.08 894.21,-282.55"/>
<polygon fill="black" stroke="black" points="896.4,-279.82 886.41,-276.29 892.02,-285.28 896.4,-279.82"/>
</g>
<!-- scale&#45;&gt;matmul1 -->
<g id="edge6" class="edge">
<title>scale&#45;&gt;matmul1</title>
<path fill="none" stroke="black" d="M453.6,-519.95C491.31,-509.36 533.23,-497.58 571.6,-486.8"/>
<polygon fill="black" stroke="black" points="572.59,-490.16 581.27,-484.08 570.7,-483.42 572.59,-490.16"/>
</g>
<!-- softmax -->
<g id="node7" class="node">
<title>softmax</title>
<polygon fill="yellow" stroke="black" points="910.5,-380 517.5,-380 517.5,-312 910.5,-312 910.5,-380"/>
<text text-anchor="middle" x="714" y="-364.8" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="714" y="-349.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="714" y="-334.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4,seq_len=2048,seq_len=2048]</text>
<text text-anchor="middle" x="714" y="-319.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4,seq_len=2048,seq_len=2048]</text>
</g>
<!-- matmul1&#45;&gt;softmax -->
<g id="edge7" class="edge">
<title>matmul1&#45;&gt;softmax</title>
<path fill="none" stroke="black" d="M703.87,-415.88C705.06,-407.78 706.36,-398.98 707.61,-390.47"/>
<polygon fill="black" stroke="black" points="711.11,-390.7 709.1,-380.3 704.19,-389.68 711.11,-390.7"/>
</g>
<!-- softmax&#45;&gt;matmul2 -->
<g id="edge8" class="edge">
<title>softmax&#45;&gt;matmul2</title>
<path fill="none" stroke="black" d="M750.36,-311.88C760.44,-302.71 771.48,-292.65 781.94,-283.12"/>
<polygon fill="black" stroke="black" points="784.4,-285.62 789.44,-276.3 779.69,-280.44 784.4,-285.62"/>
</g>
<!-- out_proj -->
<g id="node9" class="node">
<title>out_proj</title>
<polygon fill="lightgreen" stroke="black" points="1047,-172 605,-172 605,-104 1047,-104 1047,-172"/>
<text text-anchor="middle" x="826" y="-156.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="826" y="-141.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="826" y="-126.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, heads=128, d_k=128]</text>
<text text-anchor="middle" x="826" y="-111.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, hidden=7168]</text>
</g>
<!-- matmul2&#45;&gt;out_proj -->
<g id="edge10" class="edge">
<title>matmul2&#45;&gt;out_proj</title>
<path fill="none" stroke="black" d="M826,-207.88C826,-199.78 826,-190.98 826,-182.47"/>
<polygon fill="black" stroke="black" points="829.5,-182.3 826,-172.3 822.5,-182.3 829.5,-182.3"/>
</g>
<!-- residual -->
<g id="node10" class="node">
<title>residual</title>
<polygon fill="lightgrey" stroke="black" points="1025,-68 627,-68 627,0 1025,0 1025,-68"/>
<text text-anchor="middle" x="826" y="-52.8" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="826" y="-37.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="826" y="-22.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="826" y="-7.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, hidden=7168]</text>
</g>
<!-- out_proj&#45;&gt;residual -->
<g id="edge11" class="edge">
<title>out_proj&#45;&gt;residual</title>
<path fill="none" stroke="black" d="M826,-103.88C826,-95.78 826,-86.98 826,-78.47"/>
<polygon fill="black" stroke="black" points="829.5,-78.3 826,-68.3 822.5,-78.3 829.5,-78.3"/>
</g>
</g>
</svg>
