<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: token_routing Pages: 1 -->
<svg width="2118pt" height="798pt"
 viewBox="0.00 0.00 2117.51 798.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 794)">
<title>token_routing</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-794 2113.51,-794 2113.51,4 -4,4"/>
<!-- distributor -->
<g id="node1" class="node">
<title>distributor</title>
<polygon fill="gold" stroke="black" points="825.38,-462.5 168.78,-462.5 -0.13,-326.5 656.47,-326.5 825.38,-462.5"/>
<text text-anchor="middle" x="412.63" y="-413.3" font-family="Times,serif" font-size="14.00">Token Distributor</text>
<text text-anchor="middle" x="412.63" y="-398.3" font-family="Times,serif" font-size="14.00">Layer:3, DP:0</text>
<text text-anchor="middle" x="412.63" y="-383.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="412.63" y="-368.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, hidden=7168]</text>
</g>
<!-- expert_0 -->
<g id="node2" class="node">
<title>expert_0</title>
<polygon fill="lightcoral" stroke="black" points="1248.26,-790 861.26,-790 861.26,-707 1248.26,-707 1248.26,-790"/>
<text text-anchor="middle" x="1054.76" y="-774.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1054.76" y="-759.8" font-family="Times,serif" font-size="14.00">GPU:0</text>
<text text-anchor="middle" x="1054.76" y="-744.8" font-family="Times,serif" font-size="14.00">Node:0</text>
<text text-anchor="middle" x="1054.76" y="-729.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=var,seq_len=var,hidden=7168]</text>
<text text-anchor="middle" x="1054.76" y="-714.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=var,seq_len=var,hidden=7168]</text>
</g>
<!-- distributor&#45;&gt;expert_0 -->
<g id="edge1" class="edge">
<title>distributor&#45;&gt;expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M495.09,-462.6C581.08,-531.29 723.06,-635.9 861.26,-698.5 864.68,-700.05 868.16,-701.56 871.69,-703.03"/>
<polygon fill="black" stroke="black" points="870.55,-706.34 881.13,-706.83 873.16,-699.85 870.55,-706.34"/>
</g>
<!-- expert_1 -->
<g id="node3" class="node">
<title>expert_1</title>
<polygon fill="lightcoral" stroke="black" points="1248.26,-689 861.26,-689 861.26,-606 1248.26,-606 1248.26,-689"/>
<text text-anchor="middle" x="1054.76" y="-673.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1054.76" y="-658.8" font-family="Times,serif" font-size="14.00">GPU:1</text>
<text text-anchor="middle" x="1054.76" y="-643.8" font-family="Times,serif" font-size="14.00">Node:0</text>
<text text-anchor="middle" x="1054.76" y="-628.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=var,seq_len=var,hidden=7168]</text>
<text text-anchor="middle" x="1054.76" y="-613.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=var,seq_len=var,hidden=7168]</text>
</g>
<!-- distributor&#45;&gt;expert_1 -->
<g id="edge2" class="edge">
<title>distributor&#45;&gt;expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M547.78,-462.65C635.43,-505.34 753.25,-559.3 861.26,-597.5 866.39,-599.32 871.63,-601.1 876.93,-602.85"/>
<polygon fill="black" stroke="black" points="875.95,-606.21 886.54,-605.95 878.1,-599.55 875.95,-606.21"/>
</g>
<!-- expert_2 -->
<g id="node4" class="node">
<title>expert_2</title>
<polygon fill="lightcoral" stroke="black" points="1248.26,-588 861.26,-588 861.26,-505 1248.26,-505 1248.26,-588"/>
<text text-anchor="middle" x="1054.76" y="-572.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1054.76" y="-557.8" font-family="Times,serif" font-size="14.00">GPU:2</text>
<text text-anchor="middle" x="1054.76" y="-542.8" font-family="Times,serif" font-size="14.00">Node:0</text>
<text text-anchor="middle" x="1054.76" y="-527.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=var,seq_len=var,hidden=7168]</text>
<text text-anchor="middle" x="1054.76" y="-512.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=var,seq_len=var,hidden=7168]</text>
</g>
<!-- distributor&#45;&gt;expert_2 -->
<g id="edge3" class="edge">
<title>distributor&#45;&gt;expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M700.46,-462.61C757.6,-476.18 816.18,-490.09 868.79,-502.58"/>
<polygon fill="black" stroke="black" points="868.01,-505.99 878.54,-504.9 869.62,-499.18 868.01,-505.99"/>
</g>
<!-- expert_3 -->
<g id="node5" class="node">
<title>expert_3</title>
<polygon fill="lightcoral" stroke="black" points="1248.26,-487 861.26,-487 861.26,-404 1248.26,-404 1248.26,-487"/>
<text text-anchor="middle" x="1054.76" y="-471.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1054.76" y="-456.8" font-family="Times,serif" font-size="14.00">GPU:3</text>
<text text-anchor="middle" x="1054.76" y="-441.8" font-family="Times,serif" font-size="14.00">Node:0</text>
<text text-anchor="middle" x="1054.76" y="-426.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=var,seq_len=var,hidden=7168]</text>
<text text-anchor="middle" x="1054.76" y="-411.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=var,seq_len=var,hidden=7168]</text>
</g>
<!-- distributor&#45;&gt;expert_3 -->
<g id="edge4" class="edge">
<title>distributor&#45;&gt;expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M777.17,-423.46C802.33,-425.47 827.12,-427.44 850.9,-429.34"/>
<polygon fill="black" stroke="black" points="850.79,-432.84 861.03,-430.15 851.34,-425.86 850.79,-432.84"/>
</g>
<!-- expert_4 -->
<g id="node6" class="node">
<title>expert_4</title>
<polygon fill="lightcoral" stroke="black" points="1248.26,-386 861.26,-386 861.26,-303 1248.26,-303 1248.26,-386"/>
<text text-anchor="middle" x="1054.76" y="-370.8" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1054.76" y="-355.8" font-family="Times,serif" font-size="14.00">GPU:4</text>
<text text-anchor="middle" x="1054.76" y="-340.8" font-family="Times,serif" font-size="14.00">Node:0</text>
<text text-anchor="middle" x="1054.76" y="-325.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=var,seq_len=var,hidden=7168]</text>
<text text-anchor="middle" x="1054.76" y="-310.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=var,seq_len=var,hidden=7168]</text>
</g>
<!-- distributor&#45;&gt;expert_4 -->
<g id="edge5" class="edge">
<title>distributor&#45;&gt;expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M712.14,-371.18C759.26,-367.5 807.01,-363.77 851.27,-360.32"/>
<polygon fill="black" stroke="black" points="851.55,-363.8 861.25,-359.54 851.01,-356.83 851.55,-363.8"/>
</g>
<!-- expert_5 -->
<g id="node7" class="node">
<title>expert_5</title>
<polygon fill="lightcoral" stroke="black" points="1248.26,-285 861.26,-285 861.26,-202 1248.26,-202 1248.26,-285"/>
<text text-anchor="middle" x="1054.76" y="-269.8" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1054.76" y="-254.8" font-family="Times,serif" font-size="14.00">GPU:5</text>
<text text-anchor="middle" x="1054.76" y="-239.8" font-family="Times,serif" font-size="14.00">Node:0</text>
<text text-anchor="middle" x="1054.76" y="-224.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=var,seq_len=var,hidden=7168]</text>
<text text-anchor="middle" x="1054.76" y="-209.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=var,seq_len=var,hidden=7168]</text>
</g>
<!-- distributor&#45;&gt;expert_5 -->
<g id="edge6" class="edge">
<title>distributor&#45;&gt;expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M667.08,-334.71C734.05,-318.92 805.09,-302.16 867.76,-287.37"/>
<polygon fill="black" stroke="black" points="868.82,-290.72 877.74,-285.02 867.21,-283.91 868.82,-290.72"/>
</g>
<!-- expert_6 -->
<g id="node8" class="node">
<title>expert_6</title>
<polygon fill="lightcoral" stroke="black" points="1248.26,-184 861.26,-184 861.26,-101 1248.26,-101 1248.26,-184"/>
<text text-anchor="middle" x="1054.76" y="-168.8" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1054.76" y="-153.8" font-family="Times,serif" font-size="14.00">GPU:6</text>
<text text-anchor="middle" x="1054.76" y="-138.8" font-family="Times,serif" font-size="14.00">Node:0</text>
<text text-anchor="middle" x="1054.76" y="-123.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=var,seq_len=var,hidden=7168]</text>
<text text-anchor="middle" x="1054.76" y="-108.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=var,seq_len=var,hidden=7168]</text>
</g>
<!-- distributor&#45;&gt;expert_6 -->
<g id="edge7" class="edge">
<title>distributor&#45;&gt;expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M549.88,-326.33C637.37,-284.31 754.26,-231.41 861.26,-193.5 867.3,-191.36 873.47,-189.26 879.73,-187.21"/>
<polygon fill="black" stroke="black" points="881.18,-190.42 889.63,-184.03 879.04,-183.76 881.18,-190.42"/>
</g>
<!-- expert_7 -->
<g id="node9" class="node">
<title>expert_7</title>
<polygon fill="lightcoral" stroke="black" points="1248.26,-83 861.26,-83 861.26,0 1248.26,0 1248.26,-83"/>
<text text-anchor="middle" x="1054.76" y="-67.8" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="1054.76" y="-52.8" font-family="Times,serif" font-size="14.00">GPU:7</text>
<text text-anchor="middle" x="1054.76" y="-37.8" font-family="Times,serif" font-size="14.00">Node:0</text>
<text text-anchor="middle" x="1054.76" y="-22.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=var,seq_len=var,hidden=7168]</text>
<text text-anchor="middle" x="1054.76" y="-7.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=var,seq_len=var,hidden=7168]</text>
</g>
<!-- distributor&#45;&gt;expert_7 -->
<g id="edge8" class="edge">
<title>distributor&#45;&gt;expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M496.03,-326.38C582.21,-258.26 723.83,-154.9 861.26,-92.5 865.44,-90.6 869.71,-88.76 874.05,-86.98"/>
<polygon fill="black" stroke="black" points="875.63,-90.11 883.63,-83.17 873.05,-83.61 875.63,-90.11"/>
</g>
<!-- aggregator -->
<g id="node10" class="node">
<title>aggregator</title>
<polygon fill="lightgrey" stroke="black" points="2109.64,-462.5 1453.04,-462.5 1284.13,-326.5 1940.73,-326.5 2109.64,-462.5"/>
<text text-anchor="middle" x="1696.88" y="-413.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1696.88" y="-398.3" font-family="Times,serif" font-size="14.00">Layer:3, DP:0</text>
<text text-anchor="middle" x="1696.88" y="-383.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="1696.88" y="-368.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, hidden=7168]</text>
</g>
<!-- expert_0&#45;&gt;aggregator -->
<g id="edge9" class="edge">
<title>expert_0&#45;&gt;aggregator</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1228.38,-706.83C1235.16,-704.19 1241.81,-701.42 1248.26,-698.5 1382.27,-637.79 1519.84,-537.59 1606.46,-468.93"/>
<polygon fill="black" stroke="black" points="1608.78,-471.56 1614.42,-462.6 1604.42,-466.09 1608.78,-471.56"/>
</g>
<!-- expert_1&#45;&gt;aggregator -->
<g id="edge10" class="edge">
<title>expert_1&#45;&gt;aggregator</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1222.97,-605.95C1231.56,-603.23 1240.04,-600.41 1248.26,-597.5 1352.57,-560.61 1466.04,-509.01 1552.64,-467.07"/>
<polygon fill="black" stroke="black" points="1554.27,-470.17 1561.73,-462.65 1551.21,-463.87 1554.27,-470.17"/>
</g>
<!-- expert_2&#45;&gt;aggregator -->
<g id="edge11" class="edge">
<title>expert_2&#45;&gt;aggregator</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1230.67,-504.97C1293.03,-490.16 1364.72,-473.13 1432.85,-456.96"/>
<polygon fill="black" stroke="black" points="1433.95,-460.29 1442.87,-454.58 1432.34,-453.48 1433.95,-460.29"/>
</g>
<!-- expert_3&#45;&gt;aggregator -->
<g id="edge12" class="edge">
<title>expert_3&#45;&gt;aggregator</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1248.68,-430.13C1292.59,-426.63 1340.3,-422.83 1387.67,-419.06"/>
<polygon fill="black" stroke="black" points="1388.09,-422.53 1397.78,-418.25 1387.53,-415.56 1388.09,-422.53"/>
</g>
<!-- expert_4&#45;&gt;aggregator -->
<g id="edge13" class="edge">
<title>expert_4&#45;&gt;aggregator</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1248.68,-359.57C1272.57,-361.44 1297.58,-363.39 1323.06,-365.38"/>
<polygon fill="black" stroke="black" points="1322.98,-368.88 1333.22,-366.17 1323.53,-361.9 1322.98,-368.88"/>
</g>
<!-- expert_5&#45;&gt;aggregator -->
<g id="edge14" class="edge">
<title>expert_5&#45;&gt;aggregator</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1231.94,-285.06C1283.29,-297.17 1340.86,-310.75 1397.53,-324.12"/>
<polygon fill="black" stroke="black" points="1396.82,-327.55 1407.35,-326.44 1398.43,-320.74 1396.82,-327.55"/>
</g>
<!-- expert_6&#45;&gt;aggregator -->
<g id="edge15" class="edge">
<title>expert_6&#45;&gt;aggregator</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1219.88,-184.03C1229.53,-187.08 1239.05,-190.24 1248.26,-193.5 1351.59,-230.11 1464.16,-280.71 1550.56,-321.98"/>
<polygon fill="black" stroke="black" points="1549.1,-325.17 1559.63,-326.33 1552.12,-318.85 1549.1,-325.17"/>
</g>
<!-- expert_7&#45;&gt;aggregator -->
<g id="edge16" class="edge">
<title>expert_7&#45;&gt;aggregator</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1225.88,-83.17C1233.52,-86.1 1241.02,-89.21 1248.26,-92.5 1381.52,-153.02 1518.73,-252.04 1605.5,-320.1"/>
<polygon fill="black" stroke="black" points="1603.46,-322.95 1613.48,-326.38 1607.79,-317.45 1603.46,-322.95"/>
</g>
</g>
</svg>
