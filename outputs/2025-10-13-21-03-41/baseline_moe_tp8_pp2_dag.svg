<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: baseline_moe_tp8_pp2 Pages: 1 -->
<svg width="2160pt" height="549pt"
 viewBox="0.00 0.00 2160.00 549.45" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.11 0.11) rotate(0) translate(4 4858.93)">
<title>baseline_moe_tp8_pp2</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-4858.93 19113.09,-4858.93 19113.09,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="lightcyan" stroke="black" d="M20,-2482.23C20,-2482.23 18187,-2482.23 18187,-2482.23 18193,-2482.23 18199,-2488.23 18199,-2494.23 18199,-2494.23 18199,-4834.93 18199,-4834.93 18199,-4840.93 18193,-4846.93 18187,-4846.93 18187,-4846.93 20,-4846.93 20,-4846.93 14,-4846.93 8,-4840.93 8,-4834.93 8,-4834.93 8,-2494.23 8,-2494.23 8,-2488.23 14,-2482.23 20,-2482.23"/>
<text text-anchor="middle" x="9103.5" y="-4831.73" font-family="Times,serif" font-size="14.00">Pipeline Stage 0 (GPUs 0&#45;7)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer0_s0</title>
<path fill="lightcyan" stroke="blue" d="M28,-3616.31C28,-3616.31 18179,-3616.31 18179,-3616.31 18185,-3616.31 18191,-3622.31 18191,-3628.31 18191,-3628.31 18191,-4722.39 18191,-4722.39 18191,-4728.39 18185,-4734.39 18179,-4734.39 18179,-4734.39 28,-4734.39 28,-4734.39 22,-4734.39 16,-4728.39 16,-4722.39 16,-4722.39 16,-3628.31 16,-3628.31 16,-3622.31 22,-3616.31 28,-3616.31"/>
<text text-anchor="middle" x="9103.5" y="-4719.19" font-family="Times,serif" font-size="14.00">Layer 0 (Stage 0)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer1_s0</title>
<path fill="lightcyan" stroke="green" d="M29,-2490.23C29,-2490.23 18179,-2490.23 18179,-2490.23 18185,-2490.23 18191,-2496.23 18191,-2502.23 18191,-2502.23 18191,-3596.31 18191,-3596.31 18191,-3602.31 18185,-3608.31 18179,-3608.31 18179,-3608.31 29,-3608.31 29,-3608.31 23,-3608.31 17,-3602.31 17,-3596.31 17,-3596.31 17,-2502.23 17,-2502.23 17,-2496.23 23,-2490.23 29,-2490.23"/>
<text text-anchor="middle" x="9104" y="-3593.11" font-family="Times,serif" font-size="14.00">Layer 1 (Stage 0)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage1</title>
<path fill="lightyellow" stroke="black" d="M922,-8C922,-8 19088,-8 19088,-8 19094,-8 19100,-14 19100,-20 19100,-20 19100,-2462.23 19100,-2462.23 19100,-2468.23 19094,-2474.23 19088,-2474.23 19088,-2474.23 922,-2474.23 922,-2474.23 916,-2474.23 910,-2468.23 910,-2462.23 910,-2462.23 910,-20 910,-20 910,-14 916,-8 922,-8"/>
<text text-anchor="middle" x="10005" y="-2459.03" font-family="Times,serif" font-size="14.00">Pipeline Stage 1 (GPUs 8&#45;15)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_layer2_s1</title>
<path fill="lightyellow" stroke="red" d="M930,-1243.62C930,-1243.62 19080,-1243.62 19080,-1243.62 19086,-1243.62 19092,-1249.62 19092,-1255.62 19092,-1255.62 19092,-2349.7 19092,-2349.7 19092,-2355.7 19086,-2361.7 19080,-2361.7 19080,-2361.7 930,-2361.7 930,-2361.7 924,-2361.7 918,-2355.7 918,-2349.7 918,-2349.7 918,-1255.62 918,-1255.62 918,-1249.62 924,-1243.62 930,-1243.62"/>
<text text-anchor="middle" x="10005" y="-2346.5" font-family="Times,serif" font-size="14.00">Layer 2 (Stage 1)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_layer3_s1</title>
<path fill="lightyellow" stroke="purple" d="M930,-117.54C930,-117.54 19080,-117.54 19080,-117.54 19086,-117.54 19092,-123.54 19092,-129.54 19092,-129.54 19092,-1223.62 19092,-1223.62 19092,-1229.62 19086,-1235.62 19080,-1235.62 19080,-1235.62 930,-1235.62 930,-1235.62 924,-1235.62 918,-1229.62 918,-1223.62 918,-1223.62 918,-129.54 918,-129.54 918,-123.54 924,-117.54 930,-117.54"/>
<text text-anchor="middle" x="10005" y="-1220.42" font-family="Times,serif" font-size="14.00">Layer 3 (Stage 1)</text>
</g>
<!-- stage0_input -->
<g id="node1" class="node">
<title>stage0_input</title>
<ellipse fill="lightblue" stroke="black" cx="10082" cy="-4779.16" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="10082" y="-4793.16" font-family="Arial" font-size="10.00">Stage 0 Input</text>
<text text-anchor="middle" x="10082" y="-4782.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10082" y="-4771.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10082" y="-4760.16" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- input_split_l0_tp0 -->
<g id="node2" class="node">
<title>input_split_l0_tp0</title>
<ellipse fill="lightgray" stroke="black" cx="7221" cy="-4666.62" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="7221" y="-4680.62" font-family="Arial" font-size="10.00">Input Split TP0</text>
<text text-anchor="middle" x="7221" y="-4669.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7221" y="-4658.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7221" y="-4647.62" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- stage0_input&#45;&gt;input_split_l0_tp0 -->
<g id="edge1" class="edge">
<title>stage0_input&#45;&gt;input_split_l0_tp0</title>
<path fill="none" stroke="black" d="M9893.87,-4778.44C9327,-4778.8 7659.49,-4776.24 7418,-4734.39 7381.24,-4728.02 7342.07,-4715.92 7308.42,-4703.75"/>
<polygon fill="black" stroke="black" points="7309.22,-4700.31 7298.63,-4700.15 7306.8,-4706.88 7309.22,-4700.31"/>
</g>
<!-- res_add_l0_tp0 -->
<g id="node7" class="node">
<title>res_add_l0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="7360,-4220.31 7082,-4220.31 7082,-4168.31 7360,-4168.31 7360,-4220.31"/>
<text text-anchor="middle" x="7221" y="-4208.31" font-family="Arial" font-size="10.00">Residual Add TP0</text>
<text text-anchor="middle" x="7221" y="-4197.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="7221" y="-4186.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7221" y="-4175.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- stage0_input&#45;&gt;res_add_l0_tp0 -->
<g id="edge6" class="edge">
<title>stage0_input&#45;&gt;res_add_l0_tp0</title>
<path fill="none" stroke="black" d="M10165.72,-4746.13C10169.58,-4742.61 10173.06,-4738.71 10176,-4734.39 10196.74,-4703.93 10186,-4605.71 10186,-4568.85 10186,-4568.85 10186,-4568.85 10186,-4390.85 10186,-4360.87 10197.83,-4276.86 10176,-4256.31 10148.59,-4230.53 7504.57,-4222.47 7467,-4220.31 7435.68,-4218.52 7402.18,-4215.71 7370.32,-4212.61"/>
<polygon fill="black" stroke="black" points="7370.33,-4209.1 7360.03,-4211.6 7369.64,-4216.06 7370.33,-4209.1"/>
</g>
<!-- input_split_l0_tp1 -->
<g id="node9" class="node">
<title>input_split_l0_tp1</title>
<ellipse fill="lightgray" stroke="black" cx="7615" cy="-4666.62" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="7615" y="-4680.62" font-family="Arial" font-size="10.00">Input Split TP1</text>
<text text-anchor="middle" x="7615" y="-4669.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7615" y="-4658.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7615" y="-4647.62" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- stage0_input&#45;&gt;input_split_l0_tp1 -->
<g id="edge29" class="edge">
<title>stage0_input&#45;&gt;input_split_l0_tp1</title>
<path fill="none" stroke="black" d="M9893.81,-4777.84C9386.27,-4776.52 8013.91,-4769.68 7812,-4734.39 7775.41,-4728 7736.43,-4715.96 7702.88,-4703.85"/>
<polygon fill="black" stroke="black" points="7703.7,-4700.43 7693.11,-4700.27 7701.29,-4707 7703.7,-4700.43"/>
</g>
<!-- res_add_l0_tp1 -->
<g id="node14" class="node">
<title>res_add_l0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="7754,-4220.31 7476,-4220.31 7476,-4168.31 7754,-4168.31 7754,-4220.31"/>
<text text-anchor="middle" x="7615" y="-4208.31" font-family="Arial" font-size="10.00">Residual Add TP1</text>
<text text-anchor="middle" x="7615" y="-4197.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="7615" y="-4186.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7615" y="-4175.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- stage0_input&#45;&gt;res_add_l0_tp1 -->
<g id="edge34" class="edge">
<title>stage0_input&#45;&gt;res_add_l0_tp1</title>
<path fill="none" stroke="black" d="M10178.32,-4747.53C10183.06,-4743.66 10187.35,-4739.3 10191,-4734.39 10213.05,-4704.76 10206,-4605.79 10206,-4568.85 10206,-4568.85 10206,-4568.85 10206,-4390.85 10206,-4360.77 10213.26,-4276.54 10191,-4256.31 10143.09,-4212.78 7925.62,-4224.09 7861,-4220.31 7829.68,-4218.48 7796.19,-4215.66 7764.32,-4212.56"/>
<polygon fill="black" stroke="black" points="7764.33,-4209.04 7754.04,-4211.54 7763.65,-4216.01 7764.33,-4209.04"/>
</g>
<!-- input_split_l0_tp2 -->
<g id="node16" class="node">
<title>input_split_l0_tp2</title>
<ellipse fill="lightgray" stroke="black" cx="8009" cy="-4666.62" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8009" y="-4680.62" font-family="Arial" font-size="10.00">Input Split TP2</text>
<text text-anchor="middle" x="8009" y="-4669.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8009" y="-4658.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8009" y="-4647.62" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- stage0_input&#45;&gt;input_split_l0_tp2 -->
<g id="edge57" class="edge">
<title>stage0_input&#45;&gt;input_split_l0_tp2</title>
<path fill="none" stroke="black" d="M9894.19,-4777.01C9451.71,-4773.82 8368.71,-4763.17 8206,-4734.39 8169.43,-4727.92 8130.44,-4715.87 8096.89,-4703.77"/>
<polygon fill="black" stroke="black" points="8097.71,-4700.35 8087.12,-4700.2 8095.31,-4706.92 8097.71,-4700.35"/>
</g>
<!-- res_add_l0_tp2 -->
<g id="node21" class="node">
<title>res_add_l0_tp2</title>
<polygon fill="lightgreen" stroke="black" points="8148,-4220.31 7870,-4220.31 7870,-4168.31 8148,-4168.31 8148,-4220.31"/>
<text text-anchor="middle" x="8009" y="-4208.31" font-family="Arial" font-size="10.00">Residual Add TP2</text>
<text text-anchor="middle" x="8009" y="-4197.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="8009" y="-4186.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8009" y="-4175.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- stage0_input&#45;&gt;res_add_l0_tp2 -->
<g id="edge62" class="edge">
<title>stage0_input&#45;&gt;res_add_l0_tp2</title>
<path fill="none" stroke="black" d="M10194.99,-4749.72C10200.96,-4745.32 10206.39,-4740.24 10211,-4734.39 10233.85,-4705.37 10226,-4605.79 10226,-4568.85 10226,-4568.85 10226,-4568.85 10226,-4390.85 10226,-4360.77 10233.23,-4276.58 10211,-4256.31 10170.84,-4219.71 8309.25,-4223.56 8255,-4220.31 8223.68,-4218.44 8190.19,-4215.59 8158.33,-4212.49"/>
<polygon fill="black" stroke="black" points="8158.34,-4208.97 8148.04,-4211.47 8157.65,-4215.94 8158.34,-4208.97"/>
</g>
<!-- input_split_l0_tp3 -->
<g id="node23" class="node">
<title>input_split_l0_tp3</title>
<ellipse fill="lightgray" stroke="black" cx="8403" cy="-4666.62" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8403" y="-4680.62" font-family="Arial" font-size="10.00">Input Split TP3</text>
<text text-anchor="middle" x="8403" y="-4669.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8403" y="-4658.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8403" y="-4647.62" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- stage0_input&#45;&gt;input_split_l0_tp3 -->
<g id="edge85" class="edge">
<title>stage0_input&#45;&gt;input_split_l0_tp3</title>
<path fill="none" stroke="black" d="M9894.62,-4775.73C9524.35,-4770.48 8723.93,-4756.71 8600,-4734.39 8563.45,-4727.81 8524.47,-4715.74 8490.91,-4703.65"/>
<polygon fill="black" stroke="black" points="8491.73,-4700.23 8481.14,-4700.08 8489.33,-4706.8 8491.73,-4700.23"/>
</g>
<!-- res_add_l0_tp3 -->
<g id="node28" class="node">
<title>res_add_l0_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8542,-4220.31 8264,-4220.31 8264,-4168.31 8542,-4168.31 8542,-4220.31"/>
<text text-anchor="middle" x="8403" y="-4208.31" font-family="Arial" font-size="10.00">Residual Add TP3</text>
<text text-anchor="middle" x="8403" y="-4197.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="8403" y="-4186.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8403" y="-4175.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- stage0_input&#45;&gt;res_add_l0_tp3 -->
<g id="edge90" class="edge">
<title>stage0_input&#45;&gt;res_add_l0_tp3</title>
<path fill="none" stroke="black" d="M10211.02,-4752.26C10218.48,-4747.27 10225.27,-4741.37 10231,-4734.39 10254.45,-4705.85 10246,-4605.79 10246,-4568.85 10246,-4568.85 10246,-4568.85 10246,-4390.85 10246,-4360.77 10253.08,-4276.74 10231,-4256.31 10200.32,-4227.93 8983.09,-4204.96 8552.24,-4197.71"/>
<polygon fill="black" stroke="black" points="8552.27,-4194.21 8542.21,-4197.54 8552.15,-4201.21 8552.27,-4194.21"/>
</g>
<!-- input_split_l0_tp4 -->
<g id="node30" class="node">
<title>input_split_l0_tp4</title>
<ellipse fill="lightgray" stroke="black" cx="8797" cy="-4666.62" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8797" y="-4680.62" font-family="Arial" font-size="10.00">Input Split TP4</text>
<text text-anchor="middle" x="8797" y="-4669.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8797" y="-4658.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8797" y="-4647.62" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- stage0_input&#45;&gt;input_split_l0_tp4 -->
<g id="edge113" class="edge">
<title>stage0_input&#45;&gt;input_split_l0_tp4</title>
<path fill="none" stroke="black" d="M9894.11,-4777.07C9629.58,-4774.43 9160.99,-4765.38 8994,-4734.39 8957.64,-4727.64 8918.86,-4715.61 8885.4,-4703.6"/>
<polygon fill="black" stroke="black" points="8886.24,-4700.19 8875.65,-4700.05 8883.85,-4706.76 8886.24,-4700.19"/>
</g>
<!-- res_add_l0_tp4 -->
<g id="node35" class="node">
<title>res_add_l0_tp4</title>
<polygon fill="lightgreen" stroke="black" points="10060,-4220.31 9782,-4220.31 9782,-4168.31 10060,-4168.31 10060,-4220.31"/>
<text text-anchor="middle" x="9921" y="-4208.31" font-family="Arial" font-size="10.00">Residual Add TP4</text>
<text text-anchor="middle" x="9921" y="-4197.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="9921" y="-4186.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9921" y="-4175.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- stage0_input&#45;&gt;res_add_l0_tp4 -->
<g id="edge118" class="edge">
<title>stage0_input&#45;&gt;res_add_l0_tp4</title>
<path fill="none" stroke="black" d="M10215.59,-4753.19C10231.87,-4747.81 10244.92,-4741.55 10251,-4734.39 10274.9,-4706.23 10266,-4605.79 10266,-4568.85 10266,-4568.85 10266,-4568.85 10266,-4390.85 10266,-4360.77 10271.5,-4278.33 10251,-4256.31 10247.65,-4252.71 10156,-4235.94 10070.15,-4220.89"/>
<polygon fill="black" stroke="black" points="10070.71,-4217.43 10060.25,-4219.15 10069.5,-4224.33 10070.71,-4217.43"/>
</g>
<!-- input_split_l0_tp5 -->
<g id="node37" class="node">
<title>input_split_l0_tp5</title>
<ellipse fill="lightgray" stroke="black" cx="9191" cy="-4666.62" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9191" y="-4680.62" font-family="Arial" font-size="10.00">Input Split TP5</text>
<text text-anchor="middle" x="9191" y="-4669.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9191" y="-4658.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9191" y="-4647.62" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- stage0_input&#45;&gt;input_split_l0_tp5 -->
<g id="edge141" class="edge">
<title>stage0_input&#45;&gt;input_split_l0_tp5</title>
<path fill="none" stroke="black" d="M9897.12,-4772C9725.15,-4765.26 9481.79,-4752.9 9388,-4734.39 9352.05,-4727.29 9313.64,-4715.33 9280.38,-4703.48"/>
<polygon fill="black" stroke="black" points="9281.28,-4700.08 9270.68,-4699.97 9278.9,-4706.66 9281.28,-4700.08"/>
</g>
<!-- res_add_l0_tp5 -->
<g id="node42" class="node">
<title>res_add_l0_tp5</title>
<polygon fill="lightgreen" stroke="black" points="10356,-4220.31 10078,-4220.31 10078,-4168.31 10356,-4168.31 10356,-4220.31"/>
<text text-anchor="middle" x="10217" y="-4208.31" font-family="Arial" font-size="10.00">Residual Add TP5</text>
<text text-anchor="middle" x="10217" y="-4197.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="10217" y="-4186.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10217" y="-4175.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- stage0_input&#45;&gt;res_add_l0_tp5 -->
<g id="edge146" class="edge">
<title>stage0_input&#45;&gt;res_add_l0_tp5</title>
<path fill="none" stroke="black" d="M10227.27,-4755.6C10247.35,-4749.84 10263.64,-4742.83 10271,-4734.39 10319.53,-4678.7 10286,-4642.73 10286,-4568.85 10286,-4568.85 10286,-4568.85 10286,-4390.85 10286,-4330.69 10295.41,-4311.3 10271,-4256.31 10266.47,-4246.12 10259.61,-4236.42 10252.28,-4227.87"/>
<polygon fill="black" stroke="black" points="10254.79,-4225.42 10245.48,-4220.37 10249.6,-4230.12 10254.79,-4225.42"/>
</g>
<!-- input_split_l0_tp6 -->
<g id="node44" class="node">
<title>input_split_l0_tp6</title>
<ellipse fill="lightgray" stroke="black" cx="9585" cy="-4666.62" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9585" y="-4680.62" font-family="Arial" font-size="10.00">Input Split TP6</text>
<text text-anchor="middle" x="9585" y="-4669.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9585" y="-4658.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9585" y="-4647.62" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- stage0_input&#45;&gt;input_split_l0_tp6 -->
<g id="edge169" class="edge">
<title>stage0_input&#45;&gt;input_split_l0_tp6</title>
<path fill="none" stroke="black" d="M9920.61,-4760.11C9875.43,-4753.57 9826.52,-4745.09 9782,-4734.39 9747.49,-4726.1 9710.43,-4714.33 9677.88,-4702.98"/>
<polygon fill="black" stroke="black" points="9678.97,-4699.65 9668.37,-4699.63 9676.64,-4706.25 9678.97,-4699.65"/>
</g>
<!-- res_add_l0_tp6 -->
<g id="node49" class="node">
<title>res_add_l0_tp6</title>
<polygon fill="lightgreen" stroke="black" points="10652,-4220.31 10374,-4220.31 10374,-4168.31 10652,-4168.31 10652,-4220.31"/>
<text text-anchor="middle" x="10513" y="-4208.31" font-family="Arial" font-size="10.00">Residual Add TP6</text>
<text text-anchor="middle" x="10513" y="-4197.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="10513" y="-4186.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10513" y="-4175.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- stage0_input&#45;&gt;res_add_l0_tp6 -->
<g id="edge174" class="edge">
<title>stage0_input&#45;&gt;res_add_l0_tp6</title>
<path fill="none" stroke="black" d="M10233.79,-4757.36C10253.05,-4751.5 10271.96,-4744 10289,-4734.39 10376.8,-4684.9 10444,-4669.64 10444,-4568.85 10444,-4568.85 10444,-4568.85 10444,-4390.85 10444,-4331.61 10472.51,-4267.74 10492.88,-4229.66"/>
<polygon fill="black" stroke="black" points="10496.13,-4231.01 10497.86,-4220.56 10489.99,-4227.65 10496.13,-4231.01"/>
</g>
<!-- input_split_l0_tp7 -->
<g id="node51" class="node">
<title>input_split_l0_tp7</title>
<ellipse fill="lightgray" stroke="black" cx="9979" cy="-4666.62" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9979" y="-4680.62" font-family="Arial" font-size="10.00">Input Split TP7</text>
<text text-anchor="middle" x="9979" y="-4669.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9979" y="-4658.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9979" y="-4647.62" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- stage0_input&#45;&gt;input_split_l0_tp7 -->
<g id="edge197" class="edge">
<title>stage0_input&#45;&gt;input_split_l0_tp7</title>
<path fill="none" stroke="black" d="M10049.13,-4742.88C10039.46,-4732.51 10028.79,-4721.06 10018.75,-4710.28"/>
<polygon fill="black" stroke="black" points="10021.29,-4707.87 10011.91,-4702.94 10016.17,-4712.65 10021.29,-4707.87"/>
</g>
<!-- res_add_l0_tp7 -->
<g id="node56" class="node">
<title>res_add_l0_tp7</title>
<polygon fill="lightgreen" stroke="black" points="10948,-4220.31 10670,-4220.31 10670,-4168.31 10948,-4168.31 10948,-4220.31"/>
<text text-anchor="middle" x="10809" y="-4208.31" font-family="Arial" font-size="10.00">Residual Add TP7</text>
<text text-anchor="middle" x="10809" y="-4197.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="10809" y="-4186.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10809" y="-4175.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- stage0_input&#45;&gt;res_add_l0_tp7 -->
<g id="edge202" class="edge">
<title>stage0_input&#45;&gt;res_add_l0_tp7</title>
<path fill="none" stroke="black" d="M10248.89,-4762.05C10287.62,-4755.66 10328.25,-4746.76 10365,-4734.39 10511.55,-4685.07 10671,-4723.48 10671,-4568.85 10671,-4568.85 10671,-4568.85 10671,-4390.85 10671,-4322.93 10727.27,-4262.02 10767.94,-4226.87"/>
<polygon fill="black" stroke="black" points="10770.22,-4229.52 10775.59,-4220.39 10765.7,-4224.18 10770.22,-4229.52"/>
</g>
<!-- mha_qkv_l0_tp0 -->
<g id="node3" class="node">
<title>mha_qkv_l0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="7366.5,-4593.85 7075.5,-4593.85 7075.5,-4541.85 7366.5,-4541.85 7366.5,-4593.85"/>
<text text-anchor="middle" x="7221" y="-4581.85" font-family="Arial" font-size="10.00">MHA QKV TP0</text>
<text text-anchor="middle" x="7221" y="-4570.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7221" y="-4559.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7221" y="-4548.85" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- input_split_l0_tp0&#45;&gt;mha_qkv_l0_tp0 -->
<g id="edge2" class="edge">
<title>input_split_l0_tp0&#45;&gt;mha_qkv_l0_tp0</title>
<path fill="none" stroke="black" d="M7221,-4629.59C7221,-4621.28 7221,-4612.44 7221,-4604.16"/>
<polygon fill="black" stroke="black" points="7224.5,-4604.05 7221,-4594.05 7217.5,-4604.05 7224.5,-4604.05"/>
</g>
<!-- mha_attn_l0_tp0 -->
<g id="node4" class="node">
<title>mha_attn_l0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="7366.5,-4505.85 7075.5,-4505.85 7075.5,-4453.85 7366.5,-4453.85 7366.5,-4505.85"/>
<text text-anchor="middle" x="7221" y="-4493.85" font-family="Arial" font-size="10.00">MHA Attention TP0</text>
<text text-anchor="middle" x="7221" y="-4482.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7221" y="-4471.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7221" y="-4460.85" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- mha_qkv_l0_tp0&#45;&gt;mha_attn_l0_tp0 -->
<g id="edge3" class="edge">
<title>mha_qkv_l0_tp0&#45;&gt;mha_attn_l0_tp0</title>
<path fill="none" stroke="black" d="M7221,-4541.51C7221,-4533.55 7221,-4524.62 7221,-4516.1"/>
<polygon fill="black" stroke="black" points="7224.5,-4516.01 7221,-4506.01 7217.5,-4516.01 7224.5,-4516.01"/>
</g>
<!-- mha_out_l0_tp0 -->
<g id="node5" class="node">
<title>mha_out_l0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="7363,-4417.85 7079,-4417.85 7079,-4365.85 7363,-4365.85 7363,-4417.85"/>
<text text-anchor="middle" x="7221" y="-4405.85" font-family="Arial" font-size="10.00">MHA Output TP0</text>
<text text-anchor="middle" x="7221" y="-4394.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7221" y="-4383.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7221" y="-4372.85" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- mha_attn_l0_tp0&#45;&gt;mha_out_l0_tp0 -->
<g id="edge4" class="edge">
<title>mha_attn_l0_tp0&#45;&gt;mha_out_l0_tp0</title>
<path fill="none" stroke="black" d="M7221,-4453.51C7221,-4445.55 7221,-4436.62 7221,-4428.1"/>
<polygon fill="black" stroke="black" points="7224.5,-4428.01 7221,-4418.01 7217.5,-4428.01 7224.5,-4428.01"/>
</g>
<!-- attn_allreduce_l0_tp0 -->
<g id="node6" class="node">
<title>attn_allreduce_l0_tp0</title>
<ellipse fill="lightgray" stroke="black" cx="7221" cy="-4293.08" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="7221" y="-4307.08" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP0</text>
<text text-anchor="middle" x="7221" y="-4296.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7221" y="-4285.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7221" y="-4274.08" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- mha_out_l0_tp0&#45;&gt;attn_allreduce_l0_tp0 -->
<g id="edge5" class="edge">
<title>mha_out_l0_tp0&#45;&gt;attn_allreduce_l0_tp0</title>
<path fill="none" stroke="black" d="M7221,-4365.68C7221,-4357.87 7221,-4349.01 7221,-4340.24"/>
<polygon fill="black" stroke="black" points="7224.5,-4340.06 7221,-4330.06 7217.5,-4340.06 7224.5,-4340.06"/>
</g>
<!-- attn_allreduce_l0_tp0&#45;&gt;res_add_l0_tp0 -->
<g id="edge7" class="edge">
<title>attn_allreduce_l0_tp0&#45;&gt;res_add_l0_tp0</title>
<path fill="none" stroke="black" d="M7221,-4256.05C7221,-4247.74 7221,-4238.9 7221,-4230.62"/>
<polygon fill="black" stroke="black" points="7224.5,-4230.51 7221,-4220.51 7217.5,-4230.51 7224.5,-4230.51"/>
</g>
<!-- norm_l0_tp0 -->
<g id="node8" class="node">
<title>norm_l0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1281,-4132.31 1015,-4132.31 1015,-4080.31 1281,-4080.31 1281,-4132.31"/>
<text text-anchor="middle" x="1148" y="-4120.31" font-family="Arial" font-size="10.00">Layer Norm TP0</text>
<text text-anchor="middle" x="1148" y="-4109.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="1148" y="-4098.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="1148" y="-4087.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- res_add_l0_tp0&#45;&gt;norm_l0_tp0 -->
<g id="edge8" class="edge">
<title>res_add_l0_tp0&#45;&gt;norm_l0_tp0</title>
<path fill="none" stroke="black" d="M7081.65,-4191.34C6265.92,-4179.79 2117.23,-4121.04 1291.17,-4109.34"/>
<polygon fill="black" stroke="black" points="1291.06,-4105.84 1281.01,-4109.2 1290.96,-4112.84 1291.06,-4105.84"/>
</g>
<!-- gate_l0_tp0 -->
<g id="node58" class="node">
<title>gate_l0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2278.3,-4044.31 1811.72,-4044.31 1691.7,-3940.31 2158.28,-3940.31 2278.3,-4044.31"/>
<text text-anchor="middle" x="1985" y="-4006.31" font-family="Arial" font-size="10.00">Gate Network TP0</text>
<text text-anchor="middle" x="1985" y="-3995.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="1985" y="-3984.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="1985" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l0_tp0&#45;&gt;gate_l0_tp0 -->
<g id="edge9" class="edge">
<title>norm_l0_tp0&#45;&gt;gate_l0_tp0</title>
<path fill="none" stroke="black" d="M1281.1,-4091.86C1388.43,-4080.56 1543.17,-4063.26 1678,-4044.31 1711.48,-4039.61 1746.93,-4034.16 1781.4,-4028.6"/>
<polygon fill="black" stroke="black" points="1782.26,-4032.01 1791.57,-4026.96 1781.14,-4025.1 1782.26,-4032.01"/>
</g>
<!-- expert0_l0_tp0 -->
<g id="node66" class="node">
<title>expert0_l0_tp0</title>
<polygon fill="lightcoral" stroke="black" points="1654,-4018.31 1466,-4018.31 1466,-3966.31 1654,-3966.31 1654,-4018.31"/>
<text text-anchor="middle" x="1560" y="-4006.31" font-family="Arial" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="1560" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1560" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1560" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l0_tp0&#45;&gt;expert0_l0_tp0 -->
<g id="edge10" class="edge">
<title>norm_l0_tp0&#45;&gt;expert0_l0_tp0</title>
<path fill="none" stroke="black" d="M1281.2,-4086.96C1336.46,-4077.32 1400.69,-4063.43 1457,-4044.31 1473.74,-4038.63 1491.23,-4030.77 1506.95,-4022.92"/>
<polygon fill="black" stroke="black" points="1508.66,-4025.98 1515.98,-4018.32 1505.48,-4019.74 1508.66,-4025.98"/>
</g>
<!-- expert1_l0_tp0 -->
<g id="node67" class="node">
<title>expert1_l0_tp0</title>
<polygon fill="lightcoral" stroke="black" points="212,-4018.31 24,-4018.31 24,-3966.31 212,-3966.31 212,-4018.31"/>
<text text-anchor="middle" x="118" y="-4006.31" font-family="Arial" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="118" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="118" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="118" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l0_tp0&#45;&gt;expert1_l0_tp0 -->
<g id="edge12" class="edge">
<title>norm_l0_tp0&#45;&gt;expert1_l0_tp0</title>
<path fill="none" stroke="black" d="M1014.89,-4102.96C795.28,-4098.01 366.82,-4083.53 221,-4044.31 203.12,-4039.5 184.67,-4031.48 168.41,-4023.21"/>
<polygon fill="black" stroke="black" points="169.6,-4019.87 159.11,-4018.33 166.34,-4026.07 169.6,-4019.87"/>
</g>
<!-- expert2_l0_tp0 -->
<g id="node68" class="node">
<title>expert2_l0_tp0</title>
<polygon fill="lightcoral" stroke="black" points="418,-4018.31 230,-4018.31 230,-3966.31 418,-3966.31 418,-4018.31"/>
<text text-anchor="middle" x="324" y="-4006.31" font-family="Arial" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="324" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="324" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="324" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l0_tp0&#45;&gt;expert2_l0_tp0 -->
<g id="edge14" class="edge">
<title>norm_l0_tp0&#45;&gt;expert2_l0_tp0</title>
<path fill="none" stroke="black" d="M1014.99,-4100.01C837.76,-4091.91 534.08,-4074.19 427,-4044.31 409.33,-4039.38 391.06,-4031.41 374.91,-4023.23"/>
<polygon fill="black" stroke="black" points="376.15,-4019.92 365.66,-4018.4 372.91,-4026.13 376.15,-4019.92"/>
</g>
<!-- expert3_l0_tp0 -->
<g id="node69" class="node">
<title>expert3_l0_tp0</title>
<polygon fill="lightcoral" stroke="black" points="624,-4018.31 436,-4018.31 436,-3966.31 624,-3966.31 624,-4018.31"/>
<text text-anchor="middle" x="530" y="-4006.31" font-family="Arial" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="530" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="530" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="530" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l0_tp0&#45;&gt;expert3_l0_tp0 -->
<g id="edge16" class="edge">
<title>norm_l0_tp0&#45;&gt;expert3_l0_tp0</title>
<path fill="none" stroke="black" d="M1014.79,-4101.97C909.31,-4096.38 759.22,-4081.82 633,-4044.31 615.57,-4039.13 597.5,-4031.18 581.45,-4023.08"/>
<polygon fill="black" stroke="black" points="582.75,-4019.81 572.26,-4018.32 579.53,-4026.03 582.75,-4019.81"/>
</g>
<!-- expert4_l0_tp0 -->
<g id="node70" class="node">
<title>expert4_l0_tp0</title>
<polygon fill="lightcoral" stroke="black" points="830,-4018.31 642,-4018.31 642,-3966.31 830,-3966.31 830,-4018.31"/>
<text text-anchor="middle" x="736" y="-4006.31" font-family="Arial" font-size="10.00">Expert 4</text>
<text text-anchor="middle" x="736" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="736" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="736" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l0_tp0&#45;&gt;expert4_l0_tp0 -->
<g id="edge18" class="edge">
<title>norm_l0_tp0&#45;&gt;expert4_l0_tp0</title>
<path fill="none" stroke="black" d="M1014.8,-4086.96C959.54,-4077.32 895.31,-4063.43 839,-4044.31 822.26,-4038.63 804.77,-4030.77 789.05,-4022.92"/>
<polygon fill="black" stroke="black" points="790.52,-4019.74 780.02,-4018.32 787.34,-4025.98 790.52,-4019.74"/>
</g>
<!-- expert5_l0_tp0 -->
<g id="node71" class="node">
<title>expert5_l0_tp0</title>
<polygon fill="lightcoral" stroke="black" points="1036,-4018.31 848,-4018.31 848,-3966.31 1036,-3966.31 1036,-4018.31"/>
<text text-anchor="middle" x="942" y="-4006.31" font-family="Arial" font-size="10.00">Expert 5</text>
<text text-anchor="middle" x="942" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="942" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="942" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l0_tp0&#45;&gt;expert5_l0_tp0 -->
<g id="edge20" class="edge">
<title>norm_l0_tp0&#45;&gt;expert5_l0_tp0</title>
<path fill="none" stroke="black" d="M1101.77,-4080.18C1070.76,-4063.32 1029.76,-4041.03 997.06,-4023.25"/>
<polygon fill="black" stroke="black" points="998.53,-4020.07 988.08,-4018.36 995.19,-4026.22 998.53,-4020.07"/>
</g>
<!-- expert6_l0_tp0 -->
<g id="node72" class="node">
<title>expert6_l0_tp0</title>
<polygon fill="lightcoral" stroke="black" points="1242,-4018.31 1054,-4018.31 1054,-3966.31 1242,-3966.31 1242,-4018.31"/>
<text text-anchor="middle" x="1148" y="-4006.31" font-family="Arial" font-size="10.00">Expert 6</text>
<text text-anchor="middle" x="1148" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1148" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1148" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l0_tp0&#45;&gt;expert6_l0_tp0 -->
<g id="edge22" class="edge">
<title>norm_l0_tp0&#45;&gt;expert6_l0_tp0</title>
<path fill="none" stroke="black" d="M1148,-4080.18C1148,-4064.9 1148,-4045.17 1148,-4028.38"/>
<polygon fill="black" stroke="black" points="1151.5,-4028.36 1148,-4018.36 1144.5,-4028.36 1151.5,-4028.36"/>
</g>
<!-- expert7_l0_tp0 -->
<g id="node73" class="node">
<title>expert7_l0_tp0</title>
<polygon fill="lightcoral" stroke="black" points="1448,-4018.31 1260,-4018.31 1260,-3966.31 1448,-3966.31 1448,-4018.31"/>
<text text-anchor="middle" x="1354" y="-4006.31" font-family="Arial" font-size="10.00">Expert 7</text>
<text text-anchor="middle" x="1354" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1354" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1354" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l0_tp0&#45;&gt;expert7_l0_tp0 -->
<g id="edge24" class="edge">
<title>norm_l0_tp0&#45;&gt;expert7_l0_tp0</title>
<path fill="none" stroke="black" d="M1194.23,-4080.18C1225.24,-4063.32 1266.24,-4041.03 1298.94,-4023.25"/>
<polygon fill="black" stroke="black" points="1300.81,-4026.22 1307.92,-4018.36 1297.47,-4020.07 1300.81,-4026.22"/>
</g>
<!-- res_add2_l0_tp0 -->
<g id="node131" class="node">
<title>res_add2_l0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1812,-3764.31 1534,-3764.31 1534,-3712.31 1812,-3712.31 1812,-3764.31"/>
<text text-anchor="middle" x="1673" y="-3752.31" font-family="Arial" font-size="10.00">Residual Add 2 TP0</text>
<text text-anchor="middle" x="1673" y="-3741.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="1673" y="-3730.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="1673" y="-3719.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l0_tp0&#45;&gt;res_add2_l0_tp0 -->
<g id="edge27" class="edge">
<title>norm_l0_tp0&#45;&gt;res_add2_l0_tp0</title>
<path fill="none" stroke="black" d="M1281.27,-4098.42C1425.21,-4089.6 1637.52,-4072.06 1663,-4044.31 1680.88,-4024.84 1676.96,-3850.3 1674.36,-3774.35"/>
<polygon fill="black" stroke="black" points="1677.86,-3774.19 1674.01,-3764.32 1670.86,-3774.44 1677.86,-3774.19"/>
</g>
<!-- mha_qkv_l0_tp1 -->
<g id="node10" class="node">
<title>mha_qkv_l0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="7760.5,-4593.85 7469.5,-4593.85 7469.5,-4541.85 7760.5,-4541.85 7760.5,-4593.85"/>
<text text-anchor="middle" x="7615" y="-4581.85" font-family="Arial" font-size="10.00">MHA QKV TP1</text>
<text text-anchor="middle" x="7615" y="-4570.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7615" y="-4559.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7615" y="-4548.85" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- input_split_l0_tp1&#45;&gt;mha_qkv_l0_tp1 -->
<g id="edge30" class="edge">
<title>input_split_l0_tp1&#45;&gt;mha_qkv_l0_tp1</title>
<path fill="none" stroke="black" d="M7615,-4629.59C7615,-4621.28 7615,-4612.44 7615,-4604.16"/>
<polygon fill="black" stroke="black" points="7618.5,-4604.05 7615,-4594.05 7611.5,-4604.05 7618.5,-4604.05"/>
</g>
<!-- mha_attn_l0_tp1 -->
<g id="node11" class="node">
<title>mha_attn_l0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="7760.5,-4505.85 7469.5,-4505.85 7469.5,-4453.85 7760.5,-4453.85 7760.5,-4505.85"/>
<text text-anchor="middle" x="7615" y="-4493.85" font-family="Arial" font-size="10.00">MHA Attention TP1</text>
<text text-anchor="middle" x="7615" y="-4482.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7615" y="-4471.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7615" y="-4460.85" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- mha_qkv_l0_tp1&#45;&gt;mha_attn_l0_tp1 -->
<g id="edge31" class="edge">
<title>mha_qkv_l0_tp1&#45;&gt;mha_attn_l0_tp1</title>
<path fill="none" stroke="black" d="M7615,-4541.51C7615,-4533.55 7615,-4524.62 7615,-4516.1"/>
<polygon fill="black" stroke="black" points="7618.5,-4516.01 7615,-4506.01 7611.5,-4516.01 7618.5,-4516.01"/>
</g>
<!-- mha_out_l0_tp1 -->
<g id="node12" class="node">
<title>mha_out_l0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="7757,-4417.85 7473,-4417.85 7473,-4365.85 7757,-4365.85 7757,-4417.85"/>
<text text-anchor="middle" x="7615" y="-4405.85" font-family="Arial" font-size="10.00">MHA Output TP1</text>
<text text-anchor="middle" x="7615" y="-4394.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7615" y="-4383.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7615" y="-4372.85" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- mha_attn_l0_tp1&#45;&gt;mha_out_l0_tp1 -->
<g id="edge32" class="edge">
<title>mha_attn_l0_tp1&#45;&gt;mha_out_l0_tp1</title>
<path fill="none" stroke="black" d="M7615,-4453.51C7615,-4445.55 7615,-4436.62 7615,-4428.1"/>
<polygon fill="black" stroke="black" points="7618.5,-4428.01 7615,-4418.01 7611.5,-4428.01 7618.5,-4428.01"/>
</g>
<!-- attn_allreduce_l0_tp1 -->
<g id="node13" class="node">
<title>attn_allreduce_l0_tp1</title>
<ellipse fill="lightgray" stroke="black" cx="7615" cy="-4293.08" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="7615" y="-4307.08" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP1</text>
<text text-anchor="middle" x="7615" y="-4296.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7615" y="-4285.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7615" y="-4274.08" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- mha_out_l0_tp1&#45;&gt;attn_allreduce_l0_tp1 -->
<g id="edge33" class="edge">
<title>mha_out_l0_tp1&#45;&gt;attn_allreduce_l0_tp1</title>
<path fill="none" stroke="black" d="M7615,-4365.68C7615,-4357.87 7615,-4349.01 7615,-4340.24"/>
<polygon fill="black" stroke="black" points="7618.5,-4340.06 7615,-4330.06 7611.5,-4340.06 7618.5,-4340.06"/>
</g>
<!-- attn_allreduce_l0_tp1&#45;&gt;res_add_l0_tp1 -->
<g id="edge35" class="edge">
<title>attn_allreduce_l0_tp1&#45;&gt;res_add_l0_tp1</title>
<path fill="none" stroke="black" d="M7615,-4256.05C7615,-4247.74 7615,-4238.9 7615,-4230.62"/>
<polygon fill="black" stroke="black" points="7618.5,-4230.51 7615,-4220.51 7611.5,-4230.51 7618.5,-4230.51"/>
</g>
<!-- norm_l0_tp1 -->
<g id="node15" class="node">
<title>norm_l0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3553,-4132.31 3287,-4132.31 3287,-4080.31 3553,-4080.31 3553,-4132.31"/>
<text text-anchor="middle" x="3420" y="-4120.31" font-family="Arial" font-size="10.00">Layer Norm TP1</text>
<text text-anchor="middle" x="3420" y="-4109.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3420" y="-4098.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3420" y="-4087.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- res_add_l0_tp1&#45;&gt;norm_l0_tp1 -->
<g id="edge36" class="edge">
<title>res_add_l0_tp1&#45;&gt;norm_l0_tp1</title>
<path fill="none" stroke="black" d="M7475.96,-4177.08C7441.09,-4173.59 7403.71,-4170.34 7369,-4168.31 6984.08,-4145.82 4226.85,-4115.76 3563.34,-4108.8"/>
<polygon fill="black" stroke="black" points="3563.28,-4105.3 3553.25,-4108.69 3563.21,-4112.3 3563.28,-4105.3"/>
</g>
<!-- gate_l0_tp1 -->
<g id="node59" class="node">
<title>gate_l0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="4550.3,-4044.31 4083.72,-4044.31 3963.7,-3940.31 4430.28,-3940.31 4550.3,-4044.31"/>
<text text-anchor="middle" x="4257" y="-4006.31" font-family="Arial" font-size="10.00">Gate Network TP1</text>
<text text-anchor="middle" x="4257" y="-3995.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4257" y="-3984.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="4257" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l0_tp1&#45;&gt;gate_l0_tp1 -->
<g id="edge37" class="edge">
<title>norm_l0_tp1&#45;&gt;gate_l0_tp1</title>
<path fill="none" stroke="black" d="M3553.1,-4091.86C3660.43,-4080.56 3815.17,-4063.26 3950,-4044.31 3983.48,-4039.61 4018.93,-4034.16 4053.4,-4028.6"/>
<polygon fill="black" stroke="black" points="4054.26,-4032.01 4063.57,-4026.96 4053.14,-4025.1 4054.26,-4032.01"/>
</g>
<!-- expert8_l0_tp1 -->
<g id="node74" class="node">
<title>expert8_l0_tp1</title>
<polygon fill="lightcoral" stroke="black" points="3720,-4018.31 3532,-4018.31 3532,-3966.31 3720,-3966.31 3720,-4018.31"/>
<text text-anchor="middle" x="3626" y="-4006.31" font-family="Arial" font-size="10.00">Expert 8</text>
<text text-anchor="middle" x="3626" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3626" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3626" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l0_tp1&#45;&gt;expert8_l0_tp1 -->
<g id="edge38" class="edge">
<title>norm_l0_tp1&#45;&gt;expert8_l0_tp1</title>
<path fill="none" stroke="black" d="M3466.23,-4080.18C3497.24,-4063.32 3538.24,-4041.03 3570.94,-4023.25"/>
<polygon fill="black" stroke="black" points="3572.81,-4026.22 3579.92,-4018.36 3569.47,-4020.07 3572.81,-4026.22"/>
</g>
<!-- expert9_l0_tp1 -->
<g id="node75" class="node">
<title>expert9_l0_tp1</title>
<polygon fill="lightcoral" stroke="black" points="3926,-4018.31 3738,-4018.31 3738,-3966.31 3926,-3966.31 3926,-4018.31"/>
<text text-anchor="middle" x="3832" y="-4006.31" font-family="Arial" font-size="10.00">Expert 9</text>
<text text-anchor="middle" x="3832" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3832" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3832" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l0_tp1&#45;&gt;expert9_l0_tp1 -->
<g id="edge40" class="edge">
<title>norm_l0_tp1&#45;&gt;expert9_l0_tp1</title>
<path fill="none" stroke="black" d="M3553.2,-4086.96C3608.46,-4077.32 3672.69,-4063.43 3729,-4044.31 3745.74,-4038.63 3763.23,-4030.77 3778.95,-4022.92"/>
<polygon fill="black" stroke="black" points="3780.66,-4025.98 3787.98,-4018.32 3777.48,-4019.74 3780.66,-4025.98"/>
</g>
<!-- expert10_l0_tp1 -->
<g id="node76" class="node">
<title>expert10_l0_tp1</title>
<polygon fill="lightcoral" stroke="black" points="2484,-4018.31 2296,-4018.31 2296,-3966.31 2484,-3966.31 2484,-4018.31"/>
<text text-anchor="middle" x="2390" y="-4006.31" font-family="Arial" font-size="10.00">Expert 10</text>
<text text-anchor="middle" x="2390" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2390" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2390" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l0_tp1&#45;&gt;expert10_l0_tp1 -->
<g id="edge42" class="edge">
<title>norm_l0_tp1&#45;&gt;expert10_l0_tp1</title>
<path fill="none" stroke="black" d="M3286.89,-4102.96C3067.28,-4098.01 2638.82,-4083.53 2493,-4044.31 2475.12,-4039.5 2456.67,-4031.48 2440.41,-4023.21"/>
<polygon fill="black" stroke="black" points="2441.6,-4019.87 2431.11,-4018.33 2438.34,-4026.07 2441.6,-4019.87"/>
</g>
<!-- expert11_l0_tp1 -->
<g id="node77" class="node">
<title>expert11_l0_tp1</title>
<polygon fill="lightcoral" stroke="black" points="2690,-4018.31 2502,-4018.31 2502,-3966.31 2690,-3966.31 2690,-4018.31"/>
<text text-anchor="middle" x="2596" y="-4006.31" font-family="Arial" font-size="10.00">Expert 11</text>
<text text-anchor="middle" x="2596" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2596" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2596" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l0_tp1&#45;&gt;expert11_l0_tp1 -->
<g id="edge44" class="edge">
<title>norm_l0_tp1&#45;&gt;expert11_l0_tp1</title>
<path fill="none" stroke="black" d="M3286.99,-4100.01C3109.76,-4091.91 2806.08,-4074.19 2699,-4044.31 2681.33,-4039.38 2663.06,-4031.41 2646.91,-4023.23"/>
<polygon fill="black" stroke="black" points="2648.15,-4019.92 2637.66,-4018.4 2644.91,-4026.13 2648.15,-4019.92"/>
</g>
<!-- expert12_l0_tp1 -->
<g id="node78" class="node">
<title>expert12_l0_tp1</title>
<polygon fill="lightcoral" stroke="black" points="2896,-4018.31 2708,-4018.31 2708,-3966.31 2896,-3966.31 2896,-4018.31"/>
<text text-anchor="middle" x="2802" y="-4006.31" font-family="Arial" font-size="10.00">Expert 12</text>
<text text-anchor="middle" x="2802" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2802" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2802" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l0_tp1&#45;&gt;expert12_l0_tp1 -->
<g id="edge46" class="edge">
<title>norm_l0_tp1&#45;&gt;expert12_l0_tp1</title>
<path fill="none" stroke="black" d="M3286.79,-4101.97C3181.31,-4096.38 3031.22,-4081.82 2905,-4044.31 2887.57,-4039.13 2869.5,-4031.18 2853.45,-4023.08"/>
<polygon fill="black" stroke="black" points="2854.75,-4019.81 2844.26,-4018.32 2851.53,-4026.03 2854.75,-4019.81"/>
</g>
<!-- expert13_l0_tp1 -->
<g id="node79" class="node">
<title>expert13_l0_tp1</title>
<polygon fill="lightcoral" stroke="black" points="3102,-4018.31 2914,-4018.31 2914,-3966.31 3102,-3966.31 3102,-4018.31"/>
<text text-anchor="middle" x="3008" y="-4006.31" font-family="Arial" font-size="10.00">Expert 13</text>
<text text-anchor="middle" x="3008" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3008" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3008" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l0_tp1&#45;&gt;expert13_l0_tp1 -->
<g id="edge48" class="edge">
<title>norm_l0_tp1&#45;&gt;expert13_l0_tp1</title>
<path fill="none" stroke="black" d="M3286.8,-4086.96C3231.54,-4077.32 3167.31,-4063.43 3111,-4044.31 3094.26,-4038.63 3076.77,-4030.77 3061.05,-4022.92"/>
<polygon fill="black" stroke="black" points="3062.52,-4019.74 3052.02,-4018.32 3059.34,-4025.98 3062.52,-4019.74"/>
</g>
<!-- expert14_l0_tp1 -->
<g id="node80" class="node">
<title>expert14_l0_tp1</title>
<polygon fill="lightcoral" stroke="black" points="3308,-4018.31 3120,-4018.31 3120,-3966.31 3308,-3966.31 3308,-4018.31"/>
<text text-anchor="middle" x="3214" y="-4006.31" font-family="Arial" font-size="10.00">Expert 14</text>
<text text-anchor="middle" x="3214" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3214" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3214" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l0_tp1&#45;&gt;expert14_l0_tp1 -->
<g id="edge50" class="edge">
<title>norm_l0_tp1&#45;&gt;expert14_l0_tp1</title>
<path fill="none" stroke="black" d="M3373.77,-4080.18C3342.76,-4063.32 3301.76,-4041.03 3269.06,-4023.25"/>
<polygon fill="black" stroke="black" points="3270.53,-4020.07 3260.08,-4018.36 3267.19,-4026.22 3270.53,-4020.07"/>
</g>
<!-- expert15_l0_tp1 -->
<g id="node81" class="node">
<title>expert15_l0_tp1</title>
<polygon fill="lightcoral" stroke="black" points="3514,-4018.31 3326,-4018.31 3326,-3966.31 3514,-3966.31 3514,-4018.31"/>
<text text-anchor="middle" x="3420" y="-4006.31" font-family="Arial" font-size="10.00">Expert 15</text>
<text text-anchor="middle" x="3420" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3420" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3420" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l0_tp1&#45;&gt;expert15_l0_tp1 -->
<g id="edge52" class="edge">
<title>norm_l0_tp1&#45;&gt;expert15_l0_tp1</title>
<path fill="none" stroke="black" d="M3420,-4080.18C3420,-4064.9 3420,-4045.17 3420,-4028.38"/>
<polygon fill="black" stroke="black" points="3423.5,-4028.36 3420,-4018.36 3416.5,-4028.36 3423.5,-4028.36"/>
</g>
<!-- res_add2_l0_tp1 -->
<g id="node134" class="node">
<title>res_add2_l0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="4084,-3764.31 3806,-3764.31 3806,-3712.31 4084,-3712.31 4084,-3764.31"/>
<text text-anchor="middle" x="3945" y="-3752.31" font-family="Arial" font-size="10.00">Residual Add 2 TP1</text>
<text text-anchor="middle" x="3945" y="-3741.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="3945" y="-3730.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3945" y="-3719.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l0_tp1&#45;&gt;res_add2_l0_tp1 -->
<g id="edge55" class="edge">
<title>norm_l0_tp1&#45;&gt;res_add2_l0_tp1</title>
<path fill="none" stroke="black" d="M3553.27,-4098.42C3697.21,-4089.6 3909.52,-4072.06 3935,-4044.31 3952.88,-4024.84 3948.96,-3850.3 3946.36,-3774.35"/>
<polygon fill="black" stroke="black" points="3949.86,-3774.19 3946.01,-3764.32 3942.86,-3774.44 3949.86,-3774.19"/>
</g>
<!-- mha_qkv_l0_tp2 -->
<g id="node17" class="node">
<title>mha_qkv_l0_tp2</title>
<polygon fill="lightgreen" stroke="black" points="8154.5,-4593.85 7863.5,-4593.85 7863.5,-4541.85 8154.5,-4541.85 8154.5,-4593.85"/>
<text text-anchor="middle" x="8009" y="-4581.85" font-family="Arial" font-size="10.00">MHA QKV TP2</text>
<text text-anchor="middle" x="8009" y="-4570.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8009" y="-4559.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8009" y="-4548.85" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- input_split_l0_tp2&#45;&gt;mha_qkv_l0_tp2 -->
<g id="edge58" class="edge">
<title>input_split_l0_tp2&#45;&gt;mha_qkv_l0_tp2</title>
<path fill="none" stroke="black" d="M8009,-4629.59C8009,-4621.28 8009,-4612.44 8009,-4604.16"/>
<polygon fill="black" stroke="black" points="8012.5,-4604.05 8009,-4594.05 8005.5,-4604.05 8012.5,-4604.05"/>
</g>
<!-- mha_attn_l0_tp2 -->
<g id="node18" class="node">
<title>mha_attn_l0_tp2</title>
<polygon fill="lightgreen" stroke="black" points="8154.5,-4505.85 7863.5,-4505.85 7863.5,-4453.85 8154.5,-4453.85 8154.5,-4505.85"/>
<text text-anchor="middle" x="8009" y="-4493.85" font-family="Arial" font-size="10.00">MHA Attention TP2</text>
<text text-anchor="middle" x="8009" y="-4482.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8009" y="-4471.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8009" y="-4460.85" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- mha_qkv_l0_tp2&#45;&gt;mha_attn_l0_tp2 -->
<g id="edge59" class="edge">
<title>mha_qkv_l0_tp2&#45;&gt;mha_attn_l0_tp2</title>
<path fill="none" stroke="black" d="M8009,-4541.51C8009,-4533.55 8009,-4524.62 8009,-4516.1"/>
<polygon fill="black" stroke="black" points="8012.5,-4516.01 8009,-4506.01 8005.5,-4516.01 8012.5,-4516.01"/>
</g>
<!-- mha_out_l0_tp2 -->
<g id="node19" class="node">
<title>mha_out_l0_tp2</title>
<polygon fill="lightgreen" stroke="black" points="8151,-4417.85 7867,-4417.85 7867,-4365.85 8151,-4365.85 8151,-4417.85"/>
<text text-anchor="middle" x="8009" y="-4405.85" font-family="Arial" font-size="10.00">MHA Output TP2</text>
<text text-anchor="middle" x="8009" y="-4394.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8009" y="-4383.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8009" y="-4372.85" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- mha_attn_l0_tp2&#45;&gt;mha_out_l0_tp2 -->
<g id="edge60" class="edge">
<title>mha_attn_l0_tp2&#45;&gt;mha_out_l0_tp2</title>
<path fill="none" stroke="black" d="M8009,-4453.51C8009,-4445.55 8009,-4436.62 8009,-4428.1"/>
<polygon fill="black" stroke="black" points="8012.5,-4428.01 8009,-4418.01 8005.5,-4428.01 8012.5,-4428.01"/>
</g>
<!-- attn_allreduce_l0_tp2 -->
<g id="node20" class="node">
<title>attn_allreduce_l0_tp2</title>
<ellipse fill="lightgray" stroke="black" cx="8009" cy="-4293.08" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8009" y="-4307.08" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP2</text>
<text text-anchor="middle" x="8009" y="-4296.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8009" y="-4285.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8009" y="-4274.08" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- mha_out_l0_tp2&#45;&gt;attn_allreduce_l0_tp2 -->
<g id="edge61" class="edge">
<title>mha_out_l0_tp2&#45;&gt;attn_allreduce_l0_tp2</title>
<path fill="none" stroke="black" d="M8009,-4365.68C8009,-4357.87 8009,-4349.01 8009,-4340.24"/>
<polygon fill="black" stroke="black" points="8012.5,-4340.06 8009,-4330.06 8005.5,-4340.06 8012.5,-4340.06"/>
</g>
<!-- attn_allreduce_l0_tp2&#45;&gt;res_add_l0_tp2 -->
<g id="edge63" class="edge">
<title>attn_allreduce_l0_tp2&#45;&gt;res_add_l0_tp2</title>
<path fill="none" stroke="black" d="M8009,-4256.05C8009,-4247.74 8009,-4238.9 8009,-4230.62"/>
<polygon fill="black" stroke="black" points="8012.5,-4230.51 8009,-4220.51 8005.5,-4230.51 8012.5,-4230.51"/>
</g>
<!-- norm_l0_tp2 -->
<g id="node22" class="node">
<title>norm_l0_tp2</title>
<polygon fill="lightgreen" stroke="black" points="5825,-4132.31 5559,-4132.31 5559,-4080.31 5825,-4080.31 5825,-4132.31"/>
<text text-anchor="middle" x="5692" y="-4120.31" font-family="Arial" font-size="10.00">Layer Norm TP2</text>
<text text-anchor="middle" x="5692" y="-4109.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5692" y="-4098.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5692" y="-4087.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- res_add_l0_tp2&#45;&gt;norm_l0_tp2 -->
<g id="edge64" class="edge">
<title>res_add_l0_tp2&#45;&gt;norm_l0_tp2</title>
<path fill="none" stroke="black" d="M7869.94,-4177.42C7835.07,-4173.92 7797.7,-4170.58 7763,-4168.31 7039.83,-4120.98 6172.19,-4110.37 5835.41,-4107.99"/>
<polygon fill="black" stroke="black" points="5835.14,-4104.49 5825.11,-4107.92 5835.09,-4111.49 5835.14,-4104.49"/>
</g>
<!-- gate_l0_tp2 -->
<g id="node60" class="node">
<title>gate_l0_tp2</title>
<polygon fill="lightyellow" stroke="black" points="6822.3,-4044.31 6355.72,-4044.31 6235.7,-3940.31 6702.28,-3940.31 6822.3,-4044.31"/>
<text text-anchor="middle" x="6529" y="-4006.31" font-family="Arial" font-size="10.00">Gate Network TP2</text>
<text text-anchor="middle" x="6529" y="-3995.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6529" y="-3984.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="6529" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l0_tp2&#45;&gt;gate_l0_tp2 -->
<g id="edge65" class="edge">
<title>norm_l0_tp2&#45;&gt;gate_l0_tp2</title>
<path fill="none" stroke="black" d="M5825.1,-4091.86C5932.43,-4080.56 6087.17,-4063.26 6222,-4044.31 6255.48,-4039.61 6290.93,-4034.16 6325.4,-4028.6"/>
<polygon fill="black" stroke="black" points="6326.26,-4032.01 6335.57,-4026.96 6325.14,-4025.1 6326.26,-4032.01"/>
</g>
<!-- expert16_l0_tp2 -->
<g id="node82" class="node">
<title>expert16_l0_tp2</title>
<polygon fill="lightcoral" stroke="black" points="5786,-4018.31 5598,-4018.31 5598,-3966.31 5786,-3966.31 5786,-4018.31"/>
<text text-anchor="middle" x="5692" y="-4006.31" font-family="Arial" font-size="10.00">Expert 16</text>
<text text-anchor="middle" x="5692" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5692" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5692" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l0_tp2&#45;&gt;expert16_l0_tp2 -->
<g id="edge66" class="edge">
<title>norm_l0_tp2&#45;&gt;expert16_l0_tp2</title>
<path fill="none" stroke="black" d="M5692,-4080.18C5692,-4064.9 5692,-4045.17 5692,-4028.38"/>
<polygon fill="black" stroke="black" points="5695.5,-4028.36 5692,-4018.36 5688.5,-4028.36 5695.5,-4028.36"/>
</g>
<!-- expert17_l0_tp2 -->
<g id="node83" class="node">
<title>expert17_l0_tp2</title>
<polygon fill="lightcoral" stroke="black" points="5992,-4018.31 5804,-4018.31 5804,-3966.31 5992,-3966.31 5992,-4018.31"/>
<text text-anchor="middle" x="5898" y="-4006.31" font-family="Arial" font-size="10.00">Expert 17</text>
<text text-anchor="middle" x="5898" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5898" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5898" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l0_tp2&#45;&gt;expert17_l0_tp2 -->
<g id="edge68" class="edge">
<title>norm_l0_tp2&#45;&gt;expert17_l0_tp2</title>
<path fill="none" stroke="black" d="M5738.23,-4080.18C5769.24,-4063.32 5810.24,-4041.03 5842.94,-4023.25"/>
<polygon fill="black" stroke="black" points="5844.81,-4026.22 5851.92,-4018.36 5841.47,-4020.07 5844.81,-4026.22"/>
</g>
<!-- expert18_l0_tp2 -->
<g id="node84" class="node">
<title>expert18_l0_tp2</title>
<polygon fill="lightcoral" stroke="black" points="6198,-4018.31 6010,-4018.31 6010,-3966.31 6198,-3966.31 6198,-4018.31"/>
<text text-anchor="middle" x="6104" y="-4006.31" font-family="Arial" font-size="10.00">Expert 18</text>
<text text-anchor="middle" x="6104" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6104" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6104" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l0_tp2&#45;&gt;expert18_l0_tp2 -->
<g id="edge70" class="edge">
<title>norm_l0_tp2&#45;&gt;expert18_l0_tp2</title>
<path fill="none" stroke="black" d="M5825.2,-4086.96C5880.46,-4077.32 5944.69,-4063.43 6001,-4044.31 6017.74,-4038.63 6035.23,-4030.77 6050.95,-4022.92"/>
<polygon fill="black" stroke="black" points="6052.66,-4025.98 6059.98,-4018.32 6049.48,-4019.74 6052.66,-4025.98"/>
</g>
<!-- expert19_l0_tp2 -->
<g id="node85" class="node">
<title>expert19_l0_tp2</title>
<polygon fill="lightcoral" stroke="black" points="4756,-4018.31 4568,-4018.31 4568,-3966.31 4756,-3966.31 4756,-4018.31"/>
<text text-anchor="middle" x="4662" y="-4006.31" font-family="Arial" font-size="10.00">Expert 19</text>
<text text-anchor="middle" x="4662" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4662" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4662" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l0_tp2&#45;&gt;expert19_l0_tp2 -->
<g id="edge72" class="edge">
<title>norm_l0_tp2&#45;&gt;expert19_l0_tp2</title>
<path fill="none" stroke="black" d="M5558.89,-4102.96C5339.28,-4098.01 4910.82,-4083.53 4765,-4044.31 4747.12,-4039.5 4728.67,-4031.48 4712.41,-4023.21"/>
<polygon fill="black" stroke="black" points="4713.6,-4019.87 4703.11,-4018.33 4710.34,-4026.07 4713.6,-4019.87"/>
</g>
<!-- expert20_l0_tp2 -->
<g id="node86" class="node">
<title>expert20_l0_tp2</title>
<polygon fill="lightcoral" stroke="black" points="4962,-4018.31 4774,-4018.31 4774,-3966.31 4962,-3966.31 4962,-4018.31"/>
<text text-anchor="middle" x="4868" y="-4006.31" font-family="Arial" font-size="10.00">Expert 20</text>
<text text-anchor="middle" x="4868" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4868" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4868" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l0_tp2&#45;&gt;expert20_l0_tp2 -->
<g id="edge74" class="edge">
<title>norm_l0_tp2&#45;&gt;expert20_l0_tp2</title>
<path fill="none" stroke="black" d="M5558.99,-4100.01C5381.76,-4091.91 5078.08,-4074.19 4971,-4044.31 4953.33,-4039.38 4935.06,-4031.41 4918.91,-4023.23"/>
<polygon fill="black" stroke="black" points="4920.15,-4019.92 4909.66,-4018.4 4916.91,-4026.13 4920.15,-4019.92"/>
</g>
<!-- expert21_l0_tp2 -->
<g id="node87" class="node">
<title>expert21_l0_tp2</title>
<polygon fill="lightcoral" stroke="black" points="5168,-4018.31 4980,-4018.31 4980,-3966.31 5168,-3966.31 5168,-4018.31"/>
<text text-anchor="middle" x="5074" y="-4006.31" font-family="Arial" font-size="10.00">Expert 21</text>
<text text-anchor="middle" x="5074" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5074" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5074" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l0_tp2&#45;&gt;expert21_l0_tp2 -->
<g id="edge76" class="edge">
<title>norm_l0_tp2&#45;&gt;expert21_l0_tp2</title>
<path fill="none" stroke="black" d="M5558.79,-4101.97C5453.31,-4096.38 5303.22,-4081.82 5177,-4044.31 5159.57,-4039.13 5141.5,-4031.18 5125.45,-4023.08"/>
<polygon fill="black" stroke="black" points="5126.75,-4019.81 5116.26,-4018.32 5123.53,-4026.03 5126.75,-4019.81"/>
</g>
<!-- expert22_l0_tp2 -->
<g id="node88" class="node">
<title>expert22_l0_tp2</title>
<polygon fill="lightcoral" stroke="black" points="5374,-4018.31 5186,-4018.31 5186,-3966.31 5374,-3966.31 5374,-4018.31"/>
<text text-anchor="middle" x="5280" y="-4006.31" font-family="Arial" font-size="10.00">Expert 22</text>
<text text-anchor="middle" x="5280" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5280" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5280" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l0_tp2&#45;&gt;expert22_l0_tp2 -->
<g id="edge78" class="edge">
<title>norm_l0_tp2&#45;&gt;expert22_l0_tp2</title>
<path fill="none" stroke="black" d="M5558.8,-4086.96C5503.54,-4077.32 5439.31,-4063.43 5383,-4044.31 5366.26,-4038.63 5348.77,-4030.77 5333.05,-4022.92"/>
<polygon fill="black" stroke="black" points="5334.52,-4019.74 5324.02,-4018.32 5331.34,-4025.98 5334.52,-4019.74"/>
</g>
<!-- expert23_l0_tp2 -->
<g id="node89" class="node">
<title>expert23_l0_tp2</title>
<polygon fill="lightcoral" stroke="black" points="5580,-4018.31 5392,-4018.31 5392,-3966.31 5580,-3966.31 5580,-4018.31"/>
<text text-anchor="middle" x="5486" y="-4006.31" font-family="Arial" font-size="10.00">Expert 23</text>
<text text-anchor="middle" x="5486" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5486" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5486" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l0_tp2&#45;&gt;expert23_l0_tp2 -->
<g id="edge80" class="edge">
<title>norm_l0_tp2&#45;&gt;expert23_l0_tp2</title>
<path fill="none" stroke="black" d="M5645.77,-4080.18C5614.76,-4063.32 5573.76,-4041.03 5541.06,-4023.25"/>
<polygon fill="black" stroke="black" points="5542.53,-4020.07 5532.08,-4018.36 5539.19,-4026.22 5542.53,-4020.07"/>
</g>
<!-- res_add2_l0_tp2 -->
<g id="node137" class="node">
<title>res_add2_l0_tp2</title>
<polygon fill="lightgreen" stroke="black" points="6356,-3764.31 6078,-3764.31 6078,-3712.31 6356,-3712.31 6356,-3764.31"/>
<text text-anchor="middle" x="6217" y="-3752.31" font-family="Arial" font-size="10.00">Residual Add 2 TP2</text>
<text text-anchor="middle" x="6217" y="-3741.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="6217" y="-3730.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6217" y="-3719.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l0_tp2&#45;&gt;res_add2_l0_tp2 -->
<g id="edge83" class="edge">
<title>norm_l0_tp2&#45;&gt;res_add2_l0_tp2</title>
<path fill="none" stroke="black" d="M5825.27,-4098.42C5969.21,-4089.6 6181.52,-4072.06 6207,-4044.31 6224.88,-4024.84 6220.96,-3850.3 6218.36,-3774.35"/>
<polygon fill="black" stroke="black" points="6221.86,-3774.19 6218.01,-3764.32 6214.86,-3774.44 6221.86,-3774.19"/>
</g>
<!-- mha_qkv_l0_tp3 -->
<g id="node24" class="node">
<title>mha_qkv_l0_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8548.5,-4593.85 8257.5,-4593.85 8257.5,-4541.85 8548.5,-4541.85 8548.5,-4593.85"/>
<text text-anchor="middle" x="8403" y="-4581.85" font-family="Arial" font-size="10.00">MHA QKV TP3</text>
<text text-anchor="middle" x="8403" y="-4570.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8403" y="-4559.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8403" y="-4548.85" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- input_split_l0_tp3&#45;&gt;mha_qkv_l0_tp3 -->
<g id="edge86" class="edge">
<title>input_split_l0_tp3&#45;&gt;mha_qkv_l0_tp3</title>
<path fill="none" stroke="black" d="M8403,-4629.59C8403,-4621.28 8403,-4612.44 8403,-4604.16"/>
<polygon fill="black" stroke="black" points="8406.5,-4604.05 8403,-4594.05 8399.5,-4604.05 8406.5,-4604.05"/>
</g>
<!-- mha_attn_l0_tp3 -->
<g id="node25" class="node">
<title>mha_attn_l0_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8548.5,-4505.85 8257.5,-4505.85 8257.5,-4453.85 8548.5,-4453.85 8548.5,-4505.85"/>
<text text-anchor="middle" x="8403" y="-4493.85" font-family="Arial" font-size="10.00">MHA Attention TP3</text>
<text text-anchor="middle" x="8403" y="-4482.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8403" y="-4471.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8403" y="-4460.85" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- mha_qkv_l0_tp3&#45;&gt;mha_attn_l0_tp3 -->
<g id="edge87" class="edge">
<title>mha_qkv_l0_tp3&#45;&gt;mha_attn_l0_tp3</title>
<path fill="none" stroke="black" d="M8403,-4541.51C8403,-4533.55 8403,-4524.62 8403,-4516.1"/>
<polygon fill="black" stroke="black" points="8406.5,-4516.01 8403,-4506.01 8399.5,-4516.01 8406.5,-4516.01"/>
</g>
<!-- mha_out_l0_tp3 -->
<g id="node26" class="node">
<title>mha_out_l0_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8545,-4417.85 8261,-4417.85 8261,-4365.85 8545,-4365.85 8545,-4417.85"/>
<text text-anchor="middle" x="8403" y="-4405.85" font-family="Arial" font-size="10.00">MHA Output TP3</text>
<text text-anchor="middle" x="8403" y="-4394.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8403" y="-4383.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8403" y="-4372.85" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- mha_attn_l0_tp3&#45;&gt;mha_out_l0_tp3 -->
<g id="edge88" class="edge">
<title>mha_attn_l0_tp3&#45;&gt;mha_out_l0_tp3</title>
<path fill="none" stroke="black" d="M8403,-4453.51C8403,-4445.55 8403,-4436.62 8403,-4428.1"/>
<polygon fill="black" stroke="black" points="8406.5,-4428.01 8403,-4418.01 8399.5,-4428.01 8406.5,-4428.01"/>
</g>
<!-- attn_allreduce_l0_tp3 -->
<g id="node27" class="node">
<title>attn_allreduce_l0_tp3</title>
<ellipse fill="lightgray" stroke="black" cx="8403" cy="-4293.08" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8403" y="-4307.08" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP3</text>
<text text-anchor="middle" x="8403" y="-4296.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8403" y="-4285.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8403" y="-4274.08" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- mha_out_l0_tp3&#45;&gt;attn_allreduce_l0_tp3 -->
<g id="edge89" class="edge">
<title>mha_out_l0_tp3&#45;&gt;attn_allreduce_l0_tp3</title>
<path fill="none" stroke="black" d="M8403,-4365.68C8403,-4357.87 8403,-4349.01 8403,-4340.24"/>
<polygon fill="black" stroke="black" points="8406.5,-4340.06 8403,-4330.06 8399.5,-4340.06 8406.5,-4340.06"/>
</g>
<!-- attn_allreduce_l0_tp3&#45;&gt;res_add_l0_tp3 -->
<g id="edge91" class="edge">
<title>attn_allreduce_l0_tp3&#45;&gt;res_add_l0_tp3</title>
<path fill="none" stroke="black" d="M8403,-4256.05C8403,-4247.74 8403,-4238.9 8403,-4230.62"/>
<polygon fill="black" stroke="black" points="8406.5,-4230.51 8403,-4220.51 8399.5,-4230.51 8406.5,-4230.51"/>
</g>
<!-- norm_l0_tp3 -->
<g id="node29" class="node">
<title>norm_l0_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8097,-4132.31 7831,-4132.31 7831,-4080.31 8097,-4080.31 8097,-4132.31"/>
<text text-anchor="middle" x="7964" y="-4120.31" font-family="Arial" font-size="10.00">Layer Norm TP3</text>
<text text-anchor="middle" x="7964" y="-4109.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7964" y="-4098.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7964" y="-4087.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- res_add_l0_tp3&#45;&gt;norm_l0_tp3 -->
<g id="edge92" class="edge">
<title>res_add_l0_tp3&#45;&gt;norm_l0_tp3</title>
<path fill="none" stroke="black" d="M8275.14,-4168.26C8220.7,-4157.6 8157.09,-4145.14 8101.62,-4134.27"/>
<polygon fill="black" stroke="black" points="8102.21,-4130.82 8091.72,-4132.33 8100.86,-4137.69 8102.21,-4130.82"/>
</g>
<!-- gate_l0_tp3 -->
<g id="node61" class="node">
<title>gate_l0_tp3</title>
<polygon fill="lightyellow" stroke="black" points="9094.3,-4044.31 8627.72,-4044.31 8507.7,-3940.31 8974.28,-3940.31 9094.3,-4044.31"/>
<text text-anchor="middle" x="8801" y="-4006.31" font-family="Arial" font-size="10.00">Gate Network TP3</text>
<text text-anchor="middle" x="8801" y="-3995.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8801" y="-3984.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="8801" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l0_tp3&#45;&gt;gate_l0_tp3 -->
<g id="edge93" class="edge">
<title>norm_l0_tp3&#45;&gt;gate_l0_tp3</title>
<path fill="none" stroke="black" d="M8097.1,-4091.86C8204.43,-4080.56 8359.17,-4063.26 8494,-4044.31 8527.48,-4039.61 8562.93,-4034.16 8597.4,-4028.6"/>
<polygon fill="black" stroke="black" points="8598.26,-4032.01 8607.57,-4026.96 8597.14,-4025.1 8598.26,-4032.01"/>
</g>
<!-- expert24_l0_tp3 -->
<g id="node90" class="node">
<title>expert24_l0_tp3</title>
<polygon fill="lightcoral" stroke="black" points="7852,-4018.31 7664,-4018.31 7664,-3966.31 7852,-3966.31 7852,-4018.31"/>
<text text-anchor="middle" x="7758" y="-4006.31" font-family="Arial" font-size="10.00">Expert 24</text>
<text text-anchor="middle" x="7758" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7758" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7758" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l0_tp3&#45;&gt;expert24_l0_tp3 -->
<g id="edge94" class="edge">
<title>norm_l0_tp3&#45;&gt;expert24_l0_tp3</title>
<path fill="none" stroke="black" d="M7917.77,-4080.18C7886.76,-4063.32 7845.76,-4041.03 7813.06,-4023.25"/>
<polygon fill="black" stroke="black" points="7814.53,-4020.07 7804.08,-4018.36 7811.19,-4026.22 7814.53,-4020.07"/>
</g>
<!-- expert25_l0_tp3 -->
<g id="node91" class="node">
<title>expert25_l0_tp3</title>
<polygon fill="lightcoral" stroke="black" points="8058,-4018.31 7870,-4018.31 7870,-3966.31 8058,-3966.31 8058,-4018.31"/>
<text text-anchor="middle" x="7964" y="-4006.31" font-family="Arial" font-size="10.00">Expert 25</text>
<text text-anchor="middle" x="7964" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7964" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7964" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l0_tp3&#45;&gt;expert25_l0_tp3 -->
<g id="edge96" class="edge">
<title>norm_l0_tp3&#45;&gt;expert25_l0_tp3</title>
<path fill="none" stroke="black" d="M7964,-4080.18C7964,-4064.9 7964,-4045.17 7964,-4028.38"/>
<polygon fill="black" stroke="black" points="7967.5,-4028.36 7964,-4018.36 7960.5,-4028.36 7967.5,-4028.36"/>
</g>
<!-- expert26_l0_tp3 -->
<g id="node92" class="node">
<title>expert26_l0_tp3</title>
<polygon fill="lightcoral" stroke="black" points="8264,-4018.31 8076,-4018.31 8076,-3966.31 8264,-3966.31 8264,-4018.31"/>
<text text-anchor="middle" x="8170" y="-4006.31" font-family="Arial" font-size="10.00">Expert 26</text>
<text text-anchor="middle" x="8170" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8170" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8170" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l0_tp3&#45;&gt;expert26_l0_tp3 -->
<g id="edge98" class="edge">
<title>norm_l0_tp3&#45;&gt;expert26_l0_tp3</title>
<path fill="none" stroke="black" d="M8010.23,-4080.18C8041.24,-4063.32 8082.24,-4041.03 8114.94,-4023.25"/>
<polygon fill="black" stroke="black" points="8116.81,-4026.22 8123.92,-4018.36 8113.47,-4020.07 8116.81,-4026.22"/>
</g>
<!-- expert27_l0_tp3 -->
<g id="node93" class="node">
<title>expert27_l0_tp3</title>
<polygon fill="lightcoral" stroke="black" points="8470,-4018.31 8282,-4018.31 8282,-3966.31 8470,-3966.31 8470,-4018.31"/>
<text text-anchor="middle" x="8376" y="-4006.31" font-family="Arial" font-size="10.00">Expert 27</text>
<text text-anchor="middle" x="8376" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8376" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8376" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l0_tp3&#45;&gt;expert27_l0_tp3 -->
<g id="edge100" class="edge">
<title>norm_l0_tp3&#45;&gt;expert27_l0_tp3</title>
<path fill="none" stroke="black" d="M8097.2,-4086.96C8152.46,-4077.32 8216.69,-4063.43 8273,-4044.31 8289.74,-4038.63 8307.23,-4030.77 8322.95,-4022.92"/>
<polygon fill="black" stroke="black" points="8324.66,-4025.98 8331.98,-4018.32 8321.48,-4019.74 8324.66,-4025.98"/>
</g>
<!-- expert28_l0_tp3 -->
<g id="node94" class="node">
<title>expert28_l0_tp3</title>
<polygon fill="lightcoral" stroke="black" points="7028,-4018.31 6840,-4018.31 6840,-3966.31 7028,-3966.31 7028,-4018.31"/>
<text text-anchor="middle" x="6934" y="-4006.31" font-family="Arial" font-size="10.00">Expert 28</text>
<text text-anchor="middle" x="6934" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6934" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6934" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l0_tp3&#45;&gt;expert28_l0_tp3 -->
<g id="edge102" class="edge">
<title>norm_l0_tp3&#45;&gt;expert28_l0_tp3</title>
<path fill="none" stroke="black" d="M7830.89,-4102.96C7611.28,-4098.01 7182.82,-4083.53 7037,-4044.31 7019.12,-4039.5 7000.67,-4031.48 6984.41,-4023.21"/>
<polygon fill="black" stroke="black" points="6985.6,-4019.87 6975.11,-4018.33 6982.34,-4026.07 6985.6,-4019.87"/>
</g>
<!-- expert29_l0_tp3 -->
<g id="node95" class="node">
<title>expert29_l0_tp3</title>
<polygon fill="lightcoral" stroke="black" points="7234,-4018.31 7046,-4018.31 7046,-3966.31 7234,-3966.31 7234,-4018.31"/>
<text text-anchor="middle" x="7140" y="-4006.31" font-family="Arial" font-size="10.00">Expert 29</text>
<text text-anchor="middle" x="7140" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7140" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7140" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l0_tp3&#45;&gt;expert29_l0_tp3 -->
<g id="edge104" class="edge">
<title>norm_l0_tp3&#45;&gt;expert29_l0_tp3</title>
<path fill="none" stroke="black" d="M7830.99,-4100.01C7653.76,-4091.91 7350.08,-4074.19 7243,-4044.31 7225.33,-4039.38 7207.06,-4031.41 7190.91,-4023.23"/>
<polygon fill="black" stroke="black" points="7192.15,-4019.92 7181.66,-4018.4 7188.91,-4026.13 7192.15,-4019.92"/>
</g>
<!-- expert30_l0_tp3 -->
<g id="node96" class="node">
<title>expert30_l0_tp3</title>
<polygon fill="lightcoral" stroke="black" points="7440,-4018.31 7252,-4018.31 7252,-3966.31 7440,-3966.31 7440,-4018.31"/>
<text text-anchor="middle" x="7346" y="-4006.31" font-family="Arial" font-size="10.00">Expert 30</text>
<text text-anchor="middle" x="7346" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7346" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7346" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l0_tp3&#45;&gt;expert30_l0_tp3 -->
<g id="edge106" class="edge">
<title>norm_l0_tp3&#45;&gt;expert30_l0_tp3</title>
<path fill="none" stroke="black" d="M7830.79,-4101.97C7725.31,-4096.38 7575.22,-4081.82 7449,-4044.31 7431.57,-4039.13 7413.5,-4031.18 7397.45,-4023.08"/>
<polygon fill="black" stroke="black" points="7398.75,-4019.81 7388.26,-4018.32 7395.53,-4026.03 7398.75,-4019.81"/>
</g>
<!-- expert31_l0_tp3 -->
<g id="node97" class="node">
<title>expert31_l0_tp3</title>
<polygon fill="lightcoral" stroke="black" points="7646,-4018.31 7458,-4018.31 7458,-3966.31 7646,-3966.31 7646,-4018.31"/>
<text text-anchor="middle" x="7552" y="-4006.31" font-family="Arial" font-size="10.00">Expert 31</text>
<text text-anchor="middle" x="7552" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7552" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7552" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l0_tp3&#45;&gt;expert31_l0_tp3 -->
<g id="edge108" class="edge">
<title>norm_l0_tp3&#45;&gt;expert31_l0_tp3</title>
<path fill="none" stroke="black" d="M7830.8,-4086.96C7775.54,-4077.32 7711.31,-4063.43 7655,-4044.31 7638.26,-4038.63 7620.77,-4030.77 7605.05,-4022.92"/>
<polygon fill="black" stroke="black" points="7606.52,-4019.74 7596.02,-4018.32 7603.34,-4025.98 7606.52,-4019.74"/>
</g>
<!-- res_add2_l0_tp3 -->
<g id="node140" class="node">
<title>res_add2_l0_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8628,-3764.31 8350,-3764.31 8350,-3712.31 8628,-3712.31 8628,-3764.31"/>
<text text-anchor="middle" x="8489" y="-3752.31" font-family="Arial" font-size="10.00">Residual Add 2 TP3</text>
<text text-anchor="middle" x="8489" y="-3741.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="8489" y="-3730.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8489" y="-3719.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l0_tp3&#45;&gt;res_add2_l0_tp3 -->
<g id="edge111" class="edge">
<title>norm_l0_tp3&#45;&gt;res_add2_l0_tp3</title>
<path fill="none" stroke="black" d="M8097.27,-4098.42C8241.21,-4089.6 8453.52,-4072.06 8479,-4044.31 8496.88,-4024.84 8492.96,-3850.3 8490.36,-3774.35"/>
<polygon fill="black" stroke="black" points="8493.86,-3774.19 8490.01,-3764.32 8486.86,-3774.44 8493.86,-3774.19"/>
</g>
<!-- mha_qkv_l0_tp4 -->
<g id="node31" class="node">
<title>mha_qkv_l0_tp4</title>
<polygon fill="lightgreen" stroke="black" points="8942.5,-4593.85 8651.5,-4593.85 8651.5,-4541.85 8942.5,-4541.85 8942.5,-4593.85"/>
<text text-anchor="middle" x="8797" y="-4581.85" font-family="Arial" font-size="10.00">MHA QKV TP4</text>
<text text-anchor="middle" x="8797" y="-4570.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8797" y="-4559.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8797" y="-4548.85" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- input_split_l0_tp4&#45;&gt;mha_qkv_l0_tp4 -->
<g id="edge114" class="edge">
<title>input_split_l0_tp4&#45;&gt;mha_qkv_l0_tp4</title>
<path fill="none" stroke="black" d="M8797,-4629.59C8797,-4621.28 8797,-4612.44 8797,-4604.16"/>
<polygon fill="black" stroke="black" points="8800.5,-4604.05 8797,-4594.05 8793.5,-4604.05 8800.5,-4604.05"/>
</g>
<!-- mha_attn_l0_tp4 -->
<g id="node32" class="node">
<title>mha_attn_l0_tp4</title>
<polygon fill="lightgreen" stroke="black" points="8942.5,-4505.85 8651.5,-4505.85 8651.5,-4453.85 8942.5,-4453.85 8942.5,-4505.85"/>
<text text-anchor="middle" x="8797" y="-4493.85" font-family="Arial" font-size="10.00">MHA Attention TP4</text>
<text text-anchor="middle" x="8797" y="-4482.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8797" y="-4471.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8797" y="-4460.85" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- mha_qkv_l0_tp4&#45;&gt;mha_attn_l0_tp4 -->
<g id="edge115" class="edge">
<title>mha_qkv_l0_tp4&#45;&gt;mha_attn_l0_tp4</title>
<path fill="none" stroke="black" d="M8797,-4541.51C8797,-4533.55 8797,-4524.62 8797,-4516.1"/>
<polygon fill="black" stroke="black" points="8800.5,-4516.01 8797,-4506.01 8793.5,-4516.01 8800.5,-4516.01"/>
</g>
<!-- mha_out_l0_tp4 -->
<g id="node33" class="node">
<title>mha_out_l0_tp4</title>
<polygon fill="lightgreen" stroke="black" points="8939,-4417.85 8655,-4417.85 8655,-4365.85 8939,-4365.85 8939,-4417.85"/>
<text text-anchor="middle" x="8797" y="-4405.85" font-family="Arial" font-size="10.00">MHA Output TP4</text>
<text text-anchor="middle" x="8797" y="-4394.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8797" y="-4383.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8797" y="-4372.85" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- mha_attn_l0_tp4&#45;&gt;mha_out_l0_tp4 -->
<g id="edge116" class="edge">
<title>mha_attn_l0_tp4&#45;&gt;mha_out_l0_tp4</title>
<path fill="none" stroke="black" d="M8797,-4453.51C8797,-4445.55 8797,-4436.62 8797,-4428.1"/>
<polygon fill="black" stroke="black" points="8800.5,-4428.01 8797,-4418.01 8793.5,-4428.01 8800.5,-4428.01"/>
</g>
<!-- attn_allreduce_l0_tp4 -->
<g id="node34" class="node">
<title>attn_allreduce_l0_tp4</title>
<ellipse fill="lightgray" stroke="black" cx="8797" cy="-4293.08" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8797" y="-4307.08" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP4</text>
<text text-anchor="middle" x="8797" y="-4296.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8797" y="-4285.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8797" y="-4274.08" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- mha_out_l0_tp4&#45;&gt;attn_allreduce_l0_tp4 -->
<g id="edge117" class="edge">
<title>mha_out_l0_tp4&#45;&gt;attn_allreduce_l0_tp4</title>
<path fill="none" stroke="black" d="M8797,-4365.68C8797,-4357.87 8797,-4349.01 8797,-4340.24"/>
<polygon fill="black" stroke="black" points="8800.5,-4340.06 8797,-4330.06 8793.5,-4340.06 8800.5,-4340.06"/>
</g>
<!-- attn_allreduce_l0_tp4&#45;&gt;res_add_l0_tp4 -->
<g id="edge119" class="edge">
<title>attn_allreduce_l0_tp4&#45;&gt;res_add_l0_tp4</title>
<path fill="none" stroke="black" d="M8926.49,-4266.4C8948.93,-4262.58 8972.09,-4259.01 8994,-4256.31 9267.16,-4222.64 9588.06,-4206.75 9771.67,-4199.9"/>
<polygon fill="black" stroke="black" points="9772.07,-4203.39 9781.94,-4199.52 9771.82,-4196.4 9772.07,-4203.39"/>
</g>
<!-- norm_l0_tp4 -->
<g id="node36" class="node">
<title>norm_l0_tp4</title>
<polygon fill="lightgreen" stroke="black" points="10562,-4132.31 10296,-4132.31 10296,-4080.31 10562,-4080.31 10562,-4132.31"/>
<text text-anchor="middle" x="10429" y="-4120.31" font-family="Arial" font-size="10.00">Layer Norm TP4</text>
<text text-anchor="middle" x="10429" y="-4109.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10429" y="-4098.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10429" y="-4087.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- res_add_l0_tp4&#45;&gt;norm_l0_tp4 -->
<g id="edge120" class="edge">
<title>res_add_l0_tp4&#45;&gt;norm_l0_tp4</title>
<path fill="none" stroke="black" d="M10060.15,-4169.76C10130.29,-4157.88 10215.23,-4143.5 10285.91,-4131.54"/>
<polygon fill="black" stroke="black" points="10286.51,-4134.99 10295.78,-4129.87 10285.34,-4128.08 10286.51,-4134.99"/>
</g>
<!-- gate_l0_tp4 -->
<g id="node62" class="node">
<title>gate_l0_tp4</title>
<polygon fill="lightyellow" stroke="black" points="9699.3,-4044.31 9232.72,-4044.31 9112.7,-3940.31 9579.28,-3940.31 9699.3,-4044.31"/>
<text text-anchor="middle" x="9406" y="-4006.31" font-family="Arial" font-size="10.00">Gate Network TP4</text>
<text text-anchor="middle" x="9406" y="-3995.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9406" y="-3984.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="9406" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l0_tp4&#45;&gt;gate_l0_tp4 -->
<g id="edge121" class="edge">
<title>norm_l0_tp4&#45;&gt;gate_l0_tp4</title>
<path fill="none" stroke="black" d="M10295.77,-4097.36C10150.8,-4087.93 9912.39,-4070.17 9708,-4044.31 9707.9,-4044.3 9707.79,-4044.29 9707.69,-4044.27"/>
<polygon fill="black" stroke="black" points="9708.42,-4040.84 9698.05,-4043.03 9707.53,-4047.78 9708.42,-4040.84"/>
</g>
<!-- expert32_l0_tp4 -->
<g id="node98" class="node">
<title>expert32_l0_tp4</title>
<polygon fill="lightcoral" stroke="black" points="10523,-4018.31 10335,-4018.31 10335,-3966.31 10523,-3966.31 10523,-4018.31"/>
<text text-anchor="middle" x="10429" y="-4006.31" font-family="Arial" font-size="10.00">Expert 32</text>
<text text-anchor="middle" x="10429" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10429" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10429" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l0_tp4&#45;&gt;expert32_l0_tp4 -->
<g id="edge122" class="edge">
<title>norm_l0_tp4&#45;&gt;expert32_l0_tp4</title>
<path fill="none" stroke="black" d="M10429,-4080.18C10429,-4064.9 10429,-4045.17 10429,-4028.38"/>
<polygon fill="black" stroke="black" points="10432.5,-4028.36 10429,-4018.36 10425.5,-4028.36 10432.5,-4028.36"/>
</g>
<!-- expert33_l0_tp4 -->
<g id="node99" class="node">
<title>expert33_l0_tp4</title>
<polygon fill="lightcoral" stroke="black" points="10729,-4018.31 10541,-4018.31 10541,-3966.31 10729,-3966.31 10729,-4018.31"/>
<text text-anchor="middle" x="10635" y="-4006.31" font-family="Arial" font-size="10.00">Expert 33</text>
<text text-anchor="middle" x="10635" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10635" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10635" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l0_tp4&#45;&gt;expert33_l0_tp4 -->
<g id="edge124" class="edge">
<title>norm_l0_tp4&#45;&gt;expert33_l0_tp4</title>
<path fill="none" stroke="black" d="M10475.23,-4080.18C10506.24,-4063.32 10547.24,-4041.03 10579.94,-4023.25"/>
<polygon fill="black" stroke="black" points="10581.81,-4026.22 10588.92,-4018.36 10578.47,-4020.07 10581.81,-4026.22"/>
</g>
<!-- expert34_l0_tp4 -->
<g id="node100" class="node">
<title>expert34_l0_tp4</title>
<polygon fill="lightcoral" stroke="black" points="10935,-4018.31 10747,-4018.31 10747,-3966.31 10935,-3966.31 10935,-4018.31"/>
<text text-anchor="middle" x="10841" y="-4006.31" font-family="Arial" font-size="10.00">Expert 34</text>
<text text-anchor="middle" x="10841" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10841" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10841" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l0_tp4&#45;&gt;expert34_l0_tp4 -->
<g id="edge126" class="edge">
<title>norm_l0_tp4&#45;&gt;expert34_l0_tp4</title>
<path fill="none" stroke="black" d="M10562.2,-4086.96C10617.46,-4077.32 10681.69,-4063.43 10738,-4044.31 10754.74,-4038.63 10772.23,-4030.77 10787.95,-4022.92"/>
<polygon fill="black" stroke="black" points="10789.66,-4025.98 10796.98,-4018.32 10786.48,-4019.74 10789.66,-4025.98"/>
</g>
<!-- expert35_l0_tp4 -->
<g id="node101" class="node">
<title>expert35_l0_tp4</title>
<polygon fill="lightcoral" stroke="black" points="11141,-4018.31 10953,-4018.31 10953,-3966.31 11141,-3966.31 11141,-4018.31"/>
<text text-anchor="middle" x="11047" y="-4006.31" font-family="Arial" font-size="10.00">Expert 35</text>
<text text-anchor="middle" x="11047" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11047" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11047" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l0_tp4&#45;&gt;expert35_l0_tp4 -->
<g id="edge128" class="edge">
<title>norm_l0_tp4&#45;&gt;expert35_l0_tp4</title>
<path fill="none" stroke="black" d="M10562.21,-4101.97C10667.69,-4096.38 10817.78,-4081.82 10944,-4044.31 10961.43,-4039.13 10979.5,-4031.18 10995.55,-4023.08"/>
<polygon fill="black" stroke="black" points="10997.47,-4026.03 11004.74,-4018.32 10994.25,-4019.81 10997.47,-4026.03"/>
</g>
<!-- expert36_l0_tp4 -->
<g id="node102" class="node">
<title>expert36_l0_tp4</title>
<polygon fill="lightcoral" stroke="black" points="11347,-4018.31 11159,-4018.31 11159,-3966.31 11347,-3966.31 11347,-4018.31"/>
<text text-anchor="middle" x="11253" y="-4006.31" font-family="Arial" font-size="10.00">Expert 36</text>
<text text-anchor="middle" x="11253" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11253" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11253" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l0_tp4&#45;&gt;expert36_l0_tp4 -->
<g id="edge130" class="edge">
<title>norm_l0_tp4&#45;&gt;expert36_l0_tp4</title>
<path fill="none" stroke="black" d="M10562.01,-4100.01C10739.24,-4091.91 11042.92,-4074.19 11150,-4044.31 11167.67,-4039.38 11185.94,-4031.41 11202.09,-4023.23"/>
<polygon fill="black" stroke="black" points="11204.09,-4026.13 11211.34,-4018.4 11200.85,-4019.92 11204.09,-4026.13"/>
</g>
<!-- expert37_l0_tp4 -->
<g id="node103" class="node">
<title>expert37_l0_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9905,-4018.31 9717,-4018.31 9717,-3966.31 9905,-3966.31 9905,-4018.31"/>
<text text-anchor="middle" x="9811" y="-4006.31" font-family="Arial" font-size="10.00">Expert 37</text>
<text text-anchor="middle" x="9811" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9811" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9811" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l0_tp4&#45;&gt;expert37_l0_tp4 -->
<g id="edge132" class="edge">
<title>norm_l0_tp4&#45;&gt;expert37_l0_tp4</title>
<path fill="none" stroke="black" d="M10295.79,-4101.97C10190.31,-4096.38 10040.22,-4081.82 9914,-4044.31 9896.57,-4039.13 9878.5,-4031.18 9862.45,-4023.08"/>
<polygon fill="black" stroke="black" points="9863.75,-4019.81 9853.26,-4018.32 9860.53,-4026.03 9863.75,-4019.81"/>
</g>
<!-- expert38_l0_tp4 -->
<g id="node104" class="node">
<title>expert38_l0_tp4</title>
<polygon fill="lightcoral" stroke="black" points="10111,-4018.31 9923,-4018.31 9923,-3966.31 10111,-3966.31 10111,-4018.31"/>
<text text-anchor="middle" x="10017" y="-4006.31" font-family="Arial" font-size="10.00">Expert 38</text>
<text text-anchor="middle" x="10017" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10017" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10017" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l0_tp4&#45;&gt;expert38_l0_tp4 -->
<g id="edge134" class="edge">
<title>norm_l0_tp4&#45;&gt;expert38_l0_tp4</title>
<path fill="none" stroke="black" d="M10295.8,-4086.96C10240.54,-4077.32 10176.31,-4063.43 10120,-4044.31 10103.26,-4038.63 10085.77,-4030.77 10070.05,-4022.92"/>
<polygon fill="black" stroke="black" points="10071.52,-4019.74 10061.02,-4018.32 10068.34,-4025.98 10071.52,-4019.74"/>
</g>
<!-- expert39_l0_tp4 -->
<g id="node105" class="node">
<title>expert39_l0_tp4</title>
<polygon fill="lightcoral" stroke="black" points="10317,-4018.31 10129,-4018.31 10129,-3966.31 10317,-3966.31 10317,-4018.31"/>
<text text-anchor="middle" x="10223" y="-4006.31" font-family="Arial" font-size="10.00">Expert 39</text>
<text text-anchor="middle" x="10223" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10223" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10223" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l0_tp4&#45;&gt;expert39_l0_tp4 -->
<g id="edge136" class="edge">
<title>norm_l0_tp4&#45;&gt;expert39_l0_tp4</title>
<path fill="none" stroke="black" d="M10382.77,-4080.18C10351.76,-4063.32 10310.76,-4041.03 10278.06,-4023.25"/>
<polygon fill="black" stroke="black" points="10279.53,-4020.07 10269.08,-4018.36 10276.19,-4026.22 10279.53,-4020.07"/>
</g>
<!-- res_add2_l0_tp4 -->
<g id="node143" class="node">
<title>res_add2_l0_tp4</title>
<polygon fill="lightgreen" stroke="black" points="10671,-3764.31 10393,-3764.31 10393,-3712.31 10671,-3712.31 10671,-3764.31"/>
<text text-anchor="middle" x="10532" y="-3752.31" font-family="Arial" font-size="10.00">Residual Add 2 TP4</text>
<text text-anchor="middle" x="10532" y="-3741.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="10532" y="-3730.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10532" y="-3719.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l0_tp4&#45;&gt;res_add2_l0_tp4 -->
<g id="edge139" class="edge">
<title>norm_l0_tp4&#45;&gt;res_add2_l0_tp4</title>
<path fill="none" stroke="black" d="M10562.04,-4101.3C10812.03,-4093.12 11329.3,-4072.83 11356,-4044.31 11371.8,-4027.44 11370.14,-3958.59 11356,-3940.31 11204.58,-3744.53 11057.85,-3857.34 10817,-3800.31 10767.37,-3788.56 10712.63,-3776.61 10664.51,-3766.43"/>
<polygon fill="black" stroke="black" points="10665.16,-3762.99 10654.66,-3764.35 10663.72,-3769.84 10665.16,-3762.99"/>
</g>
<!-- mha_qkv_l0_tp5 -->
<g id="node38" class="node">
<title>mha_qkv_l0_tp5</title>
<polygon fill="lightgreen" stroke="black" points="9336.5,-4593.85 9045.5,-4593.85 9045.5,-4541.85 9336.5,-4541.85 9336.5,-4593.85"/>
<text text-anchor="middle" x="9191" y="-4581.85" font-family="Arial" font-size="10.00">MHA QKV TP5</text>
<text text-anchor="middle" x="9191" y="-4570.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9191" y="-4559.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9191" y="-4548.85" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- input_split_l0_tp5&#45;&gt;mha_qkv_l0_tp5 -->
<g id="edge142" class="edge">
<title>input_split_l0_tp5&#45;&gt;mha_qkv_l0_tp5</title>
<path fill="none" stroke="black" d="M9191,-4629.59C9191,-4621.28 9191,-4612.44 9191,-4604.16"/>
<polygon fill="black" stroke="black" points="9194.5,-4604.05 9191,-4594.05 9187.5,-4604.05 9194.5,-4604.05"/>
</g>
<!-- mha_attn_l0_tp5 -->
<g id="node39" class="node">
<title>mha_attn_l0_tp5</title>
<polygon fill="lightgreen" stroke="black" points="9336.5,-4505.85 9045.5,-4505.85 9045.5,-4453.85 9336.5,-4453.85 9336.5,-4505.85"/>
<text text-anchor="middle" x="9191" y="-4493.85" font-family="Arial" font-size="10.00">MHA Attention TP5</text>
<text text-anchor="middle" x="9191" y="-4482.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9191" y="-4471.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9191" y="-4460.85" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- mha_qkv_l0_tp5&#45;&gt;mha_attn_l0_tp5 -->
<g id="edge143" class="edge">
<title>mha_qkv_l0_tp5&#45;&gt;mha_attn_l0_tp5</title>
<path fill="none" stroke="black" d="M9191,-4541.51C9191,-4533.55 9191,-4524.62 9191,-4516.1"/>
<polygon fill="black" stroke="black" points="9194.5,-4516.01 9191,-4506.01 9187.5,-4516.01 9194.5,-4516.01"/>
</g>
<!-- mha_out_l0_tp5 -->
<g id="node40" class="node">
<title>mha_out_l0_tp5</title>
<polygon fill="lightgreen" stroke="black" points="9333,-4417.85 9049,-4417.85 9049,-4365.85 9333,-4365.85 9333,-4417.85"/>
<text text-anchor="middle" x="9191" y="-4405.85" font-family="Arial" font-size="10.00">MHA Output TP5</text>
<text text-anchor="middle" x="9191" y="-4394.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9191" y="-4383.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9191" y="-4372.85" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- mha_attn_l0_tp5&#45;&gt;mha_out_l0_tp5 -->
<g id="edge144" class="edge">
<title>mha_attn_l0_tp5&#45;&gt;mha_out_l0_tp5</title>
<path fill="none" stroke="black" d="M9191,-4453.51C9191,-4445.55 9191,-4436.62 9191,-4428.1"/>
<polygon fill="black" stroke="black" points="9194.5,-4428.01 9191,-4418.01 9187.5,-4428.01 9194.5,-4428.01"/>
</g>
<!-- attn_allreduce_l0_tp5 -->
<g id="node41" class="node">
<title>attn_allreduce_l0_tp5</title>
<ellipse fill="lightgray" stroke="black" cx="9191" cy="-4293.08" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9191" y="-4307.08" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP5</text>
<text text-anchor="middle" x="9191" y="-4296.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9191" y="-4285.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9191" y="-4274.08" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- mha_out_l0_tp5&#45;&gt;attn_allreduce_l0_tp5 -->
<g id="edge145" class="edge">
<title>mha_out_l0_tp5&#45;&gt;attn_allreduce_l0_tp5</title>
<path fill="none" stroke="black" d="M9191,-4365.68C9191,-4357.87 9191,-4349.01 9191,-4340.24"/>
<polygon fill="black" stroke="black" points="9194.5,-4340.06 9191,-4330.06 9187.5,-4340.06 9194.5,-4340.06"/>
</g>
<!-- attn_allreduce_l0_tp5&#45;&gt;res_add_l0_tp5 -->
<g id="edge147" class="edge">
<title>attn_allreduce_l0_tp5&#45;&gt;res_add_l0_tp5</title>
<path fill="none" stroke="black" d="M9319.93,-4266.25C9342.54,-4262.42 9365.9,-4258.89 9388,-4256.31 9685.66,-4221.56 9765.95,-4252.89 10067.27,-4220.44"/>
<polygon fill="black" stroke="black" points="10068.06,-4223.88 10077.62,-4219.31 10067.3,-4216.92 10068.06,-4223.88"/>
</g>
<!-- norm_l0_tp5 -->
<g id="node43" class="node">
<title>norm_l0_tp5</title>
<polygon fill="lightgreen" stroke="black" points="12834,-4132.31 12568,-4132.31 12568,-4080.31 12834,-4080.31 12834,-4132.31"/>
<text text-anchor="middle" x="12701" y="-4120.31" font-family="Arial" font-size="10.00">Layer Norm TP5</text>
<text text-anchor="middle" x="12701" y="-4109.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12701" y="-4098.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12701" y="-4087.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- res_add_l0_tp5&#45;&gt;norm_l0_tp5 -->
<g id="edge148" class="edge">
<title>res_add_l0_tp5&#45;&gt;norm_l0_tp5</title>
<path fill="none" stroke="black" d="M10356.36,-4169.21C10359.27,-4168.89 10362.15,-4168.59 10365,-4168.31 10793.69,-4126.72 12118.23,-4112.16 12557.67,-4108.4"/>
<polygon fill="black" stroke="black" points="12557.92,-4111.9 12567.89,-4108.31 12557.86,-4104.9 12557.92,-4111.9"/>
</g>
<!-- gate_l0_tp5 -->
<g id="node63" class="node">
<title>gate_l0_tp5</title>
<polygon fill="lightyellow" stroke="black" points="11971.3,-4044.31 11504.72,-4044.31 11384.7,-3940.31 11851.28,-3940.31 11971.3,-4044.31"/>
<text text-anchor="middle" x="11678" y="-4006.31" font-family="Arial" font-size="10.00">Gate Network TP5</text>
<text text-anchor="middle" x="11678" y="-3995.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11678" y="-3984.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="11678" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l0_tp5&#45;&gt;gate_l0_tp5 -->
<g id="edge149" class="edge">
<title>norm_l0_tp5&#45;&gt;gate_l0_tp5</title>
<path fill="none" stroke="black" d="M12567.77,-4097.36C12422.8,-4087.93 12184.39,-4070.17 11980,-4044.31 11979.9,-4044.3 11979.79,-4044.29 11979.69,-4044.27"/>
<polygon fill="black" stroke="black" points="11980.42,-4040.84 11970.05,-4043.03 11979.53,-4047.78 11980.42,-4040.84"/>
</g>
<!-- expert40_l0_tp5 -->
<g id="node106" class="node">
<title>expert40_l0_tp5</title>
<polygon fill="lightcoral" stroke="black" points="12589,-4018.31 12401,-4018.31 12401,-3966.31 12589,-3966.31 12589,-4018.31"/>
<text text-anchor="middle" x="12495" y="-4006.31" font-family="Arial" font-size="10.00">Expert 40</text>
<text text-anchor="middle" x="12495" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12495" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12495" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l0_tp5&#45;&gt;expert40_l0_tp5 -->
<g id="edge150" class="edge">
<title>norm_l0_tp5&#45;&gt;expert40_l0_tp5</title>
<path fill="none" stroke="black" d="M12654.77,-4080.18C12623.76,-4063.32 12582.76,-4041.03 12550.06,-4023.25"/>
<polygon fill="black" stroke="black" points="12551.53,-4020.07 12541.08,-4018.36 12548.19,-4026.22 12551.53,-4020.07"/>
</g>
<!-- expert41_l0_tp5 -->
<g id="node107" class="node">
<title>expert41_l0_tp5</title>
<polygon fill="lightcoral" stroke="black" points="12795,-4018.31 12607,-4018.31 12607,-3966.31 12795,-3966.31 12795,-4018.31"/>
<text text-anchor="middle" x="12701" y="-4006.31" font-family="Arial" font-size="10.00">Expert 41</text>
<text text-anchor="middle" x="12701" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12701" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12701" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l0_tp5&#45;&gt;expert41_l0_tp5 -->
<g id="edge152" class="edge">
<title>norm_l0_tp5&#45;&gt;expert41_l0_tp5</title>
<path fill="none" stroke="black" d="M12701,-4080.18C12701,-4064.9 12701,-4045.17 12701,-4028.38"/>
<polygon fill="black" stroke="black" points="12704.5,-4028.36 12701,-4018.36 12697.5,-4028.36 12704.5,-4028.36"/>
</g>
<!-- expert42_l0_tp5 -->
<g id="node108" class="node">
<title>expert42_l0_tp5</title>
<polygon fill="lightcoral" stroke="black" points="13001,-4018.31 12813,-4018.31 12813,-3966.31 13001,-3966.31 13001,-4018.31"/>
<text text-anchor="middle" x="12907" y="-4006.31" font-family="Arial" font-size="10.00">Expert 42</text>
<text text-anchor="middle" x="12907" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12907" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12907" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l0_tp5&#45;&gt;expert42_l0_tp5 -->
<g id="edge154" class="edge">
<title>norm_l0_tp5&#45;&gt;expert42_l0_tp5</title>
<path fill="none" stroke="black" d="M12747.23,-4080.18C12778.24,-4063.32 12819.24,-4041.03 12851.94,-4023.25"/>
<polygon fill="black" stroke="black" points="12853.81,-4026.22 12860.92,-4018.36 12850.47,-4020.07 12853.81,-4026.22"/>
</g>
<!-- expert43_l0_tp5 -->
<g id="node109" class="node">
<title>expert43_l0_tp5</title>
<polygon fill="lightcoral" stroke="black" points="13207,-4018.31 13019,-4018.31 13019,-3966.31 13207,-3966.31 13207,-4018.31"/>
<text text-anchor="middle" x="13113" y="-4006.31" font-family="Arial" font-size="10.00">Expert 43</text>
<text text-anchor="middle" x="13113" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13113" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13113" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l0_tp5&#45;&gt;expert43_l0_tp5 -->
<g id="edge156" class="edge">
<title>norm_l0_tp5&#45;&gt;expert43_l0_tp5</title>
<path fill="none" stroke="black" d="M12834.2,-4086.96C12889.46,-4077.32 12953.69,-4063.43 13010,-4044.31 13026.74,-4038.63 13044.23,-4030.77 13059.95,-4022.92"/>
<polygon fill="black" stroke="black" points="13061.66,-4025.98 13068.98,-4018.32 13058.48,-4019.74 13061.66,-4025.98"/>
</g>
<!-- expert44_l0_tp5 -->
<g id="node110" class="node">
<title>expert44_l0_tp5</title>
<polygon fill="lightcoral" stroke="black" points="13413,-4018.31 13225,-4018.31 13225,-3966.31 13413,-3966.31 13413,-4018.31"/>
<text text-anchor="middle" x="13319" y="-4006.31" font-family="Arial" font-size="10.00">Expert 44</text>
<text text-anchor="middle" x="13319" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13319" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13319" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l0_tp5&#45;&gt;expert44_l0_tp5 -->
<g id="edge158" class="edge">
<title>norm_l0_tp5&#45;&gt;expert44_l0_tp5</title>
<path fill="none" stroke="black" d="M12834.21,-4101.97C12939.69,-4096.38 13089.78,-4081.82 13216,-4044.31 13233.43,-4039.13 13251.5,-4031.18 13267.55,-4023.08"/>
<polygon fill="black" stroke="black" points="13269.47,-4026.03 13276.74,-4018.32 13266.25,-4019.81 13269.47,-4026.03"/>
</g>
<!-- expert45_l0_tp5 -->
<g id="node111" class="node">
<title>expert45_l0_tp5</title>
<polygon fill="lightcoral" stroke="black" points="13619,-4018.31 13431,-4018.31 13431,-3966.31 13619,-3966.31 13619,-4018.31"/>
<text text-anchor="middle" x="13525" y="-4006.31" font-family="Arial" font-size="10.00">Expert 45</text>
<text text-anchor="middle" x="13525" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13525" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13525" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l0_tp5&#45;&gt;expert45_l0_tp5 -->
<g id="edge160" class="edge">
<title>norm_l0_tp5&#45;&gt;expert45_l0_tp5</title>
<path fill="none" stroke="black" d="M12834.01,-4100.01C13011.24,-4091.91 13314.92,-4074.19 13422,-4044.31 13439.67,-4039.38 13457.94,-4031.41 13474.09,-4023.23"/>
<polygon fill="black" stroke="black" points="13476.09,-4026.13 13483.34,-4018.4 13472.85,-4019.92 13476.09,-4026.13"/>
</g>
<!-- expert46_l0_tp5 -->
<g id="node112" class="node">
<title>expert46_l0_tp5</title>
<polygon fill="lightcoral" stroke="black" points="12177,-4018.31 11989,-4018.31 11989,-3966.31 12177,-3966.31 12177,-4018.31"/>
<text text-anchor="middle" x="12083" y="-4006.31" font-family="Arial" font-size="10.00">Expert 46</text>
<text text-anchor="middle" x="12083" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12083" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12083" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l0_tp5&#45;&gt;expert46_l0_tp5 -->
<g id="edge162" class="edge">
<title>norm_l0_tp5&#45;&gt;expert46_l0_tp5</title>
<path fill="none" stroke="black" d="M12567.79,-4101.97C12462.31,-4096.38 12312.22,-4081.82 12186,-4044.31 12168.57,-4039.13 12150.5,-4031.18 12134.45,-4023.08"/>
<polygon fill="black" stroke="black" points="12135.75,-4019.81 12125.26,-4018.32 12132.53,-4026.03 12135.75,-4019.81"/>
</g>
<!-- expert47_l0_tp5 -->
<g id="node113" class="node">
<title>expert47_l0_tp5</title>
<polygon fill="lightcoral" stroke="black" points="12383,-4018.31 12195,-4018.31 12195,-3966.31 12383,-3966.31 12383,-4018.31"/>
<text text-anchor="middle" x="12289" y="-4006.31" font-family="Arial" font-size="10.00">Expert 47</text>
<text text-anchor="middle" x="12289" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12289" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12289" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l0_tp5&#45;&gt;expert47_l0_tp5 -->
<g id="edge164" class="edge">
<title>norm_l0_tp5&#45;&gt;expert47_l0_tp5</title>
<path fill="none" stroke="black" d="M12567.8,-4086.96C12512.54,-4077.32 12448.31,-4063.43 12392,-4044.31 12375.26,-4038.63 12357.77,-4030.77 12342.05,-4022.92"/>
<polygon fill="black" stroke="black" points="12343.52,-4019.74 12333.02,-4018.32 12340.34,-4025.98 12343.52,-4019.74"/>
</g>
<!-- res_add2_l0_tp5 -->
<g id="node146" class="node">
<title>res_add2_l0_tp5</title>
<polygon fill="lightgreen" stroke="black" points="12943,-3764.31 12665,-3764.31 12665,-3712.31 12943,-3712.31 12943,-3764.31"/>
<text text-anchor="middle" x="12804" y="-3752.31" font-family="Arial" font-size="10.00">Residual Add 2 TP5</text>
<text text-anchor="middle" x="12804" y="-3741.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="12804" y="-3730.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12804" y="-3719.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l0_tp5&#45;&gt;res_add2_l0_tp5 -->
<g id="edge167" class="edge">
<title>norm_l0_tp5&#45;&gt;res_add2_l0_tp5</title>
<path fill="none" stroke="black" d="M12834.04,-4101.3C13084.03,-4093.12 13601.3,-4072.83 13628,-4044.31 13643.8,-4027.44 13642.14,-3958.59 13628,-3940.31 13476.58,-3744.53 13329.85,-3857.34 13089,-3800.31 13039.37,-3788.56 12984.63,-3776.61 12936.51,-3766.43"/>
<polygon fill="black" stroke="black" points="12937.16,-3762.99 12926.66,-3764.35 12935.72,-3769.84 12937.16,-3762.99"/>
</g>
<!-- mha_qkv_l0_tp6 -->
<g id="node45" class="node">
<title>mha_qkv_l0_tp6</title>
<polygon fill="lightgreen" stroke="black" points="9730.5,-4593.85 9439.5,-4593.85 9439.5,-4541.85 9730.5,-4541.85 9730.5,-4593.85"/>
<text text-anchor="middle" x="9585" y="-4581.85" font-family="Arial" font-size="10.00">MHA QKV TP6</text>
<text text-anchor="middle" x="9585" y="-4570.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9585" y="-4559.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9585" y="-4548.85" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- input_split_l0_tp6&#45;&gt;mha_qkv_l0_tp6 -->
<g id="edge170" class="edge">
<title>input_split_l0_tp6&#45;&gt;mha_qkv_l0_tp6</title>
<path fill="none" stroke="black" d="M9585,-4629.59C9585,-4621.28 9585,-4612.44 9585,-4604.16"/>
<polygon fill="black" stroke="black" points="9588.5,-4604.05 9585,-4594.05 9581.5,-4604.05 9588.5,-4604.05"/>
</g>
<!-- mha_attn_l0_tp6 -->
<g id="node46" class="node">
<title>mha_attn_l0_tp6</title>
<polygon fill="lightgreen" stroke="black" points="9730.5,-4505.85 9439.5,-4505.85 9439.5,-4453.85 9730.5,-4453.85 9730.5,-4505.85"/>
<text text-anchor="middle" x="9585" y="-4493.85" font-family="Arial" font-size="10.00">MHA Attention TP6</text>
<text text-anchor="middle" x="9585" y="-4482.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9585" y="-4471.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9585" y="-4460.85" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- mha_qkv_l0_tp6&#45;&gt;mha_attn_l0_tp6 -->
<g id="edge171" class="edge">
<title>mha_qkv_l0_tp6&#45;&gt;mha_attn_l0_tp6</title>
<path fill="none" stroke="black" d="M9585,-4541.51C9585,-4533.55 9585,-4524.62 9585,-4516.1"/>
<polygon fill="black" stroke="black" points="9588.5,-4516.01 9585,-4506.01 9581.5,-4516.01 9588.5,-4516.01"/>
</g>
<!-- mha_out_l0_tp6 -->
<g id="node47" class="node">
<title>mha_out_l0_tp6</title>
<polygon fill="lightgreen" stroke="black" points="9727,-4417.85 9443,-4417.85 9443,-4365.85 9727,-4365.85 9727,-4417.85"/>
<text text-anchor="middle" x="9585" y="-4405.85" font-family="Arial" font-size="10.00">MHA Output TP6</text>
<text text-anchor="middle" x="9585" y="-4394.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9585" y="-4383.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9585" y="-4372.85" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- mha_attn_l0_tp6&#45;&gt;mha_out_l0_tp6 -->
<g id="edge172" class="edge">
<title>mha_attn_l0_tp6&#45;&gt;mha_out_l0_tp6</title>
<path fill="none" stroke="black" d="M9585,-4453.51C9585,-4445.55 9585,-4436.62 9585,-4428.1"/>
<polygon fill="black" stroke="black" points="9588.5,-4428.01 9585,-4418.01 9581.5,-4428.01 9588.5,-4428.01"/>
</g>
<!-- attn_allreduce_l0_tp6 -->
<g id="node48" class="node">
<title>attn_allreduce_l0_tp6</title>
<ellipse fill="lightgray" stroke="black" cx="9585" cy="-4293.08" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9585" y="-4307.08" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP6</text>
<text text-anchor="middle" x="9585" y="-4296.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9585" y="-4285.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9585" y="-4274.08" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- mha_out_l0_tp6&#45;&gt;attn_allreduce_l0_tp6 -->
<g id="edge173" class="edge">
<title>mha_out_l0_tp6&#45;&gt;attn_allreduce_l0_tp6</title>
<path fill="none" stroke="black" d="M9585,-4365.68C9585,-4357.87 9585,-4349.01 9585,-4340.24"/>
<polygon fill="black" stroke="black" points="9588.5,-4340.06 9585,-4330.06 9581.5,-4340.06 9588.5,-4340.06"/>
</g>
<!-- attn_allreduce_l0_tp6&#45;&gt;res_add_l0_tp6 -->
<g id="edge175" class="edge">
<title>attn_allreduce_l0_tp6&#45;&gt;res_add_l0_tp6</title>
<path fill="none" stroke="black" d="M9714.48,-4266.33C9736.92,-4262.51 9760.09,-4258.97 9782,-4256.31 10036.45,-4225.47 10105.35,-4249.35 10363.57,-4220.42"/>
<polygon fill="black" stroke="black" points="10364.08,-4223.89 10373.62,-4219.28 10363.29,-4216.93 10364.08,-4223.89"/>
</g>
<!-- norm_l0_tp6 -->
<g id="node50" class="node">
<title>norm_l0_tp6</title>
<polygon fill="lightgreen" stroke="black" points="15106,-4132.31 14840,-4132.31 14840,-4080.31 15106,-4080.31 15106,-4132.31"/>
<text text-anchor="middle" x="14973" y="-4120.31" font-family="Arial" font-size="10.00">Layer Norm TP6</text>
<text text-anchor="middle" x="14973" y="-4109.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14973" y="-4098.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14973" y="-4087.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- res_add_l0_tp6&#45;&gt;norm_l0_tp6 -->
<g id="edge176" class="edge">
<title>res_add_l0_tp6&#45;&gt;norm_l0_tp6</title>
<path fill="none" stroke="black" d="M10652.36,-4169.16C10655.26,-4168.86 10658.15,-4168.57 10661,-4168.31 10767.07,-4158.66 14093.66,-4117.95 14829.74,-4109.04"/>
<polygon fill="black" stroke="black" points="14829.91,-4112.54 14839.87,-4108.92 14829.82,-4105.54 14829.91,-4112.54"/>
</g>
<!-- gate_l0_tp6 -->
<g id="node64" class="node">
<title>gate_l0_tp6</title>
<polygon fill="lightyellow" stroke="black" points="14243.3,-4044.31 13776.72,-4044.31 13656.7,-3940.31 14123.28,-3940.31 14243.3,-4044.31"/>
<text text-anchor="middle" x="13950" y="-4006.31" font-family="Arial" font-size="10.00">Gate Network TP6</text>
<text text-anchor="middle" x="13950" y="-3995.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13950" y="-3984.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="13950" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l0_tp6&#45;&gt;gate_l0_tp6 -->
<g id="edge177" class="edge">
<title>norm_l0_tp6&#45;&gt;gate_l0_tp6</title>
<path fill="none" stroke="black" d="M14839.77,-4097.36C14694.8,-4087.93 14456.39,-4070.17 14252,-4044.31 14251.9,-4044.3 14251.79,-4044.29 14251.69,-4044.27"/>
<polygon fill="black" stroke="black" points="14252.42,-4040.84 14242.05,-4043.03 14251.53,-4047.78 14252.42,-4040.84"/>
</g>
<!-- expert48_l0_tp6 -->
<g id="node114" class="node">
<title>expert48_l0_tp6</title>
<polygon fill="lightcoral" stroke="black" points="14655,-4018.31 14467,-4018.31 14467,-3966.31 14655,-3966.31 14655,-4018.31"/>
<text text-anchor="middle" x="14561" y="-4006.31" font-family="Arial" font-size="10.00">Expert 48</text>
<text text-anchor="middle" x="14561" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14561" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14561" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l0_tp6&#45;&gt;expert48_l0_tp6 -->
<g id="edge178" class="edge">
<title>norm_l0_tp6&#45;&gt;expert48_l0_tp6</title>
<path fill="none" stroke="black" d="M14839.8,-4086.96C14784.54,-4077.32 14720.31,-4063.43 14664,-4044.31 14647.26,-4038.63 14629.77,-4030.77 14614.05,-4022.92"/>
<polygon fill="black" stroke="black" points="14615.52,-4019.74 14605.02,-4018.32 14612.34,-4025.98 14615.52,-4019.74"/>
</g>
<!-- expert49_l0_tp6 -->
<g id="node115" class="node">
<title>expert49_l0_tp6</title>
<polygon fill="lightcoral" stroke="black" points="14861,-4018.31 14673,-4018.31 14673,-3966.31 14861,-3966.31 14861,-4018.31"/>
<text text-anchor="middle" x="14767" y="-4006.31" font-family="Arial" font-size="10.00">Expert 49</text>
<text text-anchor="middle" x="14767" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14767" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14767" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l0_tp6&#45;&gt;expert49_l0_tp6 -->
<g id="edge180" class="edge">
<title>norm_l0_tp6&#45;&gt;expert49_l0_tp6</title>
<path fill="none" stroke="black" d="M14926.77,-4080.18C14895.76,-4063.32 14854.76,-4041.03 14822.06,-4023.25"/>
<polygon fill="black" stroke="black" points="14823.53,-4020.07 14813.08,-4018.36 14820.19,-4026.22 14823.53,-4020.07"/>
</g>
<!-- expert50_l0_tp6 -->
<g id="node116" class="node">
<title>expert50_l0_tp6</title>
<polygon fill="lightcoral" stroke="black" points="15067,-4018.31 14879,-4018.31 14879,-3966.31 15067,-3966.31 15067,-4018.31"/>
<text text-anchor="middle" x="14973" y="-4006.31" font-family="Arial" font-size="10.00">Expert 50</text>
<text text-anchor="middle" x="14973" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14973" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14973" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l0_tp6&#45;&gt;expert50_l0_tp6 -->
<g id="edge182" class="edge">
<title>norm_l0_tp6&#45;&gt;expert50_l0_tp6</title>
<path fill="none" stroke="black" d="M14973,-4080.18C14973,-4064.9 14973,-4045.17 14973,-4028.38"/>
<polygon fill="black" stroke="black" points="14976.5,-4028.36 14973,-4018.36 14969.5,-4028.36 14976.5,-4028.36"/>
</g>
<!-- expert51_l0_tp6 -->
<g id="node117" class="node">
<title>expert51_l0_tp6</title>
<polygon fill="lightcoral" stroke="black" points="15273,-4018.31 15085,-4018.31 15085,-3966.31 15273,-3966.31 15273,-4018.31"/>
<text text-anchor="middle" x="15179" y="-4006.31" font-family="Arial" font-size="10.00">Expert 51</text>
<text text-anchor="middle" x="15179" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15179" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15179" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l0_tp6&#45;&gt;expert51_l0_tp6 -->
<g id="edge184" class="edge">
<title>norm_l0_tp6&#45;&gt;expert51_l0_tp6</title>
<path fill="none" stroke="black" d="M15019.23,-4080.18C15050.24,-4063.32 15091.24,-4041.03 15123.94,-4023.25"/>
<polygon fill="black" stroke="black" points="15125.81,-4026.22 15132.92,-4018.36 15122.47,-4020.07 15125.81,-4026.22"/>
</g>
<!-- expert52_l0_tp6 -->
<g id="node118" class="node">
<title>expert52_l0_tp6</title>
<polygon fill="lightcoral" stroke="black" points="15479,-4018.31 15291,-4018.31 15291,-3966.31 15479,-3966.31 15479,-4018.31"/>
<text text-anchor="middle" x="15385" y="-4006.31" font-family="Arial" font-size="10.00">Expert 52</text>
<text text-anchor="middle" x="15385" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15385" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15385" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l0_tp6&#45;&gt;expert52_l0_tp6 -->
<g id="edge186" class="edge">
<title>norm_l0_tp6&#45;&gt;expert52_l0_tp6</title>
<path fill="none" stroke="black" d="M15106.2,-4086.96C15161.46,-4077.32 15225.69,-4063.43 15282,-4044.31 15298.74,-4038.63 15316.23,-4030.77 15331.95,-4022.92"/>
<polygon fill="black" stroke="black" points="15333.66,-4025.98 15340.98,-4018.32 15330.48,-4019.74 15333.66,-4025.98"/>
</g>
<!-- expert53_l0_tp6 -->
<g id="node119" class="node">
<title>expert53_l0_tp6</title>
<polygon fill="lightcoral" stroke="black" points="15685,-4018.31 15497,-4018.31 15497,-3966.31 15685,-3966.31 15685,-4018.31"/>
<text text-anchor="middle" x="15591" y="-4006.31" font-family="Arial" font-size="10.00">Expert 53</text>
<text text-anchor="middle" x="15591" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15591" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15591" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l0_tp6&#45;&gt;expert53_l0_tp6 -->
<g id="edge188" class="edge">
<title>norm_l0_tp6&#45;&gt;expert53_l0_tp6</title>
<path fill="none" stroke="black" d="M15106.21,-4101.97C15211.69,-4096.38 15361.78,-4081.82 15488,-4044.31 15505.43,-4039.13 15523.5,-4031.18 15539.55,-4023.08"/>
<polygon fill="black" stroke="black" points="15541.47,-4026.03 15548.74,-4018.32 15538.25,-4019.81 15541.47,-4026.03"/>
</g>
<!-- expert54_l0_tp6 -->
<g id="node120" class="node">
<title>expert54_l0_tp6</title>
<polygon fill="lightcoral" stroke="black" points="15891,-4018.31 15703,-4018.31 15703,-3966.31 15891,-3966.31 15891,-4018.31"/>
<text text-anchor="middle" x="15797" y="-4006.31" font-family="Arial" font-size="10.00">Expert 54</text>
<text text-anchor="middle" x="15797" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15797" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15797" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l0_tp6&#45;&gt;expert54_l0_tp6 -->
<g id="edge190" class="edge">
<title>norm_l0_tp6&#45;&gt;expert54_l0_tp6</title>
<path fill="none" stroke="black" d="M15106.01,-4100.01C15283.24,-4091.91 15586.92,-4074.19 15694,-4044.31 15711.67,-4039.38 15729.94,-4031.41 15746.09,-4023.23"/>
<polygon fill="black" stroke="black" points="15748.09,-4026.13 15755.34,-4018.4 15744.85,-4019.92 15748.09,-4026.13"/>
</g>
<!-- expert55_l0_tp6 -->
<g id="node121" class="node">
<title>expert55_l0_tp6</title>
<polygon fill="lightcoral" stroke="black" points="14449,-4018.31 14261,-4018.31 14261,-3966.31 14449,-3966.31 14449,-4018.31"/>
<text text-anchor="middle" x="14355" y="-4006.31" font-family="Arial" font-size="10.00">Expert 55</text>
<text text-anchor="middle" x="14355" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14355" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14355" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l0_tp6&#45;&gt;expert55_l0_tp6 -->
<g id="edge192" class="edge">
<title>norm_l0_tp6&#45;&gt;expert55_l0_tp6</title>
<path fill="none" stroke="black" d="M14839.79,-4101.97C14734.31,-4096.38 14584.22,-4081.82 14458,-4044.31 14440.57,-4039.13 14422.5,-4031.18 14406.45,-4023.08"/>
<polygon fill="black" stroke="black" points="14407.75,-4019.81 14397.26,-4018.32 14404.53,-4026.03 14407.75,-4019.81"/>
</g>
<!-- res_add2_l0_tp6 -->
<g id="node149" class="node">
<title>res_add2_l0_tp6</title>
<polygon fill="lightgreen" stroke="black" points="15215,-3764.31 14937,-3764.31 14937,-3712.31 15215,-3712.31 15215,-3764.31"/>
<text text-anchor="middle" x="15076" y="-3752.31" font-family="Arial" font-size="10.00">Residual Add 2 TP6</text>
<text text-anchor="middle" x="15076" y="-3741.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="15076" y="-3730.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15076" y="-3719.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l0_tp6&#45;&gt;res_add2_l0_tp6 -->
<g id="edge195" class="edge">
<title>norm_l0_tp6&#45;&gt;res_add2_l0_tp6</title>
<path fill="none" stroke="black" d="M15106.04,-4101.3C15356.03,-4093.12 15873.3,-4072.83 15900,-4044.31 15915.8,-4027.44 15914.14,-3958.59 15900,-3940.31 15748.58,-3744.53 15601.85,-3857.34 15361,-3800.31 15311.37,-3788.56 15256.63,-3776.61 15208.51,-3766.43"/>
<polygon fill="black" stroke="black" points="15209.16,-3762.99 15198.66,-3764.35 15207.72,-3769.84 15209.16,-3762.99"/>
</g>
<!-- mha_qkv_l0_tp7 -->
<g id="node52" class="node">
<title>mha_qkv_l0_tp7</title>
<polygon fill="lightgreen" stroke="black" points="10124.5,-4593.85 9833.5,-4593.85 9833.5,-4541.85 10124.5,-4541.85 10124.5,-4593.85"/>
<text text-anchor="middle" x="9979" y="-4581.85" font-family="Arial" font-size="10.00">MHA QKV TP7</text>
<text text-anchor="middle" x="9979" y="-4570.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9979" y="-4559.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9979" y="-4548.85" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- input_split_l0_tp7&#45;&gt;mha_qkv_l0_tp7 -->
<g id="edge198" class="edge">
<title>input_split_l0_tp7&#45;&gt;mha_qkv_l0_tp7</title>
<path fill="none" stroke="black" d="M9979,-4629.59C9979,-4621.28 9979,-4612.44 9979,-4604.16"/>
<polygon fill="black" stroke="black" points="9982.5,-4604.05 9979,-4594.05 9975.5,-4604.05 9982.5,-4604.05"/>
</g>
<!-- mha_attn_l0_tp7 -->
<g id="node53" class="node">
<title>mha_attn_l0_tp7</title>
<polygon fill="lightgreen" stroke="black" points="10124.5,-4505.85 9833.5,-4505.85 9833.5,-4453.85 10124.5,-4453.85 10124.5,-4505.85"/>
<text text-anchor="middle" x="9979" y="-4493.85" font-family="Arial" font-size="10.00">MHA Attention TP7</text>
<text text-anchor="middle" x="9979" y="-4482.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9979" y="-4471.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9979" y="-4460.85" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- mha_qkv_l0_tp7&#45;&gt;mha_attn_l0_tp7 -->
<g id="edge199" class="edge">
<title>mha_qkv_l0_tp7&#45;&gt;mha_attn_l0_tp7</title>
<path fill="none" stroke="black" d="M9979,-4541.51C9979,-4533.55 9979,-4524.62 9979,-4516.1"/>
<polygon fill="black" stroke="black" points="9982.5,-4516.01 9979,-4506.01 9975.5,-4516.01 9982.5,-4516.01"/>
</g>
<!-- mha_out_l0_tp7 -->
<g id="node54" class="node">
<title>mha_out_l0_tp7</title>
<polygon fill="lightgreen" stroke="black" points="10121,-4417.85 9837,-4417.85 9837,-4365.85 10121,-4365.85 10121,-4417.85"/>
<text text-anchor="middle" x="9979" y="-4405.85" font-family="Arial" font-size="10.00">MHA Output TP7</text>
<text text-anchor="middle" x="9979" y="-4394.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9979" y="-4383.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9979" y="-4372.85" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- mha_attn_l0_tp7&#45;&gt;mha_out_l0_tp7 -->
<g id="edge200" class="edge">
<title>mha_attn_l0_tp7&#45;&gt;mha_out_l0_tp7</title>
<path fill="none" stroke="black" d="M9979,-4453.51C9979,-4445.55 9979,-4436.62 9979,-4428.1"/>
<polygon fill="black" stroke="black" points="9982.5,-4428.01 9979,-4418.01 9975.5,-4428.01 9982.5,-4428.01"/>
</g>
<!-- attn_allreduce_l0_tp7 -->
<g id="node55" class="node">
<title>attn_allreduce_l0_tp7</title>
<ellipse fill="lightgray" stroke="black" cx="9979" cy="-4293.08" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9979" y="-4307.08" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP7</text>
<text text-anchor="middle" x="9979" y="-4296.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9979" y="-4285.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9979" y="-4274.08" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- mha_out_l0_tp7&#45;&gt;attn_allreduce_l0_tp7 -->
<g id="edge201" class="edge">
<title>mha_out_l0_tp7&#45;&gt;attn_allreduce_l0_tp7</title>
<path fill="none" stroke="black" d="M9979,-4365.68C9979,-4357.87 9979,-4349.01 9979,-4340.24"/>
<polygon fill="black" stroke="black" points="9982.5,-4340.06 9979,-4330.06 9975.5,-4340.06 9982.5,-4340.06"/>
</g>
<!-- attn_allreduce_l0_tp7&#45;&gt;res_add_l0_tp7 -->
<g id="edge203" class="edge">
<title>attn_allreduce_l0_tp7&#45;&gt;res_add_l0_tp7</title>
<path fill="none" stroke="black" d="M10107.27,-4266.15C10128.5,-4262.45 10150.32,-4258.99 10171,-4256.31 10384.28,-4228.7 10442.46,-4245.99 10659.49,-4220.44"/>
<polygon fill="black" stroke="black" points="10660.1,-4223.89 10669.62,-4219.23 10659.27,-4216.94 10660.1,-4223.89"/>
</g>
<!-- norm_l0_tp7 -->
<g id="node57" class="node">
<title>norm_l0_tp7</title>
<polygon fill="lightgreen" stroke="black" points="17378,-4132.31 17112,-4132.31 17112,-4080.31 17378,-4080.31 17378,-4132.31"/>
<text text-anchor="middle" x="17245" y="-4120.31" font-family="Arial" font-size="10.00">Layer Norm TP7</text>
<text text-anchor="middle" x="17245" y="-4109.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="17245" y="-4098.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="17245" y="-4087.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- res_add_l0_tp7&#45;&gt;norm_l0_tp7 -->
<g id="edge204" class="edge">
<title>res_add_l0_tp7&#45;&gt;norm_l0_tp7</title>
<path fill="none" stroke="black" d="M10948.28,-4191.45C11794.95,-4180.14 16243.06,-4120.7 17101.52,-4109.23"/>
<polygon fill="black" stroke="black" points="17101.81,-4112.73 17111.76,-4109.09 17101.72,-4105.73 17101.81,-4112.73"/>
</g>
<!-- gate_l0_tp7 -->
<g id="node65" class="node">
<title>gate_l0_tp7</title>
<polygon fill="lightyellow" stroke="black" points="16515.3,-4044.31 16048.72,-4044.31 15928.7,-3940.31 16395.28,-3940.31 16515.3,-4044.31"/>
<text text-anchor="middle" x="16222" y="-4006.31" font-family="Arial" font-size="10.00">Gate Network TP7</text>
<text text-anchor="middle" x="16222" y="-3995.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16222" y="-3984.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="16222" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l0_tp7&#45;&gt;gate_l0_tp7 -->
<g id="edge205" class="edge">
<title>norm_l0_tp7&#45;&gt;gate_l0_tp7</title>
<path fill="none" stroke="black" d="M17111.77,-4097.36C16966.8,-4087.93 16728.39,-4070.17 16524,-4044.31 16523.9,-4044.3 16523.79,-4044.29 16523.69,-4044.27"/>
<polygon fill="black" stroke="black" points="16524.42,-4040.84 16514.05,-4043.03 16523.53,-4047.78 16524.42,-4040.84"/>
</g>
<!-- expert56_l0_tp7 -->
<g id="node122" class="node">
<title>expert56_l0_tp7</title>
<polygon fill="lightcoral" stroke="black" points="16721,-4018.31 16533,-4018.31 16533,-3966.31 16721,-3966.31 16721,-4018.31"/>
<text text-anchor="middle" x="16627" y="-4006.31" font-family="Arial" font-size="10.00">Expert 56</text>
<text text-anchor="middle" x="16627" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16627" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16627" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l0_tp7&#45;&gt;expert56_l0_tp7 -->
<g id="edge206" class="edge">
<title>norm_l0_tp7&#45;&gt;expert56_l0_tp7</title>
<path fill="none" stroke="black" d="M17111.79,-4101.97C17006.31,-4096.38 16856.22,-4081.82 16730,-4044.31 16712.57,-4039.13 16694.5,-4031.18 16678.45,-4023.08"/>
<polygon fill="black" stroke="black" points="16679.75,-4019.81 16669.26,-4018.32 16676.53,-4026.03 16679.75,-4019.81"/>
</g>
<!-- expert57_l0_tp7 -->
<g id="node123" class="node">
<title>expert57_l0_tp7</title>
<polygon fill="lightcoral" stroke="black" points="16927,-4018.31 16739,-4018.31 16739,-3966.31 16927,-3966.31 16927,-4018.31"/>
<text text-anchor="middle" x="16833" y="-4006.31" font-family="Arial" font-size="10.00">Expert 57</text>
<text text-anchor="middle" x="16833" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16833" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16833" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l0_tp7&#45;&gt;expert57_l0_tp7 -->
<g id="edge208" class="edge">
<title>norm_l0_tp7&#45;&gt;expert57_l0_tp7</title>
<path fill="none" stroke="black" d="M17111.8,-4086.96C17056.54,-4077.32 16992.31,-4063.43 16936,-4044.31 16919.26,-4038.63 16901.77,-4030.77 16886.05,-4022.92"/>
<polygon fill="black" stroke="black" points="16887.52,-4019.74 16877.02,-4018.32 16884.34,-4025.98 16887.52,-4019.74"/>
</g>
<!-- expert58_l0_tp7 -->
<g id="node124" class="node">
<title>expert58_l0_tp7</title>
<polygon fill="lightcoral" stroke="black" points="17133,-4018.31 16945,-4018.31 16945,-3966.31 17133,-3966.31 17133,-4018.31"/>
<text text-anchor="middle" x="17039" y="-4006.31" font-family="Arial" font-size="10.00">Expert 58</text>
<text text-anchor="middle" x="17039" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17039" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17039" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l0_tp7&#45;&gt;expert58_l0_tp7 -->
<g id="edge210" class="edge">
<title>norm_l0_tp7&#45;&gt;expert58_l0_tp7</title>
<path fill="none" stroke="black" d="M17198.77,-4080.18C17167.76,-4063.32 17126.76,-4041.03 17094.06,-4023.25"/>
<polygon fill="black" stroke="black" points="17095.53,-4020.07 17085.08,-4018.36 17092.19,-4026.22 17095.53,-4020.07"/>
</g>
<!-- expert59_l0_tp7 -->
<g id="node125" class="node">
<title>expert59_l0_tp7</title>
<polygon fill="lightcoral" stroke="black" points="17339,-4018.31 17151,-4018.31 17151,-3966.31 17339,-3966.31 17339,-4018.31"/>
<text text-anchor="middle" x="17245" y="-4006.31" font-family="Arial" font-size="10.00">Expert 59</text>
<text text-anchor="middle" x="17245" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17245" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17245" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l0_tp7&#45;&gt;expert59_l0_tp7 -->
<g id="edge212" class="edge">
<title>norm_l0_tp7&#45;&gt;expert59_l0_tp7</title>
<path fill="none" stroke="black" d="M17245,-4080.18C17245,-4064.9 17245,-4045.17 17245,-4028.38"/>
<polygon fill="black" stroke="black" points="17248.5,-4028.36 17245,-4018.36 17241.5,-4028.36 17248.5,-4028.36"/>
</g>
<!-- expert60_l0_tp7 -->
<g id="node126" class="node">
<title>expert60_l0_tp7</title>
<polygon fill="lightcoral" stroke="black" points="17545,-4018.31 17357,-4018.31 17357,-3966.31 17545,-3966.31 17545,-4018.31"/>
<text text-anchor="middle" x="17451" y="-4006.31" font-family="Arial" font-size="10.00">Expert 60</text>
<text text-anchor="middle" x="17451" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17451" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17451" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l0_tp7&#45;&gt;expert60_l0_tp7 -->
<g id="edge214" class="edge">
<title>norm_l0_tp7&#45;&gt;expert60_l0_tp7</title>
<path fill="none" stroke="black" d="M17291.23,-4080.18C17322.24,-4063.32 17363.24,-4041.03 17395.94,-4023.25"/>
<polygon fill="black" stroke="black" points="17397.81,-4026.22 17404.92,-4018.36 17394.47,-4020.07 17397.81,-4026.22"/>
</g>
<!-- expert61_l0_tp7 -->
<g id="node127" class="node">
<title>expert61_l0_tp7</title>
<polygon fill="lightcoral" stroke="black" points="17751,-4018.31 17563,-4018.31 17563,-3966.31 17751,-3966.31 17751,-4018.31"/>
<text text-anchor="middle" x="17657" y="-4006.31" font-family="Arial" font-size="10.00">Expert 61</text>
<text text-anchor="middle" x="17657" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17657" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17657" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l0_tp7&#45;&gt;expert61_l0_tp7 -->
<g id="edge216" class="edge">
<title>norm_l0_tp7&#45;&gt;expert61_l0_tp7</title>
<path fill="none" stroke="black" d="M17378.2,-4086.96C17433.46,-4077.32 17497.69,-4063.43 17554,-4044.31 17570.74,-4038.63 17588.23,-4030.77 17603.95,-4022.92"/>
<polygon fill="black" stroke="black" points="17605.66,-4025.98 17612.98,-4018.32 17602.48,-4019.74 17605.66,-4025.98"/>
</g>
<!-- expert62_l0_tp7 -->
<g id="node128" class="node">
<title>expert62_l0_tp7</title>
<polygon fill="lightcoral" stroke="black" points="17957,-4018.31 17769,-4018.31 17769,-3966.31 17957,-3966.31 17957,-4018.31"/>
<text text-anchor="middle" x="17863" y="-4006.31" font-family="Arial" font-size="10.00">Expert 62</text>
<text text-anchor="middle" x="17863" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17863" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17863" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l0_tp7&#45;&gt;expert62_l0_tp7 -->
<g id="edge218" class="edge">
<title>norm_l0_tp7&#45;&gt;expert62_l0_tp7</title>
<path fill="none" stroke="black" d="M17378.21,-4101.97C17483.69,-4096.38 17633.78,-4081.82 17760,-4044.31 17777.43,-4039.13 17795.5,-4031.18 17811.55,-4023.08"/>
<polygon fill="black" stroke="black" points="17813.47,-4026.03 17820.74,-4018.32 17810.25,-4019.81 17813.47,-4026.03"/>
</g>
<!-- expert63_l0_tp7 -->
<g id="node129" class="node">
<title>expert63_l0_tp7</title>
<polygon fill="lightcoral" stroke="black" points="18163,-4018.31 17975,-4018.31 17975,-3966.31 18163,-3966.31 18163,-4018.31"/>
<text text-anchor="middle" x="18069" y="-4006.31" font-family="Arial" font-size="10.00">Expert 63</text>
<text text-anchor="middle" x="18069" y="-3995.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18069" y="-3984.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18069" y="-3973.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l0_tp7&#45;&gt;expert63_l0_tp7 -->
<g id="edge220" class="edge">
<title>norm_l0_tp7&#45;&gt;expert63_l0_tp7</title>
<path fill="none" stroke="black" d="M17378.01,-4100.01C17555.24,-4091.91 17858.92,-4074.19 17966,-4044.31 17983.67,-4039.38 18001.94,-4031.41 18018.09,-4023.23"/>
<polygon fill="black" stroke="black" points="18020.09,-4026.13 18027.34,-4018.4 18016.85,-4019.92 18020.09,-4026.13"/>
</g>
<!-- res_add2_l0_tp7 -->
<g id="node152" class="node">
<title>res_add2_l0_tp7</title>
<polygon fill="lightgreen" stroke="black" points="17487,-3764.31 17209,-3764.31 17209,-3712.31 17487,-3712.31 17487,-3764.31"/>
<text text-anchor="middle" x="17348" y="-3752.31" font-family="Arial" font-size="10.00">Residual Add 2 TP7</text>
<text text-anchor="middle" x="17348" y="-3741.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="17348" y="-3730.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="17348" y="-3719.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l0_tp7&#45;&gt;res_add2_l0_tp7 -->
<g id="edge223" class="edge">
<title>norm_l0_tp7&#45;&gt;res_add2_l0_tp7</title>
<path fill="none" stroke="black" d="M17378.04,-4101.3C17628.03,-4093.12 18145.3,-4072.83 18172,-4044.31 18376.08,-3826.36 17786.34,-3763.39 17497.39,-3745.83"/>
<polygon fill="black" stroke="black" points="17497.43,-3742.32 17487.24,-3745.22 17497.02,-3749.31 17497.43,-3742.32"/>
</g>
<!-- expert_agg_l0_tp0 -->
<g id="node130" class="node">
<title>expert_agg_l0_tp0</title>
<polygon fill="lightpink" stroke="black" points="1217.55,-3904.31 779.21,-3904.31 666.45,-3800.31 1104.79,-3800.31 1217.55,-3904.31"/>
<text text-anchor="middle" x="942" y="-3866.31" font-family="Arial" font-size="10.00">Expert Aggregation TP0</text>
<text text-anchor="middle" x="942" y="-3855.31" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="942" y="-3844.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="942" y="-3833.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- expert0_l0_tp0&#45;&gt;expert_agg_l0_tp0 -->
<g id="edge11" class="edge">
<title>expert0_l0_tp0&#45;&gt;expert_agg_l0_tp0</title>
<path fill="none" stroke="black" d="M1516.58,-3966.29C1498.64,-3956.89 1477.31,-3946.9 1457,-3940.31 1375.77,-3913.97 1284.61,-3895.24 1201.83,-3882.08"/>
<polygon fill="black" stroke="black" points="1202.19,-3878.6 1191.77,-3880.5 1201.11,-3885.51 1202.19,-3878.6"/>
</g>
<!-- expert1_l0_tp0&#45;&gt;expert_agg_l0_tp0 -->
<g id="edge13" class="edge">
<title>expert1_l0_tp0&#45;&gt;expert_agg_l0_tp0</title>
<path fill="none" stroke="black" d="M160.77,-3966.06C178.79,-3956.51 200.35,-3946.47 221,-3940.31 384.12,-3891.65 575.72,-3870.12 720.39,-3860.63"/>
<polygon fill="black" stroke="black" points="720.97,-3864.1 730.72,-3859.97 720.52,-3857.12 720.97,-3864.1"/>
</g>
<!-- expert2_l0_tp0&#45;&gt;expert_agg_l0_tp0 -->
<g id="edge15" class="edge">
<title>expert2_l0_tp0&#45;&gt;expert_agg_l0_tp0</title>
<path fill="none" stroke="black" d="M367.42,-3966.29C385.36,-3956.89 406.69,-3946.9 427,-3940.31 525.93,-3908.24 639.58,-3887.44 734.91,-3874.25"/>
<polygon fill="black" stroke="black" points="735.53,-3877.7 744.96,-3872.88 734.58,-3870.76 735.53,-3877.7"/>
</g>
<!-- expert3_l0_tp0&#45;&gt;expert_agg_l0_tp0 -->
<g id="edge17" class="edge">
<title>expert3_l0_tp0&#45;&gt;expert_agg_l0_tp0</title>
<path fill="none" stroke="black" d="M576.1,-3966.21C593.59,-3957.29 613.91,-3947.65 633,-3940.31 673.42,-3924.77 717.76,-3910.65 759.93,-3898.52"/>
<polygon fill="black" stroke="black" points="761.09,-3901.83 769.74,-3895.72 759.17,-3895.1 761.09,-3901.83"/>
</g>
<!-- expert4_l0_tp0&#45;&gt;expert_agg_l0_tp0 -->
<g id="edge19" class="edge">
<title>expert4_l0_tp0&#45;&gt;expert_agg_l0_tp0</title>
<path fill="none" stroke="black" d="M773.78,-3966C797.15,-3950.35 828.12,-3929.6 857.11,-3910.18"/>
<polygon fill="black" stroke="black" points="859.27,-3912.95 865.63,-3904.48 855.37,-3907.13 859.27,-3912.95"/>
</g>
<!-- expert5_l0_tp0&#45;&gt;expert_agg_l0_tp0 -->
<g id="edge21" class="edge">
<title>expert5_l0_tp0&#45;&gt;expert_agg_l0_tp0</title>
<path fill="none" stroke="black" d="M942,-3966C942,-3951.56 942,-3932.78 942,-3914.7"/>
<polygon fill="black" stroke="black" points="945.5,-3914.48 942,-3904.48 938.5,-3914.48 945.5,-3914.48"/>
</g>
<!-- expert6_l0_tp0&#45;&gt;expert_agg_l0_tp0 -->
<g id="edge23" class="edge">
<title>expert6_l0_tp0&#45;&gt;expert_agg_l0_tp0</title>
<path fill="none" stroke="black" d="M1110.22,-3966C1086.85,-3950.35 1055.88,-3929.6 1026.89,-3910.18"/>
<polygon fill="black" stroke="black" points="1028.63,-3907.13 1018.37,-3904.48 1024.73,-3912.95 1028.63,-3907.13"/>
</g>
<!-- expert7_l0_tp0&#45;&gt;expert_agg_l0_tp0 -->
<g id="edge25" class="edge">
<title>expert7_l0_tp0&#45;&gt;expert_agg_l0_tp0</title>
<path fill="none" stroke="black" d="M1307.9,-3966.21C1290.41,-3957.29 1270.09,-3947.65 1251,-3940.31 1219.99,-3928.39 1186.66,-3917.3 1153.79,-3907.3"/>
<polygon fill="black" stroke="black" points="1154.65,-3903.91 1144.06,-3904.38 1152.63,-3910.61 1154.65,-3903.91"/>
</g>
<!-- expert_agg_l0_tp1 -->
<g id="node133" class="node">
<title>expert_agg_l0_tp1</title>
<polygon fill="lightpink" stroke="black" points="3489.55,-3904.31 3051.21,-3904.31 2938.45,-3800.31 3376.79,-3800.31 3489.55,-3904.31"/>
<text text-anchor="middle" x="3214" y="-3866.31" font-family="Arial" font-size="10.00">Expert Aggregation TP1</text>
<text text-anchor="middle" x="3214" y="-3855.31" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="3214" y="-3844.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3214" y="-3833.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- expert8_l0_tp1&#45;&gt;expert_agg_l0_tp1 -->
<g id="edge39" class="edge">
<title>expert8_l0_tp1&#45;&gt;expert_agg_l0_tp1</title>
<path fill="none" stroke="black" d="M3579.9,-3966.21C3562.41,-3957.29 3542.09,-3947.65 3523,-3940.31 3491.99,-3928.39 3458.66,-3917.3 3425.79,-3907.3"/>
<polygon fill="black" stroke="black" points="3426.65,-3903.91 3416.06,-3904.38 3424.63,-3910.61 3426.65,-3903.91"/>
</g>
<!-- expert9_l0_tp1&#45;&gt;expert_agg_l0_tp1 -->
<g id="edge41" class="edge">
<title>expert9_l0_tp1&#45;&gt;expert_agg_l0_tp1</title>
<path fill="none" stroke="black" d="M3788.58,-3966.29C3770.64,-3956.89 3749.31,-3946.9 3729,-3940.31 3647.77,-3913.97 3556.61,-3895.24 3473.83,-3882.08"/>
<polygon fill="black" stroke="black" points="3474.19,-3878.6 3463.77,-3880.5 3473.11,-3885.51 3474.19,-3878.6"/>
</g>
<!-- expert10_l0_tp1&#45;&gt;expert_agg_l0_tp1 -->
<g id="edge43" class="edge">
<title>expert10_l0_tp1&#45;&gt;expert_agg_l0_tp1</title>
<path fill="none" stroke="black" d="M2432.77,-3966.06C2450.79,-3956.51 2472.35,-3946.47 2493,-3940.31 2656.12,-3891.65 2847.72,-3870.12 2992.39,-3860.63"/>
<polygon fill="black" stroke="black" points="2992.97,-3864.1 3002.72,-3859.97 2992.52,-3857.12 2992.97,-3864.1"/>
</g>
<!-- expert11_l0_tp1&#45;&gt;expert_agg_l0_tp1 -->
<g id="edge45" class="edge">
<title>expert11_l0_tp1&#45;&gt;expert_agg_l0_tp1</title>
<path fill="none" stroke="black" d="M2639.42,-3966.29C2657.36,-3956.89 2678.69,-3946.9 2699,-3940.31 2797.93,-3908.24 2911.58,-3887.44 3006.91,-3874.25"/>
<polygon fill="black" stroke="black" points="3007.53,-3877.7 3016.96,-3872.88 3006.58,-3870.76 3007.53,-3877.7"/>
</g>
<!-- expert12_l0_tp1&#45;&gt;expert_agg_l0_tp1 -->
<g id="edge47" class="edge">
<title>expert12_l0_tp1&#45;&gt;expert_agg_l0_tp1</title>
<path fill="none" stroke="black" d="M2848.1,-3966.21C2865.59,-3957.29 2885.91,-3947.65 2905,-3940.31 2945.42,-3924.77 2989.76,-3910.65 3031.93,-3898.52"/>
<polygon fill="black" stroke="black" points="3033.09,-3901.83 3041.74,-3895.72 3031.17,-3895.1 3033.09,-3901.83"/>
</g>
<!-- expert13_l0_tp1&#45;&gt;expert_agg_l0_tp1 -->
<g id="edge49" class="edge">
<title>expert13_l0_tp1&#45;&gt;expert_agg_l0_tp1</title>
<path fill="none" stroke="black" d="M3045.78,-3966C3069.15,-3950.35 3100.12,-3929.6 3129.11,-3910.18"/>
<polygon fill="black" stroke="black" points="3131.27,-3912.95 3137.63,-3904.48 3127.37,-3907.13 3131.27,-3912.95"/>
</g>
<!-- expert14_l0_tp1&#45;&gt;expert_agg_l0_tp1 -->
<g id="edge51" class="edge">
<title>expert14_l0_tp1&#45;&gt;expert_agg_l0_tp1</title>
<path fill="none" stroke="black" d="M3214,-3966C3214,-3951.56 3214,-3932.78 3214,-3914.7"/>
<polygon fill="black" stroke="black" points="3217.5,-3914.48 3214,-3904.48 3210.5,-3914.48 3217.5,-3914.48"/>
</g>
<!-- expert15_l0_tp1&#45;&gt;expert_agg_l0_tp1 -->
<g id="edge53" class="edge">
<title>expert15_l0_tp1&#45;&gt;expert_agg_l0_tp1</title>
<path fill="none" stroke="black" d="M3382.22,-3966C3358.85,-3950.35 3327.88,-3929.6 3298.89,-3910.18"/>
<polygon fill="black" stroke="black" points="3300.63,-3907.13 3290.37,-3904.48 3296.73,-3912.95 3300.63,-3907.13"/>
</g>
<!-- expert_agg_l0_tp2 -->
<g id="node136" class="node">
<title>expert_agg_l0_tp2</title>
<polygon fill="lightpink" stroke="black" points="5761.55,-3904.31 5323.21,-3904.31 5210.45,-3800.31 5648.79,-3800.31 5761.55,-3904.31"/>
<text text-anchor="middle" x="5486" y="-3866.31" font-family="Arial" font-size="10.00">Expert Aggregation TP2</text>
<text text-anchor="middle" x="5486" y="-3855.31" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="5486" y="-3844.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5486" y="-3833.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- expert16_l0_tp2&#45;&gt;expert_agg_l0_tp2 -->
<g id="edge67" class="edge">
<title>expert16_l0_tp2&#45;&gt;expert_agg_l0_tp2</title>
<path fill="none" stroke="black" d="M5654.22,-3966C5630.85,-3950.35 5599.88,-3929.6 5570.89,-3910.18"/>
<polygon fill="black" stroke="black" points="5572.63,-3907.13 5562.37,-3904.48 5568.73,-3912.95 5572.63,-3907.13"/>
</g>
<!-- expert17_l0_tp2&#45;&gt;expert_agg_l0_tp2 -->
<g id="edge69" class="edge">
<title>expert17_l0_tp2&#45;&gt;expert_agg_l0_tp2</title>
<path fill="none" stroke="black" d="M5851.9,-3966.21C5834.41,-3957.29 5814.09,-3947.65 5795,-3940.31 5763.99,-3928.39 5730.66,-3917.3 5697.79,-3907.3"/>
<polygon fill="black" stroke="black" points="5698.65,-3903.91 5688.06,-3904.38 5696.63,-3910.61 5698.65,-3903.91"/>
</g>
<!-- expert18_l0_tp2&#45;&gt;expert_agg_l0_tp2 -->
<g id="edge71" class="edge">
<title>expert18_l0_tp2&#45;&gt;expert_agg_l0_tp2</title>
<path fill="none" stroke="black" d="M6060.58,-3966.29C6042.64,-3956.89 6021.31,-3946.9 6001,-3940.31 5919.77,-3913.97 5828.61,-3895.24 5745.83,-3882.08"/>
<polygon fill="black" stroke="black" points="5746.19,-3878.6 5735.77,-3880.5 5745.11,-3885.51 5746.19,-3878.6"/>
</g>
<!-- expert19_l0_tp2&#45;&gt;expert_agg_l0_tp2 -->
<g id="edge73" class="edge">
<title>expert19_l0_tp2&#45;&gt;expert_agg_l0_tp2</title>
<path fill="none" stroke="black" d="M4704.77,-3966.06C4722.79,-3956.51 4744.35,-3946.47 4765,-3940.31 4928.12,-3891.65 5119.72,-3870.12 5264.39,-3860.63"/>
<polygon fill="black" stroke="black" points="5264.97,-3864.1 5274.72,-3859.97 5264.52,-3857.12 5264.97,-3864.1"/>
</g>
<!-- expert20_l0_tp2&#45;&gt;expert_agg_l0_tp2 -->
<g id="edge75" class="edge">
<title>expert20_l0_tp2&#45;&gt;expert_agg_l0_tp2</title>
<path fill="none" stroke="black" d="M4911.42,-3966.29C4929.36,-3956.89 4950.69,-3946.9 4971,-3940.31 5069.93,-3908.24 5183.58,-3887.44 5278.91,-3874.25"/>
<polygon fill="black" stroke="black" points="5279.53,-3877.7 5288.96,-3872.88 5278.58,-3870.76 5279.53,-3877.7"/>
</g>
<!-- expert21_l0_tp2&#45;&gt;expert_agg_l0_tp2 -->
<g id="edge77" class="edge">
<title>expert21_l0_tp2&#45;&gt;expert_agg_l0_tp2</title>
<path fill="none" stroke="black" d="M5120.1,-3966.21C5137.59,-3957.29 5157.91,-3947.65 5177,-3940.31 5217.42,-3924.77 5261.76,-3910.65 5303.93,-3898.52"/>
<polygon fill="black" stroke="black" points="5305.09,-3901.83 5313.74,-3895.72 5303.17,-3895.1 5305.09,-3901.83"/>
</g>
<!-- expert22_l0_tp2&#45;&gt;expert_agg_l0_tp2 -->
<g id="edge79" class="edge">
<title>expert22_l0_tp2&#45;&gt;expert_agg_l0_tp2</title>
<path fill="none" stroke="black" d="M5317.78,-3966C5341.15,-3950.35 5372.12,-3929.6 5401.11,-3910.18"/>
<polygon fill="black" stroke="black" points="5403.27,-3912.95 5409.63,-3904.48 5399.37,-3907.13 5403.27,-3912.95"/>
</g>
<!-- expert23_l0_tp2&#45;&gt;expert_agg_l0_tp2 -->
<g id="edge81" class="edge">
<title>expert23_l0_tp2&#45;&gt;expert_agg_l0_tp2</title>
<path fill="none" stroke="black" d="M5486,-3966C5486,-3951.56 5486,-3932.78 5486,-3914.7"/>
<polygon fill="black" stroke="black" points="5489.5,-3914.48 5486,-3904.48 5482.5,-3914.48 5489.5,-3914.48"/>
</g>
<!-- expert_agg_l0_tp3 -->
<g id="node139" class="node">
<title>expert_agg_l0_tp3</title>
<polygon fill="lightpink" stroke="black" points="8033.55,-3904.31 7595.21,-3904.31 7482.45,-3800.31 7920.79,-3800.31 8033.55,-3904.31"/>
<text text-anchor="middle" x="7758" y="-3866.31" font-family="Arial" font-size="10.00">Expert Aggregation TP3</text>
<text text-anchor="middle" x="7758" y="-3855.31" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="7758" y="-3844.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7758" y="-3833.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- expert24_l0_tp3&#45;&gt;expert_agg_l0_tp3 -->
<g id="edge95" class="edge">
<title>expert24_l0_tp3&#45;&gt;expert_agg_l0_tp3</title>
<path fill="none" stroke="black" d="M7758,-3966C7758,-3951.56 7758,-3932.78 7758,-3914.7"/>
<polygon fill="black" stroke="black" points="7761.5,-3914.48 7758,-3904.48 7754.5,-3914.48 7761.5,-3914.48"/>
</g>
<!-- expert25_l0_tp3&#45;&gt;expert_agg_l0_tp3 -->
<g id="edge97" class="edge">
<title>expert25_l0_tp3&#45;&gt;expert_agg_l0_tp3</title>
<path fill="none" stroke="black" d="M7926.22,-3966C7902.85,-3950.35 7871.88,-3929.6 7842.89,-3910.18"/>
<polygon fill="black" stroke="black" points="7844.63,-3907.13 7834.37,-3904.48 7840.73,-3912.95 7844.63,-3907.13"/>
</g>
<!-- expert26_l0_tp3&#45;&gt;expert_agg_l0_tp3 -->
<g id="edge99" class="edge">
<title>expert26_l0_tp3&#45;&gt;expert_agg_l0_tp3</title>
<path fill="none" stroke="black" d="M8123.9,-3966.21C8106.41,-3957.29 8086.09,-3947.65 8067,-3940.31 8035.99,-3928.39 8002.66,-3917.3 7969.79,-3907.3"/>
<polygon fill="black" stroke="black" points="7970.65,-3903.91 7960.06,-3904.38 7968.63,-3910.61 7970.65,-3903.91"/>
</g>
<!-- expert27_l0_tp3&#45;&gt;expert_agg_l0_tp3 -->
<g id="edge101" class="edge">
<title>expert27_l0_tp3&#45;&gt;expert_agg_l0_tp3</title>
<path fill="none" stroke="black" d="M8332.58,-3966.29C8314.64,-3956.89 8293.31,-3946.9 8273,-3940.31 8191.77,-3913.97 8100.61,-3895.24 8017.83,-3882.08"/>
<polygon fill="black" stroke="black" points="8018.19,-3878.6 8007.77,-3880.5 8017.11,-3885.51 8018.19,-3878.6"/>
</g>
<!-- expert28_l0_tp3&#45;&gt;expert_agg_l0_tp3 -->
<g id="edge103" class="edge">
<title>expert28_l0_tp3&#45;&gt;expert_agg_l0_tp3</title>
<path fill="none" stroke="black" d="M6976.77,-3966.06C6994.79,-3956.51 7016.35,-3946.47 7037,-3940.31 7200.12,-3891.65 7391.72,-3870.12 7536.39,-3860.63"/>
<polygon fill="black" stroke="black" points="7536.97,-3864.1 7546.72,-3859.97 7536.52,-3857.12 7536.97,-3864.1"/>
</g>
<!-- expert29_l0_tp3&#45;&gt;expert_agg_l0_tp3 -->
<g id="edge105" class="edge">
<title>expert29_l0_tp3&#45;&gt;expert_agg_l0_tp3</title>
<path fill="none" stroke="black" d="M7183.42,-3966.29C7201.36,-3956.89 7222.69,-3946.9 7243,-3940.31 7341.93,-3908.24 7455.58,-3887.44 7550.91,-3874.25"/>
<polygon fill="black" stroke="black" points="7551.53,-3877.7 7560.96,-3872.88 7550.58,-3870.76 7551.53,-3877.7"/>
</g>
<!-- expert30_l0_tp3&#45;&gt;expert_agg_l0_tp3 -->
<g id="edge107" class="edge">
<title>expert30_l0_tp3&#45;&gt;expert_agg_l0_tp3</title>
<path fill="none" stroke="black" d="M7392.1,-3966.21C7409.59,-3957.29 7429.91,-3947.65 7449,-3940.31 7489.42,-3924.77 7533.76,-3910.65 7575.93,-3898.52"/>
<polygon fill="black" stroke="black" points="7577.09,-3901.83 7585.74,-3895.72 7575.17,-3895.1 7577.09,-3901.83"/>
</g>
<!-- expert31_l0_tp3&#45;&gt;expert_agg_l0_tp3 -->
<g id="edge109" class="edge">
<title>expert31_l0_tp3&#45;&gt;expert_agg_l0_tp3</title>
<path fill="none" stroke="black" d="M7589.78,-3966C7613.15,-3950.35 7644.12,-3929.6 7673.11,-3910.18"/>
<polygon fill="black" stroke="black" points="7675.27,-3912.95 7681.63,-3904.48 7671.37,-3907.13 7675.27,-3912.95"/>
</g>
<!-- expert_agg_l0_tp4 -->
<g id="node142" class="node">
<title>expert_agg_l0_tp4</title>
<polygon fill="lightpink" stroke="black" points="10807.55,-3904.31 10369.21,-3904.31 10256.45,-3800.31 10694.79,-3800.31 10807.55,-3904.31"/>
<text text-anchor="middle" x="10532" y="-3866.31" font-family="Arial" font-size="10.00">Expert Aggregation TP4</text>
<text text-anchor="middle" x="10532" y="-3855.31" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="10532" y="-3844.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10532" y="-3833.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- expert32_l0_tp4&#45;&gt;expert_agg_l0_tp4 -->
<g id="edge123" class="edge">
<title>expert32_l0_tp4&#45;&gt;expert_agg_l0_tp4</title>
<path fill="none" stroke="black" d="M10447.89,-3966C10459.07,-3951.02 10473.74,-3931.38 10487.68,-3912.69"/>
<polygon fill="black" stroke="black" points="10490.64,-3914.58 10493.81,-3904.48 10485.03,-3910.4 10490.64,-3914.58"/>
</g>
<!-- expert33_l0_tp4&#45;&gt;expert_agg_l0_tp4 -->
<g id="edge125" class="edge">
<title>expert33_l0_tp4&#45;&gt;expert_agg_l0_tp4</title>
<path fill="none" stroke="black" d="M10616.11,-3966C10604.93,-3951.02 10590.26,-3931.38 10576.32,-3912.69"/>
<polygon fill="black" stroke="black" points="10578.97,-3910.4 10570.19,-3904.48 10573.36,-3914.58 10578.97,-3910.4"/>
</g>
<!-- expert34_l0_tp4&#45;&gt;expert_agg_l0_tp4 -->
<g id="edge127" class="edge">
<title>expert34_l0_tp4&#45;&gt;expert_agg_l0_tp4</title>
<path fill="none" stroke="black" d="M10791.78,-3966.19C10774.84,-3957.75 10755.69,-3948.42 10738,-3940.31 10714.68,-3929.63 10689.69,-3918.67 10665.42,-3908.28"/>
<polygon fill="black" stroke="black" points="10666.74,-3905.03 10656.17,-3904.33 10663.99,-3911.47 10666.74,-3905.03"/>
</g>
<!-- expert35_l0_tp4&#45;&gt;expert_agg_l0_tp4 -->
<g id="edge129" class="edge">
<title>expert35_l0_tp4&#45;&gt;expert_agg_l0_tp4</title>
<path fill="none" stroke="black" d="M11002.68,-3966.31C10984.88,-3957.09 10963.89,-3947.21 10944,-3940.31 10902.34,-3925.86 10857.43,-3913.39 10813.13,-3902.76"/>
<polygon fill="black" stroke="black" points="10813.92,-3899.35 10803.38,-3900.45 10812.31,-3906.17 10813.92,-3899.35"/>
</g>
<!-- expert36_l0_tp4&#45;&gt;expert_agg_l0_tp4 -->
<g id="edge131" class="edge">
<title>expert36_l0_tp4&#45;&gt;expert_agg_l0_tp4</title>
<path fill="none" stroke="black" d="M11210.17,-3966.27C11192.14,-3956.75 11170.59,-3946.68 11150,-3940.31 11030.81,-3903.47 10893.81,-3882.17 10779.14,-3869.88"/>
<polygon fill="black" stroke="black" points="10779.49,-3866.4 10769.17,-3868.83 10778.75,-3873.36 10779.49,-3866.4"/>
</g>
<!-- expert37_l0_tp4&#45;&gt;expert_agg_l0_tp4 -->
<g id="edge133" class="edge">
<title>expert37_l0_tp4&#45;&gt;expert_agg_l0_tp4</title>
<path fill="none" stroke="black" d="M9853.83,-3966.27C9871.86,-3956.75 9893.41,-3946.68 9914,-3940.31 10044.51,-3899.97 10196.37,-3878.26 10316.89,-3866.62"/>
<polygon fill="black" stroke="black" points="10317.36,-3870.09 10326.98,-3865.66 10316.7,-3863.12 10317.36,-3870.09"/>
</g>
<!-- expert38_l0_tp4&#45;&gt;expert_agg_l0_tp4 -->
<g id="edge135" class="edge">
<title>expert38_l0_tp4&#45;&gt;expert_agg_l0_tp4</title>
<path fill="none" stroke="black" d="M10061.32,-3966.31C10079.12,-3957.09 10100.11,-3947.21 10120,-3940.31 10188.63,-3916.5 10266.05,-3898.07 10335.1,-3884.43"/>
<polygon fill="black" stroke="black" points="10336.08,-3887.8 10345.22,-3882.45 10334.74,-3880.93 10336.08,-3887.8"/>
</g>
<!-- expert39_l0_tp4&#45;&gt;expert_agg_l0_tp4 -->
<g id="edge137" class="edge">
<title>expert39_l0_tp4&#45;&gt;expert_agg_l0_tp4</title>
<path fill="none" stroke="black" d="M10272.22,-3966.19C10289.16,-3957.75 10308.31,-3948.42 10326,-3940.31 10349.32,-3929.63 10374.31,-3918.67 10398.58,-3908.28"/>
<polygon fill="black" stroke="black" points="10400.01,-3911.47 10407.83,-3904.33 10397.26,-3905.03 10400.01,-3911.47"/>
</g>
<!-- expert_agg_l0_tp5 -->
<g id="node145" class="node">
<title>expert_agg_l0_tp5</title>
<polygon fill="lightpink" stroke="black" points="13079.55,-3904.31 12641.21,-3904.31 12528.45,-3800.31 12966.79,-3800.31 13079.55,-3904.31"/>
<text text-anchor="middle" x="12804" y="-3866.31" font-family="Arial" font-size="10.00">Expert Aggregation TP5</text>
<text text-anchor="middle" x="12804" y="-3855.31" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="12804" y="-3844.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12804" y="-3833.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- expert40_l0_tp5&#45;&gt;expert_agg_l0_tp5 -->
<g id="edge151" class="edge">
<title>expert40_l0_tp5&#45;&gt;expert_agg_l0_tp5</title>
<path fill="none" stroke="black" d="M12544.22,-3966.19C12561.16,-3957.75 12580.31,-3948.42 12598,-3940.31 12621.32,-3929.63 12646.31,-3918.67 12670.58,-3908.28"/>
<polygon fill="black" stroke="black" points="12672.01,-3911.47 12679.83,-3904.33 12669.26,-3905.03 12672.01,-3911.47"/>
</g>
<!-- expert41_l0_tp5&#45;&gt;expert_agg_l0_tp5 -->
<g id="edge153" class="edge">
<title>expert41_l0_tp5&#45;&gt;expert_agg_l0_tp5</title>
<path fill="none" stroke="black" d="M12719.89,-3966C12731.07,-3951.02 12745.74,-3931.38 12759.68,-3912.69"/>
<polygon fill="black" stroke="black" points="12762.64,-3914.58 12765.81,-3904.48 12757.03,-3910.4 12762.64,-3914.58"/>
</g>
<!-- expert42_l0_tp5&#45;&gt;expert_agg_l0_tp5 -->
<g id="edge155" class="edge">
<title>expert42_l0_tp5&#45;&gt;expert_agg_l0_tp5</title>
<path fill="none" stroke="black" d="M12888.11,-3966C12876.93,-3951.02 12862.26,-3931.38 12848.32,-3912.69"/>
<polygon fill="black" stroke="black" points="12850.97,-3910.4 12842.19,-3904.48 12845.36,-3914.58 12850.97,-3910.4"/>
</g>
<!-- expert43_l0_tp5&#45;&gt;expert_agg_l0_tp5 -->
<g id="edge157" class="edge">
<title>expert43_l0_tp5&#45;&gt;expert_agg_l0_tp5</title>
<path fill="none" stroke="black" d="M13063.78,-3966.19C13046.84,-3957.75 13027.69,-3948.42 13010,-3940.31 12986.68,-3929.63 12961.69,-3918.67 12937.42,-3908.28"/>
<polygon fill="black" stroke="black" points="12938.74,-3905.03 12928.17,-3904.33 12935.99,-3911.47 12938.74,-3905.03"/>
</g>
<!-- expert44_l0_tp5&#45;&gt;expert_agg_l0_tp5 -->
<g id="edge159" class="edge">
<title>expert44_l0_tp5&#45;&gt;expert_agg_l0_tp5</title>
<path fill="none" stroke="black" d="M13274.68,-3966.31C13256.88,-3957.09 13235.89,-3947.21 13216,-3940.31 13174.34,-3925.86 13129.43,-3913.39 13085.13,-3902.76"/>
<polygon fill="black" stroke="black" points="13085.92,-3899.35 13075.38,-3900.45 13084.31,-3906.17 13085.92,-3899.35"/>
</g>
<!-- expert45_l0_tp5&#45;&gt;expert_agg_l0_tp5 -->
<g id="edge161" class="edge">
<title>expert45_l0_tp5&#45;&gt;expert_agg_l0_tp5</title>
<path fill="none" stroke="black" d="M13482.17,-3966.27C13464.14,-3956.75 13442.59,-3946.68 13422,-3940.31 13302.81,-3903.47 13165.81,-3882.17 13051.14,-3869.88"/>
<polygon fill="black" stroke="black" points="13051.49,-3866.4 13041.17,-3868.83 13050.75,-3873.36 13051.49,-3866.4"/>
</g>
<!-- expert46_l0_tp5&#45;&gt;expert_agg_l0_tp5 -->
<g id="edge163" class="edge">
<title>expert46_l0_tp5&#45;&gt;expert_agg_l0_tp5</title>
<path fill="none" stroke="black" d="M12125.83,-3966.27C12143.86,-3956.75 12165.41,-3946.68 12186,-3940.31 12316.51,-3899.97 12468.37,-3878.26 12588.89,-3866.62"/>
<polygon fill="black" stroke="black" points="12589.36,-3870.09 12598.98,-3865.66 12588.7,-3863.12 12589.36,-3870.09"/>
</g>
<!-- expert47_l0_tp5&#45;&gt;expert_agg_l0_tp5 -->
<g id="edge165" class="edge">
<title>expert47_l0_tp5&#45;&gt;expert_agg_l0_tp5</title>
<path fill="none" stroke="black" d="M12333.32,-3966.31C12351.12,-3957.09 12372.11,-3947.21 12392,-3940.31 12460.63,-3916.5 12538.05,-3898.07 12607.1,-3884.43"/>
<polygon fill="black" stroke="black" points="12608.08,-3887.8 12617.22,-3882.45 12606.74,-3880.93 12608.08,-3887.8"/>
</g>
<!-- expert_agg_l0_tp6 -->
<g id="node148" class="node">
<title>expert_agg_l0_tp6</title>
<polygon fill="lightpink" stroke="black" points="15351.55,-3904.31 14913.21,-3904.31 14800.45,-3800.31 15238.79,-3800.31 15351.55,-3904.31"/>
<text text-anchor="middle" x="15076" y="-3866.31" font-family="Arial" font-size="10.00">Expert Aggregation TP6</text>
<text text-anchor="middle" x="15076" y="-3855.31" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="15076" y="-3844.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15076" y="-3833.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- expert48_l0_tp6&#45;&gt;expert_agg_l0_tp6 -->
<g id="edge179" class="edge">
<title>expert48_l0_tp6&#45;&gt;expert_agg_l0_tp6</title>
<path fill="none" stroke="black" d="M14605.32,-3966.31C14623.12,-3957.09 14644.11,-3947.21 14664,-3940.31 14732.63,-3916.5 14810.05,-3898.07 14879.1,-3884.43"/>
<polygon fill="black" stroke="black" points="14880.08,-3887.8 14889.22,-3882.45 14878.74,-3880.93 14880.08,-3887.8"/>
</g>
<!-- expert49_l0_tp6&#45;&gt;expert_agg_l0_tp6 -->
<g id="edge181" class="edge">
<title>expert49_l0_tp6&#45;&gt;expert_agg_l0_tp6</title>
<path fill="none" stroke="black" d="M14816.22,-3966.19C14833.16,-3957.75 14852.31,-3948.42 14870,-3940.31 14893.32,-3929.63 14918.31,-3918.67 14942.58,-3908.28"/>
<polygon fill="black" stroke="black" points="14944.01,-3911.47 14951.83,-3904.33 14941.26,-3905.03 14944.01,-3911.47"/>
</g>
<!-- expert50_l0_tp6&#45;&gt;expert_agg_l0_tp6 -->
<g id="edge183" class="edge">
<title>expert50_l0_tp6&#45;&gt;expert_agg_l0_tp6</title>
<path fill="none" stroke="black" d="M14991.89,-3966C15003.07,-3951.02 15017.74,-3931.38 15031.68,-3912.69"/>
<polygon fill="black" stroke="black" points="15034.64,-3914.58 15037.81,-3904.48 15029.03,-3910.4 15034.64,-3914.58"/>
</g>
<!-- expert51_l0_tp6&#45;&gt;expert_agg_l0_tp6 -->
<g id="edge185" class="edge">
<title>expert51_l0_tp6&#45;&gt;expert_agg_l0_tp6</title>
<path fill="none" stroke="black" d="M15160.11,-3966C15148.93,-3951.02 15134.26,-3931.38 15120.32,-3912.69"/>
<polygon fill="black" stroke="black" points="15122.97,-3910.4 15114.19,-3904.48 15117.36,-3914.58 15122.97,-3910.4"/>
</g>
<!-- expert52_l0_tp6&#45;&gt;expert_agg_l0_tp6 -->
<g id="edge187" class="edge">
<title>expert52_l0_tp6&#45;&gt;expert_agg_l0_tp6</title>
<path fill="none" stroke="black" d="M15335.78,-3966.19C15318.84,-3957.75 15299.69,-3948.42 15282,-3940.31 15258.68,-3929.63 15233.69,-3918.67 15209.42,-3908.28"/>
<polygon fill="black" stroke="black" points="15210.74,-3905.03 15200.17,-3904.33 15207.99,-3911.47 15210.74,-3905.03"/>
</g>
<!-- expert53_l0_tp6&#45;&gt;expert_agg_l0_tp6 -->
<g id="edge189" class="edge">
<title>expert53_l0_tp6&#45;&gt;expert_agg_l0_tp6</title>
<path fill="none" stroke="black" d="M15546.68,-3966.31C15528.88,-3957.09 15507.89,-3947.21 15488,-3940.31 15446.34,-3925.86 15401.43,-3913.39 15357.13,-3902.76"/>
<polygon fill="black" stroke="black" points="15357.92,-3899.35 15347.38,-3900.45 15356.31,-3906.17 15357.92,-3899.35"/>
</g>
<!-- expert54_l0_tp6&#45;&gt;expert_agg_l0_tp6 -->
<g id="edge191" class="edge">
<title>expert54_l0_tp6&#45;&gt;expert_agg_l0_tp6</title>
<path fill="none" stroke="black" d="M15754.17,-3966.27C15736.14,-3956.75 15714.59,-3946.68 15694,-3940.31 15574.81,-3903.47 15437.81,-3882.17 15323.14,-3869.88"/>
<polygon fill="black" stroke="black" points="15323.49,-3866.4 15313.17,-3868.83 15322.75,-3873.36 15323.49,-3866.4"/>
</g>
<!-- expert55_l0_tp6&#45;&gt;expert_agg_l0_tp6 -->
<g id="edge193" class="edge">
<title>expert55_l0_tp6&#45;&gt;expert_agg_l0_tp6</title>
<path fill="none" stroke="black" d="M14397.83,-3966.27C14415.86,-3956.75 14437.41,-3946.68 14458,-3940.31 14588.51,-3899.97 14740.37,-3878.26 14860.89,-3866.62"/>
<polygon fill="black" stroke="black" points="14861.36,-3870.09 14870.98,-3865.66 14860.7,-3863.12 14861.36,-3870.09"/>
</g>
<!-- expert_agg_l0_tp7 -->
<g id="node151" class="node">
<title>expert_agg_l0_tp7</title>
<polygon fill="lightpink" stroke="black" points="17623.55,-3904.31 17185.21,-3904.31 17072.45,-3800.31 17510.79,-3800.31 17623.55,-3904.31"/>
<text text-anchor="middle" x="17348" y="-3866.31" font-family="Arial" font-size="10.00">Expert Aggregation TP7</text>
<text text-anchor="middle" x="17348" y="-3855.31" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="17348" y="-3844.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="17348" y="-3833.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- expert56_l0_tp7&#45;&gt;expert_agg_l0_tp7 -->
<g id="edge207" class="edge">
<title>expert56_l0_tp7&#45;&gt;expert_agg_l0_tp7</title>
<path fill="none" stroke="black" d="M16669.83,-3966.27C16687.86,-3956.75 16709.41,-3946.68 16730,-3940.31 16860.51,-3899.97 17012.37,-3878.26 17132.89,-3866.62"/>
<polygon fill="black" stroke="black" points="17133.36,-3870.09 17142.98,-3865.66 17132.7,-3863.12 17133.36,-3870.09"/>
</g>
<!-- expert57_l0_tp7&#45;&gt;expert_agg_l0_tp7 -->
<g id="edge209" class="edge">
<title>expert57_l0_tp7&#45;&gt;expert_agg_l0_tp7</title>
<path fill="none" stroke="black" d="M16877.32,-3966.31C16895.12,-3957.09 16916.11,-3947.21 16936,-3940.31 17004.63,-3916.5 17082.05,-3898.07 17151.1,-3884.43"/>
<polygon fill="black" stroke="black" points="17152.08,-3887.8 17161.22,-3882.45 17150.74,-3880.93 17152.08,-3887.8"/>
</g>
<!-- expert58_l0_tp7&#45;&gt;expert_agg_l0_tp7 -->
<g id="edge211" class="edge">
<title>expert58_l0_tp7&#45;&gt;expert_agg_l0_tp7</title>
<path fill="none" stroke="black" d="M17088.22,-3966.19C17105.16,-3957.75 17124.31,-3948.42 17142,-3940.31 17165.32,-3929.63 17190.31,-3918.67 17214.58,-3908.28"/>
<polygon fill="black" stroke="black" points="17216.01,-3911.47 17223.83,-3904.33 17213.26,-3905.03 17216.01,-3911.47"/>
</g>
<!-- expert59_l0_tp7&#45;&gt;expert_agg_l0_tp7 -->
<g id="edge213" class="edge">
<title>expert59_l0_tp7&#45;&gt;expert_agg_l0_tp7</title>
<path fill="none" stroke="black" d="M17263.89,-3966C17275.07,-3951.02 17289.74,-3931.38 17303.68,-3912.69"/>
<polygon fill="black" stroke="black" points="17306.64,-3914.58 17309.81,-3904.48 17301.03,-3910.4 17306.64,-3914.58"/>
</g>
<!-- expert60_l0_tp7&#45;&gt;expert_agg_l0_tp7 -->
<g id="edge215" class="edge">
<title>expert60_l0_tp7&#45;&gt;expert_agg_l0_tp7</title>
<path fill="none" stroke="black" d="M17432.11,-3966C17420.93,-3951.02 17406.26,-3931.38 17392.32,-3912.69"/>
<polygon fill="black" stroke="black" points="17394.97,-3910.4 17386.19,-3904.48 17389.36,-3914.58 17394.97,-3910.4"/>
</g>
<!-- expert61_l0_tp7&#45;&gt;expert_agg_l0_tp7 -->
<g id="edge217" class="edge">
<title>expert61_l0_tp7&#45;&gt;expert_agg_l0_tp7</title>
<path fill="none" stroke="black" d="M17607.78,-3966.19C17590.84,-3957.75 17571.69,-3948.42 17554,-3940.31 17530.68,-3929.63 17505.69,-3918.67 17481.42,-3908.28"/>
<polygon fill="black" stroke="black" points="17482.74,-3905.03 17472.17,-3904.33 17479.99,-3911.47 17482.74,-3905.03"/>
</g>
<!-- expert62_l0_tp7&#45;&gt;expert_agg_l0_tp7 -->
<g id="edge219" class="edge">
<title>expert62_l0_tp7&#45;&gt;expert_agg_l0_tp7</title>
<path fill="none" stroke="black" d="M17818.68,-3966.31C17800.88,-3957.09 17779.89,-3947.21 17760,-3940.31 17718.34,-3925.86 17673.43,-3913.39 17629.13,-3902.76"/>
<polygon fill="black" stroke="black" points="17629.92,-3899.35 17619.38,-3900.45 17628.31,-3906.17 17629.92,-3899.35"/>
</g>
<!-- expert63_l0_tp7&#45;&gt;expert_agg_l0_tp7 -->
<g id="edge221" class="edge">
<title>expert63_l0_tp7&#45;&gt;expert_agg_l0_tp7</title>
<path fill="none" stroke="black" d="M18026.17,-3966.27C18008.14,-3956.75 17986.59,-3946.68 17966,-3940.31 17846.81,-3903.47 17709.81,-3882.17 17595.14,-3869.88"/>
<polygon fill="black" stroke="black" points="17595.49,-3866.4 17585.17,-3868.83 17594.75,-3873.36 17595.49,-3866.4"/>
</g>
<!-- expert_agg_l0_tp0&#45;&gt;res_add2_l0_tp0 -->
<g id="edge26" class="edge">
<title>expert_agg_l0_tp0&#45;&gt;res_add2_l0_tp0</title>
<path fill="none" stroke="black" d="M1129.3,-3822.62C1251.77,-3803.85 1409.58,-3779.67 1523.6,-3762.2"/>
<polygon fill="black" stroke="black" points="1524.45,-3765.61 1533.81,-3760.64 1523.39,-3758.69 1524.45,-3765.61"/>
</g>
<!-- norm2_l0_tp0 -->
<g id="node132" class="node">
<title>norm2_l0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3449,-3676.31 3183,-3676.31 3183,-3624.31 3449,-3624.31 3449,-3676.31"/>
<text text-anchor="middle" x="3316" y="-3664.31" font-family="Arial" font-size="10.00">Layer Norm 2 TP0</text>
<text text-anchor="middle" x="3316" y="-3653.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3316" y="-3642.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3316" y="-3631.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- res_add2_l0_tp0&#45;&gt;norm2_l0_tp0 -->
<g id="edge28" class="edge">
<title>res_add2_l0_tp0&#45;&gt;norm2_l0_tp0</title>
<path fill="none" stroke="black" d="M1812.02,-3730.04C2120.69,-3713.88 2860.53,-3675.15 3172.93,-3658.8"/>
<polygon fill="black" stroke="black" points="3173.15,-3662.29 3182.96,-3658.28 3172.79,-3655.3 3173.15,-3662.29"/>
</g>
<!-- input_split_l1_tp0 -->
<g id="node154" class="node">
<title>input_split_l1_tp0</title>
<ellipse fill="lightgray" stroke="black" cx="3316" cy="-3540.54" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="3316" y="-3554.54" font-family="Arial" font-size="10.00">Input Split TP0</text>
<text text-anchor="middle" x="3316" y="-3543.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3316" y="-3532.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="3316" y="-3521.54" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm2_l0_tp0&#45;&gt;input_split_l1_tp0 -->
<g id="edge225" class="edge">
<title>norm2_l0_tp0&#45;&gt;input_split_l1_tp0</title>
<path fill="none" stroke="black" d="M3316,-3624.05C3316,-3613.26 3316,-3600.31 3316,-3587.9"/>
<polygon fill="black" stroke="black" points="3319.5,-3587.67 3316,-3577.67 3312.5,-3587.67 3319.5,-3587.67"/>
</g>
<!-- res_add_l1_tp0 -->
<g id="node159" class="node">
<title>res_add_l1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3455,-3094.23 3177,-3094.23 3177,-3042.23 3455,-3042.23 3455,-3094.23"/>
<text text-anchor="middle" x="3316" y="-3082.23" font-family="Arial" font-size="10.00">Residual Add TP0</text>
<text text-anchor="middle" x="3316" y="-3071.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="3316" y="-3060.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3316" y="-3049.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm2_l0_tp0&#45;&gt;res_add_l1_tp0 -->
<g id="edge230" class="edge">
<title>norm2_l0_tp0&#45;&gt;res_add_l1_tp0</title>
<path fill="none" stroke="black" d="M3449.24,-3646.27C3758.62,-3639.35 4549.65,-3622.59 5211,-3616.31 5219.8,-3616.23 10275.59,-3614.35 10282,-3608.31 10308.81,-3583.03 10292,-3479.63 10292,-3442.77 10292,-3442.77 10292,-3442.77 10292,-3264.77 10292,-3204.81 10325.8,-3171.19 10282,-3130.23 10256.25,-3106.15 5240.26,-3094.59 5205,-3094.23 4557.34,-3087.65 3784.81,-3076.35 3465.47,-3071.52"/>
<polygon fill="black" stroke="black" points="3465.28,-3068.02 3455.22,-3071.37 3465.17,-3075.02 3465.28,-3068.02"/>
</g>
<!-- expert_agg_l0_tp1&#45;&gt;res_add2_l0_tp1 -->
<g id="edge54" class="edge">
<title>expert_agg_l0_tp1&#45;&gt;res_add2_l0_tp1</title>
<path fill="none" stroke="black" d="M3401.3,-3822.62C3523.77,-3803.85 3681.58,-3779.67 3795.6,-3762.2"/>
<polygon fill="black" stroke="black" points="3796.45,-3765.61 3805.81,-3760.64 3795.39,-3758.69 3796.45,-3765.61"/>
</g>
<!-- norm2_l0_tp1 -->
<g id="node135" class="node">
<title>norm2_l0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="5486,-3676.31 5220,-3676.31 5220,-3624.31 5486,-3624.31 5486,-3676.31"/>
<text text-anchor="middle" x="5353" y="-3664.31" font-family="Arial" font-size="10.00">Layer Norm 2 TP1</text>
<text text-anchor="middle" x="5353" y="-3653.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5353" y="-3642.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5353" y="-3631.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- res_add2_l0_tp1&#45;&gt;norm2_l0_tp1 -->
<g id="edge56" class="edge">
<title>res_add2_l0_tp1&#45;&gt;norm2_l0_tp1</title>
<path fill="none" stroke="black" d="M4084.18,-3728.81C4352.35,-3712.43 4938.1,-3676.65 5209.58,-3660.07"/>
<polygon fill="black" stroke="black" points="5210.13,-3663.55 5219.89,-3659.44 5209.7,-3656.56 5210.13,-3663.55"/>
</g>
<!-- input_split_l1_tp1 -->
<g id="node173" class="node">
<title>input_split_l1_tp1</title>
<ellipse fill="lightgray" stroke="black" cx="5353" cy="-3540.54" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="5353" y="-3554.54" font-family="Arial" font-size="10.00">Input Split TP1</text>
<text text-anchor="middle" x="5353" y="-3543.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5353" y="-3532.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="5353" y="-3521.54" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm2_l0_tp1&#45;&gt;input_split_l1_tp1 -->
<g id="edge253" class="edge">
<title>norm2_l0_tp1&#45;&gt;input_split_l1_tp1</title>
<path fill="none" stroke="black" d="M5353,-3624.05C5353,-3613.26 5353,-3600.31 5353,-3587.9"/>
<polygon fill="black" stroke="black" points="5356.5,-3587.67 5353,-3577.67 5349.5,-3587.67 5356.5,-3587.67"/>
</g>
<!-- res_add_l1_tp1 -->
<g id="node178" class="node">
<title>res_add_l1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="5492,-3094.23 5214,-3094.23 5214,-3042.23 5492,-3042.23 5492,-3094.23"/>
<text text-anchor="middle" x="5353" y="-3082.23" font-family="Arial" font-size="10.00">Residual Add TP1</text>
<text text-anchor="middle" x="5353" y="-3071.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="5353" y="-3060.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5353" y="-3049.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm2_l0_tp1&#45;&gt;res_add_l1_tp1 -->
<g id="edge258" class="edge">
<title>norm2_l0_tp1&#45;&gt;res_add_l1_tp1</title>
<path fill="none" stroke="black" d="M5486.2,-3645.9C5769.28,-3638.82 6451.69,-3622.66 7024,-3616.31 7035.35,-3616.19 10285.56,-3615.91 10294,-3608.31 10349.03,-3558.82 10312,-3516.78 10312,-3442.77 10312,-3442.77 10312,-3442.77 10312,-3264.77 10312,-3204.66 10342.43,-3170.73 10298,-3130.23 10264.33,-3099.55 7063.55,-3094.83 7018,-3094.23 6458.78,-3086.97 5793.93,-3076.41 5502.45,-3071.68"/>
<polygon fill="black" stroke="black" points="5502.29,-3068.18 5492.24,-3071.52 5502.18,-3075.18 5502.29,-3068.18"/>
</g>
<!-- expert_agg_l0_tp2&#45;&gt;res_add2_l0_tp2 -->
<g id="edge82" class="edge">
<title>expert_agg_l0_tp2&#45;&gt;res_add2_l0_tp2</title>
<path fill="none" stroke="black" d="M5673.3,-3822.62C5795.77,-3803.85 5953.58,-3779.67 6067.6,-3762.2"/>
<polygon fill="black" stroke="black" points="6068.45,-3765.61 6077.81,-3760.64 6067.39,-3758.69 6068.45,-3765.61"/>
</g>
<!-- norm2_l0_tp2 -->
<g id="node138" class="node">
<title>norm2_l0_tp2</title>
<polygon fill="lightgreen" stroke="black" points="7299,-3676.31 7033,-3676.31 7033,-3624.31 7299,-3624.31 7299,-3676.31"/>
<text text-anchor="middle" x="7166" y="-3664.31" font-family="Arial" font-size="10.00">Layer Norm 2 TP2</text>
<text text-anchor="middle" x="7166" y="-3653.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7166" y="-3642.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7166" y="-3631.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- res_add2_l0_tp2&#45;&gt;norm2_l0_tp2 -->
<g id="edge84" class="edge">
<title>res_add2_l0_tp2&#45;&gt;norm2_l0_tp2</title>
<path fill="none" stroke="black" d="M6356.01,-3724.72C6534.37,-3708.55 6842.22,-3680.65 7022.66,-3664.3"/>
<polygon fill="black" stroke="black" points="7023.11,-3667.78 7032.75,-3663.39 7022.48,-3660.8 7023.11,-3667.78"/>
</g>
<!-- input_split_l1_tp2 -->
<g id="node192" class="node">
<title>input_split_l1_tp2</title>
<ellipse fill="lightgray" stroke="black" cx="7166" cy="-3540.54" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="7166" y="-3554.54" font-family="Arial" font-size="10.00">Input Split TP2</text>
<text text-anchor="middle" x="7166" y="-3543.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7166" y="-3532.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7166" y="-3521.54" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm2_l0_tp2&#45;&gt;input_split_l1_tp2 -->
<g id="edge281" class="edge">
<title>norm2_l0_tp2&#45;&gt;input_split_l1_tp2</title>
<path fill="none" stroke="black" d="M7166,-3624.05C7166,-3613.26 7166,-3600.31 7166,-3587.9"/>
<polygon fill="black" stroke="black" points="7169.5,-3587.67 7166,-3577.67 7162.5,-3587.67 7169.5,-3587.67"/>
</g>
<!-- res_add_l1_tp2 -->
<g id="node197" class="node">
<title>res_add_l1_tp2</title>
<polygon fill="lightgreen" stroke="black" points="7305,-3094.23 7027,-3094.23 7027,-3042.23 7305,-3042.23 7305,-3094.23"/>
<text text-anchor="middle" x="7166" y="-3082.23" font-family="Arial" font-size="10.00">Residual Add TP2</text>
<text text-anchor="middle" x="7166" y="-3071.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="7166" y="-3060.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7166" y="-3049.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm2_l0_tp2&#45;&gt;res_add_l1_tp2 -->
<g id="edge286" class="edge">
<title>norm2_l0_tp2&#45;&gt;res_add_l1_tp2</title>
<path fill="none" stroke="black" d="M7299.05,-3644.6C7519.12,-3637.04 7972.82,-3622.42 8357,-3616.31 8370.59,-3616.1 10303.9,-3617.41 10314,-3608.31 10368.99,-3558.78 10332,-3516.78 10332,-3442.77 10332,-3442.77 10332,-3442.77 10332,-3264.77 10332,-3204.5 10359.84,-3170.5 10315,-3130.23 10274.4,-3093.78 8405.55,-3095.31 8351,-3094.23 7978.43,-3086.89 7539.99,-3077.43 7315.31,-3072.52"/>
<polygon fill="black" stroke="black" points="7315.17,-3069.01 7305.1,-3072.29 7315.02,-3076.01 7315.17,-3069.01"/>
</g>
<!-- expert_agg_l0_tp3&#45;&gt;res_add2_l0_tp3 -->
<g id="edge110" class="edge">
<title>expert_agg_l0_tp3&#45;&gt;res_add2_l0_tp3</title>
<path fill="none" stroke="black" d="M7945.3,-3822.62C8067.77,-3803.85 8225.58,-3779.67 8339.6,-3762.2"/>
<polygon fill="black" stroke="black" points="8340.45,-3765.61 8349.81,-3760.64 8339.39,-3758.69 8340.45,-3765.61"/>
</g>
<!-- norm2_l0_tp3 -->
<g id="node141" class="node">
<title>norm2_l0_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8632,-3676.31 8366,-3676.31 8366,-3624.31 8632,-3624.31 8632,-3676.31"/>
<text text-anchor="middle" x="8499" y="-3664.31" font-family="Arial" font-size="10.00">Layer Norm 2 TP3</text>
<text text-anchor="middle" x="8499" y="-3653.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8499" y="-3642.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8499" y="-3631.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- res_add2_l0_tp3&#45;&gt;norm2_l0_tp3 -->
<g id="edge112" class="edge">
<title>res_add2_l0_tp3&#45;&gt;norm2_l0_tp3</title>
<path fill="none" stroke="black" d="M8491.95,-3711.98C8492.87,-3704.01 8493.91,-3695.08 8494.9,-3686.56"/>
<polygon fill="black" stroke="black" points="8498.4,-3686.81 8496.07,-3676.47 8491.44,-3686 8498.4,-3686.81"/>
</g>
<!-- input_split_l1_tp3 -->
<g id="node211" class="node">
<title>input_split_l1_tp3</title>
<ellipse fill="lightgray" stroke="black" cx="8499" cy="-3540.54" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8499" y="-3554.54" font-family="Arial" font-size="10.00">Input Split TP3</text>
<text text-anchor="middle" x="8499" y="-3543.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8499" y="-3532.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8499" y="-3521.54" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm2_l0_tp3&#45;&gt;input_split_l1_tp3 -->
<g id="edge309" class="edge">
<title>norm2_l0_tp3&#45;&gt;input_split_l1_tp3</title>
<path fill="none" stroke="black" d="M8499,-3624.05C8499,-3613.26 8499,-3600.31 8499,-3587.9"/>
<polygon fill="black" stroke="black" points="8502.5,-3587.67 8499,-3577.67 8495.5,-3587.67 8502.5,-3587.67"/>
</g>
<!-- res_add_l1_tp3 -->
<g id="node216" class="node">
<title>res_add_l1_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8638,-3094.23 8360,-3094.23 8360,-3042.23 8638,-3042.23 8638,-3094.23"/>
<text text-anchor="middle" x="8499" y="-3082.23" font-family="Arial" font-size="10.00">Residual Add TP3</text>
<text text-anchor="middle" x="8499" y="-3071.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="8499" y="-3060.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8499" y="-3049.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm2_l0_tp3&#45;&gt;res_add_l1_tp3 -->
<g id="edge314" class="edge">
<title>norm2_l0_tp3&#45;&gt;res_add_l1_tp3</title>
<path fill="none" stroke="black" d="M8632.27,-3647.49C9051.76,-3641.61 10318.33,-3622.69 10334,-3608.31 10388.53,-3558.28 10352,-3516.78 10352,-3442.77 10352,-3442.77 10352,-3442.77 10352,-3264.77 10352,-3204.32 10377.12,-3170.47 10332,-3130.23 10269.59,-3074.58 9074.93,-3069.19 8648.59,-3069.05"/>
<polygon fill="black" stroke="black" points="8648.36,-3065.55 8638.36,-3069.04 8648.36,-3072.55 8648.36,-3065.55"/>
</g>
<!-- expert_agg_l0_tp4&#45;&gt;res_add2_l0_tp4 -->
<g id="edge138" class="edge">
<title>expert_agg_l0_tp4&#45;&gt;res_add2_l0_tp4</title>
<path fill="none" stroke="black" d="M10532,-3800.23C10532,-3791.56 10532,-3782.74 10532,-3774.6"/>
<polygon fill="black" stroke="black" points="10535.5,-3774.36 10532,-3764.36 10528.5,-3774.36 10535.5,-3774.36"/>
</g>
<!-- norm2_l0_tp4 -->
<g id="node144" class="node">
<title>norm2_l0_tp4</title>
<polygon fill="lightgreen" stroke="black" points="10543,-3676.31 10277,-3676.31 10277,-3624.31 10543,-3624.31 10543,-3676.31"/>
<text text-anchor="middle" x="10410" y="-3664.31" font-family="Arial" font-size="10.00">Layer Norm 2 TP4</text>
<text text-anchor="middle" x="10410" y="-3653.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10410" y="-3642.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10410" y="-3631.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- res_add2_l0_tp4&#45;&gt;norm2_l0_tp4 -->
<g id="edge140" class="edge">
<title>res_add2_l0_tp4&#45;&gt;norm2_l0_tp4</title>
<path fill="none" stroke="black" d="M10496.38,-3712.21C10483.22,-3702.93 10468.14,-3692.3 10454.3,-3682.54"/>
<polygon fill="black" stroke="black" points="10456.06,-3679.5 10445.87,-3676.6 10452.03,-3685.22 10456.06,-3679.5"/>
</g>
<!-- input_split_l1_tp4 -->
<g id="node230" class="node">
<title>input_split_l1_tp4</title>
<ellipse fill="lightgray" stroke="black" cx="8903" cy="-3540.54" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8903" y="-3554.54" font-family="Arial" font-size="10.00">Input Split TP4</text>
<text text-anchor="middle" x="8903" y="-3543.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8903" y="-3532.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8903" y="-3521.54" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm2_l0_tp4&#45;&gt;input_split_l1_tp4 -->
<g id="edge337" class="edge">
<title>norm2_l0_tp4&#45;&gt;input_split_l1_tp4</title>
<path fill="none" stroke="black" d="M10276.95,-3650.12C9990.37,-3651.04 9322.72,-3648.62 9100,-3608.31 9063.61,-3601.73 9024.82,-3589.73 8991.36,-3577.7"/>
<polygon fill="black" stroke="black" points="8992.21,-3574.28 8981.62,-3574.14 8989.81,-3580.86 8992.21,-3574.28"/>
</g>
<!-- res_add_l1_tp4 -->
<g id="node235" class="node">
<title>res_add_l1_tp4</title>
<polygon fill="lightgreen" stroke="black" points="10549,-3094.23 10271,-3094.23 10271,-3042.23 10549,-3042.23 10549,-3094.23"/>
<text text-anchor="middle" x="10410" y="-3082.23" font-family="Arial" font-size="10.00">Residual Add TP4</text>
<text text-anchor="middle" x="10410" y="-3071.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="10410" y="-3060.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10410" y="-3049.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm2_l0_tp4&#45;&gt;res_add_l1_tp4 -->
<g id="edge342" class="edge">
<title>norm2_l0_tp4&#45;&gt;res_add_l1_tp4</title>
<path fill="none" stroke="black" d="M10410,-3624.2C10410,-3585.32 10410,-3508.21 10410,-3442.77 10410,-3442.77 10410,-3442.77 10410,-3264.77 10410,-3208.64 10410,-3143.45 10410,-3104.32"/>
<polygon fill="black" stroke="black" points="10413.5,-3104.24 10410,-3094.24 10406.5,-3104.24 10413.5,-3104.24"/>
</g>
<!-- expert_agg_l0_tp5&#45;&gt;res_add2_l0_tp5 -->
<g id="edge166" class="edge">
<title>expert_agg_l0_tp5&#45;&gt;res_add2_l0_tp5</title>
<path fill="none" stroke="black" d="M12804,-3800.23C12804,-3791.56 12804,-3782.74 12804,-3774.6"/>
<polygon fill="black" stroke="black" points="12807.5,-3774.36 12804,-3764.36 12800.5,-3774.36 12807.5,-3774.36"/>
</g>
<!-- norm2_l0_tp5 -->
<g id="node147" class="node">
<title>norm2_l0_tp5</title>
<polygon fill="lightgreen" stroke="black" points="11827,-3676.31 11561,-3676.31 11561,-3624.31 11827,-3624.31 11827,-3676.31"/>
<text text-anchor="middle" x="11694" y="-3664.31" font-family="Arial" font-size="10.00">Layer Norm 2 TP5</text>
<text text-anchor="middle" x="11694" y="-3653.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11694" y="-3642.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11694" y="-3631.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- res_add2_l0_tp5&#45;&gt;norm2_l0_tp5 -->
<g id="edge168" class="edge">
<title>res_add2_l0_tp5&#45;&gt;norm2_l0_tp5</title>
<path fill="none" stroke="black" d="M12664.82,-3726.53C12452.99,-3710.12 12051.72,-3679.03 11837.4,-3662.42"/>
<polygon fill="black" stroke="black" points="11837.58,-3658.93 11827.34,-3661.64 11837.04,-3665.91 11837.58,-3658.93"/>
</g>
<!-- input_split_l1_tp5 -->
<g id="node249" class="node">
<title>input_split_l1_tp5</title>
<ellipse fill="lightgray" stroke="black" cx="9297" cy="-3540.54" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9297" y="-3554.54" font-family="Arial" font-size="10.00">Input Split TP5</text>
<text text-anchor="middle" x="9297" y="-3543.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9297" y="-3532.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9297" y="-3521.54" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm2_l0_tp5&#45;&gt;input_split_l1_tp5 -->
<g id="edge365" class="edge">
<title>norm2_l0_tp5&#45;&gt;input_split_l1_tp5</title>
<path fill="none" stroke="black" d="M11560.84,-3644.54C11347.8,-3637.12 10917.15,-3622.97 10552,-3616.31 10493.23,-3615.24 9551.96,-3618.09 9494,-3608.31 9457.21,-3602.11 9418.04,-3590.04 9384.39,-3577.85"/>
<polygon fill="black" stroke="black" points="9385.19,-3574.41 9374.6,-3574.24 9382.77,-3580.98 9385.19,-3574.41"/>
</g>
<!-- res_add_l1_tp5 -->
<g id="node254" class="node">
<title>res_add_l1_tp5</title>
<polygon fill="lightgreen" stroke="black" points="11833,-3094.23 11555,-3094.23 11555,-3042.23 11833,-3042.23 11833,-3094.23"/>
<text text-anchor="middle" x="11694" y="-3082.23" font-family="Arial" font-size="10.00">Residual Add TP5</text>
<text text-anchor="middle" x="11694" y="-3071.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="11694" y="-3060.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11694" y="-3049.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm2_l0_tp5&#45;&gt;res_add_l1_tp5 -->
<g id="edge370" class="edge">
<title>norm2_l0_tp5&#45;&gt;res_add_l1_tp5</title>
<path fill="none" stroke="black" d="M11694,-3624.2C11694,-3585.32 11694,-3508.21 11694,-3442.77 11694,-3442.77 11694,-3442.77 11694,-3264.77 11694,-3208.64 11694,-3143.45 11694,-3104.32"/>
<polygon fill="black" stroke="black" points="11697.5,-3104.24 11694,-3094.24 11690.5,-3104.24 11697.5,-3104.24"/>
</g>
<!-- expert_agg_l0_tp6&#45;&gt;res_add2_l0_tp6 -->
<g id="edge194" class="edge">
<title>expert_agg_l0_tp6&#45;&gt;res_add2_l0_tp6</title>
<path fill="none" stroke="black" d="M15076,-3800.23C15076,-3791.56 15076,-3782.74 15076,-3774.6"/>
<polygon fill="black" stroke="black" points="15079.5,-3774.36 15076,-3764.36 15072.5,-3774.36 15079.5,-3774.36"/>
</g>
<!-- norm2_l0_tp6 -->
<g id="node150" class="node">
<title>norm2_l0_tp6</title>
<polygon fill="lightgreen" stroke="black" points="13605,-3676.31 13339,-3676.31 13339,-3624.31 13605,-3624.31 13605,-3676.31"/>
<text text-anchor="middle" x="13472" y="-3664.31" font-family="Arial" font-size="10.00">Layer Norm 2 TP6</text>
<text text-anchor="middle" x="13472" y="-3653.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13472" y="-3642.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13472" y="-3631.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- res_add2_l0_tp6&#45;&gt;norm2_l0_tp6 -->
<g id="edge196" class="edge">
<title>res_add2_l0_tp6&#45;&gt;norm2_l0_tp6</title>
<path fill="none" stroke="black" d="M14936.81,-3729.85C14634.64,-3713.65 13921.22,-3675.4 13615.33,-3659"/>
<polygon fill="black" stroke="black" points="13615.24,-3655.49 13605.07,-3658.45 13614.86,-3662.48 13615.24,-3655.49"/>
</g>
<!-- input_split_l1_tp6 -->
<g id="node268" class="node">
<title>input_split_l1_tp6</title>
<ellipse fill="lightgray" stroke="black" cx="9691" cy="-3540.54" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9691" y="-3554.54" font-family="Arial" font-size="10.00">Input Split TP6</text>
<text text-anchor="middle" x="9691" y="-3543.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9691" y="-3532.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9691" y="-3521.54" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm2_l0_tp6&#45;&gt;input_split_l1_tp6 -->
<g id="edge393" class="edge">
<title>norm2_l0_tp6&#45;&gt;input_split_l1_tp6</title>
<path fill="none" stroke="black" d="M13338.94,-3645.9C13060.21,-3638.93 12394.54,-3623.09 11836,-3616.31 11781.89,-3615.66 9941.37,-3617.22 9888,-3608.31 9850.88,-3602.12 9811.34,-3589.9 9777.5,-3577.59"/>
<polygon fill="black" stroke="black" points="9778.71,-3574.31 9768.11,-3574.13 9776.28,-3580.87 9778.71,-3574.31"/>
</g>
<!-- res_add_l1_tp6 -->
<g id="node273" class="node">
<title>res_add_l1_tp6</title>
<polygon fill="lightgreen" stroke="black" points="13611,-3094.23 13333,-3094.23 13333,-3042.23 13611,-3042.23 13611,-3094.23"/>
<text text-anchor="middle" x="13472" y="-3082.23" font-family="Arial" font-size="10.00">Residual Add TP6</text>
<text text-anchor="middle" x="13472" y="-3071.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="13472" y="-3060.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13472" y="-3049.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm2_l0_tp6&#45;&gt;res_add_l1_tp6 -->
<g id="edge398" class="edge">
<title>norm2_l0_tp6&#45;&gt;res_add_l1_tp6</title>
<path fill="none" stroke="black" d="M13472,-3624.2C13472,-3585.32 13472,-3508.21 13472,-3442.77 13472,-3442.77 13472,-3442.77 13472,-3264.77 13472,-3208.64 13472,-3143.45 13472,-3104.32"/>
<polygon fill="black" stroke="black" points="13475.5,-3104.24 13472,-3094.24 13468.5,-3104.24 13475.5,-3104.24"/>
</g>
<!-- expert_agg_l0_tp7&#45;&gt;res_add2_l0_tp7 -->
<g id="edge222" class="edge">
<title>expert_agg_l0_tp7&#45;&gt;res_add2_l0_tp7</title>
<path fill="none" stroke="black" d="M17348,-3800.23C17348,-3791.56 17348,-3782.74 17348,-3774.6"/>
<polygon fill="black" stroke="black" points="17351.5,-3774.36 17348,-3764.36 17344.5,-3774.36 17351.5,-3774.36"/>
</g>
<!-- norm2_l0_tp7 -->
<g id="node153" class="node">
<title>norm2_l0_tp7</title>
<polygon fill="lightgreen" stroke="black" points="15639,-3676.31 15373,-3676.31 15373,-3624.31 15639,-3624.31 15639,-3676.31"/>
<text text-anchor="middle" x="15506" y="-3664.31" font-family="Arial" font-size="10.00">Layer Norm 2 TP7</text>
<text text-anchor="middle" x="15506" y="-3653.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15506" y="-3642.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15506" y="-3631.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- res_add2_l0_tp7&#45;&gt;norm2_l0_tp7 -->
<g id="edge224" class="edge">
<title>res_add2_l0_tp7&#45;&gt;norm2_l0_tp7</title>
<path fill="none" stroke="black" d="M17208.8,-3730.81C16867.9,-3714.9 15994.01,-3674.1 15649.1,-3657.99"/>
<polygon fill="black" stroke="black" points="15649.2,-3654.49 15639.05,-3657.52 15648.87,-3661.49 15649.2,-3654.49"/>
</g>
<!-- input_split_l1_tp7 -->
<g id="node287" class="node">
<title>input_split_l1_tp7</title>
<ellipse fill="lightgray" stroke="black" cx="10085" cy="-3540.54" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="10085" y="-3554.54" font-family="Arial" font-size="10.00">Input Split TP7</text>
<text text-anchor="middle" x="10085" y="-3543.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10085" y="-3532.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="10085" y="-3521.54" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm2_l0_tp7&#45;&gt;input_split_l1_tp7 -->
<g id="edge421" class="edge">
<title>norm2_l0_tp7&#45;&gt;input_split_l1_tp7</title>
<path fill="none" stroke="black" d="M15372.67,-3646.66C14644.76,-3632.19 11151.9,-3562.75 10281.69,-3545.45"/>
<polygon fill="black" stroke="black" points="10281.64,-3541.95 10271.58,-3545.25 10281.51,-3548.95 10281.64,-3541.95"/>
</g>
<!-- res_add_l1_tp7 -->
<g id="node292" class="node">
<title>res_add_l1_tp7</title>
<polygon fill="lightgreen" stroke="black" points="15645,-3094.23 15367,-3094.23 15367,-3042.23 15645,-3042.23 15645,-3094.23"/>
<text text-anchor="middle" x="15506" y="-3082.23" font-family="Arial" font-size="10.00">Residual Add TP7</text>
<text text-anchor="middle" x="15506" y="-3071.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="15506" y="-3060.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15506" y="-3049.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm2_l0_tp7&#45;&gt;res_add_l1_tp7 -->
<g id="edge426" class="edge">
<title>norm2_l0_tp7&#45;&gt;res_add_l1_tp7</title>
<path fill="none" stroke="black" d="M15506,-3624.2C15506,-3585.32 15506,-3508.21 15506,-3442.77 15506,-3442.77 15506,-3442.77 15506,-3264.77 15506,-3208.64 15506,-3143.45 15506,-3104.32"/>
<polygon fill="black" stroke="black" points="15509.5,-3104.24 15506,-3094.24 15502.5,-3104.24 15509.5,-3104.24"/>
</g>
<!-- mha_qkv_l1_tp0 -->
<g id="node155" class="node">
<title>mha_qkv_l1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3461.5,-3467.77 3170.5,-3467.77 3170.5,-3415.77 3461.5,-3415.77 3461.5,-3467.77"/>
<text text-anchor="middle" x="3316" y="-3455.77" font-family="Arial" font-size="10.00">MHA QKV TP0</text>
<text text-anchor="middle" x="3316" y="-3444.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="3316" y="-3433.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="3316" y="-3422.77" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- input_split_l1_tp0&#45;&gt;mha_qkv_l1_tp0 -->
<g id="edge226" class="edge">
<title>input_split_l1_tp0&#45;&gt;mha_qkv_l1_tp0</title>
<path fill="none" stroke="black" d="M3316,-3503.51C3316,-3495.2 3316,-3486.36 3316,-3478.08"/>
<polygon fill="black" stroke="black" points="3319.5,-3477.97 3316,-3467.97 3312.5,-3477.97 3319.5,-3477.97"/>
</g>
<!-- mha_attn_l1_tp0 -->
<g id="node156" class="node">
<title>mha_attn_l1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3461.5,-3379.77 3170.5,-3379.77 3170.5,-3327.77 3461.5,-3327.77 3461.5,-3379.77"/>
<text text-anchor="middle" x="3316" y="-3367.77" font-family="Arial" font-size="10.00">MHA Attention TP0</text>
<text text-anchor="middle" x="3316" y="-3356.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="3316" y="-3345.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="3316" y="-3334.77" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- mha_qkv_l1_tp0&#45;&gt;mha_attn_l1_tp0 -->
<g id="edge227" class="edge">
<title>mha_qkv_l1_tp0&#45;&gt;mha_attn_l1_tp0</title>
<path fill="none" stroke="black" d="M3316,-3415.44C3316,-3407.48 3316,-3398.54 3316,-3390.02"/>
<polygon fill="black" stroke="black" points="3319.5,-3389.93 3316,-3379.93 3312.5,-3389.93 3319.5,-3389.93"/>
</g>
<!-- mha_out_l1_tp0 -->
<g id="node157" class="node">
<title>mha_out_l1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3458,-3291.77 3174,-3291.77 3174,-3239.77 3458,-3239.77 3458,-3291.77"/>
<text text-anchor="middle" x="3316" y="-3279.77" font-family="Arial" font-size="10.00">MHA Output TP0</text>
<text text-anchor="middle" x="3316" y="-3268.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="3316" y="-3257.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="3316" y="-3246.77" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- mha_attn_l1_tp0&#45;&gt;mha_out_l1_tp0 -->
<g id="edge228" class="edge">
<title>mha_attn_l1_tp0&#45;&gt;mha_out_l1_tp0</title>
<path fill="none" stroke="black" d="M3316,-3327.44C3316,-3319.48 3316,-3310.54 3316,-3302.02"/>
<polygon fill="black" stroke="black" points="3319.5,-3301.93 3316,-3291.93 3312.5,-3301.93 3319.5,-3301.93"/>
</g>
<!-- attn_allreduce_l1_tp0 -->
<g id="node158" class="node">
<title>attn_allreduce_l1_tp0</title>
<ellipse fill="lightgray" stroke="black" cx="3316" cy="-3167" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="3316" y="-3181" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP0</text>
<text text-anchor="middle" x="3316" y="-3170" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="3316" y="-3159" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3316" y="-3148" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- mha_out_l1_tp0&#45;&gt;attn_allreduce_l1_tp0 -->
<g id="edge229" class="edge">
<title>mha_out_l1_tp0&#45;&gt;attn_allreduce_l1_tp0</title>
<path fill="none" stroke="black" d="M3316,-3239.6C3316,-3231.79 3316,-3222.93 3316,-3214.16"/>
<polygon fill="black" stroke="black" points="3319.5,-3213.98 3316,-3203.98 3312.5,-3213.98 3319.5,-3213.98"/>
</g>
<!-- attn_allreduce_l1_tp0&#45;&gt;res_add_l1_tp0 -->
<g id="edge231" class="edge">
<title>attn_allreduce_l1_tp0&#45;&gt;res_add_l1_tp0</title>
<path fill="none" stroke="black" d="M3316,-3129.97C3316,-3121.66 3316,-3112.82 3316,-3104.54"/>
<polygon fill="black" stroke="black" points="3319.5,-3104.43 3316,-3094.43 3312.5,-3104.43 3319.5,-3104.43"/>
</g>
<!-- norm_l1_tp0 -->
<g id="node160" class="node">
<title>norm_l1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1680,-3006.23 1414,-3006.23 1414,-2954.23 1680,-2954.23 1680,-3006.23"/>
<text text-anchor="middle" x="1547" y="-2994.23" font-family="Arial" font-size="10.00">Layer Norm TP0</text>
<text text-anchor="middle" x="1547" y="-2983.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="1547" y="-2972.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="1547" y="-2961.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- res_add_l1_tp0&#45;&gt;norm_l1_tp0 -->
<g id="edge232" class="edge">
<title>res_add_l1_tp0&#45;&gt;norm_l1_tp0</title>
<path fill="none" stroke="black" d="M3176.82,-3060.47C2847.64,-3044.47 2023.87,-3004.42 1690.46,-2988.21"/>
<polygon fill="black" stroke="black" points="1690.41,-2984.7 1680.25,-2987.71 1690.07,-2991.69 1690.41,-2984.7"/>
</g>
<!-- gate_l1_tp0 -->
<g id="node161" class="node">
<title>gate_l1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="611.3,-2918.23 144.72,-2918.23 24.7,-2814.23 491.28,-2814.23 611.3,-2918.23"/>
<text text-anchor="middle" x="318" y="-2880.23" font-family="Arial" font-size="10.00">Gate Network TP0</text>
<text text-anchor="middle" x="318" y="-2869.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="318" y="-2858.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="318" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l1_tp0&#45;&gt;gate_l1_tp0 -->
<g id="edge233" class="edge">
<title>norm_l1_tp0&#45;&gt;gate_l1_tp0</title>
<path fill="none" stroke="black" d="M1413.83,-2974.72C1233.42,-2967.64 901.54,-2951.18 620,-2918.23 619.9,-2918.22 619.79,-2918.21 619.69,-2918.2"/>
<polygon fill="black" stroke="black" points="620.39,-2914.76 610.04,-2917.04 619.56,-2921.71 620.39,-2914.76"/>
</g>
<!-- expert0_l1_tp0 -->
<g id="node162" class="node">
<title>expert0_l1_tp0</title>
<polygon fill="lightcoral" stroke="black" points="817,-2892.23 629,-2892.23 629,-2840.23 817,-2840.23 817,-2892.23"/>
<text text-anchor="middle" x="723" y="-2880.23" font-family="Arial" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="723" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="723" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="723" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l1_tp0&#45;&gt;expert0_l1_tp0 -->
<g id="edge234" class="edge">
<title>norm_l1_tp0&#45;&gt;expert0_l1_tp0</title>
<path fill="none" stroke="black" d="M1413.99,-2973.93C1236.76,-2965.83 933.08,-2948.11 826,-2918.23 808.33,-2913.3 790.06,-2905.34 773.91,-2897.15"/>
<polygon fill="black" stroke="black" points="775.15,-2893.85 764.66,-2892.32 771.91,-2900.05 775.15,-2893.85"/>
</g>
<!-- expert1_l1_tp0 -->
<g id="node163" class="node">
<title>expert1_l1_tp0</title>
<polygon fill="lightcoral" stroke="black" points="1023,-2892.23 835,-2892.23 835,-2840.23 1023,-2840.23 1023,-2892.23"/>
<text text-anchor="middle" x="929" y="-2880.23" font-family="Arial" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="929" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="929" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="929" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l1_tp0&#45;&gt;expert1_l1_tp0 -->
<g id="edge236" class="edge">
<title>norm_l1_tp0&#45;&gt;expert1_l1_tp0</title>
<path fill="none" stroke="black" d="M1413.79,-2975.89C1308.31,-2970.3 1158.22,-2955.74 1032,-2918.23 1014.57,-2913.06 996.5,-2905.1 980.45,-2897.01"/>
<polygon fill="black" stroke="black" points="981.75,-2893.74 971.26,-2892.24 978.53,-2899.95 981.75,-2893.74"/>
</g>
<!-- expert2_l1_tp0 -->
<g id="node164" class="node">
<title>expert2_l1_tp0</title>
<polygon fill="lightcoral" stroke="black" points="1229,-2892.23 1041,-2892.23 1041,-2840.23 1229,-2840.23 1229,-2892.23"/>
<text text-anchor="middle" x="1135" y="-2880.23" font-family="Arial" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="1135" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1135" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1135" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l1_tp0&#45;&gt;expert2_l1_tp0 -->
<g id="edge238" class="edge">
<title>norm_l1_tp0&#45;&gt;expert2_l1_tp0</title>
<path fill="none" stroke="black" d="M1413.8,-2960.88C1358.54,-2951.24 1294.31,-2937.35 1238,-2918.23 1221.26,-2912.55 1203.77,-2904.69 1188.05,-2896.84"/>
<polygon fill="black" stroke="black" points="1189.52,-2893.66 1179.02,-2892.24 1186.34,-2899.9 1189.52,-2893.66"/>
</g>
<!-- expert3_l1_tp0 -->
<g id="node165" class="node">
<title>expert3_l1_tp0</title>
<polygon fill="lightcoral" stroke="black" points="1435,-2892.23 1247,-2892.23 1247,-2840.23 1435,-2840.23 1435,-2892.23"/>
<text text-anchor="middle" x="1341" y="-2880.23" font-family="Arial" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="1341" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1341" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1341" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l1_tp0&#45;&gt;expert3_l1_tp0 -->
<g id="edge240" class="edge">
<title>norm_l1_tp0&#45;&gt;expert3_l1_tp0</title>
<path fill="none" stroke="black" d="M1500.77,-2954.1C1469.76,-2937.24 1428.76,-2914.95 1396.06,-2897.17"/>
<polygon fill="black" stroke="black" points="1397.53,-2893.99 1387.08,-2892.29 1394.19,-2900.14 1397.53,-2893.99"/>
</g>
<!-- expert4_l1_tp0 -->
<g id="node166" class="node">
<title>expert4_l1_tp0</title>
<polygon fill="lightcoral" stroke="black" points="1641,-2892.23 1453,-2892.23 1453,-2840.23 1641,-2840.23 1641,-2892.23"/>
<text text-anchor="middle" x="1547" y="-2880.23" font-family="Arial" font-size="10.00">Expert 4</text>
<text text-anchor="middle" x="1547" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1547" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1547" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l1_tp0&#45;&gt;expert4_l1_tp0 -->
<g id="edge242" class="edge">
<title>norm_l1_tp0&#45;&gt;expert4_l1_tp0</title>
<path fill="none" stroke="black" d="M1547,-2954.1C1547,-2938.82 1547,-2919.09 1547,-2902.3"/>
<polygon fill="black" stroke="black" points="1550.5,-2902.29 1547,-2892.29 1543.5,-2902.29 1550.5,-2902.29"/>
</g>
<!-- expert5_l1_tp0 -->
<g id="node167" class="node">
<title>expert5_l1_tp0</title>
<polygon fill="lightcoral" stroke="black" points="1847,-2892.23 1659,-2892.23 1659,-2840.23 1847,-2840.23 1847,-2892.23"/>
<text text-anchor="middle" x="1753" y="-2880.23" font-family="Arial" font-size="10.00">Expert 5</text>
<text text-anchor="middle" x="1753" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1753" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1753" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l1_tp0&#45;&gt;expert5_l1_tp0 -->
<g id="edge244" class="edge">
<title>norm_l1_tp0&#45;&gt;expert5_l1_tp0</title>
<path fill="none" stroke="black" d="M1593.23,-2954.1C1624.24,-2937.24 1665.24,-2914.95 1697.94,-2897.17"/>
<polygon fill="black" stroke="black" points="1699.81,-2900.14 1706.92,-2892.29 1696.47,-2893.99 1699.81,-2900.14"/>
</g>
<!-- expert6_l1_tp0 -->
<g id="node168" class="node">
<title>expert6_l1_tp0</title>
<polygon fill="lightcoral" stroke="black" points="2053,-2892.23 1865,-2892.23 1865,-2840.23 2053,-2840.23 2053,-2892.23"/>
<text text-anchor="middle" x="1959" y="-2880.23" font-family="Arial" font-size="10.00">Expert 6</text>
<text text-anchor="middle" x="1959" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1959" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1959" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l1_tp0&#45;&gt;expert6_l1_tp0 -->
<g id="edge246" class="edge">
<title>norm_l1_tp0&#45;&gt;expert6_l1_tp0</title>
<path fill="none" stroke="black" d="M1680.2,-2960.88C1735.46,-2951.24 1799.69,-2937.35 1856,-2918.23 1872.74,-2912.55 1890.23,-2904.69 1905.95,-2896.84"/>
<polygon fill="black" stroke="black" points="1907.66,-2899.9 1914.98,-2892.24 1904.48,-2893.66 1907.66,-2899.9"/>
</g>
<!-- expert7_l1_tp0 -->
<g id="node169" class="node">
<title>expert7_l1_tp0</title>
<polygon fill="lightcoral" stroke="black" points="2259,-2892.23 2071,-2892.23 2071,-2840.23 2259,-2840.23 2259,-2892.23"/>
<text text-anchor="middle" x="2165" y="-2880.23" font-family="Arial" font-size="10.00">Expert 7</text>
<text text-anchor="middle" x="2165" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2165" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2165" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l1_tp0&#45;&gt;expert7_l1_tp0 -->
<g id="edge248" class="edge">
<title>norm_l1_tp0&#45;&gt;expert7_l1_tp0</title>
<path fill="none" stroke="black" d="M1680.21,-2975.89C1785.69,-2970.3 1935.78,-2955.74 2062,-2918.23 2079.43,-2913.06 2097.5,-2905.1 2113.55,-2897.01"/>
<polygon fill="black" stroke="black" points="2115.47,-2899.95 2122.74,-2892.24 2112.25,-2893.74 2115.47,-2899.95"/>
</g>
<!-- res_add2_l1_tp0 -->
<g id="node171" class="node">
<title>res_add2_l1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2417,-2638.23 2139,-2638.23 2139,-2586.23 2417,-2586.23 2417,-2638.23"/>
<text text-anchor="middle" x="2278" y="-2626.23" font-family="Arial" font-size="10.00">Residual Add 2 TP0</text>
<text text-anchor="middle" x="2278" y="-2615.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="2278" y="-2604.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2278" y="-2593.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- norm_l1_tp0&#45;&gt;res_add2_l1_tp0 -->
<g id="edge251" class="edge">
<title>norm_l1_tp0&#45;&gt;res_add2_l1_tp0</title>
<path fill="none" stroke="black" d="M1680.2,-2977.34C1877.48,-2973.15 2228.45,-2959.88 2268,-2918.23 2286.21,-2899.06 2282.1,-2724.35 2279.41,-2648.32"/>
<polygon fill="black" stroke="black" points="2282.9,-2648.14 2279.04,-2638.27 2275.91,-2648.39 2282.9,-2648.14"/>
</g>
<!-- expert_agg_l1_tp0 -->
<g id="node170" class="node">
<title>expert_agg_l1_tp0</title>
<polygon fill="lightpink" stroke="black" points="1822.55,-2778.23 1384.21,-2778.23 1271.45,-2674.23 1709.79,-2674.23 1822.55,-2778.23"/>
<text text-anchor="middle" x="1547" y="-2740.23" font-family="Arial" font-size="10.00">Expert Aggregation TP0</text>
<text text-anchor="middle" x="1547" y="-2729.23" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="1547" y="-2718.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="1547" y="-2707.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- expert0_l1_tp0&#45;&gt;expert_agg_l1_tp0 -->
<g id="edge235" class="edge">
<title>expert0_l1_tp0&#45;&gt;expert_agg_l1_tp0</title>
<path fill="none" stroke="black" d="M765.77,-2839.98C783.79,-2830.43 805.35,-2820.4 826,-2814.23 989.12,-2765.57 1180.72,-2744.04 1325.39,-2734.56"/>
<polygon fill="black" stroke="black" points="1325.97,-2738.03 1335.72,-2733.89 1325.52,-2731.04 1325.97,-2738.03"/>
</g>
<!-- expert1_l1_tp0&#45;&gt;expert_agg_l1_tp0 -->
<g id="edge237" class="edge">
<title>expert1_l1_tp0&#45;&gt;expert_agg_l1_tp0</title>
<path fill="none" stroke="black" d="M972.42,-2840.21C990.36,-2830.81 1011.69,-2820.82 1032,-2814.23 1130.93,-2782.16 1244.58,-2761.36 1339.91,-2748.17"/>
<polygon fill="black" stroke="black" points="1340.53,-2751.62 1349.96,-2746.8 1339.58,-2744.69 1340.53,-2751.62"/>
</g>
<!-- expert2_l1_tp0&#45;&gt;expert_agg_l1_tp0 -->
<g id="edge239" class="edge">
<title>expert2_l1_tp0&#45;&gt;expert_agg_l1_tp0</title>
<path fill="none" stroke="black" d="M1181.1,-2840.13C1198.59,-2831.21 1218.91,-2821.58 1238,-2814.23 1278.42,-2798.69 1322.76,-2784.57 1364.93,-2772.44"/>
<polygon fill="black" stroke="black" points="1366.09,-2775.75 1374.74,-2769.64 1364.17,-2769.02 1366.09,-2775.75"/>
</g>
<!-- expert3_l1_tp0&#45;&gt;expert_agg_l1_tp0 -->
<g id="edge241" class="edge">
<title>expert3_l1_tp0&#45;&gt;expert_agg_l1_tp0</title>
<path fill="none" stroke="black" d="M1378.78,-2839.92C1402.15,-2824.27 1433.12,-2803.53 1462.11,-2784.1"/>
<polygon fill="black" stroke="black" points="1464.27,-2786.87 1470.63,-2778.4 1460.37,-2781.05 1464.27,-2786.87"/>
</g>
<!-- expert4_l1_tp0&#45;&gt;expert_agg_l1_tp0 -->
<g id="edge243" class="edge">
<title>expert4_l1_tp0&#45;&gt;expert_agg_l1_tp0</title>
<path fill="none" stroke="black" d="M1547,-2839.92C1547,-2825.48 1547,-2806.7 1547,-2788.63"/>
<polygon fill="black" stroke="black" points="1550.5,-2788.4 1547,-2778.4 1543.5,-2788.4 1550.5,-2788.4"/>
</g>
<!-- expert5_l1_tp0&#45;&gt;expert_agg_l1_tp0 -->
<g id="edge245" class="edge">
<title>expert5_l1_tp0&#45;&gt;expert_agg_l1_tp0</title>
<path fill="none" stroke="black" d="M1715.22,-2839.92C1691.85,-2824.27 1660.88,-2803.53 1631.89,-2784.1"/>
<polygon fill="black" stroke="black" points="1633.63,-2781.05 1623.37,-2778.4 1629.73,-2786.87 1633.63,-2781.05"/>
</g>
<!-- expert6_l1_tp0&#45;&gt;expert_agg_l1_tp0 -->
<g id="edge247" class="edge">
<title>expert6_l1_tp0&#45;&gt;expert_agg_l1_tp0</title>
<path fill="none" stroke="black" d="M1912.9,-2840.13C1895.41,-2831.21 1875.09,-2821.58 1856,-2814.23 1824.99,-2802.31 1791.66,-2791.22 1758.79,-2781.23"/>
<polygon fill="black" stroke="black" points="1759.65,-2777.83 1749.06,-2778.3 1757.63,-2784.53 1759.65,-2777.83"/>
</g>
<!-- expert7_l1_tp0&#45;&gt;expert_agg_l1_tp0 -->
<g id="edge249" class="edge">
<title>expert7_l1_tp0&#45;&gt;expert_agg_l1_tp0</title>
<path fill="none" stroke="black" d="M2121.58,-2840.21C2103.64,-2830.81 2082.31,-2820.82 2062,-2814.23 1980.77,-2787.9 1889.61,-2769.16 1806.83,-2756"/>
<polygon fill="black" stroke="black" points="1807.19,-2752.52 1796.77,-2754.43 1806.11,-2759.43 1807.19,-2752.52"/>
</g>
<!-- expert_agg_l1_tp0&#45;&gt;res_add2_l1_tp0 -->
<g id="edge250" class="edge">
<title>expert_agg_l1_tp0&#45;&gt;res_add2_l1_tp0</title>
<path fill="none" stroke="black" d="M1734.3,-2696.54C1856.77,-2677.77 2014.58,-2653.59 2128.6,-2636.12"/>
<polygon fill="black" stroke="black" points="2129.45,-2639.54 2138.81,-2634.56 2128.39,-2632.62 2129.45,-2639.54"/>
</g>
<!-- norm2_l1_tp0 -->
<g id="node172" class="node">
<title>norm2_l1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3405,-2550.23 3139,-2550.23 3139,-2498.23 3405,-2498.23 3405,-2550.23"/>
<text text-anchor="middle" x="3272" y="-2538.23" font-family="Arial" font-size="10.00">Layer Norm 2 TP0</text>
<text text-anchor="middle" x="3272" y="-2527.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3272" y="-2516.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3272" y="-2505.23" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- res_add2_l1_tp0&#45;&gt;norm2_l1_tp0 -->
<g id="edge252" class="edge">
<title>res_add2_l1_tp0&#45;&gt;norm2_l1_tp0</title>
<path fill="none" stroke="black" d="M2417.26,-2599.19C2605.31,-2582.92 2938.71,-2554.07 3128.78,-2537.63"/>
<polygon fill="black" stroke="black" points="3129.18,-2541.1 3138.84,-2536.76 3128.58,-2534.13 3129.18,-2541.1"/>
</g>
<!-- pipeline_comm_01 -->
<g id="node306" class="node">
<title>pipeline_comm_01</title>
<ellipse fill="lightsteelblue" stroke="black" cx="9864" cy="-2406.47" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9864" y="-2420.47" font-family="Arial" font-size="10.00">Pipeline Communication S0S1</text>
<text text-anchor="middle" x="9864" y="-2409.47" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9864" y="-2398.47" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9864" y="-2387.47" font-family="Arial" font-size="10.00">GPU: 0&#45;7  8&#45;15</text>
</g>
<!-- norm2_l1_tp0&#45;&gt;pipeline_comm_01 -->
<g id="edge449" class="edge">
<title>norm2_l1_tp0&#45;&gt;pipeline_comm_01</title>
<path fill="none" stroke="black" d="M3405.03,-2520.56C3740.19,-2513.84 4646.45,-2495.84 5402,-2482.23 7050.41,-2452.56 9041.45,-2420.56 9666.51,-2410.6"/>
<polygon fill="black" stroke="black" points="9667.02,-2414.09 9676.96,-2410.43 9666.91,-2407.09 9667.02,-2414.09"/>
</g>
<!-- mha_qkv_l1_tp1 -->
<g id="node174" class="node">
<title>mha_qkv_l1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="5498.5,-3467.77 5207.5,-3467.77 5207.5,-3415.77 5498.5,-3415.77 5498.5,-3467.77"/>
<text text-anchor="middle" x="5353" y="-3455.77" font-family="Arial" font-size="10.00">MHA QKV TP1</text>
<text text-anchor="middle" x="5353" y="-3444.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="5353" y="-3433.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="5353" y="-3422.77" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- input_split_l1_tp1&#45;&gt;mha_qkv_l1_tp1 -->
<g id="edge254" class="edge">
<title>input_split_l1_tp1&#45;&gt;mha_qkv_l1_tp1</title>
<path fill="none" stroke="black" d="M5353,-3503.51C5353,-3495.2 5353,-3486.36 5353,-3478.08"/>
<polygon fill="black" stroke="black" points="5356.5,-3477.97 5353,-3467.97 5349.5,-3477.97 5356.5,-3477.97"/>
</g>
<!-- mha_attn_l1_tp1 -->
<g id="node175" class="node">
<title>mha_attn_l1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="5498.5,-3379.77 5207.5,-3379.77 5207.5,-3327.77 5498.5,-3327.77 5498.5,-3379.77"/>
<text text-anchor="middle" x="5353" y="-3367.77" font-family="Arial" font-size="10.00">MHA Attention TP1</text>
<text text-anchor="middle" x="5353" y="-3356.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="5353" y="-3345.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="5353" y="-3334.77" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- mha_qkv_l1_tp1&#45;&gt;mha_attn_l1_tp1 -->
<g id="edge255" class="edge">
<title>mha_qkv_l1_tp1&#45;&gt;mha_attn_l1_tp1</title>
<path fill="none" stroke="black" d="M5353,-3415.44C5353,-3407.48 5353,-3398.54 5353,-3390.02"/>
<polygon fill="black" stroke="black" points="5356.5,-3389.93 5353,-3379.93 5349.5,-3389.93 5356.5,-3389.93"/>
</g>
<!-- mha_out_l1_tp1 -->
<g id="node176" class="node">
<title>mha_out_l1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="5495,-3291.77 5211,-3291.77 5211,-3239.77 5495,-3239.77 5495,-3291.77"/>
<text text-anchor="middle" x="5353" y="-3279.77" font-family="Arial" font-size="10.00">MHA Output TP1</text>
<text text-anchor="middle" x="5353" y="-3268.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="5353" y="-3257.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="5353" y="-3246.77" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- mha_attn_l1_tp1&#45;&gt;mha_out_l1_tp1 -->
<g id="edge256" class="edge">
<title>mha_attn_l1_tp1&#45;&gt;mha_out_l1_tp1</title>
<path fill="none" stroke="black" d="M5353,-3327.44C5353,-3319.48 5353,-3310.54 5353,-3302.02"/>
<polygon fill="black" stroke="black" points="5356.5,-3301.93 5353,-3291.93 5349.5,-3301.93 5356.5,-3301.93"/>
</g>
<!-- attn_allreduce_l1_tp1 -->
<g id="node177" class="node">
<title>attn_allreduce_l1_tp1</title>
<ellipse fill="lightgray" stroke="black" cx="5353" cy="-3167" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="5353" y="-3181" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP1</text>
<text text-anchor="middle" x="5353" y="-3170" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="5353" y="-3159" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5353" y="-3148" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- mha_out_l1_tp1&#45;&gt;attn_allreduce_l1_tp1 -->
<g id="edge257" class="edge">
<title>mha_out_l1_tp1&#45;&gt;attn_allreduce_l1_tp1</title>
<path fill="none" stroke="black" d="M5353,-3239.6C5353,-3231.79 5353,-3222.93 5353,-3214.16"/>
<polygon fill="black" stroke="black" points="5356.5,-3213.98 5353,-3203.98 5349.5,-3213.98 5356.5,-3213.98"/>
</g>
<!-- attn_allreduce_l1_tp1&#45;&gt;res_add_l1_tp1 -->
<g id="edge259" class="edge">
<title>attn_allreduce_l1_tp1&#45;&gt;res_add_l1_tp1</title>
<path fill="none" stroke="black" d="M5353,-3129.97C5353,-3121.66 5353,-3112.82 5353,-3104.54"/>
<polygon fill="black" stroke="black" points="5356.5,-3104.43 5353,-3094.43 5349.5,-3104.43 5356.5,-3104.43"/>
</g>
<!-- norm_l1_tp1 -->
<g id="node179" class="node">
<title>norm_l1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3952,-3006.23 3686,-3006.23 3686,-2954.23 3952,-2954.23 3952,-3006.23"/>
<text text-anchor="middle" x="3819" y="-2994.23" font-family="Arial" font-size="10.00">Layer Norm TP1</text>
<text text-anchor="middle" x="3819" y="-2983.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3819" y="-2972.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3819" y="-2961.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- res_add_l1_tp1&#45;&gt;norm_l1_tp1 -->
<g id="edge260" class="edge">
<title>res_add_l1_tp1&#45;&gt;norm_l1_tp1</title>
<path fill="none" stroke="black" d="M5213.82,-3059.43C4923.61,-3043.16 4256.48,-3005.76 3962.54,-2989.28"/>
<polygon fill="black" stroke="black" points="3962.42,-2985.77 3952.24,-2988.7 3962.03,-2992.76 3962.42,-2985.77"/>
</g>
<!-- gate_l1_tp1 -->
<g id="node180" class="node">
<title>gate_l1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2883.3,-2918.23 2416.72,-2918.23 2296.7,-2814.23 2763.28,-2814.23 2883.3,-2918.23"/>
<text text-anchor="middle" x="2590" y="-2880.23" font-family="Arial" font-size="10.00">Gate Network TP1</text>
<text text-anchor="middle" x="2590" y="-2869.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2590" y="-2858.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="2590" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l1_tp1&#45;&gt;gate_l1_tp1 -->
<g id="edge261" class="edge">
<title>norm_l1_tp1&#45;&gt;gate_l1_tp1</title>
<path fill="none" stroke="black" d="M3685.83,-2974.72C3505.42,-2967.64 3173.54,-2951.18 2892,-2918.23 2891.9,-2918.22 2891.79,-2918.21 2891.69,-2918.2"/>
<polygon fill="black" stroke="black" points="2892.39,-2914.76 2882.04,-2917.04 2891.56,-2921.71 2892.39,-2914.76"/>
</g>
<!-- expert8_l1_tp1 -->
<g id="node181" class="node">
<title>expert8_l1_tp1</title>
<polygon fill="lightcoral" stroke="black" points="3089,-2892.23 2901,-2892.23 2901,-2840.23 3089,-2840.23 3089,-2892.23"/>
<text text-anchor="middle" x="2995" y="-2880.23" font-family="Arial" font-size="10.00">Expert 8</text>
<text text-anchor="middle" x="2995" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2995" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2995" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l1_tp1&#45;&gt;expert8_l1_tp1 -->
<g id="edge262" class="edge">
<title>norm_l1_tp1&#45;&gt;expert8_l1_tp1</title>
<path fill="none" stroke="black" d="M3685.99,-2973.93C3508.76,-2965.83 3205.08,-2948.11 3098,-2918.23 3080.33,-2913.3 3062.06,-2905.34 3045.91,-2897.15"/>
<polygon fill="black" stroke="black" points="3047.15,-2893.85 3036.66,-2892.32 3043.91,-2900.05 3047.15,-2893.85"/>
</g>
<!-- expert9_l1_tp1 -->
<g id="node182" class="node">
<title>expert9_l1_tp1</title>
<polygon fill="lightcoral" stroke="black" points="3295,-2892.23 3107,-2892.23 3107,-2840.23 3295,-2840.23 3295,-2892.23"/>
<text text-anchor="middle" x="3201" y="-2880.23" font-family="Arial" font-size="10.00">Expert 9</text>
<text text-anchor="middle" x="3201" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3201" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3201" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l1_tp1&#45;&gt;expert9_l1_tp1 -->
<g id="edge264" class="edge">
<title>norm_l1_tp1&#45;&gt;expert9_l1_tp1</title>
<path fill="none" stroke="black" d="M3685.79,-2975.89C3580.31,-2970.3 3430.22,-2955.74 3304,-2918.23 3286.57,-2913.06 3268.5,-2905.1 3252.45,-2897.01"/>
<polygon fill="black" stroke="black" points="3253.75,-2893.74 3243.26,-2892.24 3250.53,-2899.95 3253.75,-2893.74"/>
</g>
<!-- expert10_l1_tp1 -->
<g id="node183" class="node">
<title>expert10_l1_tp1</title>
<polygon fill="lightcoral" stroke="black" points="3501,-2892.23 3313,-2892.23 3313,-2840.23 3501,-2840.23 3501,-2892.23"/>
<text text-anchor="middle" x="3407" y="-2880.23" font-family="Arial" font-size="10.00">Expert 10</text>
<text text-anchor="middle" x="3407" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3407" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3407" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l1_tp1&#45;&gt;expert10_l1_tp1 -->
<g id="edge266" class="edge">
<title>norm_l1_tp1&#45;&gt;expert10_l1_tp1</title>
<path fill="none" stroke="black" d="M3685.8,-2960.88C3630.54,-2951.24 3566.31,-2937.35 3510,-2918.23 3493.26,-2912.55 3475.77,-2904.69 3460.05,-2896.84"/>
<polygon fill="black" stroke="black" points="3461.52,-2893.66 3451.02,-2892.24 3458.34,-2899.9 3461.52,-2893.66"/>
</g>
<!-- expert11_l1_tp1 -->
<g id="node184" class="node">
<title>expert11_l1_tp1</title>
<polygon fill="lightcoral" stroke="black" points="3707,-2892.23 3519,-2892.23 3519,-2840.23 3707,-2840.23 3707,-2892.23"/>
<text text-anchor="middle" x="3613" y="-2880.23" font-family="Arial" font-size="10.00">Expert 11</text>
<text text-anchor="middle" x="3613" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3613" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3613" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l1_tp1&#45;&gt;expert11_l1_tp1 -->
<g id="edge268" class="edge">
<title>norm_l1_tp1&#45;&gt;expert11_l1_tp1</title>
<path fill="none" stroke="black" d="M3772.77,-2954.1C3741.76,-2937.24 3700.76,-2914.95 3668.06,-2897.17"/>
<polygon fill="black" stroke="black" points="3669.53,-2893.99 3659.08,-2892.29 3666.19,-2900.14 3669.53,-2893.99"/>
</g>
<!-- expert12_l1_tp1 -->
<g id="node185" class="node">
<title>expert12_l1_tp1</title>
<polygon fill="lightcoral" stroke="black" points="3913,-2892.23 3725,-2892.23 3725,-2840.23 3913,-2840.23 3913,-2892.23"/>
<text text-anchor="middle" x="3819" y="-2880.23" font-family="Arial" font-size="10.00">Expert 12</text>
<text text-anchor="middle" x="3819" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3819" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3819" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l1_tp1&#45;&gt;expert12_l1_tp1 -->
<g id="edge270" class="edge">
<title>norm_l1_tp1&#45;&gt;expert12_l1_tp1</title>
<path fill="none" stroke="black" d="M3819,-2954.1C3819,-2938.82 3819,-2919.09 3819,-2902.3"/>
<polygon fill="black" stroke="black" points="3822.5,-2902.29 3819,-2892.29 3815.5,-2902.29 3822.5,-2902.29"/>
</g>
<!-- expert13_l1_tp1 -->
<g id="node186" class="node">
<title>expert13_l1_tp1</title>
<polygon fill="lightcoral" stroke="black" points="4119,-2892.23 3931,-2892.23 3931,-2840.23 4119,-2840.23 4119,-2892.23"/>
<text text-anchor="middle" x="4025" y="-2880.23" font-family="Arial" font-size="10.00">Expert 13</text>
<text text-anchor="middle" x="4025" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4025" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4025" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l1_tp1&#45;&gt;expert13_l1_tp1 -->
<g id="edge272" class="edge">
<title>norm_l1_tp1&#45;&gt;expert13_l1_tp1</title>
<path fill="none" stroke="black" d="M3865.23,-2954.1C3896.24,-2937.24 3937.24,-2914.95 3969.94,-2897.17"/>
<polygon fill="black" stroke="black" points="3971.81,-2900.14 3978.92,-2892.29 3968.47,-2893.99 3971.81,-2900.14"/>
</g>
<!-- expert14_l1_tp1 -->
<g id="node187" class="node">
<title>expert14_l1_tp1</title>
<polygon fill="lightcoral" stroke="black" points="4325,-2892.23 4137,-2892.23 4137,-2840.23 4325,-2840.23 4325,-2892.23"/>
<text text-anchor="middle" x="4231" y="-2880.23" font-family="Arial" font-size="10.00">Expert 14</text>
<text text-anchor="middle" x="4231" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4231" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4231" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l1_tp1&#45;&gt;expert14_l1_tp1 -->
<g id="edge274" class="edge">
<title>norm_l1_tp1&#45;&gt;expert14_l1_tp1</title>
<path fill="none" stroke="black" d="M3952.2,-2960.88C4007.46,-2951.24 4071.69,-2937.35 4128,-2918.23 4144.74,-2912.55 4162.23,-2904.69 4177.95,-2896.84"/>
<polygon fill="black" stroke="black" points="4179.66,-2899.9 4186.98,-2892.24 4176.48,-2893.66 4179.66,-2899.9"/>
</g>
<!-- expert15_l1_tp1 -->
<g id="node188" class="node">
<title>expert15_l1_tp1</title>
<polygon fill="lightcoral" stroke="black" points="4531,-2892.23 4343,-2892.23 4343,-2840.23 4531,-2840.23 4531,-2892.23"/>
<text text-anchor="middle" x="4437" y="-2880.23" font-family="Arial" font-size="10.00">Expert 15</text>
<text text-anchor="middle" x="4437" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4437" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4437" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l1_tp1&#45;&gt;expert15_l1_tp1 -->
<g id="edge276" class="edge">
<title>norm_l1_tp1&#45;&gt;expert15_l1_tp1</title>
<path fill="none" stroke="black" d="M3952.21,-2975.89C4057.69,-2970.3 4207.78,-2955.74 4334,-2918.23 4351.43,-2913.06 4369.5,-2905.1 4385.55,-2897.01"/>
<polygon fill="black" stroke="black" points="4387.47,-2899.95 4394.74,-2892.24 4384.25,-2893.74 4387.47,-2899.95"/>
</g>
<!-- res_add2_l1_tp1 -->
<g id="node190" class="node">
<title>res_add2_l1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="4689,-2638.23 4411,-2638.23 4411,-2586.23 4689,-2586.23 4689,-2638.23"/>
<text text-anchor="middle" x="4550" y="-2626.23" font-family="Arial" font-size="10.00">Residual Add 2 TP1</text>
<text text-anchor="middle" x="4550" y="-2615.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="4550" y="-2604.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4550" y="-2593.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- norm_l1_tp1&#45;&gt;res_add2_l1_tp1 -->
<g id="edge279" class="edge">
<title>norm_l1_tp1&#45;&gt;res_add2_l1_tp1</title>
<path fill="none" stroke="black" d="M3952.2,-2977.34C4149.48,-2973.15 4500.45,-2959.88 4540,-2918.23 4558.21,-2899.06 4554.1,-2724.35 4551.41,-2648.32"/>
<polygon fill="black" stroke="black" points="4554.9,-2648.14 4551.04,-2638.27 4547.91,-2648.39 4554.9,-2648.14"/>
</g>
<!-- expert_agg_l1_tp1 -->
<g id="node189" class="node">
<title>expert_agg_l1_tp1</title>
<polygon fill="lightpink" stroke="black" points="4094.55,-2778.23 3656.21,-2778.23 3543.45,-2674.23 3981.79,-2674.23 4094.55,-2778.23"/>
<text text-anchor="middle" x="3819" y="-2740.23" font-family="Arial" font-size="10.00">Expert Aggregation TP1</text>
<text text-anchor="middle" x="3819" y="-2729.23" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="3819" y="-2718.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3819" y="-2707.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- expert8_l1_tp1&#45;&gt;expert_agg_l1_tp1 -->
<g id="edge263" class="edge">
<title>expert8_l1_tp1&#45;&gt;expert_agg_l1_tp1</title>
<path fill="none" stroke="black" d="M3037.77,-2839.98C3055.79,-2830.43 3077.35,-2820.4 3098,-2814.23 3261.12,-2765.57 3452.72,-2744.04 3597.39,-2734.56"/>
<polygon fill="black" stroke="black" points="3597.97,-2738.03 3607.72,-2733.89 3597.52,-2731.04 3597.97,-2738.03"/>
</g>
<!-- expert9_l1_tp1&#45;&gt;expert_agg_l1_tp1 -->
<g id="edge265" class="edge">
<title>expert9_l1_tp1&#45;&gt;expert_agg_l1_tp1</title>
<path fill="none" stroke="black" d="M3244.42,-2840.21C3262.36,-2830.81 3283.69,-2820.82 3304,-2814.23 3402.93,-2782.16 3516.58,-2761.36 3611.91,-2748.17"/>
<polygon fill="black" stroke="black" points="3612.53,-2751.62 3621.96,-2746.8 3611.58,-2744.69 3612.53,-2751.62"/>
</g>
<!-- expert10_l1_tp1&#45;&gt;expert_agg_l1_tp1 -->
<g id="edge267" class="edge">
<title>expert10_l1_tp1&#45;&gt;expert_agg_l1_tp1</title>
<path fill="none" stroke="black" d="M3453.1,-2840.13C3470.59,-2831.21 3490.91,-2821.58 3510,-2814.23 3550.42,-2798.69 3594.76,-2784.57 3636.93,-2772.44"/>
<polygon fill="black" stroke="black" points="3638.09,-2775.75 3646.74,-2769.64 3636.17,-2769.02 3638.09,-2775.75"/>
</g>
<!-- expert11_l1_tp1&#45;&gt;expert_agg_l1_tp1 -->
<g id="edge269" class="edge">
<title>expert11_l1_tp1&#45;&gt;expert_agg_l1_tp1</title>
<path fill="none" stroke="black" d="M3650.78,-2839.92C3674.15,-2824.27 3705.12,-2803.53 3734.11,-2784.1"/>
<polygon fill="black" stroke="black" points="3736.27,-2786.87 3742.63,-2778.4 3732.37,-2781.05 3736.27,-2786.87"/>
</g>
<!-- expert12_l1_tp1&#45;&gt;expert_agg_l1_tp1 -->
<g id="edge271" class="edge">
<title>expert12_l1_tp1&#45;&gt;expert_agg_l1_tp1</title>
<path fill="none" stroke="black" d="M3819,-2839.92C3819,-2825.48 3819,-2806.7 3819,-2788.63"/>
<polygon fill="black" stroke="black" points="3822.5,-2788.4 3819,-2778.4 3815.5,-2788.4 3822.5,-2788.4"/>
</g>
<!-- expert13_l1_tp1&#45;&gt;expert_agg_l1_tp1 -->
<g id="edge273" class="edge">
<title>expert13_l1_tp1&#45;&gt;expert_agg_l1_tp1</title>
<path fill="none" stroke="black" d="M3987.22,-2839.92C3963.85,-2824.27 3932.88,-2803.53 3903.89,-2784.1"/>
<polygon fill="black" stroke="black" points="3905.63,-2781.05 3895.37,-2778.4 3901.73,-2786.87 3905.63,-2781.05"/>
</g>
<!-- expert14_l1_tp1&#45;&gt;expert_agg_l1_tp1 -->
<g id="edge275" class="edge">
<title>expert14_l1_tp1&#45;&gt;expert_agg_l1_tp1</title>
<path fill="none" stroke="black" d="M4184.9,-2840.13C4167.41,-2831.21 4147.09,-2821.58 4128,-2814.23 4096.99,-2802.31 4063.66,-2791.22 4030.79,-2781.23"/>
<polygon fill="black" stroke="black" points="4031.65,-2777.83 4021.06,-2778.3 4029.63,-2784.53 4031.65,-2777.83"/>
</g>
<!-- expert15_l1_tp1&#45;&gt;expert_agg_l1_tp1 -->
<g id="edge277" class="edge">
<title>expert15_l1_tp1&#45;&gt;expert_agg_l1_tp1</title>
<path fill="none" stroke="black" d="M4393.58,-2840.21C4375.64,-2830.81 4354.31,-2820.82 4334,-2814.23 4252.77,-2787.9 4161.61,-2769.16 4078.83,-2756"/>
<polygon fill="black" stroke="black" points="4079.19,-2752.52 4068.77,-2754.43 4078.11,-2759.43 4079.19,-2752.52"/>
</g>
<!-- expert_agg_l1_tp1&#45;&gt;res_add2_l1_tp1 -->
<g id="edge278" class="edge">
<title>expert_agg_l1_tp1&#45;&gt;res_add2_l1_tp1</title>
<path fill="none" stroke="black" d="M4006.3,-2696.54C4128.77,-2677.77 4286.58,-2653.59 4400.6,-2636.12"/>
<polygon fill="black" stroke="black" points="4401.45,-2639.54 4410.81,-2634.56 4400.39,-2632.62 4401.45,-2639.54"/>
</g>
<!-- norm2_l1_tp1 -->
<g id="node191" class="node">
<title>norm2_l1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="5677,-2550.23 5411,-2550.23 5411,-2498.23 5677,-2498.23 5677,-2550.23"/>
<text text-anchor="middle" x="5544" y="-2538.23" font-family="Arial" font-size="10.00">Layer Norm 2 TP1</text>
<text text-anchor="middle" x="5544" y="-2527.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5544" y="-2516.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5544" y="-2505.23" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- res_add2_l1_tp1&#45;&gt;norm2_l1_tp1 -->
<g id="edge280" class="edge">
<title>res_add2_l1_tp1&#45;&gt;norm2_l1_tp1</title>
<path fill="none" stroke="black" d="M4689.26,-2599.19C4877.31,-2582.92 5210.71,-2554.07 5400.78,-2537.63"/>
<polygon fill="black" stroke="black" points="5401.18,-2541.1 5410.84,-2536.76 5400.58,-2534.13 5401.18,-2541.1"/>
</g>
<!-- norm2_l1_tp1&#45;&gt;pipeline_comm_01 -->
<g id="edge451" class="edge">
<title>norm2_l1_tp1&#45;&gt;pipeline_comm_01</title>
<path fill="none" stroke="black" d="M5677.13,-2519.67C6299.82,-2502.98 8925.75,-2432.61 9667.89,-2412.72"/>
<polygon fill="black" stroke="black" points="9668.24,-2416.21 9678.15,-2412.45 9668.06,-2409.21 9668.24,-2416.21"/>
</g>
<!-- mha_qkv_l1_tp2 -->
<g id="node193" class="node">
<title>mha_qkv_l1_tp2</title>
<polygon fill="lightgreen" stroke="black" points="7311.5,-3467.77 7020.5,-3467.77 7020.5,-3415.77 7311.5,-3415.77 7311.5,-3467.77"/>
<text text-anchor="middle" x="7166" y="-3455.77" font-family="Arial" font-size="10.00">MHA QKV TP2</text>
<text text-anchor="middle" x="7166" y="-3444.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7166" y="-3433.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7166" y="-3422.77" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- input_split_l1_tp2&#45;&gt;mha_qkv_l1_tp2 -->
<g id="edge282" class="edge">
<title>input_split_l1_tp2&#45;&gt;mha_qkv_l1_tp2</title>
<path fill="none" stroke="black" d="M7166,-3503.51C7166,-3495.2 7166,-3486.36 7166,-3478.08"/>
<polygon fill="black" stroke="black" points="7169.5,-3477.97 7166,-3467.97 7162.5,-3477.97 7169.5,-3477.97"/>
</g>
<!-- mha_attn_l1_tp2 -->
<g id="node194" class="node">
<title>mha_attn_l1_tp2</title>
<polygon fill="lightgreen" stroke="black" points="7311.5,-3379.77 7020.5,-3379.77 7020.5,-3327.77 7311.5,-3327.77 7311.5,-3379.77"/>
<text text-anchor="middle" x="7166" y="-3367.77" font-family="Arial" font-size="10.00">MHA Attention TP2</text>
<text text-anchor="middle" x="7166" y="-3356.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7166" y="-3345.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7166" y="-3334.77" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- mha_qkv_l1_tp2&#45;&gt;mha_attn_l1_tp2 -->
<g id="edge283" class="edge">
<title>mha_qkv_l1_tp2&#45;&gt;mha_attn_l1_tp2</title>
<path fill="none" stroke="black" d="M7166,-3415.44C7166,-3407.48 7166,-3398.54 7166,-3390.02"/>
<polygon fill="black" stroke="black" points="7169.5,-3389.93 7166,-3379.93 7162.5,-3389.93 7169.5,-3389.93"/>
</g>
<!-- mha_out_l1_tp2 -->
<g id="node195" class="node">
<title>mha_out_l1_tp2</title>
<polygon fill="lightgreen" stroke="black" points="7308,-3291.77 7024,-3291.77 7024,-3239.77 7308,-3239.77 7308,-3291.77"/>
<text text-anchor="middle" x="7166" y="-3279.77" font-family="Arial" font-size="10.00">MHA Output TP2</text>
<text text-anchor="middle" x="7166" y="-3268.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="7166" y="-3257.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7166" y="-3246.77" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- mha_attn_l1_tp2&#45;&gt;mha_out_l1_tp2 -->
<g id="edge284" class="edge">
<title>mha_attn_l1_tp2&#45;&gt;mha_out_l1_tp2</title>
<path fill="none" stroke="black" d="M7166,-3327.44C7166,-3319.48 7166,-3310.54 7166,-3302.02"/>
<polygon fill="black" stroke="black" points="7169.5,-3301.93 7166,-3291.93 7162.5,-3301.93 7169.5,-3301.93"/>
</g>
<!-- attn_allreduce_l1_tp2 -->
<g id="node196" class="node">
<title>attn_allreduce_l1_tp2</title>
<ellipse fill="lightgray" stroke="black" cx="7166" cy="-3167" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="7166" y="-3181" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP2</text>
<text text-anchor="middle" x="7166" y="-3170" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7166" y="-3159" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7166" y="-3148" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- mha_out_l1_tp2&#45;&gt;attn_allreduce_l1_tp2 -->
<g id="edge285" class="edge">
<title>mha_out_l1_tp2&#45;&gt;attn_allreduce_l1_tp2</title>
<path fill="none" stroke="black" d="M7166,-3239.6C7166,-3231.79 7166,-3222.93 7166,-3214.16"/>
<polygon fill="black" stroke="black" points="7169.5,-3213.98 7166,-3203.98 7162.5,-3213.98 7169.5,-3213.98"/>
</g>
<!-- attn_allreduce_l1_tp2&#45;&gt;res_add_l1_tp2 -->
<g id="edge287" class="edge">
<title>attn_allreduce_l1_tp2&#45;&gt;res_add_l1_tp2</title>
<path fill="none" stroke="black" d="M7166,-3129.97C7166,-3121.66 7166,-3112.82 7166,-3104.54"/>
<polygon fill="black" stroke="black" points="7169.5,-3104.43 7166,-3094.43 7162.5,-3104.43 7169.5,-3104.43"/>
</g>
<!-- norm_l1_tp2 -->
<g id="node198" class="node">
<title>norm_l1_tp2</title>
<polygon fill="lightgreen" stroke="black" points="6224,-3006.23 5958,-3006.23 5958,-2954.23 6224,-2954.23 6224,-3006.23"/>
<text text-anchor="middle" x="6091" y="-2994.23" font-family="Arial" font-size="10.00">Layer Norm TP2</text>
<text text-anchor="middle" x="6091" y="-2983.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6091" y="-2972.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6091" y="-2961.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- res_add_l1_tp2&#45;&gt;norm_l1_tp2 -->
<g id="edge288" class="edge">
<title>res_add_l1_tp2&#45;&gt;norm_l1_tp2</title>
<path fill="none" stroke="black" d="M7026.84,-3056.1C6822.08,-3039.72 6441.54,-3009.28 6234.39,-2992.71"/>
<polygon fill="black" stroke="black" points="6234.6,-2989.21 6224.35,-2991.9 6234.04,-2996.19 6234.6,-2989.21"/>
</g>
<!-- gate_l1_tp2 -->
<g id="node199" class="node">
<title>gate_l1_tp2</title>
<polygon fill="lightyellow" stroke="black" points="5155.3,-2918.23 4688.72,-2918.23 4568.7,-2814.23 5035.28,-2814.23 5155.3,-2918.23"/>
<text text-anchor="middle" x="4862" y="-2880.23" font-family="Arial" font-size="10.00">Gate Network TP2</text>
<text text-anchor="middle" x="4862" y="-2869.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4862" y="-2858.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="4862" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l1_tp2&#45;&gt;gate_l1_tp2 -->
<g id="edge289" class="edge">
<title>norm_l1_tp2&#45;&gt;gate_l1_tp2</title>
<path fill="none" stroke="black" d="M5957.83,-2974.72C5777.42,-2967.64 5445.54,-2951.18 5164,-2918.23 5163.9,-2918.22 5163.79,-2918.21 5163.69,-2918.2"/>
<polygon fill="black" stroke="black" points="5164.39,-2914.76 5154.04,-2917.04 5163.56,-2921.71 5164.39,-2914.76"/>
</g>
<!-- expert16_l1_tp2 -->
<g id="node200" class="node">
<title>expert16_l1_tp2</title>
<polygon fill="lightcoral" stroke="black" points="5361,-2892.23 5173,-2892.23 5173,-2840.23 5361,-2840.23 5361,-2892.23"/>
<text text-anchor="middle" x="5267" y="-2880.23" font-family="Arial" font-size="10.00">Expert 16</text>
<text text-anchor="middle" x="5267" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5267" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5267" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l1_tp2&#45;&gt;expert16_l1_tp2 -->
<g id="edge290" class="edge">
<title>norm_l1_tp2&#45;&gt;expert16_l1_tp2</title>
<path fill="none" stroke="black" d="M5957.99,-2973.93C5780.76,-2965.83 5477.08,-2948.11 5370,-2918.23 5352.33,-2913.3 5334.06,-2905.34 5317.91,-2897.15"/>
<polygon fill="black" stroke="black" points="5319.15,-2893.85 5308.66,-2892.32 5315.91,-2900.05 5319.15,-2893.85"/>
</g>
<!-- expert17_l1_tp2 -->
<g id="node201" class="node">
<title>expert17_l1_tp2</title>
<polygon fill="lightcoral" stroke="black" points="5567,-2892.23 5379,-2892.23 5379,-2840.23 5567,-2840.23 5567,-2892.23"/>
<text text-anchor="middle" x="5473" y="-2880.23" font-family="Arial" font-size="10.00">Expert 17</text>
<text text-anchor="middle" x="5473" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5473" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5473" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l1_tp2&#45;&gt;expert17_l1_tp2 -->
<g id="edge292" class="edge">
<title>norm_l1_tp2&#45;&gt;expert17_l1_tp2</title>
<path fill="none" stroke="black" d="M5957.79,-2975.89C5852.31,-2970.3 5702.22,-2955.74 5576,-2918.23 5558.57,-2913.06 5540.5,-2905.1 5524.45,-2897.01"/>
<polygon fill="black" stroke="black" points="5525.75,-2893.74 5515.26,-2892.24 5522.53,-2899.95 5525.75,-2893.74"/>
</g>
<!-- expert18_l1_tp2 -->
<g id="node202" class="node">
<title>expert18_l1_tp2</title>
<polygon fill="lightcoral" stroke="black" points="5773,-2892.23 5585,-2892.23 5585,-2840.23 5773,-2840.23 5773,-2892.23"/>
<text text-anchor="middle" x="5679" y="-2880.23" font-family="Arial" font-size="10.00">Expert 18</text>
<text text-anchor="middle" x="5679" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5679" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5679" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l1_tp2&#45;&gt;expert18_l1_tp2 -->
<g id="edge294" class="edge">
<title>norm_l1_tp2&#45;&gt;expert18_l1_tp2</title>
<path fill="none" stroke="black" d="M5957.8,-2960.88C5902.54,-2951.24 5838.31,-2937.35 5782,-2918.23 5765.26,-2912.55 5747.77,-2904.69 5732.05,-2896.84"/>
<polygon fill="black" stroke="black" points="5733.52,-2893.66 5723.02,-2892.24 5730.34,-2899.9 5733.52,-2893.66"/>
</g>
<!-- expert19_l1_tp2 -->
<g id="node203" class="node">
<title>expert19_l1_tp2</title>
<polygon fill="lightcoral" stroke="black" points="5979,-2892.23 5791,-2892.23 5791,-2840.23 5979,-2840.23 5979,-2892.23"/>
<text text-anchor="middle" x="5885" y="-2880.23" font-family="Arial" font-size="10.00">Expert 19</text>
<text text-anchor="middle" x="5885" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5885" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5885" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l1_tp2&#45;&gt;expert19_l1_tp2 -->
<g id="edge296" class="edge">
<title>norm_l1_tp2&#45;&gt;expert19_l1_tp2</title>
<path fill="none" stroke="black" d="M6044.77,-2954.1C6013.76,-2937.24 5972.76,-2914.95 5940.06,-2897.17"/>
<polygon fill="black" stroke="black" points="5941.53,-2893.99 5931.08,-2892.29 5938.19,-2900.14 5941.53,-2893.99"/>
</g>
<!-- expert20_l1_tp2 -->
<g id="node204" class="node">
<title>expert20_l1_tp2</title>
<polygon fill="lightcoral" stroke="black" points="6185,-2892.23 5997,-2892.23 5997,-2840.23 6185,-2840.23 6185,-2892.23"/>
<text text-anchor="middle" x="6091" y="-2880.23" font-family="Arial" font-size="10.00">Expert 20</text>
<text text-anchor="middle" x="6091" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6091" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6091" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l1_tp2&#45;&gt;expert20_l1_tp2 -->
<g id="edge298" class="edge">
<title>norm_l1_tp2&#45;&gt;expert20_l1_tp2</title>
<path fill="none" stroke="black" d="M6091,-2954.1C6091,-2938.82 6091,-2919.09 6091,-2902.3"/>
<polygon fill="black" stroke="black" points="6094.5,-2902.29 6091,-2892.29 6087.5,-2902.29 6094.5,-2902.29"/>
</g>
<!-- expert21_l1_tp2 -->
<g id="node205" class="node">
<title>expert21_l1_tp2</title>
<polygon fill="lightcoral" stroke="black" points="6391,-2892.23 6203,-2892.23 6203,-2840.23 6391,-2840.23 6391,-2892.23"/>
<text text-anchor="middle" x="6297" y="-2880.23" font-family="Arial" font-size="10.00">Expert 21</text>
<text text-anchor="middle" x="6297" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6297" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6297" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l1_tp2&#45;&gt;expert21_l1_tp2 -->
<g id="edge300" class="edge">
<title>norm_l1_tp2&#45;&gt;expert21_l1_tp2</title>
<path fill="none" stroke="black" d="M6137.23,-2954.1C6168.24,-2937.24 6209.24,-2914.95 6241.94,-2897.17"/>
<polygon fill="black" stroke="black" points="6243.81,-2900.14 6250.92,-2892.29 6240.47,-2893.99 6243.81,-2900.14"/>
</g>
<!-- expert22_l1_tp2 -->
<g id="node206" class="node">
<title>expert22_l1_tp2</title>
<polygon fill="lightcoral" stroke="black" points="6597,-2892.23 6409,-2892.23 6409,-2840.23 6597,-2840.23 6597,-2892.23"/>
<text text-anchor="middle" x="6503" y="-2880.23" font-family="Arial" font-size="10.00">Expert 22</text>
<text text-anchor="middle" x="6503" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6503" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6503" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l1_tp2&#45;&gt;expert22_l1_tp2 -->
<g id="edge302" class="edge">
<title>norm_l1_tp2&#45;&gt;expert22_l1_tp2</title>
<path fill="none" stroke="black" d="M6224.2,-2960.88C6279.46,-2951.24 6343.69,-2937.35 6400,-2918.23 6416.74,-2912.55 6434.23,-2904.69 6449.95,-2896.84"/>
<polygon fill="black" stroke="black" points="6451.66,-2899.9 6458.98,-2892.24 6448.48,-2893.66 6451.66,-2899.9"/>
</g>
<!-- expert23_l1_tp2 -->
<g id="node207" class="node">
<title>expert23_l1_tp2</title>
<polygon fill="lightcoral" stroke="black" points="6803,-2892.23 6615,-2892.23 6615,-2840.23 6803,-2840.23 6803,-2892.23"/>
<text text-anchor="middle" x="6709" y="-2880.23" font-family="Arial" font-size="10.00">Expert 23</text>
<text text-anchor="middle" x="6709" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6709" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6709" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l1_tp2&#45;&gt;expert23_l1_tp2 -->
<g id="edge304" class="edge">
<title>norm_l1_tp2&#45;&gt;expert23_l1_tp2</title>
<path fill="none" stroke="black" d="M6224.21,-2975.89C6329.69,-2970.3 6479.78,-2955.74 6606,-2918.23 6623.43,-2913.06 6641.5,-2905.1 6657.55,-2897.01"/>
<polygon fill="black" stroke="black" points="6659.47,-2899.95 6666.74,-2892.24 6656.25,-2893.74 6659.47,-2899.95"/>
</g>
<!-- res_add2_l1_tp2 -->
<g id="node209" class="node">
<title>res_add2_l1_tp2</title>
<polygon fill="lightgreen" stroke="black" points="6961,-2638.23 6683,-2638.23 6683,-2586.23 6961,-2586.23 6961,-2638.23"/>
<text text-anchor="middle" x="6822" y="-2626.23" font-family="Arial" font-size="10.00">Residual Add 2 TP2</text>
<text text-anchor="middle" x="6822" y="-2615.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="6822" y="-2604.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6822" y="-2593.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- norm_l1_tp2&#45;&gt;res_add2_l1_tp2 -->
<g id="edge307" class="edge">
<title>norm_l1_tp2&#45;&gt;res_add2_l1_tp2</title>
<path fill="none" stroke="black" d="M6224.2,-2977.34C6421.48,-2973.15 6772.45,-2959.88 6812,-2918.23 6830.21,-2899.06 6826.1,-2724.35 6823.41,-2648.32"/>
<polygon fill="black" stroke="black" points="6826.9,-2648.14 6823.04,-2638.27 6819.91,-2648.39 6826.9,-2648.14"/>
</g>
<!-- expert_agg_l1_tp2 -->
<g id="node208" class="node">
<title>expert_agg_l1_tp2</title>
<polygon fill="lightpink" stroke="black" points="6366.55,-2778.23 5928.21,-2778.23 5815.45,-2674.23 6253.79,-2674.23 6366.55,-2778.23"/>
<text text-anchor="middle" x="6091" y="-2740.23" font-family="Arial" font-size="10.00">Expert Aggregation TP2</text>
<text text-anchor="middle" x="6091" y="-2729.23" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="6091" y="-2718.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6091" y="-2707.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- expert16_l1_tp2&#45;&gt;expert_agg_l1_tp2 -->
<g id="edge291" class="edge">
<title>expert16_l1_tp2&#45;&gt;expert_agg_l1_tp2</title>
<path fill="none" stroke="black" d="M5309.77,-2839.98C5327.79,-2830.43 5349.35,-2820.4 5370,-2814.23 5533.12,-2765.57 5724.72,-2744.04 5869.39,-2734.56"/>
<polygon fill="black" stroke="black" points="5869.97,-2738.03 5879.72,-2733.89 5869.52,-2731.04 5869.97,-2738.03"/>
</g>
<!-- expert17_l1_tp2&#45;&gt;expert_agg_l1_tp2 -->
<g id="edge293" class="edge">
<title>expert17_l1_tp2&#45;&gt;expert_agg_l1_tp2</title>
<path fill="none" stroke="black" d="M5516.42,-2840.21C5534.36,-2830.81 5555.69,-2820.82 5576,-2814.23 5674.93,-2782.16 5788.58,-2761.36 5883.91,-2748.17"/>
<polygon fill="black" stroke="black" points="5884.53,-2751.62 5893.96,-2746.8 5883.58,-2744.69 5884.53,-2751.62"/>
</g>
<!-- expert18_l1_tp2&#45;&gt;expert_agg_l1_tp2 -->
<g id="edge295" class="edge">
<title>expert18_l1_tp2&#45;&gt;expert_agg_l1_tp2</title>
<path fill="none" stroke="black" d="M5725.1,-2840.13C5742.59,-2831.21 5762.91,-2821.58 5782,-2814.23 5822.42,-2798.69 5866.76,-2784.57 5908.93,-2772.44"/>
<polygon fill="black" stroke="black" points="5910.09,-2775.75 5918.74,-2769.64 5908.17,-2769.02 5910.09,-2775.75"/>
</g>
<!-- expert19_l1_tp2&#45;&gt;expert_agg_l1_tp2 -->
<g id="edge297" class="edge">
<title>expert19_l1_tp2&#45;&gt;expert_agg_l1_tp2</title>
<path fill="none" stroke="black" d="M5922.78,-2839.92C5946.15,-2824.27 5977.12,-2803.53 6006.11,-2784.1"/>
<polygon fill="black" stroke="black" points="6008.27,-2786.87 6014.63,-2778.4 6004.37,-2781.05 6008.27,-2786.87"/>
</g>
<!-- expert20_l1_tp2&#45;&gt;expert_agg_l1_tp2 -->
<g id="edge299" class="edge">
<title>expert20_l1_tp2&#45;&gt;expert_agg_l1_tp2</title>
<path fill="none" stroke="black" d="M6091,-2839.92C6091,-2825.48 6091,-2806.7 6091,-2788.63"/>
<polygon fill="black" stroke="black" points="6094.5,-2788.4 6091,-2778.4 6087.5,-2788.4 6094.5,-2788.4"/>
</g>
<!-- expert21_l1_tp2&#45;&gt;expert_agg_l1_tp2 -->
<g id="edge301" class="edge">
<title>expert21_l1_tp2&#45;&gt;expert_agg_l1_tp2</title>
<path fill="none" stroke="black" d="M6259.22,-2839.92C6235.85,-2824.27 6204.88,-2803.53 6175.89,-2784.1"/>
<polygon fill="black" stroke="black" points="6177.63,-2781.05 6167.37,-2778.4 6173.73,-2786.87 6177.63,-2781.05"/>
</g>
<!-- expert22_l1_tp2&#45;&gt;expert_agg_l1_tp2 -->
<g id="edge303" class="edge">
<title>expert22_l1_tp2&#45;&gt;expert_agg_l1_tp2</title>
<path fill="none" stroke="black" d="M6456.9,-2840.13C6439.41,-2831.21 6419.09,-2821.58 6400,-2814.23 6368.99,-2802.31 6335.66,-2791.22 6302.79,-2781.23"/>
<polygon fill="black" stroke="black" points="6303.65,-2777.83 6293.06,-2778.3 6301.63,-2784.53 6303.65,-2777.83"/>
</g>
<!-- expert23_l1_tp2&#45;&gt;expert_agg_l1_tp2 -->
<g id="edge305" class="edge">
<title>expert23_l1_tp2&#45;&gt;expert_agg_l1_tp2</title>
<path fill="none" stroke="black" d="M6665.58,-2840.21C6647.64,-2830.81 6626.31,-2820.82 6606,-2814.23 6524.77,-2787.9 6433.61,-2769.16 6350.83,-2756"/>
<polygon fill="black" stroke="black" points="6351.19,-2752.52 6340.77,-2754.43 6350.11,-2759.43 6351.19,-2752.52"/>
</g>
<!-- expert_agg_l1_tp2&#45;&gt;res_add2_l1_tp2 -->
<g id="edge306" class="edge">
<title>expert_agg_l1_tp2&#45;&gt;res_add2_l1_tp2</title>
<path fill="none" stroke="black" d="M6278.3,-2696.54C6400.77,-2677.77 6558.58,-2653.59 6672.6,-2636.12"/>
<polygon fill="black" stroke="black" points="6673.45,-2639.54 6682.81,-2634.56 6672.39,-2632.62 6673.45,-2639.54"/>
</g>
<!-- norm2_l1_tp2 -->
<g id="node210" class="node">
<title>norm2_l1_tp2</title>
<polygon fill="lightgreen" stroke="black" points="7949,-2550.23 7683,-2550.23 7683,-2498.23 7949,-2498.23 7949,-2550.23"/>
<text text-anchor="middle" x="7816" y="-2538.23" font-family="Arial" font-size="10.00">Layer Norm 2 TP2</text>
<text text-anchor="middle" x="7816" y="-2527.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7816" y="-2516.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7816" y="-2505.23" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- res_add2_l1_tp2&#45;&gt;norm2_l1_tp2 -->
<g id="edge308" class="edge">
<title>res_add2_l1_tp2&#45;&gt;norm2_l1_tp2</title>
<path fill="none" stroke="black" d="M6961.26,-2599.19C7149.31,-2582.92 7482.71,-2554.07 7672.78,-2537.63"/>
<polygon fill="black" stroke="black" points="7673.18,-2541.1 7682.84,-2536.76 7672.58,-2534.13 7673.18,-2541.1"/>
</g>
<!-- norm2_l1_tp2&#45;&gt;pipeline_comm_01 -->
<g id="edge453" class="edge">
<title>norm2_l1_tp2&#45;&gt;pipeline_comm_01</title>
<path fill="none" stroke="black" d="M7949.19,-2515.71C8302.47,-2495.74 9264.3,-2441.36 9674.53,-2418.18"/>
<polygon fill="black" stroke="black" points="9674.92,-2421.66 9684.71,-2417.6 9674.53,-2414.67 9674.92,-2421.66"/>
</g>
<!-- mha_qkv_l1_tp3 -->
<g id="node212" class="node">
<title>mha_qkv_l1_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8644.5,-3467.77 8353.5,-3467.77 8353.5,-3415.77 8644.5,-3415.77 8644.5,-3467.77"/>
<text text-anchor="middle" x="8499" y="-3455.77" font-family="Arial" font-size="10.00">MHA QKV TP3</text>
<text text-anchor="middle" x="8499" y="-3444.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8499" y="-3433.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8499" y="-3422.77" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- input_split_l1_tp3&#45;&gt;mha_qkv_l1_tp3 -->
<g id="edge310" class="edge">
<title>input_split_l1_tp3&#45;&gt;mha_qkv_l1_tp3</title>
<path fill="none" stroke="black" d="M8499,-3503.51C8499,-3495.2 8499,-3486.36 8499,-3478.08"/>
<polygon fill="black" stroke="black" points="8502.5,-3477.97 8499,-3467.97 8495.5,-3477.97 8502.5,-3477.97"/>
</g>
<!-- mha_attn_l1_tp3 -->
<g id="node213" class="node">
<title>mha_attn_l1_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8644.5,-3379.77 8353.5,-3379.77 8353.5,-3327.77 8644.5,-3327.77 8644.5,-3379.77"/>
<text text-anchor="middle" x="8499" y="-3367.77" font-family="Arial" font-size="10.00">MHA Attention TP3</text>
<text text-anchor="middle" x="8499" y="-3356.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8499" y="-3345.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8499" y="-3334.77" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- mha_qkv_l1_tp3&#45;&gt;mha_attn_l1_tp3 -->
<g id="edge311" class="edge">
<title>mha_qkv_l1_tp3&#45;&gt;mha_attn_l1_tp3</title>
<path fill="none" stroke="black" d="M8499,-3415.44C8499,-3407.48 8499,-3398.54 8499,-3390.02"/>
<polygon fill="black" stroke="black" points="8502.5,-3389.93 8499,-3379.93 8495.5,-3389.93 8502.5,-3389.93"/>
</g>
<!-- mha_out_l1_tp3 -->
<g id="node214" class="node">
<title>mha_out_l1_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8641,-3291.77 8357,-3291.77 8357,-3239.77 8641,-3239.77 8641,-3291.77"/>
<text text-anchor="middle" x="8499" y="-3279.77" font-family="Arial" font-size="10.00">MHA Output TP3</text>
<text text-anchor="middle" x="8499" y="-3268.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8499" y="-3257.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8499" y="-3246.77" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- mha_attn_l1_tp3&#45;&gt;mha_out_l1_tp3 -->
<g id="edge312" class="edge">
<title>mha_attn_l1_tp3&#45;&gt;mha_out_l1_tp3</title>
<path fill="none" stroke="black" d="M8499,-3327.44C8499,-3319.48 8499,-3310.54 8499,-3302.02"/>
<polygon fill="black" stroke="black" points="8502.5,-3301.93 8499,-3291.93 8495.5,-3301.93 8502.5,-3301.93"/>
</g>
<!-- attn_allreduce_l1_tp3 -->
<g id="node215" class="node">
<title>attn_allreduce_l1_tp3</title>
<ellipse fill="lightgray" stroke="black" cx="8499" cy="-3167" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8499" y="-3181" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP3</text>
<text text-anchor="middle" x="8499" y="-3170" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8499" y="-3159" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8499" y="-3148" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- mha_out_l1_tp3&#45;&gt;attn_allreduce_l1_tp3 -->
<g id="edge313" class="edge">
<title>mha_out_l1_tp3&#45;&gt;attn_allreduce_l1_tp3</title>
<path fill="none" stroke="black" d="M8499,-3239.6C8499,-3231.79 8499,-3222.93 8499,-3214.16"/>
<polygon fill="black" stroke="black" points="8502.5,-3213.98 8499,-3203.98 8495.5,-3213.98 8502.5,-3213.98"/>
</g>
<!-- attn_allreduce_l1_tp3&#45;&gt;res_add_l1_tp3 -->
<g id="edge315" class="edge">
<title>attn_allreduce_l1_tp3&#45;&gt;res_add_l1_tp3</title>
<path fill="none" stroke="black" d="M8499,-3129.97C8499,-3121.66 8499,-3112.82 8499,-3104.54"/>
<polygon fill="black" stroke="black" points="8502.5,-3104.43 8499,-3094.43 8495.5,-3104.43 8502.5,-3104.43"/>
</g>
<!-- norm_l1_tp3 -->
<g id="node217" class="node">
<title>norm_l1_tp3</title>
<polygon fill="lightgreen" stroke="black" points="8496,-3006.23 8230,-3006.23 8230,-2954.23 8496,-2954.23 8496,-3006.23"/>
<text text-anchor="middle" x="8363" y="-2994.23" font-family="Arial" font-size="10.00">Layer Norm TP3</text>
<text text-anchor="middle" x="8363" y="-2983.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8363" y="-2972.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8363" y="-2961.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- res_add_l1_tp3&#45;&gt;norm_l1_tp3 -->
<g id="edge316" class="edge">
<title>res_add_l1_tp3&#45;&gt;norm_l1_tp3</title>
<path fill="none" stroke="black" d="M8459.3,-3042.13C8444.35,-3032.67 8427.18,-3021.82 8411.51,-3011.91"/>
<polygon fill="black" stroke="black" points="8413.31,-3008.91 8402.99,-3006.52 8409.57,-3014.82 8413.31,-3008.91"/>
</g>
<!-- gate_l1_tp3 -->
<g id="node218" class="node">
<title>gate_l1_tp3</title>
<polygon fill="lightyellow" stroke="black" points="7427.3,-2918.23 6960.72,-2918.23 6840.7,-2814.23 7307.28,-2814.23 7427.3,-2918.23"/>
<text text-anchor="middle" x="7134" y="-2880.23" font-family="Arial" font-size="10.00">Gate Network TP3</text>
<text text-anchor="middle" x="7134" y="-2869.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7134" y="-2858.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="7134" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l1_tp3&#45;&gt;gate_l1_tp3 -->
<g id="edge317" class="edge">
<title>norm_l1_tp3&#45;&gt;gate_l1_tp3</title>
<path fill="none" stroke="black" d="M8229.83,-2974.72C8049.42,-2967.64 7717.54,-2951.18 7436,-2918.23 7435.9,-2918.22 7435.79,-2918.21 7435.69,-2918.2"/>
<polygon fill="black" stroke="black" points="7436.39,-2914.76 7426.04,-2917.04 7435.56,-2921.71 7436.39,-2914.76"/>
</g>
<!-- expert24_l1_tp3 -->
<g id="node219" class="node">
<title>expert24_l1_tp3</title>
<polygon fill="lightcoral" stroke="black" points="7633,-2892.23 7445,-2892.23 7445,-2840.23 7633,-2840.23 7633,-2892.23"/>
<text text-anchor="middle" x="7539" y="-2880.23" font-family="Arial" font-size="10.00">Expert 24</text>
<text text-anchor="middle" x="7539" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7539" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7539" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l1_tp3&#45;&gt;expert24_l1_tp3 -->
<g id="edge318" class="edge">
<title>norm_l1_tp3&#45;&gt;expert24_l1_tp3</title>
<path fill="none" stroke="black" d="M8229.99,-2973.93C8052.76,-2965.83 7749.08,-2948.11 7642,-2918.23 7624.33,-2913.3 7606.06,-2905.34 7589.91,-2897.15"/>
<polygon fill="black" stroke="black" points="7591.15,-2893.85 7580.66,-2892.32 7587.91,-2900.05 7591.15,-2893.85"/>
</g>
<!-- expert25_l1_tp3 -->
<g id="node220" class="node">
<title>expert25_l1_tp3</title>
<polygon fill="lightcoral" stroke="black" points="7839,-2892.23 7651,-2892.23 7651,-2840.23 7839,-2840.23 7839,-2892.23"/>
<text text-anchor="middle" x="7745" y="-2880.23" font-family="Arial" font-size="10.00">Expert 25</text>
<text text-anchor="middle" x="7745" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7745" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7745" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l1_tp3&#45;&gt;expert25_l1_tp3 -->
<g id="edge320" class="edge">
<title>norm_l1_tp3&#45;&gt;expert25_l1_tp3</title>
<path fill="none" stroke="black" d="M8229.79,-2975.89C8124.31,-2970.3 7974.22,-2955.74 7848,-2918.23 7830.57,-2913.06 7812.5,-2905.1 7796.45,-2897.01"/>
<polygon fill="black" stroke="black" points="7797.75,-2893.74 7787.26,-2892.24 7794.53,-2899.95 7797.75,-2893.74"/>
</g>
<!-- expert26_l1_tp3 -->
<g id="node221" class="node">
<title>expert26_l1_tp3</title>
<polygon fill="lightcoral" stroke="black" points="8045,-2892.23 7857,-2892.23 7857,-2840.23 8045,-2840.23 8045,-2892.23"/>
<text text-anchor="middle" x="7951" y="-2880.23" font-family="Arial" font-size="10.00">Expert 26</text>
<text text-anchor="middle" x="7951" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7951" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7951" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l1_tp3&#45;&gt;expert26_l1_tp3 -->
<g id="edge322" class="edge">
<title>norm_l1_tp3&#45;&gt;expert26_l1_tp3</title>
<path fill="none" stroke="black" d="M8229.8,-2960.88C8174.54,-2951.24 8110.31,-2937.35 8054,-2918.23 8037.26,-2912.55 8019.77,-2904.69 8004.05,-2896.84"/>
<polygon fill="black" stroke="black" points="8005.52,-2893.66 7995.02,-2892.24 8002.34,-2899.9 8005.52,-2893.66"/>
</g>
<!-- expert27_l1_tp3 -->
<g id="node222" class="node">
<title>expert27_l1_tp3</title>
<polygon fill="lightcoral" stroke="black" points="8251,-2892.23 8063,-2892.23 8063,-2840.23 8251,-2840.23 8251,-2892.23"/>
<text text-anchor="middle" x="8157" y="-2880.23" font-family="Arial" font-size="10.00">Expert 27</text>
<text text-anchor="middle" x="8157" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8157" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8157" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l1_tp3&#45;&gt;expert27_l1_tp3 -->
<g id="edge324" class="edge">
<title>norm_l1_tp3&#45;&gt;expert27_l1_tp3</title>
<path fill="none" stroke="black" d="M8316.77,-2954.1C8285.76,-2937.24 8244.76,-2914.95 8212.06,-2897.17"/>
<polygon fill="black" stroke="black" points="8213.53,-2893.99 8203.08,-2892.29 8210.19,-2900.14 8213.53,-2893.99"/>
</g>
<!-- expert28_l1_tp3 -->
<g id="node223" class="node">
<title>expert28_l1_tp3</title>
<polygon fill="lightcoral" stroke="black" points="8457,-2892.23 8269,-2892.23 8269,-2840.23 8457,-2840.23 8457,-2892.23"/>
<text text-anchor="middle" x="8363" y="-2880.23" font-family="Arial" font-size="10.00">Expert 28</text>
<text text-anchor="middle" x="8363" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8363" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8363" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l1_tp3&#45;&gt;expert28_l1_tp3 -->
<g id="edge326" class="edge">
<title>norm_l1_tp3&#45;&gt;expert28_l1_tp3</title>
<path fill="none" stroke="black" d="M8363,-2954.1C8363,-2938.82 8363,-2919.09 8363,-2902.3"/>
<polygon fill="black" stroke="black" points="8366.5,-2902.29 8363,-2892.29 8359.5,-2902.29 8366.5,-2902.29"/>
</g>
<!-- expert29_l1_tp3 -->
<g id="node224" class="node">
<title>expert29_l1_tp3</title>
<polygon fill="lightcoral" stroke="black" points="8663,-2892.23 8475,-2892.23 8475,-2840.23 8663,-2840.23 8663,-2892.23"/>
<text text-anchor="middle" x="8569" y="-2880.23" font-family="Arial" font-size="10.00">Expert 29</text>
<text text-anchor="middle" x="8569" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8569" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8569" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l1_tp3&#45;&gt;expert29_l1_tp3 -->
<g id="edge328" class="edge">
<title>norm_l1_tp3&#45;&gt;expert29_l1_tp3</title>
<path fill="none" stroke="black" d="M8409.23,-2954.1C8440.24,-2937.24 8481.24,-2914.95 8513.94,-2897.17"/>
<polygon fill="black" stroke="black" points="8515.81,-2900.14 8522.92,-2892.29 8512.47,-2893.99 8515.81,-2900.14"/>
</g>
<!-- expert30_l1_tp3 -->
<g id="node225" class="node">
<title>expert30_l1_tp3</title>
<polygon fill="lightcoral" stroke="black" points="8869,-2892.23 8681,-2892.23 8681,-2840.23 8869,-2840.23 8869,-2892.23"/>
<text text-anchor="middle" x="8775" y="-2880.23" font-family="Arial" font-size="10.00">Expert 30</text>
<text text-anchor="middle" x="8775" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8775" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8775" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l1_tp3&#45;&gt;expert30_l1_tp3 -->
<g id="edge330" class="edge">
<title>norm_l1_tp3&#45;&gt;expert30_l1_tp3</title>
<path fill="none" stroke="black" d="M8496.2,-2960.88C8551.46,-2951.24 8615.69,-2937.35 8672,-2918.23 8688.74,-2912.55 8706.23,-2904.69 8721.95,-2896.84"/>
<polygon fill="black" stroke="black" points="8723.66,-2899.9 8730.98,-2892.24 8720.48,-2893.66 8723.66,-2899.9"/>
</g>
<!-- expert31_l1_tp3 -->
<g id="node226" class="node">
<title>expert31_l1_tp3</title>
<polygon fill="lightcoral" stroke="black" points="9075,-2892.23 8887,-2892.23 8887,-2840.23 9075,-2840.23 9075,-2892.23"/>
<text text-anchor="middle" x="8981" y="-2880.23" font-family="Arial" font-size="10.00">Expert 31</text>
<text text-anchor="middle" x="8981" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8981" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8981" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l1_tp3&#45;&gt;expert31_l1_tp3 -->
<g id="edge332" class="edge">
<title>norm_l1_tp3&#45;&gt;expert31_l1_tp3</title>
<path fill="none" stroke="black" d="M8496.21,-2975.89C8601.69,-2970.3 8751.78,-2955.74 8878,-2918.23 8895.43,-2913.06 8913.5,-2905.1 8929.55,-2897.01"/>
<polygon fill="black" stroke="black" points="8931.47,-2899.95 8938.74,-2892.24 8928.25,-2893.74 8931.47,-2899.95"/>
</g>
<!-- res_add2_l1_tp3 -->
<g id="node228" class="node">
<title>res_add2_l1_tp3</title>
<polygon fill="lightgreen" stroke="black" points="9233,-2638.23 8955,-2638.23 8955,-2586.23 9233,-2586.23 9233,-2638.23"/>
<text text-anchor="middle" x="9094" y="-2626.23" font-family="Arial" font-size="10.00">Residual Add 2 TP3</text>
<text text-anchor="middle" x="9094" y="-2615.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="9094" y="-2604.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9094" y="-2593.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- norm_l1_tp3&#45;&gt;res_add2_l1_tp3 -->
<g id="edge335" class="edge">
<title>norm_l1_tp3&#45;&gt;res_add2_l1_tp3</title>
<path fill="none" stroke="black" d="M8496.2,-2977.34C8693.48,-2973.15 9044.45,-2959.88 9084,-2918.23 9102.21,-2899.06 9098.1,-2724.35 9095.41,-2648.32"/>
<polygon fill="black" stroke="black" points="9098.9,-2648.14 9095.04,-2638.27 9091.91,-2648.39 9098.9,-2648.14"/>
</g>
<!-- expert_agg_l1_tp3 -->
<g id="node227" class="node">
<title>expert_agg_l1_tp3</title>
<polygon fill="lightpink" stroke="black" points="8638.55,-2778.23 8200.21,-2778.23 8087.45,-2674.23 8525.79,-2674.23 8638.55,-2778.23"/>
<text text-anchor="middle" x="8363" y="-2740.23" font-family="Arial" font-size="10.00">Expert Aggregation TP3</text>
<text text-anchor="middle" x="8363" y="-2729.23" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="8363" y="-2718.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8363" y="-2707.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- expert24_l1_tp3&#45;&gt;expert_agg_l1_tp3 -->
<g id="edge319" class="edge">
<title>expert24_l1_tp3&#45;&gt;expert_agg_l1_tp3</title>
<path fill="none" stroke="black" d="M7581.77,-2839.98C7599.79,-2830.43 7621.35,-2820.4 7642,-2814.23 7805.12,-2765.57 7996.72,-2744.04 8141.39,-2734.56"/>
<polygon fill="black" stroke="black" points="8141.97,-2738.03 8151.72,-2733.89 8141.52,-2731.04 8141.97,-2738.03"/>
</g>
<!-- expert25_l1_tp3&#45;&gt;expert_agg_l1_tp3 -->
<g id="edge321" class="edge">
<title>expert25_l1_tp3&#45;&gt;expert_agg_l1_tp3</title>
<path fill="none" stroke="black" d="M7788.42,-2840.21C7806.36,-2830.81 7827.69,-2820.82 7848,-2814.23 7946.93,-2782.16 8060.58,-2761.36 8155.91,-2748.17"/>
<polygon fill="black" stroke="black" points="8156.53,-2751.62 8165.96,-2746.8 8155.58,-2744.69 8156.53,-2751.62"/>
</g>
<!-- expert26_l1_tp3&#45;&gt;expert_agg_l1_tp3 -->
<g id="edge323" class="edge">
<title>expert26_l1_tp3&#45;&gt;expert_agg_l1_tp3</title>
<path fill="none" stroke="black" d="M7997.1,-2840.13C8014.59,-2831.21 8034.91,-2821.58 8054,-2814.23 8094.42,-2798.69 8138.76,-2784.57 8180.93,-2772.44"/>
<polygon fill="black" stroke="black" points="8182.09,-2775.75 8190.74,-2769.64 8180.17,-2769.02 8182.09,-2775.75"/>
</g>
<!-- expert27_l1_tp3&#45;&gt;expert_agg_l1_tp3 -->
<g id="edge325" class="edge">
<title>expert27_l1_tp3&#45;&gt;expert_agg_l1_tp3</title>
<path fill="none" stroke="black" d="M8194.78,-2839.92C8218.15,-2824.27 8249.12,-2803.53 8278.11,-2784.1"/>
<polygon fill="black" stroke="black" points="8280.27,-2786.87 8286.63,-2778.4 8276.37,-2781.05 8280.27,-2786.87"/>
</g>
<!-- expert28_l1_tp3&#45;&gt;expert_agg_l1_tp3 -->
<g id="edge327" class="edge">
<title>expert28_l1_tp3&#45;&gt;expert_agg_l1_tp3</title>
<path fill="none" stroke="black" d="M8363,-2839.92C8363,-2825.48 8363,-2806.7 8363,-2788.63"/>
<polygon fill="black" stroke="black" points="8366.5,-2788.4 8363,-2778.4 8359.5,-2788.4 8366.5,-2788.4"/>
</g>
<!-- expert29_l1_tp3&#45;&gt;expert_agg_l1_tp3 -->
<g id="edge329" class="edge">
<title>expert29_l1_tp3&#45;&gt;expert_agg_l1_tp3</title>
<path fill="none" stroke="black" d="M8531.22,-2839.92C8507.85,-2824.27 8476.88,-2803.53 8447.89,-2784.1"/>
<polygon fill="black" stroke="black" points="8449.63,-2781.05 8439.37,-2778.4 8445.73,-2786.87 8449.63,-2781.05"/>
</g>
<!-- expert30_l1_tp3&#45;&gt;expert_agg_l1_tp3 -->
<g id="edge331" class="edge">
<title>expert30_l1_tp3&#45;&gt;expert_agg_l1_tp3</title>
<path fill="none" stroke="black" d="M8728.9,-2840.13C8711.41,-2831.21 8691.09,-2821.58 8672,-2814.23 8640.99,-2802.31 8607.66,-2791.22 8574.79,-2781.23"/>
<polygon fill="black" stroke="black" points="8575.65,-2777.83 8565.06,-2778.3 8573.63,-2784.53 8575.65,-2777.83"/>
</g>
<!-- expert31_l1_tp3&#45;&gt;expert_agg_l1_tp3 -->
<g id="edge333" class="edge">
<title>expert31_l1_tp3&#45;&gt;expert_agg_l1_tp3</title>
<path fill="none" stroke="black" d="M8937.58,-2840.21C8919.64,-2830.81 8898.31,-2820.82 8878,-2814.23 8796.77,-2787.9 8705.61,-2769.16 8622.83,-2756"/>
<polygon fill="black" stroke="black" points="8623.19,-2752.52 8612.77,-2754.43 8622.11,-2759.43 8623.19,-2752.52"/>
</g>
<!-- expert_agg_l1_tp3&#45;&gt;res_add2_l1_tp3 -->
<g id="edge334" class="edge">
<title>expert_agg_l1_tp3&#45;&gt;res_add2_l1_tp3</title>
<path fill="none" stroke="black" d="M8550.3,-2696.54C8672.77,-2677.77 8830.58,-2653.59 8944.6,-2636.12"/>
<polygon fill="black" stroke="black" points="8945.45,-2639.54 8954.81,-2634.56 8944.39,-2632.62 8945.45,-2639.54"/>
</g>
<!-- norm2_l1_tp3 -->
<g id="node229" class="node">
<title>norm2_l1_tp3</title>
<polygon fill="lightgreen" stroke="black" points="9541,-2550.23 9275,-2550.23 9275,-2498.23 9541,-2498.23 9541,-2550.23"/>
<text text-anchor="middle" x="9408" y="-2538.23" font-family="Arial" font-size="10.00">Layer Norm 2 TP3</text>
<text text-anchor="middle" x="9408" y="-2527.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9408" y="-2516.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9408" y="-2505.23" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- res_add2_l1_tp3&#45;&gt;norm2_l1_tp3 -->
<g id="edge336" class="edge">
<title>res_add2_l1_tp3&#45;&gt;norm2_l1_tp3</title>
<path fill="none" stroke="black" d="M9185.67,-2586.13C9223.63,-2575.73 9267.8,-2563.63 9306.72,-2552.97"/>
<polygon fill="black" stroke="black" points="9307.77,-2556.31 9316.49,-2550.3 9305.92,-2549.56 9307.77,-2556.31"/>
</g>
<!-- norm2_l1_tp3&#45;&gt;pipeline_comm_01 -->
<g id="edge455" class="edge">
<title>norm2_l1_tp3&#45;&gt;pipeline_comm_01</title>
<path fill="none" stroke="black" d="M9506.66,-2498.19C9575.59,-2480.69 9668.07,-2457.21 9741.68,-2438.52"/>
<polygon fill="black" stroke="black" points="9742.65,-2441.89 9751.48,-2436.03 9740.93,-2435.1 9742.65,-2441.89"/>
</g>
<!-- mha_qkv_l1_tp4 -->
<g id="node231" class="node">
<title>mha_qkv_l1_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9048.5,-3467.77 8757.5,-3467.77 8757.5,-3415.77 9048.5,-3415.77 9048.5,-3467.77"/>
<text text-anchor="middle" x="8903" y="-3455.77" font-family="Arial" font-size="10.00">MHA QKV TP4</text>
<text text-anchor="middle" x="8903" y="-3444.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8903" y="-3433.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8903" y="-3422.77" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- input_split_l1_tp4&#45;&gt;mha_qkv_l1_tp4 -->
<g id="edge338" class="edge">
<title>input_split_l1_tp4&#45;&gt;mha_qkv_l1_tp4</title>
<path fill="none" stroke="black" d="M8903,-3503.51C8903,-3495.2 8903,-3486.36 8903,-3478.08"/>
<polygon fill="black" stroke="black" points="8906.5,-3477.97 8903,-3467.97 8899.5,-3477.97 8906.5,-3477.97"/>
</g>
<!-- mha_attn_l1_tp4 -->
<g id="node232" class="node">
<title>mha_attn_l1_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9048.5,-3379.77 8757.5,-3379.77 8757.5,-3327.77 9048.5,-3327.77 9048.5,-3379.77"/>
<text text-anchor="middle" x="8903" y="-3367.77" font-family="Arial" font-size="10.00">MHA Attention TP4</text>
<text text-anchor="middle" x="8903" y="-3356.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8903" y="-3345.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8903" y="-3334.77" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- mha_qkv_l1_tp4&#45;&gt;mha_attn_l1_tp4 -->
<g id="edge339" class="edge">
<title>mha_qkv_l1_tp4&#45;&gt;mha_attn_l1_tp4</title>
<path fill="none" stroke="black" d="M8903,-3415.44C8903,-3407.48 8903,-3398.54 8903,-3390.02"/>
<polygon fill="black" stroke="black" points="8906.5,-3389.93 8903,-3379.93 8899.5,-3389.93 8906.5,-3389.93"/>
</g>
<!-- mha_out_l1_tp4 -->
<g id="node233" class="node">
<title>mha_out_l1_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9045,-3291.77 8761,-3291.77 8761,-3239.77 9045,-3239.77 9045,-3291.77"/>
<text text-anchor="middle" x="8903" y="-3279.77" font-family="Arial" font-size="10.00">MHA Output TP4</text>
<text text-anchor="middle" x="8903" y="-3268.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8903" y="-3257.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8903" y="-3246.77" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- mha_attn_l1_tp4&#45;&gt;mha_out_l1_tp4 -->
<g id="edge340" class="edge">
<title>mha_attn_l1_tp4&#45;&gt;mha_out_l1_tp4</title>
<path fill="none" stroke="black" d="M8903,-3327.44C8903,-3319.48 8903,-3310.54 8903,-3302.02"/>
<polygon fill="black" stroke="black" points="8906.5,-3301.93 8903,-3291.93 8899.5,-3301.93 8906.5,-3301.93"/>
</g>
<!-- attn_allreduce_l1_tp4 -->
<g id="node234" class="node">
<title>attn_allreduce_l1_tp4</title>
<ellipse fill="lightgray" stroke="black" cx="8903" cy="-3167" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8903" y="-3181" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP4</text>
<text text-anchor="middle" x="8903" y="-3170" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8903" y="-3159" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8903" y="-3148" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- mha_out_l1_tp4&#45;&gt;attn_allreduce_l1_tp4 -->
<g id="edge341" class="edge">
<title>mha_out_l1_tp4&#45;&gt;attn_allreduce_l1_tp4</title>
<path fill="none" stroke="black" d="M8903,-3239.6C8903,-3231.79 8903,-3222.93 8903,-3214.16"/>
<polygon fill="black" stroke="black" points="8906.5,-3213.98 8903,-3203.98 8899.5,-3213.98 8906.5,-3213.98"/>
</g>
<!-- attn_allreduce_l1_tp4&#45;&gt;res_add_l1_tp4 -->
<g id="edge343" class="edge">
<title>attn_allreduce_l1_tp4&#45;&gt;res_add_l1_tp4</title>
<path fill="none" stroke="black" d="M9031.65,-3140.1C9054.35,-3136.26 9077.81,-3132.75 9100,-3130.23 9518.72,-3082.69 10016.76,-3072.01 10260.54,-3069.74"/>
<polygon fill="black" stroke="black" points="10260.91,-3073.23 10270.88,-3069.65 10260.85,-3066.24 10260.91,-3073.23"/>
</g>
<!-- norm_l1_tp4 -->
<g id="node236" class="node">
<title>norm_l1_tp4</title>
<polygon fill="lightgreen" stroke="black" points="10562,-3006.23 10296,-3006.23 10296,-2954.23 10562,-2954.23 10562,-3006.23"/>
<text text-anchor="middle" x="10429" y="-2994.23" font-family="Arial" font-size="10.00">Layer Norm TP4</text>
<text text-anchor="middle" x="10429" y="-2983.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10429" y="-2972.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10429" y="-2961.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- res_add_l1_tp4&#45;&gt;norm_l1_tp4 -->
<g id="edge344" class="edge">
<title>res_add_l1_tp4&#45;&gt;norm_l1_tp4</title>
<path fill="none" stroke="black" d="M10415.6,-3041.9C10417.38,-3033.85 10419.37,-3024.8 10421.28,-3016.2"/>
<polygon fill="black" stroke="black" points="10424.7,-3016.91 10423.44,-3006.39 10417.87,-3015.4 10424.7,-3016.91"/>
</g>
<!-- gate_l1_tp4 -->
<g id="node237" class="node">
<title>gate_l1_tp4</title>
<polygon fill="lightyellow" stroke="black" points="9699.3,-2918.23 9232.72,-2918.23 9112.7,-2814.23 9579.28,-2814.23 9699.3,-2918.23"/>
<text text-anchor="middle" x="9406" y="-2880.23" font-family="Arial" font-size="10.00">Gate Network TP4</text>
<text text-anchor="middle" x="9406" y="-2869.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9406" y="-2858.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="9406" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l1_tp4&#45;&gt;gate_l1_tp4 -->
<g id="edge345" class="edge">
<title>norm_l1_tp4&#45;&gt;gate_l1_tp4</title>
<path fill="none" stroke="black" d="M10295.77,-2971.28C10150.8,-2961.86 9912.39,-2944.09 9708,-2918.23 9707.9,-2918.22 9707.79,-2918.21 9707.69,-2918.2"/>
<polygon fill="black" stroke="black" points="9708.42,-2914.76 9698.05,-2916.95 9707.53,-2921.7 9708.42,-2914.76"/>
</g>
<!-- expert32_l1_tp4 -->
<g id="node238" class="node">
<title>expert32_l1_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9905,-2892.23 9717,-2892.23 9717,-2840.23 9905,-2840.23 9905,-2892.23"/>
<text text-anchor="middle" x="9811" y="-2880.23" font-family="Arial" font-size="10.00">Expert 32</text>
<text text-anchor="middle" x="9811" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9811" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9811" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l1_tp4&#45;&gt;expert32_l1_tp4 -->
<g id="edge346" class="edge">
<title>norm_l1_tp4&#45;&gt;expert32_l1_tp4</title>
<path fill="none" stroke="black" d="M10295.79,-2975.89C10190.31,-2970.3 10040.22,-2955.74 9914,-2918.23 9896.57,-2913.06 9878.5,-2905.1 9862.45,-2897.01"/>
<polygon fill="black" stroke="black" points="9863.75,-2893.74 9853.26,-2892.24 9860.53,-2899.95 9863.75,-2893.74"/>
</g>
<!-- expert33_l1_tp4 -->
<g id="node239" class="node">
<title>expert33_l1_tp4</title>
<polygon fill="lightcoral" stroke="black" points="10111,-2892.23 9923,-2892.23 9923,-2840.23 10111,-2840.23 10111,-2892.23"/>
<text text-anchor="middle" x="10017" y="-2880.23" font-family="Arial" font-size="10.00">Expert 33</text>
<text text-anchor="middle" x="10017" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10017" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10017" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l1_tp4&#45;&gt;expert33_l1_tp4 -->
<g id="edge348" class="edge">
<title>norm_l1_tp4&#45;&gt;expert33_l1_tp4</title>
<path fill="none" stroke="black" d="M10295.8,-2960.88C10240.54,-2951.24 10176.31,-2937.35 10120,-2918.23 10103.26,-2912.55 10085.77,-2904.69 10070.05,-2896.84"/>
<polygon fill="black" stroke="black" points="10071.52,-2893.66 10061.02,-2892.24 10068.34,-2899.9 10071.52,-2893.66"/>
</g>
<!-- expert34_l1_tp4 -->
<g id="node240" class="node">
<title>expert34_l1_tp4</title>
<polygon fill="lightcoral" stroke="black" points="10317,-2892.23 10129,-2892.23 10129,-2840.23 10317,-2840.23 10317,-2892.23"/>
<text text-anchor="middle" x="10223" y="-2880.23" font-family="Arial" font-size="10.00">Expert 34</text>
<text text-anchor="middle" x="10223" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10223" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10223" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l1_tp4&#45;&gt;expert34_l1_tp4 -->
<g id="edge350" class="edge">
<title>norm_l1_tp4&#45;&gt;expert34_l1_tp4</title>
<path fill="none" stroke="black" d="M10382.77,-2954.1C10351.76,-2937.24 10310.76,-2914.95 10278.06,-2897.17"/>
<polygon fill="black" stroke="black" points="10279.53,-2893.99 10269.08,-2892.29 10276.19,-2900.14 10279.53,-2893.99"/>
</g>
<!-- expert35_l1_tp4 -->
<g id="node241" class="node">
<title>expert35_l1_tp4</title>
<polygon fill="lightcoral" stroke="black" points="10523,-2892.23 10335,-2892.23 10335,-2840.23 10523,-2840.23 10523,-2892.23"/>
<text text-anchor="middle" x="10429" y="-2880.23" font-family="Arial" font-size="10.00">Expert 35</text>
<text text-anchor="middle" x="10429" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10429" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10429" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l1_tp4&#45;&gt;expert35_l1_tp4 -->
<g id="edge352" class="edge">
<title>norm_l1_tp4&#45;&gt;expert35_l1_tp4</title>
<path fill="none" stroke="black" d="M10429,-2954.1C10429,-2938.82 10429,-2919.09 10429,-2902.3"/>
<polygon fill="black" stroke="black" points="10432.5,-2902.29 10429,-2892.29 10425.5,-2902.29 10432.5,-2902.29"/>
</g>
<!-- expert36_l1_tp4 -->
<g id="node242" class="node">
<title>expert36_l1_tp4</title>
<polygon fill="lightcoral" stroke="black" points="10729,-2892.23 10541,-2892.23 10541,-2840.23 10729,-2840.23 10729,-2892.23"/>
<text text-anchor="middle" x="10635" y="-2880.23" font-family="Arial" font-size="10.00">Expert 36</text>
<text text-anchor="middle" x="10635" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10635" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10635" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l1_tp4&#45;&gt;expert36_l1_tp4 -->
<g id="edge354" class="edge">
<title>norm_l1_tp4&#45;&gt;expert36_l1_tp4</title>
<path fill="none" stroke="black" d="M10475.23,-2954.1C10506.24,-2937.24 10547.24,-2914.95 10579.94,-2897.17"/>
<polygon fill="black" stroke="black" points="10581.81,-2900.14 10588.92,-2892.29 10578.47,-2893.99 10581.81,-2900.14"/>
</g>
<!-- expert37_l1_tp4 -->
<g id="node243" class="node">
<title>expert37_l1_tp4</title>
<polygon fill="lightcoral" stroke="black" points="10935,-2892.23 10747,-2892.23 10747,-2840.23 10935,-2840.23 10935,-2892.23"/>
<text text-anchor="middle" x="10841" y="-2880.23" font-family="Arial" font-size="10.00">Expert 37</text>
<text text-anchor="middle" x="10841" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10841" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10841" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l1_tp4&#45;&gt;expert37_l1_tp4 -->
<g id="edge356" class="edge">
<title>norm_l1_tp4&#45;&gt;expert37_l1_tp4</title>
<path fill="none" stroke="black" d="M10562.2,-2960.88C10617.46,-2951.24 10681.69,-2937.35 10738,-2918.23 10754.74,-2912.55 10772.23,-2904.69 10787.95,-2896.84"/>
<polygon fill="black" stroke="black" points="10789.66,-2899.9 10796.98,-2892.24 10786.48,-2893.66 10789.66,-2899.9"/>
</g>
<!-- expert38_l1_tp4 -->
<g id="node244" class="node">
<title>expert38_l1_tp4</title>
<polygon fill="lightcoral" stroke="black" points="11141,-2892.23 10953,-2892.23 10953,-2840.23 11141,-2840.23 11141,-2892.23"/>
<text text-anchor="middle" x="11047" y="-2880.23" font-family="Arial" font-size="10.00">Expert 38</text>
<text text-anchor="middle" x="11047" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11047" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11047" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l1_tp4&#45;&gt;expert38_l1_tp4 -->
<g id="edge358" class="edge">
<title>norm_l1_tp4&#45;&gt;expert38_l1_tp4</title>
<path fill="none" stroke="black" d="M10562.21,-2975.89C10667.69,-2970.3 10817.78,-2955.74 10944,-2918.23 10961.43,-2913.06 10979.5,-2905.1 10995.55,-2897.01"/>
<polygon fill="black" stroke="black" points="10997.47,-2899.95 11004.74,-2892.24 10994.25,-2893.74 10997.47,-2899.95"/>
</g>
<!-- expert39_l1_tp4 -->
<g id="node245" class="node">
<title>expert39_l1_tp4</title>
<polygon fill="lightcoral" stroke="black" points="11347,-2892.23 11159,-2892.23 11159,-2840.23 11347,-2840.23 11347,-2892.23"/>
<text text-anchor="middle" x="11253" y="-2880.23" font-family="Arial" font-size="10.00">Expert 39</text>
<text text-anchor="middle" x="11253" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11253" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11253" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l1_tp4&#45;&gt;expert39_l1_tp4 -->
<g id="edge360" class="edge">
<title>norm_l1_tp4&#45;&gt;expert39_l1_tp4</title>
<path fill="none" stroke="black" d="M10562.01,-2973.93C10739.24,-2965.83 11042.92,-2948.11 11150,-2918.23 11167.67,-2913.3 11185.94,-2905.34 11202.09,-2897.15"/>
<polygon fill="black" stroke="black" points="11204.09,-2900.05 11211.34,-2892.32 11200.85,-2893.85 11204.09,-2900.05"/>
</g>
<!-- res_add2_l1_tp4 -->
<g id="node247" class="node">
<title>res_add2_l1_tp4</title>
<polygon fill="lightgreen" stroke="black" points="10671,-2638.23 10393,-2638.23 10393,-2586.23 10671,-2586.23 10671,-2638.23"/>
<text text-anchor="middle" x="10532" y="-2626.23" font-family="Arial" font-size="10.00">Residual Add 2 TP4</text>
<text text-anchor="middle" x="10532" y="-2615.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="10532" y="-2604.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10532" y="-2593.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- norm_l1_tp4&#45;&gt;res_add2_l1_tp4 -->
<g id="edge363" class="edge">
<title>norm_l1_tp4&#45;&gt;res_add2_l1_tp4</title>
<path fill="none" stroke="black" d="M10562.04,-2975.23C10812.03,-2967.04 11329.3,-2946.75 11356,-2918.23 11371.8,-2901.36 11370.14,-2832.52 11356,-2814.23 11204.58,-2618.46 11057.85,-2731.26 10817,-2674.23 10767.37,-2662.48 10712.63,-2650.53 10664.51,-2640.35"/>
<polygon fill="black" stroke="black" points="10665.16,-2636.91 10654.66,-2638.27 10663.72,-2643.76 10665.16,-2636.91"/>
</g>
<!-- expert_agg_l1_tp4 -->
<g id="node246" class="node">
<title>expert_agg_l1_tp4</title>
<polygon fill="lightpink" stroke="black" points="10807.55,-2778.23 10369.21,-2778.23 10256.45,-2674.23 10694.79,-2674.23 10807.55,-2778.23"/>
<text text-anchor="middle" x="10532" y="-2740.23" font-family="Arial" font-size="10.00">Expert Aggregation TP4</text>
<text text-anchor="middle" x="10532" y="-2729.23" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="10532" y="-2718.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10532" y="-2707.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- expert32_l1_tp4&#45;&gt;expert_agg_l1_tp4 -->
<g id="edge347" class="edge">
<title>expert32_l1_tp4&#45;&gt;expert_agg_l1_tp4</title>
<path fill="none" stroke="black" d="M9853.83,-2840.19C9871.86,-2830.67 9893.41,-2820.6 9914,-2814.23 10044.51,-2773.89 10196.37,-2752.18 10316.89,-2740.54"/>
<polygon fill="black" stroke="black" points="10317.36,-2744.01 10326.98,-2739.58 10316.7,-2737.04 10317.36,-2744.01"/>
</g>
<!-- expert33_l1_tp4&#45;&gt;expert_agg_l1_tp4 -->
<g id="edge349" class="edge">
<title>expert33_l1_tp4&#45;&gt;expert_agg_l1_tp4</title>
<path fill="none" stroke="black" d="M10061.32,-2840.23C10079.12,-2831.01 10100.11,-2821.13 10120,-2814.23 10188.63,-2790.43 10266.05,-2771.99 10335.1,-2758.35"/>
<polygon fill="black" stroke="black" points="10336.08,-2761.72 10345.22,-2756.37 10334.74,-2754.85 10336.08,-2761.72"/>
</g>
<!-- expert34_l1_tp4&#45;&gt;expert_agg_l1_tp4 -->
<g id="edge351" class="edge">
<title>expert34_l1_tp4&#45;&gt;expert_agg_l1_tp4</title>
<path fill="none" stroke="black" d="M10272.22,-2840.11C10289.16,-2831.67 10308.31,-2822.34 10326,-2814.23 10349.32,-2803.55 10374.31,-2792.59 10398.58,-2782.2"/>
<polygon fill="black" stroke="black" points="10400.01,-2785.39 10407.83,-2778.25 10397.26,-2778.96 10400.01,-2785.39"/>
</g>
<!-- expert35_l1_tp4&#45;&gt;expert_agg_l1_tp4 -->
<g id="edge353" class="edge">
<title>expert35_l1_tp4&#45;&gt;expert_agg_l1_tp4</title>
<path fill="none" stroke="black" d="M10447.89,-2839.92C10459.07,-2824.94 10473.74,-2805.3 10487.68,-2786.61"/>
<polygon fill="black" stroke="black" points="10490.64,-2788.5 10493.81,-2778.4 10485.03,-2784.32 10490.64,-2788.5"/>
</g>
<!-- expert36_l1_tp4&#45;&gt;expert_agg_l1_tp4 -->
<g id="edge355" class="edge">
<title>expert36_l1_tp4&#45;&gt;expert_agg_l1_tp4</title>
<path fill="none" stroke="black" d="M10616.11,-2839.92C10604.93,-2824.94 10590.26,-2805.3 10576.32,-2786.61"/>
<polygon fill="black" stroke="black" points="10578.97,-2784.32 10570.19,-2778.4 10573.36,-2788.5 10578.97,-2784.32"/>
</g>
<!-- expert37_l1_tp4&#45;&gt;expert_agg_l1_tp4 -->
<g id="edge357" class="edge">
<title>expert37_l1_tp4&#45;&gt;expert_agg_l1_tp4</title>
<path fill="none" stroke="black" d="M10791.78,-2840.11C10774.84,-2831.67 10755.69,-2822.34 10738,-2814.23 10714.68,-2803.55 10689.69,-2792.59 10665.42,-2782.2"/>
<polygon fill="black" stroke="black" points="10666.74,-2778.96 10656.17,-2778.25 10663.99,-2785.39 10666.74,-2778.96"/>
</g>
<!-- expert38_l1_tp4&#45;&gt;expert_agg_l1_tp4 -->
<g id="edge359" class="edge">
<title>expert38_l1_tp4&#45;&gt;expert_agg_l1_tp4</title>
<path fill="none" stroke="black" d="M11002.68,-2840.23C10984.88,-2831.01 10963.89,-2821.13 10944,-2814.23 10902.34,-2799.78 10857.43,-2787.31 10813.13,-2776.68"/>
<polygon fill="black" stroke="black" points="10813.92,-2773.28 10803.38,-2774.38 10812.31,-2780.09 10813.92,-2773.28"/>
</g>
<!-- expert39_l1_tp4&#45;&gt;expert_agg_l1_tp4 -->
<g id="edge361" class="edge">
<title>expert39_l1_tp4&#45;&gt;expert_agg_l1_tp4</title>
<path fill="none" stroke="black" d="M11210.17,-2840.19C11192.14,-2830.67 11170.59,-2820.6 11150,-2814.23 11030.81,-2777.39 10893.81,-2756.09 10779.14,-2743.8"/>
<polygon fill="black" stroke="black" points="10779.49,-2740.32 10769.17,-2742.75 10778.75,-2747.28 10779.49,-2740.32"/>
</g>
<!-- expert_agg_l1_tp4&#45;&gt;res_add2_l1_tp4 -->
<g id="edge362" class="edge">
<title>expert_agg_l1_tp4&#45;&gt;res_add2_l1_tp4</title>
<path fill="none" stroke="black" d="M10532,-2674.15C10532,-2665.49 10532,-2656.66 10532,-2648.52"/>
<polygon fill="black" stroke="black" points="10535.5,-2648.28 10532,-2638.28 10528.5,-2648.28 10535.5,-2648.28"/>
</g>
<!-- norm2_l1_tp4 -->
<g id="node248" class="node">
<title>norm2_l1_tp4</title>
<polygon fill="lightgreen" stroke="black" points="10453,-2550.23 10187,-2550.23 10187,-2498.23 10453,-2498.23 10453,-2550.23"/>
<text text-anchor="middle" x="10320" y="-2538.23" font-family="Arial" font-size="10.00">Layer Norm 2 TP4</text>
<text text-anchor="middle" x="10320" y="-2527.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10320" y="-2516.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10320" y="-2505.23" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- res_add2_l1_tp4&#45;&gt;norm2_l1_tp4 -->
<g id="edge364" class="edge">
<title>res_add2_l1_tp4&#45;&gt;norm2_l1_tp4</title>
<path fill="none" stroke="black" d="M10470.11,-2586.13C10445.4,-2576.11 10416.8,-2564.5 10391.24,-2554.13"/>
<polygon fill="black" stroke="black" points="10392.55,-2550.89 10381.97,-2550.37 10389.92,-2557.37 10392.55,-2550.89"/>
</g>
<!-- norm2_l1_tp4&#45;&gt;pipeline_comm_01 -->
<g id="edge457" class="edge">
<title>norm2_l1_tp4&#45;&gt;pipeline_comm_01</title>
<path fill="none" stroke="black" d="M10221.34,-2498.19C10152.41,-2480.69 10059.93,-2457.21 9986.32,-2438.52"/>
<polygon fill="black" stroke="black" points="9987.07,-2435.1 9976.52,-2436.03 9985.35,-2441.89 9987.07,-2435.1"/>
</g>
<!-- mha_qkv_l1_tp5 -->
<g id="node250" class="node">
<title>mha_qkv_l1_tp5</title>
<polygon fill="lightgreen" stroke="black" points="9442.5,-3467.77 9151.5,-3467.77 9151.5,-3415.77 9442.5,-3415.77 9442.5,-3467.77"/>
<text text-anchor="middle" x="9297" y="-3455.77" font-family="Arial" font-size="10.00">MHA QKV TP5</text>
<text text-anchor="middle" x="9297" y="-3444.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9297" y="-3433.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9297" y="-3422.77" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- input_split_l1_tp5&#45;&gt;mha_qkv_l1_tp5 -->
<g id="edge366" class="edge">
<title>input_split_l1_tp5&#45;&gt;mha_qkv_l1_tp5</title>
<path fill="none" stroke="black" d="M9297,-3503.51C9297,-3495.2 9297,-3486.36 9297,-3478.08"/>
<polygon fill="black" stroke="black" points="9300.5,-3477.97 9297,-3467.97 9293.5,-3477.97 9300.5,-3477.97"/>
</g>
<!-- mha_attn_l1_tp5 -->
<g id="node251" class="node">
<title>mha_attn_l1_tp5</title>
<polygon fill="lightgreen" stroke="black" points="9442.5,-3379.77 9151.5,-3379.77 9151.5,-3327.77 9442.5,-3327.77 9442.5,-3379.77"/>
<text text-anchor="middle" x="9297" y="-3367.77" font-family="Arial" font-size="10.00">MHA Attention TP5</text>
<text text-anchor="middle" x="9297" y="-3356.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9297" y="-3345.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9297" y="-3334.77" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- mha_qkv_l1_tp5&#45;&gt;mha_attn_l1_tp5 -->
<g id="edge367" class="edge">
<title>mha_qkv_l1_tp5&#45;&gt;mha_attn_l1_tp5</title>
<path fill="none" stroke="black" d="M9297,-3415.44C9297,-3407.48 9297,-3398.54 9297,-3390.02"/>
<polygon fill="black" stroke="black" points="9300.5,-3389.93 9297,-3379.93 9293.5,-3389.93 9300.5,-3389.93"/>
</g>
<!-- mha_out_l1_tp5 -->
<g id="node252" class="node">
<title>mha_out_l1_tp5</title>
<polygon fill="lightgreen" stroke="black" points="9439,-3291.77 9155,-3291.77 9155,-3239.77 9439,-3239.77 9439,-3291.77"/>
<text text-anchor="middle" x="9297" y="-3279.77" font-family="Arial" font-size="10.00">MHA Output TP5</text>
<text text-anchor="middle" x="9297" y="-3268.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9297" y="-3257.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9297" y="-3246.77" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- mha_attn_l1_tp5&#45;&gt;mha_out_l1_tp5 -->
<g id="edge368" class="edge">
<title>mha_attn_l1_tp5&#45;&gt;mha_out_l1_tp5</title>
<path fill="none" stroke="black" d="M9297,-3327.44C9297,-3319.48 9297,-3310.54 9297,-3302.02"/>
<polygon fill="black" stroke="black" points="9300.5,-3301.93 9297,-3291.93 9293.5,-3301.93 9300.5,-3301.93"/>
</g>
<!-- attn_allreduce_l1_tp5 -->
<g id="node253" class="node">
<title>attn_allreduce_l1_tp5</title>
<ellipse fill="lightgray" stroke="black" cx="9297" cy="-3167" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9297" y="-3181" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP5</text>
<text text-anchor="middle" x="9297" y="-3170" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9297" y="-3159" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9297" y="-3148" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- mha_out_l1_tp5&#45;&gt;attn_allreduce_l1_tp5 -->
<g id="edge369" class="edge">
<title>mha_out_l1_tp5&#45;&gt;attn_allreduce_l1_tp5</title>
<path fill="none" stroke="black" d="M9297,-3239.6C9297,-3231.79 9297,-3222.93 9297,-3214.16"/>
<polygon fill="black" stroke="black" points="9300.5,-3213.98 9297,-3203.98 9293.5,-3213.98 9300.5,-3213.98"/>
</g>
<!-- attn_allreduce_l1_tp5&#45;&gt;res_add_l1_tp5 -->
<g id="edge371" class="edge">
<title>attn_allreduce_l1_tp5&#45;&gt;res_add_l1_tp5</title>
<path fill="none" stroke="black" d="M9424.55,-3139.93C9447.58,-3136.06 9471.44,-3132.58 9494,-3130.23 9595.71,-3119.65 11066.05,-3084.11 11544.65,-3072.75"/>
<polygon fill="black" stroke="black" points="11544.82,-3076.25 11554.74,-3072.51 11544.66,-3069.25 11544.82,-3076.25"/>
</g>
<!-- norm_l1_tp5 -->
<g id="node255" class="node">
<title>norm_l1_tp5</title>
<polygon fill="lightgreen" stroke="black" points="12834,-3006.23 12568,-3006.23 12568,-2954.23 12834,-2954.23 12834,-3006.23"/>
<text text-anchor="middle" x="12701" y="-2994.23" font-family="Arial" font-size="10.00">Layer Norm TP5</text>
<text text-anchor="middle" x="12701" y="-2983.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12701" y="-2972.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12701" y="-2961.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- res_add_l1_tp5&#45;&gt;norm_l1_tp5 -->
<g id="edge372" class="edge">
<title>res_add_l1_tp5&#45;&gt;norm_l1_tp5</title>
<path fill="none" stroke="black" d="M11833.23,-3055.34C12023.99,-3039.05 12364.88,-3009.94 12557.74,-2993.47"/>
<polygon fill="black" stroke="black" points="12558.28,-2996.94 12567.95,-2992.6 12557.69,-2989.96 12558.28,-2996.94"/>
</g>
<!-- gate_l1_tp5 -->
<g id="node256" class="node">
<title>gate_l1_tp5</title>
<polygon fill="lightyellow" stroke="black" points="11971.3,-2918.23 11504.72,-2918.23 11384.7,-2814.23 11851.28,-2814.23 11971.3,-2918.23"/>
<text text-anchor="middle" x="11678" y="-2880.23" font-family="Arial" font-size="10.00">Gate Network TP5</text>
<text text-anchor="middle" x="11678" y="-2869.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11678" y="-2858.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="11678" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l1_tp5&#45;&gt;gate_l1_tp5 -->
<g id="edge373" class="edge">
<title>norm_l1_tp5&#45;&gt;gate_l1_tp5</title>
<path fill="none" stroke="black" d="M12567.77,-2971.28C12422.8,-2961.86 12184.39,-2944.09 11980,-2918.23 11979.9,-2918.22 11979.79,-2918.21 11979.69,-2918.2"/>
<polygon fill="black" stroke="black" points="11980.42,-2914.76 11970.05,-2916.95 11979.53,-2921.7 11980.42,-2914.76"/>
</g>
<!-- expert40_l1_tp5 -->
<g id="node257" class="node">
<title>expert40_l1_tp5</title>
<polygon fill="lightcoral" stroke="black" points="12177,-2892.23 11989,-2892.23 11989,-2840.23 12177,-2840.23 12177,-2892.23"/>
<text text-anchor="middle" x="12083" y="-2880.23" font-family="Arial" font-size="10.00">Expert 40</text>
<text text-anchor="middle" x="12083" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12083" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12083" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l1_tp5&#45;&gt;expert40_l1_tp5 -->
<g id="edge374" class="edge">
<title>norm_l1_tp5&#45;&gt;expert40_l1_tp5</title>
<path fill="none" stroke="black" d="M12567.79,-2975.89C12462.31,-2970.3 12312.22,-2955.74 12186,-2918.23 12168.57,-2913.06 12150.5,-2905.1 12134.45,-2897.01"/>
<polygon fill="black" stroke="black" points="12135.75,-2893.74 12125.26,-2892.24 12132.53,-2899.95 12135.75,-2893.74"/>
</g>
<!-- expert41_l1_tp5 -->
<g id="node258" class="node">
<title>expert41_l1_tp5</title>
<polygon fill="lightcoral" stroke="black" points="12383,-2892.23 12195,-2892.23 12195,-2840.23 12383,-2840.23 12383,-2892.23"/>
<text text-anchor="middle" x="12289" y="-2880.23" font-family="Arial" font-size="10.00">Expert 41</text>
<text text-anchor="middle" x="12289" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12289" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12289" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l1_tp5&#45;&gt;expert41_l1_tp5 -->
<g id="edge376" class="edge">
<title>norm_l1_tp5&#45;&gt;expert41_l1_tp5</title>
<path fill="none" stroke="black" d="M12567.8,-2960.88C12512.54,-2951.24 12448.31,-2937.35 12392,-2918.23 12375.26,-2912.55 12357.77,-2904.69 12342.05,-2896.84"/>
<polygon fill="black" stroke="black" points="12343.52,-2893.66 12333.02,-2892.24 12340.34,-2899.9 12343.52,-2893.66"/>
</g>
<!-- expert42_l1_tp5 -->
<g id="node259" class="node">
<title>expert42_l1_tp5</title>
<polygon fill="lightcoral" stroke="black" points="12589,-2892.23 12401,-2892.23 12401,-2840.23 12589,-2840.23 12589,-2892.23"/>
<text text-anchor="middle" x="12495" y="-2880.23" font-family="Arial" font-size="10.00">Expert 42</text>
<text text-anchor="middle" x="12495" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12495" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12495" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l1_tp5&#45;&gt;expert42_l1_tp5 -->
<g id="edge378" class="edge">
<title>norm_l1_tp5&#45;&gt;expert42_l1_tp5</title>
<path fill="none" stroke="black" d="M12654.77,-2954.1C12623.76,-2937.24 12582.76,-2914.95 12550.06,-2897.17"/>
<polygon fill="black" stroke="black" points="12551.53,-2893.99 12541.08,-2892.29 12548.19,-2900.14 12551.53,-2893.99"/>
</g>
<!-- expert43_l1_tp5 -->
<g id="node260" class="node">
<title>expert43_l1_tp5</title>
<polygon fill="lightcoral" stroke="black" points="12795,-2892.23 12607,-2892.23 12607,-2840.23 12795,-2840.23 12795,-2892.23"/>
<text text-anchor="middle" x="12701" y="-2880.23" font-family="Arial" font-size="10.00">Expert 43</text>
<text text-anchor="middle" x="12701" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12701" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12701" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l1_tp5&#45;&gt;expert43_l1_tp5 -->
<g id="edge380" class="edge">
<title>norm_l1_tp5&#45;&gt;expert43_l1_tp5</title>
<path fill="none" stroke="black" d="M12701,-2954.1C12701,-2938.82 12701,-2919.09 12701,-2902.3"/>
<polygon fill="black" stroke="black" points="12704.5,-2902.29 12701,-2892.29 12697.5,-2902.29 12704.5,-2902.29"/>
</g>
<!-- expert44_l1_tp5 -->
<g id="node261" class="node">
<title>expert44_l1_tp5</title>
<polygon fill="lightcoral" stroke="black" points="13001,-2892.23 12813,-2892.23 12813,-2840.23 13001,-2840.23 13001,-2892.23"/>
<text text-anchor="middle" x="12907" y="-2880.23" font-family="Arial" font-size="10.00">Expert 44</text>
<text text-anchor="middle" x="12907" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12907" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12907" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l1_tp5&#45;&gt;expert44_l1_tp5 -->
<g id="edge382" class="edge">
<title>norm_l1_tp5&#45;&gt;expert44_l1_tp5</title>
<path fill="none" stroke="black" d="M12747.23,-2954.1C12778.24,-2937.24 12819.24,-2914.95 12851.94,-2897.17"/>
<polygon fill="black" stroke="black" points="12853.81,-2900.14 12860.92,-2892.29 12850.47,-2893.99 12853.81,-2900.14"/>
</g>
<!-- expert45_l1_tp5 -->
<g id="node262" class="node">
<title>expert45_l1_tp5</title>
<polygon fill="lightcoral" stroke="black" points="13207,-2892.23 13019,-2892.23 13019,-2840.23 13207,-2840.23 13207,-2892.23"/>
<text text-anchor="middle" x="13113" y="-2880.23" font-family="Arial" font-size="10.00">Expert 45</text>
<text text-anchor="middle" x="13113" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13113" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13113" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l1_tp5&#45;&gt;expert45_l1_tp5 -->
<g id="edge384" class="edge">
<title>norm_l1_tp5&#45;&gt;expert45_l1_tp5</title>
<path fill="none" stroke="black" d="M12834.2,-2960.88C12889.46,-2951.24 12953.69,-2937.35 13010,-2918.23 13026.74,-2912.55 13044.23,-2904.69 13059.95,-2896.84"/>
<polygon fill="black" stroke="black" points="13061.66,-2899.9 13068.98,-2892.24 13058.48,-2893.66 13061.66,-2899.9"/>
</g>
<!-- expert46_l1_tp5 -->
<g id="node263" class="node">
<title>expert46_l1_tp5</title>
<polygon fill="lightcoral" stroke="black" points="13413,-2892.23 13225,-2892.23 13225,-2840.23 13413,-2840.23 13413,-2892.23"/>
<text text-anchor="middle" x="13319" y="-2880.23" font-family="Arial" font-size="10.00">Expert 46</text>
<text text-anchor="middle" x="13319" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13319" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13319" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l1_tp5&#45;&gt;expert46_l1_tp5 -->
<g id="edge386" class="edge">
<title>norm_l1_tp5&#45;&gt;expert46_l1_tp5</title>
<path fill="none" stroke="black" d="M12834.21,-2975.89C12939.69,-2970.3 13089.78,-2955.74 13216,-2918.23 13233.43,-2913.06 13251.5,-2905.1 13267.55,-2897.01"/>
<polygon fill="black" stroke="black" points="13269.47,-2899.95 13276.74,-2892.24 13266.25,-2893.74 13269.47,-2899.95"/>
</g>
<!-- expert47_l1_tp5 -->
<g id="node264" class="node">
<title>expert47_l1_tp5</title>
<polygon fill="lightcoral" stroke="black" points="13619,-2892.23 13431,-2892.23 13431,-2840.23 13619,-2840.23 13619,-2892.23"/>
<text text-anchor="middle" x="13525" y="-2880.23" font-family="Arial" font-size="10.00">Expert 47</text>
<text text-anchor="middle" x="13525" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13525" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13525" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l1_tp5&#45;&gt;expert47_l1_tp5 -->
<g id="edge388" class="edge">
<title>norm_l1_tp5&#45;&gt;expert47_l1_tp5</title>
<path fill="none" stroke="black" d="M12834.01,-2973.93C13011.24,-2965.83 13314.92,-2948.11 13422,-2918.23 13439.67,-2913.3 13457.94,-2905.34 13474.09,-2897.15"/>
<polygon fill="black" stroke="black" points="13476.09,-2900.05 13483.34,-2892.32 13472.85,-2893.85 13476.09,-2900.05"/>
</g>
<!-- res_add2_l1_tp5 -->
<g id="node266" class="node">
<title>res_add2_l1_tp5</title>
<polygon fill="lightgreen" stroke="black" points="12943,-2638.23 12665,-2638.23 12665,-2586.23 12943,-2586.23 12943,-2638.23"/>
<text text-anchor="middle" x="12804" y="-2626.23" font-family="Arial" font-size="10.00">Residual Add 2 TP5</text>
<text text-anchor="middle" x="12804" y="-2615.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="12804" y="-2604.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12804" y="-2593.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- norm_l1_tp5&#45;&gt;res_add2_l1_tp5 -->
<g id="edge391" class="edge">
<title>norm_l1_tp5&#45;&gt;res_add2_l1_tp5</title>
<path fill="none" stroke="black" d="M12834.04,-2975.23C13084.03,-2967.04 13601.3,-2946.75 13628,-2918.23 13643.8,-2901.36 13642.14,-2832.52 13628,-2814.23 13476.58,-2618.46 13329.85,-2731.26 13089,-2674.23 13039.37,-2662.48 12984.63,-2650.53 12936.51,-2640.35"/>
<polygon fill="black" stroke="black" points="12937.16,-2636.91 12926.66,-2638.27 12935.72,-2643.76 12937.16,-2636.91"/>
</g>
<!-- expert_agg_l1_tp5 -->
<g id="node265" class="node">
<title>expert_agg_l1_tp5</title>
<polygon fill="lightpink" stroke="black" points="13079.55,-2778.23 12641.21,-2778.23 12528.45,-2674.23 12966.79,-2674.23 13079.55,-2778.23"/>
<text text-anchor="middle" x="12804" y="-2740.23" font-family="Arial" font-size="10.00">Expert Aggregation TP5</text>
<text text-anchor="middle" x="12804" y="-2729.23" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="12804" y="-2718.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12804" y="-2707.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- expert40_l1_tp5&#45;&gt;expert_agg_l1_tp5 -->
<g id="edge375" class="edge">
<title>expert40_l1_tp5&#45;&gt;expert_agg_l1_tp5</title>
<path fill="none" stroke="black" d="M12125.83,-2840.19C12143.86,-2830.67 12165.41,-2820.6 12186,-2814.23 12316.51,-2773.89 12468.37,-2752.18 12588.89,-2740.54"/>
<polygon fill="black" stroke="black" points="12589.36,-2744.01 12598.98,-2739.58 12588.7,-2737.04 12589.36,-2744.01"/>
</g>
<!-- expert41_l1_tp5&#45;&gt;expert_agg_l1_tp5 -->
<g id="edge377" class="edge">
<title>expert41_l1_tp5&#45;&gt;expert_agg_l1_tp5</title>
<path fill="none" stroke="black" d="M12333.32,-2840.23C12351.12,-2831.01 12372.11,-2821.13 12392,-2814.23 12460.63,-2790.43 12538.05,-2771.99 12607.1,-2758.35"/>
<polygon fill="black" stroke="black" points="12608.08,-2761.72 12617.22,-2756.37 12606.74,-2754.85 12608.08,-2761.72"/>
</g>
<!-- expert42_l1_tp5&#45;&gt;expert_agg_l1_tp5 -->
<g id="edge379" class="edge">
<title>expert42_l1_tp5&#45;&gt;expert_agg_l1_tp5</title>
<path fill="none" stroke="black" d="M12544.22,-2840.11C12561.16,-2831.67 12580.31,-2822.34 12598,-2814.23 12621.32,-2803.55 12646.31,-2792.59 12670.58,-2782.2"/>
<polygon fill="black" stroke="black" points="12672.01,-2785.39 12679.83,-2778.25 12669.26,-2778.96 12672.01,-2785.39"/>
</g>
<!-- expert43_l1_tp5&#45;&gt;expert_agg_l1_tp5 -->
<g id="edge381" class="edge">
<title>expert43_l1_tp5&#45;&gt;expert_agg_l1_tp5</title>
<path fill="none" stroke="black" d="M12719.89,-2839.92C12731.07,-2824.94 12745.74,-2805.3 12759.68,-2786.61"/>
<polygon fill="black" stroke="black" points="12762.64,-2788.5 12765.81,-2778.4 12757.03,-2784.32 12762.64,-2788.5"/>
</g>
<!-- expert44_l1_tp5&#45;&gt;expert_agg_l1_tp5 -->
<g id="edge383" class="edge">
<title>expert44_l1_tp5&#45;&gt;expert_agg_l1_tp5</title>
<path fill="none" stroke="black" d="M12888.11,-2839.92C12876.93,-2824.94 12862.26,-2805.3 12848.32,-2786.61"/>
<polygon fill="black" stroke="black" points="12850.97,-2784.32 12842.19,-2778.4 12845.36,-2788.5 12850.97,-2784.32"/>
</g>
<!-- expert45_l1_tp5&#45;&gt;expert_agg_l1_tp5 -->
<g id="edge385" class="edge">
<title>expert45_l1_tp5&#45;&gt;expert_agg_l1_tp5</title>
<path fill="none" stroke="black" d="M13063.78,-2840.11C13046.84,-2831.67 13027.69,-2822.34 13010,-2814.23 12986.68,-2803.55 12961.69,-2792.59 12937.42,-2782.2"/>
<polygon fill="black" stroke="black" points="12938.74,-2778.96 12928.17,-2778.25 12935.99,-2785.39 12938.74,-2778.96"/>
</g>
<!-- expert46_l1_tp5&#45;&gt;expert_agg_l1_tp5 -->
<g id="edge387" class="edge">
<title>expert46_l1_tp5&#45;&gt;expert_agg_l1_tp5</title>
<path fill="none" stroke="black" d="M13274.68,-2840.23C13256.88,-2831.01 13235.89,-2821.13 13216,-2814.23 13174.34,-2799.78 13129.43,-2787.31 13085.13,-2776.68"/>
<polygon fill="black" stroke="black" points="13085.92,-2773.28 13075.38,-2774.38 13084.31,-2780.09 13085.92,-2773.28"/>
</g>
<!-- expert47_l1_tp5&#45;&gt;expert_agg_l1_tp5 -->
<g id="edge389" class="edge">
<title>expert47_l1_tp5&#45;&gt;expert_agg_l1_tp5</title>
<path fill="none" stroke="black" d="M13482.17,-2840.19C13464.14,-2830.67 13442.59,-2820.6 13422,-2814.23 13302.81,-2777.39 13165.81,-2756.09 13051.14,-2743.8"/>
<polygon fill="black" stroke="black" points="13051.49,-2740.32 13041.17,-2742.75 13050.75,-2747.28 13051.49,-2740.32"/>
</g>
<!-- expert_agg_l1_tp5&#45;&gt;res_add2_l1_tp5 -->
<g id="edge390" class="edge">
<title>expert_agg_l1_tp5&#45;&gt;res_add2_l1_tp5</title>
<path fill="none" stroke="black" d="M12804,-2674.15C12804,-2665.49 12804,-2656.66 12804,-2648.52"/>
<polygon fill="black" stroke="black" points="12807.5,-2648.28 12804,-2638.28 12800.5,-2648.28 12807.5,-2648.28"/>
</g>
<!-- norm2_l1_tp5 -->
<g id="node267" class="node">
<title>norm2_l1_tp5</title>
<polygon fill="lightgreen" stroke="black" points="11942,-2550.23 11676,-2550.23 11676,-2498.23 11942,-2498.23 11942,-2550.23"/>
<text text-anchor="middle" x="11809" y="-2538.23" font-family="Arial" font-size="10.00">Layer Norm 2 TP5</text>
<text text-anchor="middle" x="11809" y="-2527.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11809" y="-2516.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11809" y="-2505.23" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- res_add2_l1_tp5&#45;&gt;norm2_l1_tp5 -->
<g id="edge392" class="edge">
<title>res_add2_l1_tp5&#45;&gt;norm2_l1_tp5</title>
<path fill="none" stroke="black" d="M12664.86,-2599.21C12476.7,-2582.95 12142.81,-2554.09 11952.45,-2537.63"/>
<polygon fill="black" stroke="black" points="11952.63,-2534.14 11942.37,-2536.76 11952.03,-2541.11 11952.63,-2534.14"/>
</g>
<!-- norm2_l1_tp5&#45;&gt;pipeline_comm_01 -->
<g id="edge459" class="edge">
<title>norm2_l1_tp5&#45;&gt;pipeline_comm_01</title>
<path fill="none" stroke="black" d="M11675.7,-2515.3C11337.34,-2495.16 10444.42,-2442.01 10052.71,-2418.7"/>
<polygon fill="black" stroke="black" points="10052.89,-2415.2 10042.7,-2418.1 10052.47,-2422.19 10052.89,-2415.2"/>
</g>
<!-- mha_qkv_l1_tp6 -->
<g id="node269" class="node">
<title>mha_qkv_l1_tp6</title>
<polygon fill="lightgreen" stroke="black" points="9836.5,-3467.77 9545.5,-3467.77 9545.5,-3415.77 9836.5,-3415.77 9836.5,-3467.77"/>
<text text-anchor="middle" x="9691" y="-3455.77" font-family="Arial" font-size="10.00">MHA QKV TP6</text>
<text text-anchor="middle" x="9691" y="-3444.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9691" y="-3433.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9691" y="-3422.77" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- input_split_l1_tp6&#45;&gt;mha_qkv_l1_tp6 -->
<g id="edge394" class="edge">
<title>input_split_l1_tp6&#45;&gt;mha_qkv_l1_tp6</title>
<path fill="none" stroke="black" d="M9691,-3503.51C9691,-3495.2 9691,-3486.36 9691,-3478.08"/>
<polygon fill="black" stroke="black" points="9694.5,-3477.97 9691,-3467.97 9687.5,-3477.97 9694.5,-3477.97"/>
</g>
<!-- mha_attn_l1_tp6 -->
<g id="node270" class="node">
<title>mha_attn_l1_tp6</title>
<polygon fill="lightgreen" stroke="black" points="9836.5,-3379.77 9545.5,-3379.77 9545.5,-3327.77 9836.5,-3327.77 9836.5,-3379.77"/>
<text text-anchor="middle" x="9691" y="-3367.77" font-family="Arial" font-size="10.00">MHA Attention TP6</text>
<text text-anchor="middle" x="9691" y="-3356.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9691" y="-3345.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9691" y="-3334.77" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- mha_qkv_l1_tp6&#45;&gt;mha_attn_l1_tp6 -->
<g id="edge395" class="edge">
<title>mha_qkv_l1_tp6&#45;&gt;mha_attn_l1_tp6</title>
<path fill="none" stroke="black" d="M9691,-3415.44C9691,-3407.48 9691,-3398.54 9691,-3390.02"/>
<polygon fill="black" stroke="black" points="9694.5,-3389.93 9691,-3379.93 9687.5,-3389.93 9694.5,-3389.93"/>
</g>
<!-- mha_out_l1_tp6 -->
<g id="node271" class="node">
<title>mha_out_l1_tp6</title>
<polygon fill="lightgreen" stroke="black" points="9833,-3291.77 9549,-3291.77 9549,-3239.77 9833,-3239.77 9833,-3291.77"/>
<text text-anchor="middle" x="9691" y="-3279.77" font-family="Arial" font-size="10.00">MHA Output TP6</text>
<text text-anchor="middle" x="9691" y="-3268.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9691" y="-3257.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9691" y="-3246.77" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- mha_attn_l1_tp6&#45;&gt;mha_out_l1_tp6 -->
<g id="edge396" class="edge">
<title>mha_attn_l1_tp6&#45;&gt;mha_out_l1_tp6</title>
<path fill="none" stroke="black" d="M9691,-3327.44C9691,-3319.48 9691,-3310.54 9691,-3302.02"/>
<polygon fill="black" stroke="black" points="9694.5,-3301.93 9691,-3291.93 9687.5,-3301.93 9694.5,-3301.93"/>
</g>
<!-- attn_allreduce_l1_tp6 -->
<g id="node272" class="node">
<title>attn_allreduce_l1_tp6</title>
<ellipse fill="lightgray" stroke="black" cx="9691" cy="-3167" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9691" y="-3181" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP6</text>
<text text-anchor="middle" x="9691" y="-3170" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9691" y="-3159" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9691" y="-3148" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- mha_out_l1_tp6&#45;&gt;attn_allreduce_l1_tp6 -->
<g id="edge397" class="edge">
<title>mha_out_l1_tp6&#45;&gt;attn_allreduce_l1_tp6</title>
<path fill="none" stroke="black" d="M9691,-3239.6C9691,-3231.79 9691,-3222.93 9691,-3214.16"/>
<polygon fill="black" stroke="black" points="9694.5,-3213.98 9691,-3203.98 9687.5,-3213.98 9694.5,-3213.98"/>
</g>
<!-- attn_allreduce_l1_tp6&#45;&gt;res_add_l1_tp6 -->
<g id="edge399" class="edge">
<title>attn_allreduce_l1_tp6&#45;&gt;res_add_l1_tp6</title>
<path fill="none" stroke="black" d="M9818,-3139.82C9841.2,-3135.93 9865.26,-3132.48 9888,-3130.23 9931.41,-3125.95 12649.66,-3082.35 13322.58,-3071.61"/>
<polygon fill="black" stroke="black" points="13322.87,-3075.11 13332.82,-3071.45 13322.76,-3068.11 13322.87,-3075.11"/>
</g>
<!-- norm_l1_tp6 -->
<g id="node274" class="node">
<title>norm_l1_tp6</title>
<polygon fill="lightgreen" stroke="black" points="15106,-3006.23 14840,-3006.23 14840,-2954.23 15106,-2954.23 15106,-3006.23"/>
<text text-anchor="middle" x="14973" y="-2994.23" font-family="Arial" font-size="10.00">Layer Norm TP6</text>
<text text-anchor="middle" x="14973" y="-2983.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14973" y="-2972.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14973" y="-2961.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- res_add_l1_tp6&#45;&gt;norm_l1_tp6 -->
<g id="edge400" class="edge">
<title>res_add_l1_tp6&#45;&gt;norm_l1_tp6</title>
<path fill="none" stroke="black" d="M13611.19,-3059.26C13895.8,-3042.95 14541.7,-3005.95 14829.73,-2989.44"/>
<polygon fill="black" stroke="black" points="14830.04,-2992.93 14839.82,-2988.87 14829.64,-2985.94 14830.04,-2992.93"/>
</g>
<!-- gate_l1_tp6 -->
<g id="node275" class="node">
<title>gate_l1_tp6</title>
<polygon fill="lightyellow" stroke="black" points="14243.3,-2918.23 13776.72,-2918.23 13656.7,-2814.23 14123.28,-2814.23 14243.3,-2918.23"/>
<text text-anchor="middle" x="13950" y="-2880.23" font-family="Arial" font-size="10.00">Gate Network TP6</text>
<text text-anchor="middle" x="13950" y="-2869.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13950" y="-2858.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="13950" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l1_tp6&#45;&gt;gate_l1_tp6 -->
<g id="edge401" class="edge">
<title>norm_l1_tp6&#45;&gt;gate_l1_tp6</title>
<path fill="none" stroke="black" d="M14839.77,-2971.28C14694.8,-2961.86 14456.39,-2944.09 14252,-2918.23 14251.9,-2918.22 14251.79,-2918.21 14251.69,-2918.2"/>
<polygon fill="black" stroke="black" points="14252.42,-2914.76 14242.05,-2916.95 14251.53,-2921.7 14252.42,-2914.76"/>
</g>
<!-- expert48_l1_tp6 -->
<g id="node276" class="node">
<title>expert48_l1_tp6</title>
<polygon fill="lightcoral" stroke="black" points="14449,-2892.23 14261,-2892.23 14261,-2840.23 14449,-2840.23 14449,-2892.23"/>
<text text-anchor="middle" x="14355" y="-2880.23" font-family="Arial" font-size="10.00">Expert 48</text>
<text text-anchor="middle" x="14355" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14355" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14355" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l1_tp6&#45;&gt;expert48_l1_tp6 -->
<g id="edge402" class="edge">
<title>norm_l1_tp6&#45;&gt;expert48_l1_tp6</title>
<path fill="none" stroke="black" d="M14839.79,-2975.89C14734.31,-2970.3 14584.22,-2955.74 14458,-2918.23 14440.57,-2913.06 14422.5,-2905.1 14406.45,-2897.01"/>
<polygon fill="black" stroke="black" points="14407.75,-2893.74 14397.26,-2892.24 14404.53,-2899.95 14407.75,-2893.74"/>
</g>
<!-- expert49_l1_tp6 -->
<g id="node277" class="node">
<title>expert49_l1_tp6</title>
<polygon fill="lightcoral" stroke="black" points="14655,-2892.23 14467,-2892.23 14467,-2840.23 14655,-2840.23 14655,-2892.23"/>
<text text-anchor="middle" x="14561" y="-2880.23" font-family="Arial" font-size="10.00">Expert 49</text>
<text text-anchor="middle" x="14561" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14561" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14561" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l1_tp6&#45;&gt;expert49_l1_tp6 -->
<g id="edge404" class="edge">
<title>norm_l1_tp6&#45;&gt;expert49_l1_tp6</title>
<path fill="none" stroke="black" d="M14839.8,-2960.88C14784.54,-2951.24 14720.31,-2937.35 14664,-2918.23 14647.26,-2912.55 14629.77,-2904.69 14614.05,-2896.84"/>
<polygon fill="black" stroke="black" points="14615.52,-2893.66 14605.02,-2892.24 14612.34,-2899.9 14615.52,-2893.66"/>
</g>
<!-- expert50_l1_tp6 -->
<g id="node278" class="node">
<title>expert50_l1_tp6</title>
<polygon fill="lightcoral" stroke="black" points="14861,-2892.23 14673,-2892.23 14673,-2840.23 14861,-2840.23 14861,-2892.23"/>
<text text-anchor="middle" x="14767" y="-2880.23" font-family="Arial" font-size="10.00">Expert 50</text>
<text text-anchor="middle" x="14767" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14767" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14767" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l1_tp6&#45;&gt;expert50_l1_tp6 -->
<g id="edge406" class="edge">
<title>norm_l1_tp6&#45;&gt;expert50_l1_tp6</title>
<path fill="none" stroke="black" d="M14926.77,-2954.1C14895.76,-2937.24 14854.76,-2914.95 14822.06,-2897.17"/>
<polygon fill="black" stroke="black" points="14823.53,-2893.99 14813.08,-2892.29 14820.19,-2900.14 14823.53,-2893.99"/>
</g>
<!-- expert51_l1_tp6 -->
<g id="node279" class="node">
<title>expert51_l1_tp6</title>
<polygon fill="lightcoral" stroke="black" points="15067,-2892.23 14879,-2892.23 14879,-2840.23 15067,-2840.23 15067,-2892.23"/>
<text text-anchor="middle" x="14973" y="-2880.23" font-family="Arial" font-size="10.00">Expert 51</text>
<text text-anchor="middle" x="14973" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14973" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14973" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l1_tp6&#45;&gt;expert51_l1_tp6 -->
<g id="edge408" class="edge">
<title>norm_l1_tp6&#45;&gt;expert51_l1_tp6</title>
<path fill="none" stroke="black" d="M14973,-2954.1C14973,-2938.82 14973,-2919.09 14973,-2902.3"/>
<polygon fill="black" stroke="black" points="14976.5,-2902.29 14973,-2892.29 14969.5,-2902.29 14976.5,-2902.29"/>
</g>
<!-- expert52_l1_tp6 -->
<g id="node280" class="node">
<title>expert52_l1_tp6</title>
<polygon fill="lightcoral" stroke="black" points="15273,-2892.23 15085,-2892.23 15085,-2840.23 15273,-2840.23 15273,-2892.23"/>
<text text-anchor="middle" x="15179" y="-2880.23" font-family="Arial" font-size="10.00">Expert 52</text>
<text text-anchor="middle" x="15179" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15179" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15179" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l1_tp6&#45;&gt;expert52_l1_tp6 -->
<g id="edge410" class="edge">
<title>norm_l1_tp6&#45;&gt;expert52_l1_tp6</title>
<path fill="none" stroke="black" d="M15019.23,-2954.1C15050.24,-2937.24 15091.24,-2914.95 15123.94,-2897.17"/>
<polygon fill="black" stroke="black" points="15125.81,-2900.14 15132.92,-2892.29 15122.47,-2893.99 15125.81,-2900.14"/>
</g>
<!-- expert53_l1_tp6 -->
<g id="node281" class="node">
<title>expert53_l1_tp6</title>
<polygon fill="lightcoral" stroke="black" points="15479,-2892.23 15291,-2892.23 15291,-2840.23 15479,-2840.23 15479,-2892.23"/>
<text text-anchor="middle" x="15385" y="-2880.23" font-family="Arial" font-size="10.00">Expert 53</text>
<text text-anchor="middle" x="15385" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15385" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15385" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l1_tp6&#45;&gt;expert53_l1_tp6 -->
<g id="edge412" class="edge">
<title>norm_l1_tp6&#45;&gt;expert53_l1_tp6</title>
<path fill="none" stroke="black" d="M15106.2,-2960.88C15161.46,-2951.24 15225.69,-2937.35 15282,-2918.23 15298.74,-2912.55 15316.23,-2904.69 15331.95,-2896.84"/>
<polygon fill="black" stroke="black" points="15333.66,-2899.9 15340.98,-2892.24 15330.48,-2893.66 15333.66,-2899.9"/>
</g>
<!-- expert54_l1_tp6 -->
<g id="node282" class="node">
<title>expert54_l1_tp6</title>
<polygon fill="lightcoral" stroke="black" points="15685,-2892.23 15497,-2892.23 15497,-2840.23 15685,-2840.23 15685,-2892.23"/>
<text text-anchor="middle" x="15591" y="-2880.23" font-family="Arial" font-size="10.00">Expert 54</text>
<text text-anchor="middle" x="15591" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15591" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15591" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l1_tp6&#45;&gt;expert54_l1_tp6 -->
<g id="edge414" class="edge">
<title>norm_l1_tp6&#45;&gt;expert54_l1_tp6</title>
<path fill="none" stroke="black" d="M15106.21,-2975.89C15211.69,-2970.3 15361.78,-2955.74 15488,-2918.23 15505.43,-2913.06 15523.5,-2905.1 15539.55,-2897.01"/>
<polygon fill="black" stroke="black" points="15541.47,-2899.95 15548.74,-2892.24 15538.25,-2893.74 15541.47,-2899.95"/>
</g>
<!-- expert55_l1_tp6 -->
<g id="node283" class="node">
<title>expert55_l1_tp6</title>
<polygon fill="lightcoral" stroke="black" points="15891,-2892.23 15703,-2892.23 15703,-2840.23 15891,-2840.23 15891,-2892.23"/>
<text text-anchor="middle" x="15797" y="-2880.23" font-family="Arial" font-size="10.00">Expert 55</text>
<text text-anchor="middle" x="15797" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15797" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15797" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l1_tp6&#45;&gt;expert55_l1_tp6 -->
<g id="edge416" class="edge">
<title>norm_l1_tp6&#45;&gt;expert55_l1_tp6</title>
<path fill="none" stroke="black" d="M15106.01,-2973.93C15283.24,-2965.83 15586.92,-2948.11 15694,-2918.23 15711.67,-2913.3 15729.94,-2905.34 15746.09,-2897.15"/>
<polygon fill="black" stroke="black" points="15748.09,-2900.05 15755.34,-2892.32 15744.85,-2893.85 15748.09,-2900.05"/>
</g>
<!-- res_add2_l1_tp6 -->
<g id="node285" class="node">
<title>res_add2_l1_tp6</title>
<polygon fill="lightgreen" stroke="black" points="15215,-2638.23 14937,-2638.23 14937,-2586.23 15215,-2586.23 15215,-2638.23"/>
<text text-anchor="middle" x="15076" y="-2626.23" font-family="Arial" font-size="10.00">Residual Add 2 TP6</text>
<text text-anchor="middle" x="15076" y="-2615.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="15076" y="-2604.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15076" y="-2593.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- norm_l1_tp6&#45;&gt;res_add2_l1_tp6 -->
<g id="edge419" class="edge">
<title>norm_l1_tp6&#45;&gt;res_add2_l1_tp6</title>
<path fill="none" stroke="black" d="M15106.04,-2975.23C15356.03,-2967.04 15873.3,-2946.75 15900,-2918.23 15915.8,-2901.36 15914.14,-2832.52 15900,-2814.23 15748.58,-2618.46 15601.85,-2731.26 15361,-2674.23 15311.37,-2662.48 15256.63,-2650.53 15208.51,-2640.35"/>
<polygon fill="black" stroke="black" points="15209.16,-2636.91 15198.66,-2638.27 15207.72,-2643.76 15209.16,-2636.91"/>
</g>
<!-- expert_agg_l1_tp6 -->
<g id="node284" class="node">
<title>expert_agg_l1_tp6</title>
<polygon fill="lightpink" stroke="black" points="15351.55,-2778.23 14913.21,-2778.23 14800.45,-2674.23 15238.79,-2674.23 15351.55,-2778.23"/>
<text text-anchor="middle" x="15076" y="-2740.23" font-family="Arial" font-size="10.00">Expert Aggregation TP6</text>
<text text-anchor="middle" x="15076" y="-2729.23" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="15076" y="-2718.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15076" y="-2707.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- expert48_l1_tp6&#45;&gt;expert_agg_l1_tp6 -->
<g id="edge403" class="edge">
<title>expert48_l1_tp6&#45;&gt;expert_agg_l1_tp6</title>
<path fill="none" stroke="black" d="M14397.83,-2840.19C14415.86,-2830.67 14437.41,-2820.6 14458,-2814.23 14588.51,-2773.89 14740.37,-2752.18 14860.89,-2740.54"/>
<polygon fill="black" stroke="black" points="14861.36,-2744.01 14870.98,-2739.58 14860.7,-2737.04 14861.36,-2744.01"/>
</g>
<!-- expert49_l1_tp6&#45;&gt;expert_agg_l1_tp6 -->
<g id="edge405" class="edge">
<title>expert49_l1_tp6&#45;&gt;expert_agg_l1_tp6</title>
<path fill="none" stroke="black" d="M14605.32,-2840.23C14623.12,-2831.01 14644.11,-2821.13 14664,-2814.23 14732.63,-2790.43 14810.05,-2771.99 14879.1,-2758.35"/>
<polygon fill="black" stroke="black" points="14880.08,-2761.72 14889.22,-2756.37 14878.74,-2754.85 14880.08,-2761.72"/>
</g>
<!-- expert50_l1_tp6&#45;&gt;expert_agg_l1_tp6 -->
<g id="edge407" class="edge">
<title>expert50_l1_tp6&#45;&gt;expert_agg_l1_tp6</title>
<path fill="none" stroke="black" d="M14816.22,-2840.11C14833.16,-2831.67 14852.31,-2822.34 14870,-2814.23 14893.32,-2803.55 14918.31,-2792.59 14942.58,-2782.2"/>
<polygon fill="black" stroke="black" points="14944.01,-2785.39 14951.83,-2778.25 14941.26,-2778.96 14944.01,-2785.39"/>
</g>
<!-- expert51_l1_tp6&#45;&gt;expert_agg_l1_tp6 -->
<g id="edge409" class="edge">
<title>expert51_l1_tp6&#45;&gt;expert_agg_l1_tp6</title>
<path fill="none" stroke="black" d="M14991.89,-2839.92C15003.07,-2824.94 15017.74,-2805.3 15031.68,-2786.61"/>
<polygon fill="black" stroke="black" points="15034.64,-2788.5 15037.81,-2778.4 15029.03,-2784.32 15034.64,-2788.5"/>
</g>
<!-- expert52_l1_tp6&#45;&gt;expert_agg_l1_tp6 -->
<g id="edge411" class="edge">
<title>expert52_l1_tp6&#45;&gt;expert_agg_l1_tp6</title>
<path fill="none" stroke="black" d="M15160.11,-2839.92C15148.93,-2824.94 15134.26,-2805.3 15120.32,-2786.61"/>
<polygon fill="black" stroke="black" points="15122.97,-2784.32 15114.19,-2778.4 15117.36,-2788.5 15122.97,-2784.32"/>
</g>
<!-- expert53_l1_tp6&#45;&gt;expert_agg_l1_tp6 -->
<g id="edge413" class="edge">
<title>expert53_l1_tp6&#45;&gt;expert_agg_l1_tp6</title>
<path fill="none" stroke="black" d="M15335.78,-2840.11C15318.84,-2831.67 15299.69,-2822.34 15282,-2814.23 15258.68,-2803.55 15233.69,-2792.59 15209.42,-2782.2"/>
<polygon fill="black" stroke="black" points="15210.74,-2778.96 15200.17,-2778.25 15207.99,-2785.39 15210.74,-2778.96"/>
</g>
<!-- expert54_l1_tp6&#45;&gt;expert_agg_l1_tp6 -->
<g id="edge415" class="edge">
<title>expert54_l1_tp6&#45;&gt;expert_agg_l1_tp6</title>
<path fill="none" stroke="black" d="M15546.68,-2840.23C15528.88,-2831.01 15507.89,-2821.13 15488,-2814.23 15446.34,-2799.78 15401.43,-2787.31 15357.13,-2776.68"/>
<polygon fill="black" stroke="black" points="15357.92,-2773.28 15347.38,-2774.38 15356.31,-2780.09 15357.92,-2773.28"/>
</g>
<!-- expert55_l1_tp6&#45;&gt;expert_agg_l1_tp6 -->
<g id="edge417" class="edge">
<title>expert55_l1_tp6&#45;&gt;expert_agg_l1_tp6</title>
<path fill="none" stroke="black" d="M15754.17,-2840.19C15736.14,-2830.67 15714.59,-2820.6 15694,-2814.23 15574.81,-2777.39 15437.81,-2756.09 15323.14,-2743.8"/>
<polygon fill="black" stroke="black" points="15323.49,-2740.32 15313.17,-2742.75 15322.75,-2747.28 15323.49,-2740.32"/>
</g>
<!-- expert_agg_l1_tp6&#45;&gt;res_add2_l1_tp6 -->
<g id="edge418" class="edge">
<title>expert_agg_l1_tp6&#45;&gt;res_add2_l1_tp6</title>
<path fill="none" stroke="black" d="M15076,-2674.15C15076,-2665.49 15076,-2656.66 15076,-2648.52"/>
<polygon fill="black" stroke="black" points="15079.5,-2648.28 15076,-2638.28 15072.5,-2648.28 15079.5,-2648.28"/>
</g>
<!-- norm2_l1_tp6 -->
<g id="node286" class="node">
<title>norm2_l1_tp6</title>
<polygon fill="lightgreen" stroke="black" points="13926,-2550.23 13660,-2550.23 13660,-2498.23 13926,-2498.23 13926,-2550.23"/>
<text text-anchor="middle" x="13793" y="-2538.23" font-family="Arial" font-size="10.00">Layer Norm 2 TP6</text>
<text text-anchor="middle" x="13793" y="-2527.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13793" y="-2516.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13793" y="-2505.23" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- res_add2_l1_tp6&#45;&gt;norm2_l1_tp6 -->
<g id="edge420" class="edge">
<title>res_add2_l1_tp6&#45;&gt;norm2_l1_tp6</title>
<path fill="none" stroke="black" d="M14936.87,-2601.91C14691.65,-2585.47 14185.01,-2551.51 13936.63,-2534.86"/>
<polygon fill="black" stroke="black" points="13936.67,-2531.36 13926.45,-2534.18 13936.2,-2538.34 13936.67,-2531.36"/>
</g>
<!-- norm2_l1_tp6&#45;&gt;pipeline_comm_01 -->
<g id="edge461" class="edge">
<title>norm2_l1_tp6&#45;&gt;pipeline_comm_01</title>
<path fill="none" stroke="black" d="M13659.74,-2519.31C13077.08,-2502.14 10751.74,-2433.62 10059.43,-2413.22"/>
<polygon fill="black" stroke="black" points="10059.46,-2409.72 10049.36,-2412.93 10059.25,-2416.72 10059.46,-2409.72"/>
</g>
<!-- mha_qkv_l1_tp7 -->
<g id="node288" class="node">
<title>mha_qkv_l1_tp7</title>
<polygon fill="lightgreen" stroke="black" points="10230.5,-3467.77 9939.5,-3467.77 9939.5,-3415.77 10230.5,-3415.77 10230.5,-3467.77"/>
<text text-anchor="middle" x="10085" y="-3455.77" font-family="Arial" font-size="10.00">MHA QKV TP7</text>
<text text-anchor="middle" x="10085" y="-3444.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="10085" y="-3433.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="10085" y="-3422.77" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- input_split_l1_tp7&#45;&gt;mha_qkv_l1_tp7 -->
<g id="edge422" class="edge">
<title>input_split_l1_tp7&#45;&gt;mha_qkv_l1_tp7</title>
<path fill="none" stroke="black" d="M10085,-3503.51C10085,-3495.2 10085,-3486.36 10085,-3478.08"/>
<polygon fill="black" stroke="black" points="10088.5,-3477.97 10085,-3467.97 10081.5,-3477.97 10088.5,-3477.97"/>
</g>
<!-- mha_attn_l1_tp7 -->
<g id="node289" class="node">
<title>mha_attn_l1_tp7</title>
<polygon fill="lightgreen" stroke="black" points="10230.5,-3379.77 9939.5,-3379.77 9939.5,-3327.77 10230.5,-3327.77 10230.5,-3379.77"/>
<text text-anchor="middle" x="10085" y="-3367.77" font-family="Arial" font-size="10.00">MHA Attention TP7</text>
<text text-anchor="middle" x="10085" y="-3356.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="10085" y="-3345.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="10085" y="-3334.77" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- mha_qkv_l1_tp7&#45;&gt;mha_attn_l1_tp7 -->
<g id="edge423" class="edge">
<title>mha_qkv_l1_tp7&#45;&gt;mha_attn_l1_tp7</title>
<path fill="none" stroke="black" d="M10085,-3415.44C10085,-3407.48 10085,-3398.54 10085,-3390.02"/>
<polygon fill="black" stroke="black" points="10088.5,-3389.93 10085,-3379.93 10081.5,-3389.93 10088.5,-3389.93"/>
</g>
<!-- mha_out_l1_tp7 -->
<g id="node290" class="node">
<title>mha_out_l1_tp7</title>
<polygon fill="lightgreen" stroke="black" points="10227,-3291.77 9943,-3291.77 9943,-3239.77 10227,-3239.77 10227,-3291.77"/>
<text text-anchor="middle" x="10085" y="-3279.77" font-family="Arial" font-size="10.00">MHA Output TP7</text>
<text text-anchor="middle" x="10085" y="-3268.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="10085" y="-3257.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="10085" y="-3246.77" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- mha_attn_l1_tp7&#45;&gt;mha_out_l1_tp7 -->
<g id="edge424" class="edge">
<title>mha_attn_l1_tp7&#45;&gt;mha_out_l1_tp7</title>
<path fill="none" stroke="black" d="M10085,-3327.44C10085,-3319.48 10085,-3310.54 10085,-3302.02"/>
<polygon fill="black" stroke="black" points="10088.5,-3301.93 10085,-3291.93 10081.5,-3301.93 10088.5,-3301.93"/>
</g>
<!-- attn_allreduce_l1_tp7 -->
<g id="node291" class="node">
<title>attn_allreduce_l1_tp7</title>
<ellipse fill="lightgray" stroke="black" cx="10085" cy="-3167" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="10085" y="-3181" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP7</text>
<text text-anchor="middle" x="10085" y="-3170" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="10085" y="-3159" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10085" y="-3148" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- mha_out_l1_tp7&#45;&gt;attn_allreduce_l1_tp7 -->
<g id="edge425" class="edge">
<title>mha_out_l1_tp7&#45;&gt;attn_allreduce_l1_tp7</title>
<path fill="none" stroke="black" d="M10085,-3239.6C10085,-3231.79 10085,-3222.93 10085,-3214.16"/>
<polygon fill="black" stroke="black" points="10088.5,-3213.98 10085,-3203.98 10081.5,-3213.98 10088.5,-3213.98"/>
</g>
<!-- attn_allreduce_l1_tp7&#45;&gt;res_add_l1_tp7 -->
<g id="edge427" class="edge">
<title>attn_allreduce_l1_tp7&#45;&gt;res_add_l1_tp7</title>
<path fill="none" stroke="black" d="M10272,-3162.67C11119.56,-3147.54 14592.33,-3085.54 15356.72,-3071.9"/>
<polygon fill="black" stroke="black" points="15357.02,-3075.39 15366.96,-3071.72 15356.9,-3068.4 15357.02,-3075.39"/>
</g>
<!-- norm_l1_tp7 -->
<g id="node293" class="node">
<title>norm_l1_tp7</title>
<polygon fill="lightgreen" stroke="black" points="17378,-3006.23 17112,-3006.23 17112,-2954.23 17378,-2954.23 17378,-3006.23"/>
<text text-anchor="middle" x="17245" y="-2994.23" font-family="Arial" font-size="10.00">Layer Norm TP7</text>
<text text-anchor="middle" x="17245" y="-2983.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="17245" y="-2972.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="17245" y="-2961.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- res_add_l1_tp7&#45;&gt;norm_l1_tp7 -->
<g id="edge428" class="edge">
<title>res_add_l1_tp7&#45;&gt;norm_l1_tp7</title>
<path fill="none" stroke="black" d="M15645,-3060.36C15969.31,-3044.32 16773.27,-3004.56 17101.73,-2988.32"/>
<polygon fill="black" stroke="black" points="17101.97,-2991.81 17111.78,-2987.82 17101.62,-2984.82 17101.97,-2991.81"/>
</g>
<!-- gate_l1_tp7 -->
<g id="node294" class="node">
<title>gate_l1_tp7</title>
<polygon fill="lightyellow" stroke="black" points="16515.3,-2918.23 16048.72,-2918.23 15928.7,-2814.23 16395.28,-2814.23 16515.3,-2918.23"/>
<text text-anchor="middle" x="16222" y="-2880.23" font-family="Arial" font-size="10.00">Gate Network TP7</text>
<text text-anchor="middle" x="16222" y="-2869.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16222" y="-2858.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="16222" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l1_tp7&#45;&gt;gate_l1_tp7 -->
<g id="edge429" class="edge">
<title>norm_l1_tp7&#45;&gt;gate_l1_tp7</title>
<path fill="none" stroke="black" d="M17111.77,-2971.28C16966.8,-2961.86 16728.39,-2944.09 16524,-2918.23 16523.9,-2918.22 16523.79,-2918.21 16523.69,-2918.2"/>
<polygon fill="black" stroke="black" points="16524.42,-2914.76 16514.05,-2916.95 16523.53,-2921.7 16524.42,-2914.76"/>
</g>
<!-- expert56_l1_tp7 -->
<g id="node295" class="node">
<title>expert56_l1_tp7</title>
<polygon fill="lightcoral" stroke="black" points="16721,-2892.23 16533,-2892.23 16533,-2840.23 16721,-2840.23 16721,-2892.23"/>
<text text-anchor="middle" x="16627" y="-2880.23" font-family="Arial" font-size="10.00">Expert 56</text>
<text text-anchor="middle" x="16627" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16627" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16627" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l1_tp7&#45;&gt;expert56_l1_tp7 -->
<g id="edge430" class="edge">
<title>norm_l1_tp7&#45;&gt;expert56_l1_tp7</title>
<path fill="none" stroke="black" d="M17111.79,-2975.89C17006.31,-2970.3 16856.22,-2955.74 16730,-2918.23 16712.57,-2913.06 16694.5,-2905.1 16678.45,-2897.01"/>
<polygon fill="black" stroke="black" points="16679.75,-2893.74 16669.26,-2892.24 16676.53,-2899.95 16679.75,-2893.74"/>
</g>
<!-- expert57_l1_tp7 -->
<g id="node296" class="node">
<title>expert57_l1_tp7</title>
<polygon fill="lightcoral" stroke="black" points="16927,-2892.23 16739,-2892.23 16739,-2840.23 16927,-2840.23 16927,-2892.23"/>
<text text-anchor="middle" x="16833" y="-2880.23" font-family="Arial" font-size="10.00">Expert 57</text>
<text text-anchor="middle" x="16833" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16833" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16833" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l1_tp7&#45;&gt;expert57_l1_tp7 -->
<g id="edge432" class="edge">
<title>norm_l1_tp7&#45;&gt;expert57_l1_tp7</title>
<path fill="none" stroke="black" d="M17111.8,-2960.88C17056.54,-2951.24 16992.31,-2937.35 16936,-2918.23 16919.26,-2912.55 16901.77,-2904.69 16886.05,-2896.84"/>
<polygon fill="black" stroke="black" points="16887.52,-2893.66 16877.02,-2892.24 16884.34,-2899.9 16887.52,-2893.66"/>
</g>
<!-- expert58_l1_tp7 -->
<g id="node297" class="node">
<title>expert58_l1_tp7</title>
<polygon fill="lightcoral" stroke="black" points="17133,-2892.23 16945,-2892.23 16945,-2840.23 17133,-2840.23 17133,-2892.23"/>
<text text-anchor="middle" x="17039" y="-2880.23" font-family="Arial" font-size="10.00">Expert 58</text>
<text text-anchor="middle" x="17039" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17039" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17039" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l1_tp7&#45;&gt;expert58_l1_tp7 -->
<g id="edge434" class="edge">
<title>norm_l1_tp7&#45;&gt;expert58_l1_tp7</title>
<path fill="none" stroke="black" d="M17198.77,-2954.1C17167.76,-2937.24 17126.76,-2914.95 17094.06,-2897.17"/>
<polygon fill="black" stroke="black" points="17095.53,-2893.99 17085.08,-2892.29 17092.19,-2900.14 17095.53,-2893.99"/>
</g>
<!-- expert59_l1_tp7 -->
<g id="node298" class="node">
<title>expert59_l1_tp7</title>
<polygon fill="lightcoral" stroke="black" points="17339,-2892.23 17151,-2892.23 17151,-2840.23 17339,-2840.23 17339,-2892.23"/>
<text text-anchor="middle" x="17245" y="-2880.23" font-family="Arial" font-size="10.00">Expert 59</text>
<text text-anchor="middle" x="17245" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17245" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17245" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l1_tp7&#45;&gt;expert59_l1_tp7 -->
<g id="edge436" class="edge">
<title>norm_l1_tp7&#45;&gt;expert59_l1_tp7</title>
<path fill="none" stroke="black" d="M17245,-2954.1C17245,-2938.82 17245,-2919.09 17245,-2902.3"/>
<polygon fill="black" stroke="black" points="17248.5,-2902.29 17245,-2892.29 17241.5,-2902.29 17248.5,-2902.29"/>
</g>
<!-- expert60_l1_tp7 -->
<g id="node299" class="node">
<title>expert60_l1_tp7</title>
<polygon fill="lightcoral" stroke="black" points="17545,-2892.23 17357,-2892.23 17357,-2840.23 17545,-2840.23 17545,-2892.23"/>
<text text-anchor="middle" x="17451" y="-2880.23" font-family="Arial" font-size="10.00">Expert 60</text>
<text text-anchor="middle" x="17451" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17451" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17451" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l1_tp7&#45;&gt;expert60_l1_tp7 -->
<g id="edge438" class="edge">
<title>norm_l1_tp7&#45;&gt;expert60_l1_tp7</title>
<path fill="none" stroke="black" d="M17291.23,-2954.1C17322.24,-2937.24 17363.24,-2914.95 17395.94,-2897.17"/>
<polygon fill="black" stroke="black" points="17397.81,-2900.14 17404.92,-2892.29 17394.47,-2893.99 17397.81,-2900.14"/>
</g>
<!-- expert61_l1_tp7 -->
<g id="node300" class="node">
<title>expert61_l1_tp7</title>
<polygon fill="lightcoral" stroke="black" points="17751,-2892.23 17563,-2892.23 17563,-2840.23 17751,-2840.23 17751,-2892.23"/>
<text text-anchor="middle" x="17657" y="-2880.23" font-family="Arial" font-size="10.00">Expert 61</text>
<text text-anchor="middle" x="17657" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17657" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17657" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l1_tp7&#45;&gt;expert61_l1_tp7 -->
<g id="edge440" class="edge">
<title>norm_l1_tp7&#45;&gt;expert61_l1_tp7</title>
<path fill="none" stroke="black" d="M17378.2,-2960.88C17433.46,-2951.24 17497.69,-2937.35 17554,-2918.23 17570.74,-2912.55 17588.23,-2904.69 17603.95,-2896.84"/>
<polygon fill="black" stroke="black" points="17605.66,-2899.9 17612.98,-2892.24 17602.48,-2893.66 17605.66,-2899.9"/>
</g>
<!-- expert62_l1_tp7 -->
<g id="node301" class="node">
<title>expert62_l1_tp7</title>
<polygon fill="lightcoral" stroke="black" points="17957,-2892.23 17769,-2892.23 17769,-2840.23 17957,-2840.23 17957,-2892.23"/>
<text text-anchor="middle" x="17863" y="-2880.23" font-family="Arial" font-size="10.00">Expert 62</text>
<text text-anchor="middle" x="17863" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17863" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17863" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l1_tp7&#45;&gt;expert62_l1_tp7 -->
<g id="edge442" class="edge">
<title>norm_l1_tp7&#45;&gt;expert62_l1_tp7</title>
<path fill="none" stroke="black" d="M17378.21,-2975.89C17483.69,-2970.3 17633.78,-2955.74 17760,-2918.23 17777.43,-2913.06 17795.5,-2905.1 17811.55,-2897.01"/>
<polygon fill="black" stroke="black" points="17813.47,-2899.95 17820.74,-2892.24 17810.25,-2893.74 17813.47,-2899.95"/>
</g>
<!-- expert63_l1_tp7 -->
<g id="node302" class="node">
<title>expert63_l1_tp7</title>
<polygon fill="lightcoral" stroke="black" points="18163,-2892.23 17975,-2892.23 17975,-2840.23 18163,-2840.23 18163,-2892.23"/>
<text text-anchor="middle" x="18069" y="-2880.23" font-family="Arial" font-size="10.00">Expert 63</text>
<text text-anchor="middle" x="18069" y="-2869.23" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18069" y="-2858.23" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18069" y="-2847.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l1_tp7&#45;&gt;expert63_l1_tp7 -->
<g id="edge444" class="edge">
<title>norm_l1_tp7&#45;&gt;expert63_l1_tp7</title>
<path fill="none" stroke="black" d="M17378.01,-2973.93C17555.24,-2965.83 17858.92,-2948.11 17966,-2918.23 17983.67,-2913.3 18001.94,-2905.34 18018.09,-2897.15"/>
<polygon fill="black" stroke="black" points="18020.09,-2900.05 18027.34,-2892.32 18016.85,-2893.85 18020.09,-2900.05"/>
</g>
<!-- res_add2_l1_tp7 -->
<g id="node304" class="node">
<title>res_add2_l1_tp7</title>
<polygon fill="lightgreen" stroke="black" points="17487,-2638.23 17209,-2638.23 17209,-2586.23 17487,-2586.23 17487,-2638.23"/>
<text text-anchor="middle" x="17348" y="-2626.23" font-family="Arial" font-size="10.00">Residual Add 2 TP7</text>
<text text-anchor="middle" x="17348" y="-2615.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="17348" y="-2604.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="17348" y="-2593.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- norm_l1_tp7&#45;&gt;res_add2_l1_tp7 -->
<g id="edge447" class="edge">
<title>norm_l1_tp7&#45;&gt;res_add2_l1_tp7</title>
<path fill="none" stroke="black" d="M17378.04,-2975.23C17628.03,-2967.04 18145.3,-2946.75 18172,-2918.23 18376.08,-2700.28 17786.34,-2637.31 17497.39,-2619.75"/>
<polygon fill="black" stroke="black" points="17497.43,-2616.24 17487.24,-2619.14 17497.02,-2623.23 17497.43,-2616.24"/>
</g>
<!-- expert_agg_l1_tp7 -->
<g id="node303" class="node">
<title>expert_agg_l1_tp7</title>
<polygon fill="lightpink" stroke="black" points="17623.55,-2778.23 17185.21,-2778.23 17072.45,-2674.23 17510.79,-2674.23 17623.55,-2778.23"/>
<text text-anchor="middle" x="17348" y="-2740.23" font-family="Arial" font-size="10.00">Expert Aggregation TP7</text>
<text text-anchor="middle" x="17348" y="-2729.23" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="17348" y="-2718.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="17348" y="-2707.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- expert56_l1_tp7&#45;&gt;expert_agg_l1_tp7 -->
<g id="edge431" class="edge">
<title>expert56_l1_tp7&#45;&gt;expert_agg_l1_tp7</title>
<path fill="none" stroke="black" d="M16669.83,-2840.19C16687.86,-2830.67 16709.41,-2820.6 16730,-2814.23 16860.51,-2773.89 17012.37,-2752.18 17132.89,-2740.54"/>
<polygon fill="black" stroke="black" points="17133.36,-2744.01 17142.98,-2739.58 17132.7,-2737.04 17133.36,-2744.01"/>
</g>
<!-- expert57_l1_tp7&#45;&gt;expert_agg_l1_tp7 -->
<g id="edge433" class="edge">
<title>expert57_l1_tp7&#45;&gt;expert_agg_l1_tp7</title>
<path fill="none" stroke="black" d="M16877.32,-2840.23C16895.12,-2831.01 16916.11,-2821.13 16936,-2814.23 17004.63,-2790.43 17082.05,-2771.99 17151.1,-2758.35"/>
<polygon fill="black" stroke="black" points="17152.08,-2761.72 17161.22,-2756.37 17150.74,-2754.85 17152.08,-2761.72"/>
</g>
<!-- expert58_l1_tp7&#45;&gt;expert_agg_l1_tp7 -->
<g id="edge435" class="edge">
<title>expert58_l1_tp7&#45;&gt;expert_agg_l1_tp7</title>
<path fill="none" stroke="black" d="M17088.22,-2840.11C17105.16,-2831.67 17124.31,-2822.34 17142,-2814.23 17165.32,-2803.55 17190.31,-2792.59 17214.58,-2782.2"/>
<polygon fill="black" stroke="black" points="17216.01,-2785.39 17223.83,-2778.25 17213.26,-2778.96 17216.01,-2785.39"/>
</g>
<!-- expert59_l1_tp7&#45;&gt;expert_agg_l1_tp7 -->
<g id="edge437" class="edge">
<title>expert59_l1_tp7&#45;&gt;expert_agg_l1_tp7</title>
<path fill="none" stroke="black" d="M17263.89,-2839.92C17275.07,-2824.94 17289.74,-2805.3 17303.68,-2786.61"/>
<polygon fill="black" stroke="black" points="17306.64,-2788.5 17309.81,-2778.4 17301.03,-2784.32 17306.64,-2788.5"/>
</g>
<!-- expert60_l1_tp7&#45;&gt;expert_agg_l1_tp7 -->
<g id="edge439" class="edge">
<title>expert60_l1_tp7&#45;&gt;expert_agg_l1_tp7</title>
<path fill="none" stroke="black" d="M17432.11,-2839.92C17420.93,-2824.94 17406.26,-2805.3 17392.32,-2786.61"/>
<polygon fill="black" stroke="black" points="17394.97,-2784.32 17386.19,-2778.4 17389.36,-2788.5 17394.97,-2784.32"/>
</g>
<!-- expert61_l1_tp7&#45;&gt;expert_agg_l1_tp7 -->
<g id="edge441" class="edge">
<title>expert61_l1_tp7&#45;&gt;expert_agg_l1_tp7</title>
<path fill="none" stroke="black" d="M17607.78,-2840.11C17590.84,-2831.67 17571.69,-2822.34 17554,-2814.23 17530.68,-2803.55 17505.69,-2792.59 17481.42,-2782.2"/>
<polygon fill="black" stroke="black" points="17482.74,-2778.96 17472.17,-2778.25 17479.99,-2785.39 17482.74,-2778.96"/>
</g>
<!-- expert62_l1_tp7&#45;&gt;expert_agg_l1_tp7 -->
<g id="edge443" class="edge">
<title>expert62_l1_tp7&#45;&gt;expert_agg_l1_tp7</title>
<path fill="none" stroke="black" d="M17818.68,-2840.23C17800.88,-2831.01 17779.89,-2821.13 17760,-2814.23 17718.34,-2799.78 17673.43,-2787.31 17629.13,-2776.68"/>
<polygon fill="black" stroke="black" points="17629.92,-2773.28 17619.38,-2774.38 17628.31,-2780.09 17629.92,-2773.28"/>
</g>
<!-- expert63_l1_tp7&#45;&gt;expert_agg_l1_tp7 -->
<g id="edge445" class="edge">
<title>expert63_l1_tp7&#45;&gt;expert_agg_l1_tp7</title>
<path fill="none" stroke="black" d="M18026.17,-2840.19C18008.14,-2830.67 17986.59,-2820.6 17966,-2814.23 17846.81,-2777.39 17709.81,-2756.09 17595.14,-2743.8"/>
<polygon fill="black" stroke="black" points="17595.49,-2740.32 17585.17,-2742.75 17594.75,-2747.28 17595.49,-2740.32"/>
</g>
<!-- expert_agg_l1_tp7&#45;&gt;res_add2_l1_tp7 -->
<g id="edge446" class="edge">
<title>expert_agg_l1_tp7&#45;&gt;res_add2_l1_tp7</title>
<path fill="none" stroke="black" d="M17348,-2674.15C17348,-2665.49 17348,-2656.66 17348,-2648.52"/>
<polygon fill="black" stroke="black" points="17351.5,-2648.28 17348,-2638.28 17344.5,-2648.28 17351.5,-2648.28"/>
</g>
<!-- norm2_l1_tp7 -->
<g id="node305" class="node">
<title>norm2_l1_tp7</title>
<polygon fill="lightgreen" stroke="black" points="15951,-2550.23 15685,-2550.23 15685,-2498.23 15951,-2498.23 15951,-2550.23"/>
<text text-anchor="middle" x="15818" y="-2538.23" font-family="Arial" font-size="10.00">Layer Norm 2 TP7</text>
<text text-anchor="middle" x="15818" y="-2527.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15818" y="-2516.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15818" y="-2505.23" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- res_add2_l1_tp7&#45;&gt;norm2_l1_tp7 -->
<g id="edge448" class="edge">
<title>res_add2_l1_tp7&#45;&gt;norm2_l1_tp7</title>
<path fill="none" stroke="black" d="M17208.85,-2603.41C16919.28,-2587.14 16254.52,-2549.77 15961.36,-2533.29"/>
<polygon fill="black" stroke="black" points="15961.27,-2529.78 15951.09,-2532.72 15960.88,-2536.77 15961.27,-2529.78"/>
</g>
<!-- norm2_l1_tp7&#45;&gt;pipeline_comm_01 -->
<g id="edge463" class="edge">
<title>norm2_l1_tp7&#45;&gt;pipeline_comm_01</title>
<path fill="none" stroke="black" d="M15684.73,-2520.18C15376.7,-2513.14 14591.5,-2495.41 13935,-2482.23 12445.69,-2452.34 10649.82,-2421 10061.2,-2410.85"/>
<polygon fill="black" stroke="black" points="10060.97,-2407.34 10050.92,-2410.67 10060.85,-2414.34 10060.97,-2407.34"/>
</g>
<!-- input_split_l2_tp0 -->
<g id="node307" class="node">
<title>input_split_l2_tp0</title>
<ellipse fill="lightgray" stroke="black" cx="16365" cy="-2293.93" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="16365" y="-2307.93" font-family="Arial" font-size="10.00">Input Split TP0</text>
<text text-anchor="middle" x="16365" y="-2296.93" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16365" y="-2285.93" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="16365" y="-2274.93" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- pipeline_comm_01&#45;&gt;input_split_l2_tp0 -->
<g id="edge450" class="edge">
<title>pipeline_comm_01&#45;&gt;input_split_l2_tp0</title>
<path fill="none" stroke="black" d="M10052.16,-2405.36C10676.9,-2404.67 12739.26,-2399.46 14444,-2361.7 15076.66,-2347.68 15826.09,-2317.79 16172.16,-2303.24"/>
<polygon fill="black" stroke="black" points="16172.44,-2306.73 16182.28,-2302.81 16172.15,-2299.73 16172.44,-2306.73"/>
</g>
<!-- input_split_l2_tp1 -->
<g id="node326" class="node">
<title>input_split_l2_tp1</title>
<ellipse fill="lightgray" stroke="black" cx="14247" cy="-2293.93" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="14247" y="-2307.93" font-family="Arial" font-size="10.00">Input Split TP1</text>
<text text-anchor="middle" x="14247" y="-2296.93" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14247" y="-2285.93" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="14247" y="-2274.93" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- pipeline_comm_01&#45;&gt;input_split_l2_tp1 -->
<g id="edge452" class="edge">
<title>pipeline_comm_01&#45;&gt;input_split_l2_tp1</title>
<path fill="none" stroke="black" d="M10051.91,-2403.67C10481.71,-2399.28 11569.52,-2386.48 12479,-2361.7 13052.14,-2346.08 13729.43,-2317.74 14054.29,-2303.53"/>
<polygon fill="black" stroke="black" points="14054.91,-2307.01 14064.74,-2303.07 14054.6,-2300.01 14054.91,-2307.01"/>
</g>
<!-- input_split_l2_tp2 -->
<g id="node345" class="node">
<title>input_split_l2_tp2</title>
<ellipse fill="lightgray" stroke="black" cx="12282" cy="-2293.93" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="12282" y="-2307.93" font-family="Arial" font-size="10.00">Input Split TP2</text>
<text text-anchor="middle" x="12282" y="-2296.93" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12282" y="-2285.93" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="12282" y="-2274.93" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- pipeline_comm_01&#45;&gt;input_split_l2_tp2 -->
<g id="edge454" class="edge">
<title>pipeline_comm_01&#45;&gt;input_split_l2_tp2</title>
<path fill="none" stroke="black" d="M10046.32,-2397.14C10239.05,-2388.33 10551.94,-2374.04 10822,-2361.7 11276.44,-2340.92 11810.44,-2316.5 12089.67,-2303.72"/>
<polygon fill="black" stroke="black" points="12090.08,-2307.21 12099.91,-2303.26 12089.76,-2300.22 12090.08,-2307.21"/>
</g>
<!-- input_split_l2_tp3 -->
<g id="node364" class="node">
<title>input_split_l2_tp3</title>
<ellipse fill="lightgray" stroke="black" cx="10625" cy="-2293.93" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="10625" y="-2307.93" font-family="Arial" font-size="10.00">Input Split TP3</text>
<text text-anchor="middle" x="10625" y="-2296.93" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10625" y="-2285.93" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="10625" y="-2274.93" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- pipeline_comm_01&#45;&gt;input_split_l2_tp3 -->
<g id="edge456" class="edge">
<title>pipeline_comm_01&#45;&gt;input_split_l2_tp3</title>
<path fill="none" stroke="black" d="M10012.54,-2383.89C10143.14,-2364.92 10332.71,-2337.38 10466.27,-2317.98"/>
<polygon fill="black" stroke="black" points="10466.8,-2321.44 10476.19,-2316.54 10465.79,-2314.52 10466.8,-2321.44"/>
</g>
<!-- input_split_l2_tp4 -->
<g id="node383" class="node">
<title>input_split_l2_tp4</title>
<ellipse fill="lightgray" stroke="black" cx="9602" cy="-2293.93" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9602" y="-2307.93" font-family="Arial" font-size="10.00">Input Split TP4</text>
<text text-anchor="middle" x="9602" y="-2296.93" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9602" y="-2285.93" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9602" y="-2274.93" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- pipeline_comm_01&#45;&gt;input_split_l2_tp4 -->
<g id="edge458" class="edge">
<title>pipeline_comm_01&#45;&gt;input_split_l2_tp4</title>
<path fill="none" stroke="black" d="M9786.81,-2372.9C9756.03,-2359.91 9720.47,-2344.91 9688.8,-2331.55"/>
<polygon fill="black" stroke="black" points="9690.12,-2328.31 9679.55,-2327.64 9687.4,-2334.75 9690.12,-2328.31"/>
</g>
<!-- input_split_l2_tp5 -->
<g id="node402" class="node">
<title>input_split_l2_tp5</title>
<ellipse fill="lightgray" stroke="black" cx="8491" cy="-2293.93" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8491" y="-2307.93" font-family="Arial" font-size="10.00">Input Split TP5</text>
<text text-anchor="middle" x="8491" y="-2296.93" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8491" y="-2285.93" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8491" y="-2274.93" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- pipeline_comm_01&#45;&gt;input_split_l2_tp5 -->
<g id="edge460" class="edge">
<title>pipeline_comm_01&#45;&gt;input_split_l2_tp5</title>
<path fill="none" stroke="black" d="M9691.85,-2391.61C9431.44,-2370.64 8939.61,-2331.04 8673.32,-2309.6"/>
<polygon fill="black" stroke="black" points="8673.41,-2306.1 8663.16,-2308.79 8672.85,-2313.08 8673.41,-2306.1"/>
</g>
<!-- input_split_l2_tp6 -->
<g id="node421" class="node">
<title>input_split_l2_tp6</title>
<ellipse fill="lightgray" stroke="black" cx="6684" cy="-2293.93" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="6684" y="-2307.93" font-family="Arial" font-size="10.00">Input Split TP6</text>
<text text-anchor="middle" x="6684" y="-2296.93" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6684" y="-2285.93" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="6684" y="-2274.93" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- pipeline_comm_01&#45;&gt;input_split_l2_tp6 -->
<g id="edge462" class="edge">
<title>pipeline_comm_01&#45;&gt;input_split_l2_tp6</title>
<path fill="none" stroke="black" d="M9677.88,-2401.09C9383.9,-2394.01 8794.06,-2379.03 8294,-2361.7 7781.71,-2343.93 7177.97,-2317.39 6876.13,-2303.74"/>
<polygon fill="black" stroke="black" points="6876.11,-2300.23 6865.96,-2303.28 6875.79,-2307.23 6876.11,-2300.23"/>
</g>
<!-- input_split_l2_tp7 -->
<g id="node440" class="node">
<title>input_split_l2_tp7</title>
<ellipse fill="lightgray" stroke="black" cx="3483" cy="-2293.93" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="3483" y="-2307.93" font-family="Arial" font-size="10.00">Input Split TP7</text>
<text text-anchor="middle" x="3483" y="-2296.93" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3483" y="-2285.93" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="3483" y="-2274.93" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- pipeline_comm_01&#45;&gt;input_split_l2_tp7 -->
<g id="edge464" class="edge">
<title>pipeline_comm_01&#45;&gt;input_split_l2_tp7</title>
<path fill="none" stroke="black" d="M9676.36,-2403.64C9164.8,-2398.54 7702.72,-2383.08 6487,-2361.7 5427.61,-2343.06 4158.25,-2311.96 3679,-2299.91"/>
<polygon fill="black" stroke="black" points="3678.96,-2296.41 3668.87,-2299.66 3678.78,-2303.41 3678.96,-2296.41"/>
</g>
<!-- mha_qkv_l2_tp0 -->
<g id="node308" class="node">
<title>mha_qkv_l2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="16510.5,-2221.16 16219.5,-2221.16 16219.5,-2169.16 16510.5,-2169.16 16510.5,-2221.16"/>
<text text-anchor="middle" x="16365" y="-2209.16" font-family="Arial" font-size="10.00">MHA QKV TP0</text>
<text text-anchor="middle" x="16365" y="-2198.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="16365" y="-2187.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="16365" y="-2176.16" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- input_split_l2_tp0&#45;&gt;mha_qkv_l2_tp0 -->
<g id="edge465" class="edge">
<title>input_split_l2_tp0&#45;&gt;mha_qkv_l2_tp0</title>
<path fill="none" stroke="black" d="M16365,-2256.89C16365,-2248.58 16365,-2239.75 16365,-2231.47"/>
<polygon fill="black" stroke="black" points="16368.5,-2231.35 16365,-2221.35 16361.5,-2231.35 16368.5,-2231.35"/>
</g>
<!-- res_add_l2_tp0 -->
<g id="node312" class="node">
<title>res_add_l2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="16711,-1847.62 16433,-1847.62 16433,-1795.62 16711,-1795.62 16711,-1847.62"/>
<text text-anchor="middle" x="16572" y="-1835.62" font-family="Arial" font-size="10.00">Residual Add TP0</text>
<text text-anchor="middle" x="16572" y="-1824.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="16572" y="-1813.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16572" y="-1802.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- input_split_l2_tp0&#45;&gt;res_add_l2_tp0 -->
<g id="edge469" class="edge">
<title>input_split_l2_tp0&#45;&gt;res_add_l2_tp0</title>
<path fill="none" stroke="black" d="M16459.48,-2262C16481.29,-2251.59 16503.04,-2238.16 16520,-2221.16 16559.05,-2182.02 16572,-2163.44 16572,-2108.16 16572,-2108.16 16572,-2108.16 16572,-2018.16 16572,-1962.03 16572,-1896.83 16572,-1857.7"/>
<polygon fill="black" stroke="black" points="16575.5,-1857.62 16572,-1847.62 16568.5,-1857.62 16575.5,-1857.62"/>
</g>
<!-- mha_attn_l2_tp0 -->
<g id="node309" class="node">
<title>mha_attn_l2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="16510.5,-2133.16 16219.5,-2133.16 16219.5,-2081.16 16510.5,-2081.16 16510.5,-2133.16"/>
<text text-anchor="middle" x="16365" y="-2121.16" font-family="Arial" font-size="10.00">MHA Attention TP0</text>
<text text-anchor="middle" x="16365" y="-2110.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="16365" y="-2099.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="16365" y="-2088.16" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- mha_qkv_l2_tp0&#45;&gt;mha_attn_l2_tp0 -->
<g id="edge466" class="edge">
<title>mha_qkv_l2_tp0&#45;&gt;mha_attn_l2_tp0</title>
<path fill="none" stroke="black" d="M16365,-2168.82C16365,-2160.86 16365,-2151.92 16365,-2143.4"/>
<polygon fill="black" stroke="black" points="16368.5,-2143.31 16365,-2133.31 16361.5,-2143.31 16368.5,-2143.31"/>
</g>
<!-- mha_out_l2_tp0 -->
<g id="node310" class="node">
<title>mha_out_l2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="16507,-2045.16 16223,-2045.16 16223,-1993.16 16507,-1993.16 16507,-2045.16"/>
<text text-anchor="middle" x="16365" y="-2033.16" font-family="Arial" font-size="10.00">MHA Output TP0</text>
<text text-anchor="middle" x="16365" y="-2022.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="16365" y="-2011.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="16365" y="-2000.16" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- mha_attn_l2_tp0&#45;&gt;mha_out_l2_tp0 -->
<g id="edge467" class="edge">
<title>mha_attn_l2_tp0&#45;&gt;mha_out_l2_tp0</title>
<path fill="none" stroke="black" d="M16365,-2080.82C16365,-2072.86 16365,-2063.92 16365,-2055.4"/>
<polygon fill="black" stroke="black" points="16368.5,-2055.31 16365,-2045.31 16361.5,-2055.31 16368.5,-2055.31"/>
</g>
<!-- attn_allreduce_l2_tp0 -->
<g id="node311" class="node">
<title>attn_allreduce_l2_tp0</title>
<ellipse fill="lightgray" stroke="black" cx="16365" cy="-1920.39" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="16365" y="-1934.39" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP0</text>
<text text-anchor="middle" x="16365" y="-1923.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="16365" y="-1912.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16365" y="-1901.39" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- mha_out_l2_tp0&#45;&gt;attn_allreduce_l2_tp0 -->
<g id="edge468" class="edge">
<title>mha_out_l2_tp0&#45;&gt;attn_allreduce_l2_tp0</title>
<path fill="none" stroke="black" d="M16365,-1992.98C16365,-1985.18 16365,-1976.31 16365,-1967.54"/>
<polygon fill="black" stroke="black" points="16368.5,-1967.36 16365,-1957.36 16361.5,-1967.36 16368.5,-1967.36"/>
</g>
<!-- attn_allreduce_l2_tp0&#45;&gt;res_add_l2_tp0 -->
<g id="edge470" class="edge">
<title>attn_allreduce_l2_tp0&#45;&gt;res_add_l2_tp0</title>
<path fill="none" stroke="black" d="M16435.95,-1886.22C16459.71,-1875.11 16486.02,-1862.81 16509.12,-1852.01"/>
<polygon fill="black" stroke="black" points="16510.89,-1855.05 16518.47,-1847.64 16507.93,-1848.71 16510.89,-1855.05"/>
</g>
<!-- norm_l2_tp0 -->
<g id="node313" class="node">
<title>norm_l2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="18279,-1759.62 18013,-1759.62 18013,-1707.62 18279,-1707.62 18279,-1759.62"/>
<text text-anchor="middle" x="18146" y="-1747.62" font-family="Arial" font-size="10.00">Layer Norm TP0</text>
<text text-anchor="middle" x="18146" y="-1736.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18146" y="-1725.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18146" y="-1714.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- res_add_l2_tp0&#45;&gt;norm_l2_tp0 -->
<g id="edge471" class="edge">
<title>res_add_l2_tp0&#45;&gt;norm_l2_tp0</title>
<path fill="none" stroke="black" d="M16711.34,-1813C17008.6,-1796.76 17702.3,-1758.86 18002.89,-1742.44"/>
<polygon fill="black" stroke="black" points="18003.18,-1745.93 18012.98,-1741.89 18002.8,-1738.94 18003.18,-1745.93"/>
</g>
<!-- gate_l2_tp0 -->
<g id="node314" class="node">
<title>gate_l2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="17416.3,-1671.62 16949.72,-1671.62 16829.7,-1567.62 17296.28,-1567.62 17416.3,-1671.62"/>
<text text-anchor="middle" x="17123" y="-1633.62" font-family="Arial" font-size="10.00">Gate Network TP0</text>
<text text-anchor="middle" x="17123" y="-1622.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="17123" y="-1611.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="17123" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l2_tp0&#45;&gt;gate_l2_tp0 -->
<g id="edge472" class="edge">
<title>norm_l2_tp0&#45;&gt;gate_l2_tp0</title>
<path fill="none" stroke="black" d="M18012.77,-1724.66C17867.8,-1715.24 17629.39,-1697.48 17425,-1671.62 17424.9,-1671.6 17424.79,-1671.59 17424.69,-1671.58"/>
<polygon fill="black" stroke="black" points="17425.42,-1668.14 17415.05,-1670.34 17424.53,-1675.09 17425.42,-1668.14"/>
</g>
<!-- expert8_l2_tp0 -->
<g id="node315" class="node">
<title>expert8_l2_tp0</title>
<polygon fill="lightcoral" stroke="black" points="17622,-1645.62 17434,-1645.62 17434,-1593.62 17622,-1593.62 17622,-1645.62"/>
<text text-anchor="middle" x="17528" y="-1633.62" font-family="Arial" font-size="10.00">Expert 8</text>
<text text-anchor="middle" x="17528" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17528" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17528" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l2_tp0&#45;&gt;expert8_l2_tp0 -->
<g id="edge473" class="edge">
<title>norm_l2_tp0&#45;&gt;expert8_l2_tp0</title>
<path fill="none" stroke="black" d="M18012.79,-1729.28C17907.31,-1723.68 17757.22,-1709.12 17631,-1671.62 17613.57,-1666.44 17595.5,-1658.49 17579.45,-1650.39"/>
<polygon fill="black" stroke="black" points="17580.75,-1647.12 17570.26,-1645.63 17577.53,-1653.33 17580.75,-1647.12"/>
</g>
<!-- expert9_l2_tp0 -->
<g id="node316" class="node">
<title>expert9_l2_tp0</title>
<polygon fill="lightcoral" stroke="black" points="17828,-1645.62 17640,-1645.62 17640,-1593.62 17828,-1593.62 17828,-1645.62"/>
<text text-anchor="middle" x="17734" y="-1633.62" font-family="Arial" font-size="10.00">Expert 9</text>
<text text-anchor="middle" x="17734" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17734" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17734" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l2_tp0&#45;&gt;expert9_l2_tp0 -->
<g id="edge475" class="edge">
<title>norm_l2_tp0&#45;&gt;expert9_l2_tp0</title>
<path fill="none" stroke="black" d="M18012.8,-1714.27C17957.54,-1704.62 17893.31,-1690.74 17837,-1671.62 17820.26,-1665.93 17802.77,-1658.07 17787.05,-1650.23"/>
<polygon fill="black" stroke="black" points="17788.52,-1647.05 17778.02,-1645.62 17785.34,-1653.28 17788.52,-1647.05"/>
</g>
<!-- expert10_l2_tp0 -->
<g id="node317" class="node">
<title>expert10_l2_tp0</title>
<polygon fill="lightcoral" stroke="black" points="18034,-1645.62 17846,-1645.62 17846,-1593.62 18034,-1593.62 18034,-1645.62"/>
<text text-anchor="middle" x="17940" y="-1633.62" font-family="Arial" font-size="10.00">Expert 10</text>
<text text-anchor="middle" x="17940" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17940" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17940" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l2_tp0&#45;&gt;expert10_l2_tp0 -->
<g id="edge477" class="edge">
<title>norm_l2_tp0&#45;&gt;expert10_l2_tp0</title>
<path fill="none" stroke="black" d="M18099.77,-1707.48C18068.76,-1690.62 18027.76,-1668.33 17995.06,-1650.55"/>
<polygon fill="black" stroke="black" points="17996.53,-1647.37 17986.08,-1645.67 17993.19,-1653.52 17996.53,-1647.37"/>
</g>
<!-- expert11_l2_tp0 -->
<g id="node318" class="node">
<title>expert11_l2_tp0</title>
<polygon fill="lightcoral" stroke="black" points="18240,-1645.62 18052,-1645.62 18052,-1593.62 18240,-1593.62 18240,-1645.62"/>
<text text-anchor="middle" x="18146" y="-1633.62" font-family="Arial" font-size="10.00">Expert 11</text>
<text text-anchor="middle" x="18146" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18146" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18146" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l2_tp0&#45;&gt;expert11_l2_tp0 -->
<g id="edge479" class="edge">
<title>norm_l2_tp0&#45;&gt;expert11_l2_tp0</title>
<path fill="none" stroke="black" d="M18146,-1707.48C18146,-1692.21 18146,-1672.48 18146,-1655.68"/>
<polygon fill="black" stroke="black" points="18149.5,-1655.67 18146,-1645.67 18142.5,-1655.67 18149.5,-1655.67"/>
</g>
<!-- expert12_l2_tp0 -->
<g id="node319" class="node">
<title>expert12_l2_tp0</title>
<polygon fill="lightcoral" stroke="black" points="18446,-1645.62 18258,-1645.62 18258,-1593.62 18446,-1593.62 18446,-1645.62"/>
<text text-anchor="middle" x="18352" y="-1633.62" font-family="Arial" font-size="10.00">Expert 12</text>
<text text-anchor="middle" x="18352" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18352" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18352" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l2_tp0&#45;&gt;expert12_l2_tp0 -->
<g id="edge481" class="edge">
<title>norm_l2_tp0&#45;&gt;expert12_l2_tp0</title>
<path fill="none" stroke="black" d="M18192.23,-1707.48C18223.24,-1690.62 18264.24,-1668.33 18296.94,-1650.55"/>
<polygon fill="black" stroke="black" points="18298.81,-1653.52 18305.92,-1645.67 18295.47,-1647.37 18298.81,-1653.52"/>
</g>
<!-- expert13_l2_tp0 -->
<g id="node320" class="node">
<title>expert13_l2_tp0</title>
<polygon fill="lightcoral" stroke="black" points="18652,-1645.62 18464,-1645.62 18464,-1593.62 18652,-1593.62 18652,-1645.62"/>
<text text-anchor="middle" x="18558" y="-1633.62" font-family="Arial" font-size="10.00">Expert 13</text>
<text text-anchor="middle" x="18558" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18558" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18558" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l2_tp0&#45;&gt;expert13_l2_tp0 -->
<g id="edge483" class="edge">
<title>norm_l2_tp0&#45;&gt;expert13_l2_tp0</title>
<path fill="none" stroke="black" d="M18279.2,-1714.27C18334.46,-1704.62 18398.69,-1690.74 18455,-1671.62 18471.74,-1665.93 18489.23,-1658.07 18504.95,-1650.23"/>
<polygon fill="black" stroke="black" points="18506.66,-1653.28 18513.98,-1645.62 18503.48,-1647.05 18506.66,-1653.28"/>
</g>
<!-- expert14_l2_tp0 -->
<g id="node321" class="node">
<title>expert14_l2_tp0</title>
<polygon fill="lightcoral" stroke="black" points="18858,-1645.62 18670,-1645.62 18670,-1593.62 18858,-1593.62 18858,-1645.62"/>
<text text-anchor="middle" x="18764" y="-1633.62" font-family="Arial" font-size="10.00">Expert 14</text>
<text text-anchor="middle" x="18764" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18764" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18764" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l2_tp0&#45;&gt;expert14_l2_tp0 -->
<g id="edge485" class="edge">
<title>norm_l2_tp0&#45;&gt;expert14_l2_tp0</title>
<path fill="none" stroke="black" d="M18279.21,-1729.28C18384.69,-1723.68 18534.78,-1709.12 18661,-1671.62 18678.43,-1666.44 18696.5,-1658.49 18712.55,-1650.39"/>
<polygon fill="black" stroke="black" points="18714.47,-1653.33 18721.74,-1645.63 18711.25,-1647.12 18714.47,-1653.33"/>
</g>
<!-- expert15_l2_tp0 -->
<g id="node322" class="node">
<title>expert15_l2_tp0</title>
<polygon fill="lightcoral" stroke="black" points="19064,-1645.62 18876,-1645.62 18876,-1593.62 19064,-1593.62 19064,-1645.62"/>
<text text-anchor="middle" x="18970" y="-1633.62" font-family="Arial" font-size="10.00">Expert 15</text>
<text text-anchor="middle" x="18970" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18970" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18970" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l2_tp0&#45;&gt;expert15_l2_tp0 -->
<g id="edge487" class="edge">
<title>norm_l2_tp0&#45;&gt;expert15_l2_tp0</title>
<path fill="none" stroke="black" d="M18279.01,-1727.31C18456.24,-1719.22 18759.92,-1701.49 18867,-1671.62 18884.67,-1666.69 18902.94,-1658.72 18919.09,-1650.53"/>
<polygon fill="black" stroke="black" points="18921.09,-1653.43 18928.34,-1645.71 18917.85,-1647.23 18921.09,-1653.43"/>
</g>
<!-- res_add2_l2_tp0 -->
<g id="node324" class="node">
<title>res_add2_l2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="18553,-1391.62 18275,-1391.62 18275,-1339.62 18553,-1339.62 18553,-1391.62"/>
<text text-anchor="middle" x="18414" y="-1379.62" font-family="Arial" font-size="10.00">Residual Add 2 TP0</text>
<text text-anchor="middle" x="18414" y="-1368.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="18414" y="-1357.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18414" y="-1346.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l2_tp0&#45;&gt;res_add2_l2_tp0 -->
<g id="edge490" class="edge">
<title>norm_l2_tp0&#45;&gt;res_add2_l2_tp0</title>
<path fill="none" stroke="black" d="M18279.04,-1728.61C18529.03,-1720.42 19046.3,-1700.13 19073,-1671.62 19234.93,-1498.68 18804,-1415.29 18563.36,-1383.16"/>
<polygon fill="black" stroke="black" points="18563.49,-1379.65 18553.11,-1381.81 18562.57,-1386.59 18563.49,-1379.65"/>
</g>
<!-- expert_agg_l2_tp0 -->
<g id="node323" class="node">
<title>expert_agg_l2_tp0</title>
<polygon fill="lightpink" stroke="black" points="18627.55,-1531.62 18189.21,-1531.62 18076.45,-1427.62 18514.79,-1427.62 18627.55,-1531.62"/>
<text text-anchor="middle" x="18352" y="-1493.62" font-family="Arial" font-size="10.00">Expert Aggregation TP0</text>
<text text-anchor="middle" x="18352" y="-1482.62" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="18352" y="-1471.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18352" y="-1460.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- expert8_l2_tp0&#45;&gt;expert_agg_l2_tp0 -->
<g id="edge474" class="edge">
<title>expert8_l2_tp0&#45;&gt;expert_agg_l2_tp0</title>
<path fill="none" stroke="black" d="M17570.77,-1593.37C17588.79,-1583.82 17610.35,-1573.78 17631,-1567.62 17794.12,-1518.95 17985.72,-1497.42 18130.39,-1487.94"/>
<polygon fill="black" stroke="black" points="18130.97,-1491.41 18140.72,-1487.28 18130.52,-1484.42 18130.97,-1491.41"/>
</g>
<!-- expert9_l2_tp0&#45;&gt;expert_agg_l2_tp0 -->
<g id="edge476" class="edge">
<title>expert9_l2_tp0&#45;&gt;expert_agg_l2_tp0</title>
<path fill="none" stroke="black" d="M17777.42,-1593.59C17795.36,-1584.19 17816.69,-1574.2 17837,-1567.62 17935.93,-1535.54 18049.58,-1514.74 18144.91,-1501.56"/>
<polygon fill="black" stroke="black" points="18145.53,-1505 18154.96,-1500.18 18144.58,-1498.07 18145.53,-1505"/>
</g>
<!-- expert10_l2_tp0&#45;&gt;expert_agg_l2_tp0 -->
<g id="edge478" class="edge">
<title>expert10_l2_tp0&#45;&gt;expert_agg_l2_tp0</title>
<path fill="none" stroke="black" d="M17986.1,-1593.52C18003.59,-1584.6 18023.91,-1574.96 18043,-1567.62 18083.42,-1552.08 18127.76,-1537.95 18169.93,-1525.82"/>
<polygon fill="black" stroke="black" points="18171.09,-1529.13 18179.74,-1523.02 18169.17,-1522.4 18171.09,-1529.13"/>
</g>
<!-- expert11_l2_tp0&#45;&gt;expert_agg_l2_tp0 -->
<g id="edge480" class="edge">
<title>expert11_l2_tp0&#45;&gt;expert_agg_l2_tp0</title>
<path fill="none" stroke="black" d="M18183.78,-1593.31C18207.15,-1577.65 18238.12,-1556.91 18267.11,-1537.49"/>
<polygon fill="black" stroke="black" points="18269.27,-1540.25 18275.63,-1531.78 18265.37,-1534.44 18269.27,-1540.25"/>
</g>
<!-- expert12_l2_tp0&#45;&gt;expert_agg_l2_tp0 -->
<g id="edge482" class="edge">
<title>expert12_l2_tp0&#45;&gt;expert_agg_l2_tp0</title>
<path fill="none" stroke="black" d="M18352,-1593.31C18352,-1578.86 18352,-1560.08 18352,-1542.01"/>
<polygon fill="black" stroke="black" points="18355.5,-1541.78 18352,-1531.78 18348.5,-1541.78 18355.5,-1541.78"/>
</g>
<!-- expert13_l2_tp0&#45;&gt;expert_agg_l2_tp0 -->
<g id="edge484" class="edge">
<title>expert13_l2_tp0&#45;&gt;expert_agg_l2_tp0</title>
<path fill="none" stroke="black" d="M18520.22,-1593.31C18496.85,-1577.65 18465.88,-1556.91 18436.89,-1537.49"/>
<polygon fill="black" stroke="black" points="18438.63,-1534.44 18428.37,-1531.78 18434.73,-1540.25 18438.63,-1534.44"/>
</g>
<!-- expert14_l2_tp0&#45;&gt;expert_agg_l2_tp0 -->
<g id="edge486" class="edge">
<title>expert14_l2_tp0&#45;&gt;expert_agg_l2_tp0</title>
<path fill="none" stroke="black" d="M18717.9,-1593.52C18700.41,-1584.6 18680.09,-1574.96 18661,-1567.62 18629.99,-1555.69 18596.66,-1544.6 18563.79,-1534.61"/>
<polygon fill="black" stroke="black" points="18564.65,-1531.21 18554.06,-1531.68 18562.63,-1537.92 18564.65,-1531.21"/>
</g>
<!-- expert15_l2_tp0&#45;&gt;expert_agg_l2_tp0 -->
<g id="edge488" class="edge">
<title>expert15_l2_tp0&#45;&gt;expert_agg_l2_tp0</title>
<path fill="none" stroke="black" d="M18926.58,-1593.59C18908.64,-1584.19 18887.31,-1574.2 18867,-1567.62 18785.77,-1541.28 18694.61,-1522.55 18611.83,-1509.39"/>
<polygon fill="black" stroke="black" points="18612.19,-1505.9 18601.77,-1507.81 18611.11,-1512.82 18612.19,-1505.9"/>
</g>
<!-- expert_agg_l2_tp0&#45;&gt;res_add2_l2_tp0 -->
<g id="edge489" class="edge">
<title>expert_agg_l2_tp0&#45;&gt;res_add2_l2_tp0</title>
<path fill="none" stroke="black" d="M18380.28,-1427.53C18385.34,-1418.38 18390.51,-1409.05 18395.22,-1400.54"/>
<polygon fill="black" stroke="black" points="18398.36,-1402.1 18400.14,-1391.66 18392.23,-1398.71 18398.36,-1402.1"/>
</g>
<!-- norm2_l2_tp0 -->
<g id="node325" class="node">
<title>norm2_l2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="18547,-1303.62 18281,-1303.62 18281,-1251.62 18547,-1251.62 18547,-1303.62"/>
<text text-anchor="middle" x="18414" y="-1291.62" font-family="Arial" font-size="10.00">Layer Norm 2 TP0</text>
<text text-anchor="middle" x="18414" y="-1280.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18414" y="-1269.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18414" y="-1258.62" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- res_add2_l2_tp0&#45;&gt;norm2_l2_tp0 -->
<g id="edge491" class="edge">
<title>res_add2_l2_tp0&#45;&gt;norm2_l2_tp0</title>
<path fill="none" stroke="black" d="M18414,-1339.28C18414,-1331.32 18414,-1322.38 18414,-1313.86"/>
<polygon fill="black" stroke="black" points="18417.5,-1313.77 18414,-1303.77 18410.5,-1313.77 18417.5,-1313.77"/>
</g>
<!-- input_split_l3_tp0 -->
<g id="node460" class="node">
<title>input_split_l3_tp0</title>
<ellipse fill="lightgray" stroke="black" cx="18414" cy="-1167.85" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="18414" y="-1181.85" font-family="Arial" font-size="10.00">Input Split TP0</text>
<text text-anchor="middle" x="18414" y="-1170.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18414" y="-1159.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="18414" y="-1148.85" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm2_l2_tp0&#45;&gt;input_split_l3_tp0 -->
<g id="edge681" class="edge">
<title>norm2_l2_tp0&#45;&gt;input_split_l3_tp0</title>
<path fill="none" stroke="black" d="M18414,-1251.35C18414,-1240.56 18414,-1227.61 18414,-1215.21"/>
<polygon fill="black" stroke="black" points="18417.5,-1214.98 18414,-1204.98 18410.5,-1214.98 18417.5,-1214.98"/>
</g>
<!-- mha_qkv_l2_tp1 -->
<g id="node327" class="node">
<title>mha_qkv_l2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="14392.5,-2221.16 14101.5,-2221.16 14101.5,-2169.16 14392.5,-2169.16 14392.5,-2221.16"/>
<text text-anchor="middle" x="14247" y="-2209.16" font-family="Arial" font-size="10.00">MHA QKV TP1</text>
<text text-anchor="middle" x="14247" y="-2198.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="14247" y="-2187.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="14247" y="-2176.16" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- input_split_l2_tp1&#45;&gt;mha_qkv_l2_tp1 -->
<g id="edge492" class="edge">
<title>input_split_l2_tp1&#45;&gt;mha_qkv_l2_tp1</title>
<path fill="none" stroke="black" d="M14247,-2256.89C14247,-2248.58 14247,-2239.75 14247,-2231.47"/>
<polygon fill="black" stroke="black" points="14250.5,-2231.35 14247,-2221.35 14243.5,-2231.35 14250.5,-2231.35"/>
</g>
<!-- res_add_l2_tp1 -->
<g id="node331" class="node">
<title>res_add_l2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="14593,-1847.62 14315,-1847.62 14315,-1795.62 14593,-1795.62 14593,-1847.62"/>
<text text-anchor="middle" x="14454" y="-1835.62" font-family="Arial" font-size="10.00">Residual Add TP1</text>
<text text-anchor="middle" x="14454" y="-1824.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="14454" y="-1813.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14454" y="-1802.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- input_split_l2_tp1&#45;&gt;res_add_l2_tp1 -->
<g id="edge496" class="edge">
<title>input_split_l2_tp1&#45;&gt;res_add_l2_tp1</title>
<path fill="none" stroke="black" d="M14341.48,-2262C14363.29,-2251.59 14385.04,-2238.16 14402,-2221.16 14441.05,-2182.02 14454,-2163.44 14454,-2108.16 14454,-2108.16 14454,-2108.16 14454,-2018.16 14454,-1962.03 14454,-1896.83 14454,-1857.7"/>
<polygon fill="black" stroke="black" points="14457.5,-1857.62 14454,-1847.62 14450.5,-1857.62 14457.5,-1857.62"/>
</g>
<!-- mha_attn_l2_tp1 -->
<g id="node328" class="node">
<title>mha_attn_l2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="14392.5,-2133.16 14101.5,-2133.16 14101.5,-2081.16 14392.5,-2081.16 14392.5,-2133.16"/>
<text text-anchor="middle" x="14247" y="-2121.16" font-family="Arial" font-size="10.00">MHA Attention TP1</text>
<text text-anchor="middle" x="14247" y="-2110.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="14247" y="-2099.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="14247" y="-2088.16" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- mha_qkv_l2_tp1&#45;&gt;mha_attn_l2_tp1 -->
<g id="edge493" class="edge">
<title>mha_qkv_l2_tp1&#45;&gt;mha_attn_l2_tp1</title>
<path fill="none" stroke="black" d="M14247,-2168.82C14247,-2160.86 14247,-2151.92 14247,-2143.4"/>
<polygon fill="black" stroke="black" points="14250.5,-2143.31 14247,-2133.31 14243.5,-2143.31 14250.5,-2143.31"/>
</g>
<!-- mha_out_l2_tp1 -->
<g id="node329" class="node">
<title>mha_out_l2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="14389,-2045.16 14105,-2045.16 14105,-1993.16 14389,-1993.16 14389,-2045.16"/>
<text text-anchor="middle" x="14247" y="-2033.16" font-family="Arial" font-size="10.00">MHA Output TP1</text>
<text text-anchor="middle" x="14247" y="-2022.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="14247" y="-2011.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="14247" y="-2000.16" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- mha_attn_l2_tp1&#45;&gt;mha_out_l2_tp1 -->
<g id="edge494" class="edge">
<title>mha_attn_l2_tp1&#45;&gt;mha_out_l2_tp1</title>
<path fill="none" stroke="black" d="M14247,-2080.82C14247,-2072.86 14247,-2063.92 14247,-2055.4"/>
<polygon fill="black" stroke="black" points="14250.5,-2055.31 14247,-2045.31 14243.5,-2055.31 14250.5,-2055.31"/>
</g>
<!-- attn_allreduce_l2_tp1 -->
<g id="node330" class="node">
<title>attn_allreduce_l2_tp1</title>
<ellipse fill="lightgray" stroke="black" cx="14247" cy="-1920.39" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="14247" y="-1934.39" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP1</text>
<text text-anchor="middle" x="14247" y="-1923.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="14247" y="-1912.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14247" y="-1901.39" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- mha_out_l2_tp1&#45;&gt;attn_allreduce_l2_tp1 -->
<g id="edge495" class="edge">
<title>mha_out_l2_tp1&#45;&gt;attn_allreduce_l2_tp1</title>
<path fill="none" stroke="black" d="M14247,-1992.98C14247,-1985.18 14247,-1976.31 14247,-1967.54"/>
<polygon fill="black" stroke="black" points="14250.5,-1967.36 14247,-1957.36 14243.5,-1967.36 14250.5,-1967.36"/>
</g>
<!-- attn_allreduce_l2_tp1&#45;&gt;res_add_l2_tp1 -->
<g id="edge497" class="edge">
<title>attn_allreduce_l2_tp1&#45;&gt;res_add_l2_tp1</title>
<path fill="none" stroke="black" d="M14317.95,-1886.22C14341.71,-1875.11 14368.02,-1862.81 14391.12,-1852.01"/>
<polygon fill="black" stroke="black" points="14392.89,-1855.05 14400.47,-1847.64 14389.93,-1848.71 14392.89,-1855.05"/>
</g>
<!-- norm_l2_tp1 -->
<g id="node332" class="node">
<title>norm_l2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="16007,-1759.62 15741,-1759.62 15741,-1707.62 16007,-1707.62 16007,-1759.62"/>
<text text-anchor="middle" x="15874" y="-1747.62" font-family="Arial" font-size="10.00">Layer Norm TP1</text>
<text text-anchor="middle" x="15874" y="-1736.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15874" y="-1725.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15874" y="-1714.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- res_add_l2_tp1&#45;&gt;norm_l2_tp1 -->
<g id="edge498" class="edge">
<title>res_add_l2_tp1&#45;&gt;norm_l2_tp1</title>
<path fill="none" stroke="black" d="M14593.07,-1812.2C14863.38,-1795.82 15457.13,-1759.86 15730.75,-1743.29"/>
<polygon fill="black" stroke="black" points="15730.98,-1746.79 15740.75,-1742.69 15730.55,-1739.8 15730.98,-1746.79"/>
</g>
<!-- gate_l2_tp1 -->
<g id="node333" class="node">
<title>gate_l2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="15144.3,-1671.62 14677.72,-1671.62 14557.7,-1567.62 15024.28,-1567.62 15144.3,-1671.62"/>
<text text-anchor="middle" x="14851" y="-1633.62" font-family="Arial" font-size="10.00">Gate Network TP1</text>
<text text-anchor="middle" x="14851" y="-1622.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14851" y="-1611.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="14851" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l2_tp1&#45;&gt;gate_l2_tp1 -->
<g id="edge499" class="edge">
<title>norm_l2_tp1&#45;&gt;gate_l2_tp1</title>
<path fill="none" stroke="black" d="M15740.77,-1724.66C15595.8,-1715.24 15357.39,-1697.48 15153,-1671.62 15152.9,-1671.6 15152.79,-1671.59 15152.69,-1671.58"/>
<polygon fill="black" stroke="black" points="15153.42,-1668.14 15143.05,-1670.34 15152.53,-1675.09 15153.42,-1668.14"/>
</g>
<!-- expert16_l2_tp1 -->
<g id="node334" class="node">
<title>expert16_l2_tp1</title>
<polygon fill="lightcoral" stroke="black" points="15350,-1645.62 15162,-1645.62 15162,-1593.62 15350,-1593.62 15350,-1645.62"/>
<text text-anchor="middle" x="15256" y="-1633.62" font-family="Arial" font-size="10.00">Expert 16</text>
<text text-anchor="middle" x="15256" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15256" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15256" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l2_tp1&#45;&gt;expert16_l2_tp1 -->
<g id="edge500" class="edge">
<title>norm_l2_tp1&#45;&gt;expert16_l2_tp1</title>
<path fill="none" stroke="black" d="M15740.79,-1729.28C15635.31,-1723.68 15485.22,-1709.12 15359,-1671.62 15341.57,-1666.44 15323.5,-1658.49 15307.45,-1650.39"/>
<polygon fill="black" stroke="black" points="15308.75,-1647.12 15298.26,-1645.63 15305.53,-1653.33 15308.75,-1647.12"/>
</g>
<!-- expert17_l2_tp1 -->
<g id="node335" class="node">
<title>expert17_l2_tp1</title>
<polygon fill="lightcoral" stroke="black" points="15556,-1645.62 15368,-1645.62 15368,-1593.62 15556,-1593.62 15556,-1645.62"/>
<text text-anchor="middle" x="15462" y="-1633.62" font-family="Arial" font-size="10.00">Expert 17</text>
<text text-anchor="middle" x="15462" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15462" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15462" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l2_tp1&#45;&gt;expert17_l2_tp1 -->
<g id="edge502" class="edge">
<title>norm_l2_tp1&#45;&gt;expert17_l2_tp1</title>
<path fill="none" stroke="black" d="M15740.8,-1714.27C15685.54,-1704.62 15621.31,-1690.74 15565,-1671.62 15548.26,-1665.93 15530.77,-1658.07 15515.05,-1650.23"/>
<polygon fill="black" stroke="black" points="15516.52,-1647.05 15506.02,-1645.62 15513.34,-1653.28 15516.52,-1647.05"/>
</g>
<!-- expert18_l2_tp1 -->
<g id="node336" class="node">
<title>expert18_l2_tp1</title>
<polygon fill="lightcoral" stroke="black" points="15762,-1645.62 15574,-1645.62 15574,-1593.62 15762,-1593.62 15762,-1645.62"/>
<text text-anchor="middle" x="15668" y="-1633.62" font-family="Arial" font-size="10.00">Expert 18</text>
<text text-anchor="middle" x="15668" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15668" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15668" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l2_tp1&#45;&gt;expert18_l2_tp1 -->
<g id="edge504" class="edge">
<title>norm_l2_tp1&#45;&gt;expert18_l2_tp1</title>
<path fill="none" stroke="black" d="M15827.77,-1707.48C15796.76,-1690.62 15755.76,-1668.33 15723.06,-1650.55"/>
<polygon fill="black" stroke="black" points="15724.53,-1647.37 15714.08,-1645.67 15721.19,-1653.52 15724.53,-1647.37"/>
</g>
<!-- expert19_l2_tp1 -->
<g id="node337" class="node">
<title>expert19_l2_tp1</title>
<polygon fill="lightcoral" stroke="black" points="15968,-1645.62 15780,-1645.62 15780,-1593.62 15968,-1593.62 15968,-1645.62"/>
<text text-anchor="middle" x="15874" y="-1633.62" font-family="Arial" font-size="10.00">Expert 19</text>
<text text-anchor="middle" x="15874" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15874" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15874" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l2_tp1&#45;&gt;expert19_l2_tp1 -->
<g id="edge506" class="edge">
<title>norm_l2_tp1&#45;&gt;expert19_l2_tp1</title>
<path fill="none" stroke="black" d="M15874,-1707.48C15874,-1692.21 15874,-1672.48 15874,-1655.68"/>
<polygon fill="black" stroke="black" points="15877.5,-1655.67 15874,-1645.67 15870.5,-1655.67 15877.5,-1655.67"/>
</g>
<!-- expert20_l2_tp1 -->
<g id="node338" class="node">
<title>expert20_l2_tp1</title>
<polygon fill="lightcoral" stroke="black" points="16174,-1645.62 15986,-1645.62 15986,-1593.62 16174,-1593.62 16174,-1645.62"/>
<text text-anchor="middle" x="16080" y="-1633.62" font-family="Arial" font-size="10.00">Expert 20</text>
<text text-anchor="middle" x="16080" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16080" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16080" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l2_tp1&#45;&gt;expert20_l2_tp1 -->
<g id="edge508" class="edge">
<title>norm_l2_tp1&#45;&gt;expert20_l2_tp1</title>
<path fill="none" stroke="black" d="M15920.23,-1707.48C15951.24,-1690.62 15992.24,-1668.33 16024.94,-1650.55"/>
<polygon fill="black" stroke="black" points="16026.81,-1653.52 16033.92,-1645.67 16023.47,-1647.37 16026.81,-1653.52"/>
</g>
<!-- expert21_l2_tp1 -->
<g id="node339" class="node">
<title>expert21_l2_tp1</title>
<polygon fill="lightcoral" stroke="black" points="16380,-1645.62 16192,-1645.62 16192,-1593.62 16380,-1593.62 16380,-1645.62"/>
<text text-anchor="middle" x="16286" y="-1633.62" font-family="Arial" font-size="10.00">Expert 21</text>
<text text-anchor="middle" x="16286" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16286" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16286" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l2_tp1&#45;&gt;expert21_l2_tp1 -->
<g id="edge510" class="edge">
<title>norm_l2_tp1&#45;&gt;expert21_l2_tp1</title>
<path fill="none" stroke="black" d="M16007.2,-1714.27C16062.46,-1704.62 16126.69,-1690.74 16183,-1671.62 16199.74,-1665.93 16217.23,-1658.07 16232.95,-1650.23"/>
<polygon fill="black" stroke="black" points="16234.66,-1653.28 16241.98,-1645.62 16231.48,-1647.05 16234.66,-1653.28"/>
</g>
<!-- expert22_l2_tp1 -->
<g id="node340" class="node">
<title>expert22_l2_tp1</title>
<polygon fill="lightcoral" stroke="black" points="16586,-1645.62 16398,-1645.62 16398,-1593.62 16586,-1593.62 16586,-1645.62"/>
<text text-anchor="middle" x="16492" y="-1633.62" font-family="Arial" font-size="10.00">Expert 22</text>
<text text-anchor="middle" x="16492" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16492" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16492" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l2_tp1&#45;&gt;expert22_l2_tp1 -->
<g id="edge512" class="edge">
<title>norm_l2_tp1&#45;&gt;expert22_l2_tp1</title>
<path fill="none" stroke="black" d="M16007.21,-1729.28C16112.69,-1723.68 16262.78,-1709.12 16389,-1671.62 16406.43,-1666.44 16424.5,-1658.49 16440.55,-1650.39"/>
<polygon fill="black" stroke="black" points="16442.47,-1653.33 16449.74,-1645.63 16439.25,-1647.12 16442.47,-1653.33"/>
</g>
<!-- expert23_l2_tp1 -->
<g id="node341" class="node">
<title>expert23_l2_tp1</title>
<polygon fill="lightcoral" stroke="black" points="16792,-1645.62 16604,-1645.62 16604,-1593.62 16792,-1593.62 16792,-1645.62"/>
<text text-anchor="middle" x="16698" y="-1633.62" font-family="Arial" font-size="10.00">Expert 23</text>
<text text-anchor="middle" x="16698" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16698" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16698" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l2_tp1&#45;&gt;expert23_l2_tp1 -->
<g id="edge514" class="edge">
<title>norm_l2_tp1&#45;&gt;expert23_l2_tp1</title>
<path fill="none" stroke="black" d="M16007.01,-1727.31C16184.24,-1719.22 16487.92,-1701.49 16595,-1671.62 16612.67,-1666.69 16630.94,-1658.72 16647.09,-1650.53"/>
<polygon fill="black" stroke="black" points="16649.09,-1653.43 16656.34,-1645.71 16645.85,-1647.23 16649.09,-1653.43"/>
</g>
<!-- res_add2_l2_tp1 -->
<g id="node343" class="node">
<title>res_add2_l2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="16251,-1391.62 15973,-1391.62 15973,-1339.62 16251,-1339.62 16251,-1391.62"/>
<text text-anchor="middle" x="16112" y="-1379.62" font-family="Arial" font-size="10.00">Residual Add 2 TP1</text>
<text text-anchor="middle" x="16112" y="-1368.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="16112" y="-1357.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16112" y="-1346.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l2_tp1&#45;&gt;res_add2_l2_tp1 -->
<g id="edge517" class="edge">
<title>norm_l2_tp1&#45;&gt;res_add2_l2_tp1</title>
<path fill="none" stroke="black" d="M16007.04,-1728.61C16257.03,-1720.42 16774.3,-1700.13 16801,-1671.62 16816.8,-1654.75 16814.62,-1586.29 16801,-1567.62 16681.09,-1403.17 16560.95,-1482.62 16365,-1427.62 16322.41,-1415.66 16275.4,-1403.93 16233.57,-1394"/>
<polygon fill="black" stroke="black" points="16234.15,-1390.54 16223.61,-1391.65 16232.54,-1397.35 16234.15,-1390.54"/>
</g>
<!-- expert_agg_l2_tp1 -->
<g id="node342" class="node">
<title>expert_agg_l2_tp1</title>
<polygon fill="lightpink" stroke="black" points="16355.55,-1531.62 15917.21,-1531.62 15804.45,-1427.62 16242.79,-1427.62 16355.55,-1531.62"/>
<text text-anchor="middle" x="16080" y="-1493.62" font-family="Arial" font-size="10.00">Expert Aggregation TP1</text>
<text text-anchor="middle" x="16080" y="-1482.62" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="16080" y="-1471.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16080" y="-1460.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- expert16_l2_tp1&#45;&gt;expert_agg_l2_tp1 -->
<g id="edge501" class="edge">
<title>expert16_l2_tp1&#45;&gt;expert_agg_l2_tp1</title>
<path fill="none" stroke="black" d="M15298.77,-1593.37C15316.79,-1583.82 15338.35,-1573.78 15359,-1567.62 15522.12,-1518.95 15713.72,-1497.42 15858.39,-1487.94"/>
<polygon fill="black" stroke="black" points="15858.97,-1491.41 15868.72,-1487.28 15858.52,-1484.42 15858.97,-1491.41"/>
</g>
<!-- expert17_l2_tp1&#45;&gt;expert_agg_l2_tp1 -->
<g id="edge503" class="edge">
<title>expert17_l2_tp1&#45;&gt;expert_agg_l2_tp1</title>
<path fill="none" stroke="black" d="M15505.42,-1593.59C15523.36,-1584.19 15544.69,-1574.2 15565,-1567.62 15663.93,-1535.54 15777.58,-1514.74 15872.91,-1501.56"/>
<polygon fill="black" stroke="black" points="15873.53,-1505 15882.96,-1500.18 15872.58,-1498.07 15873.53,-1505"/>
</g>
<!-- expert18_l2_tp1&#45;&gt;expert_agg_l2_tp1 -->
<g id="edge505" class="edge">
<title>expert18_l2_tp1&#45;&gt;expert_agg_l2_tp1</title>
<path fill="none" stroke="black" d="M15714.1,-1593.52C15731.59,-1584.6 15751.91,-1574.96 15771,-1567.62 15811.42,-1552.08 15855.76,-1537.95 15897.93,-1525.82"/>
<polygon fill="black" stroke="black" points="15899.09,-1529.13 15907.74,-1523.02 15897.17,-1522.4 15899.09,-1529.13"/>
</g>
<!-- expert19_l2_tp1&#45;&gt;expert_agg_l2_tp1 -->
<g id="edge507" class="edge">
<title>expert19_l2_tp1&#45;&gt;expert_agg_l2_tp1</title>
<path fill="none" stroke="black" d="M15911.78,-1593.31C15935.15,-1577.65 15966.12,-1556.91 15995.11,-1537.49"/>
<polygon fill="black" stroke="black" points="15997.27,-1540.25 16003.63,-1531.78 15993.37,-1534.44 15997.27,-1540.25"/>
</g>
<!-- expert20_l2_tp1&#45;&gt;expert_agg_l2_tp1 -->
<g id="edge509" class="edge">
<title>expert20_l2_tp1&#45;&gt;expert_agg_l2_tp1</title>
<path fill="none" stroke="black" d="M16080,-1593.31C16080,-1578.86 16080,-1560.08 16080,-1542.01"/>
<polygon fill="black" stroke="black" points="16083.5,-1541.78 16080,-1531.78 16076.5,-1541.78 16083.5,-1541.78"/>
</g>
<!-- expert21_l2_tp1&#45;&gt;expert_agg_l2_tp1 -->
<g id="edge511" class="edge">
<title>expert21_l2_tp1&#45;&gt;expert_agg_l2_tp1</title>
<path fill="none" stroke="black" d="M16248.22,-1593.31C16224.85,-1577.65 16193.88,-1556.91 16164.89,-1537.49"/>
<polygon fill="black" stroke="black" points="16166.63,-1534.44 16156.37,-1531.78 16162.73,-1540.25 16166.63,-1534.44"/>
</g>
<!-- expert22_l2_tp1&#45;&gt;expert_agg_l2_tp1 -->
<g id="edge513" class="edge">
<title>expert22_l2_tp1&#45;&gt;expert_agg_l2_tp1</title>
<path fill="none" stroke="black" d="M16445.9,-1593.52C16428.41,-1584.6 16408.09,-1574.96 16389,-1567.62 16357.99,-1555.69 16324.66,-1544.6 16291.79,-1534.61"/>
<polygon fill="black" stroke="black" points="16292.65,-1531.21 16282.06,-1531.68 16290.63,-1537.92 16292.65,-1531.21"/>
</g>
<!-- expert23_l2_tp1&#45;&gt;expert_agg_l2_tp1 -->
<g id="edge515" class="edge">
<title>expert23_l2_tp1&#45;&gt;expert_agg_l2_tp1</title>
<path fill="none" stroke="black" d="M16654.58,-1593.59C16636.64,-1584.19 16615.31,-1574.2 16595,-1567.62 16513.77,-1541.28 16422.61,-1522.55 16339.83,-1509.39"/>
<polygon fill="black" stroke="black" points="16340.19,-1505.9 16329.77,-1507.81 16339.11,-1512.82 16340.19,-1505.9"/>
</g>
<!-- expert_agg_l2_tp1&#45;&gt;res_add2_l2_tp1 -->
<g id="edge516" class="edge">
<title>expert_agg_l2_tp1&#45;&gt;res_add2_l2_tp1</title>
<path fill="none" stroke="black" d="M16094.6,-1427.53C16097.13,-1418.67 16099.71,-1409.65 16102.07,-1401.36"/>
<polygon fill="black" stroke="black" points="16105.46,-1402.24 16104.84,-1391.66 16098.73,-1400.31 16105.46,-1402.24"/>
</g>
<!-- norm2_l2_tp1 -->
<g id="node344" class="node">
<title>norm2_l2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="16245,-1303.62 15979,-1303.62 15979,-1251.62 16245,-1251.62 16245,-1303.62"/>
<text text-anchor="middle" x="16112" y="-1291.62" font-family="Arial" font-size="10.00">Layer Norm 2 TP1</text>
<text text-anchor="middle" x="16112" y="-1280.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16112" y="-1269.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16112" y="-1258.62" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- res_add2_l2_tp1&#45;&gt;norm2_l2_tp1 -->
<g id="edge518" class="edge">
<title>res_add2_l2_tp1&#45;&gt;norm2_l2_tp1</title>
<path fill="none" stroke="black" d="M16112,-1339.28C16112,-1331.32 16112,-1322.38 16112,-1313.86"/>
<polygon fill="black" stroke="black" points="16115.5,-1313.77 16112,-1303.77 16108.5,-1313.77 16115.5,-1313.77"/>
</g>
<!-- input_split_l3_tp1 -->
<g id="node479" class="node">
<title>input_split_l3_tp1</title>
<ellipse fill="lightgray" stroke="black" cx="16112" cy="-1167.85" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="16112" y="-1181.85" font-family="Arial" font-size="10.00">Input Split TP1</text>
<text text-anchor="middle" x="16112" y="-1170.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16112" y="-1159.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="16112" y="-1148.85" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm2_l2_tp1&#45;&gt;input_split_l3_tp1 -->
<g id="edge710" class="edge">
<title>norm2_l2_tp1&#45;&gt;input_split_l3_tp1</title>
<path fill="none" stroke="black" d="M16112,-1251.35C16112,-1240.56 16112,-1227.61 16112,-1215.21"/>
<polygon fill="black" stroke="black" points="16115.5,-1214.98 16112,-1204.98 16108.5,-1214.98 16115.5,-1214.98"/>
</g>
<!-- mha_qkv_l2_tp2 -->
<g id="node346" class="node">
<title>mha_qkv_l2_tp2</title>
<polygon fill="lightgreen" stroke="black" points="12427.5,-2221.16 12136.5,-2221.16 12136.5,-2169.16 12427.5,-2169.16 12427.5,-2221.16"/>
<text text-anchor="middle" x="12282" y="-2209.16" font-family="Arial" font-size="10.00">MHA QKV TP2</text>
<text text-anchor="middle" x="12282" y="-2198.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="12282" y="-2187.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="12282" y="-2176.16" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- input_split_l2_tp2&#45;&gt;mha_qkv_l2_tp2 -->
<g id="edge519" class="edge">
<title>input_split_l2_tp2&#45;&gt;mha_qkv_l2_tp2</title>
<path fill="none" stroke="black" d="M12282,-2256.89C12282,-2248.58 12282,-2239.75 12282,-2231.47"/>
<polygon fill="black" stroke="black" points="12285.5,-2231.35 12282,-2221.35 12278.5,-2231.35 12285.5,-2231.35"/>
</g>
<!-- res_add_l2_tp2 -->
<g id="node350" class="node">
<title>res_add_l2_tp2</title>
<polygon fill="lightgreen" stroke="black" points="12628,-1847.62 12350,-1847.62 12350,-1795.62 12628,-1795.62 12628,-1847.62"/>
<text text-anchor="middle" x="12489" y="-1835.62" font-family="Arial" font-size="10.00">Residual Add TP2</text>
<text text-anchor="middle" x="12489" y="-1824.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="12489" y="-1813.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12489" y="-1802.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- input_split_l2_tp2&#45;&gt;res_add_l2_tp2 -->
<g id="edge523" class="edge">
<title>input_split_l2_tp2&#45;&gt;res_add_l2_tp2</title>
<path fill="none" stroke="black" d="M12376.48,-2262C12398.29,-2251.59 12420.04,-2238.16 12437,-2221.16 12476.05,-2182.02 12489,-2163.44 12489,-2108.16 12489,-2108.16 12489,-2108.16 12489,-2018.16 12489,-1962.03 12489,-1896.83 12489,-1857.7"/>
<polygon fill="black" stroke="black" points="12492.5,-1857.62 12489,-1847.62 12485.5,-1857.62 12492.5,-1857.62"/>
</g>
<!-- mha_attn_l2_tp2 -->
<g id="node347" class="node">
<title>mha_attn_l2_tp2</title>
<polygon fill="lightgreen" stroke="black" points="12427.5,-2133.16 12136.5,-2133.16 12136.5,-2081.16 12427.5,-2081.16 12427.5,-2133.16"/>
<text text-anchor="middle" x="12282" y="-2121.16" font-family="Arial" font-size="10.00">MHA Attention TP2</text>
<text text-anchor="middle" x="12282" y="-2110.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="12282" y="-2099.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="12282" y="-2088.16" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- mha_qkv_l2_tp2&#45;&gt;mha_attn_l2_tp2 -->
<g id="edge520" class="edge">
<title>mha_qkv_l2_tp2&#45;&gt;mha_attn_l2_tp2</title>
<path fill="none" stroke="black" d="M12282,-2168.82C12282,-2160.86 12282,-2151.92 12282,-2143.4"/>
<polygon fill="black" stroke="black" points="12285.5,-2143.31 12282,-2133.31 12278.5,-2143.31 12285.5,-2143.31"/>
</g>
<!-- mha_out_l2_tp2 -->
<g id="node348" class="node">
<title>mha_out_l2_tp2</title>
<polygon fill="lightgreen" stroke="black" points="12424,-2045.16 12140,-2045.16 12140,-1993.16 12424,-1993.16 12424,-2045.16"/>
<text text-anchor="middle" x="12282" y="-2033.16" font-family="Arial" font-size="10.00">MHA Output TP2</text>
<text text-anchor="middle" x="12282" y="-2022.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="12282" y="-2011.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="12282" y="-2000.16" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- mha_attn_l2_tp2&#45;&gt;mha_out_l2_tp2 -->
<g id="edge521" class="edge">
<title>mha_attn_l2_tp2&#45;&gt;mha_out_l2_tp2</title>
<path fill="none" stroke="black" d="M12282,-2080.82C12282,-2072.86 12282,-2063.92 12282,-2055.4"/>
<polygon fill="black" stroke="black" points="12285.5,-2055.31 12282,-2045.31 12278.5,-2055.31 12285.5,-2055.31"/>
</g>
<!-- attn_allreduce_l2_tp2 -->
<g id="node349" class="node">
<title>attn_allreduce_l2_tp2</title>
<ellipse fill="lightgray" stroke="black" cx="12282" cy="-1920.39" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="12282" y="-1934.39" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP2</text>
<text text-anchor="middle" x="12282" y="-1923.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="12282" y="-1912.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12282" y="-1901.39" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- mha_out_l2_tp2&#45;&gt;attn_allreduce_l2_tp2 -->
<g id="edge522" class="edge">
<title>mha_out_l2_tp2&#45;&gt;attn_allreduce_l2_tp2</title>
<path fill="none" stroke="black" d="M12282,-1992.98C12282,-1985.18 12282,-1976.31 12282,-1967.54"/>
<polygon fill="black" stroke="black" points="12285.5,-1967.36 12282,-1957.36 12278.5,-1967.36 12285.5,-1967.36"/>
</g>
<!-- attn_allreduce_l2_tp2&#45;&gt;res_add_l2_tp2 -->
<g id="edge524" class="edge">
<title>attn_allreduce_l2_tp2&#45;&gt;res_add_l2_tp2</title>
<path fill="none" stroke="black" d="M12352.95,-1886.22C12376.71,-1875.11 12403.02,-1862.81 12426.12,-1852.01"/>
<polygon fill="black" stroke="black" points="12427.89,-1855.05 12435.47,-1847.64 12424.93,-1848.71 12427.89,-1855.05"/>
</g>
<!-- norm_l2_tp2 -->
<g id="node351" class="node">
<title>norm_l2_tp2</title>
<polygon fill="lightgreen" stroke="black" points="13735,-1759.62 13469,-1759.62 13469,-1707.62 13735,-1707.62 13735,-1759.62"/>
<text text-anchor="middle" x="13602" y="-1747.62" font-family="Arial" font-size="10.00">Layer Norm TP2</text>
<text text-anchor="middle" x="13602" y="-1736.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13602" y="-1725.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13602" y="-1714.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- res_add_l2_tp2&#45;&gt;norm_l2_tp2 -->
<g id="edge525" class="edge">
<title>res_add_l2_tp2&#45;&gt;norm_l2_tp2</title>
<path fill="none" stroke="black" d="M12628.27,-1809.86C12840.72,-1793.44 13243.66,-1762.31 13458.56,-1745.7"/>
<polygon fill="black" stroke="black" points="13458.95,-1749.18 13468.65,-1744.92 13458.41,-1742.2 13458.95,-1749.18"/>
</g>
<!-- gate_l2_tp2 -->
<g id="node352" class="node">
<title>gate_l2_tp2</title>
<polygon fill="lightyellow" stroke="black" points="12872.3,-1671.62 12405.72,-1671.62 12285.7,-1567.62 12752.28,-1567.62 12872.3,-1671.62"/>
<text text-anchor="middle" x="12579" y="-1633.62" font-family="Arial" font-size="10.00">Gate Network TP2</text>
<text text-anchor="middle" x="12579" y="-1622.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12579" y="-1611.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="12579" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l2_tp2&#45;&gt;gate_l2_tp2 -->
<g id="edge526" class="edge">
<title>norm_l2_tp2&#45;&gt;gate_l2_tp2</title>
<path fill="none" stroke="black" d="M13468.77,-1724.66C13323.8,-1715.24 13085.39,-1697.48 12881,-1671.62 12880.9,-1671.6 12880.79,-1671.59 12880.69,-1671.58"/>
<polygon fill="black" stroke="black" points="12881.42,-1668.14 12871.05,-1670.34 12880.53,-1675.09 12881.42,-1668.14"/>
</g>
<!-- expert24_l2_tp2 -->
<g id="node353" class="node">
<title>expert24_l2_tp2</title>
<polygon fill="lightcoral" stroke="black" points="13078,-1645.62 12890,-1645.62 12890,-1593.62 13078,-1593.62 13078,-1645.62"/>
<text text-anchor="middle" x="12984" y="-1633.62" font-family="Arial" font-size="10.00">Expert 24</text>
<text text-anchor="middle" x="12984" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12984" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12984" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l2_tp2&#45;&gt;expert24_l2_tp2 -->
<g id="edge527" class="edge">
<title>norm_l2_tp2&#45;&gt;expert24_l2_tp2</title>
<path fill="none" stroke="black" d="M13468.79,-1729.28C13363.31,-1723.68 13213.22,-1709.12 13087,-1671.62 13069.57,-1666.44 13051.5,-1658.49 13035.45,-1650.39"/>
<polygon fill="black" stroke="black" points="13036.75,-1647.12 13026.26,-1645.63 13033.53,-1653.33 13036.75,-1647.12"/>
</g>
<!-- expert25_l2_tp2 -->
<g id="node354" class="node">
<title>expert25_l2_tp2</title>
<polygon fill="lightcoral" stroke="black" points="13284,-1645.62 13096,-1645.62 13096,-1593.62 13284,-1593.62 13284,-1645.62"/>
<text text-anchor="middle" x="13190" y="-1633.62" font-family="Arial" font-size="10.00">Expert 25</text>
<text text-anchor="middle" x="13190" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13190" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13190" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l2_tp2&#45;&gt;expert25_l2_tp2 -->
<g id="edge529" class="edge">
<title>norm_l2_tp2&#45;&gt;expert25_l2_tp2</title>
<path fill="none" stroke="black" d="M13468.8,-1714.27C13413.54,-1704.62 13349.31,-1690.74 13293,-1671.62 13276.26,-1665.93 13258.77,-1658.07 13243.05,-1650.23"/>
<polygon fill="black" stroke="black" points="13244.52,-1647.05 13234.02,-1645.62 13241.34,-1653.28 13244.52,-1647.05"/>
</g>
<!-- expert26_l2_tp2 -->
<g id="node355" class="node">
<title>expert26_l2_tp2</title>
<polygon fill="lightcoral" stroke="black" points="13490,-1645.62 13302,-1645.62 13302,-1593.62 13490,-1593.62 13490,-1645.62"/>
<text text-anchor="middle" x="13396" y="-1633.62" font-family="Arial" font-size="10.00">Expert 26</text>
<text text-anchor="middle" x="13396" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13396" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13396" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l2_tp2&#45;&gt;expert26_l2_tp2 -->
<g id="edge531" class="edge">
<title>norm_l2_tp2&#45;&gt;expert26_l2_tp2</title>
<path fill="none" stroke="black" d="M13555.77,-1707.48C13524.76,-1690.62 13483.76,-1668.33 13451.06,-1650.55"/>
<polygon fill="black" stroke="black" points="13452.53,-1647.37 13442.08,-1645.67 13449.19,-1653.52 13452.53,-1647.37"/>
</g>
<!-- expert27_l2_tp2 -->
<g id="node356" class="node">
<title>expert27_l2_tp2</title>
<polygon fill="lightcoral" stroke="black" points="13696,-1645.62 13508,-1645.62 13508,-1593.62 13696,-1593.62 13696,-1645.62"/>
<text text-anchor="middle" x="13602" y="-1633.62" font-family="Arial" font-size="10.00">Expert 27</text>
<text text-anchor="middle" x="13602" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13602" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13602" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l2_tp2&#45;&gt;expert27_l2_tp2 -->
<g id="edge533" class="edge">
<title>norm_l2_tp2&#45;&gt;expert27_l2_tp2</title>
<path fill="none" stroke="black" d="M13602,-1707.48C13602,-1692.21 13602,-1672.48 13602,-1655.68"/>
<polygon fill="black" stroke="black" points="13605.5,-1655.67 13602,-1645.67 13598.5,-1655.67 13605.5,-1655.67"/>
</g>
<!-- expert28_l2_tp2 -->
<g id="node357" class="node">
<title>expert28_l2_tp2</title>
<polygon fill="lightcoral" stroke="black" points="13902,-1645.62 13714,-1645.62 13714,-1593.62 13902,-1593.62 13902,-1645.62"/>
<text text-anchor="middle" x="13808" y="-1633.62" font-family="Arial" font-size="10.00">Expert 28</text>
<text text-anchor="middle" x="13808" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13808" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13808" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l2_tp2&#45;&gt;expert28_l2_tp2 -->
<g id="edge535" class="edge">
<title>norm_l2_tp2&#45;&gt;expert28_l2_tp2</title>
<path fill="none" stroke="black" d="M13648.23,-1707.48C13679.24,-1690.62 13720.24,-1668.33 13752.94,-1650.55"/>
<polygon fill="black" stroke="black" points="13754.81,-1653.52 13761.92,-1645.67 13751.47,-1647.37 13754.81,-1653.52"/>
</g>
<!-- expert29_l2_tp2 -->
<g id="node358" class="node">
<title>expert29_l2_tp2</title>
<polygon fill="lightcoral" stroke="black" points="14108,-1645.62 13920,-1645.62 13920,-1593.62 14108,-1593.62 14108,-1645.62"/>
<text text-anchor="middle" x="14014" y="-1633.62" font-family="Arial" font-size="10.00">Expert 29</text>
<text text-anchor="middle" x="14014" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14014" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14014" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l2_tp2&#45;&gt;expert29_l2_tp2 -->
<g id="edge537" class="edge">
<title>norm_l2_tp2&#45;&gt;expert29_l2_tp2</title>
<path fill="none" stroke="black" d="M13735.2,-1714.27C13790.46,-1704.62 13854.69,-1690.74 13911,-1671.62 13927.74,-1665.93 13945.23,-1658.07 13960.95,-1650.23"/>
<polygon fill="black" stroke="black" points="13962.66,-1653.28 13969.98,-1645.62 13959.48,-1647.05 13962.66,-1653.28"/>
</g>
<!-- expert30_l2_tp2 -->
<g id="node359" class="node">
<title>expert30_l2_tp2</title>
<polygon fill="lightcoral" stroke="black" points="14314,-1645.62 14126,-1645.62 14126,-1593.62 14314,-1593.62 14314,-1645.62"/>
<text text-anchor="middle" x="14220" y="-1633.62" font-family="Arial" font-size="10.00">Expert 30</text>
<text text-anchor="middle" x="14220" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14220" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14220" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l2_tp2&#45;&gt;expert30_l2_tp2 -->
<g id="edge539" class="edge">
<title>norm_l2_tp2&#45;&gt;expert30_l2_tp2</title>
<path fill="none" stroke="black" d="M13735.21,-1729.28C13840.69,-1723.68 13990.78,-1709.12 14117,-1671.62 14134.43,-1666.44 14152.5,-1658.49 14168.55,-1650.39"/>
<polygon fill="black" stroke="black" points="14170.47,-1653.33 14177.74,-1645.63 14167.25,-1647.12 14170.47,-1653.33"/>
</g>
<!-- expert31_l2_tp2 -->
<g id="node360" class="node">
<title>expert31_l2_tp2</title>
<polygon fill="lightcoral" stroke="black" points="14520,-1645.62 14332,-1645.62 14332,-1593.62 14520,-1593.62 14520,-1645.62"/>
<text text-anchor="middle" x="14426" y="-1633.62" font-family="Arial" font-size="10.00">Expert 31</text>
<text text-anchor="middle" x="14426" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14426" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14426" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l2_tp2&#45;&gt;expert31_l2_tp2 -->
<g id="edge541" class="edge">
<title>norm_l2_tp2&#45;&gt;expert31_l2_tp2</title>
<path fill="none" stroke="black" d="M13735.01,-1727.31C13912.24,-1719.22 14215.92,-1701.49 14323,-1671.62 14340.67,-1666.69 14358.94,-1658.72 14375.09,-1650.53"/>
<polygon fill="black" stroke="black" points="14377.09,-1653.43 14384.34,-1645.71 14373.85,-1647.23 14377.09,-1653.43"/>
</g>
<!-- res_add2_l2_tp2 -->
<g id="node362" class="node">
<title>res_add2_l2_tp2</title>
<polygon fill="lightgreen" stroke="black" points="13999,-1391.62 13721,-1391.62 13721,-1339.62 13999,-1339.62 13999,-1391.62"/>
<text text-anchor="middle" x="13860" y="-1379.62" font-family="Arial" font-size="10.00">Residual Add 2 TP2</text>
<text text-anchor="middle" x="13860" y="-1368.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="13860" y="-1357.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13860" y="-1346.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l2_tp2&#45;&gt;res_add2_l2_tp2 -->
<g id="edge544" class="edge">
<title>norm_l2_tp2&#45;&gt;res_add2_l2_tp2</title>
<path fill="none" stroke="black" d="M13735.04,-1728.61C13985.03,-1720.42 14502.3,-1700.13 14529,-1671.62 14544.8,-1654.75 14542.62,-1586.29 14529,-1567.62 14409.09,-1403.17 14288.41,-1484.52 14093,-1427.62 14053.12,-1416 14009.11,-1404.22 13970.18,-1394.14"/>
<polygon fill="black" stroke="black" points="13970.95,-1390.73 13960.39,-1391.62 13969.2,-1397.51 13970.95,-1390.73"/>
</g>
<!-- expert_agg_l2_tp2 -->
<g id="node361" class="node">
<title>expert_agg_l2_tp2</title>
<polygon fill="lightpink" stroke="black" points="14083.55,-1531.62 13645.21,-1531.62 13532.45,-1427.62 13970.79,-1427.62 14083.55,-1531.62"/>
<text text-anchor="middle" x="13808" y="-1493.62" font-family="Arial" font-size="10.00">Expert Aggregation TP2</text>
<text text-anchor="middle" x="13808" y="-1482.62" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="13808" y="-1471.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13808" y="-1460.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- expert24_l2_tp2&#45;&gt;expert_agg_l2_tp2 -->
<g id="edge528" class="edge">
<title>expert24_l2_tp2&#45;&gt;expert_agg_l2_tp2</title>
<path fill="none" stroke="black" d="M13026.77,-1593.37C13044.79,-1583.82 13066.35,-1573.78 13087,-1567.62 13250.12,-1518.95 13441.72,-1497.42 13586.39,-1487.94"/>
<polygon fill="black" stroke="black" points="13586.97,-1491.41 13596.72,-1487.28 13586.52,-1484.42 13586.97,-1491.41"/>
</g>
<!-- expert25_l2_tp2&#45;&gt;expert_agg_l2_tp2 -->
<g id="edge530" class="edge">
<title>expert25_l2_tp2&#45;&gt;expert_agg_l2_tp2</title>
<path fill="none" stroke="black" d="M13233.42,-1593.59C13251.36,-1584.19 13272.69,-1574.2 13293,-1567.62 13391.93,-1535.54 13505.58,-1514.74 13600.91,-1501.56"/>
<polygon fill="black" stroke="black" points="13601.53,-1505 13610.96,-1500.18 13600.58,-1498.07 13601.53,-1505"/>
</g>
<!-- expert26_l2_tp2&#45;&gt;expert_agg_l2_tp2 -->
<g id="edge532" class="edge">
<title>expert26_l2_tp2&#45;&gt;expert_agg_l2_tp2</title>
<path fill="none" stroke="black" d="M13442.1,-1593.52C13459.59,-1584.6 13479.91,-1574.96 13499,-1567.62 13539.42,-1552.08 13583.76,-1537.95 13625.93,-1525.82"/>
<polygon fill="black" stroke="black" points="13627.09,-1529.13 13635.74,-1523.02 13625.17,-1522.4 13627.09,-1529.13"/>
</g>
<!-- expert27_l2_tp2&#45;&gt;expert_agg_l2_tp2 -->
<g id="edge534" class="edge">
<title>expert27_l2_tp2&#45;&gt;expert_agg_l2_tp2</title>
<path fill="none" stroke="black" d="M13639.78,-1593.31C13663.15,-1577.65 13694.12,-1556.91 13723.11,-1537.49"/>
<polygon fill="black" stroke="black" points="13725.27,-1540.25 13731.63,-1531.78 13721.37,-1534.44 13725.27,-1540.25"/>
</g>
<!-- expert28_l2_tp2&#45;&gt;expert_agg_l2_tp2 -->
<g id="edge536" class="edge">
<title>expert28_l2_tp2&#45;&gt;expert_agg_l2_tp2</title>
<path fill="none" stroke="black" d="M13808,-1593.31C13808,-1578.86 13808,-1560.08 13808,-1542.01"/>
<polygon fill="black" stroke="black" points="13811.5,-1541.78 13808,-1531.78 13804.5,-1541.78 13811.5,-1541.78"/>
</g>
<!-- expert29_l2_tp2&#45;&gt;expert_agg_l2_tp2 -->
<g id="edge538" class="edge">
<title>expert29_l2_tp2&#45;&gt;expert_agg_l2_tp2</title>
<path fill="none" stroke="black" d="M13976.22,-1593.31C13952.85,-1577.65 13921.88,-1556.91 13892.89,-1537.49"/>
<polygon fill="black" stroke="black" points="13894.63,-1534.44 13884.37,-1531.78 13890.73,-1540.25 13894.63,-1534.44"/>
</g>
<!-- expert30_l2_tp2&#45;&gt;expert_agg_l2_tp2 -->
<g id="edge540" class="edge">
<title>expert30_l2_tp2&#45;&gt;expert_agg_l2_tp2</title>
<path fill="none" stroke="black" d="M14173.9,-1593.52C14156.41,-1584.6 14136.09,-1574.96 14117,-1567.62 14085.99,-1555.69 14052.66,-1544.6 14019.79,-1534.61"/>
<polygon fill="black" stroke="black" points="14020.65,-1531.21 14010.06,-1531.68 14018.63,-1537.92 14020.65,-1531.21"/>
</g>
<!-- expert31_l2_tp2&#45;&gt;expert_agg_l2_tp2 -->
<g id="edge542" class="edge">
<title>expert31_l2_tp2&#45;&gt;expert_agg_l2_tp2</title>
<path fill="none" stroke="black" d="M14382.58,-1593.59C14364.64,-1584.19 14343.31,-1574.2 14323,-1567.62 14241.77,-1541.28 14150.61,-1522.55 14067.83,-1509.39"/>
<polygon fill="black" stroke="black" points="14068.19,-1505.9 14057.77,-1507.81 14067.11,-1512.82 14068.19,-1505.9"/>
</g>
<!-- expert_agg_l2_tp2&#45;&gt;res_add2_l2_tp2 -->
<g id="edge543" class="edge">
<title>expert_agg_l2_tp2&#45;&gt;res_add2_l2_tp2</title>
<path fill="none" stroke="black" d="M13831.72,-1427.53C13835.92,-1418.48 13840.21,-1409.25 13844.13,-1400.81"/>
<polygon fill="black" stroke="black" points="13847.34,-1402.2 13848.37,-1391.66 13840.99,-1399.26 13847.34,-1402.2"/>
</g>
<!-- norm2_l2_tp2 -->
<g id="node363" class="node">
<title>norm2_l2_tp2</title>
<polygon fill="lightgreen" stroke="black" points="13993,-1303.62 13727,-1303.62 13727,-1251.62 13993,-1251.62 13993,-1303.62"/>
<text text-anchor="middle" x="13860" y="-1291.62" font-family="Arial" font-size="10.00">Layer Norm 2 TP2</text>
<text text-anchor="middle" x="13860" y="-1280.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13860" y="-1269.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13860" y="-1258.62" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- res_add2_l2_tp2&#45;&gt;norm2_l2_tp2 -->
<g id="edge545" class="edge">
<title>res_add2_l2_tp2&#45;&gt;norm2_l2_tp2</title>
<path fill="none" stroke="black" d="M13860,-1339.28C13860,-1331.32 13860,-1322.38 13860,-1313.86"/>
<polygon fill="black" stroke="black" points="13863.5,-1313.77 13860,-1303.77 13856.5,-1313.77 13863.5,-1313.77"/>
</g>
<!-- input_split_l3_tp2 -->
<g id="node498" class="node">
<title>input_split_l3_tp2</title>
<ellipse fill="lightgray" stroke="black" cx="13860" cy="-1167.85" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="13860" y="-1181.85" font-family="Arial" font-size="10.00">Input Split TP2</text>
<text text-anchor="middle" x="13860" y="-1170.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13860" y="-1159.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="13860" y="-1148.85" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm2_l2_tp2&#45;&gt;input_split_l3_tp2 -->
<g id="edge739" class="edge">
<title>norm2_l2_tp2&#45;&gt;input_split_l3_tp2</title>
<path fill="none" stroke="black" d="M13860,-1251.35C13860,-1240.56 13860,-1227.61 13860,-1215.21"/>
<polygon fill="black" stroke="black" points="13863.5,-1214.98 13860,-1204.98 13856.5,-1214.98 13863.5,-1214.98"/>
</g>
<!-- mha_qkv_l2_tp3 -->
<g id="node365" class="node">
<title>mha_qkv_l2_tp3</title>
<polygon fill="lightgreen" stroke="black" points="10770.5,-2221.16 10479.5,-2221.16 10479.5,-2169.16 10770.5,-2169.16 10770.5,-2221.16"/>
<text text-anchor="middle" x="10625" y="-2209.16" font-family="Arial" font-size="10.00">MHA QKV TP3</text>
<text text-anchor="middle" x="10625" y="-2198.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="10625" y="-2187.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="10625" y="-2176.16" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- input_split_l2_tp3&#45;&gt;mha_qkv_l2_tp3 -->
<g id="edge546" class="edge">
<title>input_split_l2_tp3&#45;&gt;mha_qkv_l2_tp3</title>
<path fill="none" stroke="black" d="M10625,-2256.89C10625,-2248.58 10625,-2239.75 10625,-2231.47"/>
<polygon fill="black" stroke="black" points="10628.5,-2231.35 10625,-2221.35 10621.5,-2231.35 10628.5,-2231.35"/>
</g>
<!-- res_add_l2_tp3 -->
<g id="node369" class="node">
<title>res_add_l2_tp3</title>
<polygon fill="lightgreen" stroke="black" points="10971,-1847.62 10693,-1847.62 10693,-1795.62 10971,-1795.62 10971,-1847.62"/>
<text text-anchor="middle" x="10832" y="-1835.62" font-family="Arial" font-size="10.00">Residual Add TP3</text>
<text text-anchor="middle" x="10832" y="-1824.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="10832" y="-1813.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10832" y="-1802.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- input_split_l2_tp3&#45;&gt;res_add_l2_tp3 -->
<g id="edge550" class="edge">
<title>input_split_l2_tp3&#45;&gt;res_add_l2_tp3</title>
<path fill="none" stroke="black" d="M10719.48,-2262C10741.29,-2251.59 10763.04,-2238.16 10780,-2221.16 10819.05,-2182.02 10832,-2163.44 10832,-2108.16 10832,-2108.16 10832,-2108.16 10832,-2018.16 10832,-1962.03 10832,-1896.83 10832,-1857.7"/>
<polygon fill="black" stroke="black" points="10835.5,-1857.62 10832,-1847.62 10828.5,-1857.62 10835.5,-1857.62"/>
</g>
<!-- mha_attn_l2_tp3 -->
<g id="node366" class="node">
<title>mha_attn_l2_tp3</title>
<polygon fill="lightgreen" stroke="black" points="10770.5,-2133.16 10479.5,-2133.16 10479.5,-2081.16 10770.5,-2081.16 10770.5,-2133.16"/>
<text text-anchor="middle" x="10625" y="-2121.16" font-family="Arial" font-size="10.00">MHA Attention TP3</text>
<text text-anchor="middle" x="10625" y="-2110.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="10625" y="-2099.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="10625" y="-2088.16" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- mha_qkv_l2_tp3&#45;&gt;mha_attn_l2_tp3 -->
<g id="edge547" class="edge">
<title>mha_qkv_l2_tp3&#45;&gt;mha_attn_l2_tp3</title>
<path fill="none" stroke="black" d="M10625,-2168.82C10625,-2160.86 10625,-2151.92 10625,-2143.4"/>
<polygon fill="black" stroke="black" points="10628.5,-2143.31 10625,-2133.31 10621.5,-2143.31 10628.5,-2143.31"/>
</g>
<!-- mha_out_l2_tp3 -->
<g id="node367" class="node">
<title>mha_out_l2_tp3</title>
<polygon fill="lightgreen" stroke="black" points="10767,-2045.16 10483,-2045.16 10483,-1993.16 10767,-1993.16 10767,-2045.16"/>
<text text-anchor="middle" x="10625" y="-2033.16" font-family="Arial" font-size="10.00">MHA Output TP3</text>
<text text-anchor="middle" x="10625" y="-2022.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="10625" y="-2011.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="10625" y="-2000.16" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- mha_attn_l2_tp3&#45;&gt;mha_out_l2_tp3 -->
<g id="edge548" class="edge">
<title>mha_attn_l2_tp3&#45;&gt;mha_out_l2_tp3</title>
<path fill="none" stroke="black" d="M10625,-2080.82C10625,-2072.86 10625,-2063.92 10625,-2055.4"/>
<polygon fill="black" stroke="black" points="10628.5,-2055.31 10625,-2045.31 10621.5,-2055.31 10628.5,-2055.31"/>
</g>
<!-- attn_allreduce_l2_tp3 -->
<g id="node368" class="node">
<title>attn_allreduce_l2_tp3</title>
<ellipse fill="lightgray" stroke="black" cx="10625" cy="-1920.39" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="10625" y="-1934.39" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP3</text>
<text text-anchor="middle" x="10625" y="-1923.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="10625" y="-1912.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10625" y="-1901.39" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- mha_out_l2_tp3&#45;&gt;attn_allreduce_l2_tp3 -->
<g id="edge549" class="edge">
<title>mha_out_l2_tp3&#45;&gt;attn_allreduce_l2_tp3</title>
<path fill="none" stroke="black" d="M10625,-1992.98C10625,-1985.18 10625,-1976.31 10625,-1967.54"/>
<polygon fill="black" stroke="black" points="10628.5,-1967.36 10625,-1957.36 10621.5,-1967.36 10628.5,-1967.36"/>
</g>
<!-- attn_allreduce_l2_tp3&#45;&gt;res_add_l2_tp3 -->
<g id="edge551" class="edge">
<title>attn_allreduce_l2_tp3&#45;&gt;res_add_l2_tp3</title>
<path fill="none" stroke="black" d="M10695.95,-1886.22C10719.71,-1875.11 10746.02,-1862.81 10769.12,-1852.01"/>
<polygon fill="black" stroke="black" points="10770.89,-1855.05 10778.47,-1847.64 10767.93,-1848.71 10770.89,-1855.05"/>
</g>
<!-- norm_l2_tp3 -->
<g id="node370" class="node">
<title>norm_l2_tp3</title>
<polygon fill="lightgreen" stroke="black" points="11463,-1759.62 11197,-1759.62 11197,-1707.62 11463,-1707.62 11463,-1759.62"/>
<text text-anchor="middle" x="11330" y="-1747.62" font-family="Arial" font-size="10.00">Layer Norm TP3</text>
<text text-anchor="middle" x="11330" y="-1736.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11330" y="-1725.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11330" y="-1714.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- res_add_l2_tp3&#45;&gt;norm_l2_tp3 -->
<g id="edge552" class="edge">
<title>res_add_l2_tp3&#45;&gt;norm_l2_tp3</title>
<path fill="none" stroke="black" d="M10971.05,-1796.6C11038.39,-1784.98 11119.15,-1771.03 11187,-1759.31"/>
<polygon fill="black" stroke="black" points="11187.65,-1762.75 11196.91,-1757.6 11186.46,-1755.85 11187.65,-1762.75"/>
</g>
<!-- gate_l2_tp3 -->
<g id="node371" class="node">
<title>gate_l2_tp3</title>
<polygon fill="lightyellow" stroke="black" points="10600.3,-1671.62 10133.72,-1671.62 10013.7,-1567.62 10480.28,-1567.62 10600.3,-1671.62"/>
<text text-anchor="middle" x="10307" y="-1633.62" font-family="Arial" font-size="10.00">Gate Network TP3</text>
<text text-anchor="middle" x="10307" y="-1622.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10307" y="-1611.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="10307" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l2_tp3&#45;&gt;gate_l2_tp3 -->
<g id="edge553" class="edge">
<title>norm_l2_tp3&#45;&gt;gate_l2_tp3</title>
<path fill="none" stroke="black" d="M11196.77,-1724.66C11051.8,-1715.24 10813.39,-1697.48 10609,-1671.62 10608.9,-1671.6 10608.79,-1671.59 10608.69,-1671.58"/>
<polygon fill="black" stroke="black" points="10609.42,-1668.14 10599.05,-1670.34 10608.53,-1675.09 10609.42,-1668.14"/>
</g>
<!-- expert32_l2_tp3 -->
<g id="node372" class="node">
<title>expert32_l2_tp3</title>
<polygon fill="lightcoral" stroke="black" points="10806,-1645.62 10618,-1645.62 10618,-1593.62 10806,-1593.62 10806,-1645.62"/>
<text text-anchor="middle" x="10712" y="-1633.62" font-family="Arial" font-size="10.00">Expert 32</text>
<text text-anchor="middle" x="10712" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10712" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10712" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l2_tp3&#45;&gt;expert32_l2_tp3 -->
<g id="edge554" class="edge">
<title>norm_l2_tp3&#45;&gt;expert32_l2_tp3</title>
<path fill="none" stroke="black" d="M11196.79,-1729.28C11091.31,-1723.68 10941.22,-1709.12 10815,-1671.62 10797.57,-1666.44 10779.5,-1658.49 10763.45,-1650.39"/>
<polygon fill="black" stroke="black" points="10764.75,-1647.12 10754.26,-1645.63 10761.53,-1653.33 10764.75,-1647.12"/>
</g>
<!-- expert33_l2_tp3 -->
<g id="node373" class="node">
<title>expert33_l2_tp3</title>
<polygon fill="lightcoral" stroke="black" points="11012,-1645.62 10824,-1645.62 10824,-1593.62 11012,-1593.62 11012,-1645.62"/>
<text text-anchor="middle" x="10918" y="-1633.62" font-family="Arial" font-size="10.00">Expert 33</text>
<text text-anchor="middle" x="10918" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10918" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10918" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l2_tp3&#45;&gt;expert33_l2_tp3 -->
<g id="edge556" class="edge">
<title>norm_l2_tp3&#45;&gt;expert33_l2_tp3</title>
<path fill="none" stroke="black" d="M11196.8,-1714.27C11141.54,-1704.62 11077.31,-1690.74 11021,-1671.62 11004.26,-1665.93 10986.77,-1658.07 10971.05,-1650.23"/>
<polygon fill="black" stroke="black" points="10972.52,-1647.05 10962.02,-1645.62 10969.34,-1653.28 10972.52,-1647.05"/>
</g>
<!-- expert34_l2_tp3 -->
<g id="node374" class="node">
<title>expert34_l2_tp3</title>
<polygon fill="lightcoral" stroke="black" points="11218,-1645.62 11030,-1645.62 11030,-1593.62 11218,-1593.62 11218,-1645.62"/>
<text text-anchor="middle" x="11124" y="-1633.62" font-family="Arial" font-size="10.00">Expert 34</text>
<text text-anchor="middle" x="11124" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11124" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11124" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l2_tp3&#45;&gt;expert34_l2_tp3 -->
<g id="edge558" class="edge">
<title>norm_l2_tp3&#45;&gt;expert34_l2_tp3</title>
<path fill="none" stroke="black" d="M11283.77,-1707.48C11252.76,-1690.62 11211.76,-1668.33 11179.06,-1650.55"/>
<polygon fill="black" stroke="black" points="11180.53,-1647.37 11170.08,-1645.67 11177.19,-1653.52 11180.53,-1647.37"/>
</g>
<!-- expert35_l2_tp3 -->
<g id="node375" class="node">
<title>expert35_l2_tp3</title>
<polygon fill="lightcoral" stroke="black" points="11424,-1645.62 11236,-1645.62 11236,-1593.62 11424,-1593.62 11424,-1645.62"/>
<text text-anchor="middle" x="11330" y="-1633.62" font-family="Arial" font-size="10.00">Expert 35</text>
<text text-anchor="middle" x="11330" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11330" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11330" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l2_tp3&#45;&gt;expert35_l2_tp3 -->
<g id="edge560" class="edge">
<title>norm_l2_tp3&#45;&gt;expert35_l2_tp3</title>
<path fill="none" stroke="black" d="M11330,-1707.48C11330,-1692.21 11330,-1672.48 11330,-1655.68"/>
<polygon fill="black" stroke="black" points="11333.5,-1655.67 11330,-1645.67 11326.5,-1655.67 11333.5,-1655.67"/>
</g>
<!-- expert36_l2_tp3 -->
<g id="node376" class="node">
<title>expert36_l2_tp3</title>
<polygon fill="lightcoral" stroke="black" points="11630,-1645.62 11442,-1645.62 11442,-1593.62 11630,-1593.62 11630,-1645.62"/>
<text text-anchor="middle" x="11536" y="-1633.62" font-family="Arial" font-size="10.00">Expert 36</text>
<text text-anchor="middle" x="11536" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11536" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11536" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l2_tp3&#45;&gt;expert36_l2_tp3 -->
<g id="edge562" class="edge">
<title>norm_l2_tp3&#45;&gt;expert36_l2_tp3</title>
<path fill="none" stroke="black" d="M11376.23,-1707.48C11407.24,-1690.62 11448.24,-1668.33 11480.94,-1650.55"/>
<polygon fill="black" stroke="black" points="11482.81,-1653.52 11489.92,-1645.67 11479.47,-1647.37 11482.81,-1653.52"/>
</g>
<!-- expert37_l2_tp3 -->
<g id="node377" class="node">
<title>expert37_l2_tp3</title>
<polygon fill="lightcoral" stroke="black" points="11836,-1645.62 11648,-1645.62 11648,-1593.62 11836,-1593.62 11836,-1645.62"/>
<text text-anchor="middle" x="11742" y="-1633.62" font-family="Arial" font-size="10.00">Expert 37</text>
<text text-anchor="middle" x="11742" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11742" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11742" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l2_tp3&#45;&gt;expert37_l2_tp3 -->
<g id="edge564" class="edge">
<title>norm_l2_tp3&#45;&gt;expert37_l2_tp3</title>
<path fill="none" stroke="black" d="M11463.2,-1714.27C11518.46,-1704.62 11582.69,-1690.74 11639,-1671.62 11655.74,-1665.93 11673.23,-1658.07 11688.95,-1650.23"/>
<polygon fill="black" stroke="black" points="11690.66,-1653.28 11697.98,-1645.62 11687.48,-1647.05 11690.66,-1653.28"/>
</g>
<!-- expert38_l2_tp3 -->
<g id="node378" class="node">
<title>expert38_l2_tp3</title>
<polygon fill="lightcoral" stroke="black" points="12042,-1645.62 11854,-1645.62 11854,-1593.62 12042,-1593.62 12042,-1645.62"/>
<text text-anchor="middle" x="11948" y="-1633.62" font-family="Arial" font-size="10.00">Expert 38</text>
<text text-anchor="middle" x="11948" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11948" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11948" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l2_tp3&#45;&gt;expert38_l2_tp3 -->
<g id="edge566" class="edge">
<title>norm_l2_tp3&#45;&gt;expert38_l2_tp3</title>
<path fill="none" stroke="black" d="M11463.21,-1729.28C11568.69,-1723.68 11718.78,-1709.12 11845,-1671.62 11862.43,-1666.44 11880.5,-1658.49 11896.55,-1650.39"/>
<polygon fill="black" stroke="black" points="11898.47,-1653.33 11905.74,-1645.63 11895.25,-1647.12 11898.47,-1653.33"/>
</g>
<!-- expert39_l2_tp3 -->
<g id="node379" class="node">
<title>expert39_l2_tp3</title>
<polygon fill="lightcoral" stroke="black" points="12248,-1645.62 12060,-1645.62 12060,-1593.62 12248,-1593.62 12248,-1645.62"/>
<text text-anchor="middle" x="12154" y="-1633.62" font-family="Arial" font-size="10.00">Expert 39</text>
<text text-anchor="middle" x="12154" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12154" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12154" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l2_tp3&#45;&gt;expert39_l2_tp3 -->
<g id="edge568" class="edge">
<title>norm_l2_tp3&#45;&gt;expert39_l2_tp3</title>
<path fill="none" stroke="black" d="M11463.01,-1727.31C11640.24,-1719.22 11943.92,-1701.49 12051,-1671.62 12068.67,-1666.69 12086.94,-1658.72 12103.09,-1650.53"/>
<polygon fill="black" stroke="black" points="12105.09,-1653.43 12112.34,-1645.71 12101.85,-1647.23 12105.09,-1653.43"/>
</g>
<!-- res_add2_l2_tp3 -->
<g id="node381" class="node">
<title>res_add2_l2_tp3</title>
<polygon fill="lightgreen" stroke="black" points="11701,-1391.62 11423,-1391.62 11423,-1339.62 11701,-1339.62 11701,-1391.62"/>
<text text-anchor="middle" x="11562" y="-1379.62" font-family="Arial" font-size="10.00">Residual Add 2 TP3</text>
<text text-anchor="middle" x="11562" y="-1368.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="11562" y="-1357.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11562" y="-1346.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l2_tp3&#45;&gt;res_add2_l2_tp3 -->
<g id="edge571" class="edge">
<title>norm_l2_tp3&#45;&gt;res_add2_l2_tp3</title>
<path fill="none" stroke="black" d="M11463.04,-1728.61C11713.03,-1720.42 12230.3,-1700.13 12257,-1671.62 12272.8,-1654.75 12270.62,-1586.29 12257,-1567.62 12137.09,-1403.17 12017.09,-1482.1 11821,-1427.62 11777.54,-1415.54 11729.55,-1403.8 11686.81,-1393.9"/>
<polygon fill="black" stroke="black" points="11687.46,-1390.46 11676.93,-1391.62 11685.89,-1397.28 11687.46,-1390.46"/>
</g>
<!-- expert_agg_l2_tp3 -->
<g id="node380" class="node">
<title>expert_agg_l2_tp3</title>
<polygon fill="lightpink" stroke="black" points="11811.55,-1531.62 11373.21,-1531.62 11260.45,-1427.62 11698.79,-1427.62 11811.55,-1531.62"/>
<text text-anchor="middle" x="11536" y="-1493.62" font-family="Arial" font-size="10.00">Expert Aggregation TP3</text>
<text text-anchor="middle" x="11536" y="-1482.62" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="11536" y="-1471.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11536" y="-1460.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- expert32_l2_tp3&#45;&gt;expert_agg_l2_tp3 -->
<g id="edge555" class="edge">
<title>expert32_l2_tp3&#45;&gt;expert_agg_l2_tp3</title>
<path fill="none" stroke="black" d="M10754.77,-1593.37C10772.79,-1583.82 10794.35,-1573.78 10815,-1567.62 10978.12,-1518.95 11169.72,-1497.42 11314.39,-1487.94"/>
<polygon fill="black" stroke="black" points="11314.97,-1491.41 11324.72,-1487.28 11314.52,-1484.42 11314.97,-1491.41"/>
</g>
<!-- expert33_l2_tp3&#45;&gt;expert_agg_l2_tp3 -->
<g id="edge557" class="edge">
<title>expert33_l2_tp3&#45;&gt;expert_agg_l2_tp3</title>
<path fill="none" stroke="black" d="M10961.42,-1593.59C10979.36,-1584.19 11000.69,-1574.2 11021,-1567.62 11119.93,-1535.54 11233.58,-1514.74 11328.91,-1501.56"/>
<polygon fill="black" stroke="black" points="11329.53,-1505 11338.96,-1500.18 11328.58,-1498.07 11329.53,-1505"/>
</g>
<!-- expert34_l2_tp3&#45;&gt;expert_agg_l2_tp3 -->
<g id="edge559" class="edge">
<title>expert34_l2_tp3&#45;&gt;expert_agg_l2_tp3</title>
<path fill="none" stroke="black" d="M11170.1,-1593.52C11187.59,-1584.6 11207.91,-1574.96 11227,-1567.62 11267.42,-1552.08 11311.76,-1537.95 11353.93,-1525.82"/>
<polygon fill="black" stroke="black" points="11355.09,-1529.13 11363.74,-1523.02 11353.17,-1522.4 11355.09,-1529.13"/>
</g>
<!-- expert35_l2_tp3&#45;&gt;expert_agg_l2_tp3 -->
<g id="edge561" class="edge">
<title>expert35_l2_tp3&#45;&gt;expert_agg_l2_tp3</title>
<path fill="none" stroke="black" d="M11367.78,-1593.31C11391.15,-1577.65 11422.12,-1556.91 11451.11,-1537.49"/>
<polygon fill="black" stroke="black" points="11453.27,-1540.25 11459.63,-1531.78 11449.37,-1534.44 11453.27,-1540.25"/>
</g>
<!-- expert36_l2_tp3&#45;&gt;expert_agg_l2_tp3 -->
<g id="edge563" class="edge">
<title>expert36_l2_tp3&#45;&gt;expert_agg_l2_tp3</title>
<path fill="none" stroke="black" d="M11536,-1593.31C11536,-1578.86 11536,-1560.08 11536,-1542.01"/>
<polygon fill="black" stroke="black" points="11539.5,-1541.78 11536,-1531.78 11532.5,-1541.78 11539.5,-1541.78"/>
</g>
<!-- expert37_l2_tp3&#45;&gt;expert_agg_l2_tp3 -->
<g id="edge565" class="edge">
<title>expert37_l2_tp3&#45;&gt;expert_agg_l2_tp3</title>
<path fill="none" stroke="black" d="M11704.22,-1593.31C11680.85,-1577.65 11649.88,-1556.91 11620.89,-1537.49"/>
<polygon fill="black" stroke="black" points="11622.63,-1534.44 11612.37,-1531.78 11618.73,-1540.25 11622.63,-1534.44"/>
</g>
<!-- expert38_l2_tp3&#45;&gt;expert_agg_l2_tp3 -->
<g id="edge567" class="edge">
<title>expert38_l2_tp3&#45;&gt;expert_agg_l2_tp3</title>
<path fill="none" stroke="black" d="M11901.9,-1593.52C11884.41,-1584.6 11864.09,-1574.96 11845,-1567.62 11813.99,-1555.69 11780.66,-1544.6 11747.79,-1534.61"/>
<polygon fill="black" stroke="black" points="11748.65,-1531.21 11738.06,-1531.68 11746.63,-1537.92 11748.65,-1531.21"/>
</g>
<!-- expert39_l2_tp3&#45;&gt;expert_agg_l2_tp3 -->
<g id="edge569" class="edge">
<title>expert39_l2_tp3&#45;&gt;expert_agg_l2_tp3</title>
<path fill="none" stroke="black" d="M12110.58,-1593.59C12092.64,-1584.19 12071.31,-1574.2 12051,-1567.62 11969.77,-1541.28 11878.61,-1522.55 11795.83,-1509.39"/>
<polygon fill="black" stroke="black" points="11796.19,-1505.9 11785.77,-1507.81 11795.11,-1512.82 11796.19,-1505.9"/>
</g>
<!-- expert_agg_l2_tp3&#45;&gt;res_add2_l2_tp3 -->
<g id="edge570" class="edge">
<title>expert_agg_l2_tp3&#45;&gt;res_add2_l2_tp3</title>
<path fill="none" stroke="black" d="M11547.86,-1427.53C11549.89,-1418.77 11551.96,-1409.85 11553.87,-1401.63"/>
<polygon fill="black" stroke="black" points="11557.33,-1402.19 11556.19,-1391.66 11550.52,-1400.61 11557.33,-1402.19"/>
</g>
<!-- norm2_l2_tp3 -->
<g id="node382" class="node">
<title>norm2_l2_tp3</title>
<polygon fill="lightgreen" stroke="black" points="11695,-1303.62 11429,-1303.62 11429,-1251.62 11695,-1251.62 11695,-1303.62"/>
<text text-anchor="middle" x="11562" y="-1291.62" font-family="Arial" font-size="10.00">Layer Norm 2 TP3</text>
<text text-anchor="middle" x="11562" y="-1280.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11562" y="-1269.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11562" y="-1258.62" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- res_add2_l2_tp3&#45;&gt;norm2_l2_tp3 -->
<g id="edge572" class="edge">
<title>res_add2_l2_tp3&#45;&gt;norm2_l2_tp3</title>
<path fill="none" stroke="black" d="M11562,-1339.28C11562,-1331.32 11562,-1322.38 11562,-1313.86"/>
<polygon fill="black" stroke="black" points="11565.5,-1313.77 11562,-1303.77 11558.5,-1313.77 11565.5,-1313.77"/>
</g>
<!-- input_split_l3_tp3 -->
<g id="node517" class="node">
<title>input_split_l3_tp3</title>
<ellipse fill="lightgray" stroke="black" cx="11562" cy="-1167.85" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="11562" y="-1181.85" font-family="Arial" font-size="10.00">Input Split TP3</text>
<text text-anchor="middle" x="11562" y="-1170.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11562" y="-1159.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="11562" y="-1148.85" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm2_l2_tp3&#45;&gt;input_split_l3_tp3 -->
<g id="edge768" class="edge">
<title>norm2_l2_tp3&#45;&gt;input_split_l3_tp3</title>
<path fill="none" stroke="black" d="M11562,-1251.35C11562,-1240.56 11562,-1227.61 11562,-1215.21"/>
<polygon fill="black" stroke="black" points="11565.5,-1214.98 11562,-1204.98 11558.5,-1214.98 11565.5,-1214.98"/>
</g>
<!-- mha_qkv_l2_tp4 -->
<g id="node384" class="node">
<title>mha_qkv_l2_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9577.5,-2221.16 9286.5,-2221.16 9286.5,-2169.16 9577.5,-2169.16 9577.5,-2221.16"/>
<text text-anchor="middle" x="9432" y="-2209.16" font-family="Arial" font-size="10.00">MHA QKV TP4</text>
<text text-anchor="middle" x="9432" y="-2198.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9432" y="-2187.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9432" y="-2176.16" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- input_split_l2_tp4&#45;&gt;mha_qkv_l2_tp4 -->
<g id="edge573" class="edge">
<title>input_split_l2_tp4&#45;&gt;mha_qkv_l2_tp4</title>
<path fill="none" stroke="black" d="M9542.06,-2258.81C9523.42,-2248.19 9503,-2236.57 9484.87,-2226.25"/>
<polygon fill="black" stroke="black" points="9486.59,-2223.21 9476.17,-2221.3 9483.13,-2229.29 9486.59,-2223.21"/>
</g>
<!-- res_add_l2_tp4 -->
<g id="node388" class="node">
<title>res_add_l2_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9534,-1847.62 9256,-1847.62 9256,-1795.62 9534,-1795.62 9534,-1847.62"/>
<text text-anchor="middle" x="9395" y="-1835.62" font-family="Arial" font-size="10.00">Residual Add TP4</text>
<text text-anchor="middle" x="9395" y="-1824.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="9395" y="-1813.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9395" y="-1802.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- input_split_l2_tp4&#45;&gt;res_add_l2_tp4 -->
<g id="edge577" class="edge">
<title>input_split_l2_tp4&#45;&gt;res_add_l2_tp4</title>
<path fill="none" stroke="black" d="M9602,-2256.81C9602,-2219.57 9602,-2159.8 9602,-2108.16 9602,-2108.16 9602,-2108.16 9602,-2018.16 9602,-1958.2 9629.34,-1930.53 9592,-1883.62 9579.16,-1867.49 9562.13,-1855.53 9543.45,-1846.68"/>
<polygon fill="black" stroke="black" points="9544.71,-1843.41 9534.15,-1842.58 9541.89,-1849.82 9544.71,-1843.41"/>
</g>
<!-- mha_attn_l2_tp4 -->
<g id="node385" class="node">
<title>mha_attn_l2_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9572.5,-2133.16 9281.5,-2133.16 9281.5,-2081.16 9572.5,-2081.16 9572.5,-2133.16"/>
<text text-anchor="middle" x="9427" y="-2121.16" font-family="Arial" font-size="10.00">MHA Attention TP4</text>
<text text-anchor="middle" x="9427" y="-2110.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9427" y="-2099.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9427" y="-2088.16" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- mha_qkv_l2_tp4&#45;&gt;mha_attn_l2_tp4 -->
<g id="edge574" class="edge">
<title>mha_qkv_l2_tp4&#45;&gt;mha_attn_l2_tp4</title>
<path fill="none" stroke="black" d="M9430.53,-2168.82C9430.06,-2160.86 9429.54,-2151.92 9429.05,-2143.4"/>
<polygon fill="black" stroke="black" points="9432.54,-2143.09 9428.46,-2133.31 9425.55,-2143.5 9432.54,-2143.09"/>
</g>
<!-- mha_out_l2_tp4 -->
<g id="node386" class="node">
<title>mha_out_l2_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9548,-2045.16 9264,-2045.16 9264,-1993.16 9548,-1993.16 9548,-2045.16"/>
<text text-anchor="middle" x="9406" y="-2033.16" font-family="Arial" font-size="10.00">MHA Output TP4</text>
<text text-anchor="middle" x="9406" y="-2022.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9406" y="-2011.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9406" y="-2000.16" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- mha_attn_l2_tp4&#45;&gt;mha_out_l2_tp4 -->
<g id="edge575" class="edge">
<title>mha_attn_l2_tp4&#45;&gt;mha_out_l2_tp4</title>
<path fill="none" stroke="black" d="M9420.81,-2080.82C9418.85,-2072.77 9416.64,-2063.72 9414.54,-2055.12"/>
<polygon fill="black" stroke="black" points="9417.92,-2054.2 9412.14,-2045.31 9411.12,-2055.86 9417.92,-2054.2"/>
</g>
<!-- attn_allreduce_l2_tp4 -->
<g id="node387" class="node">
<title>attn_allreduce_l2_tp4</title>
<ellipse fill="lightgray" stroke="black" cx="9395" cy="-1920.39" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9395" y="-1934.39" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP4</text>
<text text-anchor="middle" x="9395" y="-1923.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9395" y="-1912.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9395" y="-1901.39" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- mha_out_l2_tp4&#45;&gt;attn_allreduce_l2_tp4 -->
<g id="edge576" class="edge">
<title>mha_out_l2_tp4&#45;&gt;attn_allreduce_l2_tp4</title>
<path fill="none" stroke="black" d="M9403.14,-1992.98C9402.25,-1985.18 9401.24,-1976.31 9400.25,-1967.54"/>
<polygon fill="black" stroke="black" points="9403.7,-1966.9 9399.09,-1957.36 9396.74,-1967.69 9403.7,-1966.9"/>
</g>
<!-- attn_allreduce_l2_tp4&#45;&gt;res_add_l2_tp4 -->
<g id="edge578" class="edge">
<title>attn_allreduce_l2_tp4&#45;&gt;res_add_l2_tp4</title>
<path fill="none" stroke="black" d="M9395,-1883.35C9395,-1875.04 9395,-1866.21 9395,-1857.93"/>
<polygon fill="black" stroke="black" points="9398.5,-1857.81 9395,-1847.81 9391.5,-1857.81 9398.5,-1857.81"/>
</g>
<!-- norm_l2_tp4 -->
<g id="node389" class="node">
<title>norm_l2_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9397,-1759.62 9131,-1759.62 9131,-1707.62 9397,-1707.62 9397,-1759.62"/>
<text text-anchor="middle" x="9264" y="-1747.62" font-family="Arial" font-size="10.00">Layer Norm TP4</text>
<text text-anchor="middle" x="9264" y="-1736.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9264" y="-1725.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9264" y="-1714.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- res_add_l2_tp4&#45;&gt;norm_l2_tp4 -->
<g id="edge579" class="edge">
<title>res_add_l2_tp4&#45;&gt;norm_l2_tp4</title>
<path fill="none" stroke="black" d="M9356.76,-1795.51C9342.49,-1786.14 9326.12,-1775.4 9311.15,-1765.57"/>
<polygon fill="black" stroke="black" points="9312.8,-1762.47 9302.52,-1759.9 9308.96,-1768.32 9312.8,-1762.47"/>
</g>
<!-- gate_l2_tp4 -->
<g id="node390" class="node">
<title>gate_l2_tp4</title>
<polygon fill="lightyellow" stroke="black" points="8328.3,-1671.62 7861.72,-1671.62 7741.7,-1567.62 8208.28,-1567.62 8328.3,-1671.62"/>
<text text-anchor="middle" x="8035" y="-1633.62" font-family="Arial" font-size="10.00">Gate Network TP4</text>
<text text-anchor="middle" x="8035" y="-1622.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8035" y="-1611.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="8035" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l2_tp4&#45;&gt;gate_l2_tp4 -->
<g id="edge580" class="edge">
<title>norm_l2_tp4&#45;&gt;gate_l2_tp4</title>
<path fill="none" stroke="black" d="M9130.83,-1728.11C8950.42,-1721.02 8618.54,-1704.57 8337,-1671.62 8336.9,-1671.61 8336.79,-1671.59 8336.69,-1671.58"/>
<polygon fill="black" stroke="black" points="8337.39,-1668.14 8327.04,-1670.42 8336.56,-1675.09 8337.39,-1668.14"/>
</g>
<!-- expert40_l2_tp4 -->
<g id="node391" class="node">
<title>expert40_l2_tp4</title>
<polygon fill="lightcoral" stroke="black" points="8534,-1645.62 8346,-1645.62 8346,-1593.62 8534,-1593.62 8534,-1645.62"/>
<text text-anchor="middle" x="8440" y="-1633.62" font-family="Arial" font-size="10.00">Expert 40</text>
<text text-anchor="middle" x="8440" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8440" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8440" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l2_tp4&#45;&gt;expert40_l2_tp4 -->
<g id="edge581" class="edge">
<title>norm_l2_tp4&#45;&gt;expert40_l2_tp4</title>
<path fill="none" stroke="black" d="M9130.99,-1727.31C8953.76,-1719.22 8650.08,-1701.49 8543,-1671.62 8525.33,-1666.69 8507.06,-1658.72 8490.91,-1650.53"/>
<polygon fill="black" stroke="black" points="8492.15,-1647.23 8481.66,-1645.71 8488.91,-1653.43 8492.15,-1647.23"/>
</g>
<!-- expert41_l2_tp4 -->
<g id="node392" class="node">
<title>expert41_l2_tp4</title>
<polygon fill="lightcoral" stroke="black" points="8740,-1645.62 8552,-1645.62 8552,-1593.62 8740,-1593.62 8740,-1645.62"/>
<text text-anchor="middle" x="8646" y="-1633.62" font-family="Arial" font-size="10.00">Expert 41</text>
<text text-anchor="middle" x="8646" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8646" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8646" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l2_tp4&#45;&gt;expert41_l2_tp4 -->
<g id="edge583" class="edge">
<title>norm_l2_tp4&#45;&gt;expert41_l2_tp4</title>
<path fill="none" stroke="black" d="M9130.79,-1729.28C9025.31,-1723.68 8875.22,-1709.12 8749,-1671.62 8731.57,-1666.44 8713.5,-1658.49 8697.45,-1650.39"/>
<polygon fill="black" stroke="black" points="8698.75,-1647.12 8688.26,-1645.63 8695.53,-1653.33 8698.75,-1647.12"/>
</g>
<!-- expert42_l2_tp4 -->
<g id="node393" class="node">
<title>expert42_l2_tp4</title>
<polygon fill="lightcoral" stroke="black" points="8946,-1645.62 8758,-1645.62 8758,-1593.62 8946,-1593.62 8946,-1645.62"/>
<text text-anchor="middle" x="8852" y="-1633.62" font-family="Arial" font-size="10.00">Expert 42</text>
<text text-anchor="middle" x="8852" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8852" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8852" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l2_tp4&#45;&gt;expert42_l2_tp4 -->
<g id="edge585" class="edge">
<title>norm_l2_tp4&#45;&gt;expert42_l2_tp4</title>
<path fill="none" stroke="black" d="M9130.8,-1714.27C9075.54,-1704.62 9011.31,-1690.74 8955,-1671.62 8938.26,-1665.93 8920.77,-1658.07 8905.05,-1650.23"/>
<polygon fill="black" stroke="black" points="8906.52,-1647.05 8896.02,-1645.62 8903.34,-1653.28 8906.52,-1647.05"/>
</g>
<!-- expert43_l2_tp4 -->
<g id="node394" class="node">
<title>expert43_l2_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9152,-1645.62 8964,-1645.62 8964,-1593.62 9152,-1593.62 9152,-1645.62"/>
<text text-anchor="middle" x="9058" y="-1633.62" font-family="Arial" font-size="10.00">Expert 43</text>
<text text-anchor="middle" x="9058" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9058" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9058" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l2_tp4&#45;&gt;expert43_l2_tp4 -->
<g id="edge587" class="edge">
<title>norm_l2_tp4&#45;&gt;expert43_l2_tp4</title>
<path fill="none" stroke="black" d="M9217.77,-1707.48C9186.76,-1690.62 9145.76,-1668.33 9113.06,-1650.55"/>
<polygon fill="black" stroke="black" points="9114.53,-1647.37 9104.08,-1645.67 9111.19,-1653.52 9114.53,-1647.37"/>
</g>
<!-- expert44_l2_tp4 -->
<g id="node395" class="node">
<title>expert44_l2_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9358,-1645.62 9170,-1645.62 9170,-1593.62 9358,-1593.62 9358,-1645.62"/>
<text text-anchor="middle" x="9264" y="-1633.62" font-family="Arial" font-size="10.00">Expert 44</text>
<text text-anchor="middle" x="9264" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9264" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9264" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l2_tp4&#45;&gt;expert44_l2_tp4 -->
<g id="edge589" class="edge">
<title>norm_l2_tp4&#45;&gt;expert44_l2_tp4</title>
<path fill="none" stroke="black" d="M9264,-1707.48C9264,-1692.21 9264,-1672.48 9264,-1655.68"/>
<polygon fill="black" stroke="black" points="9267.5,-1655.67 9264,-1645.67 9260.5,-1655.67 9267.5,-1655.67"/>
</g>
<!-- expert45_l2_tp4 -->
<g id="node396" class="node">
<title>expert45_l2_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9564,-1645.62 9376,-1645.62 9376,-1593.62 9564,-1593.62 9564,-1645.62"/>
<text text-anchor="middle" x="9470" y="-1633.62" font-family="Arial" font-size="10.00">Expert 45</text>
<text text-anchor="middle" x="9470" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9470" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9470" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l2_tp4&#45;&gt;expert45_l2_tp4 -->
<g id="edge591" class="edge">
<title>norm_l2_tp4&#45;&gt;expert45_l2_tp4</title>
<path fill="none" stroke="black" d="M9310.23,-1707.48C9341.24,-1690.62 9382.24,-1668.33 9414.94,-1650.55"/>
<polygon fill="black" stroke="black" points="9416.81,-1653.52 9423.92,-1645.67 9413.47,-1647.37 9416.81,-1653.52"/>
</g>
<!-- expert46_l2_tp4 -->
<g id="node397" class="node">
<title>expert46_l2_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9770,-1645.62 9582,-1645.62 9582,-1593.62 9770,-1593.62 9770,-1645.62"/>
<text text-anchor="middle" x="9676" y="-1633.62" font-family="Arial" font-size="10.00">Expert 46</text>
<text text-anchor="middle" x="9676" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9676" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9676" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l2_tp4&#45;&gt;expert46_l2_tp4 -->
<g id="edge593" class="edge">
<title>norm_l2_tp4&#45;&gt;expert46_l2_tp4</title>
<path fill="none" stroke="black" d="M9397.2,-1714.27C9452.46,-1704.62 9516.69,-1690.74 9573,-1671.62 9589.74,-1665.93 9607.23,-1658.07 9622.95,-1650.23"/>
<polygon fill="black" stroke="black" points="9624.66,-1653.28 9631.98,-1645.62 9621.48,-1647.05 9624.66,-1653.28"/>
</g>
<!-- expert47_l2_tp4 -->
<g id="node398" class="node">
<title>expert47_l2_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9976,-1645.62 9788,-1645.62 9788,-1593.62 9976,-1593.62 9976,-1645.62"/>
<text text-anchor="middle" x="9882" y="-1633.62" font-family="Arial" font-size="10.00">Expert 47</text>
<text text-anchor="middle" x="9882" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9882" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9882" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l2_tp4&#45;&gt;expert47_l2_tp4 -->
<g id="edge595" class="edge">
<title>norm_l2_tp4&#45;&gt;expert47_l2_tp4</title>
<path fill="none" stroke="black" d="M9397.21,-1729.28C9502.69,-1723.68 9652.78,-1709.12 9779,-1671.62 9796.43,-1666.44 9814.5,-1658.49 9830.55,-1650.39"/>
<polygon fill="black" stroke="black" points="9832.47,-1653.33 9839.74,-1645.63 9829.25,-1647.12 9832.47,-1653.33"/>
</g>
<!-- res_add2_l2_tp4 -->
<g id="node400" class="node">
<title>res_add2_l2_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9455,-1391.62 9177,-1391.62 9177,-1339.62 9455,-1339.62 9455,-1391.62"/>
<text text-anchor="middle" x="9316" y="-1379.62" font-family="Arial" font-size="10.00">Residual Add 2 TP4</text>
<text text-anchor="middle" x="9316" y="-1368.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="9316" y="-1357.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9316" y="-1346.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l2_tp4&#45;&gt;res_add2_l2_tp4 -->
<g id="edge598" class="edge">
<title>norm_l2_tp4&#45;&gt;res_add2_l2_tp4</title>
<path fill="none" stroke="black" d="M9397.36,-1730.88C9594.87,-1726.9 9946.14,-1713.91 9985,-1671.62 10000.64,-1654.6 9998.62,-1586.29 9985,-1567.62 9865.09,-1403.17 9744.41,-1484.52 9549,-1427.62 9509.12,-1416 9465.11,-1404.22 9426.18,-1394.14"/>
<polygon fill="black" stroke="black" points="9426.95,-1390.73 9416.39,-1391.62 9425.2,-1397.51 9426.95,-1390.73"/>
</g>
<!-- expert_agg_l2_tp4 -->
<g id="node399" class="node">
<title>expert_agg_l2_tp4</title>
<polygon fill="lightpink" stroke="black" points="9539.55,-1531.62 9101.21,-1531.62 8988.45,-1427.62 9426.79,-1427.62 9539.55,-1531.62"/>
<text text-anchor="middle" x="9264" y="-1493.62" font-family="Arial" font-size="10.00">Expert Aggregation TP4</text>
<text text-anchor="middle" x="9264" y="-1482.62" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="9264" y="-1471.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9264" y="-1460.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- expert40_l2_tp4&#45;&gt;expert_agg_l2_tp4 -->
<g id="edge582" class="edge">
<title>expert40_l2_tp4&#45;&gt;expert_agg_l2_tp4</title>
<path fill="none" stroke="black" d="M8482.77,-1593.37C8500.79,-1583.82 8522.35,-1573.78 8543,-1567.62 8706.12,-1518.95 8897.72,-1497.42 9042.39,-1487.94"/>
<polygon fill="black" stroke="black" points="9042.97,-1491.41 9052.72,-1487.28 9042.52,-1484.42 9042.97,-1491.41"/>
</g>
<!-- expert41_l2_tp4&#45;&gt;expert_agg_l2_tp4 -->
<g id="edge584" class="edge">
<title>expert41_l2_tp4&#45;&gt;expert_agg_l2_tp4</title>
<path fill="none" stroke="black" d="M8689.42,-1593.59C8707.36,-1584.19 8728.69,-1574.2 8749,-1567.62 8847.93,-1535.54 8961.58,-1514.74 9056.91,-1501.56"/>
<polygon fill="black" stroke="black" points="9057.53,-1505 9066.96,-1500.18 9056.58,-1498.07 9057.53,-1505"/>
</g>
<!-- expert42_l2_tp4&#45;&gt;expert_agg_l2_tp4 -->
<g id="edge586" class="edge">
<title>expert42_l2_tp4&#45;&gt;expert_agg_l2_tp4</title>
<path fill="none" stroke="black" d="M8898.1,-1593.52C8915.59,-1584.6 8935.91,-1574.96 8955,-1567.62 8995.42,-1552.08 9039.76,-1537.95 9081.93,-1525.82"/>
<polygon fill="black" stroke="black" points="9083.09,-1529.13 9091.74,-1523.02 9081.17,-1522.4 9083.09,-1529.13"/>
</g>
<!-- expert43_l2_tp4&#45;&gt;expert_agg_l2_tp4 -->
<g id="edge588" class="edge">
<title>expert43_l2_tp4&#45;&gt;expert_agg_l2_tp4</title>
<path fill="none" stroke="black" d="M9095.78,-1593.31C9119.15,-1577.65 9150.12,-1556.91 9179.11,-1537.49"/>
<polygon fill="black" stroke="black" points="9181.27,-1540.25 9187.63,-1531.78 9177.37,-1534.44 9181.27,-1540.25"/>
</g>
<!-- expert44_l2_tp4&#45;&gt;expert_agg_l2_tp4 -->
<g id="edge590" class="edge">
<title>expert44_l2_tp4&#45;&gt;expert_agg_l2_tp4</title>
<path fill="none" stroke="black" d="M9264,-1593.31C9264,-1578.86 9264,-1560.08 9264,-1542.01"/>
<polygon fill="black" stroke="black" points="9267.5,-1541.78 9264,-1531.78 9260.5,-1541.78 9267.5,-1541.78"/>
</g>
<!-- expert45_l2_tp4&#45;&gt;expert_agg_l2_tp4 -->
<g id="edge592" class="edge">
<title>expert45_l2_tp4&#45;&gt;expert_agg_l2_tp4</title>
<path fill="none" stroke="black" d="M9432.22,-1593.31C9408.85,-1577.65 9377.88,-1556.91 9348.89,-1537.49"/>
<polygon fill="black" stroke="black" points="9350.63,-1534.44 9340.37,-1531.78 9346.73,-1540.25 9350.63,-1534.44"/>
</g>
<!-- expert46_l2_tp4&#45;&gt;expert_agg_l2_tp4 -->
<g id="edge594" class="edge">
<title>expert46_l2_tp4&#45;&gt;expert_agg_l2_tp4</title>
<path fill="none" stroke="black" d="M9629.9,-1593.52C9612.41,-1584.6 9592.09,-1574.96 9573,-1567.62 9541.99,-1555.69 9508.66,-1544.6 9475.79,-1534.61"/>
<polygon fill="black" stroke="black" points="9476.65,-1531.21 9466.06,-1531.68 9474.63,-1537.92 9476.65,-1531.21"/>
</g>
<!-- expert47_l2_tp4&#45;&gt;expert_agg_l2_tp4 -->
<g id="edge596" class="edge">
<title>expert47_l2_tp4&#45;&gt;expert_agg_l2_tp4</title>
<path fill="none" stroke="black" d="M9838.58,-1593.59C9820.64,-1584.19 9799.31,-1574.2 9779,-1567.62 9697.77,-1541.28 9606.61,-1522.55 9523.83,-1509.39"/>
<polygon fill="black" stroke="black" points="9524.19,-1505.9 9513.77,-1507.81 9523.11,-1512.82 9524.19,-1505.9"/>
</g>
<!-- expert_agg_l2_tp4&#45;&gt;res_add2_l2_tp4 -->
<g id="edge597" class="edge">
<title>expert_agg_l2_tp4&#45;&gt;res_add2_l2_tp4</title>
<path fill="none" stroke="black" d="M9287.72,-1427.53C9291.92,-1418.48 9296.21,-1409.25 9300.13,-1400.81"/>
<polygon fill="black" stroke="black" points="9303.34,-1402.2 9304.37,-1391.66 9296.99,-1399.26 9303.34,-1402.2"/>
</g>
<!-- norm2_l2_tp4 -->
<g id="node401" class="node">
<title>norm2_l2_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9449,-1303.62 9183,-1303.62 9183,-1251.62 9449,-1251.62 9449,-1303.62"/>
<text text-anchor="middle" x="9316" y="-1291.62" font-family="Arial" font-size="10.00">Layer Norm 2 TP4</text>
<text text-anchor="middle" x="9316" y="-1280.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9316" y="-1269.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9316" y="-1258.62" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- res_add2_l2_tp4&#45;&gt;norm2_l2_tp4 -->
<g id="edge599" class="edge">
<title>res_add2_l2_tp4&#45;&gt;norm2_l2_tp4</title>
<path fill="none" stroke="black" d="M9316,-1339.28C9316,-1331.32 9316,-1322.38 9316,-1313.86"/>
<polygon fill="black" stroke="black" points="9319.5,-1313.77 9316,-1303.77 9312.5,-1313.77 9319.5,-1313.77"/>
</g>
<!-- input_split_l3_tp4 -->
<g id="node536" class="node">
<title>input_split_l3_tp4</title>
<ellipse fill="lightgray" stroke="black" cx="9316" cy="-1167.85" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9316" y="-1181.85" font-family="Arial" font-size="10.00">Input Split TP4</text>
<text text-anchor="middle" x="9316" y="-1170.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9316" y="-1159.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9316" y="-1148.85" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm2_l2_tp4&#45;&gt;input_split_l3_tp4 -->
<g id="edge797" class="edge">
<title>norm2_l2_tp4&#45;&gt;input_split_l3_tp4</title>
<path fill="none" stroke="black" d="M9316,-1251.35C9316,-1240.56 9316,-1227.61 9316,-1215.21"/>
<polygon fill="black" stroke="black" points="9319.5,-1214.98 9316,-1204.98 9312.5,-1214.98 9319.5,-1214.98"/>
</g>
<!-- mha_qkv_l2_tp5 -->
<g id="node403" class="node">
<title>mha_qkv_l2_tp5</title>
<polygon fill="lightgreen" stroke="black" points="8462.5,-2221.16 8171.5,-2221.16 8171.5,-2169.16 8462.5,-2169.16 8462.5,-2221.16"/>
<text text-anchor="middle" x="8317" y="-2209.16" font-family="Arial" font-size="10.00">MHA QKV TP5</text>
<text text-anchor="middle" x="8317" y="-2198.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8317" y="-2187.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8317" y="-2176.16" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- input_split_l2_tp5&#45;&gt;mha_qkv_l2_tp5 -->
<g id="edge600" class="edge">
<title>input_split_l2_tp5&#45;&gt;mha_qkv_l2_tp5</title>
<path fill="none" stroke="black" d="M8430.14,-2259.08C8410.94,-2248.4 8389.87,-2236.68 8371.16,-2226.28"/>
<polygon fill="black" stroke="black" points="8372.63,-2223.09 8362.19,-2221.29 8369.23,-2229.21 8372.63,-2223.09"/>
</g>
<!-- res_add_l2_tp5 -->
<g id="node407" class="node">
<title>res_add_l2_tp5</title>
<polygon fill="lightgreen" stroke="black" points="8423,-1847.62 8145,-1847.62 8145,-1795.62 8423,-1795.62 8423,-1847.62"/>
<text text-anchor="middle" x="8284" y="-1835.62" font-family="Arial" font-size="10.00">Residual Add TP5</text>
<text text-anchor="middle" x="8284" y="-1824.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="8284" y="-1813.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8284" y="-1802.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- input_split_l2_tp5&#45;&gt;res_add_l2_tp5 -->
<g id="edge604" class="edge">
<title>input_split_l2_tp5&#45;&gt;res_add_l2_tp5</title>
<path fill="none" stroke="black" d="M8491,-2256.81C8491,-2219.57 8491,-2159.8 8491,-2108.16 8491,-2108.16 8491,-2108.16 8491,-2018.16 8491,-1958.2 8518.34,-1930.53 8481,-1883.62 8468.16,-1867.49 8451.13,-1855.53 8432.45,-1846.68"/>
<polygon fill="black" stroke="black" points="8433.71,-1843.41 8423.15,-1842.58 8430.89,-1849.82 8433.71,-1843.41"/>
</g>
<!-- mha_attn_l2_tp5 -->
<g id="node404" class="node">
<title>mha_attn_l2_tp5</title>
<polygon fill="lightgreen" stroke="black" points="8451.5,-2133.16 8160.5,-2133.16 8160.5,-2081.16 8451.5,-2081.16 8451.5,-2133.16"/>
<text text-anchor="middle" x="8306" y="-2121.16" font-family="Arial" font-size="10.00">MHA Attention TP5</text>
<text text-anchor="middle" x="8306" y="-2110.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8306" y="-2099.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8306" y="-2088.16" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- mha_qkv_l2_tp5&#45;&gt;mha_attn_l2_tp5 -->
<g id="edge601" class="edge">
<title>mha_qkv_l2_tp5&#45;&gt;mha_attn_l2_tp5</title>
<path fill="none" stroke="black" d="M8313.76,-2168.82C8312.74,-2160.86 8311.6,-2151.92 8310.51,-2143.4"/>
<polygon fill="black" stroke="black" points="8313.96,-2142.79 8309.22,-2133.31 8307.01,-2143.68 8313.96,-2142.79"/>
</g>
<!-- mha_out_l2_tp5 -->
<g id="node405" class="node">
<title>mha_out_l2_tp5</title>
<polygon fill="lightgreen" stroke="black" points="8437,-2045.16 8153,-2045.16 8153,-1993.16 8437,-1993.16 8437,-2045.16"/>
<text text-anchor="middle" x="8295" y="-2033.16" font-family="Arial" font-size="10.00">MHA Output TP5</text>
<text text-anchor="middle" x="8295" y="-2022.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="8295" y="-2011.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8295" y="-2000.16" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- mha_attn_l2_tp5&#45;&gt;mha_out_l2_tp5 -->
<g id="edge602" class="edge">
<title>mha_attn_l2_tp5&#45;&gt;mha_out_l2_tp5</title>
<path fill="none" stroke="black" d="M8302.76,-2080.82C8301.74,-2072.86 8300.6,-2063.92 8299.51,-2055.4"/>
<polygon fill="black" stroke="black" points="8302.96,-2054.79 8298.22,-2045.31 8296.01,-2055.68 8302.96,-2054.79"/>
</g>
<!-- attn_allreduce_l2_tp5 -->
<g id="node406" class="node">
<title>attn_allreduce_l2_tp5</title>
<ellipse fill="lightgray" stroke="black" cx="8284" cy="-1920.39" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="8284" y="-1934.39" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP5</text>
<text text-anchor="middle" x="8284" y="-1923.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="8284" y="-1912.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8284" y="-1901.39" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- mha_out_l2_tp5&#45;&gt;attn_allreduce_l2_tp5 -->
<g id="edge603" class="edge">
<title>mha_out_l2_tp5&#45;&gt;attn_allreduce_l2_tp5</title>
<path fill="none" stroke="black" d="M8292.14,-1992.98C8291.25,-1985.18 8290.24,-1976.31 8289.25,-1967.54"/>
<polygon fill="black" stroke="black" points="8292.7,-1966.9 8288.09,-1957.36 8285.74,-1967.69 8292.7,-1966.9"/>
</g>
<!-- attn_allreduce_l2_tp5&#45;&gt;res_add_l2_tp5 -->
<g id="edge605" class="edge">
<title>attn_allreduce_l2_tp5&#45;&gt;res_add_l2_tp5</title>
<path fill="none" stroke="black" d="M8284,-1883.35C8284,-1875.04 8284,-1866.21 8284,-1857.93"/>
<polygon fill="black" stroke="black" points="8287.5,-1857.81 8284,-1847.81 8280.5,-1857.81 8287.5,-1857.81"/>
</g>
<!-- norm_l2_tp5 -->
<g id="node408" class="node">
<title>norm_l2_tp5</title>
<polygon fill="lightgreen" stroke="black" points="7125,-1759.62 6859,-1759.62 6859,-1707.62 7125,-1707.62 7125,-1759.62"/>
<text text-anchor="middle" x="6992" y="-1747.62" font-family="Arial" font-size="10.00">Layer Norm TP5</text>
<text text-anchor="middle" x="6992" y="-1736.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6992" y="-1725.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6992" y="-1714.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- res_add_l2_tp5&#45;&gt;norm_l2_tp5 -->
<g id="edge606" class="edge">
<title>res_add_l2_tp5&#45;&gt;norm_l2_tp5</title>
<path fill="none" stroke="black" d="M8144.81,-1811.35C7897.82,-1794.91 7385.4,-1760.8 7135.42,-1744.16"/>
<polygon fill="black" stroke="black" points="7135.38,-1740.65 7125.17,-1743.48 7134.92,-1747.64 7135.38,-1740.65"/>
</g>
<!-- gate_l2_tp5 -->
<g id="node409" class="node">
<title>gate_l2_tp5</title>
<polygon fill="lightyellow" stroke="black" points="6056.3,-1671.62 5589.72,-1671.62 5469.7,-1567.62 5936.28,-1567.62 6056.3,-1671.62"/>
<text text-anchor="middle" x="5763" y="-1633.62" font-family="Arial" font-size="10.00">Gate Network TP5</text>
<text text-anchor="middle" x="5763" y="-1622.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5763" y="-1611.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="5763" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l2_tp5&#45;&gt;gate_l2_tp5 -->
<g id="edge607" class="edge">
<title>norm_l2_tp5&#45;&gt;gate_l2_tp5</title>
<path fill="none" stroke="black" d="M6858.83,-1728.11C6678.42,-1721.02 6346.54,-1704.57 6065,-1671.62 6064.9,-1671.61 6064.79,-1671.59 6064.69,-1671.58"/>
<polygon fill="black" stroke="black" points="6065.39,-1668.14 6055.04,-1670.42 6064.56,-1675.09 6065.39,-1668.14"/>
</g>
<!-- expert48_l2_tp5 -->
<g id="node410" class="node">
<title>expert48_l2_tp5</title>
<polygon fill="lightcoral" stroke="black" points="6262,-1645.62 6074,-1645.62 6074,-1593.62 6262,-1593.62 6262,-1645.62"/>
<text text-anchor="middle" x="6168" y="-1633.62" font-family="Arial" font-size="10.00">Expert 48</text>
<text text-anchor="middle" x="6168" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6168" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6168" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l2_tp5&#45;&gt;expert48_l2_tp5 -->
<g id="edge608" class="edge">
<title>norm_l2_tp5&#45;&gt;expert48_l2_tp5</title>
<path fill="none" stroke="black" d="M6858.99,-1727.31C6681.76,-1719.22 6378.08,-1701.49 6271,-1671.62 6253.33,-1666.69 6235.06,-1658.72 6218.91,-1650.53"/>
<polygon fill="black" stroke="black" points="6220.15,-1647.23 6209.66,-1645.71 6216.91,-1653.43 6220.15,-1647.23"/>
</g>
<!-- expert49_l2_tp5 -->
<g id="node411" class="node">
<title>expert49_l2_tp5</title>
<polygon fill="lightcoral" stroke="black" points="6468,-1645.62 6280,-1645.62 6280,-1593.62 6468,-1593.62 6468,-1645.62"/>
<text text-anchor="middle" x="6374" y="-1633.62" font-family="Arial" font-size="10.00">Expert 49</text>
<text text-anchor="middle" x="6374" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6374" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6374" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l2_tp5&#45;&gt;expert49_l2_tp5 -->
<g id="edge610" class="edge">
<title>norm_l2_tp5&#45;&gt;expert49_l2_tp5</title>
<path fill="none" stroke="black" d="M6858.79,-1729.28C6753.31,-1723.68 6603.22,-1709.12 6477,-1671.62 6459.57,-1666.44 6441.5,-1658.49 6425.45,-1650.39"/>
<polygon fill="black" stroke="black" points="6426.75,-1647.12 6416.26,-1645.63 6423.53,-1653.33 6426.75,-1647.12"/>
</g>
<!-- expert50_l2_tp5 -->
<g id="node412" class="node">
<title>expert50_l2_tp5</title>
<polygon fill="lightcoral" stroke="black" points="6674,-1645.62 6486,-1645.62 6486,-1593.62 6674,-1593.62 6674,-1645.62"/>
<text text-anchor="middle" x="6580" y="-1633.62" font-family="Arial" font-size="10.00">Expert 50</text>
<text text-anchor="middle" x="6580" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6580" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6580" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l2_tp5&#45;&gt;expert50_l2_tp5 -->
<g id="edge612" class="edge">
<title>norm_l2_tp5&#45;&gt;expert50_l2_tp5</title>
<path fill="none" stroke="black" d="M6858.8,-1714.27C6803.54,-1704.62 6739.31,-1690.74 6683,-1671.62 6666.26,-1665.93 6648.77,-1658.07 6633.05,-1650.23"/>
<polygon fill="black" stroke="black" points="6634.52,-1647.05 6624.02,-1645.62 6631.34,-1653.28 6634.52,-1647.05"/>
</g>
<!-- expert51_l2_tp5 -->
<g id="node413" class="node">
<title>expert51_l2_tp5</title>
<polygon fill="lightcoral" stroke="black" points="6880,-1645.62 6692,-1645.62 6692,-1593.62 6880,-1593.62 6880,-1645.62"/>
<text text-anchor="middle" x="6786" y="-1633.62" font-family="Arial" font-size="10.00">Expert 51</text>
<text text-anchor="middle" x="6786" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6786" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6786" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l2_tp5&#45;&gt;expert51_l2_tp5 -->
<g id="edge614" class="edge">
<title>norm_l2_tp5&#45;&gt;expert51_l2_tp5</title>
<path fill="none" stroke="black" d="M6945.77,-1707.48C6914.76,-1690.62 6873.76,-1668.33 6841.06,-1650.55"/>
<polygon fill="black" stroke="black" points="6842.53,-1647.37 6832.08,-1645.67 6839.19,-1653.52 6842.53,-1647.37"/>
</g>
<!-- expert52_l2_tp5 -->
<g id="node414" class="node">
<title>expert52_l2_tp5</title>
<polygon fill="lightcoral" stroke="black" points="7086,-1645.62 6898,-1645.62 6898,-1593.62 7086,-1593.62 7086,-1645.62"/>
<text text-anchor="middle" x="6992" y="-1633.62" font-family="Arial" font-size="10.00">Expert 52</text>
<text text-anchor="middle" x="6992" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6992" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6992" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l2_tp5&#45;&gt;expert52_l2_tp5 -->
<g id="edge616" class="edge">
<title>norm_l2_tp5&#45;&gt;expert52_l2_tp5</title>
<path fill="none" stroke="black" d="M6992,-1707.48C6992,-1692.21 6992,-1672.48 6992,-1655.68"/>
<polygon fill="black" stroke="black" points="6995.5,-1655.67 6992,-1645.67 6988.5,-1655.67 6995.5,-1655.67"/>
</g>
<!-- expert53_l2_tp5 -->
<g id="node415" class="node">
<title>expert53_l2_tp5</title>
<polygon fill="lightcoral" stroke="black" points="7292,-1645.62 7104,-1645.62 7104,-1593.62 7292,-1593.62 7292,-1645.62"/>
<text text-anchor="middle" x="7198" y="-1633.62" font-family="Arial" font-size="10.00">Expert 53</text>
<text text-anchor="middle" x="7198" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7198" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7198" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l2_tp5&#45;&gt;expert53_l2_tp5 -->
<g id="edge618" class="edge">
<title>norm_l2_tp5&#45;&gt;expert53_l2_tp5</title>
<path fill="none" stroke="black" d="M7038.23,-1707.48C7069.24,-1690.62 7110.24,-1668.33 7142.94,-1650.55"/>
<polygon fill="black" stroke="black" points="7144.81,-1653.52 7151.92,-1645.67 7141.47,-1647.37 7144.81,-1653.52"/>
</g>
<!-- expert54_l2_tp5 -->
<g id="node416" class="node">
<title>expert54_l2_tp5</title>
<polygon fill="lightcoral" stroke="black" points="7498,-1645.62 7310,-1645.62 7310,-1593.62 7498,-1593.62 7498,-1645.62"/>
<text text-anchor="middle" x="7404" y="-1633.62" font-family="Arial" font-size="10.00">Expert 54</text>
<text text-anchor="middle" x="7404" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7404" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7404" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l2_tp5&#45;&gt;expert54_l2_tp5 -->
<g id="edge620" class="edge">
<title>norm_l2_tp5&#45;&gt;expert54_l2_tp5</title>
<path fill="none" stroke="black" d="M7125.2,-1714.27C7180.46,-1704.62 7244.69,-1690.74 7301,-1671.62 7317.74,-1665.93 7335.23,-1658.07 7350.95,-1650.23"/>
<polygon fill="black" stroke="black" points="7352.66,-1653.28 7359.98,-1645.62 7349.48,-1647.05 7352.66,-1653.28"/>
</g>
<!-- expert55_l2_tp5 -->
<g id="node417" class="node">
<title>expert55_l2_tp5</title>
<polygon fill="lightcoral" stroke="black" points="7704,-1645.62 7516,-1645.62 7516,-1593.62 7704,-1593.62 7704,-1645.62"/>
<text text-anchor="middle" x="7610" y="-1633.62" font-family="Arial" font-size="10.00">Expert 55</text>
<text text-anchor="middle" x="7610" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7610" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7610" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l2_tp5&#45;&gt;expert55_l2_tp5 -->
<g id="edge622" class="edge">
<title>norm_l2_tp5&#45;&gt;expert55_l2_tp5</title>
<path fill="none" stroke="black" d="M7125.21,-1729.28C7230.69,-1723.68 7380.78,-1709.12 7507,-1671.62 7524.43,-1666.44 7542.5,-1658.49 7558.55,-1650.39"/>
<polygon fill="black" stroke="black" points="7560.47,-1653.33 7567.74,-1645.63 7557.25,-1647.12 7560.47,-1653.33"/>
</g>
<!-- res_add2_l2_tp5 -->
<g id="node419" class="node">
<title>res_add2_l2_tp5</title>
<polygon fill="lightgreen" stroke="black" points="7157,-1391.62 6879,-1391.62 6879,-1339.62 7157,-1339.62 7157,-1391.62"/>
<text text-anchor="middle" x="7018" y="-1379.62" font-family="Arial" font-size="10.00">Residual Add 2 TP5</text>
<text text-anchor="middle" x="7018" y="-1368.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="7018" y="-1357.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7018" y="-1346.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l2_tp5&#45;&gt;res_add2_l2_tp5 -->
<g id="edge625" class="edge">
<title>norm_l2_tp5&#45;&gt;res_add2_l2_tp5</title>
<path fill="none" stroke="black" d="M7125.36,-1730.88C7322.87,-1726.9 7674.14,-1713.91 7713,-1671.62 7728.64,-1654.6 7726.62,-1586.29 7713,-1567.62 7593.09,-1403.17 7473.09,-1482.1 7277,-1427.62 7233.54,-1415.54 7185.55,-1403.8 7142.81,-1393.9"/>
<polygon fill="black" stroke="black" points="7143.46,-1390.46 7132.93,-1391.62 7141.89,-1397.28 7143.46,-1390.46"/>
</g>
<!-- expert_agg_l2_tp5 -->
<g id="node418" class="node">
<title>expert_agg_l2_tp5</title>
<polygon fill="lightpink" stroke="black" points="7267.55,-1531.62 6829.21,-1531.62 6716.45,-1427.62 7154.79,-1427.62 7267.55,-1531.62"/>
<text text-anchor="middle" x="6992" y="-1493.62" font-family="Arial" font-size="10.00">Expert Aggregation TP5</text>
<text text-anchor="middle" x="6992" y="-1482.62" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="6992" y="-1471.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6992" y="-1460.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- expert48_l2_tp5&#45;&gt;expert_agg_l2_tp5 -->
<g id="edge609" class="edge">
<title>expert48_l2_tp5&#45;&gt;expert_agg_l2_tp5</title>
<path fill="none" stroke="black" d="M6210.77,-1593.37C6228.79,-1583.82 6250.35,-1573.78 6271,-1567.62 6434.12,-1518.95 6625.72,-1497.42 6770.39,-1487.94"/>
<polygon fill="black" stroke="black" points="6770.97,-1491.41 6780.72,-1487.28 6770.52,-1484.42 6770.97,-1491.41"/>
</g>
<!-- expert49_l2_tp5&#45;&gt;expert_agg_l2_tp5 -->
<g id="edge611" class="edge">
<title>expert49_l2_tp5&#45;&gt;expert_agg_l2_tp5</title>
<path fill="none" stroke="black" d="M6417.42,-1593.59C6435.36,-1584.19 6456.69,-1574.2 6477,-1567.62 6575.93,-1535.54 6689.58,-1514.74 6784.91,-1501.56"/>
<polygon fill="black" stroke="black" points="6785.53,-1505 6794.96,-1500.18 6784.58,-1498.07 6785.53,-1505"/>
</g>
<!-- expert50_l2_tp5&#45;&gt;expert_agg_l2_tp5 -->
<g id="edge613" class="edge">
<title>expert50_l2_tp5&#45;&gt;expert_agg_l2_tp5</title>
<path fill="none" stroke="black" d="M6626.1,-1593.52C6643.59,-1584.6 6663.91,-1574.96 6683,-1567.62 6723.42,-1552.08 6767.76,-1537.95 6809.93,-1525.82"/>
<polygon fill="black" stroke="black" points="6811.09,-1529.13 6819.74,-1523.02 6809.17,-1522.4 6811.09,-1529.13"/>
</g>
<!-- expert51_l2_tp5&#45;&gt;expert_agg_l2_tp5 -->
<g id="edge615" class="edge">
<title>expert51_l2_tp5&#45;&gt;expert_agg_l2_tp5</title>
<path fill="none" stroke="black" d="M6823.78,-1593.31C6847.15,-1577.65 6878.12,-1556.91 6907.11,-1537.49"/>
<polygon fill="black" stroke="black" points="6909.27,-1540.25 6915.63,-1531.78 6905.37,-1534.44 6909.27,-1540.25"/>
</g>
<!-- expert52_l2_tp5&#45;&gt;expert_agg_l2_tp5 -->
<g id="edge617" class="edge">
<title>expert52_l2_tp5&#45;&gt;expert_agg_l2_tp5</title>
<path fill="none" stroke="black" d="M6992,-1593.31C6992,-1578.86 6992,-1560.08 6992,-1542.01"/>
<polygon fill="black" stroke="black" points="6995.5,-1541.78 6992,-1531.78 6988.5,-1541.78 6995.5,-1541.78"/>
</g>
<!-- expert53_l2_tp5&#45;&gt;expert_agg_l2_tp5 -->
<g id="edge619" class="edge">
<title>expert53_l2_tp5&#45;&gt;expert_agg_l2_tp5</title>
<path fill="none" stroke="black" d="M7160.22,-1593.31C7136.85,-1577.65 7105.88,-1556.91 7076.89,-1537.49"/>
<polygon fill="black" stroke="black" points="7078.63,-1534.44 7068.37,-1531.78 7074.73,-1540.25 7078.63,-1534.44"/>
</g>
<!-- expert54_l2_tp5&#45;&gt;expert_agg_l2_tp5 -->
<g id="edge621" class="edge">
<title>expert54_l2_tp5&#45;&gt;expert_agg_l2_tp5</title>
<path fill="none" stroke="black" d="M7357.9,-1593.52C7340.41,-1584.6 7320.09,-1574.96 7301,-1567.62 7269.99,-1555.69 7236.66,-1544.6 7203.79,-1534.61"/>
<polygon fill="black" stroke="black" points="7204.65,-1531.21 7194.06,-1531.68 7202.63,-1537.92 7204.65,-1531.21"/>
</g>
<!-- expert55_l2_tp5&#45;&gt;expert_agg_l2_tp5 -->
<g id="edge623" class="edge">
<title>expert55_l2_tp5&#45;&gt;expert_agg_l2_tp5</title>
<path fill="none" stroke="black" d="M7566.58,-1593.59C7548.64,-1584.19 7527.31,-1574.2 7507,-1567.62 7425.77,-1541.28 7334.61,-1522.55 7251.83,-1509.39"/>
<polygon fill="black" stroke="black" points="7252.19,-1505.9 7241.77,-1507.81 7251.11,-1512.82 7252.19,-1505.9"/>
</g>
<!-- expert_agg_l2_tp5&#45;&gt;res_add2_l2_tp5 -->
<g id="edge624" class="edge">
<title>expert_agg_l2_tp5&#45;&gt;res_add2_l2_tp5</title>
<path fill="none" stroke="black" d="M7003.86,-1427.53C7005.89,-1418.77 7007.96,-1409.85 7009.87,-1401.63"/>
<polygon fill="black" stroke="black" points="7013.33,-1402.19 7012.19,-1391.66 7006.52,-1400.61 7013.33,-1402.19"/>
</g>
<!-- norm2_l2_tp5 -->
<g id="node420" class="node">
<title>norm2_l2_tp5</title>
<polygon fill="lightgreen" stroke="black" points="7151,-1303.62 6885,-1303.62 6885,-1251.62 7151,-1251.62 7151,-1303.62"/>
<text text-anchor="middle" x="7018" y="-1291.62" font-family="Arial" font-size="10.00">Layer Norm 2 TP5</text>
<text text-anchor="middle" x="7018" y="-1280.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7018" y="-1269.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7018" y="-1258.62" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- res_add2_l2_tp5&#45;&gt;norm2_l2_tp5 -->
<g id="edge626" class="edge">
<title>res_add2_l2_tp5&#45;&gt;norm2_l2_tp5</title>
<path fill="none" stroke="black" d="M7018,-1339.28C7018,-1331.32 7018,-1322.38 7018,-1313.86"/>
<polygon fill="black" stroke="black" points="7021.5,-1313.77 7018,-1303.77 7014.5,-1313.77 7021.5,-1313.77"/>
</g>
<!-- input_split_l3_tp5 -->
<g id="node555" class="node">
<title>input_split_l3_tp5</title>
<ellipse fill="lightgray" stroke="black" cx="7018" cy="-1167.85" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="7018" y="-1181.85" font-family="Arial" font-size="10.00">Input Split TP5</text>
<text text-anchor="middle" x="7018" y="-1170.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7018" y="-1159.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="7018" y="-1148.85" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm2_l2_tp5&#45;&gt;input_split_l3_tp5 -->
<g id="edge826" class="edge">
<title>norm2_l2_tp5&#45;&gt;input_split_l3_tp5</title>
<path fill="none" stroke="black" d="M7018,-1251.35C7018,-1240.56 7018,-1227.61 7018,-1215.21"/>
<polygon fill="black" stroke="black" points="7021.5,-1214.98 7018,-1204.98 7014.5,-1214.98 7021.5,-1214.98"/>
</g>
<!-- mha_qkv_l2_tp6 -->
<g id="node422" class="node">
<title>mha_qkv_l2_tp6</title>
<polygon fill="lightgreen" stroke="black" points="6655.5,-2221.16 6364.5,-2221.16 6364.5,-2169.16 6655.5,-2169.16 6655.5,-2221.16"/>
<text text-anchor="middle" x="6510" y="-2209.16" font-family="Arial" font-size="10.00">MHA QKV TP6</text>
<text text-anchor="middle" x="6510" y="-2198.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="6510" y="-2187.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="6510" y="-2176.16" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- input_split_l2_tp6&#45;&gt;mha_qkv_l2_tp6 -->
<g id="edge627" class="edge">
<title>input_split_l2_tp6&#45;&gt;mha_qkv_l2_tp6</title>
<path fill="none" stroke="black" d="M6623.14,-2259.08C6603.94,-2248.4 6582.87,-2236.68 6564.16,-2226.28"/>
<polygon fill="black" stroke="black" points="6565.63,-2223.09 6555.19,-2221.29 6562.23,-2229.21 6565.63,-2223.09"/>
</g>
<!-- res_add_l2_tp6 -->
<g id="node426" class="node">
<title>res_add_l2_tp6</title>
<polygon fill="lightgreen" stroke="black" points="6616,-1847.62 6338,-1847.62 6338,-1795.62 6616,-1795.62 6616,-1847.62"/>
<text text-anchor="middle" x="6477" y="-1835.62" font-family="Arial" font-size="10.00">Residual Add TP6</text>
<text text-anchor="middle" x="6477" y="-1824.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="6477" y="-1813.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6477" y="-1802.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- input_split_l2_tp6&#45;&gt;res_add_l2_tp6 -->
<g id="edge631" class="edge">
<title>input_split_l2_tp6&#45;&gt;res_add_l2_tp6</title>
<path fill="none" stroke="black" d="M6684,-2256.81C6684,-2219.57 6684,-2159.8 6684,-2108.16 6684,-2108.16 6684,-2108.16 6684,-2018.16 6684,-1958.2 6711.34,-1930.53 6674,-1883.62 6661.16,-1867.49 6644.13,-1855.53 6625.45,-1846.68"/>
<polygon fill="black" stroke="black" points="6626.71,-1843.41 6616.15,-1842.58 6623.89,-1849.82 6626.71,-1843.41"/>
</g>
<!-- mha_attn_l2_tp6 -->
<g id="node423" class="node">
<title>mha_attn_l2_tp6</title>
<polygon fill="lightgreen" stroke="black" points="6644.5,-2133.16 6353.5,-2133.16 6353.5,-2081.16 6644.5,-2081.16 6644.5,-2133.16"/>
<text text-anchor="middle" x="6499" y="-2121.16" font-family="Arial" font-size="10.00">MHA Attention TP6</text>
<text text-anchor="middle" x="6499" y="-2110.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="6499" y="-2099.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="6499" y="-2088.16" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- mha_qkv_l2_tp6&#45;&gt;mha_attn_l2_tp6 -->
<g id="edge628" class="edge">
<title>mha_qkv_l2_tp6&#45;&gt;mha_attn_l2_tp6</title>
<path fill="none" stroke="black" d="M6506.76,-2168.82C6505.74,-2160.86 6504.6,-2151.92 6503.51,-2143.4"/>
<polygon fill="black" stroke="black" points="6506.96,-2142.79 6502.22,-2133.31 6500.01,-2143.68 6506.96,-2142.79"/>
</g>
<!-- mha_out_l2_tp6 -->
<g id="node424" class="node">
<title>mha_out_l2_tp6</title>
<polygon fill="lightgreen" stroke="black" points="6630,-2045.16 6346,-2045.16 6346,-1993.16 6630,-1993.16 6630,-2045.16"/>
<text text-anchor="middle" x="6488" y="-2033.16" font-family="Arial" font-size="10.00">MHA Output TP6</text>
<text text-anchor="middle" x="6488" y="-2022.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="6488" y="-2011.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="6488" y="-2000.16" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- mha_attn_l2_tp6&#45;&gt;mha_out_l2_tp6 -->
<g id="edge629" class="edge">
<title>mha_attn_l2_tp6&#45;&gt;mha_out_l2_tp6</title>
<path fill="none" stroke="black" d="M6495.76,-2080.82C6494.74,-2072.86 6493.6,-2063.92 6492.51,-2055.4"/>
<polygon fill="black" stroke="black" points="6495.96,-2054.79 6491.22,-2045.31 6489.01,-2055.68 6495.96,-2054.79"/>
</g>
<!-- attn_allreduce_l2_tp6 -->
<g id="node425" class="node">
<title>attn_allreduce_l2_tp6</title>
<ellipse fill="lightgray" stroke="black" cx="6477" cy="-1920.39" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="6477" y="-1934.39" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP6</text>
<text text-anchor="middle" x="6477" y="-1923.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="6477" y="-1912.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6477" y="-1901.39" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- mha_out_l2_tp6&#45;&gt;attn_allreduce_l2_tp6 -->
<g id="edge630" class="edge">
<title>mha_out_l2_tp6&#45;&gt;attn_allreduce_l2_tp6</title>
<path fill="none" stroke="black" d="M6485.14,-1992.98C6484.25,-1985.18 6483.24,-1976.31 6482.25,-1967.54"/>
<polygon fill="black" stroke="black" points="6485.7,-1966.9 6481.09,-1957.36 6478.74,-1967.69 6485.7,-1966.9"/>
</g>
<!-- attn_allreduce_l2_tp6&#45;&gt;res_add_l2_tp6 -->
<g id="edge632" class="edge">
<title>attn_allreduce_l2_tp6&#45;&gt;res_add_l2_tp6</title>
<path fill="none" stroke="black" d="M6477,-1883.35C6477,-1875.04 6477,-1866.21 6477,-1857.93"/>
<polygon fill="black" stroke="black" points="6480.5,-1857.81 6477,-1847.81 6473.5,-1857.81 6480.5,-1857.81"/>
</g>
<!-- norm_l2_tp6 -->
<g id="node427" class="node">
<title>norm_l2_tp6</title>
<polygon fill="lightgreen" stroke="black" points="4853,-1759.62 4587,-1759.62 4587,-1707.62 4853,-1707.62 4853,-1759.62"/>
<text text-anchor="middle" x="4720" y="-1747.62" font-family="Arial" font-size="10.00">Layer Norm TP6</text>
<text text-anchor="middle" x="4720" y="-1736.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4720" y="-1725.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4720" y="-1714.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- res_add_l2_tp6&#45;&gt;norm_l2_tp6 -->
<g id="edge633" class="edge">
<title>res_add_l2_tp6&#45;&gt;norm_l2_tp6</title>
<path fill="none" stroke="black" d="M6337.66,-1813.8C6010.2,-1797.77 5194.38,-1757.84 4863.16,-1741.62"/>
<polygon fill="black" stroke="black" points="4863.18,-1738.12 4853.02,-1741.13 4862.84,-1745.11 4863.18,-1738.12"/>
</g>
<!-- gate_l2_tp6 -->
<g id="node428" class="node">
<title>gate_l2_tp6</title>
<polygon fill="lightyellow" stroke="black" points="3784.3,-1671.62 3317.72,-1671.62 3197.7,-1567.62 3664.28,-1567.62 3784.3,-1671.62"/>
<text text-anchor="middle" x="3491" y="-1633.62" font-family="Arial" font-size="10.00">Gate Network TP6</text>
<text text-anchor="middle" x="3491" y="-1622.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3491" y="-1611.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="3491" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l2_tp6&#45;&gt;gate_l2_tp6 -->
<g id="edge634" class="edge">
<title>norm_l2_tp6&#45;&gt;gate_l2_tp6</title>
<path fill="none" stroke="black" d="M4586.83,-1728.11C4406.42,-1721.02 4074.54,-1704.57 3793,-1671.62 3792.9,-1671.61 3792.79,-1671.59 3792.69,-1671.58"/>
<polygon fill="black" stroke="black" points="3793.39,-1668.14 3783.04,-1670.42 3792.56,-1675.09 3793.39,-1668.14"/>
</g>
<!-- expert56_l2_tp6 -->
<g id="node429" class="node">
<title>expert56_l2_tp6</title>
<polygon fill="lightcoral" stroke="black" points="3990,-1645.62 3802,-1645.62 3802,-1593.62 3990,-1593.62 3990,-1645.62"/>
<text text-anchor="middle" x="3896" y="-1633.62" font-family="Arial" font-size="10.00">Expert 56</text>
<text text-anchor="middle" x="3896" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3896" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3896" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l2_tp6&#45;&gt;expert56_l2_tp6 -->
<g id="edge635" class="edge">
<title>norm_l2_tp6&#45;&gt;expert56_l2_tp6</title>
<path fill="none" stroke="black" d="M4586.99,-1727.31C4409.76,-1719.22 4106.08,-1701.49 3999,-1671.62 3981.33,-1666.69 3963.06,-1658.72 3946.91,-1650.53"/>
<polygon fill="black" stroke="black" points="3948.15,-1647.23 3937.66,-1645.71 3944.91,-1653.43 3948.15,-1647.23"/>
</g>
<!-- expert57_l2_tp6 -->
<g id="node430" class="node">
<title>expert57_l2_tp6</title>
<polygon fill="lightcoral" stroke="black" points="4196,-1645.62 4008,-1645.62 4008,-1593.62 4196,-1593.62 4196,-1645.62"/>
<text text-anchor="middle" x="4102" y="-1633.62" font-family="Arial" font-size="10.00">Expert 57</text>
<text text-anchor="middle" x="4102" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4102" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4102" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l2_tp6&#45;&gt;expert57_l2_tp6 -->
<g id="edge637" class="edge">
<title>norm_l2_tp6&#45;&gt;expert57_l2_tp6</title>
<path fill="none" stroke="black" d="M4586.79,-1729.28C4481.31,-1723.68 4331.22,-1709.12 4205,-1671.62 4187.57,-1666.44 4169.5,-1658.49 4153.45,-1650.39"/>
<polygon fill="black" stroke="black" points="4154.75,-1647.12 4144.26,-1645.63 4151.53,-1653.33 4154.75,-1647.12"/>
</g>
<!-- expert58_l2_tp6 -->
<g id="node431" class="node">
<title>expert58_l2_tp6</title>
<polygon fill="lightcoral" stroke="black" points="4402,-1645.62 4214,-1645.62 4214,-1593.62 4402,-1593.62 4402,-1645.62"/>
<text text-anchor="middle" x="4308" y="-1633.62" font-family="Arial" font-size="10.00">Expert 58</text>
<text text-anchor="middle" x="4308" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4308" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4308" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l2_tp6&#45;&gt;expert58_l2_tp6 -->
<g id="edge639" class="edge">
<title>norm_l2_tp6&#45;&gt;expert58_l2_tp6</title>
<path fill="none" stroke="black" d="M4586.8,-1714.27C4531.54,-1704.62 4467.31,-1690.74 4411,-1671.62 4394.26,-1665.93 4376.77,-1658.07 4361.05,-1650.23"/>
<polygon fill="black" stroke="black" points="4362.52,-1647.05 4352.02,-1645.62 4359.34,-1653.28 4362.52,-1647.05"/>
</g>
<!-- expert59_l2_tp6 -->
<g id="node432" class="node">
<title>expert59_l2_tp6</title>
<polygon fill="lightcoral" stroke="black" points="4608,-1645.62 4420,-1645.62 4420,-1593.62 4608,-1593.62 4608,-1645.62"/>
<text text-anchor="middle" x="4514" y="-1633.62" font-family="Arial" font-size="10.00">Expert 59</text>
<text text-anchor="middle" x="4514" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4514" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4514" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l2_tp6&#45;&gt;expert59_l2_tp6 -->
<g id="edge641" class="edge">
<title>norm_l2_tp6&#45;&gt;expert59_l2_tp6</title>
<path fill="none" stroke="black" d="M4673.77,-1707.48C4642.76,-1690.62 4601.76,-1668.33 4569.06,-1650.55"/>
<polygon fill="black" stroke="black" points="4570.53,-1647.37 4560.08,-1645.67 4567.19,-1653.52 4570.53,-1647.37"/>
</g>
<!-- expert60_l2_tp6 -->
<g id="node433" class="node">
<title>expert60_l2_tp6</title>
<polygon fill="lightcoral" stroke="black" points="4814,-1645.62 4626,-1645.62 4626,-1593.62 4814,-1593.62 4814,-1645.62"/>
<text text-anchor="middle" x="4720" y="-1633.62" font-family="Arial" font-size="10.00">Expert 60</text>
<text text-anchor="middle" x="4720" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4720" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4720" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l2_tp6&#45;&gt;expert60_l2_tp6 -->
<g id="edge643" class="edge">
<title>norm_l2_tp6&#45;&gt;expert60_l2_tp6</title>
<path fill="none" stroke="black" d="M4720,-1707.48C4720,-1692.21 4720,-1672.48 4720,-1655.68"/>
<polygon fill="black" stroke="black" points="4723.5,-1655.67 4720,-1645.67 4716.5,-1655.67 4723.5,-1655.67"/>
</g>
<!-- expert61_l2_tp6 -->
<g id="node434" class="node">
<title>expert61_l2_tp6</title>
<polygon fill="lightcoral" stroke="black" points="5020,-1645.62 4832,-1645.62 4832,-1593.62 5020,-1593.62 5020,-1645.62"/>
<text text-anchor="middle" x="4926" y="-1633.62" font-family="Arial" font-size="10.00">Expert 61</text>
<text text-anchor="middle" x="4926" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4926" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4926" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l2_tp6&#45;&gt;expert61_l2_tp6 -->
<g id="edge645" class="edge">
<title>norm_l2_tp6&#45;&gt;expert61_l2_tp6</title>
<path fill="none" stroke="black" d="M4766.23,-1707.48C4797.24,-1690.62 4838.24,-1668.33 4870.94,-1650.55"/>
<polygon fill="black" stroke="black" points="4872.81,-1653.52 4879.92,-1645.67 4869.47,-1647.37 4872.81,-1653.52"/>
</g>
<!-- expert62_l2_tp6 -->
<g id="node435" class="node">
<title>expert62_l2_tp6</title>
<polygon fill="lightcoral" stroke="black" points="5226,-1645.62 5038,-1645.62 5038,-1593.62 5226,-1593.62 5226,-1645.62"/>
<text text-anchor="middle" x="5132" y="-1633.62" font-family="Arial" font-size="10.00">Expert 62</text>
<text text-anchor="middle" x="5132" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5132" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5132" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l2_tp6&#45;&gt;expert62_l2_tp6 -->
<g id="edge647" class="edge">
<title>norm_l2_tp6&#45;&gt;expert62_l2_tp6</title>
<path fill="none" stroke="black" d="M4853.2,-1714.27C4908.46,-1704.62 4972.69,-1690.74 5029,-1671.62 5045.74,-1665.93 5063.23,-1658.07 5078.95,-1650.23"/>
<polygon fill="black" stroke="black" points="5080.66,-1653.28 5087.98,-1645.62 5077.48,-1647.05 5080.66,-1653.28"/>
</g>
<!-- expert63_l2_tp6 -->
<g id="node436" class="node">
<title>expert63_l2_tp6</title>
<polygon fill="lightcoral" stroke="black" points="5432,-1645.62 5244,-1645.62 5244,-1593.62 5432,-1593.62 5432,-1645.62"/>
<text text-anchor="middle" x="5338" y="-1633.62" font-family="Arial" font-size="10.00">Expert 63</text>
<text text-anchor="middle" x="5338" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5338" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5338" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l2_tp6&#45;&gt;expert63_l2_tp6 -->
<g id="edge649" class="edge">
<title>norm_l2_tp6&#45;&gt;expert63_l2_tp6</title>
<path fill="none" stroke="black" d="M4853.21,-1729.28C4958.69,-1723.68 5108.78,-1709.12 5235,-1671.62 5252.43,-1666.44 5270.5,-1658.49 5286.55,-1650.39"/>
<polygon fill="black" stroke="black" points="5288.47,-1653.33 5295.74,-1645.63 5285.25,-1647.12 5288.47,-1653.33"/>
</g>
<!-- res_add2_l2_tp6 -->
<g id="node438" class="node">
<title>res_add2_l2_tp6</title>
<polygon fill="lightgreen" stroke="black" points="4921,-1391.62 4643,-1391.62 4643,-1339.62 4921,-1339.62 4921,-1391.62"/>
<text text-anchor="middle" x="4782" y="-1379.62" font-family="Arial" font-size="10.00">Residual Add 2 TP6</text>
<text text-anchor="middle" x="4782" y="-1368.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="4782" y="-1357.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4782" y="-1346.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l2_tp6&#45;&gt;res_add2_l2_tp6 -->
<g id="edge652" class="edge">
<title>norm_l2_tp6&#45;&gt;res_add2_l2_tp6</title>
<path fill="none" stroke="black" d="M4853.36,-1730.88C5050.87,-1726.9 5402.14,-1713.91 5441,-1671.62 5456.64,-1654.6 5454.62,-1586.29 5441,-1567.62 5321.09,-1403.17 5200.09,-1485.59 5005,-1427.62 4966.68,-1416.23 4924.42,-1404.47 4887.09,-1394.35"/>
<polygon fill="black" stroke="black" points="4887.77,-1390.91 4877.21,-1391.68 4885.95,-1397.67 4887.77,-1390.91"/>
</g>
<!-- expert_agg_l2_tp6 -->
<g id="node437" class="node">
<title>expert_agg_l2_tp6</title>
<polygon fill="lightpink" stroke="black" points="4995.55,-1531.62 4557.21,-1531.62 4444.45,-1427.62 4882.79,-1427.62 4995.55,-1531.62"/>
<text text-anchor="middle" x="4720" y="-1493.62" font-family="Arial" font-size="10.00">Expert Aggregation TP6</text>
<text text-anchor="middle" x="4720" y="-1482.62" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="4720" y="-1471.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4720" y="-1460.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- expert56_l2_tp6&#45;&gt;expert_agg_l2_tp6 -->
<g id="edge636" class="edge">
<title>expert56_l2_tp6&#45;&gt;expert_agg_l2_tp6</title>
<path fill="none" stroke="black" d="M3938.77,-1593.37C3956.79,-1583.82 3978.35,-1573.78 3999,-1567.62 4162.12,-1518.95 4353.72,-1497.42 4498.39,-1487.94"/>
<polygon fill="black" stroke="black" points="4498.97,-1491.41 4508.72,-1487.28 4498.52,-1484.42 4498.97,-1491.41"/>
</g>
<!-- expert57_l2_tp6&#45;&gt;expert_agg_l2_tp6 -->
<g id="edge638" class="edge">
<title>expert57_l2_tp6&#45;&gt;expert_agg_l2_tp6</title>
<path fill="none" stroke="black" d="M4145.42,-1593.59C4163.36,-1584.19 4184.69,-1574.2 4205,-1567.62 4303.93,-1535.54 4417.58,-1514.74 4512.91,-1501.56"/>
<polygon fill="black" stroke="black" points="4513.53,-1505 4522.96,-1500.18 4512.58,-1498.07 4513.53,-1505"/>
</g>
<!-- expert58_l2_tp6&#45;&gt;expert_agg_l2_tp6 -->
<g id="edge640" class="edge">
<title>expert58_l2_tp6&#45;&gt;expert_agg_l2_tp6</title>
<path fill="none" stroke="black" d="M4354.1,-1593.52C4371.59,-1584.6 4391.91,-1574.96 4411,-1567.62 4451.42,-1552.08 4495.76,-1537.95 4537.93,-1525.82"/>
<polygon fill="black" stroke="black" points="4539.09,-1529.13 4547.74,-1523.02 4537.17,-1522.4 4539.09,-1529.13"/>
</g>
<!-- expert59_l2_tp6&#45;&gt;expert_agg_l2_tp6 -->
<g id="edge642" class="edge">
<title>expert59_l2_tp6&#45;&gt;expert_agg_l2_tp6</title>
<path fill="none" stroke="black" d="M4551.78,-1593.31C4575.15,-1577.65 4606.12,-1556.91 4635.11,-1537.49"/>
<polygon fill="black" stroke="black" points="4637.27,-1540.25 4643.63,-1531.78 4633.37,-1534.44 4637.27,-1540.25"/>
</g>
<!-- expert60_l2_tp6&#45;&gt;expert_agg_l2_tp6 -->
<g id="edge644" class="edge">
<title>expert60_l2_tp6&#45;&gt;expert_agg_l2_tp6</title>
<path fill="none" stroke="black" d="M4720,-1593.31C4720,-1578.86 4720,-1560.08 4720,-1542.01"/>
<polygon fill="black" stroke="black" points="4723.5,-1541.78 4720,-1531.78 4716.5,-1541.78 4723.5,-1541.78"/>
</g>
<!-- expert61_l2_tp6&#45;&gt;expert_agg_l2_tp6 -->
<g id="edge646" class="edge">
<title>expert61_l2_tp6&#45;&gt;expert_agg_l2_tp6</title>
<path fill="none" stroke="black" d="M4888.22,-1593.31C4864.85,-1577.65 4833.88,-1556.91 4804.89,-1537.49"/>
<polygon fill="black" stroke="black" points="4806.63,-1534.44 4796.37,-1531.78 4802.73,-1540.25 4806.63,-1534.44"/>
</g>
<!-- expert62_l2_tp6&#45;&gt;expert_agg_l2_tp6 -->
<g id="edge648" class="edge">
<title>expert62_l2_tp6&#45;&gt;expert_agg_l2_tp6</title>
<path fill="none" stroke="black" d="M5085.9,-1593.52C5068.41,-1584.6 5048.09,-1574.96 5029,-1567.62 4997.99,-1555.69 4964.66,-1544.6 4931.79,-1534.61"/>
<polygon fill="black" stroke="black" points="4932.65,-1531.21 4922.06,-1531.68 4930.63,-1537.92 4932.65,-1531.21"/>
</g>
<!-- expert63_l2_tp6&#45;&gt;expert_agg_l2_tp6 -->
<g id="edge650" class="edge">
<title>expert63_l2_tp6&#45;&gt;expert_agg_l2_tp6</title>
<path fill="none" stroke="black" d="M5294.58,-1593.59C5276.64,-1584.19 5255.31,-1574.2 5235,-1567.62 5153.77,-1541.28 5062.61,-1522.55 4979.83,-1509.39"/>
<polygon fill="black" stroke="black" points="4980.19,-1505.9 4969.77,-1507.81 4979.11,-1512.82 4980.19,-1505.9"/>
</g>
<!-- expert_agg_l2_tp6&#45;&gt;res_add2_l2_tp6 -->
<g id="edge651" class="edge">
<title>expert_agg_l2_tp6&#45;&gt;res_add2_l2_tp6</title>
<path fill="none" stroke="black" d="M4748.28,-1427.53C4753.34,-1418.38 4758.51,-1409.05 4763.22,-1400.54"/>
<polygon fill="black" stroke="black" points="4766.36,-1402.1 4768.14,-1391.66 4760.23,-1398.71 4766.36,-1402.1"/>
</g>
<!-- norm2_l2_tp6 -->
<g id="node439" class="node">
<title>norm2_l2_tp6</title>
<polygon fill="lightgreen" stroke="black" points="4915,-1303.62 4649,-1303.62 4649,-1251.62 4915,-1251.62 4915,-1303.62"/>
<text text-anchor="middle" x="4782" y="-1291.62" font-family="Arial" font-size="10.00">Layer Norm 2 TP6</text>
<text text-anchor="middle" x="4782" y="-1280.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4782" y="-1269.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4782" y="-1258.62" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- res_add2_l2_tp6&#45;&gt;norm2_l2_tp6 -->
<g id="edge653" class="edge">
<title>res_add2_l2_tp6&#45;&gt;norm2_l2_tp6</title>
<path fill="none" stroke="black" d="M4782,-1339.28C4782,-1331.32 4782,-1322.38 4782,-1313.86"/>
<polygon fill="black" stroke="black" points="4785.5,-1313.77 4782,-1303.77 4778.5,-1313.77 4785.5,-1313.77"/>
</g>
<!-- input_split_l3_tp6 -->
<g id="node574" class="node">
<title>input_split_l3_tp6</title>
<ellipse fill="lightgray" stroke="black" cx="4782" cy="-1167.85" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="4782" y="-1181.85" font-family="Arial" font-size="10.00">Input Split TP6</text>
<text text-anchor="middle" x="4782" y="-1170.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4782" y="-1159.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="4782" y="-1148.85" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm2_l2_tp6&#45;&gt;input_split_l3_tp6 -->
<g id="edge855" class="edge">
<title>norm2_l2_tp6&#45;&gt;input_split_l3_tp6</title>
<path fill="none" stroke="black" d="M4782,-1251.35C4782,-1240.56 4782,-1227.61 4782,-1215.21"/>
<polygon fill="black" stroke="black" points="4785.5,-1214.98 4782,-1204.98 4778.5,-1214.98 4785.5,-1214.98"/>
</g>
<!-- mha_qkv_l2_tp7 -->
<g id="node441" class="node">
<title>mha_qkv_l2_tp7</title>
<polygon fill="lightgreen" stroke="black" points="3443.5,-2221.16 3152.5,-2221.16 3152.5,-2169.16 3443.5,-2169.16 3443.5,-2221.16"/>
<text text-anchor="middle" x="3298" y="-2209.16" font-family="Arial" font-size="10.00">MHA QKV TP7</text>
<text text-anchor="middle" x="3298" y="-2198.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="3298" y="-2187.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="3298" y="-2176.16" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- input_split_l2_tp7&#45;&gt;mha_qkv_l2_tp7 -->
<g id="edge654" class="edge">
<title>input_split_l2_tp7&#45;&gt;mha_qkv_l2_tp7</title>
<path fill="none" stroke="black" d="M3418.82,-2259.35C3398.09,-2248.51 3375.27,-2236.57 3355.09,-2226.02"/>
<polygon fill="black" stroke="black" points="3356.51,-2222.81 3346.02,-2221.28 3353.26,-2229.01 3356.51,-2222.81"/>
</g>
<!-- res_add_l2_tp7 -->
<g id="node445" class="node">
<title>res_add_l2_tp7</title>
<polygon fill="lightgreen" stroke="black" points="3415,-1847.62 3137,-1847.62 3137,-1795.62 3415,-1795.62 3415,-1847.62"/>
<text text-anchor="middle" x="3276" y="-1835.62" font-family="Arial" font-size="10.00">Residual Add TP7</text>
<text text-anchor="middle" x="3276" y="-1824.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="3276" y="-1813.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3276" y="-1802.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- input_split_l2_tp7&#45;&gt;res_add_l2_tp7 -->
<g id="edge658" class="edge">
<title>input_split_l2_tp7&#45;&gt;res_add_l2_tp7</title>
<path fill="none" stroke="black" d="M3483,-2256.81C3483,-2219.57 3483,-2159.8 3483,-2108.16 3483,-2108.16 3483,-2108.16 3483,-2018.16 3483,-1958.2 3510.34,-1930.53 3473,-1883.62 3460.16,-1867.49 3443.13,-1855.53 3424.45,-1846.68"/>
<polygon fill="black" stroke="black" points="3425.71,-1843.41 3415.15,-1842.58 3422.89,-1849.82 3425.71,-1843.41"/>
</g>
<!-- mha_attn_l2_tp7 -->
<g id="node442" class="node">
<title>mha_attn_l2_tp7</title>
<polygon fill="lightgreen" stroke="black" points="3438.5,-2133.16 3147.5,-2133.16 3147.5,-2081.16 3438.5,-2081.16 3438.5,-2133.16"/>
<text text-anchor="middle" x="3293" y="-2121.16" font-family="Arial" font-size="10.00">MHA Attention TP7</text>
<text text-anchor="middle" x="3293" y="-2110.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="3293" y="-2099.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="3293" y="-2088.16" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- mha_qkv_l2_tp7&#45;&gt;mha_attn_l2_tp7 -->
<g id="edge655" class="edge">
<title>mha_qkv_l2_tp7&#45;&gt;mha_attn_l2_tp7</title>
<path fill="none" stroke="black" d="M3296.53,-2168.82C3296.06,-2160.86 3295.54,-2151.92 3295.05,-2143.4"/>
<polygon fill="black" stroke="black" points="3298.54,-2143.09 3294.46,-2133.31 3291.55,-2143.5 3298.54,-2143.09"/>
</g>
<!-- mha_out_l2_tp7 -->
<g id="node443" class="node">
<title>mha_out_l2_tp7</title>
<polygon fill="lightgreen" stroke="black" points="3429,-2045.16 3145,-2045.16 3145,-1993.16 3429,-1993.16 3429,-2045.16"/>
<text text-anchor="middle" x="3287" y="-2033.16" font-family="Arial" font-size="10.00">MHA Output TP7</text>
<text text-anchor="middle" x="3287" y="-2022.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="3287" y="-2011.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="3287" y="-2000.16" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- mha_attn_l2_tp7&#45;&gt;mha_out_l2_tp7 -->
<g id="edge656" class="edge">
<title>mha_attn_l2_tp7&#45;&gt;mha_out_l2_tp7</title>
<path fill="none" stroke="black" d="M3291.23,-2080.82C3290.68,-2072.86 3290.05,-2063.92 3289.46,-2055.4"/>
<polygon fill="black" stroke="black" points="3292.94,-2055.05 3288.76,-2045.31 3285.96,-2055.53 3292.94,-2055.05"/>
</g>
<!-- attn_allreduce_l2_tp7 -->
<g id="node444" class="node">
<title>attn_allreduce_l2_tp7</title>
<ellipse fill="lightgray" stroke="black" cx="3276" cy="-1920.39" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="3276" y="-1934.39" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP7</text>
<text text-anchor="middle" x="3276" y="-1923.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="3276" y="-1912.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3276" y="-1901.39" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- mha_out_l2_tp7&#45;&gt;attn_allreduce_l2_tp7 -->
<g id="edge657" class="edge">
<title>mha_out_l2_tp7&#45;&gt;attn_allreduce_l2_tp7</title>
<path fill="none" stroke="black" d="M3284.14,-1992.98C3283.25,-1985.18 3282.24,-1976.31 3281.25,-1967.54"/>
<polygon fill="black" stroke="black" points="3284.7,-1966.9 3280.09,-1957.36 3277.74,-1967.69 3284.7,-1966.9"/>
</g>
<!-- attn_allreduce_l2_tp7&#45;&gt;res_add_l2_tp7 -->
<g id="edge659" class="edge">
<title>attn_allreduce_l2_tp7&#45;&gt;res_add_l2_tp7</title>
<path fill="none" stroke="black" d="M3276,-1883.35C3276,-1875.04 3276,-1866.21 3276,-1857.93"/>
<polygon fill="black" stroke="black" points="3279.5,-1857.81 3276,-1847.81 3272.5,-1857.81 3279.5,-1857.81"/>
</g>
<!-- norm_l2_tp7 -->
<g id="node446" class="node">
<title>norm_l2_tp7</title>
<polygon fill="lightgreen" stroke="black" points="2581,-1759.62 2315,-1759.62 2315,-1707.62 2581,-1707.62 2581,-1759.62"/>
<text text-anchor="middle" x="2448" y="-1747.62" font-family="Arial" font-size="10.00">Layer Norm TP7</text>
<text text-anchor="middle" x="2448" y="-1736.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2448" y="-1725.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2448" y="-1714.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- res_add_l2_tp7&#45;&gt;norm_l2_tp7 -->
<g id="edge660" class="edge">
<title>res_add_l2_tp7&#45;&gt;norm_l2_tp7</title>
<path fill="none" stroke="black" d="M3136.94,-1806.17C2985.39,-1790.43 2744.1,-1765.37 2591.01,-1749.47"/>
<polygon fill="black" stroke="black" points="2591.36,-1745.99 2581.05,-1748.44 2590.64,-1752.95 2591.36,-1745.99"/>
</g>
<!-- gate_l2_tp7 -->
<g id="node447" class="node">
<title>gate_l2_tp7</title>
<polygon fill="lightyellow" stroke="black" points="1512.3,-1671.62 1045.72,-1671.62 925.7,-1567.62 1392.28,-1567.62 1512.3,-1671.62"/>
<text text-anchor="middle" x="1219" y="-1633.62" font-family="Arial" font-size="10.00">Gate Network TP7</text>
<text text-anchor="middle" x="1219" y="-1622.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="1219" y="-1611.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="1219" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l2_tp7&#45;&gt;gate_l2_tp7 -->
<g id="edge661" class="edge">
<title>norm_l2_tp7&#45;&gt;gate_l2_tp7</title>
<path fill="none" stroke="black" d="M2314.83,-1728.11C2134.42,-1721.02 1802.54,-1704.57 1521,-1671.62 1520.9,-1671.61 1520.79,-1671.59 1520.69,-1671.58"/>
<polygon fill="black" stroke="black" points="1521.39,-1668.14 1511.04,-1670.42 1520.56,-1675.09 1521.39,-1668.14"/>
</g>
<!-- expert64_l2_tp7 -->
<g id="node448" class="node">
<title>expert64_l2_tp7</title>
<polygon fill="lightcoral" stroke="black" points="1718,-1645.62 1530,-1645.62 1530,-1593.62 1718,-1593.62 1718,-1645.62"/>
<text text-anchor="middle" x="1624" y="-1633.62" font-family="Arial" font-size="10.00">Expert 64</text>
<text text-anchor="middle" x="1624" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1624" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1624" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l2_tp7&#45;&gt;expert64_l2_tp7 -->
<g id="edge662" class="edge">
<title>norm_l2_tp7&#45;&gt;expert64_l2_tp7</title>
<path fill="none" stroke="black" d="M2314.99,-1727.31C2137.76,-1719.22 1834.08,-1701.49 1727,-1671.62 1709.33,-1666.69 1691.06,-1658.72 1674.91,-1650.53"/>
<polygon fill="black" stroke="black" points="1676.15,-1647.23 1665.66,-1645.71 1672.91,-1653.43 1676.15,-1647.23"/>
</g>
<!-- expert65_l2_tp7 -->
<g id="node449" class="node">
<title>expert65_l2_tp7</title>
<polygon fill="lightcoral" stroke="black" points="1924,-1645.62 1736,-1645.62 1736,-1593.62 1924,-1593.62 1924,-1645.62"/>
<text text-anchor="middle" x="1830" y="-1633.62" font-family="Arial" font-size="10.00">Expert 65</text>
<text text-anchor="middle" x="1830" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1830" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1830" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l2_tp7&#45;&gt;expert65_l2_tp7 -->
<g id="edge664" class="edge">
<title>norm_l2_tp7&#45;&gt;expert65_l2_tp7</title>
<path fill="none" stroke="black" d="M2314.79,-1729.28C2209.31,-1723.68 2059.22,-1709.12 1933,-1671.62 1915.57,-1666.44 1897.5,-1658.49 1881.45,-1650.39"/>
<polygon fill="black" stroke="black" points="1882.75,-1647.12 1872.26,-1645.63 1879.53,-1653.33 1882.75,-1647.12"/>
</g>
<!-- expert66_l2_tp7 -->
<g id="node450" class="node">
<title>expert66_l2_tp7</title>
<polygon fill="lightcoral" stroke="black" points="2130,-1645.62 1942,-1645.62 1942,-1593.62 2130,-1593.62 2130,-1645.62"/>
<text text-anchor="middle" x="2036" y="-1633.62" font-family="Arial" font-size="10.00">Expert 66</text>
<text text-anchor="middle" x="2036" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2036" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2036" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l2_tp7&#45;&gt;expert66_l2_tp7 -->
<g id="edge666" class="edge">
<title>norm_l2_tp7&#45;&gt;expert66_l2_tp7</title>
<path fill="none" stroke="black" d="M2314.8,-1714.27C2259.54,-1704.62 2195.31,-1690.74 2139,-1671.62 2122.26,-1665.93 2104.77,-1658.07 2089.05,-1650.23"/>
<polygon fill="black" stroke="black" points="2090.52,-1647.05 2080.02,-1645.62 2087.34,-1653.28 2090.52,-1647.05"/>
</g>
<!-- expert67_l2_tp7 -->
<g id="node451" class="node">
<title>expert67_l2_tp7</title>
<polygon fill="lightcoral" stroke="black" points="2336,-1645.62 2148,-1645.62 2148,-1593.62 2336,-1593.62 2336,-1645.62"/>
<text text-anchor="middle" x="2242" y="-1633.62" font-family="Arial" font-size="10.00">Expert 67</text>
<text text-anchor="middle" x="2242" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2242" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2242" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l2_tp7&#45;&gt;expert67_l2_tp7 -->
<g id="edge668" class="edge">
<title>norm_l2_tp7&#45;&gt;expert67_l2_tp7</title>
<path fill="none" stroke="black" d="M2401.77,-1707.48C2370.76,-1690.62 2329.76,-1668.33 2297.06,-1650.55"/>
<polygon fill="black" stroke="black" points="2298.53,-1647.37 2288.08,-1645.67 2295.19,-1653.52 2298.53,-1647.37"/>
</g>
<!-- expert68_l2_tp7 -->
<g id="node452" class="node">
<title>expert68_l2_tp7</title>
<polygon fill="lightcoral" stroke="black" points="2542,-1645.62 2354,-1645.62 2354,-1593.62 2542,-1593.62 2542,-1645.62"/>
<text text-anchor="middle" x="2448" y="-1633.62" font-family="Arial" font-size="10.00">Expert 68</text>
<text text-anchor="middle" x="2448" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2448" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2448" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l2_tp7&#45;&gt;expert68_l2_tp7 -->
<g id="edge670" class="edge">
<title>norm_l2_tp7&#45;&gt;expert68_l2_tp7</title>
<path fill="none" stroke="black" d="M2448,-1707.48C2448,-1692.21 2448,-1672.48 2448,-1655.68"/>
<polygon fill="black" stroke="black" points="2451.5,-1655.67 2448,-1645.67 2444.5,-1655.67 2451.5,-1655.67"/>
</g>
<!-- expert69_l2_tp7 -->
<g id="node453" class="node">
<title>expert69_l2_tp7</title>
<polygon fill="lightcoral" stroke="black" points="2748,-1645.62 2560,-1645.62 2560,-1593.62 2748,-1593.62 2748,-1645.62"/>
<text text-anchor="middle" x="2654" y="-1633.62" font-family="Arial" font-size="10.00">Expert 69</text>
<text text-anchor="middle" x="2654" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2654" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2654" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l2_tp7&#45;&gt;expert69_l2_tp7 -->
<g id="edge672" class="edge">
<title>norm_l2_tp7&#45;&gt;expert69_l2_tp7</title>
<path fill="none" stroke="black" d="M2494.23,-1707.48C2525.24,-1690.62 2566.24,-1668.33 2598.94,-1650.55"/>
<polygon fill="black" stroke="black" points="2600.81,-1653.52 2607.92,-1645.67 2597.47,-1647.37 2600.81,-1653.52"/>
</g>
<!-- expert70_l2_tp7 -->
<g id="node454" class="node">
<title>expert70_l2_tp7</title>
<polygon fill="lightcoral" stroke="black" points="2954,-1645.62 2766,-1645.62 2766,-1593.62 2954,-1593.62 2954,-1645.62"/>
<text text-anchor="middle" x="2860" y="-1633.62" font-family="Arial" font-size="10.00">Expert 70</text>
<text text-anchor="middle" x="2860" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2860" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2860" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l2_tp7&#45;&gt;expert70_l2_tp7 -->
<g id="edge674" class="edge">
<title>norm_l2_tp7&#45;&gt;expert70_l2_tp7</title>
<path fill="none" stroke="black" d="M2581.2,-1714.27C2636.46,-1704.62 2700.69,-1690.74 2757,-1671.62 2773.74,-1665.93 2791.23,-1658.07 2806.95,-1650.23"/>
<polygon fill="black" stroke="black" points="2808.66,-1653.28 2815.98,-1645.62 2805.48,-1647.05 2808.66,-1653.28"/>
</g>
<!-- expert71_l2_tp7 -->
<g id="node455" class="node">
<title>expert71_l2_tp7</title>
<polygon fill="lightcoral" stroke="black" points="3160,-1645.62 2972,-1645.62 2972,-1593.62 3160,-1593.62 3160,-1645.62"/>
<text text-anchor="middle" x="3066" y="-1633.62" font-family="Arial" font-size="10.00">Expert 71</text>
<text text-anchor="middle" x="3066" y="-1622.62" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3066" y="-1611.62" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3066" y="-1600.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l2_tp7&#45;&gt;expert71_l2_tp7 -->
<g id="edge676" class="edge">
<title>norm_l2_tp7&#45;&gt;expert71_l2_tp7</title>
<path fill="none" stroke="black" d="M2581.21,-1729.28C2686.69,-1723.68 2836.78,-1709.12 2963,-1671.62 2980.43,-1666.44 2998.5,-1658.49 3014.55,-1650.39"/>
<polygon fill="black" stroke="black" points="3016.47,-1653.33 3023.74,-1645.63 3013.25,-1647.12 3016.47,-1653.33"/>
</g>
<!-- res_add2_l2_tp7 -->
<g id="node457" class="node">
<title>res_add2_l2_tp7</title>
<polygon fill="lightgreen" stroke="black" points="2633,-1391.62 2355,-1391.62 2355,-1339.62 2633,-1339.62 2633,-1391.62"/>
<text text-anchor="middle" x="2494" y="-1379.62" font-family="Arial" font-size="10.00">Residual Add 2 TP7</text>
<text text-anchor="middle" x="2494" y="-1368.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="2494" y="-1357.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2494" y="-1346.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l2_tp7&#45;&gt;res_add2_l2_tp7 -->
<g id="edge679" class="edge">
<title>norm_l2_tp7&#45;&gt;res_add2_l2_tp7</title>
<path fill="none" stroke="black" d="M2581.36,-1730.88C2778.87,-1726.9 3130.14,-1713.91 3169,-1671.62 3184.64,-1654.6 3182.62,-1586.29 3169,-1567.62 3049.09,-1403.17 2928.58,-1483.92 2733,-1427.62 2692.32,-1415.91 2647.42,-1404.15 2607.63,-1394.12"/>
<polygon fill="black" stroke="black" points="2608.45,-1390.71 2597.89,-1391.67 2606.74,-1397.5 2608.45,-1390.71"/>
</g>
<!-- expert_agg_l2_tp7 -->
<g id="node456" class="node">
<title>expert_agg_l2_tp7</title>
<polygon fill="lightpink" stroke="black" points="2723.55,-1531.62 2285.21,-1531.62 2172.45,-1427.62 2610.79,-1427.62 2723.55,-1531.62"/>
<text text-anchor="middle" x="2448" y="-1493.62" font-family="Arial" font-size="10.00">Expert Aggregation TP7</text>
<text text-anchor="middle" x="2448" y="-1482.62" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="2448" y="-1471.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2448" y="-1460.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- expert64_l2_tp7&#45;&gt;expert_agg_l2_tp7 -->
<g id="edge663" class="edge">
<title>expert64_l2_tp7&#45;&gt;expert_agg_l2_tp7</title>
<path fill="none" stroke="black" d="M1666.77,-1593.37C1684.79,-1583.82 1706.35,-1573.78 1727,-1567.62 1890.12,-1518.95 2081.72,-1497.42 2226.39,-1487.94"/>
<polygon fill="black" stroke="black" points="2226.97,-1491.41 2236.72,-1487.28 2226.52,-1484.42 2226.97,-1491.41"/>
</g>
<!-- expert65_l2_tp7&#45;&gt;expert_agg_l2_tp7 -->
<g id="edge665" class="edge">
<title>expert65_l2_tp7&#45;&gt;expert_agg_l2_tp7</title>
<path fill="none" stroke="black" d="M1873.42,-1593.59C1891.36,-1584.19 1912.69,-1574.2 1933,-1567.62 2031.93,-1535.54 2145.58,-1514.74 2240.91,-1501.56"/>
<polygon fill="black" stroke="black" points="2241.53,-1505 2250.96,-1500.18 2240.58,-1498.07 2241.53,-1505"/>
</g>
<!-- expert66_l2_tp7&#45;&gt;expert_agg_l2_tp7 -->
<g id="edge667" class="edge">
<title>expert66_l2_tp7&#45;&gt;expert_agg_l2_tp7</title>
<path fill="none" stroke="black" d="M2082.1,-1593.52C2099.59,-1584.6 2119.91,-1574.96 2139,-1567.62 2179.42,-1552.08 2223.76,-1537.95 2265.93,-1525.82"/>
<polygon fill="black" stroke="black" points="2267.09,-1529.13 2275.74,-1523.02 2265.17,-1522.4 2267.09,-1529.13"/>
</g>
<!-- expert67_l2_tp7&#45;&gt;expert_agg_l2_tp7 -->
<g id="edge669" class="edge">
<title>expert67_l2_tp7&#45;&gt;expert_agg_l2_tp7</title>
<path fill="none" stroke="black" d="M2279.78,-1593.31C2303.15,-1577.65 2334.12,-1556.91 2363.11,-1537.49"/>
<polygon fill="black" stroke="black" points="2365.27,-1540.25 2371.63,-1531.78 2361.37,-1534.44 2365.27,-1540.25"/>
</g>
<!-- expert68_l2_tp7&#45;&gt;expert_agg_l2_tp7 -->
<g id="edge671" class="edge">
<title>expert68_l2_tp7&#45;&gt;expert_agg_l2_tp7</title>
<path fill="none" stroke="black" d="M2448,-1593.31C2448,-1578.86 2448,-1560.08 2448,-1542.01"/>
<polygon fill="black" stroke="black" points="2451.5,-1541.78 2448,-1531.78 2444.5,-1541.78 2451.5,-1541.78"/>
</g>
<!-- expert69_l2_tp7&#45;&gt;expert_agg_l2_tp7 -->
<g id="edge673" class="edge">
<title>expert69_l2_tp7&#45;&gt;expert_agg_l2_tp7</title>
<path fill="none" stroke="black" d="M2616.22,-1593.31C2592.85,-1577.65 2561.88,-1556.91 2532.89,-1537.49"/>
<polygon fill="black" stroke="black" points="2534.63,-1534.44 2524.37,-1531.78 2530.73,-1540.25 2534.63,-1534.44"/>
</g>
<!-- expert70_l2_tp7&#45;&gt;expert_agg_l2_tp7 -->
<g id="edge675" class="edge">
<title>expert70_l2_tp7&#45;&gt;expert_agg_l2_tp7</title>
<path fill="none" stroke="black" d="M2813.9,-1593.52C2796.41,-1584.6 2776.09,-1574.96 2757,-1567.62 2725.99,-1555.69 2692.66,-1544.6 2659.79,-1534.61"/>
<polygon fill="black" stroke="black" points="2660.65,-1531.21 2650.06,-1531.68 2658.63,-1537.92 2660.65,-1531.21"/>
</g>
<!-- expert71_l2_tp7&#45;&gt;expert_agg_l2_tp7 -->
<g id="edge677" class="edge">
<title>expert71_l2_tp7&#45;&gt;expert_agg_l2_tp7</title>
<path fill="none" stroke="black" d="M3022.58,-1593.59C3004.64,-1584.19 2983.31,-1574.2 2963,-1567.62 2881.77,-1541.28 2790.61,-1522.55 2707.83,-1509.39"/>
<polygon fill="black" stroke="black" points="2708.19,-1505.9 2697.77,-1507.81 2707.11,-1512.82 2708.19,-1505.9"/>
</g>
<!-- expert_agg_l2_tp7&#45;&gt;res_add2_l2_tp7 -->
<g id="edge678" class="edge">
<title>expert_agg_l2_tp7&#45;&gt;res_add2_l2_tp7</title>
<path fill="none" stroke="black" d="M2468.98,-1427.53C2472.66,-1418.58 2476.41,-1409.45 2479.84,-1401.08"/>
<polygon fill="black" stroke="black" points="2483.15,-1402.24 2483.71,-1391.66 2476.68,-1399.58 2483.15,-1402.24"/>
</g>
<!-- norm2_l2_tp7 -->
<g id="node458" class="node">
<title>norm2_l2_tp7</title>
<polygon fill="lightgreen" stroke="black" points="2627,-1303.62 2361,-1303.62 2361,-1251.62 2627,-1251.62 2627,-1303.62"/>
<text text-anchor="middle" x="2494" y="-1291.62" font-family="Arial" font-size="10.00">Layer Norm 2 TP7</text>
<text text-anchor="middle" x="2494" y="-1280.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2494" y="-1269.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2494" y="-1258.62" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- res_add2_l2_tp7&#45;&gt;norm2_l2_tp7 -->
<g id="edge680" class="edge">
<title>res_add2_l2_tp7&#45;&gt;norm2_l2_tp7</title>
<path fill="none" stroke="black" d="M2494,-1339.28C2494,-1331.32 2494,-1322.38 2494,-1313.86"/>
<polygon fill="black" stroke="black" points="2497.5,-1313.77 2494,-1303.77 2490.5,-1313.77 2497.5,-1313.77"/>
</g>
<!-- input_split_l3_tp7 -->
<g id="node593" class="node">
<title>input_split_l3_tp7</title>
<ellipse fill="lightgray" stroke="black" cx="2494" cy="-1167.85" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="2494" y="-1181.85" font-family="Arial" font-size="10.00">Input Split TP7</text>
<text text-anchor="middle" x="2494" y="-1170.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2494" y="-1159.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="2494" y="-1148.85" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm2_l2_tp7&#45;&gt;input_split_l3_tp7 -->
<g id="edge884" class="edge">
<title>norm2_l2_tp7&#45;&gt;input_split_l3_tp7</title>
<path fill="none" stroke="black" d="M2494,-1251.35C2494,-1240.56 2494,-1227.61 2494,-1215.21"/>
<polygon fill="black" stroke="black" points="2497.5,-1214.98 2494,-1204.98 2490.5,-1214.98 2497.5,-1214.98"/>
</g>
<!-- final_output -->
<g id="node459" class="node">
<title>final_output</title>
<ellipse fill="lightblue" stroke="black" cx="10662" cy="-52.77" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="10662" y="-66.77" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="10662" y="-55.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10662" y="-44.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10662" y="-33.77" font-family="Arial" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- mha_qkv_l3_tp0 -->
<g id="node461" class="node">
<title>mha_qkv_l3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="18472.5,-1095.08 18181.5,-1095.08 18181.5,-1043.08 18472.5,-1043.08 18472.5,-1095.08"/>
<text text-anchor="middle" x="18327" y="-1083.08" font-family="Arial" font-size="10.00">MHA QKV TP0</text>
<text text-anchor="middle" x="18327" y="-1072.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="18327" y="-1061.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="18327" y="-1050.08" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- input_split_l3_tp0&#45;&gt;mha_qkv_l3_tp0 -->
<g id="edge682" class="edge">
<title>input_split_l3_tp0&#45;&gt;mha_qkv_l3_tp0</title>
<path fill="none" stroke="black" d="M18382.1,-1131.36C18373.69,-1122.01 18364.65,-1111.96 18356.38,-1102.76"/>
<polygon fill="black" stroke="black" points="18358.93,-1100.36 18349.64,-1095.26 18353.73,-1105.04 18358.93,-1100.36"/>
</g>
<!-- res_add_l3_tp0 -->
<g id="node465" class="node">
<title>res_add_l3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="18460,-721.54 18182,-721.54 18182,-669.54 18460,-669.54 18460,-721.54"/>
<text text-anchor="middle" x="18321" y="-709.54" font-family="Arial" font-size="10.00">Residual Add TP0</text>
<text text-anchor="middle" x="18321" y="-698.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="18321" y="-687.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18321" y="-676.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- input_split_l3_tp0&#45;&gt;res_add_l3_tp0 -->
<g id="edge686" class="edge">
<title>input_split_l3_tp0&#45;&gt;res_add_l3_tp0</title>
<path fill="none" stroke="black" d="M18455.45,-1131.97C18465.73,-1121.2 18475.63,-1108.58 18482,-1095.08 18503.59,-1049.31 18496,-1032.68 18496,-982.08 18496,-982.08 18496,-982.08 18496,-892.08 18496,-832.12 18522.07,-805.44 18486,-757.54 18476.26,-744.61 18463.49,-734.42 18449.34,-726.39"/>
<polygon fill="black" stroke="black" points="18450.86,-723.23 18440.38,-721.66 18447.59,-729.42 18450.86,-723.23"/>
</g>
<!-- mha_attn_l3_tp0 -->
<g id="node462" class="node">
<title>mha_attn_l3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="18461.5,-1007.08 18170.5,-1007.08 18170.5,-955.08 18461.5,-955.08 18461.5,-1007.08"/>
<text text-anchor="middle" x="18316" y="-995.08" font-family="Arial" font-size="10.00">MHA Attention TP0</text>
<text text-anchor="middle" x="18316" y="-984.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="18316" y="-973.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="18316" y="-962.08" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- mha_qkv_l3_tp0&#45;&gt;mha_attn_l3_tp0 -->
<g id="edge683" class="edge">
<title>mha_qkv_l3_tp0&#45;&gt;mha_attn_l3_tp0</title>
<path fill="none" stroke="black" d="M18323.76,-1042.74C18322.74,-1034.78 18321.6,-1025.84 18320.51,-1017.32"/>
<polygon fill="black" stroke="black" points="18323.96,-1016.71 18319.22,-1007.23 18317.01,-1017.6 18323.96,-1016.71"/>
</g>
<!-- mha_out_l3_tp0 -->
<g id="node463" class="node">
<title>mha_out_l3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="18452,-919.08 18168,-919.08 18168,-867.08 18452,-867.08 18452,-919.08"/>
<text text-anchor="middle" x="18310" y="-907.08" font-family="Arial" font-size="10.00">MHA Output TP0</text>
<text text-anchor="middle" x="18310" y="-896.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="18310" y="-885.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="18310" y="-874.08" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- mha_attn_l3_tp0&#45;&gt;mha_out_l3_tp0 -->
<g id="edge684" class="edge">
<title>mha_attn_l3_tp0&#45;&gt;mha_out_l3_tp0</title>
<path fill="none" stroke="black" d="M18314.23,-954.74C18313.68,-946.78 18313.05,-937.84 18312.46,-929.32"/>
<polygon fill="black" stroke="black" points="18315.94,-928.97 18311.76,-919.23 18308.96,-929.45 18315.94,-928.97"/>
</g>
<!-- attn_allreduce_l3_tp0 -->
<g id="node464" class="node">
<title>attn_allreduce_l3_tp0</title>
<ellipse fill="lightgray" stroke="black" cx="18289" cy="-794.31" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="18289" y="-808.31" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP0</text>
<text text-anchor="middle" x="18289" y="-797.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="18289" y="-786.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18289" y="-775.31" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- mha_out_l3_tp0&#45;&gt;attn_allreduce_l3_tp0 -->
<g id="edge685" class="edge">
<title>mha_out_l3_tp0&#45;&gt;attn_allreduce_l3_tp0</title>
<path fill="none" stroke="black" d="M18304.54,-866.91C18302.82,-859.01 18300.88,-850.04 18298.95,-841.18"/>
<polygon fill="black" stroke="black" points="18302.35,-840.32 18296.81,-831.29 18295.51,-841.8 18302.35,-840.32"/>
</g>
<!-- attn_allreduce_l3_tp0&#45;&gt;res_add_l3_tp0 -->
<g id="edge687" class="edge">
<title>attn_allreduce_l3_tp0&#45;&gt;res_add_l3_tp0</title>
<path fill="none" stroke="black" d="M18300.82,-757.55C18303.67,-748.96 18306.7,-739.8 18309.52,-731.25"/>
<polygon fill="black" stroke="black" points="18312.9,-732.18 18312.72,-721.58 18306.26,-729.98 18312.9,-732.18"/>
</g>
<!-- norm_l3_tp0 -->
<g id="node466" class="node">
<title>norm_l3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="18454,-633.54 18188,-633.54 18188,-581.54 18454,-581.54 18454,-633.54"/>
<text text-anchor="middle" x="18321" y="-621.54" font-family="Arial" font-size="10.00">Layer Norm TP0</text>
<text text-anchor="middle" x="18321" y="-610.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18321" y="-599.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18321" y="-588.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- res_add_l3_tp0&#45;&gt;norm_l3_tp0 -->
<g id="edge688" class="edge">
<title>res_add_l3_tp0&#45;&gt;norm_l3_tp0</title>
<path fill="none" stroke="black" d="M18321,-669.2C18321,-661.24 18321,-652.3 18321,-643.78"/>
<polygon fill="black" stroke="black" points="18324.5,-643.7 18321,-633.7 18317.5,-643.7 18324.5,-643.7"/>
</g>
<!-- gate_l3_tp0 -->
<g id="node467" class="node">
<title>gate_l3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="17416.3,-545.54 16949.72,-545.54 16829.7,-441.54 17296.28,-441.54 17416.3,-545.54"/>
<text text-anchor="middle" x="17123" y="-507.54" font-family="Arial" font-size="10.00">Gate Network TP0</text>
<text text-anchor="middle" x="17123" y="-496.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="17123" y="-485.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="17123" y="-474.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l3_tp0&#45;&gt;gate_l3_tp0 -->
<g id="edge689" class="edge">
<title>norm_l3_tp0&#45;&gt;gate_l3_tp0</title>
<path fill="none" stroke="black" d="M18187.79,-601.61C18012.44,-594.17 17694.81,-577.43 17425,-545.54 17424.9,-545.53 17424.79,-545.51 17424.69,-545.5"/>
<polygon fill="black" stroke="black" points="17425.39,-542.06 17415.05,-544.34 17424.55,-549.01 17425.39,-542.06"/>
</g>
<!-- expert8_l3_tp0 -->
<g id="node468" class="node">
<title>expert8_l3_tp0</title>
<polygon fill="lightcoral" stroke="black" points="17622,-519.54 17434,-519.54 17434,-467.54 17622,-467.54 17622,-519.54"/>
<text text-anchor="middle" x="17528" y="-507.54" font-family="Arial" font-size="10.00">Expert 8</text>
<text text-anchor="middle" x="17528" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17528" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17528" y="-474.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l3_tp0&#45;&gt;expert8_l3_tp0 -->
<g id="edge690" class="edge">
<title>norm_l3_tp0&#45;&gt;expert8_l3_tp0</title>
<path fill="none" stroke="black" d="M18187.9,-600.63C18017.54,-592.06 17732.3,-574.01 17631,-545.54 17613.34,-540.57 17595.07,-532.6 17578.92,-524.41"/>
<polygon fill="black" stroke="black" points="17580.16,-521.11 17569.67,-519.59 17576.92,-527.32 17580.16,-521.11"/>
</g>
<!-- expert9_l3_tp0 -->
<g id="node469" class="node">
<title>expert9_l3_tp0</title>
<polygon fill="lightcoral" stroke="black" points="17828,-519.54 17640,-519.54 17640,-467.54 17828,-467.54 17828,-519.54"/>
<text text-anchor="middle" x="17734" y="-507.54" font-family="Arial" font-size="10.00">Expert 9</text>
<text text-anchor="middle" x="17734" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17734" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17734" y="-474.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l3_tp0&#45;&gt;expert9_l3_tp0 -->
<g id="edge692" class="edge">
<title>norm_l3_tp0&#45;&gt;expert9_l3_tp0</title>
<path fill="none" stroke="black" d="M18187.83,-601.71C18089.19,-595.28 17952.46,-580.32 17837,-545.54 17819.75,-540.34 17801.86,-532.47 17785.92,-524.45"/>
<polygon fill="black" stroke="black" points="17787.27,-521.21 17776.78,-519.74 17784.06,-527.43 17787.27,-521.21"/>
</g>
<!-- expert10_l3_tp0 -->
<g id="node470" class="node">
<title>expert10_l3_tp0</title>
<polygon fill="lightcoral" stroke="black" points="18034,-519.54 17846,-519.54 17846,-467.54 18034,-467.54 18034,-519.54"/>
<text text-anchor="middle" x="17940" y="-507.54" font-family="Arial" font-size="10.00">Expert 10</text>
<text text-anchor="middle" x="17940" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17940" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="17940" y="-474.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l3_tp0&#45;&gt;expert10_l3_tp0 -->
<g id="edge694" class="edge">
<title>norm_l3_tp0&#45;&gt;expert10_l3_tp0</title>
<path fill="none" stroke="black" d="M18188,-584.22C18141.45,-574.62 18089.27,-561.8 18043,-545.54 18026.48,-539.73 18009.17,-531.91 17993.57,-524.14"/>
<polygon fill="black" stroke="black" points="17995.1,-520.99 17984.6,-519.59 17991.93,-527.24 17995.1,-520.99"/>
</g>
<!-- expert11_l3_tp0 -->
<g id="node471" class="node">
<title>expert11_l3_tp0</title>
<polygon fill="lightcoral" stroke="black" points="18240,-519.54 18052,-519.54 18052,-467.54 18240,-467.54 18240,-519.54"/>
<text text-anchor="middle" x="18146" y="-507.54" font-family="Arial" font-size="10.00">Expert 11</text>
<text text-anchor="middle" x="18146" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18146" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18146" y="-474.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l3_tp0&#45;&gt;expert11_l3_tp0 -->
<g id="edge696" class="edge">
<title>norm_l3_tp0&#45;&gt;expert11_l3_tp0</title>
<path fill="none" stroke="black" d="M18281.73,-581.4C18255.72,-564.76 18221.45,-542.83 18193.85,-525.16"/>
<polygon fill="black" stroke="black" points="18195.45,-522.03 18185.14,-519.59 18191.68,-527.93 18195.45,-522.03"/>
</g>
<!-- expert12_l3_tp0 -->
<g id="node472" class="node">
<title>expert12_l3_tp0</title>
<polygon fill="lightcoral" stroke="black" points="18446,-519.54 18258,-519.54 18258,-467.54 18446,-467.54 18446,-519.54"/>
<text text-anchor="middle" x="18352" y="-507.54" font-family="Arial" font-size="10.00">Expert 12</text>
<text text-anchor="middle" x="18352" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18352" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18352" y="-474.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l3_tp0&#45;&gt;expert12_l3_tp0 -->
<g id="edge698" class="edge">
<title>norm_l3_tp0&#45;&gt;expert12_l3_tp0</title>
<path fill="none" stroke="black" d="M18327.96,-581.4C18332.18,-566.13 18337.65,-546.4 18342.29,-529.6"/>
<polygon fill="black" stroke="black" points="18345.77,-530.16 18345.07,-519.59 18339.03,-528.29 18345.77,-530.16"/>
</g>
<!-- expert13_l3_tp0 -->
<g id="node473" class="node">
<title>expert13_l3_tp0</title>
<polygon fill="lightcoral" stroke="black" points="18652,-519.54 18464,-519.54 18464,-467.54 18652,-467.54 18652,-519.54"/>
<text text-anchor="middle" x="18558" y="-507.54" font-family="Arial" font-size="10.00">Expert 13</text>
<text text-anchor="middle" x="18558" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18558" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18558" y="-474.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l3_tp0&#45;&gt;expert13_l3_tp0 -->
<g id="edge700" class="edge">
<title>norm_l3_tp0&#45;&gt;expert13_l3_tp0</title>
<path fill="none" stroke="black" d="M18377.26,-581.42C18401.29,-570.56 18429.6,-557.6 18455,-545.54 18469.27,-538.76 18484.56,-531.3 18498.88,-524.22"/>
<polygon fill="black" stroke="black" points="18500.72,-527.22 18508.13,-519.64 18497.61,-520.94 18500.72,-527.22"/>
</g>
<!-- expert14_l3_tp0 -->
<g id="node474" class="node">
<title>expert14_l3_tp0</title>
<polygon fill="lightcoral" stroke="black" points="18858,-519.54 18670,-519.54 18670,-467.54 18858,-467.54 18858,-519.54"/>
<text text-anchor="middle" x="18764" y="-507.54" font-family="Arial" font-size="10.00">Expert 14</text>
<text text-anchor="middle" x="18764" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18764" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18764" y="-474.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l3_tp0&#45;&gt;expert14_l3_tp0 -->
<g id="edge702" class="edge">
<title>norm_l3_tp0&#45;&gt;expert14_l3_tp0</title>
<path fill="none" stroke="black" d="M18454.34,-591.5C18517.95,-582.09 18594.51,-567.47 18661,-545.54 18677.87,-539.97 18695.46,-532.11 18711.24,-524.22"/>
<polygon fill="black" stroke="black" points="18712.98,-527.26 18720.29,-519.59 18709.8,-521.03 18712.98,-527.26"/>
</g>
<!-- expert15_l3_tp0 -->
<g id="node475" class="node">
<title>expert15_l3_tp0</title>
<polygon fill="lightcoral" stroke="black" points="19064,-519.54 18876,-519.54 18876,-467.54 19064,-467.54 19064,-519.54"/>
<text text-anchor="middle" x="18970" y="-507.54" font-family="Arial" font-size="10.00">Expert 15</text>
<text text-anchor="middle" x="18970" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18970" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="18970" y="-474.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l3_tp0&#45;&gt;expert15_l3_tp0 -->
<g id="edge704" class="edge">
<title>norm_l3_tp0&#45;&gt;expert15_l3_tp0</title>
<path fill="none" stroke="black" d="M18454.26,-604.53C18566.41,-599.8 18729.95,-585.77 18867,-545.54 18884.45,-540.42 18902.52,-532.48 18918.57,-524.38"/>
<polygon fill="black" stroke="black" points="18920.49,-527.33 18927.76,-519.62 18917.27,-521.11 18920.49,-527.33"/>
</g>
<!-- res_add2_l3_tp0 -->
<g id="node477" class="node">
<title>res_add2_l3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="18388,-265.54 18110,-265.54 18110,-213.54 18388,-213.54 18388,-265.54"/>
<text text-anchor="middle" x="18249" y="-253.54" font-family="Arial" font-size="10.00">Residual Add 2 TP0</text>
<text text-anchor="middle" x="18249" y="-242.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="18249" y="-231.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18249" y="-220.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- norm_l3_tp0&#45;&gt;res_add2_l3_tp0 -->
<g id="edge707" class="edge">
<title>norm_l3_tp0&#45;&gt;res_add2_l3_tp0</title>
<path fill="none" stroke="black" d="M18454.21,-605.32C18659.02,-602.05 19032.01,-589.98 19073,-545.54 19104.33,-511.56 19101.28,-478.1 19073,-441.54 18991.41,-336.06 18612.79,-279.22 18398.3,-254.99"/>
<polygon fill="black" stroke="black" points="18398.53,-251.5 18388.21,-253.86 18397.76,-258.46 18398.53,-251.5"/>
</g>
<!-- expert_agg_l3_tp0 -->
<g id="node476" class="node">
<title>expert_agg_l3_tp0</title>
<polygon fill="lightpink" stroke="black" points="18524.55,-405.54 18086.21,-405.54 17973.45,-301.54 18411.79,-301.54 18524.55,-405.54"/>
<text text-anchor="middle" x="18249" y="-367.54" font-family="Arial" font-size="10.00">Expert Aggregation TP0</text>
<text text-anchor="middle" x="18249" y="-356.54" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="18249" y="-345.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="18249" y="-334.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- expert8_l3_tp0&#45;&gt;expert_agg_l3_tp0 -->
<g id="edge691" class="edge">
<title>expert8_l3_tp0&#45;&gt;expert_agg_l3_tp0</title>
<path fill="none" stroke="black" d="M17570.83,-467.49C17588.86,-457.98 17610.41,-447.9 17631,-441.54 17761.51,-401.19 17913.37,-379.49 18033.89,-367.84"/>
<polygon fill="black" stroke="black" points="18034.36,-371.32 18043.98,-366.89 18033.7,-364.35 18034.36,-371.32"/>
</g>
<!-- expert9_l3_tp0&#45;&gt;expert_agg_l3_tp0 -->
<g id="edge693" class="edge">
<title>expert9_l3_tp0&#45;&gt;expert_agg_l3_tp0</title>
<path fill="none" stroke="black" d="M17778.32,-467.54C17796.12,-458.31 17817.11,-448.44 17837,-441.54 17905.63,-417.73 17983.05,-399.3 18052.1,-385.65"/>
<polygon fill="black" stroke="black" points="18053.08,-389.03 18062.22,-383.68 18051.74,-382.16 18053.08,-389.03"/>
</g>
<!-- expert10_l3_tp0&#45;&gt;expert_agg_l3_tp0 -->
<g id="edge695" class="edge">
<title>expert10_l3_tp0&#45;&gt;expert_agg_l3_tp0</title>
<path fill="none" stroke="black" d="M17989.22,-467.42C18006.16,-458.97 18025.31,-449.64 18043,-441.54 18066.32,-430.86 18091.31,-419.89 18115.58,-409.51"/>
<polygon fill="black" stroke="black" points="18117.01,-412.7 18124.83,-405.55 18114.26,-406.26 18117.01,-412.7"/>
</g>
<!-- expert11_l3_tp0&#45;&gt;expert_agg_l3_tp0 -->
<g id="edge697" class="edge">
<title>expert11_l3_tp0&#45;&gt;expert_agg_l3_tp0</title>
<path fill="none" stroke="black" d="M18164.89,-467.23C18176.07,-452.25 18190.74,-432.6 18204.68,-413.92"/>
<polygon fill="black" stroke="black" points="18207.64,-415.81 18210.81,-405.7 18202.03,-411.62 18207.64,-415.81"/>
</g>
<!-- expert12_l3_tp0&#45;&gt;expert_agg_l3_tp0 -->
<g id="edge699" class="edge">
<title>expert12_l3_tp0&#45;&gt;expert_agg_l3_tp0</title>
<path fill="none" stroke="black" d="M18333.11,-467.23C18321.93,-452.25 18307.26,-432.6 18293.32,-413.92"/>
<polygon fill="black" stroke="black" points="18295.97,-411.62 18287.19,-405.7 18290.36,-415.81 18295.97,-411.62"/>
</g>
<!-- expert13_l3_tp0&#45;&gt;expert_agg_l3_tp0 -->
<g id="edge701" class="edge">
<title>expert13_l3_tp0&#45;&gt;expert_agg_l3_tp0</title>
<path fill="none" stroke="black" d="M18508.78,-467.42C18491.84,-458.97 18472.69,-449.64 18455,-441.54 18431.68,-430.86 18406.69,-419.89 18382.42,-409.51"/>
<polygon fill="black" stroke="black" points="18383.74,-406.26 18373.17,-405.55 18380.99,-412.7 18383.74,-406.26"/>
</g>
<!-- expert14_l3_tp0&#45;&gt;expert_agg_l3_tp0 -->
<g id="edge703" class="edge">
<title>expert14_l3_tp0&#45;&gt;expert_agg_l3_tp0</title>
<path fill="none" stroke="black" d="M18719.68,-467.54C18701.88,-458.31 18680.89,-448.44 18661,-441.54 18619.34,-427.08 18574.43,-414.61 18530.13,-403.99"/>
<polygon fill="black" stroke="black" points="18530.92,-400.58 18520.38,-401.68 18529.31,-407.39 18530.92,-400.58"/>
</g>
<!-- expert15_l3_tp0&#45;&gt;expert_agg_l3_tp0 -->
<g id="edge705" class="edge">
<title>expert15_l3_tp0&#45;&gt;expert_agg_l3_tp0</title>
<path fill="none" stroke="black" d="M18927.17,-467.49C18909.14,-457.98 18887.59,-447.9 18867,-441.54 18747.81,-404.69 18610.81,-383.39 18496.14,-371.11"/>
<polygon fill="black" stroke="black" points="18496.49,-367.62 18486.17,-370.06 18495.75,-374.58 18496.49,-367.62"/>
</g>
<!-- expert_agg_l3_tp0&#45;&gt;res_add2_l3_tp0 -->
<g id="edge706" class="edge">
<title>expert_agg_l3_tp0&#45;&gt;res_add2_l3_tp0</title>
<path fill="none" stroke="black" d="M18249,-301.46C18249,-292.79 18249,-283.97 18249,-275.82"/>
<polygon fill="black" stroke="black" points="18252.5,-275.58 18249,-265.58 18245.5,-275.58 18252.5,-275.58"/>
</g>
<!-- norm2_l3_tp0 -->
<g id="node478" class="node">
<title>norm2_l3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="16814,-177.54 16548,-177.54 16548,-125.54 16814,-125.54 16814,-177.54"/>
<text text-anchor="middle" x="16681" y="-165.54" font-family="Arial" font-size="10.00">Layer Norm 2 TP0</text>
<text text-anchor="middle" x="16681" y="-154.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16681" y="-143.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16681" y="-132.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- res_add2_l3_tp0&#45;&gt;norm2_l3_tp0 -->
<g id="edge708" class="edge">
<title>res_add2_l3_tp0&#45;&gt;norm2_l3_tp0</title>
<path fill="none" stroke="black" d="M18109.85,-230.91C17813.78,-214.67 17124.06,-176.84 16824.33,-160.4"/>
<polygon fill="black" stroke="black" points="16824.45,-156.9 16814.27,-159.85 16824.06,-163.89 16824.45,-156.9"/>
</g>
<!-- norm2_l3_tp0&#45;&gt;final_output -->
<g id="edge709" class="edge">
<title>norm2_l3_tp0&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M16547.79,-148.08C16241.29,-142.46 15462.35,-128.29 14811,-117.54 13290.23,-92.43 11455.85,-65.36 10859.54,-56.65"/>
<polygon fill="black" stroke="black" points="10859.17,-53.14 10849.12,-56.49 10859.07,-60.14 10859.17,-53.14"/>
</g>
<!-- mha_qkv_l3_tp1 -->
<g id="node480" class="node">
<title>mha_qkv_l3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="16154.5,-1095.08 15863.5,-1095.08 15863.5,-1043.08 16154.5,-1043.08 16154.5,-1095.08"/>
<text text-anchor="middle" x="16009" y="-1083.08" font-family="Arial" font-size="10.00">MHA QKV TP1</text>
<text text-anchor="middle" x="16009" y="-1072.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="16009" y="-1061.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="16009" y="-1050.08" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- input_split_l3_tp1&#45;&gt;mha_qkv_l3_tp1 -->
<g id="edge711" class="edge">
<title>input_split_l3_tp1&#45;&gt;mha_qkv_l3_tp1</title>
<path fill="none" stroke="black" d="M16074.52,-1131.64C16064.26,-1121.99 16053.18,-1111.59 16043.12,-1102.13"/>
<polygon fill="black" stroke="black" points="16045.33,-1099.41 16035.64,-1095.11 16040.53,-1104.51 16045.33,-1099.41"/>
</g>
<!-- res_add_l3_tp1 -->
<g id="node484" class="node">
<title>res_add_l3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="16157,-721.54 15879,-721.54 15879,-669.54 16157,-669.54 16157,-721.54"/>
<text text-anchor="middle" x="16018" y="-709.54" font-family="Arial" font-size="10.00">Residual Add TP1</text>
<text text-anchor="middle" x="16018" y="-698.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="16018" y="-687.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16018" y="-676.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- input_split_l3_tp1&#45;&gt;res_add_l3_tp1 -->
<g id="edge715" class="edge">
<title>input_split_l3_tp1&#45;&gt;res_add_l3_tp1</title>
<path fill="none" stroke="black" d="M16141.75,-1131.23C16149.87,-1120.17 16158.06,-1107.59 16164,-1095.08 16186.29,-1048.14 16194,-1034.04 16194,-982.08 16194,-982.08 16194,-982.08 16194,-892.08 16194,-832.12 16220.12,-805.4 16184,-757.54 16174.27,-744.65 16161.54,-734.48 16147.44,-726.46"/>
<polygon fill="black" stroke="black" points="16148.98,-723.32 16138.51,-721.74 16145.71,-729.51 16148.98,-723.32"/>
</g>
<!-- mha_attn_l3_tp1 -->
<g id="node481" class="node">
<title>mha_attn_l3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="16154.5,-1007.08 15863.5,-1007.08 15863.5,-955.08 16154.5,-955.08 16154.5,-1007.08"/>
<text text-anchor="middle" x="16009" y="-995.08" font-family="Arial" font-size="10.00">MHA Attention TP1</text>
<text text-anchor="middle" x="16009" y="-984.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="16009" y="-973.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="16009" y="-962.08" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- mha_qkv_l3_tp1&#45;&gt;mha_attn_l3_tp1 -->
<g id="edge712" class="edge">
<title>mha_qkv_l3_tp1&#45;&gt;mha_attn_l3_tp1</title>
<path fill="none" stroke="black" d="M16009,-1042.74C16009,-1034.78 16009,-1025.84 16009,-1017.32"/>
<polygon fill="black" stroke="black" points="16012.5,-1017.23 16009,-1007.23 16005.5,-1017.23 16012.5,-1017.23"/>
</g>
<!-- mha_out_l3_tp1 -->
<g id="node482" class="node">
<title>mha_out_l3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="16140,-919.08 15856,-919.08 15856,-867.08 16140,-867.08 16140,-919.08"/>
<text text-anchor="middle" x="15998" y="-907.08" font-family="Arial" font-size="10.00">MHA Output TP1</text>
<text text-anchor="middle" x="15998" y="-896.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="15998" y="-885.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="15998" y="-874.08" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- mha_attn_l3_tp1&#45;&gt;mha_out_l3_tp1 -->
<g id="edge713" class="edge">
<title>mha_attn_l3_tp1&#45;&gt;mha_out_l3_tp1</title>
<path fill="none" stroke="black" d="M16005.76,-954.74C16004.74,-946.78 16003.6,-937.84 16002.51,-929.32"/>
<polygon fill="black" stroke="black" points="16005.96,-928.71 16001.22,-919.23 15999.01,-929.6 16005.96,-928.71"/>
</g>
<!-- attn_allreduce_l3_tp1 -->
<g id="node483" class="node">
<title>attn_allreduce_l3_tp1</title>
<ellipse fill="lightgray" stroke="black" cx="15987" cy="-794.31" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="15987" y="-808.31" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP1</text>
<text text-anchor="middle" x="15987" y="-797.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="15987" y="-786.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15987" y="-775.31" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- mha_out_l3_tp1&#45;&gt;attn_allreduce_l3_tp1 -->
<g id="edge714" class="edge">
<title>mha_out_l3_tp1&#45;&gt;attn_allreduce_l3_tp1</title>
<path fill="none" stroke="black" d="M15995.14,-866.91C15994.25,-859.1 15993.24,-850.23 15992.25,-841.46"/>
<polygon fill="black" stroke="black" points="15995.7,-840.83 15991.09,-831.29 15988.74,-841.62 15995.7,-840.83"/>
</g>
<!-- attn_allreduce_l3_tp1&#45;&gt;res_add_l3_tp1 -->
<g id="edge716" class="edge">
<title>attn_allreduce_l3_tp1&#45;&gt;res_add_l3_tp1</title>
<path fill="none" stroke="black" d="M15998.46,-757.55C16001.21,-748.96 16004.14,-739.8 16006.88,-731.25"/>
<polygon fill="black" stroke="black" points="16010.26,-732.17 16009.98,-721.58 16003.59,-730.04 16010.26,-732.17"/>
</g>
<!-- norm_l3_tp1 -->
<g id="node485" class="node">
<title>norm_l3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="16151,-633.54 15885,-633.54 15885,-581.54 16151,-581.54 16151,-633.54"/>
<text text-anchor="middle" x="16018" y="-621.54" font-family="Arial" font-size="10.00">Layer Norm TP1</text>
<text text-anchor="middle" x="16018" y="-610.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16018" y="-599.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="16018" y="-588.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- res_add_l3_tp1&#45;&gt;norm_l3_tp1 -->
<g id="edge717" class="edge">
<title>res_add_l3_tp1&#45;&gt;norm_l3_tp1</title>
<path fill="none" stroke="black" d="M16018,-669.2C16018,-661.24 16018,-652.3 16018,-643.78"/>
<polygon fill="black" stroke="black" points="16021.5,-643.7 16018,-633.7 16014.5,-643.7 16021.5,-643.7"/>
</g>
<!-- gate_l3_tp1 -->
<g id="node486" class="node">
<title>gate_l3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="15144.3,-545.54 14677.72,-545.54 14557.7,-441.54 15024.28,-441.54 15144.3,-545.54"/>
<text text-anchor="middle" x="14851" y="-507.54" font-family="Arial" font-size="10.00">Gate Network TP1</text>
<text text-anchor="middle" x="14851" y="-496.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14851" y="-485.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="14851" y="-474.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l3_tp1&#45;&gt;gate_l3_tp1 -->
<g id="edge718" class="edge">
<title>norm_l3_tp1&#45;&gt;gate_l3_tp1</title>
<path fill="none" stroke="black" d="M15884.99,-601.17C15714.84,-593.37 15411.23,-576.38 15153,-545.54 15152.9,-545.53 15152.79,-545.51 15152.69,-545.5"/>
<polygon fill="black" stroke="black" points="15153.4,-542.06 15143.05,-544.32 15152.55,-549.01 15153.4,-542.06"/>
</g>
<!-- expert16_l3_tp1 -->
<g id="node487" class="node">
<title>expert16_l3_tp1</title>
<polygon fill="lightcoral" stroke="black" points="15350,-519.54 15162,-519.54 15162,-467.54 15350,-467.54 15350,-519.54"/>
<text text-anchor="middle" x="15256" y="-507.54" font-family="Arial" font-size="10.00">Expert 16</text>
<text text-anchor="middle" x="15256" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15256" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15256" y="-474.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l3_tp1&#45;&gt;expert16_l3_tp1 -->
<g id="edge719" class="edge">
<title>norm_l3_tp1&#45;&gt;expert16_l3_tp1</title>
<path fill="none" stroke="black" d="M15884.9,-599.98C15721.57,-590.93 15454.56,-572.61 15359,-545.54 15341.35,-540.54 15323.09,-532.55 15306.93,-524.37"/>
<polygon fill="black" stroke="black" points="15308.17,-521.06 15297.68,-519.55 15304.93,-527.27 15308.17,-521.06"/>
</g>
<!-- expert17_l3_tp1 -->
<g id="node488" class="node">
<title>expert17_l3_tp1</title>
<polygon fill="lightcoral" stroke="black" points="15556,-519.54 15368,-519.54 15368,-467.54 15556,-467.54 15556,-519.54"/>
<text text-anchor="middle" x="15462" y="-507.54" font-family="Arial" font-size="10.00">Expert 17</text>
<text text-anchor="middle" x="15462" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15462" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15462" y="-474.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l3_tp1&#45;&gt;expert17_l3_tp1 -->
<g id="edge721" class="edge">
<title>norm_l3_tp1&#45;&gt;expert17_l3_tp1</title>
<path fill="none" stroke="black" d="M15884.74,-600.02C15793.18,-592.79 15669.72,-577.57 15565,-545.54 15547.77,-540.27 15529.89,-532.37 15513.95,-524.36"/>
<polygon fill="black" stroke="black" points="15515.3,-521.12 15504.81,-519.65 15512.09,-527.34 15515.3,-521.12"/>
</g>
<!-- expert18_l3_tp1 -->
<g id="node489" class="node">
<title>expert18_l3_tp1</title>
<polygon fill="lightcoral" stroke="black" points="15762,-519.54 15574,-519.54 15574,-467.54 15762,-467.54 15762,-519.54"/>
<text text-anchor="middle" x="15668" y="-507.54" font-family="Arial" font-size="10.00">Expert 18</text>
<text text-anchor="middle" x="15668" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15668" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15668" y="-474.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l3_tp1&#45;&gt;expert18_l3_tp1 -->
<g id="edge723" class="edge">
<title>norm_l3_tp1&#45;&gt;expert18_l3_tp1</title>
<path fill="none" stroke="black" d="M15893.92,-581.47C15854.11,-571.96 15810.2,-559.89 15771,-545.54 15754.86,-539.63 15737.92,-531.93 15722.55,-524.3"/>
<polygon fill="black" stroke="black" points="15723.71,-520.96 15713.2,-519.58 15720.55,-527.21 15723.71,-520.96"/>
</g>
<!-- expert19_l3_tp1 -->
<g id="node490" class="node">
<title>expert19_l3_tp1</title>
<polygon fill="lightcoral" stroke="black" points="15968,-519.54 15780,-519.54 15780,-467.54 15968,-467.54 15968,-519.54"/>
<text text-anchor="middle" x="15874" y="-507.54" font-family="Arial" font-size="10.00">Expert 19</text>
<text text-anchor="middle" x="15874" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15874" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="15874" y="-474.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l3_tp1&#45;&gt;expert19_l3_tp1 -->
<g id="edge725" class="edge">
<title>norm_l3_tp1&#45;&gt;expert19_l3_tp1</title>
<path fill="none" stroke="black" d="M15985.68,-581.4C15964.56,-564.98 15936.81,-543.39 15914.26,-525.85"/>
<polygon fill="black" stroke="black" points="15916.25,-522.97 15906.21,-519.59 15911.95,-528.49 15916.25,-522.97"/>
</g>
<!-- expert20_l3_tp1 -->
<g id="node491" class="node">
<title>expert20_l3_tp1</title>
<polygon fill="lightcoral" stroke="black" points="16174,-519.54 15986,-519.54 15986,-467.54 16174,-467.54 16174,-519.54"/>
<text text-anchor="middle" x="16080" y="-507.54" font-family="Arial" font-size="10.00">Expert 20</text>
<text text-anchor="middle" x="16080" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16080" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16080" y="-474.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l3_tp1&#45;&gt;expert20_l3_tp1 -->
<g id="edge727" class="edge">
<title>norm_l3_tp1&#45;&gt;expert20_l3_tp1</title>
<path fill="none" stroke="black" d="M16031.91,-581.4C16040.53,-565.84 16051.71,-545.65 16061.11,-528.65"/>
<polygon fill="black" stroke="black" points="16064.35,-530.03 16066.13,-519.59 16058.23,-526.64 16064.35,-530.03"/>
</g>
<!-- expert21_l3_tp1 -->
<g id="node492" class="node">
<title>expert21_l3_tp1</title>
<polygon fill="lightcoral" stroke="black" points="16380,-519.54 16192,-519.54 16192,-467.54 16380,-467.54 16380,-519.54"/>
<text text-anchor="middle" x="16286" y="-507.54" font-family="Arial" font-size="10.00">Expert 21</text>
<text text-anchor="middle" x="16286" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16286" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16286" y="-474.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l3_tp1&#45;&gt;expert21_l3_tp1 -->
<g id="edge729" class="edge">
<title>norm_l3_tp1&#45;&gt;expert21_l3_tp1</title>
<path fill="none" stroke="black" d="M16090.94,-581.45C16119.87,-571.01 16153.27,-558.35 16183,-545.54 16198.1,-539.03 16214.15,-531.43 16228.97,-524.11"/>
<polygon fill="black" stroke="black" points="16230.63,-527.19 16238.03,-519.6 16227.51,-520.93 16230.63,-527.19"/>
</g>
<!-- expert22_l3_tp1 -->
<g id="node493" class="node">
<title>expert22_l3_tp1</title>
<polygon fill="lightcoral" stroke="black" points="16586,-519.54 16398,-519.54 16398,-467.54 16586,-467.54 16586,-519.54"/>
<text text-anchor="middle" x="16492" y="-507.54" font-family="Arial" font-size="10.00">Expert 22</text>
<text text-anchor="middle" x="16492" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16492" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16492" y="-474.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l3_tp1&#45;&gt;expert22_l3_tp1 -->
<g id="edge731" class="edge">
<title>norm_l3_tp1&#45;&gt;expert22_l3_tp1</title>
<path fill="none" stroke="black" d="M16151.17,-594.33C16222.86,-585.36 16312.11,-570.29 16389,-545.54 16405.99,-540.07 16423.68,-532.2 16439.51,-524.27"/>
<polygon fill="black" stroke="black" points="16441.29,-527.29 16448.59,-519.61 16438.1,-521.06 16441.29,-527.29"/>
</g>
<!-- expert23_l3_tp1 -->
<g id="node494" class="node">
<title>expert23_l3_tp1</title>
<polygon fill="lightcoral" stroke="black" points="16792,-519.54 16604,-519.54 16604,-467.54 16792,-467.54 16792,-519.54"/>
<text text-anchor="middle" x="16698" y="-507.54" font-family="Arial" font-size="10.00">Expert 23</text>
<text text-anchor="middle" x="16698" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16698" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="16698" y="-474.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l3_tp1&#45;&gt;expert23_l3_tp1 -->
<g id="edge733" class="edge">
<title>norm_l3_tp1&#45;&gt;expert23_l3_tp1</title>
<path fill="none" stroke="black" d="M16151.17,-605.73C16269.8,-601.9 16446.99,-588.51 16595,-545.54 16612.46,-540.47 16630.54,-532.55 16646.59,-524.45"/>
<polygon fill="black" stroke="black" points="16648.52,-527.39 16655.78,-519.68 16645.29,-521.18 16648.52,-527.39"/>
</g>
<!-- res_add2_l3_tp1 -->
<g id="node496" class="node">
<title>res_add2_l3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="16116,-265.54 15838,-265.54 15838,-213.54 16116,-213.54 16116,-265.54"/>
<text text-anchor="middle" x="15977" y="-253.54" font-family="Arial" font-size="10.00">Residual Add 2 TP1</text>
<text text-anchor="middle" x="15977" y="-242.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="15977" y="-231.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15977" y="-220.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- norm_l3_tp1&#45;&gt;res_add2_l3_tp1 -->
<g id="edge736" class="edge">
<title>norm_l3_tp1&#45;&gt;res_add2_l3_tp1</title>
<path fill="none" stroke="black" d="M16151.1,-605.8C16363.05,-603.22 16757.89,-592.14 16801,-545.54 16816.69,-528.57 16815.14,-459.82 16801,-441.54 16649.58,-245.76 16502.85,-358.56 16262,-301.54 16212.37,-289.79 16157.63,-277.83 16109.51,-267.66"/>
<polygon fill="black" stroke="black" points="16110.16,-264.22 16099.66,-265.58 16108.72,-271.07 16110.16,-264.22"/>
</g>
<!-- expert_agg_l3_tp1 -->
<g id="node495" class="node">
<title>expert_agg_l3_tp1</title>
<polygon fill="lightpink" stroke="black" points="16252.55,-405.54 15814.21,-405.54 15701.45,-301.54 16139.79,-301.54 16252.55,-405.54"/>
<text text-anchor="middle" x="15977" y="-367.54" font-family="Arial" font-size="10.00">Expert Aggregation TP1</text>
<text text-anchor="middle" x="15977" y="-356.54" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="15977" y="-345.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="15977" y="-334.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- expert16_l3_tp1&#45;&gt;expert_agg_l3_tp1 -->
<g id="edge720" class="edge">
<title>expert16_l3_tp1&#45;&gt;expert_agg_l3_tp1</title>
<path fill="none" stroke="black" d="M15298.83,-467.49C15316.86,-457.98 15338.41,-447.9 15359,-441.54 15489.51,-401.19 15641.37,-379.49 15761.89,-367.84"/>
<polygon fill="black" stroke="black" points="15762.36,-371.32 15771.98,-366.89 15761.7,-364.35 15762.36,-371.32"/>
</g>
<!-- expert17_l3_tp1&#45;&gt;expert_agg_l3_tp1 -->
<g id="edge722" class="edge">
<title>expert17_l3_tp1&#45;&gt;expert_agg_l3_tp1</title>
<path fill="none" stroke="black" d="M15506.32,-467.54C15524.12,-458.31 15545.11,-448.44 15565,-441.54 15633.63,-417.73 15711.05,-399.3 15780.1,-385.65"/>
<polygon fill="black" stroke="black" points="15781.08,-389.03 15790.22,-383.68 15779.74,-382.16 15781.08,-389.03"/>
</g>
<!-- expert18_l3_tp1&#45;&gt;expert_agg_l3_tp1 -->
<g id="edge724" class="edge">
<title>expert18_l3_tp1&#45;&gt;expert_agg_l3_tp1</title>
<path fill="none" stroke="black" d="M15717.22,-467.42C15734.16,-458.97 15753.31,-449.64 15771,-441.54 15794.32,-430.86 15819.31,-419.89 15843.58,-409.51"/>
<polygon fill="black" stroke="black" points="15845.01,-412.7 15852.83,-405.55 15842.26,-406.26 15845.01,-412.7"/>
</g>
<!-- expert19_l3_tp1&#45;&gt;expert_agg_l3_tp1 -->
<g id="edge726" class="edge">
<title>expert19_l3_tp1&#45;&gt;expert_agg_l3_tp1</title>
<path fill="none" stroke="black" d="M15892.89,-467.23C15904.07,-452.25 15918.74,-432.6 15932.68,-413.92"/>
<polygon fill="black" stroke="black" points="15935.64,-415.81 15938.81,-405.7 15930.03,-411.62 15935.64,-415.81"/>
</g>
<!-- expert20_l3_tp1&#45;&gt;expert_agg_l3_tp1 -->
<g id="edge728" class="edge">
<title>expert20_l3_tp1&#45;&gt;expert_agg_l3_tp1</title>
<path fill="none" stroke="black" d="M16061.11,-467.23C16049.93,-452.25 16035.26,-432.6 16021.32,-413.92"/>
<polygon fill="black" stroke="black" points="16023.97,-411.62 16015.19,-405.7 16018.36,-415.81 16023.97,-411.62"/>
</g>
<!-- expert21_l3_tp1&#45;&gt;expert_agg_l3_tp1 -->
<g id="edge730" class="edge">
<title>expert21_l3_tp1&#45;&gt;expert_agg_l3_tp1</title>
<path fill="none" stroke="black" d="M16236.78,-467.42C16219.84,-458.97 16200.69,-449.64 16183,-441.54 16159.68,-430.86 16134.69,-419.89 16110.42,-409.51"/>
<polygon fill="black" stroke="black" points="16111.74,-406.26 16101.17,-405.55 16108.99,-412.7 16111.74,-406.26"/>
</g>
<!-- expert22_l3_tp1&#45;&gt;expert_agg_l3_tp1 -->
<g id="edge732" class="edge">
<title>expert22_l3_tp1&#45;&gt;expert_agg_l3_tp1</title>
<path fill="none" stroke="black" d="M16447.68,-467.54C16429.88,-458.31 16408.89,-448.44 16389,-441.54 16347.34,-427.08 16302.43,-414.61 16258.13,-403.99"/>
<polygon fill="black" stroke="black" points="16258.92,-400.58 16248.38,-401.68 16257.31,-407.39 16258.92,-400.58"/>
</g>
<!-- expert23_l3_tp1&#45;&gt;expert_agg_l3_tp1 -->
<g id="edge734" class="edge">
<title>expert23_l3_tp1&#45;&gt;expert_agg_l3_tp1</title>
<path fill="none" stroke="black" d="M16655.17,-467.49C16637.14,-457.98 16615.59,-447.9 16595,-441.54 16475.81,-404.69 16338.81,-383.39 16224.14,-371.11"/>
<polygon fill="black" stroke="black" points="16224.49,-367.62 16214.17,-370.06 16223.75,-374.58 16224.49,-367.62"/>
</g>
<!-- expert_agg_l3_tp1&#45;&gt;res_add2_l3_tp1 -->
<g id="edge735" class="edge">
<title>expert_agg_l3_tp1&#45;&gt;res_add2_l3_tp1</title>
<path fill="none" stroke="black" d="M15977,-301.46C15977,-292.79 15977,-283.97 15977,-275.82"/>
<polygon fill="black" stroke="black" points="15980.5,-275.58 15977,-265.58 15973.5,-275.58 15980.5,-275.58"/>
</g>
<!-- norm2_l3_tp1 -->
<g id="node497" class="node">
<title>norm2_l3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="14802,-177.54 14536,-177.54 14536,-125.54 14802,-125.54 14802,-177.54"/>
<text text-anchor="middle" x="14669" y="-165.54" font-family="Arial" font-size="10.00">Layer Norm 2 TP1</text>
<text text-anchor="middle" x="14669" y="-154.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14669" y="-143.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="14669" y="-132.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- res_add2_l3_tp1&#45;&gt;norm2_l3_tp1 -->
<g id="edge737" class="edge">
<title>res_add2_l3_tp1&#45;&gt;norm2_l3_tp1</title>
<path fill="none" stroke="black" d="M15837.95,-229.4C15588.01,-212.96 15065.35,-178.6 14812.33,-161.96"/>
<polygon fill="black" stroke="black" points="14812.54,-158.47 14802.34,-161.31 14812.08,-165.45 14812.54,-158.47"/>
</g>
<!-- norm2_l3_tp1&#45;&gt;final_output -->
<g id="edge738" class="edge">
<title>norm2_l3_tp1&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M14535.97,-147.33C13945.76,-133.07 11562.17,-75.51 10858.5,-58.52"/>
<polygon fill="black" stroke="black" points="10858.35,-55.01 10848.26,-58.27 10858.18,-62.01 10858.35,-55.01"/>
</g>
<!-- mha_qkv_l3_tp2 -->
<g id="node499" class="node">
<title>mha_qkv_l3_tp2</title>
<polygon fill="lightgreen" stroke="black" points="13872.5,-1095.08 13581.5,-1095.08 13581.5,-1043.08 13872.5,-1043.08 13872.5,-1095.08"/>
<text text-anchor="middle" x="13727" y="-1083.08" font-family="Arial" font-size="10.00">MHA QKV TP2</text>
<text text-anchor="middle" x="13727" y="-1072.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="13727" y="-1061.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="13727" y="-1050.08" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- input_split_l3_tp2&#45;&gt;mha_qkv_l3_tp2 -->
<g id="edge740" class="edge">
<title>input_split_l3_tp2&#45;&gt;mha_qkv_l3_tp2</title>
<path fill="none" stroke="black" d="M13812.36,-1132.19C13798.41,-1122.04 13783.25,-1111.01 13769.63,-1101.1"/>
<polygon fill="black" stroke="black" points="13771.52,-1098.15 13761.38,-1095.09 13767.41,-1103.81 13771.52,-1098.15"/>
</g>
<!-- res_add_l3_tp2 -->
<g id="node503" class="node">
<title>res_add_l3_tp2</title>
<polygon fill="lightgreen" stroke="black" points="13844,-721.54 13566,-721.54 13566,-669.54 13844,-669.54 13844,-721.54"/>
<text text-anchor="middle" x="13705" y="-709.54" font-family="Arial" font-size="10.00">Residual Add TP2</text>
<text text-anchor="middle" x="13705" y="-698.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="13705" y="-687.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13705" y="-676.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- input_split_l3_tp2&#45;&gt;res_add_l3_tp2 -->
<g id="edge744" class="edge">
<title>input_split_l3_tp2&#45;&gt;res_add_l3_tp2</title>
<path fill="none" stroke="black" d="M13876.45,-1130.88C13891.69,-1094.24 13912,-1035.4 13912,-982.08 13912,-982.08 13912,-982.08 13912,-892.08 13912,-832.12 13939.34,-804.45 13902,-757.54 13889.16,-741.41 13872.13,-729.45 13853.45,-720.6"/>
<polygon fill="black" stroke="black" points="13854.71,-717.34 13844.15,-716.5 13851.89,-723.74 13854.71,-717.34"/>
</g>
<!-- mha_attn_l3_tp2 -->
<g id="node500" class="node">
<title>mha_attn_l3_tp2</title>
<polygon fill="lightgreen" stroke="black" points="13867.5,-1007.08 13576.5,-1007.08 13576.5,-955.08 13867.5,-955.08 13867.5,-1007.08"/>
<text text-anchor="middle" x="13722" y="-995.08" font-family="Arial" font-size="10.00">MHA Attention TP2</text>
<text text-anchor="middle" x="13722" y="-984.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="13722" y="-973.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="13722" y="-962.08" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- mha_qkv_l3_tp2&#45;&gt;mha_attn_l3_tp2 -->
<g id="edge741" class="edge">
<title>mha_qkv_l3_tp2&#45;&gt;mha_attn_l3_tp2</title>
<path fill="none" stroke="black" d="M13725.53,-1042.74C13725.06,-1034.78 13724.54,-1025.84 13724.05,-1017.32"/>
<polygon fill="black" stroke="black" points="13727.54,-1017.01 13723.46,-1007.23 13720.55,-1017.42 13727.54,-1017.01"/>
</g>
<!-- mha_out_l3_tp2 -->
<g id="node501" class="node">
<title>mha_out_l3_tp2</title>
<polygon fill="lightgreen" stroke="black" points="13858,-919.08 13574,-919.08 13574,-867.08 13858,-867.08 13858,-919.08"/>
<text text-anchor="middle" x="13716" y="-907.08" font-family="Arial" font-size="10.00">MHA Output TP2</text>
<text text-anchor="middle" x="13716" y="-896.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="13716" y="-885.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="13716" y="-874.08" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- mha_attn_l3_tp2&#45;&gt;mha_out_l3_tp2 -->
<g id="edge742" class="edge">
<title>mha_attn_l3_tp2&#45;&gt;mha_out_l3_tp2</title>
<path fill="none" stroke="black" d="M13720.23,-954.74C13719.68,-946.78 13719.05,-937.84 13718.46,-929.32"/>
<polygon fill="black" stroke="black" points="13721.94,-928.97 13717.76,-919.23 13714.96,-929.45 13721.94,-928.97"/>
</g>
<!-- attn_allreduce_l3_tp2 -->
<g id="node502" class="node">
<title>attn_allreduce_l3_tp2</title>
<ellipse fill="lightgray" stroke="black" cx="13705" cy="-794.31" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="13705" y="-808.31" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP2</text>
<text text-anchor="middle" x="13705" y="-797.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="13705" y="-786.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13705" y="-775.31" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- mha_out_l3_tp2&#45;&gt;attn_allreduce_l3_tp2 -->
<g id="edge743" class="edge">
<title>mha_out_l3_tp2&#45;&gt;attn_allreduce_l3_tp2</title>
<path fill="none" stroke="black" d="M13713.14,-866.91C13712.25,-859.1 13711.24,-850.23 13710.25,-841.46"/>
<polygon fill="black" stroke="black" points="13713.7,-840.83 13709.09,-831.29 13706.74,-841.62 13713.7,-840.83"/>
</g>
<!-- attn_allreduce_l3_tp2&#45;&gt;res_add_l3_tp2 -->
<g id="edge745" class="edge">
<title>attn_allreduce_l3_tp2&#45;&gt;res_add_l3_tp2</title>
<path fill="none" stroke="black" d="M13705,-757.28C13705,-748.96 13705,-740.13 13705,-731.85"/>
<polygon fill="black" stroke="black" points="13708.5,-731.74 13705,-721.74 13701.5,-731.74 13708.5,-731.74"/>
</g>
<!-- norm_l3_tp2 -->
<g id="node504" class="node">
<title>norm_l3_tp2</title>
<polygon fill="lightgreen" stroke="black" points="13838,-633.54 13572,-633.54 13572,-581.54 13838,-581.54 13838,-633.54"/>
<text text-anchor="middle" x="13705" y="-621.54" font-family="Arial" font-size="10.00">Layer Norm TP2</text>
<text text-anchor="middle" x="13705" y="-610.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13705" y="-599.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13705" y="-588.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- res_add_l3_tp2&#45;&gt;norm_l3_tp2 -->
<g id="edge746" class="edge">
<title>res_add_l3_tp2&#45;&gt;norm_l3_tp2</title>
<path fill="none" stroke="black" d="M13705,-669.2C13705,-661.24 13705,-652.3 13705,-643.78"/>
<polygon fill="black" stroke="black" points="13708.5,-643.7 13705,-633.7 13701.5,-643.7 13708.5,-643.7"/>
</g>
<!-- gate_l3_tp2 -->
<g id="node505" class="node">
<title>gate_l3_tp2</title>
<polygon fill="lightyellow" stroke="black" points="12872.3,-545.54 12405.72,-545.54 12285.7,-441.54 12752.28,-441.54 12872.3,-545.54"/>
<text text-anchor="middle" x="12579" y="-507.54" font-family="Arial" font-size="10.00">Gate Network TP2</text>
<text text-anchor="middle" x="12579" y="-496.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12579" y="-485.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="12579" y="-474.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l3_tp2&#45;&gt;gate_l3_tp2 -->
<g id="edge747" class="edge">
<title>norm_l3_tp2&#45;&gt;gate_l3_tp2</title>
<path fill="none" stroke="black" d="M13571.9,-600.52C13408.69,-592.25 13123.8,-574.96 12881,-545.54 12880.9,-545.53 12880.79,-545.51 12880.69,-545.5"/>
<polygon fill="black" stroke="black" points="12881.4,-542.06 12871.05,-544.31 12880.54,-549.01 12881.4,-542.06"/>
</g>
<!-- expert24_l3_tp2 -->
<g id="node506" class="node">
<title>expert24_l3_tp2</title>
<polygon fill="lightcoral" stroke="black" points="13078,-519.54 12890,-519.54 12890,-467.54 13078,-467.54 13078,-519.54"/>
<text text-anchor="middle" x="12984" y="-507.54" font-family="Arial" font-size="10.00">Expert 24</text>
<text text-anchor="middle" x="12984" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12984" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12984" y="-474.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l3_tp2&#45;&gt;expert24_l3_tp2 -->
<g id="edge748" class="edge">
<title>norm_l3_tp2&#45;&gt;expert24_l3_tp2</title>
<path fill="none" stroke="black" d="M13571.77,-599.02C13418,-589.34 13174.97,-570.75 13087,-545.54 13069.52,-540.53 13051.44,-532.63 13035.39,-524.52"/>
<polygon fill="black" stroke="black" points="13036.69,-521.25 13026.2,-519.75 13033.46,-527.46 13036.69,-521.25"/>
</g>
<!-- expert25_l3_tp2 -->
<g id="node507" class="node">
<title>expert25_l3_tp2</title>
<polygon fill="lightcoral" stroke="black" points="13284,-519.54 13096,-519.54 13096,-467.54 13284,-467.54 13284,-519.54"/>
<text text-anchor="middle" x="13190" y="-507.54" font-family="Arial" font-size="10.00">Expert 25</text>
<text text-anchor="middle" x="13190" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13190" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13190" y="-474.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l3_tp2&#45;&gt;expert25_l3_tp2 -->
<g id="edge750" class="edge">
<title>norm_l3_tp2&#45;&gt;expert25_l3_tp2</title>
<path fill="none" stroke="black" d="M13571.83,-597.44C13489.97,-589.26 13383.74,-573.94 13293,-545.54 13275.89,-540.18 13258.1,-532.3 13242.21,-524.33"/>
<polygon fill="black" stroke="black" points="13243.6,-521.1 13233.1,-519.64 13240.39,-527.33 13243.6,-521.1"/>
</g>
<!-- expert26_l3_tp2 -->
<g id="node508" class="node">
<title>expert26_l3_tp2</title>
<polygon fill="lightcoral" stroke="black" points="13490,-519.54 13302,-519.54 13302,-467.54 13490,-467.54 13490,-519.54"/>
<text text-anchor="middle" x="13396" y="-507.54" font-family="Arial" font-size="10.00">Expert 26</text>
<text text-anchor="middle" x="13396" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13396" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13396" y="-474.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l3_tp2&#45;&gt;expert26_l3_tp2 -->
<g id="edge752" class="edge">
<title>norm_l3_tp2&#45;&gt;expert26_l3_tp2</title>
<path fill="none" stroke="black" d="M13607.94,-581.51C13573.14,-571.57 13533.9,-559.23 13499,-545.54 13483.31,-539.38 13466.76,-531.74 13451.63,-524.26"/>
<polygon fill="black" stroke="black" points="13452.91,-520.99 13442.41,-519.63 13449.78,-527.24 13452.91,-520.99"/>
</g>
<!-- expert27_l3_tp2 -->
<g id="node509" class="node">
<title>expert27_l3_tp2</title>
<polygon fill="lightcoral" stroke="black" points="13696,-519.54 13508,-519.54 13508,-467.54 13696,-467.54 13696,-519.54"/>
<text text-anchor="middle" x="13602" y="-507.54" font-family="Arial" font-size="10.00">Expert 27</text>
<text text-anchor="middle" x="13602" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13602" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13602" y="-474.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l3_tp2&#45;&gt;expert27_l3_tp2 -->
<g id="edge754" class="edge">
<title>norm_l3_tp2&#45;&gt;expert27_l3_tp2</title>
<path fill="none" stroke="black" d="M13681.88,-581.4C13667.17,-565.41 13647.97,-544.53 13632.08,-527.25"/>
<polygon fill="black" stroke="black" points="13634.38,-524.58 13625.04,-519.59 13629.23,-529.32 13634.38,-524.58"/>
</g>
<!-- expert28_l3_tp2 -->
<g id="node510" class="node">
<title>expert28_l3_tp2</title>
<polygon fill="lightcoral" stroke="black" points="13902,-519.54 13714,-519.54 13714,-467.54 13902,-467.54 13902,-519.54"/>
<text text-anchor="middle" x="13808" y="-507.54" font-family="Arial" font-size="10.00">Expert 28</text>
<text text-anchor="middle" x="13808" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13808" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="13808" y="-474.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l3_tp2&#45;&gt;expert28_l3_tp2 -->
<g id="edge756" class="edge">
<title>norm_l3_tp2&#45;&gt;expert28_l3_tp2</title>
<path fill="none" stroke="black" d="M13728.12,-581.4C13742.83,-565.41 13762.03,-544.53 13777.92,-527.25"/>
<polygon fill="black" stroke="black" points="13780.77,-529.32 13784.96,-519.59 13775.62,-524.58 13780.77,-529.32"/>
</g>
<!-- expert29_l3_tp2 -->
<g id="node511" class="node">
<title>expert29_l3_tp2</title>
<polygon fill="lightcoral" stroke="black" points="14108,-519.54 13920,-519.54 13920,-467.54 14108,-467.54 14108,-519.54"/>
<text text-anchor="middle" x="14014" y="-507.54" font-family="Arial" font-size="10.00">Expert 29</text>
<text text-anchor="middle" x="14014" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14014" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14014" y="-474.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l3_tp2&#45;&gt;expert29_l3_tp2 -->
<g id="edge758" class="edge">
<title>norm_l3_tp2&#45;&gt;expert29_l3_tp2</title>
<path fill="none" stroke="black" d="M13802.06,-581.51C13836.86,-571.57 13876.1,-559.23 13911,-545.54 13926.69,-539.38 13943.24,-531.74 13958.37,-524.26"/>
<polygon fill="black" stroke="black" points="13960.22,-527.24 13967.59,-519.63 13957.09,-520.99 13960.22,-527.24"/>
</g>
<!-- expert30_l3_tp2 -->
<g id="node512" class="node">
<title>expert30_l3_tp2</title>
<polygon fill="lightcoral" stroke="black" points="14314,-519.54 14126,-519.54 14126,-467.54 14314,-467.54 14314,-519.54"/>
<text text-anchor="middle" x="14220" y="-507.54" font-family="Arial" font-size="10.00">Expert 30</text>
<text text-anchor="middle" x="14220" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14220" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14220" y="-474.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l3_tp2&#45;&gt;expert30_l3_tp2 -->
<g id="edge760" class="edge">
<title>norm_l3_tp2&#45;&gt;expert30_l3_tp2</title>
<path fill="none" stroke="black" d="M13838.17,-597.44C13920.03,-589.26 14026.26,-573.94 14117,-545.54 14134.11,-540.18 14151.9,-532.3 14167.79,-524.33"/>
<polygon fill="black" stroke="black" points="14169.61,-527.33 14176.9,-519.64 14166.4,-521.1 14169.61,-527.33"/>
</g>
<!-- expert31_l3_tp2 -->
<g id="node513" class="node">
<title>expert31_l3_tp2</title>
<polygon fill="lightcoral" stroke="black" points="14520,-519.54 14332,-519.54 14332,-467.54 14520,-467.54 14520,-519.54"/>
<text text-anchor="middle" x="14426" y="-507.54" font-family="Arial" font-size="10.00">Expert 31</text>
<text text-anchor="middle" x="14426" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14426" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="14426" y="-474.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l3_tp2&#45;&gt;expert31_l3_tp2 -->
<g id="edge762" class="edge">
<title>norm_l3_tp2&#45;&gt;expert31_l3_tp2</title>
<path fill="none" stroke="black" d="M13838.23,-599.02C13992,-589.34 14235.03,-570.75 14323,-545.54 14340.48,-540.53 14358.56,-532.63 14374.61,-524.52"/>
<polygon fill="black" stroke="black" points="14376.54,-527.46 14383.8,-519.75 14373.31,-521.25 14376.54,-527.46"/>
</g>
<!-- res_add2_l3_tp2 -->
<g id="node515" class="node">
<title>res_add2_l3_tp2</title>
<polygon fill="lightgreen" stroke="black" points="13844,-265.54 13566,-265.54 13566,-213.54 13844,-213.54 13844,-265.54"/>
<text text-anchor="middle" x="13705" y="-253.54" font-family="Arial" font-size="10.00">Residual Add 2 TP2</text>
<text text-anchor="middle" x="13705" y="-242.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="13705" y="-231.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13705" y="-220.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- norm_l3_tp2&#45;&gt;res_add2_l3_tp2 -->
<g id="edge765" class="edge">
<title>norm_l3_tp2&#45;&gt;res_add2_l3_tp2</title>
<path fill="none" stroke="black" d="M13838.38,-606.37C14059.68,-604.69 14483.09,-594.97 14529,-545.54 14544.73,-528.6 14543.14,-459.82 14529,-441.54 14377.58,-245.76 14230.85,-358.56 13990,-301.54 13940.37,-289.79 13885.63,-277.83 13837.51,-267.66"/>
<polygon fill="black" stroke="black" points="13838.16,-264.22 13827.66,-265.58 13836.72,-271.07 13838.16,-264.22"/>
</g>
<!-- expert_agg_l3_tp2 -->
<g id="node514" class="node">
<title>expert_agg_l3_tp2</title>
<polygon fill="lightpink" stroke="black" points="13980.55,-405.54 13542.21,-405.54 13429.45,-301.54 13867.79,-301.54 13980.55,-405.54"/>
<text text-anchor="middle" x="13705" y="-367.54" font-family="Arial" font-size="10.00">Expert Aggregation TP2</text>
<text text-anchor="middle" x="13705" y="-356.54" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="13705" y="-345.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="13705" y="-334.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- expert24_l3_tp2&#45;&gt;expert_agg_l3_tp2 -->
<g id="edge749" class="edge">
<title>expert24_l3_tp2&#45;&gt;expert_agg_l3_tp2</title>
<path fill="none" stroke="black" d="M13026.83,-467.49C13044.86,-457.98 13066.41,-447.9 13087,-441.54 13217.51,-401.19 13369.37,-379.49 13489.89,-367.84"/>
<polygon fill="black" stroke="black" points="13490.36,-371.32 13499.98,-366.89 13489.7,-364.35 13490.36,-371.32"/>
</g>
<!-- expert25_l3_tp2&#45;&gt;expert_agg_l3_tp2 -->
<g id="edge751" class="edge">
<title>expert25_l3_tp2&#45;&gt;expert_agg_l3_tp2</title>
<path fill="none" stroke="black" d="M13234.32,-467.54C13252.12,-458.31 13273.11,-448.44 13293,-441.54 13361.63,-417.73 13439.05,-399.3 13508.1,-385.65"/>
<polygon fill="black" stroke="black" points="13509.08,-389.03 13518.22,-383.68 13507.74,-382.16 13509.08,-389.03"/>
</g>
<!-- expert26_l3_tp2&#45;&gt;expert_agg_l3_tp2 -->
<g id="edge753" class="edge">
<title>expert26_l3_tp2&#45;&gt;expert_agg_l3_tp2</title>
<path fill="none" stroke="black" d="M13445.22,-467.42C13462.16,-458.97 13481.31,-449.64 13499,-441.54 13522.32,-430.86 13547.31,-419.89 13571.58,-409.51"/>
<polygon fill="black" stroke="black" points="13573.01,-412.7 13580.83,-405.55 13570.26,-406.26 13573.01,-412.7"/>
</g>
<!-- expert27_l3_tp2&#45;&gt;expert_agg_l3_tp2 -->
<g id="edge755" class="edge">
<title>expert27_l3_tp2&#45;&gt;expert_agg_l3_tp2</title>
<path fill="none" stroke="black" d="M13620.89,-467.23C13632.07,-452.25 13646.74,-432.6 13660.68,-413.92"/>
<polygon fill="black" stroke="black" points="13663.64,-415.81 13666.81,-405.7 13658.03,-411.62 13663.64,-415.81"/>
</g>
<!-- expert28_l3_tp2&#45;&gt;expert_agg_l3_tp2 -->
<g id="edge757" class="edge">
<title>expert28_l3_tp2&#45;&gt;expert_agg_l3_tp2</title>
<path fill="none" stroke="black" d="M13789.11,-467.23C13777.93,-452.25 13763.26,-432.6 13749.32,-413.92"/>
<polygon fill="black" stroke="black" points="13751.97,-411.62 13743.19,-405.7 13746.36,-415.81 13751.97,-411.62"/>
</g>
<!-- expert29_l3_tp2&#45;&gt;expert_agg_l3_tp2 -->
<g id="edge759" class="edge">
<title>expert29_l3_tp2&#45;&gt;expert_agg_l3_tp2</title>
<path fill="none" stroke="black" d="M13964.78,-467.42C13947.84,-458.97 13928.69,-449.64 13911,-441.54 13887.68,-430.86 13862.69,-419.89 13838.42,-409.51"/>
<polygon fill="black" stroke="black" points="13839.74,-406.26 13829.17,-405.55 13836.99,-412.7 13839.74,-406.26"/>
</g>
<!-- expert30_l3_tp2&#45;&gt;expert_agg_l3_tp2 -->
<g id="edge761" class="edge">
<title>expert30_l3_tp2&#45;&gt;expert_agg_l3_tp2</title>
<path fill="none" stroke="black" d="M14175.68,-467.54C14157.88,-458.31 14136.89,-448.44 14117,-441.54 14075.34,-427.08 14030.43,-414.61 13986.13,-403.99"/>
<polygon fill="black" stroke="black" points="13986.92,-400.58 13976.38,-401.68 13985.31,-407.39 13986.92,-400.58"/>
</g>
<!-- expert31_l3_tp2&#45;&gt;expert_agg_l3_tp2 -->
<g id="edge763" class="edge">
<title>expert31_l3_tp2&#45;&gt;expert_agg_l3_tp2</title>
<path fill="none" stroke="black" d="M14383.17,-467.49C14365.14,-457.98 14343.59,-447.9 14323,-441.54 14203.81,-404.69 14066.81,-383.39 13952.14,-371.11"/>
<polygon fill="black" stroke="black" points="13952.49,-367.62 13942.17,-370.06 13951.75,-374.58 13952.49,-367.62"/>
</g>
<!-- expert_agg_l3_tp2&#45;&gt;res_add2_l3_tp2 -->
<g id="edge764" class="edge">
<title>expert_agg_l3_tp2&#45;&gt;res_add2_l3_tp2</title>
<path fill="none" stroke="black" d="M13705,-301.46C13705,-292.79 13705,-283.97 13705,-275.82"/>
<polygon fill="black" stroke="black" points="13708.5,-275.58 13705,-265.58 13701.5,-275.58 13708.5,-275.58"/>
</g>
<!-- norm2_l3_tp2 -->
<g id="node516" class="node">
<title>norm2_l3_tp2</title>
<polygon fill="lightgreen" stroke="black" points="12844,-177.54 12578,-177.54 12578,-125.54 12844,-125.54 12844,-177.54"/>
<text text-anchor="middle" x="12711" y="-165.54" font-family="Arial" font-size="10.00">Layer Norm 2 TP2</text>
<text text-anchor="middle" x="12711" y="-154.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12711" y="-143.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="12711" y="-132.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- res_add2_l3_tp2&#45;&gt;norm2_l3_tp2 -->
<g id="edge766" class="edge">
<title>res_add2_l3_tp2&#45;&gt;norm2_l3_tp2</title>
<path fill="none" stroke="black" d="M13565.74,-226.49C13377.69,-210.22 13044.29,-181.37 12854.22,-164.93"/>
<polygon fill="black" stroke="black" points="12854.42,-161.43 12844.16,-164.06 12853.82,-168.41 12854.42,-161.43"/>
</g>
<!-- norm2_l3_tp2&#45;&gt;final_output -->
<g id="edge767" class="edge">
<title>norm2_l3_tp2&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M12577.74,-144.25C12224.95,-127.58 11265.59,-82.28 10853.87,-62.83"/>
<polygon fill="black" stroke="black" points="10853.8,-59.32 10843.65,-62.35 10853.47,-66.32 10853.8,-59.32"/>
</g>
<!-- mha_qkv_l3_tp3 -->
<g id="node518" class="node">
<title>mha_qkv_l3_tp3</title>
<polygon fill="lightgreen" stroke="black" points="11640.5,-1095.08 11349.5,-1095.08 11349.5,-1043.08 11640.5,-1043.08 11640.5,-1095.08"/>
<text text-anchor="middle" x="11495" y="-1083.08" font-family="Arial" font-size="10.00">MHA QKV TP3</text>
<text text-anchor="middle" x="11495" y="-1072.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="11495" y="-1061.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="11495" y="-1050.08" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- input_split_l3_tp3&#45;&gt;mha_qkv_l3_tp3 -->
<g id="edge769" class="edge">
<title>input_split_l3_tp3&#45;&gt;mha_qkv_l3_tp3</title>
<path fill="none" stroke="black" d="M11537.43,-1131.36C11531.15,-1122.29 11524.41,-1112.56 11518.2,-1103.59"/>
<polygon fill="black" stroke="black" points="11521.01,-1101.49 11512.44,-1095.26 11515.25,-1105.48 11521.01,-1101.49"/>
</g>
<!-- res_add_l3_tp3 -->
<g id="node522" class="node">
<title>res_add_l3_tp3</title>
<polygon fill="lightgreen" stroke="black" points="11623,-721.54 11345,-721.54 11345,-669.54 11623,-669.54 11623,-721.54"/>
<text text-anchor="middle" x="11484" y="-709.54" font-family="Arial" font-size="10.00">Residual Add TP3</text>
<text text-anchor="middle" x="11484" y="-698.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="11484" y="-687.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11484" y="-676.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- input_split_l3_tp3&#45;&gt;res_add_l3_tp3 -->
<g id="edge773" class="edge">
<title>input_split_l3_tp3&#45;&gt;res_add_l3_tp3</title>
<path fill="none" stroke="black" d="M11617.32,-1132.39C11629.97,-1121.93 11642.02,-1109.36 11650,-1095.08 11674.7,-1050.85 11665,-1032.74 11665,-982.08 11665,-982.08 11665,-982.08 11665,-892.08 11665,-832.12 11691.34,-805.23 11655,-757.54 11645.11,-744.56 11632.23,-734.34 11617.97,-726.29"/>
<polygon fill="black" stroke="black" points="11619.42,-723.09 11608.93,-721.55 11616.17,-729.29 11619.42,-723.09"/>
</g>
<!-- mha_attn_l3_tp3 -->
<g id="node519" class="node">
<title>mha_attn_l3_tp3</title>
<polygon fill="lightgreen" stroke="black" points="11635.5,-1007.08 11344.5,-1007.08 11344.5,-955.08 11635.5,-955.08 11635.5,-1007.08"/>
<text text-anchor="middle" x="11490" y="-995.08" font-family="Arial" font-size="10.00">MHA Attention TP3</text>
<text text-anchor="middle" x="11490" y="-984.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="11490" y="-973.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="11490" y="-962.08" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- mha_qkv_l3_tp3&#45;&gt;mha_attn_l3_tp3 -->
<g id="edge770" class="edge">
<title>mha_qkv_l3_tp3&#45;&gt;mha_attn_l3_tp3</title>
<path fill="none" stroke="black" d="M11493.53,-1042.74C11493.06,-1034.78 11492.54,-1025.84 11492.05,-1017.32"/>
<polygon fill="black" stroke="black" points="11495.54,-1017.01 11491.46,-1007.23 11488.55,-1017.42 11495.54,-1017.01"/>
</g>
<!-- mha_out_l3_tp3 -->
<g id="node520" class="node">
<title>mha_out_l3_tp3</title>
<polygon fill="lightgreen" stroke="black" points="11611,-919.08 11327,-919.08 11327,-867.08 11611,-867.08 11611,-919.08"/>
<text text-anchor="middle" x="11469" y="-907.08" font-family="Arial" font-size="10.00">MHA Output TP3</text>
<text text-anchor="middle" x="11469" y="-896.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="11469" y="-885.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="11469" y="-874.08" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- mha_attn_l3_tp3&#45;&gt;mha_out_l3_tp3 -->
<g id="edge771" class="edge">
<title>mha_attn_l3_tp3&#45;&gt;mha_out_l3_tp3</title>
<path fill="none" stroke="black" d="M11483.81,-954.74C11481.85,-946.69 11479.64,-937.64 11477.54,-929.04"/>
<polygon fill="black" stroke="black" points="11480.92,-928.12 11475.14,-919.23 11474.12,-929.78 11480.92,-928.12"/>
</g>
<!-- attn_allreduce_l3_tp3 -->
<g id="node521" class="node">
<title>attn_allreduce_l3_tp3</title>
<ellipse fill="lightgray" stroke="black" cx="11458" cy="-794.31" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="11458" y="-808.31" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP3</text>
<text text-anchor="middle" x="11458" y="-797.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="11458" y="-786.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11458" y="-775.31" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- mha_out_l3_tp3&#45;&gt;attn_allreduce_l3_tp3 -->
<g id="edge772" class="edge">
<title>mha_out_l3_tp3&#45;&gt;attn_allreduce_l3_tp3</title>
<path fill="none" stroke="black" d="M11466.14,-866.91C11465.25,-859.1 11464.24,-850.23 11463.25,-841.46"/>
<polygon fill="black" stroke="black" points="11466.7,-840.83 11462.09,-831.29 11459.74,-841.62 11466.7,-840.83"/>
</g>
<!-- attn_allreduce_l3_tp3&#45;&gt;res_add_l3_tp3 -->
<g id="edge774" class="edge">
<title>attn_allreduce_l3_tp3&#45;&gt;res_add_l3_tp3</title>
<path fill="none" stroke="black" d="M11467.61,-757.55C11469.92,-748.96 11472.38,-739.8 11474.67,-731.25"/>
<polygon fill="black" stroke="black" points="11478.06,-732.15 11477.27,-721.58 11471.3,-730.33 11478.06,-732.15"/>
</g>
<!-- norm_l3_tp3 -->
<g id="node523" class="node">
<title>norm_l3_tp3</title>
<polygon fill="lightgreen" stroke="black" points="11617,-633.54 11351,-633.54 11351,-581.54 11617,-581.54 11617,-633.54"/>
<text text-anchor="middle" x="11484" y="-621.54" font-family="Arial" font-size="10.00">Layer Norm TP3</text>
<text text-anchor="middle" x="11484" y="-610.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11484" y="-599.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11484" y="-588.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- res_add_l3_tp3&#45;&gt;norm_l3_tp3 -->
<g id="edge775" class="edge">
<title>res_add_l3_tp3&#45;&gt;norm_l3_tp3</title>
<path fill="none" stroke="black" d="M11484,-669.2C11484,-661.24 11484,-652.3 11484,-643.78"/>
<polygon fill="black" stroke="black" points="11487.5,-643.7 11484,-633.7 11480.5,-643.7 11487.5,-643.7"/>
</g>
<!-- gate_l3_tp3 -->
<g id="node524" class="node">
<title>gate_l3_tp3</title>
<polygon fill="lightyellow" stroke="black" points="10600.3,-545.54 10133.72,-545.54 10013.7,-441.54 10480.28,-441.54 10600.3,-545.54"/>
<text text-anchor="middle" x="10307" y="-507.54" font-family="Arial" font-size="10.00">Gate Network TP3</text>
<text text-anchor="middle" x="10307" y="-496.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10307" y="-485.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="10307" y="-474.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l3_tp3&#45;&gt;gate_l3_tp3 -->
<g id="edge776" class="edge">
<title>norm_l3_tp3&#45;&gt;gate_l3_tp3</title>
<path fill="none" stroke="black" d="M11350.95,-601.31C11179.11,-593.63 10870.97,-576.72 10609,-545.54 10608.9,-545.53 10608.79,-545.51 10608.69,-545.5"/>
<polygon fill="black" stroke="black" points="10609.4,-542.06 10599.05,-544.33 10608.55,-549.01 10609.4,-542.06"/>
</g>
<!-- expert32_l3_tp3 -->
<g id="node525" class="node">
<title>expert32_l3_tp3</title>
<polygon fill="lightcoral" stroke="black" points="10806,-519.54 10618,-519.54 10618,-467.54 10806,-467.54 10806,-519.54"/>
<text text-anchor="middle" x="10712" y="-507.54" font-family="Arial" font-size="10.00">Expert 32</text>
<text text-anchor="middle" x="10712" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10712" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10712" y="-474.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l3_tp3&#45;&gt;expert32_l3_tp3 -->
<g id="edge777" class="edge">
<title>norm_l3_tp3&#45;&gt;expert32_l3_tp3</title>
<path fill="none" stroke="black" d="M11350.68,-600.19C11185.04,-591.29 10912.36,-573.05 10815,-545.54 10797.34,-540.55 10779.08,-532.57 10762.93,-524.38"/>
<polygon fill="black" stroke="black" points="10764.17,-521.08 10753.68,-519.56 10760.93,-527.29 10764.17,-521.08"/>
</g>
<!-- expert33_l3_tp3 -->
<g id="node526" class="node">
<title>expert33_l3_tp3</title>
<polygon fill="lightcoral" stroke="black" points="11012,-519.54 10824,-519.54 10824,-467.54 11012,-467.54 11012,-519.54"/>
<text text-anchor="middle" x="10918" y="-507.54" font-family="Arial" font-size="10.00">Expert 33</text>
<text text-anchor="middle" x="10918" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10918" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="10918" y="-474.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l3_tp3&#45;&gt;expert33_l3_tp3 -->
<g id="edge779" class="edge">
<title>norm_l3_tp3&#45;&gt;expert33_l3_tp3</title>
<path fill="none" stroke="black" d="M11350.84,-600.59C11256.97,-593.62 11129.2,-578.46 11021,-545.54 11003.77,-540.3 10985.88,-532.41 10969.94,-524.39"/>
<polygon fill="black" stroke="black" points="10971.29,-521.15 10960.8,-519.68 10968.08,-527.37 10971.29,-521.15"/>
</g>
<!-- expert34_l3_tp3 -->
<g id="node527" class="node">
<title>expert34_l3_tp3</title>
<polygon fill="lightcoral" stroke="black" points="11218,-519.54 11030,-519.54 11030,-467.54 11218,-467.54 11218,-519.54"/>
<text text-anchor="middle" x="11124" y="-507.54" font-family="Arial" font-size="10.00">Expert 34</text>
<text text-anchor="middle" x="11124" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11124" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11124" y="-474.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l3_tp3&#45;&gt;expert34_l3_tp3 -->
<g id="edge781" class="edge">
<title>norm_l3_tp3&#45;&gt;expert34_l3_tp3</title>
<path fill="none" stroke="black" d="M11353.23,-581.53C11312.24,-572.09 11267.22,-560.06 11227,-545.54 11210.6,-539.62 11193.41,-531.8 11177.86,-524.07"/>
<polygon fill="black" stroke="black" points="11179.42,-520.94 11168.92,-519.54 11176.26,-527.18 11179.42,-520.94"/>
</g>
<!-- expert35_l3_tp3 -->
<g id="node528" class="node">
<title>expert35_l3_tp3</title>
<polygon fill="lightcoral" stroke="black" points="11424,-519.54 11236,-519.54 11236,-467.54 11424,-467.54 11424,-519.54"/>
<text text-anchor="middle" x="11330" y="-507.54" font-family="Arial" font-size="10.00">Expert 35</text>
<text text-anchor="middle" x="11330" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11330" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11330" y="-474.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l3_tp3&#45;&gt;expert35_l3_tp3 -->
<g id="edge783" class="edge">
<title>norm_l3_tp3&#45;&gt;expert35_l3_tp3</title>
<path fill="none" stroke="black" d="M11449.44,-581.4C11426.75,-564.9 11396.92,-543.21 11372.74,-525.62"/>
<polygon fill="black" stroke="black" points="11374.59,-522.64 11364.45,-519.59 11370.47,-528.3 11374.59,-522.64"/>
</g>
<!-- expert36_l3_tp3 -->
<g id="node529" class="node">
<title>expert36_l3_tp3</title>
<polygon fill="lightcoral" stroke="black" points="11630,-519.54 11442,-519.54 11442,-467.54 11630,-467.54 11630,-519.54"/>
<text text-anchor="middle" x="11536" y="-507.54" font-family="Arial" font-size="10.00">Expert 36</text>
<text text-anchor="middle" x="11536" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11536" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11536" y="-474.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l3_tp3&#45;&gt;expert36_l3_tp3 -->
<g id="edge785" class="edge">
<title>norm_l3_tp3&#45;&gt;expert36_l3_tp3</title>
<path fill="none" stroke="black" d="M11495.67,-581.4C11502.83,-565.98 11512.1,-546.03 11519.94,-529.13"/>
<polygon fill="black" stroke="black" points="11523.33,-530.13 11524.37,-519.59 11516.98,-527.19 11523.33,-530.13"/>
</g>
<!-- expert37_l3_tp3 -->
<g id="node530" class="node">
<title>expert37_l3_tp3</title>
<polygon fill="lightcoral" stroke="black" points="11836,-519.54 11648,-519.54 11648,-467.54 11836,-467.54 11836,-519.54"/>
<text text-anchor="middle" x="11742" y="-507.54" font-family="Arial" font-size="10.00">Expert 37</text>
<text text-anchor="middle" x="11742" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11742" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11742" y="-474.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l3_tp3&#45;&gt;expert37_l3_tp3 -->
<g id="edge787" class="edge">
<title>norm_l3_tp3&#45;&gt;expert37_l3_tp3</title>
<path fill="none" stroke="black" d="M11551.27,-581.49C11578.7,-570.91 11610.58,-558.14 11639,-545.54 11653.88,-538.94 11669.73,-531.37 11684.43,-524.12"/>
<polygon fill="black" stroke="black" points="11686.02,-527.24 11693.41,-519.65 11682.9,-520.97 11686.02,-527.24"/>
</g>
<!-- expert38_l3_tp3 -->
<g id="node531" class="node">
<title>expert38_l3_tp3</title>
<polygon fill="lightcoral" stroke="black" points="12042,-519.54 11854,-519.54 11854,-467.54 12042,-467.54 12042,-519.54"/>
<text text-anchor="middle" x="11948" y="-507.54" font-family="Arial" font-size="10.00">Expert 38</text>
<text text-anchor="middle" x="11948" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11948" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="11948" y="-474.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l3_tp3&#45;&gt;expert38_l3_tp3 -->
<g id="edge789" class="edge">
<title>norm_l3_tp3&#45;&gt;expert38_l3_tp3</title>
<path fill="none" stroke="black" d="M11617.4,-593.44C11686.49,-584.31 11771.54,-569.36 11845,-545.54 11861.98,-540.03 11879.67,-532.15 11895.49,-524.22"/>
<polygon fill="black" stroke="black" points="11897.28,-527.24 11904.58,-519.57 11894.08,-521.01 11897.28,-527.24"/>
</g>
<!-- expert39_l3_tp3 -->
<g id="node532" class="node">
<title>expert39_l3_tp3</title>
<polygon fill="lightcoral" stroke="black" points="12248,-519.54 12060,-519.54 12060,-467.54 12248,-467.54 12248,-519.54"/>
<text text-anchor="middle" x="12154" y="-507.54" font-family="Arial" font-size="10.00">Expert 39</text>
<text text-anchor="middle" x="12154" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12154" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="12154" y="-474.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l3_tp3&#45;&gt;expert39_l3_tp3 -->
<g id="edge791" class="edge">
<title>norm_l3_tp3&#45;&gt;expert39_l3_tp3</title>
<path fill="none" stroke="black" d="M11617.16,-605.36C11733.72,-601.24 11906.52,-587.63 12051,-545.54 12068.46,-540.45 12086.53,-532.53 12102.58,-524.43"/>
<polygon fill="black" stroke="black" points="12104.51,-527.37 12111.77,-519.66 12101.29,-521.16 12104.51,-527.37"/>
</g>
<!-- res_add2_l3_tp3 -->
<g id="node534" class="node">
<title>res_add2_l3_tp3</title>
<polygon fill="lightgreen" stroke="black" points="11572,-265.54 11294,-265.54 11294,-213.54 11572,-213.54 11572,-265.54"/>
<text text-anchor="middle" x="11433" y="-253.54" font-family="Arial" font-size="10.00">Residual Add 2 TP3</text>
<text text-anchor="middle" x="11433" y="-242.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="11433" y="-231.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11433" y="-220.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- norm_l3_tp3&#45;&gt;res_add2_l3_tp3 -->
<g id="edge794" class="edge">
<title>norm_l3_tp3&#45;&gt;res_add2_l3_tp3</title>
<path fill="none" stroke="black" d="M11617.1,-605.65C11826.75,-602.85 12214.57,-591.45 12257,-545.54 12272.69,-528.57 12271.14,-459.82 12257,-441.54 12105.58,-245.76 11958.85,-358.56 11718,-301.54 11668.37,-289.79 11613.63,-277.83 11565.51,-267.66"/>
<polygon fill="black" stroke="black" points="11566.16,-264.22 11555.66,-265.58 11564.72,-271.07 11566.16,-264.22"/>
</g>
<!-- expert_agg_l3_tp3 -->
<g id="node533" class="node">
<title>expert_agg_l3_tp3</title>
<polygon fill="lightpink" stroke="black" points="11708.55,-405.54 11270.21,-405.54 11157.45,-301.54 11595.79,-301.54 11708.55,-405.54"/>
<text text-anchor="middle" x="11433" y="-367.54" font-family="Arial" font-size="10.00">Expert Aggregation TP3</text>
<text text-anchor="middle" x="11433" y="-356.54" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="11433" y="-345.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11433" y="-334.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- expert32_l3_tp3&#45;&gt;expert_agg_l3_tp3 -->
<g id="edge778" class="edge">
<title>expert32_l3_tp3&#45;&gt;expert_agg_l3_tp3</title>
<path fill="none" stroke="black" d="M10754.83,-467.49C10772.86,-457.98 10794.41,-447.9 10815,-441.54 10945.51,-401.19 11097.37,-379.49 11217.89,-367.84"/>
<polygon fill="black" stroke="black" points="11218.36,-371.32 11227.98,-366.89 11217.7,-364.35 11218.36,-371.32"/>
</g>
<!-- expert33_l3_tp3&#45;&gt;expert_agg_l3_tp3 -->
<g id="edge780" class="edge">
<title>expert33_l3_tp3&#45;&gt;expert_agg_l3_tp3</title>
<path fill="none" stroke="black" d="M10962.32,-467.54C10980.12,-458.31 11001.11,-448.44 11021,-441.54 11089.63,-417.73 11167.05,-399.3 11236.1,-385.65"/>
<polygon fill="black" stroke="black" points="11237.08,-389.03 11246.22,-383.68 11235.74,-382.16 11237.08,-389.03"/>
</g>
<!-- expert34_l3_tp3&#45;&gt;expert_agg_l3_tp3 -->
<g id="edge782" class="edge">
<title>expert34_l3_tp3&#45;&gt;expert_agg_l3_tp3</title>
<path fill="none" stroke="black" d="M11173.22,-467.42C11190.16,-458.97 11209.31,-449.64 11227,-441.54 11250.32,-430.86 11275.31,-419.89 11299.58,-409.51"/>
<polygon fill="black" stroke="black" points="11301.01,-412.7 11308.83,-405.55 11298.26,-406.26 11301.01,-412.7"/>
</g>
<!-- expert35_l3_tp3&#45;&gt;expert_agg_l3_tp3 -->
<g id="edge784" class="edge">
<title>expert35_l3_tp3&#45;&gt;expert_agg_l3_tp3</title>
<path fill="none" stroke="black" d="M11348.89,-467.23C11360.07,-452.25 11374.74,-432.6 11388.68,-413.92"/>
<polygon fill="black" stroke="black" points="11391.64,-415.81 11394.81,-405.7 11386.03,-411.62 11391.64,-415.81"/>
</g>
<!-- expert36_l3_tp3&#45;&gt;expert_agg_l3_tp3 -->
<g id="edge786" class="edge">
<title>expert36_l3_tp3&#45;&gt;expert_agg_l3_tp3</title>
<path fill="none" stroke="black" d="M11517.11,-467.23C11505.93,-452.25 11491.26,-432.6 11477.32,-413.92"/>
<polygon fill="black" stroke="black" points="11479.97,-411.62 11471.19,-405.7 11474.36,-415.81 11479.97,-411.62"/>
</g>
<!-- expert37_l3_tp3&#45;&gt;expert_agg_l3_tp3 -->
<g id="edge788" class="edge">
<title>expert37_l3_tp3&#45;&gt;expert_agg_l3_tp3</title>
<path fill="none" stroke="black" d="M11692.78,-467.42C11675.84,-458.97 11656.69,-449.64 11639,-441.54 11615.68,-430.86 11590.69,-419.89 11566.42,-409.51"/>
<polygon fill="black" stroke="black" points="11567.74,-406.26 11557.17,-405.55 11564.99,-412.7 11567.74,-406.26"/>
</g>
<!-- expert38_l3_tp3&#45;&gt;expert_agg_l3_tp3 -->
<g id="edge790" class="edge">
<title>expert38_l3_tp3&#45;&gt;expert_agg_l3_tp3</title>
<path fill="none" stroke="black" d="M11903.68,-467.54C11885.88,-458.31 11864.89,-448.44 11845,-441.54 11803.34,-427.08 11758.43,-414.61 11714.13,-403.99"/>
<polygon fill="black" stroke="black" points="11714.92,-400.58 11704.38,-401.68 11713.31,-407.39 11714.92,-400.58"/>
</g>
<!-- expert39_l3_tp3&#45;&gt;expert_agg_l3_tp3 -->
<g id="edge792" class="edge">
<title>expert39_l3_tp3&#45;&gt;expert_agg_l3_tp3</title>
<path fill="none" stroke="black" d="M12111.17,-467.49C12093.14,-457.98 12071.59,-447.9 12051,-441.54 11931.81,-404.69 11794.81,-383.39 11680.14,-371.11"/>
<polygon fill="black" stroke="black" points="11680.49,-367.62 11670.17,-370.06 11679.75,-374.58 11680.49,-367.62"/>
</g>
<!-- expert_agg_l3_tp3&#45;&gt;res_add2_l3_tp3 -->
<g id="edge793" class="edge">
<title>expert_agg_l3_tp3&#45;&gt;res_add2_l3_tp3</title>
<path fill="none" stroke="black" d="M11433,-301.46C11433,-292.79 11433,-283.97 11433,-275.82"/>
<polygon fill="black" stroke="black" points="11436.5,-275.58 11433,-265.58 11429.5,-275.58 11436.5,-275.58"/>
</g>
<!-- norm2_l3_tp3 -->
<g id="node535" class="node">
<title>norm2_l3_tp3</title>
<polygon fill="lightgreen" stroke="black" points="11200,-177.54 10934,-177.54 10934,-125.54 11200,-125.54 11200,-177.54"/>
<text text-anchor="middle" x="11067" y="-165.54" font-family="Arial" font-size="10.00">Layer Norm 2 TP3</text>
<text text-anchor="middle" x="11067" y="-154.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11067" y="-143.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="11067" y="-132.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- res_add2_l3_tp3&#45;&gt;norm2_l3_tp3 -->
<g id="edge795" class="edge">
<title>res_add2_l3_tp3&#45;&gt;norm2_l3_tp3</title>
<path fill="none" stroke="black" d="M11326.15,-213.43C11281.43,-202.93 11229.33,-190.68 11183.62,-179.94"/>
<polygon fill="black" stroke="black" points="11184.2,-176.48 11173.66,-177.6 11182.6,-183.3 11184.2,-176.48"/>
</g>
<!-- norm2_l3_tp3&#45;&gt;final_output -->
<g id="edge796" class="edge">
<title>norm2_l3_tp3&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M10962.18,-125.49C10909.22,-112.84 10844.55,-97.39 10788.82,-84.07"/>
<polygon fill="black" stroke="black" points="10789.42,-80.62 10778.88,-81.7 10787.79,-87.42 10789.42,-80.62"/>
</g>
<!-- mha_qkv_l3_tp4 -->
<g id="node537" class="node">
<title>mha_qkv_l3_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9292.5,-1095.08 9001.5,-1095.08 9001.5,-1043.08 9292.5,-1043.08 9292.5,-1095.08"/>
<text text-anchor="middle" x="9147" y="-1083.08" font-family="Arial" font-size="10.00">MHA QKV TP4</text>
<text text-anchor="middle" x="9147" y="-1072.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9147" y="-1061.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9147" y="-1050.08" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- input_split_l3_tp4&#45;&gt;mha_qkv_l3_tp4 -->
<g id="edge798" class="edge">
<title>input_split_l3_tp4&#45;&gt;mha_qkv_l3_tp4</title>
<path fill="none" stroke="black" d="M9256.42,-1132.73C9238.05,-1122.21 9217.95,-1110.71 9200.05,-1100.46"/>
<polygon fill="black" stroke="black" points="9201.33,-1097.15 9190.91,-1095.22 9197.85,-1103.23 9201.33,-1097.15"/>
</g>
<!-- res_add_l3_tp4 -->
<g id="node541" class="node">
<title>res_add_l3_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9300,-721.54 9022,-721.54 9022,-669.54 9300,-669.54 9300,-721.54"/>
<text text-anchor="middle" x="9161" y="-709.54" font-family="Arial" font-size="10.00">Residual Add TP4</text>
<text text-anchor="middle" x="9161" y="-698.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="9161" y="-687.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9161" y="-676.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- input_split_l3_tp4&#45;&gt;res_add_l3_tp4 -->
<g id="edge802" class="edge">
<title>input_split_l3_tp4&#45;&gt;res_add_l3_tp4</title>
<path fill="none" stroke="black" d="M9316,-1130.73C9316,-1093.49 9316,-1033.72 9316,-982.08 9316,-982.08 9316,-982.08 9316,-892.08 9316,-832.12 9341,-806.22 9306,-757.54 9296.69,-744.59 9284.09,-734.38 9270.17,-726.33"/>
<polygon fill="black" stroke="black" points="9271.83,-723.24 9261.36,-721.58 9268.51,-729.4 9271.83,-723.24"/>
</g>
<!-- mha_attn_l3_tp4 -->
<g id="node538" class="node">
<title>mha_attn_l3_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9281.5,-1007.08 8990.5,-1007.08 8990.5,-955.08 9281.5,-955.08 9281.5,-1007.08"/>
<text text-anchor="middle" x="9136" y="-995.08" font-family="Arial" font-size="10.00">MHA Attention TP4</text>
<text text-anchor="middle" x="9136" y="-984.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9136" y="-973.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9136" y="-962.08" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- mha_qkv_l3_tp4&#45;&gt;mha_attn_l3_tp4 -->
<g id="edge799" class="edge">
<title>mha_qkv_l3_tp4&#45;&gt;mha_attn_l3_tp4</title>
<path fill="none" stroke="black" d="M9143.76,-1042.74C9142.74,-1034.78 9141.6,-1025.84 9140.51,-1017.32"/>
<polygon fill="black" stroke="black" points="9143.96,-1016.71 9139.22,-1007.23 9137.01,-1017.6 9143.96,-1016.71"/>
</g>
<!-- mha_out_l3_tp4 -->
<g id="node539" class="node">
<title>mha_out_l3_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9272,-919.08 8988,-919.08 8988,-867.08 9272,-867.08 9272,-919.08"/>
<text text-anchor="middle" x="9130" y="-907.08" font-family="Arial" font-size="10.00">MHA Output TP4</text>
<text text-anchor="middle" x="9130" y="-896.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="9130" y="-885.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9130" y="-874.08" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- mha_attn_l3_tp4&#45;&gt;mha_out_l3_tp4 -->
<g id="edge800" class="edge">
<title>mha_attn_l3_tp4&#45;&gt;mha_out_l3_tp4</title>
<path fill="none" stroke="black" d="M9134.23,-954.74C9133.68,-946.78 9133.05,-937.84 9132.46,-929.32"/>
<polygon fill="black" stroke="black" points="9135.94,-928.97 9131.76,-919.23 9128.96,-929.45 9135.94,-928.97"/>
</g>
<!-- attn_allreduce_l3_tp4 -->
<g id="node540" class="node">
<title>attn_allreduce_l3_tp4</title>
<ellipse fill="lightgray" stroke="black" cx="9109" cy="-794.31" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="9109" y="-808.31" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP4</text>
<text text-anchor="middle" x="9109" y="-797.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="9109" y="-786.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9109" y="-775.31" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- mha_out_l3_tp4&#45;&gt;attn_allreduce_l3_tp4 -->
<g id="edge801" class="edge">
<title>mha_out_l3_tp4&#45;&gt;attn_allreduce_l3_tp4</title>
<path fill="none" stroke="black" d="M9124.54,-866.91C9122.82,-859.01 9120.88,-850.04 9118.95,-841.18"/>
<polygon fill="black" stroke="black" points="9122.35,-840.32 9116.81,-831.29 9115.51,-841.8 9122.35,-840.32"/>
</g>
<!-- attn_allreduce_l3_tp4&#45;&gt;res_add_l3_tp4 -->
<g id="edge803" class="edge">
<title>attn_allreduce_l3_tp4&#45;&gt;res_add_l3_tp4</title>
<path fill="none" stroke="black" d="M9128.22,-757.55C9132.98,-748.68 9138.08,-739.2 9142.79,-730.42"/>
<polygon fill="black" stroke="black" points="9145.89,-732.05 9147.54,-721.58 9139.73,-728.73 9145.89,-732.05"/>
</g>
<!-- norm_l3_tp4 -->
<g id="node542" class="node">
<title>norm_l3_tp4</title>
<polygon fill="lightgreen" stroke="black" points="9294,-633.54 9028,-633.54 9028,-581.54 9294,-581.54 9294,-633.54"/>
<text text-anchor="middle" x="9161" y="-621.54" font-family="Arial" font-size="10.00">Layer Norm TP4</text>
<text text-anchor="middle" x="9161" y="-610.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9161" y="-599.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9161" y="-588.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- res_add_l3_tp4&#45;&gt;norm_l3_tp4 -->
<g id="edge804" class="edge">
<title>res_add_l3_tp4&#45;&gt;norm_l3_tp4</title>
<path fill="none" stroke="black" d="M9161,-669.2C9161,-661.24 9161,-652.3 9161,-643.78"/>
<polygon fill="black" stroke="black" points="9164.5,-643.7 9161,-633.7 9157.5,-643.7 9164.5,-643.7"/>
</g>
<!-- gate_l3_tp4 -->
<g id="node543" class="node">
<title>gate_l3_tp4</title>
<polygon fill="lightyellow" stroke="black" points="8328.3,-545.54 7861.72,-545.54 7741.7,-441.54 8208.28,-441.54 8328.3,-545.54"/>
<text text-anchor="middle" x="8035" y="-507.54" font-family="Arial" font-size="10.00">Gate Network TP4</text>
<text text-anchor="middle" x="8035" y="-496.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8035" y="-485.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="8035" y="-474.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l3_tp4&#45;&gt;gate_l3_tp4 -->
<g id="edge805" class="edge">
<title>norm_l3_tp4&#45;&gt;gate_l3_tp4</title>
<path fill="none" stroke="black" d="M9027.9,-600.52C8864.69,-592.25 8579.8,-574.96 8337,-545.54 8336.9,-545.53 8336.79,-545.51 8336.69,-545.5"/>
<polygon fill="black" stroke="black" points="8337.4,-542.06 8327.05,-544.31 8336.54,-549.01 8337.4,-542.06"/>
</g>
<!-- expert40_l3_tp4 -->
<g id="node544" class="node">
<title>expert40_l3_tp4</title>
<polygon fill="lightcoral" stroke="black" points="8534,-519.54 8346,-519.54 8346,-467.54 8534,-467.54 8534,-519.54"/>
<text text-anchor="middle" x="8440" y="-507.54" font-family="Arial" font-size="10.00">Expert 40</text>
<text text-anchor="middle" x="8440" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8440" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8440" y="-474.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l3_tp4&#45;&gt;expert40_l3_tp4 -->
<g id="edge806" class="edge">
<title>norm_l3_tp4&#45;&gt;expert40_l3_tp4</title>
<path fill="none" stroke="black" d="M9027.77,-599.02C8874,-589.34 8630.97,-570.75 8543,-545.54 8525.52,-540.53 8507.44,-532.63 8491.39,-524.52"/>
<polygon fill="black" stroke="black" points="8492.69,-521.25 8482.2,-519.75 8489.46,-527.46 8492.69,-521.25"/>
</g>
<!-- expert41_l3_tp4 -->
<g id="node545" class="node">
<title>expert41_l3_tp4</title>
<polygon fill="lightcoral" stroke="black" points="8740,-519.54 8552,-519.54 8552,-467.54 8740,-467.54 8740,-519.54"/>
<text text-anchor="middle" x="8646" y="-507.54" font-family="Arial" font-size="10.00">Expert 41</text>
<text text-anchor="middle" x="8646" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8646" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8646" y="-474.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l3_tp4&#45;&gt;expert41_l3_tp4 -->
<g id="edge808" class="edge">
<title>norm_l3_tp4&#45;&gt;expert41_l3_tp4</title>
<path fill="none" stroke="black" d="M9027.83,-597.44C8945.97,-589.26 8839.74,-573.94 8749,-545.54 8731.89,-540.18 8714.1,-532.3 8698.21,-524.33"/>
<polygon fill="black" stroke="black" points="8699.6,-521.1 8689.1,-519.64 8696.39,-527.33 8699.6,-521.1"/>
</g>
<!-- expert42_l3_tp4 -->
<g id="node546" class="node">
<title>expert42_l3_tp4</title>
<polygon fill="lightcoral" stroke="black" points="8946,-519.54 8758,-519.54 8758,-467.54 8946,-467.54 8946,-519.54"/>
<text text-anchor="middle" x="8852" y="-507.54" font-family="Arial" font-size="10.00">Expert 42</text>
<text text-anchor="middle" x="8852" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8852" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="8852" y="-474.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l3_tp4&#45;&gt;expert42_l3_tp4 -->
<g id="edge810" class="edge">
<title>norm_l3_tp4&#45;&gt;expert42_l3_tp4</title>
<path fill="none" stroke="black" d="M9063.94,-581.51C9029.14,-571.57 8989.9,-559.23 8955,-545.54 8939.31,-539.38 8922.76,-531.74 8907.63,-524.26"/>
<polygon fill="black" stroke="black" points="8908.91,-520.99 8898.41,-519.63 8905.78,-527.24 8908.91,-520.99"/>
</g>
<!-- expert43_l3_tp4 -->
<g id="node547" class="node">
<title>expert43_l3_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9152,-519.54 8964,-519.54 8964,-467.54 9152,-467.54 9152,-519.54"/>
<text text-anchor="middle" x="9058" y="-507.54" font-family="Arial" font-size="10.00">Expert 43</text>
<text text-anchor="middle" x="9058" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9058" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9058" y="-474.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l3_tp4&#45;&gt;expert43_l3_tp4 -->
<g id="edge812" class="edge">
<title>norm_l3_tp4&#45;&gt;expert43_l3_tp4</title>
<path fill="none" stroke="black" d="M9137.88,-581.4C9123.17,-565.41 9103.97,-544.53 9088.08,-527.25"/>
<polygon fill="black" stroke="black" points="9090.38,-524.58 9081.04,-519.59 9085.23,-529.32 9090.38,-524.58"/>
</g>
<!-- expert44_l3_tp4 -->
<g id="node548" class="node">
<title>expert44_l3_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9358,-519.54 9170,-519.54 9170,-467.54 9358,-467.54 9358,-519.54"/>
<text text-anchor="middle" x="9264" y="-507.54" font-family="Arial" font-size="10.00">Expert 44</text>
<text text-anchor="middle" x="9264" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9264" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9264" y="-474.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l3_tp4&#45;&gt;expert44_l3_tp4 -->
<g id="edge814" class="edge">
<title>norm_l3_tp4&#45;&gt;expert44_l3_tp4</title>
<path fill="none" stroke="black" d="M9184.12,-581.4C9198.83,-565.41 9218.03,-544.53 9233.92,-527.25"/>
<polygon fill="black" stroke="black" points="9236.77,-529.32 9240.96,-519.59 9231.62,-524.58 9236.77,-529.32"/>
</g>
<!-- expert45_l3_tp4 -->
<g id="node549" class="node">
<title>expert45_l3_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9564,-519.54 9376,-519.54 9376,-467.54 9564,-467.54 9564,-519.54"/>
<text text-anchor="middle" x="9470" y="-507.54" font-family="Arial" font-size="10.00">Expert 45</text>
<text text-anchor="middle" x="9470" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9470" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9470" y="-474.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l3_tp4&#45;&gt;expert45_l3_tp4 -->
<g id="edge816" class="edge">
<title>norm_l3_tp4&#45;&gt;expert45_l3_tp4</title>
<path fill="none" stroke="black" d="M9258.06,-581.51C9292.86,-571.57 9332.1,-559.23 9367,-545.54 9382.69,-539.38 9399.24,-531.74 9414.37,-524.26"/>
<polygon fill="black" stroke="black" points="9416.22,-527.24 9423.59,-519.63 9413.09,-520.99 9416.22,-527.24"/>
</g>
<!-- expert46_l3_tp4 -->
<g id="node550" class="node">
<title>expert46_l3_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9770,-519.54 9582,-519.54 9582,-467.54 9770,-467.54 9770,-519.54"/>
<text text-anchor="middle" x="9676" y="-507.54" font-family="Arial" font-size="10.00">Expert 46</text>
<text text-anchor="middle" x="9676" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9676" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9676" y="-474.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l3_tp4&#45;&gt;expert46_l3_tp4 -->
<g id="edge818" class="edge">
<title>norm_l3_tp4&#45;&gt;expert46_l3_tp4</title>
<path fill="none" stroke="black" d="M9294.17,-597.44C9376.03,-589.26 9482.26,-573.94 9573,-545.54 9590.11,-540.18 9607.9,-532.3 9623.79,-524.33"/>
<polygon fill="black" stroke="black" points="9625.61,-527.33 9632.9,-519.64 9622.4,-521.1 9625.61,-527.33"/>
</g>
<!-- expert47_l3_tp4 -->
<g id="node551" class="node">
<title>expert47_l3_tp4</title>
<polygon fill="lightcoral" stroke="black" points="9976,-519.54 9788,-519.54 9788,-467.54 9976,-467.54 9976,-519.54"/>
<text text-anchor="middle" x="9882" y="-507.54" font-family="Arial" font-size="10.00">Expert 47</text>
<text text-anchor="middle" x="9882" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9882" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="9882" y="-474.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l3_tp4&#45;&gt;expert47_l3_tp4 -->
<g id="edge820" class="edge">
<title>norm_l3_tp4&#45;&gt;expert47_l3_tp4</title>
<path fill="none" stroke="black" d="M9294.23,-599.02C9448,-589.34 9691.03,-570.75 9779,-545.54 9796.48,-540.53 9814.56,-532.63 9830.61,-524.52"/>
<polygon fill="black" stroke="black" points="9832.54,-527.46 9839.8,-519.75 9829.31,-521.25 9832.54,-527.46"/>
</g>
<!-- res_add2_l3_tp4 -->
<g id="node553" class="node">
<title>res_add2_l3_tp4</title>
<polygon fill="lightgreen" stroke="black" points="10134,-265.54 9856,-265.54 9856,-213.54 10134,-213.54 10134,-265.54"/>
<text text-anchor="middle" x="9995" y="-253.54" font-family="Arial" font-size="10.00">Residual Add 2 TP4</text>
<text text-anchor="middle" x="9995" y="-242.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="9995" y="-231.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9995" y="-220.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- norm_l3_tp4&#45;&gt;res_add2_l3_tp4 -->
<g id="edge823" class="edge">
<title>norm_l3_tp4&#45;&gt;res_add2_l3_tp4</title>
<path fill="none" stroke="black" d="M9294.21,-606.21C9515.25,-604.29 9938.29,-594.21 9985,-545.54 10003.31,-526.46 9999.14,-351.7 9996.42,-275.64"/>
<polygon fill="black" stroke="black" points="9999.92,-275.45 9996.05,-265.59 9992.92,-275.71 9999.92,-275.45"/>
</g>
<!-- expert_agg_l3_tp4 -->
<g id="node552" class="node">
<title>expert_agg_l3_tp4</title>
<polygon fill="lightpink" stroke="black" points="9539.55,-405.54 9101.21,-405.54 8988.45,-301.54 9426.79,-301.54 9539.55,-405.54"/>
<text text-anchor="middle" x="9264" y="-367.54" font-family="Arial" font-size="10.00">Expert Aggregation TP4</text>
<text text-anchor="middle" x="9264" y="-356.54" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="9264" y="-345.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="9264" y="-334.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- expert40_l3_tp4&#45;&gt;expert_agg_l3_tp4 -->
<g id="edge807" class="edge">
<title>expert40_l3_tp4&#45;&gt;expert_agg_l3_tp4</title>
<path fill="none" stroke="black" d="M8482.77,-467.29C8500.79,-457.74 8522.35,-447.7 8543,-441.54 8706.12,-392.88 8897.72,-371.34 9042.39,-361.86"/>
<polygon fill="black" stroke="black" points="9042.97,-365.33 9052.72,-361.2 9042.52,-358.34 9042.97,-365.33"/>
</g>
<!-- expert41_l3_tp4&#45;&gt;expert_agg_l3_tp4 -->
<g id="edge809" class="edge">
<title>expert41_l3_tp4&#45;&gt;expert_agg_l3_tp4</title>
<path fill="none" stroke="black" d="M8689.42,-467.51C8707.36,-458.11 8728.69,-448.12 8749,-441.54 8847.93,-409.46 8961.58,-388.66 9056.91,-375.48"/>
<polygon fill="black" stroke="black" points="9057.53,-378.93 9066.96,-374.11 9056.58,-371.99 9057.53,-378.93"/>
</g>
<!-- expert42_l3_tp4&#45;&gt;expert_agg_l3_tp4 -->
<g id="edge811" class="edge">
<title>expert42_l3_tp4&#45;&gt;expert_agg_l3_tp4</title>
<path fill="none" stroke="black" d="M8898.1,-467.44C8915.59,-458.52 8935.91,-448.88 8955,-441.54 8995.42,-426 9039.76,-411.88 9081.93,-399.74"/>
<polygon fill="black" stroke="black" points="9083.09,-403.05 9091.74,-396.94 9081.17,-396.32 9083.09,-403.05"/>
</g>
<!-- expert43_l3_tp4&#45;&gt;expert_agg_l3_tp4 -->
<g id="edge813" class="edge">
<title>expert43_l3_tp4&#45;&gt;expert_agg_l3_tp4</title>
<path fill="none" stroke="black" d="M9095.78,-467.23C9119.15,-451.58 9150.12,-430.83 9179.11,-411.41"/>
<polygon fill="black" stroke="black" points="9181.27,-414.18 9187.63,-405.7 9177.37,-408.36 9181.27,-414.18"/>
</g>
<!-- expert44_l3_tp4&#45;&gt;expert_agg_l3_tp4 -->
<g id="edge815" class="edge">
<title>expert44_l3_tp4&#45;&gt;expert_agg_l3_tp4</title>
<path fill="none" stroke="black" d="M9264,-467.23C9264,-452.79 9264,-434.01 9264,-415.93"/>
<polygon fill="black" stroke="black" points="9267.5,-415.7 9264,-405.7 9260.5,-415.7 9267.5,-415.7"/>
</g>
<!-- expert45_l3_tp4&#45;&gt;expert_agg_l3_tp4 -->
<g id="edge817" class="edge">
<title>expert45_l3_tp4&#45;&gt;expert_agg_l3_tp4</title>
<path fill="none" stroke="black" d="M9432.22,-467.23C9408.85,-451.58 9377.88,-430.83 9348.89,-411.41"/>
<polygon fill="black" stroke="black" points="9350.63,-408.36 9340.37,-405.7 9346.73,-414.18 9350.63,-408.36"/>
</g>
<!-- expert46_l3_tp4&#45;&gt;expert_agg_l3_tp4 -->
<g id="edge819" class="edge">
<title>expert46_l3_tp4&#45;&gt;expert_agg_l3_tp4</title>
<path fill="none" stroke="black" d="M9629.9,-467.44C9612.41,-458.52 9592.09,-448.88 9573,-441.54 9541.99,-429.61 9508.66,-418.53 9475.79,-408.53"/>
<polygon fill="black" stroke="black" points="9476.65,-405.13 9466.06,-405.6 9474.63,-411.84 9476.65,-405.13"/>
</g>
<!-- expert47_l3_tp4&#45;&gt;expert_agg_l3_tp4 -->
<g id="edge821" class="edge">
<title>expert47_l3_tp4&#45;&gt;expert_agg_l3_tp4</title>
<path fill="none" stroke="black" d="M9838.58,-467.51C9820.64,-458.11 9799.31,-448.12 9779,-441.54 9697.77,-415.2 9606.61,-396.47 9523.83,-383.31"/>
<polygon fill="black" stroke="black" points="9524.19,-379.82 9513.77,-381.73 9523.11,-386.74 9524.19,-379.82"/>
</g>
<!-- expert_agg_l3_tp4&#45;&gt;res_add2_l3_tp4 -->
<g id="edge822" class="edge">
<title>expert_agg_l3_tp4&#45;&gt;res_add2_l3_tp4</title>
<path fill="none" stroke="black" d="M9451.3,-323.84C9573.77,-305.08 9731.58,-280.9 9845.6,-263.43"/>
<polygon fill="black" stroke="black" points="9846.45,-266.84 9855.81,-261.87 9845.39,-259.92 9846.45,-266.84"/>
</g>
<!-- norm2_l3_tp4 -->
<g id="node554" class="node">
<title>norm2_l3_tp4</title>
<polygon fill="lightgreen" stroke="black" points="10391,-177.54 10125,-177.54 10125,-125.54 10391,-125.54 10391,-177.54"/>
<text text-anchor="middle" x="10258" y="-165.54" font-family="Arial" font-size="10.00">Layer Norm 2 TP4</text>
<text text-anchor="middle" x="10258" y="-154.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10258" y="-143.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="10258" y="-132.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- res_add2_l3_tp4&#45;&gt;norm2_l3_tp4 -->
<g id="edge824" class="edge">
<title>res_add2_l3_tp4&#45;&gt;norm2_l3_tp4</title>
<path fill="none" stroke="black" d="M10071.78,-213.43C10102.97,-203.23 10139.16,-191.4 10171.29,-180.89"/>
<polygon fill="black" stroke="black" points="10172.71,-184.11 10181.13,-177.68 10170.53,-177.46 10172.71,-184.11"/>
</g>
<!-- norm2_l3_tp4&#45;&gt;final_output -->
<g id="edge825" class="edge">
<title>norm2_l3_tp4&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M10362.57,-125.49C10415.39,-112.84 10479.9,-97.39 10535.5,-84.07"/>
<polygon fill="black" stroke="black" points="10536.5,-87.43 10545.41,-81.7 10534.87,-80.62 10536.5,-87.43"/>
</g>
<!-- mha_qkv_l3_tp5 -->
<g id="node556" class="node">
<title>mha_qkv_l3_tp5</title>
<polygon fill="lightgreen" stroke="black" points="7004.5,-1095.08 6713.5,-1095.08 6713.5,-1043.08 7004.5,-1043.08 7004.5,-1095.08"/>
<text text-anchor="middle" x="6859" y="-1083.08" font-family="Arial" font-size="10.00">MHA QKV TP5</text>
<text text-anchor="middle" x="6859" y="-1072.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="6859" y="-1061.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="6859" y="-1050.08" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- input_split_l3_tp5&#45;&gt;mha_qkv_l3_tp5 -->
<g id="edge827" class="edge">
<title>input_split_l3_tp5&#45;&gt;mha_qkv_l3_tp5</title>
<path fill="none" stroke="black" d="M6961.94,-1132.73C6944.74,-1122.26 6925.92,-1110.81 6909.14,-1100.59"/>
<polygon fill="black" stroke="black" points="6910.92,-1097.58 6900.56,-1095.37 6907.29,-1103.56 6910.92,-1097.58"/>
</g>
<!-- res_add_l3_tp5 -->
<g id="node560" class="node">
<title>res_add_l3_tp5</title>
<polygon fill="lightgreen" stroke="black" points="7028,-721.54 6750,-721.54 6750,-669.54 7028,-669.54 7028,-721.54"/>
<text text-anchor="middle" x="6889" y="-709.54" font-family="Arial" font-size="10.00">Residual Add TP5</text>
<text text-anchor="middle" x="6889" y="-698.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="6889" y="-687.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6889" y="-676.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- input_split_l3_tp5&#45;&gt;res_add_l3_tp5 -->
<g id="edge831" class="edge">
<title>input_split_l3_tp5&#45;&gt;res_add_l3_tp5</title>
<path fill="none" stroke="black" d="M7026.08,-1130.95C7033.72,-1093.87 7044,-1034.23 7044,-982.08 7044,-982.08 7044,-982.08 7044,-892.08 7044,-832.12 7069,-806.22 7034,-757.54 7024.69,-744.59 7012.09,-734.38 6998.17,-726.33"/>
<polygon fill="black" stroke="black" points="6999.83,-723.24 6989.36,-721.58 6996.51,-729.4 6999.83,-723.24"/>
</g>
<!-- mha_attn_l3_tp5 -->
<g id="node557" class="node">
<title>mha_attn_l3_tp5</title>
<polygon fill="lightgreen" stroke="black" points="6999.5,-1007.08 6708.5,-1007.08 6708.5,-955.08 6999.5,-955.08 6999.5,-1007.08"/>
<text text-anchor="middle" x="6854" y="-995.08" font-family="Arial" font-size="10.00">MHA Attention TP5</text>
<text text-anchor="middle" x="6854" y="-984.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="6854" y="-973.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="6854" y="-962.08" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- mha_qkv_l3_tp5&#45;&gt;mha_attn_l3_tp5 -->
<g id="edge828" class="edge">
<title>mha_qkv_l3_tp5&#45;&gt;mha_attn_l3_tp5</title>
<path fill="none" stroke="black" d="M6857.53,-1042.74C6857.06,-1034.78 6856.54,-1025.84 6856.05,-1017.32"/>
<polygon fill="black" stroke="black" points="6859.54,-1017.01 6855.46,-1007.23 6852.55,-1017.42 6859.54,-1017.01"/>
</g>
<!-- mha_out_l3_tp5 -->
<g id="node558" class="node">
<title>mha_out_l3_tp5</title>
<polygon fill="lightgreen" stroke="black" points="6990,-919.08 6706,-919.08 6706,-867.08 6990,-867.08 6990,-919.08"/>
<text text-anchor="middle" x="6848" y="-907.08" font-family="Arial" font-size="10.00">MHA Output TP5</text>
<text text-anchor="middle" x="6848" y="-896.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="6848" y="-885.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="6848" y="-874.08" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- mha_attn_l3_tp5&#45;&gt;mha_out_l3_tp5 -->
<g id="edge829" class="edge">
<title>mha_attn_l3_tp5&#45;&gt;mha_out_l3_tp5</title>
<path fill="none" stroke="black" d="M6852.23,-954.74C6851.68,-946.78 6851.05,-937.84 6850.46,-929.32"/>
<polygon fill="black" stroke="black" points="6853.94,-928.97 6849.76,-919.23 6846.96,-929.45 6853.94,-928.97"/>
</g>
<!-- attn_allreduce_l3_tp5 -->
<g id="node559" class="node">
<title>attn_allreduce_l3_tp5</title>
<ellipse fill="lightgray" stroke="black" cx="6837" cy="-794.31" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="6837" y="-808.31" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP5</text>
<text text-anchor="middle" x="6837" y="-797.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="6837" y="-786.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6837" y="-775.31" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- mha_out_l3_tp5&#45;&gt;attn_allreduce_l3_tp5 -->
<g id="edge830" class="edge">
<title>mha_out_l3_tp5&#45;&gt;attn_allreduce_l3_tp5</title>
<path fill="none" stroke="black" d="M6845.14,-866.91C6844.25,-859.1 6843.24,-850.23 6842.25,-841.46"/>
<polygon fill="black" stroke="black" points="6845.7,-840.83 6841.09,-831.29 6838.74,-841.62 6845.7,-840.83"/>
</g>
<!-- attn_allreduce_l3_tp5&#45;&gt;res_add_l3_tp5 -->
<g id="edge832" class="edge">
<title>attn_allreduce_l3_tp5&#45;&gt;res_add_l3_tp5</title>
<path fill="none" stroke="black" d="M6856.22,-757.55C6860.98,-748.68 6866.08,-739.2 6870.79,-730.42"/>
<polygon fill="black" stroke="black" points="6873.89,-732.05 6875.54,-721.58 6867.73,-728.73 6873.89,-732.05"/>
</g>
<!-- norm_l3_tp5 -->
<g id="node561" class="node">
<title>norm_l3_tp5</title>
<polygon fill="lightgreen" stroke="black" points="7022,-633.54 6756,-633.54 6756,-581.54 7022,-581.54 7022,-633.54"/>
<text text-anchor="middle" x="6889" y="-621.54" font-family="Arial" font-size="10.00">Layer Norm TP5</text>
<text text-anchor="middle" x="6889" y="-610.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6889" y="-599.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6889" y="-588.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- res_add_l3_tp5&#45;&gt;norm_l3_tp5 -->
<g id="edge833" class="edge">
<title>res_add_l3_tp5&#45;&gt;norm_l3_tp5</title>
<path fill="none" stroke="black" d="M6889,-669.2C6889,-661.24 6889,-652.3 6889,-643.78"/>
<polygon fill="black" stroke="black" points="6892.5,-643.7 6889,-633.7 6885.5,-643.7 6892.5,-643.7"/>
</g>
<!-- gate_l3_tp5 -->
<g id="node562" class="node">
<title>gate_l3_tp5</title>
<polygon fill="lightyellow" stroke="black" points="6056.3,-545.54 5589.72,-545.54 5469.7,-441.54 5936.28,-441.54 6056.3,-545.54"/>
<text text-anchor="middle" x="5763" y="-507.54" font-family="Arial" font-size="10.00">Gate Network TP5</text>
<text text-anchor="middle" x="5763" y="-496.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5763" y="-485.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="5763" y="-474.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l3_tp5&#45;&gt;gate_l3_tp5 -->
<g id="edge834" class="edge">
<title>norm_l3_tp5&#45;&gt;gate_l3_tp5</title>
<path fill="none" stroke="black" d="M6755.9,-600.52C6592.69,-592.25 6307.8,-574.96 6065,-545.54 6064.9,-545.53 6064.79,-545.51 6064.69,-545.5"/>
<polygon fill="black" stroke="black" points="6065.4,-542.06 6055.05,-544.31 6064.54,-549.01 6065.4,-542.06"/>
</g>
<!-- expert48_l3_tp5 -->
<g id="node563" class="node">
<title>expert48_l3_tp5</title>
<polygon fill="lightcoral" stroke="black" points="6262,-519.54 6074,-519.54 6074,-467.54 6262,-467.54 6262,-519.54"/>
<text text-anchor="middle" x="6168" y="-507.54" font-family="Arial" font-size="10.00">Expert 48</text>
<text text-anchor="middle" x="6168" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6168" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6168" y="-474.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l3_tp5&#45;&gt;expert48_l3_tp5 -->
<g id="edge835" class="edge">
<title>norm_l3_tp5&#45;&gt;expert48_l3_tp5</title>
<path fill="none" stroke="black" d="M6755.77,-599.02C6602,-589.34 6358.97,-570.75 6271,-545.54 6253.52,-540.53 6235.44,-532.63 6219.39,-524.52"/>
<polygon fill="black" stroke="black" points="6220.69,-521.25 6210.2,-519.75 6217.46,-527.46 6220.69,-521.25"/>
</g>
<!-- expert49_l3_tp5 -->
<g id="node564" class="node">
<title>expert49_l3_tp5</title>
<polygon fill="lightcoral" stroke="black" points="6468,-519.54 6280,-519.54 6280,-467.54 6468,-467.54 6468,-519.54"/>
<text text-anchor="middle" x="6374" y="-507.54" font-family="Arial" font-size="10.00">Expert 49</text>
<text text-anchor="middle" x="6374" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6374" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6374" y="-474.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l3_tp5&#45;&gt;expert49_l3_tp5 -->
<g id="edge837" class="edge">
<title>norm_l3_tp5&#45;&gt;expert49_l3_tp5</title>
<path fill="none" stroke="black" d="M6755.83,-597.44C6673.97,-589.26 6567.74,-573.94 6477,-545.54 6459.89,-540.18 6442.1,-532.3 6426.21,-524.33"/>
<polygon fill="black" stroke="black" points="6427.6,-521.1 6417.1,-519.64 6424.39,-527.33 6427.6,-521.1"/>
</g>
<!-- expert50_l3_tp5 -->
<g id="node565" class="node">
<title>expert50_l3_tp5</title>
<polygon fill="lightcoral" stroke="black" points="6674,-519.54 6486,-519.54 6486,-467.54 6674,-467.54 6674,-519.54"/>
<text text-anchor="middle" x="6580" y="-507.54" font-family="Arial" font-size="10.00">Expert 50</text>
<text text-anchor="middle" x="6580" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6580" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6580" y="-474.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l3_tp5&#45;&gt;expert50_l3_tp5 -->
<g id="edge839" class="edge">
<title>norm_l3_tp5&#45;&gt;expert50_l3_tp5</title>
<path fill="none" stroke="black" d="M6791.94,-581.51C6757.14,-571.57 6717.9,-559.23 6683,-545.54 6667.31,-539.38 6650.76,-531.74 6635.63,-524.26"/>
<polygon fill="black" stroke="black" points="6636.91,-520.99 6626.41,-519.63 6633.78,-527.24 6636.91,-520.99"/>
</g>
<!-- expert51_l3_tp5 -->
<g id="node566" class="node">
<title>expert51_l3_tp5</title>
<polygon fill="lightcoral" stroke="black" points="6880,-519.54 6692,-519.54 6692,-467.54 6880,-467.54 6880,-519.54"/>
<text text-anchor="middle" x="6786" y="-507.54" font-family="Arial" font-size="10.00">Expert 51</text>
<text text-anchor="middle" x="6786" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6786" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6786" y="-474.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l3_tp5&#45;&gt;expert51_l3_tp5 -->
<g id="edge841" class="edge">
<title>norm_l3_tp5&#45;&gt;expert51_l3_tp5</title>
<path fill="none" stroke="black" d="M6865.88,-581.4C6851.17,-565.41 6831.97,-544.53 6816.08,-527.25"/>
<polygon fill="black" stroke="black" points="6818.38,-524.58 6809.04,-519.59 6813.23,-529.32 6818.38,-524.58"/>
</g>
<!-- expert52_l3_tp5 -->
<g id="node567" class="node">
<title>expert52_l3_tp5</title>
<polygon fill="lightcoral" stroke="black" points="7086,-519.54 6898,-519.54 6898,-467.54 7086,-467.54 7086,-519.54"/>
<text text-anchor="middle" x="6992" y="-507.54" font-family="Arial" font-size="10.00">Expert 52</text>
<text text-anchor="middle" x="6992" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6992" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="6992" y="-474.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l3_tp5&#45;&gt;expert52_l3_tp5 -->
<g id="edge843" class="edge">
<title>norm_l3_tp5&#45;&gt;expert52_l3_tp5</title>
<path fill="none" stroke="black" d="M6912.12,-581.4C6926.83,-565.41 6946.03,-544.53 6961.92,-527.25"/>
<polygon fill="black" stroke="black" points="6964.77,-529.32 6968.96,-519.59 6959.62,-524.58 6964.77,-529.32"/>
</g>
<!-- expert53_l3_tp5 -->
<g id="node568" class="node">
<title>expert53_l3_tp5</title>
<polygon fill="lightcoral" stroke="black" points="7292,-519.54 7104,-519.54 7104,-467.54 7292,-467.54 7292,-519.54"/>
<text text-anchor="middle" x="7198" y="-507.54" font-family="Arial" font-size="10.00">Expert 53</text>
<text text-anchor="middle" x="7198" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7198" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7198" y="-474.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l3_tp5&#45;&gt;expert53_l3_tp5 -->
<g id="edge845" class="edge">
<title>norm_l3_tp5&#45;&gt;expert53_l3_tp5</title>
<path fill="none" stroke="black" d="M6986.06,-581.51C7020.86,-571.57 7060.1,-559.23 7095,-545.54 7110.69,-539.38 7127.24,-531.74 7142.37,-524.26"/>
<polygon fill="black" stroke="black" points="7144.22,-527.24 7151.59,-519.63 7141.09,-520.99 7144.22,-527.24"/>
</g>
<!-- expert54_l3_tp5 -->
<g id="node569" class="node">
<title>expert54_l3_tp5</title>
<polygon fill="lightcoral" stroke="black" points="7498,-519.54 7310,-519.54 7310,-467.54 7498,-467.54 7498,-519.54"/>
<text text-anchor="middle" x="7404" y="-507.54" font-family="Arial" font-size="10.00">Expert 54</text>
<text text-anchor="middle" x="7404" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7404" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7404" y="-474.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l3_tp5&#45;&gt;expert54_l3_tp5 -->
<g id="edge847" class="edge">
<title>norm_l3_tp5&#45;&gt;expert54_l3_tp5</title>
<path fill="none" stroke="black" d="M7022.17,-597.44C7104.03,-589.26 7210.26,-573.94 7301,-545.54 7318.11,-540.18 7335.9,-532.3 7351.79,-524.33"/>
<polygon fill="black" stroke="black" points="7353.61,-527.33 7360.9,-519.64 7350.4,-521.1 7353.61,-527.33"/>
</g>
<!-- expert55_l3_tp5 -->
<g id="node570" class="node">
<title>expert55_l3_tp5</title>
<polygon fill="lightcoral" stroke="black" points="7704,-519.54 7516,-519.54 7516,-467.54 7704,-467.54 7704,-519.54"/>
<text text-anchor="middle" x="7610" y="-507.54" font-family="Arial" font-size="10.00">Expert 55</text>
<text text-anchor="middle" x="7610" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7610" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="7610" y="-474.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l3_tp5&#45;&gt;expert55_l3_tp5 -->
<g id="edge849" class="edge">
<title>norm_l3_tp5&#45;&gt;expert55_l3_tp5</title>
<path fill="none" stroke="black" d="M7022.23,-599.02C7176,-589.34 7419.03,-570.75 7507,-545.54 7524.48,-540.53 7542.56,-532.63 7558.61,-524.52"/>
<polygon fill="black" stroke="black" points="7560.54,-527.46 7567.8,-519.75 7557.31,-521.25 7560.54,-527.46"/>
</g>
<!-- res_add2_l3_tp5 -->
<g id="node572" class="node">
<title>res_add2_l3_tp5</title>
<polygon fill="lightgreen" stroke="black" points="7862,-265.54 7584,-265.54 7584,-213.54 7862,-213.54 7862,-265.54"/>
<text text-anchor="middle" x="7723" y="-253.54" font-family="Arial" font-size="10.00">Residual Add 2 TP5</text>
<text text-anchor="middle" x="7723" y="-242.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="7723" y="-231.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7723" y="-220.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- norm_l3_tp5&#45;&gt;res_add2_l3_tp5 -->
<g id="edge852" class="edge">
<title>norm_l3_tp5&#45;&gt;res_add2_l3_tp5</title>
<path fill="none" stroke="black" d="M7022.21,-606.21C7243.25,-604.29 7666.29,-594.21 7713,-545.54 7731.31,-526.46 7727.14,-351.7 7724.42,-275.64"/>
<polygon fill="black" stroke="black" points="7727.92,-275.45 7724.05,-265.59 7720.92,-275.71 7727.92,-275.45"/>
</g>
<!-- expert_agg_l3_tp5 -->
<g id="node571" class="node">
<title>expert_agg_l3_tp5</title>
<polygon fill="lightpink" stroke="black" points="7267.55,-405.54 6829.21,-405.54 6716.45,-301.54 7154.79,-301.54 7267.55,-405.54"/>
<text text-anchor="middle" x="6992" y="-367.54" font-family="Arial" font-size="10.00">Expert Aggregation TP5</text>
<text text-anchor="middle" x="6992" y="-356.54" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="6992" y="-345.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="6992" y="-334.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- expert48_l3_tp5&#45;&gt;expert_agg_l3_tp5 -->
<g id="edge836" class="edge">
<title>expert48_l3_tp5&#45;&gt;expert_agg_l3_tp5</title>
<path fill="none" stroke="black" d="M6210.77,-467.29C6228.79,-457.74 6250.35,-447.7 6271,-441.54 6434.12,-392.88 6625.72,-371.34 6770.39,-361.86"/>
<polygon fill="black" stroke="black" points="6770.97,-365.33 6780.72,-361.2 6770.52,-358.34 6770.97,-365.33"/>
</g>
<!-- expert49_l3_tp5&#45;&gt;expert_agg_l3_tp5 -->
<g id="edge838" class="edge">
<title>expert49_l3_tp5&#45;&gt;expert_agg_l3_tp5</title>
<path fill="none" stroke="black" d="M6417.42,-467.51C6435.36,-458.11 6456.69,-448.12 6477,-441.54 6575.93,-409.46 6689.58,-388.66 6784.91,-375.48"/>
<polygon fill="black" stroke="black" points="6785.53,-378.93 6794.96,-374.11 6784.58,-371.99 6785.53,-378.93"/>
</g>
<!-- expert50_l3_tp5&#45;&gt;expert_agg_l3_tp5 -->
<g id="edge840" class="edge">
<title>expert50_l3_tp5&#45;&gt;expert_agg_l3_tp5</title>
<path fill="none" stroke="black" d="M6626.1,-467.44C6643.59,-458.52 6663.91,-448.88 6683,-441.54 6723.42,-426 6767.76,-411.88 6809.93,-399.74"/>
<polygon fill="black" stroke="black" points="6811.09,-403.05 6819.74,-396.94 6809.17,-396.32 6811.09,-403.05"/>
</g>
<!-- expert51_l3_tp5&#45;&gt;expert_agg_l3_tp5 -->
<g id="edge842" class="edge">
<title>expert51_l3_tp5&#45;&gt;expert_agg_l3_tp5</title>
<path fill="none" stroke="black" d="M6823.78,-467.23C6847.15,-451.58 6878.12,-430.83 6907.11,-411.41"/>
<polygon fill="black" stroke="black" points="6909.27,-414.18 6915.63,-405.7 6905.37,-408.36 6909.27,-414.18"/>
</g>
<!-- expert52_l3_tp5&#45;&gt;expert_agg_l3_tp5 -->
<g id="edge844" class="edge">
<title>expert52_l3_tp5&#45;&gt;expert_agg_l3_tp5</title>
<path fill="none" stroke="black" d="M6992,-467.23C6992,-452.79 6992,-434.01 6992,-415.93"/>
<polygon fill="black" stroke="black" points="6995.5,-415.7 6992,-405.7 6988.5,-415.7 6995.5,-415.7"/>
</g>
<!-- expert53_l3_tp5&#45;&gt;expert_agg_l3_tp5 -->
<g id="edge846" class="edge">
<title>expert53_l3_tp5&#45;&gt;expert_agg_l3_tp5</title>
<path fill="none" stroke="black" d="M7160.22,-467.23C7136.85,-451.58 7105.88,-430.83 7076.89,-411.41"/>
<polygon fill="black" stroke="black" points="7078.63,-408.36 7068.37,-405.7 7074.73,-414.18 7078.63,-408.36"/>
</g>
<!-- expert54_l3_tp5&#45;&gt;expert_agg_l3_tp5 -->
<g id="edge848" class="edge">
<title>expert54_l3_tp5&#45;&gt;expert_agg_l3_tp5</title>
<path fill="none" stroke="black" d="M7357.9,-467.44C7340.41,-458.52 7320.09,-448.88 7301,-441.54 7269.99,-429.61 7236.66,-418.53 7203.79,-408.53"/>
<polygon fill="black" stroke="black" points="7204.65,-405.13 7194.06,-405.6 7202.63,-411.84 7204.65,-405.13"/>
</g>
<!-- expert55_l3_tp5&#45;&gt;expert_agg_l3_tp5 -->
<g id="edge850" class="edge">
<title>expert55_l3_tp5&#45;&gt;expert_agg_l3_tp5</title>
<path fill="none" stroke="black" d="M7566.58,-467.51C7548.64,-458.11 7527.31,-448.12 7507,-441.54 7425.77,-415.2 7334.61,-396.47 7251.83,-383.31"/>
<polygon fill="black" stroke="black" points="7252.19,-379.82 7241.77,-381.73 7251.11,-386.74 7252.19,-379.82"/>
</g>
<!-- expert_agg_l3_tp5&#45;&gt;res_add2_l3_tp5 -->
<g id="edge851" class="edge">
<title>expert_agg_l3_tp5&#45;&gt;res_add2_l3_tp5</title>
<path fill="none" stroke="black" d="M7179.3,-323.84C7301.77,-305.08 7459.58,-280.9 7573.6,-263.43"/>
<polygon fill="black" stroke="black" points="7574.45,-266.84 7583.81,-261.87 7573.39,-259.92 7574.45,-266.84"/>
</g>
<!-- norm2_l3_tp5 -->
<g id="node573" class="node">
<title>norm2_l3_tp5</title>
<polygon fill="lightgreen" stroke="black" points="8981,-177.54 8715,-177.54 8715,-125.54 8981,-125.54 8981,-177.54"/>
<text text-anchor="middle" x="8848" y="-165.54" font-family="Arial" font-size="10.00">Layer Norm 2 TP5</text>
<text text-anchor="middle" x="8848" y="-154.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8848" y="-143.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="8848" y="-132.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- res_add2_l3_tp5&#45;&gt;norm2_l3_tp5 -->
<g id="edge853" class="edge">
<title>res_add2_l3_tp5&#45;&gt;norm2_l3_tp5</title>
<path fill="none" stroke="black" d="M7862.08,-227.91C8076.92,-211.48 8487.36,-180.11 8704.72,-163.49"/>
<polygon fill="black" stroke="black" points="8705.22,-166.96 8714.92,-162.71 8704.68,-159.98 8705.22,-166.96"/>
</g>
<!-- norm2_l3_tp5&#45;&gt;final_output -->
<g id="edge854" class="edge">
<title>norm2_l3_tp5&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M8981.02,-143.44C9298.7,-126.5 10102.53,-83.61 10471.52,-63.93"/>
<polygon fill="black" stroke="black" points="10471.97,-67.41 10481.77,-63.38 10471.6,-60.42 10471.97,-67.41"/>
</g>
<!-- mha_qkv_l3_tp6 -->
<g id="node575" class="node">
<title>mha_qkv_l3_tp6</title>
<polygon fill="lightgreen" stroke="black" points="4835.5,-1095.08 4544.5,-1095.08 4544.5,-1043.08 4835.5,-1043.08 4835.5,-1095.08"/>
<text text-anchor="middle" x="4690" y="-1083.08" font-family="Arial" font-size="10.00">MHA QKV TP6</text>
<text text-anchor="middle" x="4690" y="-1072.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="4690" y="-1061.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="4690" y="-1050.08" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- input_split_l3_tp6&#45;&gt;mha_qkv_l3_tp6 -->
<g id="edge856" class="edge">
<title>input_split_l3_tp6&#45;&gt;mha_qkv_l3_tp6</title>
<path fill="none" stroke="black" d="M4748.53,-1131.64C4739.44,-1122.09 4729.66,-1111.79 4720.74,-1102.41"/>
<polygon fill="black" stroke="black" points="4723.22,-1099.94 4713.8,-1095.11 4718.15,-1104.77 4723.22,-1099.94"/>
</g>
<!-- res_add_l3_tp6 -->
<g id="node579" class="node">
<title>res_add_l3_tp6</title>
<polygon fill="lightgreen" stroke="black" points="4828,-721.54 4550,-721.54 4550,-669.54 4828,-669.54 4828,-721.54"/>
<text text-anchor="middle" x="4689" y="-709.54" font-family="Arial" font-size="10.00">Residual Add TP6</text>
<text text-anchor="middle" x="4689" y="-698.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="4689" y="-687.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4689" y="-676.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- input_split_l3_tp6&#45;&gt;res_add_l3_tp6 -->
<g id="edge860" class="edge">
<title>input_split_l3_tp6&#45;&gt;res_add_l3_tp6</title>
<path fill="none" stroke="black" d="M4819.62,-1131.68C4829.26,-1120.82 4838.68,-1108.23 4845,-1095.08 4867.08,-1049.1 4865,-1033.08 4865,-982.08 4865,-982.08 4865,-982.08 4865,-892.08 4865,-832.12 4891.12,-805.4 4855,-757.54 4845.27,-744.65 4832.54,-734.48 4818.44,-726.46"/>
<polygon fill="black" stroke="black" points="4819.98,-723.32 4809.51,-721.74 4816.71,-729.51 4819.98,-723.32"/>
</g>
<!-- mha_attn_l3_tp6 -->
<g id="node576" class="node">
<title>mha_attn_l3_tp6</title>
<polygon fill="lightgreen" stroke="black" points="4825.5,-1007.08 4534.5,-1007.08 4534.5,-955.08 4825.5,-955.08 4825.5,-1007.08"/>
<text text-anchor="middle" x="4680" y="-995.08" font-family="Arial" font-size="10.00">MHA Attention TP6</text>
<text text-anchor="middle" x="4680" y="-984.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="4680" y="-973.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="4680" y="-962.08" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- mha_qkv_l3_tp6&#45;&gt;mha_attn_l3_tp6 -->
<g id="edge857" class="edge">
<title>mha_qkv_l3_tp6&#45;&gt;mha_attn_l3_tp6</title>
<path fill="none" stroke="black" d="M4687.05,-1042.74C4686.13,-1034.78 4685.09,-1025.84 4684.1,-1017.32"/>
<polygon fill="black" stroke="black" points="4687.56,-1016.76 4682.93,-1007.23 4680.6,-1017.57 4687.56,-1016.76"/>
</g>
<!-- mha_out_l3_tp6 -->
<g id="node577" class="node">
<title>mha_out_l3_tp6</title>
<polygon fill="lightgreen" stroke="black" points="4811,-919.08 4527,-919.08 4527,-867.08 4811,-867.08 4811,-919.08"/>
<text text-anchor="middle" x="4669" y="-907.08" font-family="Arial" font-size="10.00">MHA Output TP6</text>
<text text-anchor="middle" x="4669" y="-896.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="4669" y="-885.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="4669" y="-874.08" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- mha_attn_l3_tp6&#45;&gt;mha_out_l3_tp6 -->
<g id="edge858" class="edge">
<title>mha_attn_l3_tp6&#45;&gt;mha_out_l3_tp6</title>
<path fill="none" stroke="black" d="M4676.76,-954.74C4675.74,-946.78 4674.6,-937.84 4673.51,-929.32"/>
<polygon fill="black" stroke="black" points="4676.96,-928.71 4672.22,-919.23 4670.01,-929.6 4676.96,-928.71"/>
</g>
<!-- attn_allreduce_l3_tp6 -->
<g id="node578" class="node">
<title>attn_allreduce_l3_tp6</title>
<ellipse fill="lightgray" stroke="black" cx="4658" cy="-794.31" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="4658" y="-808.31" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP6</text>
<text text-anchor="middle" x="4658" y="-797.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="4658" y="-786.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4658" y="-775.31" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- mha_out_l3_tp6&#45;&gt;attn_allreduce_l3_tp6 -->
<g id="edge859" class="edge">
<title>mha_out_l3_tp6&#45;&gt;attn_allreduce_l3_tp6</title>
<path fill="none" stroke="black" d="M4666.14,-866.91C4665.25,-859.1 4664.24,-850.23 4663.25,-841.46"/>
<polygon fill="black" stroke="black" points="4666.7,-840.83 4662.09,-831.29 4659.74,-841.62 4666.7,-840.83"/>
</g>
<!-- attn_allreduce_l3_tp6&#45;&gt;res_add_l3_tp6 -->
<g id="edge861" class="edge">
<title>attn_allreduce_l3_tp6&#45;&gt;res_add_l3_tp6</title>
<path fill="none" stroke="black" d="M4669.46,-757.55C4672.21,-748.96 4675.14,-739.8 4677.88,-731.25"/>
<polygon fill="black" stroke="black" points="4681.26,-732.17 4680.98,-721.58 4674.59,-730.04 4681.26,-732.17"/>
</g>
<!-- norm_l3_tp6 -->
<g id="node580" class="node">
<title>norm_l3_tp6</title>
<polygon fill="lightgreen" stroke="black" points="4822,-633.54 4556,-633.54 4556,-581.54 4822,-581.54 4822,-633.54"/>
<text text-anchor="middle" x="4689" y="-621.54" font-family="Arial" font-size="10.00">Layer Norm TP6</text>
<text text-anchor="middle" x="4689" y="-610.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4689" y="-599.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4689" y="-588.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- res_add_l3_tp6&#45;&gt;norm_l3_tp6 -->
<g id="edge862" class="edge">
<title>res_add_l3_tp6&#45;&gt;norm_l3_tp6</title>
<path fill="none" stroke="black" d="M4689,-669.2C4689,-661.24 4689,-652.3 4689,-643.78"/>
<polygon fill="black" stroke="black" points="4692.5,-643.7 4689,-633.7 4685.5,-643.7 4692.5,-643.7"/>
</g>
<!-- gate_l3_tp6 -->
<g id="node581" class="node">
<title>gate_l3_tp6</title>
<polygon fill="lightyellow" stroke="black" points="3784.3,-545.54 3317.72,-545.54 3197.7,-441.54 3664.28,-441.54 3784.3,-545.54"/>
<text text-anchor="middle" x="3491" y="-507.54" font-family="Arial" font-size="10.00">Gate Network TP6</text>
<text text-anchor="middle" x="3491" y="-496.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3491" y="-485.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="3491" y="-474.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l3_tp6&#45;&gt;gate_l3_tp6 -->
<g id="edge863" class="edge">
<title>norm_l3_tp6&#45;&gt;gate_l3_tp6</title>
<path fill="none" stroke="black" d="M4555.79,-601.61C4380.44,-594.17 4062.81,-577.43 3793,-545.54 3792.9,-545.53 3792.79,-545.51 3792.69,-545.5"/>
<polygon fill="black" stroke="black" points="3793.39,-542.06 3783.05,-544.34 3792.55,-549.01 3793.39,-542.06"/>
</g>
<!-- expert56_l3_tp6 -->
<g id="node582" class="node">
<title>expert56_l3_tp6</title>
<polygon fill="lightcoral" stroke="black" points="3990,-519.54 3802,-519.54 3802,-467.54 3990,-467.54 3990,-519.54"/>
<text text-anchor="middle" x="3896" y="-507.54" font-family="Arial" font-size="10.00">Expert 56</text>
<text text-anchor="middle" x="3896" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3896" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3896" y="-474.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l3_tp6&#45;&gt;expert56_l3_tp6 -->
<g id="edge864" class="edge">
<title>norm_l3_tp6&#45;&gt;expert56_l3_tp6</title>
<path fill="none" stroke="black" d="M4555.9,-600.63C4385.54,-592.06 4100.3,-574.01 3999,-545.54 3981.34,-540.57 3963.07,-532.6 3946.92,-524.41"/>
<polygon fill="black" stroke="black" points="3948.16,-521.11 3937.67,-519.59 3944.92,-527.32 3948.16,-521.11"/>
</g>
<!-- expert57_l3_tp6 -->
<g id="node583" class="node">
<title>expert57_l3_tp6</title>
<polygon fill="lightcoral" stroke="black" points="4196,-519.54 4008,-519.54 4008,-467.54 4196,-467.54 4196,-519.54"/>
<text text-anchor="middle" x="4102" y="-507.54" font-family="Arial" font-size="10.00">Expert 57</text>
<text text-anchor="middle" x="4102" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4102" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4102" y="-474.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l3_tp6&#45;&gt;expert57_l3_tp6 -->
<g id="edge866" class="edge">
<title>norm_l3_tp6&#45;&gt;expert57_l3_tp6</title>
<path fill="none" stroke="black" d="M4555.83,-601.71C4457.19,-595.28 4320.46,-580.32 4205,-545.54 4187.75,-540.34 4169.86,-532.47 4153.92,-524.45"/>
<polygon fill="black" stroke="black" points="4155.27,-521.21 4144.78,-519.74 4152.06,-527.43 4155.27,-521.21"/>
</g>
<!-- expert58_l3_tp6 -->
<g id="node584" class="node">
<title>expert58_l3_tp6</title>
<polygon fill="lightcoral" stroke="black" points="4402,-519.54 4214,-519.54 4214,-467.54 4402,-467.54 4402,-519.54"/>
<text text-anchor="middle" x="4308" y="-507.54" font-family="Arial" font-size="10.00">Expert 58</text>
<text text-anchor="middle" x="4308" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4308" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4308" y="-474.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l3_tp6&#45;&gt;expert58_l3_tp6 -->
<g id="edge868" class="edge">
<title>norm_l3_tp6&#45;&gt;expert58_l3_tp6</title>
<path fill="none" stroke="black" d="M4556,-584.22C4509.45,-574.62 4457.27,-561.8 4411,-545.54 4394.48,-539.73 4377.17,-531.91 4361.57,-524.14"/>
<polygon fill="black" stroke="black" points="4363.1,-520.99 4352.6,-519.59 4359.93,-527.24 4363.1,-520.99"/>
</g>
<!-- expert59_l3_tp6 -->
<g id="node585" class="node">
<title>expert59_l3_tp6</title>
<polygon fill="lightcoral" stroke="black" points="4608,-519.54 4420,-519.54 4420,-467.54 4608,-467.54 4608,-519.54"/>
<text text-anchor="middle" x="4514" y="-507.54" font-family="Arial" font-size="10.00">Expert 59</text>
<text text-anchor="middle" x="4514" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4514" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4514" y="-474.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l3_tp6&#45;&gt;expert59_l3_tp6 -->
<g id="edge870" class="edge">
<title>norm_l3_tp6&#45;&gt;expert59_l3_tp6</title>
<path fill="none" stroke="black" d="M4649.73,-581.4C4623.72,-564.76 4589.45,-542.83 4561.85,-525.16"/>
<polygon fill="black" stroke="black" points="4563.45,-522.03 4553.14,-519.59 4559.68,-527.93 4563.45,-522.03"/>
</g>
<!-- expert60_l3_tp6 -->
<g id="node586" class="node">
<title>expert60_l3_tp6</title>
<polygon fill="lightcoral" stroke="black" points="4814,-519.54 4626,-519.54 4626,-467.54 4814,-467.54 4814,-519.54"/>
<text text-anchor="middle" x="4720" y="-507.54" font-family="Arial" font-size="10.00">Expert 60</text>
<text text-anchor="middle" x="4720" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4720" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4720" y="-474.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l3_tp6&#45;&gt;expert60_l3_tp6 -->
<g id="edge872" class="edge">
<title>norm_l3_tp6&#45;&gt;expert60_l3_tp6</title>
<path fill="none" stroke="black" d="M4695.96,-581.4C4700.18,-566.13 4705.65,-546.4 4710.29,-529.6"/>
<polygon fill="black" stroke="black" points="4713.77,-530.16 4713.07,-519.59 4707.03,-528.29 4713.77,-530.16"/>
</g>
<!-- expert61_l3_tp6 -->
<g id="node587" class="node">
<title>expert61_l3_tp6</title>
<polygon fill="lightcoral" stroke="black" points="5020,-519.54 4832,-519.54 4832,-467.54 5020,-467.54 5020,-519.54"/>
<text text-anchor="middle" x="4926" y="-507.54" font-family="Arial" font-size="10.00">Expert 61</text>
<text text-anchor="middle" x="4926" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4926" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4926" y="-474.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l3_tp6&#45;&gt;expert61_l3_tp6 -->
<g id="edge874" class="edge">
<title>norm_l3_tp6&#45;&gt;expert61_l3_tp6</title>
<path fill="none" stroke="black" d="M4745.26,-581.42C4769.29,-570.56 4797.6,-557.6 4823,-545.54 4837.27,-538.76 4852.56,-531.3 4866.88,-524.22"/>
<polygon fill="black" stroke="black" points="4868.72,-527.22 4876.13,-519.64 4865.61,-520.94 4868.72,-527.22"/>
</g>
<!-- expert62_l3_tp6 -->
<g id="node588" class="node">
<title>expert62_l3_tp6</title>
<polygon fill="lightcoral" stroke="black" points="5226,-519.54 5038,-519.54 5038,-467.54 5226,-467.54 5226,-519.54"/>
<text text-anchor="middle" x="5132" y="-507.54" font-family="Arial" font-size="10.00">Expert 62</text>
<text text-anchor="middle" x="5132" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5132" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5132" y="-474.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l3_tp6&#45;&gt;expert62_l3_tp6 -->
<g id="edge876" class="edge">
<title>norm_l3_tp6&#45;&gt;expert62_l3_tp6</title>
<path fill="none" stroke="black" d="M4822.34,-591.5C4885.95,-582.09 4962.51,-567.47 5029,-545.54 5045.87,-539.97 5063.46,-532.11 5079.24,-524.22"/>
<polygon fill="black" stroke="black" points="5080.98,-527.26 5088.29,-519.59 5077.8,-521.03 5080.98,-527.26"/>
</g>
<!-- expert63_l3_tp6 -->
<g id="node589" class="node">
<title>expert63_l3_tp6</title>
<polygon fill="lightcoral" stroke="black" points="5432,-519.54 5244,-519.54 5244,-467.54 5432,-467.54 5432,-519.54"/>
<text text-anchor="middle" x="5338" y="-507.54" font-family="Arial" font-size="10.00">Expert 63</text>
<text text-anchor="middle" x="5338" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5338" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5338" y="-474.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l3_tp6&#45;&gt;expert63_l3_tp6 -->
<g id="edge878" class="edge">
<title>norm_l3_tp6&#45;&gt;expert63_l3_tp6</title>
<path fill="none" stroke="black" d="M4822.26,-604.53C4934.41,-599.8 5097.95,-585.77 5235,-545.54 5252.45,-540.42 5270.52,-532.48 5286.57,-524.38"/>
<polygon fill="black" stroke="black" points="5288.49,-527.33 5295.76,-519.62 5285.27,-521.11 5288.49,-527.33"/>
</g>
<!-- res_add2_l3_tp6 -->
<g id="node591" class="node">
<title>res_add2_l3_tp6</title>
<polygon fill="lightgreen" stroke="black" points="5590,-265.54 5312,-265.54 5312,-213.54 5590,-213.54 5590,-265.54"/>
<text text-anchor="middle" x="5451" y="-253.54" font-family="Arial" font-size="10.00">Residual Add 2 TP6</text>
<text text-anchor="middle" x="5451" y="-242.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="5451" y="-231.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="5451" y="-220.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- norm_l3_tp6&#45;&gt;res_add2_l3_tp6 -->
<g id="edge881" class="edge">
<title>norm_l3_tp6&#45;&gt;res_add2_l3_tp6</title>
<path fill="none" stroke="black" d="M4822.05,-605.16C5026.61,-601.67 5399.29,-589.31 5441,-545.54 5459.24,-526.4 5455.11,-351.67 5452.41,-275.63"/>
<polygon fill="black" stroke="black" points="5455.91,-275.44 5452.04,-265.58 5448.91,-275.7 5455.91,-275.44"/>
</g>
<!-- expert_agg_l3_tp6 -->
<g id="node590" class="node">
<title>expert_agg_l3_tp6</title>
<polygon fill="lightpink" stroke="black" points="4995.55,-405.54 4557.21,-405.54 4444.45,-301.54 4882.79,-301.54 4995.55,-405.54"/>
<text text-anchor="middle" x="4720" y="-367.54" font-family="Arial" font-size="10.00">Expert Aggregation TP6</text>
<text text-anchor="middle" x="4720" y="-356.54" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="4720" y="-345.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4720" y="-334.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- expert56_l3_tp6&#45;&gt;expert_agg_l3_tp6 -->
<g id="edge865" class="edge">
<title>expert56_l3_tp6&#45;&gt;expert_agg_l3_tp6</title>
<path fill="none" stroke="black" d="M3938.77,-467.29C3956.79,-457.74 3978.35,-447.7 3999,-441.54 4162.12,-392.88 4353.72,-371.34 4498.39,-361.86"/>
<polygon fill="black" stroke="black" points="4498.97,-365.33 4508.72,-361.2 4498.52,-358.34 4498.97,-365.33"/>
</g>
<!-- expert57_l3_tp6&#45;&gt;expert_agg_l3_tp6 -->
<g id="edge867" class="edge">
<title>expert57_l3_tp6&#45;&gt;expert_agg_l3_tp6</title>
<path fill="none" stroke="black" d="M4145.42,-467.51C4163.36,-458.11 4184.69,-448.12 4205,-441.54 4303.93,-409.46 4417.58,-388.66 4512.91,-375.48"/>
<polygon fill="black" stroke="black" points="4513.53,-378.93 4522.96,-374.11 4512.58,-371.99 4513.53,-378.93"/>
</g>
<!-- expert58_l3_tp6&#45;&gt;expert_agg_l3_tp6 -->
<g id="edge869" class="edge">
<title>expert58_l3_tp6&#45;&gt;expert_agg_l3_tp6</title>
<path fill="none" stroke="black" d="M4354.1,-467.44C4371.59,-458.52 4391.91,-448.88 4411,-441.54 4451.42,-426 4495.76,-411.88 4537.93,-399.74"/>
<polygon fill="black" stroke="black" points="4539.09,-403.05 4547.74,-396.94 4537.17,-396.32 4539.09,-403.05"/>
</g>
<!-- expert59_l3_tp6&#45;&gt;expert_agg_l3_tp6 -->
<g id="edge871" class="edge">
<title>expert59_l3_tp6&#45;&gt;expert_agg_l3_tp6</title>
<path fill="none" stroke="black" d="M4551.78,-467.23C4575.15,-451.58 4606.12,-430.83 4635.11,-411.41"/>
<polygon fill="black" stroke="black" points="4637.27,-414.18 4643.63,-405.7 4633.37,-408.36 4637.27,-414.18"/>
</g>
<!-- expert60_l3_tp6&#45;&gt;expert_agg_l3_tp6 -->
<g id="edge873" class="edge">
<title>expert60_l3_tp6&#45;&gt;expert_agg_l3_tp6</title>
<path fill="none" stroke="black" d="M4720,-467.23C4720,-452.79 4720,-434.01 4720,-415.93"/>
<polygon fill="black" stroke="black" points="4723.5,-415.7 4720,-405.7 4716.5,-415.7 4723.5,-415.7"/>
</g>
<!-- expert61_l3_tp6&#45;&gt;expert_agg_l3_tp6 -->
<g id="edge875" class="edge">
<title>expert61_l3_tp6&#45;&gt;expert_agg_l3_tp6</title>
<path fill="none" stroke="black" d="M4888.22,-467.23C4864.85,-451.58 4833.88,-430.83 4804.89,-411.41"/>
<polygon fill="black" stroke="black" points="4806.63,-408.36 4796.37,-405.7 4802.73,-414.18 4806.63,-408.36"/>
</g>
<!-- expert62_l3_tp6&#45;&gt;expert_agg_l3_tp6 -->
<g id="edge877" class="edge">
<title>expert62_l3_tp6&#45;&gt;expert_agg_l3_tp6</title>
<path fill="none" stroke="black" d="M5085.9,-467.44C5068.41,-458.52 5048.09,-448.88 5029,-441.54 4997.99,-429.61 4964.66,-418.53 4931.79,-408.53"/>
<polygon fill="black" stroke="black" points="4932.65,-405.13 4922.06,-405.6 4930.63,-411.84 4932.65,-405.13"/>
</g>
<!-- expert63_l3_tp6&#45;&gt;expert_agg_l3_tp6 -->
<g id="edge879" class="edge">
<title>expert63_l3_tp6&#45;&gt;expert_agg_l3_tp6</title>
<path fill="none" stroke="black" d="M5294.58,-467.51C5276.64,-458.11 5255.31,-448.12 5235,-441.54 5153.77,-415.2 5062.61,-396.47 4979.83,-383.31"/>
<polygon fill="black" stroke="black" points="4980.19,-379.82 4969.77,-381.73 4979.11,-386.74 4980.19,-379.82"/>
</g>
<!-- expert_agg_l3_tp6&#45;&gt;res_add2_l3_tp6 -->
<g id="edge880" class="edge">
<title>expert_agg_l3_tp6&#45;&gt;res_add2_l3_tp6</title>
<path fill="none" stroke="black" d="M4907.3,-323.84C5029.77,-305.08 5187.58,-280.9 5301.6,-263.43"/>
<polygon fill="black" stroke="black" points="5302.45,-266.84 5311.81,-261.87 5301.39,-259.92 5302.45,-266.84"/>
</g>
<!-- norm2_l3_tp6 -->
<g id="node592" class="node">
<title>norm2_l3_tp6</title>
<polygon fill="lightgreen" stroke="black" points="7140,-177.54 6874,-177.54 6874,-125.54 7140,-125.54 7140,-177.54"/>
<text text-anchor="middle" x="7007" y="-165.54" font-family="Arial" font-size="10.00">Layer Norm 2 TP6</text>
<text text-anchor="middle" x="7007" y="-154.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7007" y="-143.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="7007" y="-132.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- res_add2_l3_tp6&#45;&gt;norm2_l3_tp6 -->
<g id="edge882" class="edge">
<title>res_add2_l3_tp6&#45;&gt;norm2_l3_tp6</title>
<path fill="none" stroke="black" d="M5590.11,-230.85C5884.19,-214.6 6566.33,-176.9 6863.89,-160.45"/>
<polygon fill="black" stroke="black" points="6864.08,-163.94 6873.88,-159.9 6863.7,-156.95 6864.08,-163.94"/>
</g>
<!-- norm2_l3_tp6&#45;&gt;final_output -->
<g id="edge883" class="edge">
<title>norm2_l3_tp6&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M7140.06,-147.02C7692.77,-132.38 9809.18,-76.35 10466.24,-58.95"/>
<polygon fill="black" stroke="black" points="10466.38,-62.45 10476.28,-58.69 10466.19,-55.45 10466.38,-62.45"/>
</g>
<!-- mha_qkv_l3_tp7 -->
<g id="node594" class="node">
<title>mha_qkv_l3_tp7</title>
<polygon fill="lightgreen" stroke="black" points="2516.5,-1095.08 2225.5,-1095.08 2225.5,-1043.08 2516.5,-1043.08 2516.5,-1095.08"/>
<text text-anchor="middle" x="2371" y="-1083.08" font-family="Arial" font-size="10.00">MHA QKV TP7</text>
<text text-anchor="middle" x="2371" y="-1072.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="2371" y="-1061.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="2371" y="-1050.08" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- input_split_l3_tp7&#45;&gt;mha_qkv_l3_tp7 -->
<g id="edge885" class="edge">
<title>input_split_l3_tp7&#45;&gt;mha_qkv_l3_tp7</title>
<path fill="none" stroke="black" d="M2449.59,-1131.91C2436.95,-1121.96 2423.26,-1111.19 2410.9,-1101.47"/>
<polygon fill="black" stroke="black" points="2413.02,-1098.68 2403,-1095.25 2408.69,-1104.18 2413.02,-1098.68"/>
</g>
<!-- res_add_l3_tp7 -->
<g id="node598" class="node">
<title>res_add_l3_tp7</title>
<polygon fill="lightgreen" stroke="black" points="2473,-721.54 2195,-721.54 2195,-669.54 2473,-669.54 2473,-721.54"/>
<text text-anchor="middle" x="2334" y="-709.54" font-family="Arial" font-size="10.00">Residual Add TP7</text>
<text text-anchor="middle" x="2334" y="-698.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="2334" y="-687.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2334" y="-676.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- input_split_l3_tp7&#45;&gt;res_add_l3_tp7 -->
<g id="edge889" class="edge">
<title>input_split_l3_tp7&#45;&gt;res_add_l3_tp7</title>
<path fill="none" stroke="black" d="M2512.37,-1131.09C2517.49,-1119.82 2522.58,-1107.16 2526,-1095.08 2539.79,-1046.33 2541,-1032.74 2541,-982.08 2541,-982.08 2541,-982.08 2541,-892.08 2541,-832.12 2568.34,-804.45 2531,-757.54 2518.16,-741.41 2501.13,-729.45 2482.45,-720.6"/>
<polygon fill="black" stroke="black" points="2483.71,-717.34 2473.15,-716.5 2480.89,-723.74 2483.71,-717.34"/>
</g>
<!-- mha_attn_l3_tp7 -->
<g id="node595" class="node">
<title>mha_attn_l3_tp7</title>
<polygon fill="lightgreen" stroke="black" points="2511.5,-1007.08 2220.5,-1007.08 2220.5,-955.08 2511.5,-955.08 2511.5,-1007.08"/>
<text text-anchor="middle" x="2366" y="-995.08" font-family="Arial" font-size="10.00">MHA Attention TP7</text>
<text text-anchor="middle" x="2366" y="-984.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="2366" y="-973.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="2366" y="-962.08" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- mha_qkv_l3_tp7&#45;&gt;mha_attn_l3_tp7 -->
<g id="edge886" class="edge">
<title>mha_qkv_l3_tp7&#45;&gt;mha_attn_l3_tp7</title>
<path fill="none" stroke="black" d="M2369.53,-1042.74C2369.06,-1034.78 2368.54,-1025.84 2368.05,-1017.32"/>
<polygon fill="black" stroke="black" points="2371.54,-1017.01 2367.46,-1007.23 2364.55,-1017.42 2371.54,-1017.01"/>
</g>
<!-- mha_out_l3_tp7 -->
<g id="node596" class="node">
<title>mha_out_l3_tp7</title>
<polygon fill="lightgreen" stroke="black" points="2487,-919.08 2203,-919.08 2203,-867.08 2487,-867.08 2487,-919.08"/>
<text text-anchor="middle" x="2345" y="-907.08" font-family="Arial" font-size="10.00">MHA Output TP7</text>
<text text-anchor="middle" x="2345" y="-896.08" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=2, d_k=512]</text>
<text text-anchor="middle" x="2345" y="-885.08" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="2345" y="-874.08" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- mha_attn_l3_tp7&#45;&gt;mha_out_l3_tp7 -->
<g id="edge887" class="edge">
<title>mha_attn_l3_tp7&#45;&gt;mha_out_l3_tp7</title>
<path fill="none" stroke="black" d="M2359.81,-954.74C2357.85,-946.69 2355.64,-937.64 2353.54,-929.04"/>
<polygon fill="black" stroke="black" points="2356.92,-928.12 2351.14,-919.23 2350.12,-929.78 2356.92,-928.12"/>
</g>
<!-- attn_allreduce_l3_tp7 -->
<g id="node597" class="node">
<title>attn_allreduce_l3_tp7</title>
<ellipse fill="lightgray" stroke="black" cx="2334" cy="-794.31" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="2334" y="-808.31" font-family="Arial" font-size="10.00">Attention All&#45;Reduce TP7</text>
<text text-anchor="middle" x="2334" y="-797.31" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=1024]</text>
<text text-anchor="middle" x="2334" y="-786.31" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2334" y="-775.31" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- mha_out_l3_tp7&#45;&gt;attn_allreduce_l3_tp7 -->
<g id="edge888" class="edge">
<title>mha_out_l3_tp7&#45;&gt;attn_allreduce_l3_tp7</title>
<path fill="none" stroke="black" d="M2342.14,-866.91C2341.25,-859.1 2340.24,-850.23 2339.25,-841.46"/>
<polygon fill="black" stroke="black" points="2342.7,-840.83 2338.09,-831.29 2335.74,-841.62 2342.7,-840.83"/>
</g>
<!-- attn_allreduce_l3_tp7&#45;&gt;res_add_l3_tp7 -->
<g id="edge890" class="edge">
<title>attn_allreduce_l3_tp7&#45;&gt;res_add_l3_tp7</title>
<path fill="none" stroke="black" d="M2334,-757.28C2334,-748.96 2334,-740.13 2334,-731.85"/>
<polygon fill="black" stroke="black" points="2337.5,-731.74 2334,-721.74 2330.5,-731.74 2337.5,-731.74"/>
</g>
<!-- norm_l3_tp7 -->
<g id="node599" class="node">
<title>norm_l3_tp7</title>
<polygon fill="lightgreen" stroke="black" points="2467,-633.54 2201,-633.54 2201,-581.54 2467,-581.54 2467,-633.54"/>
<text text-anchor="middle" x="2334" y="-621.54" font-family="Arial" font-size="10.00">Layer Norm TP7</text>
<text text-anchor="middle" x="2334" y="-610.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2334" y="-599.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2334" y="-588.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- res_add_l3_tp7&#45;&gt;norm_l3_tp7 -->
<g id="edge891" class="edge">
<title>res_add_l3_tp7&#45;&gt;norm_l3_tp7</title>
<path fill="none" stroke="black" d="M2334,-669.2C2334,-661.24 2334,-652.3 2334,-643.78"/>
<polygon fill="black" stroke="black" points="2337.5,-643.7 2334,-633.7 2330.5,-643.7 2337.5,-643.7"/>
</g>
<!-- gate_l3_tp7 -->
<g id="node600" class="node">
<title>gate_l3_tp7</title>
<polygon fill="lightyellow" stroke="black" points="1512.3,-545.54 1045.72,-545.54 925.7,-441.54 1392.28,-441.54 1512.3,-545.54"/>
<text text-anchor="middle" x="1219" y="-507.54" font-family="Arial" font-size="10.00">Gate Network TP7</text>
<text text-anchor="middle" x="1219" y="-496.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="1219" y="-485.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="1219" y="-474.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l3_tp7&#45;&gt;gate_l3_tp7 -->
<g id="edge892" class="edge">
<title>norm_l3_tp7&#45;&gt;gate_l3_tp7</title>
<path fill="none" stroke="black" d="M2200.91,-600.33C2039.59,-591.94 1759.68,-574.58 1521,-545.54 1520.9,-545.53 1520.79,-545.51 1520.69,-545.5"/>
<polygon fill="black" stroke="black" points="1521.4,-542.06 1511.05,-544.3 1520.54,-549.01 1521.4,-542.06"/>
</g>
<!-- expert64_l3_tp7 -->
<g id="node601" class="node">
<title>expert64_l3_tp7</title>
<polygon fill="lightcoral" stroke="black" points="1718,-519.54 1530,-519.54 1530,-467.54 1718,-467.54 1718,-519.54"/>
<text text-anchor="middle" x="1624" y="-507.54" font-family="Arial" font-size="10.00">Expert 64</text>
<text text-anchor="middle" x="1624" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1624" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1624" y="-474.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l3_tp7&#45;&gt;expert64_l3_tp7 -->
<g id="edge893" class="edge">
<title>norm_l3_tp7&#45;&gt;expert64_l3_tp7</title>
<path fill="none" stroke="black" d="M2200.8,-598.74C2049.65,-588.9 1812.95,-570.25 1727,-545.54 1709.53,-540.52 1691.44,-532.61 1675.4,-524.5"/>
<polygon fill="black" stroke="black" points="1676.69,-521.23 1666.21,-519.73 1673.47,-527.45 1676.69,-521.23"/>
</g>
<!-- expert65_l3_tp7 -->
<g id="node602" class="node">
<title>expert65_l3_tp7</title>
<polygon fill="lightcoral" stroke="black" points="1924,-519.54 1736,-519.54 1736,-467.54 1924,-467.54 1924,-519.54"/>
<text text-anchor="middle" x="1830" y="-507.54" font-family="Arial" font-size="10.00">Expert 65</text>
<text text-anchor="middle" x="1830" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1830" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1830" y="-474.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l3_tp7&#45;&gt;expert65_l3_tp7 -->
<g id="edge895" class="edge">
<title>norm_l3_tp7&#45;&gt;expert65_l3_tp7</title>
<path fill="none" stroke="black" d="M2200.73,-596.66C2121.57,-588.24 2019.97,-572.95 1933,-545.54 1915.9,-540.15 1898.11,-532.26 1882.23,-524.29"/>
<polygon fill="black" stroke="black" points="1883.61,-521.06 1873.11,-519.6 1880.41,-527.29 1883.61,-521.06"/>
</g>
<!-- expert66_l3_tp7 -->
<g id="node603" class="node">
<title>expert66_l3_tp7</title>
<polygon fill="lightcoral" stroke="black" points="2130,-519.54 1942,-519.54 1942,-467.54 2130,-467.54 2130,-519.54"/>
<text text-anchor="middle" x="2036" y="-507.54" font-family="Arial" font-size="10.00">Expert 66</text>
<text text-anchor="middle" x="2036" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2036" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2036" y="-474.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l3_tp7&#45;&gt;expert66_l3_tp7 -->
<g id="edge897" class="edge">
<title>norm_l3_tp7&#45;&gt;expert66_l3_tp7</title>
<path fill="none" stroke="black" d="M2243.66,-581.5C2210.36,-571.43 2172.58,-559.01 2139,-545.54 2123.43,-539.3 2106.98,-531.65 2091.91,-524.2"/>
<polygon fill="black" stroke="black" points="2093.23,-520.95 2082.72,-519.61 2090.1,-527.21 2093.23,-520.95"/>
</g>
<!-- expert67_l3_tp7 -->
<g id="node604" class="node">
<title>expert67_l3_tp7</title>
<polygon fill="lightcoral" stroke="black" points="2336,-519.54 2148,-519.54 2148,-467.54 2336,-467.54 2336,-519.54"/>
<text text-anchor="middle" x="2242" y="-507.54" font-family="Arial" font-size="10.00">Expert 67</text>
<text text-anchor="middle" x="2242" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2242" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2242" y="-474.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l3_tp7&#45;&gt;expert67_l3_tp7 -->
<g id="edge899" class="edge">
<title>norm_l3_tp7&#45;&gt;expert67_l3_tp7</title>
<path fill="none" stroke="black" d="M2313.35,-581.4C2300.33,-565.55 2283.37,-544.9 2269.25,-527.71"/>
<polygon fill="black" stroke="black" points="2271.63,-525.1 2262.58,-519.59 2266.22,-529.54 2271.63,-525.1"/>
</g>
<!-- expert68_l3_tp7 -->
<g id="node605" class="node">
<title>expert68_l3_tp7</title>
<polygon fill="lightcoral" stroke="black" points="2542,-519.54 2354,-519.54 2354,-467.54 2542,-467.54 2542,-519.54"/>
<text text-anchor="middle" x="2448" y="-507.54" font-family="Arial" font-size="10.00">Expert 68</text>
<text text-anchor="middle" x="2448" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2448" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2448" y="-474.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l3_tp7&#45;&gt;expert68_l3_tp7 -->
<g id="edge901" class="edge">
<title>norm_l3_tp7&#45;&gt;expert68_l3_tp7</title>
<path fill="none" stroke="black" d="M2359.58,-581.4C2376.01,-565.26 2397.5,-544.15 2415.18,-526.78"/>
<polygon fill="black" stroke="black" points="2417.82,-529.1 2422.5,-519.59 2412.92,-524.1 2417.82,-529.1"/>
</g>
<!-- expert69_l3_tp7 -->
<g id="node606" class="node">
<title>expert69_l3_tp7</title>
<polygon fill="lightcoral" stroke="black" points="2748,-519.54 2560,-519.54 2560,-467.54 2748,-467.54 2748,-519.54"/>
<text text-anchor="middle" x="2654" y="-507.54" font-family="Arial" font-size="10.00">Expert 69</text>
<text text-anchor="middle" x="2654" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2654" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2654" y="-474.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l3_tp7&#45;&gt;expert69_l3_tp7 -->
<g id="edge903" class="edge">
<title>norm_l3_tp7&#45;&gt;expert69_l3_tp7</title>
<path fill="none" stroke="black" d="M2437.94,-581.53C2474.19,-571.71 2514.84,-559.44 2551,-545.54 2566.81,-539.46 2583.46,-531.81 2598.65,-524.29"/>
<polygon fill="black" stroke="black" points="2600.54,-527.26 2607.91,-519.64 2597.4,-521.01 2600.54,-527.26"/>
</g>
<!-- expert70_l3_tp7 -->
<g id="node607" class="node">
<title>expert70_l3_tp7</title>
<polygon fill="lightcoral" stroke="black" points="2954,-519.54 2766,-519.54 2766,-467.54 2954,-467.54 2954,-519.54"/>
<text text-anchor="middle" x="2860" y="-507.54" font-family="Arial" font-size="10.00">Expert 70</text>
<text text-anchor="middle" x="2860" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2860" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2860" y="-474.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l3_tp7&#45;&gt;expert70_l3_tp7 -->
<g id="edge905" class="edge">
<title>norm_l3_tp7&#45;&gt;expert70_l3_tp7</title>
<path fill="none" stroke="black" d="M2467.38,-598.16C2551.86,-590.22 2662.59,-574.9 2757,-545.54 2774.2,-540.19 2792.08,-532.27 2808.02,-524.26"/>
<polygon fill="black" stroke="black" points="2809.87,-527.24 2817.16,-519.55 2806.67,-521.02 2809.87,-527.24"/>
</g>
<!-- expert71_l3_tp7 -->
<g id="node608" class="node">
<title>expert71_l3_tp7</title>
<polygon fill="lightcoral" stroke="black" points="3160,-519.54 2972,-519.54 2972,-467.54 3160,-467.54 3160,-519.54"/>
<text text-anchor="middle" x="3066" y="-507.54" font-family="Arial" font-size="10.00">Expert 71</text>
<text text-anchor="middle" x="3066" y="-496.54" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3066" y="-485.54" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3066" y="-474.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l3_tp7&#45;&gt;expert71_l3_tp7 -->
<g id="edge907" class="edge">
<title>norm_l3_tp7&#45;&gt;expert71_l3_tp7</title>
<path fill="none" stroke="black" d="M2467.18,-599.29C2623.55,-589.78 2873,-571.25 2963,-545.54 2980.48,-540.55 2998.57,-532.65 3014.61,-524.54"/>
<polygon fill="black" stroke="black" points="3016.54,-527.48 3023.8,-519.77 3013.32,-521.27 3016.54,-527.48"/>
</g>
<!-- res_add2_l3_tp7 -->
<g id="node610" class="node">
<title>res_add2_l3_tp7</title>
<polygon fill="lightgreen" stroke="black" points="3318,-265.54 3040,-265.54 3040,-213.54 3318,-213.54 3318,-265.54"/>
<text text-anchor="middle" x="3179" y="-253.54" font-family="Arial" font-size="10.00">Residual Add 2 TP7</text>
<text text-anchor="middle" x="3179" y="-242.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="3179" y="-231.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3179" y="-220.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- norm_l3_tp7&#45;&gt;res_add2_l3_tp7 -->
<g id="edge910" class="edge">
<title>norm_l3_tp7&#45;&gt;res_add2_l3_tp7</title>
<path fill="none" stroke="black" d="M2467.2,-606.36C2690.69,-604.67 3121.52,-594.97 3169,-545.54 3187.32,-526.47 3183.15,-351.71 3180.42,-275.64"/>
<polygon fill="black" stroke="black" points="3183.92,-275.45 3180.05,-265.59 3176.92,-275.71 3183.92,-275.45"/>
</g>
<!-- expert_agg_l3_tp7 -->
<g id="node609" class="node">
<title>expert_agg_l3_tp7</title>
<polygon fill="lightpink" stroke="black" points="2723.55,-405.54 2285.21,-405.54 2172.45,-301.54 2610.79,-301.54 2723.55,-405.54"/>
<text text-anchor="middle" x="2448" y="-367.54" font-family="Arial" font-size="10.00">Expert Aggregation TP7</text>
<text text-anchor="middle" x="2448" y="-356.54" font-family="Arial" font-size="10.00">Input: [processed_tokens from 8 experts]</text>
<text text-anchor="middle" x="2448" y="-345.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2448" y="-334.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- expert64_l3_tp7&#45;&gt;expert_agg_l3_tp7 -->
<g id="edge894" class="edge">
<title>expert64_l3_tp7&#45;&gt;expert_agg_l3_tp7</title>
<path fill="none" stroke="black" d="M1666.77,-467.29C1684.79,-457.74 1706.35,-447.7 1727,-441.54 1890.12,-392.88 2081.72,-371.34 2226.39,-361.86"/>
<polygon fill="black" stroke="black" points="2226.97,-365.33 2236.72,-361.2 2226.52,-358.34 2226.97,-365.33"/>
</g>
<!-- expert65_l3_tp7&#45;&gt;expert_agg_l3_tp7 -->
<g id="edge896" class="edge">
<title>expert65_l3_tp7&#45;&gt;expert_agg_l3_tp7</title>
<path fill="none" stroke="black" d="M1873.42,-467.51C1891.36,-458.11 1912.69,-448.12 1933,-441.54 2031.93,-409.46 2145.58,-388.66 2240.91,-375.48"/>
<polygon fill="black" stroke="black" points="2241.53,-378.93 2250.96,-374.11 2240.58,-371.99 2241.53,-378.93"/>
</g>
<!-- expert66_l3_tp7&#45;&gt;expert_agg_l3_tp7 -->
<g id="edge898" class="edge">
<title>expert66_l3_tp7&#45;&gt;expert_agg_l3_tp7</title>
<path fill="none" stroke="black" d="M2082.1,-467.44C2099.59,-458.52 2119.91,-448.88 2139,-441.54 2179.42,-426 2223.76,-411.88 2265.93,-399.74"/>
<polygon fill="black" stroke="black" points="2267.09,-403.05 2275.74,-396.94 2265.17,-396.32 2267.09,-403.05"/>
</g>
<!-- expert67_l3_tp7&#45;&gt;expert_agg_l3_tp7 -->
<g id="edge900" class="edge">
<title>expert67_l3_tp7&#45;&gt;expert_agg_l3_tp7</title>
<path fill="none" stroke="black" d="M2279.78,-467.23C2303.15,-451.58 2334.12,-430.83 2363.11,-411.41"/>
<polygon fill="black" stroke="black" points="2365.27,-414.18 2371.63,-405.7 2361.37,-408.36 2365.27,-414.18"/>
</g>
<!-- expert68_l3_tp7&#45;&gt;expert_agg_l3_tp7 -->
<g id="edge902" class="edge">
<title>expert68_l3_tp7&#45;&gt;expert_agg_l3_tp7</title>
<path fill="none" stroke="black" d="M2448,-467.23C2448,-452.79 2448,-434.01 2448,-415.93"/>
<polygon fill="black" stroke="black" points="2451.5,-415.7 2448,-405.7 2444.5,-415.7 2451.5,-415.7"/>
</g>
<!-- expert69_l3_tp7&#45;&gt;expert_agg_l3_tp7 -->
<g id="edge904" class="edge">
<title>expert69_l3_tp7&#45;&gt;expert_agg_l3_tp7</title>
<path fill="none" stroke="black" d="M2616.22,-467.23C2592.85,-451.58 2561.88,-430.83 2532.89,-411.41"/>
<polygon fill="black" stroke="black" points="2534.63,-408.36 2524.37,-405.7 2530.73,-414.18 2534.63,-408.36"/>
</g>
<!-- expert70_l3_tp7&#45;&gt;expert_agg_l3_tp7 -->
<g id="edge906" class="edge">
<title>expert70_l3_tp7&#45;&gt;expert_agg_l3_tp7</title>
<path fill="none" stroke="black" d="M2813.9,-467.44C2796.41,-458.52 2776.09,-448.88 2757,-441.54 2725.99,-429.61 2692.66,-418.53 2659.79,-408.53"/>
<polygon fill="black" stroke="black" points="2660.65,-405.13 2650.06,-405.6 2658.63,-411.84 2660.65,-405.13"/>
</g>
<!-- expert71_l3_tp7&#45;&gt;expert_agg_l3_tp7 -->
<g id="edge908" class="edge">
<title>expert71_l3_tp7&#45;&gt;expert_agg_l3_tp7</title>
<path fill="none" stroke="black" d="M3022.58,-467.51C3004.64,-458.11 2983.31,-448.12 2963,-441.54 2881.77,-415.2 2790.61,-396.47 2707.83,-383.31"/>
<polygon fill="black" stroke="black" points="2708.19,-379.82 2697.77,-381.73 2707.11,-386.74 2708.19,-379.82"/>
</g>
<!-- expert_agg_l3_tp7&#45;&gt;res_add2_l3_tp7 -->
<g id="edge909" class="edge">
<title>expert_agg_l3_tp7&#45;&gt;res_add2_l3_tp7</title>
<path fill="none" stroke="black" d="M2635.3,-323.84C2757.77,-305.08 2915.58,-280.9 3029.6,-263.43"/>
<polygon fill="black" stroke="black" points="3030.45,-266.84 3039.81,-261.87 3029.39,-259.92 3030.45,-266.84"/>
</g>
<!-- norm2_l3_tp7 -->
<g id="node611" class="node">
<title>norm2_l3_tp7</title>
<polygon fill="lightgreen" stroke="black" points="5084,-177.54 4818,-177.54 4818,-125.54 5084,-125.54 5084,-177.54"/>
<text text-anchor="middle" x="4951" y="-165.54" font-family="Arial" font-size="10.00">Layer Norm 2 TP7</text>
<text text-anchor="middle" x="4951" y="-154.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4951" y="-143.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4951" y="-132.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- res_add2_l3_tp7&#45;&gt;norm2_l3_tp7 -->
<g id="edge911" class="edge">
<title>res_add2_l3_tp7&#45;&gt;norm2_l3_tp7</title>
<path fill="none" stroke="black" d="M3318.05,-231.79C3647.61,-215.8 4473.57,-175.71 4807.53,-159.5"/>
<polygon fill="black" stroke="black" points="4807.93,-162.99 4817.75,-159.01 4807.59,-156 4807.93,-162.99"/>
</g>
<!-- norm2_l3_tp7&#45;&gt;final_output -->
<g id="edge912" class="edge">
<title>norm2_l3_tp7&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M5084.14,-148.22C5395.6,-142.81 6196.05,-128.92 6865,-117.54 8242.92,-94.09 9902.11,-66.42 10464.59,-57.05"/>
<polygon fill="black" stroke="black" points="10464.89,-60.55 10474.83,-56.88 10464.77,-53.55 10464.89,-60.55"/>
</g>
</g>
</svg>
