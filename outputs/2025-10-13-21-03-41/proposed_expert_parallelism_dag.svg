<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proposed_expert_parallelism Pages: 1 -->
<svg width="2160pt" height="1955pt"
 viewBox="0.00 0.00 2160.00 1955.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.36 0.36) rotate(0) translate(4 5416.01)">
<title>proposed_expert_parallelism</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-5416.01 5984,-5416.01 5984,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_layer0</title>
<path fill="aliceblue" stroke="black" d="M61,-4088.39C61,-4088.39 4823,-4088.39 4823,-4088.39 4829,-4088.39 4835,-4094.39 4835,-4100.39 4835,-4100.39 4835,-5392.01 4835,-5392.01 4835,-5398.01 4829,-5404.01 4823,-5404.01 4823,-5404.01 61,-5404.01 61,-5404.01 55,-5404.01 49,-5398.01 49,-5392.01 49,-5392.01 49,-4100.39 49,-4100.39 49,-4094.39 55,-4088.39 61,-4088.39"/>
<text text-anchor="middle" x="2442" y="-5388.81" font-family="Times,serif" font-size="14.00">Layer 0</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer1</title>
<path fill="honeydew" stroke="black" d="M20,-2764.77C20,-2764.77 4782,-2764.77 4782,-2764.77 4788,-2764.77 4794,-2770.77 4794,-2776.77 4794,-2776.77 4794,-4068.39 4794,-4068.39 4794,-4074.39 4788,-4080.39 4782,-4080.39 4782,-4080.39 20,-4080.39 20,-4080.39 14,-4080.39 8,-4074.39 8,-4068.39 8,-4068.39 8,-2776.77 8,-2776.77 8,-2770.77 14,-2764.77 20,-2764.77"/>
<text text-anchor="middle" x="2401" y="-4065.19" font-family="Times,serif" font-size="14.00">Layer 1</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer2</title>
<path fill="lavender" stroke="black" d="M103,-1441.16C103,-1441.16 4865,-1441.16 4865,-1441.16 4871,-1441.16 4877,-1447.16 4877,-1453.16 4877,-1453.16 4877,-2744.77 4877,-2744.77 4877,-2750.77 4871,-2756.77 4865,-2756.77 4865,-2756.77 103,-2756.77 103,-2756.77 97,-2756.77 91,-2750.77 91,-2744.77 91,-2744.77 91,-1453.16 91,-1453.16 91,-1447.16 97,-1441.16 103,-1441.16"/>
<text text-anchor="middle" x="2484" y="-2741.57" font-family="Times,serif" font-size="14.00">Layer 2</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_layer3</title>
<path fill="mistyrose" stroke="black" d="M1198,-8C1198,-8 5960,-8 5960,-8 5966,-8 5972,-14 5972,-20 5972,-20 5972,-1421.16 5972,-1421.16 5972,-1427.16 5966,-1433.16 5960,-1433.16 5960,-1433.16 1198,-1433.16 1198,-1433.16 1192,-1433.16 1186,-1427.16 1186,-1421.16 1186,-1421.16 1186,-20 1186,-20 1186,-14 1192,-8 1198,-8"/>
<text text-anchor="middle" x="3579" y="-1417.96" font-family="Times,serif" font-size="14.00">Layer 3</text>
</g>
<!-- input_l0 -->
<g id="node1" class="node">
<title>input_l0</title>
<ellipse fill="lightblue" stroke="black" cx="2579" cy="-5336.24" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="2579" y="-5350.24" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="2579" y="-5339.24" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2579" y="-5328.24" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2579" y="-5317.24" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- mha_qkv_l0 -->
<g id="node2" class="node">
<title>mha_qkv_l0</title>
<polygon fill="lightgreen" stroke="black" points="2644,-5263.47 2348,-5263.47 2348,-5211.47 2644,-5211.47 2644,-5263.47"/>
<text text-anchor="middle" x="2496" y="-5251.47" font-family="Arial" font-size="10.00">MHA QKV Linear</text>
<text text-anchor="middle" x="2496" y="-5240.47" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2496" y="-5229.47" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2496" y="-5218.47" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- input_l0&#45;&gt;mha_qkv_l0 -->
<g id="edge1" class="edge">
<title>input_l0&#45;&gt;mha_qkv_l0</title>
<path fill="none" stroke="black" d="M2548.57,-5299.75C2540.62,-5290.49 2532.09,-5280.55 2524.27,-5271.43"/>
<polygon fill="black" stroke="black" points="2526.77,-5268.97 2517.6,-5263.66 2521.46,-5273.52 2526.77,-5268.97"/>
</g>
<!-- res_add_l0 -->
<g id="node5" class="node">
<title>res_add_l0</title>
<polygon fill="lightgreen" stroke="black" points="2720,-4999.47 2442,-4999.47 2442,-4947.47 2720,-4947.47 2720,-4999.47"/>
<text text-anchor="middle" x="2581" y="-4987.47" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="2581" y="-4976.47" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="2581" y="-4965.47" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2581" y="-4954.47" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- input_l0&#45;&gt;res_add_l0 -->
<g id="edge4" class="edge">
<title>input_l0&#45;&gt;res_add_l0</title>
<path fill="none" stroke="black" d="M2626.39,-5300.33C2637.16,-5289.8 2647.14,-5277.31 2653,-5263.47 2692.49,-5170.15 2694.81,-5127.32 2652,-5035.47 2646.85,-5024.42 2638.62,-5014.61 2629.57,-5006.26"/>
<polygon fill="black" stroke="black" points="2631.68,-5003.46 2621.81,-4999.6 2627.11,-5008.77 2631.68,-5003.46"/>
</g>
<!-- mha_attn_l0 -->
<g id="node3" class="node">
<title>mha_attn_l0</title>
<polygon fill="lightgreen" stroke="black" points="2644,-5175.47 2348,-5175.47 2348,-5123.47 2644,-5123.47 2644,-5175.47"/>
<text text-anchor="middle" x="2496" y="-5163.47" font-family="Arial" font-size="10.00">MHA Attention</text>
<text text-anchor="middle" x="2496" y="-5152.47" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2496" y="-5141.47" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2496" y="-5130.47" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- mha_qkv_l0&#45;&gt;mha_attn_l0 -->
<g id="edge2" class="edge">
<title>mha_qkv_l0&#45;&gt;mha_attn_l0</title>
<path fill="none" stroke="black" d="M2496,-5211.13C2496,-5203.17 2496,-5194.23 2496,-5185.71"/>
<polygon fill="black" stroke="black" points="2499.5,-5185.63 2496,-5175.63 2492.5,-5185.63 2499.5,-5185.63"/>
</g>
<!-- mha_out_l0 -->
<g id="node4" class="node">
<title>mha_out_l0</title>
<polygon fill="lightgreen" stroke="black" points="2642.5,-5087.47 2353.5,-5087.47 2353.5,-5035.47 2642.5,-5035.47 2642.5,-5087.47"/>
<text text-anchor="middle" x="2498" y="-5075.47" font-family="Arial" font-size="10.00">MHA Output Linear</text>
<text text-anchor="middle" x="2498" y="-5064.47" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2498" y="-5053.47" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2498" y="-5042.47" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- mha_attn_l0&#45;&gt;mha_out_l0 -->
<g id="edge3" class="edge">
<title>mha_attn_l0&#45;&gt;mha_out_l0</title>
<path fill="none" stroke="black" d="M2496.59,-5123.13C2496.77,-5115.17 2496.98,-5106.23 2497.18,-5097.71"/>
<polygon fill="black" stroke="black" points="2500.68,-5097.7 2497.41,-5087.63 2493.68,-5097.54 2500.68,-5097.7"/>
</g>
<!-- mha_out_l0&#45;&gt;res_add_l0 -->
<g id="edge5" class="edge">
<title>mha_out_l0&#45;&gt;res_add_l0</title>
<path fill="none" stroke="black" d="M2522.45,-5035.13C2530.98,-5026.3 2540.67,-5016.26 2549.68,-5006.92"/>
<polygon fill="black" stroke="black" points="2552.29,-5009.25 2556.72,-4999.63 2547.26,-5004.39 2552.29,-5009.25"/>
</g>
<!-- norm_l0 -->
<g id="node6" class="node">
<title>norm_l0</title>
<polygon fill="lightgreen" stroke="black" points="2714,-4911.47 2448,-4911.47 2448,-4859.47 2714,-4859.47 2714,-4911.47"/>
<text text-anchor="middle" x="2581" y="-4899.47" font-family="Arial" font-size="10.00">Layer Norm</text>
<text text-anchor="middle" x="2581" y="-4888.47" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2581" y="-4877.47" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2581" y="-4866.47" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- res_add_l0&#45;&gt;norm_l0 -->
<g id="edge6" class="edge">
<title>res_add_l0&#45;&gt;norm_l0</title>
<path fill="none" stroke="black" d="M2581,-4947.13C2581,-4939.17 2581,-4930.23 2581,-4921.71"/>
<polygon fill="black" stroke="black" points="2584.5,-4921.63 2581,-4911.63 2577.5,-4921.63 2584.5,-4921.63"/>
</g>
<!-- gate_l0 -->
<g id="node7" class="node">
<title>gate_l0</title>
<polygon fill="lightyellow" stroke="black" points="2295.3,-4823.47 1828.72,-4823.47 1708.7,-4719.47 2175.28,-4719.47 2295.3,-4823.47"/>
<text text-anchor="middle" x="2002" y="-4785.47" font-family="Arial" font-size="10.00">Gate Network</text>
<text text-anchor="middle" x="2002" y="-4774.47" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2002" y="-4763.47" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="2002" y="-4752.47" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l0&#45;&gt;gate_l0 -->
<g id="edge7" class="edge">
<title>norm_l0&#45;&gt;gate_l0</title>
<path fill="none" stroke="black" d="M2451.42,-4859.4C2399.21,-4849.3 2336.89,-4837.25 2275.53,-4825.38"/>
<polygon fill="black" stroke="black" points="2276.17,-4821.94 2265.69,-4823.48 2274.84,-4828.81 2276.17,-4821.94"/>
</g>
<!-- route_l0 -->
<g id="node8" class="node">
<title>route_l0</title>
<polygon fill="lightgray" stroke="black" stroke-dasharray="5,2" points="2848.46,-4823.47 2422.99,-4823.47 2313.54,-4719.47 2739.01,-4719.47 2848.46,-4823.47"/>
<text text-anchor="middle" x="2581" y="-4785.47" font-family="Arial" font-size="10.00">Token Routing</text>
<text text-anchor="middle" x="2581" y="-4774.47" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2581" y="-4763.47" font-family="Arial" font-size="10.00">Output: [distributed across 16 GPUs]</text>
<text text-anchor="middle" x="2581" y="-4752.47" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l0&#45;&gt;route_l0 -->
<g id="edge8" class="edge">
<title>norm_l0&#45;&gt;route_l0</title>
<path fill="none" stroke="black" d="M2581,-4859.33C2581,-4851.65 2581,-4842.84 2581,-4833.84"/>
<polygon fill="black" stroke="black" points="2584.5,-4833.65 2581,-4823.65 2577.5,-4833.65 2584.5,-4833.65"/>
</g>
<!-- res_add2_l0 -->
<g id="node58" class="node">
<title>res_add2_l0</title>
<polygon fill="lightgreen" stroke="black" points="2740,-4236.39 2462,-4236.39 2462,-4184.39 2740,-4184.39 2740,-4236.39"/>
<text text-anchor="middle" x="2601" y="-4224.39" font-family="Arial" font-size="10.00">Residual Add 2</text>
<text text-anchor="middle" x="2601" y="-4213.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="2601" y="-4202.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2601" y="-4191.39" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l0&#45;&gt;res_add2_l0 -->
<g id="edge74" class="edge">
<title>norm_l0&#45;&gt;res_add2_l0</title>
<path fill="none" stroke="black" d="M2714.3,-4884.49C3197.09,-4882.82 4826,-4861.36 4826,-4647.7 4826,-4647.7 4826,-4647.7 4826,-4448.16 4826,-4431.65 4828.69,-4422.95 4816,-4412.39 4657.58,-4280.48 3222.15,-4228.78 2750.45,-4215.26"/>
<polygon fill="black" stroke="black" points="2750.26,-4211.75 2740.17,-4214.96 2750.07,-4218.75 2750.26,-4211.75"/>
</g>
<!-- expert0_comm_l0 -->
<g id="node9" class="node">
<title>expert0_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="259" cy="-4646.7" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="259" y="-4660.7" font-family="Arial" font-size="10.00">Expert 0 Communication</text>
<text text-anchor="middle" x="259" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 0]</text>
<text text-anchor="middle" x="259" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 0]</text>
<text text-anchor="middle" x="259" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- route_l0&#45;&gt;expert0_comm_l0 -->
<g id="edge9" class="edge">
<title>route_l0&#45;&gt;expert0_comm_l0</title>
<path fill="none" stroke="black" d="M2314.64,-4720.6C2311.08,-4720.2 2307.53,-4719.83 2304,-4719.47 1487.56,-4636.9 1274.61,-4764.31 458,-4683.47 428.26,-4680.53 396.3,-4675.58 366.88,-4670.3"/>
<polygon fill="black" stroke="black" points="367.47,-4666.85 357,-4668.5 366.21,-4673.74 367.47,-4666.85"/>
</g>
<!-- expert1_comm_l0 -->
<g id="node12" class="node">
<title>expert1_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="589" cy="-4646.7" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="589" y="-4660.7" font-family="Arial" font-size="10.00">Expert 1 Communication</text>
<text text-anchor="middle" x="589" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 1]</text>
<text text-anchor="middle" x="589" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 1]</text>
<text text-anchor="middle" x="589" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- route_l0&#45;&gt;expert1_comm_l0 -->
<g id="edge13" class="edge">
<title>route_l0&#45;&gt;expert1_comm_l0</title>
<path fill="none" stroke="black" d="M2314.64,-4720.62C2311.08,-4720.22 2307.53,-4719.83 2304,-4719.47 1611.03,-4648.17 1427.75,-4773.81 737,-4683.47 720.57,-4681.32 703.31,-4678.08 686.61,-4674.41"/>
<polygon fill="black" stroke="black" points="687.38,-4670.99 676.85,-4672.2 685.84,-4677.82 687.38,-4670.99"/>
</g>
<!-- expert2_comm_l0 -->
<g id="node15" class="node">
<title>expert2_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="868" cy="-4646.7" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="868" y="-4660.7" font-family="Arial" font-size="10.00">Expert 2 Communication</text>
<text text-anchor="middle" x="868" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 2]</text>
<text text-anchor="middle" x="868" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 2]</text>
<text text-anchor="middle" x="868" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- route_l0&#45;&gt;expert2_comm_l0 -->
<g id="edge17" class="edge">
<title>route_l0&#45;&gt;expert2_comm_l0</title>
<path fill="none" stroke="black" d="M2314.64,-4720.64C2311.07,-4720.23 2307.53,-4719.84 2304,-4719.47 1742.01,-4660.13 1593.99,-4751.62 1033,-4683.47 1012.4,-4680.97 990.58,-4677.11 969.78,-4672.85"/>
<polygon fill="black" stroke="black" points="970.5,-4669.42 959.99,-4670.79 969.06,-4676.27 970.5,-4669.42"/>
</g>
<!-- expert3_comm_l0 -->
<g id="node18" class="node">
<title>expert3_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="1164" cy="-4646.7" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1164" y="-4660.7" font-family="Arial" font-size="10.00">Expert 3 Communication</text>
<text text-anchor="middle" x="1164" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 3]</text>
<text text-anchor="middle" x="1164" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 3]</text>
<text text-anchor="middle" x="1164" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- route_l0&#45;&gt;expert3_comm_l0 -->
<g id="edge21" class="edge">
<title>route_l0&#45;&gt;expert3_comm_l0</title>
<path fill="none" stroke="black" d="M2314.64,-4720.68C2311.07,-4720.26 2307.52,-4719.86 2304,-4719.47 1867.22,-4671.56 1751.48,-4742.07 1316,-4683.47 1298.93,-4681.17 1280.97,-4677.81 1263.62,-4674.06"/>
<polygon fill="black" stroke="black" points="1264,-4670.56 1253.48,-4671.81 1262.48,-4677.39 1264,-4670.56"/>
</g>
<!-- expert4_comm_l0 -->
<g id="node21" class="node">
<title>expert4_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="1447" cy="-4646.7" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1447" y="-4660.7" font-family="Arial" font-size="10.00">Expert 4 Communication</text>
<text text-anchor="middle" x="1447" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 4]</text>
<text text-anchor="middle" x="1447" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 4]</text>
<text text-anchor="middle" x="1447" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- route_l0&#45;&gt;expert4_comm_l0 -->
<g id="edge25" class="edge">
<title>route_l0&#45;&gt;expert4_comm_l0</title>
<path fill="none" stroke="black" d="M2314.63,-4720.77C2311.06,-4720.32 2307.52,-4719.88 2304,-4719.47 2003,-4683.95 1923.66,-4721.76 1623,-4683.47 1599.86,-4680.52 1575.21,-4676.24 1551.92,-4671.66"/>
<polygon fill="black" stroke="black" points="1552.52,-4668.21 1542.03,-4669.68 1551.14,-4675.08 1552.52,-4668.21"/>
</g>
<!-- expert5_comm_l0 -->
<g id="node24" class="node">
<title>expert5_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="1754" cy="-4646.7" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1754" y="-4660.7" font-family="Arial" font-size="10.00">Expert 5 Communication</text>
<text text-anchor="middle" x="1754" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 5]</text>
<text text-anchor="middle" x="1754" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 5]</text>
<text text-anchor="middle" x="1754" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- route_l0&#45;&gt;expert5_comm_l0 -->
<g id="edge29" class="edge">
<title>route_l0&#45;&gt;expert5_comm_l0</title>
<path fill="none" stroke="black" d="M2314.97,-4721.01C2311.29,-4720.48 2307.63,-4719.97 2304,-4719.47 2128.47,-4695.4 2081.9,-4711.7 1907,-4683.47 1890.12,-4680.74 1872.33,-4677.21 1855.08,-4673.42"/>
<polygon fill="black" stroke="black" points="1855.53,-4669.94 1845.01,-4671.17 1854,-4676.77 1855.53,-4669.94"/>
</g>
<!-- expert6_comm_l0 -->
<g id="node27" class="node">
<title>expert6_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="2038" cy="-4646.7" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2038" y="-4660.7" font-family="Arial" font-size="10.00">Expert 6 Communication</text>
<text text-anchor="middle" x="2038" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 6]</text>
<text text-anchor="middle" x="2038" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 6]</text>
<text text-anchor="middle" x="2038" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- route_l0&#45;&gt;expert6_comm_l0 -->
<g id="edge33" class="edge">
<title>route_l0&#45;&gt;expert6_comm_l0</title>
<path fill="none" stroke="black" d="M2339.5,-4719.43C2286.86,-4707.93 2231.5,-4695.54 2180,-4683.47 2166.75,-4680.37 2152.84,-4677 2139.12,-4673.61"/>
<polygon fill="black" stroke="black" points="2139.72,-4670.15 2129.17,-4671.14 2138.04,-4676.95 2139.72,-4670.15"/>
</g>
<!-- expert7_comm_l0 -->
<g id="node30" class="node">
<title>expert7_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="2311" cy="-4646.7" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2311" y="-4660.7" font-family="Arial" font-size="10.00">Expert 7 Communication</text>
<text text-anchor="middle" x="2311" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 7]</text>
<text text-anchor="middle" x="2311" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 7]</text>
<text text-anchor="middle" x="2311" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- route_l0&#45;&gt;expert7_comm_l0 -->
<g id="edge37" class="edge">
<title>route_l0&#45;&gt;expert7_comm_l0</title>
<path fill="none" stroke="black" d="M2468.45,-4719.29C2440.74,-4706.69 2411.74,-4693.51 2386.28,-4681.93"/>
<polygon fill="black" stroke="black" points="2387.62,-4678.7 2377.07,-4677.74 2384.73,-4685.07 2387.62,-4678.7"/>
</g>
<!-- expert8_comm_l0 -->
<g id="node33" class="node">
<title>expert8_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="2581" cy="-4646.7" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2581" y="-4660.7" font-family="Arial" font-size="10.00">Expert 8 Communication</text>
<text text-anchor="middle" x="2581" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 8]</text>
<text text-anchor="middle" x="2581" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 8]</text>
<text text-anchor="middle" x="2581" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- route_l0&#45;&gt;expert8_comm_l0 -->
<g id="edge41" class="edge">
<title>route_l0&#45;&gt;expert8_comm_l0</title>
<path fill="none" stroke="black" d="M2581,-4719.12C2581,-4710.71 2581,-4702.04 2581,-4693.77"/>
<polygon fill="black" stroke="black" points="2584.5,-4693.56 2581,-4683.56 2577.5,-4693.56 2584.5,-4693.56"/>
</g>
<!-- expert9_comm_l0 -->
<g id="node36" class="node">
<title>expert9_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="2852" cy="-4646.7" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2852" y="-4660.7" font-family="Arial" font-size="10.00">Expert 9 Communication</text>
<text text-anchor="middle" x="2852" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 9]</text>
<text text-anchor="middle" x="2852" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 9]</text>
<text text-anchor="middle" x="2852" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- route_l0&#45;&gt;expert9_comm_l0 -->
<g id="edge45" class="edge">
<title>route_l0&#45;&gt;expert9_comm_l0</title>
<path fill="none" stroke="black" d="M2693.97,-4719.29C2721.78,-4706.69 2750.89,-4693.51 2776.44,-4681.93"/>
<polygon fill="black" stroke="black" points="2778.02,-4685.06 2785.68,-4677.74 2775.13,-4678.68 2778.02,-4685.06"/>
</g>
<!-- expert10_comm_l0 -->
<g id="node39" class="node">
<title>expert10_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="3139" cy="-4646.7" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="3139" y="-4660.7" font-family="Arial" font-size="10.00">Expert 10 Communication</text>
<text text-anchor="middle" x="3139" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 10]</text>
<text text-anchor="middle" x="3139" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 10]</text>
<text text-anchor="middle" x="3139" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- route_l0&#45;&gt;expert10_comm_l0 -->
<g id="edge49" class="edge">
<title>route_l0&#45;&gt;expert10_comm_l0</title>
<path fill="none" stroke="black" d="M2754.24,-4733.46C2825.19,-4718.18 2908.07,-4700.17 2983,-4683.47 2998.83,-4679.94 3015.56,-4676.16 3031.95,-4672.43"/>
<polygon fill="black" stroke="black" points="3033.12,-4675.75 3042.09,-4670.11 3031.57,-4668.93 3033.12,-4675.75"/>
</g>
<!-- expert11_comm_l0 -->
<g id="node42" class="node">
<title>expert11_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="3434" cy="-4646.7" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="3434" y="-4660.7" font-family="Arial" font-size="10.00">Expert 11 Communication</text>
<text text-anchor="middle" x="3434" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 11]</text>
<text text-anchor="middle" x="3434" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 11]</text>
<text text-anchor="middle" x="3434" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- route_l0&#45;&gt;expert11_comm_l0 -->
<g id="edge53" class="edge">
<title>route_l0&#45;&gt;expert11_comm_l0</title>
<path fill="none" stroke="black" d="M2772.63,-4751.25C2911.94,-4736.09 3104.79,-4712.66 3273,-4683.47 3290.94,-4680.36 3309.89,-4676.58 3328.26,-4672.67"/>
<polygon fill="black" stroke="black" points="3329.05,-4676.08 3338.09,-4670.55 3327.58,-4669.24 3329.05,-4676.08"/>
</g>
<!-- expert12_comm_l0 -->
<g id="node45" class="node">
<title>expert12_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="3731" cy="-4646.7" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="3731" y="-4660.7" font-family="Arial" font-size="10.00">Expert 12 Communication</text>
<text text-anchor="middle" x="3731" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 12]</text>
<text text-anchor="middle" x="3731" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 12]</text>
<text text-anchor="middle" x="3731" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- route_l0&#45;&gt;expert12_comm_l0 -->
<g id="edge57" class="edge">
<title>route_l0&#45;&gt;expert12_comm_l0</title>
<path fill="none" stroke="black" d="M2782.28,-4760.3C2982.38,-4748.41 3297.64,-4724.87 3568,-4683.47 3586.78,-4680.59 3606.63,-4676.84 3625.77,-4672.86"/>
<polygon fill="black" stroke="black" points="3626.65,-4676.25 3635.71,-4670.75 3625.2,-4669.4 3626.65,-4676.25"/>
</g>
<!-- expert13_comm_l0 -->
<g id="node48" class="node">
<title>expert13_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="4028" cy="-4646.7" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4028" y="-4660.7" font-family="Arial" font-size="10.00">Expert 13 Communication</text>
<text text-anchor="middle" x="4028" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 13]</text>
<text text-anchor="middle" x="4028" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 13]</text>
<text text-anchor="middle" x="4028" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- route_l0&#45;&gt;expert13_comm_l0 -->
<g id="edge61" class="edge">
<title>route_l0&#45;&gt;expert13_comm_l0</title>
<path fill="none" stroke="black" d="M2787.97,-4765.88C3042.57,-4758.08 3487.47,-4737.38 3865,-4683.47 3884.14,-4680.74 3904.37,-4677 3923.83,-4672.96"/>
<polygon fill="black" stroke="black" points="3924.56,-4676.39 3933.62,-4670.9 3923.11,-4669.54 3924.56,-4676.39"/>
</g>
<!-- expert14_comm_l0 -->
<g id="node51" class="node">
<title>expert14_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="4325" cy="-4646.7" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4325" y="-4660.7" font-family="Arial" font-size="10.00">Expert 14 Communication</text>
<text text-anchor="middle" x="4325" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 14]</text>
<text text-anchor="middle" x="4325" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 14]</text>
<text text-anchor="middle" x="4325" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- route_l0&#45;&gt;expert14_comm_l0 -->
<g id="edge65" class="edge">
<title>route_l0&#45;&gt;expert14_comm_l0</title>
<path fill="none" stroke="black" d="M2792.05,-4769.63C3096.15,-4765.98 3674.62,-4749.92 4162,-4683.47 4181.28,-4680.84 4201.66,-4677.13 4221.24,-4673.09"/>
<polygon fill="black" stroke="black" points="4222.02,-4676.5 4231.08,-4671.01 4220.57,-4669.65 4222.02,-4676.5"/>
</g>
<!-- expert15_comm_l0 -->
<g id="node54" class="node">
<title>expert15_comm_l0</title>
<ellipse fill="lightgray" stroke="black" cx="4623" cy="-4646.7" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4623" y="-4660.7" font-family="Arial" font-size="10.00">Expert 15 Communication</text>
<text text-anchor="middle" x="4623" y="-4649.7" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 15]</text>
<text text-anchor="middle" x="4623" y="-4638.7" font-family="Arial" font-size="10.00">Output: [tokens on GPU 15]</text>
<text text-anchor="middle" x="4623" y="-4627.7" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- route_l0&#45;&gt;expert15_comm_l0 -->
<g id="edge69" class="edge">
<title>route_l0&#45;&gt;expert15_comm_l0</title>
<path fill="none" stroke="black" d="M2787.46,-4765.3C3205.92,-4754.09 4141.25,-4725.18 4459,-4683.47 4478.53,-4680.91 4499.17,-4677.2 4518.99,-4673.14"/>
<polygon fill="black" stroke="black" points="4519.88,-4676.53 4528.95,-4671.06 4518.44,-4669.68 4519.88,-4676.53"/>
</g>
<!-- expert0_l0 -->
<g id="node10" class="node">
<title>expert0_l0</title>
<polygon fill="lightcoral" stroke="black" points="325,-4573.93 137,-4573.93 137,-4521.93 325,-4521.93 325,-4573.93"/>
<text text-anchor="middle" x="231" y="-4561.93" font-family="Arial" font-size="10.00">Expert 0 MLP</text>
<text text-anchor="middle" x="231" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="231" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="231" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- expert0_comm_l0&#45;&gt;expert0_l0 -->
<g id="edge10" class="edge">
<title>expert0_comm_l0&#45;&gt;expert0_l0</title>
<path fill="none" stroke="black" d="M248.65,-4609.94C246.17,-4601.35 243.52,-4592.19 241.04,-4583.65"/>
<polygon fill="black" stroke="black" points="244.39,-4582.61 238.25,-4573.97 237.66,-4584.55 244.39,-4582.61"/>
</g>
<!-- expert0_return_l0 -->
<g id="node11" class="node">
<title>expert0_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="197" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="197" y="-4463.16" font-family="Arial" font-size="10.00">Expert 0 Return</text>
<text text-anchor="middle" x="197" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="197" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="197" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- expert0_l0&#45;&gt;expert0_return_l0 -->
<g id="edge11" class="edge">
<title>expert0_l0&#45;&gt;expert0_return_l0</title>
<path fill="none" stroke="black" d="M222.16,-4521.76C219.35,-4513.78 216.16,-4504.7 213.02,-4495.74"/>
<polygon fill="black" stroke="black" points="216.26,-4494.41 209.64,-4486.14 209.65,-4496.73 216.26,-4494.41"/>
</g>
<!-- aggregate_l0 -->
<g id="node57" class="node">
<title>aggregate_l0</title>
<polygon fill="lightpink" stroke="black" points="2856.55,-4376.39 2418.21,-4376.39 2305.45,-4272.39 2743.79,-4272.39 2856.55,-4376.39"/>
<text text-anchor="middle" x="2581" y="-4338.39" font-family="Arial" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2581" y="-4327.39" font-family="Arial" font-size="10.00">Input: [processed_tokens from all experts]</text>
<text text-anchor="middle" x="2581" y="-4316.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2581" y="-4305.39" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- expert0_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge12" class="edge">
<title>expert0_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M292.65,-4422.27C310.28,-4418.33 328.61,-4414.79 346,-4412.39 728.89,-4359.5 1867.89,-4336.26 2355.45,-4328.54"/>
<polygon fill="black" stroke="black" points="2355.84,-4332.03 2365.78,-4328.37 2355.73,-4325.03 2355.84,-4332.03"/>
</g>
<!-- expert1_l0 -->
<g id="node13" class="node">
<title>expert1_l0</title>
<polygon fill="lightcoral" stroke="black" points="674,-4573.93 486,-4573.93 486,-4521.93 674,-4521.93 674,-4573.93"/>
<text text-anchor="middle" x="580" y="-4561.93" font-family="Arial" font-size="10.00">Expert 1 MLP</text>
<text text-anchor="middle" x="580" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="580" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="580" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- expert1_comm_l0&#45;&gt;expert1_l0 -->
<g id="edge14" class="edge">
<title>expert1_comm_l0&#45;&gt;expert1_l0</title>
<path fill="none" stroke="black" d="M585.67,-4609.94C584.89,-4601.54 584.06,-4592.59 583.28,-4584.2"/>
<polygon fill="black" stroke="black" points="586.74,-4583.61 582.33,-4573.97 579.77,-4584.25 586.74,-4583.61"/>
</g>
<!-- expert1_return_l0 -->
<g id="node14" class="node">
<title>expert1_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="495" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="495" y="-4463.16" font-family="Arial" font-size="10.00">Expert 1 Return</text>
<text text-anchor="middle" x="495" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="495" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="495" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- expert1_l0&#45;&gt;expert1_return_l0 -->
<g id="edge15" class="edge">
<title>expert1_l0&#45;&gt;expert1_return_l0</title>
<path fill="none" stroke="black" d="M557.89,-4521.76C550.05,-4512.83 541,-4502.53 532.25,-4492.56"/>
<polygon fill="black" stroke="black" points="534.87,-4490.24 525.64,-4485.04 529.61,-4494.86 534.87,-4490.24"/>
</g>
<!-- expert1_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge16" class="edge">
<title>expert1_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M591.07,-4422.26C608.57,-4418.36 626.75,-4414.83 644,-4412.39 968.62,-4366.56 1920.59,-4340.11 2357.35,-4330.08"/>
<polygon fill="black" stroke="black" points="2357.65,-4333.57 2367.57,-4329.84 2357.49,-4326.57 2357.65,-4333.57"/>
</g>
<!-- expert2_l0 -->
<g id="node16" class="node">
<title>expert2_l0</title>
<polygon fill="lightcoral" stroke="black" points="921,-4573.93 733,-4573.93 733,-4521.93 921,-4521.93 921,-4573.93"/>
<text text-anchor="middle" x="827" y="-4561.93" font-family="Arial" font-size="10.00">Expert 2 MLP</text>
<text text-anchor="middle" x="827" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="827" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="827" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- expert2_comm_l0&#45;&gt;expert2_l0 -->
<g id="edge18" class="edge">
<title>expert2_comm_l0&#45;&gt;expert2_l0</title>
<path fill="none" stroke="black" d="M852.85,-4609.94C849.17,-4601.26 845.24,-4591.99 841.59,-4583.37"/>
<polygon fill="black" stroke="black" points="844.73,-4581.82 837.61,-4573.97 838.29,-4584.55 844.73,-4581.82"/>
</g>
<!-- expert2_return_l0 -->
<g id="node17" class="node">
<title>expert2_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="793" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="793" y="-4463.16" font-family="Arial" font-size="10.00">Expert 2 Return</text>
<text text-anchor="middle" x="793" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="793" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="793" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- expert2_l0&#45;&gt;expert2_return_l0 -->
<g id="edge19" class="edge">
<title>expert2_l0&#45;&gt;expert2_return_l0</title>
<path fill="none" stroke="black" d="M818.16,-4521.76C815.35,-4513.78 812.16,-4504.7 809.02,-4495.74"/>
<polygon fill="black" stroke="black" points="812.26,-4494.41 805.64,-4486.14 805.65,-4496.73 812.26,-4494.41"/>
</g>
<!-- expert2_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge20" class="edge">
<title>expert2_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M889.08,-4422.38C906.58,-4418.46 924.76,-4414.9 942,-4412.39 1208.93,-4373.6 1977.44,-4344.6 2359.67,-4332.13"/>
<polygon fill="black" stroke="black" points="2359.87,-4335.62 2369.75,-4331.8 2359.64,-4328.63 2359.87,-4335.62"/>
</g>
<!-- expert3_l0 -->
<g id="node19" class="node">
<title>expert3_l0</title>
<polygon fill="lightcoral" stroke="black" points="1252,-4573.93 1064,-4573.93 1064,-4521.93 1252,-4521.93 1252,-4573.93"/>
<text text-anchor="middle" x="1158" y="-4561.93" font-family="Arial" font-size="10.00">Expert 3 MLP</text>
<text text-anchor="middle" x="1158" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1158" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1158" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- expert3_comm_l0&#45;&gt;expert3_l0 -->
<g id="edge22" class="edge">
<title>expert3_comm_l0&#45;&gt;expert3_l0</title>
<path fill="none" stroke="black" d="M1161.77,-4609.67C1161.25,-4601.35 1160.7,-4592.52 1160.19,-4584.24"/>
<polygon fill="black" stroke="black" points="1163.67,-4583.89 1159.56,-4574.13 1156.69,-4584.32 1163.67,-4583.89"/>
</g>
<!-- expert3_return_l0 -->
<g id="node20" class="node">
<title>expert3_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="1091" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1091" y="-4463.16" font-family="Arial" font-size="10.00">Expert 3 Return</text>
<text text-anchor="middle" x="1091" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1091" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1091" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- expert3_l0&#45;&gt;expert3_return_l0 -->
<g id="edge23" class="edge">
<title>expert3_l0&#45;&gt;expert3_return_l0</title>
<path fill="none" stroke="black" d="M1140.57,-4521.76C1134.63,-4513.18 1127.81,-4503.33 1121.17,-4493.73"/>
<polygon fill="black" stroke="black" points="1123.97,-4491.64 1115.4,-4485.41 1118.22,-4495.62 1123.97,-4491.64"/>
</g>
<!-- expert3_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge24" class="edge">
<title>expert3_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M1187.51,-4422.46C1204.88,-4418.56 1222.9,-4414.98 1240,-4412.39 1629.16,-4353.5 2087.79,-4334.44 2355.31,-4328.3"/>
<polygon fill="black" stroke="black" points="2355.62,-4331.79 2365.54,-4328.07 2355.46,-4324.79 2355.62,-4331.79"/>
</g>
<!-- expert4_l0 -->
<g id="node22" class="node">
<title>expert4_l0</title>
<polygon fill="lightcoral" stroke="black" points="1504,-4573.93 1316,-4573.93 1316,-4521.93 1504,-4521.93 1504,-4573.93"/>
<text text-anchor="middle" x="1410" y="-4561.93" font-family="Arial" font-size="10.00">Expert 4 MLP</text>
<text text-anchor="middle" x="1410" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1410" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1410" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- expert4_comm_l0&#45;&gt;expert4_l0 -->
<g id="edge26" class="edge">
<title>expert4_comm_l0&#45;&gt;expert4_l0</title>
<path fill="none" stroke="black" d="M1433.33,-4609.94C1430.01,-4601.26 1426.46,-4591.99 1423.17,-4583.37"/>
<polygon fill="black" stroke="black" points="1426.42,-4582.06 1419.58,-4573.97 1419.88,-4584.56 1426.42,-4582.06"/>
</g>
<!-- expert4_return_l0 -->
<g id="node23" class="node">
<title>expert4_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="1389" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1389" y="-4463.16" font-family="Arial" font-size="10.00">Expert 4 Return</text>
<text text-anchor="middle" x="1389" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1389" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1389" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- expert4_l0&#45;&gt;expert4_return_l0 -->
<g id="edge27" class="edge">
<title>expert4_l0&#45;&gt;expert4_return_l0</title>
<path fill="none" stroke="black" d="M1404.54,-4521.76C1402.82,-4513.86 1400.88,-4504.89 1398.95,-4496.03"/>
<polygon fill="black" stroke="black" points="1402.35,-4495.17 1396.81,-4486.14 1395.51,-4496.65 1402.35,-4495.17"/>
</g>
<!-- expert4_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge28" class="edge">
<title>expert4_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M1485.95,-4422.63C1503.2,-4418.74 1521.06,-4415.11 1538,-4412.39 1820.34,-4367 2149.71,-4344.54 2361.59,-4333.97"/>
<polygon fill="black" stroke="black" points="2361.77,-4337.46 2371.59,-4333.47 2361.43,-4330.47 2361.77,-4337.46"/>
</g>
<!-- expert5_l0 -->
<g id="node25" class="node">
<title>expert5_l0</title>
<polygon fill="lightcoral" stroke="black" points="1814,-4573.93 1626,-4573.93 1626,-4521.93 1814,-4521.93 1814,-4573.93"/>
<text text-anchor="middle" x="1720" y="-4561.93" font-family="Arial" font-size="10.00">Expert 5 MLP</text>
<text text-anchor="middle" x="1720" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1720" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1720" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- expert5_comm_l0&#45;&gt;expert5_l0 -->
<g id="edge30" class="edge">
<title>expert5_comm_l0&#45;&gt;expert5_l0</title>
<path fill="none" stroke="black" d="M1741.44,-4609.94C1738.42,-4601.35 1735.2,-4592.19 1732.2,-4583.65"/>
<polygon fill="black" stroke="black" points="1735.42,-4582.25 1728.8,-4573.97 1728.81,-4584.57 1735.42,-4582.25"/>
</g>
<!-- expert5_return_l0 -->
<g id="node26" class="node">
<title>expert5_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="1687" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1687" y="-4463.16" font-family="Arial" font-size="10.00">Expert 5 Return</text>
<text text-anchor="middle" x="1687" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1687" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1687" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- expert5_l0&#45;&gt;expert5_return_l0 -->
<g id="edge31" class="edge">
<title>expert5_l0&#45;&gt;expert5_return_l0</title>
<path fill="none" stroke="black" d="M1711.42,-4521.76C1708.7,-4513.78 1705.6,-4504.7 1702.54,-4495.74"/>
<polygon fill="black" stroke="black" points="1705.81,-4494.47 1699.27,-4486.14 1699.18,-4496.73 1705.81,-4494.47"/>
</g>
<!-- expert5_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge32" class="edge">
<title>expert5_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M1785.23,-4422.83C1802.1,-4418.98 1819.5,-4415.32 1836,-4412.39 2015.22,-4380.53 2220.85,-4357.53 2370.61,-4343.2"/>
<polygon fill="black" stroke="black" points="2371.22,-4346.66 2380.84,-4342.23 2370.56,-4339.69 2371.22,-4346.66"/>
</g>
<!-- expert6_l0 -->
<g id="node28" class="node">
<title>expert6_l0</title>
<polygon fill="lightcoral" stroke="black" points="2105,-4573.93 1917,-4573.93 1917,-4521.93 2105,-4521.93 2105,-4573.93"/>
<text text-anchor="middle" x="2011" y="-4561.93" font-family="Arial" font-size="10.00">Expert 6 MLP</text>
<text text-anchor="middle" x="2011" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2011" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2011" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- expert6_comm_l0&#45;&gt;expert6_l0 -->
<g id="edge34" class="edge">
<title>expert6_comm_l0&#45;&gt;expert6_l0</title>
<path fill="none" stroke="black" d="M2028.02,-4609.94C2025.63,-4601.35 2023.07,-4592.19 2020.69,-4583.65"/>
<polygon fill="black" stroke="black" points="2024.05,-4582.67 2017.99,-4573.97 2017.3,-4584.55 2024.05,-4582.67"/>
</g>
<!-- expert6_return_l0 -->
<g id="node29" class="node">
<title>expert6_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="1985" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1985" y="-4463.16" font-family="Arial" font-size="10.00">Expert 6 Return</text>
<text text-anchor="middle" x="1985" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1985" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1985" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- expert6_l0&#45;&gt;expert6_return_l0 -->
<g id="edge35" class="edge">
<title>expert6_l0&#45;&gt;expert6_return_l0</title>
<path fill="none" stroke="black" d="M2004.24,-4521.76C2002.12,-4513.86 1999.7,-4504.89 1997.32,-4496.03"/>
<polygon fill="black" stroke="black" points="2000.64,-4494.89 1994.67,-4486.14 1993.88,-4496.7 2000.64,-4494.89"/>
</g>
<!-- expert6_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge36" class="edge">
<title>expert6_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M2085.45,-4423.42C2101.66,-4419.61 2118.27,-4415.81 2134,-4412.39 2217.35,-4394.28 2309.84,-4375.99 2388.96,-4360.88"/>
<polygon fill="black" stroke="black" points="2389.86,-4364.27 2399.03,-4358.96 2388.55,-4357.39 2389.86,-4364.27"/>
</g>
<!-- expert7_l0 -->
<g id="node31" class="node">
<title>expert7_l0</title>
<polygon fill="lightcoral" stroke="black" points="2387,-4573.93 2199,-4573.93 2199,-4521.93 2387,-4521.93 2387,-4573.93"/>
<text text-anchor="middle" x="2293" y="-4561.93" font-family="Arial" font-size="10.00">Expert 7 MLP</text>
<text text-anchor="middle" x="2293" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2293" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2293" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- expert7_comm_l0&#45;&gt;expert7_l0 -->
<g id="edge38" class="edge">
<title>expert7_comm_l0&#45;&gt;expert7_l0</title>
<path fill="none" stroke="black" d="M2304.35,-4609.94C2302.77,-4601.44 2301.08,-4592.39 2299.51,-4583.92"/>
<polygon fill="black" stroke="black" points="2302.93,-4583.16 2297.66,-4573.97 2296.05,-4584.45 2302.93,-4583.16"/>
</g>
<!-- expert7_return_l0 -->
<g id="node32" class="node">
<title>expert7_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="2283" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2283" y="-4463.16" font-family="Arial" font-size="10.00">Expert 7 Return</text>
<text text-anchor="middle" x="2283" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2283" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2283" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- expert7_l0&#45;&gt;expert7_return_l0 -->
<g id="edge39" class="edge">
<title>expert7_l0&#45;&gt;expert7_return_l0</title>
<path fill="none" stroke="black" d="M2290.4,-4521.76C2289.59,-4513.95 2288.68,-4505.08 2287.77,-4496.32"/>
<polygon fill="black" stroke="black" points="2291.23,-4495.72 2286.72,-4486.14 2284.26,-4496.44 2291.23,-4495.72"/>
</g>
<!-- expert7_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge40" class="edge">
<title>expert7_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M2356.66,-4417.81C2384.27,-4406.44 2416.56,-4393.13 2447.91,-4380.22"/>
<polygon fill="black" stroke="black" points="2449.24,-4383.46 2457.16,-4376.41 2446.58,-4376.99 2449.24,-4383.46"/>
</g>
<!-- expert8_l0 -->
<g id="node34" class="node">
<title>expert8_l0</title>
<polygon fill="lightcoral" stroke="black" points="2675,-4573.93 2487,-4573.93 2487,-4521.93 2675,-4521.93 2675,-4573.93"/>
<text text-anchor="middle" x="2581" y="-4561.93" font-family="Arial" font-size="10.00">Expert 8 MLP</text>
<text text-anchor="middle" x="2581" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2581" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2581" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- expert8_comm_l0&#45;&gt;expert8_l0 -->
<g id="edge42" class="edge">
<title>expert8_comm_l0&#45;&gt;expert8_l0</title>
<path fill="none" stroke="black" d="M2581,-4609.67C2581,-4601.35 2581,-4592.52 2581,-4584.24"/>
<polygon fill="black" stroke="black" points="2584.5,-4584.13 2581,-4574.13 2577.5,-4584.13 2584.5,-4584.13"/>
</g>
<!-- expert8_return_l0 -->
<g id="node35" class="node">
<title>expert8_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="2581" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2581" y="-4463.16" font-family="Arial" font-size="10.00">Expert 8 Return</text>
<text text-anchor="middle" x="2581" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2581" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2581" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- expert8_l0&#45;&gt;expert8_return_l0 -->
<g id="edge43" class="edge">
<title>expert8_l0&#45;&gt;expert8_return_l0</title>
<path fill="none" stroke="black" d="M2581,-4521.76C2581,-4513.95 2581,-4505.08 2581,-4496.32"/>
<polygon fill="black" stroke="black" points="2584.5,-4496.14 2581,-4486.14 2577.5,-4496.14 2584.5,-4496.14"/>
</g>
<!-- expert8_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge44" class="edge">
<title>expert8_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M2581,-4412.32C2581,-4404.28 2581,-4395.53 2581,-4386.79"/>
<polygon fill="black" stroke="black" points="2584.5,-4386.56 2581,-4376.56 2577.5,-4386.56 2584.5,-4386.56"/>
</g>
<!-- expert9_l0 -->
<g id="node37" class="node">
<title>expert9_l0</title>
<polygon fill="lightcoral" stroke="black" points="2955,-4573.93 2767,-4573.93 2767,-4521.93 2955,-4521.93 2955,-4573.93"/>
<text text-anchor="middle" x="2861" y="-4561.93" font-family="Arial" font-size="10.00">Expert 9 MLP</text>
<text text-anchor="middle" x="2861" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2861" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2861" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- expert9_comm_l0&#45;&gt;expert9_l0 -->
<g id="edge46" class="edge">
<title>expert9_comm_l0&#45;&gt;expert9_l0</title>
<path fill="none" stroke="black" d="M2855.33,-4609.94C2856.11,-4601.54 2856.94,-4592.59 2857.72,-4584.2"/>
<polygon fill="black" stroke="black" points="2861.23,-4584.25 2858.67,-4573.97 2854.26,-4583.61 2861.23,-4584.25"/>
</g>
<!-- expert9_return_l0 -->
<g id="node38" class="node">
<title>expert9_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="2879" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2879" y="-4463.16" font-family="Arial" font-size="10.00">Expert 9 Return</text>
<text text-anchor="middle" x="2879" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2879" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2879" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- expert9_l0&#45;&gt;expert9_return_l0 -->
<g id="edge47" class="edge">
<title>expert9_l0&#45;&gt;expert9_return_l0</title>
<path fill="none" stroke="black" d="M2865.68,-4521.76C2867.15,-4513.86 2868.82,-4504.89 2870.47,-4496.03"/>
<polygon fill="black" stroke="black" points="2873.92,-4496.61 2872.31,-4486.14 2867.04,-4495.33 2873.92,-4496.61"/>
</g>
<!-- expert9_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge48" class="edge">
<title>expert9_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M2805.34,-4417.81C2777.73,-4406.44 2745.44,-4393.13 2714.09,-4380.22"/>
<polygon fill="black" stroke="black" points="2715.42,-4376.99 2704.84,-4376.41 2712.76,-4383.46 2715.42,-4376.99"/>
</g>
<!-- expert10_l0 -->
<g id="node40" class="node">
<title>expert10_l0</title>
<polygon fill="lightcoral" stroke="black" points="3246,-4573.93 3058,-4573.93 3058,-4521.93 3246,-4521.93 3246,-4573.93"/>
<text text-anchor="middle" x="3152" y="-4561.93" font-family="Arial" font-size="10.00">Expert 10 MLP</text>
<text text-anchor="middle" x="3152" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3152" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3152" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- expert10_comm_l0&#45;&gt;expert10_l0 -->
<g id="edge50" class="edge">
<title>expert10_comm_l0&#45;&gt;expert10_l0</title>
<path fill="none" stroke="black" d="M3143.8,-4609.94C3144.95,-4601.44 3146.16,-4592.39 3147.3,-4583.92"/>
<polygon fill="black" stroke="black" points="3150.77,-4584.35 3148.64,-4573.97 3143.84,-4583.42 3150.77,-4584.35"/>
</g>
<!-- expert10_return_l0 -->
<g id="node41" class="node">
<title>expert10_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="3177" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3177" y="-4463.16" font-family="Arial" font-size="10.00">Expert 10 Return</text>
<text text-anchor="middle" x="3177" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3177" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3177" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- expert10_l0&#45;&gt;expert10_return_l0 -->
<g id="edge51" class="edge">
<title>expert10_l0&#45;&gt;expert10_return_l0</title>
<path fill="none" stroke="black" d="M3158.5,-4521.76C3160.54,-4513.86 3162.86,-4504.89 3165.15,-4496.03"/>
<polygon fill="black" stroke="black" points="3168.59,-4496.69 3167.71,-4486.14 3161.82,-4494.94 3168.59,-4496.69"/>
</g>
<!-- expert10_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge52" class="edge">
<title>expert10_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M3076.55,-4423.42C3060.34,-4419.61 3043.73,-4415.81 3028,-4412.39 2974.8,-4400.83 2917.87,-4389.2 2863.07,-4378.36"/>
<polygon fill="black" stroke="black" points="2863.72,-4374.92 2853.23,-4376.42 2862.36,-4381.79 2863.72,-4374.92"/>
</g>
<!-- expert11_l0 -->
<g id="node43" class="node">
<title>expert11_l0</title>
<polygon fill="lightcoral" stroke="black" points="3542,-4573.93 3354,-4573.93 3354,-4521.93 3542,-4521.93 3542,-4573.93"/>
<text text-anchor="middle" x="3448" y="-4561.93" font-family="Arial" font-size="10.00">Expert 11 MLP</text>
<text text-anchor="middle" x="3448" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3448" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3448" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- expert11_comm_l0&#45;&gt;expert11_l0 -->
<g id="edge54" class="edge">
<title>expert11_comm_l0&#45;&gt;expert11_l0</title>
<path fill="none" stroke="black" d="M3439.17,-4609.94C3440.4,-4601.44 3441.71,-4592.39 3442.94,-4583.92"/>
<polygon fill="black" stroke="black" points="3446.41,-4584.37 3444.38,-4573.97 3439.48,-4583.37 3446.41,-4584.37"/>
</g>
<!-- expert11_return_l0 -->
<g id="node44" class="node">
<title>expert11_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="3475" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3475" y="-4463.16" font-family="Arial" font-size="10.00">Expert 11 Return</text>
<text text-anchor="middle" x="3475" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3475" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3475" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- expert11_l0&#45;&gt;expert11_return_l0 -->
<g id="edge55" class="edge">
<title>expert11_l0&#45;&gt;expert11_return_l0</title>
<path fill="none" stroke="black" d="M3455.02,-4521.76C3457.23,-4513.86 3459.73,-4504.89 3462.2,-4496.03"/>
<polygon fill="black" stroke="black" points="3465.65,-4496.71 3464.96,-4486.14 3458.9,-4494.83 3465.65,-4496.71"/>
</g>
<!-- expert11_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge56" class="edge">
<title>expert11_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M3376.77,-4422.83C3359.9,-4418.98 3342.5,-4415.32 3326,-4412.39 3163.39,-4383.48 2979.04,-4361.87 2834.41,-4347.41"/>
<polygon fill="black" stroke="black" points="2834.36,-4343.89 2824.06,-4346.38 2833.67,-4350.85 2834.36,-4343.89"/>
</g>
<!-- expert12_l0 -->
<g id="node46" class="node">
<title>expert12_l0</title>
<polygon fill="lightcoral" stroke="black" points="3839,-4573.93 3651,-4573.93 3651,-4521.93 3839,-4521.93 3839,-4573.93"/>
<text text-anchor="middle" x="3745" y="-4561.93" font-family="Arial" font-size="10.00">Expert 12 MLP</text>
<text text-anchor="middle" x="3745" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3745" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3745" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- expert12_comm_l0&#45;&gt;expert12_l0 -->
<g id="edge58" class="edge">
<title>expert12_comm_l0&#45;&gt;expert12_l0</title>
<path fill="none" stroke="black" d="M3736.17,-4609.94C3737.4,-4601.44 3738.71,-4592.39 3739.94,-4583.92"/>
<polygon fill="black" stroke="black" points="3743.41,-4584.37 3741.38,-4573.97 3736.48,-4583.37 3743.41,-4584.37"/>
</g>
<!-- expert12_return_l0 -->
<g id="node47" class="node">
<title>expert12_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="3773" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3773" y="-4463.16" font-family="Arial" font-size="10.00">Expert 12 Return</text>
<text text-anchor="middle" x="3773" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3773" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3773" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- expert12_l0&#45;&gt;expert12_return_l0 -->
<g id="edge59" class="edge">
<title>expert12_l0&#45;&gt;expert12_return_l0</title>
<path fill="none" stroke="black" d="M3752.28,-4521.76C3754.59,-4513.78 3757.22,-4504.7 3759.81,-4495.74"/>
<polygon fill="black" stroke="black" points="3763.17,-4496.72 3762.59,-4486.14 3756.45,-4494.77 3763.17,-4496.72"/>
</g>
<!-- expert12_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge60" class="edge">
<title>expert12_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M3676.05,-4422.63C3658.8,-4418.74 3640.94,-4415.11 3624,-4412.39 3350.82,-4368.47 3033.61,-4346.02 2821.4,-4335.03"/>
<polygon fill="black" stroke="black" points="2821.54,-4331.54 2811.38,-4334.52 2821.18,-4338.53 2821.54,-4331.54"/>
</g>
<!-- expert13_l0 -->
<g id="node49" class="node">
<title>expert13_l0</title>
<polygon fill="lightcoral" stroke="black" points="4136,-4573.93 3948,-4573.93 3948,-4521.93 4136,-4521.93 4136,-4573.93"/>
<text text-anchor="middle" x="4042" y="-4561.93" font-family="Arial" font-size="10.00">Expert 13 MLP</text>
<text text-anchor="middle" x="4042" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4042" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4042" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- expert13_comm_l0&#45;&gt;expert13_l0 -->
<g id="edge62" class="edge">
<title>expert13_comm_l0&#45;&gt;expert13_l0</title>
<path fill="none" stroke="black" d="M4033.17,-4609.94C4034.4,-4601.44 4035.71,-4592.39 4036.94,-4583.92"/>
<polygon fill="black" stroke="black" points="4040.41,-4584.37 4038.38,-4573.97 4033.48,-4583.37 4040.41,-4584.37"/>
</g>
<!-- expert13_return_l0 -->
<g id="node50" class="node">
<title>expert13_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="4071" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4071" y="-4463.16" font-family="Arial" font-size="10.00">Expert 13 Return</text>
<text text-anchor="middle" x="4071" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4071" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4071" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- expert13_l0&#45;&gt;expert13_return_l0 -->
<g id="edge63" class="edge">
<title>expert13_l0&#45;&gt;expert13_return_l0</title>
<path fill="none" stroke="black" d="M4049.54,-4521.76C4051.93,-4513.78 4054.66,-4504.7 4057.34,-4495.74"/>
<polygon fill="black" stroke="black" points="4060.7,-4496.72 4060.22,-4486.14 4054,-4494.71 4060.7,-4496.72"/>
</g>
<!-- expert13_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge64" class="edge">
<title>expert13_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M3974.49,-4422.46C3957.12,-4418.56 3939.1,-4414.98 3922,-4412.39 3536.68,-4354.08 3083.27,-4334.82 2814.67,-4328.48"/>
<polygon fill="black" stroke="black" points="2814.48,-4324.98 2804.4,-4328.24 2814.32,-4331.97 2814.48,-4324.98"/>
</g>
<!-- expert14_l0 -->
<g id="node52" class="node">
<title>expert14_l0</title>
<polygon fill="lightcoral" stroke="black" points="4434,-4573.93 4246,-4573.93 4246,-4521.93 4434,-4521.93 4434,-4573.93"/>
<text text-anchor="middle" x="4340" y="-4561.93" font-family="Arial" font-size="10.00">Expert 14 MLP</text>
<text text-anchor="middle" x="4340" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4340" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4340" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- expert14_comm_l0&#45;&gt;expert14_l0 -->
<g id="edge66" class="edge">
<title>expert14_comm_l0&#45;&gt;expert14_l0</title>
<path fill="none" stroke="black" d="M4330.54,-4609.94C4331.86,-4601.44 4333.26,-4592.39 4334.58,-4583.92"/>
<polygon fill="black" stroke="black" points="4338.04,-4584.39 4336.12,-4573.97 4331.13,-4583.32 4338.04,-4584.39"/>
</g>
<!-- expert14_return_l0 -->
<g id="node53" class="node">
<title>expert14_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="4369" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4369" y="-4463.16" font-family="Arial" font-size="10.00">Expert 14 Return</text>
<text text-anchor="middle" x="4369" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4369" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4369" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- expert14_l0&#45;&gt;expert14_return_l0 -->
<g id="edge67" class="edge">
<title>expert14_l0&#45;&gt;expert14_return_l0</title>
<path fill="none" stroke="black" d="M4347.54,-4521.76C4349.93,-4513.78 4352.66,-4504.7 4355.34,-4495.74"/>
<polygon fill="black" stroke="black" points="4358.7,-4496.72 4358.22,-4486.14 4352,-4494.71 4358.7,-4496.72"/>
</g>
<!-- expert14_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge68" class="edge">
<title>expert14_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M4272.92,-4422.38C4255.42,-4418.46 4237.24,-4414.9 4220,-4412.39 3956.91,-4374.16 3206.58,-4345.44 2819.07,-4332.68"/>
<polygon fill="black" stroke="black" points="2818.96,-4329.17 2808.85,-4332.34 2818.73,-4336.17 2818.96,-4329.17"/>
</g>
<!-- expert15_l0 -->
<g id="node55" class="node">
<title>expert15_l0</title>
<polygon fill="lightcoral" stroke="black" points="4732,-4573.93 4544,-4573.93 4544,-4521.93 4732,-4521.93 4732,-4573.93"/>
<text text-anchor="middle" x="4638" y="-4561.93" font-family="Arial" font-size="10.00">Expert 15 MLP</text>
<text text-anchor="middle" x="4638" y="-4550.93" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4638" y="-4539.93" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4638" y="-4528.93" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- expert15_comm_l0&#45;&gt;expert15_l0 -->
<g id="edge70" class="edge">
<title>expert15_comm_l0&#45;&gt;expert15_l0</title>
<path fill="none" stroke="black" d="M4628.54,-4609.94C4629.86,-4601.44 4631.26,-4592.39 4632.58,-4583.92"/>
<polygon fill="black" stroke="black" points="4636.04,-4584.39 4634.12,-4573.97 4629.13,-4583.32 4636.04,-4584.39"/>
</g>
<!-- expert15_return_l0 -->
<g id="node56" class="node">
<title>expert15_return_l0</title>
<ellipse fill="lightgray" stroke="black" cx="4667" cy="-4449.16" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4667" y="-4463.16" font-family="Arial" font-size="10.00">Expert 15 Return</text>
<text text-anchor="middle" x="4667" y="-4452.16" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4667" y="-4441.16" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4667" y="-4430.16" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- expert15_l0&#45;&gt;expert15_return_l0 -->
<g id="edge71" class="edge">
<title>expert15_l0&#45;&gt;expert15_return_l0</title>
<path fill="none" stroke="black" d="M4645.54,-4521.76C4647.93,-4513.78 4650.66,-4504.7 4653.34,-4495.74"/>
<polygon fill="black" stroke="black" points="4656.7,-4496.72 4656.22,-4486.14 4650,-4494.71 4656.7,-4496.72"/>
</g>
<!-- expert15_return_l0&#45;&gt;aggregate_l0 -->
<g id="edge72" class="edge">
<title>expert15_return_l0&#45;&gt;aggregate_l0</title>
<path fill="none" stroke="black" d="M4570.93,-4422.26C4553.43,-4418.36 4535.25,-4414.83 4518,-4412.39 4196.3,-4366.98 3258.47,-4340.59 2816.56,-4330.35"/>
<polygon fill="black" stroke="black" points="2816.61,-4326.85 2806.53,-4330.12 2816.45,-4333.85 2816.61,-4326.85"/>
</g>
<!-- aggregate_l0&#45;&gt;res_add2_l0 -->
<g id="edge73" class="edge">
<title>aggregate_l0&#45;&gt;res_add2_l0</title>
<path fill="none" stroke="black" d="M2590.12,-4272.31C2591.69,-4263.55 2593.28,-4254.62 2594.75,-4246.4"/>
<polygon fill="black" stroke="black" points="2598.22,-4246.89 2596.53,-4236.43 2591.32,-4245.66 2598.22,-4246.89"/>
</g>
<!-- norm2_l0 -->
<g id="node59" class="node">
<title>norm2_l0</title>
<polygon fill="lightgreen" stroke="black" points="2734,-4148.39 2468,-4148.39 2468,-4096.39 2734,-4096.39 2734,-4148.39"/>
<text text-anchor="middle" x="2601" y="-4136.39" font-family="Arial" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2601" y="-4125.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2601" y="-4114.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2601" y="-4103.39" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- res_add2_l0&#45;&gt;norm2_l0 -->
<g id="edge75" class="edge">
<title>res_add2_l0&#45;&gt;norm2_l0</title>
<path fill="none" stroke="black" d="M2601,-4184.05C2601,-4176.09 2601,-4167.15 2601,-4158.64"/>
<polygon fill="black" stroke="black" points="2604.5,-4158.55 2601,-4148.55 2597.5,-4158.55 2604.5,-4158.55"/>
</g>
<!-- input_l1 -->
<g id="node60" class="node">
<title>input_l1</title>
<ellipse fill="lightblue" stroke="black" cx="2601" cy="-4012.62" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="2601" y="-4026.62" font-family="Arial" font-size="10.00">Layer 1 Input</text>
<text text-anchor="middle" x="2601" y="-4015.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2601" y="-4004.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2601" y="-3993.62" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm2_l0&#45;&gt;input_l1 -->
<g id="edge302" class="edge">
<title>norm2_l0&#45;&gt;input_l1</title>
<path fill="none" stroke="black" d="M2601,-4096.12C2601,-4085.33 2601,-4072.39 2601,-4059.98"/>
<polygon fill="black" stroke="black" points="2604.5,-4059.75 2601,-4049.75 2597.5,-4059.75 2604.5,-4059.75"/>
</g>
<!-- mha_qkv_l1 -->
<g id="node61" class="node">
<title>mha_qkv_l1</title>
<polygon fill="lightgreen" stroke="black" points="2603,-3939.85 2307,-3939.85 2307,-3887.85 2603,-3887.85 2603,-3939.85"/>
<text text-anchor="middle" x="2455" y="-3927.85" font-family="Arial" font-size="10.00">MHA QKV Linear</text>
<text text-anchor="middle" x="2455" y="-3916.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2455" y="-3905.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2455" y="-3894.85" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- input_l1&#45;&gt;mha_qkv_l1 -->
<g id="edge76" class="edge">
<title>input_l1&#45;&gt;mha_qkv_l1</title>
<path fill="none" stroke="black" d="M2549.11,-3977.23C2533.63,-3966.97 2516.76,-3955.79 2501.63,-3945.76"/>
<polygon fill="black" stroke="black" points="2503.22,-3942.61 2492.95,-3940.01 2499.35,-3948.45 2503.22,-3942.61"/>
</g>
<!-- res_add_l1 -->
<g id="node64" class="node">
<title>res_add_l1</title>
<polygon fill="lightgreen" stroke="black" points="2679,-3675.85 2401,-3675.85 2401,-3623.85 2679,-3623.85 2679,-3675.85"/>
<text text-anchor="middle" x="2540" y="-3663.85" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="2540" y="-3652.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="2540" y="-3641.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2540" y="-3630.85" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- input_l1&#45;&gt;res_add_l1 -->
<g id="edge79" class="edge">
<title>input_l1&#45;&gt;res_add_l1</title>
<path fill="none" stroke="black" d="M2612.14,-3975.86C2628.23,-3917.47 2651.81,-3799.4 2611,-3711.85 2605.85,-3700.8 2597.62,-3691 2588.57,-3682.65"/>
<polygon fill="black" stroke="black" points="2590.68,-3679.84 2580.81,-3675.98 2586.11,-3685.15 2590.68,-3679.84"/>
</g>
<!-- mha_attn_l1 -->
<g id="node62" class="node">
<title>mha_attn_l1</title>
<polygon fill="lightgreen" stroke="black" points="2603,-3851.85 2307,-3851.85 2307,-3799.85 2603,-3799.85 2603,-3851.85"/>
<text text-anchor="middle" x="2455" y="-3839.85" font-family="Arial" font-size="10.00">MHA Attention</text>
<text text-anchor="middle" x="2455" y="-3828.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2455" y="-3817.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2455" y="-3806.85" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- mha_qkv_l1&#45;&gt;mha_attn_l1 -->
<g id="edge77" class="edge">
<title>mha_qkv_l1&#45;&gt;mha_attn_l1</title>
<path fill="none" stroke="black" d="M2455,-3887.51C2455,-3879.55 2455,-3870.62 2455,-3862.1"/>
<polygon fill="black" stroke="black" points="2458.5,-3862.01 2455,-3852.01 2451.5,-3862.01 2458.5,-3862.01"/>
</g>
<!-- mha_out_l1 -->
<g id="node63" class="node">
<title>mha_out_l1</title>
<polygon fill="lightgreen" stroke="black" points="2601.5,-3763.85 2312.5,-3763.85 2312.5,-3711.85 2601.5,-3711.85 2601.5,-3763.85"/>
<text text-anchor="middle" x="2457" y="-3751.85" font-family="Arial" font-size="10.00">MHA Output Linear</text>
<text text-anchor="middle" x="2457" y="-3740.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2457" y="-3729.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2457" y="-3718.85" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- mha_attn_l1&#45;&gt;mha_out_l1 -->
<g id="edge78" class="edge">
<title>mha_attn_l1&#45;&gt;mha_out_l1</title>
<path fill="none" stroke="black" d="M2455.59,-3799.51C2455.77,-3791.55 2455.98,-3782.62 2456.18,-3774.1"/>
<polygon fill="black" stroke="black" points="2459.68,-3774.09 2456.41,-3764.01 2452.68,-3773.92 2459.68,-3774.09"/>
</g>
<!-- mha_out_l1&#45;&gt;res_add_l1 -->
<g id="edge80" class="edge">
<title>mha_out_l1&#45;&gt;res_add_l1</title>
<path fill="none" stroke="black" d="M2481.45,-3711.51C2489.98,-3702.68 2499.67,-3692.64 2508.68,-3683.31"/>
<polygon fill="black" stroke="black" points="2511.29,-3685.63 2515.72,-3676.01 2506.26,-3680.77 2511.29,-3685.63"/>
</g>
<!-- norm_l1 -->
<g id="node65" class="node">
<title>norm_l1</title>
<polygon fill="lightgreen" stroke="black" points="2673,-3587.85 2407,-3587.85 2407,-3535.85 2673,-3535.85 2673,-3587.85"/>
<text text-anchor="middle" x="2540" y="-3575.85" font-family="Arial" font-size="10.00">Layer Norm</text>
<text text-anchor="middle" x="2540" y="-3564.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2540" y="-3553.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2540" y="-3542.85" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- res_add_l1&#45;&gt;norm_l1 -->
<g id="edge81" class="edge">
<title>res_add_l1&#45;&gt;norm_l1</title>
<path fill="none" stroke="black" d="M2540,-3623.51C2540,-3615.55 2540,-3606.62 2540,-3598.1"/>
<polygon fill="black" stroke="black" points="2543.5,-3598.01 2540,-3588.01 2536.5,-3598.01 2543.5,-3598.01"/>
</g>
<!-- gate_l1 -->
<g id="node66" class="node">
<title>gate_l1</title>
<polygon fill="lightyellow" stroke="black" points="2254.3,-3499.85 1787.72,-3499.85 1667.7,-3395.85 2134.28,-3395.85 2254.3,-3499.85"/>
<text text-anchor="middle" x="1961" y="-3461.85" font-family="Arial" font-size="10.00">Gate Network</text>
<text text-anchor="middle" x="1961" y="-3450.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="1961" y="-3439.85" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="1961" y="-3428.85" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l1&#45;&gt;gate_l1 -->
<g id="edge82" class="edge">
<title>norm_l1&#45;&gt;gate_l1</title>
<path fill="none" stroke="black" d="M2410.42,-3535.79C2358.21,-3525.69 2295.89,-3513.63 2234.53,-3501.76"/>
<polygon fill="black" stroke="black" points="2235.17,-3498.32 2224.69,-3499.86 2233.84,-3505.19 2235.17,-3498.32"/>
</g>
<!-- route_l1 -->
<g id="node67" class="node">
<title>route_l1</title>
<polygon fill="lightgray" stroke="black" stroke-dasharray="5,2" points="2807.46,-3499.85 2381.99,-3499.85 2272.54,-3395.85 2698.01,-3395.85 2807.46,-3499.85"/>
<text text-anchor="middle" x="2540" y="-3461.85" font-family="Arial" font-size="10.00">Token Routing</text>
<text text-anchor="middle" x="2540" y="-3450.85" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2540" y="-3439.85" font-family="Arial" font-size="10.00">Output: [distributed across 16 GPUs]</text>
<text text-anchor="middle" x="2540" y="-3428.85" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l1&#45;&gt;route_l1 -->
<g id="edge83" class="edge">
<title>norm_l1&#45;&gt;route_l1</title>
<path fill="none" stroke="black" d="M2540,-3535.72C2540,-3528.03 2540,-3519.22 2540,-3510.22"/>
<polygon fill="black" stroke="black" points="2543.5,-3510.03 2540,-3500.03 2536.5,-3510.03 2543.5,-3510.03"/>
</g>
<!-- res_add2_l1 -->
<g id="node117" class="node">
<title>res_add2_l1</title>
<polygon fill="lightgreen" stroke="black" points="2741,-2912.77 2463,-2912.77 2463,-2860.77 2741,-2860.77 2741,-2912.77"/>
<text text-anchor="middle" x="2602" y="-2900.77" font-family="Arial" font-size="10.00">Residual Add 2</text>
<text text-anchor="middle" x="2602" y="-2889.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="2602" y="-2878.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2602" y="-2867.77" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l1&#45;&gt;res_add2_l1 -->
<g id="edge149" class="edge">
<title>norm_l1&#45;&gt;res_add2_l1</title>
<path fill="none" stroke="black" d="M2673.3,-3560.87C3156.09,-3559.2 4785,-3537.74 4785,-3324.08 4785,-3324.08 4785,-3324.08 4785,-3124.54 4785,-3108.04 4787.68,-3099.35 4775,-3088.77 4619.99,-2959.48 3217.12,-2906.16 2751.46,-2891.92"/>
<polygon fill="black" stroke="black" points="2751.41,-2888.42 2741.31,-2891.61 2751.2,-2895.41 2751.41,-2888.42"/>
</g>
<!-- expert0_comm_l1 -->
<g id="node68" class="node">
<title>expert0_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="424" cy="-3323.08" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="424" y="-3337.08" font-family="Arial" font-size="10.00">Expert 0 Communication</text>
<text text-anchor="middle" x="424" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 0]</text>
<text text-anchor="middle" x="424" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 0]</text>
<text text-anchor="middle" x="424" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- route_l1&#45;&gt;expert0_comm_l1 -->
<g id="edge84" class="edge">
<title>route_l1&#45;&gt;expert0_comm_l1</title>
<path fill="none" stroke="black" d="M2273.64,-3396.99C2270.08,-3396.59 2266.53,-3396.21 2263,-3395.85 1887.31,-3357.54 938.17,-3410.93 564,-3359.85 549.56,-3357.88 534.46,-3354.96 519.75,-3351.63"/>
<polygon fill="black" stroke="black" points="520.18,-3348.13 509.64,-3349.26 518.58,-3354.95 520.18,-3348.13"/>
</g>
<!-- expert1_comm_l1 -->
<g id="node71" class="node">
<title>expert1_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="695" cy="-3323.08" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="695" y="-3337.08" font-family="Arial" font-size="10.00">Expert 1 Communication</text>
<text text-anchor="middle" x="695" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 1]</text>
<text text-anchor="middle" x="695" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 1]</text>
<text text-anchor="middle" x="695" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- route_l1&#45;&gt;expert1_comm_l1 -->
<g id="edge88" class="edge">
<title>route_l1&#45;&gt;expert1_comm_l1</title>
<path fill="none" stroke="black" d="M2273.64,-3397.01C2270.07,-3396.61 2266.53,-3396.22 2263,-3395.85 1629.33,-3329.97 1460.67,-3450.05 830,-3359.85 816.67,-3357.95 802.78,-3355.18 789.18,-3352.03"/>
<polygon fill="black" stroke="black" points="789.89,-3348.6 779.35,-3349.67 788.26,-3355.4 789.89,-3348.6"/>
</g>
<!-- expert2_comm_l1 -->
<g id="node74" class="node">
<title>expert2_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="961" cy="-3323.08" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="961" y="-3337.08" font-family="Arial" font-size="10.00">Expert 2 Communication</text>
<text text-anchor="middle" x="961" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 2]</text>
<text text-anchor="middle" x="961" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 2]</text>
<text text-anchor="middle" x="961" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- route_l1&#45;&gt;expert2_comm_l1 -->
<g id="edge92" class="edge">
<title>route_l1&#45;&gt;expert2_comm_l1</title>
<path fill="none" stroke="black" d="M2273.64,-3397.04C2270.07,-3396.62 2266.53,-3396.23 2263,-3395.85 1745.7,-3340.59 1607.58,-3436.41 1093,-3359.85 1080.37,-3357.97 1067.22,-3355.3 1054.32,-3352.26"/>
<polygon fill="black" stroke="black" points="1055.07,-3348.84 1044.52,-3349.87 1053.41,-3355.64 1055.07,-3348.84"/>
</g>
<!-- expert3_comm_l1 -->
<g id="node77" class="node">
<title>expert3_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="1224" cy="-3323.08" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1224" y="-3337.08" font-family="Arial" font-size="10.00">Expert 3 Communication</text>
<text text-anchor="middle" x="1224" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 3]</text>
<text text-anchor="middle" x="1224" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 3]</text>
<text text-anchor="middle" x="1224" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- route_l1&#45;&gt;expert3_comm_l1 -->
<g id="edge96" class="edge">
<title>route_l1&#45;&gt;expert3_comm_l1</title>
<path fill="none" stroke="black" d="M2273.63,-3397.08C2270.07,-3396.65 2266.52,-3396.24 2263,-3395.85 1861.61,-3351.17 1754.15,-3421.44 1355,-3359.85 1342.77,-3357.97 1330.06,-3355.35 1317.56,-3352.38"/>
<polygon fill="black" stroke="black" points="1318.15,-3348.92 1307.6,-3349.93 1316.48,-3355.72 1318.15,-3348.92"/>
</g>
<!-- expert4_comm_l1 -->
<g id="node80" class="node">
<title>expert4_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="1486" cy="-3323.08" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1486" y="-3337.08" font-family="Arial" font-size="10.00">Expert 4 Communication</text>
<text text-anchor="middle" x="1486" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 4]</text>
<text text-anchor="middle" x="1486" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 4]</text>
<text text-anchor="middle" x="1486" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- route_l1&#45;&gt;expert4_comm_l1 -->
<g id="edge100" class="edge">
<title>route_l1&#45;&gt;expert4_comm_l1</title>
<path fill="none" stroke="black" d="M2273.62,-3397.16C2270.06,-3396.71 2266.52,-3396.27 2263,-3395.85 1977.47,-3361.75 1900.83,-3405.98 1617,-3359.85 1604.88,-3357.88 1592.27,-3355.23 1579.87,-3352.26"/>
<polygon fill="black" stroke="black" points="1580.54,-3348.82 1569.99,-3349.82 1578.86,-3355.62 1580.54,-3348.82"/>
</g>
<!-- expert5_comm_l1 -->
<g id="node83" class="node">
<title>expert5_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="1748" cy="-3323.08" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1748" y="-3337.08" font-family="Arial" font-size="10.00">Expert 5 Communication</text>
<text text-anchor="middle" x="1748" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 5]</text>
<text text-anchor="middle" x="1748" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 5]</text>
<text text-anchor="middle" x="1748" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- route_l1&#45;&gt;expert5_comm_l1 -->
<g id="edge104" class="edge">
<title>route_l1&#45;&gt;expert5_comm_l1</title>
<path fill="none" stroke="black" d="M2273.97,-3397.4C2270.29,-3396.87 2266.63,-3396.36 2263,-3395.85 2092.77,-3372.27 2047.05,-3390.77 1878,-3359.85 1866.4,-3357.73 1854.32,-3355.06 1842.42,-3352.13"/>
<polygon fill="black" stroke="black" points="1843.02,-3348.68 1832.47,-3349.62 1841.31,-3355.46 1843.02,-3348.68"/>
</g>
<!-- expert6_comm_l1 -->
<g id="node86" class="node">
<title>expert6_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="2009" cy="-3323.08" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2009" y="-3337.08" font-family="Arial" font-size="10.00">Expert 6 Communication</text>
<text text-anchor="middle" x="2009" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 6]</text>
<text text-anchor="middle" x="2009" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 6]</text>
<text text-anchor="middle" x="2009" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- route_l1&#45;&gt;expert6_comm_l1 -->
<g id="edge108" class="edge">
<title>route_l1&#45;&gt;expert6_comm_l1</title>
<path fill="none" stroke="black" d="M2294.58,-3395.84C2243.06,-3384.51 2189.15,-3372.18 2139,-3359.85 2128.28,-3357.22 2117.09,-3354.34 2105.97,-3351.39"/>
<polygon fill="black" stroke="black" points="2106.8,-3347.99 2096.24,-3348.79 2105,-3354.75 2106.8,-3347.99"/>
</g>
<!-- expert7_comm_l1 -->
<g id="node89" class="node">
<title>expert7_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="2270" cy="-3323.08" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2270" y="-3337.08" font-family="Arial" font-size="10.00">Expert 7 Communication</text>
<text text-anchor="middle" x="2270" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 7]</text>
<text text-anchor="middle" x="2270" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 7]</text>
<text text-anchor="middle" x="2270" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- route_l1&#45;&gt;expert7_comm_l1 -->
<g id="edge112" class="edge">
<title>route_l1&#45;&gt;expert7_comm_l1</title>
<path fill="none" stroke="black" d="M2427.45,-3395.68C2399.74,-3383.08 2370.74,-3369.89 2345.28,-3358.31"/>
<polygon fill="black" stroke="black" points="2346.62,-3355.08 2336.07,-3354.13 2343.73,-3361.45 2346.62,-3355.08"/>
</g>
<!-- expert8_comm_l1 -->
<g id="node92" class="node">
<title>expert8_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="2540" cy="-3323.08" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2540" y="-3337.08" font-family="Arial" font-size="10.00">Expert 8 Communication</text>
<text text-anchor="middle" x="2540" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 8]</text>
<text text-anchor="middle" x="2540" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 8]</text>
<text text-anchor="middle" x="2540" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- route_l1&#45;&gt;expert8_comm_l1 -->
<g id="edge116" class="edge">
<title>route_l1&#45;&gt;expert8_comm_l1</title>
<path fill="none" stroke="black" d="M2540,-3395.5C2540,-3387.09 2540,-3378.42 2540,-3370.15"/>
<polygon fill="black" stroke="black" points="2543.5,-3369.94 2540,-3359.94 2536.5,-3369.94 2543.5,-3369.94"/>
</g>
<!-- expert9_comm_l1 -->
<g id="node95" class="node">
<title>expert9_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="2811" cy="-3323.08" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2811" y="-3337.08" font-family="Arial" font-size="10.00">Expert 9 Communication</text>
<text text-anchor="middle" x="2811" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 9]</text>
<text text-anchor="middle" x="2811" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 9]</text>
<text text-anchor="middle" x="2811" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- route_l1&#45;&gt;expert9_comm_l1 -->
<g id="edge120" class="edge">
<title>route_l1&#45;&gt;expert9_comm_l1</title>
<path fill="none" stroke="black" d="M2652.97,-3395.68C2680.78,-3383.08 2709.89,-3369.89 2735.44,-3358.31"/>
<polygon fill="black" stroke="black" points="2737.02,-3361.44 2744.68,-3354.13 2734.13,-3355.06 2737.02,-3361.44"/>
</g>
<!-- expert10_comm_l1 -->
<g id="node98" class="node">
<title>expert10_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="3085" cy="-3323.08" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="3085" y="-3337.08" font-family="Arial" font-size="10.00">Expert 10 Communication</text>
<text text-anchor="middle" x="3085" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 10]</text>
<text text-anchor="middle" x="3085" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 10]</text>
<text text-anchor="middle" x="3085" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- route_l1&#45;&gt;expert10_comm_l1 -->
<g id="edge124" class="edge">
<title>route_l1&#45;&gt;expert10_comm_l1</title>
<path fill="none" stroke="black" d="M2713.9,-3410.48C2784.77,-3395.34 2867.42,-3377.25 2942,-3359.85 2955.04,-3356.81 2968.71,-3353.52 2982.23,-3350.21"/>
<polygon fill="black" stroke="black" points="2983.15,-3353.58 2992.03,-3347.8 2981.48,-3346.79 2983.15,-3353.58"/>
</g>
<!-- expert11_comm_l1 -->
<g id="node101" class="node">
<title>expert11_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="3380" cy="-3323.08" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="3380" y="-3337.08" font-family="Arial" font-size="10.00">Expert 11 Communication</text>
<text text-anchor="middle" x="3380" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 11]</text>
<text text-anchor="middle" x="3380" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 11]</text>
<text text-anchor="middle" x="3380" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- route_l1&#45;&gt;expert11_comm_l1 -->
<g id="edge128" class="edge">
<title>route_l1&#45;&gt;expert11_comm_l1</title>
<path fill="none" stroke="black" d="M2730.94,-3427.1C2867.4,-3411.83 3055.1,-3388.5 3219,-3359.85 3236.93,-3356.72 3255.89,-3352.93 3274.25,-3349.02"/>
<polygon fill="black" stroke="black" points="3275.05,-3352.43 3284.08,-3346.9 3273.57,-3345.58 3275.05,-3352.43"/>
</g>
<!-- expert12_comm_l1 -->
<g id="node104" class="node">
<title>expert12_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="3650" cy="-3323.08" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="3650" y="-3337.08" font-family="Arial" font-size="10.00">Expert 12 Communication</text>
<text text-anchor="middle" x="3650" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 12]</text>
<text text-anchor="middle" x="3650" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 12]</text>
<text text-anchor="middle" x="3650" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- route_l1&#45;&gt;expert12_comm_l1 -->
<g id="edge132" class="edge">
<title>route_l1&#45;&gt;expert12_comm_l1</title>
<path fill="none" stroke="black" d="M2743.23,-3438.66C2941.17,-3428.34 3249.98,-3406.03 3514,-3359.85 3526.55,-3357.66 3539.64,-3354.87 3552.52,-3351.82"/>
<polygon fill="black" stroke="black" points="3553.43,-3355.21 3562.32,-3349.45 3551.78,-3348.4 3553.43,-3355.21"/>
</g>
<!-- expert13_comm_l1 -->
<g id="node107" class="node">
<title>expert13_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="3951" cy="-3323.08" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="3951" y="-3337.08" font-family="Arial" font-size="10.00">Expert 13 Communication</text>
<text text-anchor="middle" x="3951" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 13]</text>
<text text-anchor="middle" x="3951" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 13]</text>
<text text-anchor="middle" x="3951" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- route_l1&#45;&gt;expert13_comm_l1 -->
<g id="edge136" class="edge">
<title>route_l1&#45;&gt;expert13_comm_l1</title>
<path fill="none" stroke="black" d="M2745.92,-3441.35C2993.41,-3432.68 3420.78,-3411.19 3784,-3359.85 3804.06,-3357.02 3825.3,-3353.15 3845.68,-3349"/>
<polygon fill="black" stroke="black" points="3846.52,-3352.4 3855.6,-3346.94 3845.1,-3345.54 3846.52,-3352.4"/>
</g>
<!-- expert14_comm_l1 -->
<g id="node110" class="node">
<title>expert14_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="4259" cy="-3323.08" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4259" y="-3337.08" font-family="Arial" font-size="10.00">Expert 14 Communication</text>
<text text-anchor="middle" x="4259" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 14]</text>
<text text-anchor="middle" x="4259" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 14]</text>
<text text-anchor="middle" x="4259" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- route_l1&#45;&gt;expert14_comm_l1 -->
<g id="edge140" class="edge">
<title>route_l1&#45;&gt;expert14_comm_l1</title>
<path fill="none" stroke="black" d="M2749.56,-3444.76C3047.51,-3439.59 3610.13,-3421.69 4085,-3359.85 4106.88,-3357 4130.12,-3352.95 4152.25,-3348.59"/>
<polygon fill="black" stroke="black" points="4153.21,-3351.97 4162.33,-3346.57 4151.84,-3345.11 4153.21,-3351.97"/>
</g>
<!-- expert15_comm_l1 -->
<g id="node113" class="node">
<title>expert15_comm_l1</title>
<ellipse fill="lightgray" stroke="black" cx="4569" cy="-3323.08" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4569" y="-3337.08" font-family="Arial" font-size="10.00">Expert 15 Communication</text>
<text text-anchor="middle" x="4569" y="-3326.08" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 15]</text>
<text text-anchor="middle" x="4569" y="-3315.08" font-family="Arial" font-size="10.00">Output: [tokens on GPU 15]</text>
<text text-anchor="middle" x="4569" y="-3304.08" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- route_l1&#45;&gt;expert15_comm_l1 -->
<g id="edge144" class="edge">
<title>route_l1&#45;&gt;expert15_comm_l1</title>
<path fill="none" stroke="black" d="M2752.45,-3447.45C3097.82,-3446.06 3801.95,-3433.35 4393,-3359.85 4415.51,-3357.05 4439.43,-3352.96 4462.15,-3348.53"/>
<polygon fill="black" stroke="black" points="4463.02,-3351.92 4472.15,-3346.54 4461.66,-3345.06 4463.02,-3351.92"/>
</g>
<!-- expert0_l1 -->
<g id="node69" class="node">
<title>expert0_l1</title>
<polygon fill="lightcoral" stroke="black" points="518,-3250.31 330,-3250.31 330,-3198.31 518,-3198.31 518,-3250.31"/>
<text text-anchor="middle" x="424" y="-3238.31" font-family="Arial" font-size="10.00">Expert 0 MLP</text>
<text text-anchor="middle" x="424" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="424" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="424" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- expert0_comm_l1&#45;&gt;expert0_l1 -->
<g id="edge85" class="edge">
<title>expert0_comm_l1&#45;&gt;expert0_l1</title>
<path fill="none" stroke="black" d="M424,-3286.05C424,-3277.74 424,-3268.9 424,-3260.62"/>
<polygon fill="black" stroke="black" points="427.5,-3260.51 424,-3250.51 420.5,-3260.51 427.5,-3260.51"/>
</g>
<!-- expert0_return_l1 -->
<g id="node70" class="node">
<title>expert0_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="156" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="156" y="-3139.54" font-family="Arial" font-size="10.00">Expert 0 Return</text>
<text text-anchor="middle" x="156" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="156" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="156" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- expert0_l1&#45;&gt;expert0_return_l1 -->
<g id="edge86" class="edge">
<title>expert0_l1&#45;&gt;expert0_return_l1</title>
<path fill="none" stroke="black" d="M354.63,-3198.27C321.75,-3186.39 282.03,-3172.05 246.77,-3159.32"/>
<polygon fill="black" stroke="black" points="247.55,-3155.88 236.96,-3155.78 245.18,-3162.46 247.55,-3155.88"/>
</g>
<!-- aggregate_l1 -->
<g id="node116" class="node">
<title>aggregate_l1</title>
<polygon fill="lightpink" stroke="black" points="2815.55,-3052.77 2377.21,-3052.77 2264.45,-2948.77 2702.79,-2948.77 2815.55,-3052.77"/>
<text text-anchor="middle" x="2540" y="-3014.77" font-family="Arial" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2540" y="-3003.77" font-family="Arial" font-size="10.00">Input: [processed_tokens from all experts]</text>
<text text-anchor="middle" x="2540" y="-2992.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2540" y="-2981.77" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- expert0_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge87" class="edge">
<title>expert0_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M251.65,-3098.65C269.28,-3094.72 287.61,-3091.18 305,-3088.77 687.89,-3035.89 1826.89,-3012.64 2314.45,-3004.92"/>
<polygon fill="black" stroke="black" points="2314.84,-3008.41 2324.78,-3004.76 2314.73,-3001.42 2314.84,-3008.41"/>
</g>
<!-- expert1_l1 -->
<g id="node72" class="node">
<title>expert1_l1</title>
<polygon fill="lightcoral" stroke="black" points="756,-3250.31 568,-3250.31 568,-3198.31 756,-3198.31 756,-3250.31"/>
<text text-anchor="middle" x="662" y="-3238.31" font-family="Arial" font-size="10.00">Expert 1 MLP</text>
<text text-anchor="middle" x="662" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="662" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="662" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- expert1_comm_l1&#45;&gt;expert1_l1 -->
<g id="edge89" class="edge">
<title>expert1_comm_l1&#45;&gt;expert1_l1</title>
<path fill="none" stroke="black" d="M682.81,-3286.32C679.88,-3277.73 676.75,-3268.57 673.84,-3260.03"/>
<polygon fill="black" stroke="black" points="677.08,-3258.69 670.54,-3250.36 670.46,-3260.95 677.08,-3258.69"/>
</g>
<!-- expert1_return_l1 -->
<g id="node73" class="node">
<title>expert1_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="454" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="454" y="-3139.54" font-family="Arial" font-size="10.00">Expert 1 Return</text>
<text text-anchor="middle" x="454" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="454" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="454" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- expert1_l1&#45;&gt;expert1_return_l1 -->
<g id="edge90" class="edge">
<title>expert1_l1&#45;&gt;expert1_return_l1</title>
<path fill="none" stroke="black" d="M608.16,-3198.27C584.58,-3187.29 556.47,-3174.22 530.75,-3162.25"/>
<polygon fill="black" stroke="black" points="531.94,-3158.94 521.39,-3157.9 528.99,-3165.29 531.94,-3158.94"/>
</g>
<!-- expert1_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge91" class="edge">
<title>expert1_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M550.07,-3098.65C567.57,-3094.74 585.75,-3091.21 603,-3088.77 927.62,-3042.95 1879.59,-3016.49 2316.35,-3006.46"/>
<polygon fill="black" stroke="black" points="2316.65,-3009.95 2326.57,-3006.22 2316.49,-3002.95 2316.65,-3009.95"/>
</g>
<!-- expert2_l1 -->
<g id="node75" class="node">
<title>expert2_l1</title>
<polygon fill="lightcoral" stroke="black" points="1008,-3250.31 820,-3250.31 820,-3198.31 1008,-3198.31 1008,-3250.31"/>
<text text-anchor="middle" x="914" y="-3238.31" font-family="Arial" font-size="10.00">Expert 2 MLP</text>
<text text-anchor="middle" x="914" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="914" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="914" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- expert2_comm_l1&#45;&gt;expert2_l1 -->
<g id="edge93" class="edge">
<title>expert2_comm_l1&#45;&gt;expert2_l1</title>
<path fill="none" stroke="black" d="M943.77,-3286.6C939.49,-3277.8 934.93,-3268.4 930.68,-3259.66"/>
<polygon fill="black" stroke="black" points="933.75,-3257.97 926.23,-3250.5 927.45,-3261.02 933.75,-3257.97"/>
</g>
<!-- expert2_return_l1 -->
<g id="node76" class="node">
<title>expert2_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="752" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="752" y="-3139.54" font-family="Arial" font-size="10.00">Expert 2 Return</text>
<text text-anchor="middle" x="752" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="752" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="752" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- expert2_l1&#45;&gt;expert2_return_l1 -->
<g id="edge94" class="edge">
<title>expert2_l1&#45;&gt;expert2_return_l1</title>
<path fill="none" stroke="black" d="M871.86,-3198.14C854.78,-3187.94 834.69,-3175.94 815.88,-3164.7"/>
<polygon fill="black" stroke="black" points="817.44,-3161.56 807.06,-3159.43 813.85,-3167.57 817.44,-3161.56"/>
</g>
<!-- expert2_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge95" class="edge">
<title>expert2_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M848.08,-3098.76C865.58,-3094.85 883.76,-3091.28 901,-3088.77 1167.93,-3049.98 1936.44,-3020.98 2318.67,-3008.51"/>
<polygon fill="black" stroke="black" points="2318.87,-3012.01 2328.75,-3008.18 2318.64,-3005.01 2318.87,-3012.01"/>
</g>
<!-- expert3_l1 -->
<g id="node78" class="node">
<title>expert3_l1</title>
<polygon fill="lightcoral" stroke="black" points="1266,-3250.31 1078,-3250.31 1078,-3198.31 1266,-3198.31 1266,-3250.31"/>
<text text-anchor="middle" x="1172" y="-3238.31" font-family="Arial" font-size="10.00">Expert 3 MLP</text>
<text text-anchor="middle" x="1172" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1172" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1172" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- expert3_comm_l1&#45;&gt;expert3_l1 -->
<g id="edge97" class="edge">
<title>expert3_comm_l1&#45;&gt;expert3_l1</title>
<path fill="none" stroke="black" d="M1204.93,-3286.6C1200.16,-3277.71 1195.04,-3268.2 1190.31,-3259.38"/>
<polygon fill="black" stroke="black" points="1193.35,-3257.65 1185.53,-3250.5 1187.18,-3260.96 1193.35,-3257.65"/>
</g>
<!-- expert3_return_l1 -->
<g id="node79" class="node">
<title>expert3_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="1050" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1050" y="-3139.54" font-family="Arial" font-size="10.00">Expert 3 Return</text>
<text text-anchor="middle" x="1050" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1050" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1050" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- expert3_l1&#45;&gt;expert3_return_l1 -->
<g id="edge98" class="edge">
<title>expert3_l1&#45;&gt;expert3_return_l1</title>
<path fill="none" stroke="black" d="M1140.26,-3198.14C1128.34,-3188.68 1114.45,-3177.67 1101.2,-3167.16"/>
<polygon fill="black" stroke="black" points="1103.07,-3164.17 1093.06,-3160.7 1098.72,-3169.65 1103.07,-3164.17"/>
</g>
<!-- expert3_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge99" class="edge">
<title>expert3_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M1146.51,-3098.84C1163.88,-3094.94 1181.9,-3091.36 1199,-3088.77 1588.16,-3029.88 2046.79,-3010.83 2314.31,-3004.68"/>
<polygon fill="black" stroke="black" points="2314.62,-3008.17 2324.54,-3004.45 2314.46,-3001.17 2314.62,-3008.17"/>
</g>
<!-- expert4_l1 -->
<g id="node81" class="node">
<title>expert4_l1</title>
<polygon fill="lightcoral" stroke="black" points="1526,-3250.31 1338,-3250.31 1338,-3198.31 1526,-3198.31 1526,-3250.31"/>
<text text-anchor="middle" x="1432" y="-3238.31" font-family="Arial" font-size="10.00">Expert 4 MLP</text>
<text text-anchor="middle" x="1432" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1432" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1432" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- expert4_comm_l1&#45;&gt;expert4_l1 -->
<g id="edge101" class="edge">
<title>expert4_comm_l1&#45;&gt;expert4_l1</title>
<path fill="none" stroke="black" d="M1466.2,-3286.6C1461.24,-3277.71 1455.93,-3268.2 1451.01,-3259.38"/>
<polygon fill="black" stroke="black" points="1453.98,-3257.53 1446.05,-3250.5 1447.87,-3260.94 1453.98,-3257.53"/>
</g>
<!-- expert4_return_l1 -->
<g id="node82" class="node">
<title>expert4_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="1348" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1348" y="-3139.54" font-family="Arial" font-size="10.00">Expert 4 Return</text>
<text text-anchor="middle" x="1348" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1348" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1348" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- expert4_l1&#45;&gt;expert4_return_l1 -->
<g id="edge102" class="edge">
<title>expert4_l1&#45;&gt;expert4_return_l1</title>
<path fill="none" stroke="black" d="M1410.15,-3198.14C1402.55,-3189.39 1393.81,-3179.31 1385.32,-3169.54"/>
<polygon fill="black" stroke="black" points="1387.79,-3167.05 1378.59,-3161.79 1382.51,-3171.63 1387.79,-3167.05"/>
</g>
<!-- expert4_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge103" class="edge">
<title>expert4_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M1444.95,-3099.01C1462.2,-3095.12 1480.06,-3091.5 1497,-3088.77 1779.34,-3043.38 2108.71,-3020.92 2320.59,-3010.35"/>
<polygon fill="black" stroke="black" points="2320.77,-3013.85 2330.59,-3009.86 2320.43,-3006.85 2320.77,-3013.85"/>
</g>
<!-- expert5_l1 -->
<g id="node84" class="node">
<title>expert5_l1</title>
<polygon fill="lightcoral" stroke="black" points="1824,-3250.31 1636,-3250.31 1636,-3198.31 1824,-3198.31 1824,-3250.31"/>
<text text-anchor="middle" x="1730" y="-3238.31" font-family="Arial" font-size="10.00">Expert 5 MLP</text>
<text text-anchor="middle" x="1730" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1730" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1730" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- expert5_comm_l1&#45;&gt;expert5_l1 -->
<g id="edge105" class="edge">
<title>expert5_comm_l1&#45;&gt;expert5_l1</title>
<path fill="none" stroke="black" d="M1741.35,-3286.32C1739.77,-3277.83 1738.08,-3268.77 1736.51,-3260.31"/>
<polygon fill="black" stroke="black" points="1739.93,-3259.55 1734.66,-3250.36 1733.05,-3260.83 1739.93,-3259.55"/>
</g>
<!-- expert5_return_l1 -->
<g id="node85" class="node">
<title>expert5_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="1646" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1646" y="-3139.54" font-family="Arial" font-size="10.00">Expert 5 Return</text>
<text text-anchor="middle" x="1646" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1646" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1646" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- expert5_l1&#45;&gt;expert5_return_l1 -->
<g id="edge106" class="edge">
<title>expert5_l1&#45;&gt;expert5_return_l1</title>
<path fill="none" stroke="black" d="M1708.15,-3198.14C1700.55,-3189.39 1691.81,-3179.31 1683.32,-3169.54"/>
<polygon fill="black" stroke="black" points="1685.79,-3167.05 1676.59,-3161.79 1680.51,-3171.63 1685.79,-3167.05"/>
</g>
<!-- expert5_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge107" class="edge">
<title>expert5_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M1744.23,-3099.21C1761.1,-3095.36 1778.5,-3091.71 1795,-3088.77 1974.22,-3056.91 2179.85,-3033.91 2329.61,-3019.59"/>
<polygon fill="black" stroke="black" points="2330.22,-3023.04 2339.84,-3018.61 2329.56,-3016.07 2330.22,-3023.04"/>
</g>
<!-- expert6_l1 -->
<g id="node87" class="node">
<title>expert6_l1</title>
<polygon fill="lightcoral" stroke="black" points="2057,-3250.31 1869,-3250.31 1869,-3198.31 2057,-3198.31 2057,-3250.31"/>
<text text-anchor="middle" x="1963" y="-3238.31" font-family="Arial" font-size="10.00">Expert 6 MLP</text>
<text text-anchor="middle" x="1963" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1963" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1963" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- expert6_comm_l1&#45;&gt;expert6_l1 -->
<g id="edge109" class="edge">
<title>expert6_comm_l1&#45;&gt;expert6_l1</title>
<path fill="none" stroke="black" d="M1992.13,-3286.6C1987.95,-3277.8 1983.48,-3268.4 1979.33,-3259.66"/>
<polygon fill="black" stroke="black" points="1982.43,-3258.03 1974.97,-3250.5 1976.1,-3261.03 1982.43,-3258.03"/>
</g>
<!-- expert6_return_l1 -->
<g id="node88" class="node">
<title>expert6_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="1944" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1944" y="-3139.54" font-family="Arial" font-size="10.00">Expert 6 Return</text>
<text text-anchor="middle" x="1944" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1944" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1944" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- expert6_l1&#45;&gt;expert6_return_l1 -->
<g id="edge110" class="edge">
<title>expert6_l1&#45;&gt;expert6_return_l1</title>
<path fill="none" stroke="black" d="M1958.06,-3198.14C1956.51,-3190.25 1954.75,-3181.27 1953.01,-3172.41"/>
<polygon fill="black" stroke="black" points="1956.42,-3171.66 1951.06,-3162.52 1949.56,-3173.01 1956.42,-3171.66"/>
</g>
<!-- expert6_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge111" class="edge">
<title>expert6_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M2044.45,-3099.8C2060.66,-3095.99 2077.27,-3092.19 2093,-3088.77 2176.35,-3070.67 2268.84,-3052.37 2347.96,-3037.26"/>
<polygon fill="black" stroke="black" points="2348.86,-3040.65 2358.03,-3035.34 2347.55,-3033.77 2348.86,-3040.65"/>
</g>
<!-- expert7_l1 -->
<g id="node90" class="node">
<title>expert7_l1</title>
<polygon fill="lightcoral" stroke="black" points="2350,-3250.31 2162,-3250.31 2162,-3198.31 2350,-3198.31 2350,-3250.31"/>
<text text-anchor="middle" x="2256" y="-3238.31" font-family="Arial" font-size="10.00">Expert 7 MLP</text>
<text text-anchor="middle" x="2256" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2256" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2256" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- expert7_comm_l1&#45;&gt;expert7_l1 -->
<g id="edge113" class="edge">
<title>expert7_comm_l1&#45;&gt;expert7_l1</title>
<path fill="none" stroke="black" d="M2264.83,-3286.32C2263.6,-3277.83 2262.29,-3268.77 2261.06,-3260.31"/>
<polygon fill="black" stroke="black" points="2264.52,-3259.75 2259.62,-3250.36 2257.59,-3260.75 2264.52,-3259.75"/>
</g>
<!-- expert7_return_l1 -->
<g id="node91" class="node">
<title>expert7_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="2242" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2242" y="-3139.54" font-family="Arial" font-size="10.00">Expert 7 Return</text>
<text text-anchor="middle" x="2242" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2242" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2242" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- expert7_l1&#45;&gt;expert7_return_l1 -->
<g id="edge114" class="edge">
<title>expert7_l1&#45;&gt;expert7_return_l1</title>
<path fill="none" stroke="black" d="M2252.36,-3198.14C2251.23,-3190.33 2249.95,-3181.47 2248.68,-3172.7"/>
<polygon fill="black" stroke="black" points="2252.1,-3171.92 2247.2,-3162.52 2245.17,-3172.92 2252.1,-3171.92"/>
</g>
<!-- expert7_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge115" class="edge">
<title>expert7_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M2315.66,-3094.2C2343.27,-3082.82 2375.56,-3069.52 2406.91,-3056.6"/>
<polygon fill="black" stroke="black" points="2408.24,-3059.84 2416.16,-3052.79 2405.58,-3053.37 2408.24,-3059.84"/>
</g>
<!-- expert8_l1 -->
<g id="node93" class="node">
<title>expert8_l1</title>
<polygon fill="lightcoral" stroke="black" points="2634,-3250.31 2446,-3250.31 2446,-3198.31 2634,-3198.31 2634,-3250.31"/>
<text text-anchor="middle" x="2540" y="-3238.31" font-family="Arial" font-size="10.00">Expert 8 MLP</text>
<text text-anchor="middle" x="2540" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2540" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2540" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- expert8_comm_l1&#45;&gt;expert8_l1 -->
<g id="edge117" class="edge">
<title>expert8_comm_l1&#45;&gt;expert8_l1</title>
<path fill="none" stroke="black" d="M2540,-3286.05C2540,-3277.74 2540,-3268.9 2540,-3260.62"/>
<polygon fill="black" stroke="black" points="2543.5,-3260.51 2540,-3250.51 2536.5,-3260.51 2543.5,-3260.51"/>
</g>
<!-- expert8_return_l1 -->
<g id="node94" class="node">
<title>expert8_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="2540" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2540" y="-3139.54" font-family="Arial" font-size="10.00">Expert 8 Return</text>
<text text-anchor="middle" x="2540" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2540" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2540" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- expert8_l1&#45;&gt;expert8_return_l1 -->
<g id="edge118" class="edge">
<title>expert8_l1&#45;&gt;expert8_return_l1</title>
<path fill="none" stroke="black" d="M2540,-3198.14C2540,-3190.33 2540,-3181.47 2540,-3172.7"/>
<polygon fill="black" stroke="black" points="2543.5,-3172.52 2540,-3162.52 2536.5,-3172.52 2543.5,-3172.52"/>
</g>
<!-- expert8_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge119" class="edge">
<title>expert8_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M2540,-3088.7C2540,-3080.67 2540,-3071.92 2540,-3063.17"/>
<polygon fill="black" stroke="black" points="2543.5,-3062.94 2540,-3052.94 2536.5,-3062.94 2543.5,-3062.94"/>
</g>
<!-- expert9_l1 -->
<g id="node96" class="node">
<title>expert9_l1</title>
<polygon fill="lightcoral" stroke="black" points="2914,-3250.31 2726,-3250.31 2726,-3198.31 2914,-3198.31 2914,-3250.31"/>
<text text-anchor="middle" x="2820" y="-3238.31" font-family="Arial" font-size="10.00">Expert 9 MLP</text>
<text text-anchor="middle" x="2820" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2820" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2820" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- expert9_comm_l1&#45;&gt;expert9_l1 -->
<g id="edge121" class="edge">
<title>expert9_comm_l1&#45;&gt;expert9_l1</title>
<path fill="none" stroke="black" d="M2814.33,-3286.32C2815.11,-3277.92 2815.94,-3268.97 2816.72,-3260.59"/>
<polygon fill="black" stroke="black" points="2820.23,-3260.64 2817.67,-3250.36 2813.26,-3259.99 2820.23,-3260.64"/>
</g>
<!-- expert9_return_l1 -->
<g id="node97" class="node">
<title>expert9_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="2838" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2838" y="-3139.54" font-family="Arial" font-size="10.00">Expert 9 Return</text>
<text text-anchor="middle" x="2838" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2838" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2838" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- expert9_l1&#45;&gt;expert9_return_l1 -->
<g id="edge122" class="edge">
<title>expert9_l1&#45;&gt;expert9_return_l1</title>
<path fill="none" stroke="black" d="M2824.68,-3198.14C2826.15,-3190.25 2827.82,-3181.27 2829.47,-3172.41"/>
<polygon fill="black" stroke="black" points="2832.92,-3172.99 2831.31,-3162.52 2826.04,-3171.71 2832.92,-3172.99"/>
</g>
<!-- expert9_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge123" class="edge">
<title>expert9_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M2764.34,-3094.2C2736.73,-3082.82 2704.44,-3069.52 2673.09,-3056.6"/>
<polygon fill="black" stroke="black" points="2674.42,-3053.37 2663.84,-3052.79 2671.76,-3059.84 2674.42,-3053.37"/>
</g>
<!-- expert10_l1 -->
<g id="node99" class="node">
<title>expert10_l1</title>
<polygon fill="lightcoral" stroke="black" points="3200,-3250.31 3012,-3250.31 3012,-3198.31 3200,-3198.31 3200,-3250.31"/>
<text text-anchor="middle" x="3106" y="-3238.31" font-family="Arial" font-size="10.00">Expert 10 MLP</text>
<text text-anchor="middle" x="3106" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3106" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3106" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- expert10_comm_l1&#45;&gt;expert10_l1 -->
<g id="edge125" class="edge">
<title>expert10_comm_l1&#45;&gt;expert10_l1</title>
<path fill="none" stroke="black" d="M3092.76,-3286.32C3094.6,-3277.83 3096.57,-3268.77 3098.41,-3260.31"/>
<polygon fill="black" stroke="black" points="3101.86,-3260.87 3100.57,-3250.36 3095.02,-3259.39 3101.86,-3260.87"/>
</g>
<!-- expert10_return_l1 -->
<g id="node100" class="node">
<title>expert10_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="3136" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3136" y="-3139.54" font-family="Arial" font-size="10.00">Expert 10 Return</text>
<text text-anchor="middle" x="3136" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3136" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3136" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- expert10_l1&#45;&gt;expert10_return_l1 -->
<g id="edge126" class="edge">
<title>expert10_l1&#45;&gt;expert10_return_l1</title>
<path fill="none" stroke="black" d="M3113.8,-3198.14C3116.28,-3190.16 3119.09,-3181.08 3121.87,-3172.13"/>
<polygon fill="black" stroke="black" points="3125.23,-3173.11 3124.85,-3162.52 3118.54,-3171.03 3125.23,-3173.11"/>
</g>
<!-- expert10_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge127" class="edge">
<title>expert10_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M3035.55,-3099.8C3019.34,-3095.99 3002.73,-3092.19 2987,-3088.77 2933.8,-3077.22 2876.87,-3065.58 2822.07,-3054.75"/>
<polygon fill="black" stroke="black" points="2822.72,-3051.31 2812.23,-3052.8 2821.36,-3058.17 2822.72,-3051.31"/>
</g>
<!-- expert11_l1 -->
<g id="node102" class="node">
<title>expert11_l1</title>
<polygon fill="lightcoral" stroke="black" points="3523,-3250.31 3335,-3250.31 3335,-3198.31 3523,-3198.31 3523,-3250.31"/>
<text text-anchor="middle" x="3429" y="-3238.31" font-family="Arial" font-size="10.00">Expert 11 MLP</text>
<text text-anchor="middle" x="3429" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3429" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3429" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- expert11_comm_l1&#45;&gt;expert11_l1 -->
<g id="edge129" class="edge">
<title>expert11_comm_l1&#45;&gt;expert11_l1</title>
<path fill="none" stroke="black" d="M3397.97,-3286.6C3402.42,-3277.8 3407.18,-3268.4 3411.61,-3259.66"/>
<polygon fill="black" stroke="black" points="3414.85,-3261 3416.25,-3250.5 3408.61,-3257.84 3414.85,-3261"/>
</g>
<!-- expert11_return_l1 -->
<g id="node103" class="node">
<title>expert11_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="3434" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3434" y="-3139.54" font-family="Arial" font-size="10.00">Expert 11 Return</text>
<text text-anchor="middle" x="3434" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3434" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3434" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- expert11_l1&#45;&gt;expert11_return_l1 -->
<g id="edge130" class="edge">
<title>expert11_l1&#45;&gt;expert11_return_l1</title>
<path fill="none" stroke="black" d="M3430.3,-3198.14C3430.7,-3190.33 3431.16,-3181.47 3431.62,-3172.7"/>
<polygon fill="black" stroke="black" points="3435.12,-3172.69 3432.14,-3162.52 3428.13,-3172.33 3435.12,-3172.69"/>
</g>
<!-- expert11_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge131" class="edge">
<title>expert11_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M3335.77,-3099.21C3318.9,-3095.36 3301.5,-3091.71 3285,-3088.77 3122.39,-3059.87 2938.04,-3038.25 2793.41,-3023.79"/>
<polygon fill="black" stroke="black" points="2793.36,-3020.27 2783.06,-3022.76 2792.67,-3027.24 2793.36,-3020.27"/>
</g>
<!-- expert12_l1 -->
<g id="node105" class="node">
<title>expert12_l1</title>
<polygon fill="lightcoral" stroke="black" points="3761,-3250.31 3573,-3250.31 3573,-3198.31 3761,-3198.31 3761,-3250.31"/>
<text text-anchor="middle" x="3667" y="-3238.31" font-family="Arial" font-size="10.00">Expert 12 MLP</text>
<text text-anchor="middle" x="3667" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3667" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3667" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- expert12_comm_l1&#45;&gt;expert12_l1 -->
<g id="edge133" class="edge">
<title>expert12_comm_l1&#45;&gt;expert12_l1</title>
<path fill="none" stroke="black" d="M3656.28,-3286.32C3657.77,-3277.83 3659.37,-3268.77 3660.85,-3260.31"/>
<polygon fill="black" stroke="black" points="3664.32,-3260.81 3662.6,-3250.36 3657.42,-3259.6 3664.32,-3260.81"/>
</g>
<!-- expert12_return_l1 -->
<g id="node106" class="node">
<title>expert12_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="3732" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3732" y="-3139.54" font-family="Arial" font-size="10.00">Expert 12 Return</text>
<text text-anchor="middle" x="3732" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3732" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3732" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- expert12_l1&#45;&gt;expert12_return_l1 -->
<g id="edge134" class="edge">
<title>expert12_l1&#45;&gt;expert12_return_l1</title>
<path fill="none" stroke="black" d="M3683.91,-3198.14C3689.67,-3189.56 3696.29,-3179.71 3702.73,-3170.12"/>
<polygon fill="black" stroke="black" points="3705.66,-3172.04 3708.33,-3161.79 3699.84,-3168.14 3705.66,-3172.04"/>
</g>
<!-- expert12_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge135" class="edge">
<title>expert12_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M3635.05,-3099.01C3617.8,-3095.12 3599.94,-3091.5 3583,-3088.77 3309.82,-3044.85 2992.61,-3022.4 2780.4,-3011.42"/>
<polygon fill="black" stroke="black" points="2780.54,-3007.92 2770.38,-3010.9 2780.18,-3014.91 2780.54,-3007.92"/>
</g>
<!-- expert13_l1 -->
<g id="node108" class="node">
<title>expert13_l1</title>
<polygon fill="lightcoral" stroke="black" points="4061,-3250.31 3873,-3250.31 3873,-3198.31 4061,-3198.31 4061,-3250.31"/>
<text text-anchor="middle" x="3967" y="-3238.31" font-family="Arial" font-size="10.00">Expert 13 MLP</text>
<text text-anchor="middle" x="3967" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3967" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3967" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- expert13_comm_l1&#45;&gt;expert13_l1 -->
<g id="edge137" class="edge">
<title>expert13_comm_l1&#45;&gt;expert13_l1</title>
<path fill="none" stroke="black" d="M3956.91,-3286.32C3958.32,-3277.83 3959.81,-3268.77 3961.21,-3260.31"/>
<polygon fill="black" stroke="black" points="3964.68,-3260.79 3962.86,-3250.36 3957.77,-3259.65 3964.68,-3260.79"/>
</g>
<!-- expert13_return_l1 -->
<g id="node109" class="node">
<title>expert13_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="4030" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4030" y="-3139.54" font-family="Arial" font-size="10.00">Expert 13 Return</text>
<text text-anchor="middle" x="4030" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4030" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4030" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- expert13_l1&#45;&gt;expert13_return_l1 -->
<g id="edge138" class="edge">
<title>expert13_l1&#45;&gt;expert13_return_l1</title>
<path fill="none" stroke="black" d="M3983.39,-3198.14C3988.86,-3189.74 3995.13,-3180.11 4001.26,-3170.7"/>
<polygon fill="black" stroke="black" points="4004.29,-3172.44 4006.82,-3162.15 3998.43,-3168.62 4004.29,-3172.44"/>
</g>
<!-- expert13_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge139" class="edge">
<title>expert13_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M3933.49,-3098.84C3916.12,-3094.94 3898.1,-3091.36 3881,-3088.77 3495.68,-3030.46 3042.27,-3011.21 2773.67,-3004.86"/>
<polygon fill="black" stroke="black" points="2773.48,-3001.36 2763.4,-3004.63 2773.32,-3008.36 2773.48,-3001.36"/>
</g>
<!-- expert14_l1 -->
<g id="node111" class="node">
<title>expert14_l1</title>
<polygon fill="lightcoral" stroke="black" points="4376,-3250.31 4188,-3250.31 4188,-3198.31 4376,-3198.31 4376,-3250.31"/>
<text text-anchor="middle" x="4282" y="-3238.31" font-family="Arial" font-size="10.00">Expert 14 MLP</text>
<text text-anchor="middle" x="4282" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4282" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4282" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- expert14_comm_l1&#45;&gt;expert14_l1 -->
<g id="edge141" class="edge">
<title>expert14_comm_l1&#45;&gt;expert14_l1</title>
<path fill="none" stroke="black" d="M4267.5,-3286.32C4269.52,-3277.83 4271.67,-3268.77 4273.68,-3260.31"/>
<polygon fill="black" stroke="black" points="4277.14,-3260.89 4276.05,-3250.36 4270.33,-3259.28 4277.14,-3260.89"/>
</g>
<!-- expert14_return_l1 -->
<g id="node112" class="node">
<title>expert14_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="4328" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4328" y="-3139.54" font-family="Arial" font-size="10.00">Expert 14 Return</text>
<text text-anchor="middle" x="4328" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4328" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4328" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- expert14_l1&#45;&gt;expert14_return_l1 -->
<g id="edge142" class="edge">
<title>expert14_l1&#45;&gt;expert14_return_l1</title>
<path fill="none" stroke="black" d="M4293.97,-3198.14C4297.88,-3189.91 4302.35,-3180.5 4306.74,-3171.27"/>
<polygon fill="black" stroke="black" points="4309.94,-3172.69 4311.07,-3162.15 4303.62,-3169.68 4309.94,-3172.69"/>
</g>
<!-- expert14_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge143" class="edge">
<title>expert14_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M4231.92,-3098.76C4214.42,-3094.85 4196.24,-3091.28 4179,-3088.77 3915.91,-3050.54 3165.58,-3021.82 2778.07,-3009.06"/>
<polygon fill="black" stroke="black" points="2777.96,-3005.55 2767.85,-3008.72 2777.73,-3012.55 2777.96,-3005.55"/>
</g>
<!-- expert15_l1 -->
<g id="node114" class="node">
<title>expert15_l1</title>
<polygon fill="lightcoral" stroke="black" points="4682,-3250.31 4494,-3250.31 4494,-3198.31 4682,-3198.31 4682,-3250.31"/>
<text text-anchor="middle" x="4588" y="-3238.31" font-family="Arial" font-size="10.00">Expert 15 MLP</text>
<text text-anchor="middle" x="4588" y="-3227.31" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4588" y="-3216.31" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4588" y="-3205.31" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- expert15_comm_l1&#45;&gt;expert15_l1 -->
<g id="edge145" class="edge">
<title>expert15_comm_l1&#45;&gt;expert15_l1</title>
<path fill="none" stroke="black" d="M4576.02,-3286.32C4577.69,-3277.83 4579.47,-3268.77 4581.13,-3260.31"/>
<polygon fill="black" stroke="black" points="4584.59,-3260.84 4583.08,-3250.36 4577.72,-3259.49 4584.59,-3260.84"/>
</g>
<!-- expert15_return_l1 -->
<g id="node115" class="node">
<title>expert15_return_l1</title>
<ellipse fill="lightgray" stroke="black" cx="4626" cy="-3125.54" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4626" y="-3139.54" font-family="Arial" font-size="10.00">Expert 15 Return</text>
<text text-anchor="middle" x="4626" y="-3128.54" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4626" y="-3117.54" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4626" y="-3106.54" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- expert15_l1&#45;&gt;expert15_return_l1 -->
<g id="edge146" class="edge">
<title>expert15_l1&#45;&gt;expert15_return_l1</title>
<path fill="none" stroke="black" d="M4597.88,-3198.14C4601.08,-3189.99 4604.73,-3180.7 4608.32,-3171.56"/>
<polygon fill="black" stroke="black" points="4611.62,-3172.74 4612.02,-3162.15 4605.1,-3170.18 4611.62,-3172.74"/>
</g>
<!-- expert15_return_l1&#45;&gt;aggregate_l1 -->
<g id="edge147" class="edge">
<title>expert15_return_l1&#45;&gt;aggregate_l1</title>
<path fill="none" stroke="black" d="M4529.93,-3098.65C4512.43,-3094.74 4494.25,-3091.21 4477,-3088.77 4155.3,-3043.36 3217.47,-3016.97 2775.56,-3006.73"/>
<polygon fill="black" stroke="black" points="2775.61,-3003.23 2765.53,-3006.5 2775.45,-3010.23 2775.61,-3003.23"/>
</g>
<!-- aggregate_l1&#45;&gt;res_add2_l1 -->
<g id="edge148" class="edge">
<title>aggregate_l1&#45;&gt;res_add2_l1</title>
<path fill="none" stroke="black" d="M2568.28,-2948.69C2573.34,-2939.54 2578.51,-2930.21 2583.22,-2921.69"/>
<polygon fill="black" stroke="black" points="2586.36,-2923.26 2588.14,-2912.82 2580.23,-2919.87 2586.36,-2923.26"/>
</g>
<!-- norm2_l1 -->
<g id="node118" class="node">
<title>norm2_l1</title>
<polygon fill="lightgreen" stroke="black" points="2735,-2824.77 2469,-2824.77 2469,-2772.77 2735,-2772.77 2735,-2824.77"/>
<text text-anchor="middle" x="2602" y="-2812.77" font-family="Arial" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2602" y="-2801.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2602" y="-2790.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2602" y="-2779.77" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- res_add2_l1&#45;&gt;norm2_l1 -->
<g id="edge150" class="edge">
<title>res_add2_l1&#45;&gt;norm2_l1</title>
<path fill="none" stroke="black" d="M2602,-2860.44C2602,-2852.48 2602,-2843.54 2602,-2835.02"/>
<polygon fill="black" stroke="black" points="2605.5,-2834.93 2602,-2824.93 2598.5,-2834.93 2605.5,-2834.93"/>
</g>
<!-- input_l2 -->
<g id="node119" class="node">
<title>input_l2</title>
<ellipse fill="lightblue" stroke="black" cx="2602" cy="-2689" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="2602" y="-2703" font-family="Arial" font-size="10.00">Layer 2 Input</text>
<text text-anchor="middle" x="2602" y="-2692" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2602" y="-2681" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2602" y="-2670" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm2_l1&#45;&gt;input_l2 -->
<g id="edge303" class="edge">
<title>norm2_l1&#45;&gt;input_l2</title>
<path fill="none" stroke="black" d="M2602,-2772.51C2602,-2761.72 2602,-2748.77 2602,-2736.37"/>
<polygon fill="black" stroke="black" points="2605.5,-2736.13 2602,-2726.13 2598.5,-2736.13 2605.5,-2736.13"/>
</g>
<!-- mha_qkv_l2 -->
<g id="node120" class="node">
<title>mha_qkv_l2</title>
<polygon fill="lightgreen" stroke="black" points="2646,-2616.23 2350,-2616.23 2350,-2564.23 2646,-2564.23 2646,-2616.23"/>
<text text-anchor="middle" x="2498" y="-2604.23" font-family="Arial" font-size="10.00">MHA QKV Linear</text>
<text text-anchor="middle" x="2498" y="-2593.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2498" y="-2582.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2498" y="-2571.23" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- input_l2&#45;&gt;mha_qkv_l2 -->
<g id="edge151" class="edge">
<title>input_l2&#45;&gt;mha_qkv_l2</title>
<path fill="none" stroke="black" d="M2564.16,-2652.79C2553.79,-2643.15 2542.61,-2632.75 2532.45,-2623.29"/>
<polygon fill="black" stroke="black" points="2534.61,-2620.51 2524.9,-2616.27 2529.84,-2625.64 2534.61,-2620.51"/>
</g>
<!-- res_add_l2 -->
<g id="node123" class="node">
<title>res_add_l2</title>
<polygon fill="lightgreen" stroke="black" points="2762,-2352.23 2484,-2352.23 2484,-2300.23 2762,-2300.23 2762,-2352.23"/>
<text text-anchor="middle" x="2623" y="-2340.23" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="2623" y="-2329.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="2623" y="-2318.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2623" y="-2307.23" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- input_l2&#45;&gt;res_add_l2 -->
<g id="edge154" class="edge">
<title>input_l2&#45;&gt;res_add_l2</title>
<path fill="none" stroke="black" d="M2635.01,-2652.57C2643.14,-2641.71 2650.74,-2629.18 2655,-2616.23 2686.69,-2519.98 2678.16,-2486.65 2654,-2388.23 2651.75,-2379.08 2647.92,-2369.75 2643.71,-2361.22"/>
<polygon fill="black" stroke="black" points="2646.79,-2359.56 2639.04,-2352.33 2640.59,-2362.81 2646.79,-2359.56"/>
</g>
<!-- mha_attn_l2 -->
<g id="node121" class="node">
<title>mha_attn_l2</title>
<polygon fill="lightgreen" stroke="black" points="2646,-2528.23 2350,-2528.23 2350,-2476.23 2646,-2476.23 2646,-2528.23"/>
<text text-anchor="middle" x="2498" y="-2516.23" font-family="Arial" font-size="10.00">MHA Attention</text>
<text text-anchor="middle" x="2498" y="-2505.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2498" y="-2494.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2498" y="-2483.23" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- mha_qkv_l2&#45;&gt;mha_attn_l2 -->
<g id="edge152" class="edge">
<title>mha_qkv_l2&#45;&gt;mha_attn_l2</title>
<path fill="none" stroke="black" d="M2498,-2563.9C2498,-2555.94 2498,-2547 2498,-2538.48"/>
<polygon fill="black" stroke="black" points="2501.5,-2538.39 2498,-2528.39 2494.5,-2538.39 2501.5,-2538.39"/>
</g>
<!-- mha_out_l2 -->
<g id="node122" class="node">
<title>mha_out_l2</title>
<polygon fill="lightgreen" stroke="black" points="2644.5,-2440.23 2355.5,-2440.23 2355.5,-2388.23 2644.5,-2388.23 2644.5,-2440.23"/>
<text text-anchor="middle" x="2500" y="-2428.23" font-family="Arial" font-size="10.00">MHA Output Linear</text>
<text text-anchor="middle" x="2500" y="-2417.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="2500" y="-2406.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2500" y="-2395.23" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- mha_attn_l2&#45;&gt;mha_out_l2 -->
<g id="edge153" class="edge">
<title>mha_attn_l2&#45;&gt;mha_out_l2</title>
<path fill="none" stroke="black" d="M2498.59,-2475.9C2498.77,-2467.94 2498.98,-2459 2499.18,-2450.48"/>
<polygon fill="black" stroke="black" points="2502.68,-2450.47 2499.41,-2440.39 2495.68,-2450.31 2502.68,-2450.47"/>
</g>
<!-- mha_out_l2&#45;&gt;res_add_l2 -->
<g id="edge155" class="edge">
<title>mha_out_l2&#45;&gt;res_add_l2</title>
<path fill="none" stroke="black" d="M2535.91,-2388.13C2549.18,-2378.85 2564.38,-2368.22 2578.34,-2358.46"/>
<polygon fill="black" stroke="black" points="2580.65,-2361.12 2586.84,-2352.52 2576.63,-2355.38 2580.65,-2361.12"/>
</g>
<!-- norm_l2 -->
<g id="node124" class="node">
<title>norm_l2</title>
<polygon fill="lightgreen" stroke="black" points="2756,-2264.23 2490,-2264.23 2490,-2212.23 2756,-2212.23 2756,-2264.23"/>
<text text-anchor="middle" x="2623" y="-2252.23" font-family="Arial" font-size="10.00">Layer Norm</text>
<text text-anchor="middle" x="2623" y="-2241.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2623" y="-2230.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2623" y="-2219.23" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- res_add_l2&#45;&gt;norm_l2 -->
<g id="edge156" class="edge">
<title>res_add_l2&#45;&gt;norm_l2</title>
<path fill="none" stroke="black" d="M2623,-2299.9C2623,-2291.94 2623,-2283 2623,-2274.48"/>
<polygon fill="black" stroke="black" points="2626.5,-2274.39 2623,-2264.39 2619.5,-2274.39 2626.5,-2274.39"/>
</g>
<!-- gate_l2 -->
<g id="node125" class="node">
<title>gate_l2</title>
<polygon fill="lightyellow" stroke="black" points="2337.3,-2176.23 1870.72,-2176.23 1750.7,-2072.23 2217.28,-2072.23 2337.3,-2176.23"/>
<text text-anchor="middle" x="2044" y="-2138.23" font-family="Arial" font-size="10.00">Gate Network</text>
<text text-anchor="middle" x="2044" y="-2127.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2044" y="-2116.23" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="2044" y="-2105.23" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l2&#45;&gt;gate_l2 -->
<g id="edge157" class="edge">
<title>norm_l2&#45;&gt;gate_l2</title>
<path fill="none" stroke="black" d="M2493.42,-2212.17C2441.21,-2202.07 2378.89,-2190.01 2317.53,-2178.14"/>
<polygon fill="black" stroke="black" points="2318.17,-2174.7 2307.69,-2176.24 2316.84,-2181.58 2318.17,-2174.7"/>
</g>
<!-- route_l2 -->
<g id="node126" class="node">
<title>route_l2</title>
<polygon fill="lightgray" stroke="black" stroke-dasharray="5,2" points="2890.46,-2176.23 2464.99,-2176.23 2355.54,-2072.23 2781.01,-2072.23 2890.46,-2176.23"/>
<text text-anchor="middle" x="2623" y="-2138.23" font-family="Arial" font-size="10.00">Token Routing</text>
<text text-anchor="middle" x="2623" y="-2127.23" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2623" y="-2116.23" font-family="Arial" font-size="10.00">Output: [distributed across 16 GPUs]</text>
<text text-anchor="middle" x="2623" y="-2105.23" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l2&#45;&gt;route_l2 -->
<g id="edge158" class="edge">
<title>norm_l2&#45;&gt;route_l2</title>
<path fill="none" stroke="black" d="M2623,-2212.1C2623,-2204.41 2623,-2195.6 2623,-2186.6"/>
<polygon fill="black" stroke="black" points="2626.5,-2186.41 2623,-2176.41 2619.5,-2186.41 2626.5,-2186.41"/>
</g>
<!-- res_add2_l2 -->
<g id="node176" class="node">
<title>res_add2_l2</title>
<polygon fill="lightgreen" stroke="black" points="3815,-1589.16 3537,-1589.16 3537,-1537.16 3815,-1537.16 3815,-1589.16"/>
<text text-anchor="middle" x="3676" y="-1577.16" font-family="Arial" font-size="10.00">Residual Add 2</text>
<text text-anchor="middle" x="3676" y="-1566.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="3676" y="-1555.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3676" y="-1544.16" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l2&#45;&gt;res_add2_l2 -->
<g id="edge224" class="edge">
<title>norm_l2&#45;&gt;res_add2_l2</title>
<path fill="none" stroke="black" d="M2756.3,-2237.25C3239.09,-2235.58 4868,-2214.12 4868,-2000.47 4868,-2000.47 4868,-2000.47 4868,-1800.93 4868,-1784.42 4870.26,-1776.21 4858,-1765.16 4708.25,-1630.24 4108.59,-1584.42 3825.46,-1570.11"/>
<polygon fill="black" stroke="black" points="3825.27,-1566.59 3815.11,-1569.59 3824.92,-1573.58 3825.27,-1566.59"/>
</g>
<!-- expert0_comm_l2 -->
<g id="node127" class="node">
<title>expert0_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="301" cy="-1999.47" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="301" y="-2013.47" font-family="Arial" font-size="10.00">Expert 0 Communication</text>
<text text-anchor="middle" x="301" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 0]</text>
<text text-anchor="middle" x="301" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 0]</text>
<text text-anchor="middle" x="301" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- route_l2&#45;&gt;expert0_comm_l2 -->
<g id="edge159" class="edge">
<title>route_l2&#45;&gt;expert0_comm_l2</title>
<path fill="none" stroke="black" d="M2356.64,-2073.36C2353.08,-2072.97 2349.53,-2072.59 2346,-2072.23 1926.5,-2029.92 867.18,-2090.08 449,-2036.23 432.56,-2034.12 415.3,-2030.89 398.6,-2027.23"/>
<polygon fill="black" stroke="black" points="399.37,-2023.81 388.85,-2025.03 397.83,-2030.64 399.37,-2023.81"/>
</g>
<!-- expert1_comm_l2 -->
<g id="node130" class="node">
<title>expert1_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="580" cy="-1999.47" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="580" y="-2013.47" font-family="Arial" font-size="10.00">Expert 1 Communication</text>
<text text-anchor="middle" x="580" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 1]</text>
<text text-anchor="middle" x="580" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 1]</text>
<text text-anchor="middle" x="580" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- route_l2&#45;&gt;expert1_comm_l2 -->
<g id="edge163" class="edge">
<title>route_l2&#45;&gt;expert1_comm_l2</title>
<path fill="none" stroke="black" d="M2356.64,-2073.38C2353.08,-2072.98 2349.53,-2072.6 2346,-2072.23 1634,-1999.2 1446.25,-2124.67 736,-2036.23 717.65,-2033.95 698.3,-2030.44 679.71,-2026.49"/>
<polygon fill="black" stroke="black" points="680.29,-2023.03 669.77,-2024.32 678.8,-2029.87 680.29,-2023.03"/>
</g>
<!-- expert2_comm_l2 -->
<g id="node133" class="node">
<title>expert2_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="867" cy="-1999.47" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="867" y="-2013.47" font-family="Arial" font-size="10.00">Expert 2 Communication</text>
<text text-anchor="middle" x="867" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 2]</text>
<text text-anchor="middle" x="867" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 2]</text>
<text text-anchor="middle" x="867" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- route_l2&#45;&gt;expert2_comm_l2 -->
<g id="edge167" class="edge">
<title>route_l2&#45;&gt;expert2_comm_l2</title>
<path fill="none" stroke="black" d="M2356.64,-2073.4C2353.07,-2072.99 2349.53,-2072.6 2346,-2072.23 1754.36,-2010.19 1597.25,-2117.87 1008,-2036.23 993.33,-2034.2 977.98,-2031.22 963.03,-2027.84"/>
<polygon fill="black" stroke="black" points="963.81,-2024.43 953.28,-2025.56 962.22,-2031.24 963.81,-2024.43"/>
</g>
<!-- expert3_comm_l2 -->
<g id="node136" class="node">
<title>expert3_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="1139" cy="-1999.47" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1139" y="-2013.47" font-family="Arial" font-size="10.00">Expert 3 Communication</text>
<text text-anchor="middle" x="1139" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 3]</text>
<text text-anchor="middle" x="1139" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 3]</text>
<text text-anchor="middle" x="1139" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- route_l2&#45;&gt;expert3_comm_l2 -->
<g id="edge171" class="edge">
<title>route_l2&#45;&gt;expert3_comm_l2</title>
<path fill="none" stroke="black" d="M2356.64,-2073.45C2353.07,-2073.03 2349.52,-2072.62 2346,-2072.23 1910.54,-2024.45 1796.96,-2079.16 1361,-2036.23 1325.11,-2032.7 1286.21,-2027.06 1251.15,-2021.29"/>
<polygon fill="black" stroke="black" points="1251.33,-2017.77 1240.89,-2019.58 1250.18,-2024.68 1251.33,-2017.77"/>
</g>
<!-- expert4_comm_l2 -->
<g id="node139" class="node">
<title>expert4_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="1492" cy="-1999.47" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1492" y="-2013.47" font-family="Arial" font-size="10.00">Expert 4 Communication</text>
<text text-anchor="middle" x="1492" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 4]</text>
<text text-anchor="middle" x="1492" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 4]</text>
<text text-anchor="middle" x="1492" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- route_l2&#45;&gt;expert4_comm_l2 -->
<g id="edge175" class="edge">
<title>route_l2&#45;&gt;expert4_comm_l2</title>
<path fill="none" stroke="black" d="M2356.63,-2073.53C2353.06,-2073.08 2349.52,-2072.65 2346,-2072.23 2046.33,-2036.84 1967.34,-2074.39 1668,-2036.23 1644.86,-2033.29 1620.21,-2029 1596.92,-2024.42"/>
<polygon fill="black" stroke="black" points="1597.52,-2020.97 1587.03,-2022.44 1596.15,-2027.84 1597.52,-2020.97"/>
</g>
<!-- expert5_comm_l2 -->
<g id="node142" class="node">
<title>expert5_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="1799" cy="-1999.47" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1799" y="-2013.47" font-family="Arial" font-size="10.00">Expert 5 Communication</text>
<text text-anchor="middle" x="1799" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 5]</text>
<text text-anchor="middle" x="1799" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 5]</text>
<text text-anchor="middle" x="1799" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- route_l2&#45;&gt;expert5_comm_l2 -->
<g id="edge179" class="edge">
<title>route_l2&#45;&gt;expert5_comm_l2</title>
<path fill="none" stroke="black" d="M2356.97,-2073.78C2353.29,-2073.25 2349.63,-2072.73 2346,-2072.23 2171.8,-2048.29 2125.58,-2064.32 1952,-2036.23 1935.12,-2033.5 1917.33,-2029.96 1900.09,-2026.18"/>
<polygon fill="black" stroke="black" points="1900.53,-2022.69 1890.01,-2023.92 1899,-2029.52 1900.53,-2022.69"/>
</g>
<!-- expert6_comm_l2 -->
<g id="node145" class="node">
<title>expert6_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="2083" cy="-1999.47" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2083" y="-2013.47" font-family="Arial" font-size="10.00">Expert 6 Communication</text>
<text text-anchor="middle" x="2083" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 6]</text>
<text text-anchor="middle" x="2083" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 6]</text>
<text text-anchor="middle" x="2083" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- route_l2&#45;&gt;expert6_comm_l2 -->
<g id="edge183" class="edge">
<title>route_l2&#45;&gt;expert6_comm_l2</title>
<path fill="none" stroke="black" d="M2383.59,-2072.18C2331.25,-2060.67 2276.21,-2048.28 2225,-2036.23 2211.76,-2033.12 2197.85,-2029.74 2184.12,-2026.35"/>
<polygon fill="black" stroke="black" points="2184.73,-2022.9 2174.18,-2023.89 2183.04,-2029.69 2184.73,-2022.9"/>
</g>
<!-- expert7_comm_l2 -->
<g id="node148" class="node">
<title>expert7_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="2356" cy="-1999.47" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2356" y="-2013.47" font-family="Arial" font-size="10.00">Expert 7 Communication</text>
<text text-anchor="middle" x="2356" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 7]</text>
<text text-anchor="middle" x="2356" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 7]</text>
<text text-anchor="middle" x="2356" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- route_l2&#45;&gt;expert7_comm_l2 -->
<g id="edge187" class="edge">
<title>route_l2&#45;&gt;expert7_comm_l2</title>
<path fill="none" stroke="black" d="M2511.7,-2072.06C2484.3,-2059.46 2455.62,-2046.27 2430.44,-2034.7"/>
<polygon fill="black" stroke="black" points="2431.89,-2031.51 2421.34,-2030.51 2428.96,-2037.87 2431.89,-2031.51"/>
</g>
<!-- expert8_comm_l2 -->
<g id="node151" class="node">
<title>expert8_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="2623" cy="-1999.47" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2623" y="-2013.47" font-family="Arial" font-size="10.00">Expert 8 Communication</text>
<text text-anchor="middle" x="2623" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 8]</text>
<text text-anchor="middle" x="2623" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 8]</text>
<text text-anchor="middle" x="2623" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- route_l2&#45;&gt;expert8_comm_l2 -->
<g id="edge191" class="edge">
<title>route_l2&#45;&gt;expert8_comm_l2</title>
<path fill="none" stroke="black" d="M2623,-2071.88C2623,-2063.47 2623,-2054.81 2623,-2046.54"/>
<polygon fill="black" stroke="black" points="2626.5,-2046.32 2623,-2036.32 2619.5,-2046.32 2626.5,-2046.32"/>
</g>
<!-- expert9_comm_l2 -->
<g id="node154" class="node">
<title>expert9_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="2902" cy="-1999.47" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2902" y="-2013.47" font-family="Arial" font-size="10.00">Expert 9 Communication</text>
<text text-anchor="middle" x="2902" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 9]</text>
<text text-anchor="middle" x="2902" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 9]</text>
<text text-anchor="middle" x="2902" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- route_l2&#45;&gt;expert9_comm_l2 -->
<g id="edge195" class="edge">
<title>route_l2&#45;&gt;expert9_comm_l2</title>
<path fill="none" stroke="black" d="M2739.3,-2072.06C2768.32,-2059.29 2798.73,-2045.91 2825.29,-2034.22"/>
<polygon fill="black" stroke="black" points="2826.77,-2037.39 2834.52,-2030.16 2823.96,-2030.98 2826.77,-2037.39"/>
</g>
<!-- expert10_comm_l2 -->
<g id="node157" class="node">
<title>expert10_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="3177" cy="-1999.47" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="3177" y="-2013.47" font-family="Arial" font-size="10.00">Expert 10 Communication</text>
<text text-anchor="middle" x="3177" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 10]</text>
<text text-anchor="middle" x="3177" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 10]</text>
<text text-anchor="middle" x="3177" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- route_l2&#45;&gt;expert10_comm_l2 -->
<g id="edge199" class="edge">
<title>route_l2&#45;&gt;expert10_comm_l2</title>
<path fill="none" stroke="black" d="M2797.36,-2087.62C2870.3,-2072.36 2955.88,-2053.99 3033,-2036.23 3046.23,-2033.19 3060.12,-2029.88 3073.83,-2026.55"/>
<polygon fill="black" stroke="black" points="3074.89,-2029.89 3083.77,-2024.12 3073.23,-2023.09 3074.89,-2029.89"/>
</g>
<!-- expert11_comm_l2 -->
<g id="node160" class="node">
<title>expert11_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="3450" cy="-1999.47" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="3450" y="-2013.47" font-family="Arial" font-size="10.00">Expert 11 Communication</text>
<text text-anchor="middle" x="3450" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 11]</text>
<text text-anchor="middle" x="3450" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 11]</text>
<text text-anchor="middle" x="3450" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- route_l2&#45;&gt;expert11_comm_l2 -->
<g id="edge203" class="edge">
<title>route_l2&#45;&gt;expert11_comm_l2</title>
<path fill="none" stroke="black" d="M2816.05,-2105.4C2954.52,-2091.01 3145.15,-2067.93 3311,-2036.23 3323.87,-2033.77 3337.32,-2030.82 3350.57,-2027.67"/>
<polygon fill="black" stroke="black" points="3351.75,-2030.98 3360.65,-2025.23 3350.1,-2024.18 3351.75,-2030.98"/>
</g>
<!-- expert12_comm_l2 -->
<g id="node163" class="node">
<title>expert12_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="3720" cy="-1999.47" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="3720" y="-2013.47" font-family="Arial" font-size="10.00">Expert 12 Communication</text>
<text text-anchor="middle" x="3720" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 12]</text>
<text text-anchor="middle" x="3720" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 12]</text>
<text text-anchor="middle" x="3720" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- route_l2&#45;&gt;expert12_comm_l2 -->
<g id="edge207" class="edge">
<title>route_l2&#45;&gt;expert12_comm_l2</title>
<path fill="none" stroke="black" d="M2825.84,-2114.71C3021.23,-2104.19 3324.54,-2081.77 3584,-2036.23 3596.55,-2034.03 3609.64,-2031.24 3622.52,-2028.19"/>
<polygon fill="black" stroke="black" points="3623.43,-2031.57 3632.32,-2025.82 3621.78,-2024.77 3623.43,-2031.57"/>
</g>
<!-- expert13_comm_l2 -->
<g id="node166" class="node">
<title>expert13_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="4020" cy="-1999.47" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4020" y="-2013.47" font-family="Arial" font-size="10.00">Expert 13 Communication</text>
<text text-anchor="middle" x="4020" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 13]</text>
<text text-anchor="middle" x="4020" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 13]</text>
<text text-anchor="middle" x="4020" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- route_l2&#45;&gt;expert13_comm_l2 -->
<g id="edge211" class="edge">
<title>route_l2&#45;&gt;expert13_comm_l2</title>
<path fill="none" stroke="black" d="M2828.96,-2117.59C3074.19,-2108.82 3495.67,-2087.24 3854,-2036.23 3873.82,-2033.41 3894.8,-2029.57 3914.93,-2025.45"/>
<polygon fill="black" stroke="black" points="3915.66,-2028.88 3924.74,-2023.41 3914.23,-2022.02 3915.66,-2028.88"/>
</g>
<!-- expert14_comm_l2 -->
<g id="node169" class="node">
<title>expert14_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="4342" cy="-1999.47" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4342" y="-2013.47" font-family="Arial" font-size="10.00">Expert 14 Communication</text>
<text text-anchor="middle" x="4342" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 14]</text>
<text text-anchor="middle" x="4342" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 14]</text>
<text text-anchor="middle" x="4342" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- route_l2&#45;&gt;expert14_comm_l2 -->
<g id="edge215" class="edge">
<title>route_l2&#45;&gt;expert14_comm_l2</title>
<path fill="none" stroke="black" d="M2831.48,-2120.05C3126.82,-2113.56 3683.49,-2094.11 4154,-2036.23 4179.47,-2033.1 4206.69,-2028.6 4232.28,-2023.85"/>
<polygon fill="black" stroke="black" points="4233.2,-2027.24 4242.38,-2021.94 4231.9,-2020.36 4233.2,-2027.24"/>
</g>
<!-- expert15_comm_l2 -->
<g id="node172" class="node">
<title>expert15_comm_l2</title>
<ellipse fill="lightgray" stroke="black" cx="4652" cy="-1999.47" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4652" y="-2013.47" font-family="Arial" font-size="10.00">Expert 15 Communication</text>
<text text-anchor="middle" x="4652" y="-2002.47" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 15]</text>
<text text-anchor="middle" x="4652" y="-1991.47" font-family="Arial" font-size="10.00">Output: [tokens on GPU 15]</text>
<text text-anchor="middle" x="4652" y="-1980.47" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- route_l2&#45;&gt;expert15_comm_l2 -->
<g id="edge219" class="edge">
<title>route_l2&#45;&gt;expert15_comm_l2</title>
<path fill="none" stroke="black" d="M2835.45,-2123.83C3180.82,-2122.44 3884.95,-2109.73 4476,-2036.23 4498.51,-2033.44 4522.43,-2029.34 4545.15,-2024.91"/>
<polygon fill="black" stroke="black" points="4546.02,-2028.31 4555.15,-2022.92 4544.66,-2021.44 4546.02,-2028.31"/>
</g>
<!-- expert0_l2 -->
<g id="node128" class="node">
<title>expert0_l2</title>
<polygon fill="lightcoral" stroke="black" points="386,-1926.7 198,-1926.7 198,-1874.7 386,-1874.7 386,-1926.7"/>
<text text-anchor="middle" x="292" y="-1914.7" font-family="Arial" font-size="10.00">Expert 0 MLP</text>
<text text-anchor="middle" x="292" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="292" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="292" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- expert0_comm_l2&#45;&gt;expert0_l2 -->
<g id="edge160" class="edge">
<title>expert0_comm_l2&#45;&gt;expert0_l2</title>
<path fill="none" stroke="black" d="M297.67,-1962.71C296.89,-1954.3 296.06,-1945.35 295.28,-1936.97"/>
<polygon fill="black" stroke="black" points="298.74,-1936.37 294.33,-1926.74 291.77,-1937.02 298.74,-1936.37"/>
</g>
<!-- expert0_return_l2 -->
<g id="node129" class="node">
<title>expert0_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="239" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="239" y="-1815.93" font-family="Arial" font-size="10.00">Expert 0 Return</text>
<text text-anchor="middle" x="239" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="239" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="239" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- expert0_l2&#45;&gt;expert0_return_l2 -->
<g id="edge161" class="edge">
<title>expert0_l2&#45;&gt;expert0_return_l2</title>
<path fill="none" stroke="black" d="M278.21,-1874.52C273.66,-1866.21 268.45,-1856.69 263.34,-1847.37"/>
<polygon fill="black" stroke="black" points="266.38,-1845.63 258.5,-1838.54 260.24,-1848.99 266.38,-1845.63"/>
</g>
<!-- aggregate_l2 -->
<g id="node175" class="node">
<title>aggregate_l2</title>
<polygon fill="lightpink" stroke="black" points="2898.55,-1729.16 2460.21,-1729.16 2347.45,-1625.16 2785.79,-1625.16 2898.55,-1729.16"/>
<text text-anchor="middle" x="2623" y="-1691.16" font-family="Arial" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2623" y="-1680.16" font-family="Arial" font-size="10.00">Input: [processed_tokens from all experts]</text>
<text text-anchor="middle" x="2623" y="-1669.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="2623" y="-1658.16" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- expert0_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge162" class="edge">
<title>expert0_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M334.65,-1775.03C352.28,-1771.1 370.61,-1767.56 388,-1765.16 770.89,-1712.27 1909.89,-1689.02 2397.45,-1681.3"/>
<polygon fill="black" stroke="black" points="2397.84,-1684.8 2407.78,-1681.14 2397.73,-1677.8 2397.84,-1684.8"/>
</g>
<!-- expert1_l2 -->
<g id="node131" class="node">
<title>expert1_l2</title>
<polygon fill="lightcoral" stroke="black" points="656,-1926.7 468,-1926.7 468,-1874.7 656,-1874.7 656,-1926.7"/>
<text text-anchor="middle" x="562" y="-1914.7" font-family="Arial" font-size="10.00">Expert 1 MLP</text>
<text text-anchor="middle" x="562" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="562" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="562" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- expert1_comm_l2&#45;&gt;expert1_l2 -->
<g id="edge164" class="edge">
<title>expert1_comm_l2&#45;&gt;expert1_l2</title>
<path fill="none" stroke="black" d="M573.35,-1962.71C571.77,-1954.21 570.08,-1945.15 568.51,-1936.69"/>
<polygon fill="black" stroke="black" points="571.93,-1935.93 566.66,-1926.74 565.05,-1937.21 571.93,-1935.93"/>
</g>
<!-- expert1_return_l2 -->
<g id="node132" class="node">
<title>expert1_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="537" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="537" y="-1815.93" font-family="Arial" font-size="10.00">Expert 1 Return</text>
<text text-anchor="middle" x="537" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="537" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="537" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- expert1_l2&#45;&gt;expert1_return_l2 -->
<g id="edge165" class="edge">
<title>expert1_l2&#45;&gt;expert1_return_l2</title>
<path fill="none" stroke="black" d="M555.5,-1874.52C553.46,-1866.63 551.14,-1857.66 548.85,-1848.8"/>
<polygon fill="black" stroke="black" points="552.18,-1847.71 546.29,-1838.9 545.41,-1849.46 552.18,-1847.71"/>
</g>
<!-- expert1_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge166" class="edge">
<title>expert1_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M633.07,-1775.03C650.57,-1771.12 668.75,-1767.59 686,-1765.16 1010.62,-1719.33 1962.59,-1692.87 2399.35,-1682.84"/>
<polygon fill="black" stroke="black" points="2399.65,-1686.33 2409.57,-1682.61 2399.49,-1679.34 2399.65,-1686.33"/>
</g>
<!-- expert2_l2 -->
<g id="node134" class="node">
<title>expert2_l2</title>
<polygon fill="lightcoral" stroke="black" points="940,-1926.7 752,-1926.7 752,-1874.7 940,-1874.7 940,-1926.7"/>
<text text-anchor="middle" x="846" y="-1914.7" font-family="Arial" font-size="10.00">Expert 2 MLP</text>
<text text-anchor="middle" x="846" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="846" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="846" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- expert2_comm_l2&#45;&gt;expert2_l2 -->
<g id="edge168" class="edge">
<title>expert2_comm_l2&#45;&gt;expert2_l2</title>
<path fill="none" stroke="black" d="M859.24,-1962.71C857.4,-1954.21 855.43,-1945.15 853.59,-1936.69"/>
<polygon fill="black" stroke="black" points="856.98,-1935.77 851.43,-1926.74 850.14,-1937.25 856.98,-1935.77"/>
</g>
<!-- expert2_return_l2 -->
<g id="node135" class="node">
<title>expert2_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="835" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="835" y="-1815.93" font-family="Arial" font-size="10.00">Expert 2 Return</text>
<text text-anchor="middle" x="835" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="835" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="835" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- expert2_l2&#45;&gt;expert2_return_l2 -->
<g id="edge169" class="edge">
<title>expert2_l2&#45;&gt;expert2_return_l2</title>
<path fill="none" stroke="black" d="M843.14,-1874.52C842.25,-1866.71 841.24,-1857.85 840.25,-1849.08"/>
<polygon fill="black" stroke="black" points="843.7,-1848.44 839.09,-1838.9 836.74,-1849.23 843.7,-1848.44"/>
</g>
<!-- expert2_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge170" class="edge">
<title>expert2_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M931.08,-1775.15C948.58,-1771.23 966.76,-1767.66 984,-1765.16 1250.93,-1726.36 2019.44,-1697.37 2401.67,-1684.89"/>
<polygon fill="black" stroke="black" points="2401.87,-1688.39 2411.75,-1684.57 2401.64,-1681.39 2401.87,-1688.39"/>
</g>
<!-- expert3_l2 -->
<g id="node137" class="node">
<title>expert3_l2</title>
<polygon fill="lightcoral" stroke="black" points="1230,-1926.7 1042,-1926.7 1042,-1874.7 1230,-1874.7 1230,-1926.7"/>
<text text-anchor="middle" x="1136" y="-1914.7" font-family="Arial" font-size="10.00">Expert 3 MLP</text>
<text text-anchor="middle" x="1136" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1136" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1136" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- expert3_comm_l2&#45;&gt;expert3_l2 -->
<g id="edge172" class="edge">
<title>expert3_comm_l2&#45;&gt;expert3_l2</title>
<path fill="none" stroke="black" d="M1137.88,-1962.43C1137.63,-1954.12 1137.35,-1945.29 1137.09,-1937"/>
<polygon fill="black" stroke="black" points="1140.59,-1936.78 1136.78,-1926.89 1133.59,-1937 1140.59,-1936.78"/>
</g>
<!-- expert3_return_l2 -->
<g id="node138" class="node">
<title>expert3_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="1133" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1133" y="-1815.93" font-family="Arial" font-size="10.00">Expert 3 Return</text>
<text text-anchor="middle" x="1133" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1133" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1133" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- expert3_l2&#45;&gt;expert3_return_l2 -->
<g id="edge173" class="edge">
<title>expert3_l2&#45;&gt;expert3_return_l2</title>
<path fill="none" stroke="black" d="M1135.22,-1874.52C1134.98,-1866.71 1134.7,-1857.85 1134.43,-1849.08"/>
<polygon fill="black" stroke="black" points="1137.92,-1848.79 1134.12,-1838.9 1130.93,-1849.01 1137.92,-1848.79"/>
</g>
<!-- expert3_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge174" class="edge">
<title>expert3_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M1229.51,-1775.22C1246.88,-1771.32 1264.9,-1767.74 1282,-1765.16 1671.16,-1706.26 2129.79,-1687.21 2397.31,-1681.06"/>
<polygon fill="black" stroke="black" points="2397.62,-1684.56 2407.54,-1680.83 2397.46,-1677.56 2397.62,-1684.56"/>
</g>
<!-- expert4_l2 -->
<g id="node140" class="node">
<title>expert4_l2</title>
<polygon fill="lightcoral" stroke="black" points="1555,-1926.7 1367,-1926.7 1367,-1874.7 1555,-1874.7 1555,-1926.7"/>
<text text-anchor="middle" x="1461" y="-1914.7" font-family="Arial" font-size="10.00">Expert 4 MLP</text>
<text text-anchor="middle" x="1461" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1461" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1461" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- expert4_comm_l2&#45;&gt;expert4_l2 -->
<g id="edge176" class="edge">
<title>expert4_comm_l2&#45;&gt;expert4_l2</title>
<path fill="none" stroke="black" d="M1480.54,-1962.71C1477.79,-1954.12 1474.86,-1944.95 1472.12,-1936.41"/>
<polygon fill="black" stroke="black" points="1475.41,-1935.19 1469.02,-1926.74 1468.74,-1937.33 1475.41,-1935.19"/>
</g>
<!-- expert4_return_l2 -->
<g id="node141" class="node">
<title>expert4_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="1431" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1431" y="-1815.93" font-family="Arial" font-size="10.00">Expert 4 Return</text>
<text text-anchor="middle" x="1431" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1431" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1431" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- expert4_l2&#45;&gt;expert4_return_l2 -->
<g id="edge177" class="edge">
<title>expert4_l2&#45;&gt;expert4_return_l2</title>
<path fill="none" stroke="black" d="M1453.2,-1874.52C1450.72,-1866.54 1447.91,-1857.46 1445.13,-1848.51"/>
<polygon fill="black" stroke="black" points="1448.46,-1847.42 1442.15,-1838.9 1441.77,-1849.49 1448.46,-1847.42"/>
</g>
<!-- expert4_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge178" class="edge">
<title>expert4_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M1527.95,-1775.4C1545.2,-1771.5 1563.06,-1767.88 1580,-1765.16 1862.34,-1719.76 2191.71,-1697.3 2403.59,-1686.73"/>
<polygon fill="black" stroke="black" points="2403.77,-1690.23 2413.59,-1686.24 2403.43,-1683.24 2403.77,-1690.23"/>
</g>
<!-- expert5_l2 -->
<g id="node143" class="node">
<title>expert5_l2</title>
<polygon fill="lightcoral" stroke="black" points="1858,-1926.7 1670,-1926.7 1670,-1874.7 1858,-1874.7 1858,-1926.7"/>
<text text-anchor="middle" x="1764" y="-1914.7" font-family="Arial" font-size="10.00">Expert 5 MLP</text>
<text text-anchor="middle" x="1764" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1764" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1764" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- expert5_comm_l2&#45;&gt;expert5_l2 -->
<g id="edge180" class="edge">
<title>expert5_comm_l2&#45;&gt;expert5_l2</title>
<path fill="none" stroke="black" d="M1786.07,-1962.71C1782.96,-1954.12 1779.65,-1944.95 1776.56,-1936.41"/>
<polygon fill="black" stroke="black" points="1779.75,-1934.95 1773.06,-1926.74 1773.17,-1937.33 1779.75,-1934.95"/>
</g>
<!-- expert5_return_l2 -->
<g id="node144" class="node">
<title>expert5_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="1729" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1729" y="-1815.93" font-family="Arial" font-size="10.00">Expert 5 Return</text>
<text text-anchor="middle" x="1729" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1729" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1729" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- expert5_l2&#45;&gt;expert5_return_l2 -->
<g id="edge181" class="edge">
<title>expert5_l2&#45;&gt;expert5_return_l2</title>
<path fill="none" stroke="black" d="M1754.9,-1874.52C1752.01,-1866.54 1748.73,-1857.46 1745.49,-1848.51"/>
<polygon fill="black" stroke="black" points="1748.7,-1847.12 1742.01,-1838.9 1742.12,-1849.5 1748.7,-1847.12"/>
</g>
<!-- expert5_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge182" class="edge">
<title>expert5_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M1827.23,-1775.59C1844.1,-1771.75 1861.5,-1768.09 1878,-1765.16 2057.22,-1733.3 2262.85,-1710.29 2412.61,-1695.97"/>
<polygon fill="black" stroke="black" points="2413.22,-1699.43 2422.84,-1694.99 2412.56,-1692.46 2413.22,-1699.43"/>
</g>
<!-- expert6_l2 -->
<g id="node146" class="node">
<title>expert6_l2</title>
<polygon fill="lightcoral" stroke="black" points="2149,-1926.7 1961,-1926.7 1961,-1874.7 2149,-1874.7 2149,-1926.7"/>
<text text-anchor="middle" x="2055" y="-1914.7" font-family="Arial" font-size="10.00">Expert 6 MLP</text>
<text text-anchor="middle" x="2055" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2055" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2055" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- expert6_comm_l2&#45;&gt;expert6_l2 -->
<g id="edge184" class="edge">
<title>expert6_comm_l2&#45;&gt;expert6_l2</title>
<path fill="none" stroke="black" d="M2072.65,-1962.71C2070.17,-1954.12 2067.52,-1944.95 2065.04,-1936.41"/>
<polygon fill="black" stroke="black" points="2068.39,-1935.37 2062.25,-1926.74 2061.66,-1937.32 2068.39,-1935.37"/>
</g>
<!-- expert6_return_l2 -->
<g id="node147" class="node">
<title>expert6_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="2027" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2027" y="-1815.93" font-family="Arial" font-size="10.00">Expert 6 Return</text>
<text text-anchor="middle" x="2027" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2027" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2027" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- expert6_l2&#45;&gt;expert6_return_l2 -->
<g id="edge185" class="edge">
<title>expert6_l2&#45;&gt;expert6_return_l2</title>
<path fill="none" stroke="black" d="M2047.72,-1874.52C2045.41,-1866.54 2042.78,-1857.46 2040.19,-1848.51"/>
<polygon fill="black" stroke="black" points="2043.55,-1847.54 2037.41,-1838.9 2036.83,-1849.48 2043.55,-1847.54"/>
</g>
<!-- expert6_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge186" class="edge">
<title>expert6_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M2127.45,-1776.18C2143.66,-1772.37 2160.27,-1768.57 2176,-1765.16 2259.35,-1747.05 2351.84,-1728.75 2430.96,-1713.64"/>
<polygon fill="black" stroke="black" points="2431.86,-1717.03 2441.03,-1711.72 2430.55,-1710.16 2431.86,-1717.03"/>
</g>
<!-- expert7_l2 -->
<g id="node149" class="node">
<title>expert7_l2</title>
<polygon fill="lightcoral" stroke="black" points="2435,-1926.7 2247,-1926.7 2247,-1874.7 2435,-1874.7 2435,-1926.7"/>
<text text-anchor="middle" x="2341" y="-1914.7" font-family="Arial" font-size="10.00">Expert 7 MLP</text>
<text text-anchor="middle" x="2341" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2341" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2341" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- expert7_comm_l2&#45;&gt;expert7_l2 -->
<g id="edge188" class="edge">
<title>expert7_comm_l2&#45;&gt;expert7_l2</title>
<path fill="none" stroke="black" d="M2350.46,-1962.71C2349.14,-1954.21 2347.74,-1945.15 2346.42,-1936.69"/>
<polygon fill="black" stroke="black" points="2349.87,-1936.08 2344.88,-1926.74 2342.96,-1937.16 2349.87,-1936.08"/>
</g>
<!-- expert7_return_l2 -->
<g id="node150" class="node">
<title>expert7_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="2325" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2325" y="-1815.93" font-family="Arial" font-size="10.00">Expert 7 Return</text>
<text text-anchor="middle" x="2325" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2325" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2325" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- expert7_l2&#45;&gt;expert7_return_l2 -->
<g id="edge189" class="edge">
<title>expert7_l2&#45;&gt;expert7_return_l2</title>
<path fill="none" stroke="black" d="M2336.84,-1874.52C2335.53,-1866.63 2334.05,-1857.66 2332.58,-1848.8"/>
<polygon fill="black" stroke="black" points="2336.03,-1848.2 2330.95,-1838.9 2329.13,-1849.34 2336.03,-1848.2"/>
</g>
<!-- expert7_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge190" class="edge">
<title>expert7_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M2398.66,-1770.58C2426.27,-1759.2 2458.56,-1745.9 2489.91,-1732.99"/>
<polygon fill="black" stroke="black" points="2491.24,-1736.22 2499.16,-1729.18 2488.58,-1729.75 2491.24,-1736.22"/>
</g>
<!-- expert8_l2 -->
<g id="node152" class="node">
<title>expert8_l2</title>
<polygon fill="lightcoral" stroke="black" points="2717,-1926.7 2529,-1926.7 2529,-1874.7 2717,-1874.7 2717,-1926.7"/>
<text text-anchor="middle" x="2623" y="-1914.7" font-family="Arial" font-size="10.00">Expert 8 MLP</text>
<text text-anchor="middle" x="2623" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2623" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2623" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- expert8_comm_l2&#45;&gt;expert8_l2 -->
<g id="edge192" class="edge">
<title>expert8_comm_l2&#45;&gt;expert8_l2</title>
<path fill="none" stroke="black" d="M2623,-1962.43C2623,-1954.12 2623,-1945.29 2623,-1937"/>
<polygon fill="black" stroke="black" points="2626.5,-1936.89 2623,-1926.89 2619.5,-1936.89 2626.5,-1936.89"/>
</g>
<!-- expert8_return_l2 -->
<g id="node153" class="node">
<title>expert8_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="2623" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2623" y="-1815.93" font-family="Arial" font-size="10.00">Expert 8 Return</text>
<text text-anchor="middle" x="2623" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2623" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2623" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- expert8_l2&#45;&gt;expert8_return_l2 -->
<g id="edge193" class="edge">
<title>expert8_l2&#45;&gt;expert8_return_l2</title>
<path fill="none" stroke="black" d="M2623,-1874.52C2623,-1866.71 2623,-1857.85 2623,-1849.08"/>
<polygon fill="black" stroke="black" points="2626.5,-1848.9 2623,-1838.9 2619.5,-1848.9 2626.5,-1848.9"/>
</g>
<!-- expert8_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge194" class="edge">
<title>expert8_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M2623,-1765.09C2623,-1757.05 2623,-1748.3 2623,-1739.55"/>
<polygon fill="black" stroke="black" points="2626.5,-1739.32 2623,-1729.32 2619.5,-1739.32 2626.5,-1739.32"/>
</g>
<!-- expert9_l2 -->
<g id="node155" class="node">
<title>expert9_l2</title>
<polygon fill="lightcoral" stroke="black" points="3005,-1926.7 2817,-1926.7 2817,-1874.7 3005,-1874.7 3005,-1926.7"/>
<text text-anchor="middle" x="2911" y="-1914.7" font-family="Arial" font-size="10.00">Expert 9 MLP</text>
<text text-anchor="middle" x="2911" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2911" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2911" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- expert9_comm_l2&#45;&gt;expert9_l2 -->
<g id="edge196" class="edge">
<title>expert9_comm_l2&#45;&gt;expert9_l2</title>
<path fill="none" stroke="black" d="M2905.33,-1962.71C2906.11,-1954.3 2906.94,-1945.35 2907.72,-1936.97"/>
<polygon fill="black" stroke="black" points="2911.23,-1937.02 2908.67,-1926.74 2904.26,-1936.37 2911.23,-1937.02"/>
</g>
<!-- expert9_return_l2 -->
<g id="node156" class="node">
<title>expert9_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="2921" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2921" y="-1815.93" font-family="Arial" font-size="10.00">Expert 9 Return</text>
<text text-anchor="middle" x="2921" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2921" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2921" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- expert9_l2&#45;&gt;expert9_return_l2 -->
<g id="edge197" class="edge">
<title>expert9_l2&#45;&gt;expert9_return_l2</title>
<path fill="none" stroke="black" d="M2913.6,-1874.52C2914.41,-1866.71 2915.32,-1857.85 2916.23,-1849.08"/>
<polygon fill="black" stroke="black" points="2919.74,-1849.21 2917.28,-1838.9 2912.77,-1848.49 2919.74,-1849.21"/>
</g>
<!-- expert9_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge198" class="edge">
<title>expert9_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M2847.34,-1770.58C2819.73,-1759.2 2787.44,-1745.9 2756.09,-1732.99"/>
<polygon fill="black" stroke="black" points="2757.42,-1729.75 2746.84,-1729.18 2754.76,-1736.22 2757.42,-1729.75"/>
</g>
<!-- expert10_l2 -->
<g id="node158" class="node">
<title>expert10_l2</title>
<polygon fill="lightcoral" stroke="black" points="3292,-1926.7 3104,-1926.7 3104,-1874.7 3292,-1874.7 3292,-1926.7"/>
<text text-anchor="middle" x="3198" y="-1914.7" font-family="Arial" font-size="10.00">Expert 10 MLP</text>
<text text-anchor="middle" x="3198" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3198" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3198" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- expert10_comm_l2&#45;&gt;expert10_l2 -->
<g id="edge200" class="edge">
<title>expert10_comm_l2&#45;&gt;expert10_l2</title>
<path fill="none" stroke="black" d="M3184.76,-1962.71C3186.6,-1954.21 3188.57,-1945.15 3190.41,-1936.69"/>
<polygon fill="black" stroke="black" points="3193.86,-1937.25 3192.57,-1926.74 3187.02,-1935.77 3193.86,-1937.25"/>
</g>
<!-- expert10_return_l2 -->
<g id="node159" class="node">
<title>expert10_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="3219" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3219" y="-1815.93" font-family="Arial" font-size="10.00">Expert 10 Return</text>
<text text-anchor="middle" x="3219" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3219" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3219" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- expert10_l2&#45;&gt;expert10_return_l2 -->
<g id="edge201" class="edge">
<title>expert10_l2&#45;&gt;expert10_return_l2</title>
<path fill="none" stroke="black" d="M3203.46,-1874.52C3205.18,-1866.63 3207.12,-1857.66 3209.05,-1848.8"/>
<polygon fill="black" stroke="black" points="3212.49,-1849.42 3211.19,-1838.9 3205.65,-1847.93 3212.49,-1849.42"/>
</g>
<!-- expert10_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge202" class="edge">
<title>expert10_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M3118.55,-1776.18C3102.34,-1772.37 3085.73,-1768.57 3070,-1765.16 3016.8,-1753.6 2959.87,-1741.96 2905.07,-1731.13"/>
<polygon fill="black" stroke="black" points="2905.72,-1727.69 2895.23,-1729.19 2904.36,-1734.56 2905.72,-1727.69"/>
</g>
<!-- expert11_l2 -->
<g id="node161" class="node">
<title>expert11_l2</title>
<polygon fill="lightcoral" stroke="black" points="3593,-1926.7 3405,-1926.7 3405,-1874.7 3593,-1874.7 3593,-1926.7"/>
<text text-anchor="middle" x="3499" y="-1914.7" font-family="Arial" font-size="10.00">Expert 11 MLP</text>
<text text-anchor="middle" x="3499" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3499" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3499" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- expert11_comm_l2&#45;&gt;expert11_l2 -->
<g id="edge204" class="edge">
<title>expert11_comm_l2&#45;&gt;expert11_l2</title>
<path fill="none" stroke="black" d="M3467.97,-1962.98C3472.42,-1954.19 3477.18,-1944.78 3481.61,-1936.04"/>
<polygon fill="black" stroke="black" points="3484.85,-1937.38 3486.25,-1926.88 3478.61,-1934.22 3484.85,-1937.38"/>
</g>
<!-- expert11_return_l2 -->
<g id="node162" class="node">
<title>expert11_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="3517" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3517" y="-1815.93" font-family="Arial" font-size="10.00">Expert 11 Return</text>
<text text-anchor="middle" x="3517" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3517" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3517" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- expert11_l2&#45;&gt;expert11_return_l2 -->
<g id="edge205" class="edge">
<title>expert11_l2&#45;&gt;expert11_return_l2</title>
<path fill="none" stroke="black" d="M3503.68,-1874.52C3505.15,-1866.63 3506.82,-1857.66 3508.47,-1848.8"/>
<polygon fill="black" stroke="black" points="3511.92,-1849.37 3510.31,-1838.9 3505.04,-1848.09 3511.92,-1849.37"/>
</g>
<!-- expert11_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge206" class="edge">
<title>expert11_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M3418.77,-1775.59C3401.9,-1771.75 3384.5,-1768.09 3368,-1765.16 3205.39,-1736.25 3021.04,-1714.63 2876.41,-1700.17"/>
<polygon fill="black" stroke="black" points="2876.36,-1696.65 2866.06,-1699.15 2875.67,-1703.62 2876.36,-1696.65"/>
</g>
<!-- expert12_l2 -->
<g id="node164" class="node">
<title>expert12_l2</title>
<polygon fill="lightcoral" stroke="black" points="3831,-1926.7 3643,-1926.7 3643,-1874.7 3831,-1874.7 3831,-1926.7"/>
<text text-anchor="middle" x="3737" y="-1914.7" font-family="Arial" font-size="10.00">Expert 12 MLP</text>
<text text-anchor="middle" x="3737" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3737" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3737" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- expert12_comm_l2&#45;&gt;expert12_l2 -->
<g id="edge208" class="edge">
<title>expert12_comm_l2&#45;&gt;expert12_l2</title>
<path fill="none" stroke="black" d="M3726.28,-1962.71C3727.77,-1954.21 3729.37,-1945.15 3730.85,-1936.69"/>
<polygon fill="black" stroke="black" points="3734.32,-1937.19 3732.6,-1926.74 3727.42,-1935.98 3734.32,-1937.19"/>
</g>
<!-- expert12_return_l2 -->
<g id="node165" class="node">
<title>expert12_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="3815" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3815" y="-1815.93" font-family="Arial" font-size="10.00">Expert 12 Return</text>
<text text-anchor="middle" x="3815" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3815" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3815" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- expert12_l2&#45;&gt;expert12_return_l2 -->
<g id="edge209" class="edge">
<title>expert12_l2&#45;&gt;expert12_return_l2</title>
<path fill="none" stroke="black" d="M3757.29,-1874.52C3764.27,-1865.86 3772.3,-1855.9 3780.11,-1846.21"/>
<polygon fill="black" stroke="black" points="3783.04,-1848.15 3786.59,-1838.17 3777.59,-1843.76 3783.04,-1848.15"/>
</g>
<!-- expert12_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge210" class="edge">
<title>expert12_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M3718.05,-1775.4C3700.8,-1771.5 3682.94,-1767.88 3666,-1765.16 3392.82,-1721.24 3075.61,-1698.78 2863.4,-1687.8"/>
<polygon fill="black" stroke="black" points="2863.54,-1684.3 2853.38,-1687.29 2863.18,-1691.29 2863.54,-1684.3"/>
</g>
<!-- expert13_l2 -->
<g id="node167" class="node">
<title>expert13_l2</title>
<polygon fill="lightcoral" stroke="black" points="4145,-1926.7 3957,-1926.7 3957,-1874.7 4145,-1874.7 4145,-1926.7"/>
<text text-anchor="middle" x="4051" y="-1914.7" font-family="Arial" font-size="10.00">Expert 13 MLP</text>
<text text-anchor="middle" x="4051" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4051" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4051" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- expert13_comm_l2&#45;&gt;expert13_l2 -->
<g id="edge212" class="edge">
<title>expert13_comm_l2&#45;&gt;expert13_l2</title>
<path fill="none" stroke="black" d="M4031.46,-1962.71C4034.21,-1954.12 4037.14,-1944.95 4039.88,-1936.41"/>
<polygon fill="black" stroke="black" points="4043.26,-1937.33 4042.98,-1926.74 4036.59,-1935.19 4043.26,-1937.33"/>
</g>
<!-- expert13_return_l2 -->
<g id="node168" class="node">
<title>expert13_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="4113" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4113" y="-1815.93" font-family="Arial" font-size="10.00">Expert 13 Return</text>
<text text-anchor="middle" x="4113" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4113" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4113" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- expert13_l2&#45;&gt;expert13_return_l2 -->
<g id="edge213" class="edge">
<title>expert13_l2&#45;&gt;expert13_return_l2</title>
<path fill="none" stroke="black" d="M4067.13,-1874.52C4072.51,-1866.12 4078.68,-1856.49 4084.71,-1847.08"/>
<polygon fill="black" stroke="black" points="4087.74,-1848.84 4090.18,-1838.54 4081.84,-1845.07 4087.74,-1848.84"/>
</g>
<!-- expert13_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge214" class="edge">
<title>expert13_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M4016.49,-1775.22C3999.12,-1771.32 3981.1,-1767.74 3964,-1765.16 3578.68,-1706.84 3125.27,-1687.59 2856.67,-1681.25"/>
<polygon fill="black" stroke="black" points="2856.48,-1677.74 2846.4,-1681.01 2856.32,-1684.74 2856.48,-1677.74"/>
</g>
<!-- expert14_l2 -->
<g id="node170" class="node">
<title>expert14_l2</title>
<polygon fill="lightcoral" stroke="black" points="4459,-1926.7 4271,-1926.7 4271,-1874.7 4459,-1874.7 4459,-1926.7"/>
<text text-anchor="middle" x="4365" y="-1914.7" font-family="Arial" font-size="10.00">Expert 14 MLP</text>
<text text-anchor="middle" x="4365" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4365" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4365" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- expert14_comm_l2&#45;&gt;expert14_l2 -->
<g id="edge216" class="edge">
<title>expert14_comm_l2&#45;&gt;expert14_l2</title>
<path fill="none" stroke="black" d="M4350.5,-1962.71C4352.52,-1954.21 4354.67,-1945.15 4356.68,-1936.69"/>
<polygon fill="black" stroke="black" points="4360.14,-1937.28 4359.05,-1926.74 4353.33,-1935.66 4360.14,-1937.28"/>
</g>
<!-- expert14_return_l2 -->
<g id="node171" class="node">
<title>expert14_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="4411" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4411" y="-1815.93" font-family="Arial" font-size="10.00">Expert 14 Return</text>
<text text-anchor="middle" x="4411" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4411" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4411" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- expert14_l2&#45;&gt;expert14_return_l2 -->
<g id="edge217" class="edge">
<title>expert14_l2&#45;&gt;expert14_return_l2</title>
<path fill="none" stroke="black" d="M4376.97,-1874.52C4380.88,-1866.29 4385.35,-1856.88 4389.74,-1847.66"/>
<polygon fill="black" stroke="black" points="4392.94,-1849.07 4394.07,-1838.54 4386.62,-1846.07 4392.94,-1849.07"/>
</g>
<!-- expert14_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge218" class="edge">
<title>expert14_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M4314.92,-1775.15C4297.42,-1771.23 4279.24,-1767.66 4262,-1765.16 3998.91,-1726.92 3248.58,-1698.2 2861.07,-1685.44"/>
<polygon fill="black" stroke="black" points="2860.96,-1681.94 2850.85,-1685.11 2860.73,-1688.93 2860.96,-1681.94"/>
</g>
<!-- expert15_l2 -->
<g id="node173" class="node">
<title>expert15_l2</title>
<polygon fill="lightcoral" stroke="black" points="4765,-1926.7 4577,-1926.7 4577,-1874.7 4765,-1874.7 4765,-1926.7"/>
<text text-anchor="middle" x="4671" y="-1914.7" font-family="Arial" font-size="10.00">Expert 15 MLP</text>
<text text-anchor="middle" x="4671" y="-1903.7" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4671" y="-1892.7" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4671" y="-1881.7" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- expert15_comm_l2&#45;&gt;expert15_l2 -->
<g id="edge220" class="edge">
<title>expert15_comm_l2&#45;&gt;expert15_l2</title>
<path fill="none" stroke="black" d="M4659.02,-1962.71C4660.69,-1954.21 4662.47,-1945.15 4664.13,-1936.69"/>
<polygon fill="black" stroke="black" points="4667.59,-1937.23 4666.08,-1926.74 4660.72,-1935.88 4667.59,-1937.23"/>
</g>
<!-- expert15_return_l2 -->
<g id="node174" class="node">
<title>expert15_return_l2</title>
<ellipse fill="lightgray" stroke="black" cx="4709" cy="-1801.93" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4709" y="-1815.93" font-family="Arial" font-size="10.00">Expert 15 Return</text>
<text text-anchor="middle" x="4709" y="-1804.93" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4709" y="-1793.93" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4709" y="-1782.93" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- expert15_l2&#45;&gt;expert15_return_l2 -->
<g id="edge221" class="edge">
<title>expert15_l2&#45;&gt;expert15_return_l2</title>
<path fill="none" stroke="black" d="M4680.88,-1874.52C4684.08,-1866.38 4687.73,-1857.08 4691.32,-1847.94"/>
<polygon fill="black" stroke="black" points="4694.62,-1849.12 4695.02,-1838.54 4688.1,-1846.57 4694.62,-1849.12"/>
</g>
<!-- expert15_return_l2&#45;&gt;aggregate_l2 -->
<g id="edge222" class="edge">
<title>expert15_return_l2&#45;&gt;aggregate_l2</title>
<path fill="none" stroke="black" d="M4612.93,-1775.03C4595.43,-1771.12 4577.25,-1767.59 4560,-1765.16 4238.3,-1719.74 3300.47,-1693.35 2858.56,-1683.12"/>
<polygon fill="black" stroke="black" points="2858.61,-1679.62 2848.53,-1682.88 2858.45,-1686.61 2858.61,-1679.62"/>
</g>
<!-- aggregate_l2&#45;&gt;res_add2_l2 -->
<g id="edge223" class="edge">
<title>aggregate_l2&#45;&gt;res_add2_l2</title>
<path fill="none" stroke="black" d="M2818.59,-1655.35C3023.58,-1633.55 3341.12,-1599.77 3526.79,-1580.03"/>
<polygon fill="black" stroke="black" points="3527.33,-1583.49 3536.9,-1578.95 3526.59,-1576.53 3527.33,-1583.49"/>
</g>
<!-- norm2_l2 -->
<g id="node177" class="node">
<title>norm2_l2</title>
<polygon fill="lightgreen" stroke="black" points="3809,-1501.16 3543,-1501.16 3543,-1449.16 3809,-1449.16 3809,-1501.16"/>
<text text-anchor="middle" x="3676" y="-1489.16" font-family="Arial" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3676" y="-1478.16" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3676" y="-1467.16" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3676" y="-1456.16" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- res_add2_l2&#45;&gt;norm2_l2 -->
<g id="edge225" class="edge">
<title>res_add2_l2&#45;&gt;norm2_l2</title>
<path fill="none" stroke="black" d="M3676,-1536.82C3676,-1528.86 3676,-1519.92 3676,-1511.4"/>
<polygon fill="black" stroke="black" points="3679.5,-1511.31 3676,-1501.31 3672.5,-1511.31 3679.5,-1511.31"/>
</g>
<!-- input_l3 -->
<g id="node178" class="node">
<title>input_l3</title>
<ellipse fill="lightblue" stroke="black" cx="3676" cy="-1365.39" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="3676" y="-1379.39" font-family="Arial" font-size="10.00">Layer 3 Input</text>
<text text-anchor="middle" x="3676" y="-1368.39" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3676" y="-1357.39" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3676" y="-1346.39" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm2_l2&#45;&gt;input_l3 -->
<g id="edge304" class="edge">
<title>norm2_l2&#45;&gt;input_l3</title>
<path fill="none" stroke="black" d="M3676,-1448.89C3676,-1438.1 3676,-1425.15 3676,-1412.75"/>
<polygon fill="black" stroke="black" points="3679.5,-1412.51 3676,-1402.51 3672.5,-1412.51 3679.5,-1412.51"/>
</g>
<!-- mha_qkv_l3 -->
<g id="node179" class="node">
<title>mha_qkv_l3</title>
<polygon fill="lightgreen" stroke="black" points="3741,-1292.62 3445,-1292.62 3445,-1240.62 3741,-1240.62 3741,-1292.62"/>
<text text-anchor="middle" x="3593" y="-1280.62" font-family="Arial" font-size="10.00">MHA QKV Linear</text>
<text text-anchor="middle" x="3593" y="-1269.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3593" y="-1258.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="3593" y="-1247.62" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- input_l3&#45;&gt;mha_qkv_l3 -->
<g id="edge226" class="edge">
<title>input_l3&#45;&gt;mha_qkv_l3</title>
<path fill="none" stroke="black" d="M3645.57,-1328.9C3637.62,-1319.64 3629.09,-1309.7 3621.27,-1300.57"/>
<polygon fill="black" stroke="black" points="3623.77,-1298.12 3614.6,-1292.8 3618.46,-1302.67 3623.77,-1298.12"/>
</g>
<!-- res_add_l3 -->
<g id="node182" class="node">
<title>res_add_l3</title>
<polygon fill="lightgreen" stroke="black" points="3857,-1028.62 3579,-1028.62 3579,-976.62 3857,-976.62 3857,-1028.62"/>
<text text-anchor="middle" x="3718" y="-1016.62" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="3718" y="-1005.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="3718" y="-994.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3718" y="-983.62" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- input_l3&#45;&gt;res_add_l3 -->
<g id="edge229" class="edge">
<title>input_l3&#45;&gt;res_add_l3</title>
<path fill="none" stroke="black" d="M3723.39,-1329.48C3734.16,-1318.95 3744.14,-1306.46 3750,-1292.62 3789.49,-1199.3 3773.16,-1163.03 3749,-1064.62 3746.75,-1055.47 3742.92,-1046.13 3738.71,-1037.6"/>
<polygon fill="black" stroke="black" points="3741.79,-1035.94 3734.04,-1028.71 3735.59,-1039.19 3741.79,-1035.94"/>
</g>
<!-- mha_attn_l3 -->
<g id="node180" class="node">
<title>mha_attn_l3</title>
<polygon fill="lightgreen" stroke="black" points="3741,-1204.62 3445,-1204.62 3445,-1152.62 3741,-1152.62 3741,-1204.62"/>
<text text-anchor="middle" x="3593" y="-1192.62" font-family="Arial" font-size="10.00">MHA Attention</text>
<text text-anchor="middle" x="3593" y="-1181.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="3593" y="-1170.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="3593" y="-1159.62" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- mha_qkv_l3&#45;&gt;mha_attn_l3 -->
<g id="edge227" class="edge">
<title>mha_qkv_l3&#45;&gt;mha_attn_l3</title>
<path fill="none" stroke="black" d="M3593,-1240.28C3593,-1232.32 3593,-1223.38 3593,-1214.86"/>
<polygon fill="black" stroke="black" points="3596.5,-1214.77 3593,-1204.77 3589.5,-1214.77 3596.5,-1214.77"/>
</g>
<!-- mha_out_l3 -->
<g id="node181" class="node">
<title>mha_out_l3</title>
<polygon fill="lightgreen" stroke="black" points="3739.5,-1116.62 3450.5,-1116.62 3450.5,-1064.62 3739.5,-1064.62 3739.5,-1116.62"/>
<text text-anchor="middle" x="3595" y="-1104.62" font-family="Arial" font-size="10.00">MHA Output Linear</text>
<text text-anchor="middle" x="3595" y="-1093.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]</text>
<text text-anchor="middle" x="3595" y="-1082.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3595" y="-1071.62" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- mha_attn_l3&#45;&gt;mha_out_l3 -->
<g id="edge228" class="edge">
<title>mha_attn_l3&#45;&gt;mha_out_l3</title>
<path fill="none" stroke="black" d="M3593.59,-1152.28C3593.77,-1144.32 3593.98,-1135.38 3594.18,-1126.86"/>
<polygon fill="black" stroke="black" points="3597.68,-1126.85 3594.41,-1116.77 3590.68,-1126.69 3597.68,-1126.85"/>
</g>
<!-- mha_out_l3&#45;&gt;res_add_l3 -->
<g id="edge230" class="edge">
<title>mha_out_l3&#45;&gt;res_add_l3</title>
<path fill="none" stroke="black" d="M3630.91,-1064.51C3644.18,-1055.23 3659.38,-1044.6 3673.34,-1034.84"/>
<polygon fill="black" stroke="black" points="3675.65,-1037.5 3681.84,-1028.9 3671.63,-1031.77 3675.65,-1037.5"/>
</g>
<!-- norm_l3 -->
<g id="node183" class="node">
<title>norm_l3</title>
<polygon fill="lightgreen" stroke="black" points="3851,-940.62 3585,-940.62 3585,-888.62 3851,-888.62 3851,-940.62"/>
<text text-anchor="middle" x="3718" y="-928.62" font-family="Arial" font-size="10.00">Layer Norm</text>
<text text-anchor="middle" x="3718" y="-917.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3718" y="-906.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3718" y="-895.62" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- res_add_l3&#45;&gt;norm_l3 -->
<g id="edge231" class="edge">
<title>res_add_l3&#45;&gt;norm_l3</title>
<path fill="none" stroke="black" d="M3718,-976.28C3718,-968.32 3718,-959.38 3718,-950.86"/>
<polygon fill="black" stroke="black" points="3721.5,-950.77 3718,-940.77 3714.5,-950.77 3721.5,-950.77"/>
</g>
<!-- gate_l3 -->
<g id="node184" class="node">
<title>gate_l3</title>
<polygon fill="lightyellow" stroke="black" points="3432.3,-852.62 2965.72,-852.62 2845.7,-748.62 3312.28,-748.62 3432.3,-852.62"/>
<text text-anchor="middle" x="3139" y="-814.62" font-family="Arial" font-size="10.00">Gate Network</text>
<text text-anchor="middle" x="3139" y="-803.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3139" y="-792.62" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, num_experts=16]</text>
<text text-anchor="middle" x="3139" y="-781.62" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l3&#45;&gt;gate_l3 -->
<g id="edge232" class="edge">
<title>norm_l3&#45;&gt;gate_l3</title>
<path fill="none" stroke="black" d="M3588.42,-888.55C3536.21,-878.45 3473.89,-866.4 3412.53,-854.53"/>
<polygon fill="black" stroke="black" points="3413.17,-851.09 3402.69,-852.62 3411.84,-857.96 3413.17,-851.09"/>
</g>
<!-- route_l3 -->
<g id="node185" class="node">
<title>route_l3</title>
<polygon fill="lightgray" stroke="black" stroke-dasharray="5,2" points="3985.46,-852.62 3559.99,-852.62 3450.54,-748.62 3876.01,-748.62 3985.46,-852.62"/>
<text text-anchor="middle" x="3718" y="-814.62" font-family="Arial" font-size="10.00">Token Routing</text>
<text text-anchor="middle" x="3718" y="-803.62" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3718" y="-792.62" font-family="Arial" font-size="10.00">Output: [distributed across 16 GPUs]</text>
<text text-anchor="middle" x="3718" y="-781.62" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l3&#45;&gt;route_l3 -->
<g id="edge233" class="edge">
<title>norm_l3&#45;&gt;route_l3</title>
<path fill="none" stroke="black" d="M3718,-888.48C3718,-880.8 3718,-871.98 3718,-862.99"/>
<polygon fill="black" stroke="black" points="3721.5,-862.8 3718,-852.8 3714.5,-862.8 3721.5,-862.8"/>
</g>
<!-- res_add2_l3 -->
<g id="node235" class="node">
<title>res_add2_l3</title>
<polygon fill="lightgreen" stroke="black" points="4886,-265.54 4608,-265.54 4608,-213.54 4886,-213.54 4886,-265.54"/>
<text text-anchor="middle" x="4747" y="-253.54" font-family="Arial" font-size="10.00">Residual Add 2</text>
<text text-anchor="middle" x="4747" y="-242.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192] (x2)</text>
<text text-anchor="middle" x="4747" y="-231.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4747" y="-220.54" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm_l3&#45;&gt;res_add2_l3 -->
<g id="edge299" class="edge">
<title>norm_l3&#45;&gt;res_add2_l3</title>
<path fill="none" stroke="black" d="M3851.3,-913.64C4334.09,-911.97 5963,-890.5 5963,-676.85 5963,-676.85 5963,-676.85 5963,-477.31 5963,-460.8 5965.28,-452.57 5953,-441.54 5799.5,-303.71 5183.79,-259.3 4896.29,-245.91"/>
<polygon fill="black" stroke="black" points="4896.35,-242.41 4886.2,-245.45 4896.03,-249.4 4896.35,-242.41"/>
</g>
<!-- expert0_comm_l3 -->
<g id="node186" class="node">
<title>expert0_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="1409" cy="-675.85" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1409" y="-689.85" font-family="Arial" font-size="10.00">Expert 0 Communication</text>
<text text-anchor="middle" x="1409" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 0]</text>
<text text-anchor="middle" x="1409" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 0]</text>
<text text-anchor="middle" x="1409" y="-656.85" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- route_l3&#45;&gt;expert0_comm_l3 -->
<g id="edge234" class="edge">
<title>route_l3&#45;&gt;expert0_comm_l3</title>
<path fill="none" stroke="black" d="M3451.64,-749.75C3448.08,-749.35 3444.53,-748.97 3441,-748.62 3024.37,-706.57 1972.31,-766.12 1557,-712.62 1540.56,-710.5 1523.3,-707.27 1506.6,-703.61"/>
<polygon fill="black" stroke="black" points="1507.37,-700.2 1496.85,-701.41 1505.83,-707.02 1507.37,-700.2"/>
</g>
<!-- expert1_comm_l3 -->
<g id="node189" class="node">
<title>expert1_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="1688" cy="-675.85" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1688" y="-689.85" font-family="Arial" font-size="10.00">Expert 1 Communication</text>
<text text-anchor="middle" x="1688" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 1]</text>
<text text-anchor="middle" x="1688" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 1]</text>
<text text-anchor="middle" x="1688" y="-656.85" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- route_l3&#45;&gt;expert1_comm_l3 -->
<g id="edge238" class="edge">
<title>route_l3&#45;&gt;expert1_comm_l3</title>
<path fill="none" stroke="black" d="M3451.64,-749.76C3448.08,-749.36 3444.53,-748.98 3441,-748.62 2740.51,-676.64 2556.48,-793.87 1857,-712.62 1835.43,-710.11 1812.54,-706.16 1790.8,-701.78"/>
<polygon fill="black" stroke="black" points="1791.41,-698.34 1780.91,-699.75 1790,-705.19 1791.41,-698.34"/>
</g>
<!-- expert2_comm_l3 -->
<g id="node192" class="node">
<title>expert2_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="1988" cy="-675.85" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="1988" y="-689.85" font-family="Arial" font-size="10.00">Expert 2 Communication</text>
<text text-anchor="middle" x="1988" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 2]</text>
<text text-anchor="middle" x="1988" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 2]</text>
<text text-anchor="middle" x="1988" y="-656.85" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- route_l3&#45;&gt;expert2_comm_l3 -->
<g id="edge242" class="edge">
<title>route_l3&#45;&gt;expert2_comm_l3</title>
<path fill="none" stroke="black" d="M3451.64,-749.79C3448.07,-749.38 3444.53,-748.99 3441,-748.62 2864.85,-687.99 2712.38,-788.21 2138,-712.62 2121.25,-710.41 2103.64,-707.12 2086.61,-703.41"/>
<polygon fill="black" stroke="black" points="2087.19,-699.95 2076.67,-701.19 2085.66,-706.79 2087.19,-699.95"/>
</g>
<!-- expert3_comm_l3 -->
<g id="node195" class="node">
<title>expert3_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="2269" cy="-675.85" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2269" y="-689.85" font-family="Arial" font-size="10.00">Expert 3 Communication</text>
<text text-anchor="middle" x="2269" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 3]</text>
<text text-anchor="middle" x="2269" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 3]</text>
<text text-anchor="middle" x="2269" y="-656.85" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- route_l3&#45;&gt;expert3_comm_l3 -->
<g id="edge246" class="edge">
<title>route_l3&#45;&gt;expert3_comm_l3</title>
<path fill="none" stroke="black" d="M3451.63,-749.84C3448.07,-749.41 3444.52,-749.01 3441,-748.62 3021.03,-702.24 2911.46,-754.3 2491,-712.62 2455.11,-709.06 2416.22,-703.41 2381.16,-697.65"/>
<polygon fill="black" stroke="black" points="2381.33,-694.13 2370.89,-695.94 2380.18,-701.03 2381.33,-694.13"/>
</g>
<!-- expert4_comm_l3 -->
<g id="node198" class="node">
<title>expert4_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="2622" cy="-675.85" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2622" y="-689.85" font-family="Arial" font-size="10.00">Expert 4 Communication</text>
<text text-anchor="middle" x="2622" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 4]</text>
<text text-anchor="middle" x="2622" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 4]</text>
<text text-anchor="middle" x="2622" y="-656.85" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- route_l3&#45;&gt;expert4_comm_l3 -->
<g id="edge250" class="edge">
<title>route_l3&#45;&gt;expert4_comm_l3</title>
<path fill="none" stroke="black" d="M3451.63,-749.92C3448.06,-749.47 3444.52,-749.04 3441,-748.62 3148.84,-713.91 3071.39,-753.24 2780,-712.62 2761.58,-710.05 2742.14,-706.42 2723.43,-702.45"/>
<polygon fill="black" stroke="black" points="2723.94,-698.98 2713.42,-700.29 2722.45,-705.82 2723.94,-698.98"/>
</g>
<!-- expert5_comm_l3 -->
<g id="node201" class="node">
<title>expert5_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="2911" cy="-675.85" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="2911" y="-689.85" font-family="Arial" font-size="10.00">Expert 5 Communication</text>
<text text-anchor="middle" x="2911" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 5]</text>
<text text-anchor="middle" x="2911" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 5]</text>
<text text-anchor="middle" x="2911" y="-656.85" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- route_l3&#45;&gt;expert5_comm_l3 -->
<g id="edge254" class="edge">
<title>route_l3&#45;&gt;expert5_comm_l3</title>
<path fill="none" stroke="black" d="M3451.97,-750.17C3448.29,-749.64 3444.63,-749.12 3441,-748.62 3270.33,-724.99 3224.87,-741.47 3055,-712.62 3040.21,-710.11 3024.69,-706.88 3009.55,-703.41"/>
<polygon fill="black" stroke="black" points="3010.2,-699.97 2999.67,-701.09 3008.6,-706.78 3010.2,-699.97"/>
</g>
<!-- expert6_comm_l3 -->
<g id="node204" class="node">
<title>expert6_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="3186" cy="-675.85" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="3186" y="-689.85" font-family="Arial" font-size="10.00">Expert 6 Communication</text>
<text text-anchor="middle" x="3186" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 6]</text>
<text text-anchor="middle" x="3186" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 6]</text>
<text text-anchor="middle" x="3186" y="-656.85" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- route_l3&#45;&gt;expert6_comm_l3 -->
<g id="edge258" class="edge">
<title>route_l3&#45;&gt;expert6_comm_l3</title>
<path fill="none" stroke="black" d="M3479.28,-748.59C3427.66,-737.13 3373.44,-724.75 3323,-712.62 3310.93,-709.71 3298.29,-706.56 3285.78,-703.38"/>
<polygon fill="black" stroke="black" points="3286.34,-699.91 3275.78,-700.82 3284.6,-706.69 3286.34,-699.91"/>
</g>
<!-- expert7_comm_l3 -->
<g id="node207" class="node">
<title>expert7_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="3454" cy="-675.85" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="3454" y="-689.85" font-family="Arial" font-size="10.00">Expert 7 Communication</text>
<text text-anchor="middle" x="3454" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 7]</text>
<text text-anchor="middle" x="3454" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 7]</text>
<text text-anchor="middle" x="3454" y="-656.85" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- route_l3&#45;&gt;expert7_comm_l3 -->
<g id="edge262" class="edge">
<title>route_l3&#45;&gt;expert7_comm_l3</title>
<path fill="none" stroke="black" d="M3607.95,-748.44C3581.1,-735.96 3553.01,-722.89 3528.28,-711.39"/>
<polygon fill="black" stroke="black" points="3529.52,-708.11 3518.98,-707.07 3526.57,-714.46 3529.52,-708.11"/>
</g>
<!-- expert8_comm_l3 -->
<g id="node210" class="node">
<title>expert8_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="3718" cy="-675.85" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="3718" y="-689.85" font-family="Arial" font-size="10.00">Expert 8 Communication</text>
<text text-anchor="middle" x="3718" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 8]</text>
<text text-anchor="middle" x="3718" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 8]</text>
<text text-anchor="middle" x="3718" y="-656.85" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- route_l3&#45;&gt;expert8_comm_l3 -->
<g id="edge266" class="edge">
<title>route_l3&#45;&gt;expert8_comm_l3</title>
<path fill="none" stroke="black" d="M3718,-748.26C3718,-739.85 3718,-731.19 3718,-722.92"/>
<polygon fill="black" stroke="black" points="3721.5,-722.7 3718,-712.7 3714.5,-722.7 3721.5,-722.7"/>
</g>
<!-- expert9_comm_l3 -->
<g id="node213" class="node">
<title>expert9_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="3997" cy="-675.85" rx="121.74" ry="36.54"/>
<text text-anchor="middle" x="3997" y="-689.85" font-family="Arial" font-size="10.00">Expert 9 Communication</text>
<text text-anchor="middle" x="3997" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 9]</text>
<text text-anchor="middle" x="3997" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 9]</text>
<text text-anchor="middle" x="3997" y="-656.85" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- route_l3&#45;&gt;expert9_comm_l3 -->
<g id="edge270" class="edge">
<title>route_l3&#45;&gt;expert9_comm_l3</title>
<path fill="none" stroke="black" d="M3834.3,-748.44C3863.32,-735.67 3893.73,-722.29 3920.29,-710.6"/>
<polygon fill="black" stroke="black" points="3921.77,-713.77 3929.52,-706.54 3918.96,-707.37 3921.77,-713.77"/>
</g>
<!-- expert10_comm_l3 -->
<g id="node216" class="node">
<title>expert10_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="4288" cy="-675.85" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4288" y="-689.85" font-family="Arial" font-size="10.00">Expert 10 Communication</text>
<text text-anchor="middle" x="4288" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 10]</text>
<text text-anchor="middle" x="4288" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 10]</text>
<text text-anchor="middle" x="4288" y="-656.85" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- route_l3&#45;&gt;expert10_comm_l3 -->
<g id="edge274" class="edge">
<title>route_l3&#45;&gt;expert10_comm_l3</title>
<path fill="none" stroke="black" d="M3891.65,-763.2C3964.67,-747.78 4050.5,-729.5 4128,-712.62 4144.86,-708.95 4162.7,-705.01 4180.11,-701.13"/>
<polygon fill="black" stroke="black" points="4181.31,-704.45 4190.31,-698.86 4179.79,-697.62 4181.31,-704.45"/>
</g>
<!-- expert11_comm_l3 -->
<g id="node219" class="node">
<title>expert11_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="4584" cy="-675.85" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4584" y="-689.85" font-family="Arial" font-size="10.00">Expert 11 Communication</text>
<text text-anchor="middle" x="4584" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 11]</text>
<text text-anchor="middle" x="4584" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 11]</text>
<text text-anchor="middle" x="4584" y="-656.85" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- route_l3&#45;&gt;expert11_comm_l3 -->
<g id="edge278" class="edge">
<title>route_l3&#45;&gt;expert11_comm_l3</title>
<path fill="none" stroke="black" d="M3909.95,-780.84C4051.89,-765.76 4249.65,-742.23 4422,-712.62 4440.17,-709.5 4459.37,-705.7 4477.97,-701.76"/>
<polygon fill="black" stroke="black" points="4478.88,-705.15 4487.92,-699.63 4477.41,-698.3 4478.88,-705.15"/>
</g>
<!-- expert12_comm_l3 -->
<g id="node222" class="node">
<title>expert12_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="4881" cy="-675.85" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="4881" y="-689.85" font-family="Arial" font-size="10.00">Expert 12 Communication</text>
<text text-anchor="middle" x="4881" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 12]</text>
<text text-anchor="middle" x="4881" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 12]</text>
<text text-anchor="middle" x="4881" y="-656.85" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- route_l3&#45;&gt;expert12_comm_l3 -->
<g id="edge282" class="edge">
<title>route_l3&#45;&gt;expert12_comm_l3</title>
<path fill="none" stroke="black" d="M3919.55,-789.75C4122.15,-778.03 4443.01,-754.57 4718,-712.62 4736.78,-709.75 4756.63,-706.01 4775.78,-702.02"/>
<polygon fill="black" stroke="black" points="4776.66,-705.41 4785.71,-699.92 4775.21,-698.57 4776.66,-705.41"/>
</g>
<!-- expert13_comm_l3 -->
<g id="node225" class="node">
<title>expert13_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="5178" cy="-675.85" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="5178" y="-689.85" font-family="Arial" font-size="10.00">Expert 13 Communication</text>
<text text-anchor="middle" x="5178" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 13]</text>
<text text-anchor="middle" x="5178" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 13]</text>
<text text-anchor="middle" x="5178" y="-656.85" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- route_l3&#45;&gt;expert13_comm_l3 -->
<g id="edge286" class="edge">
<title>route_l3&#45;&gt;expert13_comm_l3</title>
<path fill="none" stroke="black" d="M3925.09,-795.23C4181.93,-787.61 4632.67,-767.08 5015,-712.62 5034.14,-709.89 5054.37,-706.16 5073.84,-702.12"/>
<polygon fill="black" stroke="black" points="5074.56,-705.55 5083.62,-700.06 5073.12,-698.7 5074.56,-705.55"/>
</g>
<!-- expert14_comm_l3 -->
<g id="node228" class="node">
<title>expert14_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="5476" cy="-675.85" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="5476" y="-689.85" font-family="Arial" font-size="10.00">Expert 14 Communication</text>
<text text-anchor="middle" x="5476" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 14]</text>
<text text-anchor="middle" x="5476" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 14]</text>
<text text-anchor="middle" x="5476" y="-656.85" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- route_l3&#45;&gt;expert14_comm_l3 -->
<g id="edge290" class="edge">
<title>route_l3&#45;&gt;expert14_comm_l3</title>
<path fill="none" stroke="black" d="M3929.17,-798.83C4235.32,-795.25 4819.71,-779.3 5312,-712.62 5331.39,-709.99 5351.9,-706.28 5371.59,-702.24"/>
<polygon fill="black" stroke="black" points="5372.43,-705.64 5381.5,-700.16 5370.99,-698.79 5372.43,-705.64"/>
</g>
<!-- expert15_comm_l3 -->
<g id="node231" class="node">
<title>expert15_comm_l3</title>
<ellipse fill="lightgray" stroke="black" cx="5774" cy="-675.85" rx="125.32" ry="36.54"/>
<text text-anchor="middle" x="5774" y="-689.85" font-family="Arial" font-size="10.00">Expert 15 Communication</text>
<text text-anchor="middle" x="5774" y="-678.85" font-family="Arial" font-size="10.00">Input: [tokens selected for expert 15]</text>
<text text-anchor="middle" x="5774" y="-667.85" font-family="Arial" font-size="10.00">Output: [tokens on GPU 15]</text>
<text text-anchor="middle" x="5774" y="-656.85" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- route_l3&#45;&gt;expert15_comm_l3 -->
<g id="edge294" class="edge">
<title>route_l3&#45;&gt;expert15_comm_l3</title>
<path fill="none" stroke="black" d="M3924.39,-794.53C4345.18,-783.43 5289.47,-754.64 5610,-712.62 5629.53,-710.06 5650.17,-706.36 5669.99,-702.29"/>
<polygon fill="black" stroke="black" points="5670.88,-705.68 5679.95,-700.21 5669.45,-698.83 5670.88,-705.68"/>
</g>
<!-- expert0_l3 -->
<g id="node187" class="node">
<title>expert0_l3</title>
<polygon fill="lightcoral" stroke="black" points="1465,-603.08 1277,-603.08 1277,-551.08 1465,-551.08 1465,-603.08"/>
<text text-anchor="middle" x="1371" y="-591.08" font-family="Arial" font-size="10.00">Expert 0 MLP</text>
<text text-anchor="middle" x="1371" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1371" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1371" y="-558.08" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- expert0_comm_l3&#45;&gt;expert0_l3 -->
<g id="edge235" class="edge">
<title>expert0_comm_l3&#45;&gt;expert0_l3</title>
<path fill="none" stroke="black" d="M1394.96,-639.09C1391.55,-630.41 1387.91,-621.14 1384.52,-612.52"/>
<polygon fill="black" stroke="black" points="1387.75,-611.15 1380.83,-603.12 1381.23,-613.71 1387.75,-611.15"/>
</g>
<!-- expert0_return_l3 -->
<g id="node188" class="node">
<title>expert0_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="1334" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1334" y="-492.31" font-family="Arial" font-size="10.00">Expert 0 Return</text>
<text text-anchor="middle" x="1334" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1334" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1334" y="-459.31" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- expert0_l3&#45;&gt;expert0_return_l3 -->
<g id="edge236" class="edge">
<title>expert0_l3&#45;&gt;expert0_return_l3</title>
<path fill="none" stroke="black" d="M1361.38,-550.91C1358.26,-542.76 1354.71,-533.46 1351.21,-524.33"/>
<polygon fill="black" stroke="black" points="1354.46,-523.01 1347.62,-514.92 1347.92,-525.51 1354.46,-523.01"/>
</g>
<!-- aggregate_l3 -->
<g id="node234" class="node">
<title>aggregate_l3</title>
<polygon fill="lightpink" stroke="black" points="3993.55,-405.54 3555.21,-405.54 3442.45,-301.54 3880.79,-301.54 3993.55,-405.54"/>
<text text-anchor="middle" x="3718" y="-367.54" font-family="Arial" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3718" y="-356.54" font-family="Arial" font-size="10.00">Input: [processed_tokens from all experts]</text>
<text text-anchor="middle" x="3718" y="-345.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="3718" y="-334.54" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- expert0_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge237" class="edge">
<title>expert0_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M1429.65,-451.42C1447.28,-447.48 1465.61,-443.94 1483,-441.54 1865.89,-388.65 3004.89,-365.41 3492.45,-357.69"/>
<polygon fill="black" stroke="black" points="3492.84,-361.18 3502.78,-357.52 3492.73,-354.18 3492.84,-361.18"/>
</g>
<!-- expert1_l3 -->
<g id="node190" class="node">
<title>expert1_l3</title>
<polygon fill="lightcoral" stroke="black" points="1764,-603.08 1576,-603.08 1576,-551.08 1764,-551.08 1764,-603.08"/>
<text text-anchor="middle" x="1670" y="-591.08" font-family="Arial" font-size="10.00">Expert 1 MLP</text>
<text text-anchor="middle" x="1670" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1670" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1670" y="-558.08" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- expert1_comm_l3&#45;&gt;expert1_l3 -->
<g id="edge239" class="edge">
<title>expert1_comm_l3&#45;&gt;expert1_l3</title>
<path fill="none" stroke="black" d="M1681.35,-639.09C1679.77,-630.59 1678.08,-621.54 1676.51,-613.07"/>
<polygon fill="black" stroke="black" points="1679.93,-612.31 1674.66,-603.12 1673.05,-613.59 1679.93,-612.31"/>
</g>
<!-- expert1_return_l3 -->
<g id="node191" class="node">
<title>expert1_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="1632" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1632" y="-492.31" font-family="Arial" font-size="10.00">Expert 1 Return</text>
<text text-anchor="middle" x="1632" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1632" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1632" y="-459.31" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- expert1_l3&#45;&gt;expert1_return_l3 -->
<g id="edge240" class="edge">
<title>expert1_l3&#45;&gt;expert1_return_l3</title>
<path fill="none" stroke="black" d="M1660.12,-550.91C1656.92,-542.76 1653.27,-533.46 1649.68,-524.33"/>
<polygon fill="black" stroke="black" points="1652.9,-522.95 1645.98,-514.92 1646.38,-525.51 1652.9,-522.95"/>
</g>
<!-- expert1_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge241" class="edge">
<title>expert1_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M1728.07,-451.41C1745.57,-447.51 1763.75,-443.97 1781,-441.54 2105.62,-395.71 3057.59,-369.26 3494.35,-359.22"/>
<polygon fill="black" stroke="black" points="3494.65,-362.72 3504.57,-358.99 3494.49,-355.72 3494.65,-362.72"/>
</g>
<!-- expert2_l3 -->
<g id="node193" class="node">
<title>expert2_l3</title>
<polygon fill="lightcoral" stroke="black" points="2043,-603.08 1855,-603.08 1855,-551.08 2043,-551.08 2043,-603.08"/>
<text text-anchor="middle" x="1949" y="-591.08" font-family="Arial" font-size="10.00">Expert 2 MLP</text>
<text text-anchor="middle" x="1949" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1949" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1949" y="-558.08" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- expert2_comm_l3&#45;&gt;expert2_l3 -->
<g id="edge243" class="edge">
<title>expert2_comm_l3&#45;&gt;expert2_l3</title>
<path fill="none" stroke="black" d="M1973.59,-639.09C1970.09,-630.41 1966.35,-621.14 1962.88,-612.52"/>
<polygon fill="black" stroke="black" points="1966.08,-611.09 1959.09,-603.12 1959.58,-613.71 1966.08,-611.09"/>
</g>
<!-- expert2_return_l3 -->
<g id="node194" class="node">
<title>expert2_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="1930" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="1930" y="-492.31" font-family="Arial" font-size="10.00">Expert 2 Return</text>
<text text-anchor="middle" x="1930" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="1930" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="1930" y="-459.31" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- expert2_l3&#45;&gt;expert2_return_l3 -->
<g id="edge244" class="edge">
<title>expert2_l3&#45;&gt;expert2_return_l3</title>
<path fill="none" stroke="black" d="M1944.06,-550.91C1942.51,-543.01 1940.75,-534.04 1939.01,-525.18"/>
<polygon fill="black" stroke="black" points="1942.42,-524.42 1937.06,-515.29 1935.56,-525.77 1942.42,-524.42"/>
</g>
<!-- expert2_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge245" class="edge">
<title>expert2_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M2026.08,-451.53C2043.58,-447.61 2061.76,-444.05 2079,-441.54 2345.93,-402.75 3114.44,-373.75 3496.67,-361.28"/>
<polygon fill="black" stroke="black" points="3496.87,-364.77 3506.75,-360.95 3496.64,-357.78 3496.87,-364.77"/>
</g>
<!-- expert3_l3 -->
<g id="node196" class="node">
<title>expert3_l3</title>
<polygon fill="lightcoral" stroke="black" points="2342,-603.08 2154,-603.08 2154,-551.08 2342,-551.08 2342,-603.08"/>
<text text-anchor="middle" x="2248" y="-591.08" font-family="Arial" font-size="10.00">Expert 3 MLP</text>
<text text-anchor="middle" x="2248" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2248" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2248" y="-558.08" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- expert3_comm_l3&#45;&gt;expert3_l3 -->
<g id="edge247" class="edge">
<title>expert3_comm_l3&#45;&gt;expert3_l3</title>
<path fill="none" stroke="black" d="M2261.24,-639.09C2259.4,-630.59 2257.43,-621.54 2255.59,-613.07"/>
<polygon fill="black" stroke="black" points="2258.98,-612.15 2253.43,-603.12 2252.14,-613.64 2258.98,-612.15"/>
</g>
<!-- expert3_return_l3 -->
<g id="node197" class="node">
<title>expert3_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="2228" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2228" y="-492.31" font-family="Arial" font-size="10.00">Expert 3 Return</text>
<text text-anchor="middle" x="2228" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2228" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2228" y="-459.31" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- expert3_l3&#45;&gt;expert3_return_l3 -->
<g id="edge248" class="edge">
<title>expert3_l3&#45;&gt;expert3_return_l3</title>
<path fill="none" stroke="black" d="M2242.8,-550.91C2241.17,-543.01 2239.31,-534.04 2237.48,-525.18"/>
<polygon fill="black" stroke="black" points="2240.89,-524.37 2235.44,-515.29 2234.03,-525.79 2240.89,-524.37"/>
</g>
<!-- expert3_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge249" class="edge">
<title>expert3_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M2324.51,-451.61C2341.88,-447.71 2359.9,-444.13 2377,-441.54 2766.16,-382.64 3224.79,-363.59 3492.31,-357.44"/>
<polygon fill="black" stroke="black" points="3492.62,-360.94 3502.54,-357.21 3492.46,-353.94 3492.62,-360.94"/>
</g>
<!-- expert4_l3 -->
<g id="node199" class="node">
<title>expert4_l3</title>
<polygon fill="lightcoral" stroke="black" points="2694,-603.08 2506,-603.08 2506,-551.08 2694,-551.08 2694,-603.08"/>
<text text-anchor="middle" x="2600" y="-591.08" font-family="Arial" font-size="10.00">Expert 4 MLP</text>
<text text-anchor="middle" x="2600" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2600" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2600" y="-558.08" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- expert4_comm_l3&#45;&gt;expert4_l3 -->
<g id="edge251" class="edge">
<title>expert4_comm_l3&#45;&gt;expert4_l3</title>
<path fill="none" stroke="black" d="M2613.87,-639.09C2611.94,-630.59 2609.88,-621.54 2607.96,-613.07"/>
<polygon fill="black" stroke="black" points="2611.32,-612.1 2605.69,-603.12 2604.5,-613.65 2611.32,-612.1"/>
</g>
<!-- expert4_return_l3 -->
<g id="node200" class="node">
<title>expert4_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="2526" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2526" y="-492.31" font-family="Arial" font-size="10.00">Expert 4 Return</text>
<text text-anchor="middle" x="2526" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2526" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2526" y="-459.31" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- expert4_l3&#45;&gt;expert4_return_l3 -->
<g id="edge252" class="edge">
<title>expert4_l3&#45;&gt;expert4_return_l3</title>
<path fill="none" stroke="black" d="M2580.75,-550.91C2574.13,-542.24 2566.51,-532.28 2559.1,-522.59"/>
<polygon fill="black" stroke="black" points="2561.81,-520.37 2552.95,-514.55 2556.25,-524.62 2561.81,-520.37"/>
</g>
<!-- expert4_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge253" class="edge">
<title>expert4_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M2622.95,-451.78C2640.2,-447.88 2658.06,-444.26 2675,-441.54 2957.34,-396.15 3286.71,-373.68 3498.59,-363.12"/>
<polygon fill="black" stroke="black" points="3498.77,-366.61 3508.59,-362.62 3498.43,-359.62 3498.77,-366.61"/>
</g>
<!-- expert5_l3 -->
<g id="node202" class="node">
<title>expert5_l3</title>
<polygon fill="lightcoral" stroke="black" points="2941,-603.08 2753,-603.08 2753,-551.08 2941,-551.08 2941,-603.08"/>
<text text-anchor="middle" x="2847" y="-591.08" font-family="Arial" font-size="10.00">Expert 5 MLP</text>
<text text-anchor="middle" x="2847" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2847" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2847" y="-558.08" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- expert5_comm_l3&#45;&gt;expert5_l3 -->
<g id="edge255" class="edge">
<title>expert5_comm_l3&#45;&gt;expert5_l3</title>
<path fill="none" stroke="black" d="M2887.71,-639.64C2881.65,-630.46 2875.13,-620.61 2869.12,-611.53"/>
<polygon fill="black" stroke="black" points="2871.99,-609.52 2863.55,-603.11 2866.15,-613.38 2871.99,-609.52"/>
</g>
<!-- expert5_return_l3 -->
<g id="node203" class="node">
<title>expert5_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="2824" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="2824" y="-492.31" font-family="Arial" font-size="10.00">Expert 5 Return</text>
<text text-anchor="middle" x="2824" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="2824" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="2824" y="-459.31" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- expert5_l3&#45;&gt;expert5_return_l3 -->
<g id="edge256" class="edge">
<title>expert5_l3&#45;&gt;expert5_return_l3</title>
<path fill="none" stroke="black" d="M2841.02,-550.91C2839.14,-543.01 2837.01,-534.04 2834.9,-525.18"/>
<polygon fill="black" stroke="black" points="2838.27,-524.2 2832.55,-515.29 2831.46,-525.82 2838.27,-524.2"/>
</g>
<!-- expert5_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge257" class="edge">
<title>expert5_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M2922.23,-451.97C2939.1,-448.13 2956.5,-444.47 2973,-441.54 3152.22,-409.68 3357.85,-386.67 3507.61,-372.35"/>
<polygon fill="black" stroke="black" points="3508.22,-375.81 3517.84,-371.38 3507.56,-368.84 3508.22,-375.81"/>
</g>
<!-- expert6_l3 -->
<g id="node205" class="node">
<title>expert6_l3</title>
<polygon fill="lightcoral" stroke="black" points="3248,-603.08 3060,-603.08 3060,-551.08 3248,-551.08 3248,-603.08"/>
<text text-anchor="middle" x="3154" y="-591.08" font-family="Arial" font-size="10.00">Expert 6 MLP</text>
<text text-anchor="middle" x="3154" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3154" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3154" y="-558.08" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- expert6_comm_l3&#45;&gt;expert6_l3 -->
<g id="edge259" class="edge">
<title>expert6_comm_l3&#45;&gt;expert6_l3</title>
<path fill="none" stroke="black" d="M3174.18,-639.09C3171.33,-630.5 3168.3,-621.34 3165.48,-612.79"/>
<polygon fill="black" stroke="black" points="3168.74,-611.52 3162.28,-603.12 3162.1,-613.71 3168.74,-611.52"/>
</g>
<!-- expert6_return_l3 -->
<g id="node206" class="node">
<title>expert6_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="3122" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3122" y="-492.31" font-family="Arial" font-size="10.00">Expert 6 Return</text>
<text text-anchor="middle" x="3122" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3122" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3122" y="-459.31" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- expert6_l3&#45;&gt;expert6_return_l3 -->
<g id="edge260" class="edge">
<title>expert6_l3&#45;&gt;expert6_return_l3</title>
<path fill="none" stroke="black" d="M3145.68,-550.91C3143.04,-542.93 3140.03,-533.85 3137.07,-524.89"/>
<polygon fill="black" stroke="black" points="3140.36,-523.68 3133.9,-515.29 3133.71,-525.88 3140.36,-523.68"/>
</g>
<!-- expert6_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge261" class="edge">
<title>expert6_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M3222.45,-452.57C3238.66,-448.76 3255.27,-444.96 3271,-441.54 3354.35,-423.43 3446.84,-405.14 3525.96,-390.02"/>
<polygon fill="black" stroke="black" points="3526.86,-393.41 3536.03,-388.1 3525.55,-386.54 3526.86,-393.41"/>
</g>
<!-- expert7_l3 -->
<g id="node208" class="node">
<title>expert7_l3</title>
<polygon fill="lightcoral" stroke="black" points="3531,-603.08 3343,-603.08 3343,-551.08 3531,-551.08 3531,-603.08"/>
<text text-anchor="middle" x="3437" y="-591.08" font-family="Arial" font-size="10.00">Expert 7 MLP</text>
<text text-anchor="middle" x="3437" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3437" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3437" y="-558.08" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- expert7_comm_l3&#45;&gt;expert7_l3 -->
<g id="edge263" class="edge">
<title>expert7_comm_l3&#45;&gt;expert7_l3</title>
<path fill="none" stroke="black" d="M3447.72,-639.09C3446.23,-630.59 3444.63,-621.54 3443.15,-613.07"/>
<polygon fill="black" stroke="black" points="3446.58,-612.37 3441.4,-603.12 3439.68,-613.58 3446.58,-612.37"/>
</g>
<!-- expert7_return_l3 -->
<g id="node209" class="node">
<title>expert7_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="3420" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3420" y="-492.31" font-family="Arial" font-size="10.00">Expert 7 Return</text>
<text text-anchor="middle" x="3420" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3420" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3420" y="-459.31" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- expert7_l3&#45;&gt;expert7_return_l3 -->
<g id="edge264" class="edge">
<title>expert7_l3&#45;&gt;expert7_return_l3</title>
<path fill="none" stroke="black" d="M3432.58,-550.91C3431.19,-543.01 3429.61,-534.04 3428.06,-525.18"/>
<polygon fill="black" stroke="black" points="3431.5,-524.53 3426.32,-515.29 3424.6,-525.74 3431.5,-524.53"/>
</g>
<!-- expert7_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge265" class="edge">
<title>expert7_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M3493.66,-446.96C3521.27,-435.59 3553.56,-422.28 3584.91,-409.37"/>
<polygon fill="black" stroke="black" points="3586.24,-412.61 3594.16,-405.56 3583.58,-406.13 3586.24,-412.61"/>
</g>
<!-- expert8_l3 -->
<g id="node211" class="node">
<title>expert8_l3</title>
<polygon fill="lightcoral" stroke="black" points="3812,-603.08 3624,-603.08 3624,-551.08 3812,-551.08 3812,-603.08"/>
<text text-anchor="middle" x="3718" y="-591.08" font-family="Arial" font-size="10.00">Expert 8 MLP</text>
<text text-anchor="middle" x="3718" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3718" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3718" y="-558.08" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- expert8_comm_l3&#45;&gt;expert8_l3 -->
<g id="edge267" class="edge">
<title>expert8_comm_l3&#45;&gt;expert8_l3</title>
<path fill="none" stroke="black" d="M3718,-638.81C3718,-630.5 3718,-621.67 3718,-613.39"/>
<polygon fill="black" stroke="black" points="3721.5,-613.27 3718,-603.27 3714.5,-613.27 3721.5,-613.27"/>
</g>
<!-- expert8_return_l3 -->
<g id="node212" class="node">
<title>expert8_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="3718" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="3718" y="-492.31" font-family="Arial" font-size="10.00">Expert 8 Return</text>
<text text-anchor="middle" x="3718" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="3718" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="3718" y="-459.31" font-family="Arial" font-size="10.00">GPU: 8</text>
</g>
<!-- expert8_l3&#45;&gt;expert8_return_l3 -->
<g id="edge268" class="edge">
<title>expert8_l3&#45;&gt;expert8_return_l3</title>
<path fill="none" stroke="black" d="M3718,-550.91C3718,-543.1 3718,-534.23 3718,-525.46"/>
<polygon fill="black" stroke="black" points="3721.5,-525.29 3718,-515.29 3714.5,-525.29 3721.5,-525.29"/>
</g>
<!-- expert8_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge269" class="edge">
<title>expert8_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M3718,-441.47C3718,-433.43 3718,-424.68 3718,-415.93"/>
<polygon fill="black" stroke="black" points="3721.5,-415.71 3718,-405.71 3714.5,-415.71 3721.5,-415.71"/>
</g>
<!-- expert9_l3 -->
<g id="node214" class="node">
<title>expert9_l3</title>
<polygon fill="lightcoral" stroke="black" points="4100,-603.08 3912,-603.08 3912,-551.08 4100,-551.08 4100,-603.08"/>
<text text-anchor="middle" x="4006" y="-591.08" font-family="Arial" font-size="10.00">Expert 9 MLP</text>
<text text-anchor="middle" x="4006" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4006" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4006" y="-558.08" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- expert9_comm_l3&#45;&gt;expert9_l3 -->
<g id="edge271" class="edge">
<title>expert9_comm_l3&#45;&gt;expert9_l3</title>
<path fill="none" stroke="black" d="M4000.33,-639.09C4001.11,-630.69 4001.94,-621.73 4002.72,-613.35"/>
<polygon fill="black" stroke="black" points="4006.23,-613.4 4003.67,-603.12 3999.26,-612.75 4006.23,-613.4"/>
</g>
<!-- expert9_return_l3 -->
<g id="node215" class="node">
<title>expert9_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="4016" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4016" y="-492.31" font-family="Arial" font-size="10.00">Expert 9 Return</text>
<text text-anchor="middle" x="4016" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4016" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4016" y="-459.31" font-family="Arial" font-size="10.00">GPU: 9</text>
</g>
<!-- expert9_l3&#45;&gt;expert9_return_l3 -->
<g id="edge272" class="edge">
<title>expert9_l3&#45;&gt;expert9_return_l3</title>
<path fill="none" stroke="black" d="M4008.6,-550.91C4009.41,-543.1 4010.32,-534.23 4011.23,-525.46"/>
<polygon fill="black" stroke="black" points="4014.74,-525.59 4012.28,-515.29 4007.77,-524.87 4014.74,-525.59"/>
</g>
<!-- expert9_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge273" class="edge">
<title>expert9_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M3942.34,-446.96C3914.73,-435.59 3882.44,-422.28 3851.09,-409.37"/>
<polygon fill="black" stroke="black" points="3852.42,-406.13 3841.84,-405.56 3849.76,-412.61 3852.42,-406.13"/>
</g>
<!-- expert10_l3 -->
<g id="node217" class="node">
<title>expert10_l3</title>
<polygon fill="lightcoral" stroke="black" points="4395,-603.08 4207,-603.08 4207,-551.08 4395,-551.08 4395,-603.08"/>
<text text-anchor="middle" x="4301" y="-591.08" font-family="Arial" font-size="10.00">Expert 10 MLP</text>
<text text-anchor="middle" x="4301" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4301" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4301" y="-558.08" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- expert10_comm_l3&#45;&gt;expert10_l3 -->
<g id="edge275" class="edge">
<title>expert10_comm_l3&#45;&gt;expert10_l3</title>
<path fill="none" stroke="black" d="M4292.8,-639.09C4293.95,-630.59 4295.16,-621.54 4296.3,-613.07"/>
<polygon fill="black" stroke="black" points="4299.77,-613.5 4297.64,-603.12 4292.84,-612.57 4299.77,-613.5"/>
</g>
<!-- expert10_return_l3 -->
<g id="node218" class="node">
<title>expert10_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="4314" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4314" y="-492.31" font-family="Arial" font-size="10.00">Expert 10 Return</text>
<text text-anchor="middle" x="4314" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4314" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4314" y="-459.31" font-family="Arial" font-size="10.00">GPU: 10</text>
</g>
<!-- expert10_l3&#45;&gt;expert10_return_l3 -->
<g id="edge276" class="edge">
<title>expert10_l3&#45;&gt;expert10_return_l3</title>
<path fill="none" stroke="black" d="M4304.38,-550.91C4305.43,-543.1 4306.62,-534.23 4307.8,-525.46"/>
<polygon fill="black" stroke="black" points="4311.3,-525.66 4309.17,-515.29 4304.37,-524.73 4311.3,-525.66"/>
</g>
<!-- expert10_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge277" class="edge">
<title>expert10_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M4213.55,-452.57C4197.34,-448.76 4180.73,-444.96 4165,-441.54 4111.8,-429.98 4054.87,-418.35 4000.07,-407.51"/>
<polygon fill="black" stroke="black" points="4000.72,-404.07 3990.23,-405.57 3999.36,-410.94 4000.72,-404.07"/>
</g>
<!-- expert11_l3 -->
<g id="node220" class="node">
<title>expert11_l3</title>
<polygon fill="lightcoral" stroke="black" points="4692,-603.08 4504,-603.08 4504,-551.08 4692,-551.08 4692,-603.08"/>
<text text-anchor="middle" x="4598" y="-591.08" font-family="Arial" font-size="10.00">Expert 11 MLP</text>
<text text-anchor="middle" x="4598" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4598" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4598" y="-558.08" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- expert11_comm_l3&#45;&gt;expert11_l3 -->
<g id="edge279" class="edge">
<title>expert11_comm_l3&#45;&gt;expert11_l3</title>
<path fill="none" stroke="black" d="M4589.17,-639.09C4590.4,-630.59 4591.71,-621.54 4592.94,-613.07"/>
<polygon fill="black" stroke="black" points="4596.41,-613.52 4594.38,-603.12 4589.48,-612.52 4596.41,-613.52"/>
</g>
<!-- expert11_return_l3 -->
<g id="node221" class="node">
<title>expert11_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="4612" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4612" y="-492.31" font-family="Arial" font-size="10.00">Expert 11 Return</text>
<text text-anchor="middle" x="4612" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4612" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4612" y="-459.31" font-family="Arial" font-size="10.00">GPU: 11</text>
</g>
<!-- expert11_l3&#45;&gt;expert11_return_l3 -->
<g id="edge280" class="edge">
<title>expert11_l3&#45;&gt;expert11_return_l3</title>
<path fill="none" stroke="black" d="M4601.64,-550.91C4602.77,-543.1 4604.05,-534.23 4605.32,-525.46"/>
<polygon fill="black" stroke="black" points="4608.83,-525.68 4606.8,-515.29 4601.9,-524.68 4608.83,-525.68"/>
</g>
<!-- expert11_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge281" class="edge">
<title>expert11_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M4513.77,-451.97C4496.9,-448.13 4479.5,-444.47 4463,-441.54 4300.39,-412.63 4116.04,-391.01 3971.41,-376.56"/>
<polygon fill="black" stroke="black" points="3971.36,-373.04 3961.06,-375.53 3970.67,-380 3971.36,-373.04"/>
</g>
<!-- expert12_l3 -->
<g id="node223" class="node">
<title>expert12_l3</title>
<polygon fill="lightcoral" stroke="black" points="4989,-603.08 4801,-603.08 4801,-551.08 4989,-551.08 4989,-603.08"/>
<text text-anchor="middle" x="4895" y="-591.08" font-family="Arial" font-size="10.00">Expert 12 MLP</text>
<text text-anchor="middle" x="4895" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4895" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4895" y="-558.08" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- expert12_comm_l3&#45;&gt;expert12_l3 -->
<g id="edge283" class="edge">
<title>expert12_comm_l3&#45;&gt;expert12_l3</title>
<path fill="none" stroke="black" d="M4886.17,-639.09C4887.4,-630.59 4888.71,-621.54 4889.94,-613.07"/>
<polygon fill="black" stroke="black" points="4893.41,-613.52 4891.38,-603.12 4886.48,-612.52 4893.41,-613.52"/>
</g>
<!-- expert12_return_l3 -->
<g id="node224" class="node">
<title>expert12_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="4910" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="4910" y="-492.31" font-family="Arial" font-size="10.00">Expert 12 Return</text>
<text text-anchor="middle" x="4910" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="4910" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="4910" y="-459.31" font-family="Arial" font-size="10.00">GPU: 12</text>
</g>
<!-- expert12_l3&#45;&gt;expert12_return_l3 -->
<g id="edge284" class="edge">
<title>expert12_l3&#45;&gt;expert12_return_l3</title>
<path fill="none" stroke="black" d="M4898.9,-550.91C4900.13,-543.01 4901.52,-534.04 4902.89,-525.18"/>
<polygon fill="black" stroke="black" points="4906.35,-525.7 4904.42,-515.29 4899.43,-524.63 4906.35,-525.7"/>
</g>
<!-- expert12_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge285" class="edge">
<title>expert12_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M4813.05,-451.78C4795.8,-447.88 4777.94,-444.26 4761,-441.54 4487.82,-397.62 4170.61,-375.17 3958.4,-364.18"/>
<polygon fill="black" stroke="black" points="3958.54,-360.69 3948.38,-363.67 3958.18,-367.68 3958.54,-360.69"/>
</g>
<!-- expert13_l3 -->
<g id="node226" class="node">
<title>expert13_l3</title>
<polygon fill="lightcoral" stroke="black" points="5287,-603.08 5099,-603.08 5099,-551.08 5287,-551.08 5287,-603.08"/>
<text text-anchor="middle" x="5193" y="-591.08" font-family="Arial" font-size="10.00">Expert 13 MLP</text>
<text text-anchor="middle" x="5193" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5193" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5193" y="-558.08" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- expert13_comm_l3&#45;&gt;expert13_l3 -->
<g id="edge287" class="edge">
<title>expert13_comm_l3&#45;&gt;expert13_l3</title>
<path fill="none" stroke="black" d="M5183.54,-639.09C5184.86,-630.59 5186.26,-621.54 5187.58,-613.07"/>
<polygon fill="black" stroke="black" points="5191.04,-613.54 5189.12,-603.12 5184.13,-612.47 5191.04,-613.54"/>
</g>
<!-- expert13_return_l3 -->
<g id="node227" class="node">
<title>expert13_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="5208" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="5208" y="-492.31" font-family="Arial" font-size="10.00">Expert 13 Return</text>
<text text-anchor="middle" x="5208" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5208" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="5208" y="-459.31" font-family="Arial" font-size="10.00">GPU: 13</text>
</g>
<!-- expert13_l3&#45;&gt;expert13_return_l3 -->
<g id="edge288" class="edge">
<title>expert13_l3&#45;&gt;expert13_return_l3</title>
<path fill="none" stroke="black" d="M5196.9,-550.91C5198.13,-543.01 5199.52,-534.04 5200.89,-525.18"/>
<polygon fill="black" stroke="black" points="5204.35,-525.7 5202.42,-515.29 5197.43,-524.63 5204.35,-525.7"/>
</g>
<!-- expert13_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge289" class="edge">
<title>expert13_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M5111.49,-451.61C5094.12,-447.71 5076.1,-444.13 5059,-441.54 4673.68,-383.23 4220.27,-363.97 3951.67,-357.63"/>
<polygon fill="black" stroke="black" points="3951.48,-354.12 3941.4,-357.39 3951.32,-361.12 3951.48,-354.12"/>
</g>
<!-- expert14_l3 -->
<g id="node229" class="node">
<title>expert14_l3</title>
<polygon fill="lightcoral" stroke="black" points="5585,-603.08 5397,-603.08 5397,-551.08 5585,-551.08 5585,-603.08"/>
<text text-anchor="middle" x="5491" y="-591.08" font-family="Arial" font-size="10.00">Expert 14 MLP</text>
<text text-anchor="middle" x="5491" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5491" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5491" y="-558.08" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- expert14_comm_l3&#45;&gt;expert14_l3 -->
<g id="edge291" class="edge">
<title>expert14_comm_l3&#45;&gt;expert14_l3</title>
<path fill="none" stroke="black" d="M5481.54,-639.09C5482.86,-630.59 5484.26,-621.54 5485.58,-613.07"/>
<polygon fill="black" stroke="black" points="5489.04,-613.54 5487.12,-603.12 5482.13,-612.47 5489.04,-613.54"/>
</g>
<!-- expert14_return_l3 -->
<g id="node230" class="node">
<title>expert14_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="5506" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="5506" y="-492.31" font-family="Arial" font-size="10.00">Expert 14 Return</text>
<text text-anchor="middle" x="5506" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5506" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="5506" y="-459.31" font-family="Arial" font-size="10.00">GPU: 14</text>
</g>
<!-- expert14_l3&#45;&gt;expert14_return_l3 -->
<g id="edge292" class="edge">
<title>expert14_l3&#45;&gt;expert14_return_l3</title>
<path fill="none" stroke="black" d="M5494.9,-550.91C5496.13,-543.01 5497.52,-534.04 5498.89,-525.18"/>
<polygon fill="black" stroke="black" points="5502.35,-525.7 5500.42,-515.29 5495.43,-524.63 5502.35,-525.7"/>
</g>
<!-- expert14_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge293" class="edge">
<title>expert14_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M5409.92,-451.53C5392.42,-447.61 5374.24,-444.05 5357,-441.54 5093.91,-403.3 4343.58,-374.59 3956.07,-361.82"/>
<polygon fill="black" stroke="black" points="3955.96,-358.32 3945.85,-361.49 3955.73,-365.32 3955.96,-358.32"/>
</g>
<!-- expert15_l3 -->
<g id="node232" class="node">
<title>expert15_l3</title>
<polygon fill="lightcoral" stroke="black" points="5883,-603.08 5695,-603.08 5695,-551.08 5883,-551.08 5883,-603.08"/>
<text text-anchor="middle" x="5789" y="-591.08" font-family="Arial" font-size="10.00">Expert 15 MLP</text>
<text text-anchor="middle" x="5789" y="-580.08" font-family="Arial" font-size="10.00">Input: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5789" y="-569.08" font-family="Arial" font-size="10.00">Output: [variable_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5789" y="-558.08" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- expert15_comm_l3&#45;&gt;expert15_l3 -->
<g id="edge295" class="edge">
<title>expert15_comm_l3&#45;&gt;expert15_l3</title>
<path fill="none" stroke="black" d="M5779.54,-639.09C5780.86,-630.59 5782.26,-621.54 5783.58,-613.07"/>
<polygon fill="black" stroke="black" points="5787.04,-613.54 5785.12,-603.12 5780.13,-612.47 5787.04,-613.54"/>
</g>
<!-- expert15_return_l3 -->
<g id="node233" class="node">
<title>expert15_return_l3</title>
<ellipse fill="lightgray" stroke="black" cx="5804" cy="-478.31" rx="140.01" ry="36.54"/>
<text text-anchor="middle" x="5804" y="-492.31" font-family="Arial" font-size="10.00">Expert 15 Return</text>
<text text-anchor="middle" x="5804" y="-481.31" font-family="Arial" font-size="10.00">Input: [processed_tokens, hidden=8192]</text>
<text text-anchor="middle" x="5804" y="-470.31" font-family="Arial" font-size="10.00">Output: [tokens back to original positions]</text>
<text text-anchor="middle" x="5804" y="-459.31" font-family="Arial" font-size="10.00">GPU: 15</text>
</g>
<!-- expert15_l3&#45;&gt;expert15_return_l3 -->
<g id="edge296" class="edge">
<title>expert15_l3&#45;&gt;expert15_return_l3</title>
<path fill="none" stroke="black" d="M5792.9,-550.91C5794.13,-543.01 5795.52,-534.04 5796.89,-525.18"/>
<polygon fill="black" stroke="black" points="5800.35,-525.7 5798.42,-515.29 5793.43,-524.63 5800.35,-525.7"/>
</g>
<!-- expert15_return_l3&#45;&gt;aggregate_l3 -->
<g id="edge297" class="edge">
<title>expert15_return_l3&#45;&gt;aggregate_l3</title>
<path fill="none" stroke="black" d="M5707.93,-451.41C5690.43,-447.51 5672.25,-443.97 5655,-441.54 5333.3,-396.12 4395.47,-369.73 3953.56,-359.5"/>
<polygon fill="black" stroke="black" points="3953.61,-356 3943.53,-359.27 3953.45,-363 3953.61,-356"/>
</g>
<!-- aggregate_l3&#45;&gt;res_add2_l3 -->
<g id="edge298" class="edge">
<title>aggregate_l3&#45;&gt;res_add2_l3</title>
<path fill="none" stroke="black" d="M3913.36,-331.28C4112.44,-309.61 4416.88,-276.47 4597.52,-256.81"/>
<polygon fill="black" stroke="black" points="4598.07,-260.27 4607.64,-255.71 4597.32,-253.31 4598.07,-260.27"/>
</g>
<!-- norm2_l3 -->
<g id="node236" class="node">
<title>norm2_l3</title>
<polygon fill="lightgreen" stroke="black" points="4880,-177.54 4614,-177.54 4614,-125.54 4880,-125.54 4880,-177.54"/>
<text text-anchor="middle" x="4747" y="-165.54" font-family="Arial" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="4747" y="-154.54" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4747" y="-143.54" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4747" y="-132.54" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- res_add2_l3&#45;&gt;norm2_l3 -->
<g id="edge300" class="edge">
<title>res_add2_l3&#45;&gt;norm2_l3</title>
<path fill="none" stroke="black" d="M4747,-213.2C4747,-205.24 4747,-196.3 4747,-187.78"/>
<polygon fill="black" stroke="black" points="4750.5,-187.7 4747,-177.7 4743.5,-187.7 4750.5,-187.7"/>
</g>
<!-- final_output -->
<g id="node237" class="node">
<title>final_output</title>
<ellipse fill="lightblue" stroke="black" cx="4747" cy="-52.77" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="4747" y="-66.77" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="4747" y="-55.77" font-family="Arial" font-size="10.00">Input: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4747" y="-44.77" font-family="Arial" font-size="10.00">Output: [batch_size=1024, seq_len=10000, hidden=8192]</text>
<text text-anchor="middle" x="4747" y="-33.77" font-family="Arial" font-size="10.00">GPU: all GPUs</text>
</g>
<!-- norm2_l3&#45;&gt;final_output -->
<g id="edge301" class="edge">
<title>norm2_l3&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M4747,-125.37C4747,-117.56 4747,-108.69 4747,-99.92"/>
<polygon fill="black" stroke="black" points="4750.5,-99.75 4747,-89.75 4743.5,-99.75 4750.5,-99.75"/>
</g>
</g>
</svg>
