<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Tensor_Parallel_Expert Pages: 1 -->
<svg width="2629pt" height="155pt"
 viewBox="0.00 0.00 2629.09 155.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 151)">
<title>Tensor_Parallel_Expert</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-151 2625.09,-151 2625.09,4 -4,4"/>
<text text-anchor="middle" x="1310.54" y="-7.8" font-family="Times,serif" font-size="14.00">Tensor Parallelism Within Expert (2&#45;way TP)</text>
<!-- tp_input -->
<g id="node1" class="node">
<title>tp_input</title>
<ellipse fill="lightgrey" stroke="black" cx="141.42" cy="-84.5" rx="141.34" ry="26.74"/>
<text text-anchor="middle" x="141.42" y="-88.3" font-family="Times,serif" font-size="14.00">Expert Input</text>
<text text-anchor="middle" x="141.42" y="-73.3" font-family="Times,serif" font-size="14.00">[bs=?, seq=?, dim=7168]</text>
</g>
<!-- tp_linear1_0 -->
<g id="node2" class="node">
<title>tp_linear1_0</title>
<polygon fill="lightblue" stroke="black" points="723.84,-147 318.84,-147 318.84,-94 723.84,-94 723.84,-147"/>
<text text-anchor="middle" x="521.34" y="-131.8" font-family="Times,serif" font-size="14.00">Linear 1 Col&#45;Parallel</text>
<text text-anchor="middle" x="521.34" y="-116.8" font-family="Times,serif" font-size="14.00">GPU: {expert_gpu}_0</text>
<text text-anchor="middle" x="521.34" y="-101.8" font-family="Times,serif" font-size="14.00">[bs=?, seq=?, dim=7168] → [bs=?, seq=?, dim=1024]</text>
</g>
<!-- tp_input&#45;&gt;tp_linear1_0 -->
<g id="edge1" class="edge">
<title>tp_input&#45;&gt;tp_linear1_0</title>
<path fill="none" stroke="black" d="M245.74,-102.69C245.74,-102.69 308.76,-102.69 308.76,-102.69"/>
<polygon fill="black" stroke="black" points="308.76,-106.19 318.76,-102.69 308.76,-99.19 308.76,-106.19"/>
</g>
<!-- tp_linear1_1 -->
<g id="node3" class="node">
<title>tp_linear1_1</title>
<polygon fill="lightblue" stroke="black" points="723.84,-76 318.84,-76 318.84,-23 723.84,-23 723.84,-76"/>
<text text-anchor="middle" x="521.34" y="-60.8" font-family="Times,serif" font-size="14.00">Linear 1 Col&#45;Parallel</text>
<text text-anchor="middle" x="521.34" y="-45.8" font-family="Times,serif" font-size="14.00">GPU: {expert_gpu}_1</text>
<text text-anchor="middle" x="521.34" y="-30.8" font-family="Times,serif" font-size="14.00">[bs=?, seq=?, dim=7168] → [bs=?, seq=?, dim=1024]</text>
</g>
<!-- tp_input&#45;&gt;tp_linear1_1 -->
<g id="edge2" class="edge">
<title>tp_input&#45;&gt;tp_linear1_1</title>
<path fill="none" stroke="black" d="M248.01,-66.81C248.01,-66.81 308.58,-66.81 308.58,-66.81"/>
<polygon fill="black" stroke="black" points="308.58,-70.32 318.58,-66.81 308.58,-63.32 308.58,-70.32"/>
</g>
<!-- tp_concat -->
<g id="node4" class="node">
<title>tp_concat</title>
<polygon fill="orange" stroke="black" points="1174.39,-137.5 844.78,-137.5 759.99,-31.5 1089.6,-31.5 1174.39,-137.5"/>
<text text-anchor="middle" x="967.19" y="-95.8" font-family="Times,serif" font-size="14.00">Concatenation</text>
<text text-anchor="middle" x="967.19" y="-80.8" font-family="Times,serif" font-size="14.00">GPU: Both</text>
<text text-anchor="middle" x="967.19" y="-65.8" font-family="Times,serif" font-size="14.00">[bs=?, seq=?, dim=2048]</text>
</g>
<!-- tp_linear1_0&#45;&gt;tp_concat -->
<g id="edge3" class="edge">
<title>tp_linear1_0&#45;&gt;tp_concat</title>
<path fill="none" stroke="black" d="M724.05,-115.75C724.05,-115.75 817.15,-115.75 817.15,-115.75"/>
<polygon fill="black" stroke="black" points="817.15,-119.25 827.15,-115.75 817.15,-112.25 817.15,-119.25"/>
</g>
<!-- tp_linear1_1&#45;&gt;tp_concat -->
<g id="edge4" class="edge">
<title>tp_linear1_1&#45;&gt;tp_concat</title>
<path fill="none" stroke="black" d="M724.05,-53.75C724.05,-53.75 767.59,-53.75 767.59,-53.75"/>
<polygon fill="black" stroke="black" points="767.59,-57.25 777.59,-53.75 767.59,-50.25 767.59,-57.25"/>
</g>
<!-- tp_gelu -->
<g id="node5" class="node">
<title>tp_gelu</title>
<polygon fill="lightblue" stroke="black" points="1410.54,-111 1210.54,-111 1210.54,-58 1410.54,-58 1410.54,-111"/>
<text text-anchor="middle" x="1310.54" y="-95.8" font-family="Times,serif" font-size="14.00">GELU Activation</text>
<text text-anchor="middle" x="1310.54" y="-80.8" font-family="Times,serif" font-size="14.00">GPU: Both</text>
<text text-anchor="middle" x="1310.54" y="-65.8" font-family="Times,serif" font-size="14.00">[bs=?, seq=?, dim=2048]</text>
</g>
<!-- tp_concat&#45;&gt;tp_gelu -->
<g id="edge5" class="edge">
<title>tp_concat&#45;&gt;tp_gelu</title>
<path fill="none" stroke="black" d="M1132.08,-84.5C1132.08,-84.5 1200.12,-84.5 1200.12,-84.5"/>
<polygon fill="black" stroke="black" points="1200.12,-88 1210.12,-84.5 1200.12,-81 1200.12,-88"/>
</g>
<!-- tp_linear2_0 -->
<g id="node6" class="node">
<title>tp_linear2_0</title>
<polygon fill="lightblue" stroke="black" points="1851.54,-147 1446.54,-147 1446.54,-94 1851.54,-94 1851.54,-147"/>
<text text-anchor="middle" x="1649.04" y="-131.8" font-family="Times,serif" font-size="14.00">Linear 2 Row&#45;Parallel</text>
<text text-anchor="middle" x="1649.04" y="-116.8" font-family="Times,serif" font-size="14.00">GPU: {expert_gpu}_0</text>
<text text-anchor="middle" x="1649.04" y="-101.8" font-family="Times,serif" font-size="14.00">[bs=?, seq=?, dim=1024] → [bs=?, seq=?, dim=7168]</text>
</g>
<!-- tp_gelu&#45;&gt;tp_linear2_0 -->
<g id="edge6" class="edge">
<title>tp_gelu&#45;&gt;tp_linear2_0</title>
<path fill="none" stroke="black" d="M1410.73,-102.5C1410.73,-102.5 1436.51,-102.5 1436.51,-102.5"/>
<polygon fill="black" stroke="black" points="1436.51,-106 1446.51,-102.5 1436.51,-99 1436.51,-106"/>
</g>
<!-- tp_linear2_1 -->
<g id="node7" class="node">
<title>tp_linear2_1</title>
<polygon fill="lightblue" stroke="black" points="1851.54,-76 1446.54,-76 1446.54,-23 1851.54,-23 1851.54,-76"/>
<text text-anchor="middle" x="1649.04" y="-60.8" font-family="Times,serif" font-size="14.00">Linear 2 Row&#45;Parallel</text>
<text text-anchor="middle" x="1649.04" y="-45.8" font-family="Times,serif" font-size="14.00">GPU: {expert_gpu}_1</text>
<text text-anchor="middle" x="1649.04" y="-30.8" font-family="Times,serif" font-size="14.00">[bs=?, seq=?, dim=1024] → [bs=?, seq=?, dim=7168]</text>
</g>
<!-- tp_gelu&#45;&gt;tp_linear2_1 -->
<g id="edge7" class="edge">
<title>tp_gelu&#45;&gt;tp_linear2_1</title>
<path fill="none" stroke="black" d="M1410.73,-67C1410.73,-67 1436.51,-67 1436.51,-67"/>
<polygon fill="black" stroke="black" points="1436.51,-70.5 1446.51,-67 1436.51,-63.5 1436.51,-70.5"/>
</g>
<!-- tp_allreduce -->
<g id="node8" class="node">
<title>tp_allreduce</title>
<polygon fill="orange" stroke="black" points="2302.1,-137.5 1972.48,-137.5 1887.69,-31.5 2217.3,-31.5 2302.1,-137.5"/>
<text text-anchor="middle" x="2094.89" y="-95.8" font-family="Times,serif" font-size="14.00">All&#45;Reduce Sum</text>
<text text-anchor="middle" x="2094.89" y="-80.8" font-family="Times,serif" font-size="14.00">GPU: Both</text>
<text text-anchor="middle" x="2094.89" y="-65.8" font-family="Times,serif" font-size="14.00">[bs=?, seq=?, dim=7168]</text>
</g>
<!-- tp_linear2_0&#45;&gt;tp_allreduce -->
<g id="edge8" class="edge">
<title>tp_linear2_0&#45;&gt;tp_allreduce</title>
<path fill="none" stroke="black" d="M1851.75,-115.75C1851.75,-115.75 1944.85,-115.75 1944.85,-115.75"/>
<polygon fill="black" stroke="black" points="1944.85,-119.25 1954.85,-115.75 1944.85,-112.25 1944.85,-119.25"/>
</g>
<!-- tp_linear2_1&#45;&gt;tp_allreduce -->
<g id="edge9" class="edge">
<title>tp_linear2_1&#45;&gt;tp_allreduce</title>
<path fill="none" stroke="black" d="M1851.75,-53.75C1851.75,-53.75 1895.29,-53.75 1895.29,-53.75"/>
<polygon fill="black" stroke="black" points="1895.29,-57.25 1905.29,-53.75 1895.29,-50.25 1895.29,-57.25"/>
</g>
<!-- tp_output -->
<g id="node9" class="node">
<title>tp_output</title>
<ellipse fill="lightgrey" stroke="black" cx="2479.67" cy="-84.5" rx="141.34" ry="26.74"/>
<text text-anchor="middle" x="2479.67" y="-88.3" font-family="Times,serif" font-size="14.00">Expert Output</text>
<text text-anchor="middle" x="2479.67" y="-73.3" font-family="Times,serif" font-size="14.00">[bs=?, seq=?, dim=7168]</text>
</g>
<!-- tp_allreduce&#45;&gt;tp_output -->
<g id="edge10" class="edge">
<title>tp_allreduce&#45;&gt;tp_output</title>
<path fill="none" stroke="black" d="M2259.75,-84.5C2259.75,-84.5 2328.17,-84.5 2328.17,-84.5"/>
<polygon fill="black" stroke="black" points="2328.17,-88 2338.17,-84.5 2328.17,-81 2328.17,-88"/>
</g>
</g>
</svg>
