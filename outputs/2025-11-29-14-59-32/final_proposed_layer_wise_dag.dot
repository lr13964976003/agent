// Corrected Proposed Layer-wise DAG (Fixed Connections)
digraph proposed_layer_wise_fixed {
    bgcolor=white fontname=Arial rankdir=TB
    node [fontname=Arial fontsize=10]
    node [fillcolor=lightblue shape=rectangle style=filled]
    
    // Input node
    input [label="Input\nBatch: 128\nSeq: 10000\nHidden: 4096" fillcolor=lightgreen shape=parallelogram]
    output [label="Output\nBatch: 128\nSeq: 10000\nHidden: 4096" fillcolor=lightgreen shape=parallelogram]
    
    layer_0_input_dist [label="Layer 0\nInput Distribution\nGPU 0" fillcolor=lightyellow shape=parallelogram]
    layer_0_qkv_gpu0 [label="Layer 0 QKV Proj\nGPU 0\n[4096→12288]" fillcolor=lightblue]
    layer_0_attention [label="Layer 0\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_0_attn_out_gpu0 [label="Layer 0 Attn Out\nGPU 0\n[4096→4096]" fillcolor=lightblue]
    layer_0_residual1 [label="Layer 0\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_0_ln1 [label="Layer 0\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_0_mlp_fc1_gpu0 [label="Layer 0 MLP FC1\nGPU 0\n[4096→16384]" fillcolor=lightblue]
    layer_0_gelu [label="Layer 0\nGELU Activation" fillcolor=lightblue]
    layer_0_mlp_fc2_gpu0 [label="Layer 0 MLP FC2\nGPU 0\n[16384→4096]" fillcolor=lightblue]
    layer_0_residual2 [label="Layer 0\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_0_ln2 [label="Layer 0\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_0_output_dist [label="Layer 0\nOutput Distribution\nGPU 0→0" fillcolor=lightyellow shape=parallelogram]
    layer_0_pipeline_send [label="Layer 0→1\nPipeline Send\nGPU 0→0" fillcolor=red shape=ellipse]
    layer_1_pipeline_recv [label="Layer 1\nPipeline Recv\nGPU 0" fillcolor=red shape=ellipse]
    layer_1_input_dist [label="Layer 1\nInput Distribution\nGPU 0" fillcolor=lightyellow shape=parallelogram]
    layer_1_qkv_gpu0 [label="Layer 1 QKV Proj\nGPU 0\n[4096→12288]" fillcolor=lightblue]
    layer_1_attention [label="Layer 1\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_1_attn_out_gpu0 [label="Layer 1 Attn Out\nGPU 0\n[4096→4096]" fillcolor=lightblue]
    layer_1_residual1 [label="Layer 1\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_1_ln1 [label="Layer 1\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_1_mlp_fc1_gpu0 [label="Layer 1 MLP FC1\nGPU 0\n[4096→16384]" fillcolor=lightblue]
    layer_1_gelu [label="Layer 1\nGELU Activation" fillcolor=lightblue]
    layer_1_mlp_fc2_gpu0 [label="Layer 1 MLP FC2\nGPU 0\n[16384→4096]" fillcolor=lightblue]
    layer_1_residual2 [label="Layer 1\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_1_ln2 [label="Layer 1\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_1_output_dist [label="Layer 1\nOutput Distribution\nGPU 0→1" fillcolor=lightyellow shape=parallelogram]
    layer_1_pipeline_send [label="Layer 1→2\nPipeline Send\nGPU 0→1" fillcolor=red shape=ellipse]
    layer_2_pipeline_recv [label="Layer 2\nPipeline Recv\nGPU 1" fillcolor=red shape=ellipse]
    layer_2_input_dist [label="Layer 2\nInput Distribution\nGPU 1" fillcolor=lightyellow shape=parallelogram]
    layer_2_qkv_gpu1 [label="Layer 2 QKV Proj\nGPU 1\n[4096→12288]" fillcolor=lightblue]
    layer_2_attention [label="Layer 2\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_2_attn_out_gpu1 [label="Layer 2 Attn Out\nGPU 1\n[4096→4096]" fillcolor=lightblue]
    layer_2_residual1 [label="Layer 2\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_2_ln1 [label="Layer 2\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_2_mlp_fc1_gpu1 [label="Layer 2 MLP FC1\nGPU 1\n[4096→16384]" fillcolor=lightblue]
    layer_2_gelu [label="Layer 2\nGELU Activation" fillcolor=lightblue]
    layer_2_mlp_fc2_gpu1 [label="Layer 2 MLP FC2\nGPU 1\n[16384→4096]" fillcolor=lightblue]
    layer_2_residual2 [label="Layer 2\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_2_ln2 [label="Layer 2\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_2_output_dist [label="Layer 2\nOutput Distribution\nGPU 1→1" fillcolor=lightyellow shape=parallelogram]
    layer_2_pipeline_send [label="Layer 2→3\nPipeline Send\nGPU 1→1" fillcolor=red shape=ellipse]
    layer_3_pipeline_recv [label="Layer 3\nPipeline Recv\nGPU 1" fillcolor=red shape=ellipse]
    layer_3_input_dist [label="Layer 3\nInput Distribution\nGPU 1" fillcolor=lightyellow shape=parallelogram]
    layer_3_qkv_gpu1 [label="Layer 3 QKV Proj\nGPU 1\n[4096→12288]" fillcolor=lightblue]
    layer_3_attention [label="Layer 3\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_3_attn_out_gpu1 [label="Layer 3 Attn Out\nGPU 1\n[4096→4096]" fillcolor=lightblue]
    layer_3_residual1 [label="Layer 3\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_3_ln1 [label="Layer 3\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_3_mlp_fc1_gpu1 [label="Layer 3 MLP FC1\nGPU 1\n[4096→16384]" fillcolor=lightblue]
    layer_3_gelu [label="Layer 3\nGELU Activation" fillcolor=lightblue]
    layer_3_mlp_fc2_gpu1 [label="Layer 3 MLP FC2\nGPU 1\n[16384→4096]" fillcolor=lightblue]
    layer_3_residual2 [label="Layer 3\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_3_ln2 [label="Layer 3\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_3_output_dist [label="Layer 3\nOutput Distribution\nGPU 1→2" fillcolor=lightyellow shape=parallelogram]
    layer_3_pipeline_send [label="Layer 3→4\nPipeline Send\nGPU 1→2" fillcolor=red shape=ellipse]
    layer_4_pipeline_recv [label="Layer 4\nPipeline Recv\nGPU 2" fillcolor=red shape=ellipse]
    layer_4_input_dist [label="Layer 4\nInput Distribution\nGPU 2" fillcolor=lightyellow shape=parallelogram]
    layer_4_qkv_gpu2 [label="Layer 4 QKV Proj\nGPU 2\n[4096→12288]" fillcolor=lightblue]
    layer_4_attention [label="Layer 4\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_4_attn_out_gpu2 [label="Layer 4 Attn Out\nGPU 2\n[4096→4096]" fillcolor=lightblue]
    layer_4_residual1 [label="Layer 4\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_4_ln1 [label="Layer 4\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_4_mlp_fc1_gpu2 [label="Layer 4 MLP FC1\nGPU 2\n[4096→16384]" fillcolor=lightblue]
    layer_4_gelu [label="Layer 4\nGELU Activation" fillcolor=lightblue]
    layer_4_mlp_fc2_gpu2 [label="Layer 4 MLP FC2\nGPU 2\n[16384→4096]" fillcolor=lightblue]
    layer_4_residual2 [label="Layer 4\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_4_ln2 [label="Layer 4\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_4_output_dist [label="Layer 4\nOutput Distribution\nGPU 2→2" fillcolor=lightyellow shape=parallelogram]
    layer_4_pipeline_send [label="Layer 4→5\nPipeline Send\nGPU 2→2" fillcolor=red shape=ellipse]
    layer_5_pipeline_recv [label="Layer 5\nPipeline Recv\nGPU 2" fillcolor=red shape=ellipse]
    layer_5_input_dist [label="Layer 5\nInput Distribution\nGPU 2" fillcolor=lightyellow shape=parallelogram]
    layer_5_qkv_gpu2 [label="Layer 5 QKV Proj\nGPU 2\n[4096→12288]" fillcolor=lightblue]
    layer_5_attention [label="Layer 5\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_5_attn_out_gpu2 [label="Layer 5 Attn Out\nGPU 2\n[4096→4096]" fillcolor=lightblue]
    layer_5_residual1 [label="Layer 5\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_5_ln1 [label="Layer 5\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_5_mlp_fc1_gpu2 [label="Layer 5 MLP FC1\nGPU 2\n[4096→16384]" fillcolor=lightblue]
    layer_5_gelu [label="Layer 5\nGELU Activation" fillcolor=lightblue]
    layer_5_mlp_fc2_gpu2 [label="Layer 5 MLP FC2\nGPU 2\n[16384→4096]" fillcolor=lightblue]
    layer_5_residual2 [label="Layer 5\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_5_ln2 [label="Layer 5\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_5_output_dist [label="Layer 5\nOutput Distribution\nGPU 2→3" fillcolor=lightyellow shape=parallelogram]
    layer_5_pipeline_send [label="Layer 5→6\nPipeline Send\nGPU 2→3" fillcolor=red shape=ellipse]
    layer_6_pipeline_recv [label="Layer 6\nPipeline Recv\nGPU 3" fillcolor=red shape=ellipse]
    layer_6_input_dist [label="Layer 6\nInput Distribution\nGPU 3" fillcolor=lightyellow shape=parallelogram]
    layer_6_qkv_gpu3 [label="Layer 6 QKV Proj\nGPU 3\n[4096→12288]" fillcolor=lightblue]
    layer_6_attention [label="Layer 6\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_6_attn_out_gpu3 [label="Layer 6 Attn Out\nGPU 3\n[4096→4096]" fillcolor=lightblue]
    layer_6_residual1 [label="Layer 6\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_6_ln1 [label="Layer 6\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_6_mlp_fc1_gpu3 [label="Layer 6 MLP FC1\nGPU 3\n[4096→16384]" fillcolor=lightblue]
    layer_6_gelu [label="Layer 6\nGELU Activation" fillcolor=lightblue]
    layer_6_mlp_fc2_gpu3 [label="Layer 6 MLP FC2\nGPU 3\n[16384→4096]" fillcolor=lightblue]
    layer_6_residual2 [label="Layer 6\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_6_ln2 [label="Layer 6\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_6_output_dist [label="Layer 6\nOutput Distribution\nGPU 3→3" fillcolor=lightyellow shape=parallelogram]
    layer_6_pipeline_send [label="Layer 6→7\nPipeline Send\nGPU 3→3" fillcolor=red shape=ellipse]
    layer_7_pipeline_recv [label="Layer 7\nPipeline Recv\nGPU 3" fillcolor=red shape=ellipse]
    layer_7_input_dist [label="Layer 7\nInput Distribution\nGPU 3" fillcolor=lightyellow shape=parallelogram]
    layer_7_qkv_gpu3 [label="Layer 7 QKV Proj\nGPU 3\n[4096→12288]" fillcolor=lightblue]
    layer_7_attention [label="Layer 7\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_7_attn_out_gpu3 [label="Layer 7 Attn Out\nGPU 3\n[4096→4096]" fillcolor=lightblue]
    layer_7_residual1 [label="Layer 7\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_7_ln1 [label="Layer 7\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_7_mlp_fc1_gpu3 [label="Layer 7 MLP FC1\nGPU 3\n[4096→16384]" fillcolor=lightblue]
    layer_7_gelu [label="Layer 7\nGELU Activation" fillcolor=lightblue]
    layer_7_mlp_fc2_gpu3 [label="Layer 7 MLP FC2\nGPU 3\n[16384→4096]" fillcolor=lightblue]
    layer_7_residual2 [label="Layer 7\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_7_ln2 [label="Layer 7\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_7_output_dist [label="Layer 7\nOutput Distribution\nGPU 3→4" fillcolor=lightyellow shape=parallelogram]
    layer_7_pipeline_send [label="Layer 7→8\nPipeline Send\nGPU 3→4" fillcolor=red shape=ellipse]
    layer_8_pipeline_recv [label="Layer 8\nPipeline Recv\nGPU 4" fillcolor=red shape=ellipse]
    layer_8_input_dist [label="Layer 8\nInput Distribution\nGPU 4" fillcolor=lightyellow shape=parallelogram]
    layer_8_qkv_gpu4 [label="Layer 8 QKV Proj\nGPU 4\n[4096→12288]" fillcolor=lightblue]
    layer_8_attention [label="Layer 8\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_8_attn_out_gpu4 [label="Layer 8 Attn Out\nGPU 4\n[4096→4096]" fillcolor=lightblue]
    layer_8_residual1 [label="Layer 8\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_8_ln1 [label="Layer 8\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_8_mlp_fc1_gpu4 [label="Layer 8 MLP FC1\nGPU 4\n[4096→16384]" fillcolor=lightblue]
    layer_8_gelu [label="Layer 8\nGELU Activation" fillcolor=lightblue]
    layer_8_mlp_fc2_gpu4 [label="Layer 8 MLP FC2\nGPU 4\n[16384→4096]" fillcolor=lightblue]
    layer_8_residual2 [label="Layer 8\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_8_ln2 [label="Layer 8\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_8_output_dist [label="Layer 8\nOutput Distribution\nGPU 4→4" fillcolor=lightyellow shape=parallelogram]
    layer_8_pipeline_send [label="Layer 8→9\nPipeline Send\nGPU 4→4" fillcolor=red shape=ellipse]
    layer_9_pipeline_recv [label="Layer 9\nPipeline Recv\nGPU 4" fillcolor=red shape=ellipse]
    layer_9_input_dist [label="Layer 9\nInput Distribution\nGPU 4" fillcolor=lightyellow shape=parallelogram]
    layer_9_qkv_gpu4 [label="Layer 9 QKV Proj\nGPU 4\n[4096→12288]" fillcolor=lightblue]
    layer_9_attention [label="Layer 9\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_9_attn_out_gpu4 [label="Layer 9 Attn Out\nGPU 4\n[4096→4096]" fillcolor=lightblue]
    layer_9_residual1 [label="Layer 9\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_9_ln1 [label="Layer 9\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_9_mlp_fc1_gpu4 [label="Layer 9 MLP FC1\nGPU 4\n[4096→16384]" fillcolor=lightblue]
    layer_9_gelu [label="Layer 9\nGELU Activation" fillcolor=lightblue]
    layer_9_mlp_fc2_gpu4 [label="Layer 9 MLP FC2\nGPU 4\n[16384→4096]" fillcolor=lightblue]
    layer_9_residual2 [label="Layer 9\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_9_ln2 [label="Layer 9\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_9_output_dist [label="Layer 9\nOutput Distribution\nGPU 4→5" fillcolor=lightyellow shape=parallelogram]
    layer_9_pipeline_send [label="Layer 9→10\nPipeline Send\nGPU 4→5" fillcolor=red shape=ellipse]
    layer_10_pipeline_recv [label="Layer 10\nPipeline Recv\nGPU 5" fillcolor=red shape=ellipse]
    layer_10_input_dist [label="Layer 10\nInput Distribution\nGPU 5" fillcolor=lightyellow shape=parallelogram]
    layer_10_qkv_gpu5 [label="Layer 10 QKV Proj\nGPU 5\n[4096→12288]" fillcolor=lightblue]
    layer_10_attention [label="Layer 10\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_10_attn_out_gpu5 [label="Layer 10 Attn Out\nGPU 5\n[4096→4096]" fillcolor=lightblue]
    layer_10_residual1 [label="Layer 10\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_10_ln1 [label="Layer 10\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_10_mlp_fc1_gpu5 [label="Layer 10 MLP FC1\nGPU 5\n[4096→16384]" fillcolor=lightblue]
    layer_10_gelu [label="Layer 10\nGELU Activation" fillcolor=lightblue]
    layer_10_mlp_fc2_gpu5 [label="Layer 10 MLP FC2\nGPU 5\n[16384→4096]" fillcolor=lightblue]
    layer_10_residual2 [label="Layer 10\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_10_ln2 [label="Layer 10\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_10_output_dist [label="Layer 10\nOutput Distribution\nGPU 5→5" fillcolor=lightyellow shape=parallelogram]
    layer_10_pipeline_send [label="Layer 10→11\nPipeline Send\nGPU 5→5" fillcolor=red shape=ellipse]
    layer_11_pipeline_recv [label="Layer 11\nPipeline Recv\nGPU 5" fillcolor=red shape=ellipse]
    layer_11_input_dist [label="Layer 11\nInput Distribution\nGPU 5" fillcolor=lightyellow shape=parallelogram]
    layer_11_qkv_gpu5 [label="Layer 11 QKV Proj\nGPU 5\n[4096→12288]" fillcolor=lightblue]
    layer_11_attention [label="Layer 11\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_11_attn_out_gpu5 [label="Layer 11 Attn Out\nGPU 5\n[4096→4096]" fillcolor=lightblue]
    layer_11_residual1 [label="Layer 11\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_11_ln1 [label="Layer 11\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_11_mlp_fc1_gpu5 [label="Layer 11 MLP FC1\nGPU 5\n[4096→16384]" fillcolor=lightblue]
    layer_11_gelu [label="Layer 11\nGELU Activation" fillcolor=lightblue]
    layer_11_mlp_fc2_gpu5 [label="Layer 11 MLP FC2\nGPU 5\n[16384→4096]" fillcolor=lightblue]
    layer_11_residual2 [label="Layer 11\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_11_ln2 [label="Layer 11\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_11_output_dist [label="Layer 11\nOutput Distribution\nGPU 5→6" fillcolor=lightyellow shape=parallelogram]
    layer_11_pipeline_send [label="Layer 11→12\nPipeline Send\nGPU 5→6" fillcolor=red shape=ellipse]
    layer_12_pipeline_recv [label="Layer 12\nPipeline Recv\nGPU 6" fillcolor=red shape=ellipse]
    layer_12_input_dist [label="Layer 12\nInput Distribution\nGPU 6" fillcolor=lightyellow shape=parallelogram]
    layer_12_qkv_gpu6 [label="Layer 12 QKV Proj\nGPU 6\n[4096→12288]" fillcolor=lightblue]
    layer_12_attention [label="Layer 12\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_12_attn_out_gpu6 [label="Layer 12 Attn Out\nGPU 6\n[4096→4096]" fillcolor=lightblue]
    layer_12_residual1 [label="Layer 12\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_12_ln1 [label="Layer 12\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_12_mlp_fc1_gpu6 [label="Layer 12 MLP FC1\nGPU 6\n[4096→16384]" fillcolor=lightblue]
    layer_12_gelu [label="Layer 12\nGELU Activation" fillcolor=lightblue]
    layer_12_mlp_fc2_gpu6 [label="Layer 12 MLP FC2\nGPU 6\n[16384→4096]" fillcolor=lightblue]
    layer_12_residual2 [label="Layer 12\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_12_ln2 [label="Layer 12\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_12_output_dist [label="Layer 12\nOutput Distribution\nGPU 6→6" fillcolor=lightyellow shape=parallelogram]
    layer_12_pipeline_send [label="Layer 12→13\nPipeline Send\nGPU 6→6" fillcolor=red shape=ellipse]
    layer_13_pipeline_recv [label="Layer 13\nPipeline Recv\nGPU 6" fillcolor=red shape=ellipse]
    layer_13_input_dist [label="Layer 13\nInput Distribution\nGPU 6" fillcolor=lightyellow shape=parallelogram]
    layer_13_qkv_gpu6 [label="Layer 13 QKV Proj\nGPU 6\n[4096→12288]" fillcolor=lightblue]
    layer_13_attention [label="Layer 13\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_13_attn_out_gpu6 [label="Layer 13 Attn Out\nGPU 6\n[4096→4096]" fillcolor=lightblue]
    layer_13_residual1 [label="Layer 13\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_13_ln1 [label="Layer 13\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_13_mlp_fc1_gpu6 [label="Layer 13 MLP FC1\nGPU 6\n[4096→16384]" fillcolor=lightblue]
    layer_13_gelu [label="Layer 13\nGELU Activation" fillcolor=lightblue]
    layer_13_mlp_fc2_gpu6 [label="Layer 13 MLP FC2\nGPU 6\n[16384→4096]" fillcolor=lightblue]
    layer_13_residual2 [label="Layer 13\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_13_ln2 [label="Layer 13\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_13_output_dist [label="Layer 13\nOutput Distribution\nGPU 6→7" fillcolor=lightyellow shape=parallelogram]
    layer_13_pipeline_send [label="Layer 13→14\nPipeline Send\nGPU 6→7" fillcolor=red shape=ellipse]
    layer_14_pipeline_recv [label="Layer 14\nPipeline Recv\nGPU 7" fillcolor=red shape=ellipse]
    layer_14_input_dist [label="Layer 14\nInput Distribution\nGPU 7" fillcolor=lightyellow shape=parallelogram]
    layer_14_qkv_gpu7 [label="Layer 14 QKV Proj\nGPU 7\n[4096→12288]" fillcolor=lightblue]
    layer_14_attention [label="Layer 14\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_14_attn_out_gpu7 [label="Layer 14 Attn Out\nGPU 7\n[4096→4096]" fillcolor=lightblue]
    layer_14_residual1 [label="Layer 14\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_14_ln1 [label="Layer 14\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_14_mlp_fc1_gpu7 [label="Layer 14 MLP FC1\nGPU 7\n[4096→16384]" fillcolor=lightblue]
    layer_14_gelu [label="Layer 14\nGELU Activation" fillcolor=lightblue]
    layer_14_mlp_fc2_gpu7 [label="Layer 14 MLP FC2\nGPU 7\n[16384→4096]" fillcolor=lightblue]
    layer_14_residual2 [label="Layer 14\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_14_ln2 [label="Layer 14\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    layer_14_output_dist [label="Layer 14\nOutput Distribution\nGPU 7→7" fillcolor=lightyellow shape=parallelogram]
    layer_14_pipeline_send [label="Layer 14→15\nPipeline Send\nGPU 7→7" fillcolor=red shape=ellipse]
    layer_15_pipeline_recv [label="Layer 15\nPipeline Recv\nGPU 7" fillcolor=red shape=ellipse]
    layer_15_input_dist [label="Layer 15\nInput Distribution\nGPU 7" fillcolor=lightyellow shape=parallelogram]
    layer_15_qkv_gpu7 [label="Layer 15 QKV Proj\nGPU 7\n[4096→12288]" fillcolor=lightblue]
    layer_15_attention [label="Layer 15\nAttention\n32×128 dim\nSoftmax" fillcolor=lightblue]
    layer_15_attn_out_gpu7 [label="Layer 15 Attn Out\nGPU 7\n[4096→4096]" fillcolor=lightblue]
    layer_15_residual1 [label="Layer 15\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_15_ln1 [label="Layer 15\nLayerNorm 1\nγ,β: 4096" fillcolor=lightblue]
    layer_15_mlp_fc1_gpu7 [label="Layer 15 MLP FC1\nGPU 7\n[4096→16384]" fillcolor=lightblue]
    layer_15_gelu [label="Layer 15\nGELU Activation" fillcolor=lightblue]
    layer_15_mlp_fc2_gpu7 [label="Layer 15 MLP FC2\nGPU 7\n[16384→4096]" fillcolor=lightblue]
    layer_15_residual2 [label="Layer 15\nResidual Add" fillcolor=lightyellow shape=parallelogram]
    layer_15_ln2 [label="Layer 15\nLayerNorm 2\nγ,β: 4096" fillcolor=lightblue]
    // Connections - Fixed for proper layer-wise execution
    input -> layer_0_input_dist
    layer_0_input_dist -> layer_0_qkv_gpu0
    layer_0_qkv_gpu0 -> layer_0_attention
    layer_0_attention -> layer_0_attn_out_gpu0
    layer_0_attn_out_gpu0 -> layer_0_residual1
    layer_0_input_dist -> layer_0_residual1
    layer_0_residual1 -> layer_0_ln1
    layer_0_ln1 -> layer_0_mlp_fc1_gpu0
    layer_0_mlp_fc1_gpu0 -> layer_0_gelu
    layer_0_gelu -> layer_0_mlp_fc2_gpu0
    layer_0_mlp_fc2_gpu0 -> layer_0_residual2
    layer_0_residual1 -> layer_0_residual2
    layer_0_residual2 -> layer_0_ln2
    layer_0_ln2 -> layer_0_output_dist
    layer_0_output_dist -> layer_0_pipeline_send
    layer_0_pipeline_send -> layer_1_pipeline_recv
    layer_1_pipeline_recv -> layer_1_input_dist
    layer_1_input_dist -> layer_1_qkv_gpu0
    layer_1_qkv_gpu0 -> layer_1_attention
    layer_1_attention -> layer_1_attn_out_gpu0
    layer_1_attn_out_gpu0 -> layer_1_residual1
    layer_1_input_dist -> layer_1_residual1
    layer_1_residual1 -> layer_1_ln1
    layer_1_ln1 -> layer_1_mlp_fc1_gpu0
    layer_1_mlp_fc1_gpu0 -> layer_1_gelu
    layer_1_gelu -> layer_1_mlp_fc2_gpu0
    layer_1_mlp_fc2_gpu0 -> layer_1_residual2
    layer_1_residual1 -> layer_1_residual2
    layer_1_residual2 -> layer_1_ln2
    layer_1_ln2 -> layer_1_output_dist
    layer_1_output_dist -> layer_1_pipeline_send
    layer_1_pipeline_send -> layer_2_pipeline_recv
    layer_2_pipeline_recv -> layer_2_input_dist
    layer_2_input_dist -> layer_2_qkv_gpu1
    layer_2_qkv_gpu1 -> layer_2_attention
    layer_2_attention -> layer_2_attn_out_gpu1
    layer_2_attn_out_gpu1 -> layer_2_residual1
    layer_2_input_dist -> layer_2_residual1
    layer_2_residual1 -> layer_2_ln1
    layer_2_ln1 -> layer_2_mlp_fc1_gpu1
    layer_2_mlp_fc1_gpu1 -> layer_2_gelu
    layer_2_gelu -> layer_2_mlp_fc2_gpu1
    layer_2_mlp_fc2_gpu1 -> layer_2_residual2
    layer_2_residual1 -> layer_2_residual2
    layer_2_residual2 -> layer_2_ln2
    layer_2_ln2 -> layer_2_output_dist
    layer_2_output_dist -> layer_2_pipeline_send
    layer_2_pipeline_send -> layer_3_pipeline_recv
    layer_3_pipeline_recv -> layer_3_input_dist
    layer_3_input_dist -> layer_3_qkv_gpu1
    layer_3_qkv_gpu1 -> layer_3_attention
    layer_3_attention -> layer_3_attn_out_gpu1
    layer_3_attn_out_gpu1 -> layer_3_residual1
    layer_3_input_dist -> layer_3_residual1
    layer_3_residual1 -> layer_3_ln1
    layer_3_ln1 -> layer_3_mlp_fc1_gpu1
    layer_3_mlp_fc1_gpu1 -> layer_3_gelu
    layer_3_gelu -> layer_3_mlp_fc2_gpu1
    layer_3_mlp_fc2_gpu1 -> layer_3_residual2
    layer_3_residual1 -> layer_3_residual2
    layer_3_residual2 -> layer_3_ln2
    layer_3_ln2 -> layer_3_output_dist
    layer_3_output_dist -> layer_3_pipeline_send
    layer_3_pipeline_send -> layer_4_pipeline_recv
    layer_4_pipeline_recv -> layer_4_input_dist
    layer_4_input_dist -> layer_4_qkv_gpu2
    layer_4_qkv_gpu2 -> layer_4_attention
    layer_4_attention -> layer_4_attn_out_gpu2
    layer_4_attn_out_gpu2 -> layer_4_residual1
    layer_4_input_dist -> layer_4_residual1
    layer_4_residual1 -> layer_4_ln1
    layer_4_ln1 -> layer_4_mlp_fc1_gpu2
    layer_4_mlp_fc1_gpu2 -> layer_4_gelu
    layer_4_gelu -> layer_4_mlp_fc2_gpu2
    layer_4_mlp_fc2_gpu2 -> layer_4_residual2
    layer_4_residual1 -> layer_4_residual2
    layer_4_residual2 -> layer_4_ln2
    layer_4_ln2 -> layer_4_output_dist
    layer_4_output_dist -> layer_4_pipeline_send
    layer_4_pipeline_send -> layer_5_pipeline_recv
    layer_5_pipeline_recv -> layer_5_input_dist
    layer_5_input_dist -> layer_5_qkv_gpu2
    layer_5_qkv_gpu2 -> layer_5_attention
    layer_5_attention -> layer_5_attn_out_gpu2
    layer_5_attn_out_gpu2 -> layer_5_residual1
    layer_5_input_dist -> layer_5_residual1
    layer_5_residual1 -> layer_5_ln1
    layer_5_ln1 -> layer_5_mlp_fc1_gpu2
    layer_5_mlp_fc1_gpu2 -> layer_5_gelu
    layer_5_gelu -> layer_5_mlp_fc2_gpu2
    layer_5_mlp_fc2_gpu2 -> layer_5_residual2
    layer_5_residual1 -> layer_5_residual2
    layer_5_residual2 -> layer_5_ln2
    layer_5_ln2 -> layer_5_output_dist
    layer_5_output_dist -> layer_5_pipeline_send
    layer_5_pipeline_send -> layer_6_pipeline_recv
    layer_6_pipeline_recv -> layer_6_input_dist
    layer_6_input_dist -> layer_6_qkv_gpu3
    layer_6_qkv_gpu3 -> layer_6_attention
    layer_6_attention -> layer_6_attn_out_gpu3
    layer_6_attn_out_gpu3 -> layer_6_residual1
    layer_6_input_dist -> layer_6_residual1
    layer_6_residual1 -> layer_6_ln1
    layer_6_ln1 -> layer_6_mlp_fc1_gpu3
    layer_6_mlp_fc1_gpu3 -> layer_6_gelu
    layer_6_gelu -> layer_6_mlp_fc2_gpu3
    layer_6_mlp_fc2_gpu3 -> layer_6_residual2
    layer_6_residual1 -> layer_6_residual2
    layer_6_residual2 -> layer_6_ln2
    layer_6_ln2 -> layer_6_output_dist
    layer_6_output_dist -> layer_6_pipeline_send
    layer_6_pipeline_send -> layer_7_pipeline_recv
    layer_7_pipeline_recv -> layer_7_input_dist
    layer_7_input_dist -> layer_7_qkv_gpu3
    layer_7_qkv_gpu3 -> layer_7_attention
    layer_7_attention -> layer_7_attn_out_gpu3
    layer_7_attn_out_gpu3 -> layer_7_residual1
    layer_7_input_dist -> layer_7_residual1
    layer_7_residual1 -> layer_7_ln1
    layer_7_ln1 -> layer_7_mlp_fc1_gpu3
    layer_7_mlp_fc1_gpu3 -> layer_7_gelu
    layer_7_gelu -> layer_7_mlp_fc2_gpu3
    layer_7_mlp_fc2_gpu3 -> layer_7_residual2
    layer_7_residual1 -> layer_7_residual2
    layer_7_residual2 -> layer_7_ln2
    layer_7_ln2 -> layer_7_output_dist
    layer_7_output_dist -> layer_7_pipeline_send
    layer_7_pipeline_send -> layer_8_pipeline_recv
    layer_8_pipeline_recv -> layer_8_input_dist
    layer_8_input_dist -> layer_8_qkv_gpu4
    layer_8_qkv_gpu4 -> layer_8_attention
    layer_8_attention -> layer_8_attn_out_gpu4
    layer_8_attn_out_gpu4 -> layer_8_residual1
    layer_8_input_dist -> layer_8_residual1
    layer_8_residual1 -> layer_8_ln1
    layer_8_ln1 -> layer_8_mlp_fc1_gpu4
    layer_8_mlp_fc1_gpu4 -> layer_8_gelu
    layer_8_gelu -> layer_8_mlp_fc2_gpu4
    layer_8_mlp_fc2_gpu4 -> layer_8_residual2
    layer_8_residual1 -> layer_8_residual2
    layer_8_residual2 -> layer_8_ln2
    layer_8_ln2 -> layer_8_output_dist
    layer_8_output_dist -> layer_8_pipeline_send
    layer_8_pipeline_send -> layer_9_pipeline_recv
    layer_9_pipeline_recv -> layer_9_input_dist
    layer_9_input_dist -> layer_9_qkv_gpu4
    layer_9_qkv_gpu4 -> layer_9_attention
    layer_9_attention -> layer_9_attn_out_gpu4
    layer_9_attn_out_gpu4 -> layer_9_residual1
    layer_9_input_dist -> layer_9_residual1
    layer_9_residual1 -> layer_9_ln1
    layer_9_ln1 -> layer_9_mlp_fc1_gpu4
    layer_9_mlp_fc1_gpu4 -> layer_9_gelu
    layer_9_gelu -> layer_9_mlp_fc2_gpu4
    layer_9_mlp_fc2_gpu4 -> layer_9_residual2
    layer_9_residual1 -> layer_9_residual2
    layer_9_residual2 -> layer_9_ln2
    layer_9_ln2 -> layer_9_output_dist
    layer_9_output_dist -> layer_9_pipeline_send
    layer_9_pipeline_send -> layer_10_pipeline_recv
    layer_10_pipeline_recv -> layer_10_input_dist
    layer_10_input_dist -> layer_10_qkv_gpu5
    layer_10_qkv_gpu5 -> layer_10_attention
    layer_10_attention -> layer_10_attn_out_gpu5
    layer_10_attn_out_gpu5 -> layer_10_residual1
    layer_10_input_dist -> layer_10_residual1
    layer_10_residual1 -> layer_10_ln1
    layer_10_ln1 -> layer_10_mlp_fc1_gpu5
    layer_10_mlp_fc1_gpu5 -> layer_10_gelu
    layer_10_gelu -> layer_10_mlp_fc2_gpu5
    layer_10_mlp_fc2_gpu5 -> layer_10_residual2
    layer_10_residual1 -> layer_10_residual2
    layer_10_residual2 -> layer_10_ln2
    layer_10_ln2 -> layer_10_output_dist
    layer_10_output_dist -> layer_10_pipeline_send
    layer_10_pipeline_send -> layer_11_pipeline_recv
    layer_11_pipeline_recv -> layer_11_input_dist
    layer_11_input_dist -> layer_11_qkv_gpu5
    layer_11_qkv_gpu5 -> layer_11_attention
    layer_11_attention -> layer_11_attn_out_gpu5
    layer_11_attn_out_gpu5 -> layer_11_residual1
    layer_11_input_dist -> layer_11_residual1
    layer_11_residual1 -> layer_11_ln1
    layer_11_ln1 -> layer_11_mlp_fc1_gpu5
    layer_11_mlp_fc1_gpu5 -> layer_11_gelu
    layer_11_gelu -> layer_11_mlp_fc2_gpu5
    layer_11_mlp_fc2_gpu5 -> layer_11_residual2
    layer_11_residual1 -> layer_11_residual2
    layer_11_residual2 -> layer_11_ln2
    layer_11_ln2 -> layer_11_output_dist
    layer_11_output_dist -> layer_11_pipeline_send
    layer_11_pipeline_send -> layer_12_pipeline_recv
    layer_12_pipeline_recv -> layer_12_input_dist
    layer_12_input_dist -> layer_12_qkv_gpu6
    layer_12_qkv_gpu6 -> layer_12_attention
    layer_12_attention -> layer_12_attn_out_gpu6
    layer_12_attn_out_gpu6 -> layer_12_residual1
    layer_12_input_dist -> layer_12_residual1
    layer_12_residual1 -> layer_12_ln1
    layer_12_ln1 -> layer_12_mlp_fc1_gpu6
    layer_12_mlp_fc1_gpu6 -> layer_12_gelu
    layer_12_gelu -> layer_12_mlp_fc2_gpu6
    layer_12_mlp_fc2_gpu6 -> layer_12_residual2
    layer_12_residual1 -> layer_12_residual2
    layer_12_residual2 -> layer_12_ln2
    layer_12_ln2 -> layer_12_output_dist
    layer_12_output_dist -> layer_12_pipeline_send
    layer_12_pipeline_send -> layer_13_pipeline_recv
    layer_13_pipeline_recv -> layer_13_input_dist
    layer_13_input_dist -> layer_13_qkv_gpu6
    layer_13_qkv_gpu6 -> layer_13_attention
    layer_13_attention -> layer_13_attn_out_gpu6
    layer_13_attn_out_gpu6 -> layer_13_residual1
    layer_13_input_dist -> layer_13_residual1
    layer_13_residual1 -> layer_13_ln1
    layer_13_ln1 -> layer_13_mlp_fc1_gpu6
    layer_13_mlp_fc1_gpu6 -> layer_13_gelu
    layer_13_gelu -> layer_13_mlp_fc2_gpu6
    layer_13_mlp_fc2_gpu6 -> layer_13_residual2
    layer_13_residual1 -> layer_13_residual2
    layer_13_residual2 -> layer_13_ln2
    layer_13_ln2 -> layer_13_output_dist
    layer_13_output_dist -> layer_13_pipeline_send
    layer_13_pipeline_send -> layer_14_pipeline_recv
    layer_14_pipeline_recv -> layer_14_input_dist
    layer_14_input_dist -> layer_14_qkv_gpu7
    layer_14_qkv_gpu7 -> layer_14_attention
    layer_14_attention -> layer_14_attn_out_gpu7
    layer_14_attn_out_gpu7 -> layer_14_residual1
    layer_14_input_dist -> layer_14_residual1
    layer_14_residual1 -> layer_14_ln1
    layer_14_ln1 -> layer_14_mlp_fc1_gpu7
    layer_14_mlp_fc1_gpu7 -> layer_14_gelu
    layer_14_gelu -> layer_14_mlp_fc2_gpu7
    layer_14_mlp_fc2_gpu7 -> layer_14_residual2
    layer_14_residual1 -> layer_14_residual2
    layer_14_residual2 -> layer_14_ln2
    layer_14_ln2 -> layer_14_output_dist
    layer_14_output_dist -> layer_14_pipeline_send
    layer_14_pipeline_send -> layer_15_pipeline_recv
    layer_15_pipeline_recv -> layer_15_input_dist
    layer_15_input_dist -> layer_15_qkv_gpu7
    layer_15_qkv_gpu7 -> layer_15_attention
    layer_15_attention -> layer_15_attn_out_gpu7
    layer_15_attn_out_gpu7 -> layer_15_residual1
    layer_15_input_dist -> layer_15_residual1
    layer_15_residual1 -> layer_15_ln1
    layer_15_ln1 -> layer_15_mlp_fc1_gpu7
    layer_15_mlp_fc1_gpu7 -> layer_15_gelu
    layer_15_gelu -> layer_15_mlp_fc2_gpu7
    layer_15_mlp_fc2_gpu7 -> layer_15_residual2
    layer_15_residual1 -> layer_15_residual2
    layer_15_residual2 -> layer_15_ln2
    layer_15_ln2 -> output
}
