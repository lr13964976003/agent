<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proposed_concise_corrected Pages: 1 -->
<svg width="1139pt" height="1730pt"
 viewBox="0.00 0.00 1139.24 1729.82" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1725.82)">
<title>proposed_concise_corrected</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1725.82 1135.24,-1725.82 1135.24,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_device_pattern</title>
<polygon fill="lightcoral" stroke="black" points="29.24,-284.98 29.24,-1445.39 349.24,-1445.39 349.24,-284.98 29.24,-284.98"/>
<text text-anchor="middle" x="189.24" y="-1430.19" font-family="Times,serif" font-size="14.00">Each Device i (0&#45;15): Handles 6250 tokens</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_ring_comm</title>
<polygon fill="none" stroke="blue" stroke-dasharray="1,5" points="357.24,-873.98 357.24,-970.97 926.24,-970.97 926.24,-873.98 357.24,-873.98"/>
<text text-anchor="middle" x="641.74" y="-955.77" font-family="Times,serif" font-size="14.00">Ring Communication Pattern</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_legend</title>
<polygon fill="none" stroke="gray" stroke-dasharray="1,5" points="443.24,-1638.82 443.24,-1713.82 1123.24,-1713.82 1123.24,-1638.82 443.24,-1638.82"/>
<text text-anchor="middle" x="783.24" y="-1698.62" font-family="Times,serif" font-size="14.00">Legend</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightyellow" stroke="black" points="408.72,-1694.82 83.44,-1694.82 -0.24,-1634.82 325.04,-1634.82 408.72,-1694.82"/>
<text text-anchor="middle" x="204.24" y="-1667.82" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="204.24" y="-1656.82" font-family="Arial" font-size="10.00">[batch=128, seq=100000, d_model=4096]</text>
</g>
<!-- sequence_split -->
<g id="node2" class="node">
<title>sequence_split</title>
<ellipse fill="white" stroke="black" cx="204.24" cy="-1540.61" rx="149.4" ry="21.43"/>
<text text-anchor="middle" x="204.24" y="-1543.61" font-family="Arial" font-size="10.00">Sequence Split</text>
<text text-anchor="middle" x="204.24" y="-1532.61" font-family="Arial" font-size="10.00">[128, 100000, 4096] → 16×[128, 6250, 4096]</text>
</g>
<!-- input&#45;&gt;sequence_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;sequence_split</title>
<path fill="none" stroke="black" d="M204.24,-1634.75C204.24,-1634.75 204.24,-1571.84 204.24,-1571.84"/>
<polygon fill="black" stroke="black" points="207.74,-1571.84 204.24,-1561.84 200.74,-1571.84 207.74,-1571.84"/>
</g>
<!-- l0_input -->
<g id="node3" class="node">
<title>l0_input</title>
<ellipse fill="white" stroke="black" cx="204.24" cy="-1393.18" rx="65.11" ry="21.43"/>
<text text-anchor="middle" x="204.24" y="-1396.18" font-family="Arial" font-size="10.00">Local Input</text>
<text text-anchor="middle" x="204.24" y="-1385.18" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
</g>
<!-- sequence_split&#45;&gt;l0_input -->
<g id="edge2" class="edge">
<title>sequence_split&#45;&gt;l0_input</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M204.24,-1519.17C204.24,-1519.17 204.24,-1424.64 204.24,-1424.64"/>
<polygon fill="black" stroke="black" points="207.74,-1424.64 204.24,-1414.64 200.74,-1424.64 207.74,-1424.64"/>
<text text-anchor="middle" x="269.74" y="-1472.19" font-family="Times,serif" font-size="14.00">Token distribution</text>
<text text-anchor="middle" x="269.74" y="-1457.19" font-family="Times,serif" font-size="14.00">across 16 devices</text>
</g>
<!-- l0_attention -->
<g id="node4" class="node">
<title>l0_attention</title>
<polygon fill="lightblue" stroke="black" points="340.74,-1284.97 227.74,-1284.97 227.74,-1243.97 340.74,-1243.97 340.74,-1284.97"/>
<text text-anchor="middle" x="284.24" y="-1272.97" font-family="Arial" font-size="10.00">Ring Attention Layer 0</text>
<text text-anchor="middle" x="284.24" y="-1261.97" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
<text text-anchor="middle" x="284.24" y="-1250.97" font-family="Arial" font-size="10.00">Device i</text>
</g>
<!-- l0_input&#45;&gt;l0_attention -->
<g id="edge3" class="edge">
<title>l0_input&#45;&gt;l0_attention</title>
<path fill="none" stroke="black" d="M248.52,-1377.4C248.52,-1377.4 248.52,-1295.06 248.52,-1295.06"/>
<polygon fill="black" stroke="black" points="252.02,-1295.06 248.52,-1285.06 245.02,-1295.06 252.02,-1295.06"/>
<text text-anchor="middle" x="272.74" y="-1324.77" font-family="Times,serif" font-size="14.00">Local Q + Ring K/V</text>
</g>
<!-- l0_mlp -->
<g id="node5" class="node">
<title>l0_mlp</title>
<polygon fill="lightgreen" stroke="black" points="330.24,-1170.97 238.24,-1170.97 238.24,-1129.97 330.24,-1129.97 330.24,-1170.97"/>
<text text-anchor="middle" x="284.24" y="-1158.97" font-family="Arial" font-size="10.00">MLP Layer 0</text>
<text text-anchor="middle" x="284.24" y="-1147.97" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
<text text-anchor="middle" x="284.24" y="-1136.97" font-family="Arial" font-size="10.00">Device i</text>
</g>
<!-- l0_attention&#45;&gt;l0_mlp -->
<g id="edge4" class="edge">
<title>l0_attention&#45;&gt;l0_mlp</title>
<path fill="none" stroke="black" d="M284.24,-1243.82C284.24,-1243.82 284.24,-1181.34 284.24,-1181.34"/>
<polygon fill="black" stroke="black" points="287.74,-1181.34 284.24,-1171.34 280.74,-1181.34 287.74,-1181.34"/>
</g>
<!-- send_kv -->
<g id="node13" class="node">
<title>send_kv</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="631.24" cy="-910.97" rx="82.96" ry="28.98"/>
<text text-anchor="middle" x="631.24" y="-919.47" font-family="Arial" font-size="10.00">Send KV Block</text>
<text text-anchor="middle" x="631.24" y="-908.47" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
<text text-anchor="middle" x="631.24" y="-897.47" font-family="Arial" font-size="10.00">Device i→(i+1) mod 16</text>
</g>
<!-- l0_attention&#45;&gt;send_kv -->
<g id="edge12" class="edge">
<title>l0_attention&#45;&gt;send_kv</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M340.78,-1257C435.34,-1257 615.33,-1257 615.33,-1257 615.33,-1257 615.33,-949.59 615.33,-949.59"/>
<polygon fill="black" stroke="black" points="618.83,-949.59 615.33,-939.59 611.83,-949.59 618.83,-949.59"/>
</g>
<!-- l1_attention -->
<g id="node6" class="node">
<title>l1_attention</title>
<polygon fill="lightblue" stroke="black" points="340.74,-1056.97 227.74,-1056.97 227.74,-1015.97 340.74,-1015.97 340.74,-1056.97"/>
<text text-anchor="middle" x="284.24" y="-1044.97" font-family="Arial" font-size="10.00">Ring Attention Layer 1</text>
<text text-anchor="middle" x="284.24" y="-1033.97" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
<text text-anchor="middle" x="284.24" y="-1022.97" font-family="Arial" font-size="10.00">Device i</text>
</g>
<!-- l0_mlp&#45;&gt;l1_attention -->
<g id="edge5" class="edge">
<title>l0_mlp&#45;&gt;l1_attention</title>
<path fill="none" stroke="black" d="M284.24,-1129.82C284.24,-1129.82 284.24,-1067.34 284.24,-1067.34"/>
<polygon fill="black" stroke="black" points="287.74,-1067.34 284.24,-1057.34 280.74,-1067.34 287.74,-1067.34"/>
</g>
<!-- l1_mlp -->
<g id="node7" class="node">
<title>l1_mlp</title>
<polygon fill="lightgreen" stroke="black" points="322.24,-931.47 230.24,-931.47 230.24,-890.47 322.24,-890.47 322.24,-931.47"/>
<text text-anchor="middle" x="276.24" y="-919.47" font-family="Arial" font-size="10.00">MLP Layer 1</text>
<text text-anchor="middle" x="276.24" y="-908.47" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
<text text-anchor="middle" x="276.24" y="-897.47" font-family="Arial" font-size="10.00">Device i</text>
</g>
<!-- l1_attention&#45;&gt;l1_mlp -->
<g id="edge6" class="edge">
<title>l1_attention&#45;&gt;l1_mlp</title>
<path fill="none" stroke="black" d="M276.24,-1015.74C276.24,-1015.74 276.24,-941.73 276.24,-941.73"/>
<polygon fill="black" stroke="black" points="279.74,-941.73 276.24,-931.73 272.74,-941.73 279.74,-941.73"/>
</g>
<!-- l1_attention&#45;&gt;send_kv -->
<g id="edge14" class="edge">
<title>l1_attention&#45;&gt;send_kv</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M340.93,-1029C427.3,-1029 581.92,-1029 581.92,-1029 581.92,-1029 581.92,-944.29 581.92,-944.29"/>
<polygon fill="black" stroke="black" points="585.42,-944.29 581.92,-934.29 578.42,-944.29 585.42,-944.29"/>
</g>
<!-- l2_attention -->
<g id="node8" class="node">
<title>l2_attention</title>
<polygon fill="lightblue" stroke="black" points="340.74,-808.98 227.74,-808.98 227.74,-767.98 340.74,-767.98 340.74,-808.98"/>
<text text-anchor="middle" x="284.24" y="-796.98" font-family="Arial" font-size="10.00">Ring Attention Layer 2</text>
<text text-anchor="middle" x="284.24" y="-785.98" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
<text text-anchor="middle" x="284.24" y="-774.98" font-family="Arial" font-size="10.00">Device i</text>
</g>
<!-- l1_mlp&#45;&gt;l2_attention -->
<g id="edge7" class="edge">
<title>l1_mlp&#45;&gt;l2_attention</title>
<path fill="none" stroke="black" d="M276.24,-890.47C276.24,-890.47 276.24,-819.05 276.24,-819.05"/>
<polygon fill="black" stroke="black" points="279.74,-819.05 276.24,-809.05 272.74,-819.05 279.74,-819.05"/>
</g>
<!-- l2_mlp -->
<g id="node9" class="node">
<title>l2_mlp</title>
<polygon fill="lightgreen" stroke="black" points="330.24,-694.98 238.24,-694.98 238.24,-653.98 330.24,-653.98 330.24,-694.98"/>
<text text-anchor="middle" x="284.24" y="-682.98" font-family="Arial" font-size="10.00">MLP Layer 2</text>
<text text-anchor="middle" x="284.24" y="-671.98" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
<text text-anchor="middle" x="284.24" y="-660.98" font-family="Arial" font-size="10.00">Device i</text>
</g>
<!-- l2_attention&#45;&gt;l2_mlp -->
<g id="edge8" class="edge">
<title>l2_attention&#45;&gt;l2_mlp</title>
<path fill="none" stroke="black" d="M284.24,-767.84C284.24,-767.84 284.24,-705.36 284.24,-705.36"/>
<polygon fill="black" stroke="black" points="287.74,-705.36 284.24,-695.36 280.74,-705.36 287.74,-705.36"/>
</g>
<!-- l2_attention&#45;&gt;send_kv -->
<g id="edge16" class="edge">
<title>l2_attention&#45;&gt;send_kv</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M340.98,-795C432.77,-795 603.66,-795 603.66,-795 603.66,-795 603.66,-873.49 603.66,-873.49"/>
<polygon fill="black" stroke="black" points="600.16,-873.49 603.66,-883.49 607.16,-873.49 600.16,-873.49"/>
</g>
<!-- l3_attention -->
<g id="node10" class="node">
<title>l3_attention</title>
<polygon fill="lightblue" stroke="black" points="340.74,-580.98 227.74,-580.98 227.74,-539.98 340.74,-539.98 340.74,-580.98"/>
<text text-anchor="middle" x="284.24" y="-568.98" font-family="Arial" font-size="10.00">Ring Attention Layer 3</text>
<text text-anchor="middle" x="284.24" y="-557.98" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
<text text-anchor="middle" x="284.24" y="-546.98" font-family="Arial" font-size="10.00">Device i</text>
</g>
<!-- l2_mlp&#45;&gt;l3_attention -->
<g id="edge9" class="edge">
<title>l2_mlp&#45;&gt;l3_attention</title>
<path fill="none" stroke="black" d="M284.24,-653.84C284.24,-653.84 284.24,-591.36 284.24,-591.36"/>
<polygon fill="black" stroke="black" points="287.74,-591.36 284.24,-581.36 280.74,-591.36 287.74,-591.36"/>
</g>
<!-- l3_mlp -->
<g id="node11" class="node">
<title>l3_mlp</title>
<polygon fill="lightgreen" stroke="black" points="320.24,-466.98 228.24,-466.98 228.24,-425.98 320.24,-425.98 320.24,-466.98"/>
<text text-anchor="middle" x="274.24" y="-454.98" font-family="Arial" font-size="10.00">MLP Layer 3</text>
<text text-anchor="middle" x="274.24" y="-443.98" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
<text text-anchor="middle" x="274.24" y="-432.98" font-family="Arial" font-size="10.00">Device i</text>
</g>
<!-- l3_attention&#45;&gt;l3_mlp -->
<g id="edge10" class="edge">
<title>l3_attention&#45;&gt;l3_mlp</title>
<path fill="none" stroke="black" d="M274.24,-539.84C274.24,-539.84 274.24,-477.36 274.24,-477.36"/>
<polygon fill="black" stroke="black" points="277.74,-477.36 274.24,-467.36 270.74,-477.36 277.74,-477.36"/>
</g>
<!-- l3_attention&#45;&gt;send_kv -->
<g id="edge18" class="edge">
<title>l3_attention&#45;&gt;send_kv</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M341.13,-567C445.92,-567 658.82,-567 658.82,-567 658.82,-567 658.82,-873.41 658.82,-873.41"/>
<polygon fill="black" stroke="black" points="655.32,-873.41 658.82,-883.41 662.32,-873.41 655.32,-873.41"/>
</g>
<!-- local_output -->
<g id="node12" class="node">
<title>local_output</title>
<polygon fill="white" stroke="black" points="341.5,-352.98 189.96,-352.98 150.98,-292.98 302.52,-292.98 341.5,-352.98"/>
<text text-anchor="middle" x="246.24" y="-325.98" font-family="Arial" font-size="10.00">Local Output</text>
<text text-anchor="middle" x="246.24" y="-314.98" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
</g>
<!-- l3_mlp&#45;&gt;local_output -->
<g id="edge11" class="edge">
<title>l3_mlp&#45;&gt;local_output</title>
<path fill="none" stroke="black" d="M274.24,-425.81C274.24,-425.81 274.24,-362.98 274.24,-362.98"/>
<polygon fill="black" stroke="black" points="277.74,-362.98 274.24,-352.98 270.74,-362.98 277.74,-362.98"/>
</g>
<!-- sequence_agg -->
<g id="node16" class="node">
<title>sequence_agg</title>
<ellipse fill="white" stroke="black" cx="246.24" cy="-161.99" rx="80.72" ry="28.98"/>
<text text-anchor="middle" x="246.24" y="-170.49" font-family="Arial" font-size="10.00">Sequence Aggregation</text>
<text text-anchor="middle" x="246.24" y="-159.49" font-family="Arial" font-size="10.00">[128, 100000, 4096]</text>
<text text-anchor="middle" x="246.24" y="-148.49" font-family="Arial" font-size="10.00">All 16 Devices</text>
</g>
<!-- local_output&#45;&gt;sequence_agg -->
<g id="edge20" class="edge">
<title>local_output&#45;&gt;sequence_agg</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M246.24,-292.7C246.24,-292.7 246.24,-201.05 246.24,-201.05"/>
<polygon fill="black" stroke="black" points="249.74,-201.05 246.24,-191.05 242.74,-201.05 249.74,-201.05"/>
<text text-anchor="middle" x="296.24" y="-245.78" font-family="Times,serif" font-size="14.00">All Gather</text>
<text text-anchor="middle" x="296.24" y="-230.78" font-family="Times,serif" font-size="14.00">All 16 devices</text>
</g>
<!-- recv_kv -->
<g id="node14" class="node">
<title>recv_kv</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="837.24" cy="-910.97" rx="80.72" ry="28.98"/>
<text text-anchor="middle" x="837.24" y="-919.47" font-family="Arial" font-size="10.00">Receive KV Block</text>
<text text-anchor="middle" x="837.24" y="-908.47" font-family="Arial" font-size="10.00">[128, 6250, 4096]</text>
<text text-anchor="middle" x="837.24" y="-897.47" font-family="Arial" font-size="10.00">Device (i&#45;1) mod 16→i</text>
</g>
<!-- recv_kv&#45;&gt;l0_attention -->
<g id="edge13" class="edge">
<title>recv_kv&#45;&gt;l0_attention</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M852.37,-939.53C852.37,-1024.68 852.37,-1271 852.37,-1271 852.37,-1271 350.79,-1271 350.79,-1271"/>
<polygon fill="black" stroke="black" points="350.79,-1267.5 340.79,-1271 350.79,-1274.5 350.79,-1267.5"/>
</g>
<!-- recv_kv&#45;&gt;l1_attention -->
<g id="edge15" class="edge">
<title>recv_kv&#45;&gt;l1_attention</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M804.5,-937.69C804.5,-976.27 804.5,-1043 804.5,-1043 804.5,-1043 350.91,-1043 350.91,-1043"/>
<polygon fill="black" stroke="black" points="350.91,-1039.5 340.91,-1043 350.91,-1046.5 350.91,-1039.5"/>
</g>
<!-- recv_kv&#45;&gt;l2_attention -->
<g id="edge17" class="edge">
<title>recv_kv&#45;&gt;l2_attention</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M810.37,-883.41C810.37,-845.26 810.37,-781 810.37,-781 810.37,-781 350.8,-781 350.8,-781"/>
<polygon fill="black" stroke="black" points="350.8,-777.5 340.8,-781 350.8,-784.5 350.8,-777.5"/>
</g>
<!-- recv_kv&#45;&gt;l3_attention -->
<g id="edge19" class="edge">
<title>recv_kv&#45;&gt;l3_attention</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M864.11,-883.48C864.11,-799.65 864.11,-553 864.11,-553 864.11,-553 350.9,-553 350.9,-553"/>
<polygon fill="black" stroke="black" points="350.9,-549.5 340.9,-553 350.9,-556.5 350.9,-549.5"/>
</g>
<!-- ring_stage -->
<g id="node15" class="node">
<title>ring_stage</title>
<ellipse fill="lightblue" stroke="black" cx="435.24" cy="-910.97" rx="70.01" ry="28.98"/>
<text text-anchor="middle" x="435.24" y="-919.47" font-family="Arial" font-size="10.00">16 Ring Stages</text>
<text text-anchor="middle" x="435.24" y="-908.47" font-family="Arial" font-size="10.00">Complete attention</text>
<text text-anchor="middle" x="435.24" y="-897.47" font-family="Arial" font-size="10.00">across all tokens</text>
</g>
<!-- output -->
<g id="node17" class="node">
<title>output</title>
<polygon fill="lightyellow" stroke="black" points="450.72,-60 125.44,-60 41.76,0 367.04,0 450.72,-60"/>
<text text-anchor="middle" x="246.24" y="-33" font-family="Arial" font-size="10.00">Output</text>
<text text-anchor="middle" x="246.24" y="-22" font-family="Arial" font-size="10.00">[batch=128, seq=100000, d_model=4096]</text>
</g>
<!-- sequence_agg&#45;&gt;output -->
<g id="edge21" class="edge">
<title>sequence_agg&#45;&gt;output</title>
<path fill="none" stroke="black" d="M246.24,-132.7C246.24,-132.7 246.24,-70.13 246.24,-70.13"/>
<polygon fill="black" stroke="black" points="249.74,-70.13 246.24,-60.13 242.74,-70.13 249.74,-70.13"/>
</g>
<!-- legend1 -->
<g id="node18" class="node">
<title>legend1</title>
<text text-anchor="middle" x="1029.24" y="-1662.32" font-family="Arial" font-size="10.00">Sequence Parallel: 16×6250 tokens</text>
</g>
<!-- legend2 -->
<g id="node19" class="node">
<title>legend2</title>
<text text-anchor="middle" x="796.24" y="-1662.32" font-family="Arial" font-size="10.00">Ring Attention: KV blocks rotate around ring</text>
</g>
<!-- legend3 -->
<g id="node20" class="node">
<title>legend3</title>
<text text-anchor="middle" x="550.24" y="-1662.32" font-family="Arial" font-size="10.00">Each layer: 32&#45;head attention + 32K MLP</text>
</g>
</g>
</svg>
