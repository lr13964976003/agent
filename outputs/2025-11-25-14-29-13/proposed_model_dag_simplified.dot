// MoE Proposed Model DAG - Expert Parallelism Focus
digraph {
	rankdir=LR ranksep=2.0 splines=ortho
	node [fontname=Arial fontsize=9]
	edge [fontname=Arial fontsize=8]
	input [label="Input\n[128,10000,4096]" fillcolor=yellow shape=ellipse style=filled]
	ln1 [label="LayerNorm\n[128,10000,4096]" fillcolor=lightblue shape=rectangle style=filled]
	mha [label="Multi-Head\nAttention\n[128,10000,4096]" fillcolor=lightblue shape=rectangle style=filled]
	residual1 [label="ResidualAdd\n[128,10000,4096]" fillcolor=lightblue shape=rectangle style=filled]
	ln2 [label="LayerNorm\n[128,10000,4096]" fillcolor=lightblue shape=rectangle style=filled]
	gate [label="ExpertGate\nTop-K=2\n[128,10000,16]" fillcolor=gold shape=parallelogram style=filled]
	expert0 [label="Dedicated\nExpert0\nGPU:0\n[128,*,4096]" fillcolor=lightblue shape=rectangle style="filled,rounded"]
	expert1 [label="Dedicated\nExpert1\nGPU:1\n[128,*,4096]" fillcolor=lightgreen shape=rectangle style="filled,rounded"]
	expert2 [label="Dedicated\nExpert2\nGPU:2\n[128,*,4096]" fillcolor=lightyellow shape=rectangle style="filled,rounded"]
	expert3 [label="Dedicated\nExpert3\nGPU:3\n[128,*,4096]" fillcolor=lightcoral shape=rectangle style="filled,rounded"]
	expert4 [label="Dedicated\nExpert4\nGPU:4\n[128,*,4096]" fillcolor=lightpink shape=rectangle style="filled,rounded"]
	expert5 [label="Dedicated\nExpert5\nGPU:5\n[128,*,4096]" fillcolor=lightsteelblue shape=rectangle style="filled,rounded"]
	expert6 [label="Dedicated\nExpert6\nGPU:6\n[128,*,4096]" fillcolor=lightsalmon shape=rectangle style="filled,rounded"]
	expert7 [label="Dedicated\nExpert7\nGPU:7\n[128,*,4096]" fillcolor=lightseagreen shape=rectangle style="filled,rounded"]
	expert8 [label="Dedicated\nExpert8\nGPU:8\n[128,*,4096]" fillcolor=lightcyan shape=rectangle style="filled,rounded"]
	expert9 [label="Dedicated\nExpert9\nGPU:9\n[128,*,4096]" fillcolor=lightgray shape=rectangle style="filled,rounded"]
	expert10 [label="Dedicated\nExpert10\nGPU:10\n[128,*,4096]" fillcolor=lightgoldenrod shape=rectangle style="filled,rounded"]
	expert11 [label="Dedicated\nExpert11\nGPU:11\n[128,*,4096]" fillcolor=lightsteelblue shape=rectangle style="filled,rounded"]
	expert12 [label="Dedicated\nExpert12\nGPU:12\n[128,*,4096]" fillcolor=lightcyan shape=rectangle style="filled,rounded"]
	expert13 [label="Dedicated\nExpert13\nGPU:13\n[128,*,4096]" fillcolor=lightmagenta shape=rectangle style="filled,rounded"]
	expert14 [label="Dedicated\nExpert14\nGPU:14\n[128,*,4096]" fillcolor=lightolive shape=rectangle style="filled,rounded"]
	expert15 [label="Dedicated\nExpert15\nGPU:15\n[128,*,4096]" fillcolor=lightorange shape=rectangle style="filled,rounded"]
	expert_agg [label="ExpertAggregate\n[128,10000,4096]" fillcolor=orange shape=parallelogram style=filled]
	residual2 [label="ResidualAdd\n[128,10000,4096]" fillcolor=lightblue shape=rectangle style=filled]
	output [label="Output\n[128,10000,4096]" fillcolor=yellow shape=ellipse style=filled]
	input -> ln1
	ln1 -> mha
	mha -> residual1
	input -> residual1
	residual1 -> ln2
	ln2 -> gate [style=dashed]
	gate -> expert0 [style=dashed]
	gate -> expert1 [style=dashed]
	gate -> expert2 [style=dashed]
	gate -> expert3 [style=dashed]
	gate -> expert4 [style=dashed]
	gate -> expert5 [style=dashed]
	gate -> expert6 [style=dashed]
	gate -> expert7 [style=dashed]
	gate -> expert8 [style=dashed]
	gate -> expert9 [style=dashed]
	gate -> expert10 [style=dashed]
	gate -> expert11 [style=dashed]
	gate -> expert12 [style=dashed]
	gate -> expert13 [style=dashed]
	gate -> expert14 [style=dashed]
	gate -> expert15 [style=dashed]
	expert0 -> expert_agg [label="GPU0\n[128,*,4096]" color=red style=dotted]
	expert1 -> expert_agg [label="GPU1\n[128,*,4096]" color=red style=dotted]
	expert2 -> expert_agg [label="GPU2\n[128,*,4096]" color=red style=dotted]
	expert3 -> expert_agg [label="GPU3\n[128,*,4096]" color=red style=dotted]
	expert4 -> expert_agg [label="GPU4\n[128,*,4096]" color=red style=dotted]
	expert5 -> expert_agg [label="GPU5\n[128,*,4096]" color=red style=dotted]
	expert6 -> expert_agg [label="GPU6\n[128,*,4096]" color=red style=dotted]
	expert7 -> expert_agg [label="GPU7\n[128,*,4096]" color=red style=dotted]
	expert8 -> expert_agg [label="GPU8\n[128,*,4096]" color=red style=dotted]
	expert9 -> expert_agg [label="GPU9\n[128,*,4096]" color=red style=dotted]
	expert10 -> expert_agg [label="GPU10\n[128,*,4096]" color=red style=dotted]
	expert11 -> expert_agg [label="GPU11\n[128,*,4096]" color=red style=dotted]
	expert12 -> expert_agg [label="GPU12\n[128,*,4096]" color=red style=dotted]
	expert13 -> expert_agg [label="GPU13\n[128,*,4096]" color=red style=dotted]
	expert14 -> expert_agg [label="GPU14\n[128,*,4096]" color=red style=dotted]
	expert15 -> expert_agg [label="GPU15\n[128,*,4096]" color=red style=dotted]
	ln2 -> expert_agg
	expert_agg -> residual2
	residual2 -> output
}
