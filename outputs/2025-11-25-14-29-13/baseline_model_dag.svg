<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="7657pt" height="2610pt"
 viewBox="0.00 0.00 7657.00 2609.98" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2605.98)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2605.98 7653,-2605.98 7653,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="yellow" stroke="black" cx="3370.5" cy="-2572.99" rx="190.42" ry="28.98"/>
<text text-anchor="middle" x="3370.5" y="-2581.49" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="3370.5" y="-2570.49" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, d_model=4096]</text>
<text text-anchor="middle" x="3370.5" y="-2559.49" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, d_model=4096]</text>
</g>
<!-- ln1_s0_gpu0 -->
<g id="node2" class="node">
<title>ln1_s0_gpu0</title>
<polygon fill="lightblue" stroke="black" points="2339,-2507 2212,-2507 2212,-2455 2339,-2455 2339,-2507"/>
<text text-anchor="middle" x="2275.5" y="-2495" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="2275.5" y="-2484" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2275.5" y="-2473" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2275.5" y="-2462" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- input&#45;&gt;ln1_s0_gpu0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;ln1_s0_gpu0</title>
<path fill="none" stroke="black" d="M3203.9,-2587C2897.47,-2587 2275.5,-2587 2275.5,-2587 2275.5,-2587 2275.5,-2517.2 2275.5,-2517.2"/>
<polygon fill="black" stroke="black" points="2279,-2517.2 2275.5,-2507.2 2272,-2517.2 2279,-2517.2"/>
</g>
<!-- ln1_s0_gpu1 -->
<g id="node15" class="node">
<title>ln1_s0_gpu1</title>
<polygon fill="lightblue" stroke="black" points="2901,-2507 2774,-2507 2774,-2455 2901,-2455 2901,-2507"/>
<text text-anchor="middle" x="2837.5" y="-2495" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="2837.5" y="-2484" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2837.5" y="-2473" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2837.5" y="-2462" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- input&#45;&gt;ln1_s0_gpu1 -->
<g id="edge15" class="edge">
<title>input&#45;&gt;ln1_s0_gpu1</title>
<path fill="none" stroke="black" d="M3207.69,-2558C3050.94,-2558 2837.5,-2558 2837.5,-2558 2837.5,-2558 2837.5,-2517.07 2837.5,-2517.07"/>
<polygon fill="black" stroke="black" points="2841,-2517.07 2837.5,-2507.07 2834,-2517.07 2841,-2517.07"/>
</g>
<!-- ln1_s0_gpu2 -->
<g id="node28" class="node">
<title>ln1_s0_gpu2</title>
<polygon fill="lightblue" stroke="black" points="2620,-2507 2493,-2507 2493,-2455 2620,-2455 2620,-2507"/>
<text text-anchor="middle" x="2556.5" y="-2495" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="2556.5" y="-2484" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2556.5" y="-2473" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2556.5" y="-2462" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- input&#45;&gt;ln1_s0_gpu2 -->
<g id="edge29" class="edge">
<title>input&#45;&gt;ln1_s0_gpu2</title>
<path fill="none" stroke="black" d="M3180.17,-2572C2939.6,-2572 2556.5,-2572 2556.5,-2572 2556.5,-2572 2556.5,-2517.32 2556.5,-2517.32"/>
<polygon fill="black" stroke="black" points="2560,-2517.32 2556.5,-2507.32 2553,-2517.32 2560,-2517.32"/>
</g>
<!-- ln1_s0_gpu3 -->
<g id="node41" class="node">
<title>ln1_s0_gpu3</title>
<polygon fill="lightblue" stroke="black" points="3285,-2507 3158,-2507 3158,-2455 3285,-2455 3285,-2507"/>
<text text-anchor="middle" x="3221.5" y="-2495" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="3221.5" y="-2484" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-2473" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3221.5" y="-2462" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- input&#45;&gt;ln1_s0_gpu3 -->
<g id="edge43" class="edge">
<title>input&#45;&gt;ln1_s0_gpu3</title>
<path fill="none" stroke="black" d="M3232.64,-2552.58C3232.64,-2552.58 3232.64,-2517.31 3232.64,-2517.31"/>
<polygon fill="black" stroke="black" points="3236.14,-2517.31 3232.64,-2507.31 3229.14,-2517.31 3236.14,-2517.31"/>
</g>
<!-- ln1_s0_gpu4 -->
<g id="node54" class="node">
<title>ln1_s0_gpu4</title>
<polygon fill="lightblue" stroke="black" points="4526,-2507 4399,-2507 4399,-2455 4526,-2455 4526,-2507"/>
<text text-anchor="middle" x="4462.5" y="-2495" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="4462.5" y="-2484" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-2473" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4462.5" y="-2462" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- input&#45;&gt;ln1_s0_gpu4 -->
<g id="edge57" class="edge">
<title>input&#45;&gt;ln1_s0_gpu4</title>
<path fill="none" stroke="black" d="M3560.71,-2572C3873.58,-2572 4462.5,-2572 4462.5,-2572 4462.5,-2572 4462.5,-2517.32 4462.5,-2517.32"/>
<polygon fill="black" stroke="black" points="4466,-2517.32 4462.5,-2507.32 4459,-2517.32 4466,-2517.32"/>
</g>
<!-- ln1_s0_gpu5 -->
<g id="node67" class="node">
<title>ln1_s0_gpu5</title>
<polygon fill="lightblue" stroke="black" points="3964,-2507 3837,-2507 3837,-2455 3964,-2455 3964,-2507"/>
<text text-anchor="middle" x="3900.5" y="-2495" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="3900.5" y="-2484" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-2473" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3900.5" y="-2462" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- input&#45;&gt;ln1_s0_gpu5 -->
<g id="edge71" class="edge">
<title>input&#45;&gt;ln1_s0_gpu5</title>
<path fill="none" stroke="black" d="M3541.03,-2559.81C3541.03,-2534.37 3541.03,-2481 3541.03,-2481 3541.03,-2481 3826.65,-2481 3826.65,-2481"/>
<polygon fill="black" stroke="black" points="3826.65,-2484.5 3836.65,-2481 3826.65,-2477.5 3826.65,-2484.5"/>
</g>
<!-- ln1_s0_gpu6 -->
<g id="node80" class="node">
<title>ln1_s0_gpu6</title>
<polygon fill="lightblue" stroke="black" points="7536,-2507 7409,-2507 7409,-2455 7536,-2455 7536,-2507"/>
<text text-anchor="middle" x="7472.5" y="-2495" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="7472.5" y="-2484" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7472.5" y="-2473" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7472.5" y="-2462" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- input&#45;&gt;ln1_s0_gpu6 -->
<g id="edge85" class="edge">
<title>input&#45;&gt;ln1_s0_gpu6</title>
<path fill="none" stroke="black" d="M3537.34,-2587C4306.44,-2587 7472.5,-2587 7472.5,-2587 7472.5,-2587 7472.5,-2517.2 7472.5,-2517.2"/>
<polygon fill="black" stroke="black" points="7476,-2517.2 7472.5,-2507.2 7469,-2517.2 7476,-2517.2"/>
</g>
<!-- ln1_s0_gpu7 -->
<g id="node93" class="node">
<title>ln1_s0_gpu7</title>
<polygon fill="lightblue" stroke="black" points="4245,-2507 4118,-2507 4118,-2455 4245,-2455 4245,-2507"/>
<text text-anchor="middle" x="4181.5" y="-2495" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="4181.5" y="-2484" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-2473" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4181.5" y="-2462" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- input&#45;&gt;ln1_s0_gpu7 -->
<g id="edge99" class="edge">
<title>input&#45;&gt;ln1_s0_gpu7</title>
<path fill="none" stroke="black" d="M3533.64,-2558C3770.47,-2558 4181.5,-2558 4181.5,-2558 4181.5,-2558 4181.5,-2517.07 4181.5,-2517.07"/>
<polygon fill="black" stroke="black" points="4185,-2517.07 4181.5,-2507.07 4178,-2517.07 4185,-2517.07"/>
</g>
<!-- attn_s0_gpu0 -->
<g id="node3" class="node">
<title>attn_s0_gpu0</title>
<polygon fill="lightblue" stroke="black" points="2336.5,-2418 2214.5,-2418 2214.5,-2355 2336.5,-2355 2336.5,-2418"/>
<text text-anchor="middle" x="2275.5" y="-2406" font-family="Arial" font-size="10.00">MHA&#45;Shard0</text>
<text text-anchor="middle" x="2275.5" y="-2395" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2275.5" y="-2384" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="2275.5" y="-2373" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2275.5" y="-2362" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s0_gpu0&#45;&gt;attn_s0_gpu0 -->
<g id="edge2" class="edge">
<title>ln1_s0_gpu0&#45;&gt;attn_s0_gpu0</title>
<path fill="none" stroke="black" d="M2275.5,-2454.93C2275.5,-2454.93 2275.5,-2428.21 2275.5,-2428.21"/>
<polygon fill="black" stroke="black" points="2279,-2428.21 2275.5,-2418.21 2272,-2428.21 2279,-2428.21"/>
</g>
<!-- attn_proj_s0_gpu0 -->
<g id="node4" class="node">
<title>attn_proj_s0_gpu0</title>
<polygon fill="lightblue" stroke="black" points="2336.5,-2318 2214.5,-2318 2214.5,-2266 2336.5,-2266 2336.5,-2318"/>
<text text-anchor="middle" x="2275.5" y="-2306" font-family="Arial" font-size="10.00">AttnProj&#45;Shard0</text>
<text text-anchor="middle" x="2275.5" y="-2295" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2275.5" y="-2284" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2275.5" y="-2273" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s0_gpu0&#45;&gt;attn_proj_s0_gpu0 -->
<g id="edge3" class="edge">
<title>attn_s0_gpu0&#45;&gt;attn_proj_s0_gpu0</title>
<path fill="none" stroke="black" d="M2275.5,-2354.77C2275.5,-2354.77 2275.5,-2328.14 2275.5,-2328.14"/>
<polygon fill="black" stroke="black" points="2279,-2328.14 2275.5,-2318.14 2272,-2328.14 2279,-2328.14"/>
</g>
<!-- residual1_s0_gpu0 -->
<g id="node5" class="node">
<title>residual1_s0_gpu0</title>
<polygon fill="lightblue" stroke="black" points="2338,-2229 2213,-2229 2213,-2177 2338,-2177 2338,-2229"/>
<text text-anchor="middle" x="2275.5" y="-2217" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="2275.5" y="-2206" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2275.5" y="-2195" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2275.5" y="-2184" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s0_gpu0&#45;&gt;residual1_s0_gpu0 -->
<g id="edge4" class="edge">
<title>attn_proj_s0_gpu0&#45;&gt;residual1_s0_gpu0</title>
<path fill="none" stroke="black" d="M2275.5,-2265.78C2275.5,-2265.78 2275.5,-2239.03 2275.5,-2239.03"/>
<polygon fill="black" stroke="black" points="2279,-2239.03 2275.5,-2229.03 2272,-2239.03 2279,-2239.03"/>
</g>
<!-- allreduce1_s0_gpu0 -->
<g id="node6" class="node">
<title>allreduce1_s0_gpu0</title>
<polygon fill="orange" stroke="black" points="2407.34,-2140 2197.61,-2140 2143.66,-2036 2353.39,-2036 2407.34,-2140"/>
<text text-anchor="middle" x="2275.5" y="-2102" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="2275.5" y="-2091" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2275.5" y="-2080" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2275.5" y="-2069" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s0_gpu0&#45;&gt;allreduce1_s0_gpu0 -->
<g id="edge5" class="edge">
<title>residual1_s0_gpu0&#45;&gt;allreduce1_s0_gpu0</title>
<path fill="none" stroke="black" d="M2275.5,-2176.9C2275.5,-2176.9 2275.5,-2150.32 2275.5,-2150.32"/>
<polygon fill="black" stroke="black" points="2279,-2150.32 2275.5,-2140.32 2272,-2150.32 2279,-2150.32"/>
</g>
<!-- ln2_s0_gpu0 -->
<g id="node7" class="node">
<title>ln2_s0_gpu0</title>
<polygon fill="lightblue" stroke="black" points="2372,-1999 2245,-1999 2245,-1947 2372,-1947 2372,-1999"/>
<text text-anchor="middle" x="2308.5" y="-1987" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="2308.5" y="-1976" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2308.5" y="-1965" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2308.5" y="-1954" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s0_gpu0&#45;&gt;ln2_s0_gpu0 -->
<g id="edge6" class="edge">
<title>allreduce1_s0_gpu0&#45;&gt;ln2_s0_gpu0</title>
<path fill="none" stroke="black" d="M2308.5,-2035.88C2308.5,-2035.88 2308.5,-2009.19 2308.5,-2009.19"/>
<polygon fill="black" stroke="black" points="2312,-2009.19 2308.5,-1999.19 2305,-2009.19 2312,-2009.19"/>
</g>
<!-- mlp1_s0_gpu0 -->
<g id="node8" class="node">
<title>mlp1_s0_gpu0</title>
<polygon fill="lightblue" stroke="black" points="2375,-1910 2248,-1910 2248,-1858 2375,-1858 2375,-1910"/>
<text text-anchor="middle" x="2311.5" y="-1898" font-family="Arial" font-size="10.00">MLP1&#45;Shard0</text>
<text text-anchor="middle" x="2311.5" y="-1887" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2311.5" y="-1876" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2311.5" y="-1865" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s0_gpu0&#45;&gt;mlp1_s0_gpu0 -->
<g id="edge7" class="edge">
<title>ln2_s0_gpu0&#45;&gt;mlp1_s0_gpu0</title>
<path fill="none" stroke="black" d="M2310,-1946.78C2310,-1946.78 2310,-1920.03 2310,-1920.03"/>
<polygon fill="black" stroke="black" points="2313.5,-1920.03 2310,-1910.03 2306.5,-1920.03 2313.5,-1920.03"/>
</g>
<!-- gelu_s0_gpu0 -->
<g id="node9" class="node">
<title>gelu_s0_gpu0</title>
<polygon fill="lightblue" stroke="black" points="2392,-1821 2265,-1821 2265,-1769 2392,-1769 2392,-1821"/>
<text text-anchor="middle" x="2328.5" y="-1809" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="2328.5" y="-1798" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2328.5" y="-1787" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="2328.5" y="-1776" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s0_gpu0&#45;&gt;gelu_s0_gpu0 -->
<g id="edge8" class="edge">
<title>mlp1_s0_gpu0&#45;&gt;gelu_s0_gpu0</title>
<path fill="none" stroke="black" d="M2320,-1857.78C2320,-1857.78 2320,-1831.03 2320,-1831.03"/>
<polygon fill="black" stroke="black" points="2323.5,-1831.03 2320,-1821.03 2316.5,-1831.03 2323.5,-1831.03"/>
</g>
<!-- mlp2_s0_gpu0 -->
<g id="node10" class="node">
<title>mlp2_s0_gpu0</title>
<polygon fill="lightblue" stroke="black" points="2402.5,-1732 2280.5,-1732 2280.5,-1680 2402.5,-1680 2402.5,-1732"/>
<text text-anchor="middle" x="2341.5" y="-1720" font-family="Arial" font-size="10.00">MLP2&#45;Shard0</text>
<text text-anchor="middle" x="2341.5" y="-1709" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2341.5" y="-1698" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="2341.5" y="-1687" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s0_gpu0&#45;&gt;mlp2_s0_gpu0 -->
<g id="edge9" class="edge">
<title>gelu_s0_gpu0&#45;&gt;mlp2_s0_gpu0</title>
<path fill="none" stroke="black" d="M2336.25,-1768.78C2336.25,-1768.78 2336.25,-1742.03 2336.25,-1742.03"/>
<polygon fill="black" stroke="black" points="2339.75,-1742.03 2336.25,-1732.03 2332.75,-1742.03 2339.75,-1742.03"/>
</g>
<!-- residual2_s0_gpu0 -->
<g id="node11" class="node">
<title>residual2_s0_gpu0</title>
<polygon fill="lightblue" stroke="black" points="2418,-1643 2293,-1643 2293,-1591 2418,-1591 2418,-1643"/>
<text text-anchor="middle" x="2355.5" y="-1631" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="2355.5" y="-1620" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2355.5" y="-1609" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2355.5" y="-1598" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s0_gpu0&#45;&gt;residual2_s0_gpu0 -->
<g id="edge10" class="edge">
<title>mlp2_s0_gpu0&#45;&gt;residual2_s0_gpu0</title>
<path fill="none" stroke="black" d="M2347.75,-1679.78C2347.75,-1679.78 2347.75,-1653.03 2347.75,-1653.03"/>
<polygon fill="black" stroke="black" points="2351.25,-1653.03 2347.75,-1643.03 2344.25,-1653.03 2351.25,-1653.03"/>
</g>
<!-- allreduce2_s0_gpu0 -->
<g id="node12" class="node">
<title>allreduce2_s0_gpu0</title>
<polygon fill="orange" stroke="black" points="2489.34,-1554 2279.61,-1554 2225.66,-1450 2435.39,-1450 2489.34,-1554"/>
<text text-anchor="middle" x="2357.5" y="-1516" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="2357.5" y="-1505" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="2357.5" y="-1494" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2357.5" y="-1483" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s0_gpu0&#45;&gt;allreduce2_s0_gpu0 -->
<g id="edge11" class="edge">
<title>residual2_s0_gpu0&#45;&gt;allreduce2_s0_gpu0</title>
<path fill="none" stroke="black" d="M2355.5,-1590.9C2355.5,-1590.9 2355.5,-1564.32 2355.5,-1564.32"/>
<polygon fill="black" stroke="black" points="2359,-1564.32 2355.5,-1554.32 2352,-1564.32 2359,-1564.32"/>
</g>
<!-- gate_s0_gpu0 -->
<g id="node14" class="node">
<title>gate_s0_gpu0</title>
<polygon fill="gold" stroke="black" points="312.75,-1394 116.69,-1394 66.25,-1268 262.31,-1268 312.75,-1394"/>
<text text-anchor="middle" x="189.5" y="-1350.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="189.5" y="-1339.5" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="189.5" y="-1328.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="189.5" y="-1317.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="189.5" y="-1306.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s0_gpu0&#45;&gt;gate_s0_gpu0 -->
<g id="edge12" class="edge">
<title>allreduce2_s0_gpu0&#45;&gt;gate_s0_gpu0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2261.19,-1519C1841.05,-1519 189.5,-1519 189.5,-1519 189.5,-1519 189.5,-1404.12 189.5,-1404.12"/>
<polygon fill="black" stroke="black" points="193,-1404.12 189.5,-1394.12 186,-1404.12 193,-1404.12"/>
</g>
<!-- ln1_s1_gpu8 -->
<g id="node106" class="node">
<title>ln1_s1_gpu8</title>
<polygon fill="lightgreen" stroke="black" points="3381,-1357 3254,-1357 3254,-1305 3381,-1305 3381,-1357"/>
<text text-anchor="middle" x="3317.5" y="-1345" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="3317.5" y="-1334" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3317.5" y="-1323" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3317.5" y="-1312" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu8 -->
<g id="edge113" class="edge">
<title>allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2483.75,-1501.92C2483.75,-1498.68 2483.75,-1395 2483.75,-1395 2483.75,-1395 3270.53,-1395 3270.53,-1395 3270.53,-1395 3270.53,-1367.03 3270.53,-1367.03"/>
<polygon fill="black" stroke="black" points="3274.03,-1367.03 3270.53,-1357.03 3267.03,-1367.03 3274.03,-1367.03"/>
<text text-anchor="middle" x="2970" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2970" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- ln1_s1_gpu9 -->
<g id="node119" class="node">
<title>ln1_s1_gpu9</title>
<polygon fill="lightgreen" stroke="black" points="5589,-1357 5462,-1357 5462,-1305 5589,-1305 5589,-1357"/>
<text text-anchor="middle" x="5525.5" y="-1345" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="5525.5" y="-1334" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="5525.5" y="-1323" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5525.5" y="-1312" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu9 -->
<g id="edge114" class="edge">
<title>allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2481.5,-1501.91C2481.5,-1498.34 2481.5,-1384 2481.5,-1384 2481.5,-1384 5477.88,-1384 5477.88,-1384 5477.88,-1384 5477.88,-1367.19 5477.88,-1367.19"/>
<polygon fill="black" stroke="black" points="5481.38,-1367.19 5477.88,-1357.19 5474.38,-1367.19 5481.38,-1367.19"/>
<text text-anchor="middle" x="5274" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="5274" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- ln1_s1_gpu10 -->
<g id="node132" class="node">
<title>ln1_s1_gpu10</title>
<polygon fill="lightgreen" stroke="black" points="1327,-1357 1200,-1357 1200,-1305 1327,-1305 1327,-1357"/>
<text text-anchor="middle" x="1263.5" y="-1345" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="1263.5" y="-1334" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="1263.5" y="-1323" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1263.5" y="-1312" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu10 -->
<g id="edge115" class="edge">
<title>allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2243.16,-1484C1953.58,-1484 1214.11,-1484 1214.11,-1484 1214.11,-1484 1214.11,-1367.3 1214.11,-1367.3"/>
<polygon fill="black" stroke="black" points="1217.61,-1367.3 1214.11,-1357.3 1210.61,-1367.3 1217.61,-1367.3"/>
<text text-anchor="middle" x="737" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="737" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- ln1_s1_gpu11 -->
<g id="node145" class="node">
<title>ln1_s1_gpu11</title>
<polygon fill="lightgreen" stroke="black" points="4821,-1357 4694,-1357 4694,-1305 4821,-1305 4821,-1357"/>
<text text-anchor="middle" x="4757.5" y="-1345" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="4757.5" y="-1334" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4757.5" y="-1323" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4757.5" y="-1312" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu11 -->
<g id="edge116" class="edge">
<title>allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2479.25,-1501.91C2479.25,-1498.22 2479.25,-1380 2479.25,-1380 2479.25,-1380 4715.17,-1380 4715.17,-1380 4715.17,-1380 4715.17,-1367.22 4715.17,-1367.22"/>
<polygon fill="black" stroke="black" points="4718.67,-1367.22 4715.17,-1357.22 4711.67,-1367.22 4718.67,-1367.22"/>
<text text-anchor="middle" x="4506" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4506" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- ln1_s1_gpu12 -->
<g id="node158" class="node">
<title>ln1_s1_gpu12</title>
<polygon fill="lightgreen" stroke="black" points="4053,-1357 3926,-1357 3926,-1305 4053,-1305 4053,-1357"/>
<text text-anchor="middle" x="3989.5" y="-1345" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="3989.5" y="-1334" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3989.5" y="-1323" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3989.5" y="-1312" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu12 -->
<g id="edge117" class="edge">
<title>allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2477,-1501.9C2477,-1497.63 2477,-1361 2477,-1361 2477,-1361 3937.8,-1361 3937.8,-1361 3937.8,-1361 3937.8,-1360.63 3937.8,-1360.63"/>
<polygon fill="black" stroke="black" points="3941.3,-1367.32 3937.8,-1357.32 3934.3,-1367.32 3941.3,-1367.32"/>
<text text-anchor="middle" x="3738" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="3738" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- ln1_s1_gpu13 -->
<g id="node171" class="node">
<title>ln1_s1_gpu13</title>
<polygon fill="lightgreen" stroke="black" points="2613,-1357 2486,-1357 2486,-1305 2613,-1305 2613,-1357"/>
<text text-anchor="middle" x="2549.5" y="-1345" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="2549.5" y="-1334" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="2549.5" y="-1323" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2549.5" y="-1312" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu13 -->
<g id="edge118" class="edge">
<title>allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2474.75,-1501.87C2474.75,-1496.29 2474.75,-1318 2474.75,-1318 2474.75,-1318 2475.85,-1318 2475.85,-1318"/>
<polygon fill="black" stroke="black" points="2475.78,-1321.5 2485.78,-1318 2475.78,-1314.5 2475.78,-1321.5"/>
<text text-anchor="middle" x="2202" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2202" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- ln1_s1_gpu14 -->
<g id="node184" class="node">
<title>ln1_s1_gpu14</title>
<polygon fill="lightgreen" stroke="black" points="6354,-1357 6227,-1357 6227,-1305 6354,-1305 6354,-1357"/>
<text text-anchor="middle" x="6290.5" y="-1345" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="6290.5" y="-1334" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="6290.5" y="-1323" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6290.5" y="-1312" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu14 -->
<g id="edge119" class="edge">
<title>allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2391.17,-1450C2391.17,-1441.82 2391.17,-1436 2391.17,-1436 2391.17,-1436 6242.88,-1436 6242.88,-1436 6242.88,-1436 6242.88,-1367.23 6242.88,-1367.23"/>
<polygon fill="black" stroke="black" points="6246.38,-1367.23 6242.88,-1357.23 6239.38,-1367.23 6246.38,-1367.23"/>
<text text-anchor="middle" x="6042" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="6042" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- ln1_s1_gpu15 -->
<g id="node197" class="node">
<title>ln1_s1_gpu15</title>
<polygon fill="lightgreen" stroke="black" points="1845,-1357 1718,-1357 1718,-1305 1845,-1305 1845,-1357"/>
<text text-anchor="middle" x="1781.5" y="-1345" font-family="Arial" font-size="10.00">LayerNorm1</text>
<text text-anchor="middle" x="1781.5" y="-1334" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="1781.5" y="-1323" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1781.5" y="-1312" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu15 -->
<g id="edge120" class="edge">
<title>allreduce2_s0_gpu0&#45;&gt;ln1_s1_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2232.17,-1501.89C2232.17,-1497.1 2232.17,-1344 2232.17,-1344 2232.17,-1344 1855.11,-1344 1855.11,-1344"/>
<polygon fill="black" stroke="black" points="1855.11,-1340.5 1845.11,-1344 1855.11,-1347.5 1855.11,-1340.5"/>
<text text-anchor="middle" x="1434" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="1434" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- experts_s0_gpu0 -->
<g id="node13" class="node">
<title>experts_s0_gpu0</title>
<path fill="lightcoral" stroke="black" d="M115,-1231C115,-1231 12,-1231 12,-1231 6,-1231 0,-1225 0,-1219 0,-1219 0,-1180 0,-1180 0,-1174 6,-1168 12,-1168 12,-1168 115,-1168 115,-1168 121,-1168 127,-1174 127,-1180 127,-1180 127,-1219 127,-1219 127,-1225 121,-1231 115,-1231"/>
<text text-anchor="middle" x="63.5" y="-1219" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="63.5" y="-1208" font-family="Arial" font-size="10.00">GPU:0</text>
<text text-anchor="middle" x="63.5" y="-1197" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="63.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="63.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- experts_s0_gpu0&#45;&gt;ln1_s0_gpu0 -->
<g id="edge14" class="edge">
<title>experts_s0_gpu0&#45;&gt;ln1_s0_gpu0</title>
<path fill="none" stroke="black" d="M33.06,-1231.18C33.06,-1428.52 33.06,-2481 33.06,-2481 33.06,-2481 2201.7,-2481 2201.7,-2481"/>
<polygon fill="black" stroke="black" points="2201.7,-2484.5 2211.7,-2481 2201.7,-2477.5 2201.7,-2484.5"/>
</g>
<!-- gate_s0_gpu0&#45;&gt;experts_s0_gpu0 -->
<g id="edge13" class="edge">
<title>gate_s0_gpu0&#45;&gt;experts_s0_gpu0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M96.56,-1267.95C96.56,-1267.95 96.56,-1241.11 96.56,-1241.11"/>
<polygon fill="black" stroke="black" points="100.06,-1241.11 96.56,-1231.11 93.06,-1241.11 100.06,-1241.11"/>
</g>
<!-- attn_s0_gpu1 -->
<g id="node16" class="node">
<title>attn_s0_gpu1</title>
<polygon fill="lightblue" stroke="black" points="2898.5,-2418 2776.5,-2418 2776.5,-2355 2898.5,-2355 2898.5,-2418"/>
<text text-anchor="middle" x="2837.5" y="-2406" font-family="Arial" font-size="10.00">MHA&#45;Shard1</text>
<text text-anchor="middle" x="2837.5" y="-2395" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2837.5" y="-2384" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="2837.5" y="-2373" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2837.5" y="-2362" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s0_gpu1&#45;&gt;attn_s0_gpu1 -->
<g id="edge16" class="edge">
<title>ln1_s0_gpu1&#45;&gt;attn_s0_gpu1</title>
<path fill="none" stroke="black" d="M2857.83,-2454.93C2857.83,-2454.93 2857.83,-2428.21 2857.83,-2428.21"/>
<polygon fill="black" stroke="black" points="2861.33,-2428.21 2857.83,-2418.21 2854.33,-2428.21 2861.33,-2428.21"/>
</g>
<!-- attn_proj_s0_gpu1 -->
<g id="node17" class="node">
<title>attn_proj_s0_gpu1</title>
<polygon fill="lightblue" stroke="black" points="2898.5,-2318 2776.5,-2318 2776.5,-2266 2898.5,-2266 2898.5,-2318"/>
<text text-anchor="middle" x="2837.5" y="-2306" font-family="Arial" font-size="10.00">AttnProj&#45;Shard1</text>
<text text-anchor="middle" x="2837.5" y="-2295" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2837.5" y="-2284" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2837.5" y="-2273" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s0_gpu1&#45;&gt;attn_proj_s0_gpu1 -->
<g id="edge17" class="edge">
<title>attn_s0_gpu1&#45;&gt;attn_proj_s0_gpu1</title>
<path fill="none" stroke="black" d="M2837.5,-2354.77C2837.5,-2354.77 2837.5,-2328.14 2837.5,-2328.14"/>
<polygon fill="black" stroke="black" points="2841,-2328.14 2837.5,-2318.14 2834,-2328.14 2841,-2328.14"/>
</g>
<!-- residual1_s0_gpu1 -->
<g id="node18" class="node">
<title>residual1_s0_gpu1</title>
<polygon fill="lightblue" stroke="black" points="2900,-2229 2775,-2229 2775,-2177 2900,-2177 2900,-2229"/>
<text text-anchor="middle" x="2837.5" y="-2217" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="2837.5" y="-2206" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2837.5" y="-2195" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2837.5" y="-2184" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s0_gpu1&#45;&gt;residual1_s0_gpu1 -->
<g id="edge18" class="edge">
<title>attn_proj_s0_gpu1&#45;&gt;residual1_s0_gpu1</title>
<path fill="none" stroke="black" d="M2837.5,-2265.78C2837.5,-2265.78 2837.5,-2239.03 2837.5,-2239.03"/>
<polygon fill="black" stroke="black" points="2841,-2239.03 2837.5,-2229.03 2834,-2239.03 2841,-2239.03"/>
</g>
<!-- allreduce1_s0_gpu1 -->
<g id="node19" class="node">
<title>allreduce1_s0_gpu1</title>
<polygon fill="orange" stroke="black" points="2969.34,-2140 2759.61,-2140 2705.66,-2036 2915.39,-2036 2969.34,-2140"/>
<text text-anchor="middle" x="2837.5" y="-2102" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="2837.5" y="-2091" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2837.5" y="-2080" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2837.5" y="-2069" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s0_gpu1&#45;&gt;allreduce1_s0_gpu1 -->
<g id="edge19" class="edge">
<title>residual1_s0_gpu1&#45;&gt;allreduce1_s0_gpu1</title>
<path fill="none" stroke="black" d="M2837.5,-2176.9C2837.5,-2176.9 2837.5,-2150.32 2837.5,-2150.32"/>
<polygon fill="black" stroke="black" points="2841,-2150.32 2837.5,-2140.32 2834,-2150.32 2841,-2150.32"/>
</g>
<!-- ln2_s0_gpu1 -->
<g id="node20" class="node">
<title>ln2_s0_gpu1</title>
<polygon fill="lightblue" stroke="black" points="2910,-1999 2783,-1999 2783,-1947 2910,-1947 2910,-1999"/>
<text text-anchor="middle" x="2846.5" y="-1987" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="2846.5" y="-1976" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2846.5" y="-1965" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2846.5" y="-1954" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s0_gpu1&#45;&gt;ln2_s0_gpu1 -->
<g id="edge20" class="edge">
<title>allreduce1_s0_gpu1&#45;&gt;ln2_s0_gpu1</title>
<path fill="none" stroke="black" d="M2846.5,-2035.88C2846.5,-2035.88 2846.5,-2009.19 2846.5,-2009.19"/>
<polygon fill="black" stroke="black" points="2850,-2009.19 2846.5,-1999.19 2843,-2009.19 2850,-2009.19"/>
</g>
<!-- mlp1_s0_gpu1 -->
<g id="node21" class="node">
<title>mlp1_s0_gpu1</title>
<polygon fill="lightblue" stroke="black" points="2913,-1910 2786,-1910 2786,-1858 2913,-1858 2913,-1910"/>
<text text-anchor="middle" x="2849.5" y="-1898" font-family="Arial" font-size="10.00">MLP1&#45;Shard1</text>
<text text-anchor="middle" x="2849.5" y="-1887" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2849.5" y="-1876" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2849.5" y="-1865" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s0_gpu1&#45;&gt;mlp1_s0_gpu1 -->
<g id="edge21" class="edge">
<title>ln2_s0_gpu1&#45;&gt;mlp1_s0_gpu1</title>
<path fill="none" stroke="black" d="M2848,-1946.78C2848,-1946.78 2848,-1920.03 2848,-1920.03"/>
<polygon fill="black" stroke="black" points="2851.5,-1920.03 2848,-1910.03 2844.5,-1920.03 2851.5,-1920.03"/>
</g>
<!-- gelu_s0_gpu1 -->
<g id="node22" class="node">
<title>gelu_s0_gpu1</title>
<polygon fill="lightblue" stroke="black" points="2927,-1821 2800,-1821 2800,-1769 2927,-1769 2927,-1821"/>
<text text-anchor="middle" x="2863.5" y="-1809" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="2863.5" y="-1798" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2863.5" y="-1787" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="2863.5" y="-1776" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s0_gpu1&#45;&gt;gelu_s0_gpu1 -->
<g id="edge22" class="edge">
<title>mlp1_s0_gpu1&#45;&gt;gelu_s0_gpu1</title>
<path fill="none" stroke="black" d="M2856.5,-1857.78C2856.5,-1857.78 2856.5,-1831.03 2856.5,-1831.03"/>
<polygon fill="black" stroke="black" points="2860,-1831.03 2856.5,-1821.03 2853,-1831.03 2860,-1831.03"/>
</g>
<!-- mlp2_s0_gpu1 -->
<g id="node23" class="node">
<title>mlp2_s0_gpu1</title>
<polygon fill="lightblue" stroke="black" points="2934.5,-1732 2812.5,-1732 2812.5,-1680 2934.5,-1680 2934.5,-1732"/>
<text text-anchor="middle" x="2873.5" y="-1720" font-family="Arial" font-size="10.00">MLP2&#45;Shard1</text>
<text text-anchor="middle" x="2873.5" y="-1709" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2873.5" y="-1698" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="2873.5" y="-1687" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s0_gpu1&#45;&gt;mlp2_s0_gpu1 -->
<g id="edge23" class="edge">
<title>gelu_s0_gpu1&#45;&gt;mlp2_s0_gpu1</title>
<path fill="none" stroke="black" d="M2869.75,-1768.78C2869.75,-1768.78 2869.75,-1742.03 2869.75,-1742.03"/>
<polygon fill="black" stroke="black" points="2873.25,-1742.03 2869.75,-1732.03 2866.25,-1742.03 2873.25,-1742.03"/>
</g>
<!-- residual2_s0_gpu1 -->
<g id="node24" class="node">
<title>residual2_s0_gpu1</title>
<polygon fill="lightblue" stroke="black" points="2938,-1643 2813,-1643 2813,-1591 2938,-1591 2938,-1643"/>
<text text-anchor="middle" x="2875.5" y="-1631" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="2875.5" y="-1620" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2875.5" y="-1609" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2875.5" y="-1598" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s0_gpu1&#45;&gt;residual2_s0_gpu1 -->
<g id="edge24" class="edge">
<title>mlp2_s0_gpu1&#45;&gt;residual2_s0_gpu1</title>
<path fill="none" stroke="black" d="M2873.75,-1679.78C2873.75,-1679.78 2873.75,-1653.03 2873.75,-1653.03"/>
<polygon fill="black" stroke="black" points="2877.25,-1653.03 2873.75,-1643.03 2870.25,-1653.03 2877.25,-1653.03"/>
</g>
<!-- allreduce2_s0_gpu1 -->
<g id="node25" class="node">
<title>allreduce2_s0_gpu1</title>
<polygon fill="orange" stroke="black" points="3071.34,-1554 2861.61,-1554 2807.66,-1450 3017.39,-1450 3071.34,-1554"/>
<text text-anchor="middle" x="2939.5" y="-1516" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="2939.5" y="-1505" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="2939.5" y="-1494" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2939.5" y="-1483" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s0_gpu1&#45;&gt;allreduce2_s0_gpu1 -->
<g id="edge25" class="edge">
<title>residual2_s0_gpu1&#45;&gt;allreduce2_s0_gpu1</title>
<path fill="none" stroke="black" d="M2875.5,-1590.9C2875.5,-1590.9 2875.5,-1564.32 2875.5,-1564.32"/>
<polygon fill="black" stroke="black" points="2879,-1564.32 2875.5,-1554.32 2872,-1564.32 2879,-1564.32"/>
</g>
<!-- gate_s0_gpu1 -->
<g id="node27" class="node">
<title>gate_s0_gpu1</title>
<polygon fill="gold" stroke="black" points="916.75,-1394 720.69,-1394 670.25,-1268 866.31,-1268 916.75,-1394"/>
<text text-anchor="middle" x="793.5" y="-1350.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="793.5" y="-1339.5" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="793.5" y="-1328.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="793.5" y="-1317.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="793.5" y="-1306.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s0_gpu1&#45;&gt;gate_s0_gpu1 -->
<g id="edge26" class="edge">
<title>allreduce2_s0_gpu1&#45;&gt;gate_s0_gpu1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2841.42,-1449.77C2841.42,-1446.21 2841.42,-1444 2841.42,-1444 2841.42,-1444 793.5,-1444 793.5,-1444 793.5,-1444 793.5,-1404.11 793.5,-1404.11"/>
<polygon fill="black" stroke="black" points="797,-1404.11 793.5,-1394.11 790,-1404.11 797,-1404.11"/>
</g>
<!-- allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu8 -->
<g id="edge121" class="edge">
<title>allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3034.95,-1483.72C3034.95,-1438.5 3034.95,-1325 3034.95,-1325 3034.95,-1325 3243.74,-1325 3243.74,-1325"/>
<polygon fill="black" stroke="black" points="3243.74,-1328.5 3253.74,-1325 3243.74,-1321.5 3243.74,-1328.5"/>
<text text-anchor="middle" x="3162" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="3162" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu9 -->
<g id="edge122" class="edge">
<title>allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2962.5,-1449.75C2962.5,-1435.05 2962.5,-1423 2962.5,-1423 2962.5,-1423 5509.62,-1423 5509.62,-1423 5509.62,-1423 5509.62,-1367.12 5509.62,-1367.12"/>
<polygon fill="black" stroke="black" points="5513.13,-1367.12 5509.62,-1357.12 5506.13,-1367.12 5513.13,-1367.12"/>
<text text-anchor="middle" x="5466" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="5466" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu10 -->
<g id="edge123" class="edge">
<title>allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2813.12,-1501.95C2813.12,-1499.86 2813.12,-1433 2813.12,-1433 2813.12,-1433 1242.33,-1433 1242.33,-1433 1242.33,-1433 1242.33,-1367 1242.33,-1367"/>
<polygon fill="black" stroke="black" points="1245.83,-1367 1242.33,-1357 1238.83,-1367 1245.83,-1367"/>
<text text-anchor="middle" x="929" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="929" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu11 -->
<g id="edge124" class="edge">
<title>allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2926.28,-1449.8C2926.28,-1424.71 2926.28,-1400 2926.28,-1400 2926.28,-1400 4757.5,-1400 4757.5,-1400 4757.5,-1400 4757.5,-1367.09 4757.5,-1367.09"/>
<polygon fill="black" stroke="black" points="4761,-1367.09 4757.5,-1357.09 4754,-1367.09 4761,-1367.09"/>
<text text-anchor="middle" x="4698" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4698" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu12 -->
<g id="edge125" class="edge">
<title>allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2890.05,-1449.81C2890.05,-1423.46 2890.05,-1397 2890.05,-1397 2890.05,-1397 3961.39,-1397 3961.39,-1397 3961.39,-1397 3961.39,-1367.08 3961.39,-1367.08"/>
<polygon fill="black" stroke="black" points="3964.89,-1367.08 3961.39,-1357.08 3957.89,-1367.08 3964.89,-1367.08"/>
<text text-anchor="middle" x="3930" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="3930" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu13 -->
<g id="edge126" class="edge">
<title>allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2823.71,-1449.62C2823.71,-1404.3 2823.71,-1346 2823.71,-1346 2823.71,-1346 2623.1,-1346 2623.1,-1346"/>
<polygon fill="black" stroke="black" points="2623.1,-1342.5 2613.1,-1346 2623.1,-1349.5 2623.1,-1342.5"/>
<text text-anchor="middle" x="2394" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2394" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu14 -->
<g id="edge127" class="edge">
<title>allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2998.72,-1449.74C2998.72,-1442.79 2998.72,-1438 2998.72,-1438 2998.72,-1438 6274.62,-1438 6274.62,-1438 6274.62,-1438 6274.62,-1367.18 6274.62,-1367.18"/>
<polygon fill="black" stroke="black" points="6278.13,-1367.18 6274.62,-1357.18 6271.13,-1367.18 6278.13,-1367.18"/>
<text text-anchor="middle" x="6234" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="6234" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu15 -->
<g id="edge128" class="edge">
<title>allreduce2_s0_gpu1&#45;&gt;ln1_s1_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2818.42,-1449.91C2818.42,-1433.23 2818.42,-1419 2818.42,-1419 2818.42,-1419 1749.75,-1419 1749.75,-1419 1749.75,-1419 1749.75,-1367.4 1749.75,-1367.4"/>
<polygon fill="black" stroke="black" points="1753.25,-1367.4 1749.75,-1357.4 1746.25,-1367.4 1753.25,-1367.4"/>
<text text-anchor="middle" x="1626" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="1626" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- experts_s0_gpu1 -->
<g id="node26" class="node">
<title>experts_s0_gpu1</title>
<path fill="lightcoral" stroke="black" d="M703,-1231C703,-1231 600,-1231 600,-1231 594,-1231 588,-1225 588,-1219 588,-1219 588,-1180 588,-1180 588,-1174 594,-1168 600,-1168 600,-1168 703,-1168 703,-1168 709,-1168 715,-1174 715,-1180 715,-1180 715,-1219 715,-1219 715,-1225 709,-1231 703,-1231"/>
<text text-anchor="middle" x="651.5" y="-1219" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="651.5" y="-1208" font-family="Arial" font-size="10.00">GPU:1</text>
<text text-anchor="middle" x="651.5" y="-1197" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="651.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="651.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- experts_s0_gpu1&#45;&gt;ln1_s0_gpu1 -->
<g id="edge28" class="edge">
<title>experts_s0_gpu1&#45;&gt;ln1_s0_gpu1</title>
<path fill="none" stroke="black" d="M642.5,-1231.21C642.5,-1424.12 642.5,-2432 642.5,-2432 642.5,-2432 2817.17,-2432 2817.17,-2432 2817.17,-2432 2817.17,-2444.78 2817.17,-2444.78"/>
<polygon fill="black" stroke="black" points="2813.67,-2444.78 2817.17,-2454.78 2820.67,-2444.78 2813.67,-2444.78"/>
</g>
<!-- gate_s0_gpu1&#45;&gt;experts_s0_gpu1 -->
<g id="edge27" class="edge">
<title>gate_s0_gpu1&#45;&gt;experts_s0_gpu1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M692.56,-1267.95C692.56,-1267.95 692.56,-1241.11 692.56,-1241.11"/>
<polygon fill="black" stroke="black" points="696.06,-1241.11 692.56,-1231.11 689.06,-1241.11 696.06,-1241.11"/>
</g>
<!-- attn_s0_gpu2 -->
<g id="node29" class="node">
<title>attn_s0_gpu2</title>
<polygon fill="lightblue" stroke="black" points="2617.5,-2418 2495.5,-2418 2495.5,-2355 2617.5,-2355 2617.5,-2418"/>
<text text-anchor="middle" x="2556.5" y="-2406" font-family="Arial" font-size="10.00">MHA&#45;Shard2</text>
<text text-anchor="middle" x="2556.5" y="-2395" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2556.5" y="-2384" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="2556.5" y="-2373" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2556.5" y="-2362" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s0_gpu2&#45;&gt;attn_s0_gpu2 -->
<g id="edge30" class="edge">
<title>ln1_s0_gpu2&#45;&gt;attn_s0_gpu2</title>
<path fill="none" stroke="black" d="M2576.83,-2454.93C2576.83,-2454.93 2576.83,-2428.21 2576.83,-2428.21"/>
<polygon fill="black" stroke="black" points="2580.33,-2428.21 2576.83,-2418.21 2573.33,-2428.21 2580.33,-2428.21"/>
</g>
<!-- attn_proj_s0_gpu2 -->
<g id="node30" class="node">
<title>attn_proj_s0_gpu2</title>
<polygon fill="lightblue" stroke="black" points="2617.5,-2318 2495.5,-2318 2495.5,-2266 2617.5,-2266 2617.5,-2318"/>
<text text-anchor="middle" x="2556.5" y="-2306" font-family="Arial" font-size="10.00">AttnProj&#45;Shard2</text>
<text text-anchor="middle" x="2556.5" y="-2295" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2556.5" y="-2284" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2556.5" y="-2273" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s0_gpu2&#45;&gt;attn_proj_s0_gpu2 -->
<g id="edge31" class="edge">
<title>attn_s0_gpu2&#45;&gt;attn_proj_s0_gpu2</title>
<path fill="none" stroke="black" d="M2556.5,-2354.77C2556.5,-2354.77 2556.5,-2328.14 2556.5,-2328.14"/>
<polygon fill="black" stroke="black" points="2560,-2328.14 2556.5,-2318.14 2553,-2328.14 2560,-2328.14"/>
</g>
<!-- residual1_s0_gpu2 -->
<g id="node31" class="node">
<title>residual1_s0_gpu2</title>
<polygon fill="lightblue" stroke="black" points="2619,-2229 2494,-2229 2494,-2177 2619,-2177 2619,-2229"/>
<text text-anchor="middle" x="2556.5" y="-2217" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="2556.5" y="-2206" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2556.5" y="-2195" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2556.5" y="-2184" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s0_gpu2&#45;&gt;residual1_s0_gpu2 -->
<g id="edge32" class="edge">
<title>attn_proj_s0_gpu2&#45;&gt;residual1_s0_gpu2</title>
<path fill="none" stroke="black" d="M2556.5,-2265.78C2556.5,-2265.78 2556.5,-2239.03 2556.5,-2239.03"/>
<polygon fill="black" stroke="black" points="2560,-2239.03 2556.5,-2229.03 2553,-2239.03 2560,-2239.03"/>
</g>
<!-- allreduce1_s0_gpu2 -->
<g id="node32" class="node">
<title>allreduce1_s0_gpu2</title>
<polygon fill="orange" stroke="black" points="2688.34,-2140 2478.61,-2140 2424.66,-2036 2634.39,-2036 2688.34,-2140"/>
<text text-anchor="middle" x="2556.5" y="-2102" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="2556.5" y="-2091" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2556.5" y="-2080" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2556.5" y="-2069" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s0_gpu2&#45;&gt;allreduce1_s0_gpu2 -->
<g id="edge33" class="edge">
<title>residual1_s0_gpu2&#45;&gt;allreduce1_s0_gpu2</title>
<path fill="none" stroke="black" d="M2556.5,-2176.9C2556.5,-2176.9 2556.5,-2150.32 2556.5,-2150.32"/>
<polygon fill="black" stroke="black" points="2560,-2150.32 2556.5,-2140.32 2553,-2150.32 2560,-2150.32"/>
</g>
<!-- ln2_s0_gpu2 -->
<g id="node33" class="node">
<title>ln2_s0_gpu2</title>
<polygon fill="lightblue" stroke="black" points="2638,-1999 2511,-1999 2511,-1947 2638,-1947 2638,-1999"/>
<text text-anchor="middle" x="2574.5" y="-1987" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="2574.5" y="-1976" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2574.5" y="-1965" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2574.5" y="-1954" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s0_gpu2&#45;&gt;ln2_s0_gpu2 -->
<g id="edge34" class="edge">
<title>allreduce1_s0_gpu2&#45;&gt;ln2_s0_gpu2</title>
<path fill="none" stroke="black" d="M2574.5,-2035.88C2574.5,-2035.88 2574.5,-2009.19 2574.5,-2009.19"/>
<polygon fill="black" stroke="black" points="2578,-2009.19 2574.5,-1999.19 2571,-2009.19 2578,-2009.19"/>
</g>
<!-- mlp1_s0_gpu2 -->
<g id="node34" class="node">
<title>mlp1_s0_gpu2</title>
<polygon fill="lightblue" stroke="black" points="2651,-1910 2524,-1910 2524,-1858 2651,-1858 2651,-1910"/>
<text text-anchor="middle" x="2587.5" y="-1898" font-family="Arial" font-size="10.00">MLP1&#45;Shard2</text>
<text text-anchor="middle" x="2587.5" y="-1887" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2587.5" y="-1876" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2587.5" y="-1865" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s0_gpu2&#45;&gt;mlp1_s0_gpu2 -->
<g id="edge35" class="edge">
<title>ln2_s0_gpu2&#45;&gt;mlp1_s0_gpu2</title>
<path fill="none" stroke="black" d="M2581,-1946.78C2581,-1946.78 2581,-1920.03 2581,-1920.03"/>
<polygon fill="black" stroke="black" points="2584.5,-1920.03 2581,-1910.03 2577.5,-1920.03 2584.5,-1920.03"/>
</g>
<!-- gelu_s0_gpu2 -->
<g id="node35" class="node">
<title>gelu_s0_gpu2</title>
<polygon fill="lightblue" stroke="black" points="2687,-1821 2560,-1821 2560,-1769 2687,-1769 2687,-1821"/>
<text text-anchor="middle" x="2623.5" y="-1809" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="2623.5" y="-1798" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2623.5" y="-1787" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="2623.5" y="-1776" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s0_gpu2&#45;&gt;gelu_s0_gpu2 -->
<g id="edge36" class="edge">
<title>mlp1_s0_gpu2&#45;&gt;gelu_s0_gpu2</title>
<path fill="none" stroke="black" d="M2605.5,-1857.78C2605.5,-1857.78 2605.5,-1831.03 2605.5,-1831.03"/>
<polygon fill="black" stroke="black" points="2609,-1831.03 2605.5,-1821.03 2602,-1831.03 2609,-1831.03"/>
</g>
<!-- mlp2_s0_gpu2 -->
<g id="node36" class="node">
<title>mlp2_s0_gpu2</title>
<polygon fill="lightblue" stroke="black" points="2704.5,-1732 2582.5,-1732 2582.5,-1680 2704.5,-1680 2704.5,-1732"/>
<text text-anchor="middle" x="2643.5" y="-1720" font-family="Arial" font-size="10.00">MLP2&#45;Shard2</text>
<text text-anchor="middle" x="2643.5" y="-1709" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2643.5" y="-1698" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="2643.5" y="-1687" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s0_gpu2&#45;&gt;mlp2_s0_gpu2 -->
<g id="edge37" class="edge">
<title>gelu_s0_gpu2&#45;&gt;mlp2_s0_gpu2</title>
<path fill="none" stroke="black" d="M2634.75,-1768.78C2634.75,-1768.78 2634.75,-1742.03 2634.75,-1742.03"/>
<polygon fill="black" stroke="black" points="2638.25,-1742.03 2634.75,-1732.03 2631.25,-1742.03 2638.25,-1742.03"/>
</g>
<!-- residual2_s0_gpu2 -->
<g id="node37" class="node">
<title>residual2_s0_gpu2</title>
<polygon fill="lightblue" stroke="black" points="2709,-1643 2584,-1643 2584,-1591 2709,-1591 2709,-1643"/>
<text text-anchor="middle" x="2646.5" y="-1631" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="2646.5" y="-1620" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2646.5" y="-1609" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2646.5" y="-1598" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s0_gpu2&#45;&gt;residual2_s0_gpu2 -->
<g id="edge38" class="edge">
<title>mlp2_s0_gpu2&#45;&gt;residual2_s0_gpu2</title>
<path fill="none" stroke="black" d="M2644.25,-1679.78C2644.25,-1679.78 2644.25,-1653.03 2644.25,-1653.03"/>
<polygon fill="black" stroke="black" points="2647.75,-1653.03 2644.25,-1643.03 2640.75,-1653.03 2647.75,-1653.03"/>
</g>
<!-- allreduce2_s0_gpu2 -->
<g id="node38" class="node">
<title>allreduce2_s0_gpu2</title>
<polygon fill="orange" stroke="black" points="2789.34,-1554 2579.61,-1554 2525.66,-1450 2735.39,-1450 2789.34,-1554"/>
<text text-anchor="middle" x="2657.5" y="-1516" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="2657.5" y="-1505" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="2657.5" y="-1494" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2657.5" y="-1483" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s0_gpu2&#45;&gt;allreduce2_s0_gpu2 -->
<g id="edge39" class="edge">
<title>residual2_s0_gpu2&#45;&gt;allreduce2_s0_gpu2</title>
<path fill="none" stroke="black" d="M2646.5,-1590.9C2646.5,-1590.9 2646.5,-1564.32 2646.5,-1564.32"/>
<polygon fill="black" stroke="black" points="2650,-1564.32 2646.5,-1554.32 2643,-1564.32 2650,-1564.32"/>
</g>
<!-- gate_s0_gpu2 -->
<g id="node40" class="node">
<title>gate_s0_gpu2</title>
<polygon fill="gold" stroke="black" points="614.75,-1394 418.69,-1394 368.25,-1268 564.31,-1268 614.75,-1394"/>
<text text-anchor="middle" x="491.5" y="-1350.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="491.5" y="-1339.5" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="491.5" y="-1328.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="491.5" y="-1317.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="491.5" y="-1306.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s0_gpu2&#45;&gt;gate_s0_gpu2 -->
<g id="edge40" class="edge">
<title>allreduce2_s0_gpu2&#45;&gt;gate_s0_gpu2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2535.52,-1501.84C2535.52,-1498.55 2535.52,-1446 2535.52,-1446 2535.52,-1446 491.5,-1446 491.5,-1446 491.5,-1446 491.5,-1404.22 491.5,-1404.22"/>
<polygon fill="black" stroke="black" points="495,-1404.22 491.5,-1394.22 488,-1404.22 495,-1404.22"/>
</g>
<!-- allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu8 -->
<g id="edge129" class="edge">
<title>allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2774.97,-1501.86C2774.97,-1496.2 2774.97,-1315 2774.97,-1315 2774.97,-1315 3243.94,-1315 3243.94,-1315"/>
<polygon fill="black" stroke="black" points="3243.94,-1318.5 3253.94,-1315 3243.94,-1311.5 3243.94,-1318.5"/>
<text text-anchor="middle" x="3066" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="3066" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu9 -->
<g id="edge130" class="edge">
<title>allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2746.58,-1471.3C2746.58,-1448.74 2746.58,-1422 2746.58,-1422 2746.58,-1422 5493.75,-1422 5493.75,-1422 5493.75,-1422 5493.75,-1367.32 5493.75,-1367.32"/>
<polygon fill="black" stroke="black" points="5497.25,-1367.32 5493.75,-1357.32 5490.25,-1367.32 5497.25,-1367.32"/>
<text text-anchor="middle" x="5370" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="5370" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu10 -->
<g id="edge131" class="edge">
<title>allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2545.2,-1449.77C2545.2,-1440.64 2545.2,-1434 2545.2,-1434 2545.2,-1434 1228.22,-1434 1228.22,-1434 1228.22,-1434 1228.22,-1367.26 1228.22,-1367.26"/>
<polygon fill="black" stroke="black" points="1231.72,-1367.26 1228.22,-1357.26 1224.72,-1367.26 1231.72,-1367.26"/>
<text text-anchor="middle" x="833" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="833" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu11 -->
<g id="edge132" class="edge">
<title>allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2732.39,-1449.9C2732.39,-1424.35 2732.39,-1399 2732.39,-1399 2732.39,-1399 4736.33,-1399 4736.33,-1399 4736.33,-1399 4736.33,-1367.1 4736.33,-1367.1"/>
<polygon fill="black" stroke="black" points="4739.83,-1367.1 4736.33,-1357.1 4732.83,-1367.1 4739.83,-1367.1"/>
<text text-anchor="middle" x="4602" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4602" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu12 -->
<g id="edge133" class="edge">
<title>allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2718.19,-1449.93C2718.19,-1423.12 2718.19,-1396 2718.19,-1396 2718.19,-1396 3949.59,-1396 3949.59,-1396 3949.59,-1396 3949.59,-1367.06 3949.59,-1367.06"/>
<polygon fill="black" stroke="black" points="3953.09,-1367.06 3949.59,-1357.06 3946.09,-1367.06 3953.09,-1367.06"/>
<text text-anchor="middle" x="3834" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="3834" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu13 -->
<g id="edge134" class="edge">
<title>allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2564.57,-1449.77C2564.57,-1449.77 2564.57,-1367.18 2564.57,-1367.18"/>
<polygon fill="black" stroke="black" points="2568.07,-1367.18 2564.57,-1357.18 2561.07,-1367.18 2568.07,-1367.18"/>
<text text-anchor="middle" x="2298" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2298" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu14 -->
<g id="edge135" class="edge">
<title>allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2760.78,-1498.86C2760.78,-1485.88 2760.78,-1437 2760.78,-1437 2760.78,-1437 6258.75,-1437 6258.75,-1437 6258.75,-1437 6258.75,-1367.2 6258.75,-1367.2"/>
<polygon fill="black" stroke="black" points="6262.25,-1367.2 6258.75,-1357.2 6255.25,-1367.2 6262.25,-1367.2"/>
<text text-anchor="middle" x="6138" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="6138" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu15 -->
<g id="edge136" class="edge">
<title>allreduce2_s0_gpu2&#45;&gt;ln1_s1_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M2554.89,-1449.6C2554.89,-1433.53 2554.89,-1420 2554.89,-1420 2554.89,-1420 1733.88,-1420 1733.88,-1420 1733.88,-1420 1733.88,-1367.22 1733.88,-1367.22"/>
<polygon fill="black" stroke="black" points="1737.38,-1367.22 1733.88,-1357.22 1730.38,-1367.22 1737.38,-1367.22"/>
<text text-anchor="middle" x="1530" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="1530" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- experts_s0_gpu2 -->
<g id="node39" class="node">
<title>experts_s0_gpu2</title>
<path fill="lightcoral" stroke="black" d="M370,-1231C370,-1231 267,-1231 267,-1231 261,-1231 255,-1225 255,-1219 255,-1219 255,-1180 255,-1180 255,-1174 261,-1168 267,-1168 267,-1168 370,-1168 370,-1168 376,-1168 382,-1174 382,-1180 382,-1180 382,-1219 382,-1219 382,-1225 376,-1231 370,-1231"/>
<text text-anchor="middle" x="318.5" y="-1219" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="318.5" y="-1208" font-family="Arial" font-size="10.00">GPU:2</text>
<text text-anchor="middle" x="318.5" y="-1197" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="318.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="318.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- experts_s0_gpu2&#45;&gt;ln1_s0_gpu2 -->
<g id="edge42" class="edge">
<title>experts_s0_gpu2&#45;&gt;ln1_s0_gpu2</title>
<path fill="none" stroke="black" d="M340.5,-1231.1C340.5,-1424.48 340.5,-2440 340.5,-2440 340.5,-2440 2536.17,-2440 2536.17,-2440 2536.17,-2440 2536.17,-2444.8 2536.17,-2444.8"/>
<polygon fill="black" stroke="black" points="2532.67,-2444.8 2536.17,-2454.8 2539.67,-2444.8 2532.67,-2444.8"/>
</g>
<!-- gate_s0_gpu2&#45;&gt;experts_s0_gpu2 -->
<g id="edge41" class="edge">
<title>gate_s0_gpu2&#45;&gt;experts_s0_gpu2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M375.06,-1330.9C375.06,-1330.9 375.06,-1241.13 375.06,-1241.13"/>
<polygon fill="black" stroke="black" points="378.56,-1241.13 375.06,-1231.13 371.56,-1241.13 378.56,-1241.13"/>
</g>
<!-- attn_s0_gpu3 -->
<g id="node42" class="node">
<title>attn_s0_gpu3</title>
<polygon fill="lightblue" stroke="black" points="3282.5,-2418 3160.5,-2418 3160.5,-2355 3282.5,-2355 3282.5,-2418"/>
<text text-anchor="middle" x="3221.5" y="-2406" font-family="Arial" font-size="10.00">MHA&#45;Shard3</text>
<text text-anchor="middle" x="3221.5" y="-2395" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-2384" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="3221.5" y="-2373" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3221.5" y="-2362" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s0_gpu3&#45;&gt;attn_s0_gpu3 -->
<g id="edge44" class="edge">
<title>ln1_s0_gpu3&#45;&gt;attn_s0_gpu3</title>
<path fill="none" stroke="black" d="M3241.83,-2454.93C3241.83,-2454.93 3241.83,-2428.21 3241.83,-2428.21"/>
<polygon fill="black" stroke="black" points="3245.33,-2428.21 3241.83,-2418.21 3238.33,-2428.21 3245.33,-2428.21"/>
</g>
<!-- attn_proj_s0_gpu3 -->
<g id="node43" class="node">
<title>attn_proj_s0_gpu3</title>
<polygon fill="lightblue" stroke="black" points="3282.5,-2318 3160.5,-2318 3160.5,-2266 3282.5,-2266 3282.5,-2318"/>
<text text-anchor="middle" x="3221.5" y="-2306" font-family="Arial" font-size="10.00">AttnProj&#45;Shard3</text>
<text text-anchor="middle" x="3221.5" y="-2295" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-2284" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3221.5" y="-2273" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s0_gpu3&#45;&gt;attn_proj_s0_gpu3 -->
<g id="edge45" class="edge">
<title>attn_s0_gpu3&#45;&gt;attn_proj_s0_gpu3</title>
<path fill="none" stroke="black" d="M3221.5,-2354.77C3221.5,-2354.77 3221.5,-2328.14 3221.5,-2328.14"/>
<polygon fill="black" stroke="black" points="3225,-2328.14 3221.5,-2318.14 3218,-2328.14 3225,-2328.14"/>
</g>
<!-- residual1_s0_gpu3 -->
<g id="node44" class="node">
<title>residual1_s0_gpu3</title>
<polygon fill="lightblue" stroke="black" points="3284,-2229 3159,-2229 3159,-2177 3284,-2177 3284,-2229"/>
<text text-anchor="middle" x="3221.5" y="-2217" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="3221.5" y="-2206" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-2195" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="3221.5" y="-2184" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s0_gpu3&#45;&gt;residual1_s0_gpu3 -->
<g id="edge46" class="edge">
<title>attn_proj_s0_gpu3&#45;&gt;residual1_s0_gpu3</title>
<path fill="none" stroke="black" d="M3221.5,-2265.78C3221.5,-2265.78 3221.5,-2239.03 3221.5,-2239.03"/>
<polygon fill="black" stroke="black" points="3225,-2239.03 3221.5,-2229.03 3218,-2239.03 3225,-2239.03"/>
</g>
<!-- allreduce1_s0_gpu3 -->
<g id="node45" class="node">
<title>allreduce1_s0_gpu3</title>
<polygon fill="orange" stroke="black" points="3353.34,-2140 3143.61,-2140 3089.66,-2036 3299.39,-2036 3353.34,-2140"/>
<text text-anchor="middle" x="3221.5" y="-2102" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="3221.5" y="-2091" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-2080" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3221.5" y="-2069" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s0_gpu3&#45;&gt;allreduce1_s0_gpu3 -->
<g id="edge47" class="edge">
<title>residual1_s0_gpu3&#45;&gt;allreduce1_s0_gpu3</title>
<path fill="none" stroke="black" d="M3221.5,-2176.9C3221.5,-2176.9 3221.5,-2150.32 3221.5,-2150.32"/>
<polygon fill="black" stroke="black" points="3225,-2150.32 3221.5,-2140.32 3218,-2150.32 3225,-2150.32"/>
</g>
<!-- ln2_s0_gpu3 -->
<g id="node46" class="node">
<title>ln2_s0_gpu3</title>
<polygon fill="lightblue" stroke="black" points="3285,-1999 3158,-1999 3158,-1947 3285,-1947 3285,-1999"/>
<text text-anchor="middle" x="3221.5" y="-1987" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="3221.5" y="-1976" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-1965" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3221.5" y="-1954" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s0_gpu3&#45;&gt;ln2_s0_gpu3 -->
<g id="edge48" class="edge">
<title>allreduce1_s0_gpu3&#45;&gt;ln2_s0_gpu3</title>
<path fill="none" stroke="black" d="M3221.5,-2035.88C3221.5,-2035.88 3221.5,-2009.19 3221.5,-2009.19"/>
<polygon fill="black" stroke="black" points="3225,-2009.19 3221.5,-1999.19 3218,-2009.19 3225,-2009.19"/>
</g>
<!-- mlp1_s0_gpu3 -->
<g id="node47" class="node">
<title>mlp1_s0_gpu3</title>
<polygon fill="lightblue" stroke="black" points="3285,-1910 3158,-1910 3158,-1858 3285,-1858 3285,-1910"/>
<text text-anchor="middle" x="3221.5" y="-1898" font-family="Arial" font-size="10.00">MLP1&#45;Shard3</text>
<text text-anchor="middle" x="3221.5" y="-1887" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-1876" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3221.5" y="-1865" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s0_gpu3&#45;&gt;mlp1_s0_gpu3 -->
<g id="edge49" class="edge">
<title>ln2_s0_gpu3&#45;&gt;mlp1_s0_gpu3</title>
<path fill="none" stroke="black" d="M3221.5,-1946.78C3221.5,-1946.78 3221.5,-1920.03 3221.5,-1920.03"/>
<polygon fill="black" stroke="black" points="3225,-1920.03 3221.5,-1910.03 3218,-1920.03 3225,-1920.03"/>
</g>
<!-- gelu_s0_gpu3 -->
<g id="node48" class="node">
<title>gelu_s0_gpu3</title>
<polygon fill="lightblue" stroke="black" points="3285,-1821 3158,-1821 3158,-1769 3285,-1769 3285,-1821"/>
<text text-anchor="middle" x="3221.5" y="-1809" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="3221.5" y="-1798" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-1787" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="3221.5" y="-1776" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s0_gpu3&#45;&gt;gelu_s0_gpu3 -->
<g id="edge50" class="edge">
<title>mlp1_s0_gpu3&#45;&gt;gelu_s0_gpu3</title>
<path fill="none" stroke="black" d="M3221.5,-1857.78C3221.5,-1857.78 3221.5,-1831.03 3221.5,-1831.03"/>
<polygon fill="black" stroke="black" points="3225,-1831.03 3221.5,-1821.03 3218,-1831.03 3225,-1831.03"/>
</g>
<!-- mlp2_s0_gpu3 -->
<g id="node49" class="node">
<title>mlp2_s0_gpu3</title>
<polygon fill="lightblue" stroke="black" points="3282.5,-1732 3160.5,-1732 3160.5,-1680 3282.5,-1680 3282.5,-1732"/>
<text text-anchor="middle" x="3221.5" y="-1720" font-family="Arial" font-size="10.00">MLP2&#45;Shard3</text>
<text text-anchor="middle" x="3221.5" y="-1709" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-1698" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="3221.5" y="-1687" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s0_gpu3&#45;&gt;mlp2_s0_gpu3 -->
<g id="edge51" class="edge">
<title>gelu_s0_gpu3&#45;&gt;mlp2_s0_gpu3</title>
<path fill="none" stroke="black" d="M3221.5,-1768.78C3221.5,-1768.78 3221.5,-1742.03 3221.5,-1742.03"/>
<polygon fill="black" stroke="black" points="3225,-1742.03 3221.5,-1732.03 3218,-1742.03 3225,-1742.03"/>
</g>
<!-- residual2_s0_gpu3 -->
<g id="node50" class="node">
<title>residual2_s0_gpu3</title>
<polygon fill="lightblue" stroke="black" points="3284,-1643 3159,-1643 3159,-1591 3284,-1591 3284,-1643"/>
<text text-anchor="middle" x="3221.5" y="-1631" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="3221.5" y="-1620" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-1609" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="3221.5" y="-1598" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s0_gpu3&#45;&gt;residual2_s0_gpu3 -->
<g id="edge52" class="edge">
<title>mlp2_s0_gpu3&#45;&gt;residual2_s0_gpu3</title>
<path fill="none" stroke="black" d="M3221.5,-1679.78C3221.5,-1679.78 3221.5,-1653.03 3221.5,-1653.03"/>
<polygon fill="black" stroke="black" points="3225,-1653.03 3221.5,-1643.03 3218,-1653.03 3225,-1653.03"/>
</g>
<!-- allreduce2_s0_gpu3 -->
<g id="node51" class="node">
<title>allreduce2_s0_gpu3</title>
<polygon fill="orange" stroke="black" points="3353.34,-1554 3143.61,-1554 3089.66,-1450 3299.39,-1450 3353.34,-1554"/>
<text text-anchor="middle" x="3221.5" y="-1516" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="3221.5" y="-1505" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="3221.5" y="-1494" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3221.5" y="-1483" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s0_gpu3&#45;&gt;allreduce2_s0_gpu3 -->
<g id="edge53" class="edge">
<title>residual2_s0_gpu3&#45;&gt;allreduce2_s0_gpu3</title>
<path fill="none" stroke="black" d="M3221.5,-1590.9C3221.5,-1590.9 3221.5,-1564.32 3221.5,-1564.32"/>
<polygon fill="black" stroke="black" points="3225,-1564.32 3221.5,-1554.32 3218,-1564.32 3225,-1564.32"/>
</g>
<!-- gate_s0_gpu3 -->
<g id="node53" class="node">
<title>gate_s0_gpu3</title>
<polygon fill="gold" stroke="black" points="1181.75,-1394 985.69,-1394 935.25,-1268 1131.31,-1268 1181.75,-1394"/>
<text text-anchor="middle" x="1058.5" y="-1350.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="1058.5" y="-1339.5" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="1058.5" y="-1328.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="1058.5" y="-1317.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1058.5" y="-1306.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s0_gpu3&#45;&gt;gate_s0_gpu3 -->
<g id="edge54" class="edge">
<title>allreduce2_s0_gpu3&#45;&gt;gate_s0_gpu3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3106.23,-1501.91C3106.23,-1498.06 3106.23,-1375 3106.23,-1375 3106.23,-1375 1184.46,-1375 1184.46,-1375"/>
<polygon fill="black" stroke="black" points="1184.46,-1371.5 1174.46,-1375 1184.46,-1378.5 1184.46,-1371.5"/>
</g>
<!-- allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu8 -->
<g id="edge137" class="edge">
<title>allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3336.64,-1501.88C3336.64,-1501.88 3336.64,-1367.34 3336.64,-1367.34"/>
<polygon fill="black" stroke="black" points="3340.14,-1367.34 3336.64,-1357.34 3333.14,-1367.34 3340.14,-1367.34"/>
<text text-anchor="middle" x="3258" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="3258" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu9 -->
<g id="edge138" class="edge">
<title>allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3303.58,-1457.99C3303.58,-1440.29 3303.58,-1424 3303.58,-1424 3303.58,-1424 5525.5,-1424 5525.5,-1424 5525.5,-1424 5525.5,-1367.4 5525.5,-1367.4"/>
<polygon fill="black" stroke="black" points="5529,-1367.4 5525.5,-1357.4 5522,-1367.4 5529,-1367.4"/>
<text text-anchor="middle" x="5562" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="5562" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu10 -->
<g id="edge139" class="edge">
<title>allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3095.3,-1501.95C3095.3,-1499.83 3095.3,-1432 3095.3,-1432 3095.3,-1432 1256.44,-1432 1256.44,-1432 1256.44,-1432 1256.44,-1367.01 1256.44,-1367.01"/>
<polygon fill="black" stroke="black" points="1259.94,-1367.01 1256.44,-1357.01 1252.94,-1367.01 1259.94,-1367.01"/>
<text text-anchor="middle" x="1050" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="1050" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu11 -->
<g id="edge140" class="edge">
<title>allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3287.06,-1449.72C3287.06,-1425.08 3287.06,-1401 3287.06,-1401 3287.06,-1401 4778.67,-1401 4778.67,-1401 4778.67,-1401 4778.67,-1367.07 4778.67,-1367.07"/>
<polygon fill="black" stroke="black" points="4782.17,-1367.07 4778.67,-1357.07 4775.17,-1367.07 4782.17,-1367.07"/>
<text text-anchor="middle" x="4794" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4794" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu12 -->
<g id="edge141" class="edge">
<title>allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3326.47,-1502C3372.64,-1502 3416.58,-1502 3416.58,-1502 3416.58,-1502 3416.58,-1339 3416.58,-1339 3416.58,-1339 3916,-1339 3916,-1339"/>
<polygon fill="black" stroke="black" points="3916,-1342.5 3926,-1339 3916,-1335.5 3916,-1342.5"/>
<text text-anchor="middle" x="4026" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4026" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu13 -->
<g id="edge142" class="edge">
<title>allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3111.7,-1449.93C3111.7,-1401.25 3111.7,-1336 3111.7,-1336 3111.7,-1336 2623.17,-1336 2623.17,-1336"/>
<polygon fill="black" stroke="black" points="2623.17,-1332.5 2613.17,-1336 2623.17,-1339.5 2623.17,-1332.5"/>
<text text-anchor="middle" x="2490" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2490" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu14 -->
<g id="edge143" class="edge">
<title>allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3320.11,-1489.85C3320.11,-1471.55 3320.11,-1439 3320.11,-1439 3320.11,-1439 6290.5,-1439 6290.5,-1439 6290.5,-1439 6290.5,-1367.14 6290.5,-1367.14"/>
<polygon fill="black" stroke="black" points="6294,-1367.14 6290.5,-1357.14 6287,-1367.14 6294,-1367.14"/>
<text text-anchor="middle" x="6330" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="6330" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu15 -->
<g id="edge144" class="edge">
<title>allreduce2_s0_gpu3&#45;&gt;ln1_s1_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3100.77,-1449.76C3100.77,-1432.67 3100.77,-1418 3100.77,-1418 3100.77,-1418 1765.62,-1418 1765.62,-1418 1765.62,-1418 1765.62,-1367.1 1765.62,-1367.1"/>
<polygon fill="black" stroke="black" points="1769.13,-1367.1 1765.62,-1357.1 1762.13,-1367.1 1769.13,-1367.1"/>
<text text-anchor="middle" x="1722" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="1722" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- experts_s0_gpu3 -->
<g id="node52" class="node">
<title>experts_s0_gpu3</title>
<path fill="lightcoral" stroke="black" d="M971,-1231C971,-1231 868,-1231 868,-1231 862,-1231 856,-1225 856,-1219 856,-1219 856,-1180 856,-1180 856,-1174 862,-1168 868,-1168 868,-1168 971,-1168 971,-1168 977,-1168 983,-1174 983,-1180 983,-1180 983,-1219 983,-1219 983,-1225 977,-1231 971,-1231"/>
<text text-anchor="middle" x="919.5" y="-1219" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="919.5" y="-1208" font-family="Arial" font-size="10.00">GPU:3</text>
<text text-anchor="middle" x="919.5" y="-1197" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="919.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="919.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- experts_s0_gpu3&#45;&gt;ln1_s0_gpu3 -->
<g id="edge56" class="edge">
<title>experts_s0_gpu3&#45;&gt;ln1_s0_gpu3</title>
<path fill="none" stroke="black" d="M926,-1231.02C926,-1422.84 926,-2425 926,-2425 926,-2425 3201.17,-2425 3201.17,-2425 3201.17,-2425 3201.17,-2444.97 3201.17,-2444.97"/>
<polygon fill="black" stroke="black" points="3197.67,-2444.97 3201.17,-2454.97 3204.67,-2444.97 3197.67,-2444.97"/>
</g>
<!-- gate_s0_gpu3&#45;&gt;experts_s0_gpu3 -->
<g id="edge55" class="edge">
<title>gate_s0_gpu3&#45;&gt;experts_s0_gpu3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M959.06,-1267.95C959.06,-1267.95 959.06,-1241.11 959.06,-1241.11"/>
<polygon fill="black" stroke="black" points="962.56,-1241.11 959.06,-1231.11 955.56,-1241.11 962.56,-1241.11"/>
</g>
<!-- attn_s0_gpu4 -->
<g id="node55" class="node">
<title>attn_s0_gpu4</title>
<polygon fill="lightblue" stroke="black" points="4523.5,-2418 4401.5,-2418 4401.5,-2355 4523.5,-2355 4523.5,-2418"/>
<text text-anchor="middle" x="4462.5" y="-2406" font-family="Arial" font-size="10.00">MHA&#45;Shard4</text>
<text text-anchor="middle" x="4462.5" y="-2395" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-2384" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="4462.5" y="-2373" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4462.5" y="-2362" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s0_gpu4&#45;&gt;attn_s0_gpu4 -->
<g id="edge58" class="edge">
<title>ln1_s0_gpu4&#45;&gt;attn_s0_gpu4</title>
<path fill="none" stroke="black" d="M4462.5,-2454.93C4462.5,-2454.93 4462.5,-2428.21 4462.5,-2428.21"/>
<polygon fill="black" stroke="black" points="4466,-2428.21 4462.5,-2418.21 4459,-2428.21 4466,-2428.21"/>
</g>
<!-- attn_proj_s0_gpu4 -->
<g id="node56" class="node">
<title>attn_proj_s0_gpu4</title>
<polygon fill="lightblue" stroke="black" points="4523.5,-2318 4401.5,-2318 4401.5,-2266 4523.5,-2266 4523.5,-2318"/>
<text text-anchor="middle" x="4462.5" y="-2306" font-family="Arial" font-size="10.00">AttnProj&#45;Shard4</text>
<text text-anchor="middle" x="4462.5" y="-2295" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-2284" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4462.5" y="-2273" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s0_gpu4&#45;&gt;attn_proj_s0_gpu4 -->
<g id="edge59" class="edge">
<title>attn_s0_gpu4&#45;&gt;attn_proj_s0_gpu4</title>
<path fill="none" stroke="black" d="M4462.5,-2354.77C4462.5,-2354.77 4462.5,-2328.14 4462.5,-2328.14"/>
<polygon fill="black" stroke="black" points="4466,-2328.14 4462.5,-2318.14 4459,-2328.14 4466,-2328.14"/>
</g>
<!-- residual1_s0_gpu4 -->
<g id="node57" class="node">
<title>residual1_s0_gpu4</title>
<polygon fill="lightblue" stroke="black" points="4525,-2229 4400,-2229 4400,-2177 4525,-2177 4525,-2229"/>
<text text-anchor="middle" x="4462.5" y="-2217" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="4462.5" y="-2206" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-2195" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="4462.5" y="-2184" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s0_gpu4&#45;&gt;residual1_s0_gpu4 -->
<g id="edge60" class="edge">
<title>attn_proj_s0_gpu4&#45;&gt;residual1_s0_gpu4</title>
<path fill="none" stroke="black" d="M4462.5,-2265.78C4462.5,-2265.78 4462.5,-2239.03 4462.5,-2239.03"/>
<polygon fill="black" stroke="black" points="4466,-2239.03 4462.5,-2229.03 4459,-2239.03 4466,-2239.03"/>
</g>
<!-- allreduce1_s0_gpu4 -->
<g id="node58" class="node">
<title>allreduce1_s0_gpu4</title>
<polygon fill="orange" stroke="black" points="4594.34,-2140 4384.61,-2140 4330.66,-2036 4540.39,-2036 4594.34,-2140"/>
<text text-anchor="middle" x="4462.5" y="-2102" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="4462.5" y="-2091" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-2080" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4462.5" y="-2069" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s0_gpu4&#45;&gt;allreduce1_s0_gpu4 -->
<g id="edge61" class="edge">
<title>residual1_s0_gpu4&#45;&gt;allreduce1_s0_gpu4</title>
<path fill="none" stroke="black" d="M4462.5,-2176.9C4462.5,-2176.9 4462.5,-2150.32 4462.5,-2150.32"/>
<polygon fill="black" stroke="black" points="4466,-2150.32 4462.5,-2140.32 4459,-2150.32 4466,-2150.32"/>
</g>
<!-- ln2_s0_gpu4 -->
<g id="node59" class="node">
<title>ln2_s0_gpu4</title>
<polygon fill="lightblue" stroke="black" points="4526,-1999 4399,-1999 4399,-1947 4526,-1947 4526,-1999"/>
<text text-anchor="middle" x="4462.5" y="-1987" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="4462.5" y="-1976" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-1965" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4462.5" y="-1954" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s0_gpu4&#45;&gt;ln2_s0_gpu4 -->
<g id="edge62" class="edge">
<title>allreduce1_s0_gpu4&#45;&gt;ln2_s0_gpu4</title>
<path fill="none" stroke="black" d="M4462.5,-2035.88C4462.5,-2035.88 4462.5,-2009.19 4462.5,-2009.19"/>
<polygon fill="black" stroke="black" points="4466,-2009.19 4462.5,-1999.19 4459,-2009.19 4466,-2009.19"/>
</g>
<!-- mlp1_s0_gpu4 -->
<g id="node60" class="node">
<title>mlp1_s0_gpu4</title>
<polygon fill="lightblue" stroke="black" points="4526,-1910 4399,-1910 4399,-1858 4526,-1858 4526,-1910"/>
<text text-anchor="middle" x="4462.5" y="-1898" font-family="Arial" font-size="10.00">MLP1&#45;Shard4</text>
<text text-anchor="middle" x="4462.5" y="-1887" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-1876" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4462.5" y="-1865" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s0_gpu4&#45;&gt;mlp1_s0_gpu4 -->
<g id="edge63" class="edge">
<title>ln2_s0_gpu4&#45;&gt;mlp1_s0_gpu4</title>
<path fill="none" stroke="black" d="M4462.5,-1946.78C4462.5,-1946.78 4462.5,-1920.03 4462.5,-1920.03"/>
<polygon fill="black" stroke="black" points="4466,-1920.03 4462.5,-1910.03 4459,-1920.03 4466,-1920.03"/>
</g>
<!-- gelu_s0_gpu4 -->
<g id="node61" class="node">
<title>gelu_s0_gpu4</title>
<polygon fill="lightblue" stroke="black" points="4526,-1821 4399,-1821 4399,-1769 4526,-1769 4526,-1821"/>
<text text-anchor="middle" x="4462.5" y="-1809" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="4462.5" y="-1798" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-1787" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="4462.5" y="-1776" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s0_gpu4&#45;&gt;gelu_s0_gpu4 -->
<g id="edge64" class="edge">
<title>mlp1_s0_gpu4&#45;&gt;gelu_s0_gpu4</title>
<path fill="none" stroke="black" d="M4462.5,-1857.78C4462.5,-1857.78 4462.5,-1831.03 4462.5,-1831.03"/>
<polygon fill="black" stroke="black" points="4466,-1831.03 4462.5,-1821.03 4459,-1831.03 4466,-1831.03"/>
</g>
<!-- mlp2_s0_gpu4 -->
<g id="node62" class="node">
<title>mlp2_s0_gpu4</title>
<polygon fill="lightblue" stroke="black" points="4523.5,-1732 4401.5,-1732 4401.5,-1680 4523.5,-1680 4523.5,-1732"/>
<text text-anchor="middle" x="4462.5" y="-1720" font-family="Arial" font-size="10.00">MLP2&#45;Shard4</text>
<text text-anchor="middle" x="4462.5" y="-1709" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-1698" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="4462.5" y="-1687" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s0_gpu4&#45;&gt;mlp2_s0_gpu4 -->
<g id="edge65" class="edge">
<title>gelu_s0_gpu4&#45;&gt;mlp2_s0_gpu4</title>
<path fill="none" stroke="black" d="M4462.5,-1768.78C4462.5,-1768.78 4462.5,-1742.03 4462.5,-1742.03"/>
<polygon fill="black" stroke="black" points="4466,-1742.03 4462.5,-1732.03 4459,-1742.03 4466,-1742.03"/>
</g>
<!-- residual2_s0_gpu4 -->
<g id="node63" class="node">
<title>residual2_s0_gpu4</title>
<polygon fill="lightblue" stroke="black" points="4525,-1643 4400,-1643 4400,-1591 4525,-1591 4525,-1643"/>
<text text-anchor="middle" x="4462.5" y="-1631" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="4462.5" y="-1620" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-1609" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="4462.5" y="-1598" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s0_gpu4&#45;&gt;residual2_s0_gpu4 -->
<g id="edge66" class="edge">
<title>mlp2_s0_gpu4&#45;&gt;residual2_s0_gpu4</title>
<path fill="none" stroke="black" d="M4462.5,-1679.78C4462.5,-1679.78 4462.5,-1653.03 4462.5,-1653.03"/>
<polygon fill="black" stroke="black" points="4466,-1653.03 4462.5,-1643.03 4459,-1653.03 4466,-1653.03"/>
</g>
<!-- allreduce2_s0_gpu4 -->
<g id="node64" class="node">
<title>allreduce2_s0_gpu4</title>
<polygon fill="orange" stroke="black" points="4594.34,-1554 4384.61,-1554 4330.66,-1450 4540.39,-1450 4594.34,-1554"/>
<text text-anchor="middle" x="4462.5" y="-1516" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="4462.5" y="-1505" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="4462.5" y="-1494" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4462.5" y="-1483" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s0_gpu4&#45;&gt;allreduce2_s0_gpu4 -->
<g id="edge67" class="edge">
<title>residual2_s0_gpu4&#45;&gt;allreduce2_s0_gpu4</title>
<path fill="none" stroke="black" d="M4462.5,-1590.9C4462.5,-1590.9 4462.5,-1564.32 4462.5,-1564.32"/>
<polygon fill="black" stroke="black" points="4466,-1564.32 4462.5,-1554.32 4459,-1564.32 4466,-1564.32"/>
</g>
<!-- gate_s0_gpu4 -->
<g id="node66" class="node">
<title>gate_s0_gpu4</title>
<polygon fill="gold" stroke="black" points="7185.75,-1394 6989.69,-1394 6939.25,-1268 7135.31,-1268 7185.75,-1394"/>
<text text-anchor="middle" x="7062.5" y="-1350.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="7062.5" y="-1339.5" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="7062.5" y="-1328.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="7062.5" y="-1317.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7062.5" y="-1306.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s0_gpu4&#45;&gt;gate_s0_gpu4 -->
<g id="edge68" class="edge">
<title>allreduce2_s0_gpu4&#45;&gt;gate_s0_gpu4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4574.08,-1501.85C4574.08,-1498.68 4574.08,-1448 4574.08,-1448 4574.08,-1448 7062.5,-1448 7062.5,-1448 7062.5,-1448 7062.5,-1404.29 7062.5,-1404.29"/>
<polygon fill="black" stroke="black" points="7066,-1404.29 7062.5,-1394.29 7059,-1404.29 7066,-1404.29"/>
</g>
<!-- allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu8 -->
<g id="edge145" class="edge">
<title>allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4375.72,-1449.79C4375.72,-1427.27 4375.72,-1406 4375.72,-1406 4375.72,-1406 3367.08,-1406 3367.08,-1406 3367.08,-1406 3367.08,-1367.23 3367.08,-1367.23"/>
<polygon fill="black" stroke="black" points="3370.58,-1367.23 3367.08,-1357.23 3363.58,-1367.23 3370.58,-1367.23"/>
<text text-anchor="middle" x="3546" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="3546" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu9 -->
<g id="edge146" class="edge">
<title>allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4567.5,-1502C4705.09,-1502 4929.08,-1502 4929.08,-1502 4929.08,-1502 4929.08,-1339 4929.08,-1339 4929.08,-1339 5451.96,-1339 5451.96,-1339"/>
<polygon fill="black" stroke="black" points="5451.96,-1342.5 5461.96,-1339 5451.96,-1335.5 5451.96,-1342.5"/>
<text text-anchor="middle" x="5850" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="5850" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu10 -->
<g id="edge147" class="edge">
<title>allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4342.05,-1449.8C4342.05,-1437.56 4342.05,-1428 4342.05,-1428 4342.05,-1428 1298.78,-1428 1298.78,-1428 1298.78,-1428 1298.78,-1367.25 1298.78,-1367.25"/>
<polygon fill="black" stroke="black" points="1302.28,-1367.25 1298.78,-1357.25 1295.28,-1367.25 1302.28,-1367.25"/>
<text text-anchor="middle" x="1338" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="1338" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu11 -->
<g id="edge148" class="edge">
<title>allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4584.13,-1501.89C4584.13,-1497.16 4584.13,-1346 4584.13,-1346 4584.13,-1346 4683.93,-1346 4683.93,-1346"/>
<polygon fill="black" stroke="black" points="4683.93,-1349.5 4693.93,-1346 4683.93,-1342.5 4683.93,-1349.5"/>
<text text-anchor="middle" x="5082" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="5082" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu12 -->
<g id="edge149" class="edge">
<title>allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4386.95,-1449.91C4386.95,-1394.58 4386.95,-1315 4386.95,-1315 4386.95,-1315 4063.36,-1315 4063.36,-1315"/>
<polygon fill="black" stroke="black" points="4063.36,-1311.5 4053.36,-1315 4063.36,-1318.5 4063.36,-1311.5"/>
<text text-anchor="middle" x="4314" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4314" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu13 -->
<g id="edge150" class="edge">
<title>allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4364.5,-1449.82C4364.5,-1429.05 4364.5,-1410 4364.5,-1410 4364.5,-1410 2593.63,-1410 2593.63,-1410 2593.63,-1410 2593.63,-1367.31 2593.63,-1367.31"/>
<polygon fill="black" stroke="black" points="2597.13,-1367.31 2593.63,-1357.31 2590.13,-1367.31 2597.13,-1367.31"/>
<text text-anchor="middle" x="2778" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2778" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu14 -->
<g id="edge151" class="edge">
<title>allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4564.04,-1495.23C4564.04,-1479.73 4564.04,-1443 4564.04,-1443 4564.04,-1443 6338.12,-1443 6338.12,-1443 6338.12,-1443 6338.12,-1367.26 6338.12,-1367.26"/>
<polygon fill="black" stroke="black" points="6341.63,-1367.26 6338.12,-1357.26 6334.63,-1367.26 6341.63,-1367.26"/>
<text text-anchor="middle" x="6618" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="6618" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu15 -->
<g id="edge152" class="edge">
<title>allreduce2_s0_gpu4&#45;&gt;ln1_s1_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4353.28,-1449.79C4353.28,-1430.84 4353.28,-1414 4353.28,-1414 4353.28,-1414 1813.25,-1414 1813.25,-1414 1813.25,-1414 1813.25,-1367.26 1813.25,-1367.26"/>
<polygon fill="black" stroke="black" points="1816.75,-1367.26 1813.25,-1357.26 1809.75,-1367.26 1816.75,-1367.26"/>
<text text-anchor="middle" x="2010" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2010" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- experts_s0_gpu4 -->
<g id="node65" class="node">
<title>experts_s0_gpu4</title>
<path fill="lightcoral" stroke="black" d="M7458,-1231C7458,-1231 7355,-1231 7355,-1231 7349,-1231 7343,-1225 7343,-1219 7343,-1219 7343,-1180 7343,-1180 7343,-1174 7349,-1168 7355,-1168 7355,-1168 7458,-1168 7458,-1168 7464,-1168 7470,-1174 7470,-1180 7470,-1180 7470,-1219 7470,-1219 7470,-1225 7464,-1231 7458,-1231"/>
<text text-anchor="middle" x="7406.5" y="-1219" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="7406.5" y="-1208" font-family="Arial" font-size="10.00">GPU:4</text>
<text text-anchor="middle" x="7406.5" y="-1197" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="7406.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7406.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- experts_s0_gpu4&#45;&gt;ln1_s0_gpu4 -->
<g id="edge70" class="edge">
<title>experts_s0_gpu4&#45;&gt;ln1_s0_gpu4</title>
<path fill="none" stroke="black" d="M7342.77,-1210C7286.55,-1210 7213.5,-1210 7213.5,-1210 7213.5,-1210 7213.5,-2481 7213.5,-2481 7213.5,-2481 4536.12,-2481 4536.12,-2481"/>
<polygon fill="black" stroke="black" points="4536.12,-2477.5 4526.12,-2481 4536.12,-2484.5 4536.12,-2477.5"/>
</g>
<!-- gate_s0_gpu4&#45;&gt;experts_s0_gpu4 -->
<g id="edge69" class="edge">
<title>gate_s0_gpu4&#45;&gt;experts_s0_gpu4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7155.44,-1317.9C7155.44,-1282.74 7155.44,-1189 7155.44,-1189 7155.44,-1189 7332.82,-1189 7332.82,-1189"/>
<polygon fill="black" stroke="black" points="7332.82,-1192.5 7342.82,-1189 7332.82,-1185.5 7332.82,-1192.5"/>
</g>
<!-- attn_s0_gpu5 -->
<g id="node68" class="node">
<title>attn_s0_gpu5</title>
<polygon fill="lightblue" stroke="black" points="3961.5,-2418 3839.5,-2418 3839.5,-2355 3961.5,-2355 3961.5,-2418"/>
<text text-anchor="middle" x="3900.5" y="-2406" font-family="Arial" font-size="10.00">MHA&#45;Shard5</text>
<text text-anchor="middle" x="3900.5" y="-2395" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-2384" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="3900.5" y="-2373" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3900.5" y="-2362" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s0_gpu5&#45;&gt;attn_s0_gpu5 -->
<g id="edge72" class="edge">
<title>ln1_s0_gpu5&#45;&gt;attn_s0_gpu5</title>
<path fill="none" stroke="black" d="M3880.17,-2454.93C3880.17,-2454.93 3880.17,-2428.21 3880.17,-2428.21"/>
<polygon fill="black" stroke="black" points="3883.67,-2428.21 3880.17,-2418.21 3876.67,-2428.21 3883.67,-2428.21"/>
</g>
<!-- attn_proj_s0_gpu5 -->
<g id="node69" class="node">
<title>attn_proj_s0_gpu5</title>
<polygon fill="lightblue" stroke="black" points="3961.5,-2318 3839.5,-2318 3839.5,-2266 3961.5,-2266 3961.5,-2318"/>
<text text-anchor="middle" x="3900.5" y="-2306" font-family="Arial" font-size="10.00">AttnProj&#45;Shard5</text>
<text text-anchor="middle" x="3900.5" y="-2295" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-2284" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3900.5" y="-2273" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s0_gpu5&#45;&gt;attn_proj_s0_gpu5 -->
<g id="edge73" class="edge">
<title>attn_s0_gpu5&#45;&gt;attn_proj_s0_gpu5</title>
<path fill="none" stroke="black" d="M3900.5,-2354.77C3900.5,-2354.77 3900.5,-2328.14 3900.5,-2328.14"/>
<polygon fill="black" stroke="black" points="3904,-2328.14 3900.5,-2318.14 3897,-2328.14 3904,-2328.14"/>
</g>
<!-- residual1_s0_gpu5 -->
<g id="node70" class="node">
<title>residual1_s0_gpu5</title>
<polygon fill="lightblue" stroke="black" points="3963,-2229 3838,-2229 3838,-2177 3963,-2177 3963,-2229"/>
<text text-anchor="middle" x="3900.5" y="-2217" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="3900.5" y="-2206" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-2195" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="3900.5" y="-2184" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s0_gpu5&#45;&gt;residual1_s0_gpu5 -->
<g id="edge74" class="edge">
<title>attn_proj_s0_gpu5&#45;&gt;residual1_s0_gpu5</title>
<path fill="none" stroke="black" d="M3900.5,-2265.78C3900.5,-2265.78 3900.5,-2239.03 3900.5,-2239.03"/>
<polygon fill="black" stroke="black" points="3904,-2239.03 3900.5,-2229.03 3897,-2239.03 3904,-2239.03"/>
</g>
<!-- allreduce1_s0_gpu5 -->
<g id="node71" class="node">
<title>allreduce1_s0_gpu5</title>
<polygon fill="orange" stroke="black" points="4032.34,-2140 3822.61,-2140 3768.66,-2036 3978.39,-2036 4032.34,-2140"/>
<text text-anchor="middle" x="3900.5" y="-2102" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="3900.5" y="-2091" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-2080" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3900.5" y="-2069" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s0_gpu5&#45;&gt;allreduce1_s0_gpu5 -->
<g id="edge75" class="edge">
<title>residual1_s0_gpu5&#45;&gt;allreduce1_s0_gpu5</title>
<path fill="none" stroke="black" d="M3900.5,-2176.9C3900.5,-2176.9 3900.5,-2150.32 3900.5,-2150.32"/>
<polygon fill="black" stroke="black" points="3904,-2150.32 3900.5,-2140.32 3897,-2150.32 3904,-2150.32"/>
</g>
<!-- ln2_s0_gpu5 -->
<g id="node72" class="node">
<title>ln2_s0_gpu5</title>
<polygon fill="lightblue" stroke="black" points="3964,-1999 3837,-1999 3837,-1947 3964,-1947 3964,-1999"/>
<text text-anchor="middle" x="3900.5" y="-1987" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="3900.5" y="-1976" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-1965" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3900.5" y="-1954" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s0_gpu5&#45;&gt;ln2_s0_gpu5 -->
<g id="edge76" class="edge">
<title>allreduce1_s0_gpu5&#45;&gt;ln2_s0_gpu5</title>
<path fill="none" stroke="black" d="M3900.5,-2035.88C3900.5,-2035.88 3900.5,-2009.19 3900.5,-2009.19"/>
<polygon fill="black" stroke="black" points="3904,-2009.19 3900.5,-1999.19 3897,-2009.19 3904,-2009.19"/>
</g>
<!-- mlp1_s0_gpu5 -->
<g id="node73" class="node">
<title>mlp1_s0_gpu5</title>
<polygon fill="lightblue" stroke="black" points="3964,-1910 3837,-1910 3837,-1858 3964,-1858 3964,-1910"/>
<text text-anchor="middle" x="3900.5" y="-1898" font-family="Arial" font-size="10.00">MLP1&#45;Shard5</text>
<text text-anchor="middle" x="3900.5" y="-1887" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-1876" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3900.5" y="-1865" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s0_gpu5&#45;&gt;mlp1_s0_gpu5 -->
<g id="edge77" class="edge">
<title>ln2_s0_gpu5&#45;&gt;mlp1_s0_gpu5</title>
<path fill="none" stroke="black" d="M3900.5,-1946.78C3900.5,-1946.78 3900.5,-1920.03 3900.5,-1920.03"/>
<polygon fill="black" stroke="black" points="3904,-1920.03 3900.5,-1910.03 3897,-1920.03 3904,-1920.03"/>
</g>
<!-- gelu_s0_gpu5 -->
<g id="node74" class="node">
<title>gelu_s0_gpu5</title>
<polygon fill="lightblue" stroke="black" points="3964,-1821 3837,-1821 3837,-1769 3964,-1769 3964,-1821"/>
<text text-anchor="middle" x="3900.5" y="-1809" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="3900.5" y="-1798" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-1787" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="3900.5" y="-1776" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s0_gpu5&#45;&gt;gelu_s0_gpu5 -->
<g id="edge78" class="edge">
<title>mlp1_s0_gpu5&#45;&gt;gelu_s0_gpu5</title>
<path fill="none" stroke="black" d="M3900.5,-1857.78C3900.5,-1857.78 3900.5,-1831.03 3900.5,-1831.03"/>
<polygon fill="black" stroke="black" points="3904,-1831.03 3900.5,-1821.03 3897,-1831.03 3904,-1831.03"/>
</g>
<!-- mlp2_s0_gpu5 -->
<g id="node75" class="node">
<title>mlp2_s0_gpu5</title>
<polygon fill="lightblue" stroke="black" points="3961.5,-1732 3839.5,-1732 3839.5,-1680 3961.5,-1680 3961.5,-1732"/>
<text text-anchor="middle" x="3900.5" y="-1720" font-family="Arial" font-size="10.00">MLP2&#45;Shard5</text>
<text text-anchor="middle" x="3900.5" y="-1709" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-1698" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="3900.5" y="-1687" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s0_gpu5&#45;&gt;mlp2_s0_gpu5 -->
<g id="edge79" class="edge">
<title>gelu_s0_gpu5&#45;&gt;mlp2_s0_gpu5</title>
<path fill="none" stroke="black" d="M3900.5,-1768.78C3900.5,-1768.78 3900.5,-1742.03 3900.5,-1742.03"/>
<polygon fill="black" stroke="black" points="3904,-1742.03 3900.5,-1732.03 3897,-1742.03 3904,-1742.03"/>
</g>
<!-- residual2_s0_gpu5 -->
<g id="node76" class="node">
<title>residual2_s0_gpu5</title>
<polygon fill="lightblue" stroke="black" points="3963,-1643 3838,-1643 3838,-1591 3963,-1591 3963,-1643"/>
<text text-anchor="middle" x="3900.5" y="-1631" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="3900.5" y="-1620" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-1609" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="3900.5" y="-1598" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s0_gpu5&#45;&gt;residual2_s0_gpu5 -->
<g id="edge80" class="edge">
<title>mlp2_s0_gpu5&#45;&gt;residual2_s0_gpu5</title>
<path fill="none" stroke="black" d="M3900.5,-1679.78C3900.5,-1679.78 3900.5,-1653.03 3900.5,-1653.03"/>
<polygon fill="black" stroke="black" points="3904,-1653.03 3900.5,-1643.03 3897,-1653.03 3904,-1653.03"/>
</g>
<!-- allreduce2_s0_gpu5 -->
<g id="node77" class="node">
<title>allreduce2_s0_gpu5</title>
<polygon fill="orange" stroke="black" points="4032.34,-1554 3822.61,-1554 3768.66,-1450 3978.39,-1450 4032.34,-1554"/>
<text text-anchor="middle" x="3900.5" y="-1516" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="3900.5" y="-1505" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="3900.5" y="-1494" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3900.5" y="-1483" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s0_gpu5&#45;&gt;allreduce2_s0_gpu5 -->
<g id="edge81" class="edge">
<title>residual2_s0_gpu5&#45;&gt;allreduce2_s0_gpu5</title>
<path fill="none" stroke="black" d="M3900.5,-1590.9C3900.5,-1590.9 3900.5,-1564.32 3900.5,-1564.32"/>
<polygon fill="black" stroke="black" points="3904,-1564.32 3900.5,-1554.32 3897,-1564.32 3904,-1564.32"/>
</g>
<!-- gate_s0_gpu5 -->
<g id="node79" class="node">
<title>gate_s0_gpu5</title>
<polygon fill="gold" stroke="black" points="6618.75,-1394 6422.69,-1394 6372.25,-1268 6568.31,-1268 6618.75,-1394"/>
<text text-anchor="middle" x="6495.5" y="-1350.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="6495.5" y="-1339.5" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="6495.5" y="-1328.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="6495.5" y="-1317.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6495.5" y="-1306.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s0_gpu5&#45;&gt;gate_s0_gpu5 -->
<g id="edge82" class="edge">
<title>allreduce2_s0_gpu5&#45;&gt;gate_s0_gpu5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3984.98,-1462.48C3984.98,-1429.89 3984.98,-1389 3984.98,-1389 3984.98,-1389 6410.37,-1389 6410.37,-1389"/>
<polygon fill="black" stroke="black" points="6410.37,-1392.5 6420.37,-1389 6410.37,-1385.5 6410.37,-1392.5"/>
</g>
<!-- allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu8 -->
<g id="edge153" class="edge">
<title>allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3833.48,-1449.94C3833.48,-1396.78 3833.48,-1322 3833.48,-1322 3833.48,-1322 3391.03,-1322 3391.03,-1322"/>
<polygon fill="black" stroke="black" points="3391.03,-1318.5 3381.03,-1322 3391.03,-1325.5 3391.03,-1318.5"/>
<text text-anchor="middle" x="3354" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="3354" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu9 -->
<g id="edge154" class="edge">
<title>allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4008.57,-1501.94C4008.57,-1499.61 4008.57,-1425 4008.57,-1425 4008.57,-1425 5541.38,-1425 5541.38,-1425 5541.38,-1425 5541.38,-1367.18 5541.38,-1367.18"/>
<polygon fill="black" stroke="black" points="5544.88,-1367.18 5541.38,-1357.18 5537.88,-1367.18 5544.88,-1367.18"/>
<text text-anchor="middle" x="5658" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="5658" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu10 -->
<g id="edge155" class="edge">
<title>allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3778.07,-1449.67C3778.07,-1438.51 3778.07,-1430 3778.07,-1430 3778.07,-1430 1270.56,-1430 1270.56,-1430 1270.56,-1430 1270.56,-1367.01 1270.56,-1367.01"/>
<polygon fill="black" stroke="black" points="1274.06,-1367.01 1270.56,-1357.01 1267.06,-1367.01 1274.06,-1367.01"/>
<text text-anchor="middle" x="1146" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="1146" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu11 -->
<g id="edge156" class="edge">
<title>allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3996.78,-1485.04C3996.78,-1456.51 3996.78,-1402 3996.78,-1402 3996.78,-1402 4799.83,-1402 4799.83,-1402 4799.83,-1402 4799.83,-1367.03 4799.83,-1367.03"/>
<polygon fill="black" stroke="black" points="4803.33,-1367.03 4799.83,-1357.03 4796.33,-1367.03 4803.33,-1367.03"/>
<text text-anchor="middle" x="4890" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4890" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu12 -->
<g id="edge157" class="edge">
<title>allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3973.19,-1449.77C3973.19,-1449.77 3973.19,-1367.18 3973.19,-1367.18"/>
<polygon fill="black" stroke="black" points="3976.69,-1367.18 3973.19,-1357.18 3969.69,-1367.18 3976.69,-1367.18"/>
<text text-anchor="middle" x="4122" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4122" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu13 -->
<g id="edge158" class="edge">
<title>allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3796.54,-1449.97C3796.54,-1430.49 3796.54,-1413 3796.54,-1413 3796.54,-1413 2574.26,-1413 2574.26,-1413 2574.26,-1413 2574.26,-1367.4 2574.26,-1367.4"/>
<polygon fill="black" stroke="black" points="2577.76,-1367.4 2574.26,-1357.4 2570.76,-1367.4 2577.76,-1367.4"/>
<text text-anchor="middle" x="2586" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2586" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu14 -->
<g id="edge159" class="edge">
<title>allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4020.37,-1501.96C4020.37,-1500.11 4020.37,-1441 4020.37,-1441 4020.37,-1441 6306.38,-1441 6306.38,-1441 6306.38,-1441 6306.38,-1367.07 6306.38,-1367.07"/>
<polygon fill="black" stroke="black" points="6309.88,-1367.07 6306.38,-1357.07 6302.88,-1367.07 6309.88,-1367.07"/>
<text text-anchor="middle" x="6426" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="6426" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu15 -->
<g id="edge160" class="edge">
<title>allreduce2_s0_gpu5&#45;&gt;ln1_s1_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M3787.3,-1449.99C3787.3,-1431.88 3787.3,-1416 3787.3,-1416 3787.3,-1416 1781.5,-1416 1781.5,-1416 1781.5,-1416 1781.5,-1367.43 1781.5,-1367.43"/>
<polygon fill="black" stroke="black" points="1785,-1367.43 1781.5,-1357.43 1778,-1367.43 1785,-1367.43"/>
<text text-anchor="middle" x="1818" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="1818" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- experts_s0_gpu5 -->
<g id="node78" class="node">
<title>experts_s0_gpu5</title>
<path fill="lightcoral" stroke="black" d="M6815,-1231C6815,-1231 6712,-1231 6712,-1231 6706,-1231 6700,-1225 6700,-1219 6700,-1219 6700,-1180 6700,-1180 6700,-1174 6706,-1168 6712,-1168 6712,-1168 6815,-1168 6815,-1168 6821,-1168 6827,-1174 6827,-1180 6827,-1180 6827,-1219 6827,-1219 6827,-1225 6821,-1231 6815,-1231"/>
<text text-anchor="middle" x="6763.5" y="-1219" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="6763.5" y="-1208" font-family="Arial" font-size="10.00">GPU:5</text>
<text text-anchor="middle" x="6763.5" y="-1197" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="6763.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6763.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- experts_s0_gpu5&#45;&gt;ln1_s0_gpu5 -->
<g id="edge84" class="edge">
<title>experts_s0_gpu5&#45;&gt;ln1_s0_gpu5</title>
<path fill="none" stroke="black" d="M6699.72,-1210C6664.57,-1210 6628,-1210 6628,-1210 6628,-1210 6628,-2447 6628,-2447 6628,-2447 3920.83,-2447 3920.83,-2447 3920.83,-2447 3920.83,-2447.79 3920.83,-2447.79"/>
<polygon fill="black" stroke="black" points="3917.33,-2444.89 3920.83,-2454.89 3924.33,-2444.89 3917.33,-2444.89"/>
</g>
<!-- gate_s0_gpu5&#45;&gt;experts_s0_gpu5 -->
<g id="edge83" class="edge">
<title>gate_s0_gpu5&#45;&gt;experts_s0_gpu5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6495.5,-1267.89C6495.5,-1229.97 6495.5,-1189 6495.5,-1189 6495.5,-1189 6689.99,-1189 6689.99,-1189"/>
<polygon fill="black" stroke="black" points="6689.99,-1192.5 6699.99,-1189 6689.99,-1185.5 6689.99,-1192.5"/>
</g>
<!-- attn_s0_gpu6 -->
<g id="node81" class="node">
<title>attn_s0_gpu6</title>
<polygon fill="lightblue" stroke="black" points="7533.5,-2418 7411.5,-2418 7411.5,-2355 7533.5,-2355 7533.5,-2418"/>
<text text-anchor="middle" x="7472.5" y="-2406" font-family="Arial" font-size="10.00">MHA&#45;Shard6</text>
<text text-anchor="middle" x="7472.5" y="-2395" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7472.5" y="-2384" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="7472.5" y="-2373" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7472.5" y="-2362" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s0_gpu6&#45;&gt;attn_s0_gpu6 -->
<g id="edge86" class="edge">
<title>ln1_s0_gpu6&#45;&gt;attn_s0_gpu6</title>
<path fill="none" stroke="black" d="M7472.5,-2454.93C7472.5,-2454.93 7472.5,-2428.21 7472.5,-2428.21"/>
<polygon fill="black" stroke="black" points="7476,-2428.21 7472.5,-2418.21 7469,-2428.21 7476,-2428.21"/>
</g>
<!-- attn_proj_s0_gpu6 -->
<g id="node82" class="node">
<title>attn_proj_s0_gpu6</title>
<polygon fill="lightblue" stroke="black" points="7533.5,-2318 7411.5,-2318 7411.5,-2266 7533.5,-2266 7533.5,-2318"/>
<text text-anchor="middle" x="7472.5" y="-2306" font-family="Arial" font-size="10.00">AttnProj&#45;Shard6</text>
<text text-anchor="middle" x="7472.5" y="-2295" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7472.5" y="-2284" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="7472.5" y="-2273" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s0_gpu6&#45;&gt;attn_proj_s0_gpu6 -->
<g id="edge87" class="edge">
<title>attn_s0_gpu6&#45;&gt;attn_proj_s0_gpu6</title>
<path fill="none" stroke="black" d="M7472.5,-2354.77C7472.5,-2354.77 7472.5,-2328.14 7472.5,-2328.14"/>
<polygon fill="black" stroke="black" points="7476,-2328.14 7472.5,-2318.14 7469,-2328.14 7476,-2328.14"/>
</g>
<!-- residual1_s0_gpu6 -->
<g id="node83" class="node">
<title>residual1_s0_gpu6</title>
<polygon fill="lightblue" stroke="black" points="7535,-2229 7410,-2229 7410,-2177 7535,-2177 7535,-2229"/>
<text text-anchor="middle" x="7472.5" y="-2217" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="7472.5" y="-2206" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7472.5" y="-2195" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="7472.5" y="-2184" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s0_gpu6&#45;&gt;residual1_s0_gpu6 -->
<g id="edge88" class="edge">
<title>attn_proj_s0_gpu6&#45;&gt;residual1_s0_gpu6</title>
<path fill="none" stroke="black" d="M7472.5,-2265.78C7472.5,-2265.78 7472.5,-2239.03 7472.5,-2239.03"/>
<polygon fill="black" stroke="black" points="7476,-2239.03 7472.5,-2229.03 7469,-2239.03 7476,-2239.03"/>
</g>
<!-- allreduce1_s0_gpu6 -->
<g id="node84" class="node">
<title>allreduce1_s0_gpu6</title>
<polygon fill="orange" stroke="black" points="7604.34,-2140 7394.61,-2140 7340.66,-2036 7550.39,-2036 7604.34,-2140"/>
<text text-anchor="middle" x="7472.5" y="-2102" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="7472.5" y="-2091" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7472.5" y="-2080" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="7472.5" y="-2069" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s0_gpu6&#45;&gt;allreduce1_s0_gpu6 -->
<g id="edge89" class="edge">
<title>residual1_s0_gpu6&#45;&gt;allreduce1_s0_gpu6</title>
<path fill="none" stroke="black" d="M7472.5,-2176.9C7472.5,-2176.9 7472.5,-2150.32 7472.5,-2150.32"/>
<polygon fill="black" stroke="black" points="7476,-2150.32 7472.5,-2140.32 7469,-2150.32 7476,-2150.32"/>
</g>
<!-- ln2_s0_gpu6 -->
<g id="node85" class="node">
<title>ln2_s0_gpu6</title>
<polygon fill="lightblue" stroke="black" points="7531,-1999 7404,-1999 7404,-1947 7531,-1947 7531,-1999"/>
<text text-anchor="middle" x="7467.5" y="-1987" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="7467.5" y="-1976" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7467.5" y="-1965" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7467.5" y="-1954" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s0_gpu6&#45;&gt;ln2_s0_gpu6 -->
<g id="edge90" class="edge">
<title>allreduce1_s0_gpu6&#45;&gt;ln2_s0_gpu6</title>
<path fill="none" stroke="black" d="M7467.5,-2035.88C7467.5,-2035.88 7467.5,-2009.19 7467.5,-2009.19"/>
<polygon fill="black" stroke="black" points="7471,-2009.19 7467.5,-1999.19 7464,-2009.19 7471,-2009.19"/>
</g>
<!-- mlp1_s0_gpu6 -->
<g id="node86" class="node">
<title>mlp1_s0_gpu6</title>
<polygon fill="lightblue" stroke="black" points="7529,-1910 7402,-1910 7402,-1858 7529,-1858 7529,-1910"/>
<text text-anchor="middle" x="7465.5" y="-1898" font-family="Arial" font-size="10.00">MLP1&#45;Shard6</text>
<text text-anchor="middle" x="7465.5" y="-1887" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7465.5" y="-1876" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7465.5" y="-1865" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s0_gpu6&#45;&gt;mlp1_s0_gpu6 -->
<g id="edge91" class="edge">
<title>ln2_s0_gpu6&#45;&gt;mlp1_s0_gpu6</title>
<path fill="none" stroke="black" d="M7466.5,-1946.78C7466.5,-1946.78 7466.5,-1920.03 7466.5,-1920.03"/>
<polygon fill="black" stroke="black" points="7470,-1920.03 7466.5,-1910.03 7463,-1920.03 7470,-1920.03"/>
</g>
<!-- gelu_s0_gpu6 -->
<g id="node87" class="node">
<title>gelu_s0_gpu6</title>
<polygon fill="lightblue" stroke="black" points="7511,-1821 7384,-1821 7384,-1769 7511,-1769 7511,-1821"/>
<text text-anchor="middle" x="7447.5" y="-1809" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="7447.5" y="-1798" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7447.5" y="-1787" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="7447.5" y="-1776" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s0_gpu6&#45;&gt;gelu_s0_gpu6 -->
<g id="edge92" class="edge">
<title>mlp1_s0_gpu6&#45;&gt;gelu_s0_gpu6</title>
<path fill="none" stroke="black" d="M7456.5,-1857.78C7456.5,-1857.78 7456.5,-1831.03 7456.5,-1831.03"/>
<polygon fill="black" stroke="black" points="7460,-1831.03 7456.5,-1821.03 7453,-1831.03 7460,-1831.03"/>
</g>
<!-- mlp2_s0_gpu6 -->
<g id="node88" class="node">
<title>mlp2_s0_gpu6</title>
<polygon fill="lightblue" stroke="black" points="7486.5,-1732 7364.5,-1732 7364.5,-1680 7486.5,-1680 7486.5,-1732"/>
<text text-anchor="middle" x="7425.5" y="-1720" font-family="Arial" font-size="10.00">MLP2&#45;Shard6</text>
<text text-anchor="middle" x="7425.5" y="-1709" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7425.5" y="-1698" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="7425.5" y="-1687" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s0_gpu6&#45;&gt;mlp2_s0_gpu6 -->
<g id="edge93" class="edge">
<title>gelu_s0_gpu6&#45;&gt;mlp2_s0_gpu6</title>
<path fill="none" stroke="black" d="M7435.25,-1768.78C7435.25,-1768.78 7435.25,-1742.03 7435.25,-1742.03"/>
<polygon fill="black" stroke="black" points="7438.75,-1742.03 7435.25,-1732.03 7431.75,-1742.03 7438.75,-1742.03"/>
</g>
<!-- residual2_s0_gpu6 -->
<g id="node89" class="node">
<title>residual2_s0_gpu6</title>
<polygon fill="lightblue" stroke="black" points="7483,-1643 7358,-1643 7358,-1591 7483,-1591 7483,-1643"/>
<text text-anchor="middle" x="7420.5" y="-1631" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="7420.5" y="-1620" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7420.5" y="-1609" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="7420.5" y="-1598" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s0_gpu6&#45;&gt;residual2_s0_gpu6 -->
<g id="edge94" class="edge">
<title>mlp2_s0_gpu6&#45;&gt;residual2_s0_gpu6</title>
<path fill="none" stroke="black" d="M7423.75,-1679.78C7423.75,-1679.78 7423.75,-1653.03 7423.75,-1653.03"/>
<polygon fill="black" stroke="black" points="7427.25,-1653.03 7423.75,-1643.03 7420.25,-1653.03 7427.25,-1653.03"/>
</g>
<!-- allreduce2_s0_gpu6 -->
<g id="node90" class="node">
<title>allreduce2_s0_gpu6</title>
<polygon fill="orange" stroke="black" points="5657.34,-1554 5447.61,-1554 5393.66,-1450 5603.39,-1450 5657.34,-1554"/>
<text text-anchor="middle" x="5525.5" y="-1516" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="5525.5" y="-1505" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="5525.5" y="-1494" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="5525.5" y="-1483" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s0_gpu6&#45;&gt;allreduce2_s0_gpu6 -->
<g id="edge95" class="edge">
<title>residual2_s0_gpu6&#45;&gt;allreduce2_s0_gpu6</title>
<path fill="none" stroke="black" d="M7420.5,-1591C7420.5,-1561.96 7420.5,-1519 7420.5,-1519 7420.5,-1519 5649.42,-1519 5649.42,-1519"/>
<polygon fill="black" stroke="black" points="5649.42,-1515.5 5639.42,-1519 5649.42,-1522.5 5649.42,-1515.5"/>
</g>
<!-- gate_s0_gpu6 -->
<g id="node92" class="node">
<title>gate_s0_gpu6</title>
<polygon fill="gold" stroke="black" points="7487.75,-1394 7291.69,-1394 7241.25,-1268 7437.31,-1268 7487.75,-1394"/>
<text text-anchor="middle" x="7364.5" y="-1350.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="7364.5" y="-1339.5" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7364.5" y="-1328.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="7364.5" y="-1317.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7364.5" y="-1306.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s0_gpu6&#45;&gt;gate_s0_gpu6 -->
<g id="edge96" class="edge">
<title>allreduce2_s0_gpu6&#45;&gt;gate_s0_gpu6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5621.05,-1484C5988.61,-1484 7290.98,-1484 7290.98,-1484 7290.98,-1484 7290.98,-1402.35 7290.98,-1402.35"/>
<polygon fill="black" stroke="black" points="7294.48,-1402.35 7290.98,-1392.35 7287.48,-1402.35 7294.48,-1402.35"/>
</g>
<!-- allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu8 -->
<g id="edge161" class="edge">
<title>allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M5403.74,-1449.81C5403.74,-1426.85 5403.74,-1405 5403.74,-1405 5403.74,-1405 3374.04,-1405 3374.04,-1405 3374.04,-1405 3374.04,-1367.3 3374.04,-1367.3"/>
<polygon fill="black" stroke="black" points="3377.54,-1367.3 3374.04,-1357.3 3370.54,-1367.3 3377.54,-1367.3"/>
<text text-anchor="middle" x="4410" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4410" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu9 -->
<g id="edge162" class="edge">
<title>allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M5573.12,-1449.77C5573.12,-1449.77 5573.12,-1367.18 5573.12,-1367.18"/>
<polygon fill="black" stroke="black" points="5576.63,-1367.18 5573.12,-1357.18 5569.63,-1367.18 5576.63,-1367.18"/>
<text text-anchor="middle" x="6714" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="6714" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu10 -->
<g id="edge163" class="edge">
<title>allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M5413.64,-1449.83C5413.64,-1412.93 5413.64,-1370 5413.64,-1370 5413.64,-1370 1312.89,-1370 1312.89,-1370 1312.89,-1370 1312.89,-1367.23 1312.89,-1367.23"/>
<polygon fill="black" stroke="black" points="1316.39,-1367.23 1312.89,-1357.23 1309.39,-1367.23 1316.39,-1367.23"/>
<text text-anchor="middle" x="2106" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2106" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu11 -->
<g id="edge164" class="edge">
<title>allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M5423.55,-1449.94C5423.55,-1396.78 5423.55,-1322 5423.55,-1322 5423.55,-1322 4831.06,-1322 4831.06,-1322"/>
<polygon fill="black" stroke="black" points="4831.06,-1318.5 4821.06,-1322 4831.06,-1325.5 4831.06,-1318.5"/>
<text text-anchor="middle" x="5946" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="5946" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu12 -->
<g id="edge165" class="edge">
<title>allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M5408.69,-1449.84C5408.69,-1426.44 5408.69,-1404 5408.69,-1404 5408.69,-1404 4041,-1404 4041,-1404 4041,-1404 4041,-1367.35 4041,-1367.35"/>
<polygon fill="black" stroke="black" points="4044.5,-1367.35 4041,-1357.35 4037.5,-1367.35 4044.5,-1367.35"/>
<text text-anchor="middle" x="5178" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="5178" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu13 -->
<g id="edge166" class="edge">
<title>allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M5398.78,-1449.79C5398.78,-1428.59 5398.78,-1409 5398.78,-1409 5398.78,-1409 2603.31,-1409 2603.31,-1409 2603.31,-1409 2603.31,-1367.41 2603.31,-1367.41"/>
<polygon fill="black" stroke="black" points="2606.81,-1367.41 2603.31,-1357.41 2599.81,-1367.41 2606.81,-1367.41"/>
<text text-anchor="middle" x="3642" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="3642" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu14 -->
<g id="edge167" class="edge">
<title>allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M5647.83,-1501.88C5647.83,-1496.95 5647.83,-1339 5647.83,-1339 5647.83,-1339 6216.82,-1339 6216.82,-1339"/>
<polygon fill="black" stroke="black" points="6216.82,-1342.5 6226.82,-1339 6216.82,-1335.5 6216.82,-1342.5"/>
<text text-anchor="middle" x="6835" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="6835" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu15 -->
<g id="edge168" class="edge">
<title>allreduce2_s0_gpu6&#45;&gt;ln1_s1_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M5418.59,-1449.81C5418.59,-1411.46 5418.59,-1366 5418.59,-1366 5418.59,-1366 1829.12,-1366 1829.12,-1366 1829.12,-1366 1829.12,-1365.12 1829.12,-1365.12"/>
<polygon fill="black" stroke="black" points="1832.63,-1367.17 1829.12,-1357.17 1825.63,-1367.17 1832.63,-1367.17"/>
<text text-anchor="middle" x="2874" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2874" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- experts_s0_gpu6 -->
<g id="node91" class="node">
<title>experts_s0_gpu6</title>
<path fill="lightcoral" stroke="black" d="M7637,-1231C7637,-1231 7534,-1231 7534,-1231 7528,-1231 7522,-1225 7522,-1219 7522,-1219 7522,-1180 7522,-1180 7522,-1174 7528,-1168 7534,-1168 7534,-1168 7637,-1168 7637,-1168 7643,-1168 7649,-1174 7649,-1180 7649,-1180 7649,-1219 7649,-1219 7649,-1225 7643,-1231 7637,-1231"/>
<text text-anchor="middle" x="7585.5" y="-1219" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="7585.5" y="-1208" font-family="Arial" font-size="10.00">GPU:6</text>
<text text-anchor="middle" x="7585.5" y="-1197" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="7585.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7585.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- experts_s0_gpu6&#45;&gt;ln1_s0_gpu6 -->
<g id="edge98" class="edge">
<title>experts_s0_gpu6&#45;&gt;ln1_s0_gpu6</title>
<path fill="none" stroke="black" d="M7626.58,-1231.18C7626.58,-1428.52 7626.58,-2481 7626.58,-2481 7626.58,-2481 7546.06,-2481 7546.06,-2481"/>
<polygon fill="black" stroke="black" points="7546.06,-2477.5 7536.06,-2481 7546.06,-2484.5 7546.06,-2477.5"/>
</g>
<!-- gate_s0_gpu6&#45;&gt;experts_s0_gpu6 -->
<g id="edge97" class="edge">
<title>gate_s0_gpu6&#45;&gt;experts_s0_gpu6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7478.94,-1330.9C7478.94,-1326.91 7478.94,-1199 7478.94,-1199 7478.94,-1199 7511.97,-1199 7511.97,-1199"/>
<polygon fill="black" stroke="black" points="7511.97,-1202.5 7521.97,-1199 7511.97,-1195.5 7511.97,-1202.5"/>
</g>
<!-- attn_s0_gpu7 -->
<g id="node94" class="node">
<title>attn_s0_gpu7</title>
<polygon fill="lightblue" stroke="black" points="4242.5,-2418 4120.5,-2418 4120.5,-2355 4242.5,-2355 4242.5,-2418"/>
<text text-anchor="middle" x="4181.5" y="-2406" font-family="Arial" font-size="10.00">MHA&#45;Shard7</text>
<text text-anchor="middle" x="4181.5" y="-2395" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-2384" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="4181.5" y="-2373" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4181.5" y="-2362" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s0_gpu7&#45;&gt;attn_s0_gpu7 -->
<g id="edge100" class="edge">
<title>ln1_s0_gpu7&#45;&gt;attn_s0_gpu7</title>
<path fill="none" stroke="black" d="M4181.5,-2454.93C4181.5,-2454.93 4181.5,-2428.21 4181.5,-2428.21"/>
<polygon fill="black" stroke="black" points="4185,-2428.21 4181.5,-2418.21 4178,-2428.21 4185,-2428.21"/>
</g>
<!-- attn_proj_s0_gpu7 -->
<g id="node95" class="node">
<title>attn_proj_s0_gpu7</title>
<polygon fill="lightblue" stroke="black" points="4242.5,-2318 4120.5,-2318 4120.5,-2266 4242.5,-2266 4242.5,-2318"/>
<text text-anchor="middle" x="4181.5" y="-2306" font-family="Arial" font-size="10.00">AttnProj&#45;Shard7</text>
<text text-anchor="middle" x="4181.5" y="-2295" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-2284" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4181.5" y="-2273" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s0_gpu7&#45;&gt;attn_proj_s0_gpu7 -->
<g id="edge101" class="edge">
<title>attn_s0_gpu7&#45;&gt;attn_proj_s0_gpu7</title>
<path fill="none" stroke="black" d="M4181.5,-2354.77C4181.5,-2354.77 4181.5,-2328.14 4181.5,-2328.14"/>
<polygon fill="black" stroke="black" points="4185,-2328.14 4181.5,-2318.14 4178,-2328.14 4185,-2328.14"/>
</g>
<!-- residual1_s0_gpu7 -->
<g id="node96" class="node">
<title>residual1_s0_gpu7</title>
<polygon fill="lightblue" stroke="black" points="4244,-2229 4119,-2229 4119,-2177 4244,-2177 4244,-2229"/>
<text text-anchor="middle" x="4181.5" y="-2217" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="4181.5" y="-2206" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-2195" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="4181.5" y="-2184" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s0_gpu7&#45;&gt;residual1_s0_gpu7 -->
<g id="edge102" class="edge">
<title>attn_proj_s0_gpu7&#45;&gt;residual1_s0_gpu7</title>
<path fill="none" stroke="black" d="M4181.5,-2265.78C4181.5,-2265.78 4181.5,-2239.03 4181.5,-2239.03"/>
<polygon fill="black" stroke="black" points="4185,-2239.03 4181.5,-2229.03 4178,-2239.03 4185,-2239.03"/>
</g>
<!-- allreduce1_s0_gpu7 -->
<g id="node97" class="node">
<title>allreduce1_s0_gpu7</title>
<polygon fill="orange" stroke="black" points="4313.34,-2140 4103.61,-2140 4049.66,-2036 4259.39,-2036 4313.34,-2140"/>
<text text-anchor="middle" x="4181.5" y="-2102" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="4181.5" y="-2091" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-2080" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4181.5" y="-2069" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s0_gpu7&#45;&gt;allreduce1_s0_gpu7 -->
<g id="edge103" class="edge">
<title>residual1_s0_gpu7&#45;&gt;allreduce1_s0_gpu7</title>
<path fill="none" stroke="black" d="M4181.5,-2176.9C4181.5,-2176.9 4181.5,-2150.32 4181.5,-2150.32"/>
<polygon fill="black" stroke="black" points="4185,-2150.32 4181.5,-2140.32 4178,-2150.32 4185,-2150.32"/>
</g>
<!-- ln2_s0_gpu7 -->
<g id="node98" class="node">
<title>ln2_s0_gpu7</title>
<polygon fill="lightblue" stroke="black" points="4245,-1999 4118,-1999 4118,-1947 4245,-1947 4245,-1999"/>
<text text-anchor="middle" x="4181.5" y="-1987" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="4181.5" y="-1976" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-1965" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4181.5" y="-1954" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s0_gpu7&#45;&gt;ln2_s0_gpu7 -->
<g id="edge104" class="edge">
<title>allreduce1_s0_gpu7&#45;&gt;ln2_s0_gpu7</title>
<path fill="none" stroke="black" d="M4181.5,-2035.88C4181.5,-2035.88 4181.5,-2009.19 4181.5,-2009.19"/>
<polygon fill="black" stroke="black" points="4185,-2009.19 4181.5,-1999.19 4178,-2009.19 4185,-2009.19"/>
</g>
<!-- mlp1_s0_gpu7 -->
<g id="node99" class="node">
<title>mlp1_s0_gpu7</title>
<polygon fill="lightblue" stroke="black" points="4245,-1910 4118,-1910 4118,-1858 4245,-1858 4245,-1910"/>
<text text-anchor="middle" x="4181.5" y="-1898" font-family="Arial" font-size="10.00">MLP1&#45;Shard7</text>
<text text-anchor="middle" x="4181.5" y="-1887" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-1876" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4181.5" y="-1865" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s0_gpu7&#45;&gt;mlp1_s0_gpu7 -->
<g id="edge105" class="edge">
<title>ln2_s0_gpu7&#45;&gt;mlp1_s0_gpu7</title>
<path fill="none" stroke="black" d="M4181.5,-1946.78C4181.5,-1946.78 4181.5,-1920.03 4181.5,-1920.03"/>
<polygon fill="black" stroke="black" points="4185,-1920.03 4181.5,-1910.03 4178,-1920.03 4185,-1920.03"/>
</g>
<!-- gelu_s0_gpu7 -->
<g id="node100" class="node">
<title>gelu_s0_gpu7</title>
<polygon fill="lightblue" stroke="black" points="4245,-1821 4118,-1821 4118,-1769 4245,-1769 4245,-1821"/>
<text text-anchor="middle" x="4181.5" y="-1809" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="4181.5" y="-1798" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-1787" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="4181.5" y="-1776" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s0_gpu7&#45;&gt;gelu_s0_gpu7 -->
<g id="edge106" class="edge">
<title>mlp1_s0_gpu7&#45;&gt;gelu_s0_gpu7</title>
<path fill="none" stroke="black" d="M4181.5,-1857.78C4181.5,-1857.78 4181.5,-1831.03 4181.5,-1831.03"/>
<polygon fill="black" stroke="black" points="4185,-1831.03 4181.5,-1821.03 4178,-1831.03 4185,-1831.03"/>
</g>
<!-- mlp2_s0_gpu7 -->
<g id="node101" class="node">
<title>mlp2_s0_gpu7</title>
<polygon fill="lightblue" stroke="black" points="4242.5,-1732 4120.5,-1732 4120.5,-1680 4242.5,-1680 4242.5,-1732"/>
<text text-anchor="middle" x="4181.5" y="-1720" font-family="Arial" font-size="10.00">MLP2&#45;Shard7</text>
<text text-anchor="middle" x="4181.5" y="-1709" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-1698" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="4181.5" y="-1687" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s0_gpu7&#45;&gt;mlp2_s0_gpu7 -->
<g id="edge107" class="edge">
<title>gelu_s0_gpu7&#45;&gt;mlp2_s0_gpu7</title>
<path fill="none" stroke="black" d="M4181.5,-1768.78C4181.5,-1768.78 4181.5,-1742.03 4181.5,-1742.03"/>
<polygon fill="black" stroke="black" points="4185,-1742.03 4181.5,-1732.03 4178,-1742.03 4185,-1742.03"/>
</g>
<!-- residual2_s0_gpu7 -->
<g id="node102" class="node">
<title>residual2_s0_gpu7</title>
<polygon fill="lightblue" stroke="black" points="4244,-1643 4119,-1643 4119,-1591 4244,-1591 4244,-1643"/>
<text text-anchor="middle" x="4181.5" y="-1631" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="4181.5" y="-1620" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-1609" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="4181.5" y="-1598" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s0_gpu7&#45;&gt;residual2_s0_gpu7 -->
<g id="edge108" class="edge">
<title>mlp2_s0_gpu7&#45;&gt;residual2_s0_gpu7</title>
<path fill="none" stroke="black" d="M4181.5,-1679.78C4181.5,-1679.78 4181.5,-1653.03 4181.5,-1653.03"/>
<polygon fill="black" stroke="black" points="4185,-1653.03 4181.5,-1643.03 4178,-1653.03 4185,-1653.03"/>
</g>
<!-- allreduce2_s0_gpu7 -->
<g id="node103" class="node">
<title>allreduce2_s0_gpu7</title>
<polygon fill="orange" stroke="black" points="4313.34,-1554 4103.61,-1554 4049.66,-1450 4259.39,-1450 4313.34,-1554"/>
<text text-anchor="middle" x="4181.5" y="-1516" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="4181.5" y="-1505" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="4181.5" y="-1494" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4181.5" y="-1483" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s0_gpu7&#45;&gt;allreduce2_s0_gpu7 -->
<g id="edge109" class="edge">
<title>residual2_s0_gpu7&#45;&gt;allreduce2_s0_gpu7</title>
<path fill="none" stroke="black" d="M4181.5,-1590.9C4181.5,-1590.9 4181.5,-1564.32 4181.5,-1564.32"/>
<polygon fill="black" stroke="black" points="4185,-1564.32 4181.5,-1554.32 4178,-1564.32 4185,-1564.32"/>
</g>
<!-- gate_s0_gpu7 -->
<g id="node105" class="node">
<title>gate_s0_gpu7</title>
<polygon fill="gold" stroke="black" points="6883.75,-1394 6687.69,-1394 6637.25,-1268 6833.31,-1268 6883.75,-1394"/>
<text text-anchor="middle" x="6760.5" y="-1350.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="6760.5" y="-1339.5" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="6760.5" y="-1328.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="6760.5" y="-1317.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6760.5" y="-1306.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s0_gpu7&#45;&gt;gate_s0_gpu7 -->
<g id="edge110" class="edge">
<title>allreduce2_s0_gpu7&#45;&gt;gate_s0_gpu7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4241.83,-1449.96C4241.83,-1448.09 4241.83,-1447 4241.83,-1447 4241.83,-1447 6760.5,-1447 6760.5,-1447 6760.5,-1447 6760.5,-1404.09 6760.5,-1404.09"/>
<polygon fill="black" stroke="black" points="6764,-1404.09 6760.5,-1394.09 6757,-1404.09 6764,-1404.09"/>
</g>
<!-- allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu8 -->
<g id="edge169" class="edge">
<title>allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4095.11,-1449.78C4095.11,-1428.14 4095.11,-1408 4095.11,-1408 4095.11,-1408 3360.13,-1408 3360.13,-1408 3360.13,-1408 3360.13,-1367.07 3360.13,-1367.07"/>
<polygon fill="black" stroke="black" points="3363.63,-1367.07 3360.13,-1357.07 3356.63,-1367.07 3363.63,-1367.07"/>
<text text-anchor="middle" x="3450" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="3450" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu9 -->
<g id="edge170" class="edge">
<title>allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4170.5,-1449.91C4170.5,-1437.11 4170.5,-1427 4170.5,-1427 4170.5,-1427 5557.25,-1427 5557.25,-1427 5557.25,-1427 5557.25,-1367.23 5557.25,-1367.23"/>
<polygon fill="black" stroke="black" points="5560.75,-1367.23 5557.25,-1357.23 5553.75,-1367.23 5560.75,-1367.23"/>
<text text-anchor="middle" x="5754" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="5754" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu10 -->
<g id="edge171" class="edge">
<title>allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4063.53,-1449.72C4063.53,-1438.02 4063.53,-1429 4063.53,-1429 4063.53,-1429 1284.67,-1429 1284.67,-1429 1284.67,-1429 1284.67,-1367 1284.67,-1367"/>
<polygon fill="black" stroke="black" points="1288.17,-1367 1284.67,-1357 1281.17,-1367 1288.17,-1367"/>
<text text-anchor="middle" x="1242" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="1242" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu11 -->
<g id="edge172" class="edge">
<title>allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4277.5,-1484.86C4277.5,-1442.45 4277.5,-1336 4277.5,-1336 4277.5,-1336 4683.76,-1336 4683.76,-1336"/>
<polygon fill="black" stroke="black" points="4683.76,-1339.5 4693.76,-1336 4683.76,-1332.5 4683.76,-1339.5"/>
<text text-anchor="middle" x="4986" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4986" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu12 -->
<g id="edge173" class="edge">
<title>allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4105.64,-1449.85C4105.64,-1397.64 4105.64,-1325 4105.64,-1325 4105.64,-1325 4063.01,-1325 4063.01,-1325"/>
<polygon fill="black" stroke="black" points="4063.01,-1321.5 4053.01,-1325 4063.01,-1328.5 4063.01,-1321.5"/>
<text text-anchor="middle" x="4218" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="4218" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu13 -->
<g id="edge174" class="edge">
<title>allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4084.58,-1449.86C4084.58,-1429.52 4084.58,-1411 4084.58,-1411 4084.58,-1411 2583.94,-1411 2583.94,-1411 2583.94,-1411 2583.94,-1367.19 2583.94,-1367.19"/>
<polygon fill="black" stroke="black" points="2587.44,-1367.19 2583.94,-1357.19 2580.44,-1367.2 2587.44,-1367.19"/>
<text text-anchor="middle" x="2682" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="2682" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu14 -->
<g id="edge175" class="edge">
<title>allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4206.17,-1449.84C4206.17,-1445.08 4206.17,-1442 4206.17,-1442 4206.17,-1442 6322.25,-1442 6322.25,-1442 6322.25,-1442 6322.25,-1367.02 6322.25,-1367.02"/>
<polygon fill="black" stroke="black" points="6325.75,-1367.02 6322.25,-1357.02 6318.75,-1367.02 6325.75,-1367.02"/>
<text text-anchor="middle" x="6522" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="6522" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu15 -->
<g id="edge176" class="edge">
<title>allreduce2_s0_gpu7&#45;&gt;ln1_s1_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M4074.06,-1449.88C4074.06,-1431.36 4074.06,-1415 4074.06,-1415 4074.06,-1415 1797.38,-1415 1797.38,-1415 1797.38,-1415 1797.38,-1367.12 1797.38,-1367.12"/>
<polygon fill="black" stroke="black" points="1800.88,-1367.12 1797.38,-1357.12 1793.88,-1367.12 1800.88,-1367.12"/>
<text text-anchor="middle" x="1914" y="-1424.8" font-family="Arial" font-size="9.00">Pipeline Transfer</text>
<text text-anchor="middle" x="1914" y="-1414.8" font-family="Arial" font-size="9.00">[128,10000,4096]</text>
</g>
<!-- experts_s0_gpu7 -->
<g id="node104" class="node">
<title>experts_s0_gpu7</title>
<path fill="lightcoral" stroke="black" d="M7113,-1231C7113,-1231 7010,-1231 7010,-1231 7004,-1231 6998,-1225 6998,-1219 6998,-1219 6998,-1180 6998,-1180 6998,-1174 7004,-1168 7010,-1168 7010,-1168 7113,-1168 7113,-1168 7119,-1168 7125,-1174 7125,-1180 7125,-1180 7125,-1219 7125,-1219 7125,-1225 7119,-1231 7113,-1231"/>
<text text-anchor="middle" x="7061.5" y="-1219" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="7061.5" y="-1208" font-family="Arial" font-size="10.00">GPU:7</text>
<text text-anchor="middle" x="7061.5" y="-1197" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="7061.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7061.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- experts_s0_gpu7&#45;&gt;ln1_s0_gpu7 -->
<g id="edge112" class="edge">
<title>experts_s0_gpu7&#45;&gt;ln1_s0_gpu7</title>
<path fill="none" stroke="black" d="M7061.5,-1231.13C7061.5,-1240.83 7061.5,-1249 7061.5,-1249 7061.5,-1249 4322,-1249 4322,-1249 4322,-1249 4322,-2481 4322,-2481 4322,-2481 4255.17,-2481 4255.17,-2481"/>
<polygon fill="black" stroke="black" points="4255.17,-2477.5 4245.17,-2481 4255.17,-2484.5 4255.17,-2477.5"/>
</g>
<!-- gate_s0_gpu7&#45;&gt;experts_s0_gpu7 -->
<g id="edge111" class="edge">
<title>gate_s0_gpu7&#45;&gt;experts_s0_gpu7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6855.44,-1323.14C6855.44,-1294.72 6855.44,-1199 6855.44,-1199 6855.44,-1199 6987.99,-1199 6987.99,-1199"/>
<polygon fill="black" stroke="black" points="6987.99,-1202.5 6997.99,-1199 6987.99,-1195.5 6987.99,-1202.5"/>
</g>
<!-- attn_s1_gpu8 -->
<g id="node107" class="node">
<title>attn_s1_gpu8</title>
<polygon fill="lightgreen" stroke="black" points="3378.5,-1231 3256.5,-1231 3256.5,-1168 3378.5,-1168 3378.5,-1231"/>
<text text-anchor="middle" x="3317.5" y="-1219" font-family="Arial" font-size="10.00">MHA&#45;Shard0</text>
<text text-anchor="middle" x="3317.5" y="-1208" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3317.5" y="-1197" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="3317.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3317.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s1_gpu8&#45;&gt;attn_s1_gpu8 -->
<g id="edge177" class="edge">
<title>ln1_s1_gpu8&#45;&gt;attn_s1_gpu8</title>
<path fill="none" stroke="black" d="M3317.5,-1304.71C3317.5,-1304.71 3317.5,-1241.32 3317.5,-1241.32"/>
<polygon fill="black" stroke="black" points="3321,-1241.32 3317.5,-1231.32 3314,-1241.32 3321,-1241.32"/>
</g>
<!-- attn_proj_s1_gpu8 -->
<g id="node108" class="node">
<title>attn_proj_s1_gpu8</title>
<polygon fill="lightgreen" stroke="black" points="3378.5,-1131 3256.5,-1131 3256.5,-1079 3378.5,-1079 3378.5,-1131"/>
<text text-anchor="middle" x="3317.5" y="-1119" font-family="Arial" font-size="10.00">AttnProj&#45;Shard0</text>
<text text-anchor="middle" x="3317.5" y="-1108" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3317.5" y="-1097" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3317.5" y="-1086" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s1_gpu8&#45;&gt;attn_proj_s1_gpu8 -->
<g id="edge178" class="edge">
<title>attn_s1_gpu8&#45;&gt;attn_proj_s1_gpu8</title>
<path fill="none" stroke="black" d="M3317.5,-1167.77C3317.5,-1167.77 3317.5,-1141.14 3317.5,-1141.14"/>
<polygon fill="black" stroke="black" points="3321,-1141.14 3317.5,-1131.14 3314,-1141.14 3321,-1141.14"/>
</g>
<!-- residual1_s1_gpu8 -->
<g id="node109" class="node">
<title>residual1_s1_gpu8</title>
<polygon fill="lightgreen" stroke="black" points="3382,-1042 3257,-1042 3257,-990 3382,-990 3382,-1042"/>
<text text-anchor="middle" x="3319.5" y="-1030" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="3319.5" y="-1019" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3319.5" y="-1008" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="3319.5" y="-997" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s1_gpu8&#45;&gt;residual1_s1_gpu8 -->
<g id="edge179" class="edge">
<title>attn_proj_s1_gpu8&#45;&gt;residual1_s1_gpu8</title>
<path fill="none" stroke="black" d="M3317.75,-1078.78C3317.75,-1078.78 3317.75,-1052.03 3317.75,-1052.03"/>
<polygon fill="black" stroke="black" points="3321.25,-1052.03 3317.75,-1042.03 3314.25,-1052.03 3321.25,-1052.03"/>
</g>
<!-- allreduce1_s1_gpu8 -->
<g id="node110" class="node">
<title>allreduce1_s1_gpu8</title>
<polygon fill="orange" stroke="black" points="3451.34,-953 3241.61,-953 3187.66,-849 3397.39,-849 3451.34,-953"/>
<text text-anchor="middle" x="3319.5" y="-915" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="3319.5" y="-904" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3319.5" y="-893" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3319.5" y="-882" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s1_gpu8&#45;&gt;allreduce1_s1_gpu8 -->
<g id="edge180" class="edge">
<title>residual1_s1_gpu8&#45;&gt;allreduce1_s1_gpu8</title>
<path fill="none" stroke="black" d="M3319.5,-989.9C3319.5,-989.9 3319.5,-963.32 3319.5,-963.32"/>
<polygon fill="black" stroke="black" points="3323,-963.32 3319.5,-953.32 3316,-963.32 3323,-963.32"/>
</g>
<!-- ln2_s1_gpu8 -->
<g id="node111" class="node">
<title>ln2_s1_gpu8</title>
<polygon fill="lightgreen" stroke="black" points="3383,-812 3256,-812 3256,-760 3383,-760 3383,-812"/>
<text text-anchor="middle" x="3319.5" y="-800" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="3319.5" y="-789" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3319.5" y="-778" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3319.5" y="-767" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s1_gpu8&#45;&gt;ln2_s1_gpu8 -->
<g id="edge181" class="edge">
<title>allreduce1_s1_gpu8&#45;&gt;ln2_s1_gpu8</title>
<path fill="none" stroke="black" d="M3319.5,-848.88C3319.5,-848.88 3319.5,-822.19 3319.5,-822.19"/>
<polygon fill="black" stroke="black" points="3323,-822.19 3319.5,-812.19 3316,-822.19 3323,-822.19"/>
</g>
<!-- mlp1_s1_gpu8 -->
<g id="node112" class="node">
<title>mlp1_s1_gpu8</title>
<polygon fill="lightgreen" stroke="black" points="3384,-723 3257,-723 3257,-671 3384,-671 3384,-723"/>
<text text-anchor="middle" x="3320.5" y="-711" font-family="Arial" font-size="10.00">MLP1&#45;Shard0</text>
<text text-anchor="middle" x="3320.5" y="-700" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3320.5" y="-689" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3320.5" y="-678" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s1_gpu8&#45;&gt;mlp1_s1_gpu8 -->
<g id="edge182" class="edge">
<title>ln2_s1_gpu8&#45;&gt;mlp1_s1_gpu8</title>
<path fill="none" stroke="black" d="M3320,-759.78C3320,-759.78 3320,-733.03 3320,-733.03"/>
<polygon fill="black" stroke="black" points="3323.5,-733.03 3320,-723.03 3316.5,-733.03 3323.5,-733.03"/>
</g>
<!-- gelu_s1_gpu8 -->
<g id="node113" class="node">
<title>gelu_s1_gpu8</title>
<polygon fill="lightgreen" stroke="black" points="3384,-634 3257,-634 3257,-582 3384,-582 3384,-634"/>
<text text-anchor="middle" x="3320.5" y="-622" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="3320.5" y="-611" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3320.5" y="-600" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="3320.5" y="-589" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s1_gpu8&#45;&gt;gelu_s1_gpu8 -->
<g id="edge183" class="edge">
<title>mlp1_s1_gpu8&#45;&gt;gelu_s1_gpu8</title>
<path fill="none" stroke="black" d="M3320.5,-670.78C3320.5,-670.78 3320.5,-644.03 3320.5,-644.03"/>
<polygon fill="black" stroke="black" points="3324,-644.03 3320.5,-634.03 3317,-644.03 3324,-644.03"/>
</g>
<!-- mlp2_s1_gpu8 -->
<g id="node114" class="node">
<title>mlp2_s1_gpu8</title>
<polygon fill="lightgreen" stroke="black" points="3381.5,-545 3259.5,-545 3259.5,-493 3381.5,-493 3381.5,-545"/>
<text text-anchor="middle" x="3320.5" y="-533" font-family="Arial" font-size="10.00">MLP2&#45;Shard0</text>
<text text-anchor="middle" x="3320.5" y="-522" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3320.5" y="-511" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="3320.5" y="-500" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s1_gpu8&#45;&gt;mlp2_s1_gpu8 -->
<g id="edge184" class="edge">
<title>gelu_s1_gpu8&#45;&gt;mlp2_s1_gpu8</title>
<path fill="none" stroke="black" d="M3320.5,-581.78C3320.5,-581.78 3320.5,-555.03 3320.5,-555.03"/>
<polygon fill="black" stroke="black" points="3324,-555.03 3320.5,-545.03 3317,-555.03 3324,-555.03"/>
</g>
<!-- residual2_s1_gpu8 -->
<g id="node115" class="node">
<title>residual2_s1_gpu8</title>
<polygon fill="lightgreen" stroke="black" points="3383,-456 3258,-456 3258,-404 3383,-404 3383,-456"/>
<text text-anchor="middle" x="3320.5" y="-444" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="3320.5" y="-433" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3320.5" y="-422" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="3320.5" y="-411" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s1_gpu8&#45;&gt;residual2_s1_gpu8 -->
<g id="edge185" class="edge">
<title>mlp2_s1_gpu8&#45;&gt;residual2_s1_gpu8</title>
<path fill="none" stroke="black" d="M3320.5,-492.78C3320.5,-492.78 3320.5,-466.03 3320.5,-466.03"/>
<polygon fill="black" stroke="black" points="3324,-466.03 3320.5,-456.03 3317,-466.03 3324,-466.03"/>
</g>
<!-- allreduce2_s1_gpu8 -->
<g id="node116" class="node">
<title>allreduce2_s1_gpu8</title>
<polygon fill="orange" stroke="black" points="3452.34,-367 3242.61,-367 3188.66,-263 3398.39,-263 3452.34,-367"/>
<text text-anchor="middle" x="3320.5" y="-329" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="3320.5" y="-318" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3320.5" y="-307" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3320.5" y="-296" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s1_gpu8&#45;&gt;allreduce2_s1_gpu8 -->
<g id="edge186" class="edge">
<title>residual2_s1_gpu8&#45;&gt;allreduce2_s1_gpu8</title>
<path fill="none" stroke="black" d="M3320.5,-403.9C3320.5,-403.9 3320.5,-377.32 3320.5,-377.32"/>
<polygon fill="black" stroke="black" points="3324,-377.32 3320.5,-367.32 3317,-377.32 3324,-377.32"/>
</g>
<!-- gate_s1_gpu8 -->
<g id="node118" class="node">
<title>gate_s1_gpu8</title>
<polygon fill="gold" stroke="black" points="3443.75,-226 3247.69,-226 3197.25,-100 3393.31,-100 3443.75,-226"/>
<text text-anchor="middle" x="3320.5" y="-182.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="3320.5" y="-171.5" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3320.5" y="-160.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="3320.5" y="-149.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3320.5" y="-138.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s1_gpu8&#45;&gt;gate_s1_gpu8 -->
<g id="edge187" class="edge">
<title>allreduce2_s1_gpu8&#45;&gt;gate_s1_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3320.5,-262.69C3320.5,-262.69 3320.5,-236.16 3320.5,-236.16"/>
<polygon fill="black" stroke="black" points="3324,-236.16 3320.5,-226.16 3317,-236.16 3324,-236.16"/>
</g>
<!-- output -->
<g id="node210" class="node">
<title>output</title>
<ellipse fill="yellow" stroke="black" cx="3652.5" cy="-163" rx="190.42" ry="28.98"/>
<text text-anchor="middle" x="3652.5" y="-171.5" font-family="Arial" font-size="10.00">Output</text>
<text text-anchor="middle" x="3652.5" y="-160.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, d_model=4096]</text>
<text text-anchor="middle" x="3652.5" y="-149.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, d_model=4096]</text>
</g>
<!-- allreduce2_s1_gpu8&#45;&gt;output -->
<g id="edge189" class="edge">
<title>allreduce2_s1_gpu8&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3448.02,-314.89C3448.02,-310.29 3448.02,-163 3448.02,-163 3448.02,-163 3452.08,-163 3452.08,-163"/>
<polygon fill="black" stroke="black" points="3452.08,-166.5 3462.08,-163 3452.08,-159.5 3452.08,-166.5"/>
</g>
<!-- experts_s1_gpu8 -->
<g id="node117" class="node">
<title>experts_s1_gpu8</title>
<path fill="lightcoral" stroke="black" d="M3372,-63C3372,-63 3269,-63 3269,-63 3263,-63 3257,-57 3257,-51 3257,-51 3257,-12 3257,-12 3257,-6 3263,0 3269,0 3269,0 3372,0 3372,0 3378,0 3384,-6 3384,-12 3384,-12 3384,-51 3384,-51 3384,-57 3378,-63 3372,-63"/>
<text text-anchor="middle" x="3320.5" y="-51" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="3320.5" y="-40" font-family="Arial" font-size="10.00">GPU:8</text>
<text text-anchor="middle" x="3320.5" y="-29" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="3320.5" y="-18" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3320.5" y="-7" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- gate_s1_gpu8&#45;&gt;experts_s1_gpu8 -->
<g id="edge188" class="edge">
<title>gate_s1_gpu8&#45;&gt;experts_s1_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3320.5,-99.95C3320.5,-99.95 3320.5,-73.11 3320.5,-73.11"/>
<polygon fill="black" stroke="black" points="3324,-73.11 3320.5,-63.11 3317,-73.11 3324,-73.11"/>
</g>
<!-- attn_s1_gpu9 -->
<g id="node120" class="node">
<title>attn_s1_gpu9</title>
<polygon fill="lightgreen" stroke="black" points="5562.5,-1231 5440.5,-1231 5440.5,-1168 5562.5,-1168 5562.5,-1231"/>
<text text-anchor="middle" x="5501.5" y="-1219" font-family="Arial" font-size="10.00">MHA&#45;Shard1</text>
<text text-anchor="middle" x="5501.5" y="-1208" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="5501.5" y="-1197" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="5501.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5501.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s1_gpu9&#45;&gt;attn_s1_gpu9 -->
<g id="edge190" class="edge">
<title>ln1_s1_gpu9&#45;&gt;attn_s1_gpu9</title>
<path fill="none" stroke="black" d="M5512.25,-1304.71C5512.25,-1304.71 5512.25,-1241.32 5512.25,-1241.32"/>
<polygon fill="black" stroke="black" points="5515.75,-1241.32 5512.25,-1231.32 5508.75,-1241.32 5515.75,-1241.32"/>
</g>
<!-- attn_proj_s1_gpu9 -->
<g id="node121" class="node">
<title>attn_proj_s1_gpu9</title>
<polygon fill="lightgreen" stroke="black" points="5550.5,-1131 5428.5,-1131 5428.5,-1079 5550.5,-1079 5550.5,-1131"/>
<text text-anchor="middle" x="5489.5" y="-1119" font-family="Arial" font-size="10.00">AttnProj&#45;Shard1</text>
<text text-anchor="middle" x="5489.5" y="-1108" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="5489.5" y="-1097" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="5489.5" y="-1086" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s1_gpu9&#45;&gt;attn_proj_s1_gpu9 -->
<g id="edge191" class="edge">
<title>attn_s1_gpu9&#45;&gt;attn_proj_s1_gpu9</title>
<path fill="none" stroke="black" d="M5495.5,-1167.77C5495.5,-1167.77 5495.5,-1141.14 5495.5,-1141.14"/>
<polygon fill="black" stroke="black" points="5499,-1141.14 5495.5,-1131.14 5492,-1141.14 5499,-1141.14"/>
</g>
<!-- residual1_s1_gpu9 -->
<g id="node122" class="node">
<title>residual1_s1_gpu9</title>
<polygon fill="lightgreen" stroke="black" points="5376,-1042 5251,-1042 5251,-990 5376,-990 5376,-1042"/>
<text text-anchor="middle" x="5313.5" y="-1030" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="5313.5" y="-1019" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="5313.5" y="-1008" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="5313.5" y="-997" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s1_gpu9&#45;&gt;residual1_s1_gpu9 -->
<g id="edge192" class="edge">
<title>attn_proj_s1_gpu9&#45;&gt;residual1_s1_gpu9</title>
<path fill="none" stroke="black" d="M5476.75,-1078.78C5476.75,-1052.53 5476.75,-1016 5476.75,-1016 5476.75,-1016 5386.15,-1016 5386.15,-1016"/>
<polygon fill="black" stroke="black" points="5386.15,-1012.5 5376.15,-1016 5386.15,-1019.5 5386.15,-1012.5"/>
</g>
<!-- allreduce1_s1_gpu9 -->
<g id="node123" class="node">
<title>allreduce1_s1_gpu9</title>
<polygon fill="orange" stroke="black" points="5246.34,-953 5036.61,-953 4982.66,-849 5192.39,-849 5246.34,-953"/>
<text text-anchor="middle" x="5114.5" y="-915" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="5114.5" y="-904" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="5114.5" y="-893" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="5114.5" y="-882" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s1_gpu9&#45;&gt;allreduce1_s1_gpu9 -->
<g id="edge193" class="edge">
<title>residual1_s1_gpu9&#45;&gt;allreduce1_s1_gpu9</title>
<path fill="none" stroke="black" d="M5276.42,-989.9C5276.42,-955.97 5276.42,-901 5276.42,-901 5276.42,-901 5229.79,-901 5229.79,-901"/>
<polygon fill="black" stroke="black" points="5229.79,-897.5 5219.79,-901 5229.79,-904.5 5229.79,-897.5"/>
</g>
<!-- ln2_s1_gpu9 -->
<g id="node124" class="node">
<title>ln2_s1_gpu9</title>
<polygon fill="lightgreen" stroke="black" points="5163,-812 5036,-812 5036,-760 5163,-760 5163,-812"/>
<text text-anchor="middle" x="5099.5" y="-800" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="5099.5" y="-789" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="5099.5" y="-778" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5099.5" y="-767" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s1_gpu9&#45;&gt;ln2_s1_gpu9 -->
<g id="edge194" class="edge">
<title>allreduce1_s1_gpu9&#45;&gt;ln2_s1_gpu9</title>
<path fill="none" stroke="black" d="M5099.5,-848.88C5099.5,-848.88 5099.5,-822.19 5099.5,-822.19"/>
<polygon fill="black" stroke="black" points="5103,-822.19 5099.5,-812.19 5096,-822.19 5103,-822.19"/>
</g>
<!-- mlp1_s1_gpu9 -->
<g id="node125" class="node">
<title>mlp1_s1_gpu9</title>
<polygon fill="lightgreen" stroke="black" points="5096,-723 4969,-723 4969,-671 5096,-671 5096,-723"/>
<text text-anchor="middle" x="5032.5" y="-711" font-family="Arial" font-size="10.00">MLP1&#45;Shard1</text>
<text text-anchor="middle" x="5032.5" y="-700" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="5032.5" y="-689" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5032.5" y="-678" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s1_gpu9&#45;&gt;mlp1_s1_gpu9 -->
<g id="edge195" class="edge">
<title>ln2_s1_gpu9&#45;&gt;mlp1_s1_gpu9</title>
<path fill="none" stroke="black" d="M5066,-759.78C5066,-759.78 5066,-733.03 5066,-733.03"/>
<polygon fill="black" stroke="black" points="5069.5,-733.03 5066,-723.03 5062.5,-733.03 5069.5,-733.03"/>
</g>
<!-- gelu_s1_gpu9 -->
<g id="node126" class="node">
<title>gelu_s1_gpu9</title>
<polygon fill="lightgreen" stroke="black" points="4991,-634 4864,-634 4864,-582 4991,-582 4991,-634"/>
<text text-anchor="middle" x="4927.5" y="-622" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="4927.5" y="-611" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="4927.5" y="-600" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="4927.5" y="-589" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s1_gpu9&#45;&gt;gelu_s1_gpu9 -->
<g id="edge196" class="edge">
<title>mlp1_s1_gpu9&#45;&gt;gelu_s1_gpu9</title>
<path fill="none" stroke="black" d="M4980,-670.78C4980,-670.78 4980,-644.03 4980,-644.03"/>
<polygon fill="black" stroke="black" points="4983.5,-644.03 4980,-634.03 4976.5,-644.03 4983.5,-644.03"/>
</g>
<!-- mlp2_s1_gpu9 -->
<g id="node127" class="node">
<title>mlp2_s1_gpu9</title>
<polygon fill="lightgreen" stroke="black" points="4882.5,-545 4760.5,-545 4760.5,-493 4882.5,-493 4882.5,-545"/>
<text text-anchor="middle" x="4821.5" y="-533" font-family="Arial" font-size="10.00">MLP2&#45;Shard1</text>
<text text-anchor="middle" x="4821.5" y="-522" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="4821.5" y="-511" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="4821.5" y="-500" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s1_gpu9&#45;&gt;mlp2_s1_gpu9 -->
<g id="edge197" class="edge">
<title>gelu_s1_gpu9&#45;&gt;mlp2_s1_gpu9</title>
<path fill="none" stroke="black" d="M4873.25,-581.78C4873.25,-581.78 4873.25,-555.03 4873.25,-555.03"/>
<polygon fill="black" stroke="black" points="4876.75,-555.03 4873.25,-545.03 4869.75,-555.03 4876.75,-555.03"/>
</g>
<!-- residual2_s1_gpu9 -->
<g id="node128" class="node">
<title>residual2_s1_gpu9</title>
<polygon fill="lightgreen" stroke="black" points="4712,-456 4587,-456 4587,-404 4712,-404 4712,-456"/>
<text text-anchor="middle" x="4649.5" y="-444" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="4649.5" y="-433" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="4649.5" y="-422" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="4649.5" y="-411" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s1_gpu9&#45;&gt;residual2_s1_gpu9 -->
<g id="edge198" class="edge">
<title>mlp2_s1_gpu9&#45;&gt;residual2_s1_gpu9</title>
<path fill="none" stroke="black" d="M4760.46,-519C4728.73,-519 4696.5,-519 4696.5,-519 4696.5,-519 4696.5,-466.22 4696.5,-466.22"/>
<polygon fill="black" stroke="black" points="4700,-466.22 4696.5,-456.22 4693,-466.22 4700,-466.22"/>
</g>
<!-- allreduce2_s1_gpu9 -->
<g id="node129" class="node">
<title>allreduce2_s1_gpu9</title>
<polygon fill="orange" stroke="black" points="4680.34,-367 4470.61,-367 4416.66,-263 4626.39,-263 4680.34,-367"/>
<text text-anchor="middle" x="4548.5" y="-329" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="4548.5" y="-318" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="4548.5" y="-307" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4548.5" y="-296" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s1_gpu9&#45;&gt;allreduce2_s1_gpu9 -->
<g id="edge199" class="edge">
<title>residual2_s1_gpu9&#45;&gt;allreduce2_s1_gpu9</title>
<path fill="none" stroke="black" d="M4633.58,-403.9C4633.58,-403.9 4633.58,-377.32 4633.58,-377.32"/>
<polygon fill="black" stroke="black" points="4637.08,-377.32 4633.58,-367.32 4630.08,-377.32 4637.08,-377.32"/>
</g>
<!-- gate_s1_gpu9 -->
<g id="node131" class="node">
<title>gate_s1_gpu9</title>
<polygon fill="gold" stroke="black" points="4671.75,-226 4475.69,-226 4425.25,-100 4621.31,-100 4671.75,-226"/>
<text text-anchor="middle" x="4548.5" y="-182.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="4548.5" y="-171.5" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="4548.5" y="-160.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="4548.5" y="-149.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4548.5" y="-138.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s1_gpu9&#45;&gt;gate_s1_gpu9 -->
<g id="edge200" class="edge">
<title>allreduce2_s1_gpu9&#45;&gt;gate_s1_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4548.5,-262.69C4548.5,-262.69 4548.5,-236.16 4548.5,-236.16"/>
<polygon fill="black" stroke="black" points="4552,-236.16 4548.5,-226.16 4545,-236.16 4552,-236.16"/>
</g>
<!-- allreduce2_s1_gpu9&#45;&gt;output -->
<g id="edge202" class="edge">
<title>allreduce2_s1_gpu9&#45;&gt;output</title>
<path fill="none" stroke="black" d="M4420.98,-314.94C4420.98,-312.55 4420.98,-236 4420.98,-236 4420.98,-236 3815.01,-236 3815.01,-236 3815.01,-236 3815.01,-188.13 3815.01,-188.13"/>
<polygon fill="black" stroke="black" points="3818.51,-188.13 3815.01,-178.13 3811.51,-188.13 3818.51,-188.13"/>
</g>
<!-- experts_s1_gpu9 -->
<g id="node130" class="node">
<title>experts_s1_gpu9</title>
<path fill="lightcoral" stroke="black" d="M4600,-63C4600,-63 4497,-63 4497,-63 4491,-63 4485,-57 4485,-51 4485,-51 4485,-12 4485,-12 4485,-6 4491,0 4497,0 4497,0 4600,0 4600,0 4606,0 4612,-6 4612,-12 4612,-12 4612,-51 4612,-51 4612,-57 4606,-63 4600,-63"/>
<text text-anchor="middle" x="4548.5" y="-51" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="4548.5" y="-40" font-family="Arial" font-size="10.00">GPU:9</text>
<text text-anchor="middle" x="4548.5" y="-29" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="4548.5" y="-18" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4548.5" y="-7" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- gate_s1_gpu9&#45;&gt;experts_s1_gpu9 -->
<g id="edge201" class="edge">
<title>gate_s1_gpu9&#45;&gt;experts_s1_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4548.5,-99.95C4548.5,-99.95 4548.5,-73.11 4548.5,-73.11"/>
<polygon fill="black" stroke="black" points="4552,-73.11 4548.5,-63.11 4545,-73.11 4552,-73.11"/>
</g>
<!-- attn_s1_gpu10 -->
<g id="node133" class="node">
<title>attn_s1_gpu10</title>
<polygon fill="lightgreen" stroke="black" points="1554.5,-1231 1432.5,-1231 1432.5,-1168 1554.5,-1168 1554.5,-1231"/>
<text text-anchor="middle" x="1493.5" y="-1219" font-family="Arial" font-size="10.00">MHA&#45;Shard2</text>
<text text-anchor="middle" x="1493.5" y="-1208" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="1493.5" y="-1197" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="1493.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1493.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s1_gpu10&#45;&gt;attn_s1_gpu10 -->
<g id="edge203" class="edge">
<title>ln1_s1_gpu10&#45;&gt;attn_s1_gpu10</title>
<path fill="none" stroke="black" d="M1327.26,-1331C1395.33,-1331 1493.5,-1331 1493.5,-1331 1493.5,-1331 1493.5,-1241.33 1493.5,-1241.33"/>
<polygon fill="black" stroke="black" points="1497,-1241.33 1493.5,-1231.33 1490,-1241.33 1497,-1241.33"/>
</g>
<!-- attn_proj_s1_gpu10 -->
<g id="node134" class="node">
<title>attn_proj_s1_gpu10</title>
<polygon fill="lightgreen" stroke="black" points="2238.5,-1131 2116.5,-1131 2116.5,-1079 2238.5,-1079 2238.5,-1131"/>
<text text-anchor="middle" x="2177.5" y="-1119" font-family="Arial" font-size="10.00">AttnProj&#45;Shard2</text>
<text text-anchor="middle" x="2177.5" y="-1108" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2177.5" y="-1097" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2177.5" y="-1086" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s1_gpu10&#45;&gt;attn_proj_s1_gpu10 -->
<g id="edge204" class="edge">
<title>attn_s1_gpu10&#45;&gt;attn_proj_s1_gpu10</title>
<path fill="none" stroke="black" d="M1493.5,-1167.77C1493.5,-1140.32 1493.5,-1105 1493.5,-1105 1493.5,-1105 2106.5,-1105 2106.5,-1105"/>
<polygon fill="black" stroke="black" points="2106.5,-1108.5 2116.5,-1105 2106.5,-1101.5 2106.5,-1108.5"/>
</g>
<!-- residual1_s1_gpu10 -->
<g id="node135" class="node">
<title>residual1_s1_gpu10</title>
<polygon fill="lightgreen" stroke="black" points="2279,-1042 2154,-1042 2154,-990 2279,-990 2279,-1042"/>
<text text-anchor="middle" x="2216.5" y="-1030" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="2216.5" y="-1019" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2216.5" y="-1008" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2216.5" y="-997" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s1_gpu10&#45;&gt;residual1_s1_gpu10 -->
<g id="edge205" class="edge">
<title>attn_proj_s1_gpu10&#45;&gt;residual1_s1_gpu10</title>
<path fill="none" stroke="black" d="M2196.25,-1078.78C2196.25,-1078.78 2196.25,-1052.03 2196.25,-1052.03"/>
<polygon fill="black" stroke="black" points="2199.75,-1052.03 2196.25,-1042.03 2192.75,-1052.03 2199.75,-1052.03"/>
</g>
<!-- allreduce1_s1_gpu10 -->
<g id="node136" class="node">
<title>allreduce1_s1_gpu10</title>
<polygon fill="orange" stroke="black" points="2501.34,-953 2291.61,-953 2237.66,-849 2447.39,-849 2501.34,-953"/>
<text text-anchor="middle" x="2369.5" y="-915" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="2369.5" y="-904" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2369.5" y="-893" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2369.5" y="-882" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s1_gpu10&#45;&gt;allreduce1_s1_gpu10 -->
<g id="edge206" class="edge">
<title>residual1_s1_gpu10&#45;&gt;allreduce1_s1_gpu10</title>
<path fill="none" stroke="black" d="M2258.42,-989.9C2258.42,-989.9 2258.42,-911.16 2258.42,-911.16"/>
<polygon fill="black" stroke="black" points="2261.92,-911.16 2258.42,-901.16 2254.92,-911.16 2261.92,-911.16"/>
</g>
<!-- ln2_s1_gpu10 -->
<g id="node137" class="node">
<title>ln2_s1_gpu10</title>
<polygon fill="lightgreen" stroke="black" points="2433,-812 2306,-812 2306,-760 2433,-760 2433,-812"/>
<text text-anchor="middle" x="2369.5" y="-800" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="2369.5" y="-789" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2369.5" y="-778" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2369.5" y="-767" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s1_gpu10&#45;&gt;ln2_s1_gpu10 -->
<g id="edge207" class="edge">
<title>allreduce1_s1_gpu10&#45;&gt;ln2_s1_gpu10</title>
<path fill="none" stroke="black" d="M2369.5,-848.88C2369.5,-848.88 2369.5,-822.19 2369.5,-822.19"/>
<polygon fill="black" stroke="black" points="2373,-822.19 2369.5,-812.19 2366,-822.19 2373,-822.19"/>
</g>
<!-- mlp1_s1_gpu10 -->
<g id="node138" class="node">
<title>mlp1_s1_gpu10</title>
<polygon fill="lightgreen" stroke="black" points="2433,-723 2306,-723 2306,-671 2433,-671 2433,-723"/>
<text text-anchor="middle" x="2369.5" y="-711" font-family="Arial" font-size="10.00">MLP1&#45;Shard2</text>
<text text-anchor="middle" x="2369.5" y="-700" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2369.5" y="-689" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2369.5" y="-678" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s1_gpu10&#45;&gt;mlp1_s1_gpu10 -->
<g id="edge208" class="edge">
<title>ln2_s1_gpu10&#45;&gt;mlp1_s1_gpu10</title>
<path fill="none" stroke="black" d="M2369.5,-759.78C2369.5,-759.78 2369.5,-733.03 2369.5,-733.03"/>
<polygon fill="black" stroke="black" points="2373,-733.03 2369.5,-723.03 2366,-733.03 2373,-733.03"/>
</g>
<!-- gelu_s1_gpu10 -->
<g id="node139" class="node">
<title>gelu_s1_gpu10</title>
<polygon fill="lightgreen" stroke="black" points="2433,-634 2306,-634 2306,-582 2433,-582 2433,-634"/>
<text text-anchor="middle" x="2369.5" y="-622" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="2369.5" y="-611" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2369.5" y="-600" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="2369.5" y="-589" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s1_gpu10&#45;&gt;gelu_s1_gpu10 -->
<g id="edge209" class="edge">
<title>mlp1_s1_gpu10&#45;&gt;gelu_s1_gpu10</title>
<path fill="none" stroke="black" d="M2369.5,-670.78C2369.5,-670.78 2369.5,-644.03 2369.5,-644.03"/>
<polygon fill="black" stroke="black" points="2373,-644.03 2369.5,-634.03 2366,-644.03 2373,-644.03"/>
</g>
<!-- mlp2_s1_gpu10 -->
<g id="node140" class="node">
<title>mlp2_s1_gpu10</title>
<polygon fill="lightgreen" stroke="black" points="2430.5,-545 2308.5,-545 2308.5,-493 2430.5,-493 2430.5,-545"/>
<text text-anchor="middle" x="2369.5" y="-533" font-family="Arial" font-size="10.00">MLP2&#45;Shard2</text>
<text text-anchor="middle" x="2369.5" y="-522" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2369.5" y="-511" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="2369.5" y="-500" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s1_gpu10&#45;&gt;mlp2_s1_gpu10 -->
<g id="edge210" class="edge">
<title>gelu_s1_gpu10&#45;&gt;mlp2_s1_gpu10</title>
<path fill="none" stroke="black" d="M2369.5,-581.78C2369.5,-581.78 2369.5,-555.03 2369.5,-555.03"/>
<polygon fill="black" stroke="black" points="2373,-555.03 2369.5,-545.03 2366,-555.03 2373,-555.03"/>
</g>
<!-- residual2_s1_gpu10 -->
<g id="node141" class="node">
<title>residual2_s1_gpu10</title>
<polygon fill="lightgreen" stroke="black" points="2474,-456 2349,-456 2349,-404 2474,-404 2474,-456"/>
<text text-anchor="middle" x="2411.5" y="-444" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="2411.5" y="-433" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2411.5" y="-422" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2411.5" y="-411" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s1_gpu10&#45;&gt;residual2_s1_gpu10 -->
<g id="edge211" class="edge">
<title>mlp2_s1_gpu10&#45;&gt;residual2_s1_gpu10</title>
<path fill="none" stroke="black" d="M2389.75,-492.78C2389.75,-492.78 2389.75,-466.03 2389.75,-466.03"/>
<polygon fill="black" stroke="black" points="2393.25,-466.03 2389.75,-456.03 2386.25,-466.03 2393.25,-466.03"/>
</g>
<!-- allreduce2_s1_gpu10 -->
<g id="node142" class="node">
<title>allreduce2_s1_gpu10</title>
<polygon fill="orange" stroke="black" points="2543.34,-367 2333.61,-367 2279.66,-263 2489.39,-263 2543.34,-367"/>
<text text-anchor="middle" x="2411.5" y="-329" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="2411.5" y="-318" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2411.5" y="-307" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2411.5" y="-296" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s1_gpu10&#45;&gt;allreduce2_s1_gpu10 -->
<g id="edge212" class="edge">
<title>residual2_s1_gpu10&#45;&gt;allreduce2_s1_gpu10</title>
<path fill="none" stroke="black" d="M2411.5,-403.9C2411.5,-403.9 2411.5,-377.32 2411.5,-377.32"/>
<polygon fill="black" stroke="black" points="2415,-377.32 2411.5,-367.32 2408,-377.32 2415,-377.32"/>
</g>
<!-- gate_s1_gpu10 -->
<g id="node144" class="node">
<title>gate_s1_gpu10</title>
<polygon fill="gold" stroke="black" points="2534.75,-226 2338.69,-226 2288.25,-100 2484.31,-100 2534.75,-226"/>
<text text-anchor="middle" x="2411.5" y="-182.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="2411.5" y="-171.5" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2411.5" y="-160.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="2411.5" y="-149.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2411.5" y="-138.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s1_gpu10&#45;&gt;gate_s1_gpu10 -->
<g id="edge213" class="edge">
<title>allreduce2_s1_gpu10&#45;&gt;gate_s1_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2411.5,-262.69C2411.5,-262.69 2411.5,-236.16 2411.5,-236.16"/>
<polygon fill="black" stroke="black" points="2415,-236.16 2411.5,-226.16 2408,-236.16 2415,-236.16"/>
</g>
<!-- allreduce2_s1_gpu10&#45;&gt;output -->
<g id="edge215" class="edge">
<title>allreduce2_s1_gpu10&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2539.02,-314.95C2539.02,-312.89 2539.02,-247 2539.02,-247 2539.02,-247 3481.97,-247 3481.97,-247 3481.97,-247 3481.97,-186.12 3481.97,-186.12"/>
<polygon fill="black" stroke="black" points="3485.47,-186.12 3481.97,-176.12 3478.47,-186.13 3485.47,-186.12"/>
</g>
<!-- experts_s1_gpu10 -->
<g id="node143" class="node">
<title>experts_s1_gpu10</title>
<path fill="lightcoral" stroke="black" d="M2463,-63C2463,-63 2360,-63 2360,-63 2354,-63 2348,-57 2348,-51 2348,-51 2348,-12 2348,-12 2348,-6 2354,0 2360,0 2360,0 2463,0 2463,0 2469,0 2475,-6 2475,-12 2475,-12 2475,-51 2475,-51 2475,-57 2469,-63 2463,-63"/>
<text text-anchor="middle" x="2411.5" y="-51" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="2411.5" y="-40" font-family="Arial" font-size="10.00">GPU:10</text>
<text text-anchor="middle" x="2411.5" y="-29" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="2411.5" y="-18" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2411.5" y="-7" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- gate_s1_gpu10&#45;&gt;experts_s1_gpu10 -->
<g id="edge214" class="edge">
<title>gate_s1_gpu10&#45;&gt;experts_s1_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2411.5,-99.95C2411.5,-99.95 2411.5,-73.11 2411.5,-73.11"/>
<polygon fill="black" stroke="black" points="2415,-73.11 2411.5,-63.11 2408,-73.11 2415,-73.11"/>
</g>
<!-- attn_s1_gpu11 -->
<g id="node146" class="node">
<title>attn_s1_gpu11</title>
<polygon fill="lightgreen" stroke="black" points="4818.5,-1231 4696.5,-1231 4696.5,-1168 4818.5,-1168 4818.5,-1231"/>
<text text-anchor="middle" x="4757.5" y="-1219" font-family="Arial" font-size="10.00">MHA&#45;Shard3</text>
<text text-anchor="middle" x="4757.5" y="-1208" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4757.5" y="-1197" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="4757.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4757.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s1_gpu11&#45;&gt;attn_s1_gpu11 -->
<g id="edge216" class="edge">
<title>ln1_s1_gpu11&#45;&gt;attn_s1_gpu11</title>
<path fill="none" stroke="black" d="M4757.5,-1304.71C4757.5,-1304.71 4757.5,-1241.32 4757.5,-1241.32"/>
<polygon fill="black" stroke="black" points="4761,-1241.32 4757.5,-1231.32 4754,-1241.32 4761,-1241.32"/>
</g>
<!-- attn_proj_s1_gpu11 -->
<g id="node147" class="node">
<title>attn_proj_s1_gpu11</title>
<polygon fill="lightgreen" stroke="black" points="4818.5,-1131 4696.5,-1131 4696.5,-1079 4818.5,-1079 4818.5,-1131"/>
<text text-anchor="middle" x="4757.5" y="-1119" font-family="Arial" font-size="10.00">AttnProj&#45;Shard3</text>
<text text-anchor="middle" x="4757.5" y="-1108" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4757.5" y="-1097" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4757.5" y="-1086" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s1_gpu11&#45;&gt;attn_proj_s1_gpu11 -->
<g id="edge217" class="edge">
<title>attn_s1_gpu11&#45;&gt;attn_proj_s1_gpu11</title>
<path fill="none" stroke="black" d="M4757.5,-1167.77C4757.5,-1167.77 4757.5,-1141.14 4757.5,-1141.14"/>
<polygon fill="black" stroke="black" points="4761,-1141.14 4757.5,-1131.14 4754,-1141.14 4761,-1141.14"/>
</g>
<!-- residual1_s1_gpu11 -->
<g id="node148" class="node">
<title>residual1_s1_gpu11</title>
<polygon fill="lightgreen" stroke="black" points="4820,-1042 4695,-1042 4695,-990 4820,-990 4820,-1042"/>
<text text-anchor="middle" x="4757.5" y="-1030" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="4757.5" y="-1019" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4757.5" y="-1008" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="4757.5" y="-997" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s1_gpu11&#45;&gt;residual1_s1_gpu11 -->
<g id="edge218" class="edge">
<title>attn_proj_s1_gpu11&#45;&gt;residual1_s1_gpu11</title>
<path fill="none" stroke="black" d="M4757.5,-1078.78C4757.5,-1078.78 4757.5,-1052.03 4757.5,-1052.03"/>
<polygon fill="black" stroke="black" points="4761,-1052.03 4757.5,-1042.03 4754,-1052.03 4761,-1052.03"/>
</g>
<!-- allreduce1_s1_gpu11 -->
<g id="node149" class="node">
<title>allreduce1_s1_gpu11</title>
<polygon fill="orange" stroke="black" points="4889.34,-953 4679.61,-953 4625.66,-849 4835.39,-849 4889.34,-953"/>
<text text-anchor="middle" x="4757.5" y="-915" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="4757.5" y="-904" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4757.5" y="-893" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4757.5" y="-882" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s1_gpu11&#45;&gt;allreduce1_s1_gpu11 -->
<g id="edge219" class="edge">
<title>residual1_s1_gpu11&#45;&gt;allreduce1_s1_gpu11</title>
<path fill="none" stroke="black" d="M4757.5,-989.9C4757.5,-989.9 4757.5,-963.32 4757.5,-963.32"/>
<polygon fill="black" stroke="black" points="4761,-963.32 4757.5,-953.32 4754,-963.32 4761,-963.32"/>
</g>
<!-- ln2_s1_gpu11 -->
<g id="node150" class="node">
<title>ln2_s1_gpu11</title>
<polygon fill="lightgreen" stroke="black" points="4799,-812 4672,-812 4672,-760 4799,-760 4799,-812"/>
<text text-anchor="middle" x="4735.5" y="-800" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="4735.5" y="-789" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4735.5" y="-778" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4735.5" y="-767" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s1_gpu11&#45;&gt;ln2_s1_gpu11 -->
<g id="edge220" class="edge">
<title>allreduce1_s1_gpu11&#45;&gt;ln2_s1_gpu11</title>
<path fill="none" stroke="black" d="M4735.5,-848.88C4735.5,-848.88 4735.5,-822.19 4735.5,-822.19"/>
<polygon fill="black" stroke="black" points="4739,-822.19 4735.5,-812.19 4732,-822.19 4739,-822.19"/>
</g>
<!-- mlp1_s1_gpu11 -->
<g id="node151" class="node">
<title>mlp1_s1_gpu11</title>
<polygon fill="lightgreen" stroke="black" points="4681,-723 4554,-723 4554,-671 4681,-671 4681,-723"/>
<text text-anchor="middle" x="4617.5" y="-711" font-family="Arial" font-size="10.00">MLP1&#45;Shard3</text>
<text text-anchor="middle" x="4617.5" y="-700" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4617.5" y="-689" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4617.5" y="-678" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s1_gpu11&#45;&gt;mlp1_s1_gpu11 -->
<g id="edge221" class="edge">
<title>ln2_s1_gpu11&#45;&gt;mlp1_s1_gpu11</title>
<path fill="none" stroke="black" d="M4676.5,-759.78C4676.5,-759.78 4676.5,-733.03 4676.5,-733.03"/>
<polygon fill="black" stroke="black" points="4680,-733.03 4676.5,-723.03 4673,-733.03 4680,-733.03"/>
</g>
<!-- gelu_s1_gpu11 -->
<g id="node152" class="node">
<title>gelu_s1_gpu11</title>
<polygon fill="lightgreen" stroke="black" points="4549,-634 4422,-634 4422,-582 4549,-582 4549,-634"/>
<text text-anchor="middle" x="4485.5" y="-622" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="4485.5" y="-611" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4485.5" y="-600" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="4485.5" y="-589" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s1_gpu11&#45;&gt;gelu_s1_gpu11 -->
<g id="edge222" class="edge">
<title>mlp1_s1_gpu11&#45;&gt;gelu_s1_gpu11</title>
<path fill="none" stroke="black" d="M4570.5,-670.78C4570.5,-644.53 4570.5,-608 4570.5,-608 4570.5,-608 4559.05,-608 4559.05,-608"/>
<polygon fill="black" stroke="black" points="4559.05,-604.5 4549.05,-608 4559.05,-611.5 4559.05,-604.5"/>
</g>
<!-- mlp2_s1_gpu11 -->
<g id="node153" class="node">
<title>mlp2_s1_gpu11</title>
<polygon fill="lightgreen" stroke="black" points="4539.5,-545 4417.5,-545 4417.5,-493 4539.5,-493 4539.5,-545"/>
<text text-anchor="middle" x="4478.5" y="-533" font-family="Arial" font-size="10.00">MLP2&#45;Shard3</text>
<text text-anchor="middle" x="4478.5" y="-522" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4478.5" y="-511" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="4478.5" y="-500" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s1_gpu11&#45;&gt;mlp2_s1_gpu11 -->
<g id="edge223" class="edge">
<title>gelu_s1_gpu11&#45;&gt;mlp2_s1_gpu11</title>
<path fill="none" stroke="black" d="M4480.75,-581.78C4480.75,-581.78 4480.75,-555.03 4480.75,-555.03"/>
<polygon fill="black" stroke="black" points="4484.25,-555.03 4480.75,-545.03 4477.25,-555.03 4484.25,-555.03"/>
</g>
<!-- residual2_s1_gpu11 -->
<g id="node154" class="node">
<title>residual2_s1_gpu11</title>
<polygon fill="lightgreen" stroke="black" points="4530,-456 4405,-456 4405,-404 4530,-404 4530,-456"/>
<text text-anchor="middle" x="4467.5" y="-444" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="4467.5" y="-433" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4467.5" y="-422" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="4467.5" y="-411" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s1_gpu11&#45;&gt;residual2_s1_gpu11 -->
<g id="edge224" class="edge">
<title>mlp2_s1_gpu11&#45;&gt;residual2_s1_gpu11</title>
<path fill="none" stroke="black" d="M4473.75,-492.78C4473.75,-492.78 4473.75,-466.03 4473.75,-466.03"/>
<polygon fill="black" stroke="black" points="4477.25,-466.03 4473.75,-456.03 4470.25,-466.03 4477.25,-466.03"/>
</g>
<!-- allreduce2_s1_gpu11 -->
<g id="node155" class="node">
<title>allreduce2_s1_gpu11</title>
<polygon fill="orange" stroke="black" points="4398.34,-367 4188.61,-367 4134.66,-263 4344.39,-263 4398.34,-367"/>
<text text-anchor="middle" x="4266.5" y="-329" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="4266.5" y="-318" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4266.5" y="-307" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4266.5" y="-296" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s1_gpu11&#45;&gt;allreduce2_s1_gpu11 -->
<g id="edge225" class="edge">
<title>residual2_s1_gpu11&#45;&gt;allreduce2_s1_gpu11</title>
<path fill="none" stroke="black" d="M4410.92,-403.9C4410.92,-369.97 4410.92,-315 4410.92,-315 4410.92,-315 4381.45,-315 4381.45,-315"/>
<polygon fill="black" stroke="black" points="4381.45,-311.5 4371.45,-315 4381.45,-318.5 4381.45,-311.5"/>
</g>
<!-- gate_s1_gpu11 -->
<g id="node157" class="node">
<title>gate_s1_gpu11</title>
<polygon fill="gold" stroke="black" points="4389.75,-226 4193.69,-226 4143.25,-100 4339.31,-100 4389.75,-226"/>
<text text-anchor="middle" x="4266.5" y="-182.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="4266.5" y="-171.5" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4266.5" y="-160.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="4266.5" y="-149.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4266.5" y="-138.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s1_gpu11&#45;&gt;gate_s1_gpu11 -->
<g id="edge226" class="edge">
<title>allreduce2_s1_gpu11&#45;&gt;gate_s1_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4266.5,-262.69C4266.5,-262.69 4266.5,-236.16 4266.5,-236.16"/>
<polygon fill="black" stroke="black" points="4270,-236.16 4266.5,-226.16 4263,-236.16 4270,-236.16"/>
</g>
<!-- allreduce2_s1_gpu11&#45;&gt;output -->
<g id="edge228" class="edge">
<title>allreduce2_s1_gpu11&#45;&gt;output</title>
<path fill="none" stroke="black" d="M4138.98,-314.95C4138.98,-312.71 4138.98,-241 4138.98,-241 4138.98,-241 3805.77,-241 3805.77,-241 3805.77,-241 3805.77,-190.31 3805.77,-190.31"/>
<polygon fill="black" stroke="black" points="3809.27,-190.31 3805.77,-180.31 3802.27,-190.31 3809.27,-190.31"/>
</g>
<!-- experts_s1_gpu11 -->
<g id="node156" class="node">
<title>experts_s1_gpu11</title>
<path fill="lightcoral" stroke="black" d="M4318,-63C4318,-63 4215,-63 4215,-63 4209,-63 4203,-57 4203,-51 4203,-51 4203,-12 4203,-12 4203,-6 4209,0 4215,0 4215,0 4318,0 4318,0 4324,0 4330,-6 4330,-12 4330,-12 4330,-51 4330,-51 4330,-57 4324,-63 4318,-63"/>
<text text-anchor="middle" x="4266.5" y="-51" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="4266.5" y="-40" font-family="Arial" font-size="10.00">GPU:11</text>
<text text-anchor="middle" x="4266.5" y="-29" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="4266.5" y="-18" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4266.5" y="-7" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- gate_s1_gpu11&#45;&gt;experts_s1_gpu11 -->
<g id="edge227" class="edge">
<title>gate_s1_gpu11&#45;&gt;experts_s1_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4266.5,-99.95C4266.5,-99.95 4266.5,-73.11 4266.5,-73.11"/>
<polygon fill="black" stroke="black" points="4270,-73.11 4266.5,-63.11 4263,-73.11 4270,-73.11"/>
</g>
<!-- attn_s1_gpu12 -->
<g id="node159" class="node">
<title>attn_s1_gpu12</title>
<polygon fill="lightgreen" stroke="black" points="4050.5,-1231 3928.5,-1231 3928.5,-1168 4050.5,-1168 4050.5,-1231"/>
<text text-anchor="middle" x="3989.5" y="-1219" font-family="Arial" font-size="10.00">MHA&#45;Shard4</text>
<text text-anchor="middle" x="3989.5" y="-1208" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3989.5" y="-1197" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="3989.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3989.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s1_gpu12&#45;&gt;attn_s1_gpu12 -->
<g id="edge229" class="edge">
<title>ln1_s1_gpu12&#45;&gt;attn_s1_gpu12</title>
<path fill="none" stroke="black" d="M3989.5,-1304.71C3989.5,-1304.71 3989.5,-1241.32 3989.5,-1241.32"/>
<polygon fill="black" stroke="black" points="3993,-1241.32 3989.5,-1231.32 3986,-1241.32 3993,-1241.32"/>
</g>
<!-- attn_proj_s1_gpu12 -->
<g id="node160" class="node">
<title>attn_proj_s1_gpu12</title>
<polygon fill="lightgreen" stroke="black" points="4049.5,-1131 3927.5,-1131 3927.5,-1079 4049.5,-1079 4049.5,-1131"/>
<text text-anchor="middle" x="3988.5" y="-1119" font-family="Arial" font-size="10.00">AttnProj&#45;Shard4</text>
<text text-anchor="middle" x="3988.5" y="-1108" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3988.5" y="-1097" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3988.5" y="-1086" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s1_gpu12&#45;&gt;attn_proj_s1_gpu12 -->
<g id="edge230" class="edge">
<title>attn_s1_gpu12&#45;&gt;attn_proj_s1_gpu12</title>
<path fill="none" stroke="black" d="M3989,-1167.77C3989,-1167.77 3989,-1141.14 3989,-1141.14"/>
<polygon fill="black" stroke="black" points="3992.5,-1141.14 3989,-1131.14 3985.5,-1141.14 3992.5,-1141.14"/>
</g>
<!-- residual1_s1_gpu12 -->
<g id="node161" class="node">
<title>residual1_s1_gpu12</title>
<polygon fill="lightgreen" stroke="black" points="4048,-1042 3923,-1042 3923,-990 4048,-990 4048,-1042"/>
<text text-anchor="middle" x="3985.5" y="-1030" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="3985.5" y="-1019" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3985.5" y="-1008" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="3985.5" y="-997" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s1_gpu12&#45;&gt;residual1_s1_gpu12 -->
<g id="edge231" class="edge">
<title>attn_proj_s1_gpu12&#45;&gt;residual1_s1_gpu12</title>
<path fill="none" stroke="black" d="M3987.75,-1078.78C3987.75,-1078.78 3987.75,-1052.03 3987.75,-1052.03"/>
<polygon fill="black" stroke="black" points="3991.25,-1052.03 3987.75,-1042.03 3984.25,-1052.03 3991.25,-1052.03"/>
</g>
<!-- allreduce1_s1_gpu12 -->
<g id="node162" class="node">
<title>allreduce1_s1_gpu12</title>
<polygon fill="orange" stroke="black" points="4116.34,-953 3906.61,-953 3852.66,-849 4062.39,-849 4116.34,-953"/>
<text text-anchor="middle" x="3984.5" y="-915" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="3984.5" y="-904" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3984.5" y="-893" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3984.5" y="-882" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s1_gpu12&#45;&gt;allreduce1_s1_gpu12 -->
<g id="edge232" class="edge">
<title>residual1_s1_gpu12&#45;&gt;allreduce1_s1_gpu12</title>
<path fill="none" stroke="black" d="M3985.5,-989.9C3985.5,-989.9 3985.5,-963.32 3985.5,-963.32"/>
<polygon fill="black" stroke="black" points="3989,-963.32 3985.5,-953.32 3982,-963.32 3989,-963.32"/>
</g>
<!-- ln2_s1_gpu12 -->
<g id="node163" class="node">
<title>ln2_s1_gpu12</title>
<polygon fill="lightgreen" stroke="black" points="4048,-812 3921,-812 3921,-760 4048,-760 4048,-812"/>
<text text-anchor="middle" x="3984.5" y="-800" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="3984.5" y="-789" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3984.5" y="-778" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3984.5" y="-767" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s1_gpu12&#45;&gt;ln2_s1_gpu12 -->
<g id="edge233" class="edge">
<title>allreduce1_s1_gpu12&#45;&gt;ln2_s1_gpu12</title>
<path fill="none" stroke="black" d="M3984.5,-848.88C3984.5,-848.88 3984.5,-822.19 3984.5,-822.19"/>
<polygon fill="black" stroke="black" points="3988,-822.19 3984.5,-812.19 3981,-822.19 3988,-822.19"/>
</g>
<!-- mlp1_s1_gpu12 -->
<g id="node164" class="node">
<title>mlp1_s1_gpu12</title>
<polygon fill="lightgreen" stroke="black" points="4048,-723 3921,-723 3921,-671 4048,-671 4048,-723"/>
<text text-anchor="middle" x="3984.5" y="-711" font-family="Arial" font-size="10.00">MLP1&#45;Shard4</text>
<text text-anchor="middle" x="3984.5" y="-700" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3984.5" y="-689" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3984.5" y="-678" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s1_gpu12&#45;&gt;mlp1_s1_gpu12 -->
<g id="edge234" class="edge">
<title>ln2_s1_gpu12&#45;&gt;mlp1_s1_gpu12</title>
<path fill="none" stroke="black" d="M3984.5,-759.78C3984.5,-759.78 3984.5,-733.03 3984.5,-733.03"/>
<polygon fill="black" stroke="black" points="3988,-733.03 3984.5,-723.03 3981,-733.03 3988,-733.03"/>
</g>
<!-- gelu_s1_gpu12 -->
<g id="node165" class="node">
<title>gelu_s1_gpu12</title>
<polygon fill="lightgreen" stroke="black" points="4048,-634 3921,-634 3921,-582 4048,-582 4048,-634"/>
<text text-anchor="middle" x="3984.5" y="-622" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="3984.5" y="-611" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3984.5" y="-600" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="3984.5" y="-589" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s1_gpu12&#45;&gt;gelu_s1_gpu12 -->
<g id="edge235" class="edge">
<title>mlp1_s1_gpu12&#45;&gt;gelu_s1_gpu12</title>
<path fill="none" stroke="black" d="M3984.5,-670.78C3984.5,-670.78 3984.5,-644.03 3984.5,-644.03"/>
<polygon fill="black" stroke="black" points="3988,-644.03 3984.5,-634.03 3981,-644.03 3988,-644.03"/>
</g>
<!-- mlp2_s1_gpu12 -->
<g id="node166" class="node">
<title>mlp2_s1_gpu12</title>
<polygon fill="lightgreen" stroke="black" points="4045.5,-545 3923.5,-545 3923.5,-493 4045.5,-493 4045.5,-545"/>
<text text-anchor="middle" x="3984.5" y="-533" font-family="Arial" font-size="10.00">MLP2&#45;Shard4</text>
<text text-anchor="middle" x="3984.5" y="-522" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3984.5" y="-511" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="3984.5" y="-500" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s1_gpu12&#45;&gt;mlp2_s1_gpu12 -->
<g id="edge236" class="edge">
<title>gelu_s1_gpu12&#45;&gt;mlp2_s1_gpu12</title>
<path fill="none" stroke="black" d="M3984.5,-581.78C3984.5,-581.78 3984.5,-555.03 3984.5,-555.03"/>
<polygon fill="black" stroke="black" points="3988,-555.03 3984.5,-545.03 3981,-555.03 3988,-555.03"/>
</g>
<!-- residual2_s1_gpu12 -->
<g id="node167" class="node">
<title>residual2_s1_gpu12</title>
<polygon fill="lightgreen" stroke="black" points="4047,-456 3922,-456 3922,-404 4047,-404 4047,-456"/>
<text text-anchor="middle" x="3984.5" y="-444" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="3984.5" y="-433" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3984.5" y="-422" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="3984.5" y="-411" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s1_gpu12&#45;&gt;residual2_s1_gpu12 -->
<g id="edge237" class="edge">
<title>mlp2_s1_gpu12&#45;&gt;residual2_s1_gpu12</title>
<path fill="none" stroke="black" d="M3984.5,-492.78C3984.5,-492.78 3984.5,-466.03 3984.5,-466.03"/>
<polygon fill="black" stroke="black" points="3988,-466.03 3984.5,-456.03 3981,-466.03 3988,-466.03"/>
</g>
<!-- allreduce2_s1_gpu12 -->
<g id="node168" class="node">
<title>allreduce2_s1_gpu12</title>
<polygon fill="orange" stroke="black" points="4116.34,-367 3906.61,-367 3852.66,-263 4062.39,-263 4116.34,-367"/>
<text text-anchor="middle" x="3984.5" y="-329" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="3984.5" y="-318" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3984.5" y="-307" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3984.5" y="-296" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s1_gpu12&#45;&gt;allreduce2_s1_gpu12 -->
<g id="edge238" class="edge">
<title>residual2_s1_gpu12&#45;&gt;allreduce2_s1_gpu12</title>
<path fill="none" stroke="black" d="M3984.5,-403.9C3984.5,-403.9 3984.5,-377.32 3984.5,-377.32"/>
<polygon fill="black" stroke="black" points="3988,-377.32 3984.5,-367.32 3981,-377.32 3988,-377.32"/>
</g>
<!-- gate_s1_gpu12 -->
<g id="node170" class="node">
<title>gate_s1_gpu12</title>
<polygon fill="gold" stroke="black" points="4107.75,-226 3911.69,-226 3861.25,-100 4057.31,-100 4107.75,-226"/>
<text text-anchor="middle" x="3984.5" y="-182.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="3984.5" y="-171.5" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3984.5" y="-160.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="3984.5" y="-149.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3984.5" y="-138.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s1_gpu12&#45;&gt;gate_s1_gpu12 -->
<g id="edge239" class="edge">
<title>allreduce2_s1_gpu12&#45;&gt;gate_s1_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3984.5,-262.69C3984.5,-262.69 3984.5,-236.16 3984.5,-236.16"/>
<polygon fill="black" stroke="black" points="3988,-236.16 3984.5,-226.16 3981,-236.16 3988,-236.16"/>
</g>
<!-- allreduce2_s1_gpu12&#45;&gt;output -->
<g id="edge241" class="edge">
<title>allreduce2_s1_gpu12&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3856.98,-314.89C3856.98,-310.29 3856.98,-163 3856.98,-163 3856.98,-163 3852.92,-163 3852.92,-163"/>
<polygon fill="black" stroke="black" points="3852.92,-159.5 3842.92,-163 3852.92,-166.5 3852.92,-159.5"/>
</g>
<!-- experts_s1_gpu12 -->
<g id="node169" class="node">
<title>experts_s1_gpu12</title>
<path fill="lightcoral" stroke="black" d="M4036,-63C4036,-63 3933,-63 3933,-63 3927,-63 3921,-57 3921,-51 3921,-51 3921,-12 3921,-12 3921,-6 3927,0 3933,0 3933,0 4036,0 4036,0 4042,0 4048,-6 4048,-12 4048,-12 4048,-51 4048,-51 4048,-57 4042,-63 4036,-63"/>
<text text-anchor="middle" x="3984.5" y="-51" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="3984.5" y="-40" font-family="Arial" font-size="10.00">GPU:12</text>
<text text-anchor="middle" x="3984.5" y="-29" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="3984.5" y="-18" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3984.5" y="-7" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- gate_s1_gpu12&#45;&gt;experts_s1_gpu12 -->
<g id="edge240" class="edge">
<title>gate_s1_gpu12&#45;&gt;experts_s1_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3984.5,-99.95C3984.5,-99.95 3984.5,-73.11 3984.5,-73.11"/>
<polygon fill="black" stroke="black" points="3988,-73.11 3984.5,-63.11 3981,-73.11 3988,-73.11"/>
</g>
<!-- attn_s1_gpu13 -->
<g id="node172" class="node">
<title>attn_s1_gpu13</title>
<polygon fill="lightgreen" stroke="black" points="2611.5,-1231 2489.5,-1231 2489.5,-1168 2611.5,-1168 2611.5,-1231"/>
<text text-anchor="middle" x="2550.5" y="-1219" font-family="Arial" font-size="10.00">MHA&#45;Shard5</text>
<text text-anchor="middle" x="2550.5" y="-1208" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="2550.5" y="-1197" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="2550.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2550.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s1_gpu13&#45;&gt;attn_s1_gpu13 -->
<g id="edge242" class="edge">
<title>ln1_s1_gpu13&#45;&gt;attn_s1_gpu13</title>
<path fill="none" stroke="black" d="M2550.5,-1304.71C2550.5,-1304.71 2550.5,-1241.32 2550.5,-1241.32"/>
<polygon fill="black" stroke="black" points="2554,-1241.32 2550.5,-1231.32 2547,-1241.32 2554,-1241.32"/>
</g>
<!-- attn_proj_s1_gpu13 -->
<g id="node173" class="node">
<title>attn_proj_s1_gpu13</title>
<polygon fill="lightgreen" stroke="black" points="2612.5,-1131 2490.5,-1131 2490.5,-1079 2612.5,-1079 2612.5,-1131"/>
<text text-anchor="middle" x="2551.5" y="-1119" font-family="Arial" font-size="10.00">AttnProj&#45;Shard5</text>
<text text-anchor="middle" x="2551.5" y="-1108" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="2551.5" y="-1097" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2551.5" y="-1086" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s1_gpu13&#45;&gt;attn_proj_s1_gpu13 -->
<g id="edge243" class="edge">
<title>attn_s1_gpu13&#45;&gt;attn_proj_s1_gpu13</title>
<path fill="none" stroke="black" d="M2551,-1167.77C2551,-1167.77 2551,-1141.14 2551,-1141.14"/>
<polygon fill="black" stroke="black" points="2554.5,-1141.14 2551,-1131.14 2547.5,-1141.14 2554.5,-1141.14"/>
</g>
<!-- residual1_s1_gpu13 -->
<g id="node174" class="node">
<title>residual1_s1_gpu13</title>
<polygon fill="lightgreen" stroke="black" points="2829,-1042 2704,-1042 2704,-990 2829,-990 2829,-1042"/>
<text text-anchor="middle" x="2766.5" y="-1030" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="2766.5" y="-1019" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="2766.5" y="-1008" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2766.5" y="-997" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s1_gpu13&#45;&gt;residual1_s1_gpu13 -->
<g id="edge244" class="edge">
<title>attn_proj_s1_gpu13&#45;&gt;residual1_s1_gpu13</title>
<path fill="none" stroke="black" d="M2578.75,-1078.78C2578.75,-1052.53 2578.75,-1016 2578.75,-1016 2578.75,-1016 2693.98,-1016 2693.98,-1016"/>
<polygon fill="black" stroke="black" points="2693.98,-1019.5 2703.98,-1016 2693.98,-1012.5 2693.98,-1019.5"/>
</g>
<!-- allreduce1_s1_gpu13 -->
<g id="node175" class="node">
<title>allreduce1_s1_gpu13</title>
<polygon fill="orange" stroke="black" points="3117.34,-953 2907.61,-953 2853.66,-849 3063.39,-849 3117.34,-953"/>
<text text-anchor="middle" x="2985.5" y="-915" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="2985.5" y="-904" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="2985.5" y="-893" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2985.5" y="-882" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s1_gpu13&#45;&gt;allreduce1_s1_gpu13 -->
<g id="edge245" class="edge">
<title>residual1_s1_gpu13&#45;&gt;allreduce1_s1_gpu13</title>
<path fill="none" stroke="black" d="M2815.5,-989.9C2815.5,-955.97 2815.5,-901 2815.5,-901 2815.5,-901 2870.25,-901 2870.25,-901"/>
<polygon fill="black" stroke="black" points="2870.25,-904.5 2880.25,-901 2870.25,-897.5 2870.25,-904.5"/>
</g>
<!-- ln2_s1_gpu13 -->
<g id="node176" class="node">
<title>ln2_s1_gpu13</title>
<polygon fill="lightgreen" stroke="black" points="3049,-812 2922,-812 2922,-760 3049,-760 3049,-812"/>
<text text-anchor="middle" x="2985.5" y="-800" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="2985.5" y="-789" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="2985.5" y="-778" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2985.5" y="-767" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s1_gpu13&#45;&gt;ln2_s1_gpu13 -->
<g id="edge246" class="edge">
<title>allreduce1_s1_gpu13&#45;&gt;ln2_s1_gpu13</title>
<path fill="none" stroke="black" d="M2985.5,-848.88C2985.5,-848.88 2985.5,-822.19 2985.5,-822.19"/>
<polygon fill="black" stroke="black" points="2989,-822.19 2985.5,-812.19 2982,-822.19 2989,-822.19"/>
</g>
<!-- mlp1_s1_gpu13 -->
<g id="node177" class="node">
<title>mlp1_s1_gpu13</title>
<polygon fill="lightgreen" stroke="black" points="3076,-723 2949,-723 2949,-671 3076,-671 3076,-723"/>
<text text-anchor="middle" x="3012.5" y="-711" font-family="Arial" font-size="10.00">MLP1&#45;Shard5</text>
<text text-anchor="middle" x="3012.5" y="-700" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="3012.5" y="-689" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3012.5" y="-678" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s1_gpu13&#45;&gt;mlp1_s1_gpu13 -->
<g id="edge247" class="edge">
<title>ln2_s1_gpu13&#45;&gt;mlp1_s1_gpu13</title>
<path fill="none" stroke="black" d="M2999,-759.78C2999,-759.78 2999,-733.03 2999,-733.03"/>
<polygon fill="black" stroke="black" points="3002.5,-733.03 2999,-723.03 2995.5,-733.03 3002.5,-733.03"/>
</g>
<!-- gelu_s1_gpu13 -->
<g id="node178" class="node">
<title>gelu_s1_gpu13</title>
<polygon fill="lightgreen" stroke="black" points="3083,-634 2956,-634 2956,-582 3083,-582 3083,-634"/>
<text text-anchor="middle" x="3019.5" y="-622" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="3019.5" y="-611" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="3019.5" y="-600" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="3019.5" y="-589" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s1_gpu13&#45;&gt;gelu_s1_gpu13 -->
<g id="edge248" class="edge">
<title>mlp1_s1_gpu13&#45;&gt;gelu_s1_gpu13</title>
<path fill="none" stroke="black" d="M3016,-670.78C3016,-670.78 3016,-644.03 3016,-644.03"/>
<polygon fill="black" stroke="black" points="3019.5,-644.03 3016,-634.03 3012.5,-644.03 3019.5,-644.03"/>
</g>
<!-- mlp2_s1_gpu13 -->
<g id="node179" class="node">
<title>mlp2_s1_gpu13</title>
<polygon fill="lightgreen" stroke="black" points="3084.5,-545 2962.5,-545 2962.5,-493 3084.5,-493 3084.5,-545"/>
<text text-anchor="middle" x="3023.5" y="-533" font-family="Arial" font-size="10.00">MLP2&#45;Shard5</text>
<text text-anchor="middle" x="3023.5" y="-522" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="3023.5" y="-511" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="3023.5" y="-500" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s1_gpu13&#45;&gt;mlp2_s1_gpu13 -->
<g id="edge249" class="edge">
<title>gelu_s1_gpu13&#45;&gt;mlp2_s1_gpu13</title>
<path fill="none" stroke="black" d="M3022.75,-581.78C3022.75,-581.78 3022.75,-555.03 3022.75,-555.03"/>
<polygon fill="black" stroke="black" points="3026.25,-555.03 3022.75,-545.03 3019.25,-555.03 3026.25,-555.03"/>
</g>
<!-- residual2_s1_gpu13 -->
<g id="node180" class="node">
<title>residual2_s1_gpu13</title>
<polygon fill="lightgreen" stroke="black" points="3088,-456 2963,-456 2963,-404 3088,-404 3088,-456"/>
<text text-anchor="middle" x="3025.5" y="-444" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="3025.5" y="-433" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="3025.5" y="-422" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="3025.5" y="-411" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s1_gpu13&#45;&gt;residual2_s1_gpu13 -->
<g id="edge250" class="edge">
<title>mlp2_s1_gpu13&#45;&gt;residual2_s1_gpu13</title>
<path fill="none" stroke="black" d="M3023.75,-492.78C3023.75,-492.78 3023.75,-466.03 3023.75,-466.03"/>
<polygon fill="black" stroke="black" points="3027.25,-466.03 3023.75,-456.03 3020.25,-466.03 3027.25,-466.03"/>
</g>
<!-- allreduce2_s1_gpu13 -->
<g id="node181" class="node">
<title>allreduce2_s1_gpu13</title>
<polygon fill="orange" stroke="black" points="3157.34,-367 2947.61,-367 2893.66,-263 3103.39,-263 3157.34,-367"/>
<text text-anchor="middle" x="3025.5" y="-329" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="3025.5" y="-318" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="3025.5" y="-307" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="3025.5" y="-296" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s1_gpu13&#45;&gt;allreduce2_s1_gpu13 -->
<g id="edge251" class="edge">
<title>residual2_s1_gpu13&#45;&gt;allreduce2_s1_gpu13</title>
<path fill="none" stroke="black" d="M3025.5,-403.9C3025.5,-403.9 3025.5,-377.32 3025.5,-377.32"/>
<polygon fill="black" stroke="black" points="3029,-377.32 3025.5,-367.32 3022,-377.32 3029,-377.32"/>
</g>
<!-- gate_s1_gpu13 -->
<g id="node183" class="node">
<title>gate_s1_gpu13</title>
<polygon fill="gold" stroke="black" points="3148.75,-226 2952.69,-226 2902.25,-100 3098.31,-100 3148.75,-226"/>
<text text-anchor="middle" x="3025.5" y="-182.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="3025.5" y="-171.5" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="3025.5" y="-160.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="3025.5" y="-149.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3025.5" y="-138.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s1_gpu13&#45;&gt;gate_s1_gpu13 -->
<g id="edge252" class="edge">
<title>allreduce2_s1_gpu13&#45;&gt;gate_s1_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3025.5,-262.69C3025.5,-262.69 3025.5,-236.16 3025.5,-236.16"/>
<polygon fill="black" stroke="black" points="3029,-236.16 3025.5,-226.16 3022,-236.16 3029,-236.16"/>
</g>
<!-- allreduce2_s1_gpu13&#45;&gt;output -->
<g id="edge254" class="edge">
<title>allreduce2_s1_gpu13&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3153.02,-314.83C3153.02,-311.43 3153.02,-257 3153.02,-257 3153.02,-257 3521.34,-257 3521.34,-257 3521.34,-257 3521.34,-194.33 3521.34,-194.33"/>
<polygon fill="black" stroke="black" points="3524.84,-194.33 3521.34,-184.33 3517.84,-194.33 3524.84,-194.33"/>
</g>
<!-- experts_s1_gpu13 -->
<g id="node182" class="node">
<title>experts_s1_gpu13</title>
<path fill="lightcoral" stroke="black" d="M3077,-63C3077,-63 2974,-63 2974,-63 2968,-63 2962,-57 2962,-51 2962,-51 2962,-12 2962,-12 2962,-6 2968,0 2974,0 2974,0 3077,0 3077,0 3083,0 3089,-6 3089,-12 3089,-12 3089,-51 3089,-51 3089,-57 3083,-63 3077,-63"/>
<text text-anchor="middle" x="3025.5" y="-51" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="3025.5" y="-40" font-family="Arial" font-size="10.00">GPU:13</text>
<text text-anchor="middle" x="3025.5" y="-29" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="3025.5" y="-18" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3025.5" y="-7" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- gate_s1_gpu13&#45;&gt;experts_s1_gpu13 -->
<g id="edge253" class="edge">
<title>gate_s1_gpu13&#45;&gt;experts_s1_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3025.5,-99.95C3025.5,-99.95 3025.5,-73.11 3025.5,-73.11"/>
<polygon fill="black" stroke="black" points="3029,-73.11 3025.5,-63.11 3022,-73.11 3029,-73.11"/>
</g>
<!-- attn_s1_gpu14 -->
<g id="node185" class="node">
<title>attn_s1_gpu14</title>
<polygon fill="lightgreen" stroke="black" points="5906.5,-1231 5784.5,-1231 5784.5,-1168 5906.5,-1168 5906.5,-1231"/>
<text text-anchor="middle" x="5845.5" y="-1219" font-family="Arial" font-size="10.00">MHA&#45;Shard6</text>
<text text-anchor="middle" x="5845.5" y="-1208" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="5845.5" y="-1197" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="5845.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5845.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s1_gpu14&#45;&gt;attn_s1_gpu14 -->
<g id="edge255" class="edge">
<title>ln1_s1_gpu14&#45;&gt;attn_s1_gpu14</title>
<path fill="none" stroke="black" d="M6226.74,-1322C6103.7,-1322 5845.5,-1322 5845.5,-1322 5845.5,-1322 5845.5,-1241.05 5845.5,-1241.05"/>
<polygon fill="black" stroke="black" points="5849,-1241.05 5845.5,-1231.05 5842,-1241.05 5849,-1241.05"/>
</g>
<!-- attn_proj_s1_gpu14 -->
<g id="node186" class="node">
<title>attn_proj_s1_gpu14</title>
<polygon fill="lightgreen" stroke="black" points="5760.5,-1131 5638.5,-1131 5638.5,-1079 5760.5,-1079 5760.5,-1131"/>
<text text-anchor="middle" x="5699.5" y="-1119" font-family="Arial" font-size="10.00">AttnProj&#45;Shard6</text>
<text text-anchor="middle" x="5699.5" y="-1108" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="5699.5" y="-1097" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="5699.5" y="-1086" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s1_gpu14&#45;&gt;attn_proj_s1_gpu14 -->
<g id="edge256" class="edge">
<title>attn_s1_gpu14&#45;&gt;attn_proj_s1_gpu14</title>
<path fill="none" stroke="black" d="M5784.36,-1199C5747.97,-1199 5708.83,-1199 5708.83,-1199 5708.83,-1199 5708.83,-1141.18 5708.83,-1141.18"/>
<polygon fill="black" stroke="black" points="5712.33,-1141.18 5708.83,-1131.18 5705.33,-1141.18 5712.33,-1141.18"/>
</g>
<!-- residual1_s1_gpu14 -->
<g id="node187" class="node">
<title>residual1_s1_gpu14</title>
<polygon fill="lightgreen" stroke="black" points="5650,-1042 5525,-1042 5525,-990 5650,-990 5650,-1042"/>
<text text-anchor="middle" x="5587.5" y="-1030" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="5587.5" y="-1019" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="5587.5" y="-1008" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="5587.5" y="-997" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s1_gpu14&#45;&gt;residual1_s1_gpu14 -->
<g id="edge257" class="edge">
<title>attn_proj_s1_gpu14&#45;&gt;residual1_s1_gpu14</title>
<path fill="none" stroke="black" d="M5644.25,-1078.78C5644.25,-1078.78 5644.25,-1052.03 5644.25,-1052.03"/>
<polygon fill="black" stroke="black" points="5647.75,-1052.03 5644.25,-1042.03 5640.75,-1052.03 5647.75,-1052.03"/>
</g>
<!-- allreduce1_s1_gpu14 -->
<g id="node188" class="node">
<title>allreduce1_s1_gpu14</title>
<polygon fill="orange" stroke="black" points="5565.34,-953 5355.61,-953 5301.66,-849 5511.39,-849 5565.34,-953"/>
<text text-anchor="middle" x="5433.5" y="-915" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="5433.5" y="-904" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="5433.5" y="-893" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="5433.5" y="-882" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s1_gpu14&#45;&gt;allreduce1_s1_gpu14 -->
<g id="edge258" class="edge">
<title>residual1_s1_gpu14&#45;&gt;allreduce1_s1_gpu14</title>
<path fill="none" stroke="black" d="M5545.08,-989.9C5545.08,-989.9 5545.08,-963.32 5545.08,-963.32"/>
<polygon fill="black" stroke="black" points="5548.58,-963.32 5545.08,-953.32 5541.58,-963.32 5548.58,-963.32"/>
</g>
<!-- ln2_s1_gpu14 -->
<g id="node189" class="node">
<title>ln2_s1_gpu14</title>
<polygon fill="lightgreen" stroke="black" points="5433,-812 5306,-812 5306,-760 5433,-760 5433,-812"/>
<text text-anchor="middle" x="5369.5" y="-800" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="5369.5" y="-789" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="5369.5" y="-778" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5369.5" y="-767" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s1_gpu14&#45;&gt;ln2_s1_gpu14 -->
<g id="edge259" class="edge">
<title>allreduce1_s1_gpu14&#45;&gt;ln2_s1_gpu14</title>
<path fill="none" stroke="black" d="M5369.5,-848.88C5369.5,-848.88 5369.5,-822.19 5369.5,-822.19"/>
<polygon fill="black" stroke="black" points="5373,-822.19 5369.5,-812.19 5366,-822.19 5373,-822.19"/>
</g>
<!-- mlp1_s1_gpu14 -->
<g id="node190" class="node">
<title>mlp1_s1_gpu14</title>
<polygon fill="lightgreen" stroke="black" points="5241,-723 5114,-723 5114,-671 5241,-671 5241,-723"/>
<text text-anchor="middle" x="5177.5" y="-711" font-family="Arial" font-size="10.00">MLP1&#45;Shard6</text>
<text text-anchor="middle" x="5177.5" y="-700" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="5177.5" y="-689" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5177.5" y="-678" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s1_gpu14&#45;&gt;mlp1_s1_gpu14 -->
<g id="edge260" class="edge">
<title>ln2_s1_gpu14&#45;&gt;mlp1_s1_gpu14</title>
<path fill="none" stroke="black" d="M5305.7,-786C5258.36,-786 5202,-786 5202,-786 5202,-786 5202,-733.22 5202,-733.22"/>
<polygon fill="black" stroke="black" points="5205.5,-733.22 5202,-723.22 5198.5,-733.22 5205.5,-733.22"/>
</g>
<!-- gelu_s1_gpu14 -->
<g id="node191" class="node">
<title>gelu_s1_gpu14</title>
<polygon fill="lightgreen" stroke="black" points="5170,-634 5043,-634 5043,-582 5170,-582 5170,-634"/>
<text text-anchor="middle" x="5106.5" y="-622" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="5106.5" y="-611" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="5106.5" y="-600" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="5106.5" y="-589" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s1_gpu14&#45;&gt;gelu_s1_gpu14 -->
<g id="edge261" class="edge">
<title>mlp1_s1_gpu14&#45;&gt;gelu_s1_gpu14</title>
<path fill="none" stroke="black" d="M5142,-670.78C5142,-670.78 5142,-644.03 5142,-644.03"/>
<polygon fill="black" stroke="black" points="5145.5,-644.03 5142,-634.03 5138.5,-644.03 5145.5,-644.03"/>
</g>
<!-- mlp2_s1_gpu14 -->
<g id="node192" class="node">
<title>mlp2_s1_gpu14</title>
<polygon fill="lightgreen" stroke="black" points="5067.5,-545 4945.5,-545 4945.5,-493 5067.5,-493 5067.5,-545"/>
<text text-anchor="middle" x="5006.5" y="-533" font-family="Arial" font-size="10.00">MLP2&#45;Shard6</text>
<text text-anchor="middle" x="5006.5" y="-522" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="5006.5" y="-511" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="5006.5" y="-500" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s1_gpu14&#45;&gt;mlp2_s1_gpu14 -->
<g id="edge262" class="edge">
<title>gelu_s1_gpu14&#45;&gt;mlp2_s1_gpu14</title>
<path fill="none" stroke="black" d="M5055.25,-581.78C5055.25,-581.78 5055.25,-555.03 5055.25,-555.03"/>
<polygon fill="black" stroke="black" points="5058.75,-555.03 5055.25,-545.03 5051.75,-555.03 5058.75,-555.03"/>
</g>
<!-- residual2_s1_gpu14 -->
<g id="node193" class="node">
<title>residual2_s1_gpu14</title>
<polygon fill="lightgreen" stroke="black" points="4976,-456 4851,-456 4851,-404 4976,-404 4976,-456"/>
<text text-anchor="middle" x="4913.5" y="-444" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="4913.5" y="-433" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="4913.5" y="-422" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="4913.5" y="-411" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s1_gpu14&#45;&gt;residual2_s1_gpu14 -->
<g id="edge263" class="edge">
<title>mlp2_s1_gpu14&#45;&gt;residual2_s1_gpu14</title>
<path fill="none" stroke="black" d="M4960.75,-492.78C4960.75,-492.78 4960.75,-466.03 4960.75,-466.03"/>
<polygon fill="black" stroke="black" points="4964.25,-466.03 4960.75,-456.03 4957.25,-466.03 4964.25,-466.03"/>
</g>
<!-- allreduce2_s1_gpu14 -->
<g id="node194" class="node">
<title>allreduce2_s1_gpu14</title>
<polygon fill="orange" stroke="black" points="4989.34,-367 4779.61,-367 4725.66,-263 4935.39,-263 4989.34,-367"/>
<text text-anchor="middle" x="4857.5" y="-329" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="4857.5" y="-318" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="4857.5" y="-307" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="4857.5" y="-296" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s1_gpu14&#45;&gt;allreduce2_s1_gpu14 -->
<g id="edge264" class="edge">
<title>residual2_s1_gpu14&#45;&gt;allreduce2_s1_gpu14</title>
<path fill="none" stroke="black" d="M4913.5,-403.9C4913.5,-403.9 4913.5,-377.32 4913.5,-377.32"/>
<polygon fill="black" stroke="black" points="4917,-377.32 4913.5,-367.32 4910,-377.32 4917,-377.32"/>
</g>
<!-- gate_s1_gpu14 -->
<g id="node196" class="node">
<title>gate_s1_gpu14</title>
<polygon fill="gold" stroke="black" points="4980.75,-226 4784.69,-226 4734.25,-100 4930.31,-100 4980.75,-226"/>
<text text-anchor="middle" x="4857.5" y="-182.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="4857.5" y="-171.5" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="4857.5" y="-160.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="4857.5" y="-149.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4857.5" y="-138.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s1_gpu14&#45;&gt;gate_s1_gpu14 -->
<g id="edge265" class="edge">
<title>allreduce2_s1_gpu14&#45;&gt;gate_s1_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4857.5,-262.69C4857.5,-262.69 4857.5,-236.16 4857.5,-236.16"/>
<polygon fill="black" stroke="black" points="4861,-236.16 4857.5,-226.16 4854,-236.16 4861,-236.16"/>
</g>
<!-- allreduce2_s1_gpu14&#45;&gt;output -->
<g id="edge267" class="edge">
<title>allreduce2_s1_gpu14&#45;&gt;output</title>
<path fill="none" stroke="black" d="M4729.98,-314.94C4729.98,-312.4 4729.98,-231 4729.98,-231 4729.98,-231 3824.24,-231 3824.24,-231 3824.24,-231 3824.24,-185.47 3824.24,-185.47"/>
<polygon fill="black" stroke="black" points="3827.74,-185.47 3824.24,-175.47 3820.74,-185.47 3827.74,-185.47"/>
</g>
<!-- experts_s1_gpu14 -->
<g id="node195" class="node">
<title>experts_s1_gpu14</title>
<path fill="lightcoral" stroke="black" d="M4909,-63C4909,-63 4806,-63 4806,-63 4800,-63 4794,-57 4794,-51 4794,-51 4794,-12 4794,-12 4794,-6 4800,0 4806,0 4806,0 4909,0 4909,0 4915,0 4921,-6 4921,-12 4921,-12 4921,-51 4921,-51 4921,-57 4915,-63 4909,-63"/>
<text text-anchor="middle" x="4857.5" y="-51" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="4857.5" y="-40" font-family="Arial" font-size="10.00">GPU:14</text>
<text text-anchor="middle" x="4857.5" y="-29" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="4857.5" y="-18" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4857.5" y="-7" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- gate_s1_gpu14&#45;&gt;experts_s1_gpu14 -->
<g id="edge266" class="edge">
<title>gate_s1_gpu14&#45;&gt;experts_s1_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4857.5,-99.95C4857.5,-99.95 4857.5,-73.11 4857.5,-73.11"/>
<polygon fill="black" stroke="black" points="4861,-73.11 4857.5,-63.11 4854,-73.11 4861,-73.11"/>
</g>
<!-- attn_s1_gpu15 -->
<g id="node198" class="node">
<title>attn_s1_gpu15</title>
<polygon fill="lightgreen" stroke="black" points="2165.5,-1231 2043.5,-1231 2043.5,-1168 2165.5,-1168 2165.5,-1231"/>
<text text-anchor="middle" x="2104.5" y="-1219" font-family="Arial" font-size="10.00">MHA&#45;Shard7</text>
<text text-anchor="middle" x="2104.5" y="-1208" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2104.5" y="-1197" font-family="Arial" font-size="10.00">Heads: 4/32</text>
<text text-anchor="middle" x="2104.5" y="-1186" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2104.5" y="-1175" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- ln1_s1_gpu15&#45;&gt;attn_s1_gpu15 -->
<g id="edge268" class="edge">
<title>ln1_s1_gpu15&#45;&gt;attn_s1_gpu15</title>
<path fill="none" stroke="black" d="M1845.05,-1331C1936.32,-1331 2093.67,-1331 2093.67,-1331 2093.67,-1331 2093.67,-1241.33 2093.67,-1241.33"/>
<polygon fill="black" stroke="black" points="2097.17,-1241.33 2093.67,-1231.33 2090.17,-1241.33 2097.17,-1241.33"/>
</g>
<!-- attn_proj_s1_gpu15 -->
<g id="node199" class="node">
<title>attn_proj_s1_gpu15</title>
<polygon fill="lightgreen" stroke="black" points="2472.5,-1131 2350.5,-1131 2350.5,-1079 2472.5,-1079 2472.5,-1131"/>
<text text-anchor="middle" x="2411.5" y="-1119" font-family="Arial" font-size="10.00">AttnProj&#45;Shard7</text>
<text text-anchor="middle" x="2411.5" y="-1108" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2411.5" y="-1097" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2411.5" y="-1086" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_s1_gpu15&#45;&gt;attn_proj_s1_gpu15 -->
<g id="edge269" class="edge">
<title>attn_s1_gpu15&#45;&gt;attn_proj_s1_gpu15</title>
<path fill="none" stroke="black" d="M2165.68,-1199C2260.43,-1199 2431.83,-1199 2431.83,-1199 2431.83,-1199 2431.83,-1141.18 2431.83,-1141.18"/>
<polygon fill="black" stroke="black" points="2435.33,-1141.18 2431.83,-1131.18 2428.33,-1141.18 2435.33,-1141.18"/>
</g>
<!-- residual1_s1_gpu15 -->
<g id="node200" class="node">
<title>residual1_s1_gpu15</title>
<polygon fill="lightgreen" stroke="black" points="2545,-1042 2420,-1042 2420,-990 2545,-990 2545,-1042"/>
<text text-anchor="middle" x="2482.5" y="-1030" font-family="Arial" font-size="10.00">ResidualAdd1</text>
<text text-anchor="middle" x="2482.5" y="-1019" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2482.5" y="-1008" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2482.5" y="-997" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- attn_proj_s1_gpu15&#45;&gt;residual1_s1_gpu15 -->
<g id="edge270" class="edge">
<title>attn_proj_s1_gpu15&#45;&gt;residual1_s1_gpu15</title>
<path fill="none" stroke="black" d="M2446.25,-1078.78C2446.25,-1078.78 2446.25,-1052.03 2446.25,-1052.03"/>
<polygon fill="black" stroke="black" points="2449.75,-1052.03 2446.25,-1042.03 2442.75,-1052.03 2449.75,-1052.03"/>
</g>
<!-- allreduce1_s1_gpu15 -->
<g id="node201" class="node">
<title>allreduce1_s1_gpu15</title>
<polygon fill="orange" stroke="black" points="2782.34,-953 2572.61,-953 2518.66,-849 2728.39,-849 2782.34,-953"/>
<text text-anchor="middle" x="2650.5" y="-915" font-family="Arial" font-size="10.00">AllReduce&#45;Attn</text>
<text text-anchor="middle" x="2650.5" y="-904" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2650.5" y="-893" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2650.5" y="-882" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual1_s1_gpu15&#45;&gt;allreduce1_s1_gpu15 -->
<g id="edge271" class="edge">
<title>residual1_s1_gpu15&#45;&gt;allreduce1_s1_gpu15</title>
<path fill="none" stroke="black" d="M2531.92,-989.9C2531.92,-989.9 2531.92,-911.16 2531.92,-911.16"/>
<polygon fill="black" stroke="black" points="2535.42,-911.16 2531.92,-901.16 2528.42,-911.16 2535.42,-911.16"/>
</g>
<!-- ln2_s1_gpu15 -->
<g id="node202" class="node">
<title>ln2_s1_gpu15</title>
<polygon fill="lightgreen" stroke="black" points="2744,-812 2617,-812 2617,-760 2744,-760 2744,-812"/>
<text text-anchor="middle" x="2680.5" y="-800" font-family="Arial" font-size="10.00">LayerNorm2</text>
<text text-anchor="middle" x="2680.5" y="-789" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2680.5" y="-778" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2680.5" y="-767" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- allreduce1_s1_gpu15&#45;&gt;ln2_s1_gpu15 -->
<g id="edge272" class="edge">
<title>allreduce1_s1_gpu15&#45;&gt;ln2_s1_gpu15</title>
<path fill="none" stroke="black" d="M2680.5,-848.88C2680.5,-848.88 2680.5,-822.19 2680.5,-822.19"/>
<polygon fill="black" stroke="black" points="2684,-822.19 2680.5,-812.19 2677,-822.19 2684,-822.19"/>
</g>
<!-- mlp1_s1_gpu15 -->
<g id="node203" class="node">
<title>mlp1_s1_gpu15</title>
<polygon fill="lightgreen" stroke="black" points="2758,-723 2631,-723 2631,-671 2758,-671 2758,-723"/>
<text text-anchor="middle" x="2694.5" y="-711" font-family="Arial" font-size="10.00">MLP1&#45;Shard7</text>
<text text-anchor="middle" x="2694.5" y="-700" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2694.5" y="-689" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2694.5" y="-678" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- ln2_s1_gpu15&#45;&gt;mlp1_s1_gpu15 -->
<g id="edge273" class="edge">
<title>ln2_s1_gpu15&#45;&gt;mlp1_s1_gpu15</title>
<path fill="none" stroke="black" d="M2687.5,-759.78C2687.5,-759.78 2687.5,-733.03 2687.5,-733.03"/>
<polygon fill="black" stroke="black" points="2691,-733.03 2687.5,-723.03 2684,-733.03 2691,-733.03"/>
</g>
<!-- gelu_s1_gpu15 -->
<g id="node204" class="node">
<title>gelu_s1_gpu15</title>
<polygon fill="lightgreen" stroke="black" points="2779,-634 2652,-634 2652,-582 2779,-582 2779,-634"/>
<text text-anchor="middle" x="2715.5" y="-622" font-family="Arial" font-size="10.00">GELU</text>
<text text-anchor="middle" x="2715.5" y="-611" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2715.5" y="-600" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="2715.5" y="-589" font-family="Arial" font-size="10.00">Output: [128,10000,2048]</text>
</g>
<!-- mlp1_s1_gpu15&#45;&gt;gelu_s1_gpu15 -->
<g id="edge274" class="edge">
<title>mlp1_s1_gpu15&#45;&gt;gelu_s1_gpu15</title>
<path fill="none" stroke="black" d="M2705,-670.78C2705,-670.78 2705,-644.03 2705,-644.03"/>
<polygon fill="black" stroke="black" points="2708.5,-644.03 2705,-634.03 2701.5,-644.03 2708.5,-644.03"/>
</g>
<!-- mlp2_s1_gpu15 -->
<g id="node205" class="node">
<title>mlp2_s1_gpu15</title>
<polygon fill="lightgreen" stroke="black" points="2791.5,-545 2669.5,-545 2669.5,-493 2791.5,-493 2791.5,-545"/>
<text text-anchor="middle" x="2730.5" y="-533" font-family="Arial" font-size="10.00">MLP2&#45;Shard7</text>
<text text-anchor="middle" x="2730.5" y="-522" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2730.5" y="-511" font-family="Arial" font-size="10.00">Input: [128,10000,2048]</text>
<text text-anchor="middle" x="2730.5" y="-500" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- gelu_s1_gpu15&#45;&gt;mlp2_s1_gpu15 -->
<g id="edge275" class="edge">
<title>gelu_s1_gpu15&#45;&gt;mlp2_s1_gpu15</title>
<path fill="none" stroke="black" d="M2724.25,-581.78C2724.25,-581.78 2724.25,-555.03 2724.25,-555.03"/>
<polygon fill="black" stroke="black" points="2727.75,-555.03 2724.25,-545.03 2720.75,-555.03 2727.75,-555.03"/>
</g>
<!-- residual2_s1_gpu15 -->
<g id="node206" class="node">
<title>residual2_s1_gpu15</title>
<polygon fill="lightgreen" stroke="black" points="2802,-456 2677,-456 2677,-404 2802,-404 2802,-456"/>
<text text-anchor="middle" x="2739.5" y="-444" font-family="Arial" font-size="10.00">ResidualAdd2</text>
<text text-anchor="middle" x="2739.5" y="-433" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2739.5" y="-422" font-family="Arial" font-size="10.00">Input: [128,10000,512]x2</text>
<text text-anchor="middle" x="2739.5" y="-411" font-family="Arial" font-size="10.00">Output: [128,10000,512]</text>
</g>
<!-- mlp2_s1_gpu15&#45;&gt;residual2_s1_gpu15 -->
<g id="edge276" class="edge">
<title>mlp2_s1_gpu15&#45;&gt;residual2_s1_gpu15</title>
<path fill="none" stroke="black" d="M2734.25,-492.78C2734.25,-492.78 2734.25,-466.03 2734.25,-466.03"/>
<polygon fill="black" stroke="black" points="2737.75,-466.03 2734.25,-456.03 2730.75,-466.03 2737.75,-466.03"/>
</g>
<!-- allreduce2_s1_gpu15 -->
<g id="node207" class="node">
<title>allreduce2_s1_gpu15</title>
<polygon fill="orange" stroke="black" points="2871.34,-367 2661.61,-367 2607.66,-263 2817.39,-263 2871.34,-367"/>
<text text-anchor="middle" x="2739.5" y="-329" font-family="Arial" font-size="10.00">AllReduce&#45;MLP</text>
<text text-anchor="middle" x="2739.5" y="-318" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2739.5" y="-307" font-family="Arial" font-size="10.00">Input: [128,10000,512]</text>
<text text-anchor="middle" x="2739.5" y="-296" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- residual2_s1_gpu15&#45;&gt;allreduce2_s1_gpu15 -->
<g id="edge277" class="edge">
<title>residual2_s1_gpu15&#45;&gt;allreduce2_s1_gpu15</title>
<path fill="none" stroke="black" d="M2739.5,-403.9C2739.5,-403.9 2739.5,-377.32 2739.5,-377.32"/>
<polygon fill="black" stroke="black" points="2743,-377.32 2739.5,-367.32 2736,-377.32 2743,-377.32"/>
</g>
<!-- gate_s1_gpu15 -->
<g id="node209" class="node">
<title>gate_s1_gpu15</title>
<polygon fill="gold" stroke="black" points="2862.75,-226 2666.69,-226 2616.25,-100 2812.31,-100 2862.75,-226"/>
<text text-anchor="middle" x="2739.5" y="-182.5" font-family="Arial" font-size="10.00">ExpertGate</text>
<text text-anchor="middle" x="2739.5" y="-171.5" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2739.5" y="-160.5" font-family="Arial" font-size="10.00">Top&#45;K=2 routing</text>
<text text-anchor="middle" x="2739.5" y="-149.5" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2739.5" y="-138.5" font-family="Arial" font-size="10.00">Output: [128,10000,16]</text>
</g>
<!-- allreduce2_s1_gpu15&#45;&gt;gate_s1_gpu15 -->
<g id="edge278" class="edge">
<title>allreduce2_s1_gpu15&#45;&gt;gate_s1_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2739.5,-262.69C2739.5,-262.69 2739.5,-236.16 2739.5,-236.16"/>
<polygon fill="black" stroke="black" points="2743,-236.16 2739.5,-226.16 2736,-236.16 2743,-236.16"/>
</g>
<!-- allreduce2_s1_gpu15&#45;&gt;output -->
<g id="edge280" class="edge">
<title>allreduce2_s1_gpu15&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2867.02,-314.95C2867.02,-313.05 2867.02,-252 2867.02,-252 2867.02,-252 3501.66,-252 3501.66,-252 3501.66,-252 3501.66,-191.01 3501.66,-191.01"/>
<polygon fill="black" stroke="black" points="3505.16,-191.01 3501.66,-181.01 3498.16,-191.01 3505.16,-191.01"/>
</g>
<!-- experts_s1_gpu15 -->
<g id="node208" class="node">
<title>experts_s1_gpu15</title>
<path fill="lightcoral" stroke="black" d="M2791,-63C2791,-63 2688,-63 2688,-63 2682,-63 2676,-57 2676,-51 2676,-51 2676,-12 2676,-12 2676,-6 2682,0 2688,0 2688,0 2791,0 2791,0 2797,0 2803,-6 2803,-12 2803,-12 2803,-51 2803,-51 2803,-57 2797,-63 2791,-63"/>
<text text-anchor="middle" x="2739.5" y="-51" font-family="Arial" font-size="10.00">All&#45;16&#45;Experts</text>
<text text-anchor="middle" x="2739.5" y="-40" font-family="Arial" font-size="10.00">GPU:15</text>
<text text-anchor="middle" x="2739.5" y="-29" font-family="Arial" font-size="10.00">16 MLP Experts (shared)</text>
<text text-anchor="middle" x="2739.5" y="-18" font-family="Arial" font-size="10.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2739.5" y="-7" font-family="Arial" font-size="10.00">Output: [128,10000,4096]</text>
</g>
<!-- gate_s1_gpu15&#45;&gt;experts_s1_gpu15 -->
<g id="edge279" class="edge">
<title>gate_s1_gpu15&#45;&gt;experts_s1_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2739.5,-99.95C2739.5,-99.95 2739.5,-73.11 2739.5,-73.11"/>
<polygon fill="black" stroke="black" points="2743,-73.11 2739.5,-63.11 2736,-73.11 2743,-73.11"/>
</g>
</g>
</svg>
