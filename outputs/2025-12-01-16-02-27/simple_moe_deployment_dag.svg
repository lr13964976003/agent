<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="5706pt" height="15000pt"
 viewBox="0.00 0.00 1369.36 3600.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(2.98 2.98) rotate(0) translate(4 5029.4)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-5029.4 1910.6,-5029.4 1910.6,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="1035.8" cy="-4987.93" rx="323.71" ry="37.45"/>
<text text-anchor="middle" x="1035.8" y="-4999.23" font-family="Times,serif" font-size="14.00">Total Input</text>
<text text-anchor="middle" x="1035.8" y="-4984.23" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1035.8" y="-4969.23" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer0_input -->
<g id="node2" class="node">
<title>layer0_input</title>
<polygon fill="lightyellow" stroke="black" points="1510.47,-4914.45 755.38,-4914.45 561.13,-4778.45 1316.22,-4778.45 1510.47,-4914.45"/>
<text text-anchor="middle" x="1035.8" y="-4865.25" font-family="Times,serif" font-size="14.00">Layer 0 Input</text>
<text text-anchor="middle" x="1035.8" y="-4850.25" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="1035.8" y="-4835.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1035.8" y="-4820.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- input&#45;&gt;layer0_input -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layer0_input</title>
<path fill="none" stroke="black" d="M1035.8,-4950.28C1035.8,-4942.31 1035.8,-4933.58 1035.8,-4924.69"/>
<polygon fill="black" stroke="black" points="1039.3,-4924.61 1035.8,-4914.61 1032.3,-4924.61 1039.3,-4924.61"/>
</g>
<!-- layer0_qkv -->
<g id="node3" class="node">
<title>layer0_qkv</title>
<ellipse fill="lightcoral" stroke="black" cx="854.8" cy="-4694.37" rx="333.51" ry="48.17"/>
<text text-anchor="middle" x="854.8" y="-4713.17" font-family="Times,serif" font-size="14.00">QKV Linear (TP=4)</text>
<text text-anchor="middle" x="854.8" y="-4698.17" font-family="Times,serif" font-size="14.00">GPU: [0&#45;3]</text>
<text text-anchor="middle" x="854.8" y="-4683.17" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="854.8" y="-4668.17" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, heads=16, d_k=192]</text>
</g>
<!-- layer0_input&#45;&gt;layer0_qkv -->
<g id="edge2" class="edge">
<title>layer0_input&#45;&gt;layer0_qkv</title>
<path fill="none" stroke="black" d="M954.83,-4778.31C942.74,-4768.29 930.43,-4758.08 918.77,-4748.41"/>
<polygon fill="black" stroke="black" points="920.73,-4745.49 910.8,-4741.8 916.27,-4750.88 920.73,-4745.49"/>
</g>
<!-- layer0_attn_residual -->
<g id="node6" class="node">
<title>layer0_attn_residual</title>
<polygon fill="lightyellow" stroke="black" points="1906.4,-4345.95 524.65,-4345.95 169.2,-4209.95 1550.95,-4209.95 1906.4,-4345.95"/>
<text text-anchor="middle" x="1037.8" y="-4296.75" font-family="Times,serif" font-size="14.00">Attention + Residual</text>
<text text-anchor="middle" x="1037.8" y="-4281.75" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="1037.8" y="-4266.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024], [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1037.8" y="-4251.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer0_input&#45;&gt;layer0_attn_residual -->
<g id="edge5" class="edge">
<title>layer0_input&#45;&gt;layer0_attn_residual</title>
<path fill="none" stroke="black" d="M1169.09,-4778.36C1180.46,-4767.82 1190.42,-4755.89 1197.8,-4742.45 1226.56,-4690.08 1269.38,-4518.23 1194.8,-4381.95 1189.11,-4371.56 1181.88,-4362.05 1173.65,-4353.37"/>
<polygon fill="black" stroke="black" points="1176.08,-4350.84 1166.52,-4346.27 1171.14,-4355.81 1176.08,-4350.84"/>
</g>
<!-- layer0_attn -->
<g id="node4" class="node">
<title>layer0_attn</title>
<ellipse fill="lightcoral" stroke="black" cx="858.8" cy="-4562.2" rx="327.28" ry="48.17"/>
<text text-anchor="middle" x="858.8" y="-4581" font-family="Times,serif" font-size="14.00">Attention Compute</text>
<text text-anchor="middle" x="858.8" y="-4566" font-family="Times,serif" font-size="14.00">GPU: [0&#45;3]</text>
<text text-anchor="middle" x="858.8" y="-4551" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, heads=16, d_k=192]</text>
<text text-anchor="middle" x="858.8" y="-4536" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, heads=16, d_k=64]</text>
</g>
<!-- layer0_qkv&#45;&gt;layer0_attn -->
<g id="edge3" class="edge">
<title>layer0_qkv&#45;&gt;layer0_attn</title>
<path fill="none" stroke="black" d="M856.25,-4646.01C856.51,-4637.74 856.78,-4629.06 857.04,-4620.55"/>
<polygon fill="black" stroke="black" points="860.54,-4620.41 857.35,-4610.31 853.55,-4620.2 860.54,-4620.41"/>
</g>
<!-- layer0_attn_allreduce -->
<g id="node5" class="node">
<title>layer0_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="861.8" cy="-4430.03" rx="323.71" ry="48.17"/>
<text text-anchor="middle" x="861.8" y="-4448.83" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="861.8" y="-4433.83" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="861.8" y="-4418.83" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, heads=16, d_k=64]</text>
<text text-anchor="middle" x="861.8" y="-4403.83" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer0_attn&#45;&gt;layer0_attn_allreduce -->
<g id="edge4" class="edge">
<title>layer0_attn&#45;&gt;layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M859.89,-4513.84C860.08,-4505.57 860.28,-4496.89 860.48,-4488.39"/>
<polygon fill="black" stroke="black" points="863.98,-4488.22 860.71,-4478.14 856.98,-4488.06 863.98,-4488.22"/>
</g>
<!-- layer0_attn_allreduce&#45;&gt;layer0_attn_residual -->
<g id="edge6" class="edge">
<title>layer0_attn_allreduce&#45;&gt;layer0_attn_residual</title>
<path fill="none" stroke="black" d="M916.52,-4382.37C927.61,-4372.91 939.53,-4362.75 951.41,-4352.62"/>
<polygon fill="black" stroke="black" points="953.87,-4355.12 959.21,-4345.97 949.33,-4349.8 953.87,-4355.12"/>
</g>
<!-- layer0_gate -->
<g id="node7" class="node">
<title>layer0_gate</title>
<ellipse fill="lightgreen" stroke="black" cx="864.8" cy="-4125.87" rx="318.4" ry="48.17"/>
<text text-anchor="middle" x="864.8" y="-4144.67" font-family="Times,serif" font-size="14.00">MoE Gate Network</text>
<text text-anchor="middle" x="864.8" y="-4129.67" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="864.8" y="-4114.67" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="864.8" y="-4099.67" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, num_experts=64]</text>
</g>
<!-- layer0_attn_residual&#45;&gt;layer0_gate -->
<g id="edge7" class="edge">
<title>layer0_attn_residual&#45;&gt;layer0_gate</title>
<path fill="none" stroke="black" d="M960.41,-4209.81C948.86,-4199.79 937.09,-4189.58 925.94,-4179.91"/>
<polygon fill="black" stroke="black" points="928.17,-4177.21 918.33,-4173.3 923.59,-4182.5 928.17,-4177.21"/>
</g>
<!-- layer0_moe_residual -->
<g id="node11" class="node">
<title>layer0_moe_residual</title>
<polygon fill="lightyellow" stroke="black" points="1847.4,-3605.45 465.65,-3605.45 110.2,-3469.45 1491.95,-3469.45 1847.4,-3605.45"/>
<text text-anchor="middle" x="978.8" y="-3556.25" font-family="Times,serif" font-size="14.00">MoE + Residual</text>
<text text-anchor="middle" x="978.8" y="-3541.25" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="978.8" y="-3526.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024], [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="978.8" y="-3511.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer0_attn_residual&#45;&gt;layer0_moe_residual -->
<g id="edge11" class="edge">
<title>layer0_attn_residual&#45;&gt;layer0_moe_residual</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1159.26,-4209.7C1171.59,-4199.03 1182.84,-4187.11 1191.8,-4173.95 1237.68,-4106.56 1230.8,-4076.23 1230.8,-3994.7 1230.8,-3994.7 1230.8,-3994.7 1230.8,-3860.53 1230.8,-3762.8 1268.63,-3720.97 1211.8,-3641.45 1204.01,-3630.56 1194.81,-3620.8 1184.63,-3612.06"/>
<polygon fill="black" stroke="black" points="1186.63,-3609.17 1176.66,-3605.57 1182.21,-3614.6 1186.63,-3609.17"/>
</g>
<!-- layer0_expert0 -->
<g id="node8" class="node">
<title>layer0_expert0</title>
<ellipse fill="lightsalmon" stroke="black" cx="844.8" cy="-3993.7" rx="311.25" ry="48.17"/>
<text text-anchor="middle" x="844.8" y="-4012.5" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="844.8" y="-3997.5" font-family="Times,serif" font-size="14.00">GPU: [0&#45;3]</text>
<text text-anchor="middle" x="844.8" y="-3982.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="844.8" y="-3967.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_expert0 -->
<g id="edge8" class="edge">
<title>layer0_gate&#45;&gt;layer0_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M857.52,-4077.51C856.24,-4069.15 854.89,-4060.36 853.57,-4051.77"/>
<polygon fill="black" stroke="black" points="857.02,-4051.16 852.04,-4041.81 850.1,-4052.22 857.02,-4051.16"/>
</g>
<!-- layer0_alltoall -->
<g id="node9" class="node">
<title>layer0_alltoall</title>
<ellipse fill="lightpink" stroke="black" cx="766.8" cy="-3861.53" rx="311.25" ry="48.17"/>
<text text-anchor="middle" x="766.8" y="-3880.33" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Expert Routing</text>
<text text-anchor="middle" x="766.8" y="-3865.33" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="766.8" y="-3850.33" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="766.8" y="-3835.33" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer0_expert0&#45;&gt;layer0_alltoall -->
<g id="edge9" class="edge">
<title>layer0_expert0&#45;&gt;layer0_alltoall</title>
<path fill="none" stroke="black" d="M816.64,-3945.71C811.28,-3936.77 805.63,-3927.33 800.13,-3918.16"/>
<polygon fill="black" stroke="black" points="803.06,-3916.24 794.92,-3909.46 797.06,-3919.84 803.06,-3916.24"/>
</g>
<!-- layer0_moe_aggregate -->
<g id="node10" class="node">
<title>layer0_moe_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="1202.47,-3777.45 447.38,-3777.45 253.13,-3641.45 1008.22,-3641.45 1202.47,-3777.45"/>
<text text-anchor="middle" x="727.8" y="-3728.25" font-family="Times,serif" font-size="14.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="727.8" y="-3713.25" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="727.8" y="-3698.25" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="727.8" y="-3683.25" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer0_alltoall&#45;&gt;layer0_moe_aggregate -->
<g id="edge10" class="edge">
<title>layer0_alltoall&#45;&gt;layer0_moe_aggregate</title>
<path fill="none" stroke="black" d="M754.57,-3813.46C752.42,-3805.21 750.14,-3796.44 747.86,-3787.63"/>
<polygon fill="black" stroke="black" points="751.18,-3786.5 745.27,-3777.7 744.4,-3788.26 751.18,-3786.5"/>
</g>
<!-- layer0_moe_aggregate&#45;&gt;layer0_moe_residual -->
<g id="edge12" class="edge">
<title>layer0_moe_aggregate&#45;&gt;layer0_moe_residual</title>
<path fill="none" stroke="black" d="M827,-3641.26C841.43,-3631.49 856.35,-3621.38 870.95,-3611.5"/>
<polygon fill="black" stroke="black" points="873.18,-3614.21 879.5,-3605.71 869.25,-3608.42 873.18,-3614.21"/>
</g>
<!-- layer0_output -->
<g id="node12" class="node">
<title>layer0_output</title>
<ellipse fill="lightblue" stroke="black" cx="978.8" cy="-3385.37" rx="323.71" ry="48.17"/>
<text text-anchor="middle" x="978.8" y="-3404.17" font-family="Times,serif" font-size="14.00">Layer 0 Output</text>
<text text-anchor="middle" x="978.8" y="-3389.17" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="978.8" y="-3374.17" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="978.8" y="-3359.17" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer0_moe_residual&#45;&gt;layer0_output -->
<g id="edge13" class="edge">
<title>layer0_moe_residual&#45;&gt;layer0_output</title>
<path fill="none" stroke="black" d="M978.8,-3469.31C978.8,-3460.77 978.8,-3452.08 978.8,-3443.71"/>
<polygon fill="black" stroke="black" points="982.3,-3443.68 978.8,-3433.68 975.3,-3443.68 982.3,-3443.68"/>
</g>
<!-- layer1_input -->
<g id="node13" class="node">
<title>layer1_input</title>
<polygon fill="lightyellow" stroke="black" points="1453.47,-3301.28 698.38,-3301.28 504.13,-3165.28 1259.22,-3165.28 1453.47,-3301.28"/>
<text text-anchor="middle" x="978.8" y="-3252.08" font-family="Times,serif" font-size="14.00">Layer 1 Input</text>
<text text-anchor="middle" x="978.8" y="-3237.08" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="978.8" y="-3222.08" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="978.8" y="-3207.08" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer0_output&#45;&gt;layer1_input -->
<g id="edge14" class="edge">
<title>layer0_output&#45;&gt;layer1_input</title>
<path fill="none" stroke="black" d="M978.8,-3336.88C978.8,-3328.79 978.8,-3320.21 978.8,-3311.59"/>
<polygon fill="black" stroke="black" points="982.3,-3311.48 978.8,-3301.48 975.3,-3311.48 982.3,-3311.48"/>
</g>
<!-- layer1_qkv -->
<g id="node14" class="node">
<title>layer1_qkv</title>
<ellipse fill="lightcoral" stroke="black" cx="797.8" cy="-3081.2" rx="333.51" ry="48.17"/>
<text text-anchor="middle" x="797.8" y="-3100" font-family="Times,serif" font-size="14.00">QKV Linear (TP=4)</text>
<text text-anchor="middle" x="797.8" y="-3085" font-family="Times,serif" font-size="14.00">GPU: [0&#45;3]</text>
<text text-anchor="middle" x="797.8" y="-3070" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="797.8" y="-3055" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, heads=16, d_k=192]</text>
</g>
<!-- layer1_input&#45;&gt;layer1_qkv -->
<g id="edge15" class="edge">
<title>layer1_input&#45;&gt;layer1_qkv</title>
<path fill="none" stroke="black" d="M897.83,-3165.14C885.74,-3155.13 873.43,-3144.92 861.77,-3135.24"/>
<polygon fill="black" stroke="black" points="863.73,-3132.33 853.8,-3128.64 859.27,-3137.72 863.73,-3132.33"/>
</g>
<!-- layer1_attn_residual -->
<g id="node17" class="node">
<title>layer1_attn_residual</title>
<polygon fill="lightyellow" stroke="black" points="1851.4,-2732.79 469.65,-2732.79 114.2,-2596.79 1495.95,-2596.79 1851.4,-2732.79"/>
<text text-anchor="middle" x="982.8" y="-2683.59" font-family="Times,serif" font-size="14.00">Attention + Residual</text>
<text text-anchor="middle" x="982.8" y="-2668.59" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="982.8" y="-2653.59" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024], [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="982.8" y="-2638.59" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer1_input&#45;&gt;layer1_attn_residual -->
<g id="edge18" class="edge">
<title>layer1_input&#45;&gt;layer1_attn_residual</title>
<path fill="none" stroke="black" d="M1112.09,-3165.19C1123.46,-3154.66 1133.42,-3142.72 1140.8,-3129.28 1168.89,-3078.14 1215.52,-2908.38 1139.8,-2768.79 1134.15,-2758.38 1126.95,-2748.85 1118.74,-2740.16"/>
<polygon fill="black" stroke="black" points="1121.17,-2737.64 1111.62,-2733.05 1116.23,-2742.59 1121.17,-2737.64"/>
</g>
<!-- layer1_attn -->
<g id="node15" class="node">
<title>layer1_attn</title>
<ellipse fill="lightcoral" stroke="black" cx="801.8" cy="-2949.03" rx="327.28" ry="48.17"/>
<text text-anchor="middle" x="801.8" y="-2967.83" font-family="Times,serif" font-size="14.00">Attention Compute</text>
<text text-anchor="middle" x="801.8" y="-2952.83" font-family="Times,serif" font-size="14.00">GPU: [0&#45;3]</text>
<text text-anchor="middle" x="801.8" y="-2937.83" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, heads=16, d_k=192]</text>
<text text-anchor="middle" x="801.8" y="-2922.83" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, heads=16, d_k=64]</text>
</g>
<!-- layer1_qkv&#45;&gt;layer1_attn -->
<g id="edge16" class="edge">
<title>layer1_qkv&#45;&gt;layer1_attn</title>
<path fill="none" stroke="black" d="M799.25,-3032.84C799.51,-3024.57 799.78,-3015.89 800.04,-3007.39"/>
<polygon fill="black" stroke="black" points="803.54,-3007.25 800.35,-2997.14 796.55,-3007.03 803.54,-3007.25"/>
</g>
<!-- layer1_attn_allreduce -->
<g id="node16" class="node">
<title>layer1_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="806.8" cy="-2816.87" rx="323.71" ry="48.17"/>
<text text-anchor="middle" x="806.8" y="-2835.67" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="806.8" y="-2820.67" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="806.8" y="-2805.67" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, heads=16, d_k=64]</text>
<text text-anchor="middle" x="806.8" y="-2790.67" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer1_attn&#45;&gt;layer1_attn_allreduce -->
<g id="edge17" class="edge">
<title>layer1_attn&#45;&gt;layer1_attn_allreduce</title>
<path fill="none" stroke="black" d="M803.62,-2900.67C803.94,-2892.4 804.27,-2883.72 804.6,-2875.22"/>
<polygon fill="black" stroke="black" points="808.1,-2875.1 804.99,-2864.98 801.11,-2874.83 808.1,-2875.1"/>
</g>
<!-- layer1_attn_allreduce&#45;&gt;layer1_attn_residual -->
<g id="edge19" class="edge">
<title>layer1_attn_allreduce&#45;&gt;layer1_attn_residual</title>
<path fill="none" stroke="black" d="M861.52,-2769.2C872.61,-2759.75 884.53,-2749.58 896.41,-2739.45"/>
<polygon fill="black" stroke="black" points="898.87,-2741.96 904.21,-2732.81 894.33,-2736.63 898.87,-2741.96"/>
</g>
<!-- layer1_gate -->
<g id="node18" class="node">
<title>layer1_gate</title>
<ellipse fill="lightgreen" stroke="black" cx="809.8" cy="-2512.7" rx="318.4" ry="48.17"/>
<text text-anchor="middle" x="809.8" y="-2531.5" font-family="Times,serif" font-size="14.00">MoE Gate Network</text>
<text text-anchor="middle" x="809.8" y="-2516.5" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="809.8" y="-2501.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="809.8" y="-2486.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, num_experts=64]</text>
</g>
<!-- layer1_attn_residual&#45;&gt;layer1_gate -->
<g id="edge20" class="edge">
<title>layer1_attn_residual&#45;&gt;layer1_gate</title>
<path fill="none" stroke="black" d="M905.41,-2596.64C893.86,-2586.63 882.09,-2576.42 870.94,-2566.74"/>
<polygon fill="black" stroke="black" points="873.17,-2564.05 863.33,-2560.14 868.59,-2569.34 873.17,-2564.05"/>
</g>
<!-- layer1_moe_residual -->
<g id="node22" class="node">
<title>layer1_moe_residual</title>
<polygon fill="lightyellow" stroke="black" points="1792.4,-1992.29 410.65,-1992.29 55.2,-1856.29 1436.95,-1856.29 1792.4,-1992.29"/>
<text text-anchor="middle" x="923.8" y="-1943.09" font-family="Times,serif" font-size="14.00">MoE + Residual</text>
<text text-anchor="middle" x="923.8" y="-1928.09" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="923.8" y="-1913.09" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024], [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="923.8" y="-1898.09" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer1_attn_residual&#45;&gt;layer1_moe_residual -->
<g id="edge24" class="edge">
<title>layer1_attn_residual&#45;&gt;layer1_moe_residual</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1104.26,-2596.54C1116.59,-2585.87 1127.84,-2573.95 1136.8,-2560.79 1182.68,-2493.39 1175.8,-2463.07 1175.8,-2381.54 1175.8,-2381.54 1175.8,-2381.54 1175.8,-2247.37 1175.8,-2149.63 1213.63,-2107.8 1156.8,-2028.29 1149.01,-2017.39 1139.81,-2007.63 1129.63,-1998.89"/>
<polygon fill="black" stroke="black" points="1131.63,-1996 1121.66,-1992.41 1127.21,-2001.43 1131.63,-1996"/>
</g>
<!-- layer1_expert0 -->
<g id="node19" class="node">
<title>layer1_expert0</title>
<ellipse fill="lightsalmon" stroke="black" cx="789.8" cy="-2380.54" rx="311.25" ry="48.17"/>
<text text-anchor="middle" x="789.8" y="-2399.34" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="789.8" y="-2384.34" font-family="Times,serif" font-size="14.00">GPU: [0&#45;3]</text>
<text text-anchor="middle" x="789.8" y="-2369.34" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="789.8" y="-2354.34" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_expert0 -->
<g id="edge21" class="edge">
<title>layer1_gate&#45;&gt;layer1_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M802.52,-2464.34C801.24,-2455.98 799.89,-2447.2 798.57,-2438.61"/>
<polygon fill="black" stroke="black" points="802.02,-2438 797.04,-2428.64 795.1,-2439.06 802.02,-2438"/>
</g>
<!-- layer1_alltoall -->
<g id="node20" class="node">
<title>layer1_alltoall</title>
<ellipse fill="lightpink" stroke="black" cx="711.8" cy="-2248.37" rx="311.25" ry="48.17"/>
<text text-anchor="middle" x="711.8" y="-2267.17" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Expert Routing</text>
<text text-anchor="middle" x="711.8" y="-2252.17" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="711.8" y="-2237.17" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="711.8" y="-2222.17" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer1_expert0&#45;&gt;layer1_alltoall -->
<g id="edge22" class="edge">
<title>layer1_expert0&#45;&gt;layer1_alltoall</title>
<path fill="none" stroke="black" d="M761.64,-2332.54C756.28,-2323.6 750.63,-2314.17 745.13,-2304.99"/>
<polygon fill="black" stroke="black" points="748.06,-2303.07 739.92,-2296.29 742.06,-2306.67 748.06,-2303.07"/>
</g>
<!-- layer1_moe_aggregate -->
<g id="node21" class="node">
<title>layer1_moe_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="1147.47,-2164.29 392.38,-2164.29 198.13,-2028.29 953.22,-2028.29 1147.47,-2164.29"/>
<text text-anchor="middle" x="672.8" y="-2115.09" font-family="Times,serif" font-size="14.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="672.8" y="-2100.09" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="672.8" y="-2085.09" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="672.8" y="-2070.09" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer1_alltoall&#45;&gt;layer1_moe_aggregate -->
<g id="edge23" class="edge">
<title>layer1_alltoall&#45;&gt;layer1_moe_aggregate</title>
<path fill="none" stroke="black" d="M699.57,-2200.29C697.42,-2192.05 695.14,-2183.28 692.86,-2174.47"/>
<polygon fill="black" stroke="black" points="696.18,-2173.33 690.27,-2164.53 689.4,-2175.09 696.18,-2173.33"/>
</g>
<!-- layer1_moe_aggregate&#45;&gt;layer1_moe_residual -->
<g id="edge25" class="edge">
<title>layer1_moe_aggregate&#45;&gt;layer1_moe_residual</title>
<path fill="none" stroke="black" d="M772,-2028.1C786.43,-2018.32 801.35,-2008.22 815.95,-1998.33"/>
<polygon fill="black" stroke="black" points="818.18,-2001.05 824.5,-1992.54 814.25,-1995.25 818.18,-2001.05"/>
</g>
<!-- layer1_output -->
<g id="node23" class="node">
<title>layer1_output</title>
<ellipse fill="lightblue" stroke="black" cx="923.8" cy="-1772.2" rx="323.71" ry="48.17"/>
<text text-anchor="middle" x="923.8" y="-1791" font-family="Times,serif" font-size="14.00">Layer 1 Output</text>
<text text-anchor="middle" x="923.8" y="-1776" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="923.8" y="-1761" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="923.8" y="-1746" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer1_moe_residual&#45;&gt;layer1_output -->
<g id="edge26" class="edge">
<title>layer1_moe_residual&#45;&gt;layer1_output</title>
<path fill="none" stroke="black" d="M923.8,-1856.15C923.8,-1847.6 923.8,-1838.92 923.8,-1830.55"/>
<polygon fill="black" stroke="black" points="927.3,-1830.52 923.8,-1820.52 920.3,-1830.52 927.3,-1830.52"/>
</g>
<!-- layer2_input -->
<g id="node24" class="node">
<title>layer2_input</title>
<polygon fill="lightyellow" stroke="black" points="1398.47,-1688.12 643.38,-1688.12 449.13,-1552.12 1204.22,-1552.12 1398.47,-1688.12"/>
<text text-anchor="middle" x="923.8" y="-1638.92" font-family="Times,serif" font-size="14.00">Layer 2 Input</text>
<text text-anchor="middle" x="923.8" y="-1623.92" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="923.8" y="-1608.92" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="923.8" y="-1593.92" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer1_output&#45;&gt;layer2_input -->
<g id="edge27" class="edge">
<title>layer1_output&#45;&gt;layer2_input</title>
<path fill="none" stroke="black" d="M923.8,-1723.71C923.8,-1715.63 923.8,-1707.05 923.8,-1698.43"/>
<polygon fill="black" stroke="black" points="927.3,-1698.31 923.8,-1688.31 920.3,-1698.31 927.3,-1698.31"/>
</g>
<!-- layer2_qkv -->
<g id="node25" class="node">
<title>layer2_qkv</title>
<ellipse fill="lightcoral" stroke="black" cx="742.8" cy="-1468.04" rx="333.51" ry="48.17"/>
<text text-anchor="middle" x="742.8" y="-1486.84" font-family="Times,serif" font-size="14.00">QKV Linear (TP=4)</text>
<text text-anchor="middle" x="742.8" y="-1471.84" font-family="Times,serif" font-size="14.00">GPU: [0&#45;3]</text>
<text text-anchor="middle" x="742.8" y="-1456.84" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="742.8" y="-1441.84" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, heads=16, d_k=192]</text>
</g>
<!-- layer2_input&#45;&gt;layer2_qkv -->
<g id="edge28" class="edge">
<title>layer2_input&#45;&gt;layer2_qkv</title>
<path fill="none" stroke="black" d="M842.83,-1551.98C830.74,-1541.96 818.43,-1531.75 806.77,-1522.08"/>
<polygon fill="black" stroke="black" points="808.73,-1519.16 798.8,-1515.47 804.27,-1524.55 808.73,-1519.16"/>
</g>
<!-- layer2_attn_residual -->
<g id="node28" class="node">
<title>layer2_attn_residual</title>
<polygon fill="lightyellow" stroke="black" points="1796.4,-1119.62 414.65,-1119.62 59.2,-983.62 1440.95,-983.62 1796.4,-1119.62"/>
<text text-anchor="middle" x="927.8" y="-1070.42" font-family="Times,serif" font-size="14.00">Attention + Residual</text>
<text text-anchor="middle" x="927.8" y="-1055.42" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="927.8" y="-1040.42" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024], [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="927.8" y="-1025.42" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer2_input&#45;&gt;layer2_attn_residual -->
<g id="edge31" class="edge">
<title>layer2_input&#45;&gt;layer2_attn_residual</title>
<path fill="none" stroke="black" d="M1057.09,-1552.03C1068.46,-1541.49 1078.42,-1529.56 1085.8,-1516.12 1113.89,-1464.97 1160.52,-1295.22 1084.8,-1155.62 1079.15,-1145.21 1071.95,-1135.68 1063.74,-1126.99"/>
<polygon fill="black" stroke="black" points="1066.17,-1124.47 1056.62,-1119.89 1061.23,-1129.43 1066.17,-1124.47"/>
</g>
<!-- layer2_attn -->
<g id="node26" class="node">
<title>layer2_attn</title>
<ellipse fill="lightcoral" stroke="black" cx="746.8" cy="-1335.87" rx="327.28" ry="48.17"/>
<text text-anchor="middle" x="746.8" y="-1354.67" font-family="Times,serif" font-size="14.00">Attention Compute</text>
<text text-anchor="middle" x="746.8" y="-1339.67" font-family="Times,serif" font-size="14.00">GPU: [0&#45;3]</text>
<text text-anchor="middle" x="746.8" y="-1324.67" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, heads=16, d_k=192]</text>
<text text-anchor="middle" x="746.8" y="-1309.67" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, heads=16, d_k=64]</text>
</g>
<!-- layer2_qkv&#45;&gt;layer2_attn -->
<g id="edge29" class="edge">
<title>layer2_qkv&#45;&gt;layer2_attn</title>
<path fill="none" stroke="black" d="M744.25,-1419.67C744.51,-1411.41 744.78,-1402.72 745.04,-1394.22"/>
<polygon fill="black" stroke="black" points="748.54,-1394.08 745.35,-1383.98 741.55,-1393.87 748.54,-1394.08"/>
</g>
<!-- layer2_attn_allreduce -->
<g id="node27" class="node">
<title>layer2_attn_allreduce</title>
<ellipse fill="lightpink" stroke="black" cx="751.8" cy="-1203.7" rx="323.71" ry="48.17"/>
<text text-anchor="middle" x="751.8" y="-1222.5" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="751.8" y="-1207.5" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="751.8" y="-1192.5" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, heads=16, d_k=64]</text>
<text text-anchor="middle" x="751.8" y="-1177.5" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer2_attn&#45;&gt;layer2_attn_allreduce -->
<g id="edge30" class="edge">
<title>layer2_attn&#45;&gt;layer2_attn_allreduce</title>
<path fill="none" stroke="black" d="M748.62,-1287.51C748.94,-1279.24 749.27,-1270.56 749.6,-1262.05"/>
<polygon fill="black" stroke="black" points="753.1,-1261.94 749.99,-1251.81 746.11,-1261.67 753.1,-1261.94"/>
</g>
<!-- layer2_attn_allreduce&#45;&gt;layer2_attn_residual -->
<g id="edge32" class="edge">
<title>layer2_attn_allreduce&#45;&gt;layer2_attn_residual</title>
<path fill="none" stroke="black" d="M806.52,-1156.04C817.61,-1146.58 829.53,-1136.42 841.41,-1126.28"/>
<polygon fill="black" stroke="black" points="843.87,-1128.79 849.21,-1119.64 839.33,-1123.47 843.87,-1128.79"/>
</g>
<!-- layer2_gate -->
<g id="node29" class="node">
<title>layer2_gate</title>
<ellipse fill="lightgreen" stroke="black" cx="754.8" cy="-899.54" rx="318.4" ry="48.17"/>
<text text-anchor="middle" x="754.8" y="-918.34" font-family="Times,serif" font-size="14.00">MoE Gate Network</text>
<text text-anchor="middle" x="754.8" y="-903.34" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="754.8" y="-888.34" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="754.8" y="-873.34" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, num_experts=64]</text>
</g>
<!-- layer2_attn_residual&#45;&gt;layer2_gate -->
<g id="edge33" class="edge">
<title>layer2_attn_residual&#45;&gt;layer2_gate</title>
<path fill="none" stroke="black" d="M850.41,-983.48C838.86,-973.46 827.09,-963.25 815.94,-953.58"/>
<polygon fill="black" stroke="black" points="818.17,-950.88 808.33,-946.97 813.59,-956.17 818.17,-950.88"/>
</g>
<!-- layer2_moe_residual -->
<g id="node33" class="node">
<title>layer2_moe_residual</title>
<polygon fill="lightyellow" stroke="black" points="1737.4,-379.12 355.65,-379.12 0.2,-243.12 1381.95,-243.12 1737.4,-379.12"/>
<text text-anchor="middle" x="868.8" y="-329.92" font-family="Times,serif" font-size="14.00">MoE + Residual</text>
<text text-anchor="middle" x="868.8" y="-314.92" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="868.8" y="-299.92" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024], [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="868.8" y="-284.92" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer2_attn_residual&#45;&gt;layer2_moe_residual -->
<g id="edge37" class="edge">
<title>layer2_attn_residual&#45;&gt;layer2_moe_residual</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1049.26,-983.37C1061.59,-972.7 1072.84,-960.78 1081.8,-947.62 1127.68,-880.23 1120.8,-849.9 1120.8,-768.37 1120.8,-768.37 1120.8,-768.37 1120.8,-634.2 1120.8,-536.47 1158.63,-494.63 1101.8,-415.12 1094.01,-404.22 1084.81,-394.46 1074.63,-385.73"/>
<polygon fill="black" stroke="black" points="1076.63,-382.84 1066.66,-379.24 1072.21,-388.27 1076.63,-382.84"/>
</g>
<!-- layer2_expert0 -->
<g id="node30" class="node">
<title>layer2_expert0</title>
<ellipse fill="lightsalmon" stroke="black" cx="734.8" cy="-767.37" rx="311.25" ry="48.17"/>
<text text-anchor="middle" x="734.8" y="-786.17" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="734.8" y="-771.17" font-family="Times,serif" font-size="14.00">GPU: [0&#45;3]</text>
<text text-anchor="middle" x="734.8" y="-756.17" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="734.8" y="-741.17" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_expert0 -->
<g id="edge34" class="edge">
<title>layer2_gate&#45;&gt;layer2_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M747.52,-851.17C746.24,-842.82 744.89,-834.03 743.57,-825.44"/>
<polygon fill="black" stroke="black" points="747.02,-824.83 742.04,-815.48 740.1,-825.89 747.02,-824.83"/>
</g>
<!-- layer2_alltoall -->
<g id="node31" class="node">
<title>layer2_alltoall</title>
<ellipse fill="lightpink" stroke="black" cx="656.8" cy="-635.2" rx="311.25" ry="48.17"/>
<text text-anchor="middle" x="656.8" y="-654" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Expert Routing</text>
<text text-anchor="middle" x="656.8" y="-639" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="656.8" y="-624" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="656.8" y="-609" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer2_expert0&#45;&gt;layer2_alltoall -->
<g id="edge35" class="edge">
<title>layer2_expert0&#45;&gt;layer2_alltoall</title>
<path fill="none" stroke="black" d="M706.64,-719.38C701.28,-710.44 695.63,-701 690.13,-691.82"/>
<polygon fill="black" stroke="black" points="693.06,-689.91 684.92,-683.13 687.06,-693.5 693.06,-689.91"/>
</g>
<!-- layer2_moe_aggregate -->
<g id="node32" class="node">
<title>layer2_moe_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="1092.47,-551.12 337.38,-551.12 143.13,-415.12 898.22,-415.12 1092.47,-551.12"/>
<text text-anchor="middle" x="617.8" y="-501.92" font-family="Times,serif" font-size="14.00">MoE Output Aggregation</text>
<text text-anchor="middle" x="617.8" y="-486.92" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="617.8" y="-471.92" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="617.8" y="-456.92" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer2_alltoall&#45;&gt;layer2_moe_aggregate -->
<g id="edge36" class="edge">
<title>layer2_alltoall&#45;&gt;layer2_moe_aggregate</title>
<path fill="none" stroke="black" d="M644.57,-587.13C642.42,-578.88 640.14,-570.11 637.86,-561.3"/>
<polygon fill="black" stroke="black" points="641.18,-560.16 635.27,-551.37 634.4,-561.92 641.18,-560.16"/>
</g>
<!-- layer2_moe_aggregate&#45;&gt;layer2_moe_residual -->
<g id="edge38" class="edge">
<title>layer2_moe_aggregate&#45;&gt;layer2_moe_residual</title>
<path fill="none" stroke="black" d="M717,-414.93C731.43,-405.16 746.35,-395.05 760.95,-385.17"/>
<polygon fill="black" stroke="black" points="763.18,-387.88 769.5,-379.38 759.25,-382.09 763.18,-387.88"/>
</g>
<!-- layer2_output -->
<g id="node34" class="node">
<title>layer2_output</title>
<ellipse fill="lightblue" stroke="black" cx="868.8" cy="-159.04" rx="323.71" ry="48.17"/>
<text text-anchor="middle" x="868.8" y="-177.84" font-family="Times,serif" font-size="14.00">Layer 2 Output</text>
<text text-anchor="middle" x="868.8" y="-162.84" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="868.8" y="-147.84" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="868.8" y="-132.84" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer2_moe_residual&#45;&gt;layer2_output -->
<g id="edge39" class="edge">
<title>layer2_moe_residual&#45;&gt;layer2_output</title>
<path fill="none" stroke="black" d="M868.8,-242.98C868.8,-234.43 868.8,-225.75 868.8,-217.38"/>
<polygon fill="black" stroke="black" points="872.3,-217.35 868.8,-207.35 865.3,-217.35 872.3,-217.35"/>
</g>
<!-- final_output -->
<g id="node35" class="node">
<title>final_output</title>
<ellipse fill="lightgreen" stroke="black" cx="868.8" cy="-37.48" rx="323.71" ry="37.45"/>
<text text-anchor="middle" x="868.8" y="-48.78" font-family="Times,serif" font-size="14.00">Final Output</text>
<text text-anchor="middle" x="868.8" y="-33.78" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="868.8" y="-18.78" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=10240, hidden_dim=1024]</text>
</g>
<!-- layer2_output&#45;&gt;final_output -->
<g id="edge40" class="edge">
<title>layer2_output&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M868.8,-110.78C868.8,-102.34 868.8,-93.54 868.8,-85.11"/>
<polygon fill="black" stroke="black" points="872.3,-85.06 868.8,-75.06 865.3,-85.06 872.3,-85.06"/>
</g>
</g>
</svg>
