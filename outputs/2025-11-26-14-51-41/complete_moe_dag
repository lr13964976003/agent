// Large-Scale Cross-Node Expert Parallelism DAG
digraph {
	fontname=Arial rankdir=TB size="30,40"
	input [label="INPUT\nGPU: N/A\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightcyan shape=ellipse style=filled]
	ln1 [label="LayerNorm\nGPU: All\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightblue style=filled]
	q_proj [label="Q Projection\nGPU: 0-7\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]" fillcolor=lightblue style=filled]
	k_proj [label="K Projection\nGPU: 0-7\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]" fillcolor=lightblue style=filled]
	v_proj [label="V Projection\nGPU: 0-7\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]" fillcolor=lightblue style=filled]
	comm_q [label="All-Gather Q\nGPU: 0-7\nInput: [batch_size=4, seq_len=2048, num_heads=16, head_dim=128]\nOutput: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]" fillcolor=lightyellow shape=ellipse style=filled]
	comm_k [label="All-Gather K\nGPU: 0-7\nInput: [batch_size=4, seq_len=2048, num_heads=16, head_dim=128]\nOutput: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]" fillcolor=lightyellow shape=ellipse style=filled]
	comm_v [label="All-Gather V\nGPU: 0-7\nInput: [batch_size=4, seq_len=2048, num_heads=16, head_dim=128]\nOutput: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]" fillcolor=lightyellow shape=ellipse style=filled]
	attn_score [label="Attention Score\nGPU: 0-7\nInput: [batch_size=4, seq_len=2048, seq_len=2048, num_heads=128]\nOutput: [batch_size=4, seq_len=2048, seq_len=2048, num_heads=128]" fillcolor=lightblue style=filled]
	attn_softmax [label="Softmax\nGPU: 0-7\nInput: [batch_size=4, seq_len=2048, seq_len=2048, num_heads=128]\nOutput: [batch_size=4, seq_len=2048, seq_len=2048, num_heads=128]" fillcolor=lightblue style=filled]
	attn_weight [label="Weighted Values\nGPU: 0-7\nInput: [batch_size=4, seq_len=2048, seq_len=2048, num_heads=128]\nOutput: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]" fillcolor=lightblue style=filled]
	o_proj [label="O Projection\nGPU: 0-7\nInput: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightblue style=filled]
	res1 [label="Residual Add 1\nGPU: All\nInput1: [batch_size=4, seq_len=2048, token_dim=7168]\nInput2: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightblue style=filled]
	gate [label="Gate Network\nGPU: Routing Node\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, top_k=2]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_0 [label="Token Split\nGPU: 0_0\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_1 [label="Token Split\nGPU: 0_1\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_2 [label="Token Split\nGPU: 0_2\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_3 [label="Token Split\nGPU: 0_3\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_4 [label="Token Split\nGPU: 1_0\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_5 [label="Token Split\nGPU: 1_1\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_6 [label="Token Split\nGPU: 1_2\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_7 [label="Token Split\nGPU: 1_3\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_8 [label="Token Split\nGPU: 2_0\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_9 [label="Token Split\nGPU: 2_1\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_10 [label="Token Split\nGPU: 2_2\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_11 [label="Token Split\nGPU: 2_3\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_12 [label="Token Split\nGPU: 3_0\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_13 [label="Token Split\nGPU: 3_1\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_14 [label="Token Split\nGPU: 3_2\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	split_15 [label="Token Split\nGPU: 3_3\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	expert_gate_0 [label="Expert 0 Gate\nGPU: 0_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_0 [label="Expert 0 Up\nGPU: 0_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_0 [label="Expert 0 Activation\nGPU: 0_0\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_0 [label="Expert 0 Down\nGPU: 0_0\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_0 [label="Expert 0 Gate Mul\nGPU: 0_0\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_1 [label="Expert 1 Gate\nGPU: 0_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_1 [label="Expert 1 Up\nGPU: 0_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_1 [label="Expert 1 Activation\nGPU: 0_1\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_1 [label="Expert 1 Down\nGPU: 0_1\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_1 [label="Expert 1 Gate Mul\nGPU: 0_1\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_2 [label="Expert 2 Gate\nGPU: 0_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_2 [label="Expert 2 Up\nGPU: 0_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_2 [label="Expert 2 Activation\nGPU: 0_2\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_2 [label="Expert 2 Down\nGPU: 0_2\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_2 [label="Expert 2 Gate Mul\nGPU: 0_2\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_3 [label="Expert 3 Gate\nGPU: 0_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_3 [label="Expert 3 Up\nGPU: 0_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_3 [label="Expert 3 Activation\nGPU: 0_3\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_3 [label="Expert 3 Down\nGPU: 0_3\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_3 [label="Expert 3 Gate Mul\nGPU: 0_3\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_4 [label="Expert 4 Gate\nGPU: 1_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_4 [label="Expert 4 Up\nGPU: 1_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_4 [label="Expert 4 Activation\nGPU: 1_0\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_4 [label="Expert 4 Down\nGPU: 1_0\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_4 [label="Expert 4 Gate Mul\nGPU: 1_0\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_5 [label="Expert 5 Gate\nGPU: 1_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_5 [label="Expert 5 Up\nGPU: 1_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_5 [label="Expert 5 Activation\nGPU: 1_1\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_5 [label="Expert 5 Down\nGPU: 1_1\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_5 [label="Expert 5 Gate Mul\nGPU: 1_1\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_6 [label="Expert 6 Gate\nGPU: 1_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_6 [label="Expert 6 Up\nGPU: 1_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_6 [label="Expert 6 Activation\nGPU: 1_2\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_6 [label="Expert 6 Down\nGPU: 1_2\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_6 [label="Expert 6 Gate Mul\nGPU: 1_2\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_7 [label="Expert 7 Gate\nGPU: 1_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_7 [label="Expert 7 Up\nGPU: 1_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_7 [label="Expert 7 Activation\nGPU: 1_3\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_7 [label="Expert 7 Down\nGPU: 1_3\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_7 [label="Expert 7 Gate Mul\nGPU: 1_3\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_8 [label="Expert 8 Gate\nGPU: 2_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_8 [label="Expert 8 Up\nGPU: 2_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_8 [label="Expert 8 Activation\nGPU: 2_0\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_8 [label="Expert 8 Down\nGPU: 2_0\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_8 [label="Expert 8 Gate Mul\nGPU: 2_0\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_9 [label="Expert 9 Gate\nGPU: 2_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_9 [label="Expert 9 Up\nGPU: 2_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_9 [label="Expert 9 Activation\nGPU: 2_1\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_9 [label="Expert 9 Down\nGPU: 2_1\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_9 [label="Expert 9 Gate Mul\nGPU: 2_1\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_10 [label="Expert 10 Gate\nGPU: 2_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_10 [label="Expert 10 Up\nGPU: 2_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_10 [label="Expert 10 Activation\nGPU: 2_2\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_10 [label="Expert 10 Down\nGPU: 2_2\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_10 [label="Expert 10 Gate Mul\nGPU: 2_2\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_11 [label="Expert 11 Gate\nGPU: 2_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_11 [label="Expert 11 Up\nGPU: 2_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_11 [label="Expert 11 Activation\nGPU: 2_3\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_11 [label="Expert 11 Down\nGPU: 2_3\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_11 [label="Expert 11 Gate Mul\nGPU: 2_3\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_12 [label="Expert 12 Gate\nGPU: 3_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_12 [label="Expert 12 Up\nGPU: 3_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_12 [label="Expert 12 Activation\nGPU: 3_0\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_12 [label="Expert 12 Down\nGPU: 3_0\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_12 [label="Expert 12 Gate Mul\nGPU: 3_0\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_13 [label="Expert 13 Gate\nGPU: 3_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_13 [label="Expert 13 Up\nGPU: 3_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_13 [label="Expert 13 Activation\nGPU: 3_1\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_13 [label="Expert 13 Down\nGPU: 3_1\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_13 [label="Expert 13 Gate Mul\nGPU: 3_1\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_14 [label="Expert 14 Gate\nGPU: 3_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_14 [label="Expert 14 Up\nGPU: 3_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_14 [label="Expert 14 Activation\nGPU: 3_2\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_14 [label="Expert 14 Down\nGPU: 3_2\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_14 [label="Expert 14 Gate Mul\nGPU: 3_2\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_gate_15 [label="Expert 15 Gate\nGPU: 3_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_up_15 [label="Expert 15 Up\nGPU: 3_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_act_15 [label="Expert 15 Activation\nGPU: 3_3\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	expert_down_15 [label="Expert 15 Down\nGPU: 3_3\nInput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, token_dim=7168]" fillcolor=lightblue style=filled]
	expert_mul_15 [label="Expert 15 Gate Mul\nGPU: 3_3\nInput1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nInput2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]\nOutput: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]" fillcolor=lightblue style=filled]
	agg_0 [label="Token Aggregate\nGPU: 0_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_1 [label="Token Aggregate\nGPU: 0_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_2 [label="Token Aggregate\nGPU: 0_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_3 [label="Token Aggregate\nGPU: 0_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_4 [label="Token Aggregate\nGPU: 1_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_5 [label="Token Aggregate\nGPU: 1_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_6 [label="Token Aggregate\nGPU: 1_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_7 [label="Token Aggregate\nGPU: 1_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_8 [label="Token Aggregate\nGPU: 2_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_9 [label="Token Aggregate\nGPU: 2_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_10 [label="Token Aggregate\nGPU: 2_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_11 [label="Token Aggregate\nGPU: 2_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_12 [label="Token Aggregate\nGPU: 3_0\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_13 [label="Token Aggregate\nGPU: 3_1\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_14 [label="Token Aggregate\nGPU: 3_2\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	agg_15 [label="Token Aggregate\nGPU: 3_3\nInput: [batch_size=4, dynamic_seq_len, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	final_agg [label="Final Aggregation\nGPU: All\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightgreen shape=parallelogram style=filled]
	res2 [label="Residual Add 2\nGPU: All\nInput1: [batch_size=4, seq_len=2048, token_dim=7168]\nInput2: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightblue style=filled]
	output [label="OUTPUT\nGPU: N/A\nInput: [batch_size=4, seq_len=2048, token_dim=7168]\nOutput: [batch_size=4, seq_len=2048, token_dim=7168]" fillcolor=lightcyan shape=ellipse style=filled]
	input -> ln1
	ln1 -> q_proj
	ln1 -> k_proj
	ln1 -> v_proj
	q_proj -> comm_q
	k_proj -> comm_k
	v_proj -> comm_v
	comm_q -> attn_score
	comm_k -> attn_score
	attn_score -> attn_softmax
	attn_softmax -> attn_weight
	comm_v -> attn_weight
	attn_weight -> o_proj
	o_proj -> res1
	input -> res1
	res1 -> gate
	gate -> split_0 [style=dashed]
	split_0 -> expert_gate_0
	split_0 -> expert_up_0
	expert_gate_0 -> expert_act_0
	expert_up_0 -> expert_mul_0
	expert_act_0 -> expert_mul_0
	expert_mul_0 -> expert_down_0
	expert_down_0 -> agg_0
	agg_0 -> final_agg
	gate -> split_1 [style=dashed]
	split_1 -> expert_gate_1
	split_1 -> expert_up_1
	expert_gate_1 -> expert_act_1
	expert_up_1 -> expert_mul_1
	expert_act_1 -> expert_mul_1
	expert_mul_1 -> expert_down_1
	expert_down_1 -> agg_1
	agg_1 -> final_agg
	gate -> split_2 [style=dashed]
	split_2 -> expert_gate_2
	split_2 -> expert_up_2
	expert_gate_2 -> expert_act_2
	expert_up_2 -> expert_mul_2
	expert_act_2 -> expert_mul_2
	expert_mul_2 -> expert_down_2
	expert_down_2 -> agg_2
	agg_2 -> final_agg
	gate -> split_3 [style=dashed]
	split_3 -> expert_gate_3
	split_3 -> expert_up_3
	expert_gate_3 -> expert_act_3
	expert_up_3 -> expert_mul_3
	expert_act_3 -> expert_mul_3
	expert_mul_3 -> expert_down_3
	expert_down_3 -> agg_3
	agg_3 -> final_agg
	gate -> split_4 [style=dashed]
	split_4 -> expert_gate_4
	split_4 -> expert_up_4
	expert_gate_4 -> expert_act_4
	expert_up_4 -> expert_mul_4
	expert_act_4 -> expert_mul_4
	expert_mul_4 -> expert_down_4
	expert_down_4 -> agg_4
	agg_4 -> final_agg
	gate -> split_5 [style=dashed]
	split_5 -> expert_gate_5
	split_5 -> expert_up_5
	expert_gate_5 -> expert_act_5
	expert_up_5 -> expert_mul_5
	expert_act_5 -> expert_mul_5
	expert_mul_5 -> expert_down_5
	expert_down_5 -> agg_5
	agg_5 -> final_agg
	gate -> split_6 [style=dashed]
	split_6 -> expert_gate_6
	split_6 -> expert_up_6
	expert_gate_6 -> expert_act_6
	expert_up_6 -> expert_mul_6
	expert_act_6 -> expert_mul_6
	expert_mul_6 -> expert_down_6
	expert_down_6 -> agg_6
	agg_6 -> final_agg
	gate -> split_7 [style=dashed]
	split_7 -> expert_gate_7
	split_7 -> expert_up_7
	expert_gate_7 -> expert_act_7
	expert_up_7 -> expert_mul_7
	expert_act_7 -> expert_mul_7
	expert_mul_7 -> expert_down_7
	expert_down_7 -> agg_7
	agg_7 -> final_agg
	gate -> split_8 [style=dashed]
	split_8 -> expert_gate_8
	split_8 -> expert_up_8
	expert_gate_8 -> expert_act_8
	expert_up_8 -> expert_mul_8
	expert_act_8 -> expert_mul_8
	expert_mul_8 -> expert_down_8
	expert_down_8 -> agg_8
	agg_8 -> final_agg
	gate -> split_9 [style=dashed]
	split_9 -> expert_gate_9
	split_9 -> expert_up_9
	expert_gate_9 -> expert_act_9
	expert_up_9 -> expert_mul_9
	expert_act_9 -> expert_mul_9
	expert_mul_9 -> expert_down_9
	expert_down_9 -> agg_9
	agg_9 -> final_agg
	gate -> split_10 [style=dashed]
	split_10 -> expert_gate_10
	split_10 -> expert_up_10
	expert_gate_10 -> expert_act_10
	expert_up_10 -> expert_mul_10
	expert_act_10 -> expert_mul_10
	expert_mul_10 -> expert_down_10
	expert_down_10 -> agg_10
	agg_10 -> final_agg
	gate -> split_11 [style=dashed]
	split_11 -> expert_gate_11
	split_11 -> expert_up_11
	expert_gate_11 -> expert_act_11
	expert_up_11 -> expert_mul_11
	expert_act_11 -> expert_mul_11
	expert_mul_11 -> expert_down_11
	expert_down_11 -> agg_11
	agg_11 -> final_agg
	gate -> split_12 [style=dashed]
	split_12 -> expert_gate_12
	split_12 -> expert_up_12
	expert_gate_12 -> expert_act_12
	expert_up_12 -> expert_mul_12
	expert_act_12 -> expert_mul_12
	expert_mul_12 -> expert_down_12
	expert_down_12 -> agg_12
	agg_12 -> final_agg
	gate -> split_13 [style=dashed]
	split_13 -> expert_gate_13
	split_13 -> expert_up_13
	expert_gate_13 -> expert_act_13
	expert_up_13 -> expert_mul_13
	expert_act_13 -> expert_mul_13
	expert_mul_13 -> expert_down_13
	expert_down_13 -> agg_13
	agg_13 -> final_agg
	gate -> split_14 [style=dashed]
	split_14 -> expert_gate_14
	split_14 -> expert_up_14
	expert_gate_14 -> expert_act_14
	expert_up_14 -> expert_mul_14
	expert_act_14 -> expert_mul_14
	expert_mul_14 -> expert_down_14
	expert_down_14 -> agg_14
	agg_14 -> final_agg
	gate -> split_15 [style=dashed]
	split_15 -> expert_gate_15
	split_15 -> expert_up_15
	expert_gate_15 -> expert_act_15
	expert_up_15 -> expert_mul_15
	expert_act_15 -> expert_mul_15
	expert_mul_15 -> expert_down_15
	expert_down_15 -> agg_15
	agg_15 -> final_agg
	final_agg -> res2
	res1 -> res2
	res2 -> output
}
