<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="2160pt" height="2415pt"
 viewBox="0.00 0.00 2160.00 2414.99" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.89 0.89) rotate(0) translate(4 2702.14)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2702.14 2416.41,-2702.14 2416.41,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightcyan" stroke="black" cx="1733.01" cy="-2650.05" rx="298.3" ry="48.17"/>
<text text-anchor="middle" x="1733.01" y="-2668.85" font-family="Times,serif" font-size="14.00">INPUT</text>
<text text-anchor="middle" x="1733.01" y="-2653.85" font-family="Times,serif" font-size="14.00">GPU: N/A</text>
<text text-anchor="middle" x="1733.01" y="-2638.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="1733.01" y="-2623.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, token_dim=7168]</text>
</g>
<!-- ln1 -->
<g id="node3" class="node">
<title>ln1</title>
<ellipse fill="lightblue" stroke="black" cx="1533.01" cy="-2517.89" rx="298.3" ry="48.17"/>
<text text-anchor="middle" x="1533.01" y="-2536.69" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1533.01" y="-2521.69" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="1533.01" y="-2506.69" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="1533.01" y="-2491.69" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, token_dim=7168]</text>
</g>
<!-- input&#45;&gt;ln1 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;ln1</title>
<path fill="none" stroke="black" d="M1662.5,-2603.16C1646.22,-2592.57 1628.79,-2581.22 1612.17,-2570.41"/>
<polygon fill="black" stroke="black" points="1613.85,-2567.33 1603.56,-2564.8 1610.03,-2573.19 1613.85,-2567.33"/>
</g>
<!-- res1 -->
<g id="node14" class="node">
<title>res1</title>
<ellipse fill="lightblue" stroke="black" cx="2114.01" cy="-1582.12" rx="298.3" ry="58.88"/>
<text text-anchor="middle" x="2114.01" y="-1608.42" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="2114.01" y="-1593.42" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="2114.01" y="-1578.42" font-family="Times,serif" font-size="14.00">Input1: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="2114.01" y="-1563.42" font-family="Times,serif" font-size="14.00">Input2: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="2114.01" y="-1548.42" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, token_dim=7168]</text>
</g>
<!-- input&#45;&gt;res1 -->
<g id="edge15" class="edge">
<title>input&#45;&gt;res1</title>
<path fill="none" stroke="black" d="M2002.39,-2629.19C2155.93,-2601.48 2318.01,-2536.71 2318.01,-2386.72 2318.01,-2386.72 2318.01,-2386.72 2318.01,-1856.06 2318.01,-1775.74 2341.05,-1742.62 2295.01,-1676.81 2285.18,-1662.75 2272.58,-1650.65 2258.61,-1640.28"/>
<polygon fill="black" stroke="black" points="2260.42,-1637.28 2250.24,-1634.38 2256.39,-1643 2260.42,-1637.28"/>
</g>
<!-- output -->
<g id="node2" class="node">
<title>output</title>
<ellipse fill="lightcyan" stroke="black" cx="2114.01" cy="-48.08" rx="298.3" ry="48.17"/>
<text text-anchor="middle" x="2114.01" y="-66.88" font-family="Times,serif" font-size="14.00">OUTPUT</text>
<text text-anchor="middle" x="2114.01" y="-51.88" font-family="Times,serif" font-size="14.00">GPU: N/A</text>
<text text-anchor="middle" x="2114.01" y="-36.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="2114.01" y="-21.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, token_dim=7168]</text>
</g>
<!-- q_proj -->
<g id="node4" class="node">
<title>q_proj</title>
<ellipse fill="lightblue" stroke="black" cx="385.01" cy="-2385.72" rx="372.79" ry="48.17"/>
<text text-anchor="middle" x="385.01" y="-2404.52" font-family="Times,serif" font-size="14.00">Q Projection (Column Parallel)</text>
<text text-anchor="middle" x="385.01" y="-2389.52" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="385.01" y="-2374.52" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="385.01" y="-2359.52" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, num_heads=16, head_dim=128]</text>
</g>
<!-- ln1&#45;&gt;q_proj -->
<g id="edge2" class="edge">
<title>ln1&#45;&gt;q_proj</title>
<path fill="none" stroke="black" d="M1286.04,-2490.9C1136.38,-2474.93 941.64,-2453.77 769.01,-2433.8 733.64,-2429.71 696.45,-2425.3 659.71,-2420.87"/>
<polygon fill="black" stroke="black" points="659.71,-2417.34 649.36,-2419.62 658.87,-2424.29 659.71,-2417.34"/>
</g>
<!-- k_proj -->
<g id="node5" class="node">
<title>k_proj</title>
<ellipse fill="lightblue" stroke="black" cx="1151.01" cy="-2385.72" rx="372.79" ry="48.17"/>
<text text-anchor="middle" x="1151.01" y="-2404.52" font-family="Times,serif" font-size="14.00">K Projection (Column Parallel)</text>
<text text-anchor="middle" x="1151.01" y="-2389.52" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1151.01" y="-2374.52" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="1151.01" y="-2359.52" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, num_heads=16, head_dim=128]</text>
</g>
<!-- ln1&#45;&gt;k_proj -->
<g id="edge3" class="edge">
<title>ln1&#45;&gt;k_proj</title>
<path fill="none" stroke="black" d="M1407.66,-2474.18C1370.06,-2461.36 1328.6,-2447.24 1290.17,-2434.14"/>
<polygon fill="black" stroke="black" points="1291.06,-2430.75 1280.46,-2430.83 1288.8,-2437.37 1291.06,-2430.75"/>
</g>
<!-- v_proj -->
<g id="node6" class="node">
<title>v_proj</title>
<ellipse fill="lightblue" stroke="black" cx="1914.01" cy="-2385.72" rx="372.79" ry="48.17"/>
<text text-anchor="middle" x="1914.01" y="-2404.52" font-family="Times,serif" font-size="14.00">V Projection (Column Parallel)</text>
<text text-anchor="middle" x="1914.01" y="-2389.52" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1914.01" y="-2374.52" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="1914.01" y="-2359.52" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, num_heads=16, head_dim=128]</text>
</g>
<!-- ln1&#45;&gt;v_proj -->
<g id="edge4" class="edge">
<title>ln1&#45;&gt;v_proj</title>
<path fill="none" stroke="black" d="M1658.03,-2474.18C1695.53,-2461.36 1736.88,-2447.24 1775.22,-2434.14"/>
<polygon fill="black" stroke="black" points="1776.56,-2437.38 1784.89,-2430.83 1774.3,-2430.75 1776.56,-2437.38"/>
</g>
<!-- comm_q -->
<g id="node7" class="node">
<title>comm_q</title>
<ellipse fill="lightyellow" stroke="black" cx="379.01" cy="-2253.55" rx="379.02" ry="48.17"/>
<text text-anchor="middle" x="379.01" y="-2272.35" font-family="Times,serif" font-size="14.00">All&#45;Gather Q</text>
<text text-anchor="middle" x="379.01" y="-2257.35" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="379.01" y="-2242.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, num_heads=16, head_dim=128]</text>
<text text-anchor="middle" x="379.01" y="-2227.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]</text>
</g>
<!-- q_proj&#45;&gt;comm_q -->
<g id="edge5" class="edge">
<title>q_proj&#45;&gt;comm_q</title>
<path fill="none" stroke="black" d="M382.83,-2337.36C382.44,-2329.09 382.04,-2320.41 381.65,-2311.91"/>
<polygon fill="black" stroke="black" points="385.14,-2311.49 381.18,-2301.66 378.14,-2311.81 385.14,-2311.49"/>
</g>
<!-- comm_k -->
<g id="node8" class="node">
<title>comm_k</title>
<ellipse fill="lightyellow" stroke="black" cx="1155.01" cy="-2253.55" rx="379.02" ry="48.17"/>
<text text-anchor="middle" x="1155.01" y="-2272.35" font-family="Times,serif" font-size="14.00">All&#45;Gather K</text>
<text text-anchor="middle" x="1155.01" y="-2257.35" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1155.01" y="-2242.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, num_heads=16, head_dim=128]</text>
<text text-anchor="middle" x="1155.01" y="-2227.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]</text>
</g>
<!-- k_proj&#45;&gt;comm_k -->
<g id="edge6" class="edge">
<title>k_proj&#45;&gt;comm_k</title>
<path fill="none" stroke="black" d="M1152.46,-2337.36C1152.72,-2329.09 1152.99,-2320.41 1153.25,-2311.91"/>
<polygon fill="black" stroke="black" points="1156.75,-2311.77 1153.56,-2301.66 1149.76,-2311.55 1156.75,-2311.77"/>
</g>
<!-- comm_v -->
<g id="node9" class="node">
<title>comm_v</title>
<ellipse fill="lightyellow" stroke="black" cx="1911.01" cy="-2121.39" rx="379.02" ry="48.17"/>
<text text-anchor="middle" x="1911.01" y="-2140.19" font-family="Times,serif" font-size="14.00">All&#45;Gather V</text>
<text text-anchor="middle" x="1911.01" y="-2125.19" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1911.01" y="-2110.19" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, num_heads=16, head_dim=128]</text>
<text text-anchor="middle" x="1911.01" y="-2095.19" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]</text>
</g>
<!-- v_proj&#45;&gt;comm_v -->
<g id="edge7" class="edge">
<title>v_proj&#45;&gt;comm_v</title>
<path fill="none" stroke="black" d="M1913.47,-2337.52C1912.96,-2293.27 1912.21,-2227.02 1911.67,-2179.74"/>
<polygon fill="black" stroke="black" points="1915.16,-2179.61 1911.55,-2169.65 1908.16,-2179.69 1915.16,-2179.61"/>
</g>
<!-- attn_score -->
<g id="node10" class="node">
<title>attn_score</title>
<ellipse fill="lightblue" stroke="black" cx="1139.01" cy="-2121.39" rx="374.53" ry="48.17"/>
<text text-anchor="middle" x="1139.01" y="-2140.19" font-family="Times,serif" font-size="14.00">Attention Score</text>
<text text-anchor="middle" x="1139.01" y="-2125.19" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1139.01" y="-2110.19" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, seq_len=2048, num_heads=128]</text>
<text text-anchor="middle" x="1139.01" y="-2095.19" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, seq_len=2048, num_heads=128]</text>
</g>
<!-- comm_q&#45;&gt;attn_score -->
<g id="edge8" class="edge">
<title>comm_q&#45;&gt;attn_score</title>
<path fill="none" stroke="black" d="M600.88,-2214.56C697.35,-2198.03 810.37,-2178.67 907.86,-2161.98"/>
<polygon fill="black" stroke="black" points="908.59,-2165.4 917.85,-2160.27 907.41,-2158.5 908.59,-2165.4"/>
</g>
<!-- comm_k&#45;&gt;attn_score -->
<g id="edge9" class="edge">
<title>comm_k&#45;&gt;attn_score</title>
<path fill="none" stroke="black" d="M1149.19,-2205.19C1148.16,-2196.83 1147.08,-2188.05 1146.02,-2179.46"/>
<polygon fill="black" stroke="black" points="1149.49,-2178.99 1144.8,-2169.5 1142.55,-2179.85 1149.49,-2178.99"/>
</g>
<!-- attn_weight -->
<g id="node12" class="node">
<title>attn_weight</title>
<ellipse fill="lightblue" stroke="black" cx="1911.01" cy="-1857.06" rx="379.02" ry="48.17"/>
<text text-anchor="middle" x="1911.01" y="-1875.86" font-family="Times,serif" font-size="14.00">Weighted Values</text>
<text text-anchor="middle" x="1911.01" y="-1860.86" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1911.01" y="-1845.86" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, seq_len=2048, num_heads=128]</text>
<text text-anchor="middle" x="1911.01" y="-1830.86" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]</text>
</g>
<!-- comm_v&#45;&gt;attn_weight -->
<g id="edge12" class="edge">
<title>comm_v&#45;&gt;attn_weight</title>
<path fill="none" stroke="black" d="M1911.01,-2073.19C1911.01,-2028.93 1911.01,-1962.68 1911.01,-1915.41"/>
<polygon fill="black" stroke="black" points="1914.51,-1915.32 1911.01,-1905.32 1907.51,-1915.32 1914.51,-1915.32"/>
</g>
<!-- attn_softmax -->
<g id="node11" class="node">
<title>attn_softmax</title>
<ellipse fill="lightblue" stroke="black" cx="1324.01" cy="-1989.22" rx="374.53" ry="48.17"/>
<text text-anchor="middle" x="1324.01" y="-2008.02" font-family="Times,serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="1324.01" y="-1993.02" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1324.01" y="-1978.02" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, seq_len=2048, num_heads=128]</text>
<text text-anchor="middle" x="1324.01" y="-1963.02" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, seq_len=2048, num_heads=128]</text>
</g>
<!-- attn_score&#45;&gt;attn_softmax -->
<g id="edge10" class="edge">
<title>attn_score&#45;&gt;attn_softmax</title>
<path fill="none" stroke="black" d="M1205.01,-2073.95C1219.41,-2063.81 1234.75,-2053.03 1249.46,-2042.68"/>
<polygon fill="black" stroke="black" points="1251.86,-2045.26 1258.03,-2036.65 1247.84,-2039.54 1251.86,-2045.26"/>
</g>
<!-- attn_softmax&#45;&gt;attn_weight -->
<g id="edge11" class="edge">
<title>attn_softmax&#45;&gt;attn_weight</title>
<path fill="none" stroke="black" d="M1508.53,-1947.3C1574.61,-1932.65 1649.28,-1916.09 1716.2,-1901.25"/>
<polygon fill="black" stroke="black" points="1717.01,-1904.66 1726.02,-1899.08 1715.5,-1897.82 1717.01,-1904.66"/>
</g>
<!-- o_proj -->
<g id="node13" class="node">
<title>o_proj</title>
<ellipse fill="lightblue" stroke="black" cx="1915.01" cy="-1724.89" rx="370.55" ry="48.17"/>
<text text-anchor="middle" x="1915.01" y="-1743.69" font-family="Times,serif" font-size="14.00">O Projection (Row Parallel)</text>
<text text-anchor="middle" x="1915.01" y="-1728.69" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1915.01" y="-1713.69" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, num_heads=128, head_dim=128]</text>
<text text-anchor="middle" x="1915.01" y="-1698.69" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, token_dim=7168]</text>
</g>
<!-- attn_weight&#45;&gt;o_proj -->
<g id="edge13" class="edge">
<title>attn_weight&#45;&gt;o_proj</title>
<path fill="none" stroke="black" d="M1912.46,-1808.69C1912.72,-1800.43 1912.99,-1791.74 1913.25,-1783.24"/>
<polygon fill="black" stroke="black" points="1916.75,-1783.1 1913.56,-1773 1909.76,-1782.88 1916.75,-1783.1"/>
</g>
<!-- o_proj&#45;&gt;res1 -->
<g id="edge14" class="edge">
<title>o_proj&#45;&gt;res1</title>
<path fill="none" stroke="black" d="M1980.72,-1677.4C1995.43,-1667 2011.26,-1655.8 2026.69,-1644.88"/>
<polygon fill="black" stroke="black" points="2029.07,-1647.49 2035.21,-1638.86 2025.03,-1641.77 2029.07,-1647.49"/>
</g>
<!-- gate -->
<g id="node15" class="node">
<title>gate</title>
<polygon fill="lightgreen" stroke="black" points="2313.15,-1487.43 1636.85,-1487.43 1462.87,-1351.43 2139.17,-1351.43 2313.15,-1487.43"/>
<text text-anchor="middle" x="1888.01" y="-1438.23" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="1888.01" y="-1423.23" font-family="Times,serif" font-size="14.00">GPU: Routing Node</text>
<text text-anchor="middle" x="1888.01" y="-1408.23" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="1888.01" y="-1393.23" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, top_k=2]</text>
</g>
<!-- res1&#45;&gt;gate -->
<g id="edge16" class="edge">
<title>res1&#45;&gt;gate</title>
<path fill="none" stroke="black" d="M2035.6,-1525.36C2021.19,-1515.12 2005.94,-1504.28 1990.93,-1493.61"/>
<polygon fill="black" stroke="black" points="1992.81,-1490.64 1982.63,-1487.7 1988.75,-1496.35 1992.81,-1490.64"/>
</g>
<!-- res2 -->
<g id="node24" class="node">
<title>res2</title>
<ellipse fill="lightblue" stroke="black" cx="2114.01" cy="-190.86" rx="298.3" ry="58.88"/>
<text text-anchor="middle" x="2114.01" y="-217.16" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="2114.01" y="-202.16" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="2114.01" y="-187.16" font-family="Times,serif" font-size="14.00">Input1: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="2114.01" y="-172.16" font-family="Times,serif" font-size="14.00">Input2: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="2114.01" y="-157.16" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, token_dim=7168]</text>
</g>
<!-- res1&#45;&gt;res2 -->
<g id="edge27" class="edge">
<title>res1&#45;&gt;res2</title>
<path fill="none" stroke="black" d="M2265.1,-1531.49C2286.22,-1519.59 2306.1,-1505.07 2322.01,-1487.43 2396.66,-1404.65 2398.01,-1359.89 2398.01,-1248.43 2398.01,-1248.43 2398.01,-1248.43 2398.01,-524.55 2398.01,-478.62 2372.51,-335.96 2328.01,-285.55 2314.34,-270.06 2297.65,-257.03 2279.67,-246.09"/>
<polygon fill="black" stroke="black" points="2281.15,-242.91 2270.75,-240.89 2277.62,-248.95 2281.15,-242.91"/>
</g>
<!-- token_split -->
<g id="node16" class="node">
<title>token_split</title>
<polygon fill="lightgreen" stroke="black" points="2370.31,-1315.43 1510.81,-1315.43 1289.71,-1179.43 2149.2,-1179.43 2370.31,-1315.43"/>
<text text-anchor="middle" x="1830.01" y="-1266.23" font-family="Times,serif" font-size="14.00">Token Split</text>
<text text-anchor="middle" x="1830.01" y="-1251.23" font-family="Times,serif" font-size="14.00">GPU: 0_0,0_1,0_2,0_3,1_0,1_1,1_2,1_3,2_0,2_1,2_2,2_3,3_0,3_1,3_2,3_3</text>
<text text-anchor="middle" x="1830.01" y="-1236.23" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="1830.01" y="-1221.23" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, dynamic_seq_len, token_dim=7168]</text>
</g>
<!-- gate&#45;&gt;token_split -->
<g id="edge17" class="edge">
<title>gate&#45;&gt;token_split</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1865.09,-1351.24C1862.19,-1342.74 1859.2,-1334 1856.26,-1325.36"/>
<polygon fill="black" stroke="black" points="1859.5,-1324.02 1852.96,-1315.68 1852.87,-1326.28 1859.5,-1324.02"/>
</g>
<!-- expert_gate -->
<g id="node17" class="node">
<title>expert_gate</title>
<ellipse fill="lightblue" stroke="black" cx="1441.01" cy="-1095.34" rx="318.4" ry="48.17"/>
<text text-anchor="middle" x="1441.01" y="-1114.14" font-family="Times,serif" font-size="14.00">Expert Gate (Parameterized)</text>
<text text-anchor="middle" x="1441.01" y="-1099.14" font-family="Times,serif" font-size="14.00">GPU: GPU_i for expert_i</text>
<text text-anchor="middle" x="1441.01" y="-1084.14" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, dynamic_seq_len, token_dim=7168]</text>
<text text-anchor="middle" x="1441.01" y="-1069.14" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]</text>
</g>
<!-- token_split&#45;&gt;expert_gate -->
<g id="edge18" class="edge">
<title>token_split&#45;&gt;expert_gate</title>
<path fill="none" stroke="black" d="M1656.27,-1179.39C1625.31,-1167.45 1593.63,-1155.23 1564.44,-1143.96"/>
<polygon fill="black" stroke="black" points="1565.64,-1140.68 1555.05,-1140.34 1563.12,-1147.21 1565.64,-1140.68"/>
</g>
<!-- expert_up -->
<g id="node18" class="node">
<title>expert_up</title>
<ellipse fill="lightblue" stroke="black" cx="1997.01" cy="-963.18" rx="318.4" ry="48.17"/>
<text text-anchor="middle" x="1997.01" y="-981.98" font-family="Times,serif" font-size="14.00">Expert Up Projection</text>
<text text-anchor="middle" x="1997.01" y="-966.98" font-family="Times,serif" font-size="14.00">GPU: GPU_i for expert_i</text>
<text text-anchor="middle" x="1997.01" y="-951.98" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, dynamic_seq_len, token_dim=7168]</text>
<text text-anchor="middle" x="1997.01" y="-936.98" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]</text>
</g>
<!-- token_split&#45;&gt;expert_up -->
<g id="edge19" class="edge">
<title>token_split&#45;&gt;expert_up</title>
<path fill="none" stroke="black" d="M1869.8,-1179.18C1898.47,-1130.72 1936.72,-1066.08 1963.76,-1020.37"/>
<polygon fill="black" stroke="black" points="1966.94,-1021.88 1969.02,-1011.49 1960.91,-1018.31 1966.94,-1021.88"/>
</g>
<!-- expert_act -->
<g id="node19" class="node">
<title>expert_act</title>
<ellipse fill="lightblue" stroke="black" cx="1343.01" cy="-963.18" rx="318.4" ry="48.17"/>
<text text-anchor="middle" x="1343.01" y="-981.98" font-family="Times,serif" font-size="14.00">Expert Activation (SiLU)</text>
<text text-anchor="middle" x="1343.01" y="-966.98" font-family="Times,serif" font-size="14.00">GPU: GPU_i for expert_i</text>
<text text-anchor="middle" x="1343.01" y="-951.98" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]</text>
<text text-anchor="middle" x="1343.01" y="-936.98" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]</text>
</g>
<!-- expert_gate&#45;&gt;expert_act -->
<g id="edge20" class="edge">
<title>expert_gate&#45;&gt;expert_act</title>
<path fill="none" stroke="black" d="M1405.63,-1047.35C1398.76,-1038.22 1391.5,-1028.59 1384.46,-1019.23"/>
<polygon fill="black" stroke="black" points="1387.15,-1016.98 1378.34,-1011.1 1381.56,-1021.19 1387.15,-1016.98"/>
</g>
<!-- expert_mul -->
<g id="node21" class="node">
<title>expert_mul</title>
<ellipse fill="lightblue" stroke="black" cx="1830.01" cy="-820.4" rx="318.4" ry="58.88"/>
<text text-anchor="middle" x="1830.01" y="-846.7" font-family="Times,serif" font-size="14.00">Expert Gate Multiply</text>
<text text-anchor="middle" x="1830.01" y="-831.7" font-family="Times,serif" font-size="14.00">GPU: GPU_i for expert_i</text>
<text text-anchor="middle" x="1830.01" y="-816.7" font-family="Times,serif" font-size="14.00">Input1: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]</text>
<text text-anchor="middle" x="1830.01" y="-801.7" font-family="Times,serif" font-size="14.00">Input2: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]</text>
<text text-anchor="middle" x="1830.01" y="-786.7" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]</text>
</g>
<!-- expert_up&#45;&gt;expert_mul -->
<g id="edge21" class="edge">
<title>expert_up&#45;&gt;expert_mul</title>
<path fill="none" stroke="black" d="M1941.86,-915.69C1929.98,-905.68 1917.23,-894.93 1904.75,-884.41"/>
<polygon fill="black" stroke="black" points="1906.92,-881.66 1897.02,-877.89 1902.41,-887.01 1906.92,-881.66"/>
</g>
<!-- expert_act&#45;&gt;expert_mul -->
<g id="edge22" class="edge">
<title>expert_act&#45;&gt;expert_mul</title>
<path fill="none" stroke="black" d="M1487.81,-920.32C1539.12,-905.49 1597.47,-888.62 1651.27,-873.07"/>
<polygon fill="black" stroke="black" points="1652.28,-876.42 1660.91,-870.28 1650.33,-869.7 1652.28,-876.42"/>
</g>
<!-- expert_down -->
<g id="node20" class="node">
<title>expert_down</title>
<ellipse fill="lightblue" stroke="black" cx="1830.01" cy="-677.63" rx="311.67" ry="48.17"/>
<text text-anchor="middle" x="1830.01" y="-696.43" font-family="Times,serif" font-size="14.00">Expert Down Projection</text>
<text text-anchor="middle" x="1830.01" y="-681.43" font-family="Times,serif" font-size="14.00">GPU: GPU_i for expert_i</text>
<text text-anchor="middle" x="1830.01" y="-666.43" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, dynamic_seq_len, mlp_hidden=2048]</text>
<text text-anchor="middle" x="1830.01" y="-651.43" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, dynamic_seq_len, token_dim=7168]</text>
</g>
<!-- token_aggregate -->
<g id="node22" class="node">
<title>token_aggregate</title>
<polygon fill="lightgreen" stroke="black" points="2370.31,-593.55 1510.81,-593.55 1289.71,-457.55 2149.2,-457.55 2370.31,-593.55"/>
<text text-anchor="middle" x="1830.01" y="-544.35" font-family="Times,serif" font-size="14.00">Token Aggregate</text>
<text text-anchor="middle" x="1830.01" y="-529.35" font-family="Times,serif" font-size="14.00">GPU: 0_0,0_1,0_2,0_3,1_0,1_1,1_2,1_3,2_0,2_1,2_2,2_3,3_0,3_1,3_2,3_3</text>
<text text-anchor="middle" x="1830.01" y="-514.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, dynamic_seq_len, token_dim=7168]</text>
<text text-anchor="middle" x="1830.01" y="-499.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, token_dim=7168]</text>
</g>
<!-- expert_down&#45;&gt;token_aggregate -->
<g id="edge24" class="edge">
<title>expert_down&#45;&gt;token_aggregate</title>
<path fill="none" stroke="black" d="M1830.01,-629.14C1830.01,-621.06 1830.01,-612.47 1830.01,-603.85"/>
<polygon fill="black" stroke="black" points="1833.51,-603.74 1830.01,-593.74 1826.51,-603.74 1833.51,-603.74"/>
</g>
<!-- expert_mul&#45;&gt;expert_down -->
<g id="edge23" class="edge">
<title>expert_mul&#45;&gt;expert_down</title>
<path fill="none" stroke="black" d="M1830.01,-761.33C1830.01,-752.93 1830.01,-744.29 1830.01,-735.91"/>
<polygon fill="black" stroke="black" points="1833.51,-735.84 1830.01,-725.84 1826.51,-735.84 1833.51,-735.84"/>
</g>
<!-- final_agg -->
<g id="node23" class="node">
<title>final_agg</title>
<polygon fill="lightgreen" stroke="black" points="2318.53,-421.55 1622.53,-421.55 1443.49,-285.55 2139.49,-285.55 2318.53,-421.55"/>
<text text-anchor="middle" x="1881.01" y="-372.35" font-family="Times,serif" font-size="14.00">Final Expert Aggregation</text>
<text text-anchor="middle" x="1881.01" y="-357.35" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="1881.01" y="-342.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=4, seq_len=2048, token_dim=7168]</text>
<text text-anchor="middle" x="1881.01" y="-327.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=4, seq_len=2048, token_dim=7168]</text>
</g>
<!-- token_aggregate&#45;&gt;final_agg -->
<g id="edge25" class="edge">
<title>token_aggregate&#45;&gt;final_agg</title>
<path fill="none" stroke="black" d="M1850.17,-457.36C1852.71,-448.86 1855.34,-440.12 1857.93,-431.48"/>
<polygon fill="black" stroke="black" points="1861.31,-432.39 1860.83,-421.8 1854.61,-430.38 1861.31,-432.39"/>
</g>
<!-- final_agg&#45;&gt;res2 -->
<g id="edge26" class="edge">
<title>final_agg&#45;&gt;res2</title>
<path fill="none" stroke="black" d="M1978.47,-285.33C1993.83,-274.74 2009.65,-263.83 2024.81,-253.37"/>
<polygon fill="black" stroke="black" points="2026.92,-256.17 2033.16,-247.61 2022.94,-250.41 2026.92,-256.17"/>
</g>
<!-- res2&#45;&gt;output -->
<g id="edge28" class="edge">
<title>res2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2114.01,-131.79C2114.01,-123.39 2114.01,-114.74 2114.01,-106.36"/>
<polygon fill="black" stroke="black" points="2117.51,-106.3 2114.01,-96.3 2110.51,-106.3 2117.51,-106.3"/>
</g>
</g>
</svg>
