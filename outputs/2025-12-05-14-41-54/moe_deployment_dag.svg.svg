<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1479pt" height="3231pt"
 viewBox="0.00 0.00 1479.00 3231.24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 3227.24)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-3227.24 1475,-3227.24 1475,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage1_input</title>
<path fill="lightgray" stroke="black" d="M531,-2942.27C531,-2942.27 917,-2942.27 917,-2942.27 923,-2942.27 929,-2948.27 929,-2954.27 929,-2954.27 929,-3145.25 929,-3145.25 929,-3151.25 923,-3157.25 917,-3157.25 917,-3157.25 531,-3157.25 531,-3157.25 525,-3157.25 519,-3151.25 519,-3145.25 519,-3145.25 519,-2954.27 519,-2954.27 519,-2948.27 525,-2942.27 531,-2942.27"/>
<text text-anchor="middle" x="724" y="-3142.05" font-family="Arial" font-size="14.00">Stage 1 Input Distribution (GPUs 0&#45;7)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer1</title>
<path fill="lightcyan" stroke="black" d="M609,-2149.31C609,-2149.31 840,-2149.31 840,-2149.31 846,-2149.31 852,-2155.31 852,-2161.31 852,-2161.31 852,-2922.27 852,-2922.27 852,-2928.27 846,-2934.27 840,-2934.27 840,-2934.27 609,-2934.27 609,-2934.27 603,-2934.27 597,-2928.27 597,-2922.27 597,-2922.27 597,-2161.31 597,-2161.31 597,-2155.31 603,-2149.31 609,-2149.31"/>
<text text-anchor="middle" x="724.5" y="-2919.07" font-family="Arial" font-size="14.00">Layer 1 &#45; Multi&#45;Head Attention (Stage 1)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer1_mlp</title>
<path fill="lightcyan" stroke="black" d="M643,-1521.34C643,-1521.34 805,-1521.34 805,-1521.34 811,-1521.34 817,-1527.34 817,-1533.34 817,-1533.34 817,-2129.31 817,-2129.31 817,-2135.31 811,-2141.31 805,-2141.31 805,-2141.31 643,-2141.31 643,-2141.31 637,-2141.31 631,-2135.31 631,-2129.31 631,-2129.31 631,-1533.34 631,-1533.34 631,-1527.34 637,-1521.34 643,-1521.34"/>
<text text-anchor="middle" x="724" y="-2126.11" font-family="Arial" font-size="14.00">Layer 1 &#45; MLP (Stage 1)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_layer1_moe</title>
<path fill="lightcyan" stroke="black" d="M20,-1173.91C20,-1173.91 1451,-1173.91 1451,-1173.91 1457,-1173.91 1463,-1179.91 1463,-1185.91 1463,-1185.91 1463,-1501.34 1463,-1501.34 1463,-1507.34 1457,-1513.34 1451,-1513.34 1451,-1513.34 20,-1513.34 20,-1513.34 14,-1513.34 8,-1507.34 8,-1501.34 8,-1501.34 8,-1185.91 8,-1185.91 8,-1179.91 14,-1173.91 20,-1173.91"/>
<text text-anchor="middle" x="735.5" y="-1498.14" font-family="Arial" font-size="14.00">Layer 1 &#45; MoE Routing (Stage 1)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_layer1_experts</title>
<path fill="lightcyan" stroke="black" d="M153,-865.91C153,-865.91 1295,-865.91 1295,-865.91 1301,-865.91 1307,-871.91 1307,-877.91 1307,-877.91 1307,-1153.91 1307,-1153.91 1307,-1159.91 1301,-1165.91 1295,-1165.91 1295,-1165.91 153,-1165.91 153,-1165.91 147,-1165.91 141,-1159.91 141,-1153.91 141,-1153.91 141,-877.91 141,-877.91 141,-871.91 147,-865.91 153,-865.91"/>
<text text-anchor="middle" x="724" y="-1150.71" font-family="Arial" font-size="14.00">Layer 1 &#45; Expert Computation (8 experts per GPU)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_layer1_moe_agg</title>
<path fill="lightcyan" stroke="black" d="M617,-565.93C617,-565.93 830,-565.93 830,-565.93 836,-565.93 842,-571.93 842,-577.93 842,-577.93 842,-845.91 842,-845.91 842,-851.91 836,-857.91 830,-857.91 830,-857.91 617,-857.91 617,-857.91 611,-857.91 605,-851.91 605,-845.91 605,-845.91 605,-577.93 605,-577.93 605,-571.93 611,-565.93 617,-565.93"/>
<text text-anchor="middle" x="723.5" y="-842.71" font-family="Arial" font-size="14.00">Layer 1 &#45; MoE Aggregation (Stage 1)</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_pipeline_comm</title>
<path fill="lightgray" stroke="black" d="M590,-366.97C590,-366.97 857,-366.97 857,-366.97 863,-366.97 869,-372.97 869,-378.97 869,-378.97 869,-545.93 869,-545.93 869,-551.93 863,-557.93 857,-557.93 857,-557.93 590,-557.93 590,-557.93 584,-557.93 578,-551.93 578,-545.93 578,-545.93 578,-378.97 578,-378.97 578,-372.97 584,-366.97 590,-366.97"/>
<text text-anchor="middle" x="723.5" y="-542.73" font-family="Arial" font-size="14.00">Pipeline Communication (Stage 1 → Stage 2)</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_stage2_layers</title>
<path fill="lightgray" stroke="black" d="M593,-85.98C593,-85.98 853,-85.98 853,-85.98 859,-85.98 865,-91.98 865,-97.98 865,-97.98 865,-346.97 865,-346.97 865,-352.97 859,-358.97 853,-358.97 853,-358.97 593,-358.97 593,-358.97 587,-358.97 581,-352.97 581,-346.97 581,-346.97 581,-97.98 581,-97.98 581,-91.98 587,-85.98 593,-85.98"/>
<text text-anchor="middle" x="723" y="-343.77" font-family="Arial" font-size="14.00">Stage 2: Layers 9&#45;16 (GPUs 8&#45;15)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightcoral" stroke="black" cx="724" cy="-3194.25" rx="177.47" ry="28.98"/>
<text text-anchor="middle" x="724" y="-3202.75" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="724" y="-3191.75" font-family="Arial" font-size="10.00">Batch: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="724" y="-3180.75" font-family="Arial" font-size="10.00">GPU: Host</text>
</g>
<!-- s1_split -->
<g id="node2" class="node">
<title>s1_split</title>
<polygon fill="lightyellow" stroke="black" points="920.97,-3126.25 607.64,-3126.25 527.03,-3044.25 840.36,-3044.25 920.97,-3126.25"/>
<text text-anchor="middle" x="724" y="-3093.75" font-family="Arial" font-size="10.00">Split Input Data</text>
<text text-anchor="middle" x="724" y="-3082.75" font-family="Arial" font-size="10.00">[128, 1024, 1024] → 4×[128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-3071.75" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- input&#45;&gt;s1_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;s1_split</title>
<path fill="none" stroke="black" d="M724,-3165.13C724,-3156.4 724,-3146.5 724,-3136.73"/>
<polygon fill="black" stroke="black" points="727.5,-3136.65 724,-3126.65 720.5,-3136.65 727.5,-3136.65"/>
</g>
<!-- s1_broadcast -->
<g id="node3" class="node">
<title>s1_broadcast</title>
<ellipse fill="lightblue" stroke="black" cx="724" cy="-2979.26" rx="61.54" ry="28.98"/>
<text text-anchor="middle" x="724" y="-2987.76" font-family="Arial" font-size="10.00">Broadcast Input</text>
<text text-anchor="middle" x="724" y="-2976.76" font-family="Arial" font-size="10.00">[128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-2965.76" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- s1_split&#45;&gt;s1_broadcast -->
<g id="edge2" class="edge">
<title>s1_split&#45;&gt;s1_broadcast</title>
<path fill="none" stroke="black" d="M724,-3044.05C724,-3035.69 724,-3026.9 724,-3018.61"/>
<polygon fill="black" stroke="black" points="727.5,-3018.45 724,-3008.45 720.5,-3018.45 727.5,-3018.45"/>
</g>
<!-- l1_ln -->
<g id="node4" class="node">
<title>l1_ln</title>
<polygon fill="lightgreen" stroke="black" points="785,-2903.27 663,-2903.27 663,-2851.27 785,-2851.27 785,-2903.27"/>
<text text-anchor="middle" x="724" y="-2891.27" font-family="Arial" font-size="10.00">LayerNorm</text>
<text text-anchor="middle" x="724" y="-2880.27" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-2869.27" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-2858.27" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- s1_broadcast&#45;&gt;l1_ln -->
<g id="edge3" class="edge">
<title>s1_broadcast&#45;&gt;l1_ln</title>
<path fill="none" stroke="black" d="M724,-2950.14C724,-2938.8 724,-2925.57 724,-2913.59"/>
<polygon fill="black" stroke="black" points="727.5,-2913.45 724,-2903.45 720.5,-2913.45 727.5,-2913.45"/>
</g>
<!-- l1_qkv -->
<g id="node5" class="node">
<title>l1_qkv</title>
<polygon fill="lightgreen" stroke="black" points="787,-2815.27 661,-2815.27 661,-2763.27 787,-2763.27 787,-2815.27"/>
<text text-anchor="middle" x="724" y="-2803.27" font-family="Arial" font-size="10.00">QKV Linear (Col&#45;Parallel)</text>
<text text-anchor="middle" x="724" y="-2792.27" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-2781.27" font-family="Arial" font-size="10.00">Output: [128, 1024, 192]</text>
<text text-anchor="middle" x="724" y="-2770.27" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_ln&#45;&gt;l1_qkv -->
<g id="edge4" class="edge">
<title>l1_ln&#45;&gt;l1_qkv</title>
<path fill="none" stroke="black" d="M724,-2850.93C724,-2842.97 724,-2834.03 724,-2825.52"/>
<polygon fill="black" stroke="black" points="727.5,-2825.43 724,-2815.43 720.5,-2825.43 727.5,-2825.43"/>
</g>
<!-- l1_qkv_comm -->
<g id="node6" class="node">
<title>l1_qkv_comm</title>
<ellipse fill="lightblue" stroke="black" cx="724" cy="-2698.28" rx="61.54" ry="28.98"/>
<text text-anchor="middle" x="724" y="-2706.78" font-family="Arial" font-size="10.00">All&#45;Gather QKV</text>
<text text-anchor="middle" x="724" y="-2695.78" font-family="Arial" font-size="10.00">[128, 1024, 192]</text>
<text text-anchor="middle" x="724" y="-2684.78" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_qkv&#45;&gt;l1_qkv_comm -->
<g id="edge5" class="edge">
<title>l1_qkv&#45;&gt;l1_qkv_comm</title>
<path fill="none" stroke="black" d="M724,-2763.01C724,-2755.12 724,-2746.23 724,-2737.65"/>
<polygon fill="black" stroke="black" points="727.5,-2737.42 724,-2727.42 720.5,-2737.42 727.5,-2737.42"/>
</g>
<!-- l1_reshape -->
<g id="node7" class="node">
<title>l1_reshape</title>
<polygon fill="lightgreen" stroke="black" points="816.5,-2633.29 631.5,-2633.29 631.5,-2592.29 816.5,-2592.29 816.5,-2633.29"/>
<text text-anchor="middle" x="724" y="-2621.29" font-family="Arial" font-size="10.00">Reshape for Attention</text>
<text text-anchor="middle" x="724" y="-2610.29" font-family="Arial" font-size="10.00">[128, 1024, 192] → [128, 16, 1024, 64]</text>
<text text-anchor="middle" x="724" y="-2599.29" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_qkv_comm&#45;&gt;l1_reshape -->
<g id="edge6" class="edge">
<title>l1_qkv_comm&#45;&gt;l1_reshape</title>
<path fill="none" stroke="black" d="M724,-2669.01C724,-2660.76 724,-2651.73 724,-2643.4"/>
<polygon fill="black" stroke="black" points="727.5,-2643.34 724,-2633.34 720.5,-2643.34 727.5,-2643.34"/>
</g>
<!-- l1_scores -->
<g id="node8" class="node">
<title>l1_scores</title>
<polygon fill="lightgreen" stroke="black" points="793.5,-2556.29 654.5,-2556.29 654.5,-2504.29 793.5,-2504.29 793.5,-2556.29"/>
<text text-anchor="middle" x="724" y="-2544.29" font-family="Arial" font-size="10.00">Attention Scores</text>
<text text-anchor="middle" x="724" y="-2533.29" font-family="Arial" font-size="10.00">Input: [128, 4, 1024, 64]</text>
<text text-anchor="middle" x="724" y="-2522.29" font-family="Arial" font-size="10.00">Output: [128, 4, 1024, 1024]</text>
<text text-anchor="middle" x="724" y="-2511.29" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_reshape&#45;&gt;l1_scores -->
<g id="edge7" class="edge">
<title>l1_reshape&#45;&gt;l1_scores</title>
<path fill="none" stroke="black" d="M724,-2591.89C724,-2584.28 724,-2575.35 724,-2566.71"/>
<polygon fill="black" stroke="black" points="727.5,-2566.44 724,-2556.44 720.5,-2566.44 727.5,-2566.44"/>
</g>
<!-- l1_weights -->
<g id="node9" class="node">
<title>l1_weights</title>
<polygon fill="lightgreen" stroke="black" points="793.5,-2468.29 654.5,-2468.29 654.5,-2416.29 793.5,-2416.29 793.5,-2468.29"/>
<text text-anchor="middle" x="724" y="-2456.29" font-family="Arial" font-size="10.00">Attention Softmax</text>
<text text-anchor="middle" x="724" y="-2445.29" font-family="Arial" font-size="10.00">Input: [128, 4, 1024, 1024]</text>
<text text-anchor="middle" x="724" y="-2434.29" font-family="Arial" font-size="10.00">Output: [128, 4, 1024, 1024]</text>
<text text-anchor="middle" x="724" y="-2423.29" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_scores&#45;&gt;l1_weights -->
<g id="edge8" class="edge">
<title>l1_scores&#45;&gt;l1_weights</title>
<path fill="none" stroke="black" d="M724,-2503.95C724,-2495.99 724,-2487.05 724,-2478.53"/>
<polygon fill="black" stroke="black" points="727.5,-2478.45 724,-2468.45 720.5,-2478.45 727.5,-2478.45"/>
</g>
<!-- l1_attout -->
<g id="node10" class="node">
<title>l1_attout</title>
<polygon fill="lightgreen" stroke="black" points="785,-2380.29 663,-2380.29 663,-2328.29 785,-2328.29 785,-2380.29"/>
<text text-anchor="middle" x="724" y="-2368.29" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="724" y="-2357.29" font-family="Arial" font-size="10.00">Input: [128, 4, 1024, 64]</text>
<text text-anchor="middle" x="724" y="-2346.29" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-2335.29" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_weights&#45;&gt;l1_attout -->
<g id="edge9" class="edge">
<title>l1_weights&#45;&gt;l1_attout</title>
<path fill="none" stroke="black" d="M724,-2415.95C724,-2407.99 724,-2399.05 724,-2390.53"/>
<polygon fill="black" stroke="black" points="727.5,-2390.45 724,-2380.45 720.5,-2390.45 727.5,-2390.45"/>
</g>
<!-- l1_att_allreduce -->
<g id="node11" class="node">
<title>l1_att_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="724" cy="-2263.3" rx="74.91" ry="28.98"/>
<text text-anchor="middle" x="724" y="-2271.8" font-family="Arial" font-size="10.00">All&#45;Reduce Attention</text>
<text text-anchor="middle" x="724" y="-2260.8" font-family="Arial" font-size="10.00">[128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-2249.8" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_attout&#45;&gt;l1_att_allreduce -->
<g id="edge10" class="edge">
<title>l1_attout&#45;&gt;l1_att_allreduce</title>
<path fill="none" stroke="black" d="M724,-2328.03C724,-2320.13 724,-2311.24 724,-2302.66"/>
<polygon fill="black" stroke="black" points="727.5,-2302.44 724,-2292.44 720.5,-2302.44 727.5,-2302.44"/>
</g>
<!-- l1_residual -->
<g id="node12" class="node">
<title>l1_residual</title>
<polygon fill="lightgreen" stroke="black" points="809,-2198.31 639,-2198.31 639,-2157.31 809,-2157.31 809,-2198.31"/>
<text text-anchor="middle" x="724" y="-2186.31" font-family="Arial" font-size="10.00">Add Residual</text>
<text text-anchor="middle" x="724" y="-2175.31" font-family="Arial" font-size="10.00">[128, 1024, 256] + [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-2164.31" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_att_allreduce&#45;&gt;l1_residual -->
<g id="edge11" class="edge">
<title>l1_att_allreduce&#45;&gt;l1_residual</title>
<path fill="none" stroke="black" d="M724,-2234.03C724,-2225.78 724,-2216.75 724,-2208.42"/>
<polygon fill="black" stroke="black" points="727.5,-2208.35 724,-2198.35 720.5,-2208.35 727.5,-2208.35"/>
</g>
<!-- l1_mlp_ln -->
<g id="node13" class="node">
<title>l1_mlp_ln</title>
<polygon fill="lightgreen" stroke="black" points="785,-2110.31 663,-2110.31 663,-2058.31 785,-2058.31 785,-2110.31"/>
<text text-anchor="middle" x="724" y="-2098.31" font-family="Arial" font-size="10.00">MLP LayerNorm</text>
<text text-anchor="middle" x="724" y="-2087.31" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-2076.31" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-2065.31" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_residual&#45;&gt;l1_mlp_ln -->
<g id="edge12" class="edge">
<title>l1_residual&#45;&gt;l1_mlp_ln</title>
<path fill="none" stroke="black" d="M724,-2156.95C724,-2146.28 724,-2132.79 724,-2120.41"/>
<polygon fill="black" stroke="black" points="727.5,-2120.36 724,-2110.36 720.5,-2120.36 727.5,-2120.36"/>
</g>
<!-- l1_mlp_linear1 -->
<g id="node14" class="node">
<title>l1_mlp_linear1</title>
<polygon fill="lightgreen" stroke="black" points="791,-2022.31 657,-2022.31 657,-1970.31 791,-1970.31 791,-2022.31"/>
<text text-anchor="middle" x="724" y="-2010.31" font-family="Arial" font-size="10.00">MLP Linear 1 (Col&#45;Parallel)</text>
<text text-anchor="middle" x="724" y="-1999.31" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-1988.31" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
<text text-anchor="middle" x="724" y="-1977.31" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_mlp_ln&#45;&gt;l1_mlp_linear1 -->
<g id="edge13" class="edge">
<title>l1_mlp_ln&#45;&gt;l1_mlp_linear1</title>
<path fill="none" stroke="black" d="M724,-2057.97C724,-2050.01 724,-2041.07 724,-2032.55"/>
<polygon fill="black" stroke="black" points="727.5,-2032.46 724,-2022.46 720.5,-2032.46 727.5,-2032.46"/>
</g>
<!-- l1_mlp_gather -->
<g id="node15" class="node">
<title>l1_mlp_gather</title>
<ellipse fill="lightblue" stroke="black" cx="724" cy="-1905.31" rx="65.11" ry="28.98"/>
<text text-anchor="middle" x="724" y="-1913.81" font-family="Arial" font-size="10.00">All&#45;Gather MLP</text>
<text text-anchor="middle" x="724" y="-1902.81" font-family="Arial" font-size="10.00">[128, 1024, 1024]</text>
<text text-anchor="middle" x="724" y="-1891.81" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_mlp_linear1&#45;&gt;l1_mlp_gather -->
<g id="edge14" class="edge">
<title>l1_mlp_linear1&#45;&gt;l1_mlp_gather</title>
<path fill="none" stroke="black" d="M724,-1970.04C724,-1962.15 724,-1953.26 724,-1944.68"/>
<polygon fill="black" stroke="black" points="727.5,-1944.46 724,-1934.46 720.5,-1944.46 727.5,-1944.46"/>
</g>
<!-- l1_mlp_gelu -->
<g id="node16" class="node">
<title>l1_mlp_gelu</title>
<polygon fill="lightgreen" stroke="black" points="788,-1840.32 660,-1840.32 660,-1788.32 788,-1788.32 788,-1840.32"/>
<text text-anchor="middle" x="724" y="-1828.32" font-family="Arial" font-size="10.00">GELU Activation</text>
<text text-anchor="middle" x="724" y="-1817.32" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="724" y="-1806.32" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
<text text-anchor="middle" x="724" y="-1795.32" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_mlp_gather&#45;&gt;l1_mlp_gelu -->
<g id="edge15" class="edge">
<title>l1_mlp_gather&#45;&gt;l1_mlp_gelu</title>
<path fill="none" stroke="black" d="M724,-1876.16C724,-1868.05 724,-1859.1 724,-1850.61"/>
<polygon fill="black" stroke="black" points="727.5,-1850.59 724,-1840.59 720.5,-1850.59 727.5,-1850.59"/>
</g>
<!-- l1_mlp_linear2 -->
<g id="node17" class="node">
<title>l1_mlp_linear2</title>
<polygon fill="lightgreen" stroke="black" points="793.5,-1752.32 654.5,-1752.32 654.5,-1700.32 793.5,-1700.32 793.5,-1752.32"/>
<text text-anchor="middle" x="724" y="-1740.32" font-family="Arial" font-size="10.00">MLP Linear 2 (Row&#45;Parallel)</text>
<text text-anchor="middle" x="724" y="-1729.32" font-family="Arial" font-size="10.00">Input: [128, 1024, 512]</text>
<text text-anchor="middle" x="724" y="-1718.32" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-1707.32" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_mlp_gelu&#45;&gt;l1_mlp_linear2 -->
<g id="edge16" class="edge">
<title>l1_mlp_gelu&#45;&gt;l1_mlp_linear2</title>
<path fill="none" stroke="black" d="M724,-1787.99C724,-1780.02 724,-1771.09 724,-1762.57"/>
<polygon fill="black" stroke="black" points="727.5,-1762.48 724,-1752.48 720.5,-1762.48 727.5,-1762.48"/>
</g>
<!-- l1_mlp_allreduce -->
<g id="node18" class="node">
<title>l1_mlp_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="724" cy="-1635.33" rx="62.45" ry="28.98"/>
<text text-anchor="middle" x="724" y="-1643.83" font-family="Arial" font-size="10.00">All&#45;Reduce MLP</text>
<text text-anchor="middle" x="724" y="-1632.83" font-family="Arial" font-size="10.00">[128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-1621.83" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_mlp_linear2&#45;&gt;l1_mlp_allreduce -->
<g id="edge17" class="edge">
<title>l1_mlp_linear2&#45;&gt;l1_mlp_allreduce</title>
<path fill="none" stroke="black" d="M724,-1700.06C724,-1692.17 724,-1683.28 724,-1674.7"/>
<polygon fill="black" stroke="black" points="727.5,-1674.47 724,-1664.47 720.5,-1674.47 727.5,-1674.47"/>
</g>
<!-- l1_mlp_residual -->
<g id="node19" class="node">
<title>l1_mlp_residual</title>
<polygon fill="lightgreen" stroke="black" points="809,-1570.34 639,-1570.34 639,-1529.34 809,-1529.34 809,-1570.34"/>
<text text-anchor="middle" x="724" y="-1558.34" font-family="Arial" font-size="10.00">Add Residual</text>
<text text-anchor="middle" x="724" y="-1547.34" font-family="Arial" font-size="10.00">[128, 1024, 256] + [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-1536.34" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_mlp_allreduce&#45;&gt;l1_mlp_residual -->
<g id="edge18" class="edge">
<title>l1_mlp_allreduce&#45;&gt;l1_mlp_residual</title>
<path fill="none" stroke="black" d="M724,-1606.07C724,-1597.82 724,-1588.78 724,-1580.45"/>
<polygon fill="black" stroke="black" points="727.5,-1580.39 724,-1570.39 720.5,-1580.39 727.5,-1580.39"/>
</g>
<!-- l1_moe_gate -->
<g id="node20" class="node">
<title>l1_moe_gate</title>
<polygon fill="lightyellow" stroke="black" points="845.1,-1482.34 652.46,-1482.34 602.9,-1378.34 795.54,-1378.34 845.1,-1482.34"/>
<text text-anchor="middle" x="724" y="-1444.34" font-family="Arial" font-size="10.00">MoE Gate</text>
<text text-anchor="middle" x="724" y="-1433.34" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="724" y="-1422.34" font-family="Arial" font-size="10.00">Output: [128, 1024, 64]</text>
<text text-anchor="middle" x="724" y="-1411.34" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_mlp_residual&#45;&gt;l1_moe_gate -->
<g id="edge19" class="edge">
<title>l1_mlp_residual&#45;&gt;l1_moe_gate</title>
<path fill="none" stroke="black" d="M724,-1529.17C724,-1518.97 724,-1505.89 724,-1492.63"/>
<polygon fill="black" stroke="black" points="727.5,-1492.51 724,-1482.51 720.5,-1492.51 727.5,-1492.51"/>
</g>
<!-- l1_moe_select -->
<g id="node21" class="node">
<title>l1_moe_select</title>
<polygon fill="lightyellow" stroke="black" points="874.16,-1342.34 635.29,-1342.34 573.84,-1260.34 812.71,-1260.34 874.16,-1342.34"/>
<text text-anchor="middle" x="724" y="-1309.84" font-family="Arial" font-size="10.00">Expert Selection (Top&#45;2)</text>
<text text-anchor="middle" x="724" y="-1298.84" font-family="Arial" font-size="10.00">[128, 1024, 64] → Expert IDs</text>
<text text-anchor="middle" x="724" y="-1287.84" font-family="Arial" font-size="10.00">GPU: 0&#45;3,4&#45;7</text>
</g>
<!-- l1_moe_gate&#45;&gt;l1_moe_select -->
<g id="edge20" class="edge">
<title>l1_moe_gate&#45;&gt;l1_moe_select</title>
<path fill="none" stroke="black" d="M724,-1378.05C724,-1369.63 724,-1360.92 724,-1352.53"/>
<polygon fill="black" stroke="black" points="727.5,-1352.49 724,-1342.49 720.5,-1352.49 727.5,-1352.49"/>
</g>
<!-- l1_moe_route_gpu0 -->
<g id="node22" class="node">
<title>l1_moe_route_gpu0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="92" cy="-1203.13" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="92" y="-1206.13" font-family="Arial" font-size="10.00">Route to Experts 0&#45;7</text>
<text text-anchor="middle" x="92" y="-1195.13" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- l1_moe_select&#45;&gt;l1_moe_route_gpu0 -->
<g id="edge21" class="edge">
<title>l1_moe_select&#45;&gt;l1_moe_route_gpu0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M592.74,-1285.67C481.57,-1272.39 318.22,-1250.88 177,-1224.34 170.39,-1223.1 163.52,-1221.68 156.68,-1220.18"/>
<polygon fill="black" stroke="black" points="157.23,-1216.72 146.7,-1217.95 155.7,-1223.55 157.23,-1216.72"/>
</g>
<!-- l1_moe_route_gpu1 -->
<g id="node23" class="node">
<title>l1_moe_route_gpu1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="266" cy="-1203.13" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="266" y="-1206.13" font-family="Arial" font-size="10.00">Route to Experts 8&#45;15</text>
<text text-anchor="middle" x="266" y="-1195.13" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- l1_moe_select&#45;&gt;l1_moe_route_gpu1 -->
<g id="edge26" class="edge">
<title>l1_moe_select&#45;&gt;l1_moe_route_gpu1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M582.37,-1271.87C513.65,-1257.87 429.95,-1240.57 355,-1224.34 348.45,-1222.92 341.62,-1221.42 334.81,-1219.9"/>
<polygon fill="black" stroke="black" points="335.37,-1216.44 324.85,-1217.67 333.84,-1223.27 335.37,-1216.44"/>
</g>
<!-- l1_moe_route_gpu2 -->
<g id="node24" class="node">
<title>l1_moe_route_gpu2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="447" cy="-1203.13" rx="83.38" ry="21.43"/>
<text text-anchor="middle" x="447" y="-1206.13" font-family="Arial" font-size="10.00">Route to Experts 16&#45;23</text>
<text text-anchor="middle" x="447" y="-1195.13" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- l1_moe_select&#45;&gt;l1_moe_route_gpu2 -->
<g id="edge31" class="edge">
<title>l1_moe_select&#45;&gt;l1_moe_route_gpu2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M608.53,-1260.23C572.5,-1247.72 534.33,-1234.46 504.14,-1223.97"/>
<polygon fill="black" stroke="black" points="505.23,-1220.65 494.63,-1220.67 502.93,-1227.26 505.23,-1220.65"/>
</g>
<!-- l1_moe_route_gpu3 -->
<g id="node25" class="node">
<title>l1_moe_route_gpu3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="632" cy="-1203.13" rx="83.38" ry="21.43"/>
<text text-anchor="middle" x="632" y="-1206.13" font-family="Arial" font-size="10.00">Route to Experts 24&#45;31</text>
<text text-anchor="middle" x="632" y="-1195.13" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- l1_moe_select&#45;&gt;l1_moe_route_gpu3 -->
<g id="edge36" class="edge">
<title>l1_moe_select&#45;&gt;l1_moe_route_gpu3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M685.52,-1260.09C676.3,-1250.46 666.67,-1240.39 658.16,-1231.49"/>
<polygon fill="black" stroke="black" points="660.45,-1228.82 651.01,-1224.01 655.39,-1233.65 660.45,-1228.82"/>
</g>
<!-- l1_moe_route_gpu4 -->
<g id="node26" class="node">
<title>l1_moe_route_gpu4</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="817" cy="-1203.13" rx="83.38" ry="21.43"/>
<text text-anchor="middle" x="817" y="-1206.13" font-family="Arial" font-size="10.00">Route to Experts 32&#45;39</text>
<text text-anchor="middle" x="817" y="-1195.13" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- l1_moe_select&#45;&gt;l1_moe_route_gpu4 -->
<g id="edge41" class="edge">
<title>l1_moe_select&#45;&gt;l1_moe_route_gpu4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M762.9,-1260.09C772.31,-1250.36 782.15,-1240.18 790.81,-1231.22"/>
<polygon fill="black" stroke="black" points="793.35,-1233.63 797.78,-1224.01 788.32,-1228.77 793.35,-1233.63"/>
</g>
<!-- l1_moe_route_gpu5 -->
<g id="node27" class="node">
<title>l1_moe_route_gpu5</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1002" cy="-1203.13" rx="83.38" ry="21.43"/>
<text text-anchor="middle" x="1002" y="-1206.13" font-family="Arial" font-size="10.00">Route to Experts 40&#45;47</text>
<text text-anchor="middle" x="1002" y="-1195.13" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- l1_moe_select&#45;&gt;l1_moe_route_gpu5 -->
<g id="edge46" class="edge">
<title>l1_moe_select&#45;&gt;l1_moe_route_gpu5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M818.51,-1267.63C860.41,-1253.13 908.34,-1236.54 944.71,-1223.95"/>
<polygon fill="black" stroke="black" points="945.86,-1227.26 954.17,-1220.68 943.57,-1220.64 945.86,-1227.26"/>
</g>
<!-- l1_moe_route_gpu6 -->
<g id="node28" class="node">
<title>l1_moe_route_gpu6</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1187" cy="-1203.13" rx="83.38" ry="21.43"/>
<text text-anchor="middle" x="1187" y="-1206.13" font-family="Arial" font-size="10.00">Route to Experts 48&#45;55</text>
<text text-anchor="middle" x="1187" y="-1195.13" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- l1_moe_select&#45;&gt;l1_moe_route_gpu6 -->
<g id="edge51" class="edge">
<title>l1_moe_select&#45;&gt;l1_moe_route_gpu6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M827.34,-1279.44C901.58,-1264.35 1004.02,-1243.36 1094,-1224.34 1101.06,-1222.85 1108.41,-1221.28 1115.76,-1219.7"/>
<polygon fill="black" stroke="black" points="1116.7,-1223.08 1125.74,-1217.55 1115.23,-1216.23 1116.7,-1223.08"/>
</g>
<!-- l1_moe_route_gpu7 -->
<g id="node29" class="node">
<title>l1_moe_route_gpu7</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1372" cy="-1203.13" rx="83.38" ry="21.43"/>
<text text-anchor="middle" x="1372" y="-1206.13" font-family="Arial" font-size="10.00">Route to Experts 56&#45;63</text>
<text text-anchor="middle" x="1372" y="-1195.13" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- l1_moe_select&#45;&gt;l1_moe_route_gpu7 -->
<g id="edge56" class="edge">
<title>l1_moe_select&#45;&gt;l1_moe_route_gpu7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M833.39,-1287.91C945.61,-1274.57 1125.05,-1251.57 1279,-1224.34 1286.35,-1223.04 1294.01,-1221.57 1301.63,-1220.03"/>
<polygon fill="black" stroke="black" points="1302.52,-1223.42 1311.6,-1217.97 1301.1,-1216.56 1302.52,-1223.42"/>
</g>
<!-- l1_expert_linear1_gpu0 -->
<g id="node30" class="node">
<title>l1_expert_linear1_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="277,-1134.91 149,-1134.91 149,-1071.91 277,-1071.91 277,-1134.91"/>
<text text-anchor="middle" x="213" y="-1122.91" font-family="Arial" font-size="10.00">Expert Linear 1</text>
<text text-anchor="middle" x="213" y="-1111.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="213" y="-1100.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="213" y="-1089.91" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="213" y="-1078.91" font-family="Arial" font-size="10.00">Experts: 0&#45;7</text>
</g>
<!-- l1_moe_route_gpu0&#45;&gt;l1_expert_linear1_gpu0 -->
<g id="edge22" class="edge">
<title>l1_moe_route_gpu0&#45;&gt;l1_expert_linear1_gpu0</title>
<path fill="none" stroke="black" d="M115.91,-1182.82C130.48,-1171.05 149.59,-1155.62 167,-1141.56"/>
<polygon fill="black" stroke="black" points="169.27,-1144.22 174.85,-1135.22 164.88,-1138.78 169.27,-1144.22"/>
</g>
<!-- l1_expert_linear1_gpu1 -->
<g id="node33" class="node">
<title>l1_expert_linear1_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="423,-1134.91 295,-1134.91 295,-1071.91 423,-1071.91 423,-1134.91"/>
<text text-anchor="middle" x="359" y="-1122.91" font-family="Arial" font-size="10.00">Expert Linear 1</text>
<text text-anchor="middle" x="359" y="-1111.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="359" y="-1100.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="359" y="-1089.91" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="359" y="-1078.91" font-family="Arial" font-size="10.00">Experts: 8&#45;15</text>
</g>
<!-- l1_moe_route_gpu1&#45;&gt;l1_expert_linear1_gpu1 -->
<g id="edge27" class="edge">
<title>l1_moe_route_gpu1&#45;&gt;l1_expert_linear1_gpu1</title>
<path fill="none" stroke="black" d="M284.82,-1182.35C295.75,-1170.87 309.88,-1156.02 322.87,-1142.37"/>
<polygon fill="black" stroke="black" points="325.59,-1144.59 329.95,-1134.94 320.52,-1139.77 325.59,-1144.59"/>
</g>
<!-- l1_expert_linear1_gpu2 -->
<g id="node36" class="node">
<title>l1_expert_linear1_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="569,-1134.91 441,-1134.91 441,-1071.91 569,-1071.91 569,-1134.91"/>
<text text-anchor="middle" x="505" y="-1122.91" font-family="Arial" font-size="10.00">Expert Linear 1</text>
<text text-anchor="middle" x="505" y="-1111.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="505" y="-1100.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="505" y="-1089.91" font-family="Arial" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="505" y="-1078.91" font-family="Arial" font-size="10.00">Experts: 16&#45;23</text>
</g>
<!-- l1_moe_route_gpu2&#45;&gt;l1_expert_linear1_gpu2 -->
<g id="edge32" class="edge">
<title>l1_moe_route_gpu2&#45;&gt;l1_expert_linear1_gpu2</title>
<path fill="none" stroke="black" d="M459.02,-1181.88C465.54,-1170.89 473.84,-1156.92 481.58,-1143.87"/>
<polygon fill="black" stroke="black" points="484.73,-1145.42 486.82,-1135.04 478.71,-1141.85 484.73,-1145.42"/>
</g>
<!-- l1_expert_linear1_gpu3 -->
<g id="node39" class="node">
<title>l1_expert_linear1_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="715,-1134.91 587,-1134.91 587,-1071.91 715,-1071.91 715,-1134.91"/>
<text text-anchor="middle" x="651" y="-1122.91" font-family="Arial" font-size="10.00">Expert Linear 1</text>
<text text-anchor="middle" x="651" y="-1111.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="651" y="-1100.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="651" y="-1089.91" font-family="Arial" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="651" y="-1078.91" font-family="Arial" font-size="10.00">Experts: 24&#45;31</text>
</g>
<!-- l1_moe_route_gpu3&#45;&gt;l1_expert_linear1_gpu3 -->
<g id="edge37" class="edge">
<title>l1_moe_route_gpu3&#45;&gt;l1_expert_linear1_gpu3</title>
<path fill="none" stroke="black" d="M635.94,-1181.88C638.01,-1171.21 640.63,-1157.72 643.11,-1145"/>
<polygon fill="black" stroke="black" points="646.57,-1145.52 645.05,-1135.04 639.7,-1144.18 646.57,-1145.52"/>
</g>
<!-- l1_expert_linear1_gpu4 -->
<g id="node42" class="node">
<title>l1_expert_linear1_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="861,-1134.91 733,-1134.91 733,-1071.91 861,-1071.91 861,-1134.91"/>
<text text-anchor="middle" x="797" y="-1122.91" font-family="Arial" font-size="10.00">Expert Linear 1</text>
<text text-anchor="middle" x="797" y="-1111.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="797" y="-1100.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="797" y="-1089.91" font-family="Arial" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="797" y="-1078.91" font-family="Arial" font-size="10.00">Experts: 32&#45;39</text>
</g>
<!-- l1_moe_route_gpu4&#45;&gt;l1_expert_linear1_gpu4 -->
<g id="edge42" class="edge">
<title>l1_moe_route_gpu4&#45;&gt;l1_expert_linear1_gpu4</title>
<path fill="none" stroke="black" d="M812.86,-1181.88C810.67,-1171.21 807.91,-1157.72 805.31,-1145"/>
<polygon fill="black" stroke="black" points="808.7,-1144.13 803.27,-1135.04 801.84,-1145.53 808.7,-1144.13"/>
</g>
<!-- l1_expert_linear1_gpu5 -->
<g id="node45" class="node">
<title>l1_expert_linear1_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1007,-1134.91 879,-1134.91 879,-1071.91 1007,-1071.91 1007,-1134.91"/>
<text text-anchor="middle" x="943" y="-1122.91" font-family="Arial" font-size="10.00">Expert Linear 1</text>
<text text-anchor="middle" x="943" y="-1111.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="943" y="-1100.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="943" y="-1089.91" font-family="Arial" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="943" y="-1078.91" font-family="Arial" font-size="10.00">Experts: 40&#45;47</text>
</g>
<!-- l1_moe_route_gpu5&#45;&gt;l1_expert_linear1_gpu5 -->
<g id="edge47" class="edge">
<title>l1_moe_route_gpu5&#45;&gt;l1_expert_linear1_gpu5</title>
<path fill="none" stroke="black" d="M989.78,-1181.88C983.14,-1170.89 974.7,-1156.92 966.82,-1143.87"/>
<polygon fill="black" stroke="black" points="969.65,-1141.79 961.49,-1135.04 963.66,-1145.41 969.65,-1141.79"/>
</g>
<!-- l1_expert_linear1_gpu6 -->
<g id="node48" class="node">
<title>l1_expert_linear1_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1153,-1134.91 1025,-1134.91 1025,-1071.91 1153,-1071.91 1153,-1134.91"/>
<text text-anchor="middle" x="1089" y="-1122.91" font-family="Arial" font-size="10.00">Expert Linear 1</text>
<text text-anchor="middle" x="1089" y="-1111.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="1089" y="-1100.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="1089" y="-1089.91" font-family="Arial" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="1089" y="-1078.91" font-family="Arial" font-size="10.00">Experts: 48&#45;55</text>
</g>
<!-- l1_moe_route_gpu6&#45;&gt;l1_expert_linear1_gpu6 -->
<g id="edge52" class="edge">
<title>l1_moe_route_gpu6&#45;&gt;l1_expert_linear1_gpu6</title>
<path fill="none" stroke="black" d="M1167.17,-1182.35C1155.65,-1170.87 1140.76,-1156.02 1127.07,-1142.37"/>
<polygon fill="black" stroke="black" points="1129.17,-1139.52 1119.61,-1134.94 1124.22,-1144.48 1129.17,-1139.52"/>
</g>
<!-- l1_expert_linear1_gpu7 -->
<g id="node51" class="node">
<title>l1_expert_linear1_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1299,-1134.91 1171,-1134.91 1171,-1071.91 1299,-1071.91 1299,-1134.91"/>
<text text-anchor="middle" x="1235" y="-1122.91" font-family="Arial" font-size="10.00">Expert Linear 1</text>
<text text-anchor="middle" x="1235" y="-1111.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="1235" y="-1100.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="1235" y="-1089.91" font-family="Arial" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="1235" y="-1078.91" font-family="Arial" font-size="10.00">Experts: 56&#45;63</text>
</g>
<!-- l1_moe_route_gpu7&#45;&gt;l1_expert_linear1_gpu7 -->
<g id="edge57" class="edge">
<title>l1_moe_route_gpu7&#45;&gt;l1_expert_linear1_gpu7</title>
<path fill="none" stroke="black" d="M1344.93,-1182.82C1328.22,-1170.9 1306.23,-1155.21 1286.31,-1141.01"/>
<polygon fill="black" stroke="black" points="1288.09,-1137.98 1277.92,-1135.03 1284.03,-1143.68 1288.09,-1137.98"/>
</g>
<!-- l1_expert_gelu_gpu0 -->
<g id="node31" class="node">
<title>l1_expert_gelu_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="277,-1035.91 149,-1035.91 149,-972.91 277,-972.91 277,-1035.91"/>
<text text-anchor="middle" x="213" y="-1023.91" font-family="Arial" font-size="10.00">Expert GELU</text>
<text text-anchor="middle" x="213" y="-1012.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="213" y="-1001.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="213" y="-990.91" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="213" y="-979.91" font-family="Arial" font-size="10.00">Experts: 0&#45;7</text>
</g>
<!-- l1_expert_linear1_gpu0&#45;&gt;l1_expert_gelu_gpu0 -->
<g id="edge23" class="edge">
<title>l1_expert_linear1_gpu0&#45;&gt;l1_expert_gelu_gpu0</title>
<path fill="none" stroke="black" d="M213,-1071.72C213,-1063.67 213,-1054.86 213,-1046.37"/>
<polygon fill="black" stroke="black" points="216.5,-1046.24 213,-1036.24 209.5,-1046.24 216.5,-1046.24"/>
</g>
<!-- l1_expert_linear2_gpu0 -->
<g id="node32" class="node">
<title>l1_expert_linear2_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="277,-936.91 155,-936.91 155,-873.91 277,-873.91 277,-936.91"/>
<text text-anchor="middle" x="216" y="-924.91" font-family="Arial" font-size="10.00">Expert Linear 2</text>
<text text-anchor="middle" x="216" y="-913.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="216" y="-902.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="216" y="-891.91" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="216" y="-880.91" font-family="Arial" font-size="10.00">Experts: 0&#45;7</text>
</g>
<!-- l1_expert_gelu_gpu0&#45;&gt;l1_expert_linear2_gpu0 -->
<g id="edge24" class="edge">
<title>l1_expert_gelu_gpu0&#45;&gt;l1_expert_linear2_gpu0</title>
<path fill="none" stroke="black" d="M213.95,-972.72C214.2,-964.67 214.47,-955.86 214.73,-947.37"/>
<polygon fill="black" stroke="black" points="218.24,-947.34 215.05,-937.24 211.24,-947.13 218.24,-947.34"/>
</g>
<!-- l1_moe_gather -->
<g id="node54" class="node">
<title>l1_moe_gather</title>
<ellipse fill="lightblue" stroke="black" cx="723" cy="-797.92" rx="81.13" ry="28.98"/>
<text text-anchor="middle" x="723" y="-806.42" font-family="Arial" font-size="10.00">Gather Expert Outputs</text>
<text text-anchor="middle" x="723" y="-795.42" font-family="Arial" font-size="10.00">8×[128, 1024, 256]</text>
<text text-anchor="middle" x="723" y="-784.42" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- l1_expert_linear2_gpu0&#45;&gt;l1_moe_gather -->
<g id="edge25" class="edge">
<title>l1_expert_linear2_gpu0&#45;&gt;l1_moe_gather</title>
<path fill="none" stroke="black" d="M271.6,-873.78C278.35,-870.8 285.24,-868.09 292,-865.91 406.34,-829.09 544.48,-812.18 633.01,-804.64"/>
<polygon fill="black" stroke="black" points="633.34,-808.13 643.02,-803.81 632.77,-801.15 633.34,-808.13"/>
</g>
<!-- l1_expert_gelu_gpu1 -->
<g id="node34" class="node">
<title>l1_expert_gelu_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="423,-1035.91 295,-1035.91 295,-972.91 423,-972.91 423,-1035.91"/>
<text text-anchor="middle" x="359" y="-1023.91" font-family="Arial" font-size="10.00">Expert GELU</text>
<text text-anchor="middle" x="359" y="-1012.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="359" y="-1001.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="359" y="-990.91" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="359" y="-979.91" font-family="Arial" font-size="10.00">Experts: 8&#45;15</text>
</g>
<!-- l1_expert_linear1_gpu1&#45;&gt;l1_expert_gelu_gpu1 -->
<g id="edge28" class="edge">
<title>l1_expert_linear1_gpu1&#45;&gt;l1_expert_gelu_gpu1</title>
<path fill="none" stroke="black" d="M359,-1071.72C359,-1063.67 359,-1054.86 359,-1046.37"/>
<polygon fill="black" stroke="black" points="362.5,-1046.24 359,-1036.24 355.5,-1046.24 362.5,-1046.24"/>
</g>
<!-- l1_expert_linear2_gpu1 -->
<g id="node35" class="node">
<title>l1_expert_linear2_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="423,-936.91 301,-936.91 301,-873.91 423,-873.91 423,-936.91"/>
<text text-anchor="middle" x="362" y="-924.91" font-family="Arial" font-size="10.00">Expert Linear 2</text>
<text text-anchor="middle" x="362" y="-913.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="362" y="-902.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="362" y="-891.91" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="362" y="-880.91" font-family="Arial" font-size="10.00">Experts: 8&#45;15</text>
</g>
<!-- l1_expert_gelu_gpu1&#45;&gt;l1_expert_linear2_gpu1 -->
<g id="edge29" class="edge">
<title>l1_expert_gelu_gpu1&#45;&gt;l1_expert_linear2_gpu1</title>
<path fill="none" stroke="black" d="M359.95,-972.72C360.2,-964.67 360.47,-955.86 360.73,-947.37"/>
<polygon fill="black" stroke="black" points="364.24,-947.34 361.05,-937.24 357.24,-947.13 364.24,-947.34"/>
</g>
<!-- l1_expert_linear2_gpu1&#45;&gt;l1_moe_gather -->
<g id="edge30" class="edge">
<title>l1_expert_linear2_gpu1&#45;&gt;l1_moe_gather</title>
<path fill="none" stroke="black" d="M418.62,-873.9C425.06,-870.98 431.61,-868.25 438,-865.91 504.33,-841.71 582.59,-824.05 640.3,-812.96"/>
<polygon fill="black" stroke="black" points="641.29,-816.33 650.47,-811.03 639.99,-809.45 641.29,-816.33"/>
</g>
<!-- l1_expert_gelu_gpu2 -->
<g id="node37" class="node">
<title>l1_expert_gelu_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="569,-1035.91 441,-1035.91 441,-972.91 569,-972.91 569,-1035.91"/>
<text text-anchor="middle" x="505" y="-1023.91" font-family="Arial" font-size="10.00">Expert GELU</text>
<text text-anchor="middle" x="505" y="-1012.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="505" y="-1001.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="505" y="-990.91" font-family="Arial" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="505" y="-979.91" font-family="Arial" font-size="10.00">Experts: 16&#45;23</text>
</g>
<!-- l1_expert_linear1_gpu2&#45;&gt;l1_expert_gelu_gpu2 -->
<g id="edge33" class="edge">
<title>l1_expert_linear1_gpu2&#45;&gt;l1_expert_gelu_gpu2</title>
<path fill="none" stroke="black" d="M505,-1071.72C505,-1063.67 505,-1054.86 505,-1046.37"/>
<polygon fill="black" stroke="black" points="508.5,-1046.24 505,-1036.24 501.5,-1046.24 508.5,-1046.24"/>
</g>
<!-- l1_expert_linear2_gpu2 -->
<g id="node38" class="node">
<title>l1_expert_linear2_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="569,-936.91 447,-936.91 447,-873.91 569,-873.91 569,-936.91"/>
<text text-anchor="middle" x="508" y="-924.91" font-family="Arial" font-size="10.00">Expert Linear 2</text>
<text text-anchor="middle" x="508" y="-913.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="508" y="-902.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="508" y="-891.91" font-family="Arial" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="508" y="-880.91" font-family="Arial" font-size="10.00">Experts: 16&#45;23</text>
</g>
<!-- l1_expert_gelu_gpu2&#45;&gt;l1_expert_linear2_gpu2 -->
<g id="edge34" class="edge">
<title>l1_expert_gelu_gpu2&#45;&gt;l1_expert_linear2_gpu2</title>
<path fill="none" stroke="black" d="M505.95,-972.72C506.2,-964.67 506.47,-955.86 506.73,-947.37"/>
<polygon fill="black" stroke="black" points="510.24,-947.34 507.05,-937.24 503.24,-947.13 510.24,-947.34"/>
</g>
<!-- l1_expert_linear2_gpu2&#45;&gt;l1_moe_gather -->
<g id="edge35" class="edge">
<title>l1_expert_linear2_gpu2&#45;&gt;l1_moe_gather</title>
<path fill="none" stroke="black" d="M566.47,-873.74C571.71,-871.07 576.94,-868.43 582,-865.91 609.34,-852.31 639.92,-837.71 665.6,-825.62"/>
<polygon fill="black" stroke="black" points="667.26,-828.7 674.82,-821.28 664.29,-822.37 667.26,-828.7"/>
</g>
<!-- l1_expert_gelu_gpu3 -->
<g id="node40" class="node">
<title>l1_expert_gelu_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="715,-1035.91 587,-1035.91 587,-972.91 715,-972.91 715,-1035.91"/>
<text text-anchor="middle" x="651" y="-1023.91" font-family="Arial" font-size="10.00">Expert GELU</text>
<text text-anchor="middle" x="651" y="-1012.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="651" y="-1001.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="651" y="-990.91" font-family="Arial" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="651" y="-979.91" font-family="Arial" font-size="10.00">Experts: 24&#45;31</text>
</g>
<!-- l1_expert_linear1_gpu3&#45;&gt;l1_expert_gelu_gpu3 -->
<g id="edge38" class="edge">
<title>l1_expert_linear1_gpu3&#45;&gt;l1_expert_gelu_gpu3</title>
<path fill="none" stroke="black" d="M651,-1071.72C651,-1063.67 651,-1054.86 651,-1046.37"/>
<polygon fill="black" stroke="black" points="654.5,-1046.24 651,-1036.24 647.5,-1046.24 654.5,-1046.24"/>
</g>
<!-- l1_expert_linear2_gpu3 -->
<g id="node41" class="node">
<title>l1_expert_linear2_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="713,-936.91 591,-936.91 591,-873.91 713,-873.91 713,-936.91"/>
<text text-anchor="middle" x="652" y="-924.91" font-family="Arial" font-size="10.00">Expert Linear 2</text>
<text text-anchor="middle" x="652" y="-913.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="652" y="-902.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="652" y="-891.91" font-family="Arial" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="652" y="-880.91" font-family="Arial" font-size="10.00">Experts: 24&#45;31</text>
</g>
<!-- l1_expert_gelu_gpu3&#45;&gt;l1_expert_linear2_gpu3 -->
<g id="edge39" class="edge">
<title>l1_expert_gelu_gpu3&#45;&gt;l1_expert_linear2_gpu3</title>
<path fill="none" stroke="black" d="M651.32,-972.72C651.4,-964.67 651.49,-955.86 651.58,-947.37"/>
<polygon fill="black" stroke="black" points="655.08,-947.27 651.68,-937.24 648.08,-947.2 655.08,-947.27"/>
</g>
<!-- l1_expert_linear2_gpu3&#45;&gt;l1_moe_gather -->
<g id="edge40" class="edge">
<title>l1_expert_linear2_gpu3&#45;&gt;l1_moe_gather</title>
<path fill="none" stroke="black" d="M672.54,-873.9C680.72,-861.74 690.21,-847.65 698.73,-834.98"/>
<polygon fill="black" stroke="black" points="701.77,-836.74 704.45,-826.49 695.96,-832.83 701.77,-836.74"/>
</g>
<!-- l1_expert_gelu_gpu4 -->
<g id="node43" class="node">
<title>l1_expert_gelu_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="861,-1035.91 733,-1035.91 733,-972.91 861,-972.91 861,-1035.91"/>
<text text-anchor="middle" x="797" y="-1023.91" font-family="Arial" font-size="10.00">Expert GELU</text>
<text text-anchor="middle" x="797" y="-1012.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="797" y="-1001.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="797" y="-990.91" font-family="Arial" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="797" y="-979.91" font-family="Arial" font-size="10.00">Experts: 32&#45;39</text>
</g>
<!-- l1_expert_linear1_gpu4&#45;&gt;l1_expert_gelu_gpu4 -->
<g id="edge43" class="edge">
<title>l1_expert_linear1_gpu4&#45;&gt;l1_expert_gelu_gpu4</title>
<path fill="none" stroke="black" d="M797,-1071.72C797,-1063.67 797,-1054.86 797,-1046.37"/>
<polygon fill="black" stroke="black" points="800.5,-1046.24 797,-1036.24 793.5,-1046.24 800.5,-1046.24"/>
</g>
<!-- l1_expert_linear2_gpu4 -->
<g id="node44" class="node">
<title>l1_expert_linear2_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="856,-936.91 734,-936.91 734,-873.91 856,-873.91 856,-936.91"/>
<text text-anchor="middle" x="795" y="-924.91" font-family="Arial" font-size="10.00">Expert Linear 2</text>
<text text-anchor="middle" x="795" y="-913.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="795" y="-902.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="795" y="-891.91" font-family="Arial" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="795" y="-880.91" font-family="Arial" font-size="10.00">Experts: 32&#45;39</text>
</g>
<!-- l1_expert_gelu_gpu4&#45;&gt;l1_expert_linear2_gpu4 -->
<g id="edge44" class="edge">
<title>l1_expert_gelu_gpu4&#45;&gt;l1_expert_linear2_gpu4</title>
<path fill="none" stroke="black" d="M796.37,-972.72C796.2,-964.67 796.02,-955.86 795.84,-947.37"/>
<polygon fill="black" stroke="black" points="799.34,-947.16 795.64,-937.24 792.34,-947.31 799.34,-947.16"/>
</g>
<!-- l1_expert_linear2_gpu4&#45;&gt;l1_moe_gather -->
<g id="edge45" class="edge">
<title>l1_expert_linear2_gpu4&#45;&gt;l1_moe_gather</title>
<path fill="none" stroke="black" d="M774.17,-873.9C765.87,-861.74 756.25,-847.65 747.61,-834.98"/>
<polygon fill="black" stroke="black" points="750.34,-832.77 741.81,-826.49 744.56,-836.72 750.34,-832.77"/>
</g>
<!-- l1_expert_gelu_gpu5 -->
<g id="node46" class="node">
<title>l1_expert_gelu_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1007,-1035.91 879,-1035.91 879,-972.91 1007,-972.91 1007,-1035.91"/>
<text text-anchor="middle" x="943" y="-1023.91" font-family="Arial" font-size="10.00">Expert GELU</text>
<text text-anchor="middle" x="943" y="-1012.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="943" y="-1001.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="943" y="-990.91" font-family="Arial" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="943" y="-979.91" font-family="Arial" font-size="10.00">Experts: 40&#45;47</text>
</g>
<!-- l1_expert_linear1_gpu5&#45;&gt;l1_expert_gelu_gpu5 -->
<g id="edge48" class="edge">
<title>l1_expert_linear1_gpu5&#45;&gt;l1_expert_gelu_gpu5</title>
<path fill="none" stroke="black" d="M943,-1071.72C943,-1063.67 943,-1054.86 943,-1046.37"/>
<polygon fill="black" stroke="black" points="946.5,-1046.24 943,-1036.24 939.5,-1046.24 946.5,-1046.24"/>
</g>
<!-- l1_expert_linear2_gpu5 -->
<g id="node47" class="node">
<title>l1_expert_linear2_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1000,-936.91 878,-936.91 878,-873.91 1000,-873.91 1000,-936.91"/>
<text text-anchor="middle" x="939" y="-924.91" font-family="Arial" font-size="10.00">Expert Linear 2</text>
<text text-anchor="middle" x="939" y="-913.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="939" y="-902.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="939" y="-891.91" font-family="Arial" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="939" y="-880.91" font-family="Arial" font-size="10.00">Experts: 40&#45;47</text>
</g>
<!-- l1_expert_gelu_gpu5&#45;&gt;l1_expert_linear2_gpu5 -->
<g id="edge49" class="edge">
<title>l1_expert_gelu_gpu5&#45;&gt;l1_expert_linear2_gpu5</title>
<path fill="none" stroke="black" d="M941.73,-972.72C941.4,-964.67 941.04,-955.86 940.69,-947.37"/>
<polygon fill="black" stroke="black" points="944.18,-947.09 940.27,-937.24 937.19,-947.37 944.18,-947.09"/>
</g>
<!-- l1_expert_linear2_gpu5&#45;&gt;l1_moe_gather -->
<g id="edge50" class="edge">
<title>l1_expert_linear2_gpu5&#45;&gt;l1_moe_gather</title>
<path fill="none" stroke="black" d="M880.54,-873.73C875.3,-871.06 870.06,-868.42 865,-865.91 837.49,-852.27 806.69,-837.66 780.82,-825.58"/>
<polygon fill="black" stroke="black" points="782.07,-822.3 771.53,-821.25 779.12,-828.65 782.07,-822.3"/>
</g>
<!-- l1_expert_gelu_gpu6 -->
<g id="node49" class="node">
<title>l1_expert_gelu_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1153,-1035.91 1025,-1035.91 1025,-972.91 1153,-972.91 1153,-1035.91"/>
<text text-anchor="middle" x="1089" y="-1023.91" font-family="Arial" font-size="10.00">Expert GELU</text>
<text text-anchor="middle" x="1089" y="-1012.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="1089" y="-1001.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="1089" y="-990.91" font-family="Arial" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="1089" y="-979.91" font-family="Arial" font-size="10.00">Experts: 48&#45;55</text>
</g>
<!-- l1_expert_linear1_gpu6&#45;&gt;l1_expert_gelu_gpu6 -->
<g id="edge53" class="edge">
<title>l1_expert_linear1_gpu6&#45;&gt;l1_expert_gelu_gpu6</title>
<path fill="none" stroke="black" d="M1089,-1071.72C1089,-1063.67 1089,-1054.86 1089,-1046.37"/>
<polygon fill="black" stroke="black" points="1092.5,-1046.24 1089,-1036.24 1085.5,-1046.24 1092.5,-1046.24"/>
</g>
<!-- l1_expert_linear2_gpu6 -->
<g id="node50" class="node">
<title>l1_expert_linear2_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="1145,-936.91 1023,-936.91 1023,-873.91 1145,-873.91 1145,-936.91"/>
<text text-anchor="middle" x="1084" y="-924.91" font-family="Arial" font-size="10.00">Expert Linear 2</text>
<text text-anchor="middle" x="1084" y="-913.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="1084" y="-902.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="1084" y="-891.91" font-family="Arial" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="1084" y="-880.91" font-family="Arial" font-size="10.00">Experts: 48&#45;55</text>
</g>
<!-- l1_expert_gelu_gpu6&#45;&gt;l1_expert_linear2_gpu6 -->
<g id="edge54" class="edge">
<title>l1_expert_gelu_gpu6&#45;&gt;l1_expert_linear2_gpu6</title>
<path fill="none" stroke="black" d="M1087.42,-972.72C1087,-964.67 1086.55,-955.86 1086.11,-947.37"/>
<polygon fill="black" stroke="black" points="1089.6,-947.05 1085.59,-937.24 1082.61,-947.41 1089.6,-947.05"/>
</g>
<!-- l1_expert_linear2_gpu6&#45;&gt;l1_moe_gather -->
<g id="edge55" class="edge">
<title>l1_expert_linear2_gpu6&#45;&gt;l1_moe_gather</title>
<path fill="none" stroke="black" d="M1028.15,-873.88C1021.79,-870.97 1015.32,-868.24 1009,-865.91 942.37,-841.43 863.64,-823.76 805.67,-812.74"/>
<polygon fill="black" stroke="black" points="806.3,-809.3 795.83,-810.9 805.01,-816.18 806.3,-809.3"/>
</g>
<!-- l1_expert_gelu_gpu7 -->
<g id="node52" class="node">
<title>l1_expert_gelu_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1299,-1035.91 1171,-1035.91 1171,-972.91 1299,-972.91 1299,-1035.91"/>
<text text-anchor="middle" x="1235" y="-1023.91" font-family="Arial" font-size="10.00">Expert GELU</text>
<text text-anchor="middle" x="1235" y="-1012.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="1235" y="-1001.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
<text text-anchor="middle" x="1235" y="-990.91" font-family="Arial" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="1235" y="-979.91" font-family="Arial" font-size="10.00">Experts: 56&#45;63</text>
</g>
<!-- l1_expert_linear1_gpu7&#45;&gt;l1_expert_gelu_gpu7 -->
<g id="edge58" class="edge">
<title>l1_expert_linear1_gpu7&#45;&gt;l1_expert_gelu_gpu7</title>
<path fill="none" stroke="black" d="M1235,-1071.72C1235,-1063.67 1235,-1054.86 1235,-1046.37"/>
<polygon fill="black" stroke="black" points="1238.5,-1046.24 1235,-1036.24 1231.5,-1046.24 1238.5,-1046.24"/>
</g>
<!-- l1_expert_linear2_gpu7 -->
<g id="node53" class="node">
<title>l1_expert_linear2_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="1291,-936.91 1169,-936.91 1169,-873.91 1291,-873.91 1291,-936.91"/>
<text text-anchor="middle" x="1230" y="-924.91" font-family="Arial" font-size="10.00">Expert Linear 2</text>
<text text-anchor="middle" x="1230" y="-913.91" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048]</text>
<text text-anchor="middle" x="1230" y="-902.91" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="1230" y="-891.91" font-family="Arial" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="1230" y="-880.91" font-family="Arial" font-size="10.00">Experts: 56&#45;63</text>
</g>
<!-- l1_expert_gelu_gpu7&#45;&gt;l1_expert_linear2_gpu7 -->
<g id="edge59" class="edge">
<title>l1_expert_gelu_gpu7&#45;&gt;l1_expert_linear2_gpu7</title>
<path fill="none" stroke="black" d="M1233.42,-972.72C1233,-964.67 1232.55,-955.86 1232.11,-947.37"/>
<polygon fill="black" stroke="black" points="1235.6,-947.05 1231.59,-937.24 1228.61,-947.41 1235.6,-947.05"/>
</g>
<!-- l1_expert_linear2_gpu7&#45;&gt;l1_moe_gather -->
<g id="edge60" class="edge">
<title>l1_expert_linear2_gpu7&#45;&gt;l1_moe_gather</title>
<path fill="none" stroke="black" d="M1174.4,-873.78C1167.65,-870.8 1160.76,-868.09 1154,-865.91 1039.66,-829.09 901.52,-812.18 812.99,-804.64"/>
<polygon fill="black" stroke="black" points="813.23,-801.15 802.98,-803.81 812.66,-808.13 813.23,-801.15"/>
</g>
<!-- l1_moe_weighted -->
<g id="node55" class="node">
<title>l1_moe_weighted</title>
<polygon fill="lightyellow" stroke="black" points="813.4,-732.93 669.6,-732.93 632.6,-650.93 776.4,-650.93 813.4,-732.93"/>
<text text-anchor="middle" x="723" y="-700.43" font-family="Arial" font-size="10.00">Weighted Sum</text>
<text text-anchor="middle" x="723" y="-689.43" font-family="Arial" font-size="10.00">[128, 1024, 256]</text>
<text text-anchor="middle" x="723" y="-678.43" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- l1_moe_gather&#45;&gt;l1_moe_weighted -->
<g id="edge61" class="edge">
<title>l1_moe_gather&#45;&gt;l1_moe_weighted</title>
<path fill="none" stroke="black" d="M723,-768.78C723,-760.91 723,-752.11 723,-743.37"/>
<polygon fill="black" stroke="black" points="726.5,-743.2 723,-733.2 719.5,-743.2 726.5,-743.2"/>
</g>
<!-- l1_moe_residual -->
<g id="node56" class="node">
<title>l1_moe_residual</title>
<polygon fill="lightgreen" stroke="black" points="808,-614.93 638,-614.93 638,-573.93 808,-573.93 808,-614.93"/>
<text text-anchor="middle" x="723" y="-602.93" font-family="Arial" font-size="10.00">Add Residual</text>
<text text-anchor="middle" x="723" y="-591.93" font-family="Arial" font-size="10.00">[128, 1024, 256] + [128, 1024, 256]</text>
<text text-anchor="middle" x="723" y="-580.93" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- l1_moe_weighted&#45;&gt;l1_moe_residual -->
<g id="edge62" class="edge">
<title>l1_moe_weighted&#45;&gt;l1_moe_residual</title>
<path fill="none" stroke="black" d="M723,-650.71C723,-642.13 723,-633.22 723,-625.12"/>
<polygon fill="black" stroke="black" points="726.5,-625.04 723,-615.04 719.5,-625.04 726.5,-625.04"/>
</g>
<!-- pipe_send -->
<g id="node57" class="node">
<title>pipe_send</title>
<ellipse fill="lightblue" stroke="black" cx="723" cy="-497.94" rx="65.11" ry="28.98"/>
<text text-anchor="middle" x="723" y="-506.44" font-family="Arial" font-size="10.00">Pipeline Send</text>
<text text-anchor="middle" x="723" y="-495.44" font-family="Arial" font-size="10.00">[128, 1024, 256]</text>
<text text-anchor="middle" x="723" y="-484.44" font-family="Arial" font-size="10.00">GPU: 0&#45;7 → 8&#45;15</text>
</g>
<!-- l1_moe_residual&#45;&gt;pipe_send -->
<g id="edge63" class="edge">
<title>l1_moe_residual&#45;&gt;pipe_send</title>
<path fill="none" stroke="black" d="M723,-573.85C723,-563.29 723,-549.89 723,-537.35"/>
<polygon fill="black" stroke="black" points="726.5,-537.1 723,-527.1 719.5,-537.1 726.5,-537.1"/>
</g>
<!-- pipe_recv -->
<g id="node58" class="node">
<title>pipe_recv</title>
<ellipse fill="lightblue" stroke="black" cx="723" cy="-403.96" rx="63.78" ry="28.98"/>
<text text-anchor="middle" x="723" y="-412.46" font-family="Arial" font-size="10.00">Pipeline Receive</text>
<text text-anchor="middle" x="723" y="-401.46" font-family="Arial" font-size="10.00">[128, 1024, 256]</text>
<text text-anchor="middle" x="723" y="-390.46" font-family="Arial" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- pipe_send&#45;&gt;pipe_recv -->
<g id="edge64" class="edge">
<title>pipe_send&#45;&gt;pipe_recv</title>
<path fill="none" stroke="black" d="M723,-468.84C723,-460.8 723,-451.9 723,-443.36"/>
<polygon fill="black" stroke="black" points="726.5,-443.2 723,-433.2 719.5,-443.2 726.5,-443.2"/>
</g>
<!-- l16_final -->
<g id="node59" class="node">
<title>l16_final</title>
<polygon fill="lightgreen" stroke="black" points="784,-327.97 662,-327.97 662,-275.97 784,-275.97 784,-327.97"/>
<text text-anchor="middle" x="723" y="-315.97" font-family="Arial" font-size="10.00">Final LayerNorm</text>
<text text-anchor="middle" x="723" y="-304.97" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="723" y="-293.97" font-family="Arial" font-size="10.00">Output: [128, 1024, 256]</text>
<text text-anchor="middle" x="723" y="-282.97" font-family="Arial" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- pipe_recv&#45;&gt;l16_final -->
<g id="edge65" class="edge">
<title>pipe_recv&#45;&gt;l16_final</title>
<path fill="none" stroke="black" d="M723,-374.84C723,-363.49 723,-350.27 723,-338.28"/>
<polygon fill="black" stroke="black" points="726.5,-338.15 723,-328.15 719.5,-338.15 726.5,-338.15"/>
</g>
<!-- output_proj -->
<g id="node60" class="node">
<title>output_proj</title>
<polygon fill="lightgreen" stroke="black" points="787,-239.97 659,-239.97 659,-187.97 787,-187.97 787,-239.97"/>
<text text-anchor="middle" x="723" y="-227.97" font-family="Arial" font-size="10.00">Output Projection</text>
<text text-anchor="middle" x="723" y="-216.97" font-family="Arial" font-size="10.00">Input: [128, 1024, 256]</text>
<text text-anchor="middle" x="723" y="-205.97" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
<text text-anchor="middle" x="723" y="-194.97" font-family="Arial" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- l16_final&#45;&gt;output_proj -->
<g id="edge66" class="edge">
<title>l16_final&#45;&gt;output_proj</title>
<path fill="none" stroke="black" d="M723,-275.63C723,-267.67 723,-258.73 723,-250.21"/>
<polygon fill="black" stroke="black" points="726.5,-250.12 723,-240.12 719.5,-250.12 726.5,-250.12"/>
</g>
<!-- final_gather -->
<g id="node61" class="node">
<title>final_gather</title>
<ellipse fill="lightblue" stroke="black" cx="723" cy="-122.97" rx="134.2" ry="28.98"/>
<text text-anchor="middle" x="723" y="-131.47" font-family="Arial" font-size="10.00">All&#45;Gather Output</text>
<text text-anchor="middle" x="723" y="-120.47" font-family="Arial" font-size="10.00">4×[128, 1024, 256] → [128, 1024, 1024]</text>
<text text-anchor="middle" x="723" y="-109.47" font-family="Arial" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- output_proj&#45;&gt;final_gather -->
<g id="edge67" class="edge">
<title>output_proj&#45;&gt;final_gather</title>
<path fill="none" stroke="black" d="M723,-187.7C723,-179.81 723,-170.92 723,-162.34"/>
<polygon fill="black" stroke="black" points="726.5,-162.12 723,-152.12 719.5,-162.12 726.5,-162.12"/>
</g>
<!-- output -->
<g id="node62" class="node">
<title>output</title>
<ellipse fill="lightcoral" stroke="black" cx="723" cy="-28.99" rx="65.11" ry="28.98"/>
<text text-anchor="middle" x="723" y="-37.49" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="723" y="-26.49" font-family="Arial" font-size="10.00">[128, 1024, 1024]</text>
<text text-anchor="middle" x="723" y="-15.49" font-family="Arial" font-size="10.00">GPU: Host</text>
</g>
<!-- final_gather&#45;&gt;output -->
<g id="edge68" class="edge">
<title>final_gather&#45;&gt;output</title>
<path fill="none" stroke="black" d="M723,-93.88C723,-85.84 723,-76.94 723,-68.39"/>
<polygon fill="black" stroke="black" points="726.5,-68.23 723,-58.23 719.5,-68.23 726.5,-68.23"/>
</g>
</g>
</svg>
