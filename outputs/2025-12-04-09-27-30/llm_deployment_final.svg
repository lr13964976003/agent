<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1771pt" height="3622pt"
 viewBox="0.00 0.00 425.00 869.28" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(4.17 4.17) rotate(0) translate(4 865.28)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-865.28 421,-865.28 421,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_transformer</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="8,-62.43 8,-738.85 409,-738.85 409,-62.43 8,-62.43"/>
<text text-anchor="middle" x="208.5" y="-723.65" font-family="Times,serif" font-size="14.00">Transformer Layers (Ã—16)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_mha</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="93,-492.85 93,-663.85 323,-663.85 323,-492.85 93,-492.85"/>
<text text-anchor="middle" x="208" y="-648.65" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention (TP=2)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_moe</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="16,-70.43 16,-246.43 401,-246.43 401,-70.43 16,-70.43"/>
<text text-anchor="middle" x="208.5" y="-231.23" font-family="Times,serif" font-size="14.00">MoE Experts (EP=64, TP=2)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="208" cy="-840.07" rx="135.53" ry="21.43"/>
<text text-anchor="middle" x="208" y="-843.07" font-family="Arial" font-size="10.00">Model Input</text>
<text text-anchor="middle" x="208" y="-832.07" font-family="Arial" font-size="10.00">[batch=128, seq=10000, d_model=4096]</text>
</g>
<!-- embedding -->
<g id="node2" class="node">
<title>embedding</title>
<polygon fill="lightgreen" stroke="black" points="257,-782.85 159,-782.85 159,-746.85 257,-746.85 257,-782.85"/>
<text text-anchor="middle" x="208" y="-767.85" font-family="Arial" font-size="10.00">Token Embedding</text>
<text text-anchor="middle" x="208" y="-756.85" font-family="Arial" font-size="10.00">[128, 10000, 4096]</text>
</g>
<!-- input&#45;&gt;embedding -->
<g id="edge1" class="edge">
<title>input&#45;&gt;embedding</title>
<path fill="none" stroke="black" d="M208,-818.67C208,-810.82 208,-801.72 208,-793.3"/>
<polygon fill="black" stroke="black" points="211.5,-793.16 208,-783.16 204.5,-793.16 211.5,-793.16"/>
</g>
<!-- prenorm -->
<g id="node3" class="node">
<title>prenorm</title>
<polygon fill="lightgreen" stroke="black" points="257,-707.85 159,-707.85 159,-671.85 257,-671.85 257,-707.85"/>
<text text-anchor="middle" x="208" y="-692.85" font-family="Arial" font-size="10.00">Pre&#45;LayerNorm</text>
<text text-anchor="middle" x="208" y="-681.85" font-family="Arial" font-size="10.00">[128, 10000, 4096]</text>
</g>
<!-- embedding&#45;&gt;prenorm -->
<g id="edge2" class="edge">
<title>embedding&#45;&gt;prenorm</title>
<path fill="none" stroke="black" d="M208,-746.55C208,-738.1 208,-727.72 208,-718.23"/>
<polygon fill="black" stroke="black" points="211.5,-718.03 208,-708.03 204.5,-718.03 211.5,-718.03"/>
</g>
<!-- mha_gpu0 -->
<g id="node4" class="node">
<title>mha_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="315,-632.85 217,-632.85 217,-596.85 315,-596.85 315,-632.85"/>
<text text-anchor="middle" x="266" y="-617.85" font-family="Arial" font-size="10.00">MHA_GPU0</text>
<text text-anchor="middle" x="266" y="-606.85" font-family="Arial" font-size="10.00">[128, 10000, 2048]</text>
</g>
<!-- prenorm&#45;&gt;mha_gpu0 -->
<g id="edge3" class="edge">
<title>prenorm&#45;&gt;mha_gpu0</title>
<path fill="none" stroke="black" d="M221.75,-671.55C228.97,-662.46 237.96,-651.15 245.94,-641.1"/>
<polygon fill="black" stroke="black" points="248.87,-643.04 252.35,-633.03 243.39,-638.68 248.87,-643.04"/>
</g>
<!-- mha_gpu1 -->
<g id="node5" class="node">
<title>mha_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="199,-632.85 101,-632.85 101,-596.85 199,-596.85 199,-632.85"/>
<text text-anchor="middle" x="150" y="-617.85" font-family="Arial" font-size="10.00">MHA_GPU1</text>
<text text-anchor="middle" x="150" y="-606.85" font-family="Arial" font-size="10.00">[128, 10000, 2048]</text>
</g>
<!-- prenorm&#45;&gt;mha_gpu1 -->
<g id="edge4" class="edge">
<title>prenorm&#45;&gt;mha_gpu1</title>
<path fill="none" stroke="black" d="M194.25,-671.55C187.03,-662.46 178.04,-651.15 170.06,-641.1"/>
<polygon fill="black" stroke="black" points="172.61,-638.68 163.65,-633.03 167.13,-643.04 172.61,-638.68"/>
</g>
<!-- mha_merge -->
<g id="node6" class="node">
<title>mha_merge</title>
<polygon fill="yellow" stroke="black" points="309.7,-560.85 147.92,-560.85 106.3,-500.85 268.08,-500.85 309.7,-560.85"/>
<text text-anchor="middle" x="208" y="-533.85" font-family="Arial" font-size="10.00">MHA_Merge</text>
<text text-anchor="middle" x="208" y="-522.85" font-family="Arial" font-size="10.00">[128, 10000, 4096]</text>
</g>
<!-- mha_gpu0&#45;&gt;mha_merge -->
<g id="edge5" class="edge">
<title>mha_gpu0&#45;&gt;mha_merge</title>
<path fill="none" stroke="black" d="M253.7,-596.46C248.09,-588.54 241.22,-578.82 234.53,-569.36"/>
<polygon fill="black" stroke="black" points="237.36,-567.3 228.73,-561.16 231.65,-571.35 237.36,-567.3"/>
</g>
<!-- mha_gpu1&#45;&gt;mha_merge -->
<g id="edge6" class="edge">
<title>mha_gpu1&#45;&gt;mha_merge</title>
<path fill="none" stroke="black" d="M162.3,-596.46C167.91,-588.54 174.78,-578.82 181.47,-569.36"/>
<polygon fill="black" stroke="black" points="184.35,-571.35 187.27,-561.16 178.64,-567.3 184.35,-571.35"/>
</g>
<!-- postnorm -->
<g id="node7" class="node">
<title>postnorm</title>
<polygon fill="lightgreen" stroke="black" points="257,-464.85 159,-464.85 159,-428.85 257,-428.85 257,-464.85"/>
<text text-anchor="middle" x="208" y="-449.85" font-family="Arial" font-size="10.00">Post&#45;LayerNorm</text>
<text text-anchor="middle" x="208" y="-438.85" font-family="Arial" font-size="10.00">[128, 10000, 4096]</text>
</g>
<!-- mha_merge&#45;&gt;postnorm -->
<g id="edge7" class="edge">
<title>mha_merge&#45;&gt;postnorm</title>
<path fill="none" stroke="black" d="M208,-500.71C208,-492.39 208,-483.35 208,-475.15"/>
<polygon fill="black" stroke="black" points="211.5,-474.96 208,-464.96 204.5,-474.96 211.5,-474.96"/>
</g>
<!-- gate -->
<g id="node8" class="node">
<title>gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="309.7,-392.85 147.92,-392.85 106.3,-332.85 268.08,-332.85 309.7,-392.85"/>
<text text-anchor="middle" x="208" y="-365.85" font-family="Arial" font-size="10.00">Expert Router</text>
<text text-anchor="middle" x="208" y="-354.85" font-family="Arial" font-size="10.00">[128, 10000, 4096]</text>
</g>
<!-- postnorm&#45;&gt;gate -->
<g id="edge8" class="edge">
<title>postnorm&#45;&gt;gate</title>
<path fill="none" stroke="black" d="M208,-428.46C208,-421.1 208,-412.19 208,-403.37"/>
<polygon fill="black" stroke="black" points="211.5,-403.16 208,-393.16 204.5,-403.16 211.5,-403.16"/>
</g>
<!-- token_dist -->
<g id="node9" class="node">
<title>token_dist</title>
<ellipse fill="lightcoral" stroke="black" cx="208" cy="-275.64" rx="67.35" ry="21.43"/>
<text text-anchor="middle" x="208" y="-278.64" font-family="Arial" font-size="10.00">Token Distribution</text>
<text text-anchor="middle" x="208" y="-267.64" font-family="Arial" font-size="10.00">All&#45;to&#45;All Comm</text>
</g>
<!-- gate&#45;&gt;token_dist -->
<g id="edge9" class="edge">
<title>gate&#45;&gt;token_dist</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M208,-332.53C208,-324.27 208,-315.27 208,-306.95"/>
<polygon fill="red" stroke="red" points="211.5,-306.89 208,-296.89 204.5,-306.89 211.5,-306.89"/>
</g>
<!-- expert_0 -->
<g id="node10" class="node">
<title>expert_0</title>
<polygon fill="lightgreen" stroke="black" points="393.5,-215.43 314.5,-215.43 314.5,-174.43 393.5,-174.43 393.5,-215.43"/>
<text text-anchor="middle" x="354" y="-203.43" font-family="Arial" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="354" y="-192.43" font-family="Arial" font-size="10.00">GPUs 0,1</text>
<text text-anchor="middle" x="354" y="-181.43" font-family="Arial" font-size="10.00">[tokens, 4096]</text>
</g>
<!-- token_dist&#45;&gt;expert_0 -->
<g id="edge10" class="edge">
<title>token_dist&#45;&gt;expert_0</title>
<path fill="none" stroke="black" d="M264.31,-263.92C278.54,-259.77 293.36,-254.1 306,-246.43 315.98,-240.37 325.25,-231.71 332.93,-223.26"/>
<polygon fill="black" stroke="black" points="335.62,-225.5 339.52,-215.65 330.33,-220.92 335.62,-225.5"/>
</g>
<!-- expert_1 -->
<g id="node11" class="node">
<title>expert_1</title>
<polygon fill="lightgreen" stroke="black" points="296.5,-215.43 217.5,-215.43 217.5,-174.43 296.5,-174.43 296.5,-215.43"/>
<text text-anchor="middle" x="257" y="-203.43" font-family="Arial" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="257" y="-192.43" font-family="Arial" font-size="10.00">GPUs 2,3</text>
<text text-anchor="middle" x="257" y="-181.43" font-family="Arial" font-size="10.00">[tokens, 4096]</text>
</g>
<!-- token_dist&#45;&gt;expert_1 -->
<g id="edge11" class="edge">
<title>token_dist&#45;&gt;expert_1</title>
<path fill="none" stroke="black" d="M220.36,-254.78C226.15,-245.48 233.15,-234.24 239.47,-224.08"/>
<polygon fill="black" stroke="black" points="242.5,-225.85 244.81,-215.51 236.55,-222.15 242.5,-225.85"/>
</g>
<!-- expert_2 -->
<g id="node12" class="node">
<title>expert_2</title>
<polygon fill="lightgreen" stroke="black" points="199.5,-215.43 120.5,-215.43 120.5,-174.43 199.5,-174.43 199.5,-215.43"/>
<text text-anchor="middle" x="160" y="-203.43" font-family="Arial" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="160" y="-192.43" font-family="Arial" font-size="10.00">GPUs 4,5</text>
<text text-anchor="middle" x="160" y="-181.43" font-family="Arial" font-size="10.00">[tokens, 4096]</text>
</g>
<!-- token_dist&#45;&gt;expert_2 -->
<g id="edge12" class="edge">
<title>token_dist&#45;&gt;expert_2</title>
<path fill="none" stroke="black" d="M195.64,-254.37C190.07,-245.23 183.39,-234.28 177.33,-224.35"/>
<polygon fill="black" stroke="black" points="180.18,-222.3 171.99,-215.58 174.21,-225.94 180.18,-222.3"/>
</g>
<!-- expert_3 -->
<g id="node13" class="node">
<title>expert_3</title>
<polygon fill="lightgreen" stroke="black" points="102.5,-215.43 23.5,-215.43 23.5,-174.43 102.5,-174.43 102.5,-215.43"/>
<text text-anchor="middle" x="63" y="-203.43" font-family="Arial" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="63" y="-192.43" font-family="Arial" font-size="10.00">GPUs 6,7</text>
<text text-anchor="middle" x="63" y="-181.43" font-family="Arial" font-size="10.00">[tokens, 4096]</text>
</g>
<!-- token_dist&#45;&gt;expert_3 -->
<g id="edge13" class="edge">
<title>token_dist&#45;&gt;expert_3</title>
<path fill="none" stroke="black" d="M152.64,-263.61C138.77,-259.46 124.34,-253.88 112,-246.43 101.91,-240.34 92.47,-231.66 84.62,-223.22"/>
<polygon fill="black" stroke="black" points="87.13,-220.78 77.88,-215.61 81.89,-225.42 87.13,-220.78"/>
</g>
<!-- expert_agg -->
<g id="node14" class="node">
<title>expert_agg</title>
<polygon fill="yellow" stroke="black" points="310.78,-138.43 147.28,-138.43 105.22,-78.43 268.72,-78.43 310.78,-138.43"/>
<text text-anchor="middle" x="208" y="-111.43" font-family="Arial" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="208" y="-100.43" font-family="Arial" font-size="10.00">[128, 10000, 4096]</text>
</g>
<!-- expert_0&#45;&gt;expert_agg -->
<g id="edge14" class="edge">
<title>expert_0&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M320.14,-174.33C304.36,-165.19 285.11,-154.06 267.05,-143.6"/>
<polygon fill="black" stroke="black" points="268.7,-140.52 258.3,-138.54 265.2,-146.57 268.7,-140.52"/>
</g>
<!-- expert_1&#45;&gt;expert_agg -->
<g id="edge15" class="edge">
<title>expert_1&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M245.64,-174.33C240.96,-166.27 235.39,-156.66 229.98,-147.33"/>
<polygon fill="black" stroke="black" points="232.92,-145.43 224.88,-138.54 226.87,-148.94 232.92,-145.43"/>
</g>
<!-- expert_2&#45;&gt;expert_agg -->
<g id="edge16" class="edge">
<title>expert_2&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M171.13,-174.33C175.71,-166.27 181.17,-156.66 186.47,-147.33"/>
<polygon fill="black" stroke="black" points="189.57,-148.96 191.46,-138.54 183.48,-145.5 189.57,-148.96"/>
</g>
<!-- expert_3&#45;&gt;expert_agg -->
<g id="edge17" class="edge">
<title>expert_3&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M96.63,-174.33C112.3,-165.19 131.42,-154.06 149.36,-143.6"/>
<polygon fill="black" stroke="black" points="151.17,-146.6 158.05,-138.54 147.65,-140.55 151.17,-146.6"/>
</g>
<!-- output -->
<g id="node15" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="208" cy="-21.21" rx="72.66" ry="21.43"/>
<text text-anchor="middle" x="208" y="-24.21" font-family="Arial" font-size="10.00">Model Output</text>
<text text-anchor="middle" x="208" y="-13.21" font-family="Arial" font-size="10.00">[128, 10000, 51200]</text>
</g>
<!-- expert_agg&#45;&gt;output -->
<g id="edge18" class="edge">
<title>expert_agg&#45;&gt;output</title>
<path fill="none" stroke="black" d="M208,-78.1C208,-69.84 208,-60.84 208,-52.53"/>
<polygon fill="black" stroke="black" points="211.5,-52.46 208,-42.46 204.5,-52.46 211.5,-52.46"/>
</g>
</g>
</svg>
