<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Llama3_405B_Context_Parallel Pages: 1 -->
<svg width="2956pt" height="1919pt"
 viewBox="0.00 0.00 2956.34 1919.05" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1915.05)">
<title>Llama3_405B_Context_Parallel</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1915.05 2952.34,-1915.05 2952.34,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_layer_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="725.5,-498.95 725.5,-1644.88 2879.5,-1644.88 2879.5,-498.95 725.5,-498.95"/>
<text text-anchor="middle" x="1802.5" y="-1629.68" font-family="Times,serif" font-size="14.00">Layer 1 (CP16 + TP8)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_node_0_layer_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="969.5,-506.95 969.5,-1606.38 2871.5,-1606.38 2871.5,-506.95 969.5,-506.95"/>
<text text-anchor="middle" x="1920.5" y="-1591.18" font-family="Times,serif" font-size="14.00">Node 0 (CP Rank 0)</text>
<text text-anchor="middle" x="1920.5" y="-1576.18" font-family="Times,serif" font-size="14.00">GPUs 0&#45;7, Sequence: 62500 tokens</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_node_1_layer_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="733.5,-1491.88 733.5,-1613.88 961.5,-1613.88 961.5,-1491.88 733.5,-1491.88"/>
<text text-anchor="middle" x="847.5" y="-1598.68" font-family="Times,serif" font-size="14.00">Node 1 (CP Rank 1)</text>
<text text-anchor="middle" x="847.5" y="-1583.68" font-family="Times,serif" font-size="14.00">...</text>
<text text-anchor="middle" x="847.5" y="-1568.68" font-family="Times,serif" font-size="14.00">Nodes 2&#45;15 similar</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightgreen" stroke="black" points="2184.26,-1911.05 1471.98,-1911.05 1288.75,-1805.05 2001.03,-1805.05 2184.26,-1911.05"/>
<text text-anchor="middle" x="1736.5" y="-1869.35" font-family="Times,serif" font-size="14.00">Model Input</text>
<text text-anchor="middle" x="1736.5" y="-1854.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, d_model=16384]</text>
<text text-anchor="middle" x="1736.5" y="-1839.35" font-family="Times,serif" font-size="14.00">Total tokens: 1M</text>
</g>
<!-- shard_tokens -->
<g id="node2" class="node">
<title>shard_tokens</title>
<ellipse fill="lightyellow" stroke="black" cx="1736.5" cy="-1719.97" rx="325.95" ry="48.17"/>
<text text-anchor="middle" x="1736.5" y="-1738.77" font-family="Times,serif" font-size="14.00">Context Shard</text>
<text text-anchor="middle" x="1736.5" y="-1723.77" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, d_model=16384]</text>
<text text-anchor="middle" x="1736.5" y="-1708.77" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, d_model=16384] x 16</text>
<text text-anchor="middle" x="1736.5" y="-1693.77" font-family="Times,serif" font-size="14.00">Operation: Double&#45;chunk load balancing</text>
</g>
<!-- input&#45;&gt;shard_tokens -->
<g id="edge1" class="edge">
<title>input&#45;&gt;shard_tokens</title>
<path fill="none" stroke="black" d="M1736.5,-1804.83C1736.5,-1796.21 1736.5,-1787.23 1736.5,-1778.49"/>
<polygon fill="black" stroke="black" points="1740,-1778.37 1736.5,-1768.37 1733,-1778.37 1740,-1778.37"/>
</g>
<!-- init_kv -->
<g id="node3" class="node">
<title>init_kv</title>
<ellipse fill="lightcoral" stroke="black" cx="358.5" cy="-1526.38" rx="358.51" ry="37.45"/>
<text text-anchor="middle" x="358.5" y="-1537.68" font-family="Times,serif" font-size="14.00">Initialize KV Cache</text>
<text text-anchor="middle" x="358.5" y="-1522.68" font-family="Times,serif" font-size="14.00">Total: [batch_size=1, seq_len=1000000, kv_heads=8, d_head=128]</text>
<text text-anchor="middle" x="358.5" y="-1507.68" font-family="Times,serif" font-size="14.00">Per node: [batch_size=1, seq_len=62500, kv_heads=8, d_head=128]</text>
</g>
<!-- shard_tokens&#45;&gt;init_kv -->
<g id="edge2" class="edge">
<title>shard_tokens&#45;&gt;init_kv</title>
<path fill="none" stroke="black" d="M1412.56,-1714.28C1213.91,-1706.69 955.22,-1688.31 729.5,-1644.88 635.85,-1626.86 532.67,-1592.99 458.95,-1566.23"/>
<polygon fill="black" stroke="black" points="459.8,-1562.81 449.21,-1562.67 457.4,-1569.38 459.8,-1562.81"/>
</g>
<!-- q_proj_0_1 -->
<g id="node4" class="node">
<title>q_proj_0_1</title>
<polygon fill="lightblue" stroke="black" points="2168,-1448.43 1679,-1448.43 1679,-1380.43 2168,-1380.43 2168,-1448.43"/>
<text text-anchor="middle" x="1923.5" y="-1433.23" font-family="Times,serif" font-size="14.00">Query Projection</text>
<text text-anchor="middle" x="1923.5" y="-1418.23" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, d_model=16384]</text>
<text text-anchor="middle" x="1923.5" y="-1403.23" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, heads=128, d_head=128]</text>
<text text-anchor="middle" x="1923.5" y="-1388.23" font-family="Times,serif" font-size="14.00">GPU: node_0.gpu_0&#45;7</text>
</g>
<!-- shard_tokens&#45;&gt;q_proj_0_1 -->
<g id="edge3" class="edge">
<title>shard_tokens&#45;&gt;q_proj_0_1</title>
<path fill="none" stroke="black" d="M1925.1,-1680.62C1956.49,-1670.53 1982.22,-1658.57 1992.5,-1644.88 2034.16,-1589.47 2018.02,-1553.36 1992.5,-1488.91 1987.78,-1476.97 1980.09,-1465.83 1971.53,-1456.03"/>
<polygon fill="black" stroke="black" points="1973.88,-1453.41 1964.51,-1448.46 1968.74,-1458.17 1973.88,-1453.41"/>
</g>
<!-- k_proj_0_1 -->
<g id="node5" class="node">
<title>k_proj_0_1</title>
<polygon fill="lightblue" stroke="black" points="1471.5,-1560.38 977.5,-1560.38 977.5,-1492.38 1471.5,-1492.38 1471.5,-1560.38"/>
<text text-anchor="middle" x="1224.5" y="-1545.18" font-family="Times,serif" font-size="14.00">Key Projection</text>
<text text-anchor="middle" x="1224.5" y="-1530.18" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, d_model=16384]</text>
<text text-anchor="middle" x="1224.5" y="-1515.18" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, kv_heads=8, d_head=128]</text>
<text text-anchor="middle" x="1224.5" y="-1500.18" font-family="Times,serif" font-size="14.00">GPU: node_0.gpu_0&#45;7</text>
</g>
<!-- shard_tokens&#45;&gt;k_proj_0_1 -->
<g id="edge4" class="edge">
<title>shard_tokens&#45;&gt;k_proj_0_1</title>
<path fill="none" stroke="black" d="M1579.95,-1677.67C1546.82,-1667.81 1512.27,-1656.7 1480.5,-1644.88 1417.83,-1621.58 1349.07,-1589.65 1298.61,-1564.95"/>
<polygon fill="black" stroke="black" points="1299.92,-1561.7 1289.4,-1560.43 1296.83,-1567.98 1299.92,-1561.7"/>
</g>
<!-- v_proj_0_1 -->
<g id="node6" class="node">
<title>v_proj_0_1</title>
<polygon fill="lightblue" stroke="black" points="1983.5,-1560.38 1489.5,-1560.38 1489.5,-1492.38 1983.5,-1492.38 1983.5,-1560.38"/>
<text text-anchor="middle" x="1736.5" y="-1545.18" font-family="Times,serif" font-size="14.00">Value Projection</text>
<text text-anchor="middle" x="1736.5" y="-1530.18" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, d_model=16384]</text>
<text text-anchor="middle" x="1736.5" y="-1515.18" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, kv_heads=8, d_head=128]</text>
<text text-anchor="middle" x="1736.5" y="-1500.18" font-family="Times,serif" font-size="14.00">GPU: node_0.gpu_0&#45;7</text>
</g>
<!-- shard_tokens&#45;&gt;v_proj_0_1 -->
<g id="edge5" class="edge">
<title>shard_tokens&#45;&gt;v_proj_0_1</title>
<path fill="none" stroke="black" d="M1736.5,-1671.61C1736.5,-1640.68 1736.5,-1600.62 1736.5,-1570.57"/>
<polygon fill="black" stroke="black" points="1740,-1570.39 1736.5,-1560.39 1733,-1570.39 1740,-1570.39"/>
</g>
<!-- residual_add_0_1 -->
<g id="node12" class="node">
<title>residual_add_0_1</title>
<polygon fill="purple" stroke="black" points="2569.5,-1114.95 2129.5,-1114.95 2129.5,-1061.95 2569.5,-1061.95 2569.5,-1114.95"/>
<text text-anchor="middle" x="2349.5" y="-1099.75" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="2349.5" y="-1084.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, d_model=16384] x 2</text>
<text text-anchor="middle" x="2349.5" y="-1069.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, d_model=16384]</text>
</g>
<!-- shard_tokens&#45;&gt;residual_add_0_1 -->
<g id="edge14" class="edge">
<title>shard_tokens&#45;&gt;residual_add_0_1</title>
<path fill="none" stroke="black" d="M2029.08,-1698.76C2371.25,-1671.1 2891.5,-1614.69 2891.5,-1527.38 2891.5,-1527.38 2891.5,-1527.38 2891.5,-1184.95 2891.5,-1151.3 2727.34,-1125.76 2579.71,-1109.6"/>
<polygon fill="black" stroke="black" points="2579.88,-1106.1 2569.56,-1108.5 2579.13,-1113.06 2579.88,-1106.1"/>
</g>
<!-- attention_0_1 -->
<g id="node10" class="node">
<title>attention_0_1</title>
<polygon fill="orange" stroke="black" points="2239.5,-1339.95 1703.5,-1339.95 1703.5,-1256.95 2239.5,-1256.95 2239.5,-1339.95"/>
<text text-anchor="middle" x="1971.5" y="-1324.75" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1971.5" y="-1309.75" font-family="Times,serif" font-size="14.00">Local Q: [batch_size=1, seq_len=62500, heads=128, d_head=128]</text>
<text text-anchor="middle" x="1971.5" y="-1294.75" font-family="Times,serif" font-size="14.00">Global K/V: [batch_size=1, seq_len=1000000, kv_heads=8, d_head=128]</text>
<text text-anchor="middle" x="1971.5" y="-1279.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, heads=128, d_head=128]</text>
<text text-anchor="middle" x="1971.5" y="-1264.75" font-family="Times,serif" font-size="14.00">GPU: node_0.gpu_0&#45;7</text>
</g>
<!-- q_proj_0_1&#45;&gt;attention_0_1 -->
<g id="edge10" class="edge">
<title>q_proj_0_1&#45;&gt;attention_0_1</title>
<path fill="none" stroke="black" d="M1937.52,-1380.16C1941.54,-1370.6 1946.02,-1359.96 1950.38,-1349.62"/>
<polygon fill="black" stroke="black" points="1953.67,-1350.83 1954.32,-1340.25 1947.21,-1348.11 1953.67,-1350.83"/>
</g>
<!-- kv_store_0_1 -->
<g id="node7" class="node">
<title>kv_store_0_1</title>
<ellipse fill="lightcoral" stroke="black" cx="1319.5" cy="-1414.43" rx="341.57" ry="37.45"/>
<text text-anchor="middle" x="1319.5" y="-1425.73" font-family="Times,serif" font-size="14.00">KV Cache Store</text>
<text text-anchor="middle" x="1319.5" y="-1410.73" font-family="Times,serif" font-size="14.00">Store: [batch_size=1, seq_len=62500, kv_heads=8, d_head=128]</text>
<text text-anchor="middle" x="1319.5" y="-1395.73" font-family="Times,serif" font-size="14.00">GPU: node_0.gpu_0&#45;7</text>
</g>
<!-- k_proj_0_1&#45;&gt;kv_store_0_1 -->
<g id="edge6" class="edge">
<title>k_proj_0_1&#45;&gt;kv_store_0_1</title>
<path fill="none" stroke="black" d="M1253.26,-1492.1C1262.05,-1481.92 1271.86,-1470.57 1281.18,-1459.79"/>
<polygon fill="black" stroke="black" points="1283.97,-1461.91 1287.86,-1452.06 1278.67,-1457.34 1283.97,-1461.91"/>
</g>
<!-- v_proj_0_1&#45;&gt;kv_store_0_1 -->
<g id="edge7" class="edge">
<title>v_proj_0_1&#45;&gt;kv_store_0_1</title>
<path fill="none" stroke="black" d="M1611.11,-1492.32C1562.65,-1479.54 1507.03,-1464.88 1457.45,-1451.8"/>
<polygon fill="black" stroke="black" points="1458.17,-1448.37 1447.61,-1449.21 1456.39,-1455.14 1458.17,-1448.37"/>
</g>
<!-- kv_send_0_1 -->
<g id="node8" class="node">
<title>kv_send_0_1</title>
<ellipse fill="gray" stroke="black" cx="1319.5" cy="-1298.45" rx="339.32" ry="37.45"/>
<text text-anchor="middle" x="1319.5" y="-1309.75" font-family="Times,serif" font-size="14.00">KV Ring Send</text>
<text text-anchor="middle" x="1319.5" y="-1294.75" font-family="Times,serif" font-size="14.00">Send: [batch_size=1, seq_len=62500, kv_heads=8, d_head=128]</text>
<text text-anchor="middle" x="1319.5" y="-1279.75" font-family="Times,serif" font-size="14.00">Network: node_0&#45;&gt;node_1</text>
</g>
<!-- kv_store_0_1&#45;&gt;kv_send_0_1 -->
<g id="edge8" class="edge">
<title>kv_store_0_1&#45;&gt;kv_send_0_1</title>
<path fill="none" stroke="black" d="M1319.5,-1376.74C1319.5,-1366.98 1319.5,-1356.3 1319.5,-1346.09"/>
<polygon fill="black" stroke="black" points="1323,-1346.07 1319.5,-1336.07 1316,-1346.07 1323,-1346.07"/>
</g>
<!-- kv_store_0_1&#45;&gt;attention_0_1 -->
<g id="edge11" class="edge">
<title>kv_store_0_1&#45;&gt;attention_0_1</title>
<path fill="none" stroke="black" d="M1497.23,-1382.36C1568.92,-1369.83 1652.76,-1355.17 1729.85,-1341.7"/>
<polygon fill="black" stroke="black" points="1730.45,-1345.14 1739.7,-1339.97 1729.25,-1338.25 1730.45,-1345.14"/>
</g>
<!-- kv_recv_15_1 -->
<g id="node9" class="node">
<title>kv_recv_15_1</title>
<ellipse fill="gray" stroke="black" cx="2524.5" cy="-1414.43" rx="338.91" ry="37.45"/>
<text text-anchor="middle" x="2524.5" y="-1425.73" font-family="Times,serif" font-size="14.00">KV Ring Recv</text>
<text text-anchor="middle" x="2524.5" y="-1410.73" font-family="Times,serif" font-size="14.00">Recv: [batch_size=1, seq_len=62500, kv_heads=8, d_head=128]</text>
<text text-anchor="middle" x="2524.5" y="-1395.73" font-family="Times,serif" font-size="14.00">Network: node_15&#45;&gt;node_0</text>
</g>
<!-- kv_recv_15_1&#45;&gt;attention_0_1 -->
<g id="edge9" class="edge">
<title>kv_recv_15_1&#45;&gt;attention_0_1</title>
<path fill="none" stroke="black" d="M2367.88,-1381.15C2308.92,-1369 2240.94,-1354.99 2178.12,-1342.04"/>
<polygon fill="black" stroke="black" points="2178.58,-1338.56 2168.08,-1339.97 2177.17,-1345.42 2178.58,-1338.56"/>
</g>
<!-- o_proj_0_1 -->
<g id="node11" class="node">
<title>o_proj_0_1</title>
<polygon fill="lightblue" stroke="black" points="2487,-1219.95 2010,-1219.95 2010,-1151.95 2487,-1151.95 2487,-1219.95"/>
<text text-anchor="middle" x="2248.5" y="-1204.75" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="2248.5" y="-1189.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, heads=128, d_head=128]</text>
<text text-anchor="middle" x="2248.5" y="-1174.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, d_model=16384]</text>
<text text-anchor="middle" x="2248.5" y="-1159.75" font-family="Times,serif" font-size="14.00">GPU: node_0.gpu_0&#45;7</text>
</g>
<!-- attention_0_1&#45;&gt;o_proj_0_1 -->
<g id="edge12" class="edge">
<title>attention_0_1&#45;&gt;o_proj_0_1</title>
<path fill="none" stroke="black" d="M2073.07,-1256.93C2100.28,-1246.08 2129.55,-1234.41 2156.22,-1223.77"/>
<polygon fill="black" stroke="black" points="2157.55,-1227 2165.54,-1220.05 2154.96,-1220.5 2157.55,-1227"/>
</g>
<!-- o_proj_0_1&#45;&gt;residual_add_0_1 -->
<g id="edge13" class="edge">
<title>o_proj_0_1&#45;&gt;residual_add_0_1</title>
<path fill="none" stroke="black" d="M2283.54,-1151.82C2293.71,-1142.2 2304.81,-1131.71 2314.95,-1122.12"/>
<polygon fill="black" stroke="black" points="2317.63,-1124.41 2322.49,-1115 2312.82,-1119.33 2317.63,-1124.41"/>
</g>
<!-- gate_proj_0_1 -->
<g id="node13" class="node">
<title>gate_proj_0_1</title>
<polygon fill="lightblue" stroke="black" points="2559,-1024.95 2140,-1024.95 2140,-956.95 2559,-956.95 2559,-1024.95"/>
<text text-anchor="middle" x="2349.5" y="-1009.75" font-family="Times,serif" font-size="14.00">Gate Projection</text>
<text text-anchor="middle" x="2349.5" y="-994.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, d_model=16384]</text>
<text text-anchor="middle" x="2349.5" y="-979.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, ffn_dim=53248]</text>
<text text-anchor="middle" x="2349.5" y="-964.75" font-family="Times,serif" font-size="14.00">GPU: node_0.gpu_0&#45;7</text>
</g>
<!-- residual_add_0_1&#45;&gt;gate_proj_0_1 -->
<g id="edge15" class="edge">
<title>residual_add_0_1&#45;&gt;gate_proj_0_1</title>
<path fill="none" stroke="black" d="M2349.5,-1061.86C2349.5,-1053.67 2349.5,-1044.37 2349.5,-1035.28"/>
<polygon fill="black" stroke="black" points="2353,-1035.17 2349.5,-1025.17 2346,-1035.17 2353,-1035.17"/>
</g>
<!-- up_proj_0_1 -->
<g id="node14" class="node">
<title>up_proj_0_1</title>
<polygon fill="lightblue" stroke="black" points="2331,-938.95 1912,-938.95 1912,-870.95 2331,-870.95 2331,-938.95"/>
<text text-anchor="middle" x="2121.5" y="-923.75" font-family="Times,serif" font-size="14.00">Up Projection</text>
<text text-anchor="middle" x="2121.5" y="-908.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, d_model=16384]</text>
<text text-anchor="middle" x="2121.5" y="-893.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, ffn_dim=53248]</text>
<text text-anchor="middle" x="2121.5" y="-878.75" font-family="Times,serif" font-size="14.00">GPU: node_0.gpu_0&#45;7</text>
</g>
<!-- residual_add_0_1&#45;&gt;up_proj_0_1 -->
<g id="edge16" class="edge">
<title>residual_add_0_1&#45;&gt;up_proj_0_1</title>
<path fill="none" stroke="black" d="M2214.83,-1061.92C2177.33,-1052.06 2143.53,-1039.59 2131.5,-1024.95 2114.46,-1004.21 2112.1,-974 2113.93,-949.21"/>
<polygon fill="black" stroke="black" points="2117.44,-949.26 2114.94,-938.96 2110.48,-948.57 2117.44,-949.26"/>
</g>
<!-- mlp_residual_0_1 -->
<g id="node18" class="node">
<title>mlp_residual_0_1</title>
<polygon fill="purple" stroke="black" points="2693.5,-567.95 2253.5,-567.95 2253.5,-514.95 2693.5,-514.95 2693.5,-567.95"/>
<text text-anchor="middle" x="2473.5" y="-552.75" font-family="Times,serif" font-size="14.00">MLP Residual Add</text>
<text text-anchor="middle" x="2473.5" y="-537.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, d_model=16384] x 2</text>
<text text-anchor="middle" x="2473.5" y="-522.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, d_model=16384]</text>
</g>
<!-- residual_add_0_1&#45;&gt;mlp_residual_0_1 -->
<g id="edge22" class="edge">
<title>residual_add_0_1&#45;&gt;mlp_residual_0_1</title>
<path fill="none" stroke="black" d="M2526.62,-1061.84C2556.2,-1047.51 2577.5,-1025.53 2577.5,-991.95 2577.5,-991.95 2577.5,-991.95 2577.5,-637.95 2577.5,-610.89 2558.16,-589.41 2536.16,-573.73"/>
<polygon fill="black" stroke="black" points="2537.89,-570.67 2527.64,-568 2533.99,-576.48 2537.89,-570.67"/>
</g>
<!-- silu_0_1 -->
<g id="node15" class="node">
<title>silu_0_1</title>
<polygon fill="yellow" stroke="black" points="2559,-852.95 2140,-852.95 2140,-799.95 2559,-799.95 2559,-852.95"/>
<text text-anchor="middle" x="2349.5" y="-837.75" font-family="Times,serif" font-size="14.00">SiLU Activation</text>
<text text-anchor="middle" x="2349.5" y="-822.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, ffn_dim=53248]</text>
<text text-anchor="middle" x="2349.5" y="-807.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, ffn_dim=53248]</text>
</g>
<!-- gate_proj_0_1&#45;&gt;silu_0_1 -->
<g id="edge17" class="edge">
<title>gate_proj_0_1&#45;&gt;silu_0_1</title>
<path fill="none" stroke="black" d="M2349.5,-956.68C2349.5,-929.42 2349.5,-890.95 2349.5,-863.08"/>
<polygon fill="black" stroke="black" points="2353,-862.96 2349.5,-852.96 2346,-862.96 2353,-862.96"/>
</g>
<!-- elem_mul_0_1 -->
<g id="node16" class="node">
<title>elem_mul_0_1</title>
<polygon fill="yellow" stroke="black" points="2558.5,-762.95 2124.5,-762.95 2124.5,-709.95 2558.5,-709.95 2558.5,-762.95"/>
<text text-anchor="middle" x="2341.5" y="-747.75" font-family="Times,serif" font-size="14.00">Element&#45;wise Multiply</text>
<text text-anchor="middle" x="2341.5" y="-732.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, ffn_dim=53248] x 2</text>
<text text-anchor="middle" x="2341.5" y="-717.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, ffn_dim=53248]</text>
</g>
<!-- up_proj_0_1&#45;&gt;elem_mul_0_1 -->
<g id="edge18" class="edge">
<title>up_proj_0_1&#45;&gt;elem_mul_0_1</title>
<path fill="none" stroke="black" d="M2115.82,-870.84C2113.91,-848.41 2115.48,-819.42 2131.5,-799.95 2142.47,-786.63 2156.14,-776.07 2171.21,-767.71"/>
<polygon fill="black" stroke="black" points="2172.96,-770.74 2180.23,-763.04 2169.74,-764.53 2172.96,-770.74"/>
</g>
<!-- silu_0_1&#45;&gt;elem_mul_0_1 -->
<g id="edge19" class="edge">
<title>silu_0_1&#45;&gt;elem_mul_0_1</title>
<path fill="none" stroke="black" d="M2347.15,-799.53C2346.4,-791.29 2345.56,-782.03 2344.76,-773.23"/>
<polygon fill="black" stroke="black" points="2348.23,-772.84 2343.84,-763.19 2341.26,-773.47 2348.23,-772.84"/>
</g>
<!-- down_proj_0_1 -->
<g id="node17" class="node">
<title>down_proj_0_1</title>
<polygon fill="lightblue" stroke="black" points="2556.5,-672.95 2130.5,-672.95 2130.5,-604.95 2556.5,-604.95 2556.5,-672.95"/>
<text text-anchor="middle" x="2343.5" y="-657.75" font-family="Times,serif" font-size="14.00">Down Projection</text>
<text text-anchor="middle" x="2343.5" y="-642.75" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, ffn_dim=53248]</text>
<text text-anchor="middle" x="2343.5" y="-627.75" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=62500, d_model=16384]</text>
<text text-anchor="middle" x="2343.5" y="-612.75" font-family="Times,serif" font-size="14.00">GPU: node_0.gpu_0&#45;7</text>
</g>
<!-- elem_mul_0_1&#45;&gt;down_proj_0_1 -->
<g id="edge20" class="edge">
<title>elem_mul_0_1&#45;&gt;down_proj_0_1</title>
<path fill="none" stroke="black" d="M2342.04,-709.86C2342.21,-701.67 2342.41,-692.37 2342.6,-683.28"/>
<polygon fill="black" stroke="black" points="2346.1,-683.25 2342.81,-673.17 2339.1,-683.1 2346.1,-683.25"/>
</g>
<!-- down_proj_0_1&#45;&gt;mlp_residual_0_1 -->
<g id="edge21" class="edge">
<title>down_proj_0_1&#45;&gt;mlp_residual_0_1</title>
<path fill="none" stroke="black" d="M2388.61,-604.82C2402.21,-594.83 2417.1,-583.89 2430.56,-574"/>
<polygon fill="black" stroke="black" points="2432.74,-576.74 2438.73,-568 2428.6,-571.1 2432.74,-576.74"/>
</g>
<!-- layer_126 -->
<!-- mlp_residual_0_1&#45;&gt;layer_126 -->
<g id="edge23" class="edge">
<title>mlp_residual_0_1&#45;&gt;layer_126</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2473.5,-514.86C2473.5,-500.97 2473.5,-483.58 2473.5,-468.36"/>
<polygon fill="black" stroke="black" points="2477,-468.24 2473.5,-458.24 2470,-468.24 2477,-468.24"/>
<text text-anchor="middle" x="2529.5" y="-479.75" font-family="Times,serif" font-size="14.00">... 124 layers ...</text>
</g>
<!-- node_1_processing -->
<g id="node19" class="node">
<title>node_1_processing</title>
<polygon fill="none" stroke="black" stroke-dasharray="1,5" points="953.5,-1552.88 741.5,-1552.88 741.5,-1499.88 953.5,-1499.88 953.5,-1552.88"/>
<text text-anchor="middle" x="847.5" y="-1537.68" font-family="Times,serif" font-size="14.00">Node 1 Layer 1</text>
<text text-anchor="middle" x="847.5" y="-1522.68" font-family="Times,serif" font-size="14.00">Same operations as Node 0</text>
<text text-anchor="middle" x="847.5" y="-1507.68" font-family="Times,serif" font-size="14.00">Sequence: 62500 tokens</text>
</g>
<!-- gather_tokens -->
<g id="node20" class="node">
<title>gather_tokens</title>
<ellipse fill="gray" stroke="black" cx="2519.5" cy="-1858.05" rx="317.48" ry="48.17"/>
<text text-anchor="middle" x="2519.5" y="-1876.85" font-family="Times,serif" font-size="14.00">Gather Cross&#45;Shard Results</text>
<text text-anchor="middle" x="2519.5" y="-1861.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, d_model=16384] x 16</text>
<text text-anchor="middle" x="2519.5" y="-1846.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, d_model=16384]</text>
<text text-anchor="middle" x="2519.5" y="-1831.85" font-family="Times,serif" font-size="14.00">Operation: All&#45;gather across CP ranks</text>
</g>
<!-- final_gather -->
<g id="node22" class="node">
<title>final_gather</title>
<ellipse fill="gray" stroke="black" cx="2473.5" cy="-330.48" rx="317.48" ry="37.45"/>
<text text-anchor="middle" x="2473.5" y="-341.78" font-family="Times,serif" font-size="14.00">Final Token Aggregation</text>
<text text-anchor="middle" x="2473.5" y="-326.78" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=62500, d_model=16384] x 16</text>
<text text-anchor="middle" x="2473.5" y="-311.78" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, d_model=16384]</text>
</g>
<!-- layer_126&#45;&gt;final_gather -->
<g id="edge24" class="edge">
<title>layer_126&#45;&gt;final_gather</title>
<path fill="none" stroke="black" d="M2473.5,-404.71C2473.5,-396.63 2473.5,-387.45 2473.5,-378.39"/>
<polygon fill="black" stroke="black" points="2477,-378.27 2473.5,-368.27 2470,-378.27 2477,-378.27"/>
</g>
<!-- final_layer_norm -->
<g id="node23" class="node">
<title>final_layer_norm</title>
<polygon fill="pink" stroke="black" points="2695.5,-256 2251.5,-256 2251.5,-203 2695.5,-203 2695.5,-256"/>
<text text-anchor="middle" x="2473.5" y="-240.8" font-family="Times,serif" font-size="14.00">Final LayerNorm</text>
<text text-anchor="middle" x="2473.5" y="-225.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, d_model=16384]</text>
<text text-anchor="middle" x="2473.5" y="-210.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, d_model=16384]</text>
</g>
<!-- final_gather&#45;&gt;final_layer_norm -->
<g id="edge25" class="edge">
<title>final_gather&#45;&gt;final_layer_norm</title>
<path fill="none" stroke="black" d="M2473.5,-292.9C2473.5,-284.21 2473.5,-274.95 2473.5,-266.29"/>
<polygon fill="black" stroke="black" points="2477,-266.11 2473.5,-256.11 2470,-266.11 2477,-266.11"/>
</g>
<!-- output_projection -->
<g id="node24" class="node">
<title>output_projection</title>
<polygon fill="lightblue" stroke="black" points="2708.5,-166 2238.5,-166 2238.5,-113 2708.5,-113 2708.5,-166"/>
<text text-anchor="middle" x="2473.5" y="-150.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="2473.5" y="-135.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, d_model=16384]</text>
<text text-anchor="middle" x="2473.5" y="-120.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, vocab_size=128256]</text>
</g>
<!-- final_layer_norm&#45;&gt;output_projection -->
<g id="edge26" class="edge">
<title>final_layer_norm&#45;&gt;output_projection</title>
<path fill="none" stroke="black" d="M2473.5,-202.57C2473.5,-194.34 2473.5,-185.08 2473.5,-176.28"/>
<polygon fill="black" stroke="black" points="2477,-176.24 2473.5,-166.24 2470,-176.24 2477,-176.24"/>
</g>
<!-- output -->
<g id="node25" class="node">
<title>output</title>
<polygon fill="lightgreen" stroke="black" points="2948.17,-76 2193.08,-76 1998.84,0 2753.92,0 2948.17,-76"/>
<text text-anchor="middle" x="2473.5" y="-41.8" font-family="Times,serif" font-size="14.00">Model Output</text>
<text text-anchor="middle" x="2473.5" y="-26.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, vocab_size=128256]</text>
</g>
<!-- output_projection&#45;&gt;output -->
<g id="edge27" class="edge">
<title>output_projection&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2473.5,-112.88C2473.5,-104.76 2473.5,-95.51 2473.5,-86.37"/>
<polygon fill="black" stroke="black" points="2477,-86.17 2473.5,-76.17 2470,-86.17 2477,-86.17"/>
</g>
</g>
</svg>
