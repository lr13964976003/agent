<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: baseline_moe_dag Pages: 1 -->
<svg width="712pt" height="1905pt"
 viewBox="0.00 0.00 712.00 1904.93" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1900.93)">
<title>baseline_moe_dag</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1900.93 708,-1900.93 708,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<polygon fill="none" stroke="blue" stroke-dasharray="5,2" points="8,-971.97 8,-1797.95 568,-1797.95 568,-971.97 8,-971.97"/>
<text text-anchor="middle" x="288" y="-1782.75" font-family="Times,serif" font-size="14.00">Pipeline Stage 0 (Layers 0&#45;7)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer0</title>
<path fill="none" stroke="black" d="M28,-979.97C28,-979.97 548,-979.97 548,-979.97 554,-979.97 560,-985.97 560,-991.97 560,-991.97 560,-1669.97 560,-1669.97 560,-1675.97 554,-1681.97 548,-1681.97 548,-1681.97 28,-1681.97 28,-1681.97 22,-1681.97 16,-1675.97 16,-1669.97 16,-1669.97 16,-991.97 16,-991.97 16,-985.97 22,-979.97 28,-979.97"/>
<text text-anchor="middle" x="288" y="-1666.77" font-family="Times,serif" font-size="14.00">Layer 0</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_stage1</title>
<polygon fill="none" stroke="red" stroke-dasharray="5,2" points="75,-84.98 75,-910.97 635,-910.97 635,-84.98 75,-84.98"/>
<text text-anchor="middle" x="355" y="-895.77" font-family="Times,serif" font-size="14.00">Pipeline Stage 1 (Layers 8&#45;15)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_layer8</title>
<path fill="none" stroke="black" d="M95,-92.98C95,-92.98 615,-92.98 615,-92.98 621,-92.98 627,-98.98 627,-104.98 627,-104.98 627,-782.98 627,-782.98 627,-788.98 621,-794.98 615,-794.98 615,-794.98 95,-794.98 95,-794.98 89,-794.98 83,-788.98 83,-782.98 83,-782.98 83,-104.98 83,-104.98 83,-98.98 89,-92.98 95,-92.98"/>
<text text-anchor="middle" x="355" y="-779.78" font-family="Times,serif" font-size="14.00">Layer 8</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="317" cy="-1867.94" rx="212.68" ry="28.98"/>
<text text-anchor="middle" x="317" y="-1876.44" font-family="Times,serif" font-size="10.00">Input</text>
<text text-anchor="middle" x="317" y="-1865.44" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden=4096]</text>
<text text-anchor="middle" x="317" y="-1854.44" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden=4096]</text>
</g>
<!-- stage0_input -->
<g id="node2" class="node">
<title>stage0_input</title>
<ellipse fill="lightyellow" stroke="black" cx="317" cy="-1737.96" rx="212.68" ry="28.98"/>
<text text-anchor="middle" x="317" y="-1746.46" font-family="Times,serif" font-size="10.00">Stage0 Input</text>
<text text-anchor="middle" x="317" y="-1735.46" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden=4096]</text>
<text text-anchor="middle" x="317" y="-1724.46" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden=4096]</text>
</g>
<!-- input&#45;&gt;stage0_input -->
<g id="edge1" class="edge">
<title>input&#45;&gt;stage0_input</title>
<path fill="none" stroke="black" d="M317,-1838.77C317,-1838.77 317,-1777.03 317,-1777.03"/>
<polygon fill="black" stroke="black" points="320.5,-1777.03 317,-1767.03 313.5,-1777.03 320.5,-1777.03"/>
<text text-anchor="middle" x="359.5" y="-1809.75" font-family="Times,serif" font-size="14.00">Initial Input</text>
</g>
<!-- layer0_mha_qkv -->
<g id="node3" class="node">
<title>layer0_mha_qkv</title>
<polygon fill="lightgreen" stroke="black" points="326.5,-1650.97 101.5,-1650.97 101.5,-1587.97 326.5,-1587.97 326.5,-1650.97"/>
<text text-anchor="middle" x="214" y="-1638.97" font-family="Times,serif" font-size="10.00">MHA QKV Linear</text>
<text text-anchor="middle" x="214" y="-1627.97" font-family="Times,serif" font-size="10.00">TP=8</text>
<text text-anchor="middle" x="214" y="-1616.97" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="214" y="-1605.97" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 32×128]</text>
<text text-anchor="middle" x="214" y="-1594.97" font-family="Times,serif" font-size="10.00">GPUs: [0,1,2,3,4,5,6,7]</text>
</g>
<!-- stage0_input&#45;&gt;layer0_mha_qkv -->
<g id="edge2" class="edge">
<title>stage0_input&#45;&gt;layer0_mha_qkv</title>
<path fill="none" stroke="black" d="M215.33,-1712.25C215.33,-1712.25 215.33,-1661.03 215.33,-1661.03"/>
<polygon fill="black" stroke="black" points="218.83,-1661.03 215.33,-1651.03 211.83,-1661.03 218.83,-1661.03"/>
</g>
<!-- layer0_mha_res -->
<g id="node6" class="node">
<title>layer0_mha_res</title>
<polygon fill="lightcoral" stroke="black" points="452.5,-1361.97 235.5,-1361.97 235.5,-1320.97 452.5,-1320.97 452.5,-1361.97"/>
<text text-anchor="middle" x="344" y="-1349.97" font-family="Times,serif" font-size="10.00">MHA Residual Add</text>
<text text-anchor="middle" x="344" y="-1338.97" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 4096]×2</text>
<text text-anchor="middle" x="344" y="-1327.97" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 4096]</text>
</g>
<!-- stage0_input&#45;&gt;layer0_mha_res -->
<g id="edge6" class="edge">
<title>stage0_input&#45;&gt;layer0_mha_res</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M389.5,-1710.39C389.5,-1710.39 389.5,-1372.39 389.5,-1372.39"/>
<polygon fill="black" stroke="black" points="393,-1372.39 389.5,-1362.39 386,-1372.39 393,-1372.39"/>
<text text-anchor="middle" x="383" y="-1521.27" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- layer0_mha_attn -->
<g id="node4" class="node">
<title>layer0_mha_attn</title>
<polygon fill="lightgreen" stroke="black" points="317.5,-1550.97 92.5,-1550.97 92.5,-1498.97 317.5,-1498.97 317.5,-1550.97"/>
<text text-anchor="middle" x="205" y="-1538.97" font-family="Times,serif" font-size="10.00">MHA Attention</text>
<text text-anchor="middle" x="205" y="-1527.97" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 32×128]</text>
<text text-anchor="middle" x="205" y="-1516.97" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 32×128]</text>
<text text-anchor="middle" x="205" y="-1505.97" font-family="Times,serif" font-size="10.00">GPUs: [0,1,2,3,4,5,6,7]</text>
</g>
<!-- layer0_mha_qkv&#45;&gt;layer0_mha_attn -->
<g id="edge3" class="edge">
<title>layer0_mha_qkv&#45;&gt;layer0_mha_attn</title>
<path fill="none" stroke="black" d="M209.5,-1587.74C209.5,-1587.74 209.5,-1561.11 209.5,-1561.11"/>
<polygon fill="black" stroke="black" points="213,-1561.11 209.5,-1551.11 206,-1561.11 213,-1561.11"/>
</g>
<!-- layer0_mha_out -->
<g id="node5" class="node">
<title>layer0_mha_out</title>
<polygon fill="lightgreen" stroke="black" points="324.5,-1461.97 107.5,-1461.97 107.5,-1398.97 324.5,-1398.97 324.5,-1461.97"/>
<text text-anchor="middle" x="216" y="-1449.97" font-family="Times,serif" font-size="10.00">MHA Output Linear</text>
<text text-anchor="middle" x="216" y="-1438.97" font-family="Times,serif" font-size="10.00">TP=8</text>
<text text-anchor="middle" x="216" y="-1427.97" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 32×128]</text>
<text text-anchor="middle" x="216" y="-1416.97" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="216" y="-1405.97" font-family="Times,serif" font-size="10.00">GPUs: [0,1,2,3,4,5,6,7]</text>
</g>
<!-- layer0_mha_attn&#45;&gt;layer0_mha_out -->
<g id="edge4" class="edge">
<title>layer0_mha_attn&#45;&gt;layer0_mha_out</title>
<path fill="none" stroke="black" d="M212.5,-1498.89C212.5,-1498.89 212.5,-1472.17 212.5,-1472.17"/>
<polygon fill="black" stroke="black" points="216,-1472.17 212.5,-1462.17 209,-1472.17 216,-1472.17"/>
</g>
<!-- layer0_mha_out&#45;&gt;layer0_mha_res -->
<g id="edge5" class="edge">
<title>layer0_mha_out&#45;&gt;layer0_mha_res</title>
<path fill="none" stroke="black" d="M280,-1398.84C280,-1398.84 280,-1372.15 280,-1372.15"/>
<polygon fill="black" stroke="black" points="283.5,-1372.15 280,-1362.15 276.5,-1372.15 283.5,-1372.15"/>
</g>
<!-- layer0_gate -->
<g id="node7" class="node">
<title>layer0_gate</title>
<polygon fill="lightyellow" stroke="black" points="532.01,-1283.97 127.94,-1283.97 23.99,-1179.97 428.06,-1179.97 532.01,-1283.97"/>
<text text-anchor="middle" x="278" y="-1245.97" font-family="Times,serif" font-size="10.00">Expert Gate</text>
<text text-anchor="middle" x="278" y="-1234.97" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="278" y="-1223.97" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, routing=16]</text>
<text text-anchor="middle" x="278" y="-1212.97" font-family="Times,serif" font-size="10.00">GPUs: [0,1,2,3,4,5,6,7]</text>
</g>
<!-- layer0_mha_res&#45;&gt;layer0_gate -->
<g id="edge7" class="edge">
<title>layer0_mha_res&#45;&gt;layer0_gate</title>
<path fill="none" stroke="black" d="M344,-1320.87C344,-1320.87 344,-1294.34 344,-1294.34"/>
<polygon fill="black" stroke="black" points="347.5,-1294.34 344,-1284.34 340.5,-1294.34 347.5,-1294.34"/>
</g>
<!-- layer0_exp_res -->
<g id="node9" class="node">
<title>layer0_exp_res</title>
<polygon fill="lightcoral" stroke="black" points="492.5,-1028.97 275.5,-1028.97 275.5,-987.97 492.5,-987.97 492.5,-1028.97"/>
<text text-anchor="middle" x="384" y="-1016.97" font-family="Times,serif" font-size="10.00">Expert Residual Add</text>
<text text-anchor="middle" x="384" y="-1005.97" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 4096]×2</text>
<text text-anchor="middle" x="384" y="-994.97" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 4096]</text>
</g>
<!-- layer0_mha_res&#45;&gt;layer0_exp_res -->
<g id="edge10" class="edge">
<title>layer0_mha_res&#45;&gt;layer0_exp_res</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M452.61,-1341C497.83,-1341 540,-1341 540,-1341 540,-1341 540,-1008 540,-1008 540,-1008 502.77,-1008 502.77,-1008"/>
<polygon fill="black" stroke="black" points="502.77,-1004.5 492.77,-1008 502.77,-1011.5 502.77,-1004.5"/>
<text text-anchor="middle" x="523" y="-1150.77" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- layer0_experts -->
<g id="node8" class="node">
<title>layer0_experts</title>
<polygon fill="lightgreen" stroke="black" points="429.5,-1128.97 218.5,-1128.97 218.5,-1065.97 429.5,-1065.97 429.5,-1128.97"/>
<text text-anchor="middle" x="324" y="-1116.97" font-family="Times,serif" font-size="10.00">Expert Layer</text>
<text text-anchor="middle" x="324" y="-1105.97" font-family="Times,serif" font-size="10.00">16 Experts per GPU</text>
<text text-anchor="middle" x="324" y="-1094.97" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="324" y="-1083.97" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="324" y="-1072.97" font-family="Times,serif" font-size="10.00">GPUs: [0,1,2,3,4,5,6,7]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_experts -->
<g id="edge8" class="edge">
<title>layer0_gate&#45;&gt;layer0_experts</title>
<path fill="none" stroke="black" d="M324,-1179.96C324,-1179.96 324,-1139.11 324,-1139.11"/>
<polygon fill="black" stroke="black" points="327.5,-1139.11 324,-1129.11 320.5,-1139.11 327.5,-1139.11"/>
</g>
<!-- layer0_experts&#45;&gt;layer0_exp_res -->
<g id="edge9" class="edge">
<title>layer0_experts&#45;&gt;layer0_exp_res</title>
<path fill="none" stroke="black" d="M352.5,-1065.84C352.5,-1065.84 352.5,-1039.15 352.5,-1039.15"/>
<polygon fill="black" stroke="black" points="356,-1039.15 352.5,-1029.15 349,-1039.15 356,-1039.15"/>
</g>
<!-- stage1_input -->
<g id="node10" class="node">
<title>stage1_input</title>
<ellipse fill="lightyellow" stroke="black" cx="384" cy="-850.97" rx="212.68" ry="28.98"/>
<text text-anchor="middle" x="384" y="-859.47" font-family="Times,serif" font-size="10.00">Stage1 Input</text>
<text text-anchor="middle" x="384" y="-848.47" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden=4096]</text>
<text text-anchor="middle" x="384" y="-837.47" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden=4096]</text>
</g>
<!-- layer0_exp_res&#45;&gt;stage1_input -->
<g id="edge11" class="edge">
<title>layer0_exp_res&#45;&gt;stage1_input</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M384,-987.88C384,-987.88 384,-890.14 384,-890.14"/>
<polygon fill="blue" stroke="blue" points="387.5,-890.14 384,-880.14 380.5,-890.14 387.5,-890.14"/>
<text text-anchor="middle" x="497" y="-952.77" font-family="Times,serif" font-size="14.00">Pipeline Send</text>
<text text-anchor="middle" x="497" y="-937.77" font-family="Times,serif" font-size="14.00">[batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="497" y="-922.77" font-family="Times,serif" font-size="14.00">GPU7→GPU8</text>
</g>
<!-- layer8_mha_qkv -->
<g id="node11" class="node">
<title>layer8_mha_qkv</title>
<polygon fill="lightgreen" stroke="black" points="393.5,-763.98 168.5,-763.98 168.5,-700.98 393.5,-700.98 393.5,-763.98"/>
<text text-anchor="middle" x="281" y="-751.98" font-family="Times,serif" font-size="10.00">MHA QKV Linear</text>
<text text-anchor="middle" x="281" y="-740.98" font-family="Times,serif" font-size="10.00">TP=8</text>
<text text-anchor="middle" x="281" y="-729.98" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="281" y="-718.98" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 32×128]</text>
<text text-anchor="middle" x="281" y="-707.98" font-family="Times,serif" font-size="10.00">GPUs: [8,9,10,11,12,13,14,15]</text>
</g>
<!-- stage1_input&#45;&gt;layer8_mha_qkv -->
<g id="edge12" class="edge">
<title>stage1_input&#45;&gt;layer8_mha_qkv</title>
<path fill="none" stroke="black" d="M282.33,-825.26C282.33,-825.26 282.33,-774.05 282.33,-774.05"/>
<polygon fill="black" stroke="black" points="285.83,-774.05 282.33,-764.05 278.83,-774.05 285.83,-774.05"/>
</g>
<!-- layer8_mha_res -->
<g id="node14" class="node">
<title>layer8_mha_res</title>
<polygon fill="lightcoral" stroke="black" points="519.5,-474.98 302.5,-474.98 302.5,-433.98 519.5,-433.98 519.5,-474.98"/>
<text text-anchor="middle" x="411" y="-462.98" font-family="Times,serif" font-size="10.00">MHA Residual Add</text>
<text text-anchor="middle" x="411" y="-451.98" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 4096]×2</text>
<text text-anchor="middle" x="411" y="-440.98" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 4096]</text>
</g>
<!-- stage1_input&#45;&gt;layer8_mha_res -->
<g id="edge16" class="edge">
<title>stage1_input&#45;&gt;layer8_mha_res</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M456.5,-823.41C456.5,-823.41 456.5,-485.41 456.5,-485.41"/>
<polygon fill="black" stroke="black" points="460,-485.41 456.5,-475.41 453,-485.41 460,-485.41"/>
<text text-anchor="middle" x="450" y="-634.28" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- layer8_mha_attn -->
<g id="node12" class="node">
<title>layer8_mha_attn</title>
<polygon fill="lightgreen" stroke="black" points="384.5,-663.98 159.5,-663.98 159.5,-611.98 384.5,-611.98 384.5,-663.98"/>
<text text-anchor="middle" x="272" y="-651.98" font-family="Times,serif" font-size="10.00">MHA Attention</text>
<text text-anchor="middle" x="272" y="-640.98" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 32×128]</text>
<text text-anchor="middle" x="272" y="-629.98" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 32×128]</text>
<text text-anchor="middle" x="272" y="-618.98" font-family="Times,serif" font-size="10.00">GPUs: [8,9,10,11,12,13,14,15]</text>
</g>
<!-- layer8_mha_qkv&#45;&gt;layer8_mha_attn -->
<g id="edge13" class="edge">
<title>layer8_mha_qkv&#45;&gt;layer8_mha_attn</title>
<path fill="none" stroke="black" d="M276.5,-700.75C276.5,-700.75 276.5,-674.13 276.5,-674.13"/>
<polygon fill="black" stroke="black" points="280,-674.13 276.5,-664.13 273,-674.13 280,-674.13"/>
</g>
<!-- layer8_mha_out -->
<g id="node13" class="node">
<title>layer8_mha_out</title>
<polygon fill="lightgreen" stroke="black" points="391.5,-574.98 174.5,-574.98 174.5,-511.98 391.5,-511.98 391.5,-574.98"/>
<text text-anchor="middle" x="283" y="-562.98" font-family="Times,serif" font-size="10.00">MHA Output Linear</text>
<text text-anchor="middle" x="283" y="-551.98" font-family="Times,serif" font-size="10.00">TP=8</text>
<text text-anchor="middle" x="283" y="-540.98" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 32×128]</text>
<text text-anchor="middle" x="283" y="-529.98" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="283" y="-518.98" font-family="Times,serif" font-size="10.00">GPUs: [8,9,10,11,12,13,14,15]</text>
</g>
<!-- layer8_mha_attn&#45;&gt;layer8_mha_out -->
<g id="edge14" class="edge">
<title>layer8_mha_attn&#45;&gt;layer8_mha_out</title>
<path fill="none" stroke="black" d="M279.5,-611.91C279.5,-611.91 279.5,-585.19 279.5,-585.19"/>
<polygon fill="black" stroke="black" points="283,-585.19 279.5,-575.19 276,-585.19 283,-585.19"/>
</g>
<!-- layer8_mha_out&#45;&gt;layer8_mha_res -->
<g id="edge15" class="edge">
<title>layer8_mha_out&#45;&gt;layer8_mha_res</title>
<path fill="none" stroke="black" d="M347,-511.85C347,-511.85 347,-485.16 347,-485.16"/>
<polygon fill="black" stroke="black" points="350.5,-485.16 347,-475.16 343.5,-485.16 350.5,-485.16"/>
</g>
<!-- layer8_gate -->
<g id="node15" class="node">
<title>layer8_gate</title>
<polygon fill="lightyellow" stroke="black" points="599.01,-396.98 194.94,-396.98 90.99,-292.98 495.06,-292.98 599.01,-396.98"/>
<text text-anchor="middle" x="345" y="-358.98" font-family="Times,serif" font-size="10.00">Expert Gate</text>
<text text-anchor="middle" x="345" y="-347.98" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="345" y="-336.98" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, routing=16]</text>
<text text-anchor="middle" x="345" y="-325.98" font-family="Times,serif" font-size="10.00">GPUs: [8,9,10,11,12,13,14,15]</text>
</g>
<!-- layer8_mha_res&#45;&gt;layer8_gate -->
<g id="edge17" class="edge">
<title>layer8_mha_res&#45;&gt;layer8_gate</title>
<path fill="none" stroke="black" d="M411,-433.89C411,-433.89 411,-407.36 411,-407.36"/>
<polygon fill="black" stroke="black" points="414.5,-407.36 411,-397.36 407.5,-407.36 414.5,-407.36"/>
</g>
<!-- layer8_exp_res -->
<g id="node17" class="node">
<title>layer8_exp_res</title>
<polygon fill="lightcoral" stroke="black" points="559.5,-141.98 342.5,-141.98 342.5,-100.98 559.5,-100.98 559.5,-141.98"/>
<text text-anchor="middle" x="451" y="-129.98" font-family="Times,serif" font-size="10.00">Expert Residual Add</text>
<text text-anchor="middle" x="451" y="-118.98" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 4096]×2</text>
<text text-anchor="middle" x="451" y="-107.98" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 4096]</text>
</g>
<!-- layer8_mha_res&#45;&gt;layer8_exp_res -->
<g id="edge20" class="edge">
<title>layer8_mha_res&#45;&gt;layer8_exp_res</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M519.6,-454C575.23,-454 631.42,-454 631.42,-454 631.42,-454 631.42,-121 631.42,-121 631.42,-121 569.6,-121 569.6,-121"/>
<polygon fill="black" stroke="black" points="569.6,-117.5 559.6,-121 569.6,-124.5 569.6,-117.5"/>
<text text-anchor="middle" x="590" y="-263.78" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- layer8_experts -->
<g id="node16" class="node">
<title>layer8_experts</title>
<polygon fill="lightgreen" stroke="black" points="496.5,-241.98 285.5,-241.98 285.5,-178.98 496.5,-178.98 496.5,-241.98"/>
<text text-anchor="middle" x="391" y="-229.98" font-family="Times,serif" font-size="10.00">Expert Layer</text>
<text text-anchor="middle" x="391" y="-218.98" font-family="Times,serif" font-size="10.00">16 Experts per GPU</text>
<text text-anchor="middle" x="391" y="-207.98" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="391" y="-196.98" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10000, 4096]</text>
<text text-anchor="middle" x="391" y="-185.98" font-family="Times,serif" font-size="10.00">GPUs: [8,9,10,11,12,13,14,15]</text>
</g>
<!-- layer8_gate&#45;&gt;layer8_experts -->
<g id="edge18" class="edge">
<title>layer8_gate&#45;&gt;layer8_experts</title>
<path fill="none" stroke="black" d="M391,-292.98C391,-292.98 391,-252.13 391,-252.13"/>
<polygon fill="black" stroke="black" points="394.5,-252.13 391,-242.13 387.5,-252.13 394.5,-252.13"/>
</g>
<!-- layer8_experts&#45;&gt;layer8_exp_res -->
<g id="edge19" class="edge">
<title>layer8_experts&#45;&gt;layer8_exp_res</title>
<path fill="none" stroke="black" d="M419.5,-178.85C419.5,-178.85 419.5,-152.16 419.5,-152.16"/>
<polygon fill="black" stroke="black" points="423,-152.16 419.5,-142.16 416,-152.16 423,-152.16"/>
</g>
<!-- output -->
<g id="node18" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="451" cy="-28.99" rx="212.68" ry="28.98"/>
<text text-anchor="middle" x="451" y="-37.49" font-family="Times,serif" font-size="10.00">Output</text>
<text text-anchor="middle" x="451" y="-26.49" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden=4096]</text>
<text text-anchor="middle" x="451" y="-15.49" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden=4096]</text>
</g>
<!-- layer8_exp_res&#45;&gt;output -->
<g id="edge21" class="edge">
<title>layer8_exp_res&#45;&gt;output</title>
<path fill="none" stroke="black" d="M451,-100.96C451,-100.96 451,-68.23 451,-68.23"/>
<polygon fill="black" stroke="black" points="454.5,-68.23 451,-58.23 447.5,-68.23 454.5,-68.23"/>
</g>
<!-- note -->
<g id="node19" class="node">
<title>note</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="698,-1888.44 548,-1888.44 548,-1847.44 704,-1847.44 704,-1882.44 698,-1888.44"/>
<polyline fill="none" stroke="black" stroke-dasharray="5,2" points="698,-1888.44 698,-1882.44 "/>
<polyline fill="none" stroke="black" stroke-dasharray="5,2" points="704,-1882.44 698,-1882.44 "/>
<text text-anchor="middle" x="626" y="-1876.44" font-family="Times,serif" font-size="10.00">Note: Layers 1&#45;7 and 9&#45;15</text>
<text text-anchor="middle" x="626" y="-1865.44" font-family="Times,serif" font-size="10.00">repeat similar patterns</text>
<text text-anchor="middle" x="626" y="-1854.44" font-family="Times,serif" font-size="10.00">with same device mappings</text>
</g>
</g>
</svg>
