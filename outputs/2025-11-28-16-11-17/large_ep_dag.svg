<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="5790pt" height="531pt"
 viewBox="0.00 0.00 5790.00 531.19" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 527.19)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-527.19 5786,-527.19 5786,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<polygon fill="none" stroke="black" points="8,-261.19 8,-382.19 914.53,-382.19 914.53,-261.19 8,-261.19"/>
<text text-anchor="middle" x="461.26" y="-366.99" font-family="Times,serif" font-size="14.00">Input Distribution Layer</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer1</title>
<polygon fill="none" stroke="black" points="1057.53,-308.19 1057.53,-451.19 2554.44,-451.19 2554.44,-308.19 1057.53,-308.19"/>
<text text-anchor="middle" x="1805.98" y="-435.99" font-family="Times,serif" font-size="14.00">Layer 1: MLA + Expert Routing</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_routing</title>
<polygon fill="none" stroke="black" points="2575.44,-27.19 2575.44,-428.19 3078.41,-428.19 3078.41,-27.19 2575.44,-27.19"/>
<text text-anchor="middle" x="2826.93" y="-412.99" font-family="Times,serif" font-size="14.00">Expert Routing Communication</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_layer2</title>
<polygon fill="none" stroke="black" points="3222.41,-223.19 3222.41,-366.19 4815.33,-366.19 4815.33,-223.19 3222.41,-223.19"/>
<text text-anchor="middle" x="4018.87" y="-350.99" font-family="Times,serif" font-size="14.00">Layer 2: Intermediate Processing</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_layer3</title>
<polygon fill="none" stroke="black" points="3222.41,-23.19 3222.41,-166.19 4815.33,-166.19 4815.33,-23.19 3222.41,-23.19"/>
<text text-anchor="middle" x="4018.87" y="-150.99" font-family="Times,serif" font-size="14.00">Layer 3: Output Processing</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_output</title>
<polygon fill="none" stroke="black" points="4938.33,-23.19 4938.33,-166.19 5774,-166.19 5774,-23.19 4938.33,-23.19"/>
<text text-anchor="middle" x="5356.17" y="-150.99" font-family="Times,serif" font-size="14.00">Output Aggregation</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_communication</title>
<polygon fill="none" stroke="black" points="4330.6,-374.19 4330.6,-515.19 4544.82,-515.19 4544.82,-374.19 4330.6,-374.19"/>
<text text-anchor="middle" x="4437.71" y="-499.99" font-family="Times,serif" font-size="14.00">Cross&#45;Node Communication</text>
</g>
<!-- input_tokens -->
<g id="node1" class="node">
<title>input_tokens</title>
<polygon fill="lightgray" stroke="black" points="124.59,-281.26 130.67,-281.42 136.69,-281.66 142.63,-281.98 148.45,-282.37 154.13,-282.84 159.66,-283.38 165.01,-284 170.17,-284.69 175.1,-285.45 179.8,-286.28 184.24,-287.17 188.42,-288.13 192.32,-289.14 195.92,-290.22 199.22,-291.35 202.22,-292.53 204.89,-293.75 207.25,-295.03 209.28,-296.34 210.99,-297.7 212.37,-299.08 213.42,-300.5 214.16,-301.95 214.58,-303.41 214.7,-304.9 214.51,-306.4 214.03,-307.91 213.27,-309.43 212.23,-310.95 210.93,-312.46 209.39,-313.97 207.6,-315.47 205.6,-316.96 203.38,-318.43 200.97,-319.87 198.37,-321.29 195.6,-322.68 192.68,-324.03 189.61,-325.35 186.42,-326.62 183.1,-327.85 179.67,-329.03 176.15,-330.16 172.55,-331.23 168.87,-332.25 165.12,-333.2 161.32,-334.1 157.46,-334.92 153.57,-335.68 149.63,-336.37 145.67,-336.99 141.68,-337.54 137.67,-338.01 133.64,-338.4 129.6,-338.71 125.55,-338.95 121.49,-339.11 117.43,-339.19 113.37,-339.19 109.31,-339.11 105.25,-338.95 101.2,-338.71 97.16,-338.4 93.13,-338.01 89.12,-337.54 85.13,-336.99 81.17,-336.37 77.23,-335.68 73.34,-334.92 69.48,-334.1 65.68,-333.2 61.93,-332.25 58.25,-331.23 54.64,-330.16 51.12,-329.03 47.7,-327.85 44.38,-326.62 41.19,-325.35 38.12,-324.03 35.19,-322.68 32.43,-321.29 29.83,-319.87 27.42,-318.43 25.2,-316.96 23.19,-315.47 21.41,-313.97 19.87,-312.46 18.57,-310.95 17.53,-309.43 16.77,-307.91 16.29,-306.4 16.1,-304.9 16.21,-303.41 16.64,-301.95 17.37,-300.5 18.43,-299.08 19.81,-297.7 21.52,-296.34 23.55,-295.03 25.9,-293.75 28.58,-292.53 31.57,-291.35 34.88,-290.22 38.48,-289.14 42.38,-288.13 46.56,-287.17 51,-286.28 55.7,-285.45 60.63,-284.69 65.78,-284 71.13,-283.38 76.66,-282.84 82.35,-282.37 88.17,-281.98 94.11,-281.66 100.13,-281.42 106.21,-281.26 112.33,-281.18 118.47,-281.18 124.59,-281.26"/>
<text text-anchor="middle" x="115.4" y="-318.69" font-family="Arial" font-size="10.00">Input Tokens</text>
<text text-anchor="middle" x="115.4" y="-307.69" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?]</text>
<text text-anchor="middle" x="115.4" y="-296.69" font-family="Arial" font-size="10.00">GPU: N/A</text>
</g>
<!-- token_split -->
<g id="node2" class="node">
<title>token_split</title>
<polygon fill="lightgreen" stroke="black" points="906.39,-351.19 441.52,-351.19 321.93,-269.19 786.8,-269.19 906.39,-351.19"/>
<text text-anchor="middle" x="614.16" y="-318.69" font-family="Arial" font-size="10.00">Token Split</text>
<text text-anchor="middle" x="614.16" y="-307.69" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?] → [batch_size=?, seq_len=?/256]</text>
<text text-anchor="middle" x="614.16" y="-296.69" font-family="Arial" font-size="10.00">GPU: 0&#45;255</text>
</g>
<!-- input_tokens&#45;&gt;token_split -->
<g id="edge1" class="edge">
<title>input_tokens&#45;&gt;token_split</title>
<path fill="none" stroke="black" d="M212.77,-310.19C258.42,-310.19 315.2,-310.19 371.51,-310.19"/>
<polygon fill="black" stroke="black" points="371.65,-313.69 381.65,-310.19 371.65,-306.69 371.65,-313.69"/>
<text text-anchor="middle" x="268.3" y="-313.99" font-family="Times,serif" font-size="14.00">broadcast</text>
</g>
<!-- mla_0 -->
<g id="node3" class="node">
<title>mla_0</title>
<polygon fill="lightblue" stroke="black" points="1289.53,-381.19 1065.53,-381.19 1065.53,-329.19 1289.53,-329.19 1289.53,-381.19"/>
<text text-anchor="middle" x="1177.53" y="-369.19" font-family="Arial" font-size="10.00">MLA</text>
<text text-anchor="middle" x="1177.53" y="-358.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, heads=128, d_k=56]</text>
<text text-anchor="middle" x="1177.53" y="-347.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="1177.53" y="-336.19" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- token_split&#45;&gt;mla_0 -->
<g id="edge2" class="edge">
<title>token_split&#45;&gt;mla_0</title>
<path fill="none" stroke="black" d="M877.35,-331.21C939.6,-336.2 1003.07,-341.28 1055.43,-345.48"/>
<polygon fill="black" stroke="black" points="1055.17,-348.97 1065.42,-346.28 1055.73,-341.99 1055.17,-348.97"/>
<text text-anchor="middle" x="986.03" y="-347.99" font-family="Times,serif" font-size="14.00">tokens for GPU 0</text>
</g>
<!-- residual_add_0 -->
<g id="node5" class="node">
<title>residual_add_0</title>
<polygon fill="lightgreen" stroke="black" points="2546.56,-420.19 1957.59,-420.19 1806.08,-316.19 2395.05,-316.19 2546.56,-420.19"/>
<text text-anchor="middle" x="2176.32" y="-382.19" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="2176.32" y="-371.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168] + [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2176.32" y="-360.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2176.32" y="-349.19" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- token_split&#45;&gt;residual_add_0 -->
<g id="edge5" class="edge">
<title>token_split&#45;&gt;residual_add_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M831.4,-299.7C1063.56,-290.76 1443.03,-282.83 1769.2,-307.19 1795.64,-309.16 1822.96,-311.85 1850.36,-315"/>
<polygon fill="black" stroke="black" points="1850.12,-318.5 1860.46,-316.18 1850.93,-311.54 1850.12,-318.5"/>
<text text-anchor="middle" x="1336.53" y="-294.99" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- gate_0 -->
<g id="node4" class="node">
<title>gate_0</title>
<polygon fill="lightgreen" stroke="black" points="1769.04,-420.19 1462.54,-420.19 1383.69,-316.19 1690.19,-316.19 1769.04,-420.19"/>
<text text-anchor="middle" x="1576.36" y="-382.19" font-family="Arial" font-size="10.00">Expert Gating</text>
<text text-anchor="middle" x="1576.36" y="-371.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="1576.36" y="-360.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, top_k=2]</text>
<text text-anchor="middle" x="1576.36" y="-349.19" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- mla_0&#45;&gt;gate_0 -->
<g id="edge3" class="edge">
<title>mla_0&#45;&gt;gate_0</title>
<path fill="none" stroke="black" d="M1289.6,-358.83C1326.59,-360.04 1368.64,-361.42 1408.89,-362.73"/>
<polygon fill="black" stroke="black" points="1408.97,-366.24 1419.08,-363.07 1409.2,-359.24 1408.97,-366.24"/>
</g>
<!-- gate_0&#45;&gt;residual_add_0 -->
<g id="edge4" class="edge">
<title>gate_0&#45;&gt;residual_add_0</title>
<path fill="none" stroke="black" d="M1729.8,-368.19C1773.34,-368.19 1822.39,-368.19 1871.61,-368.19"/>
<polygon fill="black" stroke="black" points="1871.78,-371.69 1881.78,-368.19 1871.78,-364.69 1871.78,-371.69"/>
</g>
<!-- comm_0_64 -->
<g id="node24" class="node">
<title>comm_0_64</title>
<ellipse fill="lightyellow" stroke="black" cx="4437.21" cy="-463.19" rx="73.58" ry="21.43"/>
<text text-anchor="middle" x="4437.21" y="-466.19" font-family="Arial" font-size="10.00">Async Transfer</text>
<text text-anchor="middle" x="4437.21" y="-455.19" font-family="Arial" font-size="10.00">GPU: 0 ↔ GPU: 64</text>
</g>
<!-- gate_0&#45;&gt;comm_0_64 -->
<g id="edge24" class="edge">
<title>gate_0&#45;&gt;comm_0_64</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1760.3,-420.19C1775.75,-423.59 1791.2,-426.66 1806.2,-429.19 1968.41,-456.49 2010.83,-456.19 2175.32,-456.19 2175.32,-456.19 2175.32,-456.19 3742.25,-456.19 3963.08,-456.19 4223.42,-459.78 4353.5,-461.81"/>
<polygon fill="black" stroke="black" points="4353.72,-465.32 4363.78,-461.98 4353.83,-458.32 4353.72,-465.32"/>
<text text-anchor="middle" x="2973.41" y="-459.99" font-family="Times,serif" font-size="14.00">token routing</text>
</g>
<!-- comm_to_expert_0 -->
<g id="node6" class="node">
<title>comm_to_expert_0</title>
<ellipse fill="lightyellow" stroke="black" cx="2711.43" cy="-368.19" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2711.43" y="-376.69" font-family="Arial" font-size="10.00">Token Routing</text>
<text text-anchor="middle" x="2711.43" y="-365.69" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2711.43" y="-354.69" font-family="Arial" font-size="10.00">→ GPU: 0</text>
</g>
<!-- residual_add_0&#45;&gt;comm_to_expert_0 -->
<g id="edge6" class="edge">
<title>residual_add_0&#45;&gt;comm_to_expert_0</title>
<path fill="none" stroke="black" d="M2471.16,-368.19C2506.67,-368.19 2541.52,-368.19 2573.16,-368.19"/>
<polygon fill="black" stroke="black" points="2573.32,-371.69 2583.32,-368.19 2573.32,-364.69 2573.32,-371.69"/>
</g>
<!-- collect_res -->
<g id="node22" class="node">
<title>collect_res</title>
<polygon fill="lightgreen" stroke="black" points="5456.45,-135.19 5050.67,-135.19 4946.29,-31.19 5352.07,-31.19 5456.45,-135.19"/>
<text text-anchor="middle" x="5201.37" y="-97.19" font-family="Arial" font-size="10.00">Gather Results</text>
<text text-anchor="middle" x="5201.37" y="-86.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168] from all GPUs</text>
<text text-anchor="middle" x="5201.37" y="-75.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="5201.37" y="-64.19" font-family="Arial" font-size="10.00">GPU: 0&#45;255</text>
</g>
<!-- residual_add_0&#45;&gt;collect_res -->
<g id="edge20" class="edge">
<title>residual_add_0&#45;&gt;collect_res</title>
<path fill="none" stroke="black" d="M2220.44,-315.88C2287.59,-238.28 2425.15,-94.2 2575.44,-23.19 2630.47,2.81 2649.57,-0.19 2710.43,-0.19 2710.43,-0.19 2710.43,-0.19 4438.21,-0.19 4606.03,-0.19 4648.47,-1.18 4815.33,-19.19 4856.66,-23.65 4900.29,-29.65 4942.75,-36.19"/>
<polygon fill="black" stroke="black" points="4942.23,-39.65 4952.65,-37.73 4943.31,-32.73 4942.23,-39.65"/>
<text text-anchor="middle" x="3342.41" y="-3.99" font-family="Times,serif" font-size="14.00">from GPU 0</text>
</g>
<!-- expert_0 -->
<g id="node7" class="node">
<title>expert_0</title>
<polygon fill="lightblue" stroke="black" points="3070.41,-394.19 2876.41,-394.19 2876.41,-342.19 3070.41,-342.19 3070.41,-394.19"/>
<text text-anchor="middle" x="2973.41" y="-382.19" font-family="Arial" font-size="10.00">Expert MLP 0</text>
<text text-anchor="middle" x="2973.41" y="-371.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2973.41" y="-360.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2973.41" y="-349.19" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- comm_to_expert_0&#45;&gt;expert_0 -->
<g id="edge7" class="edge">
<title>comm_to_expert_0&#45;&gt;expert_0</title>
<path fill="none" stroke="black" d="M2839.75,-368.19C2848.54,-368.19 2857.34,-368.19 2866,-368.19"/>
<polygon fill="black" stroke="black" points="2866.08,-371.69 2876.08,-368.19 2866.08,-364.69 2866.08,-371.69"/>
</g>
<!-- comm_to_expert_64 -->
<g id="node8" class="node">
<title>comm_to_expert_64</title>
<ellipse fill="lightyellow" stroke="black" cx="2711.43" cy="-292.19" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2711.43" y="-300.69" font-family="Arial" font-size="10.00">Token Routing</text>
<text text-anchor="middle" x="2711.43" y="-289.69" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2711.43" y="-278.69" font-family="Arial" font-size="10.00">→ GPU: 64</text>
</g>
<!-- expert_64 -->
<g id="node9" class="node">
<title>expert_64</title>
<polygon fill="lightblue" stroke="black" points="3070.41,-311.19 2876.41,-311.19 2876.41,-259.19 3070.41,-259.19 3070.41,-311.19"/>
<text text-anchor="middle" x="2973.41" y="-299.19" font-family="Arial" font-size="10.00">Expert MLP 64</text>
<text text-anchor="middle" x="2973.41" y="-288.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2973.41" y="-277.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2973.41" y="-266.19" font-family="Arial" font-size="10.00">GPU: 64</text>
</g>
<!-- comm_to_expert_64&#45;&gt;expert_64 -->
<g id="edge8" class="edge">
<title>comm_to_expert_64&#45;&gt;expert_64</title>
<path fill="none" stroke="black" d="M2838.61,-288.79C2847.82,-288.54 2857.06,-288.29 2866.14,-288.05"/>
<polygon fill="black" stroke="black" points="2866.41,-291.54 2876.31,-287.77 2866.22,-284.55 2866.41,-291.54"/>
</g>
<!-- mla_64 -->
<g id="node16" class="node">
<title>mla_64</title>
<polygon fill="lightblue" stroke="black" points="3454.41,-310.19 3230.41,-310.19 3230.41,-258.19 3454.41,-258.19 3454.41,-310.19"/>
<text text-anchor="middle" x="3342.41" y="-298.19" font-family="Arial" font-size="10.00">MLA</text>
<text text-anchor="middle" x="3342.41" y="-287.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, heads=128, d_k=56]</text>
<text text-anchor="middle" x="3342.41" y="-276.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="3342.41" y="-265.19" font-family="Arial" font-size="10.00">GPU: 64</text>
</g>
<!-- expert_64&#45;&gt;mla_64 -->
<g id="edge12" class="edge">
<title>expert_64&#45;&gt;mla_64</title>
<path fill="none" stroke="black" d="M3070.84,-284.92C3116.54,-284.8 3171.62,-284.65 3220.13,-284.52"/>
<polygon fill="black" stroke="black" points="3220.38,-288.02 3230.37,-284.49 3220.36,-281.02 3220.38,-288.02"/>
<text text-anchor="middle" x="3150.41" y="-287.99" font-family="Times,serif" font-size="14.00">processed tokens</text>
</g>
<!-- residual_add_64 -->
<g id="node18" class="node">
<title>residual_add_64</title>
<polygon fill="lightgreen" stroke="black" points="4807.45,-335.19 4218.48,-335.19 4066.96,-231.19 4655.94,-231.19 4807.45,-335.19"/>
<text text-anchor="middle" x="4437.21" y="-297.19" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="4437.21" y="-286.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168] + [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="4437.21" y="-275.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="4437.21" y="-264.19" font-family="Arial" font-size="10.00">GPU: 64</text>
</g>
<!-- expert_64&#45;&gt;residual_add_64 -->
<g id="edge15" class="edge">
<title>expert_64&#45;&gt;residual_add_64</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3070.51,-269.83C3116.41,-262.86 3172.16,-254.91 3222.41,-249.19 3536.91,-213.37 3618.14,-203.07 3934.09,-222.19 3974.96,-224.66 4017.61,-228.26 4060.03,-232.49"/>
<polygon fill="black" stroke="black" points="4059.93,-235.99 4070.23,-233.52 4060.63,-229.03 4059.93,-235.99"/>
<text text-anchor="middle" x="3501.41" y="-224.99" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- comm_to_expert_128 -->
<g id="node10" class="node">
<title>comm_to_expert_128</title>
<ellipse fill="lightyellow" stroke="black" cx="2711.43" cy="-216.19" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2711.43" y="-224.69" font-family="Arial" font-size="10.00">Token Routing</text>
<text text-anchor="middle" x="2711.43" y="-213.69" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2711.43" y="-202.69" font-family="Arial" font-size="10.00">→ GPU: 128</text>
</g>
<!-- expert_128 -->
<g id="node11" class="node">
<title>expert_128</title>
<polygon fill="lightblue" stroke="black" points="3070.41,-241.19 2876.41,-241.19 2876.41,-189.19 3070.41,-189.19 3070.41,-241.19"/>
<text text-anchor="middle" x="2973.41" y="-229.19" font-family="Arial" font-size="10.00">Expert MLP 128</text>
<text text-anchor="middle" x="2973.41" y="-218.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2973.41" y="-207.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2973.41" y="-196.19" font-family="Arial" font-size="10.00">GPU: 128</text>
</g>
<!-- comm_to_expert_128&#45;&gt;expert_128 -->
<g id="edge9" class="edge">
<title>comm_to_expert_128&#45;&gt;expert_128</title>
<path fill="none" stroke="black" d="M2839.75,-215.7C2848.54,-215.66 2857.34,-215.63 2866,-215.6"/>
<polygon fill="black" stroke="black" points="2866.1,-219.1 2876.08,-215.56 2866.07,-212.1 2866.1,-219.1"/>
</g>
<!-- comm_to_expert_192 -->
<g id="node12" class="node">
<title>comm_to_expert_192</title>
<ellipse fill="lightyellow" stroke="black" cx="2711.43" cy="-140.19" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2711.43" y="-148.69" font-family="Arial" font-size="10.00">Token Routing</text>
<text text-anchor="middle" x="2711.43" y="-137.69" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2711.43" y="-126.69" font-family="Arial" font-size="10.00">→ GPU: 192</text>
</g>
<!-- expert_192 -->
<g id="node13" class="node">
<title>expert_192</title>
<polygon fill="lightblue" stroke="black" points="3070.41,-170.19 2876.41,-170.19 2876.41,-118.19 3070.41,-118.19 3070.41,-170.19"/>
<text text-anchor="middle" x="2973.41" y="-158.19" font-family="Arial" font-size="10.00">Expert MLP 192</text>
<text text-anchor="middle" x="2973.41" y="-147.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2973.41" y="-136.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2973.41" y="-125.19" font-family="Arial" font-size="10.00">GPU: 192</text>
</g>
<!-- comm_to_expert_192&#45;&gt;expert_192 -->
<g id="edge10" class="edge">
<title>comm_to_expert_192&#45;&gt;expert_192</title>
<path fill="none" stroke="black" d="M2839.37,-142.14C2848.27,-142.28 2857.18,-142.41 2865.95,-142.55"/>
<polygon fill="black" stroke="black" points="2866.11,-146.05 2876.16,-142.71 2866.21,-139.05 2866.11,-146.05"/>
</g>
<!-- comm_to_expert_255 -->
<g id="node14" class="node">
<title>comm_to_expert_255</title>
<ellipse fill="lightyellow" stroke="black" cx="2711.43" cy="-64.19" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2711.43" y="-72.69" font-family="Arial" font-size="10.00">Token Routing</text>
<text text-anchor="middle" x="2711.43" y="-61.69" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2711.43" y="-50.69" font-family="Arial" font-size="10.00">→ GPU: 255</text>
</g>
<!-- expert_255 -->
<g id="node15" class="node">
<title>expert_255</title>
<polygon fill="lightblue" stroke="black" points="3070.41,-100.19 2876.41,-100.19 2876.41,-48.19 3070.41,-48.19 3070.41,-100.19"/>
<text text-anchor="middle" x="2973.41" y="-88.19" font-family="Arial" font-size="10.00">Expert MLP 255</text>
<text text-anchor="middle" x="2973.41" y="-77.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2973.41" y="-66.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2973.41" y="-55.19" font-family="Arial" font-size="10.00">GPU: 255</text>
</g>
<!-- comm_to_expert_255&#45;&gt;expert_255 -->
<g id="edge11" class="edge">
<title>comm_to_expert_255&#45;&gt;expert_255</title>
<path fill="none" stroke="black" d="M2837.85,-69.01C2847.29,-69.37 2856.76,-69.74 2866.07,-70.1"/>
<polygon fill="black" stroke="black" points="2865.96,-73.6 2876.09,-70.48 2866.23,-66.6 2865.96,-73.6"/>
</g>
<!-- mla_255 -->
<g id="node19" class="node">
<title>mla_255</title>
<polygon fill="lightblue" stroke="black" points="3454.41,-105.19 3230.41,-105.19 3230.41,-53.19 3454.41,-53.19 3454.41,-105.19"/>
<text text-anchor="middle" x="3342.41" y="-93.19" font-family="Arial" font-size="10.00">MLA</text>
<text text-anchor="middle" x="3342.41" y="-82.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, heads=128, d_k=56]</text>
<text text-anchor="middle" x="3342.41" y="-71.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="3342.41" y="-60.19" font-family="Arial" font-size="10.00">GPU: 255</text>
</g>
<!-- expert_255&#45;&gt;mla_255 -->
<g id="edge16" class="edge">
<title>expert_255&#45;&gt;mla_255</title>
<path fill="none" stroke="black" d="M3070.84,-75.5C3116.54,-76.12 3171.62,-76.87 3220.13,-77.54"/>
<polygon fill="black" stroke="black" points="3220.33,-81.04 3230.37,-77.67 3220.42,-74.04 3220.33,-81.04"/>
<text text-anchor="middle" x="3150.41" y="-80.99" font-family="Times,serif" font-size="14.00">processed tokens</text>
</g>
<!-- residual_add_255 -->
<g id="node21" class="node">
<title>residual_add_255</title>
<polygon fill="lightgreen" stroke="black" points="4807.45,-135.19 4218.48,-135.19 4066.96,-31.19 4655.94,-31.19 4807.45,-135.19"/>
<text text-anchor="middle" x="4437.21" y="-97.19" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="4437.21" y="-86.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168] + [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="4437.21" y="-75.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="4437.21" y="-64.19" font-family="Arial" font-size="10.00">GPU: 255</text>
</g>
<!-- expert_255&#45;&gt;residual_add_255 -->
<g id="edge19" class="edge">
<title>expert_255&#45;&gt;residual_add_255</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3070.44,-93.12C3076.52,-94.2 3082.55,-95.23 3088.41,-96.19 3147.72,-105.88 3162.7,-107.43 3222.41,-114.19 3536.99,-149.77 3618.08,-163.31 3934.09,-144.19 4015.62,-139.25 4104.2,-129.85 4183.94,-119.88"/>
<polygon fill="black" stroke="black" points="4184.64,-123.32 4194.12,-118.6 4183.76,-116.37 4184.64,-123.32"/>
<text text-anchor="middle" x="3501.41" y="-149.99" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- gate_64 -->
<g id="node17" class="node">
<title>gate_64</title>
<polygon fill="lightgreen" stroke="black" points="3933.92,-335.19 3627.42,-335.19 3548.58,-231.19 3855.08,-231.19 3933.92,-335.19"/>
<text text-anchor="middle" x="3741.25" y="-297.19" font-family="Arial" font-size="10.00">Expert Gating</text>
<text text-anchor="middle" x="3741.25" y="-286.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="3741.25" y="-275.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, top_k=2]</text>
<text text-anchor="middle" x="3741.25" y="-264.19" font-family="Arial" font-size="10.00">GPU: 64</text>
</g>
<!-- mla_64&#45;&gt;gate_64 -->
<g id="edge13" class="edge">
<title>mla_64&#45;&gt;gate_64</title>
<path fill="none" stroke="black" d="M3454.48,-283.91C3492.72,-283.81 3536.36,-283.7 3577.83,-283.6"/>
<polygon fill="black" stroke="black" points="3578.05,-287.1 3588.04,-283.57 3578.03,-280.1 3578.05,-287.1"/>
</g>
<!-- gate_64&#45;&gt;residual_add_64 -->
<g id="edge14" class="edge">
<title>gate_64&#45;&gt;residual_add_64</title>
<path fill="none" stroke="black" d="M3894.54,-283.19C3964.51,-283.19 4050.1,-283.19 4132.39,-283.19"/>
<polygon fill="black" stroke="black" points="4132.41,-286.69 4142.41,-283.19 4132.41,-279.69 4132.41,-286.69"/>
</g>
<!-- comm_64_255 -->
<g id="node25" class="node">
<title>comm_64_255</title>
<ellipse fill="lightyellow" stroke="black" cx="4437.21" cy="-403.19" rx="80.72" ry="21.43"/>
<text text-anchor="middle" x="4437.21" y="-406.19" font-family="Arial" font-size="10.00">Async Transfer</text>
<text text-anchor="middle" x="4437.21" y="-395.19" font-family="Arial" font-size="10.00">GPU: 64 ↔ GPU: 255</text>
</g>
<!-- gate_64&#45;&gt;comm_64_255 -->
<g id="edge25" class="edge">
<title>gate_64&#45;&gt;comm_64_255</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3914.65,-335.28C3963.54,-348.44 4017.07,-361.32 4067.09,-370.19 4161.78,-386.97 4271.73,-395.41 4346.84,-399.52"/>
<polygon fill="black" stroke="black" points="4347.03,-403.03 4357.2,-400.07 4347.4,-396.04 4347.03,-403.03"/>
<text text-anchor="middle" x="4000.59" y="-367.99" font-family="Times,serif" font-size="14.00">token routing</text>
</g>
<!-- residual_add_64&#45;&gt;collect_res -->
<g id="edge21" class="edge">
<title>residual_add_64&#45;&gt;collect_res</title>
<path fill="none" stroke="black" d="M4636.47,-231.16C4758.84,-199.05 4914.18,-158.29 5030.82,-127.68"/>
<polygon fill="black" stroke="black" points="5031.78,-131.05 5040.56,-125.12 5030,-124.28 5031.78,-131.05"/>
<text text-anchor="middle" x="4876.83" y="-180.99" font-family="Times,serif" font-size="14.00">from GPU 64</text>
</g>
<!-- gate_255 -->
<g id="node20" class="node">
<title>gate_255</title>
<polygon fill="lightgreen" stroke="black" points="3933.92,-135.19 3627.42,-135.19 3548.58,-31.19 3855.08,-31.19 3933.92,-135.19"/>
<text text-anchor="middle" x="3741.25" y="-97.19" font-family="Arial" font-size="10.00">Expert Gating</text>
<text text-anchor="middle" x="3741.25" y="-86.19" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="3741.25" y="-75.19" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, top_k=2]</text>
<text text-anchor="middle" x="3741.25" y="-64.19" font-family="Arial" font-size="10.00">GPU: 255</text>
</g>
<!-- mla_255&#45;&gt;gate_255 -->
<g id="edge17" class="edge">
<title>mla_255&#45;&gt;gate_255</title>
<path fill="none" stroke="black" d="M3454.48,-80.31C3492.29,-80.69 3535.39,-81.12 3576.45,-81.54"/>
<polygon fill="black" stroke="black" points="3576.53,-85.04 3586.56,-81.64 3576.6,-78.04 3576.53,-85.04"/>
</g>
<!-- gate_255&#45;&gt;residual_add_255 -->
<g id="edge18" class="edge">
<title>gate_255&#45;&gt;residual_add_255</title>
<path fill="none" stroke="black" d="M3894.54,-83.19C3964.51,-83.19 4050.1,-83.19 4132.39,-83.19"/>
<polygon fill="black" stroke="black" points="4132.41,-86.69 4142.41,-83.19 4132.41,-79.69 4132.41,-86.69"/>
</g>
<!-- residual_add_255&#45;&gt;collect_res -->
<g id="edge22" class="edge">
<title>residual_add_255&#45;&gt;collect_res</title>
<path fill="none" stroke="black" d="M4731.79,-83.19C4817.24,-83.19 4908.91,-83.19 4988.29,-83.19"/>
<polygon fill="black" stroke="black" points="4988.41,-86.69 4998.41,-83.19 4988.41,-79.69 4988.41,-86.69"/>
<text text-anchor="middle" x="4876.83" y="-86.99" font-family="Times,serif" font-size="14.00">from GPU 255</text>
</g>
<!-- final_out -->
<g id="node23" class="node">
<title>final_out</title>
<polygon fill="lightgray" stroke="black" points="5642.3,-54.26 5650.64,-54.42 5658.89,-54.66 5667.02,-54.98 5675,-55.37 5682.8,-55.84 5690.38,-56.38 5697.71,-57 5704.77,-57.69 5711.53,-58.45 5717.97,-59.28 5724.06,-60.17 5729.79,-61.13 5735.13,-62.14 5740.07,-63.22 5744.6,-64.35 5748.7,-65.53 5752.37,-66.75 5755.59,-68.03 5758.38,-69.34 5760.72,-70.7 5762.61,-72.08 5764.06,-73.5 5765.07,-74.95 5765.65,-76.41 5765.8,-77.9 5765.55,-79.4 5764.89,-80.91 5763.84,-82.43 5762.42,-83.95 5760.64,-85.46 5758.52,-86.97 5756.08,-88.47 5753.33,-89.96 5750.29,-91.43 5746.98,-92.87 5743.43,-94.29 5739.63,-95.68 5735.63,-97.03 5731.42,-98.35 5727.04,-99.62 5722.49,-100.85 5717.8,-102.03 5712.98,-103.16 5708.04,-104.23 5702.99,-105.25 5697.86,-106.2 5692.64,-107.1 5687.36,-107.92 5682.02,-108.68 5676.63,-109.37 5671.19,-109.99 5665.72,-110.54 5660.23,-111.01 5654.71,-111.4 5649.17,-111.71 5643.62,-111.95 5638.06,-112.11 5632.49,-112.19 5626.92,-112.19 5621.36,-112.11 5615.8,-111.95 5610.25,-111.71 5604.71,-111.4 5599.19,-111.01 5593.69,-110.54 5588.22,-109.99 5582.79,-109.37 5577.4,-108.68 5572.06,-107.92 5566.77,-107.1 5561.56,-106.2 5556.42,-105.25 5551.38,-104.23 5546.44,-103.16 5541.61,-102.03 5536.92,-100.85 5532.38,-99.62 5527.99,-98.35 5523.79,-97.03 5519.78,-95.68 5515.99,-94.29 5512.43,-92.87 5509.12,-91.43 5506.08,-89.96 5503.33,-88.47 5500.89,-86.97 5498.77,-85.46 5496.99,-83.95 5495.57,-82.43 5494.53,-80.91 5493.87,-79.4 5493.61,-77.9 5493.77,-76.41 5494.35,-74.95 5495.36,-73.5 5496.81,-72.08 5498.7,-70.7 5501.04,-69.34 5503.82,-68.03 5507.05,-66.75 5510.72,-65.53 5514.82,-64.35 5519.35,-63.22 5524.29,-62.14 5529.63,-61.13 5535.35,-60.17 5541.45,-59.28 5547.88,-58.45 5554.65,-57.69 5561.71,-57 5569.04,-56.38 5576.62,-55.84 5584.41,-55.37 5592.39,-54.98 5600.52,-54.66 5608.78,-54.42 5617.11,-54.26 5625.5,-54.18 5633.91,-54.18 5642.3,-54.26"/>
<text text-anchor="middle" x="5629.71" y="-91.69" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="5629.71" y="-80.69" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="5629.71" y="-69.69" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- collect_res&#45;&gt;final_out -->
<g id="edge23" class="edge">
<title>collect_res&#45;&gt;final_out</title>
<path fill="none" stroke="black" d="M5404.3,-83.19C5431.85,-83.19 5459.65,-83.19 5485.86,-83.19"/>
<polygon fill="black" stroke="black" points="5486.21,-86.69 5496.21,-83.19 5486.21,-79.69 5486.21,-86.69"/>
</g>
</g>
</svg>
