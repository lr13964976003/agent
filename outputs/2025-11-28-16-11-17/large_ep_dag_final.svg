<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="5430pt" height="1596pt"
 viewBox="0.00 0.00 5430.31 1596.32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1592.32)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1592.32 5426.31,-1592.32 5426.31,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="none" stroke="black" d="M20,-922.32C20,-922.32 902.53,-922.32 902.53,-922.32 908.53,-922.32 914.53,-928.32 914.53,-934.32 914.53,-934.32 914.53,-1031.32 914.53,-1031.32 914.53,-1037.32 908.53,-1043.32 902.53,-1043.32 902.53,-1043.32 20,-1043.32 20,-1043.32 14,-1043.32 8,-1037.32 8,-1031.32 8,-1031.32 8,-934.32 8,-934.32 8,-928.32 14,-922.32 20,-922.32"/>
<text text-anchor="middle" x="461.26" y="-1028.12" font-family="Times,serif" font-size="14.00">Input Distribution Layer</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_gpu0</title>
<path fill="none" stroke="black" d="M1087.53,-1437.32C1087.53,-1437.32 2998.44,-1437.32 2998.44,-1437.32 3004.44,-1437.32 3010.44,-1443.32 3010.44,-1449.32 3010.44,-1449.32 3010.44,-1568.32 3010.44,-1568.32 3010.44,-1574.32 3004.44,-1580.32 2998.44,-1580.32 2998.44,-1580.32 1087.53,-1580.32 1087.53,-1580.32 1081.53,-1580.32 1075.53,-1574.32 1075.53,-1568.32 1075.53,-1568.32 1075.53,-1449.32 1075.53,-1449.32 1075.53,-1443.32 1081.53,-1437.32 1087.53,-1437.32"/>
<text text-anchor="middle" x="2042.98" y="-1565.12" font-family="Times,serif" font-size="14.00">GPU 0: Complete Processing Pipeline</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_gpu64</title>
<path fill="none" stroke="black" d="M1087.53,-1286.32C1087.53,-1286.32 2998.44,-1286.32 2998.44,-1286.32 3004.44,-1286.32 3010.44,-1292.32 3010.44,-1298.32 3010.44,-1298.32 3010.44,-1417.32 3010.44,-1417.32 3010.44,-1423.32 3004.44,-1429.32 2998.44,-1429.32 2998.44,-1429.32 1087.53,-1429.32 1087.53,-1429.32 1081.53,-1429.32 1075.53,-1423.32 1075.53,-1417.32 1075.53,-1417.32 1075.53,-1298.32 1075.53,-1298.32 1075.53,-1292.32 1081.53,-1286.32 1087.53,-1286.32"/>
<text text-anchor="middle" x="2042.98" y="-1414.12" font-family="Times,serif" font-size="14.00">GPU 64: Complete Processing Pipeline</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_gpu128</title>
<path fill="none" stroke="black" d="M1087.53,-1135.32C1087.53,-1135.32 2998.44,-1135.32 2998.44,-1135.32 3004.44,-1135.32 3010.44,-1141.32 3010.44,-1147.32 3010.44,-1147.32 3010.44,-1266.32 3010.44,-1266.32 3010.44,-1272.32 3004.44,-1278.32 2998.44,-1278.32 2998.44,-1278.32 1087.53,-1278.32 1087.53,-1278.32 1081.53,-1278.32 1075.53,-1272.32 1075.53,-1266.32 1075.53,-1266.32 1075.53,-1147.32 1075.53,-1147.32 1075.53,-1141.32 1081.53,-1135.32 1087.53,-1135.32"/>
<text text-anchor="middle" x="2042.98" y="-1263.12" font-family="Times,serif" font-size="14.00">GPU 128: Complete Processing Pipeline</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_communication</title>
<path fill="none" stroke="black" d="M2163.33,-422.32C2163.33,-422.32 3980.05,-422.32 3980.05,-422.32 3986.05,-422.32 3992.05,-428.32 3992.05,-434.32 3992.05,-434.32 3992.05,-1115.32 3992.05,-1115.32 3992.05,-1121.32 3986.05,-1127.32 3980.05,-1127.32 3980.05,-1127.32 2163.33,-1127.32 2163.33,-1127.32 2157.33,-1127.32 2151.33,-1121.32 2151.33,-1115.32 2151.33,-1115.32 2151.33,-434.32 2151.33,-434.32 2151.33,-428.32 2157.33,-422.32 2163.33,-422.32"/>
<text text-anchor="middle" x="3071.69" y="-1112.12" font-family="Times,serif" font-size="14.00">Cross&#45;Node Communication &amp; Token Routing</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_output</title>
<path fill="none" stroke="black" d="M3557.11,-271.32C3557.11,-271.32 5402.31,-271.32 5402.31,-271.32 5408.31,-271.32 5414.31,-277.32 5414.31,-283.32 5414.31,-283.32 5414.31,-402.32 5414.31,-402.32 5414.31,-408.32 5408.31,-414.32 5402.31,-414.32 5402.31,-414.32 3557.11,-414.32 3557.11,-414.32 3551.11,-414.32 3545.11,-408.32 3545.11,-402.32 3545.11,-402.32 3545.11,-283.32 3545.11,-283.32 3545.11,-277.32 3551.11,-271.32 3557.11,-271.32"/>
<text text-anchor="middle" x="4479.71" y="-399.12" font-family="Times,serif" font-size="14.00">Output Aggregation &#45; Final Layer</text>
</g>
<!-- input_tokens -->
<g id="node1" class="node">
<title>input_tokens</title>
<polygon fill="lightgray" stroke="black" points="124.59,-942.39 130.67,-942.55 136.69,-942.79 142.63,-943.11 148.45,-943.5 154.13,-943.97 159.66,-944.51 165.01,-945.13 170.17,-945.82 175.1,-946.58 179.8,-947.41 184.24,-948.3 188.42,-949.25 192.32,-950.27 195.92,-951.35 199.22,-952.47 202.22,-953.65 204.89,-954.88 207.25,-956.16 209.28,-957.47 210.99,-958.83 212.37,-960.21 213.42,-961.63 214.16,-963.08 214.58,-964.54 214.7,-966.03 214.51,-967.53 214.03,-969.04 213.27,-970.56 212.23,-972.08 210.93,-973.59 209.39,-975.1 207.6,-976.6 205.6,-978.09 203.38,-979.56 200.97,-981 198.37,-982.42 195.6,-983.81 192.68,-985.16 189.61,-986.48 186.42,-987.75 183.1,-988.98 179.67,-990.16 176.15,-991.29 172.55,-992.36 168.87,-993.38 165.12,-994.33 161.32,-995.23 157.46,-996.05 153.57,-996.81 149.63,-997.5 145.67,-998.12 141.68,-998.66 137.67,-999.13 133.64,-999.53 129.6,-999.84 125.55,-1000.08 121.49,-1000.24 117.43,-1000.32 113.37,-1000.32 109.31,-1000.24 105.25,-1000.08 101.2,-999.84 97.16,-999.53 93.13,-999.13 89.12,-998.66 85.13,-998.12 81.17,-997.5 77.23,-996.81 73.34,-996.05 69.48,-995.23 65.68,-994.33 61.93,-993.38 58.25,-992.36 54.64,-991.29 51.12,-990.16 47.7,-988.98 44.38,-987.75 41.19,-986.48 38.12,-985.16 35.19,-983.81 32.43,-982.42 29.83,-981 27.42,-979.56 25.2,-978.09 23.19,-976.6 21.41,-975.1 19.87,-973.59 18.57,-972.08 17.53,-970.56 16.77,-969.04 16.29,-967.53 16.1,-966.03 16.21,-964.54 16.64,-963.08 17.37,-961.63 18.43,-960.21 19.81,-958.83 21.52,-957.47 23.55,-956.16 25.9,-954.88 28.58,-953.65 31.57,-952.47 34.88,-951.35 38.48,-950.27 42.38,-949.25 46.56,-948.3 51,-947.41 55.7,-946.58 60.63,-945.82 65.78,-945.13 71.13,-944.51 76.66,-943.97 82.35,-943.5 88.17,-943.11 94.11,-942.79 100.13,-942.55 106.21,-942.39 112.33,-942.31 118.47,-942.31 124.59,-942.39"/>
<text text-anchor="middle" x="115.4" y="-979.82" font-family="Arial" font-size="10.00">Input Tokens</text>
<text text-anchor="middle" x="115.4" y="-968.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?]</text>
<text text-anchor="middle" x="115.4" y="-957.82" font-family="Arial" font-size="10.00">GPU: N/A</text>
</g>
<!-- token_split -->
<g id="node2" class="node">
<title>token_split</title>
<polygon fill="lightgreen" stroke="black" points="906.39,-1012.32 441.52,-1012.32 321.93,-930.32 786.8,-930.32 906.39,-1012.32"/>
<text text-anchor="middle" x="614.16" y="-979.82" font-family="Arial" font-size="10.00">Token Split</text>
<text text-anchor="middle" x="614.16" y="-968.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?] → [batch_size=?, seq_len=?/256]</text>
<text text-anchor="middle" x="614.16" y="-957.82" font-family="Arial" font-size="10.00">GPU: 0&#45;255</text>
</g>
<!-- input_tokens&#45;&gt;token_split -->
<g id="edge1" class="edge">
<title>input_tokens&#45;&gt;token_split</title>
<path fill="none" stroke="black" d="M212.77,-971.32C258.42,-971.32 315.2,-971.32 371.51,-971.32"/>
<polygon fill="black" stroke="black" points="371.65,-974.82 381.65,-971.32 371.65,-967.82 371.65,-974.82"/>
<text text-anchor="middle" x="268.3" y="-975.12" font-family="Times,serif" font-size="14.00">broadcast</text>
</g>
<!-- mla_0 -->
<g id="node3" class="node">
<title>mla_0</title>
<polygon fill="lightblue" stroke="black" points="1307.53,-1497.32 1083.53,-1497.32 1083.53,-1445.32 1307.53,-1445.32 1307.53,-1497.32"/>
<text text-anchor="middle" x="1195.53" y="-1485.32" font-family="Arial" font-size="10.00">MLA</text>
<text text-anchor="middle" x="1195.53" y="-1474.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, heads=128, d_k=56]</text>
<text text-anchor="middle" x="1195.53" y="-1463.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="1195.53" y="-1452.32" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- token_split&#45;&gt;mla_0 -->
<g id="edge2" class="edge">
<title>token_split&#45;&gt;mla_0</title>
<path fill="none" stroke="black" d="M644.25,-1012.64C710.17,-1103.17 880.48,-1319.93 1075.53,-1433.32 1080.27,-1436.08 1085.24,-1438.66 1090.35,-1441.08"/>
<polygon fill="black" stroke="black" points="1089.11,-1444.36 1099.66,-1445.25 1091.97,-1437.97 1089.11,-1444.36"/>
<text text-anchor="middle" x="995.03" y="-1428.12" font-family="Times,serif" font-size="14.00">tokens for GPU 0</text>
</g>
<!-- residual_add_0 -->
<g id="node5" class="node">
<title>residual_add_0</title>
<polygon fill="lightgreen" stroke="black" points="2657.56,-1549.32 2068.59,-1549.32 1917.08,-1445.32 2506.05,-1445.32 2657.56,-1549.32"/>
<text text-anchor="middle" x="2287.32" y="-1511.32" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="2287.32" y="-1500.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168] + [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-1489.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-1478.32" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- token_split&#45;&gt;residual_add_0 -->
<g id="edge5" class="edge">
<title>token_split&#45;&gt;residual_add_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M875.43,-990.83C1028.56,-1002.06 1226.01,-1016.13 1401.53,-1027.32 1456.8,-1030.84 1860.21,-1015.99 1899.2,-1055.32 1928.8,-1085.18 1889.37,-1401.8 1917.2,-1433.32 1918.57,-1434.87 1919.97,-1436.4 1921.38,-1437.89"/>
<polygon fill="black" stroke="black" points="1919.1,-1440.56 1928.65,-1445.14 1924.05,-1435.6 1919.1,-1440.56"/>
<text text-anchor="middle" x="1354.53" y="-1029.12" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- mla_64 -->
<g id="node7" class="node">
<title>mla_64</title>
<polygon fill="lightblue" stroke="black" points="1307.53,-1346.32 1083.53,-1346.32 1083.53,-1294.32 1307.53,-1294.32 1307.53,-1346.32"/>
<text text-anchor="middle" x="1195.53" y="-1334.32" font-family="Arial" font-size="10.00">MLA</text>
<text text-anchor="middle" x="1195.53" y="-1323.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, heads=128, d_k=56]</text>
<text text-anchor="middle" x="1195.53" y="-1312.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="1195.53" y="-1301.32" font-family="Arial" font-size="10.00">GPU: 64</text>
</g>
<!-- token_split&#45;&gt;mla_64 -->
<g id="edge7" class="edge">
<title>token_split&#45;&gt;mla_64</title>
<path fill="none" stroke="black" d="M665.37,-1012.37C746.97,-1077.4 915.41,-1204.65 1075.53,-1282.32 1081.49,-1285.21 1087.73,-1287.95 1094.09,-1290.54"/>
<polygon fill="black" stroke="black" points="1092.89,-1293.83 1103.48,-1294.23 1095.45,-1287.32 1092.89,-1293.83"/>
<text text-anchor="middle" x="995.03" y="-1279.12" font-family="Times,serif" font-size="14.00">tokens for GPU 64</text>
</g>
<!-- residual_add_64 -->
<g id="node9" class="node">
<title>residual_add_64</title>
<polygon fill="lightgreen" stroke="black" points="2657.56,-1398.32 2068.59,-1398.32 1917.08,-1294.32 2506.05,-1294.32 2657.56,-1398.32"/>
<text text-anchor="middle" x="2287.32" y="-1360.32" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="2287.32" y="-1349.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168] + [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-1338.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-1327.32" font-family="Arial" font-size="10.00">GPU: 64</text>
</g>
<!-- token_split&#45;&gt;residual_add_64 -->
<g id="edge10" class="edge">
<title>token_split&#45;&gt;residual_add_64</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M827.6,-958.08C1143.58,-940.24 1708.81,-916.11 1787.2,-966.32 1802.26,-975.96 1791.5,-990.81 1805.2,-1002.32 1838.59,-1030.34 1871.91,-996.32 1899.2,-1030.32 1934.34,-1074.1 1879.54,-1240.68 1917.2,-1282.32 1918.59,-1283.85 1920,-1285.36 1921.44,-1286.84"/>
<polygon fill="black" stroke="black" points="1919.19,-1289.54 1928.79,-1294.02 1924.08,-1284.53 1919.19,-1289.54"/>
<text text-anchor="middle" x="1354.53" y="-941.12" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- mla_128 -->
<g id="node11" class="node">
<title>mla_128</title>
<polygon fill="lightblue" stroke="black" points="1307.53,-1195.32 1083.53,-1195.32 1083.53,-1143.32 1307.53,-1143.32 1307.53,-1195.32"/>
<text text-anchor="middle" x="1195.53" y="-1183.32" font-family="Arial" font-size="10.00">MLA</text>
<text text-anchor="middle" x="1195.53" y="-1172.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, heads=128, d_k=56]</text>
<text text-anchor="middle" x="1195.53" y="-1161.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="1195.53" y="-1150.32" font-family="Arial" font-size="10.00">GPU: 128</text>
</g>
<!-- token_split&#45;&gt;mla_128 -->
<g id="edge12" class="edge">
<title>token_split&#45;&gt;mla_128</title>
<path fill="none" stroke="black" d="M735.21,-1012.34C846.67,-1050.44 1009.88,-1106.21 1108.76,-1140"/>
<polygon fill="black" stroke="black" points="1107.83,-1143.38 1118.42,-1143.31 1110.09,-1136.76 1107.83,-1143.38"/>
<text text-anchor="middle" x="995.03" y="-1125.12" font-family="Times,serif" font-size="14.00">tokens for GPU 128</text>
</g>
<!-- residual_add_128 -->
<g id="node13" class="node">
<title>residual_add_128</title>
<polygon fill="lightgreen" stroke="black" points="2657.56,-1247.32 2068.59,-1247.32 1917.08,-1143.32 2506.05,-1143.32 2657.56,-1247.32"/>
<text text-anchor="middle" x="2287.32" y="-1209.32" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="2287.32" y="-1198.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168] + [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-1187.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-1176.32" font-family="Arial" font-size="10.00">GPU: 128</text>
</g>
<!-- token_split&#45;&gt;residual_add_128 -->
<g id="edge15" class="edge">
<title>token_split&#45;&gt;residual_add_128</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M801.75,-940.35C1091.35,-896.48 1631.91,-832.61 1787.2,-938.32 1802.98,-949.06 1790.77,-964.82 1805.2,-977.32 1838.15,-1005.86 1870.73,-972.3 1899.2,-1005.32 1936.14,-1048.16 1877.8,-1090.73 1917.2,-1131.32 1918.86,-1133.02 1920.54,-1134.69 1922.25,-1136.33"/>
<polygon fill="black" stroke="black" points="1920.16,-1139.16 1929.92,-1143.28 1924.86,-1133.97 1920.16,-1139.16"/>
<text text-anchor="middle" x="1354.53" y="-887.12" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- mla_192 -->
<g id="node27" class="node">
<title>mla_192</title>
<polygon fill="lightblue" stroke="black" points="3017.44,-637.32 2793.44,-637.32 2793.44,-585.32 3017.44,-585.32 3017.44,-637.32"/>
<text text-anchor="middle" x="2905.44" y="-625.32" font-family="Arial" font-size="10.00">MLA</text>
<text text-anchor="middle" x="2905.44" y="-614.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, heads=128, d_k=56]</text>
<text text-anchor="middle" x="2905.44" y="-603.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2905.44" y="-592.32" font-family="Arial" font-size="10.00">GPU: 192</text>
</g>
<!-- token_split&#45;&gt;mla_192 -->
<g id="edge43" class="edge">
<title>token_split&#45;&gt;mla_192</title>
<path fill="none" stroke="black" d="M625.17,-930.09C665.87,-773.49 834.28,-224.32 1194.53,-224.32 1194.53,-224.32 1194.53,-224.32 2288.32,-224.32 2342.47,-224.32 2736.3,-200.9 2775.44,-238.32 2814.59,-275.73 2772.84,-431.24 2793.44,-481.32 2809.05,-519.25 2840.15,-554.11 2865.48,-578.16"/>
<polygon fill="black" stroke="black" points="2863.42,-581.03 2873.13,-585.27 2868.18,-575.9 2863.42,-581.03"/>
<text text-anchor="middle" x="1594.36" y="-228.12" font-family="Times,serif" font-size="14.00">tokens for GPU 192</text>
</g>
<!-- residual_add_192 -->
<g id="node29" class="node">
<title>residual_add_192</title>
<polygon fill="lightgreen" stroke="black" points="4293.48,-383.32 3704.5,-383.32 3552.99,-279.32 4141.96,-279.32 4293.48,-383.32"/>
<text text-anchor="middle" x="3923.23" y="-345.32" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="3923.23" y="-334.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168] + [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="3923.23" y="-323.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="3923.23" y="-312.32" font-family="Arial" font-size="10.00">GPU: 192</text>
</g>
<!-- token_split&#45;&gt;residual_add_192 -->
<g id="edge46" class="edge">
<title>token_split&#45;&gt;residual_add_192</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M621.21,-930.02C641.2,-808.01 716.15,-445.2 924.53,-245.32 1017.1,-156.52 1066.25,-143.32 1194.53,-143.32 1194.53,-143.32 1194.53,-143.32 1853.2,-143.32 2576.72,-143.32 2780.37,-50.9 3478.11,-242.32 3509.94,-251.05 3513.57,-264.63 3545.11,-274.32 3547.45,-275.03 3549.8,-275.74 3552.16,-276.44"/>
<polygon fill="black" stroke="black" points="3551.33,-279.84 3561.91,-279.27 3553.28,-273.12 3551.33,-279.84"/>
<text text-anchor="middle" x="2287.32" y="-146.12" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- gate_0 -->
<g id="node4" class="node">
<title>gate_0</title>
<polygon fill="lightgreen" stroke="black" points="1787.04,-1549.32 1480.54,-1549.32 1401.69,-1445.32 1708.19,-1445.32 1787.04,-1549.32"/>
<text text-anchor="middle" x="1594.36" y="-1511.32" font-family="Arial" font-size="10.00">Expert Gating</text>
<text text-anchor="middle" x="1594.36" y="-1500.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="1594.36" y="-1489.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, top_k=2]</text>
<text text-anchor="middle" x="1594.36" y="-1478.32" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- mla_0&#45;&gt;gate_0 -->
<g id="edge3" class="edge">
<title>mla_0&#45;&gt;gate_0</title>
<path fill="none" stroke="black" d="M1307.6,-1478.59C1343.27,-1480.93 1383.66,-1483.58 1422.59,-1486.13"/>
<polygon fill="black" stroke="black" points="1422.78,-1489.65 1432.99,-1486.81 1423.24,-1482.66 1422.78,-1489.65"/>
</g>
<!-- gate_0&#45;&gt;residual_add_0 -->
<g id="edge4" class="edge">
<title>gate_0&#45;&gt;residual_add_0</title>
<path fill="none" stroke="black" d="M1747.85,-1497.32C1816.93,-1497.32 1901.16,-1497.32 1982.3,-1497.32"/>
<polygon fill="black" stroke="black" points="1982.7,-1500.82 1992.7,-1497.32 1982.7,-1493.82 1982.7,-1500.82"/>
</g>
<!-- route_0_to_64 -->
<g id="node15" class="node">
<title>route_0_to_64</title>
<ellipse fill="lightyellow" stroke="black" cx="2287.32" cy="-991.32" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2287.32" y="-999.82" font-family="Arial" font-size="10.00">Route Tokens</text>
<text text-anchor="middle" x="2287.32" y="-988.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-977.82" font-family="Arial" font-size="10.00">GPU: 0→64</text>
</g>
<!-- gate_0&#45;&gt;route_0_to_64 -->
<g id="edge17" class="edge">
<title>gate_0&#45;&gt;route_0_to_64</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1730.77,-1474.91C1752.63,-1465.47 1772.78,-1452.13 1787.2,-1433.32 1828.5,-1379.42 1775.49,-1189.37 1805.2,-1128.32 1834.27,-1068.58 1856.35,-1055.99 1917.2,-1029.32 1990.45,-997.2 2079.48,-987.29 2151.74,-985.61"/>
<polygon fill="black" stroke="black" points="2151.89,-989.11 2161.83,-985.43 2151.76,-982.11 2151.89,-989.11"/>
<text text-anchor="middle" x="1852.2" y="-1132.12" font-family="Times,serif" font-size="14.00">select tokens</text>
</g>
<!-- route_0_to_128 -->
<g id="node16" class="node">
<title>route_0_to_128</title>
<ellipse fill="lightyellow" stroke="black" cx="2287.32" cy="-915.32" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2287.32" y="-923.82" font-family="Arial" font-size="10.00">Route Tokens</text>
<text text-anchor="middle" x="2287.32" y="-912.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-901.82" font-family="Arial" font-size="10.00">GPU: 0→128</text>
</g>
<!-- gate_0&#45;&gt;route_0_to_128 -->
<g id="edge18" class="edge">
<title>gate_0&#45;&gt;route_0_to_128</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1731.01,-1475.1C1752.85,-1465.63 1772.93,-1452.24 1787.2,-1433.32 1814.92,-1396.55 1781.49,-1058.79 1805.2,-1019.32 1834.95,-969.79 1862.31,-971.36 1917.2,-953.32 1991.43,-928.92 2078.17,-919.11 2148.92,-915.54"/>
<polygon fill="black" stroke="black" points="2149.41,-919.02 2159.23,-915.06 2149.08,-912.03 2149.41,-919.02"/>
<text text-anchor="middle" x="1852.2" y="-1023.12" font-family="Times,serif" font-size="14.00">select tokens</text>
</g>
<!-- route_0_to_192 -->
<g id="node17" class="node">
<title>route_0_to_192</title>
<ellipse fill="lightyellow" stroke="black" cx="2287.32" cy="-1067.32" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2287.32" y="-1075.82" font-family="Arial" font-size="10.00">Route Tokens</text>
<text text-anchor="middle" x="2287.32" y="-1064.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-1053.82" font-family="Arial" font-size="10.00">GPU: 0→192</text>
</g>
<!-- gate_0&#45;&gt;route_0_to_192 -->
<g id="edge19" class="edge">
<title>gate_0&#45;&gt;route_0_to_192</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1727.33,-1469.79C1749.12,-1460.84 1770.14,-1448.99 1787.2,-1433.32 1894.8,-1334.44 1802.48,-1221.83 1917.2,-1131.32 1983.17,-1079.27 2076.57,-1063.45 2152.91,-1060.56"/>
<polygon fill="black" stroke="black" points="2153.2,-1064.05 2163.08,-1060.24 2152.98,-1057.05 2153.2,-1064.05"/>
<text text-anchor="middle" x="1852.2" y="-1413.12" font-family="Times,serif" font-size="14.00">select tokens</text>
</g>
<!-- coord_0_64 -->
<g id="node24" class="node">
<title>coord_0_64</title>
<ellipse fill="lightyellow" stroke="black" cx="2905.44" cy="-451.32" rx="50.41" ry="21.43"/>
<text text-anchor="middle" x="2905.44" y="-454.32" font-family="Arial" font-size="10.00">Coordination</text>
<text text-anchor="middle" x="2905.44" y="-443.32" font-family="Arial" font-size="10.00">GPU: 0↔64</text>
</g>
<!-- gate_0&#45;&gt;coord_0_64 -->
<g id="edge35" class="edge">
<title>gate_0&#45;&gt;coord_0_64</title>
<path fill="none" stroke="black" d="M1731.31,-1475.31C1753.12,-1465.83 1773.11,-1452.37 1787.2,-1433.32 1811.58,-1400.34 1794.06,-734.79 1805.2,-695.32 1827.81,-615.2 1871.97,-611.98 1899.2,-533.32 1908.52,-506.38 1895.68,-425 1917.2,-406.32 1979.3,-352.39 2575.53,-398.92 2657.44,-406.32 2725.06,-412.43 2801.84,-427.76 2851.6,-438.83"/>
<polygon fill="black" stroke="black" points="2850.96,-442.28 2861.48,-441.06 2852.5,-435.45 2850.96,-442.28"/>
<text text-anchor="middle" x="2287.32" y="-410.12" font-family="Times,serif" font-size="14.00">sync</text>
</g>
<!-- expert_0 -->
<g id="node6" class="node">
<title>expert_0</title>
<polygon fill="lightblue" stroke="black" points="3002.44,-1510.32 2808.44,-1510.32 2808.44,-1458.32 3002.44,-1458.32 3002.44,-1510.32"/>
<text text-anchor="middle" x="2905.44" y="-1498.32" font-family="Arial" font-size="10.00">Expert MLP 0</text>
<text text-anchor="middle" x="2905.44" y="-1487.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2905.44" y="-1476.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2905.44" y="-1465.32" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- residual_add_0&#45;&gt;expert_0 -->
<g id="edge6" class="edge">
<title>residual_add_0&#45;&gt;expert_0</title>
<path fill="none" stroke="black" d="M2573.39,-1491.3C2653.51,-1489.61 2735.73,-1487.88 2798.18,-1486.56"/>
<polygon fill="black" stroke="black" points="2798.5,-1490.05 2808.42,-1486.34 2798.35,-1483.05 2798.5,-1490.05"/>
</g>
<!-- collect_all -->
<g id="node31" class="node">
<title>collect_all</title>
<polygon fill="lightgreen" stroke="black" points="5096.9,-383.32 4751.92,-383.32 4663.17,-279.32 5008.15,-279.32 5096.9,-383.32"/>
<text text-anchor="middle" x="4880.04" y="-345.32" font-family="Arial" font-size="10.00">Gather All Results</text>
<text text-anchor="middle" x="4880.04" y="-334.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168] × 256</text>
<text text-anchor="middle" x="4880.04" y="-323.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="4880.04" y="-312.32" font-family="Arial" font-size="10.00">GPU: 0&#45;255</text>
</g>
<!-- expert_0&#45;&gt;collect_all -->
<g id="edge48" class="edge">
<title>expert_0&#45;&gt;collect_all</title>
<path fill="none" stroke="black" d="M3002.5,-1466.49C3136.02,-1436.02 3373.1,-1359.93 3478.11,-1190.32 3500.7,-1153.84 3487.97,-460.44 3496.11,-418.32 3505.49,-369.85 3522.26,-361.98 3535.11,-314.32 3538.57,-301.48 3534.95,-263.9 3545.11,-255.32 3608.62,-201.67 4210.39,-249.96 4293.36,-255.32 4418.75,-263.42 4558.31,-281.18 4669.73,-297.5"/>
<polygon fill="black" stroke="black" points="4669.34,-300.98 4679.74,-298.97 4670.36,-294.05 4669.34,-300.98"/>
<text text-anchor="middle" x="3923.23" y="-259.12" font-family="Times,serif" font-size="14.00">from GPU 0</text>
</g>
<!-- gate_64 -->
<g id="node8" class="node">
<title>gate_64</title>
<polygon fill="lightgreen" stroke="black" points="1787.04,-1398.32 1480.54,-1398.32 1401.69,-1294.32 1708.19,-1294.32 1787.04,-1398.32"/>
<text text-anchor="middle" x="1594.36" y="-1360.32" font-family="Arial" font-size="10.00">Expert Gating</text>
<text text-anchor="middle" x="1594.36" y="-1349.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="1594.36" y="-1338.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, top_k=2]</text>
<text text-anchor="middle" x="1594.36" y="-1327.32" font-family="Arial" font-size="10.00">GPU: 64</text>
</g>
<!-- mla_64&#45;&gt;gate_64 -->
<g id="edge8" class="edge">
<title>mla_64&#45;&gt;gate_64</title>
<path fill="none" stroke="black" d="M1307.6,-1327.59C1343.27,-1329.93 1383.66,-1332.58 1422.59,-1335.13"/>
<polygon fill="black" stroke="black" points="1422.78,-1338.65 1432.99,-1335.81 1423.24,-1331.66 1422.78,-1338.65"/>
</g>
<!-- gate_64&#45;&gt;residual_add_64 -->
<g id="edge9" class="edge">
<title>gate_64&#45;&gt;residual_add_64</title>
<path fill="none" stroke="black" d="M1747.85,-1346.32C1816.93,-1346.32 1901.16,-1346.32 1982.3,-1346.32"/>
<polygon fill="black" stroke="black" points="1982.7,-1349.82 1992.7,-1346.32 1982.7,-1342.82 1982.7,-1349.82"/>
</g>
<!-- route_64_to_0 -->
<g id="node18" class="node">
<title>route_64_to_0</title>
<ellipse fill="lightyellow" stroke="black" cx="2287.32" cy="-763.32" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2287.32" y="-771.82" font-family="Arial" font-size="10.00">Route Tokens</text>
<text text-anchor="middle" x="2287.32" y="-760.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-749.82" font-family="Arial" font-size="10.00">GPU: 64→0</text>
</g>
<!-- gate_64&#45;&gt;route_64_to_0 -->
<g id="edge20" class="edge">
<title>gate_64&#45;&gt;route_64_to_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1730.99,-1324.08C1752.83,-1314.61 1772.92,-1301.23 1787.2,-1282.32 1814.01,-1246.82 1776.26,-916.11 1805.2,-882.32 1832.92,-849.94 1867.83,-892.18 1899.2,-863.32 1920.31,-843.89 1895.17,-819.7 1917.2,-801.32 1988.11,-742.14 2095.37,-737.33 2176.02,-744.55"/>
<polygon fill="black" stroke="black" points="2175.93,-748.05 2186.22,-745.54 2176.6,-741.09 2175.93,-748.05"/>
<text text-anchor="middle" x="1852.2" y="-886.12" font-family="Times,serif" font-size="14.00">select tokens</text>
</g>
<!-- route_64_to_128 -->
<g id="node19" class="node">
<title>route_64_to_128</title>
<ellipse fill="lightyellow" stroke="black" cx="2287.32" cy="-687.32" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2287.32" y="-695.82" font-family="Arial" font-size="10.00">Route Tokens</text>
<text text-anchor="middle" x="2287.32" y="-684.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-673.82" font-family="Arial" font-size="10.00">GPU: 64→128</text>
</g>
<!-- gate_64&#45;&gt;route_64_to_128 -->
<g id="edge21" class="edge">
<title>gate_64&#45;&gt;route_64_to_128</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1731.05,-1324.12C1752.88,-1314.66 1772.95,-1301.25 1787.2,-1282.32 1816.48,-1243.39 1778.22,-884.87 1805.2,-844.32 1830.75,-805.91 1870.04,-836.06 1899.2,-800.32 1920.87,-773.75 1891.4,-747.89 1917.2,-725.32 1987.4,-663.88 2096.29,-659.79 2177.63,-667.82"/>
<polygon fill="black" stroke="black" points="2177.6,-671.34 2187.91,-668.92 2178.34,-664.38 2177.6,-671.34"/>
<text text-anchor="middle" x="1852.2" y="-848.12" font-family="Times,serif" font-size="14.00">select tokens</text>
</g>
<!-- route_64_to_192 -->
<g id="node20" class="node">
<title>route_64_to_192</title>
<ellipse fill="lightyellow" stroke="black" cx="2287.32" cy="-839.32" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2287.32" y="-847.82" font-family="Arial" font-size="10.00">Route Tokens</text>
<text text-anchor="middle" x="2287.32" y="-836.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-825.82" font-family="Arial" font-size="10.00">GPU: 64→192</text>
</g>
<!-- gate_64&#45;&gt;route_64_to_192 -->
<g id="edge22" class="edge">
<title>gate_64&#45;&gt;route_64_to_192</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1730.91,-1324.02C1752.75,-1314.56 1772.87,-1301.19 1787.2,-1282.32 1835.38,-1218.88 1754.46,-985.72 1805.2,-924.32 1832.59,-891.16 1863.31,-925.02 1899.2,-901.32 1910.33,-893.97 1905.6,-883.88 1917.2,-877.32 1990.03,-836.11 2083.98,-826.93 2158.87,-827.89"/>
<polygon fill="black" stroke="black" points="2159.24,-831.4 2169.3,-828.09 2159.37,-824.4 2159.24,-831.4"/>
<text text-anchor="middle" x="1852.2" y="-928.12" font-family="Times,serif" font-size="14.00">select tokens</text>
</g>
<!-- gate_64&#45;&gt;coord_0_64 -->
<g id="edge36" class="edge">
<title>gate_64&#45;&gt;coord_0_64</title>
<path fill="none" stroke="black" d="M1731.32,-1324.33C1753.13,-1314.84 1773.12,-1301.38 1787.2,-1282.32 1812.75,-1247.71 1791.04,-548.93 1805.2,-508.32 1832.36,-430.43 1843.34,-397.05 1917.2,-360.32 2064.49,-287.07 2493.7,-344.51 2657.44,-360.32 2710.63,-365.45 2725.05,-365.56 2775.44,-383.32 2808.19,-394.86 2842.88,-413.55 2868.02,-428.42"/>
<polygon fill="black" stroke="black" points="2866.46,-431.56 2876.84,-433.7 2870.06,-425.56 2866.46,-431.56"/>
<text text-anchor="middle" x="2287.32" y="-364.12" font-family="Times,serif" font-size="14.00">sync</text>
</g>
<!-- coord_64_128 -->
<g id="node25" class="node">
<title>coord_64_128</title>
<ellipse fill="lightyellow" stroke="black" cx="3285.28" cy="-451.32" rx="56.64" ry="21.43"/>
<text text-anchor="middle" x="3285.28" y="-454.32" font-family="Arial" font-size="10.00">Coordination</text>
<text text-anchor="middle" x="3285.28" y="-443.32" font-family="Arial" font-size="10.00">GPU: 64↔128</text>
</g>
<!-- gate_64&#45;&gt;coord_64_128 -->
<g id="edge38" class="edge">
<title>gate_64&#45;&gt;coord_64_128</title>
<path fill="none" stroke="black" d="M1731.38,-1324.37C1753.18,-1314.88 1773.16,-1301.41 1787.2,-1282.32 1817.39,-1241.27 1776.41,-407.36 1805.2,-365.32 1968.05,-127.46 2979.6,-372.04 3228.83,-436.6"/>
<polygon fill="black" stroke="black" points="3228.19,-440.05 3238.75,-439.18 3229.95,-433.28 3228.19,-440.05"/>
<text text-anchor="middle" x="2725.44" y="-337.12" font-family="Times,serif" font-size="14.00">sync</text>
</g>
<!-- expert_64 -->
<g id="node10" class="node">
<title>expert_64</title>
<polygon fill="lightblue" stroke="black" points="3002.44,-1359.32 2808.44,-1359.32 2808.44,-1307.32 3002.44,-1307.32 3002.44,-1359.32"/>
<text text-anchor="middle" x="2905.44" y="-1347.32" font-family="Arial" font-size="10.00">Expert MLP 64</text>
<text text-anchor="middle" x="2905.44" y="-1336.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2905.44" y="-1325.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2905.44" y="-1314.32" font-family="Arial" font-size="10.00">GPU: 64</text>
</g>
<!-- residual_add_64&#45;&gt;expert_64 -->
<g id="edge11" class="edge">
<title>residual_add_64&#45;&gt;expert_64</title>
<path fill="none" stroke="black" d="M2573.39,-1340.3C2653.51,-1338.61 2735.73,-1336.88 2798.18,-1335.56"/>
<polygon fill="black" stroke="black" points="2798.5,-1339.05 2808.42,-1335.34 2798.35,-1332.05 2798.5,-1339.05"/>
</g>
<!-- expert_64&#45;&gt;collect_all -->
<g id="edge49" class="edge">
<title>expert_64&#45;&gt;collect_all</title>
<path fill="none" stroke="black" d="M2986.96,-1307.18C2998.45,-1300.57 3009.16,-1292.39 3017.44,-1282.32 3039.2,-1255.83 3009.63,-1229.88 3035.44,-1207.32 3109.89,-1142.25 3411.01,-1234.94 3478.11,-1162.32 3508.51,-1129.42 3488.09,-400.38 3496.11,-356.32 3505.48,-304.87 3519.44,-295.2 3535.11,-245.32 3540.09,-229.47 3531.89,-219.36 3545.11,-209.32 3642.46,-135.32 4526.38,-204.08 4645.36,-232.32 4686.46,-242.07 4729.55,-258.4 4767.37,-275.02"/>
<polygon fill="black" stroke="black" points="4766.31,-278.38 4776.87,-279.25 4769.16,-271.98 4766.31,-278.38"/>
<text text-anchor="middle" x="3923.23" y="-213.12" font-family="Times,serif" font-size="14.00">from GPU 64</text>
</g>
<!-- gate_128 -->
<g id="node12" class="node">
<title>gate_128</title>
<polygon fill="lightgreen" stroke="black" points="1787.04,-1247.32 1480.54,-1247.32 1401.69,-1143.32 1708.19,-1143.32 1787.04,-1247.32"/>
<text text-anchor="middle" x="1594.36" y="-1209.32" font-family="Arial" font-size="10.00">Expert Gating</text>
<text text-anchor="middle" x="1594.36" y="-1198.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="1594.36" y="-1187.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, top_k=2]</text>
<text text-anchor="middle" x="1594.36" y="-1176.32" font-family="Arial" font-size="10.00">GPU: 128</text>
</g>
<!-- mla_128&#45;&gt;gate_128 -->
<g id="edge13" class="edge">
<title>mla_128&#45;&gt;gate_128</title>
<path fill="none" stroke="black" d="M1307.6,-1176.59C1343.27,-1178.93 1383.66,-1181.58 1422.59,-1184.13"/>
<polygon fill="black" stroke="black" points="1422.78,-1187.65 1432.99,-1184.81 1423.24,-1180.66 1422.78,-1187.65"/>
</g>
<!-- gate_128&#45;&gt;residual_add_128 -->
<g id="edge14" class="edge">
<title>gate_128&#45;&gt;residual_add_128</title>
<path fill="none" stroke="black" d="M1747.85,-1195.32C1816.93,-1195.32 1901.16,-1195.32 1982.3,-1195.32"/>
<polygon fill="black" stroke="black" points="1982.7,-1198.82 1992.7,-1195.32 1982.7,-1191.82 1982.7,-1198.82"/>
</g>
<!-- route_128_to_0 -->
<g id="node21" class="node">
<title>route_128_to_0</title>
<ellipse fill="lightyellow" stroke="black" cx="2287.32" cy="-535.32" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2287.32" y="-543.82" font-family="Arial" font-size="10.00">Route Tokens</text>
<text text-anchor="middle" x="2287.32" y="-532.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-521.82" font-family="Arial" font-size="10.00">GPU: 128→0</text>
</g>
<!-- gate_128&#45;&gt;route_128_to_0 -->
<g id="edge23" class="edge">
<title>gate_128&#45;&gt;route_128_to_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1676.08,-1143.15C1717,-1111.96 1763.03,-1068.46 1787.2,-1017.32 1815.64,-957.13 1761.52,-768.55 1805.2,-718.32 1833.17,-686.15 1869.94,-730.31 1899.2,-699.32 1938.03,-658.18 1876.42,-612.52 1917.2,-573.32 1986.03,-507.14 2098.9,-504.85 2181.74,-514.66"/>
<polygon fill="black" stroke="black" points="2181.33,-518.14 2191.69,-515.91 2182.2,-511.19 2181.33,-518.14"/>
<text text-anchor="middle" x="1852.2" y="-722.12" font-family="Times,serif" font-size="14.00">select tokens</text>
</g>
<!-- route_128_to_64 -->
<g id="node22" class="node">
<title>route_128_to_64</title>
<ellipse fill="lightyellow" stroke="black" cx="2287.32" cy="-459.32" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2287.32" y="-467.82" font-family="Arial" font-size="10.00">Route Tokens</text>
<text text-anchor="middle" x="2287.32" y="-456.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-445.82" font-family="Arial" font-size="10.00">GPU: 128→64</text>
</g>
<!-- gate_128&#45;&gt;route_128_to_64 -->
<g id="edge24" class="edge">
<title>gate_128&#45;&gt;route_128_to_64</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1676.22,-1143.21C1717.18,-1112.04 1763.2,-1068.54 1787.2,-1017.32 1819.01,-949.4 1782.94,-751.93 1805.2,-680.32 1833.5,-589.25 1836.51,-548.14 1917.2,-497.32 1989.84,-451.56 2086.88,-443.15 2163.24,-445.59"/>
<polygon fill="black" stroke="black" points="2163.26,-449.1 2173.39,-445.99 2163.53,-442.1 2163.26,-449.1"/>
<text text-anchor="middle" x="1852.2" y="-684.12" font-family="Times,serif" font-size="14.00">select tokens</text>
</g>
<!-- route_128_to_192 -->
<g id="node23" class="node">
<title>route_128_to_192</title>
<ellipse fill="lightyellow" stroke="black" cx="2287.32" cy="-611.32" rx="127.97" ry="28.98"/>
<text text-anchor="middle" x="2287.32" y="-619.82" font-family="Arial" font-size="10.00">Route Tokens</text>
<text text-anchor="middle" x="2287.32" y="-608.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2287.32" y="-597.82" font-family="Arial" font-size="10.00">GPU: 128→192</text>
</g>
<!-- gate_128&#45;&gt;route_128_to_192 -->
<g id="edge25" class="edge">
<title>gate_128&#45;&gt;route_128_to_192</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1675.73,-1142.98C1716.54,-1111.74 1762.59,-1068.25 1787.2,-1017.32 1809.7,-970.76 1776.51,-828.34 1805.2,-785.32 1831.22,-746.29 1870.8,-774.65 1899.2,-737.32 1923.37,-705.54 1887.61,-676.11 1917.2,-649.32 1987,-586.12 2097.41,-582.7 2179.31,-591.4"/>
<polygon fill="black" stroke="black" points="2179.07,-594.89 2189.41,-592.54 2179.87,-587.94 2179.07,-594.89"/>
<text text-anchor="middle" x="1852.2" y="-789.12" font-family="Times,serif" font-size="14.00">select tokens</text>
</g>
<!-- gate_128&#45;&gt;coord_64_128 -->
<g id="edge39" class="edge">
<title>gate_128&#45;&gt;coord_64_128</title>
<path fill="none" stroke="black" d="M1733.14,-1175.44C1754.21,-1166.44 1773.47,-1153.59 1787.2,-1135.32 1815.54,-1097.6 1771.93,-319.76 1805.2,-286.32 1904.66,-186.33 2943.04,-235.11 3074.44,-286.32 3151.44,-316.32 3222.98,-384.58 3259.31,-423.24"/>
<polygon fill="black" stroke="black" points="3257.15,-426.07 3266.51,-431.02 3262.28,-421.31 3257.15,-426.07"/>
<text text-anchor="middle" x="2725.44" y="-249.12" font-family="Times,serif" font-size="14.00">sync</text>
</g>
<!-- coord_128_192 -->
<g id="node26" class="node">
<title>coord_128_192</title>
<ellipse fill="lightyellow" stroke="black" cx="3923.23" cy="-451.32" rx="60.62" ry="21.43"/>
<text text-anchor="middle" x="3923.23" y="-454.32" font-family="Arial" font-size="10.00">Coordination</text>
<text text-anchor="middle" x="3923.23" y="-443.32" font-family="Arial" font-size="10.00">GPU: 128↔192</text>
</g>
<!-- gate_128&#45;&gt;coord_128_192 -->
<g id="edge41" class="edge">
<title>gate_128&#45;&gt;coord_128_192</title>
<path fill="none" stroke="black" d="M1733.15,-1175.46C1754.22,-1166.45 1773.48,-1153.6 1787.2,-1135.32 1816.79,-1095.9 1773.99,-286.46 1805.2,-248.32 1890.5,-144.06 2885.4,-201.6 3017.44,-228.32 3261.75,-277.75 3301.67,-364.78 3545.11,-418.32 3650.41,-441.47 3775.6,-448.5 3851.96,-450.56"/>
<polygon fill="black" stroke="black" points="3852.32,-454.07 3862.4,-450.82 3852.49,-447.08 3852.32,-454.07"/>
<text text-anchor="middle" x="2905.44" y="-232.12" font-family="Times,serif" font-size="14.00">sync</text>
</g>
<!-- expert_128 -->
<g id="node14" class="node">
<title>expert_128</title>
<polygon fill="lightblue" stroke="black" points="3002.44,-1208.32 2808.44,-1208.32 2808.44,-1156.32 3002.44,-1156.32 3002.44,-1208.32"/>
<text text-anchor="middle" x="2905.44" y="-1196.32" font-family="Arial" font-size="10.00">Expert MLP 128</text>
<text text-anchor="middle" x="2905.44" y="-1185.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2905.44" y="-1174.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="2905.44" y="-1163.32" font-family="Arial" font-size="10.00">GPU: 128</text>
</g>
<!-- residual_add_128&#45;&gt;expert_128 -->
<g id="edge16" class="edge">
<title>residual_add_128&#45;&gt;expert_128</title>
<path fill="none" stroke="black" d="M2573.39,-1189.3C2653.51,-1187.61 2735.73,-1185.88 2798.18,-1184.56"/>
<polygon fill="black" stroke="black" points="2798.5,-1188.05 2808.42,-1184.34 2798.35,-1181.05 2798.5,-1188.05"/>
</g>
<!-- expert_128&#45;&gt;collect_all -->
<g id="edge50" class="edge">
<title>expert_128&#45;&gt;collect_all</title>
<path fill="none" stroke="black" d="M3002.58,-1172.47C3013.66,-1171.38 3024.8,-1170.31 3035.44,-1169.32 3084.59,-1164.73 3444.34,-1167.32 3478.11,-1131.32 3509.82,-1097.51 3487.8,-342.91 3496.11,-297.32 3507.86,-232.87 3491.65,-196.16 3545.11,-158.32 3944.33,124.25 4180.77,-28.41 4645.36,-181.32 4705.28,-201.04 4765,-239.79 4809.06,-272.96"/>
<polygon fill="black" stroke="black" points="4807.03,-275.81 4817.11,-279.09 4811.27,-270.25 4807.03,-275.81"/>
<text text-anchor="middle" x="3923.23" y="-162.12" font-family="Times,serif" font-size="14.00">from GPU 128</text>
</g>
<!-- route_0_to_64&#45;&gt;mla_64 -->
<g id="edge26" class="edge">
<title>route_0_to_64&#45;&gt;mla_64</title>
<path fill="none" stroke="black" d="M2192.54,-1010.93C2108.7,-1022.49 1988.4,-1023.33 1917.2,-953.32 1869.32,-906.24 1949.43,-847.88 1899.2,-803.32 1850.95,-760.51 1367.9,-843.68 1325.53,-892.32 1297.03,-925.02 1333.56,-1247.61 1307.53,-1282.32 1306.29,-1283.97 1304.98,-1285.54 1303.6,-1287.06"/>
<polygon fill="black" stroke="black" points="1301.04,-1284.65 1296.16,-1294.06 1305.84,-1289.75 1301.04,-1284.65"/>
<text text-anchor="middle" x="1594.36" y="-862.12" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- route_0_to_128&#45;&gt;mla_128 -->
<g id="edge27" class="edge">
<title>route_0_to_128&#45;&gt;mla_128</title>
<path fill="none" stroke="black" d="M2193.41,-935.1C2109.29,-947.06 1988.01,-948.41 1917.2,-877.32 1888.52,-848.52 1926.92,-725.03 1899.2,-695.32 1748.21,-533.46 1600.06,-578.44 1401.53,-676.32 1228.46,-761.64 1201.3,-1034.18 1197.2,-1133.05"/>
<polygon fill="black" stroke="black" points="1193.7,-1133.03 1196.83,-1143.15 1200.69,-1133.28 1193.7,-1133.03"/>
<text text-anchor="middle" x="1594.36" y="-680.12" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- route_0_to_192&#45;&gt;mla_192 -->
<g id="edge28" class="edge">
<title>route_0_to_192&#45;&gt;mla_192</title>
<path fill="none" stroke="black" d="M2400.64,-1080.97C2478.6,-1084.75 2581.64,-1077.89 2657.44,-1029.32 2800.69,-937.53 2871.59,-730.65 2895.19,-647.21"/>
<polygon fill="black" stroke="black" points="2898.6,-648 2897.89,-637.43 2891.85,-646.14 2898.6,-648"/>
<text text-anchor="middle" x="2725.44" y="-1018.12" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- route_64_to_0&#45;&gt;mla_0 -->
<g id="edge29" class="edge">
<title>route_64_to_0&#45;&gt;mla_0</title>
<path fill="none" stroke="black" d="M2178.18,-748.13C2099.02,-742.85 1992.69,-748.52 1917.2,-801.32 1902.21,-811.8 1913.14,-826.48 1899.2,-838.32 1865.96,-866.52 1844.97,-848.46 1805.2,-866.32 1803.7,-866.99 1402.53,-1115.01 1401.53,-1116.32 1312.33,-1233.1 1409.26,-1327.27 1307.53,-1433.32 1305.65,-1435.28 1303.66,-1437.14 1301.58,-1438.9"/>
<polygon fill="black" stroke="black" points="1299.05,-1436.43 1293.17,-1445.24 1303.26,-1442.02 1299.05,-1436.43"/>
<text text-anchor="middle" x="1594.36" y="-1120.12" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- route_64_to_128&#45;&gt;mla_128 -->
<g id="edge30" class="edge">
<title>route_64_to_128&#45;&gt;mla_128</title>
<path fill="none" stroke="black" d="M2192.26,-706.86C2108.52,-718.28 1988.55,-718.95 1917.2,-649.32 1871.99,-605.19 1931.61,-562.54 1899.2,-508.32 1867.81,-455.81 1845.45,-446.98 1787.2,-428.32 1623.97,-376.01 1538.96,-325.87 1401.53,-428.32 1284.19,-515.78 1217.45,-997.11 1200.73,-1133.36"/>
<polygon fill="black" stroke="black" points="1197.25,-1132.95 1199.52,-1143.3 1204.2,-1133.79 1197.25,-1132.95"/>
<text text-anchor="middle" x="1594.36" y="-432.12" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- route_64_to_192&#45;&gt;mla_192 -->
<g id="edge31" class="edge">
<title>route_64_to_192&#45;&gt;mla_192</title>
<path fill="none" stroke="black" d="M2414.14,-843.24C2487.47,-841.45 2580.39,-832.02 2657.44,-801.32 2746.05,-766.01 2829.76,-689.22 2873.29,-644.83"/>
<polygon fill="black" stroke="black" points="2875.99,-647.08 2880.44,-637.47 2870.96,-642.21 2875.99,-647.08"/>
<text text-anchor="middle" x="2725.44" y="-794.12" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- route_128_to_0&#45;&gt;mla_0 -->
<g id="edge32" class="edge">
<title>route_128_to_0&#45;&gt;mla_0</title>
<path fill="none" stroke="black" d="M2190.62,-516.3C2107.55,-505.76 1989.54,-506.13 1917.2,-573.32 1883.79,-604.35 1931.12,-641.75 1899.2,-674.32 1859.73,-714.58 1438.95,-731.14 1401.53,-773.32 1367.06,-812.16 1395.88,-955.87 1383.53,-1006.32 1367.9,-1070.14 1340.66,-1078.37 1325.53,-1142.32 1318.06,-1173.84 1327.17,-1407.55 1307.53,-1433.32 1306.28,-1434.96 1304.95,-1436.53 1303.56,-1438.03"/>
<polygon fill="black" stroke="black" points="1301.01,-1435.62 1296.08,-1444.99 1305.78,-1440.74 1301.01,-1435.62"/>
<text text-anchor="middle" x="1594.36" y="-777.12" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- route_128_to_64&#45;&gt;mla_64 -->
<g id="edge33" class="edge">
<title>route_128_to_64&#45;&gt;mla_64</title>
<path fill="none" stroke="black" d="M2159.44,-457.71C1941.86,-457.69 1510.44,-470.4 1401.53,-568.32 1301.48,-658.26 1345.4,-728.26 1325.53,-861.32 1318.61,-907.62 1335.56,-1244.81 1307.53,-1282.32 1306.29,-1283.97 1304.98,-1285.55 1303.6,-1287.06"/>
<polygon fill="black" stroke="black" points="1301.05,-1284.66 1296.18,-1294.07 1305.85,-1289.75 1301.05,-1284.66"/>
<text text-anchor="middle" x="1594.36" y="-572.12" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- route_128_to_192&#45;&gt;mla_192 -->
<g id="edge34" class="edge">
<title>route_128_to_192&#45;&gt;mla_192</title>
<path fill="none" stroke="black" d="M2415.61,-611.32C2523.48,-611.32 2677.11,-611.32 2783.21,-611.32"/>
<polygon fill="black" stroke="black" points="2783.33,-614.82 2793.33,-611.32 2783.33,-607.82 2783.33,-614.82"/>
<text text-anchor="middle" x="2725.44" y="-615.12" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- coord_0_64&#45;&gt;coord_64_128 -->
<g id="edge37" class="edge">
<title>coord_0_64&#45;&gt;coord_64_128</title>
<path fill="none" stroke="black" d="M2955.84,-451.32C3022.99,-451.32 3143.28,-451.32 3218.16,-451.32"/>
<polygon fill="black" stroke="black" points="3218.42,-454.82 3228.41,-451.32 3218.41,-447.82 3218.42,-454.82"/>
<text text-anchor="middle" x="3054.94" y="-455.12" font-family="Times,serif" font-size="14.00">chain</text>
</g>
<!-- coord_64_128&#45;&gt;coord_128_192 -->
<g id="edge40" class="edge">
<title>coord_64_128&#45;&gt;coord_128_192</title>
<path fill="none" stroke="black" d="M3341.88,-451.32C3457.68,-451.32 3724.53,-451.32 3851.99,-451.32"/>
<polygon fill="black" stroke="black" points="3852.03,-454.82 3862.03,-451.32 3852.03,-447.82 3852.03,-454.82"/>
<text text-anchor="middle" x="3515.61" y="-455.12" font-family="Times,serif" font-size="14.00">chain</text>
</g>
<!-- gate_192 -->
<g id="node28" class="node">
<title>gate_192</title>
<polygon fill="lightgreen" stroke="black" points="3477.95,-594.32 3171.45,-594.32 3092.6,-490.32 3399.1,-490.32 3477.95,-594.32"/>
<text text-anchor="middle" x="3285.28" y="-556.32" font-family="Arial" font-size="10.00">Expert Gating</text>
<text text-anchor="middle" x="3285.28" y="-545.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="3285.28" y="-534.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, top_k=2]</text>
<text text-anchor="middle" x="3285.28" y="-523.32" font-family="Arial" font-size="10.00">GPU: 192</text>
</g>
<!-- mla_192&#45;&gt;gate_192 -->
<g id="edge44" class="edge">
<title>mla_192&#45;&gt;gate_192</title>
<path fill="none" stroke="black" d="M3017.51,-591.03C3055.92,-584.02 3099.54,-576.05 3140.22,-568.62"/>
<polygon fill="black" stroke="black" points="3141.01,-572.04 3150.22,-566.8 3139.75,-565.15 3141.01,-572.04"/>
</g>
<!-- gate_192&#45;&gt;coord_128_192 -->
<g id="edge42" class="edge">
<title>gate_192&#45;&gt;coord_128_192</title>
<path fill="none" stroke="black" d="M3423.88,-522.63C3557.53,-503.5 3754.7,-475.29 3856.33,-460.75"/>
<polygon fill="black" stroke="black" points="3857.05,-464.18 3866.45,-459.3 3856.06,-457.25 3857.05,-464.18"/>
<text text-anchor="middle" x="3515.61" y="-515.12" font-family="Times,serif" font-size="14.00">sync</text>
</g>
<!-- gate_192&#45;&gt;residual_add_192 -->
<g id="edge45" class="edge">
<title>gate_192&#45;&gt;residual_add_192</title>
<path fill="none" stroke="black" d="M3418.18,-515.44C3439.73,-506.98 3460.68,-495.88 3478.11,-481.32 3491.24,-470.36 3484.31,-459.69 3496.11,-447.32 3513.58,-429 3521.62,-427.72 3545.11,-418.32 3587.54,-401.34 3634.04,-387.25 3679.46,-375.7"/>
<polygon fill="black" stroke="black" points="3680.59,-379.02 3689.43,-373.2 3678.88,-372.23 3680.59,-379.02"/>
</g>
<!-- expert_192 -->
<g id="node30" class="node">
<title>expert_192</title>
<polygon fill="lightblue" stroke="black" points="4524.36,-357.32 4330.36,-357.32 4330.36,-305.32 4524.36,-305.32 4524.36,-357.32"/>
<text text-anchor="middle" x="4427.36" y="-345.32" font-family="Arial" font-size="10.00">Expert MLP 192</text>
<text text-anchor="middle" x="4427.36" y="-334.32" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="4427.36" y="-323.32" font-family="Arial" font-size="10.00">→ [batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="4427.36" y="-312.32" font-family="Arial" font-size="10.00">GPU: 192</text>
</g>
<!-- residual_add_192&#45;&gt;expert_192 -->
<g id="edge47" class="edge">
<title>residual_add_192&#45;&gt;expert_192</title>
<path fill="none" stroke="black" d="M4217.77,-331.32C4254.12,-331.32 4289.24,-331.32 4319.97,-331.32"/>
<polygon fill="black" stroke="black" points="4320.22,-334.82 4330.22,-331.32 4320.22,-327.82 4320.22,-334.82"/>
</g>
<!-- expert_192&#45;&gt;collect_all -->
<g id="edge51" class="edge">
<title>expert_192&#45;&gt;collect_all</title>
<path fill="none" stroke="black" d="M4524.48,-331.32C4574.7,-331.32 4637.86,-331.32 4696.9,-331.32"/>
<polygon fill="black" stroke="black" points="4697.1,-334.82 4707.1,-331.32 4697.1,-327.82 4697.1,-334.82"/>
<text text-anchor="middle" x="4593.86" y="-335.12" font-family="Times,serif" font-size="14.00">from GPU 192</text>
</g>
<!-- final_out -->
<g id="node32" class="node">
<title>final_out</title>
<polygon fill="lightgray" stroke="black" points="5282.61,-302.39 5290.95,-302.55 5299.2,-302.79 5307.33,-303.11 5315.31,-303.5 5323.1,-303.97 5330.68,-304.51 5338.02,-305.13 5345.08,-305.82 5351.84,-306.58 5358.28,-307.41 5364.37,-308.3 5370.09,-309.25 5375.43,-310.27 5380.38,-311.35 5384.9,-312.47 5389.01,-313.65 5392.67,-314.88 5395.9,-316.16 5398.69,-317.47 5401.02,-318.83 5402.92,-320.21 5404.36,-321.63 5405.38,-323.08 5405.95,-324.54 5406.11,-326.03 5405.85,-327.53 5405.19,-329.04 5404.15,-330.56 5402.73,-332.08 5400.95,-333.59 5398.83,-335.1 5396.39,-336.6 5393.64,-338.09 5390.6,-339.56 5387.29,-341 5383.73,-342.42 5379.94,-343.81 5375.93,-345.16 5371.73,-346.48 5367.35,-347.75 5362.8,-348.98 5358.11,-350.16 5353.28,-351.29 5348.34,-352.36 5343.3,-353.38 5338.16,-354.33 5332.95,-355.23 5327.67,-356.05 5322.33,-356.81 5316.93,-357.5 5311.5,-358.12 5306.03,-358.66 5300.53,-359.13 5295.01,-359.53 5289.48,-359.84 5283.93,-360.08 5278.37,-360.24 5272.8,-360.32 5267.23,-360.32 5261.67,-360.24 5256.1,-360.08 5250.55,-359.84 5245.02,-359.53 5239.5,-359.13 5234,-358.66 5228.53,-358.12 5223.1,-357.5 5217.71,-356.81 5212.36,-356.05 5207.08,-355.23 5201.87,-354.33 5196.73,-353.38 5191.69,-352.36 5186.75,-351.29 5181.92,-350.16 5177.23,-348.98 5172.68,-347.75 5168.3,-346.48 5164.1,-345.16 5160.09,-343.81 5156.3,-342.42 5152.74,-341 5149.43,-339.56 5146.39,-338.09 5143.64,-336.6 5141.2,-335.1 5139.08,-333.59 5137.3,-332.08 5135.88,-330.56 5134.84,-329.04 5134.18,-327.53 5133.92,-326.03 5134.08,-324.54 5134.65,-323.08 5135.67,-321.63 5137.11,-320.21 5139.01,-318.83 5141.34,-317.47 5144.13,-316.16 5147.36,-314.88 5151.03,-313.65 5155.13,-312.47 5159.65,-311.35 5164.6,-310.27 5169.94,-309.25 5175.66,-308.3 5181.75,-307.41 5188.19,-306.58 5194.95,-305.82 5202.01,-305.13 5209.35,-304.51 5216.93,-303.97 5224.72,-303.5 5232.7,-303.11 5240.83,-302.79 5249.08,-302.55 5257.42,-302.39 5265.81,-302.31 5274.22,-302.31 5282.61,-302.39"/>
<text text-anchor="middle" x="5270.02" y="-339.82" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="5270.02" y="-328.82" font-family="Arial" font-size="10.00">[batch_size=?, seq_len=?, dim=7168]</text>
<text text-anchor="middle" x="5270.02" y="-317.82" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- collect_all&#45;&gt;final_out -->
<g id="edge52" class="edge">
<title>collect_all&#45;&gt;final_out</title>
<path fill="none" stroke="black" d="M5052.62,-331.32C5077.2,-331.32 5102.27,-331.32 5126.22,-331.32"/>
<polygon fill="black" stroke="black" points="5126.41,-334.82 5136.41,-331.32 5126.41,-327.82 5126.41,-334.82"/>
</g>
</g>
</svg>
