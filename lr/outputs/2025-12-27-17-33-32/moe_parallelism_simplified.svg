<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="495pt" height="924pt"
 viewBox="0.00 0.00 495.25 924.02" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 920.02)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-920.02 491.25,-920.02 491.25,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_layer_detail</title>
<path fill="lightgray" stroke="black" d="M20,-159.08C20,-159.08 373,-159.08 373,-159.08 379,-159.08 385,-165.08 385,-171.08 385,-171.08 385,-811.17 385,-811.17 385,-817.17 379,-823.17 373,-823.17 373,-823.17 20,-823.17 20,-823.17 14,-823.17 8,-817.17 8,-811.17 8,-811.17 8,-171.08 8,-171.08 8,-165.08 14,-159.08 20,-159.08"/>
<text text-anchor="middle" x="196.5" y="-807.97" font-family="Times,serif" font-size="14.00">Layer 1 Detail (Representative of all 16 layers)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="none" stroke="black" cx="196" cy="-873.59" rx="124.4" ry="24.08"/>
<text text-anchor="middle" x="196" y="-876.99" font-family="Arial" font-size="12.00">Input Batch</text>
<text text-anchor="middle" x="196" y="-863.99" font-family="Arial" font-size="12.00">128 sequences, 10240 tokens</text>
</g>
<!-- sp_split -->
<g id="node2" class="node">
<title>sp_split</title>
<polygon fill="none" stroke="black" points="344.01,-792.17 108.56,-792.17 47.99,-698.17 283.44,-698.17 344.01,-792.17"/>
<text text-anchor="middle" x="196" y="-755.07" font-family="Arial" font-size="12.00">SP Split</text>
<text text-anchor="middle" x="196" y="-742.07" font-family="Arial" font-size="12.00">GPU: 0&#45;1</text>
<text text-anchor="middle" x="196" y="-729.07" font-family="Arial" font-size="12.00">Seq len: 10240 → 5120</text>
</g>
<!-- input&#45;&gt;sp_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;sp_split</title>
<path fill="none" stroke="black" d="M196,-849.4C196,-836.18 196,-818.99 196,-802.44"/>
<polygon fill="black" stroke="black" points="199.5,-802.26 196,-792.26 192.5,-802.26 199.5,-802.26"/>
</g>
<!-- attn_tp -->
<g id="node3" class="node">
<title>attn_tp</title>
<polygon fill="none" stroke="black" points="262,-662.17 130,-662.17 130,-615.17 262,-615.17 262,-662.17"/>
<text text-anchor="middle" x="196" y="-648.57" font-family="Arial" font-size="12.00">Attention (TP=2)</text>
<text text-anchor="middle" x="196" y="-635.57" font-family="Arial" font-size="12.00">GPU: 0&#45;1</text>
<text text-anchor="middle" x="196" y="-622.57" font-family="Arial" font-size="12.00">Dim: 512 → 256 each</text>
</g>
<!-- sp_split&#45;&gt;attn_tp -->
<g id="edge2" class="edge">
<title>sp_split&#45;&gt;attn_tp</title>
<path fill="none" stroke="black" d="M196,-698.03C196,-689.44 196,-680.62 196,-672.53"/>
<polygon fill="black" stroke="black" points="199.5,-672.39 196,-662.39 192.5,-672.39 199.5,-672.39"/>
</g>
<!-- tp_allreduce -->
<g id="node4" class="node">
<title>tp_allreduce</title>
<ellipse fill="none" stroke="black" cx="196" cy="-555.12" rx="67.35" ry="24.08"/>
<text text-anchor="middle" x="196" y="-558.52" font-family="Arial" font-size="12.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="196" y="-545.52" font-family="Arial" font-size="12.00">GPU: 0&#45;1</text>
</g>
<!-- attn_tp&#45;&gt;tp_allreduce -->
<g id="edge3" class="edge">
<title>attn_tp&#45;&gt;tp_allreduce</title>
<path fill="none" stroke="black" d="M196,-614.95C196,-607.05 196,-598 196,-589.42"/>
<polygon fill="black" stroke="black" points="199.5,-589.28 196,-579.28 192.5,-589.28 199.5,-589.28"/>
</g>
<!-- gate -->
<g id="node5" class="node">
<title>gate</title>
<polygon fill="none" stroke="black" points="219.7,-495.08 57.92,-495.08 16.3,-401.08 178.08,-401.08 219.7,-495.08"/>
<text text-anchor="middle" x="118" y="-457.98" font-family="Arial" font-size="12.00">Expert Gate</text>
<text text-anchor="middle" x="118" y="-444.98" font-family="Arial" font-size="12.00">GPU: 0&#45;1</text>
<text text-anchor="middle" x="118" y="-431.98" font-family="Arial" font-size="12.00">Selects experts</text>
</g>
<!-- tp_allreduce&#45;&gt;gate -->
<g id="edge4" class="edge">
<title>tp_allreduce&#45;&gt;gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M179.27,-531.59C173.11,-523.3 165.84,-513.51 158.51,-503.63"/>
<polygon fill="black" stroke="black" points="161.12,-501.28 152.35,-495.34 155.5,-505.45 161.12,-501.28"/>
</g>
<!-- experts -->
<g id="node6" class="node">
<title>experts</title>
<polygon fill="none" stroke="black" points="376.5,-471.58 237.5,-471.58 237.5,-424.58 376.5,-424.58 376.5,-471.58"/>
<text text-anchor="middle" x="307" y="-457.98" font-family="Arial" font-size="12.00">Expert Computation</text>
<text text-anchor="middle" x="307" y="-444.98" font-family="Arial" font-size="12.00">GPU: 2&#45;17 (16 experts)</text>
<text text-anchor="middle" x="307" y="-431.98" font-family="Arial" font-size="12.00">EP=16</text>
</g>
<!-- tp_allreduce&#45;&gt;experts -->
<g id="edge5" class="edge">
<title>tp_allreduce&#45;&gt;experts</title>
<path fill="none" stroke="black" d="M219,-532.36C235.33,-516.9 257.47,-495.95 275.45,-478.94"/>
<polygon fill="black" stroke="black" points="278.02,-481.33 282.88,-471.91 273.21,-476.24 278.02,-481.33"/>
</g>
<!-- expert_agg -->
<g id="node7" class="node">
<title>expert_agg</title>
<polygon fill="none" stroke="black" points="364.25,-365.08 168.19,-365.08 117.75,-297.08 313.81,-297.08 364.25,-365.08"/>
<text text-anchor="middle" x="241" y="-334.48" font-family="Arial" font-size="12.00">Expert Aggregation</text>
<text text-anchor="middle" x="241" y="-321.48" font-family="Arial" font-size="12.00">GPU: 0&#45;1</text>
</g>
<!-- experts&#45;&gt;expert_agg -->
<g id="edge6" class="edge">
<title>experts&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M293.96,-424.36C285.71,-409.98 274.78,-390.95 265,-373.91"/>
<polygon fill="black" stroke="black" points="268.03,-372.14 260.01,-365.21 261.96,-375.63 268.03,-372.14"/>
</g>
<!-- sp_merge -->
<g id="node8" class="node">
<title>sp_merge</title>
<polygon fill="none" stroke="black" points="377.01,-261.08 141.56,-261.08 80.99,-167.08 316.44,-167.08 377.01,-261.08"/>
<text text-anchor="middle" x="229" y="-223.98" font-family="Arial" font-size="12.00">SP Merge</text>
<text text-anchor="middle" x="229" y="-210.98" font-family="Arial" font-size="12.00">GPU: 0&#45;1</text>
<text text-anchor="middle" x="229" y="-197.98" font-family="Arial" font-size="12.00">Seq len: 5120 → 10240</text>
</g>
<!-- expert_agg&#45;&gt;sp_merge -->
<g id="edge7" class="edge">
<title>expert_agg&#45;&gt;sp_merge</title>
<path fill="none" stroke="black" d="M237.53,-296.82C236.69,-288.81 235.78,-280.03 234.87,-271.29"/>
<polygon fill="black" stroke="black" points="238.32,-270.69 233.8,-261.1 231.36,-271.41 238.32,-270.69"/>
</g>
<!-- pipeline -->
<g id="node9" class="node">
<title>pipeline</title>
<polygon fill="none" stroke="black" points="293,-131.08 165,-131.08 165,-84.08 293,-84.08 293,-131.08"/>
<text text-anchor="middle" x="229" y="-117.48" font-family="Arial" font-size="12.00">Pipeline Stages 2&#45;16</text>
<text text-anchor="middle" x="229" y="-104.48" font-family="Arial" font-size="12.00">PP=16</text>
<text text-anchor="middle" x="229" y="-91.48" font-family="Arial" font-size="12.00">GPU: 18&#45;255</text>
</g>
<!-- sp_merge&#45;&gt;pipeline -->
<g id="edge8" class="edge">
<title>sp_merge&#45;&gt;pipeline</title>
<path fill="none" stroke="black" d="M229,-166.94C229,-158.35 229,-149.54 229,-141.44"/>
<polygon fill="black" stroke="black" points="232.5,-141.3 229,-131.3 225.5,-141.3 232.5,-141.3"/>
</g>
<!-- output -->
<g id="node11" class="node">
<title>output</title>
<ellipse fill="none" stroke="black" cx="229" cy="-24.04" rx="124.4" ry="24.08"/>
<text text-anchor="middle" x="229" y="-27.44" font-family="Arial" font-size="12.00">Output</text>
<text text-anchor="middle" x="229" y="-14.44" font-family="Arial" font-size="12.00">128 sequences, 10240 tokens</text>
</g>
<!-- pipeline&#45;&gt;output -->
<g id="edge9" class="edge">
<title>pipeline&#45;&gt;output</title>
<path fill="none" stroke="black" d="M229,-83.87C229,-75.96 229,-66.92 229,-58.34"/>
<polygon fill="black" stroke="black" points="232.5,-58.2 229,-48.2 225.5,-58.2 232.5,-58.2"/>
</g>
<!-- dp -->
<g id="node10" class="node">
<title>dp</title>
<ellipse fill="none" stroke="black" cx="413" cy="-873.59" rx="74.49" ry="42.35"/>
<text text-anchor="middle" x="413" y="-889.99" font-family="Arial" font-size="12.00">Data Parallelism</text>
<text text-anchor="middle" x="413" y="-876.99" font-family="Arial" font-size="12.00">DP=8</text>
<text text-anchor="middle" x="413" y="-863.99" font-family="Arial" font-size="12.00">GPU: 256&#45;2047</text>
<text text-anchor="middle" x="413" y="-850.99" font-family="Arial" font-size="12.00">8 replicas</text>
</g>
</g>
</svg>
