<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="6000pt" height="3878pt"
 viewBox="0.00 0.00 1440.00 930.79" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.15 0.15) rotate(0) translate(4 26395.45)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-26395.45 40838.02,-26395.45 40838.02,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="lightgray" stroke="black" d="M103,-26303.45C103,-26303.45 432,-26303.45 432,-26303.45 438,-26303.45 444,-26309.45 444,-26315.45 444,-26315.45 444,-26371.45 444,-26371.45 444,-26377.45 438,-26383.45 432,-26383.45 432,-26383.45 103,-26383.45 103,-26383.45 97,-26383.45 91,-26377.45 91,-26371.45 91,-26371.45 91,-26315.45 91,-26315.45 91,-26309.45 97,-26303.45 103,-26303.45"/>
<text text-anchor="middle" x="267.5" y="-26368.25" font-family="Times,serif" font-size="14.00">Input Layer (Batch Size=128, Seq Len=10240)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_dp_0_stage1_ep_0</title>
<path fill="lightsteelblue" stroke="black" d="M26,-25607.96C26,-25607.96 1015,-25607.96 1015,-25607.96 1021,-25607.96 1027,-25613.96 1027,-25619.96 1027,-25619.96 1027,-26249.96 1027,-26249.96 1027,-26255.96 1021,-26261.96 1015,-26261.96 1015,-26261.96 26,-26261.96 26,-26261.96 20,-26261.96 14,-26255.96 14,-26249.96 14,-26249.96 14,-25619.96 14,-25619.96 14,-25613.96 20,-25607.96 26,-25607.96"/>
<text text-anchor="middle" x="520.5" y="-26246.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 0 (GPU 0&#45;1)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_dp_0_stage1_ep_1</title>
<path fill="lightsteelblue" stroke="black" d="M26,-24835.96C26,-24835.96 1015,-24835.96 1015,-24835.96 1021,-24835.96 1027,-24841.96 1027,-24847.96 1027,-24847.96 1027,-25576.96 1027,-25576.96 1027,-25582.96 1021,-25588.96 1015,-25588.96 1015,-25588.96 26,-25588.96 26,-25588.96 20,-25588.96 14,-25582.96 14,-25576.96 14,-25576.96 14,-24847.96 14,-24847.96 14,-24841.96 20,-24835.96 26,-24835.96"/>
<text text-anchor="middle" x="520.5" y="-25573.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 1 (GPU 2&#45;3)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_dp_0_stage1_ep_2</title>
<path fill="lightsteelblue" stroke="black" d="M26,-24037.96C26,-24037.96 1015,-24037.96 1015,-24037.96 1021,-24037.96 1027,-24043.96 1027,-24049.96 1027,-24049.96 1027,-24778.96 1027,-24778.96 1027,-24784.96 1021,-24790.96 1015,-24790.96 1015,-24790.96 26,-24790.96 26,-24790.96 20,-24790.96 14,-24784.96 14,-24778.96 14,-24778.96 14,-24049.96 14,-24049.96 14,-24043.96 20,-24037.96 26,-24037.96"/>
<text text-anchor="middle" x="520.5" y="-24775.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 2 (GPU 4&#45;5)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_dp_0_stage1_ep_3</title>
<path fill="lightsteelblue" stroke="black" d="M26,-23239.96C26,-23239.96 1015,-23239.96 1015,-23239.96 1021,-23239.96 1027,-23245.96 1027,-23251.96 1027,-23251.96 1027,-23980.96 1027,-23980.96 1027,-23986.96 1021,-23992.96 1015,-23992.96 1015,-23992.96 26,-23992.96 26,-23992.96 20,-23992.96 14,-23986.96 14,-23980.96 14,-23980.96 14,-23251.96 14,-23251.96 14,-23245.96 20,-23239.96 26,-23239.96"/>
<text text-anchor="middle" x="520.5" y="-23977.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 3 (GPU 6&#45;7)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_dp_0_stage1_ep_4</title>
<path fill="lightsteelblue" stroke="black" d="M27,-22441.96C27,-22441.96 1016,-22441.96 1016,-22441.96 1022,-22441.96 1028,-22447.96 1028,-22453.96 1028,-22453.96 1028,-23182.96 1028,-23182.96 1028,-23188.96 1022,-23194.96 1016,-23194.96 1016,-23194.96 27,-23194.96 27,-23194.96 21,-23194.96 15,-23188.96 15,-23182.96 15,-23182.96 15,-22453.96 15,-22453.96 15,-22447.96 21,-22441.96 27,-22441.96"/>
<text text-anchor="middle" x="521.5" y="-23179.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 4 (GPU 8&#45;9)</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_dp_0_stage1_ep_5</title>
<path fill="lightsteelblue" stroke="black" d="M25,-21643.96C25,-21643.96 1014,-21643.96 1014,-21643.96 1020,-21643.96 1026,-21649.96 1026,-21655.96 1026,-21655.96 1026,-22384.96 1026,-22384.96 1026,-22390.96 1020,-22396.96 1014,-22396.96 1014,-22396.96 25,-22396.96 25,-22396.96 19,-22396.96 13,-22390.96 13,-22384.96 13,-22384.96 13,-21655.96 13,-21655.96 13,-21649.96 19,-21643.96 25,-21643.96"/>
<text text-anchor="middle" x="519.5" y="-22381.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 5 (GPU 10&#45;11)</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_dp_0_stage1_ep_6</title>
<path fill="lightsteelblue" stroke="black" d="M24,-20845.96C24,-20845.96 1013,-20845.96 1013,-20845.96 1019,-20845.96 1025,-20851.96 1025,-20857.96 1025,-20857.96 1025,-21586.96 1025,-21586.96 1025,-21592.96 1019,-21598.96 1013,-21598.96 1013,-21598.96 24,-21598.96 24,-21598.96 18,-21598.96 12,-21592.96 12,-21586.96 12,-21586.96 12,-20857.96 12,-20857.96 12,-20851.96 18,-20845.96 24,-20845.96"/>
<text text-anchor="middle" x="518.5" y="-21583.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 6 (GPU 12&#45;13)</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_dp_0_stage1_ep_7</title>
<path fill="lightsteelblue" stroke="black" d="M20,-20047.96C20,-20047.96 1009,-20047.96 1009,-20047.96 1015,-20047.96 1021,-20053.96 1021,-20059.96 1021,-20059.96 1021,-20788.96 1021,-20788.96 1021,-20794.96 1015,-20800.96 1009,-20800.96 1009,-20800.96 20,-20800.96 20,-20800.96 14,-20800.96 8,-20794.96 8,-20788.96 8,-20788.96 8,-20059.96 8,-20059.96 8,-20053.96 14,-20047.96 20,-20047.96"/>
<text text-anchor="middle" x="514.5" y="-20785.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 7 (GPU 14&#45;15)</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_dp_0_stage2_ep_0</title>
<path fill="lightsteelblue" stroke="black" d="M1062,-24699.96C1062,-24699.96 2051,-24699.96 2051,-24699.96 2057,-24699.96 2063,-24705.96 2063,-24711.96 2063,-24711.96 2063,-25466.96 2063,-25466.96 2063,-25472.96 2057,-25478.96 2051,-25478.96 2051,-25478.96 1062,-25478.96 1062,-25478.96 1056,-25478.96 1050,-25472.96 1050,-25466.96 1050,-25466.96 1050,-24711.96 1050,-24711.96 1050,-24705.96 1056,-24699.96 1062,-24699.96"/>
<text text-anchor="middle" x="1556.5" y="-25463.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 0 (GPU 16&#45;17)</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_dp_0_stage2_ep_1</title>
<path fill="lightsteelblue" stroke="black" d="M1056,-23901.96C1056,-23901.96 2045,-23901.96 2045,-23901.96 2051,-23901.96 2057,-23907.96 2057,-23913.96 2057,-23913.96 2057,-24668.96 2057,-24668.96 2057,-24674.96 2051,-24680.96 2045,-24680.96 2045,-24680.96 1056,-24680.96 1056,-24680.96 1050,-24680.96 1044,-24674.96 1044,-24668.96 1044,-24668.96 1044,-23913.96 1044,-23913.96 1044,-23907.96 1050,-23901.96 1056,-23901.96"/>
<text text-anchor="middle" x="1550.5" y="-24665.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 1 (GPU 18&#45;19)</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_dp_0_stage2_ep_2</title>
<path fill="lightsteelblue" stroke="black" d="M1052,-23103.96C1052,-23103.96 2041,-23103.96 2041,-23103.96 2047,-23103.96 2053,-23109.96 2053,-23115.96 2053,-23115.96 2053,-23870.96 2053,-23870.96 2053,-23876.96 2047,-23882.96 2041,-23882.96 2041,-23882.96 1052,-23882.96 1052,-23882.96 1046,-23882.96 1040,-23876.96 1040,-23870.96 1040,-23870.96 1040,-23115.96 1040,-23115.96 1040,-23109.96 1046,-23103.96 1052,-23103.96"/>
<text text-anchor="middle" x="1546.5" y="-23867.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 2 (GPU 20&#45;21)</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_dp_0_stage2_ep_3</title>
<path fill="lightsteelblue" stroke="black" d="M1053,-22305.96C1053,-22305.96 2042,-22305.96 2042,-22305.96 2048,-22305.96 2054,-22311.96 2054,-22317.96 2054,-22317.96 2054,-23072.96 2054,-23072.96 2054,-23078.96 2048,-23084.96 2042,-23084.96 2042,-23084.96 1053,-23084.96 1053,-23084.96 1047,-23084.96 1041,-23078.96 1041,-23072.96 1041,-23072.96 1041,-22317.96 1041,-22317.96 1041,-22311.96 1047,-22305.96 1053,-22305.96"/>
<text text-anchor="middle" x="1547.5" y="-23069.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 3 (GPU 22&#45;23)</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_dp_0_stage2_ep_4</title>
<path fill="lightsteelblue" stroke="black" d="M1049,-21507.96C1049,-21507.96 2038,-21507.96 2038,-21507.96 2044,-21507.96 2050,-21513.96 2050,-21519.96 2050,-21519.96 2050,-22274.96 2050,-22274.96 2050,-22280.96 2044,-22286.96 2038,-22286.96 2038,-22286.96 1049,-22286.96 1049,-22286.96 1043,-22286.96 1037,-22280.96 1037,-22274.96 1037,-22274.96 1037,-21519.96 1037,-21519.96 1037,-21513.96 1043,-21507.96 1049,-21507.96"/>
<text text-anchor="middle" x="1543.5" y="-22271.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 4 (GPU 24&#45;25)</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_dp_0_stage2_ep_5</title>
<path fill="lightsteelblue" stroke="black" d="M1045,-20709.96C1045,-20709.96 2034,-20709.96 2034,-20709.96 2040,-20709.96 2046,-20715.96 2046,-20721.96 2046,-20721.96 2046,-21476.96 2046,-21476.96 2046,-21482.96 2040,-21488.96 2034,-21488.96 2034,-21488.96 1045,-21488.96 1045,-21488.96 1039,-21488.96 1033,-21482.96 1033,-21476.96 1033,-21476.96 1033,-20721.96 1033,-20721.96 1033,-20715.96 1039,-20709.96 1045,-20709.96"/>
<text text-anchor="middle" x="1539.5" y="-21473.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 5 (GPU 26&#45;27)</text>
</g>
<g id="clust17" class="cluster">
<title>cluster_dp_0_stage2_ep_6</title>
<path fill="lightsteelblue" stroke="black" d="M1041,-19911.96C1041,-19911.96 2030,-19911.96 2030,-19911.96 2036,-19911.96 2042,-19917.96 2042,-19923.96 2042,-19923.96 2042,-20678.96 2042,-20678.96 2042,-20684.96 2036,-20690.96 2030,-20690.96 2030,-20690.96 1041,-20690.96 1041,-20690.96 1035,-20690.96 1029,-20684.96 1029,-20678.96 1029,-20678.96 1029,-19923.96 1029,-19923.96 1029,-19917.96 1035,-19911.96 1041,-19911.96"/>
<text text-anchor="middle" x="1535.5" y="-20675.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 6 (GPU 28&#45;29)</text>
</g>
<g id="clust18" class="cluster">
<title>cluster_dp_0_stage2_ep_7</title>
<path fill="lightsteelblue" stroke="black" d="M1016,-19110.97C1016,-19110.97 2005,-19110.97 2005,-19110.97 2011,-19110.97 2017,-19116.97 2017,-19122.97 2017,-19122.97 2017,-19877.97 2017,-19877.97 2017,-19883.97 2011,-19889.97 2005,-19889.97 2005,-19889.97 1016,-19889.97 1016,-19889.97 1010,-19889.97 1004,-19883.97 1004,-19877.97 1004,-19877.97 1004,-19122.97 1004,-19122.97 1004,-19116.97 1010,-19110.97 1016,-19110.97"/>
<text text-anchor="middle" x="1510.5" y="-19874.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 7 (GPU 30&#45;31)</text>
</g>
<g id="clust21" class="cluster">
<title>cluster_dp_1_stage1_ep_0</title>
<path fill="lightsteelblue" stroke="black" d="M2063,-19246.97C2063,-19246.97 3052,-19246.97 3052,-19246.97 3058,-19246.97 3064,-19252.97 3064,-19258.97 3064,-19258.97 3064,-19990.96 3064,-19990.96 3064,-19996.96 3058,-20002.96 3052,-20002.96 3052,-20002.96 2063,-20002.96 2063,-20002.96 2057,-20002.96 2051,-19996.96 2051,-19990.96 2051,-19990.96 2051,-19258.97 2051,-19258.97 2051,-19252.97 2057,-19246.97 2063,-19246.97"/>
<text text-anchor="middle" x="2557.5" y="-19987.76" font-family="Times,serif" font-size="14.00">Expert Parallel Group 0 (GPU 64&#45;65)</text>
</g>
<g id="clust22" class="cluster">
<title>cluster_dp_1_stage1_ep_1</title>
<path fill="lightsteelblue" stroke="black" d="M2058,-18448.97C2058,-18448.97 3047,-18448.97 3047,-18448.97 3053,-18448.97 3059,-18454.97 3059,-18460.97 3059,-18460.97 3059,-19189.97 3059,-19189.97 3059,-19195.97 3053,-19201.97 3047,-19201.97 3047,-19201.97 2058,-19201.97 2058,-19201.97 2052,-19201.97 2046,-19195.97 2046,-19189.97 2046,-19189.97 2046,-18460.97 2046,-18460.97 2046,-18454.97 2052,-18448.97 2058,-18448.97"/>
<text text-anchor="middle" x="2552.5" y="-19186.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 1 (GPU 66&#45;67)</text>
</g>
<g id="clust23" class="cluster">
<title>cluster_dp_1_stage1_ep_2</title>
<path fill="lightsteelblue" stroke="black" d="M2050,-17650.97C2050,-17650.97 3039,-17650.97 3039,-17650.97 3045,-17650.97 3051,-17656.97 3051,-17662.97 3051,-17662.97 3051,-18391.97 3051,-18391.97 3051,-18397.97 3045,-18403.97 3039,-18403.97 3039,-18403.97 2050,-18403.97 2050,-18403.97 2044,-18403.97 2038,-18397.97 2038,-18391.97 2038,-18391.97 2038,-17662.97 2038,-17662.97 2038,-17656.97 2044,-17650.97 2050,-17650.97"/>
<text text-anchor="middle" x="2544.5" y="-18388.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 2 (GPU 68&#45;69)</text>
</g>
<g id="clust24" class="cluster">
<title>cluster_dp_1_stage1_ep_3</title>
<path fill="lightsteelblue" stroke="black" d="M2046,-16852.97C2046,-16852.97 3035,-16852.97 3035,-16852.97 3041,-16852.97 3047,-16858.97 3047,-16864.97 3047,-16864.97 3047,-17593.97 3047,-17593.97 3047,-17599.97 3041,-17605.97 3035,-17605.97 3035,-17605.97 2046,-17605.97 2046,-17605.97 2040,-17605.97 2034,-17599.97 2034,-17593.97 2034,-17593.97 2034,-16864.97 2034,-16864.97 2034,-16858.97 2040,-16852.97 2046,-16852.97"/>
<text text-anchor="middle" x="2540.5" y="-17590.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 3 (GPU 70&#45;71)</text>
</g>
<g id="clust25" class="cluster">
<title>cluster_dp_1_stage1_ep_4</title>
<path fill="lightsteelblue" stroke="black" d="M2042,-16054.97C2042,-16054.97 3031,-16054.97 3031,-16054.97 3037,-16054.97 3043,-16060.97 3043,-16066.97 3043,-16066.97 3043,-16795.97 3043,-16795.97 3043,-16801.97 3037,-16807.97 3031,-16807.97 3031,-16807.97 2042,-16807.97 2042,-16807.97 2036,-16807.97 2030,-16801.97 2030,-16795.97 2030,-16795.97 2030,-16066.97 2030,-16066.97 2030,-16060.97 2036,-16054.97 2042,-16054.97"/>
<text text-anchor="middle" x="2536.5" y="-16792.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 4 (GPU 72&#45;73)</text>
</g>
<g id="clust26" class="cluster">
<title>cluster_dp_1_stage1_ep_5</title>
<path fill="lightsteelblue" stroke="black" d="M2034,-15256.97C2034,-15256.97 3023,-15256.97 3023,-15256.97 3029,-15256.97 3035,-15262.97 3035,-15268.97 3035,-15268.97 3035,-15997.97 3035,-15997.97 3035,-16003.97 3029,-16009.97 3023,-16009.97 3023,-16009.97 2034,-16009.97 2034,-16009.97 2028,-16009.97 2022,-16003.97 2022,-15997.97 2022,-15997.97 2022,-15268.97 2022,-15268.97 2022,-15262.97 2028,-15256.97 2034,-15256.97"/>
<text text-anchor="middle" x="2528.5" y="-15994.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 5 (GPU 74&#45;75)</text>
</g>
<g id="clust27" class="cluster">
<title>cluster_dp_1_stage1_ep_6</title>
<path fill="lightsteelblue" stroke="black" d="M2026,-14458.97C2026,-14458.97 3015,-14458.97 3015,-14458.97 3021,-14458.97 3027,-14464.97 3027,-14470.97 3027,-14470.97 3027,-15199.97 3027,-15199.97 3027,-15205.97 3021,-15211.97 3015,-15211.97 3015,-15211.97 2026,-15211.97 2026,-15211.97 2020,-15211.97 2014,-15205.97 2014,-15199.97 2014,-15199.97 2014,-14470.97 2014,-14470.97 2014,-14464.97 2020,-14458.97 2026,-14458.97"/>
<text text-anchor="middle" x="2520.5" y="-15196.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 6 (GPU 76&#45;77)</text>
</g>
<g id="clust28" class="cluster">
<title>cluster_dp_1_stage1_ep_7</title>
<path fill="lightsteelblue" stroke="black" d="M2026,-13660.97C2026,-13660.97 3015,-13660.97 3015,-13660.97 3021,-13660.97 3027,-13666.97 3027,-13672.97 3027,-13672.97 3027,-14401.97 3027,-14401.97 3027,-14407.97 3021,-14413.97 3015,-14413.97 3015,-14413.97 2026,-14413.97 2026,-14413.97 2020,-14413.97 2014,-14407.97 2014,-14401.97 2014,-14401.97 2014,-13672.97 2014,-13672.97 2014,-13666.97 2020,-13660.97 2026,-13660.97"/>
<text text-anchor="middle" x="2520.5" y="-14398.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 7 (GPU 78&#45;79)</text>
</g>
<g id="clust30" class="cluster">
<title>cluster_dp_1_stage2_ep_0</title>
<path fill="lightsteelblue" stroke="black" d="M1023,-18312.97C1023,-18312.97 2012,-18312.97 2012,-18312.97 2018,-18312.97 2024,-18318.97 2024,-18324.97 2024,-18324.97 2024,-19079.97 2024,-19079.97 2024,-19085.97 2018,-19091.97 2012,-19091.97 2012,-19091.97 1023,-19091.97 1023,-19091.97 1017,-19091.97 1011,-19085.97 1011,-19079.97 1011,-19079.97 1011,-18324.97 1011,-18324.97 1011,-18318.97 1017,-18312.97 1023,-18312.97"/>
<text text-anchor="middle" x="1517.5" y="-19076.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 0 (GPU 80&#45;81)</text>
</g>
<g id="clust31" class="cluster">
<title>cluster_dp_1_stage2_ep_1</title>
<path fill="lightsteelblue" stroke="black" d="M1025,-17514.97C1025,-17514.97 2014,-17514.97 2014,-17514.97 2020,-17514.97 2026,-17520.97 2026,-17526.97 2026,-17526.97 2026,-18281.97 2026,-18281.97 2026,-18287.97 2020,-18293.97 2014,-18293.97 2014,-18293.97 1025,-18293.97 1025,-18293.97 1019,-18293.97 1013,-18287.97 1013,-18281.97 1013,-18281.97 1013,-17526.97 1013,-17526.97 1013,-17520.97 1019,-17514.97 1025,-17514.97"/>
<text text-anchor="middle" x="1519.5" y="-18278.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 1 (GPU 82&#45;83)</text>
</g>
<g id="clust32" class="cluster">
<title>cluster_dp_1_stage2_ep_2</title>
<path fill="lightsteelblue" stroke="black" d="M1021,-16716.97C1021,-16716.97 2010,-16716.97 2010,-16716.97 2016,-16716.97 2022,-16722.97 2022,-16728.97 2022,-16728.97 2022,-17483.97 2022,-17483.97 2022,-17489.97 2016,-17495.97 2010,-17495.97 2010,-17495.97 1021,-17495.97 1021,-17495.97 1015,-17495.97 1009,-17489.97 1009,-17483.97 1009,-17483.97 1009,-16728.97 1009,-16728.97 1009,-16722.97 1015,-16716.97 1021,-16716.97"/>
<text text-anchor="middle" x="1515.5" y="-17480.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 2 (GPU 84&#45;85)</text>
</g>
<g id="clust33" class="cluster">
<title>cluster_dp_1_stage2_ep_3</title>
<path fill="lightsteelblue" stroke="black" d="M1013,-15918.97C1013,-15918.97 2002,-15918.97 2002,-15918.97 2008,-15918.97 2014,-15924.97 2014,-15930.97 2014,-15930.97 2014,-16685.97 2014,-16685.97 2014,-16691.97 2008,-16697.97 2002,-16697.97 2002,-16697.97 1013,-16697.97 1013,-16697.97 1007,-16697.97 1001,-16691.97 1001,-16685.97 1001,-16685.97 1001,-15930.97 1001,-15930.97 1001,-15924.97 1007,-15918.97 1013,-15918.97"/>
<text text-anchor="middle" x="1507.5" y="-16682.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 3 (GPU 86&#45;87)</text>
</g>
<g id="clust34" class="cluster">
<title>cluster_dp_1_stage2_ep_4</title>
<path fill="lightsteelblue" stroke="black" d="M1005,-15120.97C1005,-15120.97 1994,-15120.97 1994,-15120.97 2000,-15120.97 2006,-15126.97 2006,-15132.97 2006,-15132.97 2006,-15887.97 2006,-15887.97 2006,-15893.97 2000,-15899.97 1994,-15899.97 1994,-15899.97 1005,-15899.97 1005,-15899.97 999,-15899.97 993,-15893.97 993,-15887.97 993,-15887.97 993,-15132.97 993,-15132.97 993,-15126.97 999,-15120.97 1005,-15120.97"/>
<text text-anchor="middle" x="1499.5" y="-15884.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 4 (GPU 88&#45;89)</text>
</g>
<g id="clust35" class="cluster">
<title>cluster_dp_1_stage2_ep_5</title>
<path fill="lightsteelblue" stroke="black" d="M1001,-14322.97C1001,-14322.97 1990,-14322.97 1990,-14322.97 1996,-14322.97 2002,-14328.97 2002,-14334.97 2002,-14334.97 2002,-15089.97 2002,-15089.97 2002,-15095.97 1996,-15101.97 1990,-15101.97 1990,-15101.97 1001,-15101.97 1001,-15101.97 995,-15101.97 989,-15095.97 989,-15089.97 989,-15089.97 989,-14334.97 989,-14334.97 989,-14328.97 995,-14322.97 1001,-14322.97"/>
<text text-anchor="middle" x="1495.5" y="-15086.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 5 (GPU 90&#45;91)</text>
</g>
<g id="clust36" class="cluster">
<title>cluster_dp_1_stage2_ep_6</title>
<path fill="lightsteelblue" stroke="black" d="M1005,-13524.97C1005,-13524.97 1994,-13524.97 1994,-13524.97 2000,-13524.97 2006,-13530.97 2006,-13536.97 2006,-13536.97 2006,-14291.97 2006,-14291.97 2006,-14297.97 2000,-14303.97 1994,-14303.97 1994,-14303.97 1005,-14303.97 1005,-14303.97 999,-14303.97 993,-14297.97 993,-14291.97 993,-14291.97 993,-13536.97 993,-13536.97 993,-13530.97 999,-13524.97 1005,-13524.97"/>
<text text-anchor="middle" x="1499.5" y="-14288.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 6 (GPU 92&#45;93)</text>
</g>
<g id="clust37" class="cluster">
<title>cluster_dp_1_stage2_ep_7</title>
<path fill="lightsteelblue" stroke="black" d="M1361,-12723.97C1361,-12723.97 2350,-12723.97 2350,-12723.97 2356,-12723.97 2362,-12729.97 2362,-12735.97 2362,-12735.97 2362,-13490.97 2362,-13490.97 2362,-13496.97 2356,-13502.97 2350,-13502.97 2350,-13502.97 1361,-13502.97 1361,-13502.97 1355,-13502.97 1349,-13496.97 1349,-13490.97 1349,-13490.97 1349,-12735.97 1349,-12735.97 1349,-12729.97 1355,-12723.97 1361,-12723.97"/>
<text text-anchor="middle" x="1855.5" y="-13487.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 7 (GPU 94&#45;95)</text>
</g>
<g id="clust40" class="cluster">
<title>cluster_dp_2_stage1_ep_0</title>
<path fill="lightsteelblue" stroke="black" d="M2414,-12859.97C2414,-12859.97 3403,-12859.97 3403,-12859.97 3409,-12859.97 3415,-12865.97 3415,-12871.97 3415,-12871.97 3415,-13603.97 3415,-13603.97 3415,-13609.97 3409,-13615.97 3403,-13615.97 3403,-13615.97 2414,-13615.97 2414,-13615.97 2408,-13615.97 2402,-13609.97 2402,-13603.97 2402,-13603.97 2402,-12871.97 2402,-12871.97 2402,-12865.97 2408,-12859.97 2414,-12859.97"/>
<text text-anchor="middle" x="2908.5" y="-13600.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 0 (GPU 128&#45;129)</text>
</g>
<g id="clust41" class="cluster">
<title>cluster_dp_2_stage1_ep_1</title>
<path fill="lightsteelblue" stroke="black" d="M2408,-12061.97C2408,-12061.97 3397,-12061.97 3397,-12061.97 3403,-12061.97 3409,-12067.97 3409,-12073.97 3409,-12073.97 3409,-12802.97 3409,-12802.97 3409,-12808.97 3403,-12814.97 3397,-12814.97 3397,-12814.97 2408,-12814.97 2408,-12814.97 2402,-12814.97 2396,-12808.97 2396,-12802.97 2396,-12802.97 2396,-12073.97 2396,-12073.97 2396,-12067.97 2402,-12061.97 2408,-12061.97"/>
<text text-anchor="middle" x="2902.5" y="-12799.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 1 (GPU 130&#45;131)</text>
</g>
<g id="clust42" class="cluster">
<title>cluster_dp_2_stage1_ep_2</title>
<path fill="lightsteelblue" stroke="black" d="M2404,-11263.97C2404,-11263.97 3393,-11263.97 3393,-11263.97 3399,-11263.97 3405,-11269.97 3405,-11275.97 3405,-11275.97 3405,-12004.97 3405,-12004.97 3405,-12010.97 3399,-12016.97 3393,-12016.97 3393,-12016.97 2404,-12016.97 2404,-12016.97 2398,-12016.97 2392,-12010.97 2392,-12004.97 2392,-12004.97 2392,-11275.97 2392,-11275.97 2392,-11269.97 2398,-11263.97 2404,-11263.97"/>
<text text-anchor="middle" x="2898.5" y="-12001.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 2 (GPU 132&#45;133)</text>
</g>
<g id="clust43" class="cluster">
<title>cluster_dp_2_stage1_ep_3</title>
<path fill="lightsteelblue" stroke="black" d="M2403,-10465.97C2403,-10465.97 3392,-10465.97 3392,-10465.97 3398,-10465.97 3404,-10471.97 3404,-10477.97 3404,-10477.97 3404,-11206.97 3404,-11206.97 3404,-11212.97 3398,-11218.97 3392,-11218.97 3392,-11218.97 2403,-11218.97 2403,-11218.97 2397,-11218.97 2391,-11212.97 2391,-11206.97 2391,-11206.97 2391,-10477.97 2391,-10477.97 2391,-10471.97 2397,-10465.97 2403,-10465.97"/>
<text text-anchor="middle" x="2897.5" y="-11203.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 3 (GPU 134&#45;135)</text>
</g>
<g id="clust44" class="cluster">
<title>cluster_dp_2_stage1_ep_4</title>
<path fill="lightsteelblue" stroke="black" d="M2403,-9667.97C2403,-9667.97 3392,-9667.97 3392,-9667.97 3398,-9667.97 3404,-9673.97 3404,-9679.97 3404,-9679.97 3404,-10408.97 3404,-10408.97 3404,-10414.97 3398,-10420.97 3392,-10420.97 3392,-10420.97 2403,-10420.97 2403,-10420.97 2397,-10420.97 2391,-10414.97 2391,-10408.97 2391,-10408.97 2391,-9679.97 2391,-9679.97 2391,-9673.97 2397,-9667.97 2403,-9667.97"/>
<text text-anchor="middle" x="2897.5" y="-10405.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 4 (GPU 136&#45;137)</text>
</g>
<g id="clust45" class="cluster">
<title>cluster_dp_2_stage1_ep_5</title>
<path fill="lightsteelblue" stroke="black" d="M2403,-8869.97C2403,-8869.97 3392,-8869.97 3392,-8869.97 3398,-8869.97 3404,-8875.97 3404,-8881.97 3404,-8881.97 3404,-9610.97 3404,-9610.97 3404,-9616.97 3398,-9622.97 3392,-9622.97 3392,-9622.97 2403,-9622.97 2403,-9622.97 2397,-9622.97 2391,-9616.97 2391,-9610.97 2391,-9610.97 2391,-8881.97 2391,-8881.97 2391,-8875.97 2397,-8869.97 2403,-8869.97"/>
<text text-anchor="middle" x="2897.5" y="-9607.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 5 (GPU 138&#45;139)</text>
</g>
<g id="clust46" class="cluster">
<title>cluster_dp_2_stage1_ep_6</title>
<path fill="lightsteelblue" stroke="black" d="M2399,-8071.97C2399,-8071.97 3388,-8071.97 3388,-8071.97 3394,-8071.97 3400,-8077.97 3400,-8083.97 3400,-8083.97 3400,-8812.97 3400,-8812.97 3400,-8818.97 3394,-8824.97 3388,-8824.97 3388,-8824.97 2399,-8824.97 2399,-8824.97 2393,-8824.97 2387,-8818.97 2387,-8812.97 2387,-8812.97 2387,-8083.97 2387,-8083.97 2387,-8077.97 2393,-8071.97 2399,-8071.97"/>
<text text-anchor="middle" x="2893.5" y="-8809.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 6 (GPU 140&#45;141)</text>
</g>
<g id="clust47" class="cluster">
<title>cluster_dp_2_stage1_ep_7</title>
<path fill="lightsteelblue" stroke="black" d="M2399,-7273.97C2399,-7273.97 3388,-7273.97 3388,-7273.97 3394,-7273.97 3400,-7279.97 3400,-7285.97 3400,-7285.97 3400,-8014.97 3400,-8014.97 3400,-8020.97 3394,-8026.97 3388,-8026.97 3388,-8026.97 2399,-8026.97 2399,-8026.97 2393,-8026.97 2387,-8020.97 2387,-8014.97 2387,-8014.97 2387,-7285.97 2387,-7285.97 2387,-7279.97 2393,-7273.97 2399,-7273.97"/>
<text text-anchor="middle" x="2893.5" y="-8011.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 7 (GPU 142&#45;143)</text>
</g>
<g id="clust49" class="cluster">
<title>cluster_dp_2_stage2_ep_0</title>
<path fill="lightsteelblue" stroke="black" d="M1367,-11925.97C1367,-11925.97 2356,-11925.97 2356,-11925.97 2362,-11925.97 2368,-11931.97 2368,-11937.97 2368,-11937.97 2368,-12692.97 2368,-12692.97 2368,-12698.97 2362,-12704.97 2356,-12704.97 2356,-12704.97 1367,-12704.97 1367,-12704.97 1361,-12704.97 1355,-12698.97 1355,-12692.97 1355,-12692.97 1355,-11937.97 1355,-11937.97 1355,-11931.97 1361,-11925.97 1367,-11925.97"/>
<text text-anchor="middle" x="1861.5" y="-12689.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 0 (GPU 144&#45;145)</text>
</g>
<g id="clust50" class="cluster">
<title>cluster_dp_2_stage2_ep_1</title>
<path fill="lightsteelblue" stroke="black" d="M1374,-11127.97C1374,-11127.97 2363,-11127.97 2363,-11127.97 2369,-11127.97 2375,-11133.97 2375,-11139.97 2375,-11139.97 2375,-11894.97 2375,-11894.97 2375,-11900.97 2369,-11906.97 2363,-11906.97 2363,-11906.97 1374,-11906.97 1374,-11906.97 1368,-11906.97 1362,-11900.97 1362,-11894.97 1362,-11894.97 1362,-11139.97 1362,-11139.97 1362,-11133.97 1368,-11127.97 1374,-11127.97"/>
<text text-anchor="middle" x="1868.5" y="-11891.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 1 (GPU 146&#45;147)</text>
</g>
<g id="clust51" class="cluster">
<title>cluster_dp_2_stage2_ep_2</title>
<path fill="lightsteelblue" stroke="black" d="M1374,-10329.97C1374,-10329.97 2363,-10329.97 2363,-10329.97 2369,-10329.97 2375,-10335.97 2375,-10341.97 2375,-10341.97 2375,-11096.97 2375,-11096.97 2375,-11102.97 2369,-11108.97 2363,-11108.97 2363,-11108.97 1374,-11108.97 1374,-11108.97 1368,-11108.97 1362,-11102.97 1362,-11096.97 1362,-11096.97 1362,-10341.97 1362,-10341.97 1362,-10335.97 1368,-10329.97 1374,-10329.97"/>
<text text-anchor="middle" x="1868.5" y="-11093.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 2 (GPU 148&#45;149)</text>
</g>
<g id="clust52" class="cluster">
<title>cluster_dp_2_stage2_ep_3</title>
<path fill="lightsteelblue" stroke="black" d="M1374,-9531.97C1374,-9531.97 2363,-9531.97 2363,-9531.97 2369,-9531.97 2375,-9537.97 2375,-9543.97 2375,-9543.97 2375,-10298.97 2375,-10298.97 2375,-10304.97 2369,-10310.97 2363,-10310.97 2363,-10310.97 1374,-10310.97 1374,-10310.97 1368,-10310.97 1362,-10304.97 1362,-10298.97 1362,-10298.97 1362,-9543.97 1362,-9543.97 1362,-9537.97 1368,-9531.97 1374,-9531.97"/>
<text text-anchor="middle" x="1868.5" y="-10295.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 3 (GPU 150&#45;151)</text>
</g>
<g id="clust53" class="cluster">
<title>cluster_dp_2_stage2_ep_4</title>
<path fill="lightsteelblue" stroke="black" d="M1378,-8733.97C1378,-8733.97 2367,-8733.97 2367,-8733.97 2373,-8733.97 2379,-8739.97 2379,-8745.97 2379,-8745.97 2379,-9500.97 2379,-9500.97 2379,-9506.97 2373,-9512.97 2367,-9512.97 2367,-9512.97 1378,-9512.97 1378,-9512.97 1372,-9512.97 1366,-9506.97 1366,-9500.97 1366,-9500.97 1366,-8745.97 1366,-8745.97 1366,-8739.97 1372,-8733.97 1378,-8733.97"/>
<text text-anchor="middle" x="1872.5" y="-9497.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 4 (GPU 152&#45;153)</text>
</g>
<g id="clust54" class="cluster">
<title>cluster_dp_2_stage2_ep_5</title>
<path fill="lightsteelblue" stroke="black" d="M1374,-7935.97C1374,-7935.97 2363,-7935.97 2363,-7935.97 2369,-7935.97 2375,-7941.97 2375,-7947.97 2375,-7947.97 2375,-8702.97 2375,-8702.97 2375,-8708.97 2369,-8714.97 2363,-8714.97 2363,-8714.97 1374,-8714.97 1374,-8714.97 1368,-8714.97 1362,-8708.97 1362,-8702.97 1362,-8702.97 1362,-7947.97 1362,-7947.97 1362,-7941.97 1368,-7935.97 1374,-7935.97"/>
<text text-anchor="middle" x="1868.5" y="-8699.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 5 (GPU 154&#45;155)</text>
</g>
<g id="clust55" class="cluster">
<title>cluster_dp_2_stage2_ep_6</title>
<path fill="lightsteelblue" stroke="black" d="M1378,-7137.97C1378,-7137.97 2367,-7137.97 2367,-7137.97 2373,-7137.97 2379,-7143.97 2379,-7149.97 2379,-7149.97 2379,-7904.97 2379,-7904.97 2379,-7910.97 2373,-7916.97 2367,-7916.97 2367,-7916.97 1378,-7916.97 1378,-7916.97 1372,-7916.97 1366,-7910.97 1366,-7904.97 1366,-7904.97 1366,-7149.97 1366,-7149.97 1366,-7143.97 1372,-7137.97 1378,-7137.97"/>
<text text-anchor="middle" x="1872.5" y="-7901.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 6 (GPU 156&#45;157)</text>
</g>
<g id="clust56" class="cluster">
<title>cluster_dp_2_stage2_ep_7</title>
<path fill="lightsteelblue" stroke="black" d="M1752,-6336.98C1752,-6336.98 2741,-6336.98 2741,-6336.98 2747,-6336.98 2753,-6342.98 2753,-6348.98 2753,-6348.98 2753,-7103.98 2753,-7103.98 2753,-7109.98 2747,-7115.98 2741,-7115.98 2741,-7115.98 1752,-7115.98 1752,-7115.98 1746,-7115.98 1740,-7109.98 1740,-7103.98 1740,-7103.98 1740,-6348.98 1740,-6348.98 1740,-6342.98 1746,-6336.98 1752,-6336.98"/>
<text text-anchor="middle" x="2246.5" y="-7100.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 7 (GPU 158&#45;159)</text>
</g>
<g id="clust59" class="cluster">
<title>cluster_dp_3_stage1_ep_0</title>
<path fill="lightsteelblue" stroke="black" d="M2789,-6472.98C2789,-6472.98 3778,-6472.98 3778,-6472.98 3784,-6472.98 3790,-6478.98 3790,-6484.98 3790,-6484.98 3790,-7216.97 3790,-7216.97 3790,-7222.97 3784,-7228.97 3778,-7228.97 3778,-7228.97 2789,-7228.97 2789,-7228.97 2783,-7228.97 2777,-7222.97 2777,-7216.97 2777,-7216.97 2777,-6484.98 2777,-6484.98 2777,-6478.98 2783,-6472.98 2789,-6472.98"/>
<text text-anchor="middle" x="3283.5" y="-7213.77" font-family="Times,serif" font-size="14.00">Expert Parallel Group 0 (GPU 192&#45;193)</text>
</g>
<g id="clust60" class="cluster">
<title>cluster_dp_3_stage1_ep_1</title>
<path fill="lightsteelblue" stroke="black" d="M2784,-5674.98C2784,-5674.98 3773,-5674.98 3773,-5674.98 3779,-5674.98 3785,-5680.98 3785,-5686.98 3785,-5686.98 3785,-6415.98 3785,-6415.98 3785,-6421.98 3779,-6427.98 3773,-6427.98 3773,-6427.98 2784,-6427.98 2784,-6427.98 2778,-6427.98 2772,-6421.98 2772,-6415.98 2772,-6415.98 2772,-5686.98 2772,-5686.98 2772,-5680.98 2778,-5674.98 2784,-5674.98"/>
<text text-anchor="middle" x="3278.5" y="-6412.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 1 (GPU 194&#45;195)</text>
</g>
<g id="clust61" class="cluster">
<title>cluster_dp_3_stage1_ep_2</title>
<path fill="lightsteelblue" stroke="black" d="M2779,-4876.98C2779,-4876.98 3768,-4876.98 3768,-4876.98 3774,-4876.98 3780,-4882.98 3780,-4888.98 3780,-4888.98 3780,-5617.98 3780,-5617.98 3780,-5623.98 3774,-5629.98 3768,-5629.98 3768,-5629.98 2779,-5629.98 2779,-5629.98 2773,-5629.98 2767,-5623.98 2767,-5617.98 2767,-5617.98 2767,-4888.98 2767,-4888.98 2767,-4882.98 2773,-4876.98 2779,-4876.98"/>
<text text-anchor="middle" x="3273.5" y="-5614.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 2 (GPU 196&#45;197)</text>
</g>
<g id="clust62" class="cluster">
<title>cluster_dp_3_stage1_ep_3</title>
<path fill="lightsteelblue" stroke="black" d="M2775,-4078.98C2775,-4078.98 3764,-4078.98 3764,-4078.98 3770,-4078.98 3776,-4084.98 3776,-4090.98 3776,-4090.98 3776,-4819.98 3776,-4819.98 3776,-4825.98 3770,-4831.98 3764,-4831.98 3764,-4831.98 2775,-4831.98 2775,-4831.98 2769,-4831.98 2763,-4825.98 2763,-4819.98 2763,-4819.98 2763,-4090.98 2763,-4090.98 2763,-4084.98 2769,-4078.98 2775,-4078.98"/>
<text text-anchor="middle" x="3269.5" y="-4816.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 3 (GPU 198&#45;199)</text>
</g>
<g id="clust63" class="cluster">
<title>cluster_dp_3_stage1_ep_4</title>
<path fill="lightsteelblue" stroke="black" d="M2767,-3280.98C2767,-3280.98 3756,-3280.98 3756,-3280.98 3762,-3280.98 3768,-3286.98 3768,-3292.98 3768,-3292.98 3768,-4021.98 3768,-4021.98 3768,-4027.98 3762,-4033.98 3756,-4033.98 3756,-4033.98 2767,-4033.98 2767,-4033.98 2761,-4033.98 2755,-4027.98 2755,-4021.98 2755,-4021.98 2755,-3292.98 2755,-3292.98 2755,-3286.98 2761,-3280.98 2767,-3280.98"/>
<text text-anchor="middle" x="3261.5" y="-4018.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 4 (GPU 200&#45;201)</text>
</g>
<g id="clust64" class="cluster">
<title>cluster_dp_3_stage1_ep_5</title>
<path fill="lightsteelblue" stroke="black" d="M2759,-2482.98C2759,-2482.98 3748,-2482.98 3748,-2482.98 3754,-2482.98 3760,-2488.98 3760,-2494.98 3760,-2494.98 3760,-3223.98 3760,-3223.98 3760,-3229.98 3754,-3235.98 3748,-3235.98 3748,-3235.98 2759,-3235.98 2759,-3235.98 2753,-3235.98 2747,-3229.98 2747,-3223.98 2747,-3223.98 2747,-2494.98 2747,-2494.98 2747,-2488.98 2753,-2482.98 2759,-2482.98"/>
<text text-anchor="middle" x="3253.5" y="-3220.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 5 (GPU 202&#45;203)</text>
</g>
<g id="clust65" class="cluster">
<title>cluster_dp_3_stage1_ep_6</title>
<path fill="lightsteelblue" stroke="black" d="M2751,-1684.98C2751,-1684.98 3740,-1684.98 3740,-1684.98 3746,-1684.98 3752,-1690.98 3752,-1696.98 3752,-1696.98 3752,-2425.98 3752,-2425.98 3752,-2431.98 3746,-2437.98 3740,-2437.98 3740,-2437.98 2751,-2437.98 2751,-2437.98 2745,-2437.98 2739,-2431.98 2739,-2425.98 2739,-2425.98 2739,-1696.98 2739,-1696.98 2739,-1690.98 2745,-1684.98 2751,-1684.98"/>
<text text-anchor="middle" x="3245.5" y="-2422.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 6 (GPU 204&#45;205)</text>
</g>
<g id="clust66" class="cluster">
<title>cluster_dp_3_stage1_ep_7</title>
<path fill="lightsteelblue" stroke="black" d="M2743,-886.98C2743,-886.98 3732,-886.98 3732,-886.98 3738,-886.98 3744,-892.98 3744,-898.98 3744,-898.98 3744,-1627.98 3744,-1627.98 3744,-1633.98 3738,-1639.98 3732,-1639.98 3732,-1639.98 2743,-1639.98 2743,-1639.98 2737,-1639.98 2731,-1633.98 2731,-1627.98 2731,-1627.98 2731,-898.98 2731,-898.98 2731,-892.98 2737,-886.98 2743,-886.98"/>
<text text-anchor="middle" x="3237.5" y="-1624.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 7 (GPU 206&#45;207)</text>
</g>
<g id="clust68" class="cluster">
<title>cluster_dp_3_stage2_ep_0</title>
<path fill="lightsteelblue" stroke="black" d="M1752,-5538.98C1752,-5538.98 2741,-5538.98 2741,-5538.98 2747,-5538.98 2753,-5544.98 2753,-5550.98 2753,-5550.98 2753,-6305.98 2753,-6305.98 2753,-6311.98 2747,-6317.98 2741,-6317.98 2741,-6317.98 1752,-6317.98 1752,-6317.98 1746,-6317.98 1740,-6311.98 1740,-6305.98 1740,-6305.98 1740,-5550.98 1740,-5550.98 1740,-5544.98 1746,-5538.98 1752,-5538.98"/>
<text text-anchor="middle" x="2246.5" y="-6302.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 0 (GPU 208&#45;209)</text>
</g>
<g id="clust69" class="cluster">
<title>cluster_dp_3_stage2_ep_1</title>
<path fill="lightsteelblue" stroke="black" d="M1754,-4740.98C1754,-4740.98 2743,-4740.98 2743,-4740.98 2749,-4740.98 2755,-4746.98 2755,-4752.98 2755,-4752.98 2755,-5507.98 2755,-5507.98 2755,-5513.98 2749,-5519.98 2743,-5519.98 2743,-5519.98 1754,-5519.98 1754,-5519.98 1748,-5519.98 1742,-5513.98 1742,-5507.98 1742,-5507.98 1742,-4752.98 1742,-4752.98 1742,-4746.98 1748,-4740.98 1754,-4740.98"/>
<text text-anchor="middle" x="2248.5" y="-5504.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 1 (GPU 210&#45;211)</text>
</g>
<g id="clust70" class="cluster">
<title>cluster_dp_3_stage2_ep_2</title>
<path fill="lightsteelblue" stroke="black" d="M1746,-3942.98C1746,-3942.98 2735,-3942.98 2735,-3942.98 2741,-3942.98 2747,-3948.98 2747,-3954.98 2747,-3954.98 2747,-4709.98 2747,-4709.98 2747,-4715.98 2741,-4721.98 2735,-4721.98 2735,-4721.98 1746,-4721.98 1746,-4721.98 1740,-4721.98 1734,-4715.98 1734,-4709.98 1734,-4709.98 1734,-3954.98 1734,-3954.98 1734,-3948.98 1740,-3942.98 1746,-3942.98"/>
<text text-anchor="middle" x="2240.5" y="-4706.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 2 (GPU 212&#45;213)</text>
</g>
<g id="clust71" class="cluster">
<title>cluster_dp_3_stage2_ep_3</title>
<path fill="lightsteelblue" stroke="black" d="M1738,-3144.98C1738,-3144.98 2727,-3144.98 2727,-3144.98 2733,-3144.98 2739,-3150.98 2739,-3156.98 2739,-3156.98 2739,-3911.98 2739,-3911.98 2739,-3917.98 2733,-3923.98 2727,-3923.98 2727,-3923.98 1738,-3923.98 1738,-3923.98 1732,-3923.98 1726,-3917.98 1726,-3911.98 1726,-3911.98 1726,-3156.98 1726,-3156.98 1726,-3150.98 1732,-3144.98 1738,-3144.98"/>
<text text-anchor="middle" x="2232.5" y="-3908.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 3 (GPU 214&#45;215)</text>
</g>
<g id="clust72" class="cluster">
<title>cluster_dp_3_stage2_ep_4</title>
<path fill="lightsteelblue" stroke="black" d="M1730,-2346.98C1730,-2346.98 2719,-2346.98 2719,-2346.98 2725,-2346.98 2731,-2352.98 2731,-2358.98 2731,-2358.98 2731,-3113.98 2731,-3113.98 2731,-3119.98 2725,-3125.98 2719,-3125.98 2719,-3125.98 1730,-3125.98 1730,-3125.98 1724,-3125.98 1718,-3119.98 1718,-3113.98 1718,-3113.98 1718,-2358.98 1718,-2358.98 1718,-2352.98 1724,-2346.98 1730,-2346.98"/>
<text text-anchor="middle" x="2224.5" y="-3110.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 4 (GPU 216&#45;217)</text>
</g>
<g id="clust73" class="cluster">
<title>cluster_dp_3_stage2_ep_5</title>
<path fill="lightsteelblue" stroke="black" d="M1722,-1548.98C1722,-1548.98 2711,-1548.98 2711,-1548.98 2717,-1548.98 2723,-1554.98 2723,-1560.98 2723,-1560.98 2723,-2315.98 2723,-2315.98 2723,-2321.98 2717,-2327.98 2711,-2327.98 2711,-2327.98 1722,-2327.98 1722,-2327.98 1716,-2327.98 1710,-2321.98 1710,-2315.98 1710,-2315.98 1710,-1560.98 1710,-1560.98 1710,-1554.98 1716,-1548.98 1722,-1548.98"/>
<text text-anchor="middle" x="2216.5" y="-2312.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 5 (GPU 218&#45;219)</text>
</g>
<g id="clust74" class="cluster">
<title>cluster_dp_3_stage2_ep_6</title>
<path fill="lightsteelblue" stroke="black" d="M1722,-768.99C1722,-768.99 2711,-768.99 2711,-768.99 2717,-768.99 2723,-774.99 2723,-780.99 2723,-780.99 2723,-1517.98 2723,-1517.98 2723,-1523.98 2717,-1529.98 2711,-1529.98 2711,-1529.98 1722,-1529.98 1722,-1529.98 1716,-1529.98 1710,-1523.98 1710,-1517.98 1710,-1517.98 1710,-780.99 1710,-780.99 1710,-774.99 1716,-768.99 1722,-768.99"/>
<text text-anchor="middle" x="2216.5" y="-1514.78" font-family="Times,serif" font-size="14.00">Expert Parallel Group 6 (GPU 220&#45;221)</text>
</g>
<g id="clust75" class="cluster">
<title>cluster_dp_3_stage2_ep_7</title>
<path fill="lightsteelblue" stroke="black" d="M2245,-107C2245,-107 3234,-107 3234,-107 3240,-107 3246,-113 3246,-119 3246,-119 3246,-735 3246,-735 3246,-741 3240,-747 3234,-747 3234,-747 2245,-747 2245,-747 2239,-747 2233,-741 2233,-735 2233,-735 2233,-119 2233,-119 2233,-113 2239,-107 2245,-107"/>
<text text-anchor="middle" x="2739.5" y="-731.8" font-family="Times,serif" font-size="14.00">Expert Parallel Group 7 (GPU 222&#45;223)</text>
</g>
<g id="clust78" class="cluster">
<title>cluster_output</title>
<path fill="lightgray" stroke="black" d="M2659,-8C2659,-8 2909,-8 2909,-8 2915,-8 2921,-14 2921,-20 2921,-20 2921,-76 2921,-76 2921,-82 2915,-88 2909,-88 2909,-88 2659,-88 2659,-88 2653,-88 2647,-82 2647,-76 2647,-76 2647,-20 2647,-20 2647,-14 2653,-8 2659,-8"/>
<text text-anchor="middle" x="2784" y="-72.8" font-family="Times,serif" font-size="14.00">Output Layer</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightgreen" stroke="black" points="384.5,-26352.45 149.5,-26352.45 149.5,-26311.45 384.5,-26311.45 384.5,-26352.45"/>
<text text-anchor="middle" x="267" y="-26340.45" font-family="Times,serif" font-size="10.00">Input Tokens</text>
<text text-anchor="middle" x="267" y="-26329.45" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-26318.45" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep0_tp0 -->
<g id="node2" class="node">
<title>ln1_dp0_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-26230.96 152.5,-26230.96 152.5,-26178.96 381.5,-26178.96 381.5,-26230.96"/>
<text text-anchor="middle" x="267" y="-26218.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="267" y="-26207.96" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="267" y="-26196.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-26185.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- input&#45;&gt;ln1_dp0_ep0_tp0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;ln1_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M267,-26311.42C267,-26292.81 267,-26264.34 267,-26241.67"/>
<polygon fill="black" stroke="black" points="270.5,-26241.4 267,-26231.4 263.5,-26241.4 270.5,-26241.4"/>
<text text-anchor="middle" x="330.5" y="-26273.76" font-family="Times,serif" font-size="14.00">batch=128â†’32x4</text>
</g>
<!-- mha_dp0_ep0_tp0 -->
<g id="node3" class="node">
<title>mha_dp0_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-26141.96 152.5,-26141.96 152.5,-26089.96 381.5,-26089.96 381.5,-26141.96"/>
<text text-anchor="middle" x="267" y="-26129.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="267" y="-26118.96" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="267" y="-26107.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-26096.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep0_tp0&#45;&gt;mha_dp0_ep0_tp0 -->
<g id="edge2" class="edge">
<title>ln1_dp0_ep0_tp0&#45;&gt;mha_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M267,-26178.79C267,-26170.5 267,-26161.11 267,-26152.21"/>
<polygon fill="black" stroke="black" points="270.5,-26152.06 267,-26142.06 263.5,-26152.06 270.5,-26152.06"/>
</g>
<!-- moe_gate_dp0_ep0_tp0 -->
<g id="node4" class="node">
<title>moe_gate_dp0_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="511.85,-26052.96 122.35,-26052.96 22.15,-25948.96 411.65,-25948.96 511.85,-26052.96"/>
<text text-anchor="middle" x="267" y="-26014.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="267" y="-26003.96" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="267" y="-25992.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-25981.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep0_tp0&#45;&gt;moe_gate_dp0_ep0_tp0 -->
<g id="edge3" class="edge">
<title>mha_dp0_ep0_tp0&#45;&gt;moe_gate_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M267,-26089.88C267,-26081.95 267,-26072.82 267,-26063.5"/>
<polygon fill="black" stroke="black" points="270.5,-26063.36 267,-26053.36 263.5,-26063.36 270.5,-26063.36"/>
</g>
<!-- expert1_dp0_ep0_tp0 -->
<g id="node5" class="node">
<title>expert1_dp0_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="258.5,-25897.96 23.5,-25897.96 23.5,-25845.96 258.5,-25845.96 258.5,-25897.96"/>
<text text-anchor="middle" x="141" y="-25885.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="141" y="-25874.96" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="141" y="-25863.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="141" y="-25852.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep0_tp0&#45;&gt;expert1_dp0_ep0_tp0 -->
<g id="edge4" class="edge">
<title>moe_gate_dp0_ep0_tp0&#45;&gt;expert1_dp0_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M216.11,-25948.67C201.73,-25934.17 186.46,-25918.78 173.48,-25905.69"/>
<polygon fill="black" stroke="black" points="175.65,-25902.91 166.12,-25898.28 170.68,-25907.84 175.65,-25902.91"/>
<text text-anchor="middle" x="254.5" y="-25919.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep0_tp0 -->
<g id="node6" class="node">
<title>expert2_dp0_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="511.5,-25897.96 276.5,-25897.96 276.5,-25845.96 511.5,-25845.96 511.5,-25897.96"/>
<text text-anchor="middle" x="394" y="-25885.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="394" y="-25874.96" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="394" y="-25863.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="394" y="-25852.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep0_tp0&#45;&gt;expert2_dp0_ep0_tp0 -->
<g id="edge5" class="edge">
<title>moe_gate_dp0_ep0_tp0&#45;&gt;expert2_dp0_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M318.29,-25948.67C332.79,-25934.17 348.18,-25918.78 361.26,-25905.69"/>
<polygon fill="black" stroke="black" points="364.08,-25907.82 368.68,-25898.28 359.13,-25902.87 364.08,-25907.82"/>
<text text-anchor="middle" x="407.5" y="-25919.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep0_tp0 -->
<g id="node7" class="node">
<title>expert_agg_dp0_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="504.33,-25808.96 126.79,-25808.96 29.67,-25704.96 407.21,-25704.96 504.33,-25808.96"/>
<text text-anchor="middle" x="267" y="-25770.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="267" y="-25759.96" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="267" y="-25748.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="267" y="-25737.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep0_tp0&#45;&gt;expert_agg_dp0_ep0_tp0 -->
<g id="edge6" class="edge">
<title>expert1_dp0_ep0_tp0&#45;&gt;expert_agg_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M168.96,-25845.88C178.9,-25836.97 190.53,-25826.54 202.25,-25816.03"/>
<polygon fill="black" stroke="black" points="204.83,-25818.41 209.94,-25809.13 200.16,-25813.2 204.83,-25818.41"/>
</g>
<!-- expert2_dp0_ep0_tp0&#45;&gt;expert_agg_dp0_ep0_tp0 -->
<g id="edge7" class="edge">
<title>expert2_dp0_ep0_tp0&#45;&gt;expert_agg_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M365.81,-25845.88C355.8,-25836.97 344.08,-25826.54 332.27,-25816.03"/>
<polygon fill="black" stroke="black" points="334.31,-25813.16 324.51,-25809.13 329.66,-25818.39 334.31,-25813.16"/>
</g>
<!-- ln2_dp0_ep0_tp0 -->
<g id="node8" class="node">
<title>ln2_dp0_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-25667.96 152.5,-25667.96 152.5,-25615.96 381.5,-25615.96 381.5,-25667.96"/>
<text text-anchor="middle" x="267" y="-25655.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="267" y="-25644.96" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="267" y="-25633.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-25622.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep0_tp0&#45;&gt;ln2_dp0_ep0_tp0 -->
<g id="edge8" class="edge">
<title>expert_agg_dp0_ep0_tp0&#45;&gt;ln2_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M267,-25704.75C267,-25695.8 267,-25686.67 267,-25678.27"/>
<polygon fill="black" stroke="black" points="270.5,-25678.09 267,-25668.09 263.5,-25678.09 270.5,-25678.09"/>
</g>
<!-- ln1_dp0_ep1_tp0 -->
<g id="node16" class="node">
<title>ln1_dp0_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-25557.96 152.5,-25557.96 152.5,-25505.96 381.5,-25505.96 381.5,-25557.96"/>
<text text-anchor="middle" x="267" y="-25545.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="267" y="-25534.96" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="267" y="-25523.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-25512.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep0_tp0&#45;&gt;ln1_dp0_ep1_tp0 -->
<g id="edge9" class="edge">
<title>ln2_dp0_ep0_tp0&#45;&gt;ln1_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M267,-25615.91C267,-25601.83 267,-25584.03 267,-25568.53"/>
<polygon fill="black" stroke="black" points="270.5,-25568.24 267,-25558.24 263.5,-25568.24 270.5,-25568.24"/>
</g>
<!-- ln1_dp0_ep0_tp1 -->
<g id="node9" class="node">
<title>ln1_dp0_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-26230.96 659.5,-26230.96 659.5,-26178.96 888.5,-26178.96 888.5,-26230.96"/>
<text text-anchor="middle" x="774" y="-26218.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="774" y="-26207.96" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="774" y="-26196.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-26185.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- mha_dp0_ep0_tp1 -->
<g id="node10" class="node">
<title>mha_dp0_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-26141.96 659.5,-26141.96 659.5,-26089.96 888.5,-26089.96 888.5,-26141.96"/>
<text text-anchor="middle" x="774" y="-26129.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="774" y="-26118.96" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="774" y="-26107.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-26096.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep0_tp1&#45;&gt;mha_dp0_ep0_tp1 -->
<g id="edge10" class="edge">
<title>ln1_dp0_ep0_tp1&#45;&gt;mha_dp0_ep0_tp1</title>
<path fill="none" stroke="black" d="M774,-26178.79C774,-26170.5 774,-26161.11 774,-26152.21"/>
<polygon fill="black" stroke="black" points="777.5,-26152.06 774,-26142.06 770.5,-26152.06 777.5,-26152.06"/>
</g>
<!-- moe_gate_dp0_ep0_tp1 -->
<g id="node11" class="node">
<title>moe_gate_dp0_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1018.85,-26052.96 629.35,-26052.96 529.15,-25948.96 918.65,-25948.96 1018.85,-26052.96"/>
<text text-anchor="middle" x="774" y="-26014.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="774" y="-26003.96" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="774" y="-25992.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-25981.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep0_tp1&#45;&gt;moe_gate_dp0_ep0_tp1 -->
<g id="edge11" class="edge">
<title>mha_dp0_ep0_tp1&#45;&gt;moe_gate_dp0_ep0_tp1</title>
<path fill="none" stroke="black" d="M774,-26089.88C774,-26081.95 774,-26072.82 774,-26063.5"/>
<polygon fill="black" stroke="black" points="777.5,-26063.36 774,-26053.36 770.5,-26063.36 777.5,-26063.36"/>
</g>
<!-- expert1_dp0_ep0_tp1 -->
<g id="node12" class="node">
<title>expert1_dp0_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="764.5,-25897.96 529.5,-25897.96 529.5,-25845.96 764.5,-25845.96 764.5,-25897.96"/>
<text text-anchor="middle" x="647" y="-25885.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="647" y="-25874.96" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="647" y="-25863.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="647" y="-25852.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep0_tp1&#45;&gt;expert1_dp0_ep0_tp1 -->
<g id="edge12" class="edge">
<title>moe_gate_dp0_ep0_tp1&#45;&gt;expert1_dp0_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M722.71,-25948.67C708.21,-25934.17 692.82,-25918.78 679.74,-25905.69"/>
<polygon fill="black" stroke="black" points="681.87,-25902.87 672.32,-25898.28 676.92,-25907.82 681.87,-25902.87"/>
<text text-anchor="middle" x="760.5" y="-25919.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep0_tp1 -->
<g id="node13" class="node">
<title>expert2_dp0_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1017.5,-25897.96 782.5,-25897.96 782.5,-25845.96 1017.5,-25845.96 1017.5,-25897.96"/>
<text text-anchor="middle" x="900" y="-25885.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="900" y="-25874.96" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="900" y="-25863.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="900" y="-25852.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep0_tp1&#45;&gt;expert2_dp0_ep0_tp1 -->
<g id="edge13" class="edge">
<title>moe_gate_dp0_ep0_tp1&#45;&gt;expert2_dp0_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M824.89,-25948.67C839.27,-25934.17 854.54,-25918.78 867.52,-25905.69"/>
<polygon fill="black" stroke="black" points="870.32,-25907.84 874.88,-25898.28 865.35,-25902.91 870.32,-25907.84"/>
<text text-anchor="middle" x="913.5" y="-25919.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep0_tp1 -->
<g id="node14" class="node">
<title>expert_agg_dp0_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1011.33,-25808.96 633.79,-25808.96 536.67,-25704.96 914.21,-25704.96 1011.33,-25808.96"/>
<text text-anchor="middle" x="774" y="-25770.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="774" y="-25759.96" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="774" y="-25748.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="774" y="-25737.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep0_tp1&#45;&gt;expert_agg_dp0_ep0_tp1 -->
<g id="edge14" class="edge">
<title>expert1_dp0_ep0_tp1&#45;&gt;expert_agg_dp0_ep0_tp1</title>
<path fill="none" stroke="black" d="M675.19,-25845.88C685.2,-25836.97 696.92,-25826.54 708.73,-25816.03"/>
<polygon fill="black" stroke="black" points="711.34,-25818.39 716.49,-25809.13 706.69,-25813.16 711.34,-25818.39"/>
</g>
<!-- expert2_dp0_ep0_tp1&#45;&gt;expert_agg_dp0_ep0_tp1 -->
<g id="edge15" class="edge">
<title>expert2_dp0_ep0_tp1&#45;&gt;expert_agg_dp0_ep0_tp1</title>
<path fill="none" stroke="black" d="M872.04,-25845.88C862.1,-25836.97 850.47,-25826.54 838.75,-25816.03"/>
<polygon fill="black" stroke="black" points="840.84,-25813.2 831.06,-25809.13 836.17,-25818.41 840.84,-25813.2"/>
</g>
<!-- ln2_dp0_ep0_tp1 -->
<g id="node15" class="node">
<title>ln2_dp0_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-25667.96 659.5,-25667.96 659.5,-25615.96 888.5,-25615.96 888.5,-25667.96"/>
<text text-anchor="middle" x="774" y="-25655.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="774" y="-25644.96" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="774" y="-25633.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-25622.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep0_tp1&#45;&gt;ln2_dp0_ep0_tp1 -->
<g id="edge16" class="edge">
<title>expert_agg_dp0_ep0_tp1&#45;&gt;ln2_dp0_ep0_tp1</title>
<path fill="none" stroke="black" d="M774,-25704.75C774,-25695.8 774,-25686.67 774,-25678.27"/>
<polygon fill="black" stroke="black" points="777.5,-25678.09 774,-25668.09 770.5,-25678.09 777.5,-25678.09"/>
</g>
<!-- ln1_dp0_ep1_tp1 -->
<g id="node23" class="node">
<title>ln1_dp0_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-25557.96 659.5,-25557.96 659.5,-25505.96 888.5,-25505.96 888.5,-25557.96"/>
<text text-anchor="middle" x="774" y="-25545.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="774" y="-25534.96" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="774" y="-25523.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-25512.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep0_tp1&#45;&gt;ln1_dp0_ep1_tp1 -->
<g id="edge17" class="edge">
<title>ln2_dp0_ep0_tp1&#45;&gt;ln1_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M774,-25615.91C774,-25601.83 774,-25584.03 774,-25568.53"/>
<polygon fill="black" stroke="black" points="777.5,-25568.24 774,-25558.24 770.5,-25568.24 777.5,-25568.24"/>
</g>
<!-- mha_dp0_ep1_tp0 -->
<g id="node17" class="node">
<title>mha_dp0_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-25447.96 152.5,-25447.96 152.5,-25395.96 381.5,-25395.96 381.5,-25447.96"/>
<text text-anchor="middle" x="267" y="-25435.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="267" y="-25424.96" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="267" y="-25413.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-25402.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep1_tp0&#45;&gt;mha_dp0_ep1_tp0 -->
<g id="edge18" class="edge">
<title>ln1_dp0_ep1_tp0&#45;&gt;mha_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M267,-25505.91C267,-25491.83 267,-25474.03 267,-25458.53"/>
<polygon fill="black" stroke="black" points="270.5,-25458.24 267,-25448.24 263.5,-25458.24 270.5,-25458.24"/>
</g>
<!-- moe_gate_dp0_ep1_tp0 -->
<g id="node18" class="node">
<title>moe_gate_dp0_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="511.85,-25358.96 122.35,-25358.96 22.15,-25254.96 411.65,-25254.96 511.85,-25358.96"/>
<text text-anchor="middle" x="267" y="-25320.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="267" y="-25309.96" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="267" y="-25298.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-25287.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep1_tp0&#45;&gt;moe_gate_dp0_ep1_tp0 -->
<g id="edge19" class="edge">
<title>mha_dp0_ep1_tp0&#45;&gt;moe_gate_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M267,-25395.88C267,-25387.95 267,-25378.82 267,-25369.5"/>
<polygon fill="black" stroke="black" points="270.5,-25369.36 267,-25359.36 263.5,-25369.36 270.5,-25369.36"/>
</g>
<!-- expert1_dp0_ep1_tp0 -->
<g id="node19" class="node">
<title>expert1_dp0_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="258.5,-25177.96 23.5,-25177.96 23.5,-25125.96 258.5,-25125.96 258.5,-25177.96"/>
<text text-anchor="middle" x="141" y="-25165.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="141" y="-25154.96" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="141" y="-25143.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="141" y="-25132.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep1_tp0&#45;&gt;expert1_dp0_ep1_tp0 -->
<g id="edge20" class="edge">
<title>moe_gate_dp0_ep1_tp0&#45;&gt;expert1_dp0_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M224.69,-25254.58C206.09,-25232 184.79,-25206.13 168.33,-25186.14"/>
<polygon fill="black" stroke="black" points="170.88,-25183.73 161.82,-25178.24 165.47,-25188.18 170.88,-25183.73"/>
<text text-anchor="middle" x="265.5" y="-25225.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep1_tp0 -->
<g id="node20" class="node">
<title>expert2_dp0_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="511.5,-25177.96 276.5,-25177.96 276.5,-25125.96 511.5,-25125.96 511.5,-25177.96"/>
<text text-anchor="middle" x="394" y="-25165.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="394" y="-25154.96" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="394" y="-25143.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="394" y="-25132.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep1_tp0&#45;&gt;expert2_dp0_ep1_tp0 -->
<g id="edge21" class="edge">
<title>moe_gate_dp0_ep1_tp0&#45;&gt;expert2_dp0_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M311.8,-25254.92C316.97,-25248.9 322.12,-25242.81 327,-25236.96 340.7,-25220.51 355.58,-25201.93 367.83,-25186.43"/>
<polygon fill="black" stroke="black" points="370.9,-25188.2 374.34,-25178.18 365.4,-25183.86 370.9,-25188.2"/>
<text text-anchor="middle" x="396.5" y="-25225.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep1_tp0 -->
<g id="node21" class="node">
<title>expert_agg_dp0_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="504.33,-25062.96 126.79,-25062.96 29.67,-24958.96 407.21,-24958.96 504.33,-25062.96"/>
<text text-anchor="middle" x="267" y="-25024.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="267" y="-25013.96" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="267" y="-25002.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="267" y="-24991.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep1_tp0&#45;&gt;expert_agg_dp0_ep1_tp0 -->
<g id="edge22" class="edge">
<title>expert1_dp0_ep1_tp0&#45;&gt;expert_agg_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M163.82,-25125.79C177.78,-25110.38 196.26,-25090 213.72,-25070.74"/>
<polygon fill="black" stroke="black" points="216.48,-25072.9 220.6,-25063.14 211.3,-25068.2 216.48,-25072.9"/>
</g>
<!-- expert2_dp0_ep1_tp0&#45;&gt;expert_agg_dp0_ep1_tp0 -->
<g id="edge23" class="edge">
<title>expert2_dp0_ep1_tp0&#45;&gt;expert_agg_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M371,-25125.79C356.93,-25110.38 338.3,-25090 320.7,-25070.74"/>
<polygon fill="black" stroke="black" points="323.09,-25068.16 313.76,-25063.14 317.93,-25072.88 323.09,-25068.16"/>
</g>
<!-- ln2_dp0_ep1_tp0 -->
<g id="node22" class="node">
<title>ln2_dp0_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-24895.96 152.5,-24895.96 152.5,-24843.96 381.5,-24843.96 381.5,-24895.96"/>
<text text-anchor="middle" x="267" y="-24883.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="267" y="-24872.96" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="267" y="-24861.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-24850.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep1_tp0&#45;&gt;ln2_dp0_ep1_tp0 -->
<g id="edge24" class="edge">
<title>expert_agg_dp0_ep1_tp0&#45;&gt;ln2_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M267,-24958.59C267,-24941.25 267,-24922.29 267,-24906.45"/>
<polygon fill="black" stroke="black" points="270.5,-24906.05 267,-24896.05 263.5,-24906.05 270.5,-24906.05"/>
</g>
<!-- ln1_dp0_ep2_tp0 -->
<g id="node30" class="node">
<title>ln1_dp0_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-24759.96 152.5,-24759.96 152.5,-24707.96 381.5,-24707.96 381.5,-24759.96"/>
<text text-anchor="middle" x="267" y="-24747.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="267" y="-24736.96" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="267" y="-24725.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-24714.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep1_tp0&#45;&gt;ln1_dp0_ep2_tp0 -->
<g id="edge25" class="edge">
<title>ln2_dp0_ep1_tp0&#45;&gt;ln1_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M267,-24843.75C267,-24822.98 267,-24793.28 267,-24770.15"/>
<polygon fill="black" stroke="black" points="270.5,-24770.05 267,-24760.05 263.5,-24770.05 270.5,-24770.05"/>
</g>
<!-- mha_dp0_ep1_tp1 -->
<g id="node24" class="node">
<title>mha_dp0_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-25447.96 659.5,-25447.96 659.5,-25395.96 888.5,-25395.96 888.5,-25447.96"/>
<text text-anchor="middle" x="774" y="-25435.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="774" y="-25424.96" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="774" y="-25413.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-25402.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep1_tp1&#45;&gt;mha_dp0_ep1_tp1 -->
<g id="edge26" class="edge">
<title>ln1_dp0_ep1_tp1&#45;&gt;mha_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M774,-25505.91C774,-25491.83 774,-25474.03 774,-25458.53"/>
<polygon fill="black" stroke="black" points="777.5,-25458.24 774,-25448.24 770.5,-25458.24 777.5,-25458.24"/>
</g>
<!-- moe_gate_dp0_ep1_tp1 -->
<g id="node25" class="node">
<title>moe_gate_dp0_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1018.85,-25358.96 629.35,-25358.96 529.15,-25254.96 918.65,-25254.96 1018.85,-25358.96"/>
<text text-anchor="middle" x="774" y="-25320.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="774" y="-25309.96" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="774" y="-25298.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-25287.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep1_tp1&#45;&gt;moe_gate_dp0_ep1_tp1 -->
<g id="edge27" class="edge">
<title>mha_dp0_ep1_tp1&#45;&gt;moe_gate_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M774,-25395.88C774,-25387.95 774,-25378.82 774,-25369.5"/>
<polygon fill="black" stroke="black" points="777.5,-25369.36 774,-25359.36 770.5,-25369.36 777.5,-25369.36"/>
</g>
<!-- expert1_dp0_ep1_tp1 -->
<g id="node26" class="node">
<title>expert1_dp0_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="764.5,-25177.96 529.5,-25177.96 529.5,-25125.96 764.5,-25125.96 764.5,-25177.96"/>
<text text-anchor="middle" x="647" y="-25165.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="647" y="-25154.96" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="647" y="-25143.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="647" y="-25132.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep1_tp1&#45;&gt;expert1_dp0_ep1_tp1 -->
<g id="edge28" class="edge">
<title>moe_gate_dp0_ep1_tp1&#45;&gt;expert1_dp0_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M730.03,-25254.84C724.94,-25248.83 719.84,-25242.77 715,-25236.96 701.1,-25220.25 685.86,-25201.47 673.34,-25185.91"/>
<polygon fill="black" stroke="black" points="676.05,-25183.7 667.06,-25178.09 670.59,-25188.08 676.05,-25183.7"/>
<text text-anchor="middle" x="772.5" y="-25225.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep1_tp1 -->
<g id="node27" class="node">
<title>expert2_dp0_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1017.5,-25177.96 782.5,-25177.96 782.5,-25125.96 1017.5,-25125.96 1017.5,-25177.96"/>
<text text-anchor="middle" x="900" y="-25165.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="900" y="-25154.96" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="900" y="-25143.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="900" y="-25132.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep1_tp1&#45;&gt;expert2_dp0_ep1_tp1 -->
<g id="edge29" class="edge">
<title>moe_gate_dp0_ep1_tp1&#45;&gt;expert2_dp0_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M816.31,-25254.58C834.91,-25232 856.21,-25206.13 872.67,-25186.14"/>
<polygon fill="black" stroke="black" points="875.53,-25188.18 879.18,-25178.24 870.12,-25183.73 875.53,-25188.18"/>
<text text-anchor="middle" x="898.5" y="-25225.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep1_tp1 -->
<g id="node28" class="node">
<title>expert_agg_dp0_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1011.33,-25062.96 633.79,-25062.96 536.67,-24958.96 914.21,-24958.96 1011.33,-25062.96"/>
<text text-anchor="middle" x="774" y="-25024.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="774" y="-25013.96" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="774" y="-25002.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="774" y="-24991.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep1_tp1&#45;&gt;expert_agg_dp0_ep1_tp1 -->
<g id="edge30" class="edge">
<title>expert1_dp0_ep1_tp1&#45;&gt;expert_agg_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M670,-25125.79C684.07,-25110.38 702.7,-25090 720.3,-25070.74"/>
<polygon fill="black" stroke="black" points="723.07,-25072.88 727.24,-25063.14 717.91,-25068.16 723.07,-25072.88"/>
</g>
<!-- expert2_dp0_ep1_tp1&#45;&gt;expert_agg_dp0_ep1_tp1 -->
<g id="edge31" class="edge">
<title>expert2_dp0_ep1_tp1&#45;&gt;expert_agg_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M877.18,-25125.79C863.22,-25110.38 844.74,-25090 827.28,-25070.74"/>
<polygon fill="black" stroke="black" points="829.7,-25068.2 820.4,-25063.14 824.52,-25072.9 829.7,-25068.2"/>
</g>
<!-- ln2_dp0_ep1_tp1 -->
<g id="node29" class="node">
<title>ln2_dp0_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-24895.96 659.5,-24895.96 659.5,-24843.96 888.5,-24843.96 888.5,-24895.96"/>
<text text-anchor="middle" x="774" y="-24883.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="774" y="-24872.96" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="774" y="-24861.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-24850.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep1_tp1&#45;&gt;ln2_dp0_ep1_tp1 -->
<g id="edge32" class="edge">
<title>expert_agg_dp0_ep1_tp1&#45;&gt;ln2_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M774,-24958.59C774,-24941.25 774,-24922.29 774,-24906.45"/>
<polygon fill="black" stroke="black" points="777.5,-24906.05 774,-24896.05 770.5,-24906.05 777.5,-24906.05"/>
</g>
<!-- ln1_dp0_ep2_tp1 -->
<g id="node37" class="node">
<title>ln1_dp0_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-24759.96 659.5,-24759.96 659.5,-24707.96 888.5,-24707.96 888.5,-24759.96"/>
<text text-anchor="middle" x="774" y="-24747.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="774" y="-24736.96" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="774" y="-24725.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-24714.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep1_tp1&#45;&gt;ln1_dp0_ep2_tp1 -->
<g id="edge33" class="edge">
<title>ln2_dp0_ep1_tp1&#45;&gt;ln1_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M774,-24843.75C774,-24822.98 774,-24793.28 774,-24770.15"/>
<polygon fill="black" stroke="black" points="777.5,-24770.05 774,-24760.05 770.5,-24770.05 777.5,-24770.05"/>
</g>
<!-- mha_dp0_ep2_tp0 -->
<g id="node31" class="node">
<title>mha_dp0_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-24649.96 152.5,-24649.96 152.5,-24597.96 381.5,-24597.96 381.5,-24649.96"/>
<text text-anchor="middle" x="267" y="-24637.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="267" y="-24626.96" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="267" y="-24615.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-24604.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep2_tp0&#45;&gt;mha_dp0_ep2_tp0 -->
<g id="edge34" class="edge">
<title>ln1_dp0_ep2_tp0&#45;&gt;mha_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M267,-24707.91C267,-24693.83 267,-24676.03 267,-24660.53"/>
<polygon fill="black" stroke="black" points="270.5,-24660.24 267,-24650.24 263.5,-24660.24 270.5,-24660.24"/>
</g>
<!-- moe_gate_dp0_ep2_tp0 -->
<g id="node32" class="node">
<title>moe_gate_dp0_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="511.85,-24560.96 122.35,-24560.96 22.15,-24456.96 411.65,-24456.96 511.85,-24560.96"/>
<text text-anchor="middle" x="267" y="-24522.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="267" y="-24511.96" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="267" y="-24500.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-24489.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep2_tp0&#45;&gt;moe_gate_dp0_ep2_tp0 -->
<g id="edge35" class="edge">
<title>mha_dp0_ep2_tp0&#45;&gt;moe_gate_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M267,-24597.88C267,-24589.95 267,-24580.82 267,-24571.5"/>
<polygon fill="black" stroke="black" points="270.5,-24571.36 267,-24561.36 263.5,-24571.36 270.5,-24571.36"/>
</g>
<!-- expert1_dp0_ep2_tp0 -->
<g id="node33" class="node">
<title>expert1_dp0_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="258.5,-24379.96 23.5,-24379.96 23.5,-24327.96 258.5,-24327.96 258.5,-24379.96"/>
<text text-anchor="middle" x="141" y="-24367.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="141" y="-24356.96" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="141" y="-24345.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="141" y="-24334.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep2_tp0&#45;&gt;expert1_dp0_ep2_tp0 -->
<g id="edge36" class="edge">
<title>moe_gate_dp0_ep2_tp0&#45;&gt;expert1_dp0_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M224.69,-24456.58C206.09,-24434 184.79,-24408.13 168.33,-24388.14"/>
<polygon fill="black" stroke="black" points="170.88,-24385.73 161.82,-24380.24 165.47,-24390.18 170.88,-24385.73"/>
<text text-anchor="middle" x="265.5" y="-24427.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep2_tp0 -->
<g id="node34" class="node">
<title>expert2_dp0_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="511.5,-24379.96 276.5,-24379.96 276.5,-24327.96 511.5,-24327.96 511.5,-24379.96"/>
<text text-anchor="middle" x="394" y="-24367.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="394" y="-24356.96" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="394" y="-24345.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="394" y="-24334.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep2_tp0&#45;&gt;expert2_dp0_ep2_tp0 -->
<g id="edge37" class="edge">
<title>moe_gate_dp0_ep2_tp0&#45;&gt;expert2_dp0_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M311.8,-24456.92C316.97,-24450.9 322.12,-24444.81 327,-24438.96 340.7,-24422.51 355.58,-24403.93 367.83,-24388.43"/>
<polygon fill="black" stroke="black" points="370.9,-24390.2 374.34,-24380.18 365.4,-24385.86 370.9,-24390.2"/>
<text text-anchor="middle" x="396.5" y="-24427.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep2_tp0 -->
<g id="node35" class="node">
<title>expert_agg_dp0_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="504.33,-24264.96 126.79,-24264.96 29.67,-24160.96 407.21,-24160.96 504.33,-24264.96"/>
<text text-anchor="middle" x="267" y="-24226.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="267" y="-24215.96" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="267" y="-24204.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="267" y="-24193.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep2_tp0&#45;&gt;expert_agg_dp0_ep2_tp0 -->
<g id="edge38" class="edge">
<title>expert1_dp0_ep2_tp0&#45;&gt;expert_agg_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M163.82,-24327.79C177.78,-24312.38 196.26,-24292 213.72,-24272.74"/>
<polygon fill="black" stroke="black" points="216.48,-24274.9 220.6,-24265.14 211.3,-24270.2 216.48,-24274.9"/>
</g>
<!-- expert2_dp0_ep2_tp0&#45;&gt;expert_agg_dp0_ep2_tp0 -->
<g id="edge39" class="edge">
<title>expert2_dp0_ep2_tp0&#45;&gt;expert_agg_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M371,-24327.79C356.93,-24312.38 338.3,-24292 320.7,-24272.74"/>
<polygon fill="black" stroke="black" points="323.09,-24270.16 313.76,-24265.14 317.93,-24274.88 323.09,-24270.16"/>
</g>
<!-- ln2_dp0_ep2_tp0 -->
<g id="node36" class="node">
<title>ln2_dp0_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-24097.96 152.5,-24097.96 152.5,-24045.96 381.5,-24045.96 381.5,-24097.96"/>
<text text-anchor="middle" x="267" y="-24085.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="267" y="-24074.96" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="267" y="-24063.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-24052.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep2_tp0&#45;&gt;ln2_dp0_ep2_tp0 -->
<g id="edge40" class="edge">
<title>expert_agg_dp0_ep2_tp0&#45;&gt;ln2_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M267,-24160.59C267,-24143.25 267,-24124.29 267,-24108.45"/>
<polygon fill="black" stroke="black" points="270.5,-24108.05 267,-24098.05 263.5,-24108.05 270.5,-24108.05"/>
</g>
<!-- ln1_dp0_ep3_tp0 -->
<g id="node44" class="node">
<title>ln1_dp0_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-23961.96 152.5,-23961.96 152.5,-23909.96 381.5,-23909.96 381.5,-23961.96"/>
<text text-anchor="middle" x="267" y="-23949.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="267" y="-23938.96" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="267" y="-23927.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-23916.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep2_tp0&#45;&gt;ln1_dp0_ep3_tp0 -->
<g id="edge41" class="edge">
<title>ln2_dp0_ep2_tp0&#45;&gt;ln1_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M267,-24045.75C267,-24024.98 267,-23995.28 267,-23972.15"/>
<polygon fill="black" stroke="black" points="270.5,-23972.05 267,-23962.05 263.5,-23972.05 270.5,-23972.05"/>
</g>
<!-- mha_dp0_ep2_tp1 -->
<g id="node38" class="node">
<title>mha_dp0_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-24649.96 659.5,-24649.96 659.5,-24597.96 888.5,-24597.96 888.5,-24649.96"/>
<text text-anchor="middle" x="774" y="-24637.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="774" y="-24626.96" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="774" y="-24615.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-24604.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep2_tp1&#45;&gt;mha_dp0_ep2_tp1 -->
<g id="edge42" class="edge">
<title>ln1_dp0_ep2_tp1&#45;&gt;mha_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M774,-24707.91C774,-24693.83 774,-24676.03 774,-24660.53"/>
<polygon fill="black" stroke="black" points="777.5,-24660.24 774,-24650.24 770.5,-24660.24 777.5,-24660.24"/>
</g>
<!-- moe_gate_dp0_ep2_tp1 -->
<g id="node39" class="node">
<title>moe_gate_dp0_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1018.85,-24560.96 629.35,-24560.96 529.15,-24456.96 918.65,-24456.96 1018.85,-24560.96"/>
<text text-anchor="middle" x="774" y="-24522.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="774" y="-24511.96" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="774" y="-24500.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-24489.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep2_tp1&#45;&gt;moe_gate_dp0_ep2_tp1 -->
<g id="edge43" class="edge">
<title>mha_dp0_ep2_tp1&#45;&gt;moe_gate_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M774,-24597.88C774,-24589.95 774,-24580.82 774,-24571.5"/>
<polygon fill="black" stroke="black" points="777.5,-24571.36 774,-24561.36 770.5,-24571.36 777.5,-24571.36"/>
</g>
<!-- expert1_dp0_ep2_tp1 -->
<g id="node40" class="node">
<title>expert1_dp0_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="764.5,-24379.96 529.5,-24379.96 529.5,-24327.96 764.5,-24327.96 764.5,-24379.96"/>
<text text-anchor="middle" x="647" y="-24367.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="647" y="-24356.96" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="647" y="-24345.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="647" y="-24334.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep2_tp1&#45;&gt;expert1_dp0_ep2_tp1 -->
<g id="edge44" class="edge">
<title>moe_gate_dp0_ep2_tp1&#45;&gt;expert1_dp0_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M730.03,-24456.84C724.94,-24450.83 719.84,-24444.77 715,-24438.96 701.1,-24422.25 685.86,-24403.47 673.34,-24387.91"/>
<polygon fill="black" stroke="black" points="676.05,-24385.7 667.06,-24380.09 670.59,-24390.08 676.05,-24385.7"/>
<text text-anchor="middle" x="772.5" y="-24427.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep2_tp1 -->
<g id="node41" class="node">
<title>expert2_dp0_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1017.5,-24379.96 782.5,-24379.96 782.5,-24327.96 1017.5,-24327.96 1017.5,-24379.96"/>
<text text-anchor="middle" x="900" y="-24367.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="900" y="-24356.96" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="900" y="-24345.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="900" y="-24334.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep2_tp1&#45;&gt;expert2_dp0_ep2_tp1 -->
<g id="edge45" class="edge">
<title>moe_gate_dp0_ep2_tp1&#45;&gt;expert2_dp0_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M816.31,-24456.58C834.91,-24434 856.21,-24408.13 872.67,-24388.14"/>
<polygon fill="black" stroke="black" points="875.53,-24390.18 879.18,-24380.24 870.12,-24385.73 875.53,-24390.18"/>
<text text-anchor="middle" x="898.5" y="-24427.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep2_tp1 -->
<g id="node42" class="node">
<title>expert_agg_dp0_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1011.33,-24264.96 633.79,-24264.96 536.67,-24160.96 914.21,-24160.96 1011.33,-24264.96"/>
<text text-anchor="middle" x="774" y="-24226.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="774" y="-24215.96" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="774" y="-24204.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="774" y="-24193.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep2_tp1&#45;&gt;expert_agg_dp0_ep2_tp1 -->
<g id="edge46" class="edge">
<title>expert1_dp0_ep2_tp1&#45;&gt;expert_agg_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M670,-24327.79C684.07,-24312.38 702.7,-24292 720.3,-24272.74"/>
<polygon fill="black" stroke="black" points="723.07,-24274.88 727.24,-24265.14 717.91,-24270.16 723.07,-24274.88"/>
</g>
<!-- expert2_dp0_ep2_tp1&#45;&gt;expert_agg_dp0_ep2_tp1 -->
<g id="edge47" class="edge">
<title>expert2_dp0_ep2_tp1&#45;&gt;expert_agg_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M877.18,-24327.79C863.22,-24312.38 844.74,-24292 827.28,-24272.74"/>
<polygon fill="black" stroke="black" points="829.7,-24270.2 820.4,-24265.14 824.52,-24274.9 829.7,-24270.2"/>
</g>
<!-- ln2_dp0_ep2_tp1 -->
<g id="node43" class="node">
<title>ln2_dp0_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-24097.96 659.5,-24097.96 659.5,-24045.96 888.5,-24045.96 888.5,-24097.96"/>
<text text-anchor="middle" x="774" y="-24085.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="774" y="-24074.96" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="774" y="-24063.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-24052.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep2_tp1&#45;&gt;ln2_dp0_ep2_tp1 -->
<g id="edge48" class="edge">
<title>expert_agg_dp0_ep2_tp1&#45;&gt;ln2_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M774,-24160.59C774,-24143.25 774,-24124.29 774,-24108.45"/>
<polygon fill="black" stroke="black" points="777.5,-24108.05 774,-24098.05 770.5,-24108.05 777.5,-24108.05"/>
</g>
<!-- ln1_dp0_ep3_tp1 -->
<g id="node51" class="node">
<title>ln1_dp0_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-23961.96 659.5,-23961.96 659.5,-23909.96 888.5,-23909.96 888.5,-23961.96"/>
<text text-anchor="middle" x="774" y="-23949.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="774" y="-23938.96" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="774" y="-23927.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-23916.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep2_tp1&#45;&gt;ln1_dp0_ep3_tp1 -->
<g id="edge49" class="edge">
<title>ln2_dp0_ep2_tp1&#45;&gt;ln1_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M774,-24045.75C774,-24024.98 774,-23995.28 774,-23972.15"/>
<polygon fill="black" stroke="black" points="777.5,-23972.05 774,-23962.05 770.5,-23972.05 777.5,-23972.05"/>
</g>
<!-- mha_dp0_ep3_tp0 -->
<g id="node45" class="node">
<title>mha_dp0_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="381.5,-23851.96 152.5,-23851.96 152.5,-23799.96 381.5,-23799.96 381.5,-23851.96"/>
<text text-anchor="middle" x="267" y="-23839.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="267" y="-23828.96" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="267" y="-23817.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-23806.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep3_tp0&#45;&gt;mha_dp0_ep3_tp0 -->
<g id="edge50" class="edge">
<title>ln1_dp0_ep3_tp0&#45;&gt;mha_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M267,-23909.91C267,-23895.83 267,-23878.03 267,-23862.53"/>
<polygon fill="black" stroke="black" points="270.5,-23862.24 267,-23852.24 263.5,-23862.24 270.5,-23862.24"/>
</g>
<!-- moe_gate_dp0_ep3_tp0 -->
<g id="node46" class="node">
<title>moe_gate_dp0_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="511.85,-23762.96 122.35,-23762.96 22.15,-23658.96 411.65,-23658.96 511.85,-23762.96"/>
<text text-anchor="middle" x="267" y="-23724.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="267" y="-23713.96" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="267" y="-23702.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="267" y="-23691.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep3_tp0&#45;&gt;moe_gate_dp0_ep3_tp0 -->
<g id="edge51" class="edge">
<title>mha_dp0_ep3_tp0&#45;&gt;moe_gate_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M267,-23799.88C267,-23791.95 267,-23782.82 267,-23773.5"/>
<polygon fill="black" stroke="black" points="270.5,-23773.36 267,-23763.36 263.5,-23773.36 270.5,-23773.36"/>
</g>
<!-- expert1_dp0_ep3_tp0 -->
<g id="node47" class="node">
<title>expert1_dp0_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="258.5,-23581.96 23.5,-23581.96 23.5,-23529.96 258.5,-23529.96 258.5,-23581.96"/>
<text text-anchor="middle" x="141" y="-23569.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="141" y="-23558.96" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="141" y="-23547.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="141" y="-23536.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep3_tp0&#45;&gt;expert1_dp0_ep3_tp0 -->
<g id="edge52" class="edge">
<title>moe_gate_dp0_ep3_tp0&#45;&gt;expert1_dp0_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M224.69,-23658.58C206.09,-23636 184.79,-23610.13 168.33,-23590.14"/>
<polygon fill="black" stroke="black" points="170.88,-23587.73 161.82,-23582.24 165.47,-23592.18 170.88,-23587.73"/>
<text text-anchor="middle" x="265.5" y="-23629.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep3_tp0 -->
<g id="node48" class="node">
<title>expert2_dp0_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="511.5,-23581.96 276.5,-23581.96 276.5,-23529.96 511.5,-23529.96 511.5,-23581.96"/>
<text text-anchor="middle" x="394" y="-23569.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="394" y="-23558.96" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="394" y="-23547.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="394" y="-23536.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep3_tp0&#45;&gt;expert2_dp0_ep3_tp0 -->
<g id="edge53" class="edge">
<title>moe_gate_dp0_ep3_tp0&#45;&gt;expert2_dp0_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M311.8,-23658.92C316.97,-23652.9 322.12,-23646.81 327,-23640.96 340.7,-23624.51 355.58,-23605.93 367.83,-23590.43"/>
<polygon fill="black" stroke="black" points="370.9,-23592.2 374.34,-23582.18 365.4,-23587.86 370.9,-23592.2"/>
<text text-anchor="middle" x="396.5" y="-23629.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep3_tp0 -->
<g id="node49" class="node">
<title>expert_agg_dp0_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="505.33,-23466.96 127.79,-23466.96 30.67,-23362.96 408.21,-23362.96 505.33,-23466.96"/>
<text text-anchor="middle" x="268" y="-23428.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="268" y="-23417.96" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="268" y="-23406.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="268" y="-23395.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep3_tp0&#45;&gt;expert_agg_dp0_ep3_tp0 -->
<g id="edge54" class="edge">
<title>expert1_dp0_ep3_tp0&#45;&gt;expert_agg_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M164,-23529.79C178.07,-23514.38 196.7,-23494 214.3,-23474.74"/>
<polygon fill="black" stroke="black" points="217.07,-23476.88 221.24,-23467.14 211.91,-23472.16 217.07,-23476.88"/>
</g>
<!-- expert2_dp0_ep3_tp0&#45;&gt;expert_agg_dp0_ep3_tp0 -->
<g id="edge55" class="edge">
<title>expert2_dp0_ep3_tp0&#45;&gt;expert_agg_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M371.18,-23529.79C357.22,-23514.38 338.74,-23494 321.28,-23474.74"/>
<polygon fill="black" stroke="black" points="323.7,-23472.2 314.4,-23467.14 318.52,-23476.9 323.7,-23472.2"/>
</g>
<!-- ln2_dp0_ep3_tp0 -->
<g id="node50" class="node">
<title>ln2_dp0_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="382.5,-23299.96 153.5,-23299.96 153.5,-23247.96 382.5,-23247.96 382.5,-23299.96"/>
<text text-anchor="middle" x="268" y="-23287.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="268" y="-23276.96" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="268" y="-23265.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="268" y="-23254.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep3_tp0&#45;&gt;ln2_dp0_ep3_tp0 -->
<g id="edge56" class="edge">
<title>expert_agg_dp0_ep3_tp0&#45;&gt;ln2_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M268,-23362.59C268,-23345.25 268,-23326.29 268,-23310.45"/>
<polygon fill="black" stroke="black" points="271.5,-23310.05 268,-23300.05 264.5,-23310.05 271.5,-23310.05"/>
</g>
<!-- ln1_dp0_ep4_tp0 -->
<g id="node58" class="node">
<title>ln1_dp0_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="382.5,-23163.96 153.5,-23163.96 153.5,-23111.96 382.5,-23111.96 382.5,-23163.96"/>
<text text-anchor="middle" x="268" y="-23151.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="268" y="-23140.96" font-family="Times,serif" font-size="10.00">GPU 8</text>
<text text-anchor="middle" x="268" y="-23129.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="268" y="-23118.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep3_tp0&#45;&gt;ln1_dp0_ep4_tp0 -->
<g id="edge57" class="edge">
<title>ln2_dp0_ep3_tp0&#45;&gt;ln1_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M268,-23247.75C268,-23226.98 268,-23197.28 268,-23174.15"/>
<polygon fill="black" stroke="black" points="271.5,-23174.05 268,-23164.05 264.5,-23174.05 271.5,-23174.05"/>
</g>
<!-- mha_dp0_ep3_tp1 -->
<g id="node52" class="node">
<title>mha_dp0_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="888.5,-23851.96 659.5,-23851.96 659.5,-23799.96 888.5,-23799.96 888.5,-23851.96"/>
<text text-anchor="middle" x="774" y="-23839.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="774" y="-23828.96" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="774" y="-23817.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-23806.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep3_tp1&#45;&gt;mha_dp0_ep3_tp1 -->
<g id="edge58" class="edge">
<title>ln1_dp0_ep3_tp1&#45;&gt;mha_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M774,-23909.91C774,-23895.83 774,-23878.03 774,-23862.53"/>
<polygon fill="black" stroke="black" points="777.5,-23862.24 774,-23852.24 770.5,-23862.24 777.5,-23862.24"/>
</g>
<!-- moe_gate_dp0_ep3_tp1 -->
<g id="node53" class="node">
<title>moe_gate_dp0_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1018.85,-23762.96 629.35,-23762.96 529.15,-23658.96 918.65,-23658.96 1018.85,-23762.96"/>
<text text-anchor="middle" x="774" y="-23724.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="774" y="-23713.96" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="774" y="-23702.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="774" y="-23691.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep3_tp1&#45;&gt;moe_gate_dp0_ep3_tp1 -->
<g id="edge59" class="edge">
<title>mha_dp0_ep3_tp1&#45;&gt;moe_gate_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M774,-23799.88C774,-23791.95 774,-23782.82 774,-23773.5"/>
<polygon fill="black" stroke="black" points="777.5,-23773.36 774,-23763.36 770.5,-23773.36 777.5,-23773.36"/>
</g>
<!-- expert1_dp0_ep3_tp1 -->
<g id="node54" class="node">
<title>expert1_dp0_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="764.5,-23581.96 529.5,-23581.96 529.5,-23529.96 764.5,-23529.96 764.5,-23581.96"/>
<text text-anchor="middle" x="647" y="-23569.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="647" y="-23558.96" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="647" y="-23547.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="647" y="-23536.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep3_tp1&#45;&gt;expert1_dp0_ep3_tp1 -->
<g id="edge60" class="edge">
<title>moe_gate_dp0_ep3_tp1&#45;&gt;expert1_dp0_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M730.03,-23658.84C724.94,-23652.83 719.84,-23646.77 715,-23640.96 701.1,-23624.25 685.86,-23605.47 673.34,-23589.91"/>
<polygon fill="black" stroke="black" points="676.05,-23587.7 667.06,-23582.09 670.59,-23592.08 676.05,-23587.7"/>
<text text-anchor="middle" x="772.5" y="-23629.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep3_tp1 -->
<g id="node55" class="node">
<title>expert2_dp0_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1017.5,-23581.96 782.5,-23581.96 782.5,-23529.96 1017.5,-23529.96 1017.5,-23581.96"/>
<text text-anchor="middle" x="900" y="-23569.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="900" y="-23558.96" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="900" y="-23547.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="900" y="-23536.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep3_tp1&#45;&gt;expert2_dp0_ep3_tp1 -->
<g id="edge61" class="edge">
<title>moe_gate_dp0_ep3_tp1&#45;&gt;expert2_dp0_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M816.31,-23658.58C834.91,-23636 856.21,-23610.13 872.67,-23590.14"/>
<polygon fill="black" stroke="black" points="875.53,-23592.18 879.18,-23582.24 870.12,-23587.73 875.53,-23592.18"/>
<text text-anchor="middle" x="898.5" y="-23629.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep3_tp1 -->
<g id="node56" class="node">
<title>expert_agg_dp0_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1012.33,-23466.96 634.79,-23466.96 537.67,-23362.96 915.21,-23362.96 1012.33,-23466.96"/>
<text text-anchor="middle" x="775" y="-23428.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="775" y="-23417.96" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="775" y="-23406.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="775" y="-23395.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep3_tp1&#45;&gt;expert_agg_dp0_ep3_tp1 -->
<g id="edge62" class="edge">
<title>expert1_dp0_ep3_tp1&#45;&gt;expert_agg_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M670.18,-23529.79C684.36,-23514.38 703.14,-23494 720.87,-23474.74"/>
<polygon fill="black" stroke="black" points="723.67,-23476.87 727.87,-23467.14 718.52,-23472.12 723.67,-23476.87"/>
</g>
<!-- expert2_dp0_ep3_tp1&#45;&gt;expert_agg_dp0_ep3_tp1 -->
<g id="edge63" class="edge">
<title>expert2_dp0_ep3_tp1&#45;&gt;expert_agg_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M877.36,-23529.79C863.51,-23514.38 845.18,-23494 827.86,-23474.74"/>
<polygon fill="black" stroke="black" points="830.32,-23472.23 821.03,-23467.14 825.11,-23476.92 830.32,-23472.23"/>
</g>
<!-- ln2_dp0_ep3_tp1 -->
<g id="node57" class="node">
<title>ln2_dp0_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="889.5,-23299.96 660.5,-23299.96 660.5,-23247.96 889.5,-23247.96 889.5,-23299.96"/>
<text text-anchor="middle" x="775" y="-23287.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="775" y="-23276.96" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="775" y="-23265.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="775" y="-23254.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep3_tp1&#45;&gt;ln2_dp0_ep3_tp1 -->
<g id="edge64" class="edge">
<title>expert_agg_dp0_ep3_tp1&#45;&gt;ln2_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M775,-23362.59C775,-23345.25 775,-23326.29 775,-23310.45"/>
<polygon fill="black" stroke="black" points="778.5,-23310.05 775,-23300.05 771.5,-23310.05 778.5,-23310.05"/>
</g>
<!-- ln1_dp0_ep4_tp1 -->
<g id="node65" class="node">
<title>ln1_dp0_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="889.5,-23163.96 660.5,-23163.96 660.5,-23111.96 889.5,-23111.96 889.5,-23163.96"/>
<text text-anchor="middle" x="775" y="-23151.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="775" y="-23140.96" font-family="Times,serif" font-size="10.00">GPU 9</text>
<text text-anchor="middle" x="775" y="-23129.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="775" y="-23118.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep3_tp1&#45;&gt;ln1_dp0_ep4_tp1 -->
<g id="edge65" class="edge">
<title>ln2_dp0_ep3_tp1&#45;&gt;ln1_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M775,-23247.75C775,-23226.98 775,-23197.28 775,-23174.15"/>
<polygon fill="black" stroke="black" points="778.5,-23174.05 775,-23164.05 771.5,-23174.05 778.5,-23174.05"/>
</g>
<!-- mha_dp0_ep4_tp0 -->
<g id="node59" class="node">
<title>mha_dp0_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="382.5,-23053.96 153.5,-23053.96 153.5,-23001.96 382.5,-23001.96 382.5,-23053.96"/>
<text text-anchor="middle" x="268" y="-23041.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="268" y="-23030.96" font-family="Times,serif" font-size="10.00">GPU 8</text>
<text text-anchor="middle" x="268" y="-23019.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="268" y="-23008.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep4_tp0&#45;&gt;mha_dp0_ep4_tp0 -->
<g id="edge66" class="edge">
<title>ln1_dp0_ep4_tp0&#45;&gt;mha_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M268,-23111.91C268,-23097.83 268,-23080.03 268,-23064.53"/>
<polygon fill="black" stroke="black" points="271.5,-23064.24 268,-23054.24 264.5,-23064.24 271.5,-23064.24"/>
</g>
<!-- moe_gate_dp0_ep4_tp0 -->
<g id="node60" class="node">
<title>moe_gate_dp0_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="512.85,-22964.96 123.35,-22964.96 23.15,-22860.96 412.65,-22860.96 512.85,-22964.96"/>
<text text-anchor="middle" x="268" y="-22926.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="268" y="-22915.96" font-family="Times,serif" font-size="10.00">GPU 8</text>
<text text-anchor="middle" x="268" y="-22904.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="268" y="-22893.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep4_tp0&#45;&gt;moe_gate_dp0_ep4_tp0 -->
<g id="edge67" class="edge">
<title>mha_dp0_ep4_tp0&#45;&gt;moe_gate_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M268,-23001.88C268,-22993.95 268,-22984.82 268,-22975.5"/>
<polygon fill="black" stroke="black" points="271.5,-22975.36 268,-22965.36 264.5,-22975.36 271.5,-22975.36"/>
</g>
<!-- expert1_dp0_ep4_tp0 -->
<g id="node61" class="node">
<title>expert1_dp0_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="259.5,-22783.96 24.5,-22783.96 24.5,-22731.96 259.5,-22731.96 259.5,-22783.96"/>
<text text-anchor="middle" x="142" y="-22771.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="142" y="-22760.96" font-family="Times,serif" font-size="10.00">GPU 8</text>
<text text-anchor="middle" x="142" y="-22749.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="142" y="-22738.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep4_tp0&#45;&gt;expert1_dp0_ep4_tp0 -->
<g id="edge68" class="edge">
<title>moe_gate_dp0_ep4_tp0&#45;&gt;expert1_dp0_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M216.6,-22860.78C211.2,-22854.89 205.9,-22848.87 201,-22842.96 187.77,-22826.97 174.37,-22808.15 163.69,-22792.38"/>
<polygon fill="black" stroke="black" points="166.53,-22790.33 158.05,-22783.97 160.71,-22794.23 166.53,-22790.33"/>
<text text-anchor="middle" x="258.5" y="-22831.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep4_tp0 -->
<g id="node62" class="node">
<title>expert2_dp0_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="512.5,-22783.96 277.5,-22783.96 277.5,-22731.96 512.5,-22731.96 512.5,-22783.96"/>
<text text-anchor="middle" x="395" y="-22771.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="395" y="-22760.96" font-family="Times,serif" font-size="10.00">GPU 8</text>
<text text-anchor="middle" x="395" y="-22749.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="395" y="-22738.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep4_tp0&#45;&gt;expert2_dp0_ep4_tp0 -->
<g id="edge69" class="edge">
<title>moe_gate_dp0_ep4_tp0&#45;&gt;expert2_dp0_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M310.64,-22860.58C329.39,-22838 350.86,-22812.13 367.46,-22792.14"/>
<polygon fill="black" stroke="black" points="370.32,-22794.17 374.02,-22784.24 364.94,-22789.7 370.32,-22794.17"/>
<text text-anchor="middle" x="393.5" y="-22831.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep4_tp0 -->
<g id="node63" class="node">
<title>expert_agg_dp0_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="503.33,-22668.96 125.79,-22668.96 28.67,-22564.96 406.21,-22564.96 503.33,-22668.96"/>
<text text-anchor="middle" x="266" y="-22630.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="266" y="-22619.96" font-family="Times,serif" font-size="10.00">GPU 8</text>
<text text-anchor="middle" x="266" y="-22608.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="266" y="-22597.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep4_tp0&#45;&gt;expert_agg_dp0_ep4_tp0 -->
<g id="edge70" class="edge">
<title>expert1_dp0_ep4_tp0&#45;&gt;expert_agg_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M164.46,-22731.79C178.2,-22716.38 196.38,-22696 213.56,-22676.74"/>
<polygon fill="black" stroke="black" points="216.3,-22678.93 220.34,-22669.14 211.07,-22674.27 216.3,-22678.93"/>
</g>
<!-- expert2_dp0_ep4_tp0&#45;&gt;expert_agg_dp0_ep4_tp0 -->
<g id="edge71" class="edge">
<title>expert2_dp0_ep4_tp0&#45;&gt;expert_agg_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M371.64,-22731.79C357.28,-22716.32 338.26,-22695.82 320.31,-22676.48"/>
<polygon fill="black" stroke="black" points="322.87,-22674.09 313.5,-22669.14 317.74,-22678.85 322.87,-22674.09"/>
</g>
<!-- ln2_dp0_ep4_tp0 -->
<g id="node64" class="node">
<title>ln2_dp0_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="380.5,-22501.96 151.5,-22501.96 151.5,-22449.96 380.5,-22449.96 380.5,-22501.96"/>
<text text-anchor="middle" x="266" y="-22489.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="266" y="-22478.96" font-family="Times,serif" font-size="10.00">GPU 8</text>
<text text-anchor="middle" x="266" y="-22467.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="266" y="-22456.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep4_tp0&#45;&gt;ln2_dp0_ep4_tp0 -->
<g id="edge72" class="edge">
<title>expert_agg_dp0_ep4_tp0&#45;&gt;ln2_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M266,-22564.59C266,-22547.25 266,-22528.29 266,-22512.45"/>
<polygon fill="black" stroke="black" points="269.5,-22512.05 266,-22502.05 262.5,-22512.05 269.5,-22512.05"/>
</g>
<!-- ln1_dp0_ep5_tp0 -->
<g id="node72" class="node">
<title>ln1_dp0_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="380.5,-22365.96 151.5,-22365.96 151.5,-22313.96 380.5,-22313.96 380.5,-22365.96"/>
<text text-anchor="middle" x="266" y="-22353.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="266" y="-22342.96" font-family="Times,serif" font-size="10.00">GPU 10</text>
<text text-anchor="middle" x="266" y="-22331.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="266" y="-22320.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep4_tp0&#45;&gt;ln1_dp0_ep5_tp0 -->
<g id="edge73" class="edge">
<title>ln2_dp0_ep4_tp0&#45;&gt;ln1_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M266,-22449.75C266,-22428.98 266,-22399.28 266,-22376.15"/>
<polygon fill="black" stroke="black" points="269.5,-22376.05 266,-22366.05 262.5,-22376.05 269.5,-22376.05"/>
</g>
<!-- mha_dp0_ep4_tp1 -->
<g id="node66" class="node">
<title>mha_dp0_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="889.5,-23053.96 660.5,-23053.96 660.5,-23001.96 889.5,-23001.96 889.5,-23053.96"/>
<text text-anchor="middle" x="775" y="-23041.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="775" y="-23030.96" font-family="Times,serif" font-size="10.00">GPU 9</text>
<text text-anchor="middle" x="775" y="-23019.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="775" y="-23008.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep4_tp1&#45;&gt;mha_dp0_ep4_tp1 -->
<g id="edge74" class="edge">
<title>ln1_dp0_ep4_tp1&#45;&gt;mha_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M775,-23111.91C775,-23097.83 775,-23080.03 775,-23064.53"/>
<polygon fill="black" stroke="black" points="778.5,-23064.24 775,-23054.24 771.5,-23064.24 778.5,-23064.24"/>
</g>
<!-- moe_gate_dp0_ep4_tp1 -->
<g id="node67" class="node">
<title>moe_gate_dp0_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1019.85,-22964.96 630.35,-22964.96 530.15,-22860.96 919.65,-22860.96 1019.85,-22964.96"/>
<text text-anchor="middle" x="775" y="-22926.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="775" y="-22915.96" font-family="Times,serif" font-size="10.00">GPU 9</text>
<text text-anchor="middle" x="775" y="-22904.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="775" y="-22893.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep4_tp1&#45;&gt;moe_gate_dp0_ep4_tp1 -->
<g id="edge75" class="edge">
<title>mha_dp0_ep4_tp1&#45;&gt;moe_gate_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M775,-23001.88C775,-22993.95 775,-22984.82 775,-22975.5"/>
<polygon fill="black" stroke="black" points="778.5,-22975.36 775,-22965.36 771.5,-22975.36 778.5,-22975.36"/>
</g>
<!-- expert1_dp0_ep4_tp1 -->
<g id="node68" class="node">
<title>expert1_dp0_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="765.5,-22783.96 530.5,-22783.96 530.5,-22731.96 765.5,-22731.96 765.5,-22783.96"/>
<text text-anchor="middle" x="648" y="-22771.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="648" y="-22760.96" font-family="Times,serif" font-size="10.00">GPU 9</text>
<text text-anchor="middle" x="648" y="-22749.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="648" y="-22738.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep4_tp1&#45;&gt;expert1_dp0_ep4_tp1 -->
<g id="edge76" class="edge">
<title>moe_gate_dp0_ep4_tp1&#45;&gt;expert1_dp0_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M731.03,-22860.84C725.94,-22854.83 720.84,-22848.77 716,-22842.96 702.1,-22826.25 686.86,-22807.47 674.34,-22791.91"/>
<polygon fill="black" stroke="black" points="677.05,-22789.7 668.06,-22784.09 671.59,-22794.08 677.05,-22789.7"/>
<text text-anchor="middle" x="773.5" y="-22831.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep4_tp1 -->
<g id="node69" class="node">
<title>expert2_dp0_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1018.5,-22783.96 783.5,-22783.96 783.5,-22731.96 1018.5,-22731.96 1018.5,-22783.96"/>
<text text-anchor="middle" x="901" y="-22771.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="901" y="-22760.96" font-family="Times,serif" font-size="10.00">GPU 9</text>
<text text-anchor="middle" x="901" y="-22749.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="901" y="-22738.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep4_tp1&#45;&gt;expert2_dp0_ep4_tp1 -->
<g id="edge77" class="edge">
<title>moe_gate_dp0_ep4_tp1&#45;&gt;expert2_dp0_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M817.31,-22860.58C835.91,-22838 857.21,-22812.13 873.67,-22792.14"/>
<polygon fill="black" stroke="black" points="876.53,-22794.18 880.18,-22784.24 871.12,-22789.73 876.53,-22794.18"/>
<text text-anchor="middle" x="899.5" y="-22831.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep4_tp1 -->
<g id="node70" class="node">
<title>expert_agg_dp0_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1010.33,-22668.96 632.79,-22668.96 535.67,-22564.96 913.21,-22564.96 1010.33,-22668.96"/>
<text text-anchor="middle" x="773" y="-22630.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="773" y="-22619.96" font-family="Times,serif" font-size="10.00">GPU 9</text>
<text text-anchor="middle" x="773" y="-22608.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="773" y="-22597.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep4_tp1&#45;&gt;expert_agg_dp0_ep4_tp1 -->
<g id="edge78" class="edge">
<title>expert1_dp0_ep4_tp1&#45;&gt;expert_agg_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M670.64,-22731.79C684.49,-22716.38 702.82,-22696 720.14,-22676.74"/>
<polygon fill="black" stroke="black" points="722.89,-22678.92 726.97,-22669.14 717.68,-22674.23 722.89,-22678.92"/>
</g>
<!-- expert2_dp0_ep4_tp1&#45;&gt;expert_agg_dp0_ep4_tp1 -->
<g id="edge79" class="edge">
<title>expert2_dp0_ep4_tp1&#45;&gt;expert_agg_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M877.82,-22731.79C863.64,-22716.38 844.86,-22696 827.13,-22676.74"/>
<polygon fill="black" stroke="black" points="829.48,-22674.12 820.13,-22669.14 824.33,-22678.87 829.48,-22674.12"/>
</g>
<!-- ln2_dp0_ep4_tp1 -->
<g id="node71" class="node">
<title>ln2_dp0_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="887.5,-22501.96 658.5,-22501.96 658.5,-22449.96 887.5,-22449.96 887.5,-22501.96"/>
<text text-anchor="middle" x="773" y="-22489.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="773" y="-22478.96" font-family="Times,serif" font-size="10.00">GPU 9</text>
<text text-anchor="middle" x="773" y="-22467.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="773" y="-22456.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep4_tp1&#45;&gt;ln2_dp0_ep4_tp1 -->
<g id="edge80" class="edge">
<title>expert_agg_dp0_ep4_tp1&#45;&gt;ln2_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M773,-22564.59C773,-22547.25 773,-22528.29 773,-22512.45"/>
<polygon fill="black" stroke="black" points="776.5,-22512.05 773,-22502.05 769.5,-22512.05 776.5,-22512.05"/>
</g>
<!-- ln1_dp0_ep5_tp1 -->
<g id="node79" class="node">
<title>ln1_dp0_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="887.5,-22365.96 658.5,-22365.96 658.5,-22313.96 887.5,-22313.96 887.5,-22365.96"/>
<text text-anchor="middle" x="773" y="-22353.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="773" y="-22342.96" font-family="Times,serif" font-size="10.00">GPU 11</text>
<text text-anchor="middle" x="773" y="-22331.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="773" y="-22320.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep4_tp1&#45;&gt;ln1_dp0_ep5_tp1 -->
<g id="edge81" class="edge">
<title>ln2_dp0_ep4_tp1&#45;&gt;ln1_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M773,-22449.75C773,-22428.98 773,-22399.28 773,-22376.15"/>
<polygon fill="black" stroke="black" points="776.5,-22376.05 773,-22366.05 769.5,-22376.05 776.5,-22376.05"/>
</g>
<!-- mha_dp0_ep5_tp0 -->
<g id="node73" class="node">
<title>mha_dp0_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="380.5,-22255.96 151.5,-22255.96 151.5,-22203.96 380.5,-22203.96 380.5,-22255.96"/>
<text text-anchor="middle" x="266" y="-22243.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="266" y="-22232.96" font-family="Times,serif" font-size="10.00">GPU 10</text>
<text text-anchor="middle" x="266" y="-22221.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="266" y="-22210.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep5_tp0&#45;&gt;mha_dp0_ep5_tp0 -->
<g id="edge82" class="edge">
<title>ln1_dp0_ep5_tp0&#45;&gt;mha_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M266,-22313.91C266,-22299.83 266,-22282.03 266,-22266.53"/>
<polygon fill="black" stroke="black" points="269.5,-22266.24 266,-22256.24 262.5,-22266.24 269.5,-22266.24"/>
</g>
<!-- moe_gate_dp0_ep5_tp0 -->
<g id="node74" class="node">
<title>moe_gate_dp0_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="510.85,-22166.96 121.35,-22166.96 21.15,-22062.96 410.65,-22062.96 510.85,-22166.96"/>
<text text-anchor="middle" x="266" y="-22128.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="266" y="-22117.96" font-family="Times,serif" font-size="10.00">GPU 10</text>
<text text-anchor="middle" x="266" y="-22106.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="266" y="-22095.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep5_tp0&#45;&gt;moe_gate_dp0_ep5_tp0 -->
<g id="edge83" class="edge">
<title>mha_dp0_ep5_tp0&#45;&gt;moe_gate_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M266,-22203.88C266,-22195.95 266,-22186.82 266,-22177.5"/>
<polygon fill="black" stroke="black" points="269.5,-22177.36 266,-22167.36 262.5,-22177.36 269.5,-22177.36"/>
</g>
<!-- expert1_dp0_ep5_tp0 -->
<g id="node75" class="node">
<title>expert1_dp0_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="257.5,-21985.96 22.5,-21985.96 22.5,-21933.96 257.5,-21933.96 257.5,-21985.96"/>
<text text-anchor="middle" x="140" y="-21973.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="140" y="-21962.96" font-family="Times,serif" font-size="10.00">GPU 10</text>
<text text-anchor="middle" x="140" y="-21951.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="140" y="-21940.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep5_tp0&#45;&gt;expert1_dp0_ep5_tp0 -->
<g id="edge84" class="edge">
<title>moe_gate_dp0_ep5_tp0&#45;&gt;expert1_dp0_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M223.69,-22062.58C205.09,-22040 183.79,-22014.13 167.33,-21994.14"/>
<polygon fill="black" stroke="black" points="169.88,-21991.73 160.82,-21986.24 164.47,-21996.18 169.88,-21991.73"/>
<text text-anchor="middle" x="264.5" y="-22033.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep5_tp0 -->
<g id="node76" class="node">
<title>expert2_dp0_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="510.5,-21985.96 275.5,-21985.96 275.5,-21933.96 510.5,-21933.96 510.5,-21985.96"/>
<text text-anchor="middle" x="393" y="-21973.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="393" y="-21962.96" font-family="Times,serif" font-size="10.00">GPU 10</text>
<text text-anchor="middle" x="393" y="-21951.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="393" y="-21940.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep5_tp0&#45;&gt;expert2_dp0_ep5_tp0 -->
<g id="edge85" class="edge">
<title>moe_gate_dp0_ep5_tp0&#45;&gt;expert2_dp0_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M310.8,-22062.92C315.97,-22056.9 321.12,-22050.81 326,-22044.96 339.7,-22028.51 354.58,-22009.93 366.83,-21994.43"/>
<polygon fill="black" stroke="black" points="369.9,-21996.2 373.34,-21986.18 364.4,-21991.86 369.9,-21996.2"/>
<text text-anchor="middle" x="395.5" y="-22033.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep5_tp0 -->
<g id="node77" class="node">
<title>expert_agg_dp0_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="502.33,-21870.96 124.79,-21870.96 27.67,-21766.96 405.21,-21766.96 502.33,-21870.96"/>
<text text-anchor="middle" x="265" y="-21832.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="265" y="-21821.96" font-family="Times,serif" font-size="10.00">GPU 10</text>
<text text-anchor="middle" x="265" y="-21810.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="265" y="-21799.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep5_tp0&#45;&gt;expert_agg_dp0_ep5_tp0 -->
<g id="edge86" class="edge">
<title>expert1_dp0_ep5_tp0&#45;&gt;expert_agg_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M162.64,-21933.79C176.49,-21918.38 194.82,-21898 212.14,-21878.74"/>
<polygon fill="black" stroke="black" points="214.89,-21880.92 218.97,-21871.14 209.68,-21876.23 214.89,-21880.92"/>
</g>
<!-- expert2_dp0_ep5_tp0&#45;&gt;expert_agg_dp0_ep5_tp0 -->
<g id="edge87" class="edge">
<title>expert2_dp0_ep5_tp0&#45;&gt;expert_agg_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M369.82,-21933.79C355.64,-21918.38 336.86,-21898 319.13,-21878.74"/>
<polygon fill="black" stroke="black" points="321.48,-21876.12 312.13,-21871.14 316.33,-21880.87 321.48,-21876.12"/>
</g>
<!-- ln2_dp0_ep5_tp0 -->
<g id="node78" class="node">
<title>ln2_dp0_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="379.5,-21703.96 150.5,-21703.96 150.5,-21651.96 379.5,-21651.96 379.5,-21703.96"/>
<text text-anchor="middle" x="265" y="-21691.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="265" y="-21680.96" font-family="Times,serif" font-size="10.00">GPU 10</text>
<text text-anchor="middle" x="265" y="-21669.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="265" y="-21658.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep5_tp0&#45;&gt;ln2_dp0_ep5_tp0 -->
<g id="edge88" class="edge">
<title>expert_agg_dp0_ep5_tp0&#45;&gt;ln2_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M265,-21766.59C265,-21749.25 265,-21730.29 265,-21714.45"/>
<polygon fill="black" stroke="black" points="268.5,-21714.05 265,-21704.05 261.5,-21714.05 268.5,-21714.05"/>
</g>
<!-- ln1_dp0_ep6_tp0 -->
<g id="node86" class="node">
<title>ln1_dp0_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="379.5,-21567.96 150.5,-21567.96 150.5,-21515.96 379.5,-21515.96 379.5,-21567.96"/>
<text text-anchor="middle" x="265" y="-21555.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="265" y="-21544.96" font-family="Times,serif" font-size="10.00">GPU 12</text>
<text text-anchor="middle" x="265" y="-21533.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="265" y="-21522.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep5_tp0&#45;&gt;ln1_dp0_ep6_tp0 -->
<g id="edge89" class="edge">
<title>ln2_dp0_ep5_tp0&#45;&gt;ln1_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M265,-21651.75C265,-21630.98 265,-21601.28 265,-21578.15"/>
<polygon fill="black" stroke="black" points="268.5,-21578.05 265,-21568.05 261.5,-21578.05 268.5,-21578.05"/>
</g>
<!-- mha_dp0_ep5_tp1 -->
<g id="node80" class="node">
<title>mha_dp0_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="887.5,-22255.96 658.5,-22255.96 658.5,-22203.96 887.5,-22203.96 887.5,-22255.96"/>
<text text-anchor="middle" x="773" y="-22243.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="773" y="-22232.96" font-family="Times,serif" font-size="10.00">GPU 11</text>
<text text-anchor="middle" x="773" y="-22221.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="773" y="-22210.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep5_tp1&#45;&gt;mha_dp0_ep5_tp1 -->
<g id="edge90" class="edge">
<title>ln1_dp0_ep5_tp1&#45;&gt;mha_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M773,-22313.91C773,-22299.83 773,-22282.03 773,-22266.53"/>
<polygon fill="black" stroke="black" points="776.5,-22266.24 773,-22256.24 769.5,-22266.24 776.5,-22266.24"/>
</g>
<!-- moe_gate_dp0_ep5_tp1 -->
<g id="node81" class="node">
<title>moe_gate_dp0_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1017.85,-22166.96 628.35,-22166.96 528.15,-22062.96 917.65,-22062.96 1017.85,-22166.96"/>
<text text-anchor="middle" x="773" y="-22128.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="773" y="-22117.96" font-family="Times,serif" font-size="10.00">GPU 11</text>
<text text-anchor="middle" x="773" y="-22106.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="773" y="-22095.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep5_tp1&#45;&gt;moe_gate_dp0_ep5_tp1 -->
<g id="edge91" class="edge">
<title>mha_dp0_ep5_tp1&#45;&gt;moe_gate_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M773,-22203.88C773,-22195.95 773,-22186.82 773,-22177.5"/>
<polygon fill="black" stroke="black" points="776.5,-22177.36 773,-22167.36 769.5,-22177.36 776.5,-22177.36"/>
</g>
<!-- expert1_dp0_ep5_tp1 -->
<g id="node82" class="node">
<title>expert1_dp0_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="763.5,-21985.96 528.5,-21985.96 528.5,-21933.96 763.5,-21933.96 763.5,-21985.96"/>
<text text-anchor="middle" x="646" y="-21973.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="646" y="-21962.96" font-family="Times,serif" font-size="10.00">GPU 11</text>
<text text-anchor="middle" x="646" y="-21951.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="646" y="-21940.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep5_tp1&#45;&gt;expert1_dp0_ep5_tp1 -->
<g id="edge92" class="edge">
<title>moe_gate_dp0_ep5_tp1&#45;&gt;expert1_dp0_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M729.03,-22062.84C723.94,-22056.83 718.84,-22050.77 714,-22044.96 700.1,-22028.25 684.86,-22009.47 672.34,-21993.91"/>
<polygon fill="black" stroke="black" points="675.05,-21991.7 666.06,-21986.09 669.59,-21996.08 675.05,-21991.7"/>
<text text-anchor="middle" x="771.5" y="-22033.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep5_tp1 -->
<g id="node83" class="node">
<title>expert2_dp0_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1016.5,-21985.96 781.5,-21985.96 781.5,-21933.96 1016.5,-21933.96 1016.5,-21985.96"/>
<text text-anchor="middle" x="899" y="-21973.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="899" y="-21962.96" font-family="Times,serif" font-size="10.00">GPU 11</text>
<text text-anchor="middle" x="899" y="-21951.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="899" y="-21940.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep5_tp1&#45;&gt;expert2_dp0_ep5_tp1 -->
<g id="edge93" class="edge">
<title>moe_gate_dp0_ep5_tp1&#45;&gt;expert2_dp0_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M815.31,-22062.58C833.91,-22040 855.21,-22014.13 871.67,-21994.14"/>
<polygon fill="black" stroke="black" points="874.53,-21996.18 878.18,-21986.24 869.12,-21991.73 874.53,-21996.18"/>
<text text-anchor="middle" x="897.5" y="-22033.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep5_tp1 -->
<g id="node84" class="node">
<title>expert_agg_dp0_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1009.33,-21870.96 631.79,-21870.96 534.67,-21766.96 912.21,-21766.96 1009.33,-21870.96"/>
<text text-anchor="middle" x="772" y="-21832.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="772" y="-21821.96" font-family="Times,serif" font-size="10.00">GPU 11</text>
<text text-anchor="middle" x="772" y="-21810.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="772" y="-21799.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep5_tp1&#45;&gt;expert_agg_dp0_ep5_tp1 -->
<g id="edge94" class="edge">
<title>expert1_dp0_ep5_tp1&#45;&gt;expert_agg_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M668.82,-21933.79C682.78,-21918.38 701.26,-21898 718.72,-21878.74"/>
<polygon fill="black" stroke="black" points="721.48,-21880.9 725.6,-21871.14 716.3,-21876.2 721.48,-21880.9"/>
</g>
<!-- expert2_dp0_ep5_tp1&#45;&gt;expert_agg_dp0_ep5_tp1 -->
<g id="edge95" class="edge">
<title>expert2_dp0_ep5_tp1&#45;&gt;expert_agg_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M876,-21933.79C861.93,-21918.38 843.3,-21898 825.7,-21878.74"/>
<polygon fill="black" stroke="black" points="828.09,-21876.16 818.76,-21871.14 822.93,-21880.88 828.09,-21876.16"/>
</g>
<!-- ln2_dp0_ep5_tp1 -->
<g id="node85" class="node">
<title>ln2_dp0_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="886.5,-21703.96 657.5,-21703.96 657.5,-21651.96 886.5,-21651.96 886.5,-21703.96"/>
<text text-anchor="middle" x="772" y="-21691.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="772" y="-21680.96" font-family="Times,serif" font-size="10.00">GPU 11</text>
<text text-anchor="middle" x="772" y="-21669.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="772" y="-21658.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep5_tp1&#45;&gt;ln2_dp0_ep5_tp1 -->
<g id="edge96" class="edge">
<title>expert_agg_dp0_ep5_tp1&#45;&gt;ln2_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M772,-21766.59C772,-21749.25 772,-21730.29 772,-21714.45"/>
<polygon fill="black" stroke="black" points="775.5,-21714.05 772,-21704.05 768.5,-21714.05 775.5,-21714.05"/>
</g>
<!-- ln1_dp0_ep6_tp1 -->
<g id="node93" class="node">
<title>ln1_dp0_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="886.5,-21567.96 657.5,-21567.96 657.5,-21515.96 886.5,-21515.96 886.5,-21567.96"/>
<text text-anchor="middle" x="772" y="-21555.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="772" y="-21544.96" font-family="Times,serif" font-size="10.00">GPU 13</text>
<text text-anchor="middle" x="772" y="-21533.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="772" y="-21522.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep5_tp1&#45;&gt;ln1_dp0_ep6_tp1 -->
<g id="edge97" class="edge">
<title>ln2_dp0_ep5_tp1&#45;&gt;ln1_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M772,-21651.75C772,-21630.98 772,-21601.28 772,-21578.15"/>
<polygon fill="black" stroke="black" points="775.5,-21578.05 772,-21568.05 768.5,-21578.05 775.5,-21578.05"/>
</g>
<!-- mha_dp0_ep6_tp0 -->
<g id="node87" class="node">
<title>mha_dp0_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="379.5,-21457.96 150.5,-21457.96 150.5,-21405.96 379.5,-21405.96 379.5,-21457.96"/>
<text text-anchor="middle" x="265" y="-21445.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="265" y="-21434.96" font-family="Times,serif" font-size="10.00">GPU 12</text>
<text text-anchor="middle" x="265" y="-21423.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="265" y="-21412.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep6_tp0&#45;&gt;mha_dp0_ep6_tp0 -->
<g id="edge98" class="edge">
<title>ln1_dp0_ep6_tp0&#45;&gt;mha_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M265,-21515.91C265,-21501.83 265,-21484.03 265,-21468.53"/>
<polygon fill="black" stroke="black" points="268.5,-21468.24 265,-21458.24 261.5,-21468.24 268.5,-21468.24"/>
</g>
<!-- moe_gate_dp0_ep6_tp0 -->
<g id="node88" class="node">
<title>moe_gate_dp0_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="509.85,-21368.96 120.35,-21368.96 20.15,-21264.96 409.65,-21264.96 509.85,-21368.96"/>
<text text-anchor="middle" x="265" y="-21330.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="265" y="-21319.96" font-family="Times,serif" font-size="10.00">GPU 12</text>
<text text-anchor="middle" x="265" y="-21308.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="265" y="-21297.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep6_tp0&#45;&gt;moe_gate_dp0_ep6_tp0 -->
<g id="edge99" class="edge">
<title>mha_dp0_ep6_tp0&#45;&gt;moe_gate_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M265,-21405.88C265,-21397.95 265,-21388.82 265,-21379.5"/>
<polygon fill="black" stroke="black" points="268.5,-21379.36 265,-21369.36 261.5,-21379.36 268.5,-21379.36"/>
</g>
<!-- expert1_dp0_ep6_tp0 -->
<g id="node89" class="node">
<title>expert1_dp0_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="256.5,-21187.96 21.5,-21187.96 21.5,-21135.96 256.5,-21135.96 256.5,-21187.96"/>
<text text-anchor="middle" x="139" y="-21175.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="139" y="-21164.96" font-family="Times,serif" font-size="10.00">GPU 12</text>
<text text-anchor="middle" x="139" y="-21153.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="139" y="-21142.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep6_tp0&#45;&gt;expert1_dp0_ep6_tp0 -->
<g id="edge100" class="edge">
<title>moe_gate_dp0_ep6_tp0&#45;&gt;expert1_dp0_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M213.6,-21264.78C208.2,-21258.89 202.9,-21252.87 198,-21246.96 184.77,-21230.97 171.37,-21212.15 160.69,-21196.38"/>
<polygon fill="black" stroke="black" points="163.53,-21194.33 155.05,-21187.97 157.71,-21198.23 163.53,-21194.33"/>
<text text-anchor="middle" x="255.5" y="-21235.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep6_tp0 -->
<g id="node90" class="node">
<title>expert2_dp0_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="509.5,-21187.96 274.5,-21187.96 274.5,-21135.96 509.5,-21135.96 509.5,-21187.96"/>
<text text-anchor="middle" x="392" y="-21175.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="392" y="-21164.96" font-family="Times,serif" font-size="10.00">GPU 12</text>
<text text-anchor="middle" x="392" y="-21153.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="392" y="-21142.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep6_tp0&#45;&gt;expert2_dp0_ep6_tp0 -->
<g id="edge101" class="edge">
<title>moe_gate_dp0_ep6_tp0&#45;&gt;expert2_dp0_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M307.64,-21264.58C326.39,-21242 347.86,-21216.13 364.46,-21196.14"/>
<polygon fill="black" stroke="black" points="367.32,-21198.17 371.02,-21188.24 361.94,-21193.7 367.32,-21198.17"/>
<text text-anchor="middle" x="390.5" y="-21235.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep6_tp0 -->
<g id="node91" class="node">
<title>expert_agg_dp0_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="498.33,-21072.96 120.79,-21072.96 23.67,-20968.96 401.21,-20968.96 498.33,-21072.96"/>
<text text-anchor="middle" x="261" y="-21034.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="261" y="-21023.96" font-family="Times,serif" font-size="10.00">GPU 12</text>
<text text-anchor="middle" x="261" y="-21012.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="261" y="-21001.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep6_tp0&#45;&gt;expert_agg_dp0_ep6_tp0 -->
<g id="edge102" class="edge">
<title>expert1_dp0_ep6_tp0&#45;&gt;expert_agg_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M161.09,-21135.79C174.61,-21120.38 192.5,-21100 209.41,-21080.74"/>
<polygon fill="black" stroke="black" points="212.11,-21082.96 216.08,-21073.14 206.85,-21078.35 212.11,-21082.96"/>
</g>
<!-- expert2_dp0_ep6_tp0&#45;&gt;expert_agg_dp0_ep6_tp0 -->
<g id="edge103" class="edge">
<title>expert2_dp0_ep6_tp0&#45;&gt;expert_agg_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M368.28,-21135.79C353.7,-21120.32 334.38,-21099.82 316.16,-21080.48"/>
<polygon fill="black" stroke="black" points="318.64,-21078.02 309.24,-21073.14 313.55,-21082.82 318.64,-21078.02"/>
</g>
<!-- ln2_dp0_ep6_tp0 -->
<g id="node92" class="node">
<title>ln2_dp0_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="375.5,-20905.96 146.5,-20905.96 146.5,-20853.96 375.5,-20853.96 375.5,-20905.96"/>
<text text-anchor="middle" x="261" y="-20893.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="261" y="-20882.96" font-family="Times,serif" font-size="10.00">GPU 12</text>
<text text-anchor="middle" x="261" y="-20871.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="261" y="-20860.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep6_tp0&#45;&gt;ln2_dp0_ep6_tp0 -->
<g id="edge104" class="edge">
<title>expert_agg_dp0_ep6_tp0&#45;&gt;ln2_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M261,-20968.59C261,-20951.25 261,-20932.29 261,-20916.45"/>
<polygon fill="black" stroke="black" points="264.5,-20916.05 261,-20906.05 257.5,-20916.05 264.5,-20916.05"/>
</g>
<!-- ln1_dp0_ep7_tp0 -->
<g id="node100" class="node">
<title>ln1_dp0_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="375.5,-20769.96 146.5,-20769.96 146.5,-20717.96 375.5,-20717.96 375.5,-20769.96"/>
<text text-anchor="middle" x="261" y="-20757.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="261" y="-20746.96" font-family="Times,serif" font-size="10.00">GPU 14</text>
<text text-anchor="middle" x="261" y="-20735.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="261" y="-20724.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep6_tp0&#45;&gt;ln1_dp0_ep7_tp0 -->
<g id="edge105" class="edge">
<title>ln2_dp0_ep6_tp0&#45;&gt;ln1_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M261,-20853.75C261,-20832.98 261,-20803.28 261,-20780.15"/>
<polygon fill="black" stroke="black" points="264.5,-20780.05 261,-20770.05 257.5,-20780.05 264.5,-20780.05"/>
</g>
<!-- mha_dp0_ep6_tp1 -->
<g id="node94" class="node">
<title>mha_dp0_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="886.5,-21457.96 657.5,-21457.96 657.5,-21405.96 886.5,-21405.96 886.5,-21457.96"/>
<text text-anchor="middle" x="772" y="-21445.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="772" y="-21434.96" font-family="Times,serif" font-size="10.00">GPU 13</text>
<text text-anchor="middle" x="772" y="-21423.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="772" y="-21412.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep6_tp1&#45;&gt;mha_dp0_ep6_tp1 -->
<g id="edge106" class="edge">
<title>ln1_dp0_ep6_tp1&#45;&gt;mha_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M772,-21515.91C772,-21501.83 772,-21484.03 772,-21468.53"/>
<polygon fill="black" stroke="black" points="775.5,-21468.24 772,-21458.24 768.5,-21468.24 775.5,-21468.24"/>
</g>
<!-- moe_gate_dp0_ep6_tp1 -->
<g id="node95" class="node">
<title>moe_gate_dp0_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1016.85,-21368.96 627.35,-21368.96 527.15,-21264.96 916.65,-21264.96 1016.85,-21368.96"/>
<text text-anchor="middle" x="772" y="-21330.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="772" y="-21319.96" font-family="Times,serif" font-size="10.00">GPU 13</text>
<text text-anchor="middle" x="772" y="-21308.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="772" y="-21297.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep6_tp1&#45;&gt;moe_gate_dp0_ep6_tp1 -->
<g id="edge107" class="edge">
<title>mha_dp0_ep6_tp1&#45;&gt;moe_gate_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M772,-21405.88C772,-21397.95 772,-21388.82 772,-21379.5"/>
<polygon fill="black" stroke="black" points="775.5,-21379.36 772,-21369.36 768.5,-21379.36 775.5,-21379.36"/>
</g>
<!-- expert1_dp0_ep6_tp1 -->
<g id="node96" class="node">
<title>expert1_dp0_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="762.5,-21187.96 527.5,-21187.96 527.5,-21135.96 762.5,-21135.96 762.5,-21187.96"/>
<text text-anchor="middle" x="645" y="-21175.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="645" y="-21164.96" font-family="Times,serif" font-size="10.00">GPU 13</text>
<text text-anchor="middle" x="645" y="-21153.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="645" y="-21142.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep6_tp1&#45;&gt;expert1_dp0_ep6_tp1 -->
<g id="edge108" class="edge">
<title>moe_gate_dp0_ep6_tp1&#45;&gt;expert1_dp0_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M728.03,-21264.84C722.94,-21258.83 717.84,-21252.77 713,-21246.96 699.1,-21230.25 683.86,-21211.47 671.34,-21195.91"/>
<polygon fill="black" stroke="black" points="674.05,-21193.7 665.06,-21188.09 668.59,-21198.08 674.05,-21193.7"/>
<text text-anchor="middle" x="770.5" y="-21235.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep6_tp1 -->
<g id="node97" class="node">
<title>expert2_dp0_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1015.5,-21187.96 780.5,-21187.96 780.5,-21135.96 1015.5,-21135.96 1015.5,-21187.96"/>
<text text-anchor="middle" x="898" y="-21175.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="898" y="-21164.96" font-family="Times,serif" font-size="10.00">GPU 13</text>
<text text-anchor="middle" x="898" y="-21153.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="898" y="-21142.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep6_tp1&#45;&gt;expert2_dp0_ep6_tp1 -->
<g id="edge109" class="edge">
<title>moe_gate_dp0_ep6_tp1&#45;&gt;expert2_dp0_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M814.31,-21264.58C832.91,-21242 854.21,-21216.13 870.67,-21196.14"/>
<polygon fill="black" stroke="black" points="873.53,-21198.18 877.18,-21188.24 868.12,-21193.73 873.53,-21198.18"/>
<text text-anchor="middle" x="896.5" y="-21235.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep6_tp1 -->
<g id="node98" class="node">
<title>expert_agg_dp0_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1005.33,-21072.96 627.79,-21072.96 530.67,-20968.96 908.21,-20968.96 1005.33,-21072.96"/>
<text text-anchor="middle" x="768" y="-21034.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="768" y="-21023.96" font-family="Times,serif" font-size="10.00">GPU 13</text>
<text text-anchor="middle" x="768" y="-21012.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="768" y="-21001.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep6_tp1&#45;&gt;expert_agg_dp0_ep6_tp1 -->
<g id="edge110" class="edge">
<title>expert1_dp0_ep6_tp1&#45;&gt;expert_agg_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M667.27,-21135.79C680.9,-21120.38 698.94,-21100 715.99,-21080.74"/>
<polygon fill="black" stroke="black" points="718.7,-21082.95 722.71,-21073.14 713.46,-21078.31 718.7,-21082.95"/>
</g>
<!-- expert2_dp0_ep6_tp1&#45;&gt;expert_agg_dp0_ep6_tp1 -->
<g id="edge111" class="edge">
<title>expert2_dp0_ep6_tp1&#45;&gt;expert_agg_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M874.46,-21135.79C859.99,-21120.32 840.82,-21099.82 822.73,-21080.48"/>
<polygon fill="black" stroke="black" points="825.26,-21078.05 815.87,-21073.14 820.14,-21082.83 825.26,-21078.05"/>
</g>
<!-- ln2_dp0_ep6_tp1 -->
<g id="node99" class="node">
<title>ln2_dp0_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="882.5,-20905.96 653.5,-20905.96 653.5,-20853.96 882.5,-20853.96 882.5,-20905.96"/>
<text text-anchor="middle" x="768" y="-20893.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="768" y="-20882.96" font-family="Times,serif" font-size="10.00">GPU 13</text>
<text text-anchor="middle" x="768" y="-20871.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="768" y="-20860.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep6_tp1&#45;&gt;ln2_dp0_ep6_tp1 -->
<g id="edge112" class="edge">
<title>expert_agg_dp0_ep6_tp1&#45;&gt;ln2_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M768,-20968.59C768,-20951.25 768,-20932.29 768,-20916.45"/>
<polygon fill="black" stroke="black" points="771.5,-20916.05 768,-20906.05 764.5,-20916.05 771.5,-20916.05"/>
</g>
<!-- ln1_dp0_ep7_tp1 -->
<g id="node107" class="node">
<title>ln1_dp0_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="882.5,-20769.96 653.5,-20769.96 653.5,-20717.96 882.5,-20717.96 882.5,-20769.96"/>
<text text-anchor="middle" x="768" y="-20757.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="768" y="-20746.96" font-family="Times,serif" font-size="10.00">GPU 15</text>
<text text-anchor="middle" x="768" y="-20735.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="768" y="-20724.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp0_ep6_tp1&#45;&gt;ln1_dp0_ep7_tp1 -->
<g id="edge113" class="edge">
<title>ln2_dp0_ep6_tp1&#45;&gt;ln1_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M768,-20853.75C768,-20832.98 768,-20803.28 768,-20780.15"/>
<polygon fill="black" stroke="black" points="771.5,-20780.05 768,-20770.05 764.5,-20780.05 771.5,-20780.05"/>
</g>
<!-- mha_dp0_ep7_tp0 -->
<g id="node101" class="node">
<title>mha_dp0_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="375.5,-20659.96 146.5,-20659.96 146.5,-20607.96 375.5,-20607.96 375.5,-20659.96"/>
<text text-anchor="middle" x="261" y="-20647.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="261" y="-20636.96" font-family="Times,serif" font-size="10.00">GPU 14</text>
<text text-anchor="middle" x="261" y="-20625.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="261" y="-20614.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep7_tp0&#45;&gt;mha_dp0_ep7_tp0 -->
<g id="edge114" class="edge">
<title>ln1_dp0_ep7_tp0&#45;&gt;mha_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M261,-20717.91C261,-20703.83 261,-20686.03 261,-20670.53"/>
<polygon fill="black" stroke="black" points="264.5,-20670.24 261,-20660.24 257.5,-20670.24 264.5,-20670.24"/>
</g>
<!-- moe_gate_dp0_ep7_tp0 -->
<g id="node102" class="node">
<title>moe_gate_dp0_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="505.85,-20570.96 116.35,-20570.96 16.15,-20466.96 405.65,-20466.96 505.85,-20570.96"/>
<text text-anchor="middle" x="261" y="-20532.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="261" y="-20521.96" font-family="Times,serif" font-size="10.00">GPU 14</text>
<text text-anchor="middle" x="261" y="-20510.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="261" y="-20499.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep7_tp0&#45;&gt;moe_gate_dp0_ep7_tp0 -->
<g id="edge115" class="edge">
<title>mha_dp0_ep7_tp0&#45;&gt;moe_gate_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M261,-20607.88C261,-20599.95 261,-20590.82 261,-20581.5"/>
<polygon fill="black" stroke="black" points="264.5,-20581.36 261,-20571.36 257.5,-20581.36 264.5,-20581.36"/>
</g>
<!-- expert1_dp0_ep7_tp0 -->
<g id="node103" class="node">
<title>expert1_dp0_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="252.5,-20389.96 17.5,-20389.96 17.5,-20337.96 252.5,-20337.96 252.5,-20389.96"/>
<text text-anchor="middle" x="135" y="-20377.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="135" y="-20366.96" font-family="Times,serif" font-size="10.00">GPU 14</text>
<text text-anchor="middle" x="135" y="-20355.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="135" y="-20344.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep7_tp0&#45;&gt;expert1_dp0_ep7_tp0 -->
<g id="edge116" class="edge">
<title>moe_gate_dp0_ep7_tp0&#45;&gt;expert1_dp0_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M218.69,-20466.58C200.09,-20444 178.79,-20418.13 162.33,-20398.14"/>
<polygon fill="black" stroke="black" points="164.88,-20395.73 155.82,-20390.24 159.47,-20400.18 164.88,-20395.73"/>
<text text-anchor="middle" x="259.5" y="-20437.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep7_tp0 -->
<g id="node104" class="node">
<title>expert2_dp0_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="505.5,-20389.96 270.5,-20389.96 270.5,-20337.96 505.5,-20337.96 505.5,-20389.96"/>
<text text-anchor="middle" x="388" y="-20377.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="388" y="-20366.96" font-family="Times,serif" font-size="10.00">GPU 14</text>
<text text-anchor="middle" x="388" y="-20355.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="388" y="-20344.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep7_tp0&#45;&gt;expert2_dp0_ep7_tp0 -->
<g id="edge117" class="edge">
<title>moe_gate_dp0_ep7_tp0&#45;&gt;expert2_dp0_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M305.8,-20466.92C310.97,-20460.9 316.12,-20454.81 321,-20448.96 334.7,-20432.51 349.58,-20413.93 361.83,-20398.43"/>
<polygon fill="black" stroke="black" points="364.9,-20400.2 368.34,-20390.18 359.4,-20395.86 364.9,-20400.2"/>
<text text-anchor="middle" x="390.5" y="-20437.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep7_tp0 -->
<g id="node105" class="node">
<title>expert_agg_dp0_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="520.33,-20274.96 142.79,-20274.96 45.67,-20170.96 423.21,-20170.96 520.33,-20274.96"/>
<text text-anchor="middle" x="283" y="-20236.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="283" y="-20225.96" font-family="Times,serif" font-size="10.00">GPU 14</text>
<text text-anchor="middle" x="283" y="-20214.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="283" y="-20203.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep7_tp0&#45;&gt;expert_agg_dp0_ep7_tp0 -->
<g id="edge118" class="edge">
<title>expert1_dp0_ep7_tp0&#45;&gt;expert_agg_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M161.8,-20337.79C178.35,-20322.25 200.29,-20301.64 220.96,-20282.22"/>
<polygon fill="black" stroke="black" points="223.61,-20284.54 228.5,-20275.14 218.82,-20279.43 223.61,-20284.54"/>
</g>
<!-- expert2_dp0_ep7_tp0&#45;&gt;expert_agg_dp0_ep7_tp0 -->
<g id="edge119" class="edge">
<title>expert2_dp0_ep7_tp0&#45;&gt;expert_agg_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M368.99,-20337.79C357.45,-20322.52 342.22,-20302.36 327.79,-20283.25"/>
<polygon fill="black" stroke="black" points="330.48,-20281.01 321.66,-20275.14 324.9,-20285.23 330.48,-20281.01"/>
</g>
<!-- ln2_dp0_ep7_tp0 -->
<g id="node106" class="node">
<title>ln2_dp0_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="601.5,-20107.96 372.5,-20107.96 372.5,-20055.96 601.5,-20055.96 601.5,-20107.96"/>
<text text-anchor="middle" x="487" y="-20095.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="487" y="-20084.96" font-family="Times,serif" font-size="10.00">GPU 14</text>
<text text-anchor="middle" x="487" y="-20073.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="487" y="-20062.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep7_tp0&#45;&gt;ln2_dp0_ep7_tp0 -->
<g id="edge120" class="edge">
<title>expert_agg_dp0_ep7_tp0&#45;&gt;ln2_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M358.09,-20170.79C386.14,-20151.68 417.11,-20130.58 441.67,-20113.84"/>
<polygon fill="black" stroke="black" points="443.78,-20116.64 450.07,-20108.12 439.84,-20110.86 443.78,-20116.64"/>
</g>
<!-- comm_pipeline_dp0_ep7_tp0 -->
<g id="node1041" class="node">
<title>comm_pipeline_dp0_ep7_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="683" cy="-19945.96" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="683" y="-19954.46" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="683" y="-19943.46" font-family="Times,serif" font-size="10.00">GPU 14â†’30</text>
<text text-anchor="middle" x="683" y="-19932.46" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- ln2_dp0_ep7_tp0&#45;&gt;comm_pipeline_dp0_ep7_tp0 -->
<g id="edge121" class="edge">
<title>ln2_dp0_ep7_tp0&#45;&gt;comm_pipeline_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M523.87,-20055.75C556.17,-20033.67 603.23,-20001.49 637.8,-19977.86"/>
<polygon fill="black" stroke="black" points="640.02,-19980.58 646.3,-19972.05 636.07,-19974.8 640.02,-19980.58"/>
</g>
<!-- mha_dp0_ep7_tp1 -->
<g id="node108" class="node">
<title>mha_dp0_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="882.5,-20659.96 653.5,-20659.96 653.5,-20607.96 882.5,-20607.96 882.5,-20659.96"/>
<text text-anchor="middle" x="768" y="-20647.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="768" y="-20636.96" font-family="Times,serif" font-size="10.00">GPU 15</text>
<text text-anchor="middle" x="768" y="-20625.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="768" y="-20614.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp0_ep7_tp1&#45;&gt;mha_dp0_ep7_tp1 -->
<g id="edge123" class="edge">
<title>ln1_dp0_ep7_tp1&#45;&gt;mha_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M768,-20717.91C768,-20703.83 768,-20686.03 768,-20670.53"/>
<polygon fill="black" stroke="black" points="771.5,-20670.24 768,-20660.24 764.5,-20670.24 771.5,-20670.24"/>
</g>
<!-- moe_gate_dp0_ep7_tp1 -->
<g id="node109" class="node">
<title>moe_gate_dp0_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1012.85,-20570.96 623.35,-20570.96 523.15,-20466.96 912.65,-20466.96 1012.85,-20570.96"/>
<text text-anchor="middle" x="768" y="-20532.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="768" y="-20521.96" font-family="Times,serif" font-size="10.00">GPU 15</text>
<text text-anchor="middle" x="768" y="-20510.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="768" y="-20499.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp0_ep7_tp1&#45;&gt;moe_gate_dp0_ep7_tp1 -->
<g id="edge124" class="edge">
<title>mha_dp0_ep7_tp1&#45;&gt;moe_gate_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M768,-20607.88C768,-20599.95 768,-20590.82 768,-20581.5"/>
<polygon fill="black" stroke="black" points="771.5,-20581.36 768,-20571.36 764.5,-20581.36 771.5,-20581.36"/>
</g>
<!-- expert1_dp0_ep7_tp1 -->
<g id="node110" class="node">
<title>expert1_dp0_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="758.5,-20389.96 523.5,-20389.96 523.5,-20337.96 758.5,-20337.96 758.5,-20389.96"/>
<text text-anchor="middle" x="641" y="-20377.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="641" y="-20366.96" font-family="Times,serif" font-size="10.00">GPU 15</text>
<text text-anchor="middle" x="641" y="-20355.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="641" y="-20344.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep7_tp1&#45;&gt;expert1_dp0_ep7_tp1 -->
<g id="edge125" class="edge">
<title>moe_gate_dp0_ep7_tp1&#45;&gt;expert1_dp0_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M724.03,-20466.84C718.94,-20460.83 713.84,-20454.77 709,-20448.96 695.1,-20432.25 679.86,-20413.47 667.34,-20397.91"/>
<polygon fill="black" stroke="black" points="670.05,-20395.7 661.06,-20390.09 664.59,-20400.08 670.05,-20395.7"/>
<text text-anchor="middle" x="766.5" y="-20437.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp0_ep7_tp1 -->
<g id="node111" class="node">
<title>expert2_dp0_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1011.5,-20389.96 776.5,-20389.96 776.5,-20337.96 1011.5,-20337.96 1011.5,-20389.96"/>
<text text-anchor="middle" x="894" y="-20377.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="894" y="-20366.96" font-family="Times,serif" font-size="10.00">GPU 15</text>
<text text-anchor="middle" x="894" y="-20355.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="894" y="-20344.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp0_ep7_tp1&#45;&gt;expert2_dp0_ep7_tp1 -->
<g id="edge126" class="edge">
<title>moe_gate_dp0_ep7_tp1&#45;&gt;expert2_dp0_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M810.31,-20466.58C828.91,-20444 850.21,-20418.13 866.67,-20398.14"/>
<polygon fill="black" stroke="black" points="869.53,-20400.18 873.18,-20390.24 864.12,-20395.73 869.53,-20400.18"/>
<text text-anchor="middle" x="892.5" y="-20437.76" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp0_ep7_tp1 -->
<g id="node112" class="node">
<title>expert_agg_dp0_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1013.33,-20274.96 635.79,-20274.96 538.67,-20170.96 916.21,-20170.96 1013.33,-20274.96"/>
<text text-anchor="middle" x="776" y="-20236.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="776" y="-20225.96" font-family="Times,serif" font-size="10.00">GPU 15</text>
<text text-anchor="middle" x="776" y="-20214.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="776" y="-20203.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp0_ep7_tp1&#45;&gt;expert_agg_dp0_ep7_tp1 -->
<g id="edge127" class="edge">
<title>expert1_dp0_ep7_tp1&#45;&gt;expert_agg_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M665.45,-20337.79C680.47,-20322.32 700.38,-20301.82 719.16,-20282.48"/>
<polygon fill="black" stroke="black" points="721.83,-20284.75 726.29,-20275.14 716.81,-20279.87 721.83,-20284.75"/>
</g>
<!-- expert2_dp0_ep7_tp1&#45;&gt;expert_agg_dp0_ep7_tp1 -->
<g id="edge128" class="edge">
<title>expert2_dp0_ep7_tp1&#45;&gt;expert_agg_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M872.63,-20337.79C859.61,-20322.45 842.4,-20302.18 826.12,-20282.99"/>
<polygon fill="black" stroke="black" points="828.59,-20280.5 819.45,-20275.14 823.25,-20285.03 828.59,-20280.5"/>
</g>
<!-- ln2_dp0_ep7_tp1 -->
<g id="node113" class="node">
<title>ln2_dp0_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="909.5,-20107.96 680.5,-20107.96 680.5,-20055.96 909.5,-20055.96 909.5,-20107.96"/>
<text text-anchor="middle" x="795" y="-20095.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="795" y="-20084.96" font-family="Times,serif" font-size="10.00">GPU 15</text>
<text text-anchor="middle" x="795" y="-20073.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="795" y="-20062.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp0_ep7_tp1&#45;&gt;ln2_dp0_ep7_tp1 -->
<g id="edge129" class="edge">
<title>expert_agg_dp0_ep7_tp1&#45;&gt;ln2_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M783.02,-20170.59C785.41,-20153.08 788.03,-20133.92 790.21,-20118"/>
<polygon fill="black" stroke="black" points="793.68,-20118.43 791.57,-20108.05 786.75,-20117.48 793.68,-20118.43"/>
</g>
<!-- comm_pipeline_dp0_ep7_tp1 -->
<g id="node1042" class="node">
<title>comm_pipeline_dp0_ep7_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="936" cy="-19945.96" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="936" y="-19954.46" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="936" y="-19943.46" font-family="Times,serif" font-size="10.00">GPU 15â†’31</text>
<text text-anchor="middle" x="936" y="-19932.46" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- ln2_dp0_ep7_tp1&#45;&gt;comm_pipeline_dp0_ep7_tp1 -->
<g id="edge130" class="edge">
<title>ln2_dp0_ep7_tp1&#45;&gt;comm_pipeline_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M821.52,-20055.75C843.93,-20034.45 876.22,-20003.77 900.79,-19980.42"/>
<polygon fill="black" stroke="black" points="903.31,-19982.85 908.15,-19973.42 898.49,-19977.78 903.31,-19982.85"/>
</g>
<!-- stage2_ln1_dp0_ep0_tp0 -->
<g id="node114" class="node">
<title>stage2_ln1_dp0_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1417.5,-25447.96 1188.5,-25447.96 1188.5,-25395.96 1417.5,-25395.96 1417.5,-25447.96"/>
<text text-anchor="middle" x="1303" y="-25435.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1303" y="-25424.96" font-family="Times,serif" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1303" y="-25413.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1303" y="-25402.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_mha_dp0_ep0_tp0 -->
<g id="node115" class="node">
<title>stage2_mha_dp0_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1417.5,-25332.96 1188.5,-25332.96 1188.5,-25280.96 1417.5,-25280.96 1417.5,-25332.96"/>
<text text-anchor="middle" x="1303" y="-25320.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1303" y="-25309.96" font-family="Times,serif" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1303" y="-25298.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1303" y="-25287.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep0_tp0&#45;&gt;stage2_mha_dp0_ep0_tp0 -->
<g id="edge132" class="edge">
<title>stage2_ln1_dp0_ep0_tp0&#45;&gt;stage2_mha_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M1303,-25395.88C1303,-25380.37 1303,-25360.23 1303,-25343.14"/>
<polygon fill="black" stroke="black" points="1306.5,-25342.97 1303,-25332.97 1299.5,-25342.97 1306.5,-25342.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep0_tp0 -->
<g id="node116" class="node">
<title>stage2_moe_gate_dp0_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1547.85,-25203.96 1158.35,-25203.96 1058.15,-25099.96 1447.65,-25099.96 1547.85,-25203.96"/>
<text text-anchor="middle" x="1303" y="-25165.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1303" y="-25154.96" font-family="Times,serif" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1303" y="-25143.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1303" y="-25132.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep0_tp0&#45;&gt;stage2_moe_gate_dp0_ep0_tp0 -->
<g id="edge133" class="edge">
<title>stage2_mha_dp0_ep0_tp0&#45;&gt;stage2_moe_gate_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M1303,-25280.69C1303,-25262.58 1303,-25237.37 1303,-25214.13"/>
<polygon fill="black" stroke="black" points="1306.5,-25213.97 1303,-25203.97 1299.5,-25213.97 1306.5,-25213.97"/>
</g>
<!-- stage2_expert1_dp0_ep0_tp0 -->
<g id="node117" class="node">
<title>stage2_expert1_dp0_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1294.5,-25036.96 1059.5,-25036.96 1059.5,-24984.96 1294.5,-24984.96 1294.5,-25036.96"/>
<text text-anchor="middle" x="1177" y="-25024.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1177" y="-25013.96" font-family="Times,serif" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1177" y="-25002.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1177" y="-24991.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep0_tp0&#45;&gt;stage2_expert1_dp0_ep0_tp0 -->
<g id="edge134" class="edge">
<title>stage2_moe_gate_dp0_ep0_tp0&#45;&gt;stage2_expert1_dp0_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1256.44,-25099.59C1239.81,-25081.25 1221.54,-25061.09 1206.72,-25044.74"/>
<polygon fill="black" stroke="black" points="1209.05,-25042.1 1199.74,-25037.05 1203.87,-25046.81 1209.05,-25042.1"/>
</g>
<!-- stage2_expert2_dp0_ep0_tp0 -->
<g id="node118" class="node">
<title>stage2_expert2_dp0_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1547.5,-25036.96 1312.5,-25036.96 1312.5,-24984.96 1547.5,-24984.96 1547.5,-25036.96"/>
<text text-anchor="middle" x="1430" y="-25024.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1430" y="-25013.96" font-family="Times,serif" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1430" y="-25002.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1430" y="-24991.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep0_tp0&#45;&gt;stage2_expert2_dp0_ep0_tp0 -->
<g id="edge135" class="edge">
<title>stage2_moe_gate_dp0_ep0_tp0&#45;&gt;stage2_expert2_dp0_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1349.93,-25099.59C1366.69,-25081.25 1385.1,-25061.09 1400.04,-25044.74"/>
<polygon fill="black" stroke="black" points="1402.92,-25046.79 1407.08,-25037.05 1397.75,-25042.07 1402.92,-25046.79"/>
</g>
<!-- stage2_expert_agg_dp0_ep0_tp0 -->
<g id="node119" class="node">
<title>stage2_expert_agg_dp0_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1534.33,-24921.96 1156.79,-24921.96 1059.67,-24817.96 1437.21,-24817.96 1534.33,-24921.96"/>
<text text-anchor="middle" x="1297" y="-24883.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1297" y="-24872.96" font-family="Times,serif" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1297" y="-24861.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1297" y="-24850.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep0_tp0&#45;&gt;stage2_expert_agg_dp0_ep0_tp0 -->
<g id="edge136" class="edge">
<title>stage2_expert1_dp0_ep0_tp0&#45;&gt;stage2_expert_agg_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M1198.73,-24984.79C1212.03,-24969.38 1229.63,-24949 1246.26,-24929.74"/>
<polygon fill="black" stroke="black" points="1248.93,-24932 1252.81,-24922.14 1243.63,-24927.42 1248.93,-24932"/>
</g>
<!-- stage2_expert2_dp0_ep0_tp0&#45;&gt;stage2_expert_agg_dp0_ep0_tp0 -->
<g id="edge137" class="edge">
<title>stage2_expert2_dp0_ep0_tp0&#45;&gt;stage2_expert_agg_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M1405.91,-24984.79C1391.11,-24969.32 1371.5,-24948.82 1353,-24929.48"/>
<polygon fill="black" stroke="black" points="1355.42,-24926.94 1345.97,-24922.14 1350.36,-24931.78 1355.42,-24926.94"/>
</g>
<!-- stage2_ln2_dp0_ep0_tp0 -->
<g id="node120" class="node">
<title>stage2_ln2_dp0_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1411.5,-24759.96 1182.5,-24759.96 1182.5,-24707.96 1411.5,-24707.96 1411.5,-24759.96"/>
<text text-anchor="middle" x="1297" y="-24747.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1297" y="-24736.96" font-family="Times,serif" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1297" y="-24725.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1297" y="-24714.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep0_tp0&#45;&gt;stage2_ln2_dp0_ep0_tp0 -->
<g id="edge138" class="edge">
<title>stage2_expert_agg_dp0_ep0_tp0&#45;&gt;stage2_ln2_dp0_ep0_tp0</title>
<path fill="none" stroke="black" d="M1297,-24817.91C1297,-24801.96 1297,-24784.73 1297,-24770.13"/>
<polygon fill="black" stroke="black" points="1300.5,-24770.02 1297,-24760.02 1293.5,-24770.02 1300.5,-24770.02"/>
</g>
<!-- stage2_ln1_dp0_ep1_tp0 -->
<g id="node128" class="node">
<title>stage2_ln1_dp0_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1411.5,-24649.96 1182.5,-24649.96 1182.5,-24597.96 1411.5,-24597.96 1411.5,-24649.96"/>
<text text-anchor="middle" x="1297" y="-24637.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1297" y="-24626.96" font-family="Times,serif" font-size="10.00">GPU 18</text>
<text text-anchor="middle" x="1297" y="-24615.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1297" y="-24604.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep0_tp0&#45;&gt;stage2_ln1_dp0_ep1_tp0 -->
<g id="edge139" class="edge">
<title>stage2_ln2_dp0_ep0_tp0&#45;&gt;stage2_ln1_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M1297,-24707.91C1297,-24693.83 1297,-24676.03 1297,-24660.53"/>
<polygon fill="black" stroke="black" points="1300.5,-24660.24 1297,-24650.24 1293.5,-24660.24 1300.5,-24660.24"/>
</g>
<!-- stage2_ln1_dp0_ep0_tp1 -->
<g id="node121" class="node">
<title>stage2_ln1_dp0_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1924.5,-25447.96 1695.5,-25447.96 1695.5,-25395.96 1924.5,-25395.96 1924.5,-25447.96"/>
<text text-anchor="middle" x="1810" y="-25435.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1810" y="-25424.96" font-family="Times,serif" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1810" y="-25413.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1810" y="-25402.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_mha_dp0_ep0_tp1 -->
<g id="node122" class="node">
<title>stage2_mha_dp0_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1924.5,-25332.96 1695.5,-25332.96 1695.5,-25280.96 1924.5,-25280.96 1924.5,-25332.96"/>
<text text-anchor="middle" x="1810" y="-25320.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1810" y="-25309.96" font-family="Times,serif" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1810" y="-25298.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1810" y="-25287.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep0_tp1&#45;&gt;stage2_mha_dp0_ep0_tp1 -->
<g id="edge140" class="edge">
<title>stage2_ln1_dp0_ep0_tp1&#45;&gt;stage2_mha_dp0_ep0_tp1</title>
<path fill="none" stroke="black" d="M1810,-25395.88C1810,-25380.37 1810,-25360.23 1810,-25343.14"/>
<polygon fill="black" stroke="black" points="1813.5,-25342.97 1810,-25332.97 1806.5,-25342.97 1813.5,-25342.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep0_tp1 -->
<g id="node123" class="node">
<title>stage2_moe_gate_dp0_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2054.85,-25203.96 1665.35,-25203.96 1565.15,-25099.96 1954.65,-25099.96 2054.85,-25203.96"/>
<text text-anchor="middle" x="1810" y="-25165.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1810" y="-25154.96" font-family="Times,serif" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1810" y="-25143.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1810" y="-25132.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep0_tp1&#45;&gt;stage2_moe_gate_dp0_ep0_tp1 -->
<g id="edge141" class="edge">
<title>stage2_mha_dp0_ep0_tp1&#45;&gt;stage2_moe_gate_dp0_ep0_tp1</title>
<path fill="none" stroke="black" d="M1810,-25280.69C1810,-25262.58 1810,-25237.37 1810,-25214.13"/>
<polygon fill="black" stroke="black" points="1813.5,-25213.97 1810,-25203.97 1806.5,-25213.97 1813.5,-25213.97"/>
</g>
<!-- stage2_expert1_dp0_ep0_tp1 -->
<g id="node124" class="node">
<title>stage2_expert1_dp0_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1800.5,-25036.96 1565.5,-25036.96 1565.5,-24984.96 1800.5,-24984.96 1800.5,-25036.96"/>
<text text-anchor="middle" x="1683" y="-25024.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1683" y="-25013.96" font-family="Times,serif" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1683" y="-25002.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1683" y="-24991.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep0_tp1&#45;&gt;stage2_expert1_dp0_ep0_tp1 -->
<g id="edge142" class="edge">
<title>stage2_moe_gate_dp0_ep0_tp1&#45;&gt;stage2_expert1_dp0_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1763.07,-25099.59C1746.31,-25081.25 1727.9,-25061.09 1712.96,-25044.74"/>
<polygon fill="black" stroke="black" points="1715.25,-25042.07 1705.92,-25037.05 1710.08,-25046.79 1715.25,-25042.07"/>
</g>
<!-- stage2_expert2_dp0_ep0_tp1 -->
<g id="node125" class="node">
<title>stage2_expert2_dp0_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2053.5,-25036.96 1818.5,-25036.96 1818.5,-24984.96 2053.5,-24984.96 2053.5,-25036.96"/>
<text text-anchor="middle" x="1936" y="-25024.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1936" y="-25013.96" font-family="Times,serif" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1936" y="-25002.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1936" y="-24991.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep0_tp1&#45;&gt;stage2_expert2_dp0_ep0_tp1 -->
<g id="edge143" class="edge">
<title>stage2_moe_gate_dp0_ep0_tp1&#45;&gt;stage2_expert2_dp0_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1856.56,-25099.59C1873.19,-25081.25 1891.46,-25061.09 1906.28,-25044.74"/>
<polygon fill="black" stroke="black" points="1909.13,-25046.81 1913.26,-25037.05 1903.95,-25042.1 1909.13,-25046.81"/>
</g>
<!-- stage2_expert_agg_dp0_ep0_tp1 -->
<g id="node126" class="node">
<title>stage2_expert_agg_dp0_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2041.33,-24921.96 1663.79,-24921.96 1566.67,-24817.96 1944.21,-24817.96 2041.33,-24921.96"/>
<text text-anchor="middle" x="1804" y="-24883.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1804" y="-24872.96" font-family="Times,serif" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1804" y="-24861.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1804" y="-24850.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep0_tp1&#45;&gt;stage2_expert_agg_dp0_ep0_tp1 -->
<g id="edge144" class="edge">
<title>stage2_expert1_dp0_ep0_tp1&#45;&gt;stage2_expert_agg_dp0_ep0_tp1</title>
<path fill="none" stroke="black" d="M1704.91,-24984.79C1718.32,-24969.38 1736.07,-24949 1752.83,-24929.74"/>
<polygon fill="black" stroke="black" points="1755.52,-24931.98 1759.45,-24922.14 1750.24,-24927.38 1755.52,-24931.98"/>
</g>
<!-- stage2_expert2_dp0_ep0_tp1&#45;&gt;stage2_expert_agg_dp0_ep0_tp1 -->
<g id="edge145" class="edge">
<title>stage2_expert2_dp0_ep0_tp1&#45;&gt;stage2_expert_agg_dp0_ep0_tp1</title>
<path fill="none" stroke="black" d="M1912.1,-24984.79C1897.4,-24969.32 1877.94,-24948.82 1859.58,-24929.48"/>
<polygon fill="black" stroke="black" points="1862.03,-24926.98 1852.6,-24922.14 1856.95,-24931.8 1862.03,-24926.98"/>
</g>
<!-- stage2_ln2_dp0_ep0_tp1 -->
<g id="node127" class="node">
<title>stage2_ln2_dp0_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1918.5,-24759.96 1689.5,-24759.96 1689.5,-24707.96 1918.5,-24707.96 1918.5,-24759.96"/>
<text text-anchor="middle" x="1804" y="-24747.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1804" y="-24736.96" font-family="Times,serif" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1804" y="-24725.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1804" y="-24714.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep0_tp1&#45;&gt;stage2_ln2_dp0_ep0_tp1 -->
<g id="edge146" class="edge">
<title>stage2_expert_agg_dp0_ep0_tp1&#45;&gt;stage2_ln2_dp0_ep0_tp1</title>
<path fill="none" stroke="black" d="M1804,-24817.91C1804,-24801.96 1804,-24784.73 1804,-24770.13"/>
<polygon fill="black" stroke="black" points="1807.5,-24770.02 1804,-24760.02 1800.5,-24770.02 1807.5,-24770.02"/>
</g>
<!-- stage2_ln1_dp0_ep1_tp1 -->
<g id="node135" class="node">
<title>stage2_ln1_dp0_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1918.5,-24649.96 1689.5,-24649.96 1689.5,-24597.96 1918.5,-24597.96 1918.5,-24649.96"/>
<text text-anchor="middle" x="1804" y="-24637.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1804" y="-24626.96" font-family="Times,serif" font-size="10.00">GPU 19</text>
<text text-anchor="middle" x="1804" y="-24615.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1804" y="-24604.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep0_tp1&#45;&gt;stage2_ln1_dp0_ep1_tp1 -->
<g id="edge147" class="edge">
<title>stage2_ln2_dp0_ep0_tp1&#45;&gt;stage2_ln1_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M1804,-24707.91C1804,-24693.83 1804,-24676.03 1804,-24660.53"/>
<polygon fill="black" stroke="black" points="1807.5,-24660.24 1804,-24650.24 1800.5,-24660.24 1807.5,-24660.24"/>
</g>
<!-- stage2_mha_dp0_ep1_tp0 -->
<g id="node129" class="node">
<title>stage2_mha_dp0_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1411.5,-24534.96 1182.5,-24534.96 1182.5,-24482.96 1411.5,-24482.96 1411.5,-24534.96"/>
<text text-anchor="middle" x="1297" y="-24522.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1297" y="-24511.96" font-family="Times,serif" font-size="10.00">GPU 18</text>
<text text-anchor="middle" x="1297" y="-24500.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1297" y="-24489.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep1_tp0&#45;&gt;stage2_mha_dp0_ep1_tp0 -->
<g id="edge148" class="edge">
<title>stage2_ln1_dp0_ep1_tp0&#45;&gt;stage2_mha_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M1297,-24597.88C1297,-24582.37 1297,-24562.23 1297,-24545.14"/>
<polygon fill="black" stroke="black" points="1300.5,-24544.97 1297,-24534.97 1293.5,-24544.97 1300.5,-24544.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep1_tp0 -->
<g id="node130" class="node">
<title>stage2_moe_gate_dp0_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1541.85,-24405.96 1152.35,-24405.96 1052.15,-24301.96 1441.65,-24301.96 1541.85,-24405.96"/>
<text text-anchor="middle" x="1297" y="-24367.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1297" y="-24356.96" font-family="Times,serif" font-size="10.00">GPU 18</text>
<text text-anchor="middle" x="1297" y="-24345.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1297" y="-24334.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep1_tp0&#45;&gt;stage2_moe_gate_dp0_ep1_tp0 -->
<g id="edge149" class="edge">
<title>stage2_mha_dp0_ep1_tp0&#45;&gt;stage2_moe_gate_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M1297,-24482.69C1297,-24464.58 1297,-24439.37 1297,-24416.13"/>
<polygon fill="black" stroke="black" points="1300.5,-24415.97 1297,-24405.97 1293.5,-24415.97 1300.5,-24415.97"/>
</g>
<!-- stage2_expert1_dp0_ep1_tp0 -->
<g id="node131" class="node">
<title>stage2_expert1_dp0_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1288.5,-24238.96 1053.5,-24238.96 1053.5,-24186.96 1288.5,-24186.96 1288.5,-24238.96"/>
<text text-anchor="middle" x="1171" y="-24226.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1171" y="-24215.96" font-family="Times,serif" font-size="10.00">GPU 18</text>
<text text-anchor="middle" x="1171" y="-24204.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1171" y="-24193.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep1_tp0&#45;&gt;stage2_expert1_dp0_ep1_tp0 -->
<g id="edge150" class="edge">
<title>stage2_moe_gate_dp0_ep1_tp0&#45;&gt;stage2_expert1_dp0_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1250.44,-24301.59C1233.81,-24283.25 1215.54,-24263.09 1200.72,-24246.74"/>
<polygon fill="black" stroke="black" points="1203.05,-24244.1 1193.74,-24239.05 1197.87,-24248.81 1203.05,-24244.1"/>
</g>
<!-- stage2_expert2_dp0_ep1_tp0 -->
<g id="node132" class="node">
<title>stage2_expert2_dp0_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1541.5,-24238.96 1306.5,-24238.96 1306.5,-24186.96 1541.5,-24186.96 1541.5,-24238.96"/>
<text text-anchor="middle" x="1424" y="-24226.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1424" y="-24215.96" font-family="Times,serif" font-size="10.00">GPU 18</text>
<text text-anchor="middle" x="1424" y="-24204.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1424" y="-24193.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep1_tp0&#45;&gt;stage2_expert2_dp0_ep1_tp0 -->
<g id="edge151" class="edge">
<title>stage2_moe_gate_dp0_ep1_tp0&#45;&gt;stage2_expert2_dp0_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1343.93,-24301.59C1360.69,-24283.25 1379.1,-24263.09 1394.04,-24246.74"/>
<polygon fill="black" stroke="black" points="1396.92,-24248.79 1401.08,-24239.05 1391.75,-24244.07 1396.92,-24248.79"/>
</g>
<!-- stage2_expert_agg_dp0_ep1_tp0 -->
<g id="node133" class="node">
<title>stage2_expert_agg_dp0_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1530.33,-24123.96 1152.79,-24123.96 1055.67,-24019.96 1433.21,-24019.96 1530.33,-24123.96"/>
<text text-anchor="middle" x="1293" y="-24085.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1293" y="-24074.96" font-family="Times,serif" font-size="10.00">GPU 18</text>
<text text-anchor="middle" x="1293" y="-24063.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1293" y="-24052.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep1_tp0&#45;&gt;stage2_expert_agg_dp0_ep1_tp0 -->
<g id="edge152" class="edge">
<title>stage2_expert1_dp0_ep1_tp0&#45;&gt;stage2_expert_agg_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M1193.09,-24186.79C1206.61,-24171.38 1224.5,-24151 1241.41,-24131.74"/>
<polygon fill="black" stroke="black" points="1244.11,-24133.96 1248.08,-24124.14 1238.85,-24129.35 1244.11,-24133.96"/>
</g>
<!-- stage2_expert2_dp0_ep1_tp0&#45;&gt;stage2_expert_agg_dp0_ep1_tp0 -->
<g id="edge153" class="edge">
<title>stage2_expert2_dp0_ep1_tp0&#45;&gt;stage2_expert_agg_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M1400.28,-24186.79C1385.7,-24171.32 1366.38,-24150.82 1348.16,-24131.48"/>
<polygon fill="black" stroke="black" points="1350.64,-24129.02 1341.24,-24124.14 1345.55,-24133.82 1350.64,-24129.02"/>
</g>
<!-- stage2_ln2_dp0_ep1_tp0 -->
<g id="node134" class="node">
<title>stage2_ln2_dp0_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1407.5,-23961.96 1178.5,-23961.96 1178.5,-23909.96 1407.5,-23909.96 1407.5,-23961.96"/>
<text text-anchor="middle" x="1293" y="-23949.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1293" y="-23938.96" font-family="Times,serif" font-size="10.00">GPU 18</text>
<text text-anchor="middle" x="1293" y="-23927.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1293" y="-23916.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep1_tp0&#45;&gt;stage2_ln2_dp0_ep1_tp0 -->
<g id="edge154" class="edge">
<title>stage2_expert_agg_dp0_ep1_tp0&#45;&gt;stage2_ln2_dp0_ep1_tp0</title>
<path fill="none" stroke="black" d="M1293,-24019.91C1293,-24003.96 1293,-23986.73 1293,-23972.13"/>
<polygon fill="black" stroke="black" points="1296.5,-23972.02 1293,-23962.02 1289.5,-23972.02 1296.5,-23972.02"/>
</g>
<!-- stage2_ln1_dp0_ep2_tp0 -->
<g id="node142" class="node">
<title>stage2_ln1_dp0_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1407.5,-23851.96 1178.5,-23851.96 1178.5,-23799.96 1407.5,-23799.96 1407.5,-23851.96"/>
<text text-anchor="middle" x="1293" y="-23839.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1293" y="-23828.96" font-family="Times,serif" font-size="10.00">GPU 20</text>
<text text-anchor="middle" x="1293" y="-23817.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1293" y="-23806.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep1_tp0&#45;&gt;stage2_ln1_dp0_ep2_tp0 -->
<g id="edge155" class="edge">
<title>stage2_ln2_dp0_ep1_tp0&#45;&gt;stage2_ln1_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M1293,-23909.91C1293,-23895.83 1293,-23878.03 1293,-23862.53"/>
<polygon fill="black" stroke="black" points="1296.5,-23862.24 1293,-23852.24 1289.5,-23862.24 1296.5,-23862.24"/>
</g>
<!-- stage2_mha_dp0_ep1_tp1 -->
<g id="node136" class="node">
<title>stage2_mha_dp0_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1918.5,-24534.96 1689.5,-24534.96 1689.5,-24482.96 1918.5,-24482.96 1918.5,-24534.96"/>
<text text-anchor="middle" x="1804" y="-24522.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1804" y="-24511.96" font-family="Times,serif" font-size="10.00">GPU 19</text>
<text text-anchor="middle" x="1804" y="-24500.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1804" y="-24489.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep1_tp1&#45;&gt;stage2_mha_dp0_ep1_tp1 -->
<g id="edge156" class="edge">
<title>stage2_ln1_dp0_ep1_tp1&#45;&gt;stage2_mha_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M1804,-24597.88C1804,-24582.37 1804,-24562.23 1804,-24545.14"/>
<polygon fill="black" stroke="black" points="1807.5,-24544.97 1804,-24534.97 1800.5,-24544.97 1807.5,-24544.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep1_tp1 -->
<g id="node137" class="node">
<title>stage2_moe_gate_dp0_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2048.85,-24405.96 1659.35,-24405.96 1559.15,-24301.96 1948.65,-24301.96 2048.85,-24405.96"/>
<text text-anchor="middle" x="1804" y="-24367.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1804" y="-24356.96" font-family="Times,serif" font-size="10.00">GPU 19</text>
<text text-anchor="middle" x="1804" y="-24345.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1804" y="-24334.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep1_tp1&#45;&gt;stage2_moe_gate_dp0_ep1_tp1 -->
<g id="edge157" class="edge">
<title>stage2_mha_dp0_ep1_tp1&#45;&gt;stage2_moe_gate_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M1804,-24482.69C1804,-24464.58 1804,-24439.37 1804,-24416.13"/>
<polygon fill="black" stroke="black" points="1807.5,-24415.97 1804,-24405.97 1800.5,-24415.97 1807.5,-24415.97"/>
</g>
<!-- stage2_expert1_dp0_ep1_tp1 -->
<g id="node138" class="node">
<title>stage2_expert1_dp0_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1794.5,-24238.96 1559.5,-24238.96 1559.5,-24186.96 1794.5,-24186.96 1794.5,-24238.96"/>
<text text-anchor="middle" x="1677" y="-24226.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1677" y="-24215.96" font-family="Times,serif" font-size="10.00">GPU 19</text>
<text text-anchor="middle" x="1677" y="-24204.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1677" y="-24193.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep1_tp1&#45;&gt;stage2_expert1_dp0_ep1_tp1 -->
<g id="edge158" class="edge">
<title>stage2_moe_gate_dp0_ep1_tp1&#45;&gt;stage2_expert1_dp0_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1757.07,-24301.59C1740.31,-24283.25 1721.9,-24263.09 1706.96,-24246.74"/>
<polygon fill="black" stroke="black" points="1709.25,-24244.07 1699.92,-24239.05 1704.08,-24248.79 1709.25,-24244.07"/>
</g>
<!-- stage2_expert2_dp0_ep1_tp1 -->
<g id="node139" class="node">
<title>stage2_expert2_dp0_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2047.5,-24238.96 1812.5,-24238.96 1812.5,-24186.96 2047.5,-24186.96 2047.5,-24238.96"/>
<text text-anchor="middle" x="1930" y="-24226.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1930" y="-24215.96" font-family="Times,serif" font-size="10.00">GPU 19</text>
<text text-anchor="middle" x="1930" y="-24204.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1930" y="-24193.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep1_tp1&#45;&gt;stage2_expert2_dp0_ep1_tp1 -->
<g id="edge159" class="edge">
<title>stage2_moe_gate_dp0_ep1_tp1&#45;&gt;stage2_expert2_dp0_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1850.56,-24301.59C1867.19,-24283.25 1885.46,-24263.09 1900.28,-24246.74"/>
<polygon fill="black" stroke="black" points="1903.13,-24248.81 1907.26,-24239.05 1897.95,-24244.1 1903.13,-24248.81"/>
</g>
<!-- stage2_expert_agg_dp0_ep1_tp1 -->
<g id="node140" class="node">
<title>stage2_expert_agg_dp0_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2037.33,-24123.96 1659.79,-24123.96 1562.67,-24019.96 1940.21,-24019.96 2037.33,-24123.96"/>
<text text-anchor="middle" x="1800" y="-24085.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1800" y="-24074.96" font-family="Times,serif" font-size="10.00">GPU 19</text>
<text text-anchor="middle" x="1800" y="-24063.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1800" y="-24052.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep1_tp1&#45;&gt;stage2_expert_agg_dp0_ep1_tp1 -->
<g id="edge160" class="edge">
<title>stage2_expert1_dp0_ep1_tp1&#45;&gt;stage2_expert_agg_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M1699.27,-24186.79C1712.9,-24171.38 1730.94,-24151 1747.99,-24131.74"/>
<polygon fill="black" stroke="black" points="1750.7,-24133.95 1754.71,-24124.14 1745.46,-24129.31 1750.7,-24133.95"/>
</g>
<!-- stage2_expert2_dp0_ep1_tp1&#45;&gt;stage2_expert_agg_dp0_ep1_tp1 -->
<g id="edge161" class="edge">
<title>stage2_expert2_dp0_ep1_tp1&#45;&gt;stage2_expert_agg_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M1906.46,-24186.79C1891.99,-24171.32 1872.82,-24150.82 1854.73,-24131.48"/>
<polygon fill="black" stroke="black" points="1857.26,-24129.05 1847.87,-24124.14 1852.14,-24133.83 1857.26,-24129.05"/>
</g>
<!-- stage2_ln2_dp0_ep1_tp1 -->
<g id="node141" class="node">
<title>stage2_ln2_dp0_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1914.5,-23961.96 1685.5,-23961.96 1685.5,-23909.96 1914.5,-23909.96 1914.5,-23961.96"/>
<text text-anchor="middle" x="1800" y="-23949.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1800" y="-23938.96" font-family="Times,serif" font-size="10.00">GPU 19</text>
<text text-anchor="middle" x="1800" y="-23927.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1800" y="-23916.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep1_tp1&#45;&gt;stage2_ln2_dp0_ep1_tp1 -->
<g id="edge162" class="edge">
<title>stage2_expert_agg_dp0_ep1_tp1&#45;&gt;stage2_ln2_dp0_ep1_tp1</title>
<path fill="none" stroke="black" d="M1800,-24019.91C1800,-24003.96 1800,-23986.73 1800,-23972.13"/>
<polygon fill="black" stroke="black" points="1803.5,-23972.02 1800,-23962.02 1796.5,-23972.02 1803.5,-23972.02"/>
</g>
<!-- stage2_ln1_dp0_ep2_tp1 -->
<g id="node149" class="node">
<title>stage2_ln1_dp0_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1914.5,-23851.96 1685.5,-23851.96 1685.5,-23799.96 1914.5,-23799.96 1914.5,-23851.96"/>
<text text-anchor="middle" x="1800" y="-23839.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1800" y="-23828.96" font-family="Times,serif" font-size="10.00">GPU 21</text>
<text text-anchor="middle" x="1800" y="-23817.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1800" y="-23806.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep1_tp1&#45;&gt;stage2_ln1_dp0_ep2_tp1 -->
<g id="edge163" class="edge">
<title>stage2_ln2_dp0_ep1_tp1&#45;&gt;stage2_ln1_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M1800,-23909.91C1800,-23895.83 1800,-23878.03 1800,-23862.53"/>
<polygon fill="black" stroke="black" points="1803.5,-23862.24 1800,-23852.24 1796.5,-23862.24 1803.5,-23862.24"/>
</g>
<!-- stage2_mha_dp0_ep2_tp0 -->
<g id="node143" class="node">
<title>stage2_mha_dp0_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1407.5,-23736.96 1178.5,-23736.96 1178.5,-23684.96 1407.5,-23684.96 1407.5,-23736.96"/>
<text text-anchor="middle" x="1293" y="-23724.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1293" y="-23713.96" font-family="Times,serif" font-size="10.00">GPU 20</text>
<text text-anchor="middle" x="1293" y="-23702.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1293" y="-23691.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep2_tp0&#45;&gt;stage2_mha_dp0_ep2_tp0 -->
<g id="edge164" class="edge">
<title>stage2_ln1_dp0_ep2_tp0&#45;&gt;stage2_mha_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M1293,-23799.88C1293,-23784.37 1293,-23764.23 1293,-23747.14"/>
<polygon fill="black" stroke="black" points="1296.5,-23746.97 1293,-23736.97 1289.5,-23746.97 1296.5,-23746.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep2_tp0 -->
<g id="node144" class="node">
<title>stage2_moe_gate_dp0_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1537.85,-23607.96 1148.35,-23607.96 1048.15,-23503.96 1437.65,-23503.96 1537.85,-23607.96"/>
<text text-anchor="middle" x="1293" y="-23569.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1293" y="-23558.96" font-family="Times,serif" font-size="10.00">GPU 20</text>
<text text-anchor="middle" x="1293" y="-23547.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1293" y="-23536.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep2_tp0&#45;&gt;stage2_moe_gate_dp0_ep2_tp0 -->
<g id="edge165" class="edge">
<title>stage2_mha_dp0_ep2_tp0&#45;&gt;stage2_moe_gate_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M1293,-23684.69C1293,-23666.58 1293,-23641.37 1293,-23618.13"/>
<polygon fill="black" stroke="black" points="1296.5,-23617.97 1293,-23607.97 1289.5,-23617.97 1296.5,-23617.97"/>
</g>
<!-- stage2_expert1_dp0_ep2_tp0 -->
<g id="node145" class="node">
<title>stage2_expert1_dp0_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1284.5,-23440.96 1049.5,-23440.96 1049.5,-23388.96 1284.5,-23388.96 1284.5,-23440.96"/>
<text text-anchor="middle" x="1167" y="-23428.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1167" y="-23417.96" font-family="Times,serif" font-size="10.00">GPU 20</text>
<text text-anchor="middle" x="1167" y="-23406.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1167" y="-23395.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep2_tp0&#45;&gt;stage2_expert1_dp0_ep2_tp0 -->
<g id="edge166" class="edge">
<title>stage2_moe_gate_dp0_ep2_tp0&#45;&gt;stage2_expert1_dp0_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1246.44,-23503.59C1229.81,-23485.25 1211.54,-23465.09 1196.72,-23448.74"/>
<polygon fill="black" stroke="black" points="1199.05,-23446.1 1189.74,-23441.05 1193.87,-23450.81 1199.05,-23446.1"/>
</g>
<!-- stage2_expert2_dp0_ep2_tp0 -->
<g id="node146" class="node">
<title>stage2_expert2_dp0_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1537.5,-23440.96 1302.5,-23440.96 1302.5,-23388.96 1537.5,-23388.96 1537.5,-23440.96"/>
<text text-anchor="middle" x="1420" y="-23428.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1420" y="-23417.96" font-family="Times,serif" font-size="10.00">GPU 20</text>
<text text-anchor="middle" x="1420" y="-23406.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1420" y="-23395.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep2_tp0&#45;&gt;stage2_expert2_dp0_ep2_tp0 -->
<g id="edge167" class="edge">
<title>stage2_moe_gate_dp0_ep2_tp0&#45;&gt;stage2_expert2_dp0_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1339.93,-23503.59C1356.69,-23485.25 1375.1,-23465.09 1390.04,-23448.74"/>
<polygon fill="black" stroke="black" points="1392.92,-23450.79 1397.08,-23441.05 1387.75,-23446.07 1392.92,-23450.79"/>
</g>
<!-- stage2_expert_agg_dp0_ep2_tp0 -->
<g id="node147" class="node">
<title>stage2_expert_agg_dp0_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1531.33,-23325.96 1153.79,-23325.96 1056.67,-23221.96 1434.21,-23221.96 1531.33,-23325.96"/>
<text text-anchor="middle" x="1294" y="-23287.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1294" y="-23276.96" font-family="Times,serif" font-size="10.00">GPU 20</text>
<text text-anchor="middle" x="1294" y="-23265.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1294" y="-23254.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep2_tp0&#45;&gt;stage2_expert_agg_dp0_ep2_tp0 -->
<g id="edge168" class="edge">
<title>stage2_expert1_dp0_ep2_tp0&#45;&gt;stage2_expert_agg_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M1190,-23388.79C1204.07,-23373.38 1222.7,-23353 1240.3,-23333.74"/>
<polygon fill="black" stroke="black" points="1243.07,-23335.88 1247.24,-23326.14 1237.91,-23331.16 1243.07,-23335.88"/>
</g>
<!-- stage2_expert2_dp0_ep2_tp0&#45;&gt;stage2_expert_agg_dp0_ep2_tp0 -->
<g id="edge169" class="edge">
<title>stage2_expert2_dp0_ep2_tp0&#45;&gt;stage2_expert_agg_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M1397.18,-23388.79C1383.22,-23373.38 1364.74,-23353 1347.28,-23333.74"/>
<polygon fill="black" stroke="black" points="1349.7,-23331.2 1340.4,-23326.14 1344.52,-23335.9 1349.7,-23331.2"/>
</g>
<!-- stage2_ln2_dp0_ep2_tp0 -->
<g id="node148" class="node">
<title>stage2_ln2_dp0_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1408.5,-23163.96 1179.5,-23163.96 1179.5,-23111.96 1408.5,-23111.96 1408.5,-23163.96"/>
<text text-anchor="middle" x="1294" y="-23151.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1294" y="-23140.96" font-family="Times,serif" font-size="10.00">GPU 20</text>
<text text-anchor="middle" x="1294" y="-23129.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1294" y="-23118.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep2_tp0&#45;&gt;stage2_ln2_dp0_ep2_tp0 -->
<g id="edge170" class="edge">
<title>stage2_expert_agg_dp0_ep2_tp0&#45;&gt;stage2_ln2_dp0_ep2_tp0</title>
<path fill="none" stroke="black" d="M1294,-23221.91C1294,-23205.96 1294,-23188.73 1294,-23174.13"/>
<polygon fill="black" stroke="black" points="1297.5,-23174.02 1294,-23164.02 1290.5,-23174.02 1297.5,-23174.02"/>
</g>
<!-- stage2_ln1_dp0_ep3_tp0 -->
<g id="node156" class="node">
<title>stage2_ln1_dp0_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1408.5,-23053.96 1179.5,-23053.96 1179.5,-23001.96 1408.5,-23001.96 1408.5,-23053.96"/>
<text text-anchor="middle" x="1294" y="-23041.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1294" y="-23030.96" font-family="Times,serif" font-size="10.00">GPU 22</text>
<text text-anchor="middle" x="1294" y="-23019.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1294" y="-23008.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep2_tp0&#45;&gt;stage2_ln1_dp0_ep3_tp0 -->
<g id="edge171" class="edge">
<title>stage2_ln2_dp0_ep2_tp0&#45;&gt;stage2_ln1_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M1294,-23111.91C1294,-23097.83 1294,-23080.03 1294,-23064.53"/>
<polygon fill="black" stroke="black" points="1297.5,-23064.24 1294,-23054.24 1290.5,-23064.24 1297.5,-23064.24"/>
</g>
<!-- stage2_mha_dp0_ep2_tp1 -->
<g id="node150" class="node">
<title>stage2_mha_dp0_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1914.5,-23736.96 1685.5,-23736.96 1685.5,-23684.96 1914.5,-23684.96 1914.5,-23736.96"/>
<text text-anchor="middle" x="1800" y="-23724.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1800" y="-23713.96" font-family="Times,serif" font-size="10.00">GPU 21</text>
<text text-anchor="middle" x="1800" y="-23702.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1800" y="-23691.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep2_tp1&#45;&gt;stage2_mha_dp0_ep2_tp1 -->
<g id="edge172" class="edge">
<title>stage2_ln1_dp0_ep2_tp1&#45;&gt;stage2_mha_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M1800,-23799.88C1800,-23784.37 1800,-23764.23 1800,-23747.14"/>
<polygon fill="black" stroke="black" points="1803.5,-23746.97 1800,-23736.97 1796.5,-23746.97 1803.5,-23746.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep2_tp1 -->
<g id="node151" class="node">
<title>stage2_moe_gate_dp0_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2044.85,-23607.96 1655.35,-23607.96 1555.15,-23503.96 1944.65,-23503.96 2044.85,-23607.96"/>
<text text-anchor="middle" x="1800" y="-23569.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1800" y="-23558.96" font-family="Times,serif" font-size="10.00">GPU 21</text>
<text text-anchor="middle" x="1800" y="-23547.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1800" y="-23536.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep2_tp1&#45;&gt;stage2_moe_gate_dp0_ep2_tp1 -->
<g id="edge173" class="edge">
<title>stage2_mha_dp0_ep2_tp1&#45;&gt;stage2_moe_gate_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M1800,-23684.69C1800,-23666.58 1800,-23641.37 1800,-23618.13"/>
<polygon fill="black" stroke="black" points="1803.5,-23617.97 1800,-23607.97 1796.5,-23617.97 1803.5,-23617.97"/>
</g>
<!-- stage2_expert1_dp0_ep2_tp1 -->
<g id="node152" class="node">
<title>stage2_expert1_dp0_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1790.5,-23440.96 1555.5,-23440.96 1555.5,-23388.96 1790.5,-23388.96 1790.5,-23440.96"/>
<text text-anchor="middle" x="1673" y="-23428.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1673" y="-23417.96" font-family="Times,serif" font-size="10.00">GPU 21</text>
<text text-anchor="middle" x="1673" y="-23406.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1673" y="-23395.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep2_tp1&#45;&gt;stage2_expert1_dp0_ep2_tp1 -->
<g id="edge174" class="edge">
<title>stage2_moe_gate_dp0_ep2_tp1&#45;&gt;stage2_expert1_dp0_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1753.07,-23503.59C1736.31,-23485.25 1717.9,-23465.09 1702.96,-23448.74"/>
<polygon fill="black" stroke="black" points="1705.25,-23446.07 1695.92,-23441.05 1700.08,-23450.79 1705.25,-23446.07"/>
</g>
<!-- stage2_expert2_dp0_ep2_tp1 -->
<g id="node153" class="node">
<title>stage2_expert2_dp0_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2043.5,-23440.96 1808.5,-23440.96 1808.5,-23388.96 2043.5,-23388.96 2043.5,-23440.96"/>
<text text-anchor="middle" x="1926" y="-23428.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1926" y="-23417.96" font-family="Times,serif" font-size="10.00">GPU 21</text>
<text text-anchor="middle" x="1926" y="-23406.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1926" y="-23395.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep2_tp1&#45;&gt;stage2_expert2_dp0_ep2_tp1 -->
<g id="edge175" class="edge">
<title>stage2_moe_gate_dp0_ep2_tp1&#45;&gt;stage2_expert2_dp0_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1846.56,-23503.59C1863.19,-23485.25 1881.46,-23465.09 1896.28,-23448.74"/>
<polygon fill="black" stroke="black" points="1899.13,-23450.81 1903.26,-23441.05 1893.95,-23446.1 1899.13,-23450.81"/>
</g>
<!-- stage2_expert_agg_dp0_ep2_tp1 -->
<g id="node154" class="node">
<title>stage2_expert_agg_dp0_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2038.33,-23325.96 1660.79,-23325.96 1563.67,-23221.96 1941.21,-23221.96 2038.33,-23325.96"/>
<text text-anchor="middle" x="1801" y="-23287.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1801" y="-23276.96" font-family="Times,serif" font-size="10.00">GPU 21</text>
<text text-anchor="middle" x="1801" y="-23265.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1801" y="-23254.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep2_tp1&#45;&gt;stage2_expert_agg_dp0_ep2_tp1 -->
<g id="edge176" class="edge">
<title>stage2_expert1_dp0_ep2_tp1&#45;&gt;stage2_expert_agg_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M1696.18,-23388.79C1710.36,-23373.38 1729.14,-23353 1746.87,-23333.74"/>
<polygon fill="black" stroke="black" points="1749.67,-23335.87 1753.87,-23326.14 1744.52,-23331.12 1749.67,-23335.87"/>
</g>
<!-- stage2_expert2_dp0_ep2_tp1&#45;&gt;stage2_expert_agg_dp0_ep2_tp1 -->
<g id="edge177" class="edge">
<title>stage2_expert2_dp0_ep2_tp1&#45;&gt;stage2_expert_agg_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M1903.36,-23388.79C1889.51,-23373.38 1871.18,-23353 1853.86,-23333.74"/>
<polygon fill="black" stroke="black" points="1856.32,-23331.23 1847.03,-23326.14 1851.11,-23335.92 1856.32,-23331.23"/>
</g>
<!-- stage2_ln2_dp0_ep2_tp1 -->
<g id="node155" class="node">
<title>stage2_ln2_dp0_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1915.5,-23163.96 1686.5,-23163.96 1686.5,-23111.96 1915.5,-23111.96 1915.5,-23163.96"/>
<text text-anchor="middle" x="1801" y="-23151.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1801" y="-23140.96" font-family="Times,serif" font-size="10.00">GPU 21</text>
<text text-anchor="middle" x="1801" y="-23129.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1801" y="-23118.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep2_tp1&#45;&gt;stage2_ln2_dp0_ep2_tp1 -->
<g id="edge178" class="edge">
<title>stage2_expert_agg_dp0_ep2_tp1&#45;&gt;stage2_ln2_dp0_ep2_tp1</title>
<path fill="none" stroke="black" d="M1801,-23221.91C1801,-23205.96 1801,-23188.73 1801,-23174.13"/>
<polygon fill="black" stroke="black" points="1804.5,-23174.02 1801,-23164.02 1797.5,-23174.02 1804.5,-23174.02"/>
</g>
<!-- stage2_ln1_dp0_ep3_tp1 -->
<g id="node163" class="node">
<title>stage2_ln1_dp0_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1915.5,-23053.96 1686.5,-23053.96 1686.5,-23001.96 1915.5,-23001.96 1915.5,-23053.96"/>
<text text-anchor="middle" x="1801" y="-23041.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1801" y="-23030.96" font-family="Times,serif" font-size="10.00">GPU 23</text>
<text text-anchor="middle" x="1801" y="-23019.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1801" y="-23008.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep2_tp1&#45;&gt;stage2_ln1_dp0_ep3_tp1 -->
<g id="edge179" class="edge">
<title>stage2_ln2_dp0_ep2_tp1&#45;&gt;stage2_ln1_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M1801,-23111.91C1801,-23097.83 1801,-23080.03 1801,-23064.53"/>
<polygon fill="black" stroke="black" points="1804.5,-23064.24 1801,-23054.24 1797.5,-23064.24 1804.5,-23064.24"/>
</g>
<!-- stage2_mha_dp0_ep3_tp0 -->
<g id="node157" class="node">
<title>stage2_mha_dp0_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1408.5,-22938.96 1179.5,-22938.96 1179.5,-22886.96 1408.5,-22886.96 1408.5,-22938.96"/>
<text text-anchor="middle" x="1294" y="-22926.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1294" y="-22915.96" font-family="Times,serif" font-size="10.00">GPU 22</text>
<text text-anchor="middle" x="1294" y="-22904.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1294" y="-22893.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep3_tp0&#45;&gt;stage2_mha_dp0_ep3_tp0 -->
<g id="edge180" class="edge">
<title>stage2_ln1_dp0_ep3_tp0&#45;&gt;stage2_mha_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M1294,-23001.88C1294,-22986.37 1294,-22966.23 1294,-22949.14"/>
<polygon fill="black" stroke="black" points="1297.5,-22948.97 1294,-22938.97 1290.5,-22948.97 1297.5,-22948.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep3_tp0 -->
<g id="node158" class="node">
<title>stage2_moe_gate_dp0_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1538.85,-22809.96 1149.35,-22809.96 1049.15,-22705.96 1438.65,-22705.96 1538.85,-22809.96"/>
<text text-anchor="middle" x="1294" y="-22771.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1294" y="-22760.96" font-family="Times,serif" font-size="10.00">GPU 22</text>
<text text-anchor="middle" x="1294" y="-22749.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1294" y="-22738.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep3_tp0&#45;&gt;stage2_moe_gate_dp0_ep3_tp0 -->
<g id="edge181" class="edge">
<title>stage2_mha_dp0_ep3_tp0&#45;&gt;stage2_moe_gate_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M1294,-22886.69C1294,-22868.58 1294,-22843.37 1294,-22820.13"/>
<polygon fill="black" stroke="black" points="1297.5,-22819.97 1294,-22809.97 1290.5,-22819.97 1297.5,-22819.97"/>
</g>
<!-- stage2_expert1_dp0_ep3_tp0 -->
<g id="node159" class="node">
<title>stage2_expert1_dp0_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1285.5,-22642.96 1050.5,-22642.96 1050.5,-22590.96 1285.5,-22590.96 1285.5,-22642.96"/>
<text text-anchor="middle" x="1168" y="-22630.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1168" y="-22619.96" font-family="Times,serif" font-size="10.00">GPU 22</text>
<text text-anchor="middle" x="1168" y="-22608.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1168" y="-22597.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep3_tp0&#45;&gt;stage2_expert1_dp0_ep3_tp0 -->
<g id="edge182" class="edge">
<title>stage2_moe_gate_dp0_ep3_tp0&#45;&gt;stage2_expert1_dp0_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1247.44,-22705.59C1230.81,-22687.25 1212.54,-22667.09 1197.72,-22650.74"/>
<polygon fill="black" stroke="black" points="1200.05,-22648.1 1190.74,-22643.05 1194.87,-22652.81 1200.05,-22648.1"/>
</g>
<!-- stage2_expert2_dp0_ep3_tp0 -->
<g id="node160" class="node">
<title>stage2_expert2_dp0_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1538.5,-22642.96 1303.5,-22642.96 1303.5,-22590.96 1538.5,-22590.96 1538.5,-22642.96"/>
<text text-anchor="middle" x="1421" y="-22630.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1421" y="-22619.96" font-family="Times,serif" font-size="10.00">GPU 22</text>
<text text-anchor="middle" x="1421" y="-22608.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1421" y="-22597.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep3_tp0&#45;&gt;stage2_expert2_dp0_ep3_tp0 -->
<g id="edge183" class="edge">
<title>stage2_moe_gate_dp0_ep3_tp0&#45;&gt;stage2_expert2_dp0_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1340.93,-22705.59C1357.69,-22687.25 1376.1,-22667.09 1391.04,-22650.74"/>
<polygon fill="black" stroke="black" points="1393.92,-22652.79 1398.08,-22643.05 1388.75,-22648.07 1393.92,-22652.79"/>
</g>
<!-- stage2_expert_agg_dp0_ep3_tp0 -->
<g id="node161" class="node">
<title>stage2_expert_agg_dp0_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1527.33,-22527.96 1149.79,-22527.96 1052.67,-22423.96 1430.21,-22423.96 1527.33,-22527.96"/>
<text text-anchor="middle" x="1290" y="-22489.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1290" y="-22478.96" font-family="Times,serif" font-size="10.00">GPU 22</text>
<text text-anchor="middle" x="1290" y="-22467.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1290" y="-22456.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep3_tp0&#45;&gt;stage2_expert_agg_dp0_ep3_tp0 -->
<g id="edge184" class="edge">
<title>stage2_expert1_dp0_ep3_tp0&#45;&gt;stage2_expert_agg_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M1190.09,-22590.79C1203.61,-22575.38 1221.5,-22555 1238.41,-22535.74"/>
<polygon fill="black" stroke="black" points="1241.11,-22537.96 1245.08,-22528.14 1235.85,-22533.35 1241.11,-22537.96"/>
</g>
<!-- stage2_expert2_dp0_ep3_tp0&#45;&gt;stage2_expert_agg_dp0_ep3_tp0 -->
<g id="edge185" class="edge">
<title>stage2_expert2_dp0_ep3_tp0&#45;&gt;stage2_expert_agg_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M1397.28,-22590.79C1382.7,-22575.32 1363.38,-22554.82 1345.16,-22535.48"/>
<polygon fill="black" stroke="black" points="1347.64,-22533.02 1338.24,-22528.14 1342.55,-22537.82 1347.64,-22533.02"/>
</g>
<!-- stage2_ln2_dp0_ep3_tp0 -->
<g id="node162" class="node">
<title>stage2_ln2_dp0_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1404.5,-22365.96 1175.5,-22365.96 1175.5,-22313.96 1404.5,-22313.96 1404.5,-22365.96"/>
<text text-anchor="middle" x="1290" y="-22353.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1290" y="-22342.96" font-family="Times,serif" font-size="10.00">GPU 22</text>
<text text-anchor="middle" x="1290" y="-22331.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1290" y="-22320.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep3_tp0&#45;&gt;stage2_ln2_dp0_ep3_tp0 -->
<g id="edge186" class="edge">
<title>stage2_expert_agg_dp0_ep3_tp0&#45;&gt;stage2_ln2_dp0_ep3_tp0</title>
<path fill="none" stroke="black" d="M1290,-22423.91C1290,-22407.96 1290,-22390.73 1290,-22376.13"/>
<polygon fill="black" stroke="black" points="1293.5,-22376.02 1290,-22366.02 1286.5,-22376.02 1293.5,-22376.02"/>
</g>
<!-- stage2_ln1_dp0_ep4_tp0 -->
<g id="node170" class="node">
<title>stage2_ln1_dp0_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1404.5,-22255.96 1175.5,-22255.96 1175.5,-22203.96 1404.5,-22203.96 1404.5,-22255.96"/>
<text text-anchor="middle" x="1290" y="-22243.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1290" y="-22232.96" font-family="Times,serif" font-size="10.00">GPU 24</text>
<text text-anchor="middle" x="1290" y="-22221.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1290" y="-22210.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep3_tp0&#45;&gt;stage2_ln1_dp0_ep4_tp0 -->
<g id="edge187" class="edge">
<title>stage2_ln2_dp0_ep3_tp0&#45;&gt;stage2_ln1_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M1290,-22313.91C1290,-22299.83 1290,-22282.03 1290,-22266.53"/>
<polygon fill="black" stroke="black" points="1293.5,-22266.24 1290,-22256.24 1286.5,-22266.24 1293.5,-22266.24"/>
</g>
<!-- stage2_mha_dp0_ep3_tp1 -->
<g id="node164" class="node">
<title>stage2_mha_dp0_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1915.5,-22938.96 1686.5,-22938.96 1686.5,-22886.96 1915.5,-22886.96 1915.5,-22938.96"/>
<text text-anchor="middle" x="1801" y="-22926.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1801" y="-22915.96" font-family="Times,serif" font-size="10.00">GPU 23</text>
<text text-anchor="middle" x="1801" y="-22904.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1801" y="-22893.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep3_tp1&#45;&gt;stage2_mha_dp0_ep3_tp1 -->
<g id="edge188" class="edge">
<title>stage2_ln1_dp0_ep3_tp1&#45;&gt;stage2_mha_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M1801,-23001.88C1801,-22986.37 1801,-22966.23 1801,-22949.14"/>
<polygon fill="black" stroke="black" points="1804.5,-22948.97 1801,-22938.97 1797.5,-22948.97 1804.5,-22948.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep3_tp1 -->
<g id="node165" class="node">
<title>stage2_moe_gate_dp0_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2045.85,-22809.96 1656.35,-22809.96 1556.15,-22705.96 1945.65,-22705.96 2045.85,-22809.96"/>
<text text-anchor="middle" x="1801" y="-22771.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1801" y="-22760.96" font-family="Times,serif" font-size="10.00">GPU 23</text>
<text text-anchor="middle" x="1801" y="-22749.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1801" y="-22738.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep3_tp1&#45;&gt;stage2_moe_gate_dp0_ep3_tp1 -->
<g id="edge189" class="edge">
<title>stage2_mha_dp0_ep3_tp1&#45;&gt;stage2_moe_gate_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M1801,-22886.69C1801,-22868.58 1801,-22843.37 1801,-22820.13"/>
<polygon fill="black" stroke="black" points="1804.5,-22819.97 1801,-22809.97 1797.5,-22819.97 1804.5,-22819.97"/>
</g>
<!-- stage2_expert1_dp0_ep3_tp1 -->
<g id="node166" class="node">
<title>stage2_expert1_dp0_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1791.5,-22642.96 1556.5,-22642.96 1556.5,-22590.96 1791.5,-22590.96 1791.5,-22642.96"/>
<text text-anchor="middle" x="1674" y="-22630.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1674" y="-22619.96" font-family="Times,serif" font-size="10.00">GPU 23</text>
<text text-anchor="middle" x="1674" y="-22608.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1674" y="-22597.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep3_tp1&#45;&gt;stage2_expert1_dp0_ep3_tp1 -->
<g id="edge190" class="edge">
<title>stage2_moe_gate_dp0_ep3_tp1&#45;&gt;stage2_expert1_dp0_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1754.07,-22705.59C1737.31,-22687.25 1718.9,-22667.09 1703.96,-22650.74"/>
<polygon fill="black" stroke="black" points="1706.25,-22648.07 1696.92,-22643.05 1701.08,-22652.79 1706.25,-22648.07"/>
</g>
<!-- stage2_expert2_dp0_ep3_tp1 -->
<g id="node167" class="node">
<title>stage2_expert2_dp0_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2044.5,-22642.96 1809.5,-22642.96 1809.5,-22590.96 2044.5,-22590.96 2044.5,-22642.96"/>
<text text-anchor="middle" x="1927" y="-22630.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1927" y="-22619.96" font-family="Times,serif" font-size="10.00">GPU 23</text>
<text text-anchor="middle" x="1927" y="-22608.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1927" y="-22597.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep3_tp1&#45;&gt;stage2_expert2_dp0_ep3_tp1 -->
<g id="edge191" class="edge">
<title>stage2_moe_gate_dp0_ep3_tp1&#45;&gt;stage2_expert2_dp0_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1847.56,-22705.59C1864.19,-22687.25 1882.46,-22667.09 1897.28,-22650.74"/>
<polygon fill="black" stroke="black" points="1900.13,-22652.81 1904.26,-22643.05 1894.95,-22648.1 1900.13,-22652.81"/>
</g>
<!-- stage2_expert_agg_dp0_ep3_tp1 -->
<g id="node168" class="node">
<title>stage2_expert_agg_dp0_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2034.33,-22527.96 1656.79,-22527.96 1559.67,-22423.96 1937.21,-22423.96 2034.33,-22527.96"/>
<text text-anchor="middle" x="1797" y="-22489.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1797" y="-22478.96" font-family="Times,serif" font-size="10.00">GPU 23</text>
<text text-anchor="middle" x="1797" y="-22467.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1797" y="-22456.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep3_tp1&#45;&gt;stage2_expert_agg_dp0_ep3_tp1 -->
<g id="edge192" class="edge">
<title>stage2_expert1_dp0_ep3_tp1&#45;&gt;stage2_expert_agg_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M1696.27,-22590.79C1709.9,-22575.38 1727.94,-22555 1744.99,-22535.74"/>
<polygon fill="black" stroke="black" points="1747.7,-22537.95 1751.71,-22528.14 1742.46,-22533.31 1747.7,-22537.95"/>
</g>
<!-- stage2_expert2_dp0_ep3_tp1&#45;&gt;stage2_expert_agg_dp0_ep3_tp1 -->
<g id="edge193" class="edge">
<title>stage2_expert2_dp0_ep3_tp1&#45;&gt;stage2_expert_agg_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M1903.46,-22590.79C1888.99,-22575.32 1869.82,-22554.82 1851.73,-22535.48"/>
<polygon fill="black" stroke="black" points="1854.26,-22533.05 1844.87,-22528.14 1849.14,-22537.83 1854.26,-22533.05"/>
</g>
<!-- stage2_ln2_dp0_ep3_tp1 -->
<g id="node169" class="node">
<title>stage2_ln2_dp0_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1911.5,-22365.96 1682.5,-22365.96 1682.5,-22313.96 1911.5,-22313.96 1911.5,-22365.96"/>
<text text-anchor="middle" x="1797" y="-22353.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1797" y="-22342.96" font-family="Times,serif" font-size="10.00">GPU 23</text>
<text text-anchor="middle" x="1797" y="-22331.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1797" y="-22320.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep3_tp1&#45;&gt;stage2_ln2_dp0_ep3_tp1 -->
<g id="edge194" class="edge">
<title>stage2_expert_agg_dp0_ep3_tp1&#45;&gt;stage2_ln2_dp0_ep3_tp1</title>
<path fill="none" stroke="black" d="M1797,-22423.91C1797,-22407.96 1797,-22390.73 1797,-22376.13"/>
<polygon fill="black" stroke="black" points="1800.5,-22376.02 1797,-22366.02 1793.5,-22376.02 1800.5,-22376.02"/>
</g>
<!-- stage2_ln1_dp0_ep4_tp1 -->
<g id="node177" class="node">
<title>stage2_ln1_dp0_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1911.5,-22255.96 1682.5,-22255.96 1682.5,-22203.96 1911.5,-22203.96 1911.5,-22255.96"/>
<text text-anchor="middle" x="1797" y="-22243.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1797" y="-22232.96" font-family="Times,serif" font-size="10.00">GPU 25</text>
<text text-anchor="middle" x="1797" y="-22221.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1797" y="-22210.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep3_tp1&#45;&gt;stage2_ln1_dp0_ep4_tp1 -->
<g id="edge195" class="edge">
<title>stage2_ln2_dp0_ep3_tp1&#45;&gt;stage2_ln1_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M1797,-22313.91C1797,-22299.83 1797,-22282.03 1797,-22266.53"/>
<polygon fill="black" stroke="black" points="1800.5,-22266.24 1797,-22256.24 1793.5,-22266.24 1800.5,-22266.24"/>
</g>
<!-- stage2_mha_dp0_ep4_tp0 -->
<g id="node171" class="node">
<title>stage2_mha_dp0_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1404.5,-22140.96 1175.5,-22140.96 1175.5,-22088.96 1404.5,-22088.96 1404.5,-22140.96"/>
<text text-anchor="middle" x="1290" y="-22128.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1290" y="-22117.96" font-family="Times,serif" font-size="10.00">GPU 24</text>
<text text-anchor="middle" x="1290" y="-22106.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1290" y="-22095.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep4_tp0&#45;&gt;stage2_mha_dp0_ep4_tp0 -->
<g id="edge196" class="edge">
<title>stage2_ln1_dp0_ep4_tp0&#45;&gt;stage2_mha_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M1290,-22203.88C1290,-22188.37 1290,-22168.23 1290,-22151.14"/>
<polygon fill="black" stroke="black" points="1293.5,-22150.97 1290,-22140.97 1286.5,-22150.97 1293.5,-22150.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep4_tp0 -->
<g id="node172" class="node">
<title>stage2_moe_gate_dp0_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1534.85,-22011.96 1145.35,-22011.96 1045.15,-21907.96 1434.65,-21907.96 1534.85,-22011.96"/>
<text text-anchor="middle" x="1290" y="-21973.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1290" y="-21962.96" font-family="Times,serif" font-size="10.00">GPU 24</text>
<text text-anchor="middle" x="1290" y="-21951.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1290" y="-21940.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep4_tp0&#45;&gt;stage2_moe_gate_dp0_ep4_tp0 -->
<g id="edge197" class="edge">
<title>stage2_mha_dp0_ep4_tp0&#45;&gt;stage2_moe_gate_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M1290,-22088.69C1290,-22070.58 1290,-22045.37 1290,-22022.13"/>
<polygon fill="black" stroke="black" points="1293.5,-22021.97 1290,-22011.97 1286.5,-22021.97 1293.5,-22021.97"/>
</g>
<!-- stage2_expert1_dp0_ep4_tp0 -->
<g id="node173" class="node">
<title>stage2_expert1_dp0_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1281.5,-21844.96 1046.5,-21844.96 1046.5,-21792.96 1281.5,-21792.96 1281.5,-21844.96"/>
<text text-anchor="middle" x="1164" y="-21832.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1164" y="-21821.96" font-family="Times,serif" font-size="10.00">GPU 24</text>
<text text-anchor="middle" x="1164" y="-21810.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1164" y="-21799.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep4_tp0&#45;&gt;stage2_expert1_dp0_ep4_tp0 -->
<g id="edge198" class="edge">
<title>stage2_moe_gate_dp0_ep4_tp0&#45;&gt;stage2_expert1_dp0_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1243.44,-21907.59C1226.81,-21889.25 1208.54,-21869.09 1193.72,-21852.74"/>
<polygon fill="black" stroke="black" points="1196.05,-21850.1 1186.74,-21845.05 1190.87,-21854.81 1196.05,-21850.1"/>
</g>
<!-- stage2_expert2_dp0_ep4_tp0 -->
<g id="node174" class="node">
<title>stage2_expert2_dp0_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1534.5,-21844.96 1299.5,-21844.96 1299.5,-21792.96 1534.5,-21792.96 1534.5,-21844.96"/>
<text text-anchor="middle" x="1417" y="-21832.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1417" y="-21821.96" font-family="Times,serif" font-size="10.00">GPU 24</text>
<text text-anchor="middle" x="1417" y="-21810.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1417" y="-21799.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep4_tp0&#45;&gt;stage2_expert2_dp0_ep4_tp0 -->
<g id="edge199" class="edge">
<title>stage2_moe_gate_dp0_ep4_tp0&#45;&gt;stage2_expert2_dp0_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1336.93,-21907.59C1353.69,-21889.25 1372.1,-21869.09 1387.04,-21852.74"/>
<polygon fill="black" stroke="black" points="1389.92,-21854.79 1394.08,-21845.05 1384.75,-21850.07 1389.92,-21854.79"/>
</g>
<!-- stage2_expert_agg_dp0_ep4_tp0 -->
<g id="node175" class="node">
<title>stage2_expert_agg_dp0_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1523.33,-21729.96 1145.79,-21729.96 1048.67,-21625.96 1426.21,-21625.96 1523.33,-21729.96"/>
<text text-anchor="middle" x="1286" y="-21691.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1286" y="-21680.96" font-family="Times,serif" font-size="10.00">GPU 24</text>
<text text-anchor="middle" x="1286" y="-21669.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1286" y="-21658.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep4_tp0&#45;&gt;stage2_expert_agg_dp0_ep4_tp0 -->
<g id="edge200" class="edge">
<title>stage2_expert1_dp0_ep4_tp0&#45;&gt;stage2_expert_agg_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M1186.09,-21792.79C1199.61,-21777.38 1217.5,-21757 1234.41,-21737.74"/>
<polygon fill="black" stroke="black" points="1237.11,-21739.96 1241.08,-21730.14 1231.85,-21735.35 1237.11,-21739.96"/>
</g>
<!-- stage2_expert2_dp0_ep4_tp0&#45;&gt;stage2_expert_agg_dp0_ep4_tp0 -->
<g id="edge201" class="edge">
<title>stage2_expert2_dp0_ep4_tp0&#45;&gt;stage2_expert_agg_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M1393.28,-21792.79C1378.7,-21777.32 1359.38,-21756.82 1341.16,-21737.48"/>
<polygon fill="black" stroke="black" points="1343.64,-21735.02 1334.24,-21730.14 1338.55,-21739.82 1343.64,-21735.02"/>
</g>
<!-- stage2_ln2_dp0_ep4_tp0 -->
<g id="node176" class="node">
<title>stage2_ln2_dp0_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1400.5,-21567.96 1171.5,-21567.96 1171.5,-21515.96 1400.5,-21515.96 1400.5,-21567.96"/>
<text text-anchor="middle" x="1286" y="-21555.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1286" y="-21544.96" font-family="Times,serif" font-size="10.00">GPU 24</text>
<text text-anchor="middle" x="1286" y="-21533.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1286" y="-21522.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep4_tp0&#45;&gt;stage2_ln2_dp0_ep4_tp0 -->
<g id="edge202" class="edge">
<title>stage2_expert_agg_dp0_ep4_tp0&#45;&gt;stage2_ln2_dp0_ep4_tp0</title>
<path fill="none" stroke="black" d="M1286,-21625.91C1286,-21609.96 1286,-21592.73 1286,-21578.13"/>
<polygon fill="black" stroke="black" points="1289.5,-21578.02 1286,-21568.02 1282.5,-21578.02 1289.5,-21578.02"/>
</g>
<!-- stage2_ln1_dp0_ep5_tp0 -->
<g id="node184" class="node">
<title>stage2_ln1_dp0_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1400.5,-21457.96 1171.5,-21457.96 1171.5,-21405.96 1400.5,-21405.96 1400.5,-21457.96"/>
<text text-anchor="middle" x="1286" y="-21445.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1286" y="-21434.96" font-family="Times,serif" font-size="10.00">GPU 26</text>
<text text-anchor="middle" x="1286" y="-21423.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1286" y="-21412.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep4_tp0&#45;&gt;stage2_ln1_dp0_ep5_tp0 -->
<g id="edge203" class="edge">
<title>stage2_ln2_dp0_ep4_tp0&#45;&gt;stage2_ln1_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M1286,-21515.91C1286,-21501.83 1286,-21484.03 1286,-21468.53"/>
<polygon fill="black" stroke="black" points="1289.5,-21468.24 1286,-21458.24 1282.5,-21468.24 1289.5,-21468.24"/>
</g>
<!-- stage2_mha_dp0_ep4_tp1 -->
<g id="node178" class="node">
<title>stage2_mha_dp0_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1911.5,-22140.96 1682.5,-22140.96 1682.5,-22088.96 1911.5,-22088.96 1911.5,-22140.96"/>
<text text-anchor="middle" x="1797" y="-22128.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1797" y="-22117.96" font-family="Times,serif" font-size="10.00">GPU 25</text>
<text text-anchor="middle" x="1797" y="-22106.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1797" y="-22095.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep4_tp1&#45;&gt;stage2_mha_dp0_ep4_tp1 -->
<g id="edge204" class="edge">
<title>stage2_ln1_dp0_ep4_tp1&#45;&gt;stage2_mha_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M1797,-22203.88C1797,-22188.37 1797,-22168.23 1797,-22151.14"/>
<polygon fill="black" stroke="black" points="1800.5,-22150.97 1797,-22140.97 1793.5,-22150.97 1800.5,-22150.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep4_tp1 -->
<g id="node179" class="node">
<title>stage2_moe_gate_dp0_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2041.85,-22011.96 1652.35,-22011.96 1552.15,-21907.96 1941.65,-21907.96 2041.85,-22011.96"/>
<text text-anchor="middle" x="1797" y="-21973.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1797" y="-21962.96" font-family="Times,serif" font-size="10.00">GPU 25</text>
<text text-anchor="middle" x="1797" y="-21951.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1797" y="-21940.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep4_tp1&#45;&gt;stage2_moe_gate_dp0_ep4_tp1 -->
<g id="edge205" class="edge">
<title>stage2_mha_dp0_ep4_tp1&#45;&gt;stage2_moe_gate_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M1797,-22088.69C1797,-22070.58 1797,-22045.37 1797,-22022.13"/>
<polygon fill="black" stroke="black" points="1800.5,-22021.97 1797,-22011.97 1793.5,-22021.97 1800.5,-22021.97"/>
</g>
<!-- stage2_expert1_dp0_ep4_tp1 -->
<g id="node180" class="node">
<title>stage2_expert1_dp0_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1787.5,-21844.96 1552.5,-21844.96 1552.5,-21792.96 1787.5,-21792.96 1787.5,-21844.96"/>
<text text-anchor="middle" x="1670" y="-21832.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1670" y="-21821.96" font-family="Times,serif" font-size="10.00">GPU 25</text>
<text text-anchor="middle" x="1670" y="-21810.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1670" y="-21799.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep4_tp1&#45;&gt;stage2_expert1_dp0_ep4_tp1 -->
<g id="edge206" class="edge">
<title>stage2_moe_gate_dp0_ep4_tp1&#45;&gt;stage2_expert1_dp0_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1750.07,-21907.59C1733.31,-21889.25 1714.9,-21869.09 1699.96,-21852.74"/>
<polygon fill="black" stroke="black" points="1702.25,-21850.07 1692.92,-21845.05 1697.08,-21854.79 1702.25,-21850.07"/>
</g>
<!-- stage2_expert2_dp0_ep4_tp1 -->
<g id="node181" class="node">
<title>stage2_expert2_dp0_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2040.5,-21844.96 1805.5,-21844.96 1805.5,-21792.96 2040.5,-21792.96 2040.5,-21844.96"/>
<text text-anchor="middle" x="1923" y="-21832.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1923" y="-21821.96" font-family="Times,serif" font-size="10.00">GPU 25</text>
<text text-anchor="middle" x="1923" y="-21810.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1923" y="-21799.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep4_tp1&#45;&gt;stage2_expert2_dp0_ep4_tp1 -->
<g id="edge207" class="edge">
<title>stage2_moe_gate_dp0_ep4_tp1&#45;&gt;stage2_expert2_dp0_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1843.56,-21907.59C1860.19,-21889.25 1878.46,-21869.09 1893.28,-21852.74"/>
<polygon fill="black" stroke="black" points="1896.13,-21854.81 1900.26,-21845.05 1890.95,-21850.1 1896.13,-21854.81"/>
</g>
<!-- stage2_expert_agg_dp0_ep4_tp1 -->
<g id="node182" class="node">
<title>stage2_expert_agg_dp0_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2030.33,-21729.96 1652.79,-21729.96 1555.67,-21625.96 1933.21,-21625.96 2030.33,-21729.96"/>
<text text-anchor="middle" x="1793" y="-21691.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1793" y="-21680.96" font-family="Times,serif" font-size="10.00">GPU 25</text>
<text text-anchor="middle" x="1793" y="-21669.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1793" y="-21658.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep4_tp1&#45;&gt;stage2_expert_agg_dp0_ep4_tp1 -->
<g id="edge208" class="edge">
<title>stage2_expert1_dp0_ep4_tp1&#45;&gt;stage2_expert_agg_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M1692.27,-21792.79C1705.9,-21777.38 1723.94,-21757 1740.99,-21737.74"/>
<polygon fill="black" stroke="black" points="1743.7,-21739.95 1747.71,-21730.14 1738.46,-21735.31 1743.7,-21739.95"/>
</g>
<!-- stage2_expert2_dp0_ep4_tp1&#45;&gt;stage2_expert_agg_dp0_ep4_tp1 -->
<g id="edge209" class="edge">
<title>stage2_expert2_dp0_ep4_tp1&#45;&gt;stage2_expert_agg_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M1899.46,-21792.79C1884.99,-21777.32 1865.82,-21756.82 1847.73,-21737.48"/>
<polygon fill="black" stroke="black" points="1850.26,-21735.05 1840.87,-21730.14 1845.14,-21739.83 1850.26,-21735.05"/>
</g>
<!-- stage2_ln2_dp0_ep4_tp1 -->
<g id="node183" class="node">
<title>stage2_ln2_dp0_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1907.5,-21567.96 1678.5,-21567.96 1678.5,-21515.96 1907.5,-21515.96 1907.5,-21567.96"/>
<text text-anchor="middle" x="1793" y="-21555.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1793" y="-21544.96" font-family="Times,serif" font-size="10.00">GPU 25</text>
<text text-anchor="middle" x="1793" y="-21533.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1793" y="-21522.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep4_tp1&#45;&gt;stage2_ln2_dp0_ep4_tp1 -->
<g id="edge210" class="edge">
<title>stage2_expert_agg_dp0_ep4_tp1&#45;&gt;stage2_ln2_dp0_ep4_tp1</title>
<path fill="none" stroke="black" d="M1793,-21625.91C1793,-21609.96 1793,-21592.73 1793,-21578.13"/>
<polygon fill="black" stroke="black" points="1796.5,-21578.02 1793,-21568.02 1789.5,-21578.02 1796.5,-21578.02"/>
</g>
<!-- stage2_ln1_dp0_ep5_tp1 -->
<g id="node191" class="node">
<title>stage2_ln1_dp0_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1907.5,-21457.96 1678.5,-21457.96 1678.5,-21405.96 1907.5,-21405.96 1907.5,-21457.96"/>
<text text-anchor="middle" x="1793" y="-21445.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1793" y="-21434.96" font-family="Times,serif" font-size="10.00">GPU 27</text>
<text text-anchor="middle" x="1793" y="-21423.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1793" y="-21412.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep4_tp1&#45;&gt;stage2_ln1_dp0_ep5_tp1 -->
<g id="edge211" class="edge">
<title>stage2_ln2_dp0_ep4_tp1&#45;&gt;stage2_ln1_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M1793,-21515.91C1793,-21501.83 1793,-21484.03 1793,-21468.53"/>
<polygon fill="black" stroke="black" points="1796.5,-21468.24 1793,-21458.24 1789.5,-21468.24 1796.5,-21468.24"/>
</g>
<!-- stage2_mha_dp0_ep5_tp0 -->
<g id="node185" class="node">
<title>stage2_mha_dp0_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1400.5,-21342.96 1171.5,-21342.96 1171.5,-21290.96 1400.5,-21290.96 1400.5,-21342.96"/>
<text text-anchor="middle" x="1286" y="-21330.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1286" y="-21319.96" font-family="Times,serif" font-size="10.00">GPU 26</text>
<text text-anchor="middle" x="1286" y="-21308.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1286" y="-21297.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep5_tp0&#45;&gt;stage2_mha_dp0_ep5_tp0 -->
<g id="edge212" class="edge">
<title>stage2_ln1_dp0_ep5_tp0&#45;&gt;stage2_mha_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M1286,-21405.88C1286,-21390.37 1286,-21370.23 1286,-21353.14"/>
<polygon fill="black" stroke="black" points="1289.5,-21352.97 1286,-21342.97 1282.5,-21352.97 1289.5,-21352.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep5_tp0 -->
<g id="node186" class="node">
<title>stage2_moe_gate_dp0_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1530.85,-21213.96 1141.35,-21213.96 1041.15,-21109.96 1430.65,-21109.96 1530.85,-21213.96"/>
<text text-anchor="middle" x="1286" y="-21175.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1286" y="-21164.96" font-family="Times,serif" font-size="10.00">GPU 26</text>
<text text-anchor="middle" x="1286" y="-21153.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1286" y="-21142.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep5_tp0&#45;&gt;stage2_moe_gate_dp0_ep5_tp0 -->
<g id="edge213" class="edge">
<title>stage2_mha_dp0_ep5_tp0&#45;&gt;stage2_moe_gate_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M1286,-21290.69C1286,-21272.58 1286,-21247.37 1286,-21224.13"/>
<polygon fill="black" stroke="black" points="1289.5,-21223.97 1286,-21213.97 1282.5,-21223.97 1289.5,-21223.97"/>
</g>
<!-- stage2_expert1_dp0_ep5_tp0 -->
<g id="node187" class="node">
<title>stage2_expert1_dp0_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1277.5,-21046.96 1042.5,-21046.96 1042.5,-20994.96 1277.5,-20994.96 1277.5,-21046.96"/>
<text text-anchor="middle" x="1160" y="-21034.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1160" y="-21023.96" font-family="Times,serif" font-size="10.00">GPU 26</text>
<text text-anchor="middle" x="1160" y="-21012.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1160" y="-21001.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep5_tp0&#45;&gt;stage2_expert1_dp0_ep5_tp0 -->
<g id="edge214" class="edge">
<title>stage2_moe_gate_dp0_ep5_tp0&#45;&gt;stage2_expert1_dp0_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1239.44,-21109.59C1222.81,-21091.25 1204.54,-21071.09 1189.72,-21054.74"/>
<polygon fill="black" stroke="black" points="1192.05,-21052.1 1182.74,-21047.05 1186.87,-21056.81 1192.05,-21052.1"/>
</g>
<!-- stage2_expert2_dp0_ep5_tp0 -->
<g id="node188" class="node">
<title>stage2_expert2_dp0_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1530.5,-21046.96 1295.5,-21046.96 1295.5,-20994.96 1530.5,-20994.96 1530.5,-21046.96"/>
<text text-anchor="middle" x="1413" y="-21034.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1413" y="-21023.96" font-family="Times,serif" font-size="10.00">GPU 26</text>
<text text-anchor="middle" x="1413" y="-21012.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1413" y="-21001.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep5_tp0&#45;&gt;stage2_expert2_dp0_ep5_tp0 -->
<g id="edge215" class="edge">
<title>stage2_moe_gate_dp0_ep5_tp0&#45;&gt;stage2_expert2_dp0_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1332.93,-21109.59C1349.69,-21091.25 1368.1,-21071.09 1383.04,-21054.74"/>
<polygon fill="black" stroke="black" points="1385.92,-21056.79 1390.08,-21047.05 1380.75,-21052.07 1385.92,-21056.79"/>
</g>
<!-- stage2_expert_agg_dp0_ep5_tp0 -->
<g id="node189" class="node">
<title>stage2_expert_agg_dp0_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1519.33,-20931.96 1141.79,-20931.96 1044.67,-20827.96 1422.21,-20827.96 1519.33,-20931.96"/>
<text text-anchor="middle" x="1282" y="-20893.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1282" y="-20882.96" font-family="Times,serif" font-size="10.00">GPU 26</text>
<text text-anchor="middle" x="1282" y="-20871.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1282" y="-20860.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep5_tp0&#45;&gt;stage2_expert_agg_dp0_ep5_tp0 -->
<g id="edge216" class="edge">
<title>stage2_expert1_dp0_ep5_tp0&#45;&gt;stage2_expert_agg_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M1182.09,-20994.79C1195.61,-20979.38 1213.5,-20959 1230.41,-20939.74"/>
<polygon fill="black" stroke="black" points="1233.11,-20941.96 1237.08,-20932.14 1227.85,-20937.35 1233.11,-20941.96"/>
</g>
<!-- stage2_expert2_dp0_ep5_tp0&#45;&gt;stage2_expert_agg_dp0_ep5_tp0 -->
<g id="edge217" class="edge">
<title>stage2_expert2_dp0_ep5_tp0&#45;&gt;stage2_expert_agg_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M1389.28,-20994.79C1374.7,-20979.32 1355.38,-20958.82 1337.16,-20939.48"/>
<polygon fill="black" stroke="black" points="1339.64,-20937.02 1330.24,-20932.14 1334.55,-20941.82 1339.64,-20937.02"/>
</g>
<!-- stage2_ln2_dp0_ep5_tp0 -->
<g id="node190" class="node">
<title>stage2_ln2_dp0_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1396.5,-20769.96 1167.5,-20769.96 1167.5,-20717.96 1396.5,-20717.96 1396.5,-20769.96"/>
<text text-anchor="middle" x="1282" y="-20757.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1282" y="-20746.96" font-family="Times,serif" font-size="10.00">GPU 26</text>
<text text-anchor="middle" x="1282" y="-20735.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1282" y="-20724.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep5_tp0&#45;&gt;stage2_ln2_dp0_ep5_tp0 -->
<g id="edge218" class="edge">
<title>stage2_expert_agg_dp0_ep5_tp0&#45;&gt;stage2_ln2_dp0_ep5_tp0</title>
<path fill="none" stroke="black" d="M1282,-20827.91C1282,-20811.96 1282,-20794.73 1282,-20780.13"/>
<polygon fill="black" stroke="black" points="1285.5,-20780.02 1282,-20770.02 1278.5,-20780.02 1285.5,-20780.02"/>
</g>
<!-- stage2_ln1_dp0_ep6_tp0 -->
<g id="node198" class="node">
<title>stage2_ln1_dp0_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1396.5,-20659.96 1167.5,-20659.96 1167.5,-20607.96 1396.5,-20607.96 1396.5,-20659.96"/>
<text text-anchor="middle" x="1282" y="-20647.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1282" y="-20636.96" font-family="Times,serif" font-size="10.00">GPU 28</text>
<text text-anchor="middle" x="1282" y="-20625.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1282" y="-20614.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep5_tp0&#45;&gt;stage2_ln1_dp0_ep6_tp0 -->
<g id="edge219" class="edge">
<title>stage2_ln2_dp0_ep5_tp0&#45;&gt;stage2_ln1_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M1282,-20717.91C1282,-20703.83 1282,-20686.03 1282,-20670.53"/>
<polygon fill="black" stroke="black" points="1285.5,-20670.24 1282,-20660.24 1278.5,-20670.24 1285.5,-20670.24"/>
</g>
<!-- stage2_mha_dp0_ep5_tp1 -->
<g id="node192" class="node">
<title>stage2_mha_dp0_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1907.5,-21342.96 1678.5,-21342.96 1678.5,-21290.96 1907.5,-21290.96 1907.5,-21342.96"/>
<text text-anchor="middle" x="1793" y="-21330.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1793" y="-21319.96" font-family="Times,serif" font-size="10.00">GPU 27</text>
<text text-anchor="middle" x="1793" y="-21308.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1793" y="-21297.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep5_tp1&#45;&gt;stage2_mha_dp0_ep5_tp1 -->
<g id="edge220" class="edge">
<title>stage2_ln1_dp0_ep5_tp1&#45;&gt;stage2_mha_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M1793,-21405.88C1793,-21390.37 1793,-21370.23 1793,-21353.14"/>
<polygon fill="black" stroke="black" points="1796.5,-21352.97 1793,-21342.97 1789.5,-21352.97 1796.5,-21352.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep5_tp1 -->
<g id="node193" class="node">
<title>stage2_moe_gate_dp0_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2037.85,-21213.96 1648.35,-21213.96 1548.15,-21109.96 1937.65,-21109.96 2037.85,-21213.96"/>
<text text-anchor="middle" x="1793" y="-21175.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1793" y="-21164.96" font-family="Times,serif" font-size="10.00">GPU 27</text>
<text text-anchor="middle" x="1793" y="-21153.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1793" y="-21142.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep5_tp1&#45;&gt;stage2_moe_gate_dp0_ep5_tp1 -->
<g id="edge221" class="edge">
<title>stage2_mha_dp0_ep5_tp1&#45;&gt;stage2_moe_gate_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M1793,-21290.69C1793,-21272.58 1793,-21247.37 1793,-21224.13"/>
<polygon fill="black" stroke="black" points="1796.5,-21223.97 1793,-21213.97 1789.5,-21223.97 1796.5,-21223.97"/>
</g>
<!-- stage2_expert1_dp0_ep5_tp1 -->
<g id="node194" class="node">
<title>stage2_expert1_dp0_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1783.5,-21046.96 1548.5,-21046.96 1548.5,-20994.96 1783.5,-20994.96 1783.5,-21046.96"/>
<text text-anchor="middle" x="1666" y="-21034.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1666" y="-21023.96" font-family="Times,serif" font-size="10.00">GPU 27</text>
<text text-anchor="middle" x="1666" y="-21012.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1666" y="-21001.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep5_tp1&#45;&gt;stage2_expert1_dp0_ep5_tp1 -->
<g id="edge222" class="edge">
<title>stage2_moe_gate_dp0_ep5_tp1&#45;&gt;stage2_expert1_dp0_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1746.07,-21109.59C1729.31,-21091.25 1710.9,-21071.09 1695.96,-21054.74"/>
<polygon fill="black" stroke="black" points="1698.25,-21052.07 1688.92,-21047.05 1693.08,-21056.79 1698.25,-21052.07"/>
</g>
<!-- stage2_expert2_dp0_ep5_tp1 -->
<g id="node195" class="node">
<title>stage2_expert2_dp0_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2036.5,-21046.96 1801.5,-21046.96 1801.5,-20994.96 2036.5,-20994.96 2036.5,-21046.96"/>
<text text-anchor="middle" x="1919" y="-21034.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1919" y="-21023.96" font-family="Times,serif" font-size="10.00">GPU 27</text>
<text text-anchor="middle" x="1919" y="-21012.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1919" y="-21001.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep5_tp1&#45;&gt;stage2_expert2_dp0_ep5_tp1 -->
<g id="edge223" class="edge">
<title>stage2_moe_gate_dp0_ep5_tp1&#45;&gt;stage2_expert2_dp0_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1839.56,-21109.59C1856.19,-21091.25 1874.46,-21071.09 1889.28,-21054.74"/>
<polygon fill="black" stroke="black" points="1892.13,-21056.81 1896.26,-21047.05 1886.95,-21052.1 1892.13,-21056.81"/>
</g>
<!-- stage2_expert_agg_dp0_ep5_tp1 -->
<g id="node196" class="node">
<title>stage2_expert_agg_dp0_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2026.33,-20931.96 1648.79,-20931.96 1551.67,-20827.96 1929.21,-20827.96 2026.33,-20931.96"/>
<text text-anchor="middle" x="1789" y="-20893.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1789" y="-20882.96" font-family="Times,serif" font-size="10.00">GPU 27</text>
<text text-anchor="middle" x="1789" y="-20871.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1789" y="-20860.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep5_tp1&#45;&gt;stage2_expert_agg_dp0_ep5_tp1 -->
<g id="edge224" class="edge">
<title>stage2_expert1_dp0_ep5_tp1&#45;&gt;stage2_expert_agg_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M1688.27,-20994.79C1701.9,-20979.38 1719.94,-20959 1736.99,-20939.74"/>
<polygon fill="black" stroke="black" points="1739.7,-20941.95 1743.71,-20932.14 1734.46,-20937.31 1739.7,-20941.95"/>
</g>
<!-- stage2_expert2_dp0_ep5_tp1&#45;&gt;stage2_expert_agg_dp0_ep5_tp1 -->
<g id="edge225" class="edge">
<title>stage2_expert2_dp0_ep5_tp1&#45;&gt;stage2_expert_agg_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M1895.46,-20994.79C1880.99,-20979.32 1861.82,-20958.82 1843.73,-20939.48"/>
<polygon fill="black" stroke="black" points="1846.26,-20937.05 1836.87,-20932.14 1841.14,-20941.83 1846.26,-20937.05"/>
</g>
<!-- stage2_ln2_dp0_ep5_tp1 -->
<g id="node197" class="node">
<title>stage2_ln2_dp0_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1903.5,-20769.96 1674.5,-20769.96 1674.5,-20717.96 1903.5,-20717.96 1903.5,-20769.96"/>
<text text-anchor="middle" x="1789" y="-20757.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1789" y="-20746.96" font-family="Times,serif" font-size="10.00">GPU 27</text>
<text text-anchor="middle" x="1789" y="-20735.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1789" y="-20724.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep5_tp1&#45;&gt;stage2_ln2_dp0_ep5_tp1 -->
<g id="edge226" class="edge">
<title>stage2_expert_agg_dp0_ep5_tp1&#45;&gt;stage2_ln2_dp0_ep5_tp1</title>
<path fill="none" stroke="black" d="M1789,-20827.91C1789,-20811.96 1789,-20794.73 1789,-20780.13"/>
<polygon fill="black" stroke="black" points="1792.5,-20780.02 1789,-20770.02 1785.5,-20780.02 1792.5,-20780.02"/>
</g>
<!-- stage2_ln1_dp0_ep6_tp1 -->
<g id="node205" class="node">
<title>stage2_ln1_dp0_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1903.5,-20659.96 1674.5,-20659.96 1674.5,-20607.96 1903.5,-20607.96 1903.5,-20659.96"/>
<text text-anchor="middle" x="1789" y="-20647.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1789" y="-20636.96" font-family="Times,serif" font-size="10.00">GPU 29</text>
<text text-anchor="middle" x="1789" y="-20625.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1789" y="-20614.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep5_tp1&#45;&gt;stage2_ln1_dp0_ep6_tp1 -->
<g id="edge227" class="edge">
<title>stage2_ln2_dp0_ep5_tp1&#45;&gt;stage2_ln1_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M1789,-20717.91C1789,-20703.83 1789,-20686.03 1789,-20670.53"/>
<polygon fill="black" stroke="black" points="1792.5,-20670.24 1789,-20660.24 1785.5,-20670.24 1792.5,-20670.24"/>
</g>
<!-- stage2_mha_dp0_ep6_tp0 -->
<g id="node199" class="node">
<title>stage2_mha_dp0_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1396.5,-20544.96 1167.5,-20544.96 1167.5,-20492.96 1396.5,-20492.96 1396.5,-20544.96"/>
<text text-anchor="middle" x="1282" y="-20532.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1282" y="-20521.96" font-family="Times,serif" font-size="10.00">GPU 28</text>
<text text-anchor="middle" x="1282" y="-20510.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1282" y="-20499.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep6_tp0&#45;&gt;stage2_mha_dp0_ep6_tp0 -->
<g id="edge228" class="edge">
<title>stage2_ln1_dp0_ep6_tp0&#45;&gt;stage2_mha_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M1282,-20607.88C1282,-20592.37 1282,-20572.23 1282,-20555.14"/>
<polygon fill="black" stroke="black" points="1285.5,-20554.97 1282,-20544.97 1278.5,-20554.97 1285.5,-20554.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep6_tp0 -->
<g id="node200" class="node">
<title>stage2_moe_gate_dp0_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1526.85,-20415.96 1137.35,-20415.96 1037.15,-20311.96 1426.65,-20311.96 1526.85,-20415.96"/>
<text text-anchor="middle" x="1282" y="-20377.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1282" y="-20366.96" font-family="Times,serif" font-size="10.00">GPU 28</text>
<text text-anchor="middle" x="1282" y="-20355.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1282" y="-20344.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep6_tp0&#45;&gt;stage2_moe_gate_dp0_ep6_tp0 -->
<g id="edge229" class="edge">
<title>stage2_mha_dp0_ep6_tp0&#45;&gt;stage2_moe_gate_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M1282,-20492.69C1282,-20474.58 1282,-20449.37 1282,-20426.13"/>
<polygon fill="black" stroke="black" points="1285.5,-20425.97 1282,-20415.97 1278.5,-20425.97 1285.5,-20425.97"/>
</g>
<!-- stage2_expert1_dp0_ep6_tp0 -->
<g id="node201" class="node">
<title>stage2_expert1_dp0_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1273.5,-20248.96 1038.5,-20248.96 1038.5,-20196.96 1273.5,-20196.96 1273.5,-20248.96"/>
<text text-anchor="middle" x="1156" y="-20236.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1156" y="-20225.96" font-family="Times,serif" font-size="10.00">GPU 28</text>
<text text-anchor="middle" x="1156" y="-20214.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1156" y="-20203.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep6_tp0&#45;&gt;stage2_expert1_dp0_ep6_tp0 -->
<g id="edge230" class="edge">
<title>stage2_moe_gate_dp0_ep6_tp0&#45;&gt;stage2_expert1_dp0_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1235.44,-20311.59C1218.81,-20293.25 1200.54,-20273.09 1185.72,-20256.74"/>
<polygon fill="black" stroke="black" points="1188.05,-20254.1 1178.74,-20249.05 1182.87,-20258.81 1188.05,-20254.1"/>
</g>
<!-- stage2_expert2_dp0_ep6_tp0 -->
<g id="node202" class="node">
<title>stage2_expert2_dp0_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1526.5,-20248.96 1291.5,-20248.96 1291.5,-20196.96 1526.5,-20196.96 1526.5,-20248.96"/>
<text text-anchor="middle" x="1409" y="-20236.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1409" y="-20225.96" font-family="Times,serif" font-size="10.00">GPU 28</text>
<text text-anchor="middle" x="1409" y="-20214.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1409" y="-20203.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep6_tp0&#45;&gt;stage2_expert2_dp0_ep6_tp0 -->
<g id="edge231" class="edge">
<title>stage2_moe_gate_dp0_ep6_tp0&#45;&gt;stage2_expert2_dp0_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1328.93,-20311.59C1345.69,-20293.25 1364.1,-20273.09 1379.04,-20256.74"/>
<polygon fill="black" stroke="black" points="1381.92,-20258.79 1386.08,-20249.05 1376.75,-20254.07 1381.92,-20258.79"/>
</g>
<!-- stage2_expert_agg_dp0_ep6_tp0 -->
<g id="node203" class="node">
<title>stage2_expert_agg_dp0_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1511.33,-20133.96 1133.79,-20133.96 1036.67,-20029.96 1414.21,-20029.96 1511.33,-20133.96"/>
<text text-anchor="middle" x="1274" y="-20095.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1274" y="-20084.96" font-family="Times,serif" font-size="10.00">GPU 28</text>
<text text-anchor="middle" x="1274" y="-20073.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1274" y="-20062.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep6_tp0&#45;&gt;stage2_expert_agg_dp0_ep6_tp0 -->
<g id="edge232" class="edge">
<title>stage2_expert1_dp0_ep6_tp0&#45;&gt;stage2_expert_agg_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M1177.37,-20196.79C1190.39,-20181.45 1207.6,-20161.18 1223.88,-20141.99"/>
<polygon fill="black" stroke="black" points="1226.75,-20144.03 1230.55,-20134.14 1221.41,-20139.5 1226.75,-20144.03"/>
</g>
<!-- stage2_expert2_dp0_ep6_tp0&#45;&gt;stage2_expert_agg_dp0_ep6_tp0 -->
<g id="edge233" class="edge">
<title>stage2_expert2_dp0_ep6_tp0&#45;&gt;stage2_expert_agg_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M1384.55,-20196.79C1369.53,-20181.32 1349.62,-20160.82 1330.84,-20141.48"/>
<polygon fill="black" stroke="black" points="1333.19,-20138.87 1323.71,-20134.14 1328.17,-20143.75 1333.19,-20138.87"/>
</g>
<!-- stage2_ln2_dp0_ep6_tp0 -->
<g id="node204" class="node">
<title>stage2_ln2_dp0_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1381.5,-19971.96 1152.5,-19971.96 1152.5,-19919.96 1381.5,-19919.96 1381.5,-19971.96"/>
<text text-anchor="middle" x="1267" y="-19959.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1267" y="-19948.96" font-family="Times,serif" font-size="10.00">GPU 28</text>
<text text-anchor="middle" x="1267" y="-19937.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1267" y="-19926.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep6_tp0&#45;&gt;stage2_ln2_dp0_ep6_tp0 -->
<g id="edge234" class="edge">
<title>stage2_expert_agg_dp0_ep6_tp0&#45;&gt;stage2_ln2_dp0_ep6_tp0</title>
<path fill="none" stroke="black" d="M1271.33,-20029.91C1270.5,-20013.96 1269.6,-19996.73 1268.84,-19982.13"/>
<polygon fill="black" stroke="black" points="1272.33,-19981.82 1268.31,-19972.02 1265.34,-19982.19 1272.33,-19981.82"/>
</g>
<!-- stage2_ln1_dp0_ep7_tp0 -->
<g id="node212" class="node">
<title>stage2_ln1_dp0_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1371.5,-19858.97 1142.5,-19858.97 1142.5,-19806.97 1371.5,-19806.97 1371.5,-19858.97"/>
<text text-anchor="middle" x="1257" y="-19846.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1257" y="-19835.97" font-family="Times,serif" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1257" y="-19824.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1257" y="-19813.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep6_tp0&#45;&gt;stage2_ln1_dp0_ep7_tp0 -->
<g id="edge235" class="edge">
<title>stage2_ln2_dp0_ep6_tp0&#45;&gt;stage2_ln1_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M1264.73,-19919.77C1263.39,-19904.87 1261.67,-19885.76 1260.19,-19869.37"/>
<polygon fill="black" stroke="black" points="1263.64,-19868.7 1259.26,-19859.05 1256.67,-19869.33 1263.64,-19868.7"/>
</g>
<!-- stage2_mha_dp0_ep6_tp1 -->
<g id="node206" class="node">
<title>stage2_mha_dp0_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1903.5,-20544.96 1674.5,-20544.96 1674.5,-20492.96 1903.5,-20492.96 1903.5,-20544.96"/>
<text text-anchor="middle" x="1789" y="-20532.96" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1789" y="-20521.96" font-family="Times,serif" font-size="10.00">GPU 29</text>
<text text-anchor="middle" x="1789" y="-20510.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1789" y="-20499.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep6_tp1&#45;&gt;stage2_mha_dp0_ep6_tp1 -->
<g id="edge236" class="edge">
<title>stage2_ln1_dp0_ep6_tp1&#45;&gt;stage2_mha_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M1789,-20607.88C1789,-20592.37 1789,-20572.23 1789,-20555.14"/>
<polygon fill="black" stroke="black" points="1792.5,-20554.97 1789,-20544.97 1785.5,-20554.97 1792.5,-20554.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep6_tp1 -->
<g id="node207" class="node">
<title>stage2_moe_gate_dp0_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2033.85,-20415.96 1644.35,-20415.96 1544.15,-20311.96 1933.65,-20311.96 2033.85,-20415.96"/>
<text text-anchor="middle" x="1789" y="-20377.96" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1789" y="-20366.96" font-family="Times,serif" font-size="10.00">GPU 29</text>
<text text-anchor="middle" x="1789" y="-20355.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1789" y="-20344.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep6_tp1&#45;&gt;stage2_moe_gate_dp0_ep6_tp1 -->
<g id="edge237" class="edge">
<title>stage2_mha_dp0_ep6_tp1&#45;&gt;stage2_moe_gate_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M1789,-20492.69C1789,-20474.58 1789,-20449.37 1789,-20426.13"/>
<polygon fill="black" stroke="black" points="1792.5,-20425.97 1789,-20415.97 1785.5,-20425.97 1792.5,-20425.97"/>
</g>
<!-- stage2_expert1_dp0_ep6_tp1 -->
<g id="node208" class="node">
<title>stage2_expert1_dp0_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1779.5,-20248.96 1544.5,-20248.96 1544.5,-20196.96 1779.5,-20196.96 1779.5,-20248.96"/>
<text text-anchor="middle" x="1662" y="-20236.96" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1662" y="-20225.96" font-family="Times,serif" font-size="10.00">GPU 29</text>
<text text-anchor="middle" x="1662" y="-20214.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1662" y="-20203.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep6_tp1&#45;&gt;stage2_expert1_dp0_ep6_tp1 -->
<g id="edge238" class="edge">
<title>stage2_moe_gate_dp0_ep6_tp1&#45;&gt;stage2_expert1_dp0_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1742.07,-20311.59C1725.31,-20293.25 1706.9,-20273.09 1691.96,-20256.74"/>
<polygon fill="black" stroke="black" points="1694.25,-20254.07 1684.92,-20249.05 1689.08,-20258.79 1694.25,-20254.07"/>
</g>
<!-- stage2_expert2_dp0_ep6_tp1 -->
<g id="node209" class="node">
<title>stage2_expert2_dp0_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2032.5,-20248.96 1797.5,-20248.96 1797.5,-20196.96 2032.5,-20196.96 2032.5,-20248.96"/>
<text text-anchor="middle" x="1915" y="-20236.96" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1915" y="-20225.96" font-family="Times,serif" font-size="10.00">GPU 29</text>
<text text-anchor="middle" x="1915" y="-20214.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1915" y="-20203.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep6_tp1&#45;&gt;stage2_expert2_dp0_ep6_tp1 -->
<g id="edge239" class="edge">
<title>stage2_moe_gate_dp0_ep6_tp1&#45;&gt;stage2_expert2_dp0_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1835.56,-20311.59C1852.19,-20293.25 1870.46,-20273.09 1885.28,-20256.74"/>
<polygon fill="black" stroke="black" points="1888.13,-20258.81 1892.26,-20249.05 1882.95,-20254.1 1888.13,-20258.81"/>
</g>
<!-- stage2_expert_agg_dp0_ep6_tp1 -->
<g id="node210" class="node">
<title>stage2_expert_agg_dp0_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2004.33,-20133.96 1626.79,-20133.96 1529.67,-20029.96 1907.21,-20029.96 2004.33,-20133.96"/>
<text text-anchor="middle" x="1767" y="-20095.96" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1767" y="-20084.96" font-family="Times,serif" font-size="10.00">GPU 29</text>
<text text-anchor="middle" x="1767" y="-20073.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1767" y="-20062.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep6_tp1&#45;&gt;stage2_expert_agg_dp0_ep6_tp1 -->
<g id="edge240" class="edge">
<title>stage2_expert1_dp0_ep6_tp1&#45;&gt;stage2_expert_agg_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M1681.01,-20196.79C1692.55,-20181.52 1707.78,-20161.36 1722.21,-20142.25"/>
<polygon fill="black" stroke="black" points="1725.1,-20144.23 1728.34,-20134.14 1719.52,-20140.01 1725.1,-20144.23"/>
</g>
<!-- stage2_expert2_dp0_ep6_tp1&#45;&gt;stage2_expert_agg_dp0_ep6_tp1 -->
<g id="edge241" class="edge">
<title>stage2_expert2_dp0_ep6_tp1&#45;&gt;stage2_expert_agg_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M1888.2,-20196.79C1871.65,-20181.25 1849.71,-20160.64 1829.04,-20141.22"/>
<polygon fill="black" stroke="black" points="1831.18,-20138.43 1821.5,-20134.14 1826.39,-20143.54 1831.18,-20138.43"/>
</g>
<!-- stage2_ln2_dp0_ep6_tp1 -->
<g id="node211" class="node">
<title>stage2_ln2_dp0_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1879.5,-19971.96 1650.5,-19971.96 1650.5,-19919.96 1879.5,-19919.96 1879.5,-19971.96"/>
<text text-anchor="middle" x="1765" y="-19959.96" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1765" y="-19948.96" font-family="Times,serif" font-size="10.00">GPU 29</text>
<text text-anchor="middle" x="1765" y="-19937.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1765" y="-19926.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep6_tp1&#45;&gt;stage2_ln2_dp0_ep6_tp1 -->
<g id="edge242" class="edge">
<title>stage2_expert_agg_dp0_ep6_tp1&#45;&gt;stage2_ln2_dp0_ep6_tp1</title>
<path fill="none" stroke="black" d="M1766.24,-20029.91C1766,-20013.96 1765.74,-19996.73 1765.52,-19982.13"/>
<polygon fill="black" stroke="black" points="1769.02,-19981.96 1765.37,-19972.02 1762.02,-19982.07 1769.02,-19981.96"/>
</g>
<!-- stage2_ln1_dp0_ep7_tp1 -->
<g id="node219" class="node">
<title>stage2_ln1_dp0_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1878.5,-19858.97 1649.5,-19858.97 1649.5,-19806.97 1878.5,-19806.97 1878.5,-19858.97"/>
<text text-anchor="middle" x="1764" y="-19846.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1764" y="-19835.97" font-family="Times,serif" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="1764" y="-19824.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1764" y="-19813.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep6_tp1&#45;&gt;stage2_ln1_dp0_ep7_tp1 -->
<g id="edge243" class="edge">
<title>stage2_ln2_dp0_ep6_tp1&#45;&gt;stage2_ln1_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M1764.77,-19919.77C1764.64,-19904.87 1764.47,-19885.76 1764.32,-19869.37"/>
<polygon fill="black" stroke="black" points="1767.82,-19869.02 1764.23,-19859.05 1760.82,-19869.08 1767.82,-19869.02"/>
</g>
<!-- stage2_mha_dp0_ep7_tp0 -->
<g id="node213" class="node">
<title>stage2_mha_dp0_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1371.5,-19743.97 1142.5,-19743.97 1142.5,-19691.97 1371.5,-19691.97 1371.5,-19743.97"/>
<text text-anchor="middle" x="1257" y="-19731.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1257" y="-19720.97" font-family="Times,serif" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1257" y="-19709.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1257" y="-19698.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep7_tp0&#45;&gt;stage2_mha_dp0_ep7_tp0 -->
<g id="edge244" class="edge">
<title>stage2_ln1_dp0_ep7_tp0&#45;&gt;stage2_mha_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M1257,-19806.89C1257,-19791.38 1257,-19771.24 1257,-19754.15"/>
<polygon fill="black" stroke="black" points="1260.5,-19753.97 1257,-19743.97 1253.5,-19753.97 1260.5,-19753.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep7_tp0 -->
<g id="node214" class="node">
<title>stage2_moe_gate_dp0_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1501.85,-19614.97 1112.35,-19614.97 1012.15,-19510.97 1401.65,-19510.97 1501.85,-19614.97"/>
<text text-anchor="middle" x="1257" y="-19576.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1257" y="-19565.97" font-family="Times,serif" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1257" y="-19554.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1257" y="-19543.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep7_tp0&#45;&gt;stage2_moe_gate_dp0_ep7_tp0 -->
<g id="edge245" class="edge">
<title>stage2_mha_dp0_ep7_tp0&#45;&gt;stage2_moe_gate_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M1257,-19691.7C1257,-19673.59 1257,-19648.38 1257,-19625.14"/>
<polygon fill="black" stroke="black" points="1260.5,-19624.98 1257,-19614.98 1253.5,-19624.98 1260.5,-19624.98"/>
</g>
<!-- stage2_expert1_dp0_ep7_tp0 -->
<g id="node215" class="node">
<title>stage2_expert1_dp0_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1248.5,-19447.97 1013.5,-19447.97 1013.5,-19395.97 1248.5,-19395.97 1248.5,-19447.97"/>
<text text-anchor="middle" x="1131" y="-19435.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1131" y="-19424.97" font-family="Times,serif" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1131" y="-19413.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1131" y="-19402.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep7_tp0&#45;&gt;stage2_expert1_dp0_ep7_tp0 -->
<g id="edge246" class="edge">
<title>stage2_moe_gate_dp0_ep7_tp0&#45;&gt;stage2_expert1_dp0_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1210.44,-19510.6C1193.81,-19492.26 1175.54,-19472.1 1160.72,-19455.75"/>
<polygon fill="black" stroke="black" points="1163.05,-19453.11 1153.74,-19448.05 1157.87,-19457.81 1163.05,-19453.11"/>
</g>
<!-- stage2_expert2_dp0_ep7_tp0 -->
<g id="node216" class="node">
<title>stage2_expert2_dp0_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1501.5,-19447.97 1266.5,-19447.97 1266.5,-19395.97 1501.5,-19395.97 1501.5,-19447.97"/>
<text text-anchor="middle" x="1384" y="-19435.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1384" y="-19424.97" font-family="Times,serif" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1384" y="-19413.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1384" y="-19402.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep7_tp0&#45;&gt;stage2_expert2_dp0_ep7_tp0 -->
<g id="edge247" class="edge">
<title>stage2_moe_gate_dp0_ep7_tp0&#45;&gt;stage2_expert2_dp0_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1303.93,-19510.6C1320.69,-19492.26 1339.1,-19472.1 1354.04,-19455.75"/>
<polygon fill="black" stroke="black" points="1356.92,-19457.8 1361.08,-19448.05 1351.75,-19453.08 1356.92,-19457.8"/>
</g>
<!-- stage2_expert_agg_dp0_ep7_tp0 -->
<g id="node217" class="node">
<title>stage2_expert_agg_dp0_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1501.33,-19332.97 1123.79,-19332.97 1026.67,-19228.97 1404.21,-19228.97 1501.33,-19332.97"/>
<text text-anchor="middle" x="1264" y="-19294.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1264" y="-19283.97" font-family="Times,serif" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1264" y="-19272.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1264" y="-19261.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep7_tp0&#45;&gt;stage2_expert_agg_dp0_ep7_tp0 -->
<g id="edge248" class="edge">
<title>stage2_expert1_dp0_ep7_tp0&#45;&gt;stage2_expert_agg_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M1155.09,-19395.79C1169.89,-19380.32 1189.5,-19359.82 1208,-19340.49"/>
<polygon fill="black" stroke="black" points="1210.64,-19342.79 1215.03,-19333.15 1205.58,-19337.95 1210.64,-19342.79"/>
</g>
<!-- stage2_expert2_dp0_ep7_tp0&#45;&gt;stage2_expert_agg_dp0_ep7_tp0 -->
<g id="edge249" class="edge">
<title>stage2_expert2_dp0_ep7_tp0&#45;&gt;stage2_expert_agg_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M1362.27,-19395.79C1348.97,-19380.39 1331.37,-19360.01 1314.74,-19340.74"/>
<polygon fill="black" stroke="black" points="1317.37,-19338.43 1308.19,-19333.15 1312.07,-19343 1317.37,-19338.43"/>
</g>
<!-- stage2_ln2_dp0_ep7_tp0 -->
<g id="node218" class="node">
<title>stage2_ln2_dp0_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1378.5,-19170.97 1149.5,-19170.97 1149.5,-19118.97 1378.5,-19118.97 1378.5,-19170.97"/>
<text text-anchor="middle" x="1264" y="-19158.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1264" y="-19147.97" font-family="Times,serif" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1264" y="-19136.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1264" y="-19125.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep7_tp0&#45;&gt;stage2_ln2_dp0_ep7_tp0 -->
<g id="edge250" class="edge">
<title>stage2_expert_agg_dp0_ep7_tp0&#45;&gt;stage2_ln2_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M1264,-19228.92C1264,-19212.97 1264,-19195.74 1264,-19181.14"/>
<polygon fill="black" stroke="black" points="1267.5,-19181.02 1264,-19171.02 1260.5,-19181.02 1267.5,-19181.02"/>
</g>
<!-- stage2_ln1_dp1_ep0_tp0 -->
<g id="node338" class="node">
<title>stage2_ln1_dp1_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1378.5,-19060.97 1149.5,-19060.97 1149.5,-19008.97 1378.5,-19008.97 1378.5,-19060.97"/>
<text text-anchor="middle" x="1264" y="-19048.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1264" y="-19037.97" font-family="Times,serif" font-size="10.00">GPU 80</text>
<text text-anchor="middle" x="1264" y="-19026.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1264" y="-19015.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep7_tp0&#45;&gt;stage2_ln1_dp1_ep0_tp0 -->
<g id="edge251" class="edge">
<title>stage2_ln2_dp0_ep7_tp0&#45;&gt;stage2_ln1_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M1264,-19118.92C1264,-19104.84 1264,-19087.04 1264,-19071.54"/>
<polygon fill="black" stroke="black" points="1267.5,-19071.25 1264,-19061.25 1260.5,-19071.25 1267.5,-19071.25"/>
</g>
<!-- stage2_mha_dp0_ep7_tp1 -->
<g id="node220" class="node">
<title>stage2_mha_dp0_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1878.5,-19743.97 1649.5,-19743.97 1649.5,-19691.97 1878.5,-19691.97 1878.5,-19743.97"/>
<text text-anchor="middle" x="1764" y="-19731.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1764" y="-19720.97" font-family="Times,serif" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="1764" y="-19709.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1764" y="-19698.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp0_ep7_tp1&#45;&gt;stage2_mha_dp0_ep7_tp1 -->
<g id="edge252" class="edge">
<title>stage2_ln1_dp0_ep7_tp1&#45;&gt;stage2_mha_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M1764,-19806.89C1764,-19791.38 1764,-19771.24 1764,-19754.15"/>
<polygon fill="black" stroke="black" points="1767.5,-19753.97 1764,-19743.97 1760.5,-19753.97 1767.5,-19753.97"/>
</g>
<!-- stage2_moe_gate_dp0_ep7_tp1 -->
<g id="node221" class="node">
<title>stage2_moe_gate_dp0_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2008.85,-19614.97 1619.35,-19614.97 1519.15,-19510.97 1908.65,-19510.97 2008.85,-19614.97"/>
<text text-anchor="middle" x="1764" y="-19576.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1764" y="-19565.97" font-family="Times,serif" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="1764" y="-19554.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1764" y="-19543.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp0_ep7_tp1&#45;&gt;stage2_moe_gate_dp0_ep7_tp1 -->
<g id="edge253" class="edge">
<title>stage2_mha_dp0_ep7_tp1&#45;&gt;stage2_moe_gate_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M1764,-19691.7C1764,-19673.59 1764,-19648.38 1764,-19625.14"/>
<polygon fill="black" stroke="black" points="1767.5,-19624.98 1764,-19614.98 1760.5,-19624.98 1767.5,-19624.98"/>
</g>
<!-- stage2_expert1_dp0_ep7_tp1 -->
<g id="node222" class="node">
<title>stage2_expert1_dp0_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1754.5,-19447.97 1519.5,-19447.97 1519.5,-19395.97 1754.5,-19395.97 1754.5,-19447.97"/>
<text text-anchor="middle" x="1637" y="-19435.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1637" y="-19424.97" font-family="Times,serif" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="1637" y="-19413.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1637" y="-19402.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep7_tp1&#45;&gt;stage2_expert1_dp0_ep7_tp1 -->
<g id="edge254" class="edge">
<title>stage2_moe_gate_dp0_ep7_tp1&#45;&gt;stage2_expert1_dp0_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1717.07,-19510.6C1700.31,-19492.26 1681.9,-19472.1 1666.96,-19455.75"/>
<polygon fill="black" stroke="black" points="1669.25,-19453.08 1659.92,-19448.05 1664.08,-19457.8 1669.25,-19453.08"/>
</g>
<!-- stage2_expert2_dp0_ep7_tp1 -->
<g id="node223" class="node">
<title>stage2_expert2_dp0_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2007.5,-19447.97 1772.5,-19447.97 1772.5,-19395.97 2007.5,-19395.97 2007.5,-19447.97"/>
<text text-anchor="middle" x="1890" y="-19435.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1890" y="-19424.97" font-family="Times,serif" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="1890" y="-19413.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1890" y="-19402.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp0_ep7_tp1&#45;&gt;stage2_expert2_dp0_ep7_tp1 -->
<g id="edge255" class="edge">
<title>stage2_moe_gate_dp0_ep7_tp1&#45;&gt;stage2_expert2_dp0_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1810.56,-19510.6C1827.19,-19492.26 1845.46,-19472.1 1860.28,-19455.75"/>
<polygon fill="black" stroke="black" points="1863.13,-19457.81 1867.26,-19448.05 1857.95,-19453.11 1863.13,-19457.81"/>
</g>
<!-- stage2_expert_agg_dp0_ep7_tp1 -->
<g id="node224" class="node">
<title>stage2_expert_agg_dp0_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2008.33,-19332.97 1630.79,-19332.97 1533.67,-19228.97 1911.21,-19228.97 2008.33,-19332.97"/>
<text text-anchor="middle" x="1771" y="-19294.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1771" y="-19283.97" font-family="Times,serif" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="1771" y="-19272.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1771" y="-19261.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp0_ep7_tp1&#45;&gt;stage2_expert_agg_dp0_ep7_tp1 -->
<g id="edge256" class="edge">
<title>stage2_expert1_dp0_ep7_tp1&#45;&gt;stage2_expert_agg_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M1661.27,-19395.79C1676.18,-19380.32 1695.94,-19359.82 1714.58,-19340.49"/>
<polygon fill="black" stroke="black" points="1717.24,-19342.78 1721.66,-19333.15 1712.2,-19337.92 1717.24,-19342.78"/>
</g>
<!-- stage2_expert2_dp0_ep7_tp1&#45;&gt;stage2_expert_agg_dp0_ep7_tp1 -->
<g id="edge257" class="edge">
<title>stage2_expert2_dp0_ep7_tp1&#45;&gt;stage2_expert_agg_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M1868.45,-19395.79C1855.26,-19380.39 1837.81,-19360.01 1821.32,-19340.74"/>
<polygon fill="black" stroke="black" points="1823.98,-19338.47 1814.82,-19333.15 1818.66,-19343.02 1823.98,-19338.47"/>
</g>
<!-- stage2_ln2_dp0_ep7_tp1 -->
<g id="node225" class="node">
<title>stage2_ln2_dp0_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1885.5,-19170.97 1656.5,-19170.97 1656.5,-19118.97 1885.5,-19118.97 1885.5,-19170.97"/>
<text text-anchor="middle" x="1771" y="-19158.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1771" y="-19147.97" font-family="Times,serif" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="1771" y="-19136.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1771" y="-19125.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp0_ep7_tp1&#45;&gt;stage2_ln2_dp0_ep7_tp1 -->
<g id="edge258" class="edge">
<title>stage2_expert_agg_dp0_ep7_tp1&#45;&gt;stage2_ln2_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M1771,-19228.92C1771,-19212.97 1771,-19195.74 1771,-19181.14"/>
<polygon fill="black" stroke="black" points="1774.5,-19181.02 1771,-19171.02 1767.5,-19181.02 1774.5,-19181.02"/>
</g>
<!-- stage2_ln1_dp1_ep0_tp1 -->
<g id="node345" class="node">
<title>stage2_ln1_dp1_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1885.5,-19060.97 1656.5,-19060.97 1656.5,-19008.97 1885.5,-19008.97 1885.5,-19060.97"/>
<text text-anchor="middle" x="1771" y="-19048.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1771" y="-19037.97" font-family="Times,serif" font-size="10.00">GPU 81</text>
<text text-anchor="middle" x="1771" y="-19026.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1771" y="-19015.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp0_ep7_tp1&#45;&gt;stage2_ln1_dp1_ep0_tp1 -->
<g id="edge259" class="edge">
<title>stage2_ln2_dp0_ep7_tp1&#45;&gt;stage2_ln1_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M1771,-19118.92C1771,-19104.84 1771,-19087.04 1771,-19071.54"/>
<polygon fill="black" stroke="black" points="1774.5,-19071.25 1771,-19061.25 1767.5,-19071.25 1774.5,-19071.25"/>
</g>
<!-- ln1_dp1_ep0_tp0 -->
<g id="node226" class="node">
<title>ln1_dp1_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2418.5,-19971.96 2189.5,-19971.96 2189.5,-19919.96 2418.5,-19919.96 2418.5,-19971.96"/>
<text text-anchor="middle" x="2304" y="-19959.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2304" y="-19948.96" font-family="Times,serif" font-size="10.00">GPU 64</text>
<text text-anchor="middle" x="2304" y="-19937.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2304" y="-19926.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- mha_dp1_ep0_tp0 -->
<g id="node227" class="node">
<title>mha_dp1_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2418.5,-19858.97 2189.5,-19858.97 2189.5,-19806.97 2418.5,-19806.97 2418.5,-19858.97"/>
<text text-anchor="middle" x="2304" y="-19846.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2304" y="-19835.97" font-family="Times,serif" font-size="10.00">GPU 64</text>
<text text-anchor="middle" x="2304" y="-19824.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2304" y="-19813.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep0_tp0&#45;&gt;mha_dp1_ep0_tp0 -->
<g id="edge260" class="edge">
<title>ln1_dp1_ep0_tp0&#45;&gt;mha_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M2304,-19919.77C2304,-19904.87 2304,-19885.76 2304,-19869.37"/>
<polygon fill="black" stroke="black" points="2307.5,-19869.05 2304,-19859.05 2300.5,-19869.05 2307.5,-19869.05"/>
</g>
<!-- moe_gate_dp1_ep0_tp0 -->
<g id="node228" class="node">
<title>moe_gate_dp1_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2548.85,-19769.97 2159.35,-19769.97 2059.15,-19665.97 2448.65,-19665.97 2548.85,-19769.97"/>
<text text-anchor="middle" x="2304" y="-19731.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2304" y="-19720.97" font-family="Times,serif" font-size="10.00">GPU 64</text>
<text text-anchor="middle" x="2304" y="-19709.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2304" y="-19698.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep0_tp0&#45;&gt;moe_gate_dp1_ep0_tp0 -->
<g id="edge261" class="edge">
<title>mha_dp1_ep0_tp0&#45;&gt;moe_gate_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M2304,-19806.89C2304,-19798.96 2304,-19789.82 2304,-19780.5"/>
<polygon fill="black" stroke="black" points="2307.5,-19780.37 2304,-19770.37 2300.5,-19780.37 2307.5,-19780.37"/>
</g>
<!-- expert1_dp1_ep0_tp0 -->
<g id="node229" class="node">
<title>expert1_dp1_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2295.5,-19588.97 2060.5,-19588.97 2060.5,-19536.97 2295.5,-19536.97 2295.5,-19588.97"/>
<text text-anchor="middle" x="2178" y="-19576.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2178" y="-19565.97" font-family="Times,serif" font-size="10.00">GPU 64</text>
<text text-anchor="middle" x="2178" y="-19554.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2178" y="-19543.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep0_tp0&#45;&gt;expert1_dp1_ep0_tp0 -->
<g id="edge262" class="edge">
<title>moe_gate_dp1_ep0_tp0&#45;&gt;expert1_dp1_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2261.69,-19665.59C2243.09,-19643.01 2221.79,-19617.14 2205.33,-19597.15"/>
<polygon fill="black" stroke="black" points="2207.88,-19594.74 2198.82,-19589.25 2202.47,-19599.19 2207.88,-19594.74"/>
<text text-anchor="middle" x="2301.5" y="-19636.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep0_tp0 -->
<g id="node230" class="node">
<title>expert2_dp1_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2548.5,-19588.97 2313.5,-19588.97 2313.5,-19536.97 2548.5,-19536.97 2548.5,-19588.97"/>
<text text-anchor="middle" x="2431" y="-19576.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2431" y="-19565.97" font-family="Times,serif" font-size="10.00">GPU 64</text>
<text text-anchor="middle" x="2431" y="-19554.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2431" y="-19543.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep0_tp0&#45;&gt;expert2_dp1_ep0_tp0 -->
<g id="edge263" class="edge">
<title>moe_gate_dp1_ep0_tp0&#45;&gt;expert2_dp1_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2347.97,-19665.85C2353.06,-19659.84 2358.16,-19653.78 2363,-19647.97 2376.9,-19631.26 2392.14,-19612.48 2404.66,-19596.92"/>
<polygon fill="black" stroke="black" points="2407.41,-19599.09 2410.94,-19589.1 2401.95,-19594.71 2407.41,-19599.09"/>
<text text-anchor="middle" x="2431.5" y="-19636.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep0_tp0 -->
<g id="node231" class="node">
<title>expert_agg_dp1_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2536.33,-19473.97 2158.79,-19473.97 2061.67,-19369.97 2439.21,-19369.97 2536.33,-19473.97"/>
<text text-anchor="middle" x="2299" y="-19435.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2299" y="-19424.97" font-family="Times,serif" font-size="10.00">GPU 64</text>
<text text-anchor="middle" x="2299" y="-19413.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2299" y="-19402.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep0_tp0&#45;&gt;expert_agg_dp1_ep0_tp0 -->
<g id="edge264" class="edge">
<title>expert1_dp1_ep0_tp0&#45;&gt;expert_agg_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M2199.91,-19536.79C2213.32,-19521.39 2231.07,-19501.01 2247.83,-19481.74"/>
<polygon fill="black" stroke="black" points="2250.52,-19483.99 2254.45,-19474.15 2245.24,-19479.39 2250.52,-19483.99"/>
</g>
<!-- expert2_dp1_ep0_tp0&#45;&gt;expert_agg_dp1_ep0_tp0 -->
<g id="edge265" class="edge">
<title>expert2_dp1_ep0_tp0&#45;&gt;expert_agg_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M2407.1,-19536.79C2392.4,-19521.32 2372.94,-19500.82 2354.58,-19481.49"/>
<polygon fill="black" stroke="black" points="2357.03,-19478.99 2347.6,-19474.15 2351.95,-19483.81 2357.03,-19478.99"/>
</g>
<!-- ln2_dp1_ep0_tp0 -->
<g id="node232" class="node">
<title>ln2_dp1_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2413.5,-19306.97 2184.5,-19306.97 2184.5,-19254.97 2413.5,-19254.97 2413.5,-19306.97"/>
<text text-anchor="middle" x="2299" y="-19294.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2299" y="-19283.97" font-family="Times,serif" font-size="10.00">GPU 64</text>
<text text-anchor="middle" x="2299" y="-19272.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2299" y="-19261.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep0_tp0&#45;&gt;ln2_dp1_ep0_tp0 -->
<g id="edge266" class="edge">
<title>expert_agg_dp1_ep0_tp0&#45;&gt;ln2_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M2299,-19369.6C2299,-19352.26 2299,-19333.3 2299,-19317.46"/>
<polygon fill="black" stroke="black" points="2302.5,-19317.05 2299,-19307.05 2295.5,-19317.05 2302.5,-19317.05"/>
</g>
<!-- ln1_dp1_ep1_tp0 -->
<g id="node240" class="node">
<title>ln1_dp1_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2413.5,-19170.97 2184.5,-19170.97 2184.5,-19118.97 2413.5,-19118.97 2413.5,-19170.97"/>
<text text-anchor="middle" x="2299" y="-19158.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2299" y="-19147.97" font-family="Times,serif" font-size="10.00">GPU 66</text>
<text text-anchor="middle" x="2299" y="-19136.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2299" y="-19125.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep0_tp0&#45;&gt;ln1_dp1_ep1_tp0 -->
<g id="edge267" class="edge">
<title>ln2_dp1_ep0_tp0&#45;&gt;ln1_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M2299,-19254.76C2299,-19233.99 2299,-19204.28 2299,-19181.16"/>
<polygon fill="black" stroke="black" points="2302.5,-19181.06 2299,-19171.06 2295.5,-19181.06 2302.5,-19181.06"/>
</g>
<!-- ln1_dp1_ep0_tp1 -->
<g id="node233" class="node">
<title>ln1_dp1_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2925.5,-19971.96 2696.5,-19971.96 2696.5,-19919.96 2925.5,-19919.96 2925.5,-19971.96"/>
<text text-anchor="middle" x="2811" y="-19959.96" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2811" y="-19948.96" font-family="Times,serif" font-size="10.00">GPU 65</text>
<text text-anchor="middle" x="2811" y="-19937.96" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2811" y="-19926.96" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- mha_dp1_ep0_tp1 -->
<g id="node234" class="node">
<title>mha_dp1_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2925.5,-19858.97 2696.5,-19858.97 2696.5,-19806.97 2925.5,-19806.97 2925.5,-19858.97"/>
<text text-anchor="middle" x="2811" y="-19846.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2811" y="-19835.97" font-family="Times,serif" font-size="10.00">GPU 65</text>
<text text-anchor="middle" x="2811" y="-19824.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2811" y="-19813.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep0_tp1&#45;&gt;mha_dp1_ep0_tp1 -->
<g id="edge268" class="edge">
<title>ln1_dp1_ep0_tp1&#45;&gt;mha_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M2811,-19919.77C2811,-19904.87 2811,-19885.76 2811,-19869.37"/>
<polygon fill="black" stroke="black" points="2814.5,-19869.05 2811,-19859.05 2807.5,-19869.05 2814.5,-19869.05"/>
</g>
<!-- moe_gate_dp1_ep0_tp1 -->
<g id="node235" class="node">
<title>moe_gate_dp1_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3055.85,-19769.97 2666.35,-19769.97 2566.15,-19665.97 2955.65,-19665.97 3055.85,-19769.97"/>
<text text-anchor="middle" x="2811" y="-19731.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2811" y="-19720.97" font-family="Times,serif" font-size="10.00">GPU 65</text>
<text text-anchor="middle" x="2811" y="-19709.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2811" y="-19698.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep0_tp1&#45;&gt;moe_gate_dp1_ep0_tp1 -->
<g id="edge269" class="edge">
<title>mha_dp1_ep0_tp1&#45;&gt;moe_gate_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M2811,-19806.89C2811,-19798.96 2811,-19789.82 2811,-19780.5"/>
<polygon fill="black" stroke="black" points="2814.5,-19780.37 2811,-19770.37 2807.5,-19780.37 2814.5,-19780.37"/>
</g>
<!-- expert1_dp1_ep0_tp1 -->
<g id="node236" class="node">
<title>expert1_dp1_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2801.5,-19588.97 2566.5,-19588.97 2566.5,-19536.97 2801.5,-19536.97 2801.5,-19588.97"/>
<text text-anchor="middle" x="2684" y="-19576.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2684" y="-19565.97" font-family="Times,serif" font-size="10.00">GPU 65</text>
<text text-anchor="middle" x="2684" y="-19554.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2684" y="-19543.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep0_tp1&#45;&gt;expert1_dp1_ep0_tp1 -->
<g id="edge270" class="edge">
<title>moe_gate_dp1_ep0_tp1&#45;&gt;expert1_dp1_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2766.2,-19665.93C2761.03,-19659.91 2755.88,-19653.82 2751,-19647.97 2737.3,-19631.52 2722.42,-19612.94 2710.17,-19597.44"/>
<polygon fill="black" stroke="black" points="2712.6,-19594.87 2703.66,-19589.18 2707.1,-19599.2 2712.6,-19594.87"/>
<text text-anchor="middle" x="2808.5" y="-19636.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep0_tp1 -->
<g id="node237" class="node">
<title>expert2_dp1_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3054.5,-19588.97 2819.5,-19588.97 2819.5,-19536.97 3054.5,-19536.97 3054.5,-19588.97"/>
<text text-anchor="middle" x="2937" y="-19576.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2937" y="-19565.97" font-family="Times,serif" font-size="10.00">GPU 65</text>
<text text-anchor="middle" x="2937" y="-19554.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2937" y="-19543.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep0_tp1&#45;&gt;expert2_dp1_ep0_tp1 -->
<g id="edge271" class="edge">
<title>moe_gate_dp1_ep0_tp1&#45;&gt;expert2_dp1_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2853.31,-19665.59C2871.91,-19643.01 2893.21,-19617.14 2909.67,-19597.15"/>
<polygon fill="black" stroke="black" points="2912.53,-19599.19 2916.18,-19589.25 2907.12,-19594.74 2912.53,-19599.19"/>
<text text-anchor="middle" x="2934.5" y="-19636.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep0_tp1 -->
<g id="node238" class="node">
<title>expert_agg_dp1_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3043.33,-19473.97 2665.79,-19473.97 2568.67,-19369.97 2946.21,-19369.97 3043.33,-19473.97"/>
<text text-anchor="middle" x="2806" y="-19435.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2806" y="-19424.97" font-family="Times,serif" font-size="10.00">GPU 65</text>
<text text-anchor="middle" x="2806" y="-19413.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2806" y="-19402.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep0_tp1&#45;&gt;expert_agg_dp1_ep0_tp1 -->
<g id="edge272" class="edge">
<title>expert1_dp1_ep0_tp1&#45;&gt;expert_agg_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M2706.09,-19536.79C2719.61,-19521.39 2737.5,-19501.01 2754.41,-19481.74"/>
<polygon fill="black" stroke="black" points="2757.11,-19483.97 2761.08,-19474.15 2751.85,-19479.35 2757.11,-19483.97"/>
</g>
<!-- expert2_dp1_ep0_tp1&#45;&gt;expert_agg_dp1_ep0_tp1 -->
<g id="edge273" class="edge">
<title>expert2_dp1_ep0_tp1&#45;&gt;expert_agg_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M2913.28,-19536.79C2898.7,-19521.32 2879.38,-19500.82 2861.16,-19481.49"/>
<polygon fill="black" stroke="black" points="2863.64,-19479.02 2854.24,-19474.15 2858.55,-19483.83 2863.64,-19479.02"/>
</g>
<!-- ln2_dp1_ep0_tp1 -->
<g id="node239" class="node">
<title>ln2_dp1_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2920.5,-19306.97 2691.5,-19306.97 2691.5,-19254.97 2920.5,-19254.97 2920.5,-19306.97"/>
<text text-anchor="middle" x="2806" y="-19294.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2806" y="-19283.97" font-family="Times,serif" font-size="10.00">GPU 65</text>
<text text-anchor="middle" x="2806" y="-19272.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2806" y="-19261.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep0_tp1&#45;&gt;ln2_dp1_ep0_tp1 -->
<g id="edge274" class="edge">
<title>expert_agg_dp1_ep0_tp1&#45;&gt;ln2_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M2806,-19369.6C2806,-19352.26 2806,-19333.3 2806,-19317.46"/>
<polygon fill="black" stroke="black" points="2809.5,-19317.05 2806,-19307.05 2802.5,-19317.05 2809.5,-19317.05"/>
</g>
<!-- ln1_dp1_ep1_tp1 -->
<g id="node247" class="node">
<title>ln1_dp1_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2920.5,-19170.97 2691.5,-19170.97 2691.5,-19118.97 2920.5,-19118.97 2920.5,-19170.97"/>
<text text-anchor="middle" x="2806" y="-19158.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2806" y="-19147.97" font-family="Times,serif" font-size="10.00">GPU 67</text>
<text text-anchor="middle" x="2806" y="-19136.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2806" y="-19125.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep0_tp1&#45;&gt;ln1_dp1_ep1_tp1 -->
<g id="edge275" class="edge">
<title>ln2_dp1_ep0_tp1&#45;&gt;ln1_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M2806,-19254.76C2806,-19233.99 2806,-19204.28 2806,-19181.16"/>
<polygon fill="black" stroke="black" points="2809.5,-19181.06 2806,-19171.06 2802.5,-19181.06 2809.5,-19181.06"/>
</g>
<!-- mha_dp1_ep1_tp0 -->
<g id="node241" class="node">
<title>mha_dp1_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2413.5,-19060.97 2184.5,-19060.97 2184.5,-19008.97 2413.5,-19008.97 2413.5,-19060.97"/>
<text text-anchor="middle" x="2299" y="-19048.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2299" y="-19037.97" font-family="Times,serif" font-size="10.00">GPU 66</text>
<text text-anchor="middle" x="2299" y="-19026.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2299" y="-19015.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep1_tp0&#45;&gt;mha_dp1_ep1_tp0 -->
<g id="edge276" class="edge">
<title>ln1_dp1_ep1_tp0&#45;&gt;mha_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M2299,-19118.92C2299,-19104.84 2299,-19087.04 2299,-19071.54"/>
<polygon fill="black" stroke="black" points="2302.5,-19071.25 2299,-19061.25 2295.5,-19071.25 2302.5,-19071.25"/>
</g>
<!-- moe_gate_dp1_ep1_tp0 -->
<g id="node242" class="node">
<title>moe_gate_dp1_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2543.85,-18971.97 2154.35,-18971.97 2054.15,-18867.97 2443.65,-18867.97 2543.85,-18971.97"/>
<text text-anchor="middle" x="2299" y="-18933.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2299" y="-18922.97" font-family="Times,serif" font-size="10.00">GPU 66</text>
<text text-anchor="middle" x="2299" y="-18911.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2299" y="-18900.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep1_tp0&#45;&gt;moe_gate_dp1_ep1_tp0 -->
<g id="edge277" class="edge">
<title>mha_dp1_ep1_tp0&#45;&gt;moe_gate_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M2299,-19008.89C2299,-19000.96 2299,-18991.82 2299,-18982.5"/>
<polygon fill="black" stroke="black" points="2302.5,-18982.37 2299,-18972.37 2295.5,-18982.37 2302.5,-18982.37"/>
</g>
<!-- expert1_dp1_ep1_tp0 -->
<g id="node243" class="node">
<title>expert1_dp1_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2290.5,-18790.97 2055.5,-18790.97 2055.5,-18738.97 2290.5,-18738.97 2290.5,-18790.97"/>
<text text-anchor="middle" x="2173" y="-18778.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2173" y="-18767.97" font-family="Times,serif" font-size="10.00">GPU 66</text>
<text text-anchor="middle" x="2173" y="-18756.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2173" y="-18745.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep1_tp0&#45;&gt;expert1_dp1_ep1_tp0 -->
<g id="edge278" class="edge">
<title>moe_gate_dp1_ep1_tp0&#45;&gt;expert1_dp1_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2256.69,-18867.59C2238.09,-18845.01 2216.79,-18819.14 2200.33,-18799.15"/>
<polygon fill="black" stroke="black" points="2202.88,-18796.74 2193.82,-18791.25 2197.47,-18801.19 2202.88,-18796.74"/>
<text text-anchor="middle" x="2296.5" y="-18838.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep1_tp0 -->
<g id="node244" class="node">
<title>expert2_dp1_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2543.5,-18790.97 2308.5,-18790.97 2308.5,-18738.97 2543.5,-18738.97 2543.5,-18790.97"/>
<text text-anchor="middle" x="2426" y="-18778.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2426" y="-18767.97" font-family="Times,serif" font-size="10.00">GPU 66</text>
<text text-anchor="middle" x="2426" y="-18756.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2426" y="-18745.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep1_tp0&#45;&gt;expert2_dp1_ep1_tp0 -->
<g id="edge279" class="edge">
<title>moe_gate_dp1_ep1_tp0&#45;&gt;expert2_dp1_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2342.97,-18867.85C2348.06,-18861.84 2353.16,-18855.78 2358,-18849.97 2371.9,-18833.26 2387.14,-18814.48 2399.66,-18798.92"/>
<polygon fill="black" stroke="black" points="2402.41,-18801.09 2405.94,-18791.1 2396.95,-18796.71 2402.41,-18801.09"/>
<text text-anchor="middle" x="2426.5" y="-18838.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep1_tp0 -->
<g id="node245" class="node">
<title>expert_agg_dp1_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2528.33,-18675.97 2150.79,-18675.97 2053.67,-18571.97 2431.21,-18571.97 2528.33,-18675.97"/>
<text text-anchor="middle" x="2291" y="-18637.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2291" y="-18626.97" font-family="Times,serif" font-size="10.00">GPU 66</text>
<text text-anchor="middle" x="2291" y="-18615.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2291" y="-18604.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep1_tp0&#45;&gt;expert_agg_dp1_ep1_tp0 -->
<g id="edge280" class="edge">
<title>expert1_dp1_ep1_tp0&#45;&gt;expert_agg_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M2194.37,-18738.79C2207.39,-18723.46 2224.6,-18703.19 2240.88,-18684"/>
<polygon fill="black" stroke="black" points="2243.75,-18686.04 2247.55,-18676.15 2238.41,-18681.51 2243.75,-18686.04"/>
</g>
<!-- expert2_dp1_ep1_tp0&#45;&gt;expert_agg_dp1_ep1_tp0 -->
<g id="edge281" class="edge">
<title>expert2_dp1_ep1_tp0&#45;&gt;expert_agg_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M2401.55,-18738.79C2386.53,-18723.32 2366.62,-18702.82 2347.84,-18683.49"/>
<polygon fill="black" stroke="black" points="2350.19,-18680.88 2340.71,-18676.15 2345.17,-18685.76 2350.19,-18680.88"/>
</g>
<!-- ln2_dp1_ep1_tp0 -->
<g id="node246" class="node">
<title>ln2_dp1_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2405.5,-18508.97 2176.5,-18508.97 2176.5,-18456.97 2405.5,-18456.97 2405.5,-18508.97"/>
<text text-anchor="middle" x="2291" y="-18496.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2291" y="-18485.97" font-family="Times,serif" font-size="10.00">GPU 66</text>
<text text-anchor="middle" x="2291" y="-18474.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2291" y="-18463.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep1_tp0&#45;&gt;ln2_dp1_ep1_tp0 -->
<g id="edge282" class="edge">
<title>expert_agg_dp1_ep1_tp0&#45;&gt;ln2_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M2291,-18571.6C2291,-18554.26 2291,-18535.3 2291,-18519.46"/>
<polygon fill="black" stroke="black" points="2294.5,-18519.05 2291,-18509.05 2287.5,-18519.05 2294.5,-18519.05"/>
</g>
<!-- ln1_dp1_ep2_tp0 -->
<g id="node254" class="node">
<title>ln1_dp1_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2405.5,-18372.97 2176.5,-18372.97 2176.5,-18320.97 2405.5,-18320.97 2405.5,-18372.97"/>
<text text-anchor="middle" x="2291" y="-18360.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2291" y="-18349.97" font-family="Times,serif" font-size="10.00">GPU 68</text>
<text text-anchor="middle" x="2291" y="-18338.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2291" y="-18327.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep1_tp0&#45;&gt;ln1_dp1_ep2_tp0 -->
<g id="edge283" class="edge">
<title>ln2_dp1_ep1_tp0&#45;&gt;ln1_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M2291,-18456.76C2291,-18435.99 2291,-18406.28 2291,-18383.16"/>
<polygon fill="black" stroke="black" points="2294.5,-18383.06 2291,-18373.06 2287.5,-18383.06 2294.5,-18383.06"/>
</g>
<!-- mha_dp1_ep1_tp1 -->
<g id="node248" class="node">
<title>mha_dp1_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2920.5,-19060.97 2691.5,-19060.97 2691.5,-19008.97 2920.5,-19008.97 2920.5,-19060.97"/>
<text text-anchor="middle" x="2806" y="-19048.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2806" y="-19037.97" font-family="Times,serif" font-size="10.00">GPU 67</text>
<text text-anchor="middle" x="2806" y="-19026.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2806" y="-19015.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep1_tp1&#45;&gt;mha_dp1_ep1_tp1 -->
<g id="edge284" class="edge">
<title>ln1_dp1_ep1_tp1&#45;&gt;mha_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M2806,-19118.92C2806,-19104.84 2806,-19087.04 2806,-19071.54"/>
<polygon fill="black" stroke="black" points="2809.5,-19071.25 2806,-19061.25 2802.5,-19071.25 2809.5,-19071.25"/>
</g>
<!-- moe_gate_dp1_ep1_tp1 -->
<g id="node249" class="node">
<title>moe_gate_dp1_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3050.85,-18971.97 2661.35,-18971.97 2561.15,-18867.97 2950.65,-18867.97 3050.85,-18971.97"/>
<text text-anchor="middle" x="2806" y="-18933.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2806" y="-18922.97" font-family="Times,serif" font-size="10.00">GPU 67</text>
<text text-anchor="middle" x="2806" y="-18911.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2806" y="-18900.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep1_tp1&#45;&gt;moe_gate_dp1_ep1_tp1 -->
<g id="edge285" class="edge">
<title>mha_dp1_ep1_tp1&#45;&gt;moe_gate_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M2806,-19008.89C2806,-19000.96 2806,-18991.82 2806,-18982.5"/>
<polygon fill="black" stroke="black" points="2809.5,-18982.37 2806,-18972.37 2802.5,-18982.37 2809.5,-18982.37"/>
</g>
<!-- expert1_dp1_ep1_tp1 -->
<g id="node250" class="node">
<title>expert1_dp1_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2796.5,-18790.97 2561.5,-18790.97 2561.5,-18738.97 2796.5,-18738.97 2796.5,-18790.97"/>
<text text-anchor="middle" x="2679" y="-18778.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2679" y="-18767.97" font-family="Times,serif" font-size="10.00">GPU 67</text>
<text text-anchor="middle" x="2679" y="-18756.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2679" y="-18745.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep1_tp1&#45;&gt;expert1_dp1_ep1_tp1 -->
<g id="edge286" class="edge">
<title>moe_gate_dp1_ep1_tp1&#45;&gt;expert1_dp1_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2761.2,-18867.93C2756.03,-18861.91 2750.88,-18855.82 2746,-18849.97 2732.3,-18833.52 2717.42,-18814.94 2705.17,-18799.44"/>
<polygon fill="black" stroke="black" points="2707.6,-18796.87 2698.66,-18791.18 2702.1,-18801.2 2707.6,-18796.87"/>
<text text-anchor="middle" x="2803.5" y="-18838.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep1_tp1 -->
<g id="node251" class="node">
<title>expert2_dp1_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3049.5,-18790.97 2814.5,-18790.97 2814.5,-18738.97 3049.5,-18738.97 3049.5,-18790.97"/>
<text text-anchor="middle" x="2932" y="-18778.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2932" y="-18767.97" font-family="Times,serif" font-size="10.00">GPU 67</text>
<text text-anchor="middle" x="2932" y="-18756.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2932" y="-18745.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep1_tp1&#45;&gt;expert2_dp1_ep1_tp1 -->
<g id="edge287" class="edge">
<title>moe_gate_dp1_ep1_tp1&#45;&gt;expert2_dp1_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2848.31,-18867.59C2866.91,-18845.01 2888.21,-18819.14 2904.67,-18799.15"/>
<polygon fill="black" stroke="black" points="2907.53,-18801.19 2911.18,-18791.25 2902.12,-18796.74 2907.53,-18801.19"/>
<text text-anchor="middle" x="2929.5" y="-18838.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep1_tp1 -->
<g id="node252" class="node">
<title>expert_agg_dp1_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3035.33,-18675.97 2657.79,-18675.97 2560.67,-18571.97 2938.21,-18571.97 3035.33,-18675.97"/>
<text text-anchor="middle" x="2798" y="-18637.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2798" y="-18626.97" font-family="Times,serif" font-size="10.00">GPU 67</text>
<text text-anchor="middle" x="2798" y="-18615.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2798" y="-18604.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep1_tp1&#45;&gt;expert_agg_dp1_ep1_tp1 -->
<g id="edge288" class="edge">
<title>expert1_dp1_ep1_tp1&#45;&gt;expert_agg_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M2700.55,-18738.79C2713.74,-18723.39 2731.19,-18703.01 2747.68,-18683.74"/>
<polygon fill="black" stroke="black" points="2750.34,-18686.02 2754.18,-18676.15 2745.02,-18681.47 2750.34,-18686.02"/>
</g>
<!-- expert2_dp1_ep1_tp1&#45;&gt;expert_agg_dp1_ep1_tp1 -->
<g id="edge289" class="edge">
<title>expert2_dp1_ep1_tp1&#45;&gt;expert_agg_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M2907.73,-18738.79C2892.82,-18723.32 2873.06,-18702.82 2854.42,-18683.49"/>
<polygon fill="black" stroke="black" points="2856.8,-18680.92 2847.34,-18676.15 2851.76,-18685.78 2856.8,-18680.92"/>
</g>
<!-- ln2_dp1_ep1_tp1 -->
<g id="node253" class="node">
<title>ln2_dp1_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2912.5,-18508.97 2683.5,-18508.97 2683.5,-18456.97 2912.5,-18456.97 2912.5,-18508.97"/>
<text text-anchor="middle" x="2798" y="-18496.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2798" y="-18485.97" font-family="Times,serif" font-size="10.00">GPU 67</text>
<text text-anchor="middle" x="2798" y="-18474.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2798" y="-18463.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep1_tp1&#45;&gt;ln2_dp1_ep1_tp1 -->
<g id="edge290" class="edge">
<title>expert_agg_dp1_ep1_tp1&#45;&gt;ln2_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M2798,-18571.6C2798,-18554.26 2798,-18535.3 2798,-18519.46"/>
<polygon fill="black" stroke="black" points="2801.5,-18519.05 2798,-18509.05 2794.5,-18519.05 2801.5,-18519.05"/>
</g>
<!-- ln1_dp1_ep2_tp1 -->
<g id="node261" class="node">
<title>ln1_dp1_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2912.5,-18372.97 2683.5,-18372.97 2683.5,-18320.97 2912.5,-18320.97 2912.5,-18372.97"/>
<text text-anchor="middle" x="2798" y="-18360.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2798" y="-18349.97" font-family="Times,serif" font-size="10.00">GPU 69</text>
<text text-anchor="middle" x="2798" y="-18338.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2798" y="-18327.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep1_tp1&#45;&gt;ln1_dp1_ep2_tp1 -->
<g id="edge291" class="edge">
<title>ln2_dp1_ep1_tp1&#45;&gt;ln1_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M2798,-18456.76C2798,-18435.99 2798,-18406.28 2798,-18383.16"/>
<polygon fill="black" stroke="black" points="2801.5,-18383.06 2798,-18373.06 2794.5,-18383.06 2801.5,-18383.06"/>
</g>
<!-- mha_dp1_ep2_tp0 -->
<g id="node255" class="node">
<title>mha_dp1_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2405.5,-18262.97 2176.5,-18262.97 2176.5,-18210.97 2405.5,-18210.97 2405.5,-18262.97"/>
<text text-anchor="middle" x="2291" y="-18250.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2291" y="-18239.97" font-family="Times,serif" font-size="10.00">GPU 68</text>
<text text-anchor="middle" x="2291" y="-18228.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2291" y="-18217.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep2_tp0&#45;&gt;mha_dp1_ep2_tp0 -->
<g id="edge292" class="edge">
<title>ln1_dp1_ep2_tp0&#45;&gt;mha_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M2291,-18320.92C2291,-18306.84 2291,-18289.04 2291,-18273.54"/>
<polygon fill="black" stroke="black" points="2294.5,-18273.25 2291,-18263.25 2287.5,-18273.25 2294.5,-18273.25"/>
</g>
<!-- moe_gate_dp1_ep2_tp0 -->
<g id="node256" class="node">
<title>moe_gate_dp1_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2535.85,-18173.97 2146.35,-18173.97 2046.15,-18069.97 2435.65,-18069.97 2535.85,-18173.97"/>
<text text-anchor="middle" x="2291" y="-18135.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2291" y="-18124.97" font-family="Times,serif" font-size="10.00">GPU 68</text>
<text text-anchor="middle" x="2291" y="-18113.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2291" y="-18102.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep2_tp0&#45;&gt;moe_gate_dp1_ep2_tp0 -->
<g id="edge293" class="edge">
<title>mha_dp1_ep2_tp0&#45;&gt;moe_gate_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M2291,-18210.89C2291,-18202.96 2291,-18193.82 2291,-18184.5"/>
<polygon fill="black" stroke="black" points="2294.5,-18184.37 2291,-18174.37 2287.5,-18184.37 2294.5,-18184.37"/>
</g>
<!-- expert1_dp1_ep2_tp0 -->
<g id="node257" class="node">
<title>expert1_dp1_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2282.5,-17992.97 2047.5,-17992.97 2047.5,-17940.97 2282.5,-17940.97 2282.5,-17992.97"/>
<text text-anchor="middle" x="2165" y="-17980.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2165" y="-17969.97" font-family="Times,serif" font-size="10.00">GPU 68</text>
<text text-anchor="middle" x="2165" y="-17958.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2165" y="-17947.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep2_tp0&#45;&gt;expert1_dp1_ep2_tp0 -->
<g id="edge294" class="edge">
<title>moe_gate_dp1_ep2_tp0&#45;&gt;expert1_dp1_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2239.6,-18069.79C2234.2,-18063.9 2228.9,-18057.88 2224,-18051.97 2210.77,-18035.98 2197.37,-18017.16 2186.69,-18001.39"/>
<polygon fill="black" stroke="black" points="2189.53,-17999.34 2181.05,-17992.98 2183.71,-18003.24 2189.53,-17999.34"/>
<text text-anchor="middle" x="2281.5" y="-18040.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep2_tp0 -->
<g id="node258" class="node">
<title>expert2_dp1_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2535.5,-17992.97 2300.5,-17992.97 2300.5,-17940.97 2535.5,-17940.97 2535.5,-17992.97"/>
<text text-anchor="middle" x="2418" y="-17980.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2418" y="-17969.97" font-family="Times,serif" font-size="10.00">GPU 68</text>
<text text-anchor="middle" x="2418" y="-17958.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2418" y="-17947.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep2_tp0&#45;&gt;expert2_dp1_ep2_tp0 -->
<g id="edge295" class="edge">
<title>moe_gate_dp1_ep2_tp0&#45;&gt;expert2_dp1_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2333.64,-18069.59C2352.39,-18047.01 2373.86,-18021.14 2390.46,-18001.15"/>
<polygon fill="black" stroke="black" points="2393.32,-18003.18 2397.02,-17993.25 2387.94,-17998.71 2393.32,-18003.18"/>
<text text-anchor="middle" x="2415.5" y="-18040.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep2_tp0 -->
<g id="node259" class="node">
<title>expert_agg_dp1_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2524.33,-17877.97 2146.79,-17877.97 2049.67,-17773.97 2427.21,-17773.97 2524.33,-17877.97"/>
<text text-anchor="middle" x="2287" y="-17839.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2287" y="-17828.97" font-family="Times,serif" font-size="10.00">GPU 68</text>
<text text-anchor="middle" x="2287" y="-17817.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2287" y="-17806.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep2_tp0&#45;&gt;expert_agg_dp1_ep2_tp0 -->
<g id="edge296" class="edge">
<title>expert1_dp1_ep2_tp0&#45;&gt;expert_agg_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M2187.09,-17940.79C2200.61,-17925.39 2218.5,-17905.01 2235.41,-17885.74"/>
<polygon fill="black" stroke="black" points="2238.11,-17887.97 2242.08,-17878.15 2232.85,-17883.35 2238.11,-17887.97"/>
</g>
<!-- expert2_dp1_ep2_tp0&#45;&gt;expert_agg_dp1_ep2_tp0 -->
<g id="edge297" class="edge">
<title>expert2_dp1_ep2_tp0&#45;&gt;expert_agg_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M2394.28,-17940.79C2379.7,-17925.32 2360.38,-17904.82 2342.16,-17885.49"/>
<polygon fill="black" stroke="black" points="2344.64,-17883.02 2335.24,-17878.15 2339.55,-17887.83 2344.64,-17883.02"/>
</g>
<!-- ln2_dp1_ep2_tp0 -->
<g id="node260" class="node">
<title>ln2_dp1_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2401.5,-17710.97 2172.5,-17710.97 2172.5,-17658.97 2401.5,-17658.97 2401.5,-17710.97"/>
<text text-anchor="middle" x="2287" y="-17698.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2287" y="-17687.97" font-family="Times,serif" font-size="10.00">GPU 68</text>
<text text-anchor="middle" x="2287" y="-17676.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2287" y="-17665.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep2_tp0&#45;&gt;ln2_dp1_ep2_tp0 -->
<g id="edge298" class="edge">
<title>expert_agg_dp1_ep2_tp0&#45;&gt;ln2_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M2287,-17773.6C2287,-17756.26 2287,-17737.3 2287,-17721.46"/>
<polygon fill="black" stroke="black" points="2290.5,-17721.05 2287,-17711.05 2283.5,-17721.05 2290.5,-17721.05"/>
</g>
<!-- ln1_dp1_ep3_tp0 -->
<g id="node268" class="node">
<title>ln1_dp1_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2401.5,-17574.97 2172.5,-17574.97 2172.5,-17522.97 2401.5,-17522.97 2401.5,-17574.97"/>
<text text-anchor="middle" x="2287" y="-17562.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2287" y="-17551.97" font-family="Times,serif" font-size="10.00">GPU 70</text>
<text text-anchor="middle" x="2287" y="-17540.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2287" y="-17529.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep2_tp0&#45;&gt;ln1_dp1_ep3_tp0 -->
<g id="edge299" class="edge">
<title>ln2_dp1_ep2_tp0&#45;&gt;ln1_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M2287,-17658.76C2287,-17637.99 2287,-17608.28 2287,-17585.16"/>
<polygon fill="black" stroke="black" points="2290.5,-17585.06 2287,-17575.06 2283.5,-17585.06 2290.5,-17585.06"/>
</g>
<!-- mha_dp1_ep2_tp1 -->
<g id="node262" class="node">
<title>mha_dp1_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2912.5,-18262.97 2683.5,-18262.97 2683.5,-18210.97 2912.5,-18210.97 2912.5,-18262.97"/>
<text text-anchor="middle" x="2798" y="-18250.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2798" y="-18239.97" font-family="Times,serif" font-size="10.00">GPU 69</text>
<text text-anchor="middle" x="2798" y="-18228.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2798" y="-18217.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep2_tp1&#45;&gt;mha_dp1_ep2_tp1 -->
<g id="edge300" class="edge">
<title>ln1_dp1_ep2_tp1&#45;&gt;mha_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M2798,-18320.92C2798,-18306.84 2798,-18289.04 2798,-18273.54"/>
<polygon fill="black" stroke="black" points="2801.5,-18273.25 2798,-18263.25 2794.5,-18273.25 2801.5,-18273.25"/>
</g>
<!-- moe_gate_dp1_ep2_tp1 -->
<g id="node263" class="node">
<title>moe_gate_dp1_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3042.85,-18173.97 2653.35,-18173.97 2553.15,-18069.97 2942.65,-18069.97 3042.85,-18173.97"/>
<text text-anchor="middle" x="2798" y="-18135.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2798" y="-18124.97" font-family="Times,serif" font-size="10.00">GPU 69</text>
<text text-anchor="middle" x="2798" y="-18113.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2798" y="-18102.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep2_tp1&#45;&gt;moe_gate_dp1_ep2_tp1 -->
<g id="edge301" class="edge">
<title>mha_dp1_ep2_tp1&#45;&gt;moe_gate_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M2798,-18210.89C2798,-18202.96 2798,-18193.82 2798,-18184.5"/>
<polygon fill="black" stroke="black" points="2801.5,-18184.37 2798,-18174.37 2794.5,-18184.37 2801.5,-18184.37"/>
</g>
<!-- expert1_dp1_ep2_tp1 -->
<g id="node264" class="node">
<title>expert1_dp1_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2788.5,-17992.97 2553.5,-17992.97 2553.5,-17940.97 2788.5,-17940.97 2788.5,-17992.97"/>
<text text-anchor="middle" x="2671" y="-17980.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2671" y="-17969.97" font-family="Times,serif" font-size="10.00">GPU 69</text>
<text text-anchor="middle" x="2671" y="-17958.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2671" y="-17947.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep2_tp1&#45;&gt;expert1_dp1_ep2_tp1 -->
<g id="edge302" class="edge">
<title>moe_gate_dp1_ep2_tp1&#45;&gt;expert1_dp1_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2753.2,-18069.93C2748.03,-18063.91 2742.88,-18057.82 2738,-18051.97 2724.3,-18035.52 2709.42,-18016.94 2697.17,-18001.44"/>
<polygon fill="black" stroke="black" points="2699.6,-17998.87 2690.66,-17993.18 2694.1,-18003.2 2699.6,-17998.87"/>
<text text-anchor="middle" x="2795.5" y="-18040.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep2_tp1 -->
<g id="node265" class="node">
<title>expert2_dp1_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3041.5,-17992.97 2806.5,-17992.97 2806.5,-17940.97 3041.5,-17940.97 3041.5,-17992.97"/>
<text text-anchor="middle" x="2924" y="-17980.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2924" y="-17969.97" font-family="Times,serif" font-size="10.00">GPU 69</text>
<text text-anchor="middle" x="2924" y="-17958.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2924" y="-17947.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep2_tp1&#45;&gt;expert2_dp1_ep2_tp1 -->
<g id="edge303" class="edge">
<title>moe_gate_dp1_ep2_tp1&#45;&gt;expert2_dp1_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2840.31,-18069.59C2858.91,-18047.01 2880.21,-18021.14 2896.67,-18001.15"/>
<polygon fill="black" stroke="black" points="2899.53,-18003.19 2903.18,-17993.25 2894.12,-17998.74 2899.53,-18003.19"/>
<text text-anchor="middle" x="2921.5" y="-18040.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep2_tp1 -->
<g id="node266" class="node">
<title>expert_agg_dp1_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3031.33,-17877.97 2653.79,-17877.97 2556.67,-17773.97 2934.21,-17773.97 3031.33,-17877.97"/>
<text text-anchor="middle" x="2794" y="-17839.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2794" y="-17828.97" font-family="Times,serif" font-size="10.00">GPU 69</text>
<text text-anchor="middle" x="2794" y="-17817.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2794" y="-17806.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep2_tp1&#45;&gt;expert_agg_dp1_ep2_tp1 -->
<g id="edge304" class="edge">
<title>expert1_dp1_ep2_tp1&#45;&gt;expert_agg_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M2693.27,-17940.79C2706.9,-17925.39 2724.94,-17905.01 2741.99,-17885.74"/>
<polygon fill="black" stroke="black" points="2744.7,-17887.96 2748.71,-17878.15 2739.46,-17883.32 2744.7,-17887.96"/>
</g>
<!-- expert2_dp1_ep2_tp1&#45;&gt;expert_agg_dp1_ep2_tp1 -->
<g id="edge305" class="edge">
<title>expert2_dp1_ep2_tp1&#45;&gt;expert_agg_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M2900.46,-17940.79C2885.99,-17925.32 2866.82,-17904.82 2848.73,-17885.49"/>
<polygon fill="black" stroke="black" points="2851.26,-17883.06 2841.87,-17878.15 2846.14,-17887.84 2851.26,-17883.06"/>
</g>
<!-- ln2_dp1_ep2_tp1 -->
<g id="node267" class="node">
<title>ln2_dp1_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2908.5,-17710.97 2679.5,-17710.97 2679.5,-17658.97 2908.5,-17658.97 2908.5,-17710.97"/>
<text text-anchor="middle" x="2794" y="-17698.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2794" y="-17687.97" font-family="Times,serif" font-size="10.00">GPU 69</text>
<text text-anchor="middle" x="2794" y="-17676.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2794" y="-17665.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep2_tp1&#45;&gt;ln2_dp1_ep2_tp1 -->
<g id="edge306" class="edge">
<title>expert_agg_dp1_ep2_tp1&#45;&gt;ln2_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M2794,-17773.6C2794,-17756.26 2794,-17737.3 2794,-17721.46"/>
<polygon fill="black" stroke="black" points="2797.5,-17721.05 2794,-17711.05 2790.5,-17721.05 2797.5,-17721.05"/>
</g>
<!-- ln1_dp1_ep3_tp1 -->
<g id="node275" class="node">
<title>ln1_dp1_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2908.5,-17574.97 2679.5,-17574.97 2679.5,-17522.97 2908.5,-17522.97 2908.5,-17574.97"/>
<text text-anchor="middle" x="2794" y="-17562.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2794" y="-17551.97" font-family="Times,serif" font-size="10.00">GPU 71</text>
<text text-anchor="middle" x="2794" y="-17540.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2794" y="-17529.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep2_tp1&#45;&gt;ln1_dp1_ep3_tp1 -->
<g id="edge307" class="edge">
<title>ln2_dp1_ep2_tp1&#45;&gt;ln1_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M2794,-17658.76C2794,-17637.99 2794,-17608.28 2794,-17585.16"/>
<polygon fill="black" stroke="black" points="2797.5,-17585.06 2794,-17575.06 2790.5,-17585.06 2797.5,-17585.06"/>
</g>
<!-- mha_dp1_ep3_tp0 -->
<g id="node269" class="node">
<title>mha_dp1_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2401.5,-17464.97 2172.5,-17464.97 2172.5,-17412.97 2401.5,-17412.97 2401.5,-17464.97"/>
<text text-anchor="middle" x="2287" y="-17452.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2287" y="-17441.97" font-family="Times,serif" font-size="10.00">GPU 70</text>
<text text-anchor="middle" x="2287" y="-17430.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2287" y="-17419.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep3_tp0&#45;&gt;mha_dp1_ep3_tp0 -->
<g id="edge308" class="edge">
<title>ln1_dp1_ep3_tp0&#45;&gt;mha_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M2287,-17522.92C2287,-17508.84 2287,-17491.04 2287,-17475.54"/>
<polygon fill="black" stroke="black" points="2290.5,-17475.25 2287,-17465.25 2283.5,-17475.25 2290.5,-17475.25"/>
</g>
<!-- moe_gate_dp1_ep3_tp0 -->
<g id="node270" class="node">
<title>moe_gate_dp1_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2531.85,-17375.97 2142.35,-17375.97 2042.15,-17271.97 2431.65,-17271.97 2531.85,-17375.97"/>
<text text-anchor="middle" x="2287" y="-17337.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2287" y="-17326.97" font-family="Times,serif" font-size="10.00">GPU 70</text>
<text text-anchor="middle" x="2287" y="-17315.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2287" y="-17304.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep3_tp0&#45;&gt;moe_gate_dp1_ep3_tp0 -->
<g id="edge309" class="edge">
<title>mha_dp1_ep3_tp0&#45;&gt;moe_gate_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M2287,-17412.89C2287,-17404.96 2287,-17395.82 2287,-17386.5"/>
<polygon fill="black" stroke="black" points="2290.5,-17386.37 2287,-17376.37 2283.5,-17386.37 2290.5,-17386.37"/>
</g>
<!-- expert1_dp1_ep3_tp0 -->
<g id="node271" class="node">
<title>expert1_dp1_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2278.5,-17194.97 2043.5,-17194.97 2043.5,-17142.97 2278.5,-17142.97 2278.5,-17194.97"/>
<text text-anchor="middle" x="2161" y="-17182.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2161" y="-17171.97" font-family="Times,serif" font-size="10.00">GPU 70</text>
<text text-anchor="middle" x="2161" y="-17160.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2161" y="-17149.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep3_tp0&#45;&gt;expert1_dp1_ep3_tp0 -->
<g id="edge310" class="edge">
<title>moe_gate_dp1_ep3_tp0&#45;&gt;expert1_dp1_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2235.6,-17271.79C2230.2,-17265.9 2224.9,-17259.88 2220,-17253.97 2206.77,-17237.98 2193.37,-17219.16 2182.69,-17203.39"/>
<polygon fill="black" stroke="black" points="2185.53,-17201.34 2177.05,-17194.98 2179.71,-17205.24 2185.53,-17201.34"/>
<text text-anchor="middle" x="2277.5" y="-17242.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep3_tp0 -->
<g id="node272" class="node">
<title>expert2_dp1_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2531.5,-17194.97 2296.5,-17194.97 2296.5,-17142.97 2531.5,-17142.97 2531.5,-17194.97"/>
<text text-anchor="middle" x="2414" y="-17182.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2414" y="-17171.97" font-family="Times,serif" font-size="10.00">GPU 70</text>
<text text-anchor="middle" x="2414" y="-17160.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2414" y="-17149.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep3_tp0&#45;&gt;expert2_dp1_ep3_tp0 -->
<g id="edge311" class="edge">
<title>moe_gate_dp1_ep3_tp0&#45;&gt;expert2_dp1_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2329.64,-17271.59C2348.39,-17249.01 2369.86,-17223.14 2386.46,-17203.15"/>
<polygon fill="black" stroke="black" points="2389.32,-17205.18 2393.02,-17195.25 2383.94,-17200.71 2389.32,-17205.18"/>
<text text-anchor="middle" x="2411.5" y="-17242.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep3_tp0 -->
<g id="node273" class="node">
<title>expert_agg_dp1_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2520.33,-17079.97 2142.79,-17079.97 2045.67,-16975.97 2423.21,-16975.97 2520.33,-17079.97"/>
<text text-anchor="middle" x="2283" y="-17041.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2283" y="-17030.97" font-family="Times,serif" font-size="10.00">GPU 70</text>
<text text-anchor="middle" x="2283" y="-17019.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2283" y="-17008.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep3_tp0&#45;&gt;expert_agg_dp1_ep3_tp0 -->
<g id="edge312" class="edge">
<title>expert1_dp1_ep3_tp0&#45;&gt;expert_agg_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M2183.09,-17142.79C2196.61,-17127.39 2214.5,-17107.01 2231.41,-17087.74"/>
<polygon fill="black" stroke="black" points="2234.11,-17089.97 2238.08,-17080.15 2228.85,-17085.35 2234.11,-17089.97"/>
</g>
<!-- expert2_dp1_ep3_tp0&#45;&gt;expert_agg_dp1_ep3_tp0 -->
<g id="edge313" class="edge">
<title>expert2_dp1_ep3_tp0&#45;&gt;expert_agg_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M2390.28,-17142.79C2375.7,-17127.32 2356.38,-17106.82 2338.16,-17087.49"/>
<polygon fill="black" stroke="black" points="2340.64,-17085.02 2331.24,-17080.15 2335.55,-17089.83 2340.64,-17085.02"/>
</g>
<!-- ln2_dp1_ep3_tp0 -->
<g id="node274" class="node">
<title>ln2_dp1_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2397.5,-16912.97 2168.5,-16912.97 2168.5,-16860.97 2397.5,-16860.97 2397.5,-16912.97"/>
<text text-anchor="middle" x="2283" y="-16900.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2283" y="-16889.97" font-family="Times,serif" font-size="10.00">GPU 70</text>
<text text-anchor="middle" x="2283" y="-16878.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2283" y="-16867.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep3_tp0&#45;&gt;ln2_dp1_ep3_tp0 -->
<g id="edge314" class="edge">
<title>expert_agg_dp1_ep3_tp0&#45;&gt;ln2_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M2283,-16975.6C2283,-16958.26 2283,-16939.3 2283,-16923.46"/>
<polygon fill="black" stroke="black" points="2286.5,-16923.05 2283,-16913.05 2279.5,-16923.05 2286.5,-16923.05"/>
</g>
<!-- ln1_dp1_ep4_tp0 -->
<g id="node282" class="node">
<title>ln1_dp1_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2397.5,-16776.97 2168.5,-16776.97 2168.5,-16724.97 2397.5,-16724.97 2397.5,-16776.97"/>
<text text-anchor="middle" x="2283" y="-16764.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2283" y="-16753.97" font-family="Times,serif" font-size="10.00">GPU 72</text>
<text text-anchor="middle" x="2283" y="-16742.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2283" y="-16731.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep3_tp0&#45;&gt;ln1_dp1_ep4_tp0 -->
<g id="edge315" class="edge">
<title>ln2_dp1_ep3_tp0&#45;&gt;ln1_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M2283,-16860.76C2283,-16839.99 2283,-16810.28 2283,-16787.16"/>
<polygon fill="black" stroke="black" points="2286.5,-16787.06 2283,-16777.06 2279.5,-16787.06 2286.5,-16787.06"/>
</g>
<!-- mha_dp1_ep3_tp1 -->
<g id="node276" class="node">
<title>mha_dp1_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2908.5,-17464.97 2679.5,-17464.97 2679.5,-17412.97 2908.5,-17412.97 2908.5,-17464.97"/>
<text text-anchor="middle" x="2794" y="-17452.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2794" y="-17441.97" font-family="Times,serif" font-size="10.00">GPU 71</text>
<text text-anchor="middle" x="2794" y="-17430.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2794" y="-17419.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep3_tp1&#45;&gt;mha_dp1_ep3_tp1 -->
<g id="edge316" class="edge">
<title>ln1_dp1_ep3_tp1&#45;&gt;mha_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M2794,-17522.92C2794,-17508.84 2794,-17491.04 2794,-17475.54"/>
<polygon fill="black" stroke="black" points="2797.5,-17475.25 2794,-17465.25 2790.5,-17475.25 2797.5,-17475.25"/>
</g>
<!-- moe_gate_dp1_ep3_tp1 -->
<g id="node277" class="node">
<title>moe_gate_dp1_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3038.85,-17375.97 2649.35,-17375.97 2549.15,-17271.97 2938.65,-17271.97 3038.85,-17375.97"/>
<text text-anchor="middle" x="2794" y="-17337.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2794" y="-17326.97" font-family="Times,serif" font-size="10.00">GPU 71</text>
<text text-anchor="middle" x="2794" y="-17315.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2794" y="-17304.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep3_tp1&#45;&gt;moe_gate_dp1_ep3_tp1 -->
<g id="edge317" class="edge">
<title>mha_dp1_ep3_tp1&#45;&gt;moe_gate_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M2794,-17412.89C2794,-17404.96 2794,-17395.82 2794,-17386.5"/>
<polygon fill="black" stroke="black" points="2797.5,-17386.37 2794,-17376.37 2790.5,-17386.37 2797.5,-17386.37"/>
</g>
<!-- expert1_dp1_ep3_tp1 -->
<g id="node278" class="node">
<title>expert1_dp1_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2784.5,-17194.97 2549.5,-17194.97 2549.5,-17142.97 2784.5,-17142.97 2784.5,-17194.97"/>
<text text-anchor="middle" x="2667" y="-17182.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2667" y="-17171.97" font-family="Times,serif" font-size="10.00">GPU 71</text>
<text text-anchor="middle" x="2667" y="-17160.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2667" y="-17149.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep3_tp1&#45;&gt;expert1_dp1_ep3_tp1 -->
<g id="edge318" class="edge">
<title>moe_gate_dp1_ep3_tp1&#45;&gt;expert1_dp1_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2749.2,-17271.93C2744.03,-17265.91 2738.88,-17259.82 2734,-17253.97 2720.3,-17237.52 2705.42,-17218.94 2693.17,-17203.44"/>
<polygon fill="black" stroke="black" points="2695.6,-17200.87 2686.66,-17195.18 2690.1,-17205.2 2695.6,-17200.87"/>
<text text-anchor="middle" x="2791.5" y="-17242.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep3_tp1 -->
<g id="node279" class="node">
<title>expert2_dp1_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3037.5,-17194.97 2802.5,-17194.97 2802.5,-17142.97 3037.5,-17142.97 3037.5,-17194.97"/>
<text text-anchor="middle" x="2920" y="-17182.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2920" y="-17171.97" font-family="Times,serif" font-size="10.00">GPU 71</text>
<text text-anchor="middle" x="2920" y="-17160.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2920" y="-17149.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep3_tp1&#45;&gt;expert2_dp1_ep3_tp1 -->
<g id="edge319" class="edge">
<title>moe_gate_dp1_ep3_tp1&#45;&gt;expert2_dp1_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2836.31,-17271.59C2854.91,-17249.01 2876.21,-17223.14 2892.67,-17203.15"/>
<polygon fill="black" stroke="black" points="2895.53,-17205.19 2899.18,-17195.25 2890.12,-17200.74 2895.53,-17205.19"/>
<text text-anchor="middle" x="2917.5" y="-17242.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep3_tp1 -->
<g id="node280" class="node">
<title>expert_agg_dp1_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3027.33,-17079.97 2649.79,-17079.97 2552.67,-16975.97 2930.21,-16975.97 3027.33,-17079.97"/>
<text text-anchor="middle" x="2790" y="-17041.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2790" y="-17030.97" font-family="Times,serif" font-size="10.00">GPU 71</text>
<text text-anchor="middle" x="2790" y="-17019.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2790" y="-17008.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep3_tp1&#45;&gt;expert_agg_dp1_ep3_tp1 -->
<g id="edge320" class="edge">
<title>expert1_dp1_ep3_tp1&#45;&gt;expert_agg_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M2689.27,-17142.79C2702.9,-17127.39 2720.94,-17107.01 2737.99,-17087.74"/>
<polygon fill="black" stroke="black" points="2740.7,-17089.96 2744.71,-17080.15 2735.46,-17085.32 2740.7,-17089.96"/>
</g>
<!-- expert2_dp1_ep3_tp1&#45;&gt;expert_agg_dp1_ep3_tp1 -->
<g id="edge321" class="edge">
<title>expert2_dp1_ep3_tp1&#45;&gt;expert_agg_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M2896.46,-17142.79C2881.99,-17127.32 2862.82,-17106.82 2844.73,-17087.49"/>
<polygon fill="black" stroke="black" points="2847.26,-17085.06 2837.87,-17080.15 2842.14,-17089.84 2847.26,-17085.06"/>
</g>
<!-- ln2_dp1_ep3_tp1 -->
<g id="node281" class="node">
<title>ln2_dp1_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2904.5,-16912.97 2675.5,-16912.97 2675.5,-16860.97 2904.5,-16860.97 2904.5,-16912.97"/>
<text text-anchor="middle" x="2790" y="-16900.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2790" y="-16889.97" font-family="Times,serif" font-size="10.00">GPU 71</text>
<text text-anchor="middle" x="2790" y="-16878.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2790" y="-16867.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep3_tp1&#45;&gt;ln2_dp1_ep3_tp1 -->
<g id="edge322" class="edge">
<title>expert_agg_dp1_ep3_tp1&#45;&gt;ln2_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M2790,-16975.6C2790,-16958.26 2790,-16939.3 2790,-16923.46"/>
<polygon fill="black" stroke="black" points="2793.5,-16923.05 2790,-16913.05 2786.5,-16923.05 2793.5,-16923.05"/>
</g>
<!-- ln1_dp1_ep4_tp1 -->
<g id="node289" class="node">
<title>ln1_dp1_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2904.5,-16776.97 2675.5,-16776.97 2675.5,-16724.97 2904.5,-16724.97 2904.5,-16776.97"/>
<text text-anchor="middle" x="2790" y="-16764.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2790" y="-16753.97" font-family="Times,serif" font-size="10.00">GPU 73</text>
<text text-anchor="middle" x="2790" y="-16742.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2790" y="-16731.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep3_tp1&#45;&gt;ln1_dp1_ep4_tp1 -->
<g id="edge323" class="edge">
<title>ln2_dp1_ep3_tp1&#45;&gt;ln1_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M2790,-16860.76C2790,-16839.99 2790,-16810.28 2790,-16787.16"/>
<polygon fill="black" stroke="black" points="2793.5,-16787.06 2790,-16777.06 2786.5,-16787.06 2793.5,-16787.06"/>
</g>
<!-- mha_dp1_ep4_tp0 -->
<g id="node283" class="node">
<title>mha_dp1_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2397.5,-16666.97 2168.5,-16666.97 2168.5,-16614.97 2397.5,-16614.97 2397.5,-16666.97"/>
<text text-anchor="middle" x="2283" y="-16654.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2283" y="-16643.97" font-family="Times,serif" font-size="10.00">GPU 72</text>
<text text-anchor="middle" x="2283" y="-16632.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2283" y="-16621.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep4_tp0&#45;&gt;mha_dp1_ep4_tp0 -->
<g id="edge324" class="edge">
<title>ln1_dp1_ep4_tp0&#45;&gt;mha_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M2283,-16724.92C2283,-16710.84 2283,-16693.04 2283,-16677.54"/>
<polygon fill="black" stroke="black" points="2286.5,-16677.25 2283,-16667.25 2279.5,-16677.25 2286.5,-16677.25"/>
</g>
<!-- moe_gate_dp1_ep4_tp0 -->
<g id="node284" class="node">
<title>moe_gate_dp1_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2527.85,-16577.97 2138.35,-16577.97 2038.15,-16473.97 2427.65,-16473.97 2527.85,-16577.97"/>
<text text-anchor="middle" x="2283" y="-16539.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2283" y="-16528.97" font-family="Times,serif" font-size="10.00">GPU 72</text>
<text text-anchor="middle" x="2283" y="-16517.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2283" y="-16506.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep4_tp0&#45;&gt;moe_gate_dp1_ep4_tp0 -->
<g id="edge325" class="edge">
<title>mha_dp1_ep4_tp0&#45;&gt;moe_gate_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M2283,-16614.89C2283,-16606.96 2283,-16597.82 2283,-16588.5"/>
<polygon fill="black" stroke="black" points="2286.5,-16588.37 2283,-16578.37 2279.5,-16588.37 2286.5,-16588.37"/>
</g>
<!-- expert1_dp1_ep4_tp0 -->
<g id="node285" class="node">
<title>expert1_dp1_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2274.5,-16396.97 2039.5,-16396.97 2039.5,-16344.97 2274.5,-16344.97 2274.5,-16396.97"/>
<text text-anchor="middle" x="2157" y="-16384.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2157" y="-16373.97" font-family="Times,serif" font-size="10.00">GPU 72</text>
<text text-anchor="middle" x="2157" y="-16362.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2157" y="-16351.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep4_tp0&#45;&gt;expert1_dp1_ep4_tp0 -->
<g id="edge326" class="edge">
<title>moe_gate_dp1_ep4_tp0&#45;&gt;expert1_dp1_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2240.69,-16473.59C2222.09,-16451.01 2200.79,-16425.14 2184.33,-16405.15"/>
<polygon fill="black" stroke="black" points="2186.88,-16402.74 2177.82,-16397.25 2181.47,-16407.19 2186.88,-16402.74"/>
<text text-anchor="middle" x="2280.5" y="-16444.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep4_tp0 -->
<g id="node286" class="node">
<title>expert2_dp1_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2527.5,-16396.97 2292.5,-16396.97 2292.5,-16344.97 2527.5,-16344.97 2527.5,-16396.97"/>
<text text-anchor="middle" x="2410" y="-16384.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2410" y="-16373.97" font-family="Times,serif" font-size="10.00">GPU 72</text>
<text text-anchor="middle" x="2410" y="-16362.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2410" y="-16351.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep4_tp0&#45;&gt;expert2_dp1_ep4_tp0 -->
<g id="edge327" class="edge">
<title>moe_gate_dp1_ep4_tp0&#45;&gt;expert2_dp1_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2326.97,-16473.85C2332.06,-16467.84 2337.16,-16461.78 2342,-16455.97 2355.9,-16439.26 2371.14,-16420.48 2383.66,-16404.92"/>
<polygon fill="black" stroke="black" points="2386.41,-16407.09 2389.94,-16397.1 2380.95,-16402.71 2386.41,-16407.09"/>
<text text-anchor="middle" x="2410.5" y="-16444.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep4_tp0 -->
<g id="node287" class="node">
<title>expert_agg_dp1_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2512.33,-16281.97 2134.79,-16281.97 2037.67,-16177.97 2415.21,-16177.97 2512.33,-16281.97"/>
<text text-anchor="middle" x="2275" y="-16243.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2275" y="-16232.97" font-family="Times,serif" font-size="10.00">GPU 72</text>
<text text-anchor="middle" x="2275" y="-16221.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2275" y="-16210.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep4_tp0&#45;&gt;expert_agg_dp1_ep4_tp0 -->
<g id="edge328" class="edge">
<title>expert1_dp1_ep4_tp0&#45;&gt;expert_agg_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M2178.37,-16344.79C2191.39,-16329.46 2208.6,-16309.19 2224.88,-16290"/>
<polygon fill="black" stroke="black" points="2227.75,-16292.04 2231.55,-16282.15 2222.41,-16287.51 2227.75,-16292.04"/>
</g>
<!-- expert2_dp1_ep4_tp0&#45;&gt;expert_agg_dp1_ep4_tp0 -->
<g id="edge329" class="edge">
<title>expert2_dp1_ep4_tp0&#45;&gt;expert_agg_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M2385.55,-16344.79C2370.53,-16329.32 2350.62,-16308.82 2331.84,-16289.49"/>
<polygon fill="black" stroke="black" points="2334.19,-16286.88 2324.71,-16282.15 2329.17,-16291.76 2334.19,-16286.88"/>
</g>
<!-- ln2_dp1_ep4_tp0 -->
<g id="node288" class="node">
<title>ln2_dp1_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2389.5,-16114.97 2160.5,-16114.97 2160.5,-16062.97 2389.5,-16062.97 2389.5,-16114.97"/>
<text text-anchor="middle" x="2275" y="-16102.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2275" y="-16091.97" font-family="Times,serif" font-size="10.00">GPU 72</text>
<text text-anchor="middle" x="2275" y="-16080.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2275" y="-16069.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep4_tp0&#45;&gt;ln2_dp1_ep4_tp0 -->
<g id="edge330" class="edge">
<title>expert_agg_dp1_ep4_tp0&#45;&gt;ln2_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M2275,-16177.6C2275,-16160.26 2275,-16141.3 2275,-16125.46"/>
<polygon fill="black" stroke="black" points="2278.5,-16125.05 2275,-16115.05 2271.5,-16125.05 2278.5,-16125.05"/>
</g>
<!-- ln1_dp1_ep5_tp0 -->
<g id="node296" class="node">
<title>ln1_dp1_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2389.5,-15978.97 2160.5,-15978.97 2160.5,-15926.97 2389.5,-15926.97 2389.5,-15978.97"/>
<text text-anchor="middle" x="2275" y="-15966.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2275" y="-15955.97" font-family="Times,serif" font-size="10.00">GPU 74</text>
<text text-anchor="middle" x="2275" y="-15944.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2275" y="-15933.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep4_tp0&#45;&gt;ln1_dp1_ep5_tp0 -->
<g id="edge331" class="edge">
<title>ln2_dp1_ep4_tp0&#45;&gt;ln1_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M2275,-16062.76C2275,-16041.99 2275,-16012.28 2275,-15989.16"/>
<polygon fill="black" stroke="black" points="2278.5,-15989.06 2275,-15979.06 2271.5,-15989.06 2278.5,-15989.06"/>
</g>
<!-- mha_dp1_ep4_tp1 -->
<g id="node290" class="node">
<title>mha_dp1_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2904.5,-16666.97 2675.5,-16666.97 2675.5,-16614.97 2904.5,-16614.97 2904.5,-16666.97"/>
<text text-anchor="middle" x="2790" y="-16654.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2790" y="-16643.97" font-family="Times,serif" font-size="10.00">GPU 73</text>
<text text-anchor="middle" x="2790" y="-16632.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2790" y="-16621.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep4_tp1&#45;&gt;mha_dp1_ep4_tp1 -->
<g id="edge332" class="edge">
<title>ln1_dp1_ep4_tp1&#45;&gt;mha_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M2790,-16724.92C2790,-16710.84 2790,-16693.04 2790,-16677.54"/>
<polygon fill="black" stroke="black" points="2793.5,-16677.25 2790,-16667.25 2786.5,-16677.25 2793.5,-16677.25"/>
</g>
<!-- moe_gate_dp1_ep4_tp1 -->
<g id="node291" class="node">
<title>moe_gate_dp1_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3034.85,-16577.97 2645.35,-16577.97 2545.15,-16473.97 2934.65,-16473.97 3034.85,-16577.97"/>
<text text-anchor="middle" x="2790" y="-16539.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2790" y="-16528.97" font-family="Times,serif" font-size="10.00">GPU 73</text>
<text text-anchor="middle" x="2790" y="-16517.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2790" y="-16506.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep4_tp1&#45;&gt;moe_gate_dp1_ep4_tp1 -->
<g id="edge333" class="edge">
<title>mha_dp1_ep4_tp1&#45;&gt;moe_gate_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M2790,-16614.89C2790,-16606.96 2790,-16597.82 2790,-16588.5"/>
<polygon fill="black" stroke="black" points="2793.5,-16588.37 2790,-16578.37 2786.5,-16588.37 2793.5,-16588.37"/>
</g>
<!-- expert1_dp1_ep4_tp1 -->
<g id="node292" class="node">
<title>expert1_dp1_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2781.5,-16396.97 2546.5,-16396.97 2546.5,-16344.97 2781.5,-16344.97 2781.5,-16396.97"/>
<text text-anchor="middle" x="2664" y="-16384.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2664" y="-16373.97" font-family="Times,serif" font-size="10.00">GPU 73</text>
<text text-anchor="middle" x="2664" y="-16362.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2664" y="-16351.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep4_tp1&#45;&gt;expert1_dp1_ep4_tp1 -->
<g id="edge334" class="edge">
<title>moe_gate_dp1_ep4_tp1&#45;&gt;expert1_dp1_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2747.69,-16473.59C2729.09,-16451.01 2707.79,-16425.14 2691.33,-16405.15"/>
<polygon fill="black" stroke="black" points="2693.88,-16402.74 2684.82,-16397.25 2688.47,-16407.19 2693.88,-16402.74"/>
<text text-anchor="middle" x="2787.5" y="-16444.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep4_tp1 -->
<g id="node293" class="node">
<title>expert2_dp1_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3034.5,-16396.97 2799.5,-16396.97 2799.5,-16344.97 3034.5,-16344.97 3034.5,-16396.97"/>
<text text-anchor="middle" x="2917" y="-16384.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2917" y="-16373.97" font-family="Times,serif" font-size="10.00">GPU 73</text>
<text text-anchor="middle" x="2917" y="-16362.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2917" y="-16351.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep4_tp1&#45;&gt;expert2_dp1_ep4_tp1 -->
<g id="edge335" class="edge">
<title>moe_gate_dp1_ep4_tp1&#45;&gt;expert2_dp1_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2833.97,-16473.85C2839.06,-16467.84 2844.16,-16461.78 2849,-16455.97 2862.9,-16439.26 2878.14,-16420.48 2890.66,-16404.92"/>
<polygon fill="black" stroke="black" points="2893.41,-16407.09 2896.94,-16397.1 2887.95,-16402.71 2893.41,-16407.09"/>
<text text-anchor="middle" x="2917.5" y="-16444.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep4_tp1 -->
<g id="node294" class="node">
<title>expert_agg_dp1_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3019.33,-16281.97 2641.79,-16281.97 2544.67,-16177.97 2922.21,-16177.97 3019.33,-16281.97"/>
<text text-anchor="middle" x="2782" y="-16243.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2782" y="-16232.97" font-family="Times,serif" font-size="10.00">GPU 73</text>
<text text-anchor="middle" x="2782" y="-16221.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2782" y="-16210.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep4_tp1&#45;&gt;expert_agg_dp1_ep4_tp1 -->
<g id="edge336" class="edge">
<title>expert1_dp1_ep4_tp1&#45;&gt;expert_agg_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M2685.37,-16344.79C2698.39,-16329.46 2715.6,-16309.19 2731.88,-16290"/>
<polygon fill="black" stroke="black" points="2734.75,-16292.04 2738.55,-16282.15 2729.41,-16287.51 2734.75,-16292.04"/>
</g>
<!-- expert2_dp1_ep4_tp1&#45;&gt;expert_agg_dp1_ep4_tp1 -->
<g id="edge337" class="edge">
<title>expert2_dp1_ep4_tp1&#45;&gt;expert_agg_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M2892.55,-16344.79C2877.53,-16329.32 2857.62,-16308.82 2838.84,-16289.49"/>
<polygon fill="black" stroke="black" points="2841.19,-16286.88 2831.71,-16282.15 2836.17,-16291.76 2841.19,-16286.88"/>
</g>
<!-- ln2_dp1_ep4_tp1 -->
<g id="node295" class="node">
<title>ln2_dp1_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2896.5,-16114.97 2667.5,-16114.97 2667.5,-16062.97 2896.5,-16062.97 2896.5,-16114.97"/>
<text text-anchor="middle" x="2782" y="-16102.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2782" y="-16091.97" font-family="Times,serif" font-size="10.00">GPU 73</text>
<text text-anchor="middle" x="2782" y="-16080.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2782" y="-16069.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep4_tp1&#45;&gt;ln2_dp1_ep4_tp1 -->
<g id="edge338" class="edge">
<title>expert_agg_dp1_ep4_tp1&#45;&gt;ln2_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M2782,-16177.6C2782,-16160.26 2782,-16141.3 2782,-16125.46"/>
<polygon fill="black" stroke="black" points="2785.5,-16125.05 2782,-16115.05 2778.5,-16125.05 2785.5,-16125.05"/>
</g>
<!-- ln1_dp1_ep5_tp1 -->
<g id="node303" class="node">
<title>ln1_dp1_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2896.5,-15978.97 2667.5,-15978.97 2667.5,-15926.97 2896.5,-15926.97 2896.5,-15978.97"/>
<text text-anchor="middle" x="2782" y="-15966.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2782" y="-15955.97" font-family="Times,serif" font-size="10.00">GPU 75</text>
<text text-anchor="middle" x="2782" y="-15944.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2782" y="-15933.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep4_tp1&#45;&gt;ln1_dp1_ep5_tp1 -->
<g id="edge339" class="edge">
<title>ln2_dp1_ep4_tp1&#45;&gt;ln1_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M2782,-16062.76C2782,-16041.99 2782,-16012.28 2782,-15989.16"/>
<polygon fill="black" stroke="black" points="2785.5,-15989.06 2782,-15979.06 2778.5,-15989.06 2785.5,-15989.06"/>
</g>
<!-- mha_dp1_ep5_tp0 -->
<g id="node297" class="node">
<title>mha_dp1_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2389.5,-15868.97 2160.5,-15868.97 2160.5,-15816.97 2389.5,-15816.97 2389.5,-15868.97"/>
<text text-anchor="middle" x="2275" y="-15856.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2275" y="-15845.97" font-family="Times,serif" font-size="10.00">GPU 74</text>
<text text-anchor="middle" x="2275" y="-15834.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2275" y="-15823.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep5_tp0&#45;&gt;mha_dp1_ep5_tp0 -->
<g id="edge340" class="edge">
<title>ln1_dp1_ep5_tp0&#45;&gt;mha_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M2275,-15926.92C2275,-15912.84 2275,-15895.04 2275,-15879.54"/>
<polygon fill="black" stroke="black" points="2278.5,-15879.25 2275,-15869.25 2271.5,-15879.25 2278.5,-15879.25"/>
</g>
<!-- moe_gate_dp1_ep5_tp0 -->
<g id="node298" class="node">
<title>moe_gate_dp1_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2519.85,-15779.97 2130.35,-15779.97 2030.15,-15675.97 2419.65,-15675.97 2519.85,-15779.97"/>
<text text-anchor="middle" x="2275" y="-15741.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2275" y="-15730.97" font-family="Times,serif" font-size="10.00">GPU 74</text>
<text text-anchor="middle" x="2275" y="-15719.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2275" y="-15708.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep5_tp0&#45;&gt;moe_gate_dp1_ep5_tp0 -->
<g id="edge341" class="edge">
<title>mha_dp1_ep5_tp0&#45;&gt;moe_gate_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M2275,-15816.89C2275,-15808.96 2275,-15799.82 2275,-15790.5"/>
<polygon fill="black" stroke="black" points="2278.5,-15790.37 2275,-15780.37 2271.5,-15790.37 2278.5,-15790.37"/>
</g>
<!-- expert1_dp1_ep5_tp0 -->
<g id="node299" class="node">
<title>expert1_dp1_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2266.5,-15598.97 2031.5,-15598.97 2031.5,-15546.97 2266.5,-15546.97 2266.5,-15598.97"/>
<text text-anchor="middle" x="2149" y="-15586.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2149" y="-15575.97" font-family="Times,serif" font-size="10.00">GPU 74</text>
<text text-anchor="middle" x="2149" y="-15564.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2149" y="-15553.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep5_tp0&#45;&gt;expert1_dp1_ep5_tp0 -->
<g id="edge342" class="edge">
<title>moe_gate_dp1_ep5_tp0&#45;&gt;expert1_dp1_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2232.69,-15675.59C2214.09,-15653.01 2192.79,-15627.14 2176.33,-15607.15"/>
<polygon fill="black" stroke="black" points="2178.88,-15604.74 2169.82,-15599.25 2173.47,-15609.19 2178.88,-15604.74"/>
<text text-anchor="middle" x="2272.5" y="-15646.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep5_tp0 -->
<g id="node300" class="node">
<title>expert2_dp1_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2519.5,-15598.97 2284.5,-15598.97 2284.5,-15546.97 2519.5,-15546.97 2519.5,-15598.97"/>
<text text-anchor="middle" x="2402" y="-15586.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2402" y="-15575.97" font-family="Times,serif" font-size="10.00">GPU 74</text>
<text text-anchor="middle" x="2402" y="-15564.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2402" y="-15553.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep5_tp0&#45;&gt;expert2_dp1_ep5_tp0 -->
<g id="edge343" class="edge">
<title>moe_gate_dp1_ep5_tp0&#45;&gt;expert2_dp1_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2318.97,-15675.85C2324.06,-15669.84 2329.16,-15663.78 2334,-15657.97 2347.9,-15641.26 2363.14,-15622.48 2375.66,-15606.92"/>
<polygon fill="black" stroke="black" points="2378.41,-15609.09 2381.94,-15599.1 2372.95,-15604.71 2378.41,-15609.09"/>
<text text-anchor="middle" x="2402.5" y="-15646.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep5_tp0 -->
<g id="node301" class="node">
<title>expert_agg_dp1_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2504.33,-15483.97 2126.79,-15483.97 2029.67,-15379.97 2407.21,-15379.97 2504.33,-15483.97"/>
<text text-anchor="middle" x="2267" y="-15445.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2267" y="-15434.97" font-family="Times,serif" font-size="10.00">GPU 74</text>
<text text-anchor="middle" x="2267" y="-15423.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2267" y="-15412.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep5_tp0&#45;&gt;expert_agg_dp1_ep5_tp0 -->
<g id="edge344" class="edge">
<title>expert1_dp1_ep5_tp0&#45;&gt;expert_agg_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M2170.37,-15546.79C2183.39,-15531.46 2200.6,-15511.19 2216.88,-15492"/>
<polygon fill="black" stroke="black" points="2219.75,-15494.04 2223.55,-15484.15 2214.41,-15489.51 2219.75,-15494.04"/>
</g>
<!-- expert2_dp1_ep5_tp0&#45;&gt;expert_agg_dp1_ep5_tp0 -->
<g id="edge345" class="edge">
<title>expert2_dp1_ep5_tp0&#45;&gt;expert_agg_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M2377.55,-15546.79C2362.53,-15531.32 2342.62,-15510.82 2323.84,-15491.49"/>
<polygon fill="black" stroke="black" points="2326.19,-15488.88 2316.71,-15484.15 2321.17,-15493.76 2326.19,-15488.88"/>
</g>
<!-- ln2_dp1_ep5_tp0 -->
<g id="node302" class="node">
<title>ln2_dp1_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2381.5,-15316.97 2152.5,-15316.97 2152.5,-15264.97 2381.5,-15264.97 2381.5,-15316.97"/>
<text text-anchor="middle" x="2267" y="-15304.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2267" y="-15293.97" font-family="Times,serif" font-size="10.00">GPU 74</text>
<text text-anchor="middle" x="2267" y="-15282.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2267" y="-15271.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep5_tp0&#45;&gt;ln2_dp1_ep5_tp0 -->
<g id="edge346" class="edge">
<title>expert_agg_dp1_ep5_tp0&#45;&gt;ln2_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M2267,-15379.6C2267,-15362.26 2267,-15343.3 2267,-15327.46"/>
<polygon fill="black" stroke="black" points="2270.5,-15327.05 2267,-15317.05 2263.5,-15327.05 2270.5,-15327.05"/>
</g>
<!-- ln1_dp1_ep6_tp0 -->
<g id="node310" class="node">
<title>ln1_dp1_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2381.5,-15180.97 2152.5,-15180.97 2152.5,-15128.97 2381.5,-15128.97 2381.5,-15180.97"/>
<text text-anchor="middle" x="2267" y="-15168.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2267" y="-15157.97" font-family="Times,serif" font-size="10.00">GPU 76</text>
<text text-anchor="middle" x="2267" y="-15146.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2267" y="-15135.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep5_tp0&#45;&gt;ln1_dp1_ep6_tp0 -->
<g id="edge347" class="edge">
<title>ln2_dp1_ep5_tp0&#45;&gt;ln1_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M2267,-15264.76C2267,-15243.99 2267,-15214.28 2267,-15191.16"/>
<polygon fill="black" stroke="black" points="2270.5,-15191.06 2267,-15181.06 2263.5,-15191.06 2270.5,-15191.06"/>
</g>
<!-- mha_dp1_ep5_tp1 -->
<g id="node304" class="node">
<title>mha_dp1_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2896.5,-15868.97 2667.5,-15868.97 2667.5,-15816.97 2896.5,-15816.97 2896.5,-15868.97"/>
<text text-anchor="middle" x="2782" y="-15856.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2782" y="-15845.97" font-family="Times,serif" font-size="10.00">GPU 75</text>
<text text-anchor="middle" x="2782" y="-15834.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2782" y="-15823.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep5_tp1&#45;&gt;mha_dp1_ep5_tp1 -->
<g id="edge348" class="edge">
<title>ln1_dp1_ep5_tp1&#45;&gt;mha_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M2782,-15926.92C2782,-15912.84 2782,-15895.04 2782,-15879.54"/>
<polygon fill="black" stroke="black" points="2785.5,-15879.25 2782,-15869.25 2778.5,-15879.25 2785.5,-15879.25"/>
</g>
<!-- moe_gate_dp1_ep5_tp1 -->
<g id="node305" class="node">
<title>moe_gate_dp1_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3026.85,-15779.97 2637.35,-15779.97 2537.15,-15675.97 2926.65,-15675.97 3026.85,-15779.97"/>
<text text-anchor="middle" x="2782" y="-15741.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2782" y="-15730.97" font-family="Times,serif" font-size="10.00">GPU 75</text>
<text text-anchor="middle" x="2782" y="-15719.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2782" y="-15708.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep5_tp1&#45;&gt;moe_gate_dp1_ep5_tp1 -->
<g id="edge349" class="edge">
<title>mha_dp1_ep5_tp1&#45;&gt;moe_gate_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M2782,-15816.89C2782,-15808.96 2782,-15799.82 2782,-15790.5"/>
<polygon fill="black" stroke="black" points="2785.5,-15790.37 2782,-15780.37 2778.5,-15790.37 2785.5,-15790.37"/>
</g>
<!-- expert1_dp1_ep5_tp1 -->
<g id="node306" class="node">
<title>expert1_dp1_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2772.5,-15598.97 2537.5,-15598.97 2537.5,-15546.97 2772.5,-15546.97 2772.5,-15598.97"/>
<text text-anchor="middle" x="2655" y="-15586.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2655" y="-15575.97" font-family="Times,serif" font-size="10.00">GPU 75</text>
<text text-anchor="middle" x="2655" y="-15564.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2655" y="-15553.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep5_tp1&#45;&gt;expert1_dp1_ep5_tp1 -->
<g id="edge350" class="edge">
<title>moe_gate_dp1_ep5_tp1&#45;&gt;expert1_dp1_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2737.2,-15675.93C2732.03,-15669.91 2726.88,-15663.82 2722,-15657.97 2708.3,-15641.52 2693.42,-15622.94 2681.17,-15607.44"/>
<polygon fill="black" stroke="black" points="2683.6,-15604.87 2674.66,-15599.18 2678.1,-15609.2 2683.6,-15604.87"/>
<text text-anchor="middle" x="2779.5" y="-15646.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep5_tp1 -->
<g id="node307" class="node">
<title>expert2_dp1_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3025.5,-15598.97 2790.5,-15598.97 2790.5,-15546.97 3025.5,-15546.97 3025.5,-15598.97"/>
<text text-anchor="middle" x="2908" y="-15586.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2908" y="-15575.97" font-family="Times,serif" font-size="10.00">GPU 75</text>
<text text-anchor="middle" x="2908" y="-15564.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2908" y="-15553.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep5_tp1&#45;&gt;expert2_dp1_ep5_tp1 -->
<g id="edge351" class="edge">
<title>moe_gate_dp1_ep5_tp1&#45;&gt;expert2_dp1_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2824.31,-15675.59C2842.91,-15653.01 2864.21,-15627.14 2880.67,-15607.15"/>
<polygon fill="black" stroke="black" points="2883.53,-15609.19 2887.18,-15599.25 2878.12,-15604.74 2883.53,-15609.19"/>
<text text-anchor="middle" x="2905.5" y="-15646.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep5_tp1 -->
<g id="node308" class="node">
<title>expert_agg_dp1_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3011.33,-15483.97 2633.79,-15483.97 2536.67,-15379.97 2914.21,-15379.97 3011.33,-15483.97"/>
<text text-anchor="middle" x="2774" y="-15445.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2774" y="-15434.97" font-family="Times,serif" font-size="10.00">GPU 75</text>
<text text-anchor="middle" x="2774" y="-15423.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2774" y="-15412.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep5_tp1&#45;&gt;expert_agg_dp1_ep5_tp1 -->
<g id="edge352" class="edge">
<title>expert1_dp1_ep5_tp1&#45;&gt;expert_agg_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M2676.55,-15546.79C2689.74,-15531.39 2707.19,-15511.01 2723.68,-15491.74"/>
<polygon fill="black" stroke="black" points="2726.34,-15494.02 2730.18,-15484.15 2721.02,-15489.47 2726.34,-15494.02"/>
</g>
<!-- expert2_dp1_ep5_tp1&#45;&gt;expert_agg_dp1_ep5_tp1 -->
<g id="edge353" class="edge">
<title>expert2_dp1_ep5_tp1&#45;&gt;expert_agg_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M2883.73,-15546.79C2868.82,-15531.32 2849.06,-15510.82 2830.42,-15491.49"/>
<polygon fill="black" stroke="black" points="2832.8,-15488.92 2823.34,-15484.15 2827.76,-15493.78 2832.8,-15488.92"/>
</g>
<!-- ln2_dp1_ep5_tp1 -->
<g id="node309" class="node">
<title>ln2_dp1_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2888.5,-15316.97 2659.5,-15316.97 2659.5,-15264.97 2888.5,-15264.97 2888.5,-15316.97"/>
<text text-anchor="middle" x="2774" y="-15304.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2774" y="-15293.97" font-family="Times,serif" font-size="10.00">GPU 75</text>
<text text-anchor="middle" x="2774" y="-15282.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2774" y="-15271.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep5_tp1&#45;&gt;ln2_dp1_ep5_tp1 -->
<g id="edge354" class="edge">
<title>expert_agg_dp1_ep5_tp1&#45;&gt;ln2_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M2774,-15379.6C2774,-15362.26 2774,-15343.3 2774,-15327.46"/>
<polygon fill="black" stroke="black" points="2777.5,-15327.05 2774,-15317.05 2770.5,-15327.05 2777.5,-15327.05"/>
</g>
<!-- ln1_dp1_ep6_tp1 -->
<g id="node317" class="node">
<title>ln1_dp1_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2888.5,-15180.97 2659.5,-15180.97 2659.5,-15128.97 2888.5,-15128.97 2888.5,-15180.97"/>
<text text-anchor="middle" x="2774" y="-15168.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2774" y="-15157.97" font-family="Times,serif" font-size="10.00">GPU 77</text>
<text text-anchor="middle" x="2774" y="-15146.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2774" y="-15135.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep5_tp1&#45;&gt;ln1_dp1_ep6_tp1 -->
<g id="edge355" class="edge">
<title>ln2_dp1_ep5_tp1&#45;&gt;ln1_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M2774,-15264.76C2774,-15243.99 2774,-15214.28 2774,-15191.16"/>
<polygon fill="black" stroke="black" points="2777.5,-15191.06 2774,-15181.06 2770.5,-15191.06 2777.5,-15191.06"/>
</g>
<!-- mha_dp1_ep6_tp0 -->
<g id="node311" class="node">
<title>mha_dp1_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2381.5,-15070.97 2152.5,-15070.97 2152.5,-15018.97 2381.5,-15018.97 2381.5,-15070.97"/>
<text text-anchor="middle" x="2267" y="-15058.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2267" y="-15047.97" font-family="Times,serif" font-size="10.00">GPU 76</text>
<text text-anchor="middle" x="2267" y="-15036.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2267" y="-15025.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep6_tp0&#45;&gt;mha_dp1_ep6_tp0 -->
<g id="edge356" class="edge">
<title>ln1_dp1_ep6_tp0&#45;&gt;mha_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M2267,-15128.92C2267,-15114.84 2267,-15097.04 2267,-15081.54"/>
<polygon fill="black" stroke="black" points="2270.5,-15081.25 2267,-15071.25 2263.5,-15081.25 2270.5,-15081.25"/>
</g>
<!-- moe_gate_dp1_ep6_tp0 -->
<g id="node312" class="node">
<title>moe_gate_dp1_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2511.85,-14981.97 2122.35,-14981.97 2022.15,-14877.97 2411.65,-14877.97 2511.85,-14981.97"/>
<text text-anchor="middle" x="2267" y="-14943.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2267" y="-14932.97" font-family="Times,serif" font-size="10.00">GPU 76</text>
<text text-anchor="middle" x="2267" y="-14921.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2267" y="-14910.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep6_tp0&#45;&gt;moe_gate_dp1_ep6_tp0 -->
<g id="edge357" class="edge">
<title>mha_dp1_ep6_tp0&#45;&gt;moe_gate_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M2267,-15018.89C2267,-15010.96 2267,-15001.82 2267,-14992.5"/>
<polygon fill="black" stroke="black" points="2270.5,-14992.37 2267,-14982.37 2263.5,-14992.37 2270.5,-14992.37"/>
</g>
<!-- expert1_dp1_ep6_tp0 -->
<g id="node313" class="node">
<title>expert1_dp1_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2258.5,-14800.97 2023.5,-14800.97 2023.5,-14748.97 2258.5,-14748.97 2258.5,-14800.97"/>
<text text-anchor="middle" x="2141" y="-14788.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2141" y="-14777.97" font-family="Times,serif" font-size="10.00">GPU 76</text>
<text text-anchor="middle" x="2141" y="-14766.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2141" y="-14755.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep6_tp0&#45;&gt;expert1_dp1_ep6_tp0 -->
<g id="edge358" class="edge">
<title>moe_gate_dp1_ep6_tp0&#45;&gt;expert1_dp1_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2224.69,-14877.59C2206.09,-14855.01 2184.79,-14829.14 2168.33,-14809.15"/>
<polygon fill="black" stroke="black" points="2170.88,-14806.74 2161.82,-14801.25 2165.47,-14811.19 2170.88,-14806.74"/>
<text text-anchor="middle" x="2264.5" y="-14848.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep6_tp0 -->
<g id="node314" class="node">
<title>expert2_dp1_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2511.5,-14800.97 2276.5,-14800.97 2276.5,-14748.97 2511.5,-14748.97 2511.5,-14800.97"/>
<text text-anchor="middle" x="2394" y="-14788.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2394" y="-14777.97" font-family="Times,serif" font-size="10.00">GPU 76</text>
<text text-anchor="middle" x="2394" y="-14766.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2394" y="-14755.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep6_tp0&#45;&gt;expert2_dp1_ep6_tp0 -->
<g id="edge359" class="edge">
<title>moe_gate_dp1_ep6_tp0&#45;&gt;expert2_dp1_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2310.97,-14877.85C2316.06,-14871.84 2321.16,-14865.78 2326,-14859.97 2339.9,-14843.26 2355.14,-14824.48 2367.66,-14808.92"/>
<polygon fill="black" stroke="black" points="2370.41,-14811.09 2373.94,-14801.1 2364.95,-14806.71 2370.41,-14811.09"/>
<text text-anchor="middle" x="2394.5" y="-14848.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep6_tp0 -->
<g id="node315" class="node">
<title>expert_agg_dp1_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2504.33,-14685.97 2126.79,-14685.97 2029.67,-14581.97 2407.21,-14581.97 2504.33,-14685.97"/>
<text text-anchor="middle" x="2267" y="-14647.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2267" y="-14636.97" font-family="Times,serif" font-size="10.00">GPU 76</text>
<text text-anchor="middle" x="2267" y="-14625.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2267" y="-14614.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep6_tp0&#45;&gt;expert_agg_dp1_ep6_tp0 -->
<g id="edge360" class="edge">
<title>expert1_dp1_ep6_tp0&#45;&gt;expert_agg_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M2163.82,-14748.79C2177.78,-14733.39 2196.26,-14713.01 2213.72,-14693.74"/>
<polygon fill="black" stroke="black" points="2216.48,-14695.91 2220.6,-14686.15 2211.3,-14691.21 2216.48,-14695.91"/>
</g>
<!-- expert2_dp1_ep6_tp0&#45;&gt;expert_agg_dp1_ep6_tp0 -->
<g id="edge361" class="edge">
<title>expert2_dp1_ep6_tp0&#45;&gt;expert_agg_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M2371,-14748.79C2356.93,-14733.39 2338.3,-14713.01 2320.7,-14693.74"/>
<polygon fill="black" stroke="black" points="2323.09,-14691.17 2313.76,-14686.15 2317.93,-14695.89 2323.09,-14691.17"/>
</g>
<!-- ln2_dp1_ep6_tp0 -->
<g id="node316" class="node">
<title>ln2_dp1_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2381.5,-14518.97 2152.5,-14518.97 2152.5,-14466.97 2381.5,-14466.97 2381.5,-14518.97"/>
<text text-anchor="middle" x="2267" y="-14506.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2267" y="-14495.97" font-family="Times,serif" font-size="10.00">GPU 76</text>
<text text-anchor="middle" x="2267" y="-14484.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2267" y="-14473.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep6_tp0&#45;&gt;ln2_dp1_ep6_tp0 -->
<g id="edge362" class="edge">
<title>expert_agg_dp1_ep6_tp0&#45;&gt;ln2_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M2267,-14581.6C2267,-14564.26 2267,-14545.3 2267,-14529.46"/>
<polygon fill="black" stroke="black" points="2270.5,-14529.05 2267,-14519.05 2263.5,-14529.05 2270.5,-14529.05"/>
</g>
<!-- ln1_dp1_ep7_tp0 -->
<g id="node324" class="node">
<title>ln1_dp1_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2381.5,-14382.97 2152.5,-14382.97 2152.5,-14330.97 2381.5,-14330.97 2381.5,-14382.97"/>
<text text-anchor="middle" x="2267" y="-14370.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2267" y="-14359.97" font-family="Times,serif" font-size="10.00">GPU 78</text>
<text text-anchor="middle" x="2267" y="-14348.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2267" y="-14337.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep6_tp0&#45;&gt;ln1_dp1_ep7_tp0 -->
<g id="edge363" class="edge">
<title>ln2_dp1_ep6_tp0&#45;&gt;ln1_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M2267,-14466.76C2267,-14445.99 2267,-14416.28 2267,-14393.16"/>
<polygon fill="black" stroke="black" points="2270.5,-14393.06 2267,-14383.06 2263.5,-14393.06 2270.5,-14393.06"/>
</g>
<!-- mha_dp1_ep6_tp1 -->
<g id="node318" class="node">
<title>mha_dp1_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2888.5,-15070.97 2659.5,-15070.97 2659.5,-15018.97 2888.5,-15018.97 2888.5,-15070.97"/>
<text text-anchor="middle" x="2774" y="-15058.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2774" y="-15047.97" font-family="Times,serif" font-size="10.00">GPU 77</text>
<text text-anchor="middle" x="2774" y="-15036.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2774" y="-15025.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep6_tp1&#45;&gt;mha_dp1_ep6_tp1 -->
<g id="edge364" class="edge">
<title>ln1_dp1_ep6_tp1&#45;&gt;mha_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M2774,-15128.92C2774,-15114.84 2774,-15097.04 2774,-15081.54"/>
<polygon fill="black" stroke="black" points="2777.5,-15081.25 2774,-15071.25 2770.5,-15081.25 2777.5,-15081.25"/>
</g>
<!-- moe_gate_dp1_ep6_tp1 -->
<g id="node319" class="node">
<title>moe_gate_dp1_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3018.85,-14981.97 2629.35,-14981.97 2529.15,-14877.97 2918.65,-14877.97 3018.85,-14981.97"/>
<text text-anchor="middle" x="2774" y="-14943.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2774" y="-14932.97" font-family="Times,serif" font-size="10.00">GPU 77</text>
<text text-anchor="middle" x="2774" y="-14921.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2774" y="-14910.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep6_tp1&#45;&gt;moe_gate_dp1_ep6_tp1 -->
<g id="edge365" class="edge">
<title>mha_dp1_ep6_tp1&#45;&gt;moe_gate_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M2774,-15018.89C2774,-15010.96 2774,-15001.82 2774,-14992.5"/>
<polygon fill="black" stroke="black" points="2777.5,-14992.37 2774,-14982.37 2770.5,-14992.37 2777.5,-14992.37"/>
</g>
<!-- expert1_dp1_ep6_tp1 -->
<g id="node320" class="node">
<title>expert1_dp1_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2764.5,-14800.97 2529.5,-14800.97 2529.5,-14748.97 2764.5,-14748.97 2764.5,-14800.97"/>
<text text-anchor="middle" x="2647" y="-14788.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2647" y="-14777.97" font-family="Times,serif" font-size="10.00">GPU 77</text>
<text text-anchor="middle" x="2647" y="-14766.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2647" y="-14755.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep6_tp1&#45;&gt;expert1_dp1_ep6_tp1 -->
<g id="edge366" class="edge">
<title>moe_gate_dp1_ep6_tp1&#45;&gt;expert1_dp1_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2729.2,-14877.93C2724.03,-14871.91 2718.88,-14865.82 2714,-14859.97 2700.3,-14843.52 2685.42,-14824.94 2673.17,-14809.44"/>
<polygon fill="black" stroke="black" points="2675.6,-14806.87 2666.66,-14801.18 2670.1,-14811.2 2675.6,-14806.87"/>
<text text-anchor="middle" x="2771.5" y="-14848.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep6_tp1 -->
<g id="node321" class="node">
<title>expert2_dp1_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3017.5,-14800.97 2782.5,-14800.97 2782.5,-14748.97 3017.5,-14748.97 3017.5,-14800.97"/>
<text text-anchor="middle" x="2900" y="-14788.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2900" y="-14777.97" font-family="Times,serif" font-size="10.00">GPU 77</text>
<text text-anchor="middle" x="2900" y="-14766.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2900" y="-14755.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep6_tp1&#45;&gt;expert2_dp1_ep6_tp1 -->
<g id="edge367" class="edge">
<title>moe_gate_dp1_ep6_tp1&#45;&gt;expert2_dp1_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2816.31,-14877.59C2834.91,-14855.01 2856.21,-14829.14 2872.67,-14809.15"/>
<polygon fill="black" stroke="black" points="2875.53,-14811.19 2879.18,-14801.25 2870.12,-14806.74 2875.53,-14811.19"/>
<text text-anchor="middle" x="2897.5" y="-14848.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep6_tp1 -->
<g id="node322" class="node">
<title>expert_agg_dp1_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3011.33,-14685.97 2633.79,-14685.97 2536.67,-14581.97 2914.21,-14581.97 3011.33,-14685.97"/>
<text text-anchor="middle" x="2774" y="-14647.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2774" y="-14636.97" font-family="Times,serif" font-size="10.00">GPU 77</text>
<text text-anchor="middle" x="2774" y="-14625.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2774" y="-14614.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep6_tp1&#45;&gt;expert_agg_dp1_ep6_tp1 -->
<g id="edge368" class="edge">
<title>expert1_dp1_ep6_tp1&#45;&gt;expert_agg_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M2670,-14748.79C2684.07,-14733.39 2702.7,-14713.01 2720.3,-14693.74"/>
<polygon fill="black" stroke="black" points="2723.07,-14695.89 2727.24,-14686.15 2717.91,-14691.17 2723.07,-14695.89"/>
</g>
<!-- expert2_dp1_ep6_tp1&#45;&gt;expert_agg_dp1_ep6_tp1 -->
<g id="edge369" class="edge">
<title>expert2_dp1_ep6_tp1&#45;&gt;expert_agg_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M2877.18,-14748.79C2863.22,-14733.39 2844.74,-14713.01 2827.28,-14693.74"/>
<polygon fill="black" stroke="black" points="2829.7,-14691.21 2820.4,-14686.15 2824.52,-14695.91 2829.7,-14691.21"/>
</g>
<!-- ln2_dp1_ep6_tp1 -->
<g id="node323" class="node">
<title>ln2_dp1_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2888.5,-14518.97 2659.5,-14518.97 2659.5,-14466.97 2888.5,-14466.97 2888.5,-14518.97"/>
<text text-anchor="middle" x="2774" y="-14506.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2774" y="-14495.97" font-family="Times,serif" font-size="10.00">GPU 77</text>
<text text-anchor="middle" x="2774" y="-14484.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2774" y="-14473.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep6_tp1&#45;&gt;ln2_dp1_ep6_tp1 -->
<g id="edge370" class="edge">
<title>expert_agg_dp1_ep6_tp1&#45;&gt;ln2_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M2774,-14581.6C2774,-14564.26 2774,-14545.3 2774,-14529.46"/>
<polygon fill="black" stroke="black" points="2777.5,-14529.05 2774,-14519.05 2770.5,-14529.05 2777.5,-14529.05"/>
</g>
<!-- ln1_dp1_ep7_tp1 -->
<g id="node331" class="node">
<title>ln1_dp1_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2888.5,-14382.97 2659.5,-14382.97 2659.5,-14330.97 2888.5,-14330.97 2888.5,-14382.97"/>
<text text-anchor="middle" x="2774" y="-14370.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2774" y="-14359.97" font-family="Times,serif" font-size="10.00">GPU 79</text>
<text text-anchor="middle" x="2774" y="-14348.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2774" y="-14337.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp1_ep6_tp1&#45;&gt;ln1_dp1_ep7_tp1 -->
<g id="edge371" class="edge">
<title>ln2_dp1_ep6_tp1&#45;&gt;ln1_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2774,-14466.76C2774,-14445.99 2774,-14416.28 2774,-14393.16"/>
<polygon fill="black" stroke="black" points="2777.5,-14393.06 2774,-14383.06 2770.5,-14393.06 2777.5,-14393.06"/>
</g>
<!-- mha_dp1_ep7_tp0 -->
<g id="node325" class="node">
<title>mha_dp1_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2381.5,-14272.97 2152.5,-14272.97 2152.5,-14220.97 2381.5,-14220.97 2381.5,-14272.97"/>
<text text-anchor="middle" x="2267" y="-14260.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2267" y="-14249.97" font-family="Times,serif" font-size="10.00">GPU 78</text>
<text text-anchor="middle" x="2267" y="-14238.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2267" y="-14227.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep7_tp0&#45;&gt;mha_dp1_ep7_tp0 -->
<g id="edge372" class="edge">
<title>ln1_dp1_ep7_tp0&#45;&gt;mha_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M2267,-14330.92C2267,-14316.84 2267,-14299.04 2267,-14283.54"/>
<polygon fill="black" stroke="black" points="2270.5,-14283.25 2267,-14273.25 2263.5,-14283.25 2270.5,-14283.25"/>
</g>
<!-- moe_gate_dp1_ep7_tp0 -->
<g id="node326" class="node">
<title>moe_gate_dp1_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2511.85,-14183.97 2122.35,-14183.97 2022.15,-14079.97 2411.65,-14079.97 2511.85,-14183.97"/>
<text text-anchor="middle" x="2267" y="-14145.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2267" y="-14134.97" font-family="Times,serif" font-size="10.00">GPU 78</text>
<text text-anchor="middle" x="2267" y="-14123.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2267" y="-14112.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep7_tp0&#45;&gt;moe_gate_dp1_ep7_tp0 -->
<g id="edge373" class="edge">
<title>mha_dp1_ep7_tp0&#45;&gt;moe_gate_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M2267,-14220.89C2267,-14212.96 2267,-14203.82 2267,-14194.5"/>
<polygon fill="black" stroke="black" points="2270.5,-14194.37 2267,-14184.37 2263.5,-14194.37 2270.5,-14194.37"/>
</g>
<!-- expert1_dp1_ep7_tp0 -->
<g id="node327" class="node">
<title>expert1_dp1_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2258.5,-14002.97 2023.5,-14002.97 2023.5,-13950.97 2258.5,-13950.97 2258.5,-14002.97"/>
<text text-anchor="middle" x="2141" y="-13990.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2141" y="-13979.97" font-family="Times,serif" font-size="10.00">GPU 78</text>
<text text-anchor="middle" x="2141" y="-13968.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2141" y="-13957.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep7_tp0&#45;&gt;expert1_dp1_ep7_tp0 -->
<g id="edge374" class="edge">
<title>moe_gate_dp1_ep7_tp0&#45;&gt;expert1_dp1_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2224.69,-14079.59C2206.09,-14057.01 2184.79,-14031.14 2168.33,-14011.15"/>
<polygon fill="black" stroke="black" points="2170.88,-14008.74 2161.82,-14003.25 2165.47,-14013.19 2170.88,-14008.74"/>
<text text-anchor="middle" x="2264.5" y="-14050.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep7_tp0 -->
<g id="node328" class="node">
<title>expert2_dp1_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2511.5,-14002.97 2276.5,-14002.97 2276.5,-13950.97 2511.5,-13950.97 2511.5,-14002.97"/>
<text text-anchor="middle" x="2394" y="-13990.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2394" y="-13979.97" font-family="Times,serif" font-size="10.00">GPU 78</text>
<text text-anchor="middle" x="2394" y="-13968.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2394" y="-13957.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep7_tp0&#45;&gt;expert2_dp1_ep7_tp0 -->
<g id="edge375" class="edge">
<title>moe_gate_dp1_ep7_tp0&#45;&gt;expert2_dp1_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2310.97,-14079.85C2316.06,-14073.84 2321.16,-14067.78 2326,-14061.97 2339.9,-14045.26 2355.14,-14026.48 2367.66,-14010.92"/>
<polygon fill="black" stroke="black" points="2370.41,-14013.09 2373.94,-14003.1 2364.95,-14008.71 2370.41,-14013.09"/>
<text text-anchor="middle" x="2394.5" y="-14050.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep7_tp0 -->
<g id="node329" class="node">
<title>expert_agg_dp1_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2496.33,-13887.97 2118.79,-13887.97 2021.67,-13783.97 2399.21,-13783.97 2496.33,-13887.97"/>
<text text-anchor="middle" x="2259" y="-13849.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2259" y="-13838.97" font-family="Times,serif" font-size="10.00">GPU 78</text>
<text text-anchor="middle" x="2259" y="-13827.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2259" y="-13816.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep7_tp0&#45;&gt;expert_agg_dp1_ep7_tp0 -->
<g id="edge376" class="edge">
<title>expert1_dp1_ep7_tp0&#45;&gt;expert_agg_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M2162.37,-13950.79C2175.39,-13935.46 2192.6,-13915.19 2208.88,-13896"/>
<polygon fill="black" stroke="black" points="2211.75,-13898.04 2215.55,-13888.15 2206.41,-13893.51 2211.75,-13898.04"/>
</g>
<!-- expert2_dp1_ep7_tp0&#45;&gt;expert_agg_dp1_ep7_tp0 -->
<g id="edge377" class="edge">
<title>expert2_dp1_ep7_tp0&#45;&gt;expert_agg_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M2369.55,-13950.79C2354.53,-13935.32 2334.62,-13914.82 2315.84,-13895.49"/>
<polygon fill="black" stroke="black" points="2318.19,-13892.88 2308.71,-13888.15 2313.17,-13897.76 2318.19,-13892.88"/>
</g>
<!-- ln2_dp1_ep7_tp0 -->
<g id="node330" class="node">
<title>ln2_dp1_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2312.5,-13720.97 2083.5,-13720.97 2083.5,-13668.97 2312.5,-13668.97 2312.5,-13720.97"/>
<text text-anchor="middle" x="2198" y="-13708.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2198" y="-13697.97" font-family="Times,serif" font-size="10.00">GPU 78</text>
<text text-anchor="middle" x="2198" y="-13686.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2198" y="-13675.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep7_tp0&#45;&gt;ln2_dp1_ep7_tp0 -->
<g id="edge378" class="edge">
<title>expert_agg_dp1_ep7_tp0&#45;&gt;ln2_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M2236.46,-13783.6C2228.7,-13765.93 2220.21,-13746.57 2213.18,-13730.55"/>
<polygon fill="black" stroke="black" points="2216.23,-13728.8 2209.01,-13721.05 2209.82,-13731.62 2216.23,-13728.8"/>
</g>
<!-- comm_pipeline_dp1_ep7_tp0 -->
<g id="node1057" class="node">
<title>comm_pipeline_dp1_ep7_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="2115" cy="-13558.97" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="2115" y="-13567.47" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="2115" y="-13556.47" font-family="Times,serif" font-size="10.00">GPU 78â†’94</text>
<text text-anchor="middle" x="2115" y="-13545.47" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- ln2_dp1_ep7_tp0&#45;&gt;comm_pipeline_dp1_ep7_tp0 -->
<g id="edge379" class="edge">
<title>ln2_dp1_ep7_tp0&#45;&gt;comm_pipeline_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M2182.39,-13668.76C2169.7,-13648.28 2151.64,-13619.13 2137.41,-13596.15"/>
<polygon fill="black" stroke="black" points="2140.21,-13594.02 2131.97,-13587.36 2134.26,-13597.71 2140.21,-13594.02"/>
</g>
<!-- mha_dp1_ep7_tp1 -->
<g id="node332" class="node">
<title>mha_dp1_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2888.5,-14272.97 2659.5,-14272.97 2659.5,-14220.97 2888.5,-14220.97 2888.5,-14272.97"/>
<text text-anchor="middle" x="2774" y="-14260.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2774" y="-14249.97" font-family="Times,serif" font-size="10.00">GPU 79</text>
<text text-anchor="middle" x="2774" y="-14238.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2774" y="-14227.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp1_ep7_tp1&#45;&gt;mha_dp1_ep7_tp1 -->
<g id="edge381" class="edge">
<title>ln1_dp1_ep7_tp1&#45;&gt;mha_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2774,-14330.92C2774,-14316.84 2774,-14299.04 2774,-14283.54"/>
<polygon fill="black" stroke="black" points="2777.5,-14283.25 2774,-14273.25 2770.5,-14283.25 2777.5,-14283.25"/>
</g>
<!-- moe_gate_dp1_ep7_tp1 -->
<g id="node333" class="node">
<title>moe_gate_dp1_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3018.85,-14183.97 2629.35,-14183.97 2529.15,-14079.97 2918.65,-14079.97 3018.85,-14183.97"/>
<text text-anchor="middle" x="2774" y="-14145.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2774" y="-14134.97" font-family="Times,serif" font-size="10.00">GPU 79</text>
<text text-anchor="middle" x="2774" y="-14123.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2774" y="-14112.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp1_ep7_tp1&#45;&gt;moe_gate_dp1_ep7_tp1 -->
<g id="edge382" class="edge">
<title>mha_dp1_ep7_tp1&#45;&gt;moe_gate_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2774,-14220.89C2774,-14212.96 2774,-14203.82 2774,-14194.5"/>
<polygon fill="black" stroke="black" points="2777.5,-14194.37 2774,-14184.37 2770.5,-14194.37 2777.5,-14194.37"/>
</g>
<!-- expert1_dp1_ep7_tp1 -->
<g id="node334" class="node">
<title>expert1_dp1_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2764.5,-14002.97 2529.5,-14002.97 2529.5,-13950.97 2764.5,-13950.97 2764.5,-14002.97"/>
<text text-anchor="middle" x="2647" y="-13990.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2647" y="-13979.97" font-family="Times,serif" font-size="10.00">GPU 79</text>
<text text-anchor="middle" x="2647" y="-13968.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2647" y="-13957.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep7_tp1&#45;&gt;expert1_dp1_ep7_tp1 -->
<g id="edge383" class="edge">
<title>moe_gate_dp1_ep7_tp1&#45;&gt;expert1_dp1_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2729.2,-14079.93C2724.03,-14073.91 2718.88,-14067.82 2714,-14061.97 2700.3,-14045.52 2685.42,-14026.94 2673.17,-14011.44"/>
<polygon fill="black" stroke="black" points="2675.6,-14008.87 2666.66,-14003.18 2670.1,-14013.2 2675.6,-14008.87"/>
<text text-anchor="middle" x="2771.5" y="-14050.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp1_ep7_tp1 -->
<g id="node335" class="node">
<title>expert2_dp1_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3017.5,-14002.97 2782.5,-14002.97 2782.5,-13950.97 3017.5,-13950.97 3017.5,-14002.97"/>
<text text-anchor="middle" x="2900" y="-13990.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2900" y="-13979.97" font-family="Times,serif" font-size="10.00">GPU 79</text>
<text text-anchor="middle" x="2900" y="-13968.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2900" y="-13957.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp1_ep7_tp1&#45;&gt;expert2_dp1_ep7_tp1 -->
<g id="edge384" class="edge">
<title>moe_gate_dp1_ep7_tp1&#45;&gt;expert2_dp1_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2816.31,-14079.59C2834.91,-14057.01 2856.21,-14031.14 2872.67,-14011.15"/>
<polygon fill="black" stroke="black" points="2875.53,-14013.19 2879.18,-14003.25 2870.12,-14008.74 2875.53,-14013.19"/>
<text text-anchor="middle" x="2897.5" y="-14050.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp1_ep7_tp1 -->
<g id="node336" class="node">
<title>expert_agg_dp1_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2989.33,-13887.97 2611.79,-13887.97 2514.67,-13783.97 2892.21,-13783.97 2989.33,-13887.97"/>
<text text-anchor="middle" x="2752" y="-13849.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2752" y="-13838.97" font-family="Times,serif" font-size="10.00">GPU 79</text>
<text text-anchor="middle" x="2752" y="-13827.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2752" y="-13816.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp1_ep7_tp1&#45;&gt;expert_agg_dp1_ep7_tp1 -->
<g id="edge385" class="edge">
<title>expert1_dp1_ep7_tp1&#45;&gt;expert_agg_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2666.01,-13950.79C2677.55,-13935.53 2692.78,-13915.37 2707.21,-13896.26"/>
<polygon fill="black" stroke="black" points="2710.1,-13898.24 2713.34,-13888.15 2704.52,-13894.02 2710.1,-13898.24"/>
</g>
<!-- expert2_dp1_ep7_tp1&#45;&gt;expert_agg_dp1_ep7_tp1 -->
<g id="edge386" class="edge">
<title>expert2_dp1_ep7_tp1&#45;&gt;expert_agg_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2873.2,-13950.79C2856.65,-13935.26 2834.71,-13914.64 2814.04,-13895.23"/>
<polygon fill="black" stroke="black" points="2816.18,-13892.44 2806.5,-13888.15 2811.39,-13897.55 2816.18,-13892.44"/>
</g>
<!-- ln2_dp1_ep7_tp1 -->
<g id="node337" class="node">
<title>ln2_dp1_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2712.5,-13720.97 2483.5,-13720.97 2483.5,-13668.97 2712.5,-13668.97 2712.5,-13720.97"/>
<text text-anchor="middle" x="2598" y="-13708.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2598" y="-13697.97" font-family="Times,serif" font-size="10.00">GPU 79</text>
<text text-anchor="middle" x="2598" y="-13686.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2598" y="-13675.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp1_ep7_tp1&#45;&gt;ln2_dp1_ep7_tp1 -->
<g id="edge387" class="edge">
<title>expert_agg_dp1_ep7_tp1&#45;&gt;ln2_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2695.09,-13783.6C2674.4,-13764.93 2651.63,-13744.37 2633.34,-13727.86"/>
<polygon fill="black" stroke="black" points="2635.56,-13725.16 2625.8,-13721.05 2630.87,-13730.35 2635.56,-13725.16"/>
</g>
<!-- comm_pipeline_dp1_ep7_tp1 -->
<g id="node1058" class="node">
<title>comm_pipeline_dp1_ep7_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="2307" cy="-13558.97" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="2307" y="-13567.47" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="2307" y="-13556.47" font-family="Times,serif" font-size="10.00">GPU 79â†’95</text>
<text text-anchor="middle" x="2307" y="-13545.47" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- ln2_dp1_ep7_tp1&#45;&gt;comm_pipeline_dp1_ep7_tp1 -->
<g id="edge388" class="edge">
<title>ln2_dp1_ep7_tp1&#45;&gt;comm_pipeline_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2524.43,-13668.88C2486.04,-13654.89 2438.71,-13636.22 2398,-13615.97 2382.87,-13608.44 2366.99,-13599.18 2352.8,-13590.37"/>
<polygon fill="black" stroke="black" points="2354.54,-13587.33 2344.21,-13584.96 2350.81,-13593.25 2354.54,-13587.33"/>
</g>
<!-- stage2_mha_dp1_ep0_tp0 -->
<g id="node339" class="node">
<title>stage2_mha_dp1_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1378.5,-18945.97 1149.5,-18945.97 1149.5,-18893.97 1378.5,-18893.97 1378.5,-18945.97"/>
<text text-anchor="middle" x="1264" y="-18933.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1264" y="-18922.97" font-family="Times,serif" font-size="10.00">GPU 80</text>
<text text-anchor="middle" x="1264" y="-18911.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1264" y="-18900.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep0_tp0&#45;&gt;stage2_mha_dp1_ep0_tp0 -->
<g id="edge390" class="edge">
<title>stage2_ln1_dp1_ep0_tp0&#45;&gt;stage2_mha_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M1264,-19008.89C1264,-18993.38 1264,-18973.24 1264,-18956.15"/>
<polygon fill="black" stroke="black" points="1267.5,-18955.97 1264,-18945.97 1260.5,-18955.97 1267.5,-18955.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep0_tp0 -->
<g id="node340" class="node">
<title>stage2_moe_gate_dp1_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1508.85,-18816.97 1119.35,-18816.97 1019.15,-18712.97 1408.65,-18712.97 1508.85,-18816.97"/>
<text text-anchor="middle" x="1264" y="-18778.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1264" y="-18767.97" font-family="Times,serif" font-size="10.00">GPU 80</text>
<text text-anchor="middle" x="1264" y="-18756.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1264" y="-18745.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep0_tp0&#45;&gt;stage2_moe_gate_dp1_ep0_tp0 -->
<g id="edge391" class="edge">
<title>stage2_mha_dp1_ep0_tp0&#45;&gt;stage2_moe_gate_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M1264,-18893.7C1264,-18875.59 1264,-18850.38 1264,-18827.14"/>
<polygon fill="black" stroke="black" points="1267.5,-18826.98 1264,-18816.98 1260.5,-18826.98 1267.5,-18826.98"/>
</g>
<!-- stage2_expert1_dp1_ep0_tp0 -->
<g id="node341" class="node">
<title>stage2_expert1_dp1_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1255.5,-18649.97 1020.5,-18649.97 1020.5,-18597.97 1255.5,-18597.97 1255.5,-18649.97"/>
<text text-anchor="middle" x="1138" y="-18637.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1138" y="-18626.97" font-family="Times,serif" font-size="10.00">GPU 80</text>
<text text-anchor="middle" x="1138" y="-18615.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1138" y="-18604.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep0_tp0&#45;&gt;stage2_expert1_dp1_ep0_tp0 -->
<g id="edge392" class="edge">
<title>stage2_moe_gate_dp1_ep0_tp0&#45;&gt;stage2_expert1_dp1_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1217.44,-18712.6C1200.81,-18694.26 1182.54,-18674.1 1167.72,-18657.75"/>
<polygon fill="black" stroke="black" points="1170.05,-18655.11 1160.74,-18650.05 1164.87,-18659.81 1170.05,-18655.11"/>
</g>
<!-- stage2_expert2_dp1_ep0_tp0 -->
<g id="node342" class="node">
<title>stage2_expert2_dp1_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1508.5,-18649.97 1273.5,-18649.97 1273.5,-18597.97 1508.5,-18597.97 1508.5,-18649.97"/>
<text text-anchor="middle" x="1391" y="-18637.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1391" y="-18626.97" font-family="Times,serif" font-size="10.00">GPU 80</text>
<text text-anchor="middle" x="1391" y="-18615.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1391" y="-18604.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep0_tp0&#45;&gt;stage2_expert2_dp1_ep0_tp0 -->
<g id="edge393" class="edge">
<title>stage2_moe_gate_dp1_ep0_tp0&#45;&gt;stage2_expert2_dp1_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1310.93,-18712.6C1327.69,-18694.26 1346.1,-18674.1 1361.04,-18657.75"/>
<polygon fill="black" stroke="black" points="1363.92,-18659.8 1368.08,-18650.05 1358.75,-18655.08 1363.92,-18659.8"/>
</g>
<!-- stage2_expert_agg_dp1_ep0_tp0 -->
<g id="node343" class="node">
<title>stage2_expert_agg_dp1_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1503.33,-18534.97 1125.79,-18534.97 1028.67,-18430.97 1406.21,-18430.97 1503.33,-18534.97"/>
<text text-anchor="middle" x="1266" y="-18496.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1266" y="-18485.97" font-family="Times,serif" font-size="10.00">GPU 80</text>
<text text-anchor="middle" x="1266" y="-18474.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1266" y="-18463.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep0_tp0&#45;&gt;stage2_expert_agg_dp1_ep0_tp0 -->
<g id="edge394" class="edge">
<title>stage2_expert1_dp1_ep0_tp0&#45;&gt;stage2_expert_agg_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M1161.18,-18597.79C1175.36,-18582.39 1194.14,-18562.01 1211.87,-18542.74"/>
<polygon fill="black" stroke="black" points="1214.67,-18544.88 1218.87,-18535.15 1209.52,-18540.13 1214.67,-18544.88"/>
</g>
<!-- stage2_expert2_dp1_ep0_tp0&#45;&gt;stage2_expert_agg_dp1_ep0_tp0 -->
<g id="edge395" class="edge">
<title>stage2_expert2_dp1_ep0_tp0&#45;&gt;stage2_expert_agg_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M1368.36,-18597.79C1354.51,-18582.39 1336.18,-18562.01 1318.86,-18542.74"/>
<polygon fill="black" stroke="black" points="1321.32,-18540.24 1312.03,-18535.15 1316.11,-18544.92 1321.32,-18540.24"/>
</g>
<!-- stage2_ln2_dp1_ep0_tp0 -->
<g id="node344" class="node">
<title>stage2_ln2_dp1_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1380.5,-18372.97 1151.5,-18372.97 1151.5,-18320.97 1380.5,-18320.97 1380.5,-18372.97"/>
<text text-anchor="middle" x="1266" y="-18360.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1266" y="-18349.97" font-family="Times,serif" font-size="10.00">GPU 80</text>
<text text-anchor="middle" x="1266" y="-18338.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1266" y="-18327.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep0_tp0&#45;&gt;stage2_ln2_dp1_ep0_tp0 -->
<g id="edge396" class="edge">
<title>stage2_expert_agg_dp1_ep0_tp0&#45;&gt;stage2_ln2_dp1_ep0_tp0</title>
<path fill="none" stroke="black" d="M1266,-18430.92C1266,-18414.97 1266,-18397.74 1266,-18383.14"/>
<polygon fill="black" stroke="black" points="1269.5,-18383.02 1266,-18373.02 1262.5,-18383.02 1269.5,-18383.02"/>
</g>
<!-- stage2_ln1_dp1_ep1_tp0 -->
<g id="node352" class="node">
<title>stage2_ln1_dp1_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1380.5,-18262.97 1151.5,-18262.97 1151.5,-18210.97 1380.5,-18210.97 1380.5,-18262.97"/>
<text text-anchor="middle" x="1266" y="-18250.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1266" y="-18239.97" font-family="Times,serif" font-size="10.00">GPU 82</text>
<text text-anchor="middle" x="1266" y="-18228.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1266" y="-18217.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep0_tp0&#45;&gt;stage2_ln1_dp1_ep1_tp0 -->
<g id="edge397" class="edge">
<title>stage2_ln2_dp1_ep0_tp0&#45;&gt;stage2_ln1_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M1266,-18320.92C1266,-18306.84 1266,-18289.04 1266,-18273.54"/>
<polygon fill="black" stroke="black" points="1269.5,-18273.25 1266,-18263.25 1262.5,-18273.25 1269.5,-18273.25"/>
</g>
<!-- stage2_mha_dp1_ep0_tp1 -->
<g id="node346" class="node">
<title>stage2_mha_dp1_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1885.5,-18945.97 1656.5,-18945.97 1656.5,-18893.97 1885.5,-18893.97 1885.5,-18945.97"/>
<text text-anchor="middle" x="1771" y="-18933.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1771" y="-18922.97" font-family="Times,serif" font-size="10.00">GPU 81</text>
<text text-anchor="middle" x="1771" y="-18911.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1771" y="-18900.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep0_tp1&#45;&gt;stage2_mha_dp1_ep0_tp1 -->
<g id="edge398" class="edge">
<title>stage2_ln1_dp1_ep0_tp1&#45;&gt;stage2_mha_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M1771,-19008.89C1771,-18993.38 1771,-18973.24 1771,-18956.15"/>
<polygon fill="black" stroke="black" points="1774.5,-18955.97 1771,-18945.97 1767.5,-18955.97 1774.5,-18955.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep0_tp1 -->
<g id="node347" class="node">
<title>stage2_moe_gate_dp1_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2015.85,-18816.97 1626.35,-18816.97 1526.15,-18712.97 1915.65,-18712.97 2015.85,-18816.97"/>
<text text-anchor="middle" x="1771" y="-18778.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1771" y="-18767.97" font-family="Times,serif" font-size="10.00">GPU 81</text>
<text text-anchor="middle" x="1771" y="-18756.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1771" y="-18745.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep0_tp1&#45;&gt;stage2_moe_gate_dp1_ep0_tp1 -->
<g id="edge399" class="edge">
<title>stage2_mha_dp1_ep0_tp1&#45;&gt;stage2_moe_gate_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M1771,-18893.7C1771,-18875.59 1771,-18850.38 1771,-18827.14"/>
<polygon fill="black" stroke="black" points="1774.5,-18826.98 1771,-18816.98 1767.5,-18826.98 1774.5,-18826.98"/>
</g>
<!-- stage2_expert1_dp1_ep0_tp1 -->
<g id="node348" class="node">
<title>stage2_expert1_dp1_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1761.5,-18649.97 1526.5,-18649.97 1526.5,-18597.97 1761.5,-18597.97 1761.5,-18649.97"/>
<text text-anchor="middle" x="1644" y="-18637.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1644" y="-18626.97" font-family="Times,serif" font-size="10.00">GPU 81</text>
<text text-anchor="middle" x="1644" y="-18615.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1644" y="-18604.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep0_tp1&#45;&gt;stage2_expert1_dp1_ep0_tp1 -->
<g id="edge400" class="edge">
<title>stage2_moe_gate_dp1_ep0_tp1&#45;&gt;stage2_expert1_dp1_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1724.07,-18712.6C1707.31,-18694.26 1688.9,-18674.1 1673.96,-18657.75"/>
<polygon fill="black" stroke="black" points="1676.25,-18655.08 1666.92,-18650.05 1671.08,-18659.8 1676.25,-18655.08"/>
</g>
<!-- stage2_expert2_dp1_ep0_tp1 -->
<g id="node349" class="node">
<title>stage2_expert2_dp1_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2014.5,-18649.97 1779.5,-18649.97 1779.5,-18597.97 2014.5,-18597.97 2014.5,-18649.97"/>
<text text-anchor="middle" x="1897" y="-18637.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1897" y="-18626.97" font-family="Times,serif" font-size="10.00">GPU 81</text>
<text text-anchor="middle" x="1897" y="-18615.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1897" y="-18604.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep0_tp1&#45;&gt;stage2_expert2_dp1_ep0_tp1 -->
<g id="edge401" class="edge">
<title>stage2_moe_gate_dp1_ep0_tp1&#45;&gt;stage2_expert2_dp1_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1817.56,-18712.6C1834.19,-18694.26 1852.46,-18674.1 1867.28,-18657.75"/>
<polygon fill="black" stroke="black" points="1870.13,-18659.81 1874.26,-18650.05 1864.95,-18655.11 1870.13,-18659.81"/>
</g>
<!-- stage2_expert_agg_dp1_ep0_tp1 -->
<g id="node350" class="node">
<title>stage2_expert_agg_dp1_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2010.33,-18534.97 1632.79,-18534.97 1535.67,-18430.97 1913.21,-18430.97 2010.33,-18534.97"/>
<text text-anchor="middle" x="1773" y="-18496.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1773" y="-18485.97" font-family="Times,serif" font-size="10.00">GPU 81</text>
<text text-anchor="middle" x="1773" y="-18474.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1773" y="-18463.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep0_tp1&#45;&gt;stage2_expert_agg_dp1_ep0_tp1 -->
<g id="edge402" class="edge">
<title>stage2_expert1_dp1_ep0_tp1&#45;&gt;stage2_expert_agg_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M1667.36,-18597.79C1681.72,-18582.32 1700.74,-18561.82 1718.69,-18542.49"/>
<polygon fill="black" stroke="black" points="1721.26,-18544.86 1725.5,-18535.15 1716.13,-18540.1 1721.26,-18544.86"/>
</g>
<!-- stage2_expert2_dp1_ep0_tp1&#45;&gt;stage2_expert_agg_dp1_ep0_tp1 -->
<g id="edge403" class="edge">
<title>stage2_expert2_dp1_ep0_tp1&#45;&gt;stage2_expert_agg_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M1874.54,-18597.79C1860.8,-18582.39 1842.62,-18562.01 1825.44,-18542.74"/>
<polygon fill="black" stroke="black" points="1827.93,-18540.28 1818.66,-18535.15 1822.7,-18544.94 1827.93,-18540.28"/>
</g>
<!-- stage2_ln2_dp1_ep0_tp1 -->
<g id="node351" class="node">
<title>stage2_ln2_dp1_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1887.5,-18372.97 1658.5,-18372.97 1658.5,-18320.97 1887.5,-18320.97 1887.5,-18372.97"/>
<text text-anchor="middle" x="1773" y="-18360.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1773" y="-18349.97" font-family="Times,serif" font-size="10.00">GPU 81</text>
<text text-anchor="middle" x="1773" y="-18338.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1773" y="-18327.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep0_tp1&#45;&gt;stage2_ln2_dp1_ep0_tp1 -->
<g id="edge404" class="edge">
<title>stage2_expert_agg_dp1_ep0_tp1&#45;&gt;stage2_ln2_dp1_ep0_tp1</title>
<path fill="none" stroke="black" d="M1773,-18430.92C1773,-18414.97 1773,-18397.74 1773,-18383.14"/>
<polygon fill="black" stroke="black" points="1776.5,-18383.02 1773,-18373.02 1769.5,-18383.02 1776.5,-18383.02"/>
</g>
<!-- stage2_ln1_dp1_ep1_tp1 -->
<g id="node359" class="node">
<title>stage2_ln1_dp1_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1887.5,-18262.97 1658.5,-18262.97 1658.5,-18210.97 1887.5,-18210.97 1887.5,-18262.97"/>
<text text-anchor="middle" x="1773" y="-18250.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1773" y="-18239.97" font-family="Times,serif" font-size="10.00">GPU 83</text>
<text text-anchor="middle" x="1773" y="-18228.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1773" y="-18217.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep0_tp1&#45;&gt;stage2_ln1_dp1_ep1_tp1 -->
<g id="edge405" class="edge">
<title>stage2_ln2_dp1_ep0_tp1&#45;&gt;stage2_ln1_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M1773,-18320.92C1773,-18306.84 1773,-18289.04 1773,-18273.54"/>
<polygon fill="black" stroke="black" points="1776.5,-18273.25 1773,-18263.25 1769.5,-18273.25 1776.5,-18273.25"/>
</g>
<!-- stage2_mha_dp1_ep1_tp0 -->
<g id="node353" class="node">
<title>stage2_mha_dp1_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1380.5,-18147.97 1151.5,-18147.97 1151.5,-18095.97 1380.5,-18095.97 1380.5,-18147.97"/>
<text text-anchor="middle" x="1266" y="-18135.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1266" y="-18124.97" font-family="Times,serif" font-size="10.00">GPU 82</text>
<text text-anchor="middle" x="1266" y="-18113.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1266" y="-18102.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep1_tp0&#45;&gt;stage2_mha_dp1_ep1_tp0 -->
<g id="edge406" class="edge">
<title>stage2_ln1_dp1_ep1_tp0&#45;&gt;stage2_mha_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M1266,-18210.89C1266,-18195.38 1266,-18175.24 1266,-18158.15"/>
<polygon fill="black" stroke="black" points="1269.5,-18157.97 1266,-18147.97 1262.5,-18157.97 1269.5,-18157.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep1_tp0 -->
<g id="node354" class="node">
<title>stage2_moe_gate_dp1_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1510.85,-18018.97 1121.35,-18018.97 1021.15,-17914.97 1410.65,-17914.97 1510.85,-18018.97"/>
<text text-anchor="middle" x="1266" y="-17980.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1266" y="-17969.97" font-family="Times,serif" font-size="10.00">GPU 82</text>
<text text-anchor="middle" x="1266" y="-17958.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1266" y="-17947.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep1_tp0&#45;&gt;stage2_moe_gate_dp1_ep1_tp0 -->
<g id="edge407" class="edge">
<title>stage2_mha_dp1_ep1_tp0&#45;&gt;stage2_moe_gate_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M1266,-18095.7C1266,-18077.59 1266,-18052.38 1266,-18029.14"/>
<polygon fill="black" stroke="black" points="1269.5,-18028.98 1266,-18018.98 1262.5,-18028.98 1269.5,-18028.98"/>
</g>
<!-- stage2_expert1_dp1_ep1_tp0 -->
<g id="node355" class="node">
<title>stage2_expert1_dp1_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1257.5,-17851.97 1022.5,-17851.97 1022.5,-17799.97 1257.5,-17799.97 1257.5,-17851.97"/>
<text text-anchor="middle" x="1140" y="-17839.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1140" y="-17828.97" font-family="Times,serif" font-size="10.00">GPU 82</text>
<text text-anchor="middle" x="1140" y="-17817.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1140" y="-17806.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep1_tp0&#45;&gt;stage2_expert1_dp1_ep1_tp0 -->
<g id="edge408" class="edge">
<title>stage2_moe_gate_dp1_ep1_tp0&#45;&gt;stage2_expert1_dp1_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1219.44,-17914.6C1202.81,-17896.26 1184.54,-17876.1 1169.72,-17859.75"/>
<polygon fill="black" stroke="black" points="1172.05,-17857.11 1162.74,-17852.05 1166.87,-17861.81 1172.05,-17857.11"/>
</g>
<!-- stage2_expert2_dp1_ep1_tp0 -->
<g id="node356" class="node">
<title>stage2_expert2_dp1_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1510.5,-17851.97 1275.5,-17851.97 1275.5,-17799.97 1510.5,-17799.97 1510.5,-17851.97"/>
<text text-anchor="middle" x="1393" y="-17839.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1393" y="-17828.97" font-family="Times,serif" font-size="10.00">GPU 82</text>
<text text-anchor="middle" x="1393" y="-17817.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1393" y="-17806.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep1_tp0&#45;&gt;stage2_expert2_dp1_ep1_tp0 -->
<g id="edge409" class="edge">
<title>stage2_moe_gate_dp1_ep1_tp0&#45;&gt;stage2_expert2_dp1_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1312.93,-17914.6C1329.69,-17896.26 1348.1,-17876.1 1363.04,-17859.75"/>
<polygon fill="black" stroke="black" points="1365.92,-17861.8 1370.08,-17852.05 1360.75,-17857.08 1365.92,-17861.8"/>
</g>
<!-- stage2_expert_agg_dp1_ep1_tp0 -->
<g id="node357" class="node">
<title>stage2_expert_agg_dp1_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1499.33,-17736.97 1121.79,-17736.97 1024.67,-17632.97 1402.21,-17632.97 1499.33,-17736.97"/>
<text text-anchor="middle" x="1262" y="-17698.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1262" y="-17687.97" font-family="Times,serif" font-size="10.00">GPU 82</text>
<text text-anchor="middle" x="1262" y="-17676.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1262" y="-17665.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep1_tp0&#45;&gt;stage2_expert_agg_dp1_ep1_tp0 -->
<g id="edge410" class="edge">
<title>stage2_expert1_dp1_ep1_tp0&#45;&gt;stage2_expert_agg_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M1162.09,-17799.79C1175.61,-17784.39 1193.5,-17764.01 1210.41,-17744.74"/>
<polygon fill="black" stroke="black" points="1213.11,-17746.97 1217.08,-17737.15 1207.85,-17742.35 1213.11,-17746.97"/>
</g>
<!-- stage2_expert2_dp1_ep1_tp0&#45;&gt;stage2_expert_agg_dp1_ep1_tp0 -->
<g id="edge411" class="edge">
<title>stage2_expert2_dp1_ep1_tp0&#45;&gt;stage2_expert_agg_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M1369.28,-17799.79C1354.7,-17784.32 1335.38,-17763.82 1317.16,-17744.49"/>
<polygon fill="black" stroke="black" points="1319.64,-17742.02 1310.24,-17737.15 1314.55,-17746.83 1319.64,-17742.02"/>
</g>
<!-- stage2_ln2_dp1_ep1_tp0 -->
<g id="node358" class="node">
<title>stage2_ln2_dp1_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1376.5,-17574.97 1147.5,-17574.97 1147.5,-17522.97 1376.5,-17522.97 1376.5,-17574.97"/>
<text text-anchor="middle" x="1262" y="-17562.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1262" y="-17551.97" font-family="Times,serif" font-size="10.00">GPU 82</text>
<text text-anchor="middle" x="1262" y="-17540.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1262" y="-17529.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep1_tp0&#45;&gt;stage2_ln2_dp1_ep1_tp0 -->
<g id="edge412" class="edge">
<title>stage2_expert_agg_dp1_ep1_tp0&#45;&gt;stage2_ln2_dp1_ep1_tp0</title>
<path fill="none" stroke="black" d="M1262,-17632.92C1262,-17616.97 1262,-17599.74 1262,-17585.14"/>
<polygon fill="black" stroke="black" points="1265.5,-17585.02 1262,-17575.02 1258.5,-17585.02 1265.5,-17585.02"/>
</g>
<!-- stage2_ln1_dp1_ep2_tp0 -->
<g id="node366" class="node">
<title>stage2_ln1_dp1_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1376.5,-17464.97 1147.5,-17464.97 1147.5,-17412.97 1376.5,-17412.97 1376.5,-17464.97"/>
<text text-anchor="middle" x="1262" y="-17452.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1262" y="-17441.97" font-family="Times,serif" font-size="10.00">GPU 84</text>
<text text-anchor="middle" x="1262" y="-17430.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1262" y="-17419.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep1_tp0&#45;&gt;stage2_ln1_dp1_ep2_tp0 -->
<g id="edge413" class="edge">
<title>stage2_ln2_dp1_ep1_tp0&#45;&gt;stage2_ln1_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M1262,-17522.92C1262,-17508.84 1262,-17491.04 1262,-17475.54"/>
<polygon fill="black" stroke="black" points="1265.5,-17475.25 1262,-17465.25 1258.5,-17475.25 1265.5,-17475.25"/>
</g>
<!-- stage2_mha_dp1_ep1_tp1 -->
<g id="node360" class="node">
<title>stage2_mha_dp1_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1887.5,-18147.97 1658.5,-18147.97 1658.5,-18095.97 1887.5,-18095.97 1887.5,-18147.97"/>
<text text-anchor="middle" x="1773" y="-18135.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1773" y="-18124.97" font-family="Times,serif" font-size="10.00">GPU 83</text>
<text text-anchor="middle" x="1773" y="-18113.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1773" y="-18102.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep1_tp1&#45;&gt;stage2_mha_dp1_ep1_tp1 -->
<g id="edge414" class="edge">
<title>stage2_ln1_dp1_ep1_tp1&#45;&gt;stage2_mha_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M1773,-18210.89C1773,-18195.38 1773,-18175.24 1773,-18158.15"/>
<polygon fill="black" stroke="black" points="1776.5,-18157.97 1773,-18147.97 1769.5,-18157.97 1776.5,-18157.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep1_tp1 -->
<g id="node361" class="node">
<title>stage2_moe_gate_dp1_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2017.85,-18018.97 1628.35,-18018.97 1528.15,-17914.97 1917.65,-17914.97 2017.85,-18018.97"/>
<text text-anchor="middle" x="1773" y="-17980.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1773" y="-17969.97" font-family="Times,serif" font-size="10.00">GPU 83</text>
<text text-anchor="middle" x="1773" y="-17958.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1773" y="-17947.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep1_tp1&#45;&gt;stage2_moe_gate_dp1_ep1_tp1 -->
<g id="edge415" class="edge">
<title>stage2_mha_dp1_ep1_tp1&#45;&gt;stage2_moe_gate_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M1773,-18095.7C1773,-18077.59 1773,-18052.38 1773,-18029.14"/>
<polygon fill="black" stroke="black" points="1776.5,-18028.98 1773,-18018.98 1769.5,-18028.98 1776.5,-18028.98"/>
</g>
<!-- stage2_expert1_dp1_ep1_tp1 -->
<g id="node362" class="node">
<title>stage2_expert1_dp1_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1764.5,-17851.97 1529.5,-17851.97 1529.5,-17799.97 1764.5,-17799.97 1764.5,-17851.97"/>
<text text-anchor="middle" x="1647" y="-17839.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1647" y="-17828.97" font-family="Times,serif" font-size="10.00">GPU 83</text>
<text text-anchor="middle" x="1647" y="-17817.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1647" y="-17806.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep1_tp1&#45;&gt;stage2_expert1_dp1_ep1_tp1 -->
<g id="edge416" class="edge">
<title>stage2_moe_gate_dp1_ep1_tp1&#45;&gt;stage2_expert1_dp1_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1726.44,-17914.6C1709.81,-17896.26 1691.54,-17876.1 1676.72,-17859.75"/>
<polygon fill="black" stroke="black" points="1679.05,-17857.11 1669.74,-17852.05 1673.87,-17861.81 1679.05,-17857.11"/>
</g>
<!-- stage2_expert2_dp1_ep1_tp1 -->
<g id="node363" class="node">
<title>stage2_expert2_dp1_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2017.5,-17851.97 1782.5,-17851.97 1782.5,-17799.97 2017.5,-17799.97 2017.5,-17851.97"/>
<text text-anchor="middle" x="1900" y="-17839.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1900" y="-17828.97" font-family="Times,serif" font-size="10.00">GPU 83</text>
<text text-anchor="middle" x="1900" y="-17817.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1900" y="-17806.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep1_tp1&#45;&gt;stage2_expert2_dp1_ep1_tp1 -->
<g id="edge417" class="edge">
<title>stage2_moe_gate_dp1_ep1_tp1&#45;&gt;stage2_expert2_dp1_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1819.93,-17914.6C1836.69,-17896.26 1855.1,-17876.1 1870.04,-17859.75"/>
<polygon fill="black" stroke="black" points="1872.92,-17861.8 1877.08,-17852.05 1867.75,-17857.08 1872.92,-17861.8"/>
</g>
<!-- stage2_expert_agg_dp1_ep1_tp1 -->
<g id="node364" class="node">
<title>stage2_expert_agg_dp1_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2006.33,-17736.97 1628.79,-17736.97 1531.67,-17632.97 1909.21,-17632.97 2006.33,-17736.97"/>
<text text-anchor="middle" x="1769" y="-17698.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1769" y="-17687.97" font-family="Times,serif" font-size="10.00">GPU 83</text>
<text text-anchor="middle" x="1769" y="-17676.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1769" y="-17665.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep1_tp1&#45;&gt;stage2_expert_agg_dp1_ep1_tp1 -->
<g id="edge418" class="edge">
<title>stage2_expert1_dp1_ep1_tp1&#45;&gt;stage2_expert_agg_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M1669.09,-17799.79C1682.61,-17784.39 1700.5,-17764.01 1717.41,-17744.74"/>
<polygon fill="black" stroke="black" points="1720.11,-17746.97 1724.08,-17737.15 1714.85,-17742.35 1720.11,-17746.97"/>
</g>
<!-- stage2_expert2_dp1_ep1_tp1&#45;&gt;stage2_expert_agg_dp1_ep1_tp1 -->
<g id="edge419" class="edge">
<title>stage2_expert2_dp1_ep1_tp1&#45;&gt;stage2_expert_agg_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M1876.28,-17799.79C1861.7,-17784.32 1842.38,-17763.82 1824.16,-17744.49"/>
<polygon fill="black" stroke="black" points="1826.64,-17742.02 1817.24,-17737.15 1821.55,-17746.83 1826.64,-17742.02"/>
</g>
<!-- stage2_ln2_dp1_ep1_tp1 -->
<g id="node365" class="node">
<title>stage2_ln2_dp1_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1883.5,-17574.97 1654.5,-17574.97 1654.5,-17522.97 1883.5,-17522.97 1883.5,-17574.97"/>
<text text-anchor="middle" x="1769" y="-17562.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1769" y="-17551.97" font-family="Times,serif" font-size="10.00">GPU 83</text>
<text text-anchor="middle" x="1769" y="-17540.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1769" y="-17529.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep1_tp1&#45;&gt;stage2_ln2_dp1_ep1_tp1 -->
<g id="edge420" class="edge">
<title>stage2_expert_agg_dp1_ep1_tp1&#45;&gt;stage2_ln2_dp1_ep1_tp1</title>
<path fill="none" stroke="black" d="M1769,-17632.92C1769,-17616.97 1769,-17599.74 1769,-17585.14"/>
<polygon fill="black" stroke="black" points="1772.5,-17585.02 1769,-17575.02 1765.5,-17585.02 1772.5,-17585.02"/>
</g>
<!-- stage2_ln1_dp1_ep2_tp1 -->
<g id="node373" class="node">
<title>stage2_ln1_dp1_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1883.5,-17464.97 1654.5,-17464.97 1654.5,-17412.97 1883.5,-17412.97 1883.5,-17464.97"/>
<text text-anchor="middle" x="1769" y="-17452.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1769" y="-17441.97" font-family="Times,serif" font-size="10.00">GPU 85</text>
<text text-anchor="middle" x="1769" y="-17430.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1769" y="-17419.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep1_tp1&#45;&gt;stage2_ln1_dp1_ep2_tp1 -->
<g id="edge421" class="edge">
<title>stage2_ln2_dp1_ep1_tp1&#45;&gt;stage2_ln1_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M1769,-17522.92C1769,-17508.84 1769,-17491.04 1769,-17475.54"/>
<polygon fill="black" stroke="black" points="1772.5,-17475.25 1769,-17465.25 1765.5,-17475.25 1772.5,-17475.25"/>
</g>
<!-- stage2_mha_dp1_ep2_tp0 -->
<g id="node367" class="node">
<title>stage2_mha_dp1_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1376.5,-17349.97 1147.5,-17349.97 1147.5,-17297.97 1376.5,-17297.97 1376.5,-17349.97"/>
<text text-anchor="middle" x="1262" y="-17337.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1262" y="-17326.97" font-family="Times,serif" font-size="10.00">GPU 84</text>
<text text-anchor="middle" x="1262" y="-17315.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1262" y="-17304.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep2_tp0&#45;&gt;stage2_mha_dp1_ep2_tp0 -->
<g id="edge422" class="edge">
<title>stage2_ln1_dp1_ep2_tp0&#45;&gt;stage2_mha_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M1262,-17412.89C1262,-17397.38 1262,-17377.24 1262,-17360.15"/>
<polygon fill="black" stroke="black" points="1265.5,-17359.97 1262,-17349.97 1258.5,-17359.97 1265.5,-17359.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep2_tp0 -->
<g id="node368" class="node">
<title>stage2_moe_gate_dp1_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1506.85,-17220.97 1117.35,-17220.97 1017.15,-17116.97 1406.65,-17116.97 1506.85,-17220.97"/>
<text text-anchor="middle" x="1262" y="-17182.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1262" y="-17171.97" font-family="Times,serif" font-size="10.00">GPU 84</text>
<text text-anchor="middle" x="1262" y="-17160.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1262" y="-17149.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep2_tp0&#45;&gt;stage2_moe_gate_dp1_ep2_tp0 -->
<g id="edge423" class="edge">
<title>stage2_mha_dp1_ep2_tp0&#45;&gt;stage2_moe_gate_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M1262,-17297.7C1262,-17279.59 1262,-17254.38 1262,-17231.14"/>
<polygon fill="black" stroke="black" points="1265.5,-17230.98 1262,-17220.98 1258.5,-17230.98 1265.5,-17230.98"/>
</g>
<!-- stage2_expert1_dp1_ep2_tp0 -->
<g id="node369" class="node">
<title>stage2_expert1_dp1_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1253.5,-17053.97 1018.5,-17053.97 1018.5,-17001.97 1253.5,-17001.97 1253.5,-17053.97"/>
<text text-anchor="middle" x="1136" y="-17041.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1136" y="-17030.97" font-family="Times,serif" font-size="10.00">GPU 84</text>
<text text-anchor="middle" x="1136" y="-17019.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1136" y="-17008.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep2_tp0&#45;&gt;stage2_expert1_dp1_ep2_tp0 -->
<g id="edge424" class="edge">
<title>stage2_moe_gate_dp1_ep2_tp0&#45;&gt;stage2_expert1_dp1_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1215.44,-17116.6C1198.81,-17098.26 1180.54,-17078.1 1165.72,-17061.75"/>
<polygon fill="black" stroke="black" points="1168.05,-17059.11 1158.74,-17054.05 1162.87,-17063.81 1168.05,-17059.11"/>
</g>
<!-- stage2_expert2_dp1_ep2_tp0 -->
<g id="node370" class="node">
<title>stage2_expert2_dp1_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1506.5,-17053.97 1271.5,-17053.97 1271.5,-17001.97 1506.5,-17001.97 1506.5,-17053.97"/>
<text text-anchor="middle" x="1389" y="-17041.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1389" y="-17030.97" font-family="Times,serif" font-size="10.00">GPU 84</text>
<text text-anchor="middle" x="1389" y="-17019.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1389" y="-17008.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep2_tp0&#45;&gt;stage2_expert2_dp1_ep2_tp0 -->
<g id="edge425" class="edge">
<title>stage2_moe_gate_dp1_ep2_tp0&#45;&gt;stage2_expert2_dp1_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1308.93,-17116.6C1325.69,-17098.26 1344.1,-17078.1 1359.04,-17061.75"/>
<polygon fill="black" stroke="black" points="1361.92,-17063.8 1366.08,-17054.05 1356.75,-17059.08 1361.92,-17063.8"/>
</g>
<!-- stage2_expert_agg_dp1_ep2_tp0 -->
<g id="node371" class="node">
<title>stage2_expert_agg_dp1_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1491.33,-16938.97 1113.79,-16938.97 1016.67,-16834.97 1394.21,-16834.97 1491.33,-16938.97"/>
<text text-anchor="middle" x="1254" y="-16900.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1254" y="-16889.97" font-family="Times,serif" font-size="10.00">GPU 84</text>
<text text-anchor="middle" x="1254" y="-16878.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1254" y="-16867.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep2_tp0&#45;&gt;stage2_expert_agg_dp1_ep2_tp0 -->
<g id="edge426" class="edge">
<title>stage2_expert1_dp1_ep2_tp0&#45;&gt;stage2_expert_agg_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M1157.37,-17001.79C1170.39,-16986.46 1187.6,-16966.19 1203.88,-16947"/>
<polygon fill="black" stroke="black" points="1206.75,-16949.04 1210.55,-16939.15 1201.41,-16944.51 1206.75,-16949.04"/>
</g>
<!-- stage2_expert2_dp1_ep2_tp0&#45;&gt;stage2_expert_agg_dp1_ep2_tp0 -->
<g id="edge427" class="edge">
<title>stage2_expert2_dp1_ep2_tp0&#45;&gt;stage2_expert_agg_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M1364.55,-17001.79C1349.53,-16986.32 1329.62,-16965.82 1310.84,-16946.49"/>
<polygon fill="black" stroke="black" points="1313.19,-16943.88 1303.71,-16939.15 1308.17,-16948.76 1313.19,-16943.88"/>
</g>
<!-- stage2_ln2_dp1_ep2_tp0 -->
<g id="node372" class="node">
<title>stage2_ln2_dp1_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1368.5,-16776.97 1139.5,-16776.97 1139.5,-16724.97 1368.5,-16724.97 1368.5,-16776.97"/>
<text text-anchor="middle" x="1254" y="-16764.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1254" y="-16753.97" font-family="Times,serif" font-size="10.00">GPU 84</text>
<text text-anchor="middle" x="1254" y="-16742.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1254" y="-16731.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep2_tp0&#45;&gt;stage2_ln2_dp1_ep2_tp0 -->
<g id="edge428" class="edge">
<title>stage2_expert_agg_dp1_ep2_tp0&#45;&gt;stage2_ln2_dp1_ep2_tp0</title>
<path fill="none" stroke="black" d="M1254,-16834.92C1254,-16818.97 1254,-16801.74 1254,-16787.14"/>
<polygon fill="black" stroke="black" points="1257.5,-16787.02 1254,-16777.02 1250.5,-16787.02 1257.5,-16787.02"/>
</g>
<!-- stage2_ln1_dp1_ep3_tp0 -->
<g id="node380" class="node">
<title>stage2_ln1_dp1_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1368.5,-16666.97 1139.5,-16666.97 1139.5,-16614.97 1368.5,-16614.97 1368.5,-16666.97"/>
<text text-anchor="middle" x="1254" y="-16654.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1254" y="-16643.97" font-family="Times,serif" font-size="10.00">GPU 86</text>
<text text-anchor="middle" x="1254" y="-16632.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1254" y="-16621.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep2_tp0&#45;&gt;stage2_ln1_dp1_ep3_tp0 -->
<g id="edge429" class="edge">
<title>stage2_ln2_dp1_ep2_tp0&#45;&gt;stage2_ln1_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M1254,-16724.92C1254,-16710.84 1254,-16693.04 1254,-16677.54"/>
<polygon fill="black" stroke="black" points="1257.5,-16677.25 1254,-16667.25 1250.5,-16677.25 1257.5,-16677.25"/>
</g>
<!-- stage2_mha_dp1_ep2_tp1 -->
<g id="node374" class="node">
<title>stage2_mha_dp1_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1883.5,-17349.97 1654.5,-17349.97 1654.5,-17297.97 1883.5,-17297.97 1883.5,-17349.97"/>
<text text-anchor="middle" x="1769" y="-17337.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1769" y="-17326.97" font-family="Times,serif" font-size="10.00">GPU 85</text>
<text text-anchor="middle" x="1769" y="-17315.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1769" y="-17304.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep2_tp1&#45;&gt;stage2_mha_dp1_ep2_tp1 -->
<g id="edge430" class="edge">
<title>stage2_ln1_dp1_ep2_tp1&#45;&gt;stage2_mha_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M1769,-17412.89C1769,-17397.38 1769,-17377.24 1769,-17360.15"/>
<polygon fill="black" stroke="black" points="1772.5,-17359.97 1769,-17349.97 1765.5,-17359.97 1772.5,-17359.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep2_tp1 -->
<g id="node375" class="node">
<title>stage2_moe_gate_dp1_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2013.85,-17220.97 1624.35,-17220.97 1524.15,-17116.97 1913.65,-17116.97 2013.85,-17220.97"/>
<text text-anchor="middle" x="1769" y="-17182.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1769" y="-17171.97" font-family="Times,serif" font-size="10.00">GPU 85</text>
<text text-anchor="middle" x="1769" y="-17160.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1769" y="-17149.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep2_tp1&#45;&gt;stage2_moe_gate_dp1_ep2_tp1 -->
<g id="edge431" class="edge">
<title>stage2_mha_dp1_ep2_tp1&#45;&gt;stage2_moe_gate_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M1769,-17297.7C1769,-17279.59 1769,-17254.38 1769,-17231.14"/>
<polygon fill="black" stroke="black" points="1772.5,-17230.98 1769,-17220.98 1765.5,-17230.98 1772.5,-17230.98"/>
</g>
<!-- stage2_expert1_dp1_ep2_tp1 -->
<g id="node376" class="node">
<title>stage2_expert1_dp1_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1759.5,-17053.97 1524.5,-17053.97 1524.5,-17001.97 1759.5,-17001.97 1759.5,-17053.97"/>
<text text-anchor="middle" x="1642" y="-17041.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1642" y="-17030.97" font-family="Times,serif" font-size="10.00">GPU 85</text>
<text text-anchor="middle" x="1642" y="-17019.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1642" y="-17008.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep2_tp1&#45;&gt;stage2_expert1_dp1_ep2_tp1 -->
<g id="edge432" class="edge">
<title>stage2_moe_gate_dp1_ep2_tp1&#45;&gt;stage2_expert1_dp1_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1722.07,-17116.6C1705.31,-17098.26 1686.9,-17078.1 1671.96,-17061.75"/>
<polygon fill="black" stroke="black" points="1674.25,-17059.08 1664.92,-17054.05 1669.08,-17063.8 1674.25,-17059.08"/>
</g>
<!-- stage2_expert2_dp1_ep2_tp1 -->
<g id="node377" class="node">
<title>stage2_expert2_dp1_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2012.5,-17053.97 1777.5,-17053.97 1777.5,-17001.97 2012.5,-17001.97 2012.5,-17053.97"/>
<text text-anchor="middle" x="1895" y="-17041.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1895" y="-17030.97" font-family="Times,serif" font-size="10.00">GPU 85</text>
<text text-anchor="middle" x="1895" y="-17019.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1895" y="-17008.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep2_tp1&#45;&gt;stage2_expert2_dp1_ep2_tp1 -->
<g id="edge433" class="edge">
<title>stage2_moe_gate_dp1_ep2_tp1&#45;&gt;stage2_expert2_dp1_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1815.56,-17116.6C1832.19,-17098.26 1850.46,-17078.1 1865.28,-17061.75"/>
<polygon fill="black" stroke="black" points="1868.13,-17063.81 1872.26,-17054.05 1862.95,-17059.11 1868.13,-17063.81"/>
</g>
<!-- stage2_expert_agg_dp1_ep2_tp1 -->
<g id="node378" class="node">
<title>stage2_expert_agg_dp1_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1998.33,-16938.97 1620.79,-16938.97 1523.67,-16834.97 1901.21,-16834.97 1998.33,-16938.97"/>
<text text-anchor="middle" x="1761" y="-16900.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1761" y="-16889.97" font-family="Times,serif" font-size="10.00">GPU 85</text>
<text text-anchor="middle" x="1761" y="-16878.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1761" y="-16867.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep2_tp1&#45;&gt;stage2_expert_agg_dp1_ep2_tp1 -->
<g id="edge434" class="edge">
<title>stage2_expert1_dp1_ep2_tp1&#45;&gt;stage2_expert_agg_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M1663.55,-17001.79C1676.74,-16986.39 1694.19,-16966.01 1710.68,-16946.74"/>
<polygon fill="black" stroke="black" points="1713.34,-16949.02 1717.18,-16939.15 1708.02,-16944.47 1713.34,-16949.02"/>
</g>
<!-- stage2_expert2_dp1_ep2_tp1&#45;&gt;stage2_expert_agg_dp1_ep2_tp1 -->
<g id="edge435" class="edge">
<title>stage2_expert2_dp1_ep2_tp1&#45;&gt;stage2_expert_agg_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M1870.73,-17001.79C1855.82,-16986.32 1836.06,-16965.82 1817.42,-16946.49"/>
<polygon fill="black" stroke="black" points="1819.8,-16943.92 1810.34,-16939.15 1814.76,-16948.78 1819.8,-16943.92"/>
</g>
<!-- stage2_ln2_dp1_ep2_tp1 -->
<g id="node379" class="node">
<title>stage2_ln2_dp1_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1875.5,-16776.97 1646.5,-16776.97 1646.5,-16724.97 1875.5,-16724.97 1875.5,-16776.97"/>
<text text-anchor="middle" x="1761" y="-16764.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1761" y="-16753.97" font-family="Times,serif" font-size="10.00">GPU 85</text>
<text text-anchor="middle" x="1761" y="-16742.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1761" y="-16731.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep2_tp1&#45;&gt;stage2_ln2_dp1_ep2_tp1 -->
<g id="edge436" class="edge">
<title>stage2_expert_agg_dp1_ep2_tp1&#45;&gt;stage2_ln2_dp1_ep2_tp1</title>
<path fill="none" stroke="black" d="M1761,-16834.92C1761,-16818.97 1761,-16801.74 1761,-16787.14"/>
<polygon fill="black" stroke="black" points="1764.5,-16787.02 1761,-16777.02 1757.5,-16787.02 1764.5,-16787.02"/>
</g>
<!-- stage2_ln1_dp1_ep3_tp1 -->
<g id="node387" class="node">
<title>stage2_ln1_dp1_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1875.5,-16666.97 1646.5,-16666.97 1646.5,-16614.97 1875.5,-16614.97 1875.5,-16666.97"/>
<text text-anchor="middle" x="1761" y="-16654.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1761" y="-16643.97" font-family="Times,serif" font-size="10.00">GPU 87</text>
<text text-anchor="middle" x="1761" y="-16632.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1761" y="-16621.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep2_tp1&#45;&gt;stage2_ln1_dp1_ep3_tp1 -->
<g id="edge437" class="edge">
<title>stage2_ln2_dp1_ep2_tp1&#45;&gt;stage2_ln1_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M1761,-16724.92C1761,-16710.84 1761,-16693.04 1761,-16677.54"/>
<polygon fill="black" stroke="black" points="1764.5,-16677.25 1761,-16667.25 1757.5,-16677.25 1764.5,-16677.25"/>
</g>
<!-- stage2_mha_dp1_ep3_tp0 -->
<g id="node381" class="node">
<title>stage2_mha_dp1_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1368.5,-16551.97 1139.5,-16551.97 1139.5,-16499.97 1368.5,-16499.97 1368.5,-16551.97"/>
<text text-anchor="middle" x="1254" y="-16539.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1254" y="-16528.97" font-family="Times,serif" font-size="10.00">GPU 86</text>
<text text-anchor="middle" x="1254" y="-16517.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1254" y="-16506.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep3_tp0&#45;&gt;stage2_mha_dp1_ep3_tp0 -->
<g id="edge438" class="edge">
<title>stage2_ln1_dp1_ep3_tp0&#45;&gt;stage2_mha_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M1254,-16614.89C1254,-16599.38 1254,-16579.24 1254,-16562.15"/>
<polygon fill="black" stroke="black" points="1257.5,-16561.97 1254,-16551.97 1250.5,-16561.97 1257.5,-16561.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep3_tp0 -->
<g id="node382" class="node">
<title>stage2_moe_gate_dp1_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1498.85,-16422.97 1109.35,-16422.97 1009.15,-16318.97 1398.65,-16318.97 1498.85,-16422.97"/>
<text text-anchor="middle" x="1254" y="-16384.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1254" y="-16373.97" font-family="Times,serif" font-size="10.00">GPU 86</text>
<text text-anchor="middle" x="1254" y="-16362.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1254" y="-16351.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep3_tp0&#45;&gt;stage2_moe_gate_dp1_ep3_tp0 -->
<g id="edge439" class="edge">
<title>stage2_mha_dp1_ep3_tp0&#45;&gt;stage2_moe_gate_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M1254,-16499.7C1254,-16481.59 1254,-16456.38 1254,-16433.14"/>
<polygon fill="black" stroke="black" points="1257.5,-16432.98 1254,-16422.98 1250.5,-16432.98 1257.5,-16432.98"/>
</g>
<!-- stage2_expert1_dp1_ep3_tp0 -->
<g id="node383" class="node">
<title>stage2_expert1_dp1_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1245.5,-16255.97 1010.5,-16255.97 1010.5,-16203.97 1245.5,-16203.97 1245.5,-16255.97"/>
<text text-anchor="middle" x="1128" y="-16243.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1128" y="-16232.97" font-family="Times,serif" font-size="10.00">GPU 86</text>
<text text-anchor="middle" x="1128" y="-16221.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1128" y="-16210.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep3_tp0&#45;&gt;stage2_expert1_dp1_ep3_tp0 -->
<g id="edge440" class="edge">
<title>stage2_moe_gate_dp1_ep3_tp0&#45;&gt;stage2_expert1_dp1_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1207.44,-16318.6C1190.81,-16300.26 1172.54,-16280.1 1157.72,-16263.75"/>
<polygon fill="black" stroke="black" points="1160.05,-16261.11 1150.74,-16256.05 1154.87,-16265.81 1160.05,-16261.11"/>
</g>
<!-- stage2_expert2_dp1_ep3_tp0 -->
<g id="node384" class="node">
<title>stage2_expert2_dp1_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1498.5,-16255.97 1263.5,-16255.97 1263.5,-16203.97 1498.5,-16203.97 1498.5,-16255.97"/>
<text text-anchor="middle" x="1381" y="-16243.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1381" y="-16232.97" font-family="Times,serif" font-size="10.00">GPU 86</text>
<text text-anchor="middle" x="1381" y="-16221.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1381" y="-16210.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep3_tp0&#45;&gt;stage2_expert2_dp1_ep3_tp0 -->
<g id="edge441" class="edge">
<title>stage2_moe_gate_dp1_ep3_tp0&#45;&gt;stage2_expert2_dp1_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1300.93,-16318.6C1317.69,-16300.26 1336.1,-16280.1 1351.04,-16263.75"/>
<polygon fill="black" stroke="black" points="1353.92,-16265.8 1358.08,-16256.05 1348.75,-16261.08 1353.92,-16265.8"/>
</g>
<!-- stage2_expert_agg_dp1_ep3_tp0 -->
<g id="node385" class="node">
<title>stage2_expert_agg_dp1_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1483.33,-16140.97 1105.79,-16140.97 1008.67,-16036.97 1386.21,-16036.97 1483.33,-16140.97"/>
<text text-anchor="middle" x="1246" y="-16102.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1246" y="-16091.97" font-family="Times,serif" font-size="10.00">GPU 86</text>
<text text-anchor="middle" x="1246" y="-16080.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1246" y="-16069.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep3_tp0&#45;&gt;stage2_expert_agg_dp1_ep3_tp0 -->
<g id="edge442" class="edge">
<title>stage2_expert1_dp1_ep3_tp0&#45;&gt;stage2_expert_agg_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M1149.37,-16203.79C1162.39,-16188.46 1179.6,-16168.19 1195.88,-16149"/>
<polygon fill="black" stroke="black" points="1198.75,-16151.04 1202.55,-16141.15 1193.41,-16146.51 1198.75,-16151.04"/>
</g>
<!-- stage2_expert2_dp1_ep3_tp0&#45;&gt;stage2_expert_agg_dp1_ep3_tp0 -->
<g id="edge443" class="edge">
<title>stage2_expert2_dp1_ep3_tp0&#45;&gt;stage2_expert_agg_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M1356.55,-16203.79C1341.53,-16188.32 1321.62,-16167.82 1302.84,-16148.49"/>
<polygon fill="black" stroke="black" points="1305.19,-16145.88 1295.71,-16141.15 1300.17,-16150.76 1305.19,-16145.88"/>
</g>
<!-- stage2_ln2_dp1_ep3_tp0 -->
<g id="node386" class="node">
<title>stage2_ln2_dp1_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1360.5,-15978.97 1131.5,-15978.97 1131.5,-15926.97 1360.5,-15926.97 1360.5,-15978.97"/>
<text text-anchor="middle" x="1246" y="-15966.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1246" y="-15955.97" font-family="Times,serif" font-size="10.00">GPU 86</text>
<text text-anchor="middle" x="1246" y="-15944.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1246" y="-15933.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep3_tp0&#45;&gt;stage2_ln2_dp1_ep3_tp0 -->
<g id="edge444" class="edge">
<title>stage2_expert_agg_dp1_ep3_tp0&#45;&gt;stage2_ln2_dp1_ep3_tp0</title>
<path fill="none" stroke="black" d="M1246,-16036.92C1246,-16020.97 1246,-16003.74 1246,-15989.14"/>
<polygon fill="black" stroke="black" points="1249.5,-15989.02 1246,-15979.02 1242.5,-15989.02 1249.5,-15989.02"/>
</g>
<!-- stage2_ln1_dp1_ep4_tp0 -->
<g id="node394" class="node">
<title>stage2_ln1_dp1_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1360.5,-15868.97 1131.5,-15868.97 1131.5,-15816.97 1360.5,-15816.97 1360.5,-15868.97"/>
<text text-anchor="middle" x="1246" y="-15856.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1246" y="-15845.97" font-family="Times,serif" font-size="10.00">GPU 88</text>
<text text-anchor="middle" x="1246" y="-15834.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1246" y="-15823.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep3_tp0&#45;&gt;stage2_ln1_dp1_ep4_tp0 -->
<g id="edge445" class="edge">
<title>stage2_ln2_dp1_ep3_tp0&#45;&gt;stage2_ln1_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M1246,-15926.92C1246,-15912.84 1246,-15895.04 1246,-15879.54"/>
<polygon fill="black" stroke="black" points="1249.5,-15879.25 1246,-15869.25 1242.5,-15879.25 1249.5,-15879.25"/>
</g>
<!-- stage2_mha_dp1_ep3_tp1 -->
<g id="node388" class="node">
<title>stage2_mha_dp1_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1875.5,-16551.97 1646.5,-16551.97 1646.5,-16499.97 1875.5,-16499.97 1875.5,-16551.97"/>
<text text-anchor="middle" x="1761" y="-16539.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1761" y="-16528.97" font-family="Times,serif" font-size="10.00">GPU 87</text>
<text text-anchor="middle" x="1761" y="-16517.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1761" y="-16506.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep3_tp1&#45;&gt;stage2_mha_dp1_ep3_tp1 -->
<g id="edge446" class="edge">
<title>stage2_ln1_dp1_ep3_tp1&#45;&gt;stage2_mha_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M1761,-16614.89C1761,-16599.38 1761,-16579.24 1761,-16562.15"/>
<polygon fill="black" stroke="black" points="1764.5,-16561.97 1761,-16551.97 1757.5,-16561.97 1764.5,-16561.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep3_tp1 -->
<g id="node389" class="node">
<title>stage2_moe_gate_dp1_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2005.85,-16422.97 1616.35,-16422.97 1516.15,-16318.97 1905.65,-16318.97 2005.85,-16422.97"/>
<text text-anchor="middle" x="1761" y="-16384.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1761" y="-16373.97" font-family="Times,serif" font-size="10.00">GPU 87</text>
<text text-anchor="middle" x="1761" y="-16362.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1761" y="-16351.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep3_tp1&#45;&gt;stage2_moe_gate_dp1_ep3_tp1 -->
<g id="edge447" class="edge">
<title>stage2_mha_dp1_ep3_tp1&#45;&gt;stage2_moe_gate_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M1761,-16499.7C1761,-16481.59 1761,-16456.38 1761,-16433.14"/>
<polygon fill="black" stroke="black" points="1764.5,-16432.98 1761,-16422.98 1757.5,-16432.98 1764.5,-16432.98"/>
</g>
<!-- stage2_expert1_dp1_ep3_tp1 -->
<g id="node390" class="node">
<title>stage2_expert1_dp1_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1751.5,-16255.97 1516.5,-16255.97 1516.5,-16203.97 1751.5,-16203.97 1751.5,-16255.97"/>
<text text-anchor="middle" x="1634" y="-16243.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1634" y="-16232.97" font-family="Times,serif" font-size="10.00">GPU 87</text>
<text text-anchor="middle" x="1634" y="-16221.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1634" y="-16210.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep3_tp1&#45;&gt;stage2_expert1_dp1_ep3_tp1 -->
<g id="edge448" class="edge">
<title>stage2_moe_gate_dp1_ep3_tp1&#45;&gt;stage2_expert1_dp1_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1714.07,-16318.6C1697.31,-16300.26 1678.9,-16280.1 1663.96,-16263.75"/>
<polygon fill="black" stroke="black" points="1666.25,-16261.08 1656.92,-16256.05 1661.08,-16265.8 1666.25,-16261.08"/>
</g>
<!-- stage2_expert2_dp1_ep3_tp1 -->
<g id="node391" class="node">
<title>stage2_expert2_dp1_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2004.5,-16255.97 1769.5,-16255.97 1769.5,-16203.97 2004.5,-16203.97 2004.5,-16255.97"/>
<text text-anchor="middle" x="1887" y="-16243.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1887" y="-16232.97" font-family="Times,serif" font-size="10.00">GPU 87</text>
<text text-anchor="middle" x="1887" y="-16221.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1887" y="-16210.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep3_tp1&#45;&gt;stage2_expert2_dp1_ep3_tp1 -->
<g id="edge449" class="edge">
<title>stage2_moe_gate_dp1_ep3_tp1&#45;&gt;stage2_expert2_dp1_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1807.56,-16318.6C1824.19,-16300.26 1842.46,-16280.1 1857.28,-16263.75"/>
<polygon fill="black" stroke="black" points="1860.13,-16265.81 1864.26,-16256.05 1854.95,-16261.11 1860.13,-16265.81"/>
</g>
<!-- stage2_expert_agg_dp1_ep3_tp1 -->
<g id="node392" class="node">
<title>stage2_expert_agg_dp1_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1990.33,-16140.97 1612.79,-16140.97 1515.67,-16036.97 1893.21,-16036.97 1990.33,-16140.97"/>
<text text-anchor="middle" x="1753" y="-16102.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1753" y="-16091.97" font-family="Times,serif" font-size="10.00">GPU 87</text>
<text text-anchor="middle" x="1753" y="-16080.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1753" y="-16069.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep3_tp1&#45;&gt;stage2_expert_agg_dp1_ep3_tp1 -->
<g id="edge450" class="edge">
<title>stage2_expert1_dp1_ep3_tp1&#45;&gt;stage2_expert_agg_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M1655.55,-16203.79C1668.74,-16188.39 1686.19,-16168.01 1702.68,-16148.74"/>
<polygon fill="black" stroke="black" points="1705.34,-16151.02 1709.18,-16141.15 1700.02,-16146.47 1705.34,-16151.02"/>
</g>
<!-- stage2_expert2_dp1_ep3_tp1&#45;&gt;stage2_expert_agg_dp1_ep3_tp1 -->
<g id="edge451" class="edge">
<title>stage2_expert2_dp1_ep3_tp1&#45;&gt;stage2_expert_agg_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M1862.73,-16203.79C1847.82,-16188.32 1828.06,-16167.82 1809.42,-16148.49"/>
<polygon fill="black" stroke="black" points="1811.8,-16145.92 1802.34,-16141.15 1806.76,-16150.78 1811.8,-16145.92"/>
</g>
<!-- stage2_ln2_dp1_ep3_tp1 -->
<g id="node393" class="node">
<title>stage2_ln2_dp1_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1867.5,-15978.97 1638.5,-15978.97 1638.5,-15926.97 1867.5,-15926.97 1867.5,-15978.97"/>
<text text-anchor="middle" x="1753" y="-15966.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1753" y="-15955.97" font-family="Times,serif" font-size="10.00">GPU 87</text>
<text text-anchor="middle" x="1753" y="-15944.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1753" y="-15933.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep3_tp1&#45;&gt;stage2_ln2_dp1_ep3_tp1 -->
<g id="edge452" class="edge">
<title>stage2_expert_agg_dp1_ep3_tp1&#45;&gt;stage2_ln2_dp1_ep3_tp1</title>
<path fill="none" stroke="black" d="M1753,-16036.92C1753,-16020.97 1753,-16003.74 1753,-15989.14"/>
<polygon fill="black" stroke="black" points="1756.5,-15989.02 1753,-15979.02 1749.5,-15989.02 1756.5,-15989.02"/>
</g>
<!-- stage2_ln1_dp1_ep4_tp1 -->
<g id="node401" class="node">
<title>stage2_ln1_dp1_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1867.5,-15868.97 1638.5,-15868.97 1638.5,-15816.97 1867.5,-15816.97 1867.5,-15868.97"/>
<text text-anchor="middle" x="1753" y="-15856.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1753" y="-15845.97" font-family="Times,serif" font-size="10.00">GPU 89</text>
<text text-anchor="middle" x="1753" y="-15834.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1753" y="-15823.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep3_tp1&#45;&gt;stage2_ln1_dp1_ep4_tp1 -->
<g id="edge453" class="edge">
<title>stage2_ln2_dp1_ep3_tp1&#45;&gt;stage2_ln1_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M1753,-15926.92C1753,-15912.84 1753,-15895.04 1753,-15879.54"/>
<polygon fill="black" stroke="black" points="1756.5,-15879.25 1753,-15869.25 1749.5,-15879.25 1756.5,-15879.25"/>
</g>
<!-- stage2_mha_dp1_ep4_tp0 -->
<g id="node395" class="node">
<title>stage2_mha_dp1_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1360.5,-15753.97 1131.5,-15753.97 1131.5,-15701.97 1360.5,-15701.97 1360.5,-15753.97"/>
<text text-anchor="middle" x="1246" y="-15741.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1246" y="-15730.97" font-family="Times,serif" font-size="10.00">GPU 88</text>
<text text-anchor="middle" x="1246" y="-15719.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1246" y="-15708.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep4_tp0&#45;&gt;stage2_mha_dp1_ep4_tp0 -->
<g id="edge454" class="edge">
<title>stage2_ln1_dp1_ep4_tp0&#45;&gt;stage2_mha_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M1246,-15816.89C1246,-15801.38 1246,-15781.24 1246,-15764.15"/>
<polygon fill="black" stroke="black" points="1249.5,-15763.97 1246,-15753.97 1242.5,-15763.97 1249.5,-15763.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep4_tp0 -->
<g id="node396" class="node">
<title>stage2_moe_gate_dp1_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1490.85,-15624.97 1101.35,-15624.97 1001.15,-15520.97 1390.65,-15520.97 1490.85,-15624.97"/>
<text text-anchor="middle" x="1246" y="-15586.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1246" y="-15575.97" font-family="Times,serif" font-size="10.00">GPU 88</text>
<text text-anchor="middle" x="1246" y="-15564.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1246" y="-15553.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep4_tp0&#45;&gt;stage2_moe_gate_dp1_ep4_tp0 -->
<g id="edge455" class="edge">
<title>stage2_mha_dp1_ep4_tp0&#45;&gt;stage2_moe_gate_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M1246,-15701.7C1246,-15683.59 1246,-15658.38 1246,-15635.14"/>
<polygon fill="black" stroke="black" points="1249.5,-15634.98 1246,-15624.98 1242.5,-15634.98 1249.5,-15634.98"/>
</g>
<!-- stage2_expert1_dp1_ep4_tp0 -->
<g id="node397" class="node">
<title>stage2_expert1_dp1_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1237.5,-15457.97 1002.5,-15457.97 1002.5,-15405.97 1237.5,-15405.97 1237.5,-15457.97"/>
<text text-anchor="middle" x="1120" y="-15445.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1120" y="-15434.97" font-family="Times,serif" font-size="10.00">GPU 88</text>
<text text-anchor="middle" x="1120" y="-15423.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1120" y="-15412.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep4_tp0&#45;&gt;stage2_expert1_dp1_ep4_tp0 -->
<g id="edge456" class="edge">
<title>stage2_moe_gate_dp1_ep4_tp0&#45;&gt;stage2_expert1_dp1_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1199.44,-15520.6C1182.81,-15502.26 1164.54,-15482.1 1149.72,-15465.75"/>
<polygon fill="black" stroke="black" points="1152.05,-15463.11 1142.74,-15458.05 1146.87,-15467.81 1152.05,-15463.11"/>
</g>
<!-- stage2_expert2_dp1_ep4_tp0 -->
<g id="node398" class="node">
<title>stage2_expert2_dp1_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1490.5,-15457.97 1255.5,-15457.97 1255.5,-15405.97 1490.5,-15405.97 1490.5,-15457.97"/>
<text text-anchor="middle" x="1373" y="-15445.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1373" y="-15434.97" font-family="Times,serif" font-size="10.00">GPU 88</text>
<text text-anchor="middle" x="1373" y="-15423.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1373" y="-15412.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep4_tp0&#45;&gt;stage2_expert2_dp1_ep4_tp0 -->
<g id="edge457" class="edge">
<title>stage2_moe_gate_dp1_ep4_tp0&#45;&gt;stage2_expert2_dp1_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1292.93,-15520.6C1309.69,-15502.26 1328.1,-15482.1 1343.04,-15465.75"/>
<polygon fill="black" stroke="black" points="1345.92,-15467.8 1350.08,-15458.05 1340.75,-15463.08 1345.92,-15467.8"/>
</g>
<!-- stage2_expert_agg_dp1_ep4_tp0 -->
<g id="node399" class="node">
<title>stage2_expert_agg_dp1_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1479.33,-15342.97 1101.79,-15342.97 1004.67,-15238.97 1382.21,-15238.97 1479.33,-15342.97"/>
<text text-anchor="middle" x="1242" y="-15304.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1242" y="-15293.97" font-family="Times,serif" font-size="10.00">GPU 88</text>
<text text-anchor="middle" x="1242" y="-15282.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1242" y="-15271.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep4_tp0&#45;&gt;stage2_expert_agg_dp1_ep4_tp0 -->
<g id="edge458" class="edge">
<title>stage2_expert1_dp1_ep4_tp0&#45;&gt;stage2_expert_agg_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M1142.09,-15405.79C1155.61,-15390.39 1173.5,-15370.01 1190.41,-15350.74"/>
<polygon fill="black" stroke="black" points="1193.11,-15352.97 1197.08,-15343.15 1187.85,-15348.35 1193.11,-15352.97"/>
</g>
<!-- stage2_expert2_dp1_ep4_tp0&#45;&gt;stage2_expert_agg_dp1_ep4_tp0 -->
<g id="edge459" class="edge">
<title>stage2_expert2_dp1_ep4_tp0&#45;&gt;stage2_expert_agg_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M1349.28,-15405.79C1334.7,-15390.32 1315.38,-15369.82 1297.16,-15350.49"/>
<polygon fill="black" stroke="black" points="1299.64,-15348.02 1290.24,-15343.15 1294.55,-15352.83 1299.64,-15348.02"/>
</g>
<!-- stage2_ln2_dp1_ep4_tp0 -->
<g id="node400" class="node">
<title>stage2_ln2_dp1_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1356.5,-15180.97 1127.5,-15180.97 1127.5,-15128.97 1356.5,-15128.97 1356.5,-15180.97"/>
<text text-anchor="middle" x="1242" y="-15168.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1242" y="-15157.97" font-family="Times,serif" font-size="10.00">GPU 88</text>
<text text-anchor="middle" x="1242" y="-15146.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1242" y="-15135.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep4_tp0&#45;&gt;stage2_ln2_dp1_ep4_tp0 -->
<g id="edge460" class="edge">
<title>stage2_expert_agg_dp1_ep4_tp0&#45;&gt;stage2_ln2_dp1_ep4_tp0</title>
<path fill="none" stroke="black" d="M1242,-15238.92C1242,-15222.97 1242,-15205.74 1242,-15191.14"/>
<polygon fill="black" stroke="black" points="1245.5,-15191.02 1242,-15181.02 1238.5,-15191.02 1245.5,-15191.02"/>
</g>
<!-- stage2_ln1_dp1_ep5_tp0 -->
<g id="node408" class="node">
<title>stage2_ln1_dp1_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1356.5,-15070.97 1127.5,-15070.97 1127.5,-15018.97 1356.5,-15018.97 1356.5,-15070.97"/>
<text text-anchor="middle" x="1242" y="-15058.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1242" y="-15047.97" font-family="Times,serif" font-size="10.00">GPU 90</text>
<text text-anchor="middle" x="1242" y="-15036.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1242" y="-15025.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep4_tp0&#45;&gt;stage2_ln1_dp1_ep5_tp0 -->
<g id="edge461" class="edge">
<title>stage2_ln2_dp1_ep4_tp0&#45;&gt;stage2_ln1_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M1242,-15128.92C1242,-15114.84 1242,-15097.04 1242,-15081.54"/>
<polygon fill="black" stroke="black" points="1245.5,-15081.25 1242,-15071.25 1238.5,-15081.25 1245.5,-15081.25"/>
</g>
<!-- stage2_mha_dp1_ep4_tp1 -->
<g id="node402" class="node">
<title>stage2_mha_dp1_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1867.5,-15753.97 1638.5,-15753.97 1638.5,-15701.97 1867.5,-15701.97 1867.5,-15753.97"/>
<text text-anchor="middle" x="1753" y="-15741.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1753" y="-15730.97" font-family="Times,serif" font-size="10.00">GPU 89</text>
<text text-anchor="middle" x="1753" y="-15719.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1753" y="-15708.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep4_tp1&#45;&gt;stage2_mha_dp1_ep4_tp1 -->
<g id="edge462" class="edge">
<title>stage2_ln1_dp1_ep4_tp1&#45;&gt;stage2_mha_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M1753,-15816.89C1753,-15801.38 1753,-15781.24 1753,-15764.15"/>
<polygon fill="black" stroke="black" points="1756.5,-15763.97 1753,-15753.97 1749.5,-15763.97 1756.5,-15763.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep4_tp1 -->
<g id="node403" class="node">
<title>stage2_moe_gate_dp1_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1997.85,-15624.97 1608.35,-15624.97 1508.15,-15520.97 1897.65,-15520.97 1997.85,-15624.97"/>
<text text-anchor="middle" x="1753" y="-15586.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1753" y="-15575.97" font-family="Times,serif" font-size="10.00">GPU 89</text>
<text text-anchor="middle" x="1753" y="-15564.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1753" y="-15553.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep4_tp1&#45;&gt;stage2_moe_gate_dp1_ep4_tp1 -->
<g id="edge463" class="edge">
<title>stage2_mha_dp1_ep4_tp1&#45;&gt;stage2_moe_gate_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M1753,-15701.7C1753,-15683.59 1753,-15658.38 1753,-15635.14"/>
<polygon fill="black" stroke="black" points="1756.5,-15634.98 1753,-15624.98 1749.5,-15634.98 1756.5,-15634.98"/>
</g>
<!-- stage2_expert1_dp1_ep4_tp1 -->
<g id="node404" class="node">
<title>stage2_expert1_dp1_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1743.5,-15457.97 1508.5,-15457.97 1508.5,-15405.97 1743.5,-15405.97 1743.5,-15457.97"/>
<text text-anchor="middle" x="1626" y="-15445.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1626" y="-15434.97" font-family="Times,serif" font-size="10.00">GPU 89</text>
<text text-anchor="middle" x="1626" y="-15423.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1626" y="-15412.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep4_tp1&#45;&gt;stage2_expert1_dp1_ep4_tp1 -->
<g id="edge464" class="edge">
<title>stage2_moe_gate_dp1_ep4_tp1&#45;&gt;stage2_expert1_dp1_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1706.07,-15520.6C1689.31,-15502.26 1670.9,-15482.1 1655.96,-15465.75"/>
<polygon fill="black" stroke="black" points="1658.25,-15463.08 1648.92,-15458.05 1653.08,-15467.8 1658.25,-15463.08"/>
</g>
<!-- stage2_expert2_dp1_ep4_tp1 -->
<g id="node405" class="node">
<title>stage2_expert2_dp1_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1996.5,-15457.97 1761.5,-15457.97 1761.5,-15405.97 1996.5,-15405.97 1996.5,-15457.97"/>
<text text-anchor="middle" x="1879" y="-15445.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1879" y="-15434.97" font-family="Times,serif" font-size="10.00">GPU 89</text>
<text text-anchor="middle" x="1879" y="-15423.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1879" y="-15412.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep4_tp1&#45;&gt;stage2_expert2_dp1_ep4_tp1 -->
<g id="edge465" class="edge">
<title>stage2_moe_gate_dp1_ep4_tp1&#45;&gt;stage2_expert2_dp1_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1799.56,-15520.6C1816.19,-15502.26 1834.46,-15482.1 1849.28,-15465.75"/>
<polygon fill="black" stroke="black" points="1852.13,-15467.81 1856.26,-15458.05 1846.95,-15463.11 1852.13,-15467.81"/>
</g>
<!-- stage2_expert_agg_dp1_ep4_tp1 -->
<g id="node406" class="node">
<title>stage2_expert_agg_dp1_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1986.33,-15342.97 1608.79,-15342.97 1511.67,-15238.97 1889.21,-15238.97 1986.33,-15342.97"/>
<text text-anchor="middle" x="1749" y="-15304.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1749" y="-15293.97" font-family="Times,serif" font-size="10.00">GPU 89</text>
<text text-anchor="middle" x="1749" y="-15282.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1749" y="-15271.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep4_tp1&#45;&gt;stage2_expert_agg_dp1_ep4_tp1 -->
<g id="edge466" class="edge">
<title>stage2_expert1_dp1_ep4_tp1&#45;&gt;stage2_expert_agg_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M1648.27,-15405.79C1661.9,-15390.39 1679.94,-15370.01 1696.99,-15350.74"/>
<polygon fill="black" stroke="black" points="1699.7,-15352.96 1703.71,-15343.15 1694.46,-15348.32 1699.7,-15352.96"/>
</g>
<!-- stage2_expert2_dp1_ep4_tp1&#45;&gt;stage2_expert_agg_dp1_ep4_tp1 -->
<g id="edge467" class="edge">
<title>stage2_expert2_dp1_ep4_tp1&#45;&gt;stage2_expert_agg_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M1855.46,-15405.79C1840.99,-15390.32 1821.82,-15369.82 1803.73,-15350.49"/>
<polygon fill="black" stroke="black" points="1806.26,-15348.06 1796.87,-15343.15 1801.14,-15352.84 1806.26,-15348.06"/>
</g>
<!-- stage2_ln2_dp1_ep4_tp1 -->
<g id="node407" class="node">
<title>stage2_ln2_dp1_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1863.5,-15180.97 1634.5,-15180.97 1634.5,-15128.97 1863.5,-15128.97 1863.5,-15180.97"/>
<text text-anchor="middle" x="1749" y="-15168.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1749" y="-15157.97" font-family="Times,serif" font-size="10.00">GPU 89</text>
<text text-anchor="middle" x="1749" y="-15146.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1749" y="-15135.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep4_tp1&#45;&gt;stage2_ln2_dp1_ep4_tp1 -->
<g id="edge468" class="edge">
<title>stage2_expert_agg_dp1_ep4_tp1&#45;&gt;stage2_ln2_dp1_ep4_tp1</title>
<path fill="none" stroke="black" d="M1749,-15238.92C1749,-15222.97 1749,-15205.74 1749,-15191.14"/>
<polygon fill="black" stroke="black" points="1752.5,-15191.02 1749,-15181.02 1745.5,-15191.02 1752.5,-15191.02"/>
</g>
<!-- stage2_ln1_dp1_ep5_tp1 -->
<g id="node415" class="node">
<title>stage2_ln1_dp1_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1863.5,-15070.97 1634.5,-15070.97 1634.5,-15018.97 1863.5,-15018.97 1863.5,-15070.97"/>
<text text-anchor="middle" x="1749" y="-15058.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1749" y="-15047.97" font-family="Times,serif" font-size="10.00">GPU 91</text>
<text text-anchor="middle" x="1749" y="-15036.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1749" y="-15025.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep4_tp1&#45;&gt;stage2_ln1_dp1_ep5_tp1 -->
<g id="edge469" class="edge">
<title>stage2_ln2_dp1_ep4_tp1&#45;&gt;stage2_ln1_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M1749,-15128.92C1749,-15114.84 1749,-15097.04 1749,-15081.54"/>
<polygon fill="black" stroke="black" points="1752.5,-15081.25 1749,-15071.25 1745.5,-15081.25 1752.5,-15081.25"/>
</g>
<!-- stage2_mha_dp1_ep5_tp0 -->
<g id="node409" class="node">
<title>stage2_mha_dp1_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1356.5,-14955.97 1127.5,-14955.97 1127.5,-14903.97 1356.5,-14903.97 1356.5,-14955.97"/>
<text text-anchor="middle" x="1242" y="-14943.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1242" y="-14932.97" font-family="Times,serif" font-size="10.00">GPU 90</text>
<text text-anchor="middle" x="1242" y="-14921.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1242" y="-14910.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep5_tp0&#45;&gt;stage2_mha_dp1_ep5_tp0 -->
<g id="edge470" class="edge">
<title>stage2_ln1_dp1_ep5_tp0&#45;&gt;stage2_mha_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M1242,-15018.89C1242,-15003.38 1242,-14983.24 1242,-14966.15"/>
<polygon fill="black" stroke="black" points="1245.5,-14965.97 1242,-14955.97 1238.5,-14965.97 1245.5,-14965.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep5_tp0 -->
<g id="node410" class="node">
<title>stage2_moe_gate_dp1_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1486.85,-14826.97 1097.35,-14826.97 997.15,-14722.97 1386.65,-14722.97 1486.85,-14826.97"/>
<text text-anchor="middle" x="1242" y="-14788.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1242" y="-14777.97" font-family="Times,serif" font-size="10.00">GPU 90</text>
<text text-anchor="middle" x="1242" y="-14766.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1242" y="-14755.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep5_tp0&#45;&gt;stage2_moe_gate_dp1_ep5_tp0 -->
<g id="edge471" class="edge">
<title>stage2_mha_dp1_ep5_tp0&#45;&gt;stage2_moe_gate_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M1242,-14903.7C1242,-14885.59 1242,-14860.38 1242,-14837.14"/>
<polygon fill="black" stroke="black" points="1245.5,-14836.98 1242,-14826.98 1238.5,-14836.98 1245.5,-14836.98"/>
</g>
<!-- stage2_expert1_dp1_ep5_tp0 -->
<g id="node411" class="node">
<title>stage2_expert1_dp1_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1233.5,-14659.97 998.5,-14659.97 998.5,-14607.97 1233.5,-14607.97 1233.5,-14659.97"/>
<text text-anchor="middle" x="1116" y="-14647.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1116" y="-14636.97" font-family="Times,serif" font-size="10.00">GPU 90</text>
<text text-anchor="middle" x="1116" y="-14625.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1116" y="-14614.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep5_tp0&#45;&gt;stage2_expert1_dp1_ep5_tp0 -->
<g id="edge472" class="edge">
<title>stage2_moe_gate_dp1_ep5_tp0&#45;&gt;stage2_expert1_dp1_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1195.44,-14722.6C1178.81,-14704.26 1160.54,-14684.1 1145.72,-14667.75"/>
<polygon fill="black" stroke="black" points="1148.05,-14665.11 1138.74,-14660.05 1142.87,-14669.81 1148.05,-14665.11"/>
</g>
<!-- stage2_expert2_dp1_ep5_tp0 -->
<g id="node412" class="node">
<title>stage2_expert2_dp1_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1486.5,-14659.97 1251.5,-14659.97 1251.5,-14607.97 1486.5,-14607.97 1486.5,-14659.97"/>
<text text-anchor="middle" x="1369" y="-14647.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1369" y="-14636.97" font-family="Times,serif" font-size="10.00">GPU 90</text>
<text text-anchor="middle" x="1369" y="-14625.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1369" y="-14614.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep5_tp0&#45;&gt;stage2_expert2_dp1_ep5_tp0 -->
<g id="edge473" class="edge">
<title>stage2_moe_gate_dp1_ep5_tp0&#45;&gt;stage2_expert2_dp1_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1288.93,-14722.6C1305.69,-14704.26 1324.1,-14684.1 1339.04,-14667.75"/>
<polygon fill="black" stroke="black" points="1341.92,-14669.8 1346.08,-14660.05 1336.75,-14665.08 1341.92,-14669.8"/>
</g>
<!-- stage2_expert_agg_dp1_ep5_tp0 -->
<g id="node413" class="node">
<title>stage2_expert_agg_dp1_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1483.33,-14544.97 1105.79,-14544.97 1008.67,-14440.97 1386.21,-14440.97 1483.33,-14544.97"/>
<text text-anchor="middle" x="1246" y="-14506.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1246" y="-14495.97" font-family="Times,serif" font-size="10.00">GPU 90</text>
<text text-anchor="middle" x="1246" y="-14484.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1246" y="-14473.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep5_tp0&#45;&gt;stage2_expert_agg_dp1_ep5_tp0 -->
<g id="edge474" class="edge">
<title>stage2_expert1_dp1_ep5_tp0&#45;&gt;stage2_expert_agg_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M1139.54,-14607.79C1154.01,-14592.32 1173.18,-14571.82 1191.27,-14552.49"/>
<polygon fill="black" stroke="black" points="1193.86,-14554.84 1198.13,-14545.15 1188.74,-14550.06 1193.86,-14554.84"/>
</g>
<!-- stage2_expert2_dp1_ep5_tp0&#45;&gt;stage2_expert_agg_dp1_ep5_tp0 -->
<g id="edge475" class="edge">
<title>stage2_expert2_dp1_ep5_tp0&#45;&gt;stage2_expert_agg_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M1346.73,-14607.79C1333.1,-14592.39 1315.06,-14572.01 1298.01,-14552.74"/>
<polygon fill="black" stroke="black" points="1300.54,-14550.32 1291.29,-14545.15 1295.3,-14554.96 1300.54,-14550.32"/>
</g>
<!-- stage2_ln2_dp1_ep5_tp0 -->
<g id="node414" class="node">
<title>stage2_ln2_dp1_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1360.5,-14382.97 1131.5,-14382.97 1131.5,-14330.97 1360.5,-14330.97 1360.5,-14382.97"/>
<text text-anchor="middle" x="1246" y="-14370.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1246" y="-14359.97" font-family="Times,serif" font-size="10.00">GPU 90</text>
<text text-anchor="middle" x="1246" y="-14348.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1246" y="-14337.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep5_tp0&#45;&gt;stage2_ln2_dp1_ep5_tp0 -->
<g id="edge476" class="edge">
<title>stage2_expert_agg_dp1_ep5_tp0&#45;&gt;stage2_ln2_dp1_ep5_tp0</title>
<path fill="none" stroke="black" d="M1246,-14440.92C1246,-14424.97 1246,-14407.74 1246,-14393.14"/>
<polygon fill="black" stroke="black" points="1249.5,-14393.02 1246,-14383.02 1242.5,-14393.02 1249.5,-14393.02"/>
</g>
<!-- stage2_ln1_dp1_ep6_tp0 -->
<g id="node422" class="node">
<title>stage2_ln1_dp1_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1360.5,-14272.97 1131.5,-14272.97 1131.5,-14220.97 1360.5,-14220.97 1360.5,-14272.97"/>
<text text-anchor="middle" x="1246" y="-14260.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1246" y="-14249.97" font-family="Times,serif" font-size="10.00">GPU 92</text>
<text text-anchor="middle" x="1246" y="-14238.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1246" y="-14227.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep5_tp0&#45;&gt;stage2_ln1_dp1_ep6_tp0 -->
<g id="edge477" class="edge">
<title>stage2_ln2_dp1_ep5_tp0&#45;&gt;stage2_ln1_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M1246,-14330.92C1246,-14316.84 1246,-14299.04 1246,-14283.54"/>
<polygon fill="black" stroke="black" points="1249.5,-14283.25 1246,-14273.25 1242.5,-14283.25 1249.5,-14283.25"/>
</g>
<!-- stage2_mha_dp1_ep5_tp1 -->
<g id="node416" class="node">
<title>stage2_mha_dp1_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1863.5,-14955.97 1634.5,-14955.97 1634.5,-14903.97 1863.5,-14903.97 1863.5,-14955.97"/>
<text text-anchor="middle" x="1749" y="-14943.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1749" y="-14932.97" font-family="Times,serif" font-size="10.00">GPU 91</text>
<text text-anchor="middle" x="1749" y="-14921.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1749" y="-14910.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep5_tp1&#45;&gt;stage2_mha_dp1_ep5_tp1 -->
<g id="edge478" class="edge">
<title>stage2_ln1_dp1_ep5_tp1&#45;&gt;stage2_mha_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M1749,-15018.89C1749,-15003.38 1749,-14983.24 1749,-14966.15"/>
<polygon fill="black" stroke="black" points="1752.5,-14965.97 1749,-14955.97 1745.5,-14965.97 1752.5,-14965.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep5_tp1 -->
<g id="node417" class="node">
<title>stage2_moe_gate_dp1_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1993.85,-14826.97 1604.35,-14826.97 1504.15,-14722.97 1893.65,-14722.97 1993.85,-14826.97"/>
<text text-anchor="middle" x="1749" y="-14788.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1749" y="-14777.97" font-family="Times,serif" font-size="10.00">GPU 91</text>
<text text-anchor="middle" x="1749" y="-14766.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1749" y="-14755.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep5_tp1&#45;&gt;stage2_moe_gate_dp1_ep5_tp1 -->
<g id="edge479" class="edge">
<title>stage2_mha_dp1_ep5_tp1&#45;&gt;stage2_moe_gate_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M1749,-14903.7C1749,-14885.59 1749,-14860.38 1749,-14837.14"/>
<polygon fill="black" stroke="black" points="1752.5,-14836.98 1749,-14826.98 1745.5,-14836.98 1752.5,-14836.98"/>
</g>
<!-- stage2_expert1_dp1_ep5_tp1 -->
<g id="node418" class="node">
<title>stage2_expert1_dp1_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1739.5,-14659.97 1504.5,-14659.97 1504.5,-14607.97 1739.5,-14607.97 1739.5,-14659.97"/>
<text text-anchor="middle" x="1622" y="-14647.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1622" y="-14636.97" font-family="Times,serif" font-size="10.00">GPU 91</text>
<text text-anchor="middle" x="1622" y="-14625.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1622" y="-14614.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep5_tp1&#45;&gt;stage2_expert1_dp1_ep5_tp1 -->
<g id="edge480" class="edge">
<title>stage2_moe_gate_dp1_ep5_tp1&#45;&gt;stage2_expert1_dp1_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1702.07,-14722.6C1685.31,-14704.26 1666.9,-14684.1 1651.96,-14667.75"/>
<polygon fill="black" stroke="black" points="1654.25,-14665.08 1644.92,-14660.05 1649.08,-14669.8 1654.25,-14665.08"/>
</g>
<!-- stage2_expert2_dp1_ep5_tp1 -->
<g id="node419" class="node">
<title>stage2_expert2_dp1_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1992.5,-14659.97 1757.5,-14659.97 1757.5,-14607.97 1992.5,-14607.97 1992.5,-14659.97"/>
<text text-anchor="middle" x="1875" y="-14647.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1875" y="-14636.97" font-family="Times,serif" font-size="10.00">GPU 91</text>
<text text-anchor="middle" x="1875" y="-14625.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1875" y="-14614.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep5_tp1&#45;&gt;stage2_expert2_dp1_ep5_tp1 -->
<g id="edge481" class="edge">
<title>stage2_moe_gate_dp1_ep5_tp1&#45;&gt;stage2_expert2_dp1_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1795.56,-14722.6C1812.19,-14704.26 1830.46,-14684.1 1845.28,-14667.75"/>
<polygon fill="black" stroke="black" points="1848.13,-14669.81 1852.26,-14660.05 1842.95,-14665.11 1848.13,-14669.81"/>
</g>
<!-- stage2_expert_agg_dp1_ep5_tp1 -->
<g id="node420" class="node">
<title>stage2_expert_agg_dp1_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1990.33,-14544.97 1612.79,-14544.97 1515.67,-14440.97 1893.21,-14440.97 1990.33,-14544.97"/>
<text text-anchor="middle" x="1753" y="-14506.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1753" y="-14495.97" font-family="Times,serif" font-size="10.00">GPU 91</text>
<text text-anchor="middle" x="1753" y="-14484.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1753" y="-14473.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep5_tp1&#45;&gt;stage2_expert_agg_dp1_ep5_tp1 -->
<g id="edge482" class="edge">
<title>stage2_expert1_dp1_ep5_tp1&#45;&gt;stage2_expert_agg_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M1645.72,-14607.79C1660.3,-14592.32 1679.62,-14571.82 1697.84,-14552.49"/>
<polygon fill="black" stroke="black" points="1700.45,-14554.83 1704.76,-14545.15 1695.36,-14550.02 1700.45,-14554.83"/>
</g>
<!-- stage2_expert2_dp1_ep5_tp1&#45;&gt;stage2_expert_agg_dp1_ep5_tp1 -->
<g id="edge483" class="edge">
<title>stage2_expert2_dp1_ep5_tp1&#45;&gt;stage2_expert_agg_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M1852.91,-14607.79C1839.39,-14592.39 1821.5,-14572.01 1804.59,-14552.74"/>
<polygon fill="black" stroke="black" points="1807.15,-14550.35 1797.92,-14545.15 1801.89,-14554.97 1807.15,-14550.35"/>
</g>
<!-- stage2_ln2_dp1_ep5_tp1 -->
<g id="node421" class="node">
<title>stage2_ln2_dp1_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1867.5,-14382.97 1638.5,-14382.97 1638.5,-14330.97 1867.5,-14330.97 1867.5,-14382.97"/>
<text text-anchor="middle" x="1753" y="-14370.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1753" y="-14359.97" font-family="Times,serif" font-size="10.00">GPU 91</text>
<text text-anchor="middle" x="1753" y="-14348.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1753" y="-14337.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep5_tp1&#45;&gt;stage2_ln2_dp1_ep5_tp1 -->
<g id="edge484" class="edge">
<title>stage2_expert_agg_dp1_ep5_tp1&#45;&gt;stage2_ln2_dp1_ep5_tp1</title>
<path fill="none" stroke="black" d="M1753,-14440.92C1753,-14424.97 1753,-14407.74 1753,-14393.14"/>
<polygon fill="black" stroke="black" points="1756.5,-14393.02 1753,-14383.02 1749.5,-14393.02 1756.5,-14393.02"/>
</g>
<!-- stage2_ln1_dp1_ep6_tp1 -->
<g id="node429" class="node">
<title>stage2_ln1_dp1_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1867.5,-14272.97 1638.5,-14272.97 1638.5,-14220.97 1867.5,-14220.97 1867.5,-14272.97"/>
<text text-anchor="middle" x="1753" y="-14260.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1753" y="-14249.97" font-family="Times,serif" font-size="10.00">GPU 93</text>
<text text-anchor="middle" x="1753" y="-14238.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1753" y="-14227.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep5_tp1&#45;&gt;stage2_ln1_dp1_ep6_tp1 -->
<g id="edge485" class="edge">
<title>stage2_ln2_dp1_ep5_tp1&#45;&gt;stage2_ln1_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M1753,-14330.92C1753,-14316.84 1753,-14299.04 1753,-14283.54"/>
<polygon fill="black" stroke="black" points="1756.5,-14283.25 1753,-14273.25 1749.5,-14283.25 1756.5,-14283.25"/>
</g>
<!-- stage2_mha_dp1_ep6_tp0 -->
<g id="node423" class="node">
<title>stage2_mha_dp1_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1360.5,-14157.97 1131.5,-14157.97 1131.5,-14105.97 1360.5,-14105.97 1360.5,-14157.97"/>
<text text-anchor="middle" x="1246" y="-14145.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1246" y="-14134.97" font-family="Times,serif" font-size="10.00">GPU 92</text>
<text text-anchor="middle" x="1246" y="-14123.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1246" y="-14112.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep6_tp0&#45;&gt;stage2_mha_dp1_ep6_tp0 -->
<g id="edge486" class="edge">
<title>stage2_ln1_dp1_ep6_tp0&#45;&gt;stage2_mha_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M1246,-14220.89C1246,-14205.38 1246,-14185.24 1246,-14168.15"/>
<polygon fill="black" stroke="black" points="1249.5,-14167.97 1246,-14157.97 1242.5,-14167.97 1249.5,-14167.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep6_tp0 -->
<g id="node424" class="node">
<title>stage2_moe_gate_dp1_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1490.85,-14028.97 1101.35,-14028.97 1001.15,-13924.97 1390.65,-13924.97 1490.85,-14028.97"/>
<text text-anchor="middle" x="1246" y="-13990.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1246" y="-13979.97" font-family="Times,serif" font-size="10.00">GPU 92</text>
<text text-anchor="middle" x="1246" y="-13968.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1246" y="-13957.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep6_tp0&#45;&gt;stage2_moe_gate_dp1_ep6_tp0 -->
<g id="edge487" class="edge">
<title>stage2_mha_dp1_ep6_tp0&#45;&gt;stage2_moe_gate_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M1246,-14105.7C1246,-14087.59 1246,-14062.38 1246,-14039.14"/>
<polygon fill="black" stroke="black" points="1249.5,-14038.98 1246,-14028.98 1242.5,-14038.98 1249.5,-14038.98"/>
</g>
<!-- stage2_expert1_dp1_ep6_tp0 -->
<g id="node425" class="node">
<title>stage2_expert1_dp1_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1237.5,-13861.97 1002.5,-13861.97 1002.5,-13809.97 1237.5,-13809.97 1237.5,-13861.97"/>
<text text-anchor="middle" x="1120" y="-13849.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1120" y="-13838.97" font-family="Times,serif" font-size="10.00">GPU 92</text>
<text text-anchor="middle" x="1120" y="-13827.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1120" y="-13816.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep6_tp0&#45;&gt;stage2_expert1_dp1_ep6_tp0 -->
<g id="edge488" class="edge">
<title>stage2_moe_gate_dp1_ep6_tp0&#45;&gt;stage2_expert1_dp1_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1199.44,-13924.6C1182.81,-13906.26 1164.54,-13886.1 1149.72,-13869.75"/>
<polygon fill="black" stroke="black" points="1152.05,-13867.11 1142.74,-13862.05 1146.87,-13871.81 1152.05,-13867.11"/>
</g>
<!-- stage2_expert2_dp1_ep6_tp0 -->
<g id="node426" class="node">
<title>stage2_expert2_dp1_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1490.5,-13861.97 1255.5,-13861.97 1255.5,-13809.97 1490.5,-13809.97 1490.5,-13861.97"/>
<text text-anchor="middle" x="1373" y="-13849.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1373" y="-13838.97" font-family="Times,serif" font-size="10.00">GPU 92</text>
<text text-anchor="middle" x="1373" y="-13827.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1373" y="-13816.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep6_tp0&#45;&gt;stage2_expert2_dp1_ep6_tp0 -->
<g id="edge489" class="edge">
<title>stage2_moe_gate_dp1_ep6_tp0&#45;&gt;stage2_expert2_dp1_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1292.93,-13924.6C1309.69,-13906.26 1328.1,-13886.1 1343.04,-13869.75"/>
<polygon fill="black" stroke="black" points="1345.92,-13871.8 1350.08,-13862.05 1340.75,-13867.08 1345.92,-13871.8"/>
</g>
<!-- stage2_expert_agg_dp1_ep6_tp0 -->
<g id="node427" class="node">
<title>stage2_expert_agg_dp1_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1505.33,-13746.97 1127.79,-13746.97 1030.67,-13642.97 1408.21,-13642.97 1505.33,-13746.97"/>
<text text-anchor="middle" x="1268" y="-13708.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1268" y="-13697.97" font-family="Times,serif" font-size="10.00">GPU 92</text>
<text text-anchor="middle" x="1268" y="-13686.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1268" y="-13675.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep6_tp0&#45;&gt;stage2_expert_agg_dp1_ep6_tp0 -->
<g id="edge490" class="edge">
<title>stage2_expert1_dp1_ep6_tp0&#45;&gt;stage2_expert_agg_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M1146.8,-13809.79C1163.35,-13794.26 1185.29,-13773.64 1205.96,-13754.23"/>
<polygon fill="black" stroke="black" points="1208.61,-13756.55 1213.5,-13747.15 1203.82,-13751.44 1208.61,-13756.55"/>
</g>
<!-- stage2_expert2_dp1_ep6_tp0&#45;&gt;stage2_expert_agg_dp1_ep6_tp0 -->
<g id="edge491" class="edge">
<title>stage2_expert2_dp1_ep6_tp0&#45;&gt;stage2_expert_agg_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M1353.99,-13809.79C1342.45,-13794.53 1327.22,-13774.37 1312.79,-13755.26"/>
<polygon fill="black" stroke="black" points="1315.48,-13753.02 1306.66,-13747.15 1309.9,-13757.24 1315.48,-13753.02"/>
</g>
<!-- stage2_ln2_dp1_ep6_tp0 -->
<g id="node428" class="node">
<title>stage2_ln2_dp1_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1624.5,-13584.97 1395.5,-13584.97 1395.5,-13532.97 1624.5,-13532.97 1624.5,-13584.97"/>
<text text-anchor="middle" x="1510" y="-13572.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1510" y="-13561.97" font-family="Times,serif" font-size="10.00">GPU 92</text>
<text text-anchor="middle" x="1510" y="-13550.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1510" y="-13539.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep6_tp0&#45;&gt;stage2_ln2_dp1_ep6_tp0 -->
<g id="edge492" class="edge">
<title>stage2_expert_agg_dp1_ep6_tp0&#45;&gt;stage2_ln2_dp1_ep6_tp0</title>
<path fill="none" stroke="black" d="M1360.18,-13642.92C1392.48,-13625.04 1427.69,-13605.54 1455.86,-13589.94"/>
<polygon fill="black" stroke="black" points="1457.69,-13592.93 1464.74,-13585.02 1454.3,-13586.81 1457.69,-13592.93"/>
</g>
<!-- stage2_ln1_dp1_ep7_tp0 -->
<g id="node436" class="node">
<title>stage2_ln1_dp1_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1716.5,-13471.97 1487.5,-13471.97 1487.5,-13419.97 1716.5,-13419.97 1716.5,-13471.97"/>
<text text-anchor="middle" x="1602" y="-13459.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1602" y="-13448.97" font-family="Times,serif" font-size="10.00">GPU 94</text>
<text text-anchor="middle" x="1602" y="-13437.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1602" y="-13426.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep6_tp0&#45;&gt;stage2_ln1_dp1_ep7_tp0 -->
<g id="edge493" class="edge">
<title>stage2_ln2_dp1_ep6_tp0&#45;&gt;stage2_ln1_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M1530.88,-13532.78C1543.82,-13517.17 1560.58,-13496.94 1574.58,-13480.05"/>
<polygon fill="black" stroke="black" points="1577.52,-13481.99 1581.21,-13472.06 1572.13,-13477.53 1577.52,-13481.99"/>
</g>
<!-- stage2_mha_dp1_ep6_tp1 -->
<g id="node430" class="node">
<title>stage2_mha_dp1_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1867.5,-14157.97 1638.5,-14157.97 1638.5,-14105.97 1867.5,-14105.97 1867.5,-14157.97"/>
<text text-anchor="middle" x="1753" y="-14145.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1753" y="-14134.97" font-family="Times,serif" font-size="10.00">GPU 93</text>
<text text-anchor="middle" x="1753" y="-14123.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1753" y="-14112.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep6_tp1&#45;&gt;stage2_mha_dp1_ep6_tp1 -->
<g id="edge494" class="edge">
<title>stage2_ln1_dp1_ep6_tp1&#45;&gt;stage2_mha_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M1753,-14220.89C1753,-14205.38 1753,-14185.24 1753,-14168.15"/>
<polygon fill="black" stroke="black" points="1756.5,-14167.97 1753,-14157.97 1749.5,-14167.97 1756.5,-14167.97"/>
</g>
<!-- stage2_moe_gate_dp1_ep6_tp1 -->
<g id="node431" class="node">
<title>stage2_moe_gate_dp1_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1997.85,-14028.97 1608.35,-14028.97 1508.15,-13924.97 1897.65,-13924.97 1997.85,-14028.97"/>
<text text-anchor="middle" x="1753" y="-13990.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1753" y="-13979.97" font-family="Times,serif" font-size="10.00">GPU 93</text>
<text text-anchor="middle" x="1753" y="-13968.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1753" y="-13957.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep6_tp1&#45;&gt;stage2_moe_gate_dp1_ep6_tp1 -->
<g id="edge495" class="edge">
<title>stage2_mha_dp1_ep6_tp1&#45;&gt;stage2_moe_gate_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M1753,-14105.7C1753,-14087.59 1753,-14062.38 1753,-14039.14"/>
<polygon fill="black" stroke="black" points="1756.5,-14038.98 1753,-14028.98 1749.5,-14038.98 1756.5,-14038.98"/>
</g>
<!-- stage2_expert1_dp1_ep6_tp1 -->
<g id="node432" class="node">
<title>stage2_expert1_dp1_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1743.5,-13861.97 1508.5,-13861.97 1508.5,-13809.97 1743.5,-13809.97 1743.5,-13861.97"/>
<text text-anchor="middle" x="1626" y="-13849.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1626" y="-13838.97" font-family="Times,serif" font-size="10.00">GPU 93</text>
<text text-anchor="middle" x="1626" y="-13827.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1626" y="-13816.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep6_tp1&#45;&gt;stage2_expert1_dp1_ep6_tp1 -->
<g id="edge496" class="edge">
<title>stage2_moe_gate_dp1_ep6_tp1&#45;&gt;stage2_expert1_dp1_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1706.07,-13924.6C1689.31,-13906.26 1670.9,-13886.1 1655.96,-13869.75"/>
<polygon fill="black" stroke="black" points="1658.25,-13867.08 1648.92,-13862.05 1653.08,-13871.8 1658.25,-13867.08"/>
</g>
<!-- stage2_expert2_dp1_ep6_tp1 -->
<g id="node433" class="node">
<title>stage2_expert2_dp1_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1996.5,-13861.97 1761.5,-13861.97 1761.5,-13809.97 1996.5,-13809.97 1996.5,-13861.97"/>
<text text-anchor="middle" x="1879" y="-13849.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1879" y="-13838.97" font-family="Times,serif" font-size="10.00">GPU 93</text>
<text text-anchor="middle" x="1879" y="-13827.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1879" y="-13816.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep6_tp1&#45;&gt;stage2_expert2_dp1_ep6_tp1 -->
<g id="edge497" class="edge">
<title>stage2_moe_gate_dp1_ep6_tp1&#45;&gt;stage2_expert2_dp1_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1799.56,-13924.6C1816.19,-13906.26 1834.46,-13886.1 1849.28,-13869.75"/>
<polygon fill="black" stroke="black" points="1852.13,-13871.81 1856.26,-13862.05 1846.95,-13867.11 1852.13,-13871.81"/>
</g>
<!-- stage2_expert_agg_dp1_ep6_tp1 -->
<g id="node434" class="node">
<title>stage2_expert_agg_dp1_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="1998.33,-13746.97 1620.79,-13746.97 1523.67,-13642.97 1901.21,-13642.97 1998.33,-13746.97"/>
<text text-anchor="middle" x="1761" y="-13708.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1761" y="-13697.97" font-family="Times,serif" font-size="10.00">GPU 93</text>
<text text-anchor="middle" x="1761" y="-13686.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1761" y="-13675.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep6_tp1&#45;&gt;stage2_expert_agg_dp1_ep6_tp1 -->
<g id="edge498" class="edge">
<title>stage2_expert1_dp1_ep6_tp1&#45;&gt;stage2_expert_agg_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M1650.45,-13809.79C1665.47,-13794.32 1685.38,-13773.82 1704.16,-13754.49"/>
<polygon fill="black" stroke="black" points="1706.83,-13756.76 1711.29,-13747.15 1701.81,-13751.88 1706.83,-13756.76"/>
</g>
<!-- stage2_expert2_dp1_ep6_tp1&#45;&gt;stage2_expert_agg_dp1_ep6_tp1 -->
<g id="edge499" class="edge">
<title>stage2_expert2_dp1_ep6_tp1&#45;&gt;stage2_expert_agg_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M1857.63,-13809.79C1844.61,-13794.46 1827.4,-13774.19 1811.12,-13755"/>
<polygon fill="black" stroke="black" points="1813.59,-13752.51 1804.45,-13747.15 1808.25,-13757.04 1813.59,-13752.51"/>
</g>
<!-- stage2_ln2_dp1_ep6_tp1 -->
<g id="node435" class="node">
<title>stage2_ln2_dp1_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="1908.5,-13584.97 1679.5,-13584.97 1679.5,-13532.97 1908.5,-13532.97 1908.5,-13584.97"/>
<text text-anchor="middle" x="1794" y="-13572.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1794" y="-13561.97" font-family="Times,serif" font-size="10.00">GPU 93</text>
<text text-anchor="middle" x="1794" y="-13550.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1794" y="-13539.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep6_tp1&#45;&gt;stage2_ln2_dp1_ep6_tp1 -->
<g id="edge500" class="edge">
<title>stage2_expert_agg_dp1_ep6_tp1&#45;&gt;stage2_ln2_dp1_ep6_tp1</title>
<path fill="none" stroke="black" d="M1773.57,-13642.92C1777.5,-13626.97 1781.74,-13609.74 1785.34,-13595.14"/>
<polygon fill="black" stroke="black" points="1788.84,-13595.57 1787.83,-13585.02 1782.04,-13593.9 1788.84,-13595.57"/>
</g>
<!-- stage2_ln1_dp1_ep7_tp1 -->
<g id="node443" class="node">
<title>stage2_ln1_dp1_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2223.5,-13471.97 1994.5,-13471.97 1994.5,-13419.97 2223.5,-13419.97 2223.5,-13471.97"/>
<text text-anchor="middle" x="2109" y="-13459.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2109" y="-13448.97" font-family="Times,serif" font-size="10.00">GPU 95</text>
<text text-anchor="middle" x="2109" y="-13437.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2109" y="-13426.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep6_tp1&#45;&gt;stage2_ln1_dp1_ep7_tp1 -->
<g id="edge501" class="edge">
<title>stage2_ln2_dp1_ep6_tp1&#45;&gt;stage2_ln1_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M1865.08,-13532.92C1913.58,-13515.83 1977.92,-13493.16 2028.33,-13475.4"/>
<polygon fill="black" stroke="black" points="2029.63,-13478.65 2037.9,-13472.03 2027.31,-13472.05 2029.63,-13478.65"/>
</g>
<!-- stage2_mha_dp1_ep7_tp0 -->
<g id="node437" class="node">
<title>stage2_mha_dp1_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1716.5,-13356.97 1487.5,-13356.97 1487.5,-13304.97 1716.5,-13304.97 1716.5,-13356.97"/>
<text text-anchor="middle" x="1602" y="-13344.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1602" y="-13333.97" font-family="Times,serif" font-size="10.00">GPU 94</text>
<text text-anchor="middle" x="1602" y="-13322.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1602" y="-13311.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep7_tp0&#45;&gt;stage2_mha_dp1_ep7_tp0 -->
<g id="edge502" class="edge">
<title>stage2_ln1_dp1_ep7_tp0&#45;&gt;stage2_mha_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M1602,-13419.9C1602,-13404.39 1602,-13384.25 1602,-13367.16"/>
<polygon fill="black" stroke="black" points="1605.5,-13366.98 1602,-13356.98 1598.5,-13366.98 1605.5,-13366.98"/>
</g>
<!-- stage2_moe_gate_dp1_ep7_tp0 -->
<g id="node438" class="node">
<title>stage2_moe_gate_dp1_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1846.85,-13227.97 1457.35,-13227.97 1357.15,-13123.97 1746.65,-13123.97 1846.85,-13227.97"/>
<text text-anchor="middle" x="1602" y="-13189.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1602" y="-13178.97" font-family="Times,serif" font-size="10.00">GPU 94</text>
<text text-anchor="middle" x="1602" y="-13167.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1602" y="-13156.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep7_tp0&#45;&gt;stage2_moe_gate_dp1_ep7_tp0 -->
<g id="edge503" class="edge">
<title>stage2_mha_dp1_ep7_tp0&#45;&gt;stage2_moe_gate_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M1602,-13304.71C1602,-13286.6 1602,-13261.39 1602,-13238.15"/>
<polygon fill="black" stroke="black" points="1605.5,-13237.99 1602,-13227.99 1598.5,-13237.99 1605.5,-13237.99"/>
</g>
<!-- stage2_expert1_dp1_ep7_tp0 -->
<g id="node439" class="node">
<title>stage2_expert1_dp1_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1593.5,-13060.97 1358.5,-13060.97 1358.5,-13008.97 1593.5,-13008.97 1593.5,-13060.97"/>
<text text-anchor="middle" x="1476" y="-13048.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1476" y="-13037.97" font-family="Times,serif" font-size="10.00">GPU 94</text>
<text text-anchor="middle" x="1476" y="-13026.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1476" y="-13015.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep7_tp0&#45;&gt;stage2_expert1_dp1_ep7_tp0 -->
<g id="edge504" class="edge">
<title>stage2_moe_gate_dp1_ep7_tp0&#45;&gt;stage2_expert1_dp1_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1555.44,-13123.61C1538.81,-13105.27 1520.54,-13085.11 1505.72,-13068.76"/>
<polygon fill="black" stroke="black" points="1508.05,-13066.12 1498.74,-13061.06 1502.87,-13070.82 1508.05,-13066.12"/>
</g>
<!-- stage2_expert2_dp1_ep7_tp0 -->
<g id="node440" class="node">
<title>stage2_expert2_dp1_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1846.5,-13060.97 1611.5,-13060.97 1611.5,-13008.97 1846.5,-13008.97 1846.5,-13060.97"/>
<text text-anchor="middle" x="1729" y="-13048.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1729" y="-13037.97" font-family="Times,serif" font-size="10.00">GPU 94</text>
<text text-anchor="middle" x="1729" y="-13026.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1729" y="-13015.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep7_tp0&#45;&gt;stage2_expert2_dp1_ep7_tp0 -->
<g id="edge505" class="edge">
<title>stage2_moe_gate_dp1_ep7_tp0&#45;&gt;stage2_expert2_dp1_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1648.93,-13123.61C1665.69,-13105.27 1684.1,-13085.11 1699.04,-13068.76"/>
<polygon fill="black" stroke="black" points="1701.92,-13070.81 1706.08,-13061.06 1696.75,-13066.08 1701.92,-13070.81"/>
</g>
<!-- stage2_expert_agg_dp1_ep7_tp0 -->
<g id="node441" class="node">
<title>stage2_expert_agg_dp1_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1845.33,-12945.97 1467.79,-12945.97 1370.67,-12841.97 1748.21,-12841.97 1845.33,-12945.97"/>
<text text-anchor="middle" x="1608" y="-12907.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1608" y="-12896.97" font-family="Times,serif" font-size="10.00">GPU 94</text>
<text text-anchor="middle" x="1608" y="-12885.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1608" y="-12874.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep7_tp0&#45;&gt;stage2_expert_agg_dp1_ep7_tp0 -->
<g id="edge506" class="edge">
<title>stage2_expert1_dp1_ep7_tp0&#45;&gt;stage2_expert_agg_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M1499.9,-13008.8C1514.6,-12993.33 1534.06,-12972.83 1552.42,-12953.5"/>
<polygon fill="black" stroke="black" points="1555.05,-12955.82 1559.4,-12946.16 1549.97,-12951 1555.05,-12955.82"/>
</g>
<!-- stage2_expert2_dp1_ep7_tp0&#45;&gt;stage2_expert_agg_dp1_ep7_tp0 -->
<g id="edge507" class="edge">
<title>stage2_expert2_dp1_ep7_tp0&#45;&gt;stage2_expert_agg_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M1707.09,-13008.8C1693.68,-12993.4 1675.93,-12973.01 1659.17,-12953.75"/>
<polygon fill="black" stroke="black" points="1661.76,-12951.4 1652.55,-12946.16 1656.48,-12956 1661.76,-12951.4"/>
</g>
<!-- stage2_ln2_dp1_ep7_tp0 -->
<g id="node442" class="node">
<title>stage2_ln2_dp1_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1722.5,-12783.97 1493.5,-12783.97 1493.5,-12731.97 1722.5,-12731.97 1722.5,-12783.97"/>
<text text-anchor="middle" x="1608" y="-12771.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1608" y="-12760.97" font-family="Times,serif" font-size="10.00">GPU 94</text>
<text text-anchor="middle" x="1608" y="-12749.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1608" y="-12738.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep7_tp0&#45;&gt;stage2_ln2_dp1_ep7_tp0 -->
<g id="edge508" class="edge">
<title>stage2_expert_agg_dp1_ep7_tp0&#45;&gt;stage2_ln2_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M1608,-12841.93C1608,-12825.98 1608,-12808.75 1608,-12794.15"/>
<polygon fill="black" stroke="black" points="1611.5,-12794.03 1608,-12784.03 1604.5,-12794.03 1611.5,-12794.03"/>
</g>
<!-- stage2_ln1_dp2_ep0_tp0 -->
<g id="node562" class="node">
<title>stage2_ln1_dp2_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1722.5,-12673.97 1493.5,-12673.97 1493.5,-12621.97 1722.5,-12621.97 1722.5,-12673.97"/>
<text text-anchor="middle" x="1608" y="-12661.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1608" y="-12650.97" font-family="Times,serif" font-size="10.00">GPU 144</text>
<text text-anchor="middle" x="1608" y="-12639.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1608" y="-12628.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep7_tp0&#45;&gt;stage2_ln1_dp2_ep0_tp0 -->
<g id="edge509" class="edge">
<title>stage2_ln2_dp1_ep7_tp0&#45;&gt;stage2_ln1_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M1608,-12731.93C1608,-12717.85 1608,-12700.05 1608,-12684.55"/>
<polygon fill="black" stroke="black" points="1611.5,-12684.26 1608,-12674.26 1604.5,-12684.26 1611.5,-12684.26"/>
</g>
<!-- stage2_mha_dp1_ep7_tp1 -->
<g id="node444" class="node">
<title>stage2_mha_dp1_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2223.5,-13356.97 1994.5,-13356.97 1994.5,-13304.97 2223.5,-13304.97 2223.5,-13356.97"/>
<text text-anchor="middle" x="2109" y="-13344.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2109" y="-13333.97" font-family="Times,serif" font-size="10.00">GPU 95</text>
<text text-anchor="middle" x="2109" y="-13322.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2109" y="-13311.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp1_ep7_tp1&#45;&gt;stage2_mha_dp1_ep7_tp1 -->
<g id="edge510" class="edge">
<title>stage2_ln1_dp1_ep7_tp1&#45;&gt;stage2_mha_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2109,-13419.9C2109,-13404.39 2109,-13384.25 2109,-13367.16"/>
<polygon fill="black" stroke="black" points="2112.5,-13366.98 2109,-13356.98 2105.5,-13366.98 2112.5,-13366.98"/>
</g>
<!-- stage2_moe_gate_dp1_ep7_tp1 -->
<g id="node445" class="node">
<title>stage2_moe_gate_dp1_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2353.85,-13227.97 1964.35,-13227.97 1864.15,-13123.97 2253.65,-13123.97 2353.85,-13227.97"/>
<text text-anchor="middle" x="2109" y="-13189.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2109" y="-13178.97" font-family="Times,serif" font-size="10.00">GPU 95</text>
<text text-anchor="middle" x="2109" y="-13167.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2109" y="-13156.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp1_ep7_tp1&#45;&gt;stage2_moe_gate_dp1_ep7_tp1 -->
<g id="edge511" class="edge">
<title>stage2_mha_dp1_ep7_tp1&#45;&gt;stage2_moe_gate_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2109,-13304.71C2109,-13286.6 2109,-13261.39 2109,-13238.15"/>
<polygon fill="black" stroke="black" points="2112.5,-13237.99 2109,-13227.99 2105.5,-13237.99 2112.5,-13237.99"/>
</g>
<!-- stage2_expert1_dp1_ep7_tp1 -->
<g id="node446" class="node">
<title>stage2_expert1_dp1_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2099.5,-13060.97 1864.5,-13060.97 1864.5,-13008.97 2099.5,-13008.97 2099.5,-13060.97"/>
<text text-anchor="middle" x="1982" y="-13048.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1982" y="-13037.97" font-family="Times,serif" font-size="10.00">GPU 95</text>
<text text-anchor="middle" x="1982" y="-13026.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1982" y="-13015.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep7_tp1&#45;&gt;stage2_expert1_dp1_ep7_tp1 -->
<g id="edge512" class="edge">
<title>stage2_moe_gate_dp1_ep7_tp1&#45;&gt;stage2_expert1_dp1_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2062.07,-13123.61C2045.31,-13105.27 2026.9,-13085.11 2011.96,-13068.76"/>
<polygon fill="black" stroke="black" points="2014.25,-13066.08 2004.92,-13061.06 2009.08,-13070.81 2014.25,-13066.08"/>
</g>
<!-- stage2_expert2_dp1_ep7_tp1 -->
<g id="node447" class="node">
<title>stage2_expert2_dp1_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2352.5,-13060.97 2117.5,-13060.97 2117.5,-13008.97 2352.5,-13008.97 2352.5,-13060.97"/>
<text text-anchor="middle" x="2235" y="-13048.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2235" y="-13037.97" font-family="Times,serif" font-size="10.00">GPU 95</text>
<text text-anchor="middle" x="2235" y="-13026.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2235" y="-13015.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp1_ep7_tp1&#45;&gt;stage2_expert2_dp1_ep7_tp1 -->
<g id="edge513" class="edge">
<title>stage2_moe_gate_dp1_ep7_tp1&#45;&gt;stage2_expert2_dp1_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2155.56,-13123.61C2172.19,-13105.27 2190.46,-13085.11 2205.28,-13068.76"/>
<polygon fill="black" stroke="black" points="2208.13,-13070.82 2212.26,-13061.06 2202.95,-13066.12 2208.13,-13070.82"/>
</g>
<!-- stage2_expert_agg_dp1_ep7_tp1 -->
<g id="node448" class="node">
<title>stage2_expert_agg_dp1_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2352.33,-12945.97 1974.79,-12945.97 1877.67,-12841.97 2255.21,-12841.97 2352.33,-12945.97"/>
<text text-anchor="middle" x="2115" y="-12907.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2115" y="-12896.97" font-family="Times,serif" font-size="10.00">GPU 95</text>
<text text-anchor="middle" x="2115" y="-12885.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2115" y="-12874.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp1_ep7_tp1&#45;&gt;stage2_expert_agg_dp1_ep7_tp1 -->
<g id="edge514" class="edge">
<title>stage2_expert1_dp1_ep7_tp1&#45;&gt;stage2_expert_agg_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2006.09,-13008.8C2020.89,-12993.33 2040.5,-12972.83 2059,-12953.5"/>
<polygon fill="black" stroke="black" points="2061.64,-12955.8 2066.03,-12946.16 2056.58,-12950.96 2061.64,-12955.8"/>
</g>
<!-- stage2_expert2_dp1_ep7_tp1&#45;&gt;stage2_expert_agg_dp1_ep7_tp1 -->
<g id="edge515" class="edge">
<title>stage2_expert2_dp1_ep7_tp1&#45;&gt;stage2_expert_agg_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2213.27,-13008.8C2199.97,-12993.4 2182.37,-12973.01 2165.74,-12953.75"/>
<polygon fill="black" stroke="black" points="2168.37,-12951.44 2159.19,-12946.16 2163.07,-12956.01 2168.37,-12951.44"/>
</g>
<!-- stage2_ln2_dp1_ep7_tp1 -->
<g id="node449" class="node">
<title>stage2_ln2_dp1_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2229.5,-12783.97 2000.5,-12783.97 2000.5,-12731.97 2229.5,-12731.97 2229.5,-12783.97"/>
<text text-anchor="middle" x="2115" y="-12771.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2115" y="-12760.97" font-family="Times,serif" font-size="10.00">GPU 95</text>
<text text-anchor="middle" x="2115" y="-12749.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2115" y="-12738.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp1_ep7_tp1&#45;&gt;stage2_ln2_dp1_ep7_tp1 -->
<g id="edge516" class="edge">
<title>stage2_expert_agg_dp1_ep7_tp1&#45;&gt;stage2_ln2_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2115,-12841.93C2115,-12825.98 2115,-12808.75 2115,-12794.15"/>
<polygon fill="black" stroke="black" points="2118.5,-12794.03 2115,-12784.03 2111.5,-12794.03 2118.5,-12794.03"/>
</g>
<!-- stage2_ln1_dp2_ep0_tp1 -->
<g id="node569" class="node">
<title>stage2_ln1_dp2_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2229.5,-12673.97 2000.5,-12673.97 2000.5,-12621.97 2229.5,-12621.97 2229.5,-12673.97"/>
<text text-anchor="middle" x="2115" y="-12661.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2115" y="-12650.97" font-family="Times,serif" font-size="10.00">GPU 145</text>
<text text-anchor="middle" x="2115" y="-12639.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2115" y="-12628.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp1_ep7_tp1&#45;&gt;stage2_ln1_dp2_ep0_tp1 -->
<g id="edge517" class="edge">
<title>stage2_ln2_dp1_ep7_tp1&#45;&gt;stage2_ln1_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M2115,-12731.93C2115,-12717.85 2115,-12700.05 2115,-12684.55"/>
<polygon fill="black" stroke="black" points="2118.5,-12684.26 2115,-12674.26 2111.5,-12684.26 2118.5,-12684.26"/>
</g>
<!-- ln1_dp2_ep0_tp0 -->
<g id="node450" class="node">
<title>ln1_dp2_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2769.5,-13584.97 2540.5,-13584.97 2540.5,-13532.97 2769.5,-13532.97 2769.5,-13584.97"/>
<text text-anchor="middle" x="2655" y="-13572.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2655" y="-13561.97" font-family="Times,serif" font-size="10.00">GPU 128</text>
<text text-anchor="middle" x="2655" y="-13550.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2655" y="-13539.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- mha_dp2_ep0_tp0 -->
<g id="node451" class="node">
<title>mha_dp2_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2769.5,-13471.97 2540.5,-13471.97 2540.5,-13419.97 2769.5,-13419.97 2769.5,-13471.97"/>
<text text-anchor="middle" x="2655" y="-13459.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2655" y="-13448.97" font-family="Times,serif" font-size="10.00">GPU 128</text>
<text text-anchor="middle" x="2655" y="-13437.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2655" y="-13426.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep0_tp0&#45;&gt;mha_dp2_ep0_tp0 -->
<g id="edge518" class="edge">
<title>ln1_dp2_ep0_tp0&#45;&gt;mha_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M2655,-13532.78C2655,-13517.88 2655,-13498.77 2655,-13482.37"/>
<polygon fill="black" stroke="black" points="2658.5,-13482.06 2655,-13472.06 2651.5,-13482.06 2658.5,-13482.06"/>
</g>
<!-- moe_gate_dp2_ep0_tp0 -->
<g id="node452" class="node">
<title>moe_gate_dp2_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2899.85,-13382.97 2510.35,-13382.97 2410.15,-13278.97 2799.65,-13278.97 2899.85,-13382.97"/>
<text text-anchor="middle" x="2655" y="-13344.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2655" y="-13333.97" font-family="Times,serif" font-size="10.00">GPU 128</text>
<text text-anchor="middle" x="2655" y="-13322.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2655" y="-13311.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep0_tp0&#45;&gt;moe_gate_dp2_ep0_tp0 -->
<g id="edge519" class="edge">
<title>mha_dp2_ep0_tp0&#45;&gt;moe_gate_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M2655,-13419.9C2655,-13411.97 2655,-13402.83 2655,-13393.51"/>
<polygon fill="black" stroke="black" points="2658.5,-13393.37 2655,-13383.37 2651.5,-13393.37 2658.5,-13393.37"/>
</g>
<!-- expert1_dp2_ep0_tp0 -->
<g id="node453" class="node">
<title>expert1_dp2_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2646.5,-13201.97 2411.5,-13201.97 2411.5,-13149.97 2646.5,-13149.97 2646.5,-13201.97"/>
<text text-anchor="middle" x="2529" y="-13189.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2529" y="-13178.97" font-family="Times,serif" font-size="10.00">GPU 128</text>
<text text-anchor="middle" x="2529" y="-13167.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2529" y="-13156.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep0_tp0&#45;&gt;expert1_dp2_ep0_tp0 -->
<g id="edge520" class="edge">
<title>moe_gate_dp2_ep0_tp0&#45;&gt;expert1_dp2_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2612.69,-13278.6C2594.09,-13256.02 2572.79,-13230.14 2556.33,-13210.16"/>
<polygon fill="black" stroke="black" points="2558.88,-13207.75 2549.82,-13202.26 2553.47,-13212.2 2558.88,-13207.75"/>
<text text-anchor="middle" x="2652.5" y="-13249.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep0_tp0 -->
<g id="node454" class="node">
<title>expert2_dp2_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2899.5,-13201.97 2664.5,-13201.97 2664.5,-13149.97 2899.5,-13149.97 2899.5,-13201.97"/>
<text text-anchor="middle" x="2782" y="-13189.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2782" y="-13178.97" font-family="Times,serif" font-size="10.00">GPU 128</text>
<text text-anchor="middle" x="2782" y="-13167.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2782" y="-13156.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep0_tp0&#45;&gt;expert2_dp2_ep0_tp0 -->
<g id="edge521" class="edge">
<title>moe_gate_dp2_ep0_tp0&#45;&gt;expert2_dp2_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2698.97,-13278.86C2704.06,-13272.85 2709.16,-13266.79 2714,-13260.97 2727.9,-13244.27 2743.14,-13225.49 2755.66,-13209.93"/>
<polygon fill="black" stroke="black" points="2758.41,-13212.1 2761.94,-13202.11 2752.95,-13207.71 2758.41,-13212.1"/>
<text text-anchor="middle" x="2782.5" y="-13249.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep0_tp0 -->
<g id="node455" class="node">
<title>expert_agg_dp2_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2886.33,-13086.97 2508.79,-13086.97 2411.67,-12982.97 2789.21,-12982.97 2886.33,-13086.97"/>
<text text-anchor="middle" x="2649" y="-13048.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2649" y="-13037.97" font-family="Times,serif" font-size="10.00">GPU 128</text>
<text text-anchor="middle" x="2649" y="-13026.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2649" y="-13015.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep0_tp0&#45;&gt;expert_agg_dp2_ep0_tp0 -->
<g id="edge522" class="edge">
<title>expert1_dp2_ep0_tp0&#45;&gt;expert_agg_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M2550.73,-13149.8C2564.03,-13134.4 2581.63,-13114.01 2598.26,-13094.75"/>
<polygon fill="black" stroke="black" points="2600.93,-13097.01 2604.81,-13087.16 2595.63,-13092.44 2600.93,-13097.01"/>
</g>
<!-- expert2_dp2_ep0_tp0&#45;&gt;expert_agg_dp2_ep0_tp0 -->
<g id="edge523" class="edge">
<title>expert2_dp2_ep0_tp0&#45;&gt;expert_agg_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M2757.91,-13149.8C2743.11,-13134.33 2723.5,-13113.83 2705,-13094.5"/>
<polygon fill="black" stroke="black" points="2707.42,-13091.96 2697.97,-13087.16 2702.36,-13096.8 2707.42,-13091.96"/>
</g>
<!-- ln2_dp2_ep0_tp0 -->
<g id="node456" class="node">
<title>ln2_dp2_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2763.5,-12919.97 2534.5,-12919.97 2534.5,-12867.97 2763.5,-12867.97 2763.5,-12919.97"/>
<text text-anchor="middle" x="2649" y="-12907.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2649" y="-12896.97" font-family="Times,serif" font-size="10.00">GPU 128</text>
<text text-anchor="middle" x="2649" y="-12885.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2649" y="-12874.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep0_tp0&#45;&gt;ln2_dp2_ep0_tp0 -->
<g id="edge524" class="edge">
<title>expert_agg_dp2_ep0_tp0&#45;&gt;ln2_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M2649,-12982.61C2649,-12965.27 2649,-12946.31 2649,-12930.47"/>
<polygon fill="black" stroke="black" points="2652.5,-12930.06 2649,-12920.06 2645.5,-12930.06 2652.5,-12930.06"/>
</g>
<!-- ln1_dp2_ep1_tp0 -->
<g id="node464" class="node">
<title>ln1_dp2_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2763.5,-12783.97 2534.5,-12783.97 2534.5,-12731.97 2763.5,-12731.97 2763.5,-12783.97"/>
<text text-anchor="middle" x="2649" y="-12771.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2649" y="-12760.97" font-family="Times,serif" font-size="10.00">GPU 130</text>
<text text-anchor="middle" x="2649" y="-12749.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2649" y="-12738.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep0_tp0&#45;&gt;ln1_dp2_ep1_tp0 -->
<g id="edge525" class="edge">
<title>ln2_dp2_ep0_tp0&#45;&gt;ln1_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M2649,-12867.77C2649,-12846.99 2649,-12817.29 2649,-12794.17"/>
<polygon fill="black" stroke="black" points="2652.5,-12794.07 2649,-12784.07 2645.5,-12794.07 2652.5,-12794.07"/>
</g>
<!-- ln1_dp2_ep0_tp1 -->
<g id="node457" class="node">
<title>ln1_dp2_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3276.5,-13584.97 3047.5,-13584.97 3047.5,-13532.97 3276.5,-13532.97 3276.5,-13584.97"/>
<text text-anchor="middle" x="3162" y="-13572.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3162" y="-13561.97" font-family="Times,serif" font-size="10.00">GPU 129</text>
<text text-anchor="middle" x="3162" y="-13550.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3162" y="-13539.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- mha_dp2_ep0_tp1 -->
<g id="node458" class="node">
<title>mha_dp2_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3276.5,-13471.97 3047.5,-13471.97 3047.5,-13419.97 3276.5,-13419.97 3276.5,-13471.97"/>
<text text-anchor="middle" x="3162" y="-13459.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3162" y="-13448.97" font-family="Times,serif" font-size="10.00">GPU 129</text>
<text text-anchor="middle" x="3162" y="-13437.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3162" y="-13426.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep0_tp1&#45;&gt;mha_dp2_ep0_tp1 -->
<g id="edge526" class="edge">
<title>ln1_dp2_ep0_tp1&#45;&gt;mha_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M3162,-13532.78C3162,-13517.88 3162,-13498.77 3162,-13482.37"/>
<polygon fill="black" stroke="black" points="3165.5,-13482.06 3162,-13472.06 3158.5,-13482.06 3165.5,-13482.06"/>
</g>
<!-- moe_gate_dp2_ep0_tp1 -->
<g id="node459" class="node">
<title>moe_gate_dp2_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3406.85,-13382.97 3017.35,-13382.97 2917.15,-13278.97 3306.65,-13278.97 3406.85,-13382.97"/>
<text text-anchor="middle" x="3162" y="-13344.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3162" y="-13333.97" font-family="Times,serif" font-size="10.00">GPU 129</text>
<text text-anchor="middle" x="3162" y="-13322.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3162" y="-13311.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep0_tp1&#45;&gt;moe_gate_dp2_ep0_tp1 -->
<g id="edge527" class="edge">
<title>mha_dp2_ep0_tp1&#45;&gt;moe_gate_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M3162,-13419.9C3162,-13411.97 3162,-13402.83 3162,-13393.51"/>
<polygon fill="black" stroke="black" points="3165.5,-13393.37 3162,-13383.37 3158.5,-13393.37 3165.5,-13393.37"/>
</g>
<!-- expert1_dp2_ep0_tp1 -->
<g id="node460" class="node">
<title>expert1_dp2_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3152.5,-13201.97 2917.5,-13201.97 2917.5,-13149.97 3152.5,-13149.97 3152.5,-13201.97"/>
<text text-anchor="middle" x="3035" y="-13189.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3035" y="-13178.97" font-family="Times,serif" font-size="10.00">GPU 129</text>
<text text-anchor="middle" x="3035" y="-13167.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3035" y="-13156.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep0_tp1&#45;&gt;expert1_dp2_ep0_tp1 -->
<g id="edge528" class="edge">
<title>moe_gate_dp2_ep0_tp1&#45;&gt;expert1_dp2_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3117.2,-13278.94C3112.03,-13272.91 3106.88,-13266.83 3102,-13260.97 3088.3,-13244.53 3073.42,-13225.95 3061.17,-13210.45"/>
<polygon fill="black" stroke="black" points="3063.6,-13207.88 3054.66,-13202.19 3058.1,-13212.21 3063.6,-13207.88"/>
<text text-anchor="middle" x="3159.5" y="-13249.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep0_tp1 -->
<g id="node461" class="node">
<title>expert2_dp2_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3405.5,-13201.97 3170.5,-13201.97 3170.5,-13149.97 3405.5,-13149.97 3405.5,-13201.97"/>
<text text-anchor="middle" x="3288" y="-13189.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3288" y="-13178.97" font-family="Times,serif" font-size="10.00">GPU 129</text>
<text text-anchor="middle" x="3288" y="-13167.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3288" y="-13156.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep0_tp1&#45;&gt;expert2_dp2_ep0_tp1 -->
<g id="edge529" class="edge">
<title>moe_gate_dp2_ep0_tp1&#45;&gt;expert2_dp2_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3204.31,-13278.6C3222.91,-13256.02 3244.21,-13230.14 3260.67,-13210.16"/>
<polygon fill="black" stroke="black" points="3263.53,-13212.2 3267.18,-13202.26 3258.12,-13207.75 3263.53,-13212.2"/>
<text text-anchor="middle" x="3285.5" y="-13249.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep0_tp1 -->
<g id="node462" class="node">
<title>expert_agg_dp2_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3393.33,-13086.97 3015.79,-13086.97 2918.67,-12982.97 3296.21,-12982.97 3393.33,-13086.97"/>
<text text-anchor="middle" x="3156" y="-13048.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3156" y="-13037.97" font-family="Times,serif" font-size="10.00">GPU 129</text>
<text text-anchor="middle" x="3156" y="-13026.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3156" y="-13015.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep0_tp1&#45;&gt;expert_agg_dp2_ep0_tp1 -->
<g id="edge530" class="edge">
<title>expert1_dp2_ep0_tp1&#45;&gt;expert_agg_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M3056.91,-13149.8C3070.32,-13134.4 3088.07,-13114.01 3104.83,-13094.75"/>
<polygon fill="black" stroke="black" points="3107.52,-13097 3111.45,-13087.16 3102.24,-13092.4 3107.52,-13097"/>
</g>
<!-- expert2_dp2_ep0_tp1&#45;&gt;expert_agg_dp2_ep0_tp1 -->
<g id="edge531" class="edge">
<title>expert2_dp2_ep0_tp1&#45;&gt;expert_agg_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M3264.1,-13149.8C3249.4,-13134.33 3229.94,-13113.83 3211.58,-13094.5"/>
<polygon fill="black" stroke="black" points="3214.03,-13092 3204.6,-13087.16 3208.95,-13096.82 3214.03,-13092"/>
</g>
<!-- ln2_dp2_ep0_tp1 -->
<g id="node463" class="node">
<title>ln2_dp2_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3270.5,-12919.97 3041.5,-12919.97 3041.5,-12867.97 3270.5,-12867.97 3270.5,-12919.97"/>
<text text-anchor="middle" x="3156" y="-12907.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3156" y="-12896.97" font-family="Times,serif" font-size="10.00">GPU 129</text>
<text text-anchor="middle" x="3156" y="-12885.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3156" y="-12874.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep0_tp1&#45;&gt;ln2_dp2_ep0_tp1 -->
<g id="edge532" class="edge">
<title>expert_agg_dp2_ep0_tp1&#45;&gt;ln2_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M3156,-12982.61C3156,-12965.27 3156,-12946.31 3156,-12930.47"/>
<polygon fill="black" stroke="black" points="3159.5,-12930.06 3156,-12920.06 3152.5,-12930.06 3159.5,-12930.06"/>
</g>
<!-- ln1_dp2_ep1_tp1 -->
<g id="node471" class="node">
<title>ln1_dp2_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3270.5,-12783.97 3041.5,-12783.97 3041.5,-12731.97 3270.5,-12731.97 3270.5,-12783.97"/>
<text text-anchor="middle" x="3156" y="-12771.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3156" y="-12760.97" font-family="Times,serif" font-size="10.00">GPU 131</text>
<text text-anchor="middle" x="3156" y="-12749.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3156" y="-12738.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep0_tp1&#45;&gt;ln1_dp2_ep1_tp1 -->
<g id="edge533" class="edge">
<title>ln2_dp2_ep0_tp1&#45;&gt;ln1_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M3156,-12867.77C3156,-12846.99 3156,-12817.29 3156,-12794.17"/>
<polygon fill="black" stroke="black" points="3159.5,-12794.07 3156,-12784.07 3152.5,-12794.07 3159.5,-12794.07"/>
</g>
<!-- mha_dp2_ep1_tp0 -->
<g id="node465" class="node">
<title>mha_dp2_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2763.5,-12673.97 2534.5,-12673.97 2534.5,-12621.97 2763.5,-12621.97 2763.5,-12673.97"/>
<text text-anchor="middle" x="2649" y="-12661.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2649" y="-12650.97" font-family="Times,serif" font-size="10.00">GPU 130</text>
<text text-anchor="middle" x="2649" y="-12639.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2649" y="-12628.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep1_tp0&#45;&gt;mha_dp2_ep1_tp0 -->
<g id="edge534" class="edge">
<title>ln1_dp2_ep1_tp0&#45;&gt;mha_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M2649,-12731.93C2649,-12717.85 2649,-12700.05 2649,-12684.55"/>
<polygon fill="black" stroke="black" points="2652.5,-12684.26 2649,-12674.26 2645.5,-12684.26 2652.5,-12684.26"/>
</g>
<!-- moe_gate_dp2_ep1_tp0 -->
<g id="node466" class="node">
<title>moe_gate_dp2_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2893.85,-12584.97 2504.35,-12584.97 2404.15,-12480.97 2793.65,-12480.97 2893.85,-12584.97"/>
<text text-anchor="middle" x="2649" y="-12546.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2649" y="-12535.97" font-family="Times,serif" font-size="10.00">GPU 130</text>
<text text-anchor="middle" x="2649" y="-12524.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2649" y="-12513.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep1_tp0&#45;&gt;moe_gate_dp2_ep1_tp0 -->
<g id="edge535" class="edge">
<title>mha_dp2_ep1_tp0&#45;&gt;moe_gate_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M2649,-12621.9C2649,-12613.97 2649,-12604.83 2649,-12595.51"/>
<polygon fill="black" stroke="black" points="2652.5,-12595.37 2649,-12585.37 2645.5,-12595.37 2652.5,-12595.37"/>
</g>
<!-- expert1_dp2_ep1_tp0 -->
<g id="node467" class="node">
<title>expert1_dp2_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2640.5,-12403.97 2405.5,-12403.97 2405.5,-12351.97 2640.5,-12351.97 2640.5,-12403.97"/>
<text text-anchor="middle" x="2523" y="-12391.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2523" y="-12380.97" font-family="Times,serif" font-size="10.00">GPU 130</text>
<text text-anchor="middle" x="2523" y="-12369.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2523" y="-12358.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep1_tp0&#45;&gt;expert1_dp2_ep1_tp0 -->
<g id="edge536" class="edge">
<title>moe_gate_dp2_ep1_tp0&#45;&gt;expert1_dp2_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2606.69,-12480.6C2588.09,-12458.02 2566.79,-12432.14 2550.33,-12412.16"/>
<polygon fill="black" stroke="black" points="2552.88,-12409.75 2543.82,-12404.26 2547.47,-12414.2 2552.88,-12409.75"/>
<text text-anchor="middle" x="2646.5" y="-12451.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep1_tp0 -->
<g id="node468" class="node">
<title>expert2_dp2_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2893.5,-12403.97 2658.5,-12403.97 2658.5,-12351.97 2893.5,-12351.97 2893.5,-12403.97"/>
<text text-anchor="middle" x="2776" y="-12391.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2776" y="-12380.97" font-family="Times,serif" font-size="10.00">GPU 130</text>
<text text-anchor="middle" x="2776" y="-12369.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2776" y="-12358.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep1_tp0&#45;&gt;expert2_dp2_ep1_tp0 -->
<g id="edge537" class="edge">
<title>moe_gate_dp2_ep1_tp0&#45;&gt;expert2_dp2_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2692.97,-12480.86C2698.06,-12474.85 2703.16,-12468.79 2708,-12462.97 2721.9,-12446.27 2737.14,-12427.49 2749.66,-12411.93"/>
<polygon fill="black" stroke="black" points="2752.41,-12414.1 2755.94,-12404.11 2746.95,-12409.71 2752.41,-12414.1"/>
<text text-anchor="middle" x="2776.5" y="-12451.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep1_tp0 -->
<g id="node469" class="node">
<title>expert_agg_dp2_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2882.33,-12288.97 2504.79,-12288.97 2407.67,-12184.97 2785.21,-12184.97 2882.33,-12288.97"/>
<text text-anchor="middle" x="2645" y="-12250.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2645" y="-12239.97" font-family="Times,serif" font-size="10.00">GPU 130</text>
<text text-anchor="middle" x="2645" y="-12228.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2645" y="-12217.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep1_tp0&#45;&gt;expert_agg_dp2_ep1_tp0 -->
<g id="edge538" class="edge">
<title>expert1_dp2_ep1_tp0&#45;&gt;expert_agg_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M2545.09,-12351.8C2558.61,-12336.4 2576.5,-12316.01 2593.41,-12296.75"/>
<polygon fill="black" stroke="black" points="2596.11,-12298.98 2600.08,-12289.16 2590.85,-12294.36 2596.11,-12298.98"/>
</g>
<!-- expert2_dp2_ep1_tp0&#45;&gt;expert_agg_dp2_ep1_tp0 -->
<g id="edge539" class="edge">
<title>expert2_dp2_ep1_tp0&#45;&gt;expert_agg_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M2752.28,-12351.8C2737.7,-12336.33 2718.38,-12315.83 2700.16,-12296.5"/>
<polygon fill="black" stroke="black" points="2702.64,-12294.03 2693.24,-12289.16 2697.55,-12298.83 2702.64,-12294.03"/>
</g>
<!-- ln2_dp2_ep1_tp0 -->
<g id="node470" class="node">
<title>ln2_dp2_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2759.5,-12121.97 2530.5,-12121.97 2530.5,-12069.97 2759.5,-12069.97 2759.5,-12121.97"/>
<text text-anchor="middle" x="2645" y="-12109.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2645" y="-12098.97" font-family="Times,serif" font-size="10.00">GPU 130</text>
<text text-anchor="middle" x="2645" y="-12087.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2645" y="-12076.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep1_tp0&#45;&gt;ln2_dp2_ep1_tp0 -->
<g id="edge540" class="edge">
<title>expert_agg_dp2_ep1_tp0&#45;&gt;ln2_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M2645,-12184.61C2645,-12167.27 2645,-12148.31 2645,-12132.47"/>
<polygon fill="black" stroke="black" points="2648.5,-12132.06 2645,-12122.06 2641.5,-12132.06 2648.5,-12132.06"/>
</g>
<!-- ln1_dp2_ep2_tp0 -->
<g id="node478" class="node">
<title>ln1_dp2_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2759.5,-11985.97 2530.5,-11985.97 2530.5,-11933.97 2759.5,-11933.97 2759.5,-11985.97"/>
<text text-anchor="middle" x="2645" y="-11973.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2645" y="-11962.97" font-family="Times,serif" font-size="10.00">GPU 132</text>
<text text-anchor="middle" x="2645" y="-11951.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2645" y="-11940.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep1_tp0&#45;&gt;ln1_dp2_ep2_tp0 -->
<g id="edge541" class="edge">
<title>ln2_dp2_ep1_tp0&#45;&gt;ln1_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M2645,-12069.77C2645,-12048.99 2645,-12019.29 2645,-11996.17"/>
<polygon fill="black" stroke="black" points="2648.5,-11996.07 2645,-11986.07 2641.5,-11996.07 2648.5,-11996.07"/>
</g>
<!-- mha_dp2_ep1_tp1 -->
<g id="node472" class="node">
<title>mha_dp2_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3270.5,-12673.97 3041.5,-12673.97 3041.5,-12621.97 3270.5,-12621.97 3270.5,-12673.97"/>
<text text-anchor="middle" x="3156" y="-12661.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3156" y="-12650.97" font-family="Times,serif" font-size="10.00">GPU 131</text>
<text text-anchor="middle" x="3156" y="-12639.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3156" y="-12628.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep1_tp1&#45;&gt;mha_dp2_ep1_tp1 -->
<g id="edge542" class="edge">
<title>ln1_dp2_ep1_tp1&#45;&gt;mha_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M3156,-12731.93C3156,-12717.85 3156,-12700.05 3156,-12684.55"/>
<polygon fill="black" stroke="black" points="3159.5,-12684.26 3156,-12674.26 3152.5,-12684.26 3159.5,-12684.26"/>
</g>
<!-- moe_gate_dp2_ep1_tp1 -->
<g id="node473" class="node">
<title>moe_gate_dp2_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3400.85,-12584.97 3011.35,-12584.97 2911.15,-12480.97 3300.65,-12480.97 3400.85,-12584.97"/>
<text text-anchor="middle" x="3156" y="-12546.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3156" y="-12535.97" font-family="Times,serif" font-size="10.00">GPU 131</text>
<text text-anchor="middle" x="3156" y="-12524.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3156" y="-12513.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep1_tp1&#45;&gt;moe_gate_dp2_ep1_tp1 -->
<g id="edge543" class="edge">
<title>mha_dp2_ep1_tp1&#45;&gt;moe_gate_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M3156,-12621.9C3156,-12613.97 3156,-12604.83 3156,-12595.51"/>
<polygon fill="black" stroke="black" points="3159.5,-12595.37 3156,-12585.37 3152.5,-12595.37 3159.5,-12595.37"/>
</g>
<!-- expert1_dp2_ep1_tp1 -->
<g id="node474" class="node">
<title>expert1_dp2_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3146.5,-12403.97 2911.5,-12403.97 2911.5,-12351.97 3146.5,-12351.97 3146.5,-12403.97"/>
<text text-anchor="middle" x="3029" y="-12391.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3029" y="-12380.97" font-family="Times,serif" font-size="10.00">GPU 131</text>
<text text-anchor="middle" x="3029" y="-12369.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3029" y="-12358.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep1_tp1&#45;&gt;expert1_dp2_ep1_tp1 -->
<g id="edge544" class="edge">
<title>moe_gate_dp2_ep1_tp1&#45;&gt;expert1_dp2_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3111.2,-12480.94C3106.03,-12474.91 3100.88,-12468.83 3096,-12462.97 3082.3,-12446.53 3067.42,-12427.95 3055.17,-12412.45"/>
<polygon fill="black" stroke="black" points="3057.6,-12409.88 3048.66,-12404.19 3052.1,-12414.21 3057.6,-12409.88"/>
<text text-anchor="middle" x="3153.5" y="-12451.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep1_tp1 -->
<g id="node475" class="node">
<title>expert2_dp2_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3399.5,-12403.97 3164.5,-12403.97 3164.5,-12351.97 3399.5,-12351.97 3399.5,-12403.97"/>
<text text-anchor="middle" x="3282" y="-12391.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3282" y="-12380.97" font-family="Times,serif" font-size="10.00">GPU 131</text>
<text text-anchor="middle" x="3282" y="-12369.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3282" y="-12358.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep1_tp1&#45;&gt;expert2_dp2_ep1_tp1 -->
<g id="edge545" class="edge">
<title>moe_gate_dp2_ep1_tp1&#45;&gt;expert2_dp2_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3198.31,-12480.6C3216.91,-12458.02 3238.21,-12432.14 3254.67,-12412.16"/>
<polygon fill="black" stroke="black" points="3257.53,-12414.2 3261.18,-12404.26 3252.12,-12409.75 3257.53,-12414.2"/>
<text text-anchor="middle" x="3279.5" y="-12451.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep1_tp1 -->
<g id="node476" class="node">
<title>expert_agg_dp2_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3389.33,-12288.97 3011.79,-12288.97 2914.67,-12184.97 3292.21,-12184.97 3389.33,-12288.97"/>
<text text-anchor="middle" x="3152" y="-12250.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3152" y="-12239.97" font-family="Times,serif" font-size="10.00">GPU 131</text>
<text text-anchor="middle" x="3152" y="-12228.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3152" y="-12217.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep1_tp1&#45;&gt;expert_agg_dp2_ep1_tp1 -->
<g id="edge546" class="edge">
<title>expert1_dp2_ep1_tp1&#45;&gt;expert_agg_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M3051.27,-12351.8C3064.9,-12336.4 3082.94,-12316.01 3099.99,-12296.75"/>
<polygon fill="black" stroke="black" points="3102.7,-12298.96 3106.71,-12289.16 3097.46,-12294.33 3102.7,-12298.96"/>
</g>
<!-- expert2_dp2_ep1_tp1&#45;&gt;expert_agg_dp2_ep1_tp1 -->
<g id="edge547" class="edge">
<title>expert2_dp2_ep1_tp1&#45;&gt;expert_agg_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M3258.46,-12351.8C3243.99,-12336.33 3224.82,-12315.83 3206.73,-12296.5"/>
<polygon fill="black" stroke="black" points="3209.26,-12294.07 3199.87,-12289.16 3204.14,-12298.85 3209.26,-12294.07"/>
</g>
<!-- ln2_dp2_ep1_tp1 -->
<g id="node477" class="node">
<title>ln2_dp2_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3266.5,-12121.97 3037.5,-12121.97 3037.5,-12069.97 3266.5,-12069.97 3266.5,-12121.97"/>
<text text-anchor="middle" x="3152" y="-12109.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3152" y="-12098.97" font-family="Times,serif" font-size="10.00">GPU 131</text>
<text text-anchor="middle" x="3152" y="-12087.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3152" y="-12076.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep1_tp1&#45;&gt;ln2_dp2_ep1_tp1 -->
<g id="edge548" class="edge">
<title>expert_agg_dp2_ep1_tp1&#45;&gt;ln2_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M3152,-12184.61C3152,-12167.27 3152,-12148.31 3152,-12132.47"/>
<polygon fill="black" stroke="black" points="3155.5,-12132.06 3152,-12122.06 3148.5,-12132.06 3155.5,-12132.06"/>
</g>
<!-- ln1_dp2_ep2_tp1 -->
<g id="node485" class="node">
<title>ln1_dp2_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3266.5,-11985.97 3037.5,-11985.97 3037.5,-11933.97 3266.5,-11933.97 3266.5,-11985.97"/>
<text text-anchor="middle" x="3152" y="-11973.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3152" y="-11962.97" font-family="Times,serif" font-size="10.00">GPU 133</text>
<text text-anchor="middle" x="3152" y="-11951.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3152" y="-11940.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep1_tp1&#45;&gt;ln1_dp2_ep2_tp1 -->
<g id="edge549" class="edge">
<title>ln2_dp2_ep1_tp1&#45;&gt;ln1_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M3152,-12069.77C3152,-12048.99 3152,-12019.29 3152,-11996.17"/>
<polygon fill="black" stroke="black" points="3155.5,-11996.07 3152,-11986.07 3148.5,-11996.07 3155.5,-11996.07"/>
</g>
<!-- mha_dp2_ep2_tp0 -->
<g id="node479" class="node">
<title>mha_dp2_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2759.5,-11875.97 2530.5,-11875.97 2530.5,-11823.97 2759.5,-11823.97 2759.5,-11875.97"/>
<text text-anchor="middle" x="2645" y="-11863.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2645" y="-11852.97" font-family="Times,serif" font-size="10.00">GPU 132</text>
<text text-anchor="middle" x="2645" y="-11841.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2645" y="-11830.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep2_tp0&#45;&gt;mha_dp2_ep2_tp0 -->
<g id="edge550" class="edge">
<title>ln1_dp2_ep2_tp0&#45;&gt;mha_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M2645,-11933.93C2645,-11919.85 2645,-11902.05 2645,-11886.55"/>
<polygon fill="black" stroke="black" points="2648.5,-11886.26 2645,-11876.26 2641.5,-11886.26 2648.5,-11886.26"/>
</g>
<!-- moe_gate_dp2_ep2_tp0 -->
<g id="node480" class="node">
<title>moe_gate_dp2_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2889.85,-11786.97 2500.35,-11786.97 2400.15,-11682.97 2789.65,-11682.97 2889.85,-11786.97"/>
<text text-anchor="middle" x="2645" y="-11748.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2645" y="-11737.97" font-family="Times,serif" font-size="10.00">GPU 132</text>
<text text-anchor="middle" x="2645" y="-11726.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2645" y="-11715.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep2_tp0&#45;&gt;moe_gate_dp2_ep2_tp0 -->
<g id="edge551" class="edge">
<title>mha_dp2_ep2_tp0&#45;&gt;moe_gate_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M2645,-11823.9C2645,-11815.97 2645,-11806.83 2645,-11797.51"/>
<polygon fill="black" stroke="black" points="2648.5,-11797.37 2645,-11787.37 2641.5,-11797.37 2648.5,-11797.37"/>
</g>
<!-- expert1_dp2_ep2_tp0 -->
<g id="node481" class="node">
<title>expert1_dp2_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2636.5,-11605.97 2401.5,-11605.97 2401.5,-11553.97 2636.5,-11553.97 2636.5,-11605.97"/>
<text text-anchor="middle" x="2519" y="-11593.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2519" y="-11582.97" font-family="Times,serif" font-size="10.00">GPU 132</text>
<text text-anchor="middle" x="2519" y="-11571.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2519" y="-11560.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep2_tp0&#45;&gt;expert1_dp2_ep2_tp0 -->
<g id="edge552" class="edge">
<title>moe_gate_dp2_ep2_tp0&#45;&gt;expert1_dp2_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2602.69,-11682.6C2584.09,-11660.02 2562.79,-11634.14 2546.33,-11614.16"/>
<polygon fill="black" stroke="black" points="2548.88,-11611.75 2539.82,-11606.26 2543.47,-11616.2 2548.88,-11611.75"/>
<text text-anchor="middle" x="2642.5" y="-11653.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep2_tp0 -->
<g id="node482" class="node">
<title>expert2_dp2_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2889.5,-11605.97 2654.5,-11605.97 2654.5,-11553.97 2889.5,-11553.97 2889.5,-11605.97"/>
<text text-anchor="middle" x="2772" y="-11593.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2772" y="-11582.97" font-family="Times,serif" font-size="10.00">GPU 132</text>
<text text-anchor="middle" x="2772" y="-11571.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2772" y="-11560.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep2_tp0&#45;&gt;expert2_dp2_ep2_tp0 -->
<g id="edge553" class="edge">
<title>moe_gate_dp2_ep2_tp0&#45;&gt;expert2_dp2_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2688.97,-11682.86C2694.06,-11676.85 2699.16,-11670.79 2704,-11664.97 2717.9,-11648.27 2733.14,-11629.49 2745.66,-11613.93"/>
<polygon fill="black" stroke="black" points="2748.41,-11616.1 2751.94,-11606.11 2742.95,-11611.71 2748.41,-11616.1"/>
<text text-anchor="middle" x="2772.5" y="-11653.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep2_tp0 -->
<g id="node483" class="node">
<title>expert_agg_dp2_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2881.33,-11490.97 2503.79,-11490.97 2406.67,-11386.97 2784.21,-11386.97 2881.33,-11490.97"/>
<text text-anchor="middle" x="2644" y="-11452.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2644" y="-11441.97" font-family="Times,serif" font-size="10.00">GPU 132</text>
<text text-anchor="middle" x="2644" y="-11430.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2644" y="-11419.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep2_tp0&#45;&gt;expert_agg_dp2_ep2_tp0 -->
<g id="edge554" class="edge">
<title>expert1_dp2_ep2_tp0&#45;&gt;expert_agg_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M2541.64,-11553.8C2555.49,-11538.4 2573.82,-11518.01 2591.14,-11498.75"/>
<polygon fill="black" stroke="black" points="2593.89,-11500.93 2597.97,-11491.16 2588.68,-11496.25 2593.89,-11500.93"/>
</g>
<!-- expert2_dp2_ep2_tp0&#45;&gt;expert_agg_dp2_ep2_tp0 -->
<g id="edge555" class="edge">
<title>expert2_dp2_ep2_tp0&#45;&gt;expert_agg_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M2748.82,-11553.8C2734.64,-11538.4 2715.86,-11518.01 2698.13,-11498.75"/>
<polygon fill="black" stroke="black" points="2700.48,-11496.14 2691.13,-11491.16 2695.33,-11500.88 2700.48,-11496.14"/>
</g>
<!-- ln2_dp2_ep2_tp0 -->
<g id="node484" class="node">
<title>ln2_dp2_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2758.5,-11323.97 2529.5,-11323.97 2529.5,-11271.97 2758.5,-11271.97 2758.5,-11323.97"/>
<text text-anchor="middle" x="2644" y="-11311.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2644" y="-11300.97" font-family="Times,serif" font-size="10.00">GPU 132</text>
<text text-anchor="middle" x="2644" y="-11289.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-11278.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep2_tp0&#45;&gt;ln2_dp2_ep2_tp0 -->
<g id="edge556" class="edge">
<title>expert_agg_dp2_ep2_tp0&#45;&gt;ln2_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M2644,-11386.61C2644,-11369.27 2644,-11350.31 2644,-11334.47"/>
<polygon fill="black" stroke="black" points="2647.5,-11334.06 2644,-11324.06 2640.5,-11334.06 2647.5,-11334.06"/>
</g>
<!-- ln1_dp2_ep3_tp0 -->
<g id="node492" class="node">
<title>ln1_dp2_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2758.5,-11187.97 2529.5,-11187.97 2529.5,-11135.97 2758.5,-11135.97 2758.5,-11187.97"/>
<text text-anchor="middle" x="2644" y="-11175.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2644" y="-11164.97" font-family="Times,serif" font-size="10.00">GPU 134</text>
<text text-anchor="middle" x="2644" y="-11153.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-11142.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep2_tp0&#45;&gt;ln1_dp2_ep3_tp0 -->
<g id="edge557" class="edge">
<title>ln2_dp2_ep2_tp0&#45;&gt;ln1_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M2644,-11271.77C2644,-11250.99 2644,-11221.29 2644,-11198.17"/>
<polygon fill="black" stroke="black" points="2647.5,-11198.07 2644,-11188.07 2640.5,-11198.07 2647.5,-11198.07"/>
</g>
<!-- mha_dp2_ep2_tp1 -->
<g id="node486" class="node">
<title>mha_dp2_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3266.5,-11875.97 3037.5,-11875.97 3037.5,-11823.97 3266.5,-11823.97 3266.5,-11875.97"/>
<text text-anchor="middle" x="3152" y="-11863.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3152" y="-11852.97" font-family="Times,serif" font-size="10.00">GPU 133</text>
<text text-anchor="middle" x="3152" y="-11841.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3152" y="-11830.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep2_tp1&#45;&gt;mha_dp2_ep2_tp1 -->
<g id="edge558" class="edge">
<title>ln1_dp2_ep2_tp1&#45;&gt;mha_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M3152,-11933.93C3152,-11919.85 3152,-11902.05 3152,-11886.55"/>
<polygon fill="black" stroke="black" points="3155.5,-11886.26 3152,-11876.26 3148.5,-11886.26 3155.5,-11886.26"/>
</g>
<!-- moe_gate_dp2_ep2_tp1 -->
<g id="node487" class="node">
<title>moe_gate_dp2_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3396.85,-11786.97 3007.35,-11786.97 2907.15,-11682.97 3296.65,-11682.97 3396.85,-11786.97"/>
<text text-anchor="middle" x="3152" y="-11748.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3152" y="-11737.97" font-family="Times,serif" font-size="10.00">GPU 133</text>
<text text-anchor="middle" x="3152" y="-11726.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3152" y="-11715.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep2_tp1&#45;&gt;moe_gate_dp2_ep2_tp1 -->
<g id="edge559" class="edge">
<title>mha_dp2_ep2_tp1&#45;&gt;moe_gate_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M3152,-11823.9C3152,-11815.97 3152,-11806.83 3152,-11797.51"/>
<polygon fill="black" stroke="black" points="3155.5,-11797.37 3152,-11787.37 3148.5,-11797.37 3155.5,-11797.37"/>
</g>
<!-- expert1_dp2_ep2_tp1 -->
<g id="node488" class="node">
<title>expert1_dp2_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3142.5,-11605.97 2907.5,-11605.97 2907.5,-11553.97 3142.5,-11553.97 3142.5,-11605.97"/>
<text text-anchor="middle" x="3025" y="-11593.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3025" y="-11582.97" font-family="Times,serif" font-size="10.00">GPU 133</text>
<text text-anchor="middle" x="3025" y="-11571.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3025" y="-11560.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep2_tp1&#45;&gt;expert1_dp2_ep2_tp1 -->
<g id="edge560" class="edge">
<title>moe_gate_dp2_ep2_tp1&#45;&gt;expert1_dp2_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3107.2,-11682.94C3102.03,-11676.91 3096.88,-11670.83 3092,-11664.97 3078.3,-11648.53 3063.42,-11629.95 3051.17,-11614.45"/>
<polygon fill="black" stroke="black" points="3053.6,-11611.88 3044.66,-11606.19 3048.1,-11616.21 3053.6,-11611.88"/>
<text text-anchor="middle" x="3149.5" y="-11653.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep2_tp1 -->
<g id="node489" class="node">
<title>expert2_dp2_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3395.5,-11605.97 3160.5,-11605.97 3160.5,-11553.97 3395.5,-11553.97 3395.5,-11605.97"/>
<text text-anchor="middle" x="3278" y="-11593.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3278" y="-11582.97" font-family="Times,serif" font-size="10.00">GPU 133</text>
<text text-anchor="middle" x="3278" y="-11571.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3278" y="-11560.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep2_tp1&#45;&gt;expert2_dp2_ep2_tp1 -->
<g id="edge561" class="edge">
<title>moe_gate_dp2_ep2_tp1&#45;&gt;expert2_dp2_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3194.31,-11682.6C3212.91,-11660.02 3234.21,-11634.14 3250.67,-11614.16"/>
<polygon fill="black" stroke="black" points="3253.53,-11616.2 3257.18,-11606.26 3248.12,-11611.75 3253.53,-11616.2"/>
<text text-anchor="middle" x="3275.5" y="-11653.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep2_tp1 -->
<g id="node490" class="node">
<title>expert_agg_dp2_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3388.33,-11490.97 3010.79,-11490.97 2913.67,-11386.97 3291.21,-11386.97 3388.33,-11490.97"/>
<text text-anchor="middle" x="3151" y="-11452.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3151" y="-11441.97" font-family="Times,serif" font-size="10.00">GPU 133</text>
<text text-anchor="middle" x="3151" y="-11430.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3151" y="-11419.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep2_tp1&#45;&gt;expert_agg_dp2_ep2_tp1 -->
<g id="edge562" class="edge">
<title>expert1_dp2_ep2_tp1&#45;&gt;expert_agg_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M3047.82,-11553.8C3061.78,-11538.4 3080.26,-11518.01 3097.72,-11498.75"/>
<polygon fill="black" stroke="black" points="3100.48,-11500.92 3104.6,-11491.16 3095.3,-11496.22 3100.48,-11500.92"/>
</g>
<!-- expert2_dp2_ep2_tp1&#45;&gt;expert_agg_dp2_ep2_tp1 -->
<g id="edge563" class="edge">
<title>expert2_dp2_ep2_tp1&#45;&gt;expert_agg_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M3255,-11553.8C3240.93,-11538.4 3222.3,-11518.01 3204.7,-11498.75"/>
<polygon fill="black" stroke="black" points="3207.09,-11496.18 3197.76,-11491.16 3201.93,-11500.9 3207.09,-11496.18"/>
</g>
<!-- ln2_dp2_ep2_tp1 -->
<g id="node491" class="node">
<title>ln2_dp2_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3265.5,-11323.97 3036.5,-11323.97 3036.5,-11271.97 3265.5,-11271.97 3265.5,-11323.97"/>
<text text-anchor="middle" x="3151" y="-11311.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3151" y="-11300.97" font-family="Times,serif" font-size="10.00">GPU 133</text>
<text text-anchor="middle" x="3151" y="-11289.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-11278.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep2_tp1&#45;&gt;ln2_dp2_ep2_tp1 -->
<g id="edge564" class="edge">
<title>expert_agg_dp2_ep2_tp1&#45;&gt;ln2_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M3151,-11386.61C3151,-11369.27 3151,-11350.31 3151,-11334.47"/>
<polygon fill="black" stroke="black" points="3154.5,-11334.06 3151,-11324.06 3147.5,-11334.06 3154.5,-11334.06"/>
</g>
<!-- ln1_dp2_ep3_tp1 -->
<g id="node499" class="node">
<title>ln1_dp2_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3265.5,-11187.97 3036.5,-11187.97 3036.5,-11135.97 3265.5,-11135.97 3265.5,-11187.97"/>
<text text-anchor="middle" x="3151" y="-11175.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3151" y="-11164.97" font-family="Times,serif" font-size="10.00">GPU 135</text>
<text text-anchor="middle" x="3151" y="-11153.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-11142.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep2_tp1&#45;&gt;ln1_dp2_ep3_tp1 -->
<g id="edge565" class="edge">
<title>ln2_dp2_ep2_tp1&#45;&gt;ln1_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M3151,-11271.77C3151,-11250.99 3151,-11221.29 3151,-11198.17"/>
<polygon fill="black" stroke="black" points="3154.5,-11198.07 3151,-11188.07 3147.5,-11198.07 3154.5,-11198.07"/>
</g>
<!-- mha_dp2_ep3_tp0 -->
<g id="node493" class="node">
<title>mha_dp2_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2758.5,-11077.97 2529.5,-11077.97 2529.5,-11025.97 2758.5,-11025.97 2758.5,-11077.97"/>
<text text-anchor="middle" x="2644" y="-11065.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2644" y="-11054.97" font-family="Times,serif" font-size="10.00">GPU 134</text>
<text text-anchor="middle" x="2644" y="-11043.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-11032.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep3_tp0&#45;&gt;mha_dp2_ep3_tp0 -->
<g id="edge566" class="edge">
<title>ln1_dp2_ep3_tp0&#45;&gt;mha_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M2644,-11135.93C2644,-11121.85 2644,-11104.05 2644,-11088.55"/>
<polygon fill="black" stroke="black" points="2647.5,-11088.26 2644,-11078.26 2640.5,-11088.26 2647.5,-11088.26"/>
</g>
<!-- moe_gate_dp2_ep3_tp0 -->
<g id="node494" class="node">
<title>moe_gate_dp2_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2888.85,-10988.97 2499.35,-10988.97 2399.15,-10884.97 2788.65,-10884.97 2888.85,-10988.97"/>
<text text-anchor="middle" x="2644" y="-10950.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2644" y="-10939.97" font-family="Times,serif" font-size="10.00">GPU 134</text>
<text text-anchor="middle" x="2644" y="-10928.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-10917.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep3_tp0&#45;&gt;moe_gate_dp2_ep3_tp0 -->
<g id="edge567" class="edge">
<title>mha_dp2_ep3_tp0&#45;&gt;moe_gate_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M2644,-11025.9C2644,-11017.97 2644,-11008.83 2644,-10999.51"/>
<polygon fill="black" stroke="black" points="2647.5,-10999.37 2644,-10989.37 2640.5,-10999.37 2647.5,-10999.37"/>
</g>
<!-- expert1_dp2_ep3_tp0 -->
<g id="node495" class="node">
<title>expert1_dp2_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2635.5,-10807.97 2400.5,-10807.97 2400.5,-10755.97 2635.5,-10755.97 2635.5,-10807.97"/>
<text text-anchor="middle" x="2518" y="-10795.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2518" y="-10784.97" font-family="Times,serif" font-size="10.00">GPU 134</text>
<text text-anchor="middle" x="2518" y="-10773.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2518" y="-10762.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep3_tp0&#45;&gt;expert1_dp2_ep3_tp0 -->
<g id="edge568" class="edge">
<title>moe_gate_dp2_ep3_tp0&#45;&gt;expert1_dp2_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2601.69,-10884.6C2583.09,-10862.02 2561.79,-10836.14 2545.33,-10816.16"/>
<polygon fill="black" stroke="black" points="2547.88,-10813.75 2538.82,-10808.26 2542.47,-10818.2 2547.88,-10813.75"/>
<text text-anchor="middle" x="2641.5" y="-10855.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep3_tp0 -->
<g id="node496" class="node">
<title>expert2_dp2_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2888.5,-10807.97 2653.5,-10807.97 2653.5,-10755.97 2888.5,-10755.97 2888.5,-10807.97"/>
<text text-anchor="middle" x="2771" y="-10795.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2771" y="-10784.97" font-family="Times,serif" font-size="10.00">GPU 134</text>
<text text-anchor="middle" x="2771" y="-10773.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2771" y="-10762.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep3_tp0&#45;&gt;expert2_dp2_ep3_tp0 -->
<g id="edge569" class="edge">
<title>moe_gate_dp2_ep3_tp0&#45;&gt;expert2_dp2_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2687.97,-10884.86C2693.06,-10878.85 2698.16,-10872.79 2703,-10866.97 2716.9,-10850.27 2732.14,-10831.49 2744.66,-10815.93"/>
<polygon fill="black" stroke="black" points="2747.41,-10818.1 2750.94,-10808.11 2741.95,-10813.71 2747.41,-10818.1"/>
<text text-anchor="middle" x="2771.5" y="-10855.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep3_tp0 -->
<g id="node497" class="node">
<title>expert_agg_dp2_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2881.33,-10692.97 2503.79,-10692.97 2406.67,-10588.97 2784.21,-10588.97 2881.33,-10692.97"/>
<text text-anchor="middle" x="2644" y="-10654.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2644" y="-10643.97" font-family="Times,serif" font-size="10.00">GPU 134</text>
<text text-anchor="middle" x="2644" y="-10632.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2644" y="-10621.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep3_tp0&#45;&gt;expert_agg_dp2_ep3_tp0 -->
<g id="edge570" class="edge">
<title>expert1_dp2_ep3_tp0&#45;&gt;expert_agg_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M2540.82,-10755.8C2554.78,-10740.4 2573.26,-10720.01 2590.72,-10700.75"/>
<polygon fill="black" stroke="black" points="2593.48,-10702.92 2597.6,-10693.16 2588.3,-10698.22 2593.48,-10702.92"/>
</g>
<!-- expert2_dp2_ep3_tp0&#45;&gt;expert_agg_dp2_ep3_tp0 -->
<g id="edge571" class="edge">
<title>expert2_dp2_ep3_tp0&#45;&gt;expert_agg_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M2748,-10755.8C2733.93,-10740.4 2715.3,-10720.01 2697.7,-10700.75"/>
<polygon fill="black" stroke="black" points="2700.09,-10698.18 2690.76,-10693.16 2694.93,-10702.9 2700.09,-10698.18"/>
</g>
<!-- ln2_dp2_ep3_tp0 -->
<g id="node498" class="node">
<title>ln2_dp2_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2758.5,-10525.97 2529.5,-10525.97 2529.5,-10473.97 2758.5,-10473.97 2758.5,-10525.97"/>
<text text-anchor="middle" x="2644" y="-10513.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2644" y="-10502.97" font-family="Times,serif" font-size="10.00">GPU 134</text>
<text text-anchor="middle" x="2644" y="-10491.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-10480.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep3_tp0&#45;&gt;ln2_dp2_ep3_tp0 -->
<g id="edge572" class="edge">
<title>expert_agg_dp2_ep3_tp0&#45;&gt;ln2_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M2644,-10588.61C2644,-10571.27 2644,-10552.31 2644,-10536.47"/>
<polygon fill="black" stroke="black" points="2647.5,-10536.06 2644,-10526.06 2640.5,-10536.06 2647.5,-10536.06"/>
</g>
<!-- ln1_dp2_ep4_tp0 -->
<g id="node506" class="node">
<title>ln1_dp2_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2758.5,-10389.97 2529.5,-10389.97 2529.5,-10337.97 2758.5,-10337.97 2758.5,-10389.97"/>
<text text-anchor="middle" x="2644" y="-10377.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2644" y="-10366.97" font-family="Times,serif" font-size="10.00">GPU 136</text>
<text text-anchor="middle" x="2644" y="-10355.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-10344.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep3_tp0&#45;&gt;ln1_dp2_ep4_tp0 -->
<g id="edge573" class="edge">
<title>ln2_dp2_ep3_tp0&#45;&gt;ln1_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M2644,-10473.77C2644,-10452.99 2644,-10423.29 2644,-10400.17"/>
<polygon fill="black" stroke="black" points="2647.5,-10400.07 2644,-10390.07 2640.5,-10400.07 2647.5,-10400.07"/>
</g>
<!-- mha_dp2_ep3_tp1 -->
<g id="node500" class="node">
<title>mha_dp2_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3265.5,-11077.97 3036.5,-11077.97 3036.5,-11025.97 3265.5,-11025.97 3265.5,-11077.97"/>
<text text-anchor="middle" x="3151" y="-11065.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3151" y="-11054.97" font-family="Times,serif" font-size="10.00">GPU 135</text>
<text text-anchor="middle" x="3151" y="-11043.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-11032.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep3_tp1&#45;&gt;mha_dp2_ep3_tp1 -->
<g id="edge574" class="edge">
<title>ln1_dp2_ep3_tp1&#45;&gt;mha_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M3151,-11135.93C3151,-11121.85 3151,-11104.05 3151,-11088.55"/>
<polygon fill="black" stroke="black" points="3154.5,-11088.26 3151,-11078.26 3147.5,-11088.26 3154.5,-11088.26"/>
</g>
<!-- moe_gate_dp2_ep3_tp1 -->
<g id="node501" class="node">
<title>moe_gate_dp2_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3395.85,-10988.97 3006.35,-10988.97 2906.15,-10884.97 3295.65,-10884.97 3395.85,-10988.97"/>
<text text-anchor="middle" x="3151" y="-10950.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3151" y="-10939.97" font-family="Times,serif" font-size="10.00">GPU 135</text>
<text text-anchor="middle" x="3151" y="-10928.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-10917.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep3_tp1&#45;&gt;moe_gate_dp2_ep3_tp1 -->
<g id="edge575" class="edge">
<title>mha_dp2_ep3_tp1&#45;&gt;moe_gate_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M3151,-11025.9C3151,-11017.97 3151,-11008.83 3151,-10999.51"/>
<polygon fill="black" stroke="black" points="3154.5,-10999.37 3151,-10989.37 3147.5,-10999.37 3154.5,-10999.37"/>
</g>
<!-- expert1_dp2_ep3_tp1 -->
<g id="node502" class="node">
<title>expert1_dp2_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3141.5,-10807.97 2906.5,-10807.97 2906.5,-10755.97 3141.5,-10755.97 3141.5,-10807.97"/>
<text text-anchor="middle" x="3024" y="-10795.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3024" y="-10784.97" font-family="Times,serif" font-size="10.00">GPU 135</text>
<text text-anchor="middle" x="3024" y="-10773.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3024" y="-10762.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep3_tp1&#45;&gt;expert1_dp2_ep3_tp1 -->
<g id="edge576" class="edge">
<title>moe_gate_dp2_ep3_tp1&#45;&gt;expert1_dp2_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3106.2,-10884.94C3101.03,-10878.91 3095.88,-10872.83 3091,-10866.97 3077.3,-10850.53 3062.42,-10831.95 3050.17,-10816.45"/>
<polygon fill="black" stroke="black" points="3052.6,-10813.88 3043.66,-10808.19 3047.1,-10818.21 3052.6,-10813.88"/>
<text text-anchor="middle" x="3148.5" y="-10855.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep3_tp1 -->
<g id="node503" class="node">
<title>expert2_dp2_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3394.5,-10807.97 3159.5,-10807.97 3159.5,-10755.97 3394.5,-10755.97 3394.5,-10807.97"/>
<text text-anchor="middle" x="3277" y="-10795.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3277" y="-10784.97" font-family="Times,serif" font-size="10.00">GPU 135</text>
<text text-anchor="middle" x="3277" y="-10773.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3277" y="-10762.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep3_tp1&#45;&gt;expert2_dp2_ep3_tp1 -->
<g id="edge577" class="edge">
<title>moe_gate_dp2_ep3_tp1&#45;&gt;expert2_dp2_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3193.31,-10884.6C3211.91,-10862.02 3233.21,-10836.14 3249.67,-10816.16"/>
<polygon fill="black" stroke="black" points="3252.53,-10818.2 3256.18,-10808.26 3247.12,-10813.75 3252.53,-10818.2"/>
<text text-anchor="middle" x="3274.5" y="-10855.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep3_tp1 -->
<g id="node504" class="node">
<title>expert_agg_dp2_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3388.33,-10692.97 3010.79,-10692.97 2913.67,-10588.97 3291.21,-10588.97 3388.33,-10692.97"/>
<text text-anchor="middle" x="3151" y="-10654.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3151" y="-10643.97" font-family="Times,serif" font-size="10.00">GPU 135</text>
<text text-anchor="middle" x="3151" y="-10632.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3151" y="-10621.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep3_tp1&#45;&gt;expert_agg_dp2_ep3_tp1 -->
<g id="edge578" class="edge">
<title>expert1_dp2_ep3_tp1&#45;&gt;expert_agg_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M3047,-10755.8C3061.07,-10740.4 3079.7,-10720.01 3097.3,-10700.75"/>
<polygon fill="black" stroke="black" points="3100.07,-10702.9 3104.24,-10693.16 3094.91,-10698.18 3100.07,-10702.9"/>
</g>
<!-- expert2_dp2_ep3_tp1&#45;&gt;expert_agg_dp2_ep3_tp1 -->
<g id="edge579" class="edge">
<title>expert2_dp2_ep3_tp1&#45;&gt;expert_agg_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M3254.18,-10755.8C3240.22,-10740.4 3221.74,-10720.01 3204.28,-10700.75"/>
<polygon fill="black" stroke="black" points="3206.7,-10698.22 3197.4,-10693.16 3201.52,-10702.92 3206.7,-10698.22"/>
</g>
<!-- ln2_dp2_ep3_tp1 -->
<g id="node505" class="node">
<title>ln2_dp2_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3265.5,-10525.97 3036.5,-10525.97 3036.5,-10473.97 3265.5,-10473.97 3265.5,-10525.97"/>
<text text-anchor="middle" x="3151" y="-10513.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3151" y="-10502.97" font-family="Times,serif" font-size="10.00">GPU 135</text>
<text text-anchor="middle" x="3151" y="-10491.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-10480.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep3_tp1&#45;&gt;ln2_dp2_ep3_tp1 -->
<g id="edge580" class="edge">
<title>expert_agg_dp2_ep3_tp1&#45;&gt;ln2_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M3151,-10588.61C3151,-10571.27 3151,-10552.31 3151,-10536.47"/>
<polygon fill="black" stroke="black" points="3154.5,-10536.06 3151,-10526.06 3147.5,-10536.06 3154.5,-10536.06"/>
</g>
<!-- ln1_dp2_ep4_tp1 -->
<g id="node513" class="node">
<title>ln1_dp2_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3265.5,-10389.97 3036.5,-10389.97 3036.5,-10337.97 3265.5,-10337.97 3265.5,-10389.97"/>
<text text-anchor="middle" x="3151" y="-10377.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3151" y="-10366.97" font-family="Times,serif" font-size="10.00">GPU 137</text>
<text text-anchor="middle" x="3151" y="-10355.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-10344.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep3_tp1&#45;&gt;ln1_dp2_ep4_tp1 -->
<g id="edge581" class="edge">
<title>ln2_dp2_ep3_tp1&#45;&gt;ln1_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M3151,-10473.77C3151,-10452.99 3151,-10423.29 3151,-10400.17"/>
<polygon fill="black" stroke="black" points="3154.5,-10400.07 3151,-10390.07 3147.5,-10400.07 3154.5,-10400.07"/>
</g>
<!-- mha_dp2_ep4_tp0 -->
<g id="node507" class="node">
<title>mha_dp2_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2758.5,-10279.97 2529.5,-10279.97 2529.5,-10227.97 2758.5,-10227.97 2758.5,-10279.97"/>
<text text-anchor="middle" x="2644" y="-10267.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2644" y="-10256.97" font-family="Times,serif" font-size="10.00">GPU 136</text>
<text text-anchor="middle" x="2644" y="-10245.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-10234.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep4_tp0&#45;&gt;mha_dp2_ep4_tp0 -->
<g id="edge582" class="edge">
<title>ln1_dp2_ep4_tp0&#45;&gt;mha_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M2644,-10337.93C2644,-10323.85 2644,-10306.05 2644,-10290.55"/>
<polygon fill="black" stroke="black" points="2647.5,-10290.26 2644,-10280.26 2640.5,-10290.26 2647.5,-10290.26"/>
</g>
<!-- moe_gate_dp2_ep4_tp0 -->
<g id="node508" class="node">
<title>moe_gate_dp2_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2888.85,-10190.97 2499.35,-10190.97 2399.15,-10086.97 2788.65,-10086.97 2888.85,-10190.97"/>
<text text-anchor="middle" x="2644" y="-10152.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2644" y="-10141.97" font-family="Times,serif" font-size="10.00">GPU 136</text>
<text text-anchor="middle" x="2644" y="-10130.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-10119.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep4_tp0&#45;&gt;moe_gate_dp2_ep4_tp0 -->
<g id="edge583" class="edge">
<title>mha_dp2_ep4_tp0&#45;&gt;moe_gate_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M2644,-10227.9C2644,-10219.97 2644,-10210.83 2644,-10201.51"/>
<polygon fill="black" stroke="black" points="2647.5,-10201.37 2644,-10191.37 2640.5,-10201.37 2647.5,-10201.37"/>
</g>
<!-- expert1_dp2_ep4_tp0 -->
<g id="node509" class="node">
<title>expert1_dp2_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2635.5,-10009.97 2400.5,-10009.97 2400.5,-9957.97 2635.5,-9957.97 2635.5,-10009.97"/>
<text text-anchor="middle" x="2518" y="-9997.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2518" y="-9986.97" font-family="Times,serif" font-size="10.00">GPU 136</text>
<text text-anchor="middle" x="2518" y="-9975.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2518" y="-9964.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep4_tp0&#45;&gt;expert1_dp2_ep4_tp0 -->
<g id="edge584" class="edge">
<title>moe_gate_dp2_ep4_tp0&#45;&gt;expert1_dp2_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2592.6,-10086.8C2587.2,-10080.91 2581.9,-10074.89 2577,-10068.97 2563.77,-10052.99 2550.37,-10034.17 2539.69,-10018.4"/>
<polygon fill="black" stroke="black" points="2542.53,-10016.35 2534.05,-10009.99 2536.71,-10020.24 2542.53,-10016.35"/>
<text text-anchor="middle" x="2634.5" y="-10057.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep4_tp0 -->
<g id="node510" class="node">
<title>expert2_dp2_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2888.5,-10009.97 2653.5,-10009.97 2653.5,-9957.97 2888.5,-9957.97 2888.5,-10009.97"/>
<text text-anchor="middle" x="2771" y="-9997.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2771" y="-9986.97" font-family="Times,serif" font-size="10.00">GPU 136</text>
<text text-anchor="middle" x="2771" y="-9975.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2771" y="-9964.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep4_tp0&#45;&gt;expert2_dp2_ep4_tp0 -->
<g id="edge585" class="edge">
<title>moe_gate_dp2_ep4_tp0&#45;&gt;expert2_dp2_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2686.64,-10086.6C2705.39,-10064.02 2726.86,-10038.14 2743.46,-10018.16"/>
<polygon fill="black" stroke="black" points="2746.32,-10020.19 2750.02,-10010.26 2740.94,-10015.71 2746.32,-10020.19"/>
<text text-anchor="middle" x="2768.5" y="-10057.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep4_tp0 -->
<g id="node511" class="node">
<title>expert_agg_dp2_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2881.33,-9894.97 2503.79,-9894.97 2406.67,-9790.97 2784.21,-9790.97 2881.33,-9894.97"/>
<text text-anchor="middle" x="2644" y="-9856.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2644" y="-9845.97" font-family="Times,serif" font-size="10.00">GPU 136</text>
<text text-anchor="middle" x="2644" y="-9834.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2644" y="-9823.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep4_tp0&#45;&gt;expert_agg_dp2_ep4_tp0 -->
<g id="edge586" class="edge">
<title>expert1_dp2_ep4_tp0&#45;&gt;expert_agg_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M2540.82,-9957.8C2554.78,-9942.4 2573.26,-9922.01 2590.72,-9902.75"/>
<polygon fill="black" stroke="black" points="2593.48,-9904.92 2597.6,-9895.16 2588.3,-9900.22 2593.48,-9904.92"/>
</g>
<!-- expert2_dp2_ep4_tp0&#45;&gt;expert_agg_dp2_ep4_tp0 -->
<g id="edge587" class="edge">
<title>expert2_dp2_ep4_tp0&#45;&gt;expert_agg_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M2748,-9957.8C2733.93,-9942.4 2715.3,-9922.01 2697.7,-9902.75"/>
<polygon fill="black" stroke="black" points="2700.09,-9900.18 2690.76,-9895.16 2694.93,-9904.9 2700.09,-9900.18"/>
</g>
<!-- ln2_dp2_ep4_tp0 -->
<g id="node512" class="node">
<title>ln2_dp2_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2758.5,-9727.97 2529.5,-9727.97 2529.5,-9675.97 2758.5,-9675.97 2758.5,-9727.97"/>
<text text-anchor="middle" x="2644" y="-9715.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2644" y="-9704.97" font-family="Times,serif" font-size="10.00">GPU 136</text>
<text text-anchor="middle" x="2644" y="-9693.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-9682.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep4_tp0&#45;&gt;ln2_dp2_ep4_tp0 -->
<g id="edge588" class="edge">
<title>expert_agg_dp2_ep4_tp0&#45;&gt;ln2_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M2644,-9790.61C2644,-9773.27 2644,-9754.31 2644,-9738.47"/>
<polygon fill="black" stroke="black" points="2647.5,-9738.06 2644,-9728.06 2640.5,-9738.06 2647.5,-9738.06"/>
</g>
<!-- ln1_dp2_ep5_tp0 -->
<g id="node520" class="node">
<title>ln1_dp2_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2758.5,-9591.97 2529.5,-9591.97 2529.5,-9539.97 2758.5,-9539.97 2758.5,-9591.97"/>
<text text-anchor="middle" x="2644" y="-9579.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2644" y="-9568.97" font-family="Times,serif" font-size="10.00">GPU 138</text>
<text text-anchor="middle" x="2644" y="-9557.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-9546.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep4_tp0&#45;&gt;ln1_dp2_ep5_tp0 -->
<g id="edge589" class="edge">
<title>ln2_dp2_ep4_tp0&#45;&gt;ln1_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M2644,-9675.77C2644,-9654.99 2644,-9625.29 2644,-9602.17"/>
<polygon fill="black" stroke="black" points="2647.5,-9602.07 2644,-9592.07 2640.5,-9602.07 2647.5,-9602.07"/>
</g>
<!-- mha_dp2_ep4_tp1 -->
<g id="node514" class="node">
<title>mha_dp2_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3265.5,-10279.97 3036.5,-10279.97 3036.5,-10227.97 3265.5,-10227.97 3265.5,-10279.97"/>
<text text-anchor="middle" x="3151" y="-10267.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3151" y="-10256.97" font-family="Times,serif" font-size="10.00">GPU 137</text>
<text text-anchor="middle" x="3151" y="-10245.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-10234.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep4_tp1&#45;&gt;mha_dp2_ep4_tp1 -->
<g id="edge590" class="edge">
<title>ln1_dp2_ep4_tp1&#45;&gt;mha_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M3151,-10337.93C3151,-10323.85 3151,-10306.05 3151,-10290.55"/>
<polygon fill="black" stroke="black" points="3154.5,-10290.26 3151,-10280.26 3147.5,-10290.26 3154.5,-10290.26"/>
</g>
<!-- moe_gate_dp2_ep4_tp1 -->
<g id="node515" class="node">
<title>moe_gate_dp2_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3395.85,-10190.97 3006.35,-10190.97 2906.15,-10086.97 3295.65,-10086.97 3395.85,-10190.97"/>
<text text-anchor="middle" x="3151" y="-10152.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3151" y="-10141.97" font-family="Times,serif" font-size="10.00">GPU 137</text>
<text text-anchor="middle" x="3151" y="-10130.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-10119.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep4_tp1&#45;&gt;moe_gate_dp2_ep4_tp1 -->
<g id="edge591" class="edge">
<title>mha_dp2_ep4_tp1&#45;&gt;moe_gate_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M3151,-10227.9C3151,-10219.97 3151,-10210.83 3151,-10201.51"/>
<polygon fill="black" stroke="black" points="3154.5,-10201.37 3151,-10191.37 3147.5,-10201.37 3154.5,-10201.37"/>
</g>
<!-- expert1_dp2_ep4_tp1 -->
<g id="node516" class="node">
<title>expert1_dp2_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3141.5,-10009.97 2906.5,-10009.97 2906.5,-9957.97 3141.5,-9957.97 3141.5,-10009.97"/>
<text text-anchor="middle" x="3024" y="-9997.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3024" y="-9986.97" font-family="Times,serif" font-size="10.00">GPU 137</text>
<text text-anchor="middle" x="3024" y="-9975.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3024" y="-9964.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep4_tp1&#45;&gt;expert1_dp2_ep4_tp1 -->
<g id="edge592" class="edge">
<title>moe_gate_dp2_ep4_tp1&#45;&gt;expert1_dp2_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3106.2,-10086.94C3101.03,-10080.91 3095.88,-10074.83 3091,-10068.97 3077.3,-10052.53 3062.42,-10033.95 3050.17,-10018.45"/>
<polygon fill="black" stroke="black" points="3052.6,-10015.88 3043.66,-10010.19 3047.1,-10020.21 3052.6,-10015.88"/>
<text text-anchor="middle" x="3148.5" y="-10057.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep4_tp1 -->
<g id="node517" class="node">
<title>expert2_dp2_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3394.5,-10009.97 3159.5,-10009.97 3159.5,-9957.97 3394.5,-9957.97 3394.5,-10009.97"/>
<text text-anchor="middle" x="3277" y="-9997.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3277" y="-9986.97" font-family="Times,serif" font-size="10.00">GPU 137</text>
<text text-anchor="middle" x="3277" y="-9975.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3277" y="-9964.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep4_tp1&#45;&gt;expert2_dp2_ep4_tp1 -->
<g id="edge593" class="edge">
<title>moe_gate_dp2_ep4_tp1&#45;&gt;expert2_dp2_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3193.31,-10086.6C3211.91,-10064.02 3233.21,-10038.14 3249.67,-10018.16"/>
<polygon fill="black" stroke="black" points="3252.53,-10020.2 3256.18,-10010.26 3247.12,-10015.75 3252.53,-10020.2"/>
<text text-anchor="middle" x="3274.5" y="-10057.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep4_tp1 -->
<g id="node518" class="node">
<title>expert_agg_dp2_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3388.33,-9894.97 3010.79,-9894.97 2913.67,-9790.97 3291.21,-9790.97 3388.33,-9894.97"/>
<text text-anchor="middle" x="3151" y="-9856.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3151" y="-9845.97" font-family="Times,serif" font-size="10.00">GPU 137</text>
<text text-anchor="middle" x="3151" y="-9834.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3151" y="-9823.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep4_tp1&#45;&gt;expert_agg_dp2_ep4_tp1 -->
<g id="edge594" class="edge">
<title>expert1_dp2_ep4_tp1&#45;&gt;expert_agg_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M3047,-9957.8C3061.07,-9942.4 3079.7,-9922.01 3097.3,-9902.75"/>
<polygon fill="black" stroke="black" points="3100.07,-9904.9 3104.24,-9895.16 3094.91,-9900.18 3100.07,-9904.9"/>
</g>
<!-- expert2_dp2_ep4_tp1&#45;&gt;expert_agg_dp2_ep4_tp1 -->
<g id="edge595" class="edge">
<title>expert2_dp2_ep4_tp1&#45;&gt;expert_agg_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M3254.18,-9957.8C3240.22,-9942.4 3221.74,-9922.01 3204.28,-9902.75"/>
<polygon fill="black" stroke="black" points="3206.7,-9900.22 3197.4,-9895.16 3201.52,-9904.92 3206.7,-9900.22"/>
</g>
<!-- ln2_dp2_ep4_tp1 -->
<g id="node519" class="node">
<title>ln2_dp2_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3265.5,-9727.97 3036.5,-9727.97 3036.5,-9675.97 3265.5,-9675.97 3265.5,-9727.97"/>
<text text-anchor="middle" x="3151" y="-9715.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3151" y="-9704.97" font-family="Times,serif" font-size="10.00">GPU 137</text>
<text text-anchor="middle" x="3151" y="-9693.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-9682.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep4_tp1&#45;&gt;ln2_dp2_ep4_tp1 -->
<g id="edge596" class="edge">
<title>expert_agg_dp2_ep4_tp1&#45;&gt;ln2_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M3151,-9790.61C3151,-9773.27 3151,-9754.31 3151,-9738.47"/>
<polygon fill="black" stroke="black" points="3154.5,-9738.06 3151,-9728.06 3147.5,-9738.06 3154.5,-9738.06"/>
</g>
<!-- ln1_dp2_ep5_tp1 -->
<g id="node527" class="node">
<title>ln1_dp2_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3265.5,-9591.97 3036.5,-9591.97 3036.5,-9539.97 3265.5,-9539.97 3265.5,-9591.97"/>
<text text-anchor="middle" x="3151" y="-9579.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3151" y="-9568.97" font-family="Times,serif" font-size="10.00">GPU 139</text>
<text text-anchor="middle" x="3151" y="-9557.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-9546.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep4_tp1&#45;&gt;ln1_dp2_ep5_tp1 -->
<g id="edge597" class="edge">
<title>ln2_dp2_ep4_tp1&#45;&gt;ln1_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M3151,-9675.77C3151,-9654.99 3151,-9625.29 3151,-9602.17"/>
<polygon fill="black" stroke="black" points="3154.5,-9602.07 3151,-9592.07 3147.5,-9602.07 3154.5,-9602.07"/>
</g>
<!-- mha_dp2_ep5_tp0 -->
<g id="node521" class="node">
<title>mha_dp2_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2758.5,-9481.97 2529.5,-9481.97 2529.5,-9429.97 2758.5,-9429.97 2758.5,-9481.97"/>
<text text-anchor="middle" x="2644" y="-9469.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2644" y="-9458.97" font-family="Times,serif" font-size="10.00">GPU 138</text>
<text text-anchor="middle" x="2644" y="-9447.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-9436.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep5_tp0&#45;&gt;mha_dp2_ep5_tp0 -->
<g id="edge598" class="edge">
<title>ln1_dp2_ep5_tp0&#45;&gt;mha_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M2644,-9539.93C2644,-9525.85 2644,-9508.05 2644,-9492.55"/>
<polygon fill="black" stroke="black" points="2647.5,-9492.26 2644,-9482.26 2640.5,-9492.26 2647.5,-9492.26"/>
</g>
<!-- moe_gate_dp2_ep5_tp0 -->
<g id="node522" class="node">
<title>moe_gate_dp2_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2888.85,-9392.97 2499.35,-9392.97 2399.15,-9288.97 2788.65,-9288.97 2888.85,-9392.97"/>
<text text-anchor="middle" x="2644" y="-9354.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2644" y="-9343.97" font-family="Times,serif" font-size="10.00">GPU 138</text>
<text text-anchor="middle" x="2644" y="-9332.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2644" y="-9321.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep5_tp0&#45;&gt;moe_gate_dp2_ep5_tp0 -->
<g id="edge599" class="edge">
<title>mha_dp2_ep5_tp0&#45;&gt;moe_gate_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M2644,-9429.9C2644,-9421.97 2644,-9412.83 2644,-9403.51"/>
<polygon fill="black" stroke="black" points="2647.5,-9403.37 2644,-9393.37 2640.5,-9403.37 2647.5,-9403.37"/>
</g>
<!-- expert1_dp2_ep5_tp0 -->
<g id="node523" class="node">
<title>expert1_dp2_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2635.5,-9211.97 2400.5,-9211.97 2400.5,-9159.97 2635.5,-9159.97 2635.5,-9211.97"/>
<text text-anchor="middle" x="2518" y="-9199.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2518" y="-9188.97" font-family="Times,serif" font-size="10.00">GPU 138</text>
<text text-anchor="middle" x="2518" y="-9177.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2518" y="-9166.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep5_tp0&#45;&gt;expert1_dp2_ep5_tp0 -->
<g id="edge600" class="edge">
<title>moe_gate_dp2_ep5_tp0&#45;&gt;expert1_dp2_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2601.69,-9288.6C2583.09,-9266.02 2561.79,-9240.14 2545.33,-9220.16"/>
<polygon fill="black" stroke="black" points="2547.88,-9217.75 2538.82,-9212.26 2542.47,-9222.2 2547.88,-9217.75"/>
<text text-anchor="middle" x="2641.5" y="-9259.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep5_tp0 -->
<g id="node524" class="node">
<title>expert2_dp2_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2888.5,-9211.97 2653.5,-9211.97 2653.5,-9159.97 2888.5,-9159.97 2888.5,-9211.97"/>
<text text-anchor="middle" x="2771" y="-9199.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2771" y="-9188.97" font-family="Times,serif" font-size="10.00">GPU 138</text>
<text text-anchor="middle" x="2771" y="-9177.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2771" y="-9166.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep5_tp0&#45;&gt;expert2_dp2_ep5_tp0 -->
<g id="edge601" class="edge">
<title>moe_gate_dp2_ep5_tp0&#45;&gt;expert2_dp2_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2687.97,-9288.86C2693.06,-9282.85 2698.16,-9276.79 2703,-9270.97 2716.9,-9254.27 2732.14,-9235.49 2744.66,-9219.93"/>
<polygon fill="black" stroke="black" points="2747.41,-9222.1 2750.94,-9212.11 2741.95,-9217.71 2747.41,-9222.1"/>
<text text-anchor="middle" x="2771.5" y="-9259.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep5_tp0 -->
<g id="node525" class="node">
<title>expert_agg_dp2_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2877.33,-9096.97 2499.79,-9096.97 2402.67,-8992.97 2780.21,-8992.97 2877.33,-9096.97"/>
<text text-anchor="middle" x="2640" y="-9058.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2640" y="-9047.97" font-family="Times,serif" font-size="10.00">GPU 138</text>
<text text-anchor="middle" x="2640" y="-9036.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2640" y="-9025.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep5_tp0&#45;&gt;expert_agg_dp2_ep5_tp0 -->
<g id="edge602" class="edge">
<title>expert1_dp2_ep5_tp0&#45;&gt;expert_agg_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M2540.09,-9159.8C2553.61,-9144.4 2571.5,-9124.01 2588.41,-9104.75"/>
<polygon fill="black" stroke="black" points="2591.11,-9106.98 2595.08,-9097.16 2585.85,-9102.36 2591.11,-9106.98"/>
</g>
<!-- expert2_dp2_ep5_tp0&#45;&gt;expert_agg_dp2_ep5_tp0 -->
<g id="edge603" class="edge">
<title>expert2_dp2_ep5_tp0&#45;&gt;expert_agg_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M2747.28,-9159.8C2732.7,-9144.33 2713.38,-9123.83 2695.16,-9104.5"/>
<polygon fill="black" stroke="black" points="2697.64,-9102.03 2688.24,-9097.16 2692.55,-9106.83 2697.64,-9102.03"/>
</g>
<!-- ln2_dp2_ep5_tp0 -->
<g id="node526" class="node">
<title>ln2_dp2_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2754.5,-8929.97 2525.5,-8929.97 2525.5,-8877.97 2754.5,-8877.97 2754.5,-8929.97"/>
<text text-anchor="middle" x="2640" y="-8917.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2640" y="-8906.97" font-family="Times,serif" font-size="10.00">GPU 138</text>
<text text-anchor="middle" x="2640" y="-8895.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2640" y="-8884.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep5_tp0&#45;&gt;ln2_dp2_ep5_tp0 -->
<g id="edge604" class="edge">
<title>expert_agg_dp2_ep5_tp0&#45;&gt;ln2_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M2640,-8992.61C2640,-8975.27 2640,-8956.31 2640,-8940.47"/>
<polygon fill="black" stroke="black" points="2643.5,-8940.06 2640,-8930.06 2636.5,-8940.06 2643.5,-8940.06"/>
</g>
<!-- ln1_dp2_ep6_tp0 -->
<g id="node534" class="node">
<title>ln1_dp2_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2754.5,-8793.97 2525.5,-8793.97 2525.5,-8741.97 2754.5,-8741.97 2754.5,-8793.97"/>
<text text-anchor="middle" x="2640" y="-8781.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2640" y="-8770.97" font-family="Times,serif" font-size="10.00">GPU 140</text>
<text text-anchor="middle" x="2640" y="-8759.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2640" y="-8748.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep5_tp0&#45;&gt;ln1_dp2_ep6_tp0 -->
<g id="edge605" class="edge">
<title>ln2_dp2_ep5_tp0&#45;&gt;ln1_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M2640,-8877.77C2640,-8856.99 2640,-8827.29 2640,-8804.17"/>
<polygon fill="black" stroke="black" points="2643.5,-8804.07 2640,-8794.07 2636.5,-8804.07 2643.5,-8804.07"/>
</g>
<!-- mha_dp2_ep5_tp1 -->
<g id="node528" class="node">
<title>mha_dp2_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3265.5,-9481.97 3036.5,-9481.97 3036.5,-9429.97 3265.5,-9429.97 3265.5,-9481.97"/>
<text text-anchor="middle" x="3151" y="-9469.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3151" y="-9458.97" font-family="Times,serif" font-size="10.00">GPU 139</text>
<text text-anchor="middle" x="3151" y="-9447.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-9436.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep5_tp1&#45;&gt;mha_dp2_ep5_tp1 -->
<g id="edge606" class="edge">
<title>ln1_dp2_ep5_tp1&#45;&gt;mha_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M3151,-9539.93C3151,-9525.85 3151,-9508.05 3151,-9492.55"/>
<polygon fill="black" stroke="black" points="3154.5,-9492.26 3151,-9482.26 3147.5,-9492.26 3154.5,-9492.26"/>
</g>
<!-- moe_gate_dp2_ep5_tp1 -->
<g id="node529" class="node">
<title>moe_gate_dp2_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3395.85,-9392.97 3006.35,-9392.97 2906.15,-9288.97 3295.65,-9288.97 3395.85,-9392.97"/>
<text text-anchor="middle" x="3151" y="-9354.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3151" y="-9343.97" font-family="Times,serif" font-size="10.00">GPU 139</text>
<text text-anchor="middle" x="3151" y="-9332.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3151" y="-9321.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep5_tp1&#45;&gt;moe_gate_dp2_ep5_tp1 -->
<g id="edge607" class="edge">
<title>mha_dp2_ep5_tp1&#45;&gt;moe_gate_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M3151,-9429.9C3151,-9421.97 3151,-9412.83 3151,-9403.51"/>
<polygon fill="black" stroke="black" points="3154.5,-9403.37 3151,-9393.37 3147.5,-9403.37 3154.5,-9403.37"/>
</g>
<!-- expert1_dp2_ep5_tp1 -->
<g id="node530" class="node">
<title>expert1_dp2_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3141.5,-9211.97 2906.5,-9211.97 2906.5,-9159.97 3141.5,-9159.97 3141.5,-9211.97"/>
<text text-anchor="middle" x="3024" y="-9199.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3024" y="-9188.97" font-family="Times,serif" font-size="10.00">GPU 139</text>
<text text-anchor="middle" x="3024" y="-9177.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3024" y="-9166.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep5_tp1&#45;&gt;expert1_dp2_ep5_tp1 -->
<g id="edge608" class="edge">
<title>moe_gate_dp2_ep5_tp1&#45;&gt;expert1_dp2_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3106.2,-9288.94C3101.03,-9282.91 3095.88,-9276.83 3091,-9270.97 3077.3,-9254.53 3062.42,-9235.95 3050.17,-9220.45"/>
<polygon fill="black" stroke="black" points="3052.6,-9217.88 3043.66,-9212.19 3047.1,-9222.21 3052.6,-9217.88"/>
<text text-anchor="middle" x="3148.5" y="-9259.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep5_tp1 -->
<g id="node531" class="node">
<title>expert2_dp2_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3394.5,-9211.97 3159.5,-9211.97 3159.5,-9159.97 3394.5,-9159.97 3394.5,-9211.97"/>
<text text-anchor="middle" x="3277" y="-9199.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3277" y="-9188.97" font-family="Times,serif" font-size="10.00">GPU 139</text>
<text text-anchor="middle" x="3277" y="-9177.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3277" y="-9166.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep5_tp1&#45;&gt;expert2_dp2_ep5_tp1 -->
<g id="edge609" class="edge">
<title>moe_gate_dp2_ep5_tp1&#45;&gt;expert2_dp2_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3193.31,-9288.6C3211.91,-9266.02 3233.21,-9240.14 3249.67,-9220.16"/>
<polygon fill="black" stroke="black" points="3252.53,-9222.2 3256.18,-9212.26 3247.12,-9217.75 3252.53,-9222.2"/>
<text text-anchor="middle" x="3274.5" y="-9259.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep5_tp1 -->
<g id="node532" class="node">
<title>expert_agg_dp2_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3384.33,-9096.97 3006.79,-9096.97 2909.67,-8992.97 3287.21,-8992.97 3384.33,-9096.97"/>
<text text-anchor="middle" x="3147" y="-9058.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3147" y="-9047.97" font-family="Times,serif" font-size="10.00">GPU 139</text>
<text text-anchor="middle" x="3147" y="-9036.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3147" y="-9025.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep5_tp1&#45;&gt;expert_agg_dp2_ep5_tp1 -->
<g id="edge610" class="edge">
<title>expert1_dp2_ep5_tp1&#45;&gt;expert_agg_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M3046.27,-9159.8C3059.9,-9144.4 3077.94,-9124.01 3094.99,-9104.75"/>
<polygon fill="black" stroke="black" points="3097.7,-9106.96 3101.71,-9097.16 3092.46,-9102.33 3097.7,-9106.96"/>
</g>
<!-- expert2_dp2_ep5_tp1&#45;&gt;expert_agg_dp2_ep5_tp1 -->
<g id="edge611" class="edge">
<title>expert2_dp2_ep5_tp1&#45;&gt;expert_agg_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M3253.46,-9159.8C3238.99,-9144.33 3219.82,-9123.83 3201.73,-9104.5"/>
<polygon fill="black" stroke="black" points="3204.26,-9102.07 3194.87,-9097.16 3199.14,-9106.85 3204.26,-9102.07"/>
</g>
<!-- ln2_dp2_ep5_tp1 -->
<g id="node533" class="node">
<title>ln2_dp2_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3261.5,-8929.97 3032.5,-8929.97 3032.5,-8877.97 3261.5,-8877.97 3261.5,-8929.97"/>
<text text-anchor="middle" x="3147" y="-8917.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3147" y="-8906.97" font-family="Times,serif" font-size="10.00">GPU 139</text>
<text text-anchor="middle" x="3147" y="-8895.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3147" y="-8884.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep5_tp1&#45;&gt;ln2_dp2_ep5_tp1 -->
<g id="edge612" class="edge">
<title>expert_agg_dp2_ep5_tp1&#45;&gt;ln2_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M3147,-8992.61C3147,-8975.27 3147,-8956.31 3147,-8940.47"/>
<polygon fill="black" stroke="black" points="3150.5,-8940.06 3147,-8930.06 3143.5,-8940.06 3150.5,-8940.06"/>
</g>
<!-- ln1_dp2_ep6_tp1 -->
<g id="node541" class="node">
<title>ln1_dp2_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3261.5,-8793.97 3032.5,-8793.97 3032.5,-8741.97 3261.5,-8741.97 3261.5,-8793.97"/>
<text text-anchor="middle" x="3147" y="-8781.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3147" y="-8770.97" font-family="Times,serif" font-size="10.00">GPU 141</text>
<text text-anchor="middle" x="3147" y="-8759.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3147" y="-8748.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep5_tp1&#45;&gt;ln1_dp2_ep6_tp1 -->
<g id="edge613" class="edge">
<title>ln2_dp2_ep5_tp1&#45;&gt;ln1_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M3147,-8877.77C3147,-8856.99 3147,-8827.29 3147,-8804.17"/>
<polygon fill="black" stroke="black" points="3150.5,-8804.07 3147,-8794.07 3143.5,-8804.07 3150.5,-8804.07"/>
</g>
<!-- mha_dp2_ep6_tp0 -->
<g id="node535" class="node">
<title>mha_dp2_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2754.5,-8683.97 2525.5,-8683.97 2525.5,-8631.97 2754.5,-8631.97 2754.5,-8683.97"/>
<text text-anchor="middle" x="2640" y="-8671.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2640" y="-8660.97" font-family="Times,serif" font-size="10.00">GPU 140</text>
<text text-anchor="middle" x="2640" y="-8649.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2640" y="-8638.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep6_tp0&#45;&gt;mha_dp2_ep6_tp0 -->
<g id="edge614" class="edge">
<title>ln1_dp2_ep6_tp0&#45;&gt;mha_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M2640,-8741.93C2640,-8727.85 2640,-8710.05 2640,-8694.55"/>
<polygon fill="black" stroke="black" points="2643.5,-8694.26 2640,-8684.26 2636.5,-8694.26 2643.5,-8694.26"/>
</g>
<!-- moe_gate_dp2_ep6_tp0 -->
<g id="node536" class="node">
<title>moe_gate_dp2_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2884.85,-8594.97 2495.35,-8594.97 2395.15,-8490.97 2784.65,-8490.97 2884.85,-8594.97"/>
<text text-anchor="middle" x="2640" y="-8556.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2640" y="-8545.97" font-family="Times,serif" font-size="10.00">GPU 140</text>
<text text-anchor="middle" x="2640" y="-8534.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2640" y="-8523.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep6_tp0&#45;&gt;moe_gate_dp2_ep6_tp0 -->
<g id="edge615" class="edge">
<title>mha_dp2_ep6_tp0&#45;&gt;moe_gate_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M2640,-8631.9C2640,-8623.97 2640,-8614.83 2640,-8605.51"/>
<polygon fill="black" stroke="black" points="2643.5,-8605.37 2640,-8595.37 2636.5,-8605.37 2643.5,-8605.37"/>
</g>
<!-- expert1_dp2_ep6_tp0 -->
<g id="node537" class="node">
<title>expert1_dp2_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2631.5,-8413.97 2396.5,-8413.97 2396.5,-8361.97 2631.5,-8361.97 2631.5,-8413.97"/>
<text text-anchor="middle" x="2514" y="-8401.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2514" y="-8390.97" font-family="Times,serif" font-size="10.00">GPU 140</text>
<text text-anchor="middle" x="2514" y="-8379.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2514" y="-8368.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep6_tp0&#45;&gt;expert1_dp2_ep6_tp0 -->
<g id="edge616" class="edge">
<title>moe_gate_dp2_ep6_tp0&#45;&gt;expert1_dp2_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2588.6,-8490.8C2583.2,-8484.91 2577.9,-8478.89 2573,-8472.97 2559.77,-8456.99 2546.37,-8438.17 2535.69,-8422.4"/>
<polygon fill="black" stroke="black" points="2538.53,-8420.35 2530.05,-8413.99 2532.71,-8424.24 2538.53,-8420.35"/>
<text text-anchor="middle" x="2630.5" y="-8461.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep6_tp0 -->
<g id="node538" class="node">
<title>expert2_dp2_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2884.5,-8413.97 2649.5,-8413.97 2649.5,-8361.97 2884.5,-8361.97 2884.5,-8413.97"/>
<text text-anchor="middle" x="2767" y="-8401.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2767" y="-8390.97" font-family="Times,serif" font-size="10.00">GPU 140</text>
<text text-anchor="middle" x="2767" y="-8379.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2767" y="-8368.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep6_tp0&#45;&gt;expert2_dp2_ep6_tp0 -->
<g id="edge617" class="edge">
<title>moe_gate_dp2_ep6_tp0&#45;&gt;expert2_dp2_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2682.64,-8490.6C2701.39,-8468.02 2722.86,-8442.14 2739.46,-8422.16"/>
<polygon fill="black" stroke="black" points="2742.32,-8424.19 2746.02,-8414.26 2736.94,-8419.71 2742.32,-8424.19"/>
<text text-anchor="middle" x="2764.5" y="-8461.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep6_tp0 -->
<g id="node539" class="node">
<title>expert_agg_dp2_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2877.33,-8298.97 2499.79,-8298.97 2402.67,-8194.97 2780.21,-8194.97 2877.33,-8298.97"/>
<text text-anchor="middle" x="2640" y="-8260.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2640" y="-8249.97" font-family="Times,serif" font-size="10.00">GPU 140</text>
<text text-anchor="middle" x="2640" y="-8238.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2640" y="-8227.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep6_tp0&#45;&gt;expert_agg_dp2_ep6_tp0 -->
<g id="edge618" class="edge">
<title>expert1_dp2_ep6_tp0&#45;&gt;expert_agg_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M2536.82,-8361.8C2550.78,-8346.4 2569.26,-8326.01 2586.72,-8306.75"/>
<polygon fill="black" stroke="black" points="2589.48,-8308.92 2593.6,-8299.16 2584.3,-8304.22 2589.48,-8308.92"/>
</g>
<!-- expert2_dp2_ep6_tp0&#45;&gt;expert_agg_dp2_ep6_tp0 -->
<g id="edge619" class="edge">
<title>expert2_dp2_ep6_tp0&#45;&gt;expert_agg_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M2744,-8361.8C2729.93,-8346.4 2711.3,-8326.01 2693.7,-8306.75"/>
<polygon fill="black" stroke="black" points="2696.09,-8304.18 2686.76,-8299.16 2690.93,-8308.9 2696.09,-8304.18"/>
</g>
<!-- ln2_dp2_ep6_tp0 -->
<g id="node540" class="node">
<title>ln2_dp2_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2754.5,-8131.97 2525.5,-8131.97 2525.5,-8079.97 2754.5,-8079.97 2754.5,-8131.97"/>
<text text-anchor="middle" x="2640" y="-8119.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2640" y="-8108.97" font-family="Times,serif" font-size="10.00">GPU 140</text>
<text text-anchor="middle" x="2640" y="-8097.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2640" y="-8086.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep6_tp0&#45;&gt;ln2_dp2_ep6_tp0 -->
<g id="edge620" class="edge">
<title>expert_agg_dp2_ep6_tp0&#45;&gt;ln2_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M2640,-8194.61C2640,-8177.27 2640,-8158.31 2640,-8142.47"/>
<polygon fill="black" stroke="black" points="2643.5,-8142.06 2640,-8132.06 2636.5,-8142.06 2643.5,-8142.06"/>
</g>
<!-- ln1_dp2_ep7_tp0 -->
<g id="node548" class="node">
<title>ln1_dp2_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2754.5,-7995.97 2525.5,-7995.97 2525.5,-7943.97 2754.5,-7943.97 2754.5,-7995.97"/>
<text text-anchor="middle" x="2640" y="-7983.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2640" y="-7972.97" font-family="Times,serif" font-size="10.00">GPU 142</text>
<text text-anchor="middle" x="2640" y="-7961.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2640" y="-7950.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep6_tp0&#45;&gt;ln1_dp2_ep7_tp0 -->
<g id="edge621" class="edge">
<title>ln2_dp2_ep6_tp0&#45;&gt;ln1_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M2640,-8079.77C2640,-8058.99 2640,-8029.29 2640,-8006.17"/>
<polygon fill="black" stroke="black" points="2643.5,-8006.07 2640,-7996.07 2636.5,-8006.07 2643.5,-8006.07"/>
</g>
<!-- mha_dp2_ep6_tp1 -->
<g id="node542" class="node">
<title>mha_dp2_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3261.5,-8683.97 3032.5,-8683.97 3032.5,-8631.97 3261.5,-8631.97 3261.5,-8683.97"/>
<text text-anchor="middle" x="3147" y="-8671.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3147" y="-8660.97" font-family="Times,serif" font-size="10.00">GPU 141</text>
<text text-anchor="middle" x="3147" y="-8649.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3147" y="-8638.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep6_tp1&#45;&gt;mha_dp2_ep6_tp1 -->
<g id="edge622" class="edge">
<title>ln1_dp2_ep6_tp1&#45;&gt;mha_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M3147,-8741.93C3147,-8727.85 3147,-8710.05 3147,-8694.55"/>
<polygon fill="black" stroke="black" points="3150.5,-8694.26 3147,-8684.26 3143.5,-8694.26 3150.5,-8694.26"/>
</g>
<!-- moe_gate_dp2_ep6_tp1 -->
<g id="node543" class="node">
<title>moe_gate_dp2_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3391.85,-8594.97 3002.35,-8594.97 2902.15,-8490.97 3291.65,-8490.97 3391.85,-8594.97"/>
<text text-anchor="middle" x="3147" y="-8556.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3147" y="-8545.97" font-family="Times,serif" font-size="10.00">GPU 141</text>
<text text-anchor="middle" x="3147" y="-8534.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3147" y="-8523.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep6_tp1&#45;&gt;moe_gate_dp2_ep6_tp1 -->
<g id="edge623" class="edge">
<title>mha_dp2_ep6_tp1&#45;&gt;moe_gate_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M3147,-8631.9C3147,-8623.97 3147,-8614.83 3147,-8605.51"/>
<polygon fill="black" stroke="black" points="3150.5,-8605.37 3147,-8595.37 3143.5,-8605.37 3150.5,-8605.37"/>
</g>
<!-- expert1_dp2_ep6_tp1 -->
<g id="node544" class="node">
<title>expert1_dp2_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3137.5,-8413.97 2902.5,-8413.97 2902.5,-8361.97 3137.5,-8361.97 3137.5,-8413.97"/>
<text text-anchor="middle" x="3020" y="-8401.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3020" y="-8390.97" font-family="Times,serif" font-size="10.00">GPU 141</text>
<text text-anchor="middle" x="3020" y="-8379.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3020" y="-8368.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep6_tp1&#45;&gt;expert1_dp2_ep6_tp1 -->
<g id="edge624" class="edge">
<title>moe_gate_dp2_ep6_tp1&#45;&gt;expert1_dp2_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3102.2,-8490.94C3097.03,-8484.91 3091.88,-8478.83 3087,-8472.97 3073.3,-8456.53 3058.42,-8437.95 3046.17,-8422.45"/>
<polygon fill="black" stroke="black" points="3048.6,-8419.88 3039.66,-8414.19 3043.1,-8424.21 3048.6,-8419.88"/>
<text text-anchor="middle" x="3144.5" y="-8461.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep6_tp1 -->
<g id="node545" class="node">
<title>expert2_dp2_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3390.5,-8413.97 3155.5,-8413.97 3155.5,-8361.97 3390.5,-8361.97 3390.5,-8413.97"/>
<text text-anchor="middle" x="3273" y="-8401.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3273" y="-8390.97" font-family="Times,serif" font-size="10.00">GPU 141</text>
<text text-anchor="middle" x="3273" y="-8379.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3273" y="-8368.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep6_tp1&#45;&gt;expert2_dp2_ep6_tp1 -->
<g id="edge625" class="edge">
<title>moe_gate_dp2_ep6_tp1&#45;&gt;expert2_dp2_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3189.31,-8490.6C3207.91,-8468.02 3229.21,-8442.14 3245.67,-8422.16"/>
<polygon fill="black" stroke="black" points="3248.53,-8424.2 3252.18,-8414.26 3243.12,-8419.75 3248.53,-8424.2"/>
<text text-anchor="middle" x="3270.5" y="-8461.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep6_tp1 -->
<g id="node546" class="node">
<title>expert_agg_dp2_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3384.33,-8298.97 3006.79,-8298.97 2909.67,-8194.97 3287.21,-8194.97 3384.33,-8298.97"/>
<text text-anchor="middle" x="3147" y="-8260.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3147" y="-8249.97" font-family="Times,serif" font-size="10.00">GPU 141</text>
<text text-anchor="middle" x="3147" y="-8238.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3147" y="-8227.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep6_tp1&#45;&gt;expert_agg_dp2_ep6_tp1 -->
<g id="edge626" class="edge">
<title>expert1_dp2_ep6_tp1&#45;&gt;expert_agg_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M3043,-8361.8C3057.07,-8346.4 3075.7,-8326.01 3093.3,-8306.75"/>
<polygon fill="black" stroke="black" points="3096.07,-8308.9 3100.24,-8299.16 3090.91,-8304.18 3096.07,-8308.9"/>
</g>
<!-- expert2_dp2_ep6_tp1&#45;&gt;expert_agg_dp2_ep6_tp1 -->
<g id="edge627" class="edge">
<title>expert2_dp2_ep6_tp1&#45;&gt;expert_agg_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M3250.18,-8361.8C3236.22,-8346.4 3217.74,-8326.01 3200.28,-8306.75"/>
<polygon fill="black" stroke="black" points="3202.7,-8304.22 3193.4,-8299.16 3197.52,-8308.92 3202.7,-8304.22"/>
</g>
<!-- ln2_dp2_ep6_tp1 -->
<g id="node547" class="node">
<title>ln2_dp2_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3261.5,-8131.97 3032.5,-8131.97 3032.5,-8079.97 3261.5,-8079.97 3261.5,-8131.97"/>
<text text-anchor="middle" x="3147" y="-8119.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3147" y="-8108.97" font-family="Times,serif" font-size="10.00">GPU 141</text>
<text text-anchor="middle" x="3147" y="-8097.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3147" y="-8086.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep6_tp1&#45;&gt;ln2_dp2_ep6_tp1 -->
<g id="edge628" class="edge">
<title>expert_agg_dp2_ep6_tp1&#45;&gt;ln2_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M3147,-8194.61C3147,-8177.27 3147,-8158.31 3147,-8142.47"/>
<polygon fill="black" stroke="black" points="3150.5,-8142.06 3147,-8132.06 3143.5,-8142.06 3150.5,-8142.06"/>
</g>
<!-- ln1_dp2_ep7_tp1 -->
<g id="node555" class="node">
<title>ln1_dp2_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3261.5,-7995.97 3032.5,-7995.97 3032.5,-7943.97 3261.5,-7943.97 3261.5,-7995.97"/>
<text text-anchor="middle" x="3147" y="-7983.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3147" y="-7972.97" font-family="Times,serif" font-size="10.00">GPU 143</text>
<text text-anchor="middle" x="3147" y="-7961.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3147" y="-7950.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp2_ep6_tp1&#45;&gt;ln1_dp2_ep7_tp1 -->
<g id="edge629" class="edge">
<title>ln2_dp2_ep6_tp1&#45;&gt;ln1_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M3147,-8079.77C3147,-8058.99 3147,-8029.29 3147,-8006.17"/>
<polygon fill="black" stroke="black" points="3150.5,-8006.07 3147,-7996.07 3143.5,-8006.07 3150.5,-8006.07"/>
</g>
<!-- mha_dp2_ep7_tp0 -->
<g id="node549" class="node">
<title>mha_dp2_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2754.5,-7885.97 2525.5,-7885.97 2525.5,-7833.97 2754.5,-7833.97 2754.5,-7885.97"/>
<text text-anchor="middle" x="2640" y="-7873.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2640" y="-7862.97" font-family="Times,serif" font-size="10.00">GPU 142</text>
<text text-anchor="middle" x="2640" y="-7851.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2640" y="-7840.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep7_tp0&#45;&gt;mha_dp2_ep7_tp0 -->
<g id="edge630" class="edge">
<title>ln1_dp2_ep7_tp0&#45;&gt;mha_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M2640,-7943.93C2640,-7929.85 2640,-7912.05 2640,-7896.55"/>
<polygon fill="black" stroke="black" points="2643.5,-7896.26 2640,-7886.26 2636.5,-7896.26 2643.5,-7896.26"/>
</g>
<!-- moe_gate_dp2_ep7_tp0 -->
<g id="node550" class="node">
<title>moe_gate_dp2_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2884.85,-7796.97 2495.35,-7796.97 2395.15,-7692.97 2784.65,-7692.97 2884.85,-7796.97"/>
<text text-anchor="middle" x="2640" y="-7758.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2640" y="-7747.97" font-family="Times,serif" font-size="10.00">GPU 142</text>
<text text-anchor="middle" x="2640" y="-7736.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2640" y="-7725.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep7_tp0&#45;&gt;moe_gate_dp2_ep7_tp0 -->
<g id="edge631" class="edge">
<title>mha_dp2_ep7_tp0&#45;&gt;moe_gate_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M2640,-7833.9C2640,-7825.97 2640,-7816.83 2640,-7807.51"/>
<polygon fill="black" stroke="black" points="2643.5,-7807.37 2640,-7797.37 2636.5,-7807.37 2643.5,-7807.37"/>
</g>
<!-- expert1_dp2_ep7_tp0 -->
<g id="node551" class="node">
<title>expert1_dp2_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2631.5,-7615.97 2396.5,-7615.97 2396.5,-7563.97 2631.5,-7563.97 2631.5,-7615.97"/>
<text text-anchor="middle" x="2514" y="-7603.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2514" y="-7592.97" font-family="Times,serif" font-size="10.00">GPU 142</text>
<text text-anchor="middle" x="2514" y="-7581.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2514" y="-7570.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep7_tp0&#45;&gt;expert1_dp2_ep7_tp0 -->
<g id="edge632" class="edge">
<title>moe_gate_dp2_ep7_tp0&#45;&gt;expert1_dp2_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2597.69,-7692.6C2579.09,-7670.02 2557.79,-7644.14 2541.33,-7624.16"/>
<polygon fill="black" stroke="black" points="2543.88,-7621.75 2534.82,-7616.26 2538.47,-7626.2 2543.88,-7621.75"/>
<text text-anchor="middle" x="2637.5" y="-7663.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep7_tp0 -->
<g id="node552" class="node">
<title>expert2_dp2_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2884.5,-7615.97 2649.5,-7615.97 2649.5,-7563.97 2884.5,-7563.97 2884.5,-7615.97"/>
<text text-anchor="middle" x="2767" y="-7603.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2767" y="-7592.97" font-family="Times,serif" font-size="10.00">GPU 142</text>
<text text-anchor="middle" x="2767" y="-7581.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2767" y="-7570.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep7_tp0&#45;&gt;expert2_dp2_ep7_tp0 -->
<g id="edge633" class="edge">
<title>moe_gate_dp2_ep7_tp0&#45;&gt;expert2_dp2_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2683.97,-7692.86C2689.06,-7686.85 2694.16,-7680.79 2699,-7674.97 2712.9,-7658.27 2728.14,-7639.49 2740.66,-7623.93"/>
<polygon fill="black" stroke="black" points="2743.41,-7626.1 2746.94,-7616.11 2737.95,-7621.71 2743.41,-7626.1"/>
<text text-anchor="middle" x="2767.5" y="-7663.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep7_tp0 -->
<g id="node553" class="node">
<title>expert_agg_dp2_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2869.33,-7500.97 2491.79,-7500.97 2394.67,-7396.97 2772.21,-7396.97 2869.33,-7500.97"/>
<text text-anchor="middle" x="2632" y="-7462.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2632" y="-7451.97" font-family="Times,serif" font-size="10.00">GPU 142</text>
<text text-anchor="middle" x="2632" y="-7440.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2632" y="-7429.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep7_tp0&#45;&gt;expert_agg_dp2_ep7_tp0 -->
<g id="edge634" class="edge">
<title>expert1_dp2_ep7_tp0&#45;&gt;expert_agg_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M2535.37,-7563.8C2548.39,-7548.47 2565.6,-7528.19 2581.88,-7509.01"/>
<polygon fill="black" stroke="black" points="2584.75,-7511.05 2588.55,-7501.16 2579.41,-7506.51 2584.75,-7511.05"/>
</g>
<!-- expert2_dp2_ep7_tp0&#45;&gt;expert_agg_dp2_ep7_tp0 -->
<g id="edge635" class="edge">
<title>expert2_dp2_ep7_tp0&#45;&gt;expert_agg_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M2742.55,-7563.8C2727.53,-7548.33 2707.62,-7527.83 2688.84,-7508.5"/>
<polygon fill="black" stroke="black" points="2691.19,-7505.89 2681.71,-7501.16 2686.17,-7510.77 2691.19,-7505.89"/>
</g>
<!-- ln2_dp2_ep7_tp0 -->
<g id="node554" class="node">
<title>ln2_dp2_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2685.5,-7333.97 2456.5,-7333.97 2456.5,-7281.97 2685.5,-7281.97 2685.5,-7333.97"/>
<text text-anchor="middle" x="2571" y="-7321.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2571" y="-7310.97" font-family="Times,serif" font-size="10.00">GPU 142</text>
<text text-anchor="middle" x="2571" y="-7299.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2571" y="-7288.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep7_tp0&#45;&gt;ln2_dp2_ep7_tp0 -->
<g id="edge636" class="edge">
<title>expert_agg_dp2_ep7_tp0&#45;&gt;ln2_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M2609.46,-7396.61C2601.7,-7378.93 2593.21,-7359.58 2586.18,-7343.56"/>
<polygon fill="black" stroke="black" points="2589.23,-7341.81 2582.01,-7334.06 2582.82,-7344.63 2589.23,-7341.81"/>
</g>
<!-- comm_pipeline_dp2_ep7_tp0 -->
<g id="node1073" class="node">
<title>comm_pipeline_dp2_ep7_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="2489" cy="-7171.97" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="2489" y="-7180.47" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="2489" y="-7169.47" font-family="Times,serif" font-size="10.00">GPU 142â†’158</text>
<text text-anchor="middle" x="2489" y="-7158.47" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- ln2_dp2_ep7_tp0&#45;&gt;comm_pipeline_dp2_ep7_tp0 -->
<g id="edge637" class="edge">
<title>ln2_dp2_ep7_tp0&#45;&gt;comm_pipeline_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M2555.58,-7281.77C2543.04,-7261.29 2525.2,-7232.13 2511.14,-7209.16"/>
<polygon fill="black" stroke="black" points="2513.97,-7207.07 2505.77,-7200.37 2508,-7210.73 2513.97,-7207.07"/>
</g>
<!-- mha_dp2_ep7_tp1 -->
<g id="node556" class="node">
<title>mha_dp2_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3261.5,-7885.97 3032.5,-7885.97 3032.5,-7833.97 3261.5,-7833.97 3261.5,-7885.97"/>
<text text-anchor="middle" x="3147" y="-7873.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3147" y="-7862.97" font-family="Times,serif" font-size="10.00">GPU 143</text>
<text text-anchor="middle" x="3147" y="-7851.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3147" y="-7840.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp2_ep7_tp1&#45;&gt;mha_dp2_ep7_tp1 -->
<g id="edge639" class="edge">
<title>ln1_dp2_ep7_tp1&#45;&gt;mha_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M3147,-7943.93C3147,-7929.85 3147,-7912.05 3147,-7896.55"/>
<polygon fill="black" stroke="black" points="3150.5,-7896.26 3147,-7886.26 3143.5,-7896.26 3150.5,-7896.26"/>
</g>
<!-- moe_gate_dp2_ep7_tp1 -->
<g id="node557" class="node">
<title>moe_gate_dp2_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3391.85,-7796.97 3002.35,-7796.97 2902.15,-7692.97 3291.65,-7692.97 3391.85,-7796.97"/>
<text text-anchor="middle" x="3147" y="-7758.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3147" y="-7747.97" font-family="Times,serif" font-size="10.00">GPU 143</text>
<text text-anchor="middle" x="3147" y="-7736.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3147" y="-7725.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp2_ep7_tp1&#45;&gt;moe_gate_dp2_ep7_tp1 -->
<g id="edge640" class="edge">
<title>mha_dp2_ep7_tp1&#45;&gt;moe_gate_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M3147,-7833.9C3147,-7825.97 3147,-7816.83 3147,-7807.51"/>
<polygon fill="black" stroke="black" points="3150.5,-7807.37 3147,-7797.37 3143.5,-7807.37 3150.5,-7807.37"/>
</g>
<!-- expert1_dp2_ep7_tp1 -->
<g id="node558" class="node">
<title>expert1_dp2_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3137.5,-7615.97 2902.5,-7615.97 2902.5,-7563.97 3137.5,-7563.97 3137.5,-7615.97"/>
<text text-anchor="middle" x="3020" y="-7603.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3020" y="-7592.97" font-family="Times,serif" font-size="10.00">GPU 143</text>
<text text-anchor="middle" x="3020" y="-7581.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3020" y="-7570.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep7_tp1&#45;&gt;expert1_dp2_ep7_tp1 -->
<g id="edge641" class="edge">
<title>moe_gate_dp2_ep7_tp1&#45;&gt;expert1_dp2_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3102.2,-7692.94C3097.03,-7686.91 3091.88,-7680.83 3087,-7674.97 3073.3,-7658.53 3058.42,-7639.95 3046.17,-7624.45"/>
<polygon fill="black" stroke="black" points="3048.6,-7621.88 3039.66,-7616.19 3043.1,-7626.21 3048.6,-7621.88"/>
<text text-anchor="middle" x="3144.5" y="-7663.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp2_ep7_tp1 -->
<g id="node559" class="node">
<title>expert2_dp2_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3390.5,-7615.97 3155.5,-7615.97 3155.5,-7563.97 3390.5,-7563.97 3390.5,-7615.97"/>
<text text-anchor="middle" x="3273" y="-7603.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3273" y="-7592.97" font-family="Times,serif" font-size="10.00">GPU 143</text>
<text text-anchor="middle" x="3273" y="-7581.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3273" y="-7570.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp2_ep7_tp1&#45;&gt;expert2_dp2_ep7_tp1 -->
<g id="edge642" class="edge">
<title>moe_gate_dp2_ep7_tp1&#45;&gt;expert2_dp2_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3189.31,-7692.6C3207.91,-7670.02 3229.21,-7644.14 3245.67,-7624.16"/>
<polygon fill="black" stroke="black" points="3248.53,-7626.2 3252.18,-7616.26 3243.12,-7621.75 3248.53,-7626.2"/>
<text text-anchor="middle" x="3270.5" y="-7663.77" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp2_ep7_tp1 -->
<g id="node560" class="node">
<title>expert_agg_dp2_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3362.33,-7500.97 2984.79,-7500.97 2887.67,-7396.97 3265.21,-7396.97 3362.33,-7500.97"/>
<text text-anchor="middle" x="3125" y="-7462.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3125" y="-7451.97" font-family="Times,serif" font-size="10.00">GPU 143</text>
<text text-anchor="middle" x="3125" y="-7440.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3125" y="-7429.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp2_ep7_tp1&#45;&gt;expert_agg_dp2_ep7_tp1 -->
<g id="edge643" class="edge">
<title>expert1_dp2_ep7_tp1&#45;&gt;expert_agg_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M3039.01,-7563.8C3050.55,-7548.54 3065.78,-7528.37 3080.21,-7509.26"/>
<polygon fill="black" stroke="black" points="3083.1,-7511.25 3086.34,-7501.16 3077.52,-7507.03 3083.1,-7511.25"/>
</g>
<!-- expert2_dp2_ep7_tp1&#45;&gt;expert_agg_dp2_ep7_tp1 -->
<g id="edge644" class="edge">
<title>expert2_dp2_ep7_tp1&#45;&gt;expert_agg_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M3246.2,-7563.8C3229.65,-7548.26 3207.71,-7527.65 3187.04,-7508.24"/>
<polygon fill="black" stroke="black" points="3189.18,-7505.45 3179.5,-7501.16 3184.39,-7510.55 3189.18,-7505.45"/>
</g>
<!-- ln2_dp2_ep7_tp1 -->
<g id="node561" class="node">
<title>ln2_dp2_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3085.5,-7333.97 2856.5,-7333.97 2856.5,-7281.97 3085.5,-7281.97 3085.5,-7333.97"/>
<text text-anchor="middle" x="2971" y="-7321.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2971" y="-7310.97" font-family="Times,serif" font-size="10.00">GPU 143</text>
<text text-anchor="middle" x="2971" y="-7299.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2971" y="-7288.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp2_ep7_tp1&#45;&gt;ln2_dp2_ep7_tp1 -->
<g id="edge645" class="edge">
<title>expert_agg_dp2_ep7_tp1&#45;&gt;ln2_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M3068.09,-7396.61C3047.4,-7377.93 3024.63,-7357.38 3006.34,-7340.87"/>
<polygon fill="black" stroke="black" points="3008.56,-7338.17 2998.8,-7334.06 3003.87,-7343.36 3008.56,-7338.17"/>
</g>
<!-- comm_pipeline_dp2_ep7_tp1 -->
<g id="node1074" class="node">
<title>comm_pipeline_dp2_ep7_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="2682" cy="-7171.97" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="2682" y="-7180.47" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="2682" y="-7169.47" font-family="Times,serif" font-size="10.00">GPU 143â†’159</text>
<text text-anchor="middle" x="2682" y="-7158.47" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- ln2_dp2_ep7_tp1&#45;&gt;comm_pipeline_dp2_ep7_tp1 -->
<g id="edge646" class="edge">
<title>ln2_dp2_ep7_tp1&#45;&gt;comm_pipeline_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M2898.65,-7281.97C2860.56,-7267.94 2813.48,-7249.21 2773,-7228.97 2757.88,-7221.42 2742,-7212.15 2727.82,-7203.34"/>
<polygon fill="black" stroke="black" points="2729.55,-7200.3 2719.22,-7197.94 2725.83,-7206.23 2729.55,-7200.3"/>
</g>
<!-- stage2_mha_dp2_ep0_tp0 -->
<g id="node563" class="node">
<title>stage2_mha_dp2_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1722.5,-12558.97 1493.5,-12558.97 1493.5,-12506.97 1722.5,-12506.97 1722.5,-12558.97"/>
<text text-anchor="middle" x="1608" y="-12546.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1608" y="-12535.97" font-family="Times,serif" font-size="10.00">GPU 144</text>
<text text-anchor="middle" x="1608" y="-12524.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1608" y="-12513.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep0_tp0&#45;&gt;stage2_mha_dp2_ep0_tp0 -->
<g id="edge648" class="edge">
<title>stage2_ln1_dp2_ep0_tp0&#45;&gt;stage2_mha_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M1608,-12621.9C1608,-12606.39 1608,-12586.25 1608,-12569.16"/>
<polygon fill="black" stroke="black" points="1611.5,-12568.98 1608,-12558.98 1604.5,-12568.98 1611.5,-12568.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep0_tp0 -->
<g id="node564" class="node">
<title>stage2_moe_gate_dp2_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1852.85,-12429.97 1463.35,-12429.97 1363.15,-12325.97 1752.65,-12325.97 1852.85,-12429.97"/>
<text text-anchor="middle" x="1608" y="-12391.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1608" y="-12380.97" font-family="Times,serif" font-size="10.00">GPU 144</text>
<text text-anchor="middle" x="1608" y="-12369.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1608" y="-12358.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep0_tp0&#45;&gt;stage2_moe_gate_dp2_ep0_tp0 -->
<g id="edge649" class="edge">
<title>stage2_mha_dp2_ep0_tp0&#45;&gt;stage2_moe_gate_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M1608,-12506.71C1608,-12488.6 1608,-12463.39 1608,-12440.15"/>
<polygon fill="black" stroke="black" points="1611.5,-12439.99 1608,-12429.99 1604.5,-12439.99 1611.5,-12439.99"/>
</g>
<!-- stage2_expert1_dp2_ep0_tp0 -->
<g id="node565" class="node">
<title>stage2_expert1_dp2_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1599.5,-12262.97 1364.5,-12262.97 1364.5,-12210.97 1599.5,-12210.97 1599.5,-12262.97"/>
<text text-anchor="middle" x="1482" y="-12250.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1482" y="-12239.97" font-family="Times,serif" font-size="10.00">GPU 144</text>
<text text-anchor="middle" x="1482" y="-12228.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1482" y="-12217.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep0_tp0&#45;&gt;stage2_expert1_dp2_ep0_tp0 -->
<g id="edge650" class="edge">
<title>stage2_moe_gate_dp2_ep0_tp0&#45;&gt;stage2_expert1_dp2_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1561.44,-12325.61C1544.81,-12307.27 1526.54,-12287.11 1511.72,-12270.76"/>
<polygon fill="black" stroke="black" points="1514.05,-12268.12 1504.74,-12263.06 1508.87,-12272.82 1514.05,-12268.12"/>
</g>
<!-- stage2_expert2_dp2_ep0_tp0 -->
<g id="node566" class="node">
<title>stage2_expert2_dp2_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1852.5,-12262.97 1617.5,-12262.97 1617.5,-12210.97 1852.5,-12210.97 1852.5,-12262.97"/>
<text text-anchor="middle" x="1735" y="-12250.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1735" y="-12239.97" font-family="Times,serif" font-size="10.00">GPU 144</text>
<text text-anchor="middle" x="1735" y="-12228.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1735" y="-12217.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep0_tp0&#45;&gt;stage2_expert2_dp2_ep0_tp0 -->
<g id="edge651" class="edge">
<title>stage2_moe_gate_dp2_ep0_tp0&#45;&gt;stage2_expert2_dp2_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1654.93,-12325.61C1671.69,-12307.27 1690.1,-12287.11 1705.04,-12270.76"/>
<polygon fill="black" stroke="black" points="1707.92,-12272.81 1712.08,-12263.06 1702.75,-12268.08 1707.92,-12272.81"/>
</g>
<!-- stage2_expert_agg_dp2_ep0_tp0 -->
<g id="node567" class="node">
<title>stage2_expert_agg_dp2_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1852.33,-12147.97 1474.79,-12147.97 1377.67,-12043.97 1755.21,-12043.97 1852.33,-12147.97"/>
<text text-anchor="middle" x="1615" y="-12109.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1615" y="-12098.97" font-family="Times,serif" font-size="10.00">GPU 144</text>
<text text-anchor="middle" x="1615" y="-12087.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1615" y="-12076.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep0_tp0&#45;&gt;stage2_expert_agg_dp2_ep0_tp0 -->
<g id="edge652" class="edge">
<title>stage2_expert1_dp2_ep0_tp0&#45;&gt;stage2_expert_agg_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M1506.09,-12210.8C1520.89,-12195.33 1540.5,-12174.83 1559,-12155.5"/>
<polygon fill="black" stroke="black" points="1561.64,-12157.8 1566.03,-12148.16 1556.58,-12152.96 1561.64,-12157.8"/>
</g>
<!-- stage2_expert2_dp2_ep0_tp0&#45;&gt;stage2_expert_agg_dp2_ep0_tp0 -->
<g id="edge653" class="edge">
<title>stage2_expert2_dp2_ep0_tp0&#45;&gt;stage2_expert_agg_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M1713.27,-12210.8C1699.97,-12195.4 1682.37,-12175.01 1665.74,-12155.75"/>
<polygon fill="black" stroke="black" points="1668.37,-12153.44 1659.19,-12148.16 1663.07,-12158.01 1668.37,-12153.44"/>
</g>
<!-- stage2_ln2_dp2_ep0_tp0 -->
<g id="node568" class="node">
<title>stage2_ln2_dp2_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-11985.97 1500.5,-11985.97 1500.5,-11933.97 1729.5,-11933.97 1729.5,-11985.97"/>
<text text-anchor="middle" x="1615" y="-11973.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1615" y="-11962.97" font-family="Times,serif" font-size="10.00">GPU 144</text>
<text text-anchor="middle" x="1615" y="-11951.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-11940.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep0_tp0&#45;&gt;stage2_ln2_dp2_ep0_tp0 -->
<g id="edge654" class="edge">
<title>stage2_expert_agg_dp2_ep0_tp0&#45;&gt;stage2_ln2_dp2_ep0_tp0</title>
<path fill="none" stroke="black" d="M1615,-12043.93C1615,-12027.98 1615,-12010.75 1615,-11996.15"/>
<polygon fill="black" stroke="black" points="1618.5,-11996.03 1615,-11986.03 1611.5,-11996.03 1618.5,-11996.03"/>
</g>
<!-- stage2_ln1_dp2_ep1_tp0 -->
<g id="node576" class="node">
<title>stage2_ln1_dp2_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-11875.97 1500.5,-11875.97 1500.5,-11823.97 1729.5,-11823.97 1729.5,-11875.97"/>
<text text-anchor="middle" x="1615" y="-11863.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1615" y="-11852.97" font-family="Times,serif" font-size="10.00">GPU 146</text>
<text text-anchor="middle" x="1615" y="-11841.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-11830.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep0_tp0&#45;&gt;stage2_ln1_dp2_ep1_tp0 -->
<g id="edge655" class="edge">
<title>stage2_ln2_dp2_ep0_tp0&#45;&gt;stage2_ln1_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M1615,-11933.93C1615,-11919.85 1615,-11902.05 1615,-11886.55"/>
<polygon fill="black" stroke="black" points="1618.5,-11886.26 1615,-11876.26 1611.5,-11886.26 1618.5,-11886.26"/>
</g>
<!-- stage2_mha_dp2_ep0_tp1 -->
<g id="node570" class="node">
<title>stage2_mha_dp2_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2229.5,-12558.97 2000.5,-12558.97 2000.5,-12506.97 2229.5,-12506.97 2229.5,-12558.97"/>
<text text-anchor="middle" x="2115" y="-12546.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2115" y="-12535.97" font-family="Times,serif" font-size="10.00">GPU 145</text>
<text text-anchor="middle" x="2115" y="-12524.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2115" y="-12513.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep0_tp1&#45;&gt;stage2_mha_dp2_ep0_tp1 -->
<g id="edge656" class="edge">
<title>stage2_ln1_dp2_ep0_tp1&#45;&gt;stage2_mha_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M2115,-12621.9C2115,-12606.39 2115,-12586.25 2115,-12569.16"/>
<polygon fill="black" stroke="black" points="2118.5,-12568.98 2115,-12558.98 2111.5,-12568.98 2118.5,-12568.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep0_tp1 -->
<g id="node571" class="node">
<title>stage2_moe_gate_dp2_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2359.85,-12429.97 1970.35,-12429.97 1870.15,-12325.97 2259.65,-12325.97 2359.85,-12429.97"/>
<text text-anchor="middle" x="2115" y="-12391.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2115" y="-12380.97" font-family="Times,serif" font-size="10.00">GPU 145</text>
<text text-anchor="middle" x="2115" y="-12369.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2115" y="-12358.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep0_tp1&#45;&gt;stage2_moe_gate_dp2_ep0_tp1 -->
<g id="edge657" class="edge">
<title>stage2_mha_dp2_ep0_tp1&#45;&gt;stage2_moe_gate_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M2115,-12506.71C2115,-12488.6 2115,-12463.39 2115,-12440.15"/>
<polygon fill="black" stroke="black" points="2118.5,-12439.99 2115,-12429.99 2111.5,-12439.99 2118.5,-12439.99"/>
</g>
<!-- stage2_expert1_dp2_ep0_tp1 -->
<g id="node572" class="node">
<title>stage2_expert1_dp2_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2105.5,-12262.97 1870.5,-12262.97 1870.5,-12210.97 2105.5,-12210.97 2105.5,-12262.97"/>
<text text-anchor="middle" x="1988" y="-12250.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1988" y="-12239.97" font-family="Times,serif" font-size="10.00">GPU 145</text>
<text text-anchor="middle" x="1988" y="-12228.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1988" y="-12217.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep0_tp1&#45;&gt;stage2_expert1_dp2_ep0_tp1 -->
<g id="edge658" class="edge">
<title>stage2_moe_gate_dp2_ep0_tp1&#45;&gt;stage2_expert1_dp2_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2068.07,-12325.61C2051.31,-12307.27 2032.9,-12287.11 2017.96,-12270.76"/>
<polygon fill="black" stroke="black" points="2020.25,-12268.08 2010.92,-12263.06 2015.08,-12272.81 2020.25,-12268.08"/>
</g>
<!-- stage2_expert2_dp2_ep0_tp1 -->
<g id="node573" class="node">
<title>stage2_expert2_dp2_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2358.5,-12262.97 2123.5,-12262.97 2123.5,-12210.97 2358.5,-12210.97 2358.5,-12262.97"/>
<text text-anchor="middle" x="2241" y="-12250.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2241" y="-12239.97" font-family="Times,serif" font-size="10.00">GPU 145</text>
<text text-anchor="middle" x="2241" y="-12228.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2241" y="-12217.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep0_tp1&#45;&gt;stage2_expert2_dp2_ep0_tp1 -->
<g id="edge659" class="edge">
<title>stage2_moe_gate_dp2_ep0_tp1&#45;&gt;stage2_expert2_dp2_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2161.56,-12325.61C2178.19,-12307.27 2196.46,-12287.11 2211.28,-12270.76"/>
<polygon fill="black" stroke="black" points="2214.13,-12272.82 2218.26,-12263.06 2208.95,-12268.12 2214.13,-12272.82"/>
</g>
<!-- stage2_expert_agg_dp2_ep0_tp1 -->
<g id="node574" class="node">
<title>stage2_expert_agg_dp2_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2359.33,-12147.97 1981.79,-12147.97 1884.67,-12043.97 2262.21,-12043.97 2359.33,-12147.97"/>
<text text-anchor="middle" x="2122" y="-12109.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2122" y="-12098.97" font-family="Times,serif" font-size="10.00">GPU 145</text>
<text text-anchor="middle" x="2122" y="-12087.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2122" y="-12076.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep0_tp1&#45;&gt;stage2_expert_agg_dp2_ep0_tp1 -->
<g id="edge660" class="edge">
<title>stage2_expert1_dp2_ep0_tp1&#45;&gt;stage2_expert_agg_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M2012.27,-12210.8C2027.18,-12195.33 2046.94,-12174.83 2065.58,-12155.5"/>
<polygon fill="black" stroke="black" points="2068.24,-12157.79 2072.66,-12148.16 2063.2,-12152.93 2068.24,-12157.79"/>
</g>
<!-- stage2_expert2_dp2_ep0_tp1&#45;&gt;stage2_expert_agg_dp2_ep0_tp1 -->
<g id="edge661" class="edge">
<title>stage2_expert2_dp2_ep0_tp1&#45;&gt;stage2_expert_agg_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M2219.45,-12210.8C2206.26,-12195.4 2188.81,-12175.01 2172.32,-12155.75"/>
<polygon fill="black" stroke="black" points="2174.98,-12153.48 2165.82,-12148.16 2169.66,-12158.03 2174.98,-12153.48"/>
</g>
<!-- stage2_ln2_dp2_ep0_tp1 -->
<g id="node575" class="node">
<title>stage2_ln2_dp2_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-11985.97 2007.5,-11985.97 2007.5,-11933.97 2236.5,-11933.97 2236.5,-11985.97"/>
<text text-anchor="middle" x="2122" y="-11973.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2122" y="-11962.97" font-family="Times,serif" font-size="10.00">GPU 145</text>
<text text-anchor="middle" x="2122" y="-11951.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-11940.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep0_tp1&#45;&gt;stage2_ln2_dp2_ep0_tp1 -->
<g id="edge662" class="edge">
<title>stage2_expert_agg_dp2_ep0_tp1&#45;&gt;stage2_ln2_dp2_ep0_tp1</title>
<path fill="none" stroke="black" d="M2122,-12043.93C2122,-12027.98 2122,-12010.75 2122,-11996.15"/>
<polygon fill="black" stroke="black" points="2125.5,-11996.03 2122,-11986.03 2118.5,-11996.03 2125.5,-11996.03"/>
</g>
<!-- stage2_ln1_dp2_ep1_tp1 -->
<g id="node583" class="node">
<title>stage2_ln1_dp2_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-11875.97 2007.5,-11875.97 2007.5,-11823.97 2236.5,-11823.97 2236.5,-11875.97"/>
<text text-anchor="middle" x="2122" y="-11863.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2122" y="-11852.97" font-family="Times,serif" font-size="10.00">GPU 147</text>
<text text-anchor="middle" x="2122" y="-11841.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-11830.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep0_tp1&#45;&gt;stage2_ln1_dp2_ep1_tp1 -->
<g id="edge663" class="edge">
<title>stage2_ln2_dp2_ep0_tp1&#45;&gt;stage2_ln1_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M2122,-11933.93C2122,-11919.85 2122,-11902.05 2122,-11886.55"/>
<polygon fill="black" stroke="black" points="2125.5,-11886.26 2122,-11876.26 2118.5,-11886.26 2125.5,-11886.26"/>
</g>
<!-- stage2_mha_dp2_ep1_tp0 -->
<g id="node577" class="node">
<title>stage2_mha_dp2_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-11760.97 1500.5,-11760.97 1500.5,-11708.97 1729.5,-11708.97 1729.5,-11760.97"/>
<text text-anchor="middle" x="1615" y="-11748.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1615" y="-11737.97" font-family="Times,serif" font-size="10.00">GPU 146</text>
<text text-anchor="middle" x="1615" y="-11726.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-11715.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep1_tp0&#45;&gt;stage2_mha_dp2_ep1_tp0 -->
<g id="edge664" class="edge">
<title>stage2_ln1_dp2_ep1_tp0&#45;&gt;stage2_mha_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M1615,-11823.9C1615,-11808.39 1615,-11788.25 1615,-11771.16"/>
<polygon fill="black" stroke="black" points="1618.5,-11770.98 1615,-11760.98 1611.5,-11770.98 1618.5,-11770.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep1_tp0 -->
<g id="node578" class="node">
<title>stage2_moe_gate_dp2_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1859.85,-11631.97 1470.35,-11631.97 1370.15,-11527.97 1759.65,-11527.97 1859.85,-11631.97"/>
<text text-anchor="middle" x="1615" y="-11593.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1615" y="-11582.97" font-family="Times,serif" font-size="10.00">GPU 146</text>
<text text-anchor="middle" x="1615" y="-11571.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-11560.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep1_tp0&#45;&gt;stage2_moe_gate_dp2_ep1_tp0 -->
<g id="edge665" class="edge">
<title>stage2_mha_dp2_ep1_tp0&#45;&gt;stage2_moe_gate_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M1615,-11708.71C1615,-11690.6 1615,-11665.39 1615,-11642.15"/>
<polygon fill="black" stroke="black" points="1618.5,-11641.99 1615,-11631.99 1611.5,-11641.99 1618.5,-11641.99"/>
</g>
<!-- stage2_expert1_dp2_ep1_tp0 -->
<g id="node579" class="node">
<title>stage2_expert1_dp2_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1606.5,-11464.97 1371.5,-11464.97 1371.5,-11412.97 1606.5,-11412.97 1606.5,-11464.97"/>
<text text-anchor="middle" x="1489" y="-11452.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1489" y="-11441.97" font-family="Times,serif" font-size="10.00">GPU 146</text>
<text text-anchor="middle" x="1489" y="-11430.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1489" y="-11419.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep1_tp0&#45;&gt;stage2_expert1_dp2_ep1_tp0 -->
<g id="edge666" class="edge">
<title>stage2_moe_gate_dp2_ep1_tp0&#45;&gt;stage2_expert1_dp2_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1568.44,-11527.61C1551.81,-11509.27 1533.54,-11489.11 1518.72,-11472.76"/>
<polygon fill="black" stroke="black" points="1521.05,-11470.12 1511.74,-11465.06 1515.87,-11474.82 1521.05,-11470.12"/>
</g>
<!-- stage2_expert2_dp2_ep1_tp0 -->
<g id="node580" class="node">
<title>stage2_expert2_dp2_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1859.5,-11464.97 1624.5,-11464.97 1624.5,-11412.97 1859.5,-11412.97 1859.5,-11464.97"/>
<text text-anchor="middle" x="1742" y="-11452.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1742" y="-11441.97" font-family="Times,serif" font-size="10.00">GPU 146</text>
<text text-anchor="middle" x="1742" y="-11430.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1742" y="-11419.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep1_tp0&#45;&gt;stage2_expert2_dp2_ep1_tp0 -->
<g id="edge667" class="edge">
<title>stage2_moe_gate_dp2_ep1_tp0&#45;&gt;stage2_expert2_dp2_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1661.93,-11527.61C1678.69,-11509.27 1697.1,-11489.11 1712.04,-11472.76"/>
<polygon fill="black" stroke="black" points="1714.92,-11474.81 1719.08,-11465.06 1709.75,-11470.08 1714.92,-11474.81"/>
</g>
<!-- stage2_expert_agg_dp2_ep1_tp0 -->
<g id="node581" class="node">
<title>stage2_expert_agg_dp2_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1852.33,-11349.97 1474.79,-11349.97 1377.67,-11245.97 1755.21,-11245.97 1852.33,-11349.97"/>
<text text-anchor="middle" x="1615" y="-11311.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1615" y="-11300.97" font-family="Times,serif" font-size="10.00">GPU 146</text>
<text text-anchor="middle" x="1615" y="-11289.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1615" y="-11278.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep1_tp0&#45;&gt;stage2_expert_agg_dp2_ep1_tp0 -->
<g id="edge668" class="edge">
<title>stage2_expert1_dp2_ep1_tp0&#45;&gt;stage2_expert_agg_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M1511.82,-11412.8C1525.78,-11397.4 1544.26,-11377.01 1561.72,-11357.75"/>
<polygon fill="black" stroke="black" points="1564.48,-11359.92 1568.6,-11350.16 1559.3,-11355.22 1564.48,-11359.92"/>
</g>
<!-- stage2_expert2_dp2_ep1_tp0&#45;&gt;stage2_expert_agg_dp2_ep1_tp0 -->
<g id="edge669" class="edge">
<title>stage2_expert2_dp2_ep1_tp0&#45;&gt;stage2_expert_agg_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M1719,-11412.8C1704.93,-11397.4 1686.3,-11377.01 1668.7,-11357.75"/>
<polygon fill="black" stroke="black" points="1671.09,-11355.18 1661.76,-11350.16 1665.93,-11359.9 1671.09,-11355.18"/>
</g>
<!-- stage2_ln2_dp2_ep1_tp0 -->
<g id="node582" class="node">
<title>stage2_ln2_dp2_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-11187.97 1500.5,-11187.97 1500.5,-11135.97 1729.5,-11135.97 1729.5,-11187.97"/>
<text text-anchor="middle" x="1615" y="-11175.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1615" y="-11164.97" font-family="Times,serif" font-size="10.00">GPU 146</text>
<text text-anchor="middle" x="1615" y="-11153.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-11142.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep1_tp0&#45;&gt;stage2_ln2_dp2_ep1_tp0 -->
<g id="edge670" class="edge">
<title>stage2_expert_agg_dp2_ep1_tp0&#45;&gt;stage2_ln2_dp2_ep1_tp0</title>
<path fill="none" stroke="black" d="M1615,-11245.93C1615,-11229.98 1615,-11212.75 1615,-11198.15"/>
<polygon fill="black" stroke="black" points="1618.5,-11198.03 1615,-11188.03 1611.5,-11198.03 1618.5,-11198.03"/>
</g>
<!-- stage2_ln1_dp2_ep2_tp0 -->
<g id="node590" class="node">
<title>stage2_ln1_dp2_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-11077.97 1500.5,-11077.97 1500.5,-11025.97 1729.5,-11025.97 1729.5,-11077.97"/>
<text text-anchor="middle" x="1615" y="-11065.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1615" y="-11054.97" font-family="Times,serif" font-size="10.00">GPU 148</text>
<text text-anchor="middle" x="1615" y="-11043.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-11032.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep1_tp0&#45;&gt;stage2_ln1_dp2_ep2_tp0 -->
<g id="edge671" class="edge">
<title>stage2_ln2_dp2_ep1_tp0&#45;&gt;stage2_ln1_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M1615,-11135.93C1615,-11121.85 1615,-11104.05 1615,-11088.55"/>
<polygon fill="black" stroke="black" points="1618.5,-11088.26 1615,-11078.26 1611.5,-11088.26 1618.5,-11088.26"/>
</g>
<!-- stage2_mha_dp2_ep1_tp1 -->
<g id="node584" class="node">
<title>stage2_mha_dp2_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-11760.97 2007.5,-11760.97 2007.5,-11708.97 2236.5,-11708.97 2236.5,-11760.97"/>
<text text-anchor="middle" x="2122" y="-11748.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2122" y="-11737.97" font-family="Times,serif" font-size="10.00">GPU 147</text>
<text text-anchor="middle" x="2122" y="-11726.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-11715.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep1_tp1&#45;&gt;stage2_mha_dp2_ep1_tp1 -->
<g id="edge672" class="edge">
<title>stage2_ln1_dp2_ep1_tp1&#45;&gt;stage2_mha_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M2122,-11823.9C2122,-11808.39 2122,-11788.25 2122,-11771.16"/>
<polygon fill="black" stroke="black" points="2125.5,-11770.98 2122,-11760.98 2118.5,-11770.98 2125.5,-11770.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep1_tp1 -->
<g id="node585" class="node">
<title>stage2_moe_gate_dp2_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2366.85,-11631.97 1977.35,-11631.97 1877.15,-11527.97 2266.65,-11527.97 2366.85,-11631.97"/>
<text text-anchor="middle" x="2122" y="-11593.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2122" y="-11582.97" font-family="Times,serif" font-size="10.00">GPU 147</text>
<text text-anchor="middle" x="2122" y="-11571.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-11560.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep1_tp1&#45;&gt;stage2_moe_gate_dp2_ep1_tp1 -->
<g id="edge673" class="edge">
<title>stage2_mha_dp2_ep1_tp1&#45;&gt;stage2_moe_gate_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M2122,-11708.71C2122,-11690.6 2122,-11665.39 2122,-11642.15"/>
<polygon fill="black" stroke="black" points="2125.5,-11641.99 2122,-11631.99 2118.5,-11641.99 2125.5,-11641.99"/>
</g>
<!-- stage2_expert1_dp2_ep1_tp1 -->
<g id="node586" class="node">
<title>stage2_expert1_dp2_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2112.5,-11464.97 1877.5,-11464.97 1877.5,-11412.97 2112.5,-11412.97 2112.5,-11464.97"/>
<text text-anchor="middle" x="1995" y="-11452.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1995" y="-11441.97" font-family="Times,serif" font-size="10.00">GPU 147</text>
<text text-anchor="middle" x="1995" y="-11430.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1995" y="-11419.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep1_tp1&#45;&gt;stage2_expert1_dp2_ep1_tp1 -->
<g id="edge674" class="edge">
<title>stage2_moe_gate_dp2_ep1_tp1&#45;&gt;stage2_expert1_dp2_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2075.07,-11527.61C2058.31,-11509.27 2039.9,-11489.11 2024.96,-11472.76"/>
<polygon fill="black" stroke="black" points="2027.25,-11470.08 2017.92,-11465.06 2022.08,-11474.81 2027.25,-11470.08"/>
</g>
<!-- stage2_expert2_dp2_ep1_tp1 -->
<g id="node587" class="node">
<title>stage2_expert2_dp2_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2365.5,-11464.97 2130.5,-11464.97 2130.5,-11412.97 2365.5,-11412.97 2365.5,-11464.97"/>
<text text-anchor="middle" x="2248" y="-11452.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2248" y="-11441.97" font-family="Times,serif" font-size="10.00">GPU 147</text>
<text text-anchor="middle" x="2248" y="-11430.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2248" y="-11419.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep1_tp1&#45;&gt;stage2_expert2_dp2_ep1_tp1 -->
<g id="edge675" class="edge">
<title>stage2_moe_gate_dp2_ep1_tp1&#45;&gt;stage2_expert2_dp2_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2168.56,-11527.61C2185.19,-11509.27 2203.46,-11489.11 2218.28,-11472.76"/>
<polygon fill="black" stroke="black" points="2221.13,-11474.82 2225.26,-11465.06 2215.95,-11470.12 2221.13,-11474.82"/>
</g>
<!-- stage2_expert_agg_dp2_ep1_tp1 -->
<g id="node588" class="node">
<title>stage2_expert_agg_dp2_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2359.33,-11349.97 1981.79,-11349.97 1884.67,-11245.97 2262.21,-11245.97 2359.33,-11349.97"/>
<text text-anchor="middle" x="2122" y="-11311.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2122" y="-11300.97" font-family="Times,serif" font-size="10.00">GPU 147</text>
<text text-anchor="middle" x="2122" y="-11289.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2122" y="-11278.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep1_tp1&#45;&gt;stage2_expert_agg_dp2_ep1_tp1 -->
<g id="edge676" class="edge">
<title>stage2_expert1_dp2_ep1_tp1&#45;&gt;stage2_expert_agg_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M2018,-11412.8C2032.07,-11397.4 2050.7,-11377.01 2068.3,-11357.75"/>
<polygon fill="black" stroke="black" points="2071.07,-11359.9 2075.24,-11350.16 2065.91,-11355.18 2071.07,-11359.9"/>
</g>
<!-- stage2_expert2_dp2_ep1_tp1&#45;&gt;stage2_expert_agg_dp2_ep1_tp1 -->
<g id="edge677" class="edge">
<title>stage2_expert2_dp2_ep1_tp1&#45;&gt;stage2_expert_agg_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M2225.18,-11412.8C2211.22,-11397.4 2192.74,-11377.01 2175.28,-11357.75"/>
<polygon fill="black" stroke="black" points="2177.7,-11355.22 2168.4,-11350.16 2172.52,-11359.92 2177.7,-11355.22"/>
</g>
<!-- stage2_ln2_dp2_ep1_tp1 -->
<g id="node589" class="node">
<title>stage2_ln2_dp2_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-11187.97 2007.5,-11187.97 2007.5,-11135.97 2236.5,-11135.97 2236.5,-11187.97"/>
<text text-anchor="middle" x="2122" y="-11175.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2122" y="-11164.97" font-family="Times,serif" font-size="10.00">GPU 147</text>
<text text-anchor="middle" x="2122" y="-11153.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-11142.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep1_tp1&#45;&gt;stage2_ln2_dp2_ep1_tp1 -->
<g id="edge678" class="edge">
<title>stage2_expert_agg_dp2_ep1_tp1&#45;&gt;stage2_ln2_dp2_ep1_tp1</title>
<path fill="none" stroke="black" d="M2122,-11245.93C2122,-11229.98 2122,-11212.75 2122,-11198.15"/>
<polygon fill="black" stroke="black" points="2125.5,-11198.03 2122,-11188.03 2118.5,-11198.03 2125.5,-11198.03"/>
</g>
<!-- stage2_ln1_dp2_ep2_tp1 -->
<g id="node597" class="node">
<title>stage2_ln1_dp2_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-11077.97 2007.5,-11077.97 2007.5,-11025.97 2236.5,-11025.97 2236.5,-11077.97"/>
<text text-anchor="middle" x="2122" y="-11065.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2122" y="-11054.97" font-family="Times,serif" font-size="10.00">GPU 149</text>
<text text-anchor="middle" x="2122" y="-11043.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-11032.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep1_tp1&#45;&gt;stage2_ln1_dp2_ep2_tp1 -->
<g id="edge679" class="edge">
<title>stage2_ln2_dp2_ep1_tp1&#45;&gt;stage2_ln1_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M2122,-11135.93C2122,-11121.85 2122,-11104.05 2122,-11088.55"/>
<polygon fill="black" stroke="black" points="2125.5,-11088.26 2122,-11078.26 2118.5,-11088.26 2125.5,-11088.26"/>
</g>
<!-- stage2_mha_dp2_ep2_tp0 -->
<g id="node591" class="node">
<title>stage2_mha_dp2_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-10962.97 1500.5,-10962.97 1500.5,-10910.97 1729.5,-10910.97 1729.5,-10962.97"/>
<text text-anchor="middle" x="1615" y="-10950.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1615" y="-10939.97" font-family="Times,serif" font-size="10.00">GPU 148</text>
<text text-anchor="middle" x="1615" y="-10928.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-10917.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep2_tp0&#45;&gt;stage2_mha_dp2_ep2_tp0 -->
<g id="edge680" class="edge">
<title>stage2_ln1_dp2_ep2_tp0&#45;&gt;stage2_mha_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M1615,-11025.9C1615,-11010.39 1615,-10990.25 1615,-10973.16"/>
<polygon fill="black" stroke="black" points="1618.5,-10972.98 1615,-10962.98 1611.5,-10972.98 1618.5,-10972.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep2_tp0 -->
<g id="node592" class="node">
<title>stage2_moe_gate_dp2_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1859.85,-10833.97 1470.35,-10833.97 1370.15,-10729.97 1759.65,-10729.97 1859.85,-10833.97"/>
<text text-anchor="middle" x="1615" y="-10795.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1615" y="-10784.97" font-family="Times,serif" font-size="10.00">GPU 148</text>
<text text-anchor="middle" x="1615" y="-10773.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-10762.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep2_tp0&#45;&gt;stage2_moe_gate_dp2_ep2_tp0 -->
<g id="edge681" class="edge">
<title>stage2_mha_dp2_ep2_tp0&#45;&gt;stage2_moe_gate_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M1615,-10910.71C1615,-10892.6 1615,-10867.39 1615,-10844.15"/>
<polygon fill="black" stroke="black" points="1618.5,-10843.99 1615,-10833.99 1611.5,-10843.99 1618.5,-10843.99"/>
</g>
<!-- stage2_expert1_dp2_ep2_tp0 -->
<g id="node593" class="node">
<title>stage2_expert1_dp2_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1606.5,-10666.97 1371.5,-10666.97 1371.5,-10614.97 1606.5,-10614.97 1606.5,-10666.97"/>
<text text-anchor="middle" x="1489" y="-10654.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1489" y="-10643.97" font-family="Times,serif" font-size="10.00">GPU 148</text>
<text text-anchor="middle" x="1489" y="-10632.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1489" y="-10621.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep2_tp0&#45;&gt;stage2_expert1_dp2_ep2_tp0 -->
<g id="edge682" class="edge">
<title>stage2_moe_gate_dp2_ep2_tp0&#45;&gt;stage2_expert1_dp2_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1568.44,-10729.61C1551.81,-10711.27 1533.54,-10691.11 1518.72,-10674.76"/>
<polygon fill="black" stroke="black" points="1521.05,-10672.12 1511.74,-10667.06 1515.87,-10676.82 1521.05,-10672.12"/>
</g>
<!-- stage2_expert2_dp2_ep2_tp0 -->
<g id="node594" class="node">
<title>stage2_expert2_dp2_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1859.5,-10666.97 1624.5,-10666.97 1624.5,-10614.97 1859.5,-10614.97 1859.5,-10666.97"/>
<text text-anchor="middle" x="1742" y="-10654.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1742" y="-10643.97" font-family="Times,serif" font-size="10.00">GPU 148</text>
<text text-anchor="middle" x="1742" y="-10632.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1742" y="-10621.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep2_tp0&#45;&gt;stage2_expert2_dp2_ep2_tp0 -->
<g id="edge683" class="edge">
<title>stage2_moe_gate_dp2_ep2_tp0&#45;&gt;stage2_expert2_dp2_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1661.93,-10729.61C1678.69,-10711.27 1697.1,-10691.11 1712.04,-10674.76"/>
<polygon fill="black" stroke="black" points="1714.92,-10676.81 1719.08,-10667.06 1709.75,-10672.08 1714.92,-10676.81"/>
</g>
<!-- stage2_expert_agg_dp2_ep2_tp0 -->
<g id="node595" class="node">
<title>stage2_expert_agg_dp2_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1852.33,-10551.97 1474.79,-10551.97 1377.67,-10447.97 1755.21,-10447.97 1852.33,-10551.97"/>
<text text-anchor="middle" x="1615" y="-10513.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1615" y="-10502.97" font-family="Times,serif" font-size="10.00">GPU 148</text>
<text text-anchor="middle" x="1615" y="-10491.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1615" y="-10480.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep2_tp0&#45;&gt;stage2_expert_agg_dp2_ep2_tp0 -->
<g id="edge684" class="edge">
<title>stage2_expert1_dp2_ep2_tp0&#45;&gt;stage2_expert_agg_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M1511.82,-10614.8C1525.78,-10599.4 1544.26,-10579.01 1561.72,-10559.75"/>
<polygon fill="black" stroke="black" points="1564.48,-10561.92 1568.6,-10552.16 1559.3,-10557.22 1564.48,-10561.92"/>
</g>
<!-- stage2_expert2_dp2_ep2_tp0&#45;&gt;stage2_expert_agg_dp2_ep2_tp0 -->
<g id="edge685" class="edge">
<title>stage2_expert2_dp2_ep2_tp0&#45;&gt;stage2_expert_agg_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M1719,-10614.8C1704.93,-10599.4 1686.3,-10579.01 1668.7,-10559.75"/>
<polygon fill="black" stroke="black" points="1671.09,-10557.18 1661.76,-10552.16 1665.93,-10561.9 1671.09,-10557.18"/>
</g>
<!-- stage2_ln2_dp2_ep2_tp0 -->
<g id="node596" class="node">
<title>stage2_ln2_dp2_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-10389.97 1500.5,-10389.97 1500.5,-10337.97 1729.5,-10337.97 1729.5,-10389.97"/>
<text text-anchor="middle" x="1615" y="-10377.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1615" y="-10366.97" font-family="Times,serif" font-size="10.00">GPU 148</text>
<text text-anchor="middle" x="1615" y="-10355.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-10344.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep2_tp0&#45;&gt;stage2_ln2_dp2_ep2_tp0 -->
<g id="edge686" class="edge">
<title>stage2_expert_agg_dp2_ep2_tp0&#45;&gt;stage2_ln2_dp2_ep2_tp0</title>
<path fill="none" stroke="black" d="M1615,-10447.93C1615,-10431.98 1615,-10414.75 1615,-10400.15"/>
<polygon fill="black" stroke="black" points="1618.5,-10400.03 1615,-10390.03 1611.5,-10400.03 1618.5,-10400.03"/>
</g>
<!-- stage2_ln1_dp2_ep3_tp0 -->
<g id="node604" class="node">
<title>stage2_ln1_dp2_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-10279.97 1500.5,-10279.97 1500.5,-10227.97 1729.5,-10227.97 1729.5,-10279.97"/>
<text text-anchor="middle" x="1615" y="-10267.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1615" y="-10256.97" font-family="Times,serif" font-size="10.00">GPU 150</text>
<text text-anchor="middle" x="1615" y="-10245.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-10234.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep2_tp0&#45;&gt;stage2_ln1_dp2_ep3_tp0 -->
<g id="edge687" class="edge">
<title>stage2_ln2_dp2_ep2_tp0&#45;&gt;stage2_ln1_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M1615,-10337.93C1615,-10323.85 1615,-10306.05 1615,-10290.55"/>
<polygon fill="black" stroke="black" points="1618.5,-10290.26 1615,-10280.26 1611.5,-10290.26 1618.5,-10290.26"/>
</g>
<!-- stage2_mha_dp2_ep2_tp1 -->
<g id="node598" class="node">
<title>stage2_mha_dp2_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-10962.97 2007.5,-10962.97 2007.5,-10910.97 2236.5,-10910.97 2236.5,-10962.97"/>
<text text-anchor="middle" x="2122" y="-10950.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2122" y="-10939.97" font-family="Times,serif" font-size="10.00">GPU 149</text>
<text text-anchor="middle" x="2122" y="-10928.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-10917.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep2_tp1&#45;&gt;stage2_mha_dp2_ep2_tp1 -->
<g id="edge688" class="edge">
<title>stage2_ln1_dp2_ep2_tp1&#45;&gt;stage2_mha_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M2122,-11025.9C2122,-11010.39 2122,-10990.25 2122,-10973.16"/>
<polygon fill="black" stroke="black" points="2125.5,-10972.98 2122,-10962.98 2118.5,-10972.98 2125.5,-10972.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep2_tp1 -->
<g id="node599" class="node">
<title>stage2_moe_gate_dp2_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2366.85,-10833.97 1977.35,-10833.97 1877.15,-10729.97 2266.65,-10729.97 2366.85,-10833.97"/>
<text text-anchor="middle" x="2122" y="-10795.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2122" y="-10784.97" font-family="Times,serif" font-size="10.00">GPU 149</text>
<text text-anchor="middle" x="2122" y="-10773.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-10762.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep2_tp1&#45;&gt;stage2_moe_gate_dp2_ep2_tp1 -->
<g id="edge689" class="edge">
<title>stage2_mha_dp2_ep2_tp1&#45;&gt;stage2_moe_gate_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M2122,-10910.71C2122,-10892.6 2122,-10867.39 2122,-10844.15"/>
<polygon fill="black" stroke="black" points="2125.5,-10843.99 2122,-10833.99 2118.5,-10843.99 2125.5,-10843.99"/>
</g>
<!-- stage2_expert1_dp2_ep2_tp1 -->
<g id="node600" class="node">
<title>stage2_expert1_dp2_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2112.5,-10666.97 1877.5,-10666.97 1877.5,-10614.97 2112.5,-10614.97 2112.5,-10666.97"/>
<text text-anchor="middle" x="1995" y="-10654.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1995" y="-10643.97" font-family="Times,serif" font-size="10.00">GPU 149</text>
<text text-anchor="middle" x="1995" y="-10632.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1995" y="-10621.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep2_tp1&#45;&gt;stage2_expert1_dp2_ep2_tp1 -->
<g id="edge690" class="edge">
<title>stage2_moe_gate_dp2_ep2_tp1&#45;&gt;stage2_expert1_dp2_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2075.07,-10729.61C2058.31,-10711.27 2039.9,-10691.11 2024.96,-10674.76"/>
<polygon fill="black" stroke="black" points="2027.25,-10672.08 2017.92,-10667.06 2022.08,-10676.81 2027.25,-10672.08"/>
</g>
<!-- stage2_expert2_dp2_ep2_tp1 -->
<g id="node601" class="node">
<title>stage2_expert2_dp2_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2365.5,-10666.97 2130.5,-10666.97 2130.5,-10614.97 2365.5,-10614.97 2365.5,-10666.97"/>
<text text-anchor="middle" x="2248" y="-10654.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2248" y="-10643.97" font-family="Times,serif" font-size="10.00">GPU 149</text>
<text text-anchor="middle" x="2248" y="-10632.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2248" y="-10621.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep2_tp1&#45;&gt;stage2_expert2_dp2_ep2_tp1 -->
<g id="edge691" class="edge">
<title>stage2_moe_gate_dp2_ep2_tp1&#45;&gt;stage2_expert2_dp2_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2168.56,-10729.61C2185.19,-10711.27 2203.46,-10691.11 2218.28,-10674.76"/>
<polygon fill="black" stroke="black" points="2221.13,-10676.82 2225.26,-10667.06 2215.95,-10672.12 2221.13,-10676.82"/>
</g>
<!-- stage2_expert_agg_dp2_ep2_tp1 -->
<g id="node602" class="node">
<title>stage2_expert_agg_dp2_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2359.33,-10551.97 1981.79,-10551.97 1884.67,-10447.97 2262.21,-10447.97 2359.33,-10551.97"/>
<text text-anchor="middle" x="2122" y="-10513.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2122" y="-10502.97" font-family="Times,serif" font-size="10.00">GPU 149</text>
<text text-anchor="middle" x="2122" y="-10491.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2122" y="-10480.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep2_tp1&#45;&gt;stage2_expert_agg_dp2_ep2_tp1 -->
<g id="edge692" class="edge">
<title>stage2_expert1_dp2_ep2_tp1&#45;&gt;stage2_expert_agg_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M2018,-10614.8C2032.07,-10599.4 2050.7,-10579.01 2068.3,-10559.75"/>
<polygon fill="black" stroke="black" points="2071.07,-10561.9 2075.24,-10552.16 2065.91,-10557.18 2071.07,-10561.9"/>
</g>
<!-- stage2_expert2_dp2_ep2_tp1&#45;&gt;stage2_expert_agg_dp2_ep2_tp1 -->
<g id="edge693" class="edge">
<title>stage2_expert2_dp2_ep2_tp1&#45;&gt;stage2_expert_agg_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M2225.18,-10614.8C2211.22,-10599.4 2192.74,-10579.01 2175.28,-10559.75"/>
<polygon fill="black" stroke="black" points="2177.7,-10557.22 2168.4,-10552.16 2172.52,-10561.92 2177.7,-10557.22"/>
</g>
<!-- stage2_ln2_dp2_ep2_tp1 -->
<g id="node603" class="node">
<title>stage2_ln2_dp2_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-10389.97 2007.5,-10389.97 2007.5,-10337.97 2236.5,-10337.97 2236.5,-10389.97"/>
<text text-anchor="middle" x="2122" y="-10377.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2122" y="-10366.97" font-family="Times,serif" font-size="10.00">GPU 149</text>
<text text-anchor="middle" x="2122" y="-10355.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-10344.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep2_tp1&#45;&gt;stage2_ln2_dp2_ep2_tp1 -->
<g id="edge694" class="edge">
<title>stage2_expert_agg_dp2_ep2_tp1&#45;&gt;stage2_ln2_dp2_ep2_tp1</title>
<path fill="none" stroke="black" d="M2122,-10447.93C2122,-10431.98 2122,-10414.75 2122,-10400.15"/>
<polygon fill="black" stroke="black" points="2125.5,-10400.03 2122,-10390.03 2118.5,-10400.03 2125.5,-10400.03"/>
</g>
<!-- stage2_ln1_dp2_ep3_tp1 -->
<g id="node611" class="node">
<title>stage2_ln1_dp2_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-10279.97 2007.5,-10279.97 2007.5,-10227.97 2236.5,-10227.97 2236.5,-10279.97"/>
<text text-anchor="middle" x="2122" y="-10267.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2122" y="-10256.97" font-family="Times,serif" font-size="10.00">GPU 151</text>
<text text-anchor="middle" x="2122" y="-10245.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-10234.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep2_tp1&#45;&gt;stage2_ln1_dp2_ep3_tp1 -->
<g id="edge695" class="edge">
<title>stage2_ln2_dp2_ep2_tp1&#45;&gt;stage2_ln1_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M2122,-10337.93C2122,-10323.85 2122,-10306.05 2122,-10290.55"/>
<polygon fill="black" stroke="black" points="2125.5,-10290.26 2122,-10280.26 2118.5,-10290.26 2125.5,-10290.26"/>
</g>
<!-- stage2_mha_dp2_ep3_tp0 -->
<g id="node605" class="node">
<title>stage2_mha_dp2_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-10164.97 1500.5,-10164.97 1500.5,-10112.97 1729.5,-10112.97 1729.5,-10164.97"/>
<text text-anchor="middle" x="1615" y="-10152.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1615" y="-10141.97" font-family="Times,serif" font-size="10.00">GPU 150</text>
<text text-anchor="middle" x="1615" y="-10130.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-10119.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep3_tp0&#45;&gt;stage2_mha_dp2_ep3_tp0 -->
<g id="edge696" class="edge">
<title>stage2_ln1_dp2_ep3_tp0&#45;&gt;stage2_mha_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M1615,-10227.9C1615,-10212.39 1615,-10192.25 1615,-10175.16"/>
<polygon fill="black" stroke="black" points="1618.5,-10174.98 1615,-10164.98 1611.5,-10174.98 1618.5,-10174.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep3_tp0 -->
<g id="node606" class="node">
<title>stage2_moe_gate_dp2_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1859.85,-10035.97 1470.35,-10035.97 1370.15,-9931.97 1759.65,-9931.97 1859.85,-10035.97"/>
<text text-anchor="middle" x="1615" y="-9997.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1615" y="-9986.97" font-family="Times,serif" font-size="10.00">GPU 150</text>
<text text-anchor="middle" x="1615" y="-9975.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-9964.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep3_tp0&#45;&gt;stage2_moe_gate_dp2_ep3_tp0 -->
<g id="edge697" class="edge">
<title>stage2_mha_dp2_ep3_tp0&#45;&gt;stage2_moe_gate_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M1615,-10112.71C1615,-10094.6 1615,-10069.39 1615,-10046.15"/>
<polygon fill="black" stroke="black" points="1618.5,-10045.99 1615,-10035.99 1611.5,-10045.99 1618.5,-10045.99"/>
</g>
<!-- stage2_expert1_dp2_ep3_tp0 -->
<g id="node607" class="node">
<title>stage2_expert1_dp2_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1606.5,-9868.97 1371.5,-9868.97 1371.5,-9816.97 1606.5,-9816.97 1606.5,-9868.97"/>
<text text-anchor="middle" x="1489" y="-9856.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1489" y="-9845.97" font-family="Times,serif" font-size="10.00">GPU 150</text>
<text text-anchor="middle" x="1489" y="-9834.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1489" y="-9823.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep3_tp0&#45;&gt;stage2_expert1_dp2_ep3_tp0 -->
<g id="edge698" class="edge">
<title>stage2_moe_gate_dp2_ep3_tp0&#45;&gt;stage2_expert1_dp2_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1568.44,-9931.61C1551.81,-9913.27 1533.54,-9893.11 1518.72,-9876.76"/>
<polygon fill="black" stroke="black" points="1521.05,-9874.12 1511.74,-9869.06 1515.87,-9878.82 1521.05,-9874.12"/>
</g>
<!-- stage2_expert2_dp2_ep3_tp0 -->
<g id="node608" class="node">
<title>stage2_expert2_dp2_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1859.5,-9868.97 1624.5,-9868.97 1624.5,-9816.97 1859.5,-9816.97 1859.5,-9868.97"/>
<text text-anchor="middle" x="1742" y="-9856.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1742" y="-9845.97" font-family="Times,serif" font-size="10.00">GPU 150</text>
<text text-anchor="middle" x="1742" y="-9834.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1742" y="-9823.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep3_tp0&#45;&gt;stage2_expert2_dp2_ep3_tp0 -->
<g id="edge699" class="edge">
<title>stage2_moe_gate_dp2_ep3_tp0&#45;&gt;stage2_expert2_dp2_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1661.93,-9931.61C1678.69,-9913.27 1697.1,-9893.11 1712.04,-9876.76"/>
<polygon fill="black" stroke="black" points="1714.92,-9878.81 1719.08,-9869.06 1709.75,-9874.08 1714.92,-9878.81"/>
</g>
<!-- stage2_expert_agg_dp2_ep3_tp0 -->
<g id="node609" class="node">
<title>stage2_expert_agg_dp2_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1856.33,-9753.97 1478.79,-9753.97 1381.67,-9649.97 1759.21,-9649.97 1856.33,-9753.97"/>
<text text-anchor="middle" x="1619" y="-9715.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1619" y="-9704.97" font-family="Times,serif" font-size="10.00">GPU 150</text>
<text text-anchor="middle" x="1619" y="-9693.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1619" y="-9682.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep3_tp0&#45;&gt;stage2_expert_agg_dp2_ep3_tp0 -->
<g id="edge700" class="edge">
<title>stage2_expert1_dp2_ep3_tp0&#45;&gt;stage2_expert_agg_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M1512.54,-9816.8C1527.01,-9801.33 1546.18,-9780.83 1564.27,-9761.5"/>
<polygon fill="black" stroke="black" points="1566.86,-9763.85 1571.13,-9754.16 1561.74,-9759.07 1566.86,-9763.85"/>
</g>
<!-- stage2_expert2_dp2_ep3_tp0&#45;&gt;stage2_expert_agg_dp2_ep3_tp0 -->
<g id="edge701" class="edge">
<title>stage2_expert2_dp2_ep3_tp0&#45;&gt;stage2_expert_agg_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M1719.73,-9816.8C1706.1,-9801.4 1688.06,-9781.01 1671.01,-9761.75"/>
<polygon fill="black" stroke="black" points="1673.54,-9759.33 1664.29,-9754.16 1668.3,-9763.96 1673.54,-9759.33"/>
</g>
<!-- stage2_ln2_dp2_ep3_tp0 -->
<g id="node610" class="node">
<title>stage2_ln2_dp2_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1733.5,-9591.97 1504.5,-9591.97 1504.5,-9539.97 1733.5,-9539.97 1733.5,-9591.97"/>
<text text-anchor="middle" x="1619" y="-9579.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1619" y="-9568.97" font-family="Times,serif" font-size="10.00">GPU 150</text>
<text text-anchor="middle" x="1619" y="-9557.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1619" y="-9546.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep3_tp0&#45;&gt;stage2_ln2_dp2_ep3_tp0 -->
<g id="edge702" class="edge">
<title>stage2_expert_agg_dp2_ep3_tp0&#45;&gt;stage2_ln2_dp2_ep3_tp0</title>
<path fill="none" stroke="black" d="M1619,-9649.93C1619,-9633.98 1619,-9616.75 1619,-9602.15"/>
<polygon fill="black" stroke="black" points="1622.5,-9602.03 1619,-9592.03 1615.5,-9602.03 1622.5,-9602.03"/>
</g>
<!-- stage2_ln1_dp2_ep4_tp0 -->
<g id="node618" class="node">
<title>stage2_ln1_dp2_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1733.5,-9481.97 1504.5,-9481.97 1504.5,-9429.97 1733.5,-9429.97 1733.5,-9481.97"/>
<text text-anchor="middle" x="1619" y="-9469.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1619" y="-9458.97" font-family="Times,serif" font-size="10.00">GPU 152</text>
<text text-anchor="middle" x="1619" y="-9447.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1619" y="-9436.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep3_tp0&#45;&gt;stage2_ln1_dp2_ep4_tp0 -->
<g id="edge703" class="edge">
<title>stage2_ln2_dp2_ep3_tp0&#45;&gt;stage2_ln1_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M1619,-9539.93C1619,-9525.85 1619,-9508.05 1619,-9492.55"/>
<polygon fill="black" stroke="black" points="1622.5,-9492.26 1619,-9482.26 1615.5,-9492.26 1622.5,-9492.26"/>
</g>
<!-- stage2_mha_dp2_ep3_tp1 -->
<g id="node612" class="node">
<title>stage2_mha_dp2_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-10164.97 2007.5,-10164.97 2007.5,-10112.97 2236.5,-10112.97 2236.5,-10164.97"/>
<text text-anchor="middle" x="2122" y="-10152.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2122" y="-10141.97" font-family="Times,serif" font-size="10.00">GPU 151</text>
<text text-anchor="middle" x="2122" y="-10130.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-10119.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep3_tp1&#45;&gt;stage2_mha_dp2_ep3_tp1 -->
<g id="edge704" class="edge">
<title>stage2_ln1_dp2_ep3_tp1&#45;&gt;stage2_mha_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M2122,-10227.9C2122,-10212.39 2122,-10192.25 2122,-10175.16"/>
<polygon fill="black" stroke="black" points="2125.5,-10174.98 2122,-10164.98 2118.5,-10174.98 2125.5,-10174.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep3_tp1 -->
<g id="node613" class="node">
<title>stage2_moe_gate_dp2_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2366.85,-10035.97 1977.35,-10035.97 1877.15,-9931.97 2266.65,-9931.97 2366.85,-10035.97"/>
<text text-anchor="middle" x="2122" y="-9997.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2122" y="-9986.97" font-family="Times,serif" font-size="10.00">GPU 151</text>
<text text-anchor="middle" x="2122" y="-9975.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-9964.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep3_tp1&#45;&gt;stage2_moe_gate_dp2_ep3_tp1 -->
<g id="edge705" class="edge">
<title>stage2_mha_dp2_ep3_tp1&#45;&gt;stage2_moe_gate_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M2122,-10112.71C2122,-10094.6 2122,-10069.39 2122,-10046.15"/>
<polygon fill="black" stroke="black" points="2125.5,-10045.99 2122,-10035.99 2118.5,-10045.99 2125.5,-10045.99"/>
</g>
<!-- stage2_expert1_dp2_ep3_tp1 -->
<g id="node614" class="node">
<title>stage2_expert1_dp2_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2112.5,-9868.97 1877.5,-9868.97 1877.5,-9816.97 2112.5,-9816.97 2112.5,-9868.97"/>
<text text-anchor="middle" x="1995" y="-9856.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1995" y="-9845.97" font-family="Times,serif" font-size="10.00">GPU 151</text>
<text text-anchor="middle" x="1995" y="-9834.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1995" y="-9823.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep3_tp1&#45;&gt;stage2_expert1_dp2_ep3_tp1 -->
<g id="edge706" class="edge">
<title>stage2_moe_gate_dp2_ep3_tp1&#45;&gt;stage2_expert1_dp2_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2075.07,-9931.61C2058.31,-9913.27 2039.9,-9893.11 2024.96,-9876.76"/>
<polygon fill="black" stroke="black" points="2027.25,-9874.08 2017.92,-9869.06 2022.08,-9878.81 2027.25,-9874.08"/>
</g>
<!-- stage2_expert2_dp2_ep3_tp1 -->
<g id="node615" class="node">
<title>stage2_expert2_dp2_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2365.5,-9868.97 2130.5,-9868.97 2130.5,-9816.97 2365.5,-9816.97 2365.5,-9868.97"/>
<text text-anchor="middle" x="2248" y="-9856.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2248" y="-9845.97" font-family="Times,serif" font-size="10.00">GPU 151</text>
<text text-anchor="middle" x="2248" y="-9834.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2248" y="-9823.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep3_tp1&#45;&gt;stage2_expert2_dp2_ep3_tp1 -->
<g id="edge707" class="edge">
<title>stage2_moe_gate_dp2_ep3_tp1&#45;&gt;stage2_expert2_dp2_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2168.56,-9931.61C2185.19,-9913.27 2203.46,-9893.11 2218.28,-9876.76"/>
<polygon fill="black" stroke="black" points="2221.13,-9878.82 2225.26,-9869.06 2215.95,-9874.12 2221.13,-9878.82"/>
</g>
<!-- stage2_expert_agg_dp2_ep3_tp1 -->
<g id="node616" class="node">
<title>stage2_expert_agg_dp2_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2363.33,-9753.97 1985.79,-9753.97 1888.67,-9649.97 2266.21,-9649.97 2363.33,-9753.97"/>
<text text-anchor="middle" x="2126" y="-9715.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2126" y="-9704.97" font-family="Times,serif" font-size="10.00">GPU 151</text>
<text text-anchor="middle" x="2126" y="-9693.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2126" y="-9682.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep3_tp1&#45;&gt;stage2_expert_agg_dp2_ep3_tp1 -->
<g id="edge708" class="edge">
<title>stage2_expert1_dp2_ep3_tp1&#45;&gt;stage2_expert_agg_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M2018.72,-9816.8C2033.3,-9801.33 2052.62,-9780.83 2070.84,-9761.5"/>
<polygon fill="black" stroke="black" points="2073.45,-9763.83 2077.76,-9754.16 2068.36,-9759.03 2073.45,-9763.83"/>
</g>
<!-- stage2_expert2_dp2_ep3_tp1&#45;&gt;stage2_expert_agg_dp2_ep3_tp1 -->
<g id="edge709" class="edge">
<title>stage2_expert2_dp2_ep3_tp1&#45;&gt;stage2_expert_agg_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M2225.91,-9816.8C2212.39,-9801.4 2194.5,-9781.01 2177.59,-9761.75"/>
<polygon fill="black" stroke="black" points="2180.15,-9759.36 2170.92,-9754.16 2174.89,-9763.98 2180.15,-9759.36"/>
</g>
<!-- stage2_ln2_dp2_ep3_tp1 -->
<g id="node617" class="node">
<title>stage2_ln2_dp2_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2240.5,-9591.97 2011.5,-9591.97 2011.5,-9539.97 2240.5,-9539.97 2240.5,-9591.97"/>
<text text-anchor="middle" x="2126" y="-9579.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2126" y="-9568.97" font-family="Times,serif" font-size="10.00">GPU 151</text>
<text text-anchor="middle" x="2126" y="-9557.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2126" y="-9546.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep3_tp1&#45;&gt;stage2_ln2_dp2_ep3_tp1 -->
<g id="edge710" class="edge">
<title>stage2_expert_agg_dp2_ep3_tp1&#45;&gt;stage2_ln2_dp2_ep3_tp1</title>
<path fill="none" stroke="black" d="M2126,-9649.93C2126,-9633.98 2126,-9616.75 2126,-9602.15"/>
<polygon fill="black" stroke="black" points="2129.5,-9602.03 2126,-9592.03 2122.5,-9602.03 2129.5,-9602.03"/>
</g>
<!-- stage2_ln1_dp2_ep4_tp1 -->
<g id="node625" class="node">
<title>stage2_ln1_dp2_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2240.5,-9481.97 2011.5,-9481.97 2011.5,-9429.97 2240.5,-9429.97 2240.5,-9481.97"/>
<text text-anchor="middle" x="2126" y="-9469.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2126" y="-9458.97" font-family="Times,serif" font-size="10.00">GPU 153</text>
<text text-anchor="middle" x="2126" y="-9447.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2126" y="-9436.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep3_tp1&#45;&gt;stage2_ln1_dp2_ep4_tp1 -->
<g id="edge711" class="edge">
<title>stage2_ln2_dp2_ep3_tp1&#45;&gt;stage2_ln1_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M2126,-9539.93C2126,-9525.85 2126,-9508.05 2126,-9492.55"/>
<polygon fill="black" stroke="black" points="2129.5,-9492.26 2126,-9482.26 2122.5,-9492.26 2129.5,-9492.26"/>
</g>
<!-- stage2_mha_dp2_ep4_tp0 -->
<g id="node619" class="node">
<title>stage2_mha_dp2_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1733.5,-9366.97 1504.5,-9366.97 1504.5,-9314.97 1733.5,-9314.97 1733.5,-9366.97"/>
<text text-anchor="middle" x="1619" y="-9354.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1619" y="-9343.97" font-family="Times,serif" font-size="10.00">GPU 152</text>
<text text-anchor="middle" x="1619" y="-9332.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1619" y="-9321.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep4_tp0&#45;&gt;stage2_mha_dp2_ep4_tp0 -->
<g id="edge712" class="edge">
<title>stage2_ln1_dp2_ep4_tp0&#45;&gt;stage2_mha_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M1619,-9429.9C1619,-9414.39 1619,-9394.25 1619,-9377.16"/>
<polygon fill="black" stroke="black" points="1622.5,-9376.98 1619,-9366.98 1615.5,-9376.98 1622.5,-9376.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep4_tp0 -->
<g id="node620" class="node">
<title>stage2_moe_gate_dp2_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1863.85,-9237.97 1474.35,-9237.97 1374.15,-9133.97 1763.65,-9133.97 1863.85,-9237.97"/>
<text text-anchor="middle" x="1619" y="-9199.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1619" y="-9188.97" font-family="Times,serif" font-size="10.00">GPU 152</text>
<text text-anchor="middle" x="1619" y="-9177.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1619" y="-9166.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep4_tp0&#45;&gt;stage2_moe_gate_dp2_ep4_tp0 -->
<g id="edge713" class="edge">
<title>stage2_mha_dp2_ep4_tp0&#45;&gt;stage2_moe_gate_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M1619,-9314.71C1619,-9296.6 1619,-9271.39 1619,-9248.15"/>
<polygon fill="black" stroke="black" points="1622.5,-9247.99 1619,-9237.99 1615.5,-9247.99 1622.5,-9247.99"/>
</g>
<!-- stage2_expert1_dp2_ep4_tp0 -->
<g id="node621" class="node">
<title>stage2_expert1_dp2_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1610.5,-9070.97 1375.5,-9070.97 1375.5,-9018.97 1610.5,-9018.97 1610.5,-9070.97"/>
<text text-anchor="middle" x="1493" y="-9058.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1493" y="-9047.97" font-family="Times,serif" font-size="10.00">GPU 152</text>
<text text-anchor="middle" x="1493" y="-9036.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1493" y="-9025.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep4_tp0&#45;&gt;stage2_expert1_dp2_ep4_tp0 -->
<g id="edge714" class="edge">
<title>stage2_moe_gate_dp2_ep4_tp0&#45;&gt;stage2_expert1_dp2_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1572.44,-9133.61C1555.81,-9115.27 1537.54,-9095.11 1522.72,-9078.76"/>
<polygon fill="black" stroke="black" points="1525.05,-9076.12 1515.74,-9071.06 1519.87,-9080.82 1525.05,-9076.12"/>
</g>
<!-- stage2_expert2_dp2_ep4_tp0 -->
<g id="node622" class="node">
<title>stage2_expert2_dp2_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1863.5,-9070.97 1628.5,-9070.97 1628.5,-9018.97 1863.5,-9018.97 1863.5,-9070.97"/>
<text text-anchor="middle" x="1746" y="-9058.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1746" y="-9047.97" font-family="Times,serif" font-size="10.00">GPU 152</text>
<text text-anchor="middle" x="1746" y="-9036.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1746" y="-9025.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep4_tp0&#45;&gt;stage2_expert2_dp2_ep4_tp0 -->
<g id="edge715" class="edge">
<title>stage2_moe_gate_dp2_ep4_tp0&#45;&gt;stage2_expert2_dp2_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1665.93,-9133.61C1682.69,-9115.27 1701.1,-9095.11 1716.04,-9078.76"/>
<polygon fill="black" stroke="black" points="1718.92,-9080.81 1723.08,-9071.06 1713.75,-9076.08 1718.92,-9080.81"/>
</g>
<!-- stage2_expert_agg_dp2_ep4_tp0 -->
<g id="node623" class="node">
<title>stage2_expert_agg_dp2_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1852.33,-8955.97 1474.79,-8955.97 1377.67,-8851.97 1755.21,-8851.97 1852.33,-8955.97"/>
<text text-anchor="middle" x="1615" y="-8917.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1615" y="-8906.97" font-family="Times,serif" font-size="10.00">GPU 152</text>
<text text-anchor="middle" x="1615" y="-8895.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1615" y="-8884.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep4_tp0&#45;&gt;stage2_expert_agg_dp2_ep4_tp0 -->
<g id="edge716" class="edge">
<title>stage2_expert1_dp2_ep4_tp0&#45;&gt;stage2_expert_agg_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M1515.09,-9018.8C1528.61,-9003.4 1546.5,-8983.01 1563.41,-8963.75"/>
<polygon fill="black" stroke="black" points="1566.11,-8965.98 1570.08,-8956.16 1560.85,-8961.36 1566.11,-8965.98"/>
</g>
<!-- stage2_expert2_dp2_ep4_tp0&#45;&gt;stage2_expert_agg_dp2_ep4_tp0 -->
<g id="edge717" class="edge">
<title>stage2_expert2_dp2_ep4_tp0&#45;&gt;stage2_expert_agg_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M1722.28,-9018.8C1707.7,-9003.33 1688.38,-8982.83 1670.16,-8963.5"/>
<polygon fill="black" stroke="black" points="1672.64,-8961.03 1663.24,-8956.16 1667.55,-8965.83 1672.64,-8961.03"/>
</g>
<!-- stage2_ln2_dp2_ep4_tp0 -->
<g id="node624" class="node">
<title>stage2_ln2_dp2_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-8793.97 1500.5,-8793.97 1500.5,-8741.97 1729.5,-8741.97 1729.5,-8793.97"/>
<text text-anchor="middle" x="1615" y="-8781.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1615" y="-8770.97" font-family="Times,serif" font-size="10.00">GPU 152</text>
<text text-anchor="middle" x="1615" y="-8759.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-8748.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep4_tp0&#45;&gt;stage2_ln2_dp2_ep4_tp0 -->
<g id="edge718" class="edge">
<title>stage2_expert_agg_dp2_ep4_tp0&#45;&gt;stage2_ln2_dp2_ep4_tp0</title>
<path fill="none" stroke="black" d="M1615,-8851.93C1615,-8835.98 1615,-8818.75 1615,-8804.15"/>
<polygon fill="black" stroke="black" points="1618.5,-8804.03 1615,-8794.03 1611.5,-8804.03 1618.5,-8804.03"/>
</g>
<!-- stage2_ln1_dp2_ep5_tp0 -->
<g id="node632" class="node">
<title>stage2_ln1_dp2_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-8683.97 1500.5,-8683.97 1500.5,-8631.97 1729.5,-8631.97 1729.5,-8683.97"/>
<text text-anchor="middle" x="1615" y="-8671.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1615" y="-8660.97" font-family="Times,serif" font-size="10.00">GPU 154</text>
<text text-anchor="middle" x="1615" y="-8649.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-8638.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep4_tp0&#45;&gt;stage2_ln1_dp2_ep5_tp0 -->
<g id="edge719" class="edge">
<title>stage2_ln2_dp2_ep4_tp0&#45;&gt;stage2_ln1_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M1615,-8741.93C1615,-8727.85 1615,-8710.05 1615,-8694.55"/>
<polygon fill="black" stroke="black" points="1618.5,-8694.26 1615,-8684.26 1611.5,-8694.26 1618.5,-8694.26"/>
</g>
<!-- stage2_mha_dp2_ep4_tp1 -->
<g id="node626" class="node">
<title>stage2_mha_dp2_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2240.5,-9366.97 2011.5,-9366.97 2011.5,-9314.97 2240.5,-9314.97 2240.5,-9366.97"/>
<text text-anchor="middle" x="2126" y="-9354.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2126" y="-9343.97" font-family="Times,serif" font-size="10.00">GPU 153</text>
<text text-anchor="middle" x="2126" y="-9332.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2126" y="-9321.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep4_tp1&#45;&gt;stage2_mha_dp2_ep4_tp1 -->
<g id="edge720" class="edge">
<title>stage2_ln1_dp2_ep4_tp1&#45;&gt;stage2_mha_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M2126,-9429.9C2126,-9414.39 2126,-9394.25 2126,-9377.16"/>
<polygon fill="black" stroke="black" points="2129.5,-9376.98 2126,-9366.98 2122.5,-9376.98 2129.5,-9376.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep4_tp1 -->
<g id="node627" class="node">
<title>stage2_moe_gate_dp2_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2370.85,-9237.97 1981.35,-9237.97 1881.15,-9133.97 2270.65,-9133.97 2370.85,-9237.97"/>
<text text-anchor="middle" x="2126" y="-9199.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2126" y="-9188.97" font-family="Times,serif" font-size="10.00">GPU 153</text>
<text text-anchor="middle" x="2126" y="-9177.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2126" y="-9166.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep4_tp1&#45;&gt;stage2_moe_gate_dp2_ep4_tp1 -->
<g id="edge721" class="edge">
<title>stage2_mha_dp2_ep4_tp1&#45;&gt;stage2_moe_gate_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M2126,-9314.71C2126,-9296.6 2126,-9271.39 2126,-9248.15"/>
<polygon fill="black" stroke="black" points="2129.5,-9247.99 2126,-9237.99 2122.5,-9247.99 2129.5,-9247.99"/>
</g>
<!-- stage2_expert1_dp2_ep4_tp1 -->
<g id="node628" class="node">
<title>stage2_expert1_dp2_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2116.5,-9070.97 1881.5,-9070.97 1881.5,-9018.97 2116.5,-9018.97 2116.5,-9070.97"/>
<text text-anchor="middle" x="1999" y="-9058.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1999" y="-9047.97" font-family="Times,serif" font-size="10.00">GPU 153</text>
<text text-anchor="middle" x="1999" y="-9036.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1999" y="-9025.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep4_tp1&#45;&gt;stage2_expert1_dp2_ep4_tp1 -->
<g id="edge722" class="edge">
<title>stage2_moe_gate_dp2_ep4_tp1&#45;&gt;stage2_expert1_dp2_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2079.07,-9133.61C2062.31,-9115.27 2043.9,-9095.11 2028.96,-9078.76"/>
<polygon fill="black" stroke="black" points="2031.25,-9076.08 2021.92,-9071.06 2026.08,-9080.81 2031.25,-9076.08"/>
</g>
<!-- stage2_expert2_dp2_ep4_tp1 -->
<g id="node629" class="node">
<title>stage2_expert2_dp2_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2369.5,-9070.97 2134.5,-9070.97 2134.5,-9018.97 2369.5,-9018.97 2369.5,-9070.97"/>
<text text-anchor="middle" x="2252" y="-9058.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2252" y="-9047.97" font-family="Times,serif" font-size="10.00">GPU 153</text>
<text text-anchor="middle" x="2252" y="-9036.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2252" y="-9025.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep4_tp1&#45;&gt;stage2_expert2_dp2_ep4_tp1 -->
<g id="edge723" class="edge">
<title>stage2_moe_gate_dp2_ep4_tp1&#45;&gt;stage2_expert2_dp2_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2172.56,-9133.61C2189.19,-9115.27 2207.46,-9095.11 2222.28,-9078.76"/>
<polygon fill="black" stroke="black" points="2225.13,-9080.82 2229.26,-9071.06 2219.95,-9076.12 2225.13,-9080.82"/>
</g>
<!-- stage2_expert_agg_dp2_ep4_tp1 -->
<g id="node630" class="node">
<title>stage2_expert_agg_dp2_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2359.33,-8955.97 1981.79,-8955.97 1884.67,-8851.97 2262.21,-8851.97 2359.33,-8955.97"/>
<text text-anchor="middle" x="2122" y="-8917.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2122" y="-8906.97" font-family="Times,serif" font-size="10.00">GPU 153</text>
<text text-anchor="middle" x="2122" y="-8895.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2122" y="-8884.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep4_tp1&#45;&gt;stage2_expert_agg_dp2_ep4_tp1 -->
<g id="edge724" class="edge">
<title>stage2_expert1_dp2_ep4_tp1&#45;&gt;stage2_expert_agg_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M2021.27,-9018.8C2034.9,-9003.4 2052.94,-8983.01 2069.99,-8963.75"/>
<polygon fill="black" stroke="black" points="2072.7,-8965.96 2076.71,-8956.16 2067.46,-8961.33 2072.7,-8965.96"/>
</g>
<!-- stage2_expert2_dp2_ep4_tp1&#45;&gt;stage2_expert_agg_dp2_ep4_tp1 -->
<g id="edge725" class="edge">
<title>stage2_expert2_dp2_ep4_tp1&#45;&gt;stage2_expert_agg_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M2228.46,-9018.8C2213.99,-9003.33 2194.82,-8982.83 2176.73,-8963.5"/>
<polygon fill="black" stroke="black" points="2179.26,-8961.07 2169.87,-8956.16 2174.14,-8965.85 2179.26,-8961.07"/>
</g>
<!-- stage2_ln2_dp2_ep4_tp1 -->
<g id="node631" class="node">
<title>stage2_ln2_dp2_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-8793.97 2007.5,-8793.97 2007.5,-8741.97 2236.5,-8741.97 2236.5,-8793.97"/>
<text text-anchor="middle" x="2122" y="-8781.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2122" y="-8770.97" font-family="Times,serif" font-size="10.00">GPU 153</text>
<text text-anchor="middle" x="2122" y="-8759.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-8748.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep4_tp1&#45;&gt;stage2_ln2_dp2_ep4_tp1 -->
<g id="edge726" class="edge">
<title>stage2_expert_agg_dp2_ep4_tp1&#45;&gt;stage2_ln2_dp2_ep4_tp1</title>
<path fill="none" stroke="black" d="M2122,-8851.93C2122,-8835.98 2122,-8818.75 2122,-8804.15"/>
<polygon fill="black" stroke="black" points="2125.5,-8804.03 2122,-8794.03 2118.5,-8804.03 2125.5,-8804.03"/>
</g>
<!-- stage2_ln1_dp2_ep5_tp1 -->
<g id="node639" class="node">
<title>stage2_ln1_dp2_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-8683.97 2007.5,-8683.97 2007.5,-8631.97 2236.5,-8631.97 2236.5,-8683.97"/>
<text text-anchor="middle" x="2122" y="-8671.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2122" y="-8660.97" font-family="Times,serif" font-size="10.00">GPU 155</text>
<text text-anchor="middle" x="2122" y="-8649.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-8638.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep4_tp1&#45;&gt;stage2_ln1_dp2_ep5_tp1 -->
<g id="edge727" class="edge">
<title>stage2_ln2_dp2_ep4_tp1&#45;&gt;stage2_ln1_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M2122,-8741.93C2122,-8727.85 2122,-8710.05 2122,-8694.55"/>
<polygon fill="black" stroke="black" points="2125.5,-8694.26 2122,-8684.26 2118.5,-8694.26 2125.5,-8694.26"/>
</g>
<!-- stage2_mha_dp2_ep5_tp0 -->
<g id="node633" class="node">
<title>stage2_mha_dp2_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1729.5,-8568.97 1500.5,-8568.97 1500.5,-8516.97 1729.5,-8516.97 1729.5,-8568.97"/>
<text text-anchor="middle" x="1615" y="-8556.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1615" y="-8545.97" font-family="Times,serif" font-size="10.00">GPU 154</text>
<text text-anchor="middle" x="1615" y="-8534.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-8523.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep5_tp0&#45;&gt;stage2_mha_dp2_ep5_tp0 -->
<g id="edge728" class="edge">
<title>stage2_ln1_dp2_ep5_tp0&#45;&gt;stage2_mha_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M1615,-8631.9C1615,-8616.39 1615,-8596.25 1615,-8579.16"/>
<polygon fill="black" stroke="black" points="1618.5,-8578.98 1615,-8568.98 1611.5,-8578.98 1618.5,-8578.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep5_tp0 -->
<g id="node634" class="node">
<title>stage2_moe_gate_dp2_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1859.85,-8439.97 1470.35,-8439.97 1370.15,-8335.97 1759.65,-8335.97 1859.85,-8439.97"/>
<text text-anchor="middle" x="1615" y="-8401.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1615" y="-8390.97" font-family="Times,serif" font-size="10.00">GPU 154</text>
<text text-anchor="middle" x="1615" y="-8379.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1615" y="-8368.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep5_tp0&#45;&gt;stage2_moe_gate_dp2_ep5_tp0 -->
<g id="edge729" class="edge">
<title>stage2_mha_dp2_ep5_tp0&#45;&gt;stage2_moe_gate_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M1615,-8516.71C1615,-8498.6 1615,-8473.39 1615,-8450.15"/>
<polygon fill="black" stroke="black" points="1618.5,-8449.99 1615,-8439.99 1611.5,-8449.99 1618.5,-8449.99"/>
</g>
<!-- stage2_expert1_dp2_ep5_tp0 -->
<g id="node635" class="node">
<title>stage2_expert1_dp2_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1606.5,-8272.97 1371.5,-8272.97 1371.5,-8220.97 1606.5,-8220.97 1606.5,-8272.97"/>
<text text-anchor="middle" x="1489" y="-8260.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1489" y="-8249.97" font-family="Times,serif" font-size="10.00">GPU 154</text>
<text text-anchor="middle" x="1489" y="-8238.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1489" y="-8227.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep5_tp0&#45;&gt;stage2_expert1_dp2_ep5_tp0 -->
<g id="edge730" class="edge">
<title>stage2_moe_gate_dp2_ep5_tp0&#45;&gt;stage2_expert1_dp2_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1568.44,-8335.61C1551.81,-8317.27 1533.54,-8297.11 1518.72,-8280.76"/>
<polygon fill="black" stroke="black" points="1521.05,-8278.12 1511.74,-8273.06 1515.87,-8282.82 1521.05,-8278.12"/>
</g>
<!-- stage2_expert2_dp2_ep5_tp0 -->
<g id="node636" class="node">
<title>stage2_expert2_dp2_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1859.5,-8272.97 1624.5,-8272.97 1624.5,-8220.97 1859.5,-8220.97 1859.5,-8272.97"/>
<text text-anchor="middle" x="1742" y="-8260.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1742" y="-8249.97" font-family="Times,serif" font-size="10.00">GPU 154</text>
<text text-anchor="middle" x="1742" y="-8238.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1742" y="-8227.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep5_tp0&#45;&gt;stage2_expert2_dp2_ep5_tp0 -->
<g id="edge731" class="edge">
<title>stage2_moe_gate_dp2_ep5_tp0&#45;&gt;stage2_expert2_dp2_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1661.93,-8335.61C1678.69,-8317.27 1697.1,-8297.11 1712.04,-8280.76"/>
<polygon fill="black" stroke="black" points="1714.92,-8282.81 1719.08,-8273.06 1709.75,-8278.08 1714.92,-8282.81"/>
</g>
<!-- stage2_expert_agg_dp2_ep5_tp0 -->
<g id="node637" class="node">
<title>stage2_expert_agg_dp2_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1856.33,-8157.97 1478.79,-8157.97 1381.67,-8053.97 1759.21,-8053.97 1856.33,-8157.97"/>
<text text-anchor="middle" x="1619" y="-8119.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1619" y="-8108.97" font-family="Times,serif" font-size="10.00">GPU 154</text>
<text text-anchor="middle" x="1619" y="-8097.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1619" y="-8086.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep5_tp0&#45;&gt;stage2_expert_agg_dp2_ep5_tp0 -->
<g id="edge732" class="edge">
<title>stage2_expert1_dp2_ep5_tp0&#45;&gt;stage2_expert_agg_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M1512.54,-8220.8C1527.01,-8205.33 1546.18,-8184.83 1564.27,-8165.5"/>
<polygon fill="black" stroke="black" points="1566.86,-8167.85 1571.13,-8158.16 1561.74,-8163.07 1566.86,-8167.85"/>
</g>
<!-- stage2_expert2_dp2_ep5_tp0&#45;&gt;stage2_expert_agg_dp2_ep5_tp0 -->
<g id="edge733" class="edge">
<title>stage2_expert2_dp2_ep5_tp0&#45;&gt;stage2_expert_agg_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M1719.73,-8220.8C1706.1,-8205.4 1688.06,-8185.01 1671.01,-8165.75"/>
<polygon fill="black" stroke="black" points="1673.54,-8163.33 1664.29,-8158.16 1668.3,-8167.96 1673.54,-8163.33"/>
</g>
<!-- stage2_ln2_dp2_ep5_tp0 -->
<g id="node638" class="node">
<title>stage2_ln2_dp2_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1733.5,-7995.97 1504.5,-7995.97 1504.5,-7943.97 1733.5,-7943.97 1733.5,-7995.97"/>
<text text-anchor="middle" x="1619" y="-7983.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1619" y="-7972.97" font-family="Times,serif" font-size="10.00">GPU 154</text>
<text text-anchor="middle" x="1619" y="-7961.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1619" y="-7950.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep5_tp0&#45;&gt;stage2_ln2_dp2_ep5_tp0 -->
<g id="edge734" class="edge">
<title>stage2_expert_agg_dp2_ep5_tp0&#45;&gt;stage2_ln2_dp2_ep5_tp0</title>
<path fill="none" stroke="black" d="M1619,-8053.93C1619,-8037.98 1619,-8020.75 1619,-8006.15"/>
<polygon fill="black" stroke="black" points="1622.5,-8006.03 1619,-7996.03 1615.5,-8006.03 1622.5,-8006.03"/>
</g>
<!-- stage2_ln1_dp2_ep6_tp0 -->
<g id="node646" class="node">
<title>stage2_ln1_dp2_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1733.5,-7885.97 1504.5,-7885.97 1504.5,-7833.97 1733.5,-7833.97 1733.5,-7885.97"/>
<text text-anchor="middle" x="1619" y="-7873.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1619" y="-7862.97" font-family="Times,serif" font-size="10.00">GPU 156</text>
<text text-anchor="middle" x="1619" y="-7851.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1619" y="-7840.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep5_tp0&#45;&gt;stage2_ln1_dp2_ep6_tp0 -->
<g id="edge735" class="edge">
<title>stage2_ln2_dp2_ep5_tp0&#45;&gt;stage2_ln1_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M1619,-7943.93C1619,-7929.85 1619,-7912.05 1619,-7896.55"/>
<polygon fill="black" stroke="black" points="1622.5,-7896.26 1619,-7886.26 1615.5,-7896.26 1622.5,-7896.26"/>
</g>
<!-- stage2_mha_dp2_ep5_tp1 -->
<g id="node640" class="node">
<title>stage2_mha_dp2_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2236.5,-8568.97 2007.5,-8568.97 2007.5,-8516.97 2236.5,-8516.97 2236.5,-8568.97"/>
<text text-anchor="middle" x="2122" y="-8556.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2122" y="-8545.97" font-family="Times,serif" font-size="10.00">GPU 155</text>
<text text-anchor="middle" x="2122" y="-8534.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-8523.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep5_tp1&#45;&gt;stage2_mha_dp2_ep5_tp1 -->
<g id="edge736" class="edge">
<title>stage2_ln1_dp2_ep5_tp1&#45;&gt;stage2_mha_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M2122,-8631.9C2122,-8616.39 2122,-8596.25 2122,-8579.16"/>
<polygon fill="black" stroke="black" points="2125.5,-8578.98 2122,-8568.98 2118.5,-8578.98 2125.5,-8578.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep5_tp1 -->
<g id="node641" class="node">
<title>stage2_moe_gate_dp2_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2366.85,-8439.97 1977.35,-8439.97 1877.15,-8335.97 2266.65,-8335.97 2366.85,-8439.97"/>
<text text-anchor="middle" x="2122" y="-8401.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2122" y="-8390.97" font-family="Times,serif" font-size="10.00">GPU 155</text>
<text text-anchor="middle" x="2122" y="-8379.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-8368.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep5_tp1&#45;&gt;stage2_moe_gate_dp2_ep5_tp1 -->
<g id="edge737" class="edge">
<title>stage2_mha_dp2_ep5_tp1&#45;&gt;stage2_moe_gate_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M2122,-8516.71C2122,-8498.6 2122,-8473.39 2122,-8450.15"/>
<polygon fill="black" stroke="black" points="2125.5,-8449.99 2122,-8439.99 2118.5,-8449.99 2125.5,-8449.99"/>
</g>
<!-- stage2_expert1_dp2_ep5_tp1 -->
<g id="node642" class="node">
<title>stage2_expert1_dp2_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2112.5,-8272.97 1877.5,-8272.97 1877.5,-8220.97 2112.5,-8220.97 2112.5,-8272.97"/>
<text text-anchor="middle" x="1995" y="-8260.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1995" y="-8249.97" font-family="Times,serif" font-size="10.00">GPU 155</text>
<text text-anchor="middle" x="1995" y="-8238.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1995" y="-8227.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep5_tp1&#45;&gt;stage2_expert1_dp2_ep5_tp1 -->
<g id="edge738" class="edge">
<title>stage2_moe_gate_dp2_ep5_tp1&#45;&gt;stage2_expert1_dp2_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2075.07,-8335.61C2058.31,-8317.27 2039.9,-8297.11 2024.96,-8280.76"/>
<polygon fill="black" stroke="black" points="2027.25,-8278.08 2017.92,-8273.06 2022.08,-8282.81 2027.25,-8278.08"/>
</g>
<!-- stage2_expert2_dp2_ep5_tp1 -->
<g id="node643" class="node">
<title>stage2_expert2_dp2_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2365.5,-8272.97 2130.5,-8272.97 2130.5,-8220.97 2365.5,-8220.97 2365.5,-8272.97"/>
<text text-anchor="middle" x="2248" y="-8260.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2248" y="-8249.97" font-family="Times,serif" font-size="10.00">GPU 155</text>
<text text-anchor="middle" x="2248" y="-8238.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2248" y="-8227.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep5_tp1&#45;&gt;stage2_expert2_dp2_ep5_tp1 -->
<g id="edge739" class="edge">
<title>stage2_moe_gate_dp2_ep5_tp1&#45;&gt;stage2_expert2_dp2_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2168.56,-8335.61C2185.19,-8317.27 2203.46,-8297.11 2218.28,-8280.76"/>
<polygon fill="black" stroke="black" points="2221.13,-8282.82 2225.26,-8273.06 2215.95,-8278.12 2221.13,-8282.82"/>
</g>
<!-- stage2_expert_agg_dp2_ep5_tp1 -->
<g id="node644" class="node">
<title>stage2_expert_agg_dp2_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2363.33,-8157.97 1985.79,-8157.97 1888.67,-8053.97 2266.21,-8053.97 2363.33,-8157.97"/>
<text text-anchor="middle" x="2126" y="-8119.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2126" y="-8108.97" font-family="Times,serif" font-size="10.00">GPU 155</text>
<text text-anchor="middle" x="2126" y="-8097.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2126" y="-8086.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep5_tp1&#45;&gt;stage2_expert_agg_dp2_ep5_tp1 -->
<g id="edge740" class="edge">
<title>stage2_expert1_dp2_ep5_tp1&#45;&gt;stage2_expert_agg_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M2018.72,-8220.8C2033.3,-8205.33 2052.62,-8184.83 2070.84,-8165.5"/>
<polygon fill="black" stroke="black" points="2073.45,-8167.83 2077.76,-8158.16 2068.36,-8163.03 2073.45,-8167.83"/>
</g>
<!-- stage2_expert2_dp2_ep5_tp1&#45;&gt;stage2_expert_agg_dp2_ep5_tp1 -->
<g id="edge741" class="edge">
<title>stage2_expert2_dp2_ep5_tp1&#45;&gt;stage2_expert_agg_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M2225.91,-8220.8C2212.39,-8205.4 2194.5,-8185.01 2177.59,-8165.75"/>
<polygon fill="black" stroke="black" points="2180.15,-8163.36 2170.92,-8158.16 2174.89,-8167.98 2180.15,-8163.36"/>
</g>
<!-- stage2_ln2_dp2_ep5_tp1 -->
<g id="node645" class="node">
<title>stage2_ln2_dp2_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2240.5,-7995.97 2011.5,-7995.97 2011.5,-7943.97 2240.5,-7943.97 2240.5,-7995.97"/>
<text text-anchor="middle" x="2126" y="-7983.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2126" y="-7972.97" font-family="Times,serif" font-size="10.00">GPU 155</text>
<text text-anchor="middle" x="2126" y="-7961.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2126" y="-7950.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep5_tp1&#45;&gt;stage2_ln2_dp2_ep5_tp1 -->
<g id="edge742" class="edge">
<title>stage2_expert_agg_dp2_ep5_tp1&#45;&gt;stage2_ln2_dp2_ep5_tp1</title>
<path fill="none" stroke="black" d="M2126,-8053.93C2126,-8037.98 2126,-8020.75 2126,-8006.15"/>
<polygon fill="black" stroke="black" points="2129.5,-8006.03 2126,-7996.03 2122.5,-8006.03 2129.5,-8006.03"/>
</g>
<!-- stage2_ln1_dp2_ep6_tp1 -->
<g id="node653" class="node">
<title>stage2_ln1_dp2_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2240.5,-7885.97 2011.5,-7885.97 2011.5,-7833.97 2240.5,-7833.97 2240.5,-7885.97"/>
<text text-anchor="middle" x="2126" y="-7873.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2126" y="-7862.97" font-family="Times,serif" font-size="10.00">GPU 157</text>
<text text-anchor="middle" x="2126" y="-7851.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2126" y="-7840.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep5_tp1&#45;&gt;stage2_ln1_dp2_ep6_tp1 -->
<g id="edge743" class="edge">
<title>stage2_ln2_dp2_ep5_tp1&#45;&gt;stage2_ln1_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M2126,-7943.93C2126,-7929.85 2126,-7912.05 2126,-7896.55"/>
<polygon fill="black" stroke="black" points="2129.5,-7896.26 2126,-7886.26 2122.5,-7896.26 2129.5,-7896.26"/>
</g>
<!-- stage2_mha_dp2_ep6_tp0 -->
<g id="node647" class="node">
<title>stage2_mha_dp2_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1733.5,-7770.97 1504.5,-7770.97 1504.5,-7718.97 1733.5,-7718.97 1733.5,-7770.97"/>
<text text-anchor="middle" x="1619" y="-7758.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1619" y="-7747.97" font-family="Times,serif" font-size="10.00">GPU 156</text>
<text text-anchor="middle" x="1619" y="-7736.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1619" y="-7725.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep6_tp0&#45;&gt;stage2_mha_dp2_ep6_tp0 -->
<g id="edge744" class="edge">
<title>stage2_ln1_dp2_ep6_tp0&#45;&gt;stage2_mha_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M1619,-7833.9C1619,-7818.39 1619,-7798.25 1619,-7781.16"/>
<polygon fill="black" stroke="black" points="1622.5,-7780.98 1619,-7770.98 1615.5,-7780.98 1622.5,-7780.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep6_tp0 -->
<g id="node648" class="node">
<title>stage2_moe_gate_dp2_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1863.85,-7641.97 1474.35,-7641.97 1374.15,-7537.97 1763.65,-7537.97 1863.85,-7641.97"/>
<text text-anchor="middle" x="1619" y="-7603.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1619" y="-7592.97" font-family="Times,serif" font-size="10.00">GPU 156</text>
<text text-anchor="middle" x="1619" y="-7581.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1619" y="-7570.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep6_tp0&#45;&gt;stage2_moe_gate_dp2_ep6_tp0 -->
<g id="edge745" class="edge">
<title>stage2_mha_dp2_ep6_tp0&#45;&gt;stage2_moe_gate_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M1619,-7718.71C1619,-7700.6 1619,-7675.39 1619,-7652.15"/>
<polygon fill="black" stroke="black" points="1622.5,-7651.99 1619,-7641.99 1615.5,-7651.99 1622.5,-7651.99"/>
</g>
<!-- stage2_expert1_dp2_ep6_tp0 -->
<g id="node649" class="node">
<title>stage2_expert1_dp2_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1610.5,-7474.97 1375.5,-7474.97 1375.5,-7422.97 1610.5,-7422.97 1610.5,-7474.97"/>
<text text-anchor="middle" x="1493" y="-7462.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1493" y="-7451.97" font-family="Times,serif" font-size="10.00">GPU 156</text>
<text text-anchor="middle" x="1493" y="-7440.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1493" y="-7429.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep6_tp0&#45;&gt;stage2_expert1_dp2_ep6_tp0 -->
<g id="edge746" class="edge">
<title>stage2_moe_gate_dp2_ep6_tp0&#45;&gt;stage2_expert1_dp2_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1572.44,-7537.61C1555.81,-7519.27 1537.54,-7499.11 1522.72,-7482.76"/>
<polygon fill="black" stroke="black" points="1525.05,-7480.12 1515.74,-7475.06 1519.87,-7484.82 1525.05,-7480.12"/>
</g>
<!-- stage2_expert2_dp2_ep6_tp0 -->
<g id="node650" class="node">
<title>stage2_expert2_dp2_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1863.5,-7474.97 1628.5,-7474.97 1628.5,-7422.97 1863.5,-7422.97 1863.5,-7474.97"/>
<text text-anchor="middle" x="1746" y="-7462.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="1746" y="-7451.97" font-family="Times,serif" font-size="10.00">GPU 156</text>
<text text-anchor="middle" x="1746" y="-7440.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1746" y="-7429.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep6_tp0&#45;&gt;stage2_expert2_dp2_ep6_tp0 -->
<g id="edge747" class="edge">
<title>stage2_moe_gate_dp2_ep6_tp0&#45;&gt;stage2_expert2_dp2_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1665.93,-7537.61C1682.69,-7519.27 1701.1,-7499.11 1716.04,-7482.76"/>
<polygon fill="black" stroke="black" points="1718.92,-7484.81 1723.08,-7475.06 1713.75,-7480.08 1718.92,-7484.81"/>
</g>
<!-- stage2_expert_agg_dp2_ep6_tp0 -->
<g id="node651" class="node">
<title>stage2_expert_agg_dp2_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="1878.33,-7359.97 1500.79,-7359.97 1403.67,-7255.97 1781.21,-7255.97 1878.33,-7359.97"/>
<text text-anchor="middle" x="1641" y="-7321.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1641" y="-7310.97" font-family="Times,serif" font-size="10.00">GPU 156</text>
<text text-anchor="middle" x="1641" y="-7299.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1641" y="-7288.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep6_tp0&#45;&gt;stage2_expert_agg_dp2_ep6_tp0 -->
<g id="edge748" class="edge">
<title>stage2_expert1_dp2_ep6_tp0&#45;&gt;stage2_expert_agg_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M1519.8,-7422.8C1536.35,-7407.26 1558.29,-7386.65 1578.96,-7367.24"/>
<polygon fill="black" stroke="black" points="1581.61,-7369.55 1586.5,-7360.16 1576.82,-7364.45 1581.61,-7369.55"/>
</g>
<!-- stage2_expert2_dp2_ep6_tp0&#45;&gt;stage2_expert_agg_dp2_ep6_tp0 -->
<g id="edge749" class="edge">
<title>stage2_expert2_dp2_ep6_tp0&#45;&gt;stage2_expert_agg_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M1726.99,-7422.8C1715.45,-7407.54 1700.22,-7387.37 1685.79,-7368.26"/>
<polygon fill="black" stroke="black" points="1688.48,-7366.03 1679.66,-7360.16 1682.9,-7370.25 1688.48,-7366.03"/>
</g>
<!-- stage2_ln2_dp2_ep6_tp0 -->
<g id="node652" class="node">
<title>stage2_ln2_dp2_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1969.5,-7197.97 1740.5,-7197.97 1740.5,-7145.97 1969.5,-7145.97 1969.5,-7197.97"/>
<text text-anchor="middle" x="1855" y="-7185.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1855" y="-7174.97" font-family="Times,serif" font-size="10.00">GPU 156</text>
<text text-anchor="middle" x="1855" y="-7163.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1855" y="-7152.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep6_tp0&#45;&gt;stage2_ln2_dp2_ep6_tp0 -->
<g id="edge750" class="edge">
<title>stage2_expert_agg_dp2_ep6_tp0&#45;&gt;stage2_ln2_dp2_ep6_tp0</title>
<path fill="none" stroke="black" d="M1722.51,-7255.93C1750.83,-7238.2 1781.68,-7218.89 1806.47,-7203.36"/>
<polygon fill="black" stroke="black" points="1808.36,-7206.31 1814.98,-7198.03 1804.65,-7200.37 1808.36,-7206.31"/>
</g>
<!-- stage2_ln1_dp2_ep7_tp0 -->
<g id="node660" class="node">
<title>stage2_ln1_dp2_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2107.5,-7084.98 1878.5,-7084.98 1878.5,-7032.98 2107.5,-7032.98 2107.5,-7084.98"/>
<text text-anchor="middle" x="1993" y="-7072.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1993" y="-7061.98" font-family="Times,serif" font-size="10.00">GPU 158</text>
<text text-anchor="middle" x="1993" y="-7050.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1993" y="-7039.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep6_tp0&#45;&gt;stage2_ln1_dp2_ep7_tp0 -->
<g id="edge751" class="edge">
<title>stage2_ln2_dp2_ep6_tp0&#45;&gt;stage2_ln1_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M1886.31,-7145.79C1906.34,-7129.68 1932.48,-7108.66 1953.87,-7091.46"/>
<polygon fill="black" stroke="black" points="1956.21,-7094.06 1961.81,-7085.07 1951.82,-7088.61 1956.21,-7094.06"/>
</g>
<!-- stage2_mha_dp2_ep6_tp1 -->
<g id="node654" class="node">
<title>stage2_mha_dp2_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2240.5,-7770.97 2011.5,-7770.97 2011.5,-7718.97 2240.5,-7718.97 2240.5,-7770.97"/>
<text text-anchor="middle" x="2126" y="-7758.97" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2126" y="-7747.97" font-family="Times,serif" font-size="10.00">GPU 157</text>
<text text-anchor="middle" x="2126" y="-7736.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2126" y="-7725.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep6_tp1&#45;&gt;stage2_mha_dp2_ep6_tp1 -->
<g id="edge752" class="edge">
<title>stage2_ln1_dp2_ep6_tp1&#45;&gt;stage2_mha_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M2126,-7833.9C2126,-7818.39 2126,-7798.25 2126,-7781.16"/>
<polygon fill="black" stroke="black" points="2129.5,-7780.98 2126,-7770.98 2122.5,-7780.98 2129.5,-7780.98"/>
</g>
<!-- stage2_moe_gate_dp2_ep6_tp1 -->
<g id="node655" class="node">
<title>stage2_moe_gate_dp2_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2370.85,-7641.97 1981.35,-7641.97 1881.15,-7537.97 2270.65,-7537.97 2370.85,-7641.97"/>
<text text-anchor="middle" x="2126" y="-7603.97" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2126" y="-7592.97" font-family="Times,serif" font-size="10.00">GPU 157</text>
<text text-anchor="middle" x="2126" y="-7581.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2126" y="-7570.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep6_tp1&#45;&gt;stage2_moe_gate_dp2_ep6_tp1 -->
<g id="edge753" class="edge">
<title>stage2_mha_dp2_ep6_tp1&#45;&gt;stage2_moe_gate_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M2126,-7718.71C2126,-7700.6 2126,-7675.39 2126,-7652.15"/>
<polygon fill="black" stroke="black" points="2129.5,-7651.99 2126,-7641.99 2122.5,-7651.99 2129.5,-7651.99"/>
</g>
<!-- stage2_expert1_dp2_ep6_tp1 -->
<g id="node656" class="node">
<title>stage2_expert1_dp2_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2116.5,-7474.97 1881.5,-7474.97 1881.5,-7422.97 2116.5,-7422.97 2116.5,-7474.97"/>
<text text-anchor="middle" x="1999" y="-7462.97" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1999" y="-7451.97" font-family="Times,serif" font-size="10.00">GPU 157</text>
<text text-anchor="middle" x="1999" y="-7440.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1999" y="-7429.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep6_tp1&#45;&gt;stage2_expert1_dp2_ep6_tp1 -->
<g id="edge754" class="edge">
<title>stage2_moe_gate_dp2_ep6_tp1&#45;&gt;stage2_expert1_dp2_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2079.07,-7537.61C2062.31,-7519.27 2043.9,-7499.11 2028.96,-7482.76"/>
<polygon fill="black" stroke="black" points="2031.25,-7480.08 2021.92,-7475.06 2026.08,-7484.81 2031.25,-7480.08"/>
</g>
<!-- stage2_expert2_dp2_ep6_tp1 -->
<g id="node657" class="node">
<title>stage2_expert2_dp2_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2369.5,-7474.97 2134.5,-7474.97 2134.5,-7422.97 2369.5,-7422.97 2369.5,-7474.97"/>
<text text-anchor="middle" x="2252" y="-7462.97" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2252" y="-7451.97" font-family="Times,serif" font-size="10.00">GPU 157</text>
<text text-anchor="middle" x="2252" y="-7440.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2252" y="-7429.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep6_tp1&#45;&gt;stage2_expert2_dp2_ep6_tp1 -->
<g id="edge755" class="edge">
<title>stage2_moe_gate_dp2_ep6_tp1&#45;&gt;stage2_expert2_dp2_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2172.56,-7537.61C2189.19,-7519.27 2207.46,-7499.11 2222.28,-7482.76"/>
<polygon fill="black" stroke="black" points="2225.13,-7484.82 2229.26,-7475.06 2219.95,-7480.12 2225.13,-7484.82"/>
</g>
<!-- stage2_expert_agg_dp2_ep6_tp1 -->
<g id="node658" class="node">
<title>stage2_expert_agg_dp2_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2371.33,-7359.97 1993.79,-7359.97 1896.67,-7255.97 2274.21,-7255.97 2371.33,-7359.97"/>
<text text-anchor="middle" x="2134" y="-7321.97" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2134" y="-7310.97" font-family="Times,serif" font-size="10.00">GPU 157</text>
<text text-anchor="middle" x="2134" y="-7299.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2134" y="-7288.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep6_tp1&#45;&gt;stage2_expert_agg_dp2_ep6_tp1 -->
<g id="edge756" class="edge">
<title>stage2_expert1_dp2_ep6_tp1&#45;&gt;stage2_expert_agg_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M2023.45,-7422.8C2038.47,-7407.33 2058.38,-7386.83 2077.16,-7367.5"/>
<polygon fill="black" stroke="black" points="2079.83,-7369.77 2084.29,-7360.16 2074.81,-7364.89 2079.83,-7369.77"/>
</g>
<!-- stage2_expert2_dp2_ep6_tp1&#45;&gt;stage2_expert_agg_dp2_ep6_tp1 -->
<g id="edge757" class="edge">
<title>stage2_expert2_dp2_ep6_tp1&#45;&gt;stage2_expert_agg_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M2230.63,-7422.8C2217.61,-7407.47 2200.4,-7387.19 2184.12,-7368.01"/>
<polygon fill="black" stroke="black" points="2186.59,-7365.51 2177.45,-7360.16 2181.25,-7370.05 2186.59,-7365.51"/>
</g>
<!-- stage2_ln2_dp2_ep6_tp1 -->
<g id="node659" class="node">
<title>stage2_ln2_dp2_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2339.5,-7197.97 2110.5,-7197.97 2110.5,-7145.97 2339.5,-7145.97 2339.5,-7197.97"/>
<text text-anchor="middle" x="2225" y="-7185.97" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2225" y="-7174.97" font-family="Times,serif" font-size="10.00">GPU 157</text>
<text text-anchor="middle" x="2225" y="-7163.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2225" y="-7152.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep6_tp1&#45;&gt;stage2_ln2_dp2_ep6_tp1 -->
<g id="edge758" class="edge">
<title>stage2_expert_agg_dp2_ep6_tp1&#45;&gt;stage2_ln2_dp2_ep6_tp1</title>
<path fill="none" stroke="black" d="M2168.66,-7255.93C2179.92,-7239.36 2192.11,-7221.41 2202.26,-7206.46"/>
<polygon fill="black" stroke="black" points="2205.26,-7208.27 2207.98,-7198.03 2199.47,-7204.34 2205.26,-7208.27"/>
</g>
<!-- stage2_ln1_dp2_ep7_tp1 -->
<g id="node667" class="node">
<title>stage2_ln1_dp2_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2614.5,-7084.98 2385.5,-7084.98 2385.5,-7032.98 2614.5,-7032.98 2614.5,-7084.98"/>
<text text-anchor="middle" x="2500" y="-7072.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2500" y="-7061.98" font-family="Times,serif" font-size="10.00">GPU 159</text>
<text text-anchor="middle" x="2500" y="-7050.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2500" y="-7039.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep6_tp1&#45;&gt;stage2_ln1_dp2_ep7_tp1 -->
<g id="edge759" class="edge">
<title>stage2_ln2_dp2_ep6_tp1&#45;&gt;stage2_ln1_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M2287.06,-7145.93C2328.97,-7129.01 2384.43,-7106.63 2428.25,-7088.94"/>
<polygon fill="black" stroke="black" points="2429.73,-7092.12 2437.69,-7085.13 2427.11,-7085.63 2429.73,-7092.12"/>
</g>
<!-- stage2_mha_dp2_ep7_tp0 -->
<g id="node661" class="node">
<title>stage2_mha_dp2_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2107.5,-6969.98 1878.5,-6969.98 1878.5,-6917.98 2107.5,-6917.98 2107.5,-6969.98"/>
<text text-anchor="middle" x="1993" y="-6957.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1993" y="-6946.98" font-family="Times,serif" font-size="10.00">GPU 158</text>
<text text-anchor="middle" x="1993" y="-6935.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1993" y="-6924.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep7_tp0&#45;&gt;stage2_mha_dp2_ep7_tp0 -->
<g id="edge760" class="edge">
<title>stage2_ln1_dp2_ep7_tp0&#45;&gt;stage2_mha_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M1993,-7032.9C1993,-7017.4 1993,-6997.26 1993,-6980.17"/>
<polygon fill="black" stroke="black" points="1996.5,-6979.99 1993,-6969.99 1989.5,-6979.99 1996.5,-6979.99"/>
</g>
<!-- stage2_moe_gate_dp2_ep7_tp0 -->
<g id="node662" class="node">
<title>stage2_moe_gate_dp2_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2237.85,-6840.98 1848.35,-6840.98 1748.15,-6736.98 2137.65,-6736.98 2237.85,-6840.98"/>
<text text-anchor="middle" x="1993" y="-6802.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1993" y="-6791.98" font-family="Times,serif" font-size="10.00">GPU 158</text>
<text text-anchor="middle" x="1993" y="-6780.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1993" y="-6769.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep7_tp0&#45;&gt;stage2_moe_gate_dp2_ep7_tp0 -->
<g id="edge761" class="edge">
<title>stage2_mha_dp2_ep7_tp0&#45;&gt;stage2_moe_gate_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M1993,-6917.72C1993,-6899.6 1993,-6874.4 1993,-6851.16"/>
<polygon fill="black" stroke="black" points="1996.5,-6851 1993,-6841 1989.5,-6851 1996.5,-6851"/>
</g>
<!-- stage2_expert1_dp2_ep7_tp0 -->
<g id="node663" class="node">
<title>stage2_expert1_dp2_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1984.5,-6673.98 1749.5,-6673.98 1749.5,-6621.98 1984.5,-6621.98 1984.5,-6673.98"/>
<text text-anchor="middle" x="1867" y="-6661.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1867" y="-6650.98" font-family="Times,serif" font-size="10.00">GPU 158</text>
<text text-anchor="middle" x="1867" y="-6639.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1867" y="-6628.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep7_tp0&#45;&gt;stage2_expert1_dp2_ep7_tp0 -->
<g id="edge762" class="edge">
<title>stage2_moe_gate_dp2_ep7_tp0&#45;&gt;stage2_expert1_dp2_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1946.44,-6736.62C1929.81,-6718.28 1911.54,-6698.12 1896.72,-6681.77"/>
<polygon fill="black" stroke="black" points="1899.05,-6679.13 1889.74,-6674.07 1893.87,-6683.83 1899.05,-6679.13"/>
</g>
<!-- stage2_expert2_dp2_ep7_tp0 -->
<g id="node664" class="node">
<title>stage2_expert2_dp2_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2237.5,-6673.98 2002.5,-6673.98 2002.5,-6621.98 2237.5,-6621.98 2237.5,-6673.98"/>
<text text-anchor="middle" x="2120" y="-6661.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2120" y="-6650.98" font-family="Times,serif" font-size="10.00">GPU 158</text>
<text text-anchor="middle" x="2120" y="-6639.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2120" y="-6628.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep7_tp0&#45;&gt;stage2_expert2_dp2_ep7_tp0 -->
<g id="edge763" class="edge">
<title>stage2_moe_gate_dp2_ep7_tp0&#45;&gt;stage2_expert2_dp2_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2039.93,-6736.62C2056.69,-6718.28 2075.1,-6698.12 2090.04,-6681.77"/>
<polygon fill="black" stroke="black" points="2092.92,-6683.82 2097.08,-6674.07 2087.75,-6679.09 2092.92,-6683.82"/>
</g>
<!-- stage2_expert_agg_dp2_ep7_tp0 -->
<g id="node665" class="node">
<title>stage2_expert_agg_dp2_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2230.33,-6558.98 1852.79,-6558.98 1755.67,-6454.98 2133.21,-6454.98 2230.33,-6558.98"/>
<text text-anchor="middle" x="1993" y="-6520.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1993" y="-6509.98" font-family="Times,serif" font-size="10.00">GPU 158</text>
<text text-anchor="middle" x="1993" y="-6498.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1993" y="-6487.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep7_tp0&#45;&gt;stage2_expert_agg_dp2_ep7_tp0 -->
<g id="edge764" class="edge">
<title>stage2_expert1_dp2_ep7_tp0&#45;&gt;stage2_expert_agg_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M1889.82,-6621.81C1903.78,-6606.41 1922.26,-6586.02 1939.72,-6566.76"/>
<polygon fill="black" stroke="black" points="1942.48,-6568.92 1946.6,-6559.17 1937.3,-6564.22 1942.48,-6568.92"/>
</g>
<!-- stage2_expert2_dp2_ep7_tp0&#45;&gt;stage2_expert_agg_dp2_ep7_tp0 -->
<g id="edge765" class="edge">
<title>stage2_expert2_dp2_ep7_tp0&#45;&gt;stage2_expert_agg_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M2097,-6621.81C2082.93,-6606.41 2064.3,-6586.02 2046.7,-6566.76"/>
<polygon fill="black" stroke="black" points="2049.09,-6564.19 2039.76,-6559.17 2043.93,-6568.91 2049.09,-6564.19"/>
</g>
<!-- stage2_ln2_dp2_ep7_tp0 -->
<g id="node666" class="node">
<title>stage2_ln2_dp2_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2107.5,-6396.98 1878.5,-6396.98 1878.5,-6344.98 2107.5,-6344.98 2107.5,-6396.98"/>
<text text-anchor="middle" x="1993" y="-6384.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1993" y="-6373.98" font-family="Times,serif" font-size="10.00">GPU 158</text>
<text text-anchor="middle" x="1993" y="-6362.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1993" y="-6351.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep7_tp0&#45;&gt;stage2_ln2_dp2_ep7_tp0 -->
<g id="edge766" class="edge">
<title>stage2_expert_agg_dp2_ep7_tp0&#45;&gt;stage2_ln2_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M1993,-6454.94C1993,-6438.99 1993,-6421.76 1993,-6407.16"/>
<polygon fill="black" stroke="black" points="1996.5,-6407.04 1993,-6397.04 1989.5,-6407.04 1996.5,-6407.04"/>
</g>
<!-- stage2_ln1_dp3_ep0_tp0 -->
<g id="node786" class="node">
<title>stage2_ln1_dp3_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2107.5,-6286.98 1878.5,-6286.98 1878.5,-6234.98 2107.5,-6234.98 2107.5,-6286.98"/>
<text text-anchor="middle" x="1993" y="-6274.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1993" y="-6263.98" font-family="Times,serif" font-size="10.00">GPU 208</text>
<text text-anchor="middle" x="1993" y="-6252.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1993" y="-6241.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep7_tp0&#45;&gt;stage2_ln1_dp3_ep0_tp0 -->
<g id="edge767" class="edge">
<title>stage2_ln2_dp2_ep7_tp0&#45;&gt;stage2_ln1_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M1993,-6344.93C1993,-6330.86 1993,-6313.06 1993,-6297.56"/>
<polygon fill="black" stroke="black" points="1996.5,-6297.27 1993,-6287.27 1989.5,-6297.27 1996.5,-6297.27"/>
</g>
<!-- stage2_mha_dp2_ep7_tp1 -->
<g id="node668" class="node">
<title>stage2_mha_dp2_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2614.5,-6969.98 2385.5,-6969.98 2385.5,-6917.98 2614.5,-6917.98 2614.5,-6969.98"/>
<text text-anchor="middle" x="2500" y="-6957.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2500" y="-6946.98" font-family="Times,serif" font-size="10.00">GPU 159</text>
<text text-anchor="middle" x="2500" y="-6935.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2500" y="-6924.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp2_ep7_tp1&#45;&gt;stage2_mha_dp2_ep7_tp1 -->
<g id="edge768" class="edge">
<title>stage2_ln1_dp2_ep7_tp1&#45;&gt;stage2_mha_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M2500,-7032.9C2500,-7017.4 2500,-6997.26 2500,-6980.17"/>
<polygon fill="black" stroke="black" points="2503.5,-6979.99 2500,-6969.99 2496.5,-6979.99 2503.5,-6979.99"/>
</g>
<!-- stage2_moe_gate_dp2_ep7_tp1 -->
<g id="node669" class="node">
<title>stage2_moe_gate_dp2_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2744.85,-6840.98 2355.35,-6840.98 2255.15,-6736.98 2644.65,-6736.98 2744.85,-6840.98"/>
<text text-anchor="middle" x="2500" y="-6802.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2500" y="-6791.98" font-family="Times,serif" font-size="10.00">GPU 159</text>
<text text-anchor="middle" x="2500" y="-6780.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2500" y="-6769.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp2_ep7_tp1&#45;&gt;stage2_moe_gate_dp2_ep7_tp1 -->
<g id="edge769" class="edge">
<title>stage2_mha_dp2_ep7_tp1&#45;&gt;stage2_moe_gate_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M2500,-6917.72C2500,-6899.6 2500,-6874.4 2500,-6851.16"/>
<polygon fill="black" stroke="black" points="2503.5,-6851 2500,-6841 2496.5,-6851 2503.5,-6851"/>
</g>
<!-- stage2_expert1_dp2_ep7_tp1 -->
<g id="node670" class="node">
<title>stage2_expert1_dp2_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2490.5,-6673.98 2255.5,-6673.98 2255.5,-6621.98 2490.5,-6621.98 2490.5,-6673.98"/>
<text text-anchor="middle" x="2373" y="-6661.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2373" y="-6650.98" font-family="Times,serif" font-size="10.00">GPU 159</text>
<text text-anchor="middle" x="2373" y="-6639.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2373" y="-6628.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep7_tp1&#45;&gt;stage2_expert1_dp2_ep7_tp1 -->
<g id="edge770" class="edge">
<title>stage2_moe_gate_dp2_ep7_tp1&#45;&gt;stage2_expert1_dp2_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2453.07,-6736.62C2436.31,-6718.28 2417.9,-6698.12 2402.96,-6681.77"/>
<polygon fill="black" stroke="black" points="2405.25,-6679.09 2395.92,-6674.07 2400.08,-6683.82 2405.25,-6679.09"/>
</g>
<!-- stage2_expert2_dp2_ep7_tp1 -->
<g id="node671" class="node">
<title>stage2_expert2_dp2_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2743.5,-6673.98 2508.5,-6673.98 2508.5,-6621.98 2743.5,-6621.98 2743.5,-6673.98"/>
<text text-anchor="middle" x="2626" y="-6661.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2626" y="-6650.98" font-family="Times,serif" font-size="10.00">GPU 159</text>
<text text-anchor="middle" x="2626" y="-6639.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2626" y="-6628.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp2_ep7_tp1&#45;&gt;stage2_expert2_dp2_ep7_tp1 -->
<g id="edge771" class="edge">
<title>stage2_moe_gate_dp2_ep7_tp1&#45;&gt;stage2_expert2_dp2_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2546.56,-6736.62C2563.19,-6718.28 2581.46,-6698.12 2596.28,-6681.77"/>
<polygon fill="black" stroke="black" points="2599.13,-6683.83 2603.26,-6674.07 2593.95,-6679.13 2599.13,-6683.83"/>
</g>
<!-- stage2_expert_agg_dp2_ep7_tp1 -->
<g id="node672" class="node">
<title>stage2_expert_agg_dp2_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2737.33,-6558.98 2359.79,-6558.98 2262.67,-6454.98 2640.21,-6454.98 2737.33,-6558.98"/>
<text text-anchor="middle" x="2500" y="-6520.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2500" y="-6509.98" font-family="Times,serif" font-size="10.00">GPU 159</text>
<text text-anchor="middle" x="2500" y="-6498.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2500" y="-6487.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp2_ep7_tp1&#45;&gt;stage2_expert_agg_dp2_ep7_tp1 -->
<g id="edge772" class="edge">
<title>stage2_expert1_dp2_ep7_tp1&#45;&gt;stage2_expert_agg_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M2396,-6621.81C2410.07,-6606.41 2428.7,-6586.02 2446.3,-6566.76"/>
<polygon fill="black" stroke="black" points="2449.07,-6568.91 2453.24,-6559.17 2443.91,-6564.19 2449.07,-6568.91"/>
</g>
<!-- stage2_expert2_dp2_ep7_tp1&#45;&gt;stage2_expert_agg_dp2_ep7_tp1 -->
<g id="edge773" class="edge">
<title>stage2_expert2_dp2_ep7_tp1&#45;&gt;stage2_expert_agg_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M2603.18,-6621.81C2589.22,-6606.41 2570.74,-6586.02 2553.28,-6566.76"/>
<polygon fill="black" stroke="black" points="2555.7,-6564.22 2546.4,-6559.17 2550.52,-6568.92 2555.7,-6564.22"/>
</g>
<!-- stage2_ln2_dp2_ep7_tp1 -->
<g id="node673" class="node">
<title>stage2_ln2_dp2_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2614.5,-6396.98 2385.5,-6396.98 2385.5,-6344.98 2614.5,-6344.98 2614.5,-6396.98"/>
<text text-anchor="middle" x="2500" y="-6384.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2500" y="-6373.98" font-family="Times,serif" font-size="10.00">GPU 159</text>
<text text-anchor="middle" x="2500" y="-6362.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2500" y="-6351.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp2_ep7_tp1&#45;&gt;stage2_ln2_dp2_ep7_tp1 -->
<g id="edge774" class="edge">
<title>stage2_expert_agg_dp2_ep7_tp1&#45;&gt;stage2_ln2_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M2500,-6454.94C2500,-6438.99 2500,-6421.76 2500,-6407.16"/>
<polygon fill="black" stroke="black" points="2503.5,-6407.04 2500,-6397.04 2496.5,-6407.04 2503.5,-6407.04"/>
</g>
<!-- stage2_ln1_dp3_ep0_tp1 -->
<g id="node793" class="node">
<title>stage2_ln1_dp3_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2614.5,-6286.98 2385.5,-6286.98 2385.5,-6234.98 2614.5,-6234.98 2614.5,-6286.98"/>
<text text-anchor="middle" x="2500" y="-6274.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2500" y="-6263.98" font-family="Times,serif" font-size="10.00">GPU 209</text>
<text text-anchor="middle" x="2500" y="-6252.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2500" y="-6241.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp2_ep7_tp1&#45;&gt;stage2_ln1_dp3_ep0_tp1 -->
<g id="edge775" class="edge">
<title>stage2_ln2_dp2_ep7_tp1&#45;&gt;stage2_ln1_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M2500,-6344.93C2500,-6330.86 2500,-6313.06 2500,-6297.56"/>
<polygon fill="black" stroke="black" points="2503.5,-6297.27 2500,-6287.27 2496.5,-6297.27 2503.5,-6297.27"/>
</g>
<!-- ln1_dp3_ep0_tp0 -->
<g id="node674" class="node">
<title>ln1_dp3_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3144.5,-7197.97 2915.5,-7197.97 2915.5,-7145.97 3144.5,-7145.97 3144.5,-7197.97"/>
<text text-anchor="middle" x="3030" y="-7185.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3030" y="-7174.97" font-family="Times,serif" font-size="10.00">GPU 192</text>
<text text-anchor="middle" x="3030" y="-7163.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3030" y="-7152.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- mha_dp3_ep0_tp0 -->
<g id="node675" class="node">
<title>mha_dp3_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3144.5,-7084.98 2915.5,-7084.98 2915.5,-7032.98 3144.5,-7032.98 3144.5,-7084.98"/>
<text text-anchor="middle" x="3030" y="-7072.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3030" y="-7061.98" font-family="Times,serif" font-size="10.00">GPU 192</text>
<text text-anchor="middle" x="3030" y="-7050.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3030" y="-7039.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep0_tp0&#45;&gt;mha_dp3_ep0_tp0 -->
<g id="edge776" class="edge">
<title>ln1_dp3_ep0_tp0&#45;&gt;mha_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M3030,-7145.79C3030,-7130.89 3030,-7111.78 3030,-7095.38"/>
<polygon fill="black" stroke="black" points="3033.5,-7095.07 3030,-7085.07 3026.5,-7095.07 3033.5,-7095.07"/>
</g>
<!-- moe_gate_dp3_ep0_tp0 -->
<g id="node676" class="node">
<title>moe_gate_dp3_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3274.85,-6995.98 2885.35,-6995.98 2785.15,-6891.98 3174.65,-6891.98 3274.85,-6995.98"/>
<text text-anchor="middle" x="3030" y="-6957.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3030" y="-6946.98" font-family="Times,serif" font-size="10.00">GPU 192</text>
<text text-anchor="middle" x="3030" y="-6935.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3030" y="-6924.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep0_tp0&#45;&gt;moe_gate_dp3_ep0_tp0 -->
<g id="edge777" class="edge">
<title>mha_dp3_ep0_tp0&#45;&gt;moe_gate_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M3030,-7032.9C3030,-7024.98 3030,-7015.84 3030,-7006.52"/>
<polygon fill="black" stroke="black" points="3033.5,-7006.38 3030,-6996.38 3026.5,-7006.38 3033.5,-7006.38"/>
</g>
<!-- expert1_dp3_ep0_tp0 -->
<g id="node677" class="node">
<title>expert1_dp3_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3021.5,-6814.98 2786.5,-6814.98 2786.5,-6762.98 3021.5,-6762.98 3021.5,-6814.98"/>
<text text-anchor="middle" x="2904" y="-6802.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2904" y="-6791.98" font-family="Times,serif" font-size="10.00">GPU 192</text>
<text text-anchor="middle" x="2904" y="-6780.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2904" y="-6769.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep0_tp0&#45;&gt;expert1_dp3_ep0_tp0 -->
<g id="edge778" class="edge">
<title>moe_gate_dp3_ep0_tp0&#45;&gt;expert1_dp3_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2987.69,-6891.61C2969.09,-6869.03 2947.79,-6843.15 2931.33,-6823.17"/>
<polygon fill="black" stroke="black" points="2933.88,-6820.76 2924.82,-6815.26 2928.47,-6825.21 2933.88,-6820.76"/>
<text text-anchor="middle" x="3027.5" y="-6862.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep0_tp0 -->
<g id="node678" class="node">
<title>expert2_dp3_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3274.5,-6814.98 3039.5,-6814.98 3039.5,-6762.98 3274.5,-6762.98 3274.5,-6814.98"/>
<text text-anchor="middle" x="3157" y="-6802.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3157" y="-6791.98" font-family="Times,serif" font-size="10.00">GPU 192</text>
<text text-anchor="middle" x="3157" y="-6780.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3157" y="-6769.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep0_tp0&#45;&gt;expert2_dp3_ep0_tp0 -->
<g id="edge779" class="edge">
<title>moe_gate_dp3_ep0_tp0&#45;&gt;expert2_dp3_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3073.97,-6891.87C3079.06,-6885.86 3084.16,-6879.8 3089,-6873.98 3102.9,-6857.28 3118.14,-6838.5 3130.66,-6822.94"/>
<polygon fill="black" stroke="black" points="3133.41,-6825.11 3136.94,-6815.12 3127.95,-6820.72 3133.41,-6825.11"/>
<text text-anchor="middle" x="3157.5" y="-6862.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep0_tp0 -->
<g id="node679" class="node">
<title>expert_agg_dp3_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3262.33,-6699.98 2884.79,-6699.98 2787.67,-6595.98 3165.21,-6595.98 3262.33,-6699.98"/>
<text text-anchor="middle" x="3025" y="-6661.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3025" y="-6650.98" font-family="Times,serif" font-size="10.00">GPU 192</text>
<text text-anchor="middle" x="3025" y="-6639.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3025" y="-6628.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep0_tp0&#45;&gt;expert_agg_dp3_ep0_tp0 -->
<g id="edge780" class="edge">
<title>expert1_dp3_ep0_tp0&#45;&gt;expert_agg_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M2925.91,-6762.81C2939.32,-6747.41 2957.07,-6727.02 2973.83,-6707.76"/>
<polygon fill="black" stroke="black" points="2976.52,-6710.01 2980.45,-6700.17 2971.24,-6705.41 2976.52,-6710.01"/>
</g>
<!-- expert2_dp3_ep0_tp0&#45;&gt;expert_agg_dp3_ep0_tp0 -->
<g id="edge781" class="edge">
<title>expert2_dp3_ep0_tp0&#45;&gt;expert_agg_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M3133.1,-6762.81C3118.4,-6747.34 3098.94,-6726.84 3080.58,-6707.51"/>
<polygon fill="black" stroke="black" points="3083.03,-6705.01 3073.6,-6700.17 3077.95,-6709.83 3083.03,-6705.01"/>
</g>
<!-- ln2_dp3_ep0_tp0 -->
<g id="node680" class="node">
<title>ln2_dp3_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3139.5,-6532.98 2910.5,-6532.98 2910.5,-6480.98 3139.5,-6480.98 3139.5,-6532.98"/>
<text text-anchor="middle" x="3025" y="-6520.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3025" y="-6509.98" font-family="Times,serif" font-size="10.00">GPU 192</text>
<text text-anchor="middle" x="3025" y="-6498.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3025" y="-6487.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep0_tp0&#45;&gt;ln2_dp3_ep0_tp0 -->
<g id="edge782" class="edge">
<title>expert_agg_dp3_ep0_tp0&#45;&gt;ln2_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M3025,-6595.62C3025,-6578.28 3025,-6559.31 3025,-6543.48"/>
<polygon fill="black" stroke="black" points="3028.5,-6543.07 3025,-6533.07 3021.5,-6543.07 3028.5,-6543.07"/>
</g>
<!-- ln1_dp3_ep1_tp0 -->
<g id="node688" class="node">
<title>ln1_dp3_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3139.5,-6396.98 2910.5,-6396.98 2910.5,-6344.98 3139.5,-6344.98 3139.5,-6396.98"/>
<text text-anchor="middle" x="3025" y="-6384.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3025" y="-6373.98" font-family="Times,serif" font-size="10.00">GPU 194</text>
<text text-anchor="middle" x="3025" y="-6362.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3025" y="-6351.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep0_tp0&#45;&gt;ln1_dp3_ep1_tp0 -->
<g id="edge783" class="edge">
<title>ln2_dp3_ep0_tp0&#45;&gt;ln1_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M3025,-6480.78C3025,-6460 3025,-6430.3 3025,-6407.18"/>
<polygon fill="black" stroke="black" points="3028.5,-6407.07 3025,-6397.07 3021.5,-6407.07 3028.5,-6407.07"/>
</g>
<!-- ln1_dp3_ep0_tp1 -->
<g id="node681" class="node">
<title>ln1_dp3_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3651.5,-7197.97 3422.5,-7197.97 3422.5,-7145.97 3651.5,-7145.97 3651.5,-7197.97"/>
<text text-anchor="middle" x="3537" y="-7185.97" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3537" y="-7174.97" font-family="Times,serif" font-size="10.00">GPU 193</text>
<text text-anchor="middle" x="3537" y="-7163.97" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3537" y="-7152.97" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- mha_dp3_ep0_tp1 -->
<g id="node682" class="node">
<title>mha_dp3_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3651.5,-7084.98 3422.5,-7084.98 3422.5,-7032.98 3651.5,-7032.98 3651.5,-7084.98"/>
<text text-anchor="middle" x="3537" y="-7072.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3537" y="-7061.98" font-family="Times,serif" font-size="10.00">GPU 193</text>
<text text-anchor="middle" x="3537" y="-7050.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3537" y="-7039.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep0_tp1&#45;&gt;mha_dp3_ep0_tp1 -->
<g id="edge784" class="edge">
<title>ln1_dp3_ep0_tp1&#45;&gt;mha_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M3537,-7145.79C3537,-7130.89 3537,-7111.78 3537,-7095.38"/>
<polygon fill="black" stroke="black" points="3540.5,-7095.07 3537,-7085.07 3533.5,-7095.07 3540.5,-7095.07"/>
</g>
<!-- moe_gate_dp3_ep0_tp1 -->
<g id="node683" class="node">
<title>moe_gate_dp3_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3781.85,-6995.98 3392.35,-6995.98 3292.15,-6891.98 3681.65,-6891.98 3781.85,-6995.98"/>
<text text-anchor="middle" x="3537" y="-6957.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3537" y="-6946.98" font-family="Times,serif" font-size="10.00">GPU 193</text>
<text text-anchor="middle" x="3537" y="-6935.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3537" y="-6924.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep0_tp1&#45;&gt;moe_gate_dp3_ep0_tp1 -->
<g id="edge785" class="edge">
<title>mha_dp3_ep0_tp1&#45;&gt;moe_gate_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M3537,-7032.9C3537,-7024.98 3537,-7015.84 3537,-7006.52"/>
<polygon fill="black" stroke="black" points="3540.5,-7006.38 3537,-6996.38 3533.5,-7006.38 3540.5,-7006.38"/>
</g>
<!-- expert1_dp3_ep0_tp1 -->
<g id="node684" class="node">
<title>expert1_dp3_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3527.5,-6814.98 3292.5,-6814.98 3292.5,-6762.98 3527.5,-6762.98 3527.5,-6814.98"/>
<text text-anchor="middle" x="3410" y="-6802.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3410" y="-6791.98" font-family="Times,serif" font-size="10.00">GPU 193</text>
<text text-anchor="middle" x="3410" y="-6780.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3410" y="-6769.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep0_tp1&#45;&gt;expert1_dp3_ep0_tp1 -->
<g id="edge786" class="edge">
<title>moe_gate_dp3_ep0_tp1&#45;&gt;expert1_dp3_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3492.2,-6891.95C3487.03,-6885.92 3481.88,-6879.84 3477,-6873.98 3463.3,-6857.54 3448.42,-6838.96 3436.17,-6823.46"/>
<polygon fill="black" stroke="black" points="3438.6,-6820.89 3429.66,-6815.2 3433.1,-6825.22 3438.6,-6820.89"/>
<text text-anchor="middle" x="3534.5" y="-6862.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep0_tp1 -->
<g id="node685" class="node">
<title>expert2_dp3_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3780.5,-6814.98 3545.5,-6814.98 3545.5,-6762.98 3780.5,-6762.98 3780.5,-6814.98"/>
<text text-anchor="middle" x="3663" y="-6802.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3663" y="-6791.98" font-family="Times,serif" font-size="10.00">GPU 193</text>
<text text-anchor="middle" x="3663" y="-6780.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3663" y="-6769.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep0_tp1&#45;&gt;expert2_dp3_ep0_tp1 -->
<g id="edge787" class="edge">
<title>moe_gate_dp3_ep0_tp1&#45;&gt;expert2_dp3_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3579.31,-6891.61C3597.91,-6869.03 3619.21,-6843.15 3635.67,-6823.17"/>
<polygon fill="black" stroke="black" points="3638.53,-6825.21 3642.18,-6815.26 3633.12,-6820.76 3638.53,-6825.21"/>
<text text-anchor="middle" x="3660.5" y="-6862.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep0_tp1 -->
<g id="node686" class="node">
<title>expert_agg_dp3_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3769.33,-6699.98 3391.79,-6699.98 3294.67,-6595.98 3672.21,-6595.98 3769.33,-6699.98"/>
<text text-anchor="middle" x="3532" y="-6661.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3532" y="-6650.98" font-family="Times,serif" font-size="10.00">GPU 193</text>
<text text-anchor="middle" x="3532" y="-6639.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3532" y="-6628.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep0_tp1&#45;&gt;expert_agg_dp3_ep0_tp1 -->
<g id="edge788" class="edge">
<title>expert1_dp3_ep0_tp1&#45;&gt;expert_agg_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M3432.09,-6762.81C3445.61,-6747.41 3463.5,-6727.02 3480.41,-6707.76"/>
<polygon fill="black" stroke="black" points="3483.11,-6709.99 3487.08,-6700.17 3477.85,-6705.37 3483.11,-6709.99"/>
</g>
<!-- expert2_dp3_ep0_tp1&#45;&gt;expert_agg_dp3_ep0_tp1 -->
<g id="edge789" class="edge">
<title>expert2_dp3_ep0_tp1&#45;&gt;expert_agg_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M3639.28,-6762.81C3624.7,-6747.34 3605.38,-6726.84 3587.16,-6707.51"/>
<polygon fill="black" stroke="black" points="3589.64,-6705.04 3580.24,-6700.17 3584.55,-6709.84 3589.64,-6705.04"/>
</g>
<!-- ln2_dp3_ep0_tp1 -->
<g id="node687" class="node">
<title>ln2_dp3_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3646.5,-6532.98 3417.5,-6532.98 3417.5,-6480.98 3646.5,-6480.98 3646.5,-6532.98"/>
<text text-anchor="middle" x="3532" y="-6520.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3532" y="-6509.98" font-family="Times,serif" font-size="10.00">GPU 193</text>
<text text-anchor="middle" x="3532" y="-6498.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3532" y="-6487.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep0_tp1&#45;&gt;ln2_dp3_ep0_tp1 -->
<g id="edge790" class="edge">
<title>expert_agg_dp3_ep0_tp1&#45;&gt;ln2_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M3532,-6595.62C3532,-6578.28 3532,-6559.31 3532,-6543.48"/>
<polygon fill="black" stroke="black" points="3535.5,-6543.07 3532,-6533.07 3528.5,-6543.07 3535.5,-6543.07"/>
</g>
<!-- ln1_dp3_ep1_tp1 -->
<g id="node695" class="node">
<title>ln1_dp3_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3646.5,-6396.98 3417.5,-6396.98 3417.5,-6344.98 3646.5,-6344.98 3646.5,-6396.98"/>
<text text-anchor="middle" x="3532" y="-6384.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3532" y="-6373.98" font-family="Times,serif" font-size="10.00">GPU 195</text>
<text text-anchor="middle" x="3532" y="-6362.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3532" y="-6351.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep0_tp1&#45;&gt;ln1_dp3_ep1_tp1 -->
<g id="edge791" class="edge">
<title>ln2_dp3_ep0_tp1&#45;&gt;ln1_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M3532,-6480.78C3532,-6460 3532,-6430.3 3532,-6407.18"/>
<polygon fill="black" stroke="black" points="3535.5,-6407.07 3532,-6397.07 3528.5,-6407.07 3535.5,-6407.07"/>
</g>
<!-- mha_dp3_ep1_tp0 -->
<g id="node689" class="node">
<title>mha_dp3_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3139.5,-6286.98 2910.5,-6286.98 2910.5,-6234.98 3139.5,-6234.98 3139.5,-6286.98"/>
<text text-anchor="middle" x="3025" y="-6274.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3025" y="-6263.98" font-family="Times,serif" font-size="10.00">GPU 194</text>
<text text-anchor="middle" x="3025" y="-6252.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3025" y="-6241.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep1_tp0&#45;&gt;mha_dp3_ep1_tp0 -->
<g id="edge792" class="edge">
<title>ln1_dp3_ep1_tp0&#45;&gt;mha_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M3025,-6344.93C3025,-6330.86 3025,-6313.06 3025,-6297.56"/>
<polygon fill="black" stroke="black" points="3028.5,-6297.27 3025,-6287.27 3021.5,-6297.27 3028.5,-6297.27"/>
</g>
<!-- moe_gate_dp3_ep1_tp0 -->
<g id="node690" class="node">
<title>moe_gate_dp3_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3269.85,-6197.98 2880.35,-6197.98 2780.15,-6093.98 3169.65,-6093.98 3269.85,-6197.98"/>
<text text-anchor="middle" x="3025" y="-6159.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3025" y="-6148.98" font-family="Times,serif" font-size="10.00">GPU 194</text>
<text text-anchor="middle" x="3025" y="-6137.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3025" y="-6126.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep1_tp0&#45;&gt;moe_gate_dp3_ep1_tp0 -->
<g id="edge793" class="edge">
<title>mha_dp3_ep1_tp0&#45;&gt;moe_gate_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M3025,-6234.9C3025,-6226.98 3025,-6217.84 3025,-6208.52"/>
<polygon fill="black" stroke="black" points="3028.5,-6208.38 3025,-6198.38 3021.5,-6208.38 3028.5,-6208.38"/>
</g>
<!-- expert1_dp3_ep1_tp0 -->
<g id="node691" class="node">
<title>expert1_dp3_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3016.5,-6016.98 2781.5,-6016.98 2781.5,-5964.98 3016.5,-5964.98 3016.5,-6016.98"/>
<text text-anchor="middle" x="2899" y="-6004.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2899" y="-5993.98" font-family="Times,serif" font-size="10.00">GPU 194</text>
<text text-anchor="middle" x="2899" y="-5982.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2899" y="-5971.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep1_tp0&#45;&gt;expert1_dp3_ep1_tp0 -->
<g id="edge794" class="edge">
<title>moe_gate_dp3_ep1_tp0&#45;&gt;expert1_dp3_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2982.69,-6093.61C2964.09,-6071.03 2942.79,-6045.15 2926.33,-6025.17"/>
<polygon fill="black" stroke="black" points="2928.88,-6022.76 2919.82,-6017.26 2923.47,-6027.21 2928.88,-6022.76"/>
<text text-anchor="middle" x="3022.5" y="-6064.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep1_tp0 -->
<g id="node692" class="node">
<title>expert2_dp3_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3269.5,-6016.98 3034.5,-6016.98 3034.5,-5964.98 3269.5,-5964.98 3269.5,-6016.98"/>
<text text-anchor="middle" x="3152" y="-6004.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3152" y="-5993.98" font-family="Times,serif" font-size="10.00">GPU 194</text>
<text text-anchor="middle" x="3152" y="-5982.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3152" y="-5971.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep1_tp0&#45;&gt;expert2_dp3_ep1_tp0 -->
<g id="edge795" class="edge">
<title>moe_gate_dp3_ep1_tp0&#45;&gt;expert2_dp3_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3068.97,-6093.87C3074.06,-6087.86 3079.16,-6081.8 3084,-6075.98 3097.9,-6059.28 3113.14,-6040.5 3125.66,-6024.94"/>
<polygon fill="black" stroke="black" points="3128.41,-6027.11 3131.94,-6017.12 3122.95,-6022.72 3128.41,-6027.11"/>
<text text-anchor="middle" x="3152.5" y="-6064.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep1_tp0 -->
<g id="node693" class="node">
<title>expert_agg_dp3_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3257.33,-5901.98 2879.79,-5901.98 2782.67,-5797.98 3160.21,-5797.98 3257.33,-5901.98"/>
<text text-anchor="middle" x="3020" y="-5863.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3020" y="-5852.98" font-family="Times,serif" font-size="10.00">GPU 194</text>
<text text-anchor="middle" x="3020" y="-5841.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3020" y="-5830.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep1_tp0&#45;&gt;expert_agg_dp3_ep1_tp0 -->
<g id="edge796" class="edge">
<title>expert1_dp3_ep1_tp0&#45;&gt;expert_agg_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M2920.91,-5964.81C2934.32,-5949.41 2952.07,-5929.02 2968.83,-5909.76"/>
<polygon fill="black" stroke="black" points="2971.52,-5912.01 2975.45,-5902.17 2966.24,-5907.41 2971.52,-5912.01"/>
</g>
<!-- expert2_dp3_ep1_tp0&#45;&gt;expert_agg_dp3_ep1_tp0 -->
<g id="edge797" class="edge">
<title>expert2_dp3_ep1_tp0&#45;&gt;expert_agg_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M3128.1,-5964.81C3113.4,-5949.34 3093.94,-5928.84 3075.58,-5909.51"/>
<polygon fill="black" stroke="black" points="3078.03,-5907.01 3068.6,-5902.17 3072.95,-5911.83 3078.03,-5907.01"/>
</g>
<!-- ln2_dp3_ep1_tp0 -->
<g id="node694" class="node">
<title>ln2_dp3_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3134.5,-5734.98 2905.5,-5734.98 2905.5,-5682.98 3134.5,-5682.98 3134.5,-5734.98"/>
<text text-anchor="middle" x="3020" y="-5722.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3020" y="-5711.98" font-family="Times,serif" font-size="10.00">GPU 194</text>
<text text-anchor="middle" x="3020" y="-5700.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3020" y="-5689.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep1_tp0&#45;&gt;ln2_dp3_ep1_tp0 -->
<g id="edge798" class="edge">
<title>expert_agg_dp3_ep1_tp0&#45;&gt;ln2_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M3020,-5797.62C3020,-5780.28 3020,-5761.31 3020,-5745.48"/>
<polygon fill="black" stroke="black" points="3023.5,-5745.07 3020,-5735.07 3016.5,-5745.07 3023.5,-5745.07"/>
</g>
<!-- ln1_dp3_ep2_tp0 -->
<g id="node702" class="node">
<title>ln1_dp3_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3134.5,-5598.98 2905.5,-5598.98 2905.5,-5546.98 3134.5,-5546.98 3134.5,-5598.98"/>
<text text-anchor="middle" x="3020" y="-5586.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3020" y="-5575.98" font-family="Times,serif" font-size="10.00">GPU 196</text>
<text text-anchor="middle" x="3020" y="-5564.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3020" y="-5553.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep1_tp0&#45;&gt;ln1_dp3_ep2_tp0 -->
<g id="edge799" class="edge">
<title>ln2_dp3_ep1_tp0&#45;&gt;ln1_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M3020,-5682.78C3020,-5662 3020,-5632.3 3020,-5609.18"/>
<polygon fill="black" stroke="black" points="3023.5,-5609.07 3020,-5599.07 3016.5,-5609.07 3023.5,-5609.07"/>
</g>
<!-- mha_dp3_ep1_tp1 -->
<g id="node696" class="node">
<title>mha_dp3_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3646.5,-6286.98 3417.5,-6286.98 3417.5,-6234.98 3646.5,-6234.98 3646.5,-6286.98"/>
<text text-anchor="middle" x="3532" y="-6274.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3532" y="-6263.98" font-family="Times,serif" font-size="10.00">GPU 195</text>
<text text-anchor="middle" x="3532" y="-6252.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3532" y="-6241.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep1_tp1&#45;&gt;mha_dp3_ep1_tp1 -->
<g id="edge800" class="edge">
<title>ln1_dp3_ep1_tp1&#45;&gt;mha_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M3532,-6344.93C3532,-6330.86 3532,-6313.06 3532,-6297.56"/>
<polygon fill="black" stroke="black" points="3535.5,-6297.27 3532,-6287.27 3528.5,-6297.27 3535.5,-6297.27"/>
</g>
<!-- moe_gate_dp3_ep1_tp1 -->
<g id="node697" class="node">
<title>moe_gate_dp3_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3776.85,-6197.98 3387.35,-6197.98 3287.15,-6093.98 3676.65,-6093.98 3776.85,-6197.98"/>
<text text-anchor="middle" x="3532" y="-6159.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3532" y="-6148.98" font-family="Times,serif" font-size="10.00">GPU 195</text>
<text text-anchor="middle" x="3532" y="-6137.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3532" y="-6126.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep1_tp1&#45;&gt;moe_gate_dp3_ep1_tp1 -->
<g id="edge801" class="edge">
<title>mha_dp3_ep1_tp1&#45;&gt;moe_gate_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M3532,-6234.9C3532,-6226.98 3532,-6217.84 3532,-6208.52"/>
<polygon fill="black" stroke="black" points="3535.5,-6208.38 3532,-6198.38 3528.5,-6208.38 3535.5,-6208.38"/>
</g>
<!-- expert1_dp3_ep1_tp1 -->
<g id="node698" class="node">
<title>expert1_dp3_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3522.5,-6016.98 3287.5,-6016.98 3287.5,-5964.98 3522.5,-5964.98 3522.5,-6016.98"/>
<text text-anchor="middle" x="3405" y="-6004.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3405" y="-5993.98" font-family="Times,serif" font-size="10.00">GPU 195</text>
<text text-anchor="middle" x="3405" y="-5982.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3405" y="-5971.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep1_tp1&#45;&gt;expert1_dp3_ep1_tp1 -->
<g id="edge802" class="edge">
<title>moe_gate_dp3_ep1_tp1&#45;&gt;expert1_dp3_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3487.2,-6093.95C3482.03,-6087.92 3476.88,-6081.84 3472,-6075.98 3458.3,-6059.54 3443.42,-6040.96 3431.17,-6025.46"/>
<polygon fill="black" stroke="black" points="3433.6,-6022.89 3424.66,-6017.2 3428.1,-6027.22 3433.6,-6022.89"/>
<text text-anchor="middle" x="3529.5" y="-6064.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep1_tp1 -->
<g id="node699" class="node">
<title>expert2_dp3_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3775.5,-6016.98 3540.5,-6016.98 3540.5,-5964.98 3775.5,-5964.98 3775.5,-6016.98"/>
<text text-anchor="middle" x="3658" y="-6004.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3658" y="-5993.98" font-family="Times,serif" font-size="10.00">GPU 195</text>
<text text-anchor="middle" x="3658" y="-5982.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3658" y="-5971.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep1_tp1&#45;&gt;expert2_dp3_ep1_tp1 -->
<g id="edge803" class="edge">
<title>moe_gate_dp3_ep1_tp1&#45;&gt;expert2_dp3_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3574.31,-6093.61C3592.91,-6071.03 3614.21,-6045.15 3630.67,-6025.17"/>
<polygon fill="black" stroke="black" points="3633.53,-6027.21 3637.18,-6017.26 3628.12,-6022.76 3633.53,-6027.21"/>
<text text-anchor="middle" x="3655.5" y="-6064.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep1_tp1 -->
<g id="node700" class="node">
<title>expert_agg_dp3_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3764.33,-5901.98 3386.79,-5901.98 3289.67,-5797.98 3667.21,-5797.98 3764.33,-5901.98"/>
<text text-anchor="middle" x="3527" y="-5863.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3527" y="-5852.98" font-family="Times,serif" font-size="10.00">GPU 195</text>
<text text-anchor="middle" x="3527" y="-5841.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3527" y="-5830.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep1_tp1&#45;&gt;expert_agg_dp3_ep1_tp1 -->
<g id="edge804" class="edge">
<title>expert1_dp3_ep1_tp1&#45;&gt;expert_agg_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M3427.09,-5964.81C3440.61,-5949.41 3458.5,-5929.02 3475.41,-5909.76"/>
<polygon fill="black" stroke="black" points="3478.11,-5911.99 3482.08,-5902.17 3472.85,-5907.37 3478.11,-5911.99"/>
</g>
<!-- expert2_dp3_ep1_tp1&#45;&gt;expert_agg_dp3_ep1_tp1 -->
<g id="edge805" class="edge">
<title>expert2_dp3_ep1_tp1&#45;&gt;expert_agg_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M3634.28,-5964.81C3619.7,-5949.34 3600.38,-5928.84 3582.16,-5909.51"/>
<polygon fill="black" stroke="black" points="3584.64,-5907.04 3575.24,-5902.17 3579.55,-5911.84 3584.64,-5907.04"/>
</g>
<!-- ln2_dp3_ep1_tp1 -->
<g id="node701" class="node">
<title>ln2_dp3_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3641.5,-5734.98 3412.5,-5734.98 3412.5,-5682.98 3641.5,-5682.98 3641.5,-5734.98"/>
<text text-anchor="middle" x="3527" y="-5722.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3527" y="-5711.98" font-family="Times,serif" font-size="10.00">GPU 195</text>
<text text-anchor="middle" x="3527" y="-5700.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3527" y="-5689.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep1_tp1&#45;&gt;ln2_dp3_ep1_tp1 -->
<g id="edge806" class="edge">
<title>expert_agg_dp3_ep1_tp1&#45;&gt;ln2_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M3527,-5797.62C3527,-5780.28 3527,-5761.31 3527,-5745.48"/>
<polygon fill="black" stroke="black" points="3530.5,-5745.07 3527,-5735.07 3523.5,-5745.07 3530.5,-5745.07"/>
</g>
<!-- ln1_dp3_ep2_tp1 -->
<g id="node709" class="node">
<title>ln1_dp3_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3641.5,-5598.98 3412.5,-5598.98 3412.5,-5546.98 3641.5,-5546.98 3641.5,-5598.98"/>
<text text-anchor="middle" x="3527" y="-5586.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3527" y="-5575.98" font-family="Times,serif" font-size="10.00">GPU 197</text>
<text text-anchor="middle" x="3527" y="-5564.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3527" y="-5553.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep1_tp1&#45;&gt;ln1_dp3_ep2_tp1 -->
<g id="edge807" class="edge">
<title>ln2_dp3_ep1_tp1&#45;&gt;ln1_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M3527,-5682.78C3527,-5662 3527,-5632.3 3527,-5609.18"/>
<polygon fill="black" stroke="black" points="3530.5,-5609.07 3527,-5599.07 3523.5,-5609.07 3530.5,-5609.07"/>
</g>
<!-- mha_dp3_ep2_tp0 -->
<g id="node703" class="node">
<title>mha_dp3_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3134.5,-5488.98 2905.5,-5488.98 2905.5,-5436.98 3134.5,-5436.98 3134.5,-5488.98"/>
<text text-anchor="middle" x="3020" y="-5476.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3020" y="-5465.98" font-family="Times,serif" font-size="10.00">GPU 196</text>
<text text-anchor="middle" x="3020" y="-5454.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3020" y="-5443.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep2_tp0&#45;&gt;mha_dp3_ep2_tp0 -->
<g id="edge808" class="edge">
<title>ln1_dp3_ep2_tp0&#45;&gt;mha_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M3020,-5546.93C3020,-5532.86 3020,-5515.06 3020,-5499.56"/>
<polygon fill="black" stroke="black" points="3023.5,-5499.27 3020,-5489.27 3016.5,-5499.27 3023.5,-5499.27"/>
</g>
<!-- moe_gate_dp3_ep2_tp0 -->
<g id="node704" class="node">
<title>moe_gate_dp3_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3264.85,-5399.98 2875.35,-5399.98 2775.15,-5295.98 3164.65,-5295.98 3264.85,-5399.98"/>
<text text-anchor="middle" x="3020" y="-5361.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3020" y="-5350.98" font-family="Times,serif" font-size="10.00">GPU 196</text>
<text text-anchor="middle" x="3020" y="-5339.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3020" y="-5328.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep2_tp0&#45;&gt;moe_gate_dp3_ep2_tp0 -->
<g id="edge809" class="edge">
<title>mha_dp3_ep2_tp0&#45;&gt;moe_gate_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M3020,-5436.9C3020,-5428.98 3020,-5419.84 3020,-5410.52"/>
<polygon fill="black" stroke="black" points="3023.5,-5410.38 3020,-5400.38 3016.5,-5410.38 3023.5,-5410.38"/>
</g>
<!-- expert1_dp3_ep2_tp0 -->
<g id="node705" class="node">
<title>expert1_dp3_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3011.5,-5218.98 2776.5,-5218.98 2776.5,-5166.98 3011.5,-5166.98 3011.5,-5218.98"/>
<text text-anchor="middle" x="2894" y="-5206.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2894" y="-5195.98" font-family="Times,serif" font-size="10.00">GPU 196</text>
<text text-anchor="middle" x="2894" y="-5184.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2894" y="-5173.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep2_tp0&#45;&gt;expert1_dp3_ep2_tp0 -->
<g id="edge810" class="edge">
<title>moe_gate_dp3_ep2_tp0&#45;&gt;expert1_dp3_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2977.69,-5295.61C2959.09,-5273.03 2937.79,-5247.15 2921.33,-5227.17"/>
<polygon fill="black" stroke="black" points="2923.88,-5224.76 2914.82,-5219.26 2918.47,-5229.21 2923.88,-5224.76"/>
<text text-anchor="middle" x="3017.5" y="-5266.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep2_tp0 -->
<g id="node706" class="node">
<title>expert2_dp3_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3264.5,-5218.98 3029.5,-5218.98 3029.5,-5166.98 3264.5,-5166.98 3264.5,-5218.98"/>
<text text-anchor="middle" x="3147" y="-5206.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3147" y="-5195.98" font-family="Times,serif" font-size="10.00">GPU 196</text>
<text text-anchor="middle" x="3147" y="-5184.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3147" y="-5173.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep2_tp0&#45;&gt;expert2_dp3_ep2_tp0 -->
<g id="edge811" class="edge">
<title>moe_gate_dp3_ep2_tp0&#45;&gt;expert2_dp3_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3063.97,-5295.87C3069.06,-5289.86 3074.16,-5283.8 3079,-5277.98 3092.9,-5261.28 3108.14,-5242.5 3120.66,-5226.94"/>
<polygon fill="black" stroke="black" points="3123.41,-5229.11 3126.94,-5219.12 3117.95,-5224.72 3123.41,-5229.11"/>
<text text-anchor="middle" x="3147.5" y="-5266.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep2_tp0 -->
<g id="node707" class="node">
<title>expert_agg_dp3_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3253.33,-5103.98 2875.79,-5103.98 2778.67,-4999.98 3156.21,-4999.98 3253.33,-5103.98"/>
<text text-anchor="middle" x="3016" y="-5065.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3016" y="-5054.98" font-family="Times,serif" font-size="10.00">GPU 196</text>
<text text-anchor="middle" x="3016" y="-5043.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3016" y="-5032.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep2_tp0&#45;&gt;expert_agg_dp3_ep2_tp0 -->
<g id="edge812" class="edge">
<title>expert1_dp3_ep2_tp0&#45;&gt;expert_agg_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M2916.09,-5166.81C2929.61,-5151.41 2947.5,-5131.02 2964.41,-5111.76"/>
<polygon fill="black" stroke="black" points="2967.11,-5113.99 2971.08,-5104.17 2961.85,-5109.37 2967.11,-5113.99"/>
</g>
<!-- expert2_dp3_ep2_tp0&#45;&gt;expert_agg_dp3_ep2_tp0 -->
<g id="edge813" class="edge">
<title>expert2_dp3_ep2_tp0&#45;&gt;expert_agg_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M3123.28,-5166.81C3108.7,-5151.34 3089.38,-5130.84 3071.16,-5111.51"/>
<polygon fill="black" stroke="black" points="3073.64,-5109.04 3064.24,-5104.17 3068.55,-5113.84 3073.64,-5109.04"/>
</g>
<!-- ln2_dp3_ep2_tp0 -->
<g id="node708" class="node">
<title>ln2_dp3_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3130.5,-4936.98 2901.5,-4936.98 2901.5,-4884.98 3130.5,-4884.98 3130.5,-4936.98"/>
<text text-anchor="middle" x="3016" y="-4924.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3016" y="-4913.98" font-family="Times,serif" font-size="10.00">GPU 196</text>
<text text-anchor="middle" x="3016" y="-4902.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3016" y="-4891.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep2_tp0&#45;&gt;ln2_dp3_ep2_tp0 -->
<g id="edge814" class="edge">
<title>expert_agg_dp3_ep2_tp0&#45;&gt;ln2_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M3016,-4999.62C3016,-4982.28 3016,-4963.31 3016,-4947.48"/>
<polygon fill="black" stroke="black" points="3019.5,-4947.07 3016,-4937.07 3012.5,-4947.07 3019.5,-4947.07"/>
</g>
<!-- ln1_dp3_ep3_tp0 -->
<g id="node716" class="node">
<title>ln1_dp3_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3130.5,-4800.98 2901.5,-4800.98 2901.5,-4748.98 3130.5,-4748.98 3130.5,-4800.98"/>
<text text-anchor="middle" x="3016" y="-4788.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3016" y="-4777.98" font-family="Times,serif" font-size="10.00">GPU 198</text>
<text text-anchor="middle" x="3016" y="-4766.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3016" y="-4755.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep2_tp0&#45;&gt;ln1_dp3_ep3_tp0 -->
<g id="edge815" class="edge">
<title>ln2_dp3_ep2_tp0&#45;&gt;ln1_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M3016,-4884.78C3016,-4864 3016,-4834.3 3016,-4811.18"/>
<polygon fill="black" stroke="black" points="3019.5,-4811.07 3016,-4801.07 3012.5,-4811.07 3019.5,-4811.07"/>
</g>
<!-- mha_dp3_ep2_tp1 -->
<g id="node710" class="node">
<title>mha_dp3_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3641.5,-5488.98 3412.5,-5488.98 3412.5,-5436.98 3641.5,-5436.98 3641.5,-5488.98"/>
<text text-anchor="middle" x="3527" y="-5476.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3527" y="-5465.98" font-family="Times,serif" font-size="10.00">GPU 197</text>
<text text-anchor="middle" x="3527" y="-5454.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3527" y="-5443.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep2_tp1&#45;&gt;mha_dp3_ep2_tp1 -->
<g id="edge816" class="edge">
<title>ln1_dp3_ep2_tp1&#45;&gt;mha_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M3527,-5546.93C3527,-5532.86 3527,-5515.06 3527,-5499.56"/>
<polygon fill="black" stroke="black" points="3530.5,-5499.27 3527,-5489.27 3523.5,-5499.27 3530.5,-5499.27"/>
</g>
<!-- moe_gate_dp3_ep2_tp1 -->
<g id="node711" class="node">
<title>moe_gate_dp3_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3771.85,-5399.98 3382.35,-5399.98 3282.15,-5295.98 3671.65,-5295.98 3771.85,-5399.98"/>
<text text-anchor="middle" x="3527" y="-5361.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3527" y="-5350.98" font-family="Times,serif" font-size="10.00">GPU 197</text>
<text text-anchor="middle" x="3527" y="-5339.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3527" y="-5328.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep2_tp1&#45;&gt;moe_gate_dp3_ep2_tp1 -->
<g id="edge817" class="edge">
<title>mha_dp3_ep2_tp1&#45;&gt;moe_gate_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M3527,-5436.9C3527,-5428.98 3527,-5419.84 3527,-5410.52"/>
<polygon fill="black" stroke="black" points="3530.5,-5410.38 3527,-5400.38 3523.5,-5410.38 3530.5,-5410.38"/>
</g>
<!-- expert1_dp3_ep2_tp1 -->
<g id="node712" class="node">
<title>expert1_dp3_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3517.5,-5218.98 3282.5,-5218.98 3282.5,-5166.98 3517.5,-5166.98 3517.5,-5218.98"/>
<text text-anchor="middle" x="3400" y="-5206.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3400" y="-5195.98" font-family="Times,serif" font-size="10.00">GPU 197</text>
<text text-anchor="middle" x="3400" y="-5184.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3400" y="-5173.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep2_tp1&#45;&gt;expert1_dp3_ep2_tp1 -->
<g id="edge818" class="edge">
<title>moe_gate_dp3_ep2_tp1&#45;&gt;expert1_dp3_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3482.2,-5295.95C3477.03,-5289.92 3471.88,-5283.84 3467,-5277.98 3453.3,-5261.54 3438.42,-5242.96 3426.17,-5227.46"/>
<polygon fill="black" stroke="black" points="3428.6,-5224.89 3419.66,-5219.2 3423.1,-5229.22 3428.6,-5224.89"/>
<text text-anchor="middle" x="3524.5" y="-5266.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep2_tp1 -->
<g id="node713" class="node">
<title>expert2_dp3_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3770.5,-5218.98 3535.5,-5218.98 3535.5,-5166.98 3770.5,-5166.98 3770.5,-5218.98"/>
<text text-anchor="middle" x="3653" y="-5206.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3653" y="-5195.98" font-family="Times,serif" font-size="10.00">GPU 197</text>
<text text-anchor="middle" x="3653" y="-5184.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3653" y="-5173.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep2_tp1&#45;&gt;expert2_dp3_ep2_tp1 -->
<g id="edge819" class="edge">
<title>moe_gate_dp3_ep2_tp1&#45;&gt;expert2_dp3_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3569.31,-5295.61C3587.91,-5273.03 3609.21,-5247.15 3625.67,-5227.17"/>
<polygon fill="black" stroke="black" points="3628.53,-5229.21 3632.18,-5219.26 3623.12,-5224.76 3628.53,-5229.21"/>
<text text-anchor="middle" x="3650.5" y="-5266.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep2_tp1 -->
<g id="node714" class="node">
<title>expert_agg_dp3_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3760.33,-5103.98 3382.79,-5103.98 3285.67,-4999.98 3663.21,-4999.98 3760.33,-5103.98"/>
<text text-anchor="middle" x="3523" y="-5065.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3523" y="-5054.98" font-family="Times,serif" font-size="10.00">GPU 197</text>
<text text-anchor="middle" x="3523" y="-5043.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3523" y="-5032.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep2_tp1&#45;&gt;expert_agg_dp3_ep2_tp1 -->
<g id="edge820" class="edge">
<title>expert1_dp3_ep2_tp1&#45;&gt;expert_agg_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M3422.27,-5166.81C3435.9,-5151.41 3453.94,-5131.02 3470.99,-5111.76"/>
<polygon fill="black" stroke="black" points="3473.7,-5113.97 3477.71,-5104.17 3468.46,-5109.33 3473.7,-5113.97"/>
</g>
<!-- expert2_dp3_ep2_tp1&#45;&gt;expert_agg_dp3_ep2_tp1 -->
<g id="edge821" class="edge">
<title>expert2_dp3_ep2_tp1&#45;&gt;expert_agg_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M3629.46,-5166.81C3614.99,-5151.34 3595.82,-5130.84 3577.73,-5111.51"/>
<polygon fill="black" stroke="black" points="3580.26,-5109.08 3570.87,-5104.17 3575.14,-5113.86 3580.26,-5109.08"/>
</g>
<!-- ln2_dp3_ep2_tp1 -->
<g id="node715" class="node">
<title>ln2_dp3_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3637.5,-4936.98 3408.5,-4936.98 3408.5,-4884.98 3637.5,-4884.98 3637.5,-4936.98"/>
<text text-anchor="middle" x="3523" y="-4924.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3523" y="-4913.98" font-family="Times,serif" font-size="10.00">GPU 197</text>
<text text-anchor="middle" x="3523" y="-4902.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3523" y="-4891.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep2_tp1&#45;&gt;ln2_dp3_ep2_tp1 -->
<g id="edge822" class="edge">
<title>expert_agg_dp3_ep2_tp1&#45;&gt;ln2_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M3523,-4999.62C3523,-4982.28 3523,-4963.31 3523,-4947.48"/>
<polygon fill="black" stroke="black" points="3526.5,-4947.07 3523,-4937.07 3519.5,-4947.07 3526.5,-4947.07"/>
</g>
<!-- ln1_dp3_ep3_tp1 -->
<g id="node723" class="node">
<title>ln1_dp3_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3637.5,-4800.98 3408.5,-4800.98 3408.5,-4748.98 3637.5,-4748.98 3637.5,-4800.98"/>
<text text-anchor="middle" x="3523" y="-4788.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3523" y="-4777.98" font-family="Times,serif" font-size="10.00">GPU 199</text>
<text text-anchor="middle" x="3523" y="-4766.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3523" y="-4755.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep2_tp1&#45;&gt;ln1_dp3_ep3_tp1 -->
<g id="edge823" class="edge">
<title>ln2_dp3_ep2_tp1&#45;&gt;ln1_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M3523,-4884.78C3523,-4864 3523,-4834.3 3523,-4811.18"/>
<polygon fill="black" stroke="black" points="3526.5,-4811.07 3523,-4801.07 3519.5,-4811.07 3526.5,-4811.07"/>
</g>
<!-- mha_dp3_ep3_tp0 -->
<g id="node717" class="node">
<title>mha_dp3_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3130.5,-4690.98 2901.5,-4690.98 2901.5,-4638.98 3130.5,-4638.98 3130.5,-4690.98"/>
<text text-anchor="middle" x="3016" y="-4678.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3016" y="-4667.98" font-family="Times,serif" font-size="10.00">GPU 198</text>
<text text-anchor="middle" x="3016" y="-4656.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3016" y="-4645.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep3_tp0&#45;&gt;mha_dp3_ep3_tp0 -->
<g id="edge824" class="edge">
<title>ln1_dp3_ep3_tp0&#45;&gt;mha_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M3016,-4748.93C3016,-4734.86 3016,-4717.06 3016,-4701.56"/>
<polygon fill="black" stroke="black" points="3019.5,-4701.27 3016,-4691.27 3012.5,-4701.27 3019.5,-4701.27"/>
</g>
<!-- moe_gate_dp3_ep3_tp0 -->
<g id="node718" class="node">
<title>moe_gate_dp3_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3260.85,-4601.98 2871.35,-4601.98 2771.15,-4497.98 3160.65,-4497.98 3260.85,-4601.98"/>
<text text-anchor="middle" x="3016" y="-4563.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3016" y="-4552.98" font-family="Times,serif" font-size="10.00">GPU 198</text>
<text text-anchor="middle" x="3016" y="-4541.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3016" y="-4530.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep3_tp0&#45;&gt;moe_gate_dp3_ep3_tp0 -->
<g id="edge825" class="edge">
<title>mha_dp3_ep3_tp0&#45;&gt;moe_gate_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M3016,-4638.9C3016,-4630.98 3016,-4621.84 3016,-4612.52"/>
<polygon fill="black" stroke="black" points="3019.5,-4612.38 3016,-4602.38 3012.5,-4612.38 3019.5,-4612.38"/>
</g>
<!-- expert1_dp3_ep3_tp0 -->
<g id="node719" class="node">
<title>expert1_dp3_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3007.5,-4420.98 2772.5,-4420.98 2772.5,-4368.98 3007.5,-4368.98 3007.5,-4420.98"/>
<text text-anchor="middle" x="2890" y="-4408.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2890" y="-4397.98" font-family="Times,serif" font-size="10.00">GPU 198</text>
<text text-anchor="middle" x="2890" y="-4386.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2890" y="-4375.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep3_tp0&#45;&gt;expert1_dp3_ep3_tp0 -->
<g id="edge826" class="edge">
<title>moe_gate_dp3_ep3_tp0&#45;&gt;expert1_dp3_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2973.69,-4497.61C2955.09,-4475.03 2933.79,-4449.15 2917.33,-4429.17"/>
<polygon fill="black" stroke="black" points="2919.88,-4426.76 2910.82,-4421.26 2914.47,-4431.21 2919.88,-4426.76"/>
<text text-anchor="middle" x="3013.5" y="-4468.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep3_tp0 -->
<g id="node720" class="node">
<title>expert2_dp3_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3260.5,-4420.98 3025.5,-4420.98 3025.5,-4368.98 3260.5,-4368.98 3260.5,-4420.98"/>
<text text-anchor="middle" x="3143" y="-4408.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3143" y="-4397.98" font-family="Times,serif" font-size="10.00">GPU 198</text>
<text text-anchor="middle" x="3143" y="-4386.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3143" y="-4375.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep3_tp0&#45;&gt;expert2_dp3_ep3_tp0 -->
<g id="edge827" class="edge">
<title>moe_gate_dp3_ep3_tp0&#45;&gt;expert2_dp3_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3059.97,-4497.87C3065.06,-4491.86 3070.16,-4485.8 3075,-4479.98 3088.9,-4463.28 3104.14,-4444.5 3116.66,-4428.94"/>
<polygon fill="black" stroke="black" points="3119.41,-4431.11 3122.94,-4421.12 3113.95,-4426.72 3119.41,-4431.11"/>
<text text-anchor="middle" x="3143.5" y="-4468.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep3_tp0 -->
<g id="node721" class="node">
<title>expert_agg_dp3_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3245.33,-4305.98 2867.79,-4305.98 2770.67,-4201.98 3148.21,-4201.98 3245.33,-4305.98"/>
<text text-anchor="middle" x="3008" y="-4267.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3008" y="-4256.98" font-family="Times,serif" font-size="10.00">GPU 198</text>
<text text-anchor="middle" x="3008" y="-4245.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3008" y="-4234.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep3_tp0&#45;&gt;expert_agg_dp3_ep3_tp0 -->
<g id="edge828" class="edge">
<title>expert1_dp3_ep3_tp0&#45;&gt;expert_agg_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M2911.37,-4368.81C2924.39,-4353.48 2941.6,-4333.2 2957.88,-4314.02"/>
<polygon fill="black" stroke="black" points="2960.75,-4316.05 2964.55,-4306.17 2955.41,-4311.52 2960.75,-4316.05"/>
</g>
<!-- expert2_dp3_ep3_tp0&#45;&gt;expert_agg_dp3_ep3_tp0 -->
<g id="edge829" class="edge">
<title>expert2_dp3_ep3_tp0&#45;&gt;expert_agg_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M3118.55,-4368.81C3103.53,-4353.34 3083.62,-4332.84 3064.84,-4313.51"/>
<polygon fill="black" stroke="black" points="3067.19,-4310.9 3057.71,-4306.17 3062.17,-4315.78 3067.19,-4310.9"/>
</g>
<!-- ln2_dp3_ep3_tp0 -->
<g id="node722" class="node">
<title>ln2_dp3_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3122.5,-4138.98 2893.5,-4138.98 2893.5,-4086.98 3122.5,-4086.98 3122.5,-4138.98"/>
<text text-anchor="middle" x="3008" y="-4126.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3008" y="-4115.98" font-family="Times,serif" font-size="10.00">GPU 198</text>
<text text-anchor="middle" x="3008" y="-4104.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3008" y="-4093.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep3_tp0&#45;&gt;ln2_dp3_ep3_tp0 -->
<g id="edge830" class="edge">
<title>expert_agg_dp3_ep3_tp0&#45;&gt;ln2_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M3008,-4201.62C3008,-4184.28 3008,-4165.31 3008,-4149.48"/>
<polygon fill="black" stroke="black" points="3011.5,-4149.07 3008,-4139.07 3004.5,-4149.07 3011.5,-4149.07"/>
</g>
<!-- ln1_dp3_ep4_tp0 -->
<g id="node730" class="node">
<title>ln1_dp3_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3122.5,-4002.98 2893.5,-4002.98 2893.5,-3950.98 3122.5,-3950.98 3122.5,-4002.98"/>
<text text-anchor="middle" x="3008" y="-3990.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3008" y="-3979.98" font-family="Times,serif" font-size="10.00">GPU 200</text>
<text text-anchor="middle" x="3008" y="-3968.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3008" y="-3957.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep3_tp0&#45;&gt;ln1_dp3_ep4_tp0 -->
<g id="edge831" class="edge">
<title>ln2_dp3_ep3_tp0&#45;&gt;ln1_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M3008,-4086.78C3008,-4066 3008,-4036.3 3008,-4013.18"/>
<polygon fill="black" stroke="black" points="3011.5,-4013.07 3008,-4003.07 3004.5,-4013.07 3011.5,-4013.07"/>
</g>
<!-- mha_dp3_ep3_tp1 -->
<g id="node724" class="node">
<title>mha_dp3_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3637.5,-4690.98 3408.5,-4690.98 3408.5,-4638.98 3637.5,-4638.98 3637.5,-4690.98"/>
<text text-anchor="middle" x="3523" y="-4678.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3523" y="-4667.98" font-family="Times,serif" font-size="10.00">GPU 199</text>
<text text-anchor="middle" x="3523" y="-4656.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3523" y="-4645.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep3_tp1&#45;&gt;mha_dp3_ep3_tp1 -->
<g id="edge832" class="edge">
<title>ln1_dp3_ep3_tp1&#45;&gt;mha_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M3523,-4748.93C3523,-4734.86 3523,-4717.06 3523,-4701.56"/>
<polygon fill="black" stroke="black" points="3526.5,-4701.27 3523,-4691.27 3519.5,-4701.27 3526.5,-4701.27"/>
</g>
<!-- moe_gate_dp3_ep3_tp1 -->
<g id="node725" class="node">
<title>moe_gate_dp3_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3767.85,-4601.98 3378.35,-4601.98 3278.15,-4497.98 3667.65,-4497.98 3767.85,-4601.98"/>
<text text-anchor="middle" x="3523" y="-4563.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3523" y="-4552.98" font-family="Times,serif" font-size="10.00">GPU 199</text>
<text text-anchor="middle" x="3523" y="-4541.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3523" y="-4530.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep3_tp1&#45;&gt;moe_gate_dp3_ep3_tp1 -->
<g id="edge833" class="edge">
<title>mha_dp3_ep3_tp1&#45;&gt;moe_gate_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M3523,-4638.9C3523,-4630.98 3523,-4621.84 3523,-4612.52"/>
<polygon fill="black" stroke="black" points="3526.5,-4612.38 3523,-4602.38 3519.5,-4612.38 3526.5,-4612.38"/>
</g>
<!-- expert1_dp3_ep3_tp1 -->
<g id="node726" class="node">
<title>expert1_dp3_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3513.5,-4420.98 3278.5,-4420.98 3278.5,-4368.98 3513.5,-4368.98 3513.5,-4420.98"/>
<text text-anchor="middle" x="3396" y="-4408.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3396" y="-4397.98" font-family="Times,serif" font-size="10.00">GPU 199</text>
<text text-anchor="middle" x="3396" y="-4386.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3396" y="-4375.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep3_tp1&#45;&gt;expert1_dp3_ep3_tp1 -->
<g id="edge834" class="edge">
<title>moe_gate_dp3_ep3_tp1&#45;&gt;expert1_dp3_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3478.2,-4497.95C3473.03,-4491.92 3467.88,-4485.84 3463,-4479.98 3449.3,-4463.54 3434.42,-4444.96 3422.17,-4429.46"/>
<polygon fill="black" stroke="black" points="3424.6,-4426.89 3415.66,-4421.2 3419.1,-4431.22 3424.6,-4426.89"/>
<text text-anchor="middle" x="3520.5" y="-4468.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep3_tp1 -->
<g id="node727" class="node">
<title>expert2_dp3_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3766.5,-4420.98 3531.5,-4420.98 3531.5,-4368.98 3766.5,-4368.98 3766.5,-4420.98"/>
<text text-anchor="middle" x="3649" y="-4408.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3649" y="-4397.98" font-family="Times,serif" font-size="10.00">GPU 199</text>
<text text-anchor="middle" x="3649" y="-4386.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3649" y="-4375.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep3_tp1&#45;&gt;expert2_dp3_ep3_tp1 -->
<g id="edge835" class="edge">
<title>moe_gate_dp3_ep3_tp1&#45;&gt;expert2_dp3_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3565.31,-4497.61C3583.91,-4475.03 3605.21,-4449.15 3621.67,-4429.17"/>
<polygon fill="black" stroke="black" points="3624.53,-4431.21 3628.18,-4421.26 3619.12,-4426.76 3624.53,-4431.21"/>
<text text-anchor="middle" x="3646.5" y="-4468.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep3_tp1 -->
<g id="node728" class="node">
<title>expert_agg_dp3_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3752.33,-4305.98 3374.79,-4305.98 3277.67,-4201.98 3655.21,-4201.98 3752.33,-4305.98"/>
<text text-anchor="middle" x="3515" y="-4267.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3515" y="-4256.98" font-family="Times,serif" font-size="10.00">GPU 199</text>
<text text-anchor="middle" x="3515" y="-4245.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3515" y="-4234.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep3_tp1&#45;&gt;expert_agg_dp3_ep3_tp1 -->
<g id="edge836" class="edge">
<title>expert1_dp3_ep3_tp1&#45;&gt;expert_agg_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M3417.55,-4368.81C3430.74,-4353.41 3448.19,-4333.02 3464.68,-4313.76"/>
<polygon fill="black" stroke="black" points="3467.34,-4316.04 3471.18,-4306.17 3462.02,-4311.49 3467.34,-4316.04"/>
</g>
<!-- expert2_dp3_ep3_tp1&#45;&gt;expert_agg_dp3_ep3_tp1 -->
<g id="edge837" class="edge">
<title>expert2_dp3_ep3_tp1&#45;&gt;expert_agg_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M3624.73,-4368.81C3609.82,-4353.34 3590.06,-4332.84 3571.42,-4313.51"/>
<polygon fill="black" stroke="black" points="3573.8,-4310.94 3564.34,-4306.17 3568.76,-4315.79 3573.8,-4310.94"/>
</g>
<!-- ln2_dp3_ep3_tp1 -->
<g id="node729" class="node">
<title>ln2_dp3_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3629.5,-4138.98 3400.5,-4138.98 3400.5,-4086.98 3629.5,-4086.98 3629.5,-4138.98"/>
<text text-anchor="middle" x="3515" y="-4126.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3515" y="-4115.98" font-family="Times,serif" font-size="10.00">GPU 199</text>
<text text-anchor="middle" x="3515" y="-4104.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3515" y="-4093.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep3_tp1&#45;&gt;ln2_dp3_ep3_tp1 -->
<g id="edge838" class="edge">
<title>expert_agg_dp3_ep3_tp1&#45;&gt;ln2_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M3515,-4201.62C3515,-4184.28 3515,-4165.31 3515,-4149.48"/>
<polygon fill="black" stroke="black" points="3518.5,-4149.07 3515,-4139.07 3511.5,-4149.07 3518.5,-4149.07"/>
</g>
<!-- ln1_dp3_ep4_tp1 -->
<g id="node737" class="node">
<title>ln1_dp3_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3629.5,-4002.98 3400.5,-4002.98 3400.5,-3950.98 3629.5,-3950.98 3629.5,-4002.98"/>
<text text-anchor="middle" x="3515" y="-3990.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3515" y="-3979.98" font-family="Times,serif" font-size="10.00">GPU 201</text>
<text text-anchor="middle" x="3515" y="-3968.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3515" y="-3957.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep3_tp1&#45;&gt;ln1_dp3_ep4_tp1 -->
<g id="edge839" class="edge">
<title>ln2_dp3_ep3_tp1&#45;&gt;ln1_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M3515,-4086.78C3515,-4066 3515,-4036.3 3515,-4013.18"/>
<polygon fill="black" stroke="black" points="3518.5,-4013.07 3515,-4003.07 3511.5,-4013.07 3518.5,-4013.07"/>
</g>
<!-- mha_dp3_ep4_tp0 -->
<g id="node731" class="node">
<title>mha_dp3_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3122.5,-3892.98 2893.5,-3892.98 2893.5,-3840.98 3122.5,-3840.98 3122.5,-3892.98"/>
<text text-anchor="middle" x="3008" y="-3880.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3008" y="-3869.98" font-family="Times,serif" font-size="10.00">GPU 200</text>
<text text-anchor="middle" x="3008" y="-3858.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3008" y="-3847.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep4_tp0&#45;&gt;mha_dp3_ep4_tp0 -->
<g id="edge840" class="edge">
<title>ln1_dp3_ep4_tp0&#45;&gt;mha_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M3008,-3950.93C3008,-3936.86 3008,-3919.06 3008,-3903.56"/>
<polygon fill="black" stroke="black" points="3011.5,-3903.27 3008,-3893.27 3004.5,-3903.27 3011.5,-3903.27"/>
</g>
<!-- moe_gate_dp3_ep4_tp0 -->
<g id="node732" class="node">
<title>moe_gate_dp3_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3252.85,-3803.98 2863.35,-3803.98 2763.15,-3699.98 3152.65,-3699.98 3252.85,-3803.98"/>
<text text-anchor="middle" x="3008" y="-3765.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3008" y="-3754.98" font-family="Times,serif" font-size="10.00">GPU 200</text>
<text text-anchor="middle" x="3008" y="-3743.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3008" y="-3732.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep4_tp0&#45;&gt;moe_gate_dp3_ep4_tp0 -->
<g id="edge841" class="edge">
<title>mha_dp3_ep4_tp0&#45;&gt;moe_gate_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M3008,-3840.9C3008,-3832.98 3008,-3823.84 3008,-3814.52"/>
<polygon fill="black" stroke="black" points="3011.5,-3814.38 3008,-3804.38 3004.5,-3814.38 3011.5,-3814.38"/>
</g>
<!-- expert1_dp3_ep4_tp0 -->
<g id="node733" class="node">
<title>expert1_dp3_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2999.5,-3622.98 2764.5,-3622.98 2764.5,-3570.98 2999.5,-3570.98 2999.5,-3622.98"/>
<text text-anchor="middle" x="2882" y="-3610.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2882" y="-3599.98" font-family="Times,serif" font-size="10.00">GPU 200</text>
<text text-anchor="middle" x="2882" y="-3588.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2882" y="-3577.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep4_tp0&#45;&gt;expert1_dp3_ep4_tp0 -->
<g id="edge842" class="edge">
<title>moe_gate_dp3_ep4_tp0&#45;&gt;expert1_dp3_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2965.69,-3699.61C2947.09,-3677.03 2925.79,-3651.15 2909.33,-3631.17"/>
<polygon fill="black" stroke="black" points="2911.88,-3628.76 2902.82,-3623.26 2906.47,-3633.21 2911.88,-3628.76"/>
<text text-anchor="middle" x="3005.5" y="-3670.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep4_tp0 -->
<g id="node734" class="node">
<title>expert2_dp3_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3252.5,-3622.98 3017.5,-3622.98 3017.5,-3570.98 3252.5,-3570.98 3252.5,-3622.98"/>
<text text-anchor="middle" x="3135" y="-3610.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3135" y="-3599.98" font-family="Times,serif" font-size="10.00">GPU 200</text>
<text text-anchor="middle" x="3135" y="-3588.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3135" y="-3577.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep4_tp0&#45;&gt;expert2_dp3_ep4_tp0 -->
<g id="edge843" class="edge">
<title>moe_gate_dp3_ep4_tp0&#45;&gt;expert2_dp3_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3051.97,-3699.87C3057.06,-3693.86 3062.16,-3687.8 3067,-3681.98 3080.9,-3665.28 3096.14,-3646.5 3108.66,-3630.94"/>
<polygon fill="black" stroke="black" points="3111.41,-3633.11 3114.94,-3623.12 3105.95,-3628.72 3111.41,-3633.11"/>
<text text-anchor="middle" x="3135.5" y="-3670.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep4_tp0 -->
<g id="node735" class="node">
<title>expert_agg_dp3_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3237.33,-3507.98 2859.79,-3507.98 2762.67,-3403.98 3140.21,-3403.98 3237.33,-3507.98"/>
<text text-anchor="middle" x="3000" y="-3469.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3000" y="-3458.98" font-family="Times,serif" font-size="10.00">GPU 200</text>
<text text-anchor="middle" x="3000" y="-3447.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3000" y="-3436.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep4_tp0&#45;&gt;expert_agg_dp3_ep4_tp0 -->
<g id="edge844" class="edge">
<title>expert1_dp3_ep4_tp0&#45;&gt;expert_agg_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M2903.37,-3570.81C2916.39,-3555.48 2933.6,-3535.2 2949.88,-3516.02"/>
<polygon fill="black" stroke="black" points="2952.75,-3518.05 2956.55,-3508.17 2947.41,-3513.52 2952.75,-3518.05"/>
</g>
<!-- expert2_dp3_ep4_tp0&#45;&gt;expert_agg_dp3_ep4_tp0 -->
<g id="edge845" class="edge">
<title>expert2_dp3_ep4_tp0&#45;&gt;expert_agg_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M3110.55,-3570.81C3095.53,-3555.34 3075.62,-3534.84 3056.84,-3515.51"/>
<polygon fill="black" stroke="black" points="3059.19,-3512.9 3049.71,-3508.17 3054.17,-3517.78 3059.19,-3512.9"/>
</g>
<!-- ln2_dp3_ep4_tp0 -->
<g id="node736" class="node">
<title>ln2_dp3_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3114.5,-3340.98 2885.5,-3340.98 2885.5,-3288.98 3114.5,-3288.98 3114.5,-3340.98"/>
<text text-anchor="middle" x="3000" y="-3328.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3000" y="-3317.98" font-family="Times,serif" font-size="10.00">GPU 200</text>
<text text-anchor="middle" x="3000" y="-3306.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3000" y="-3295.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep4_tp0&#45;&gt;ln2_dp3_ep4_tp0 -->
<g id="edge846" class="edge">
<title>expert_agg_dp3_ep4_tp0&#45;&gt;ln2_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M3000,-3403.62C3000,-3386.28 3000,-3367.31 3000,-3351.48"/>
<polygon fill="black" stroke="black" points="3003.5,-3351.07 3000,-3341.07 2996.5,-3351.07 3003.5,-3351.07"/>
</g>
<!-- ln1_dp3_ep5_tp0 -->
<g id="node744" class="node">
<title>ln1_dp3_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3114.5,-3204.98 2885.5,-3204.98 2885.5,-3152.98 3114.5,-3152.98 3114.5,-3204.98"/>
<text text-anchor="middle" x="3000" y="-3192.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3000" y="-3181.98" font-family="Times,serif" font-size="10.00">GPU 202</text>
<text text-anchor="middle" x="3000" y="-3170.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3000" y="-3159.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep4_tp0&#45;&gt;ln1_dp3_ep5_tp0 -->
<g id="edge847" class="edge">
<title>ln2_dp3_ep4_tp0&#45;&gt;ln1_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M3000,-3288.78C3000,-3268 3000,-3238.3 3000,-3215.18"/>
<polygon fill="black" stroke="black" points="3003.5,-3215.07 3000,-3205.07 2996.5,-3215.07 3003.5,-3215.07"/>
</g>
<!-- mha_dp3_ep4_tp1 -->
<g id="node738" class="node">
<title>mha_dp3_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3629.5,-3892.98 3400.5,-3892.98 3400.5,-3840.98 3629.5,-3840.98 3629.5,-3892.98"/>
<text text-anchor="middle" x="3515" y="-3880.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3515" y="-3869.98" font-family="Times,serif" font-size="10.00">GPU 201</text>
<text text-anchor="middle" x="3515" y="-3858.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3515" y="-3847.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep4_tp1&#45;&gt;mha_dp3_ep4_tp1 -->
<g id="edge848" class="edge">
<title>ln1_dp3_ep4_tp1&#45;&gt;mha_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M3515,-3950.93C3515,-3936.86 3515,-3919.06 3515,-3903.56"/>
<polygon fill="black" stroke="black" points="3518.5,-3903.27 3515,-3893.27 3511.5,-3903.27 3518.5,-3903.27"/>
</g>
<!-- moe_gate_dp3_ep4_tp1 -->
<g id="node739" class="node">
<title>moe_gate_dp3_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3759.85,-3803.98 3370.35,-3803.98 3270.15,-3699.98 3659.65,-3699.98 3759.85,-3803.98"/>
<text text-anchor="middle" x="3515" y="-3765.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3515" y="-3754.98" font-family="Times,serif" font-size="10.00">GPU 201</text>
<text text-anchor="middle" x="3515" y="-3743.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3515" y="-3732.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep4_tp1&#45;&gt;moe_gate_dp3_ep4_tp1 -->
<g id="edge849" class="edge">
<title>mha_dp3_ep4_tp1&#45;&gt;moe_gate_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M3515,-3840.9C3515,-3832.98 3515,-3823.84 3515,-3814.52"/>
<polygon fill="black" stroke="black" points="3518.5,-3814.38 3515,-3804.38 3511.5,-3814.38 3518.5,-3814.38"/>
</g>
<!-- expert1_dp3_ep4_tp1 -->
<g id="node740" class="node">
<title>expert1_dp3_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3505.5,-3622.98 3270.5,-3622.98 3270.5,-3570.98 3505.5,-3570.98 3505.5,-3622.98"/>
<text text-anchor="middle" x="3388" y="-3610.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3388" y="-3599.98" font-family="Times,serif" font-size="10.00">GPU 201</text>
<text text-anchor="middle" x="3388" y="-3588.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3388" y="-3577.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep4_tp1&#45;&gt;expert1_dp3_ep4_tp1 -->
<g id="edge850" class="edge">
<title>moe_gate_dp3_ep4_tp1&#45;&gt;expert1_dp3_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3470.2,-3699.95C3465.03,-3693.92 3459.88,-3687.84 3455,-3681.98 3441.3,-3665.54 3426.42,-3646.96 3414.17,-3631.46"/>
<polygon fill="black" stroke="black" points="3416.6,-3628.89 3407.66,-3623.2 3411.1,-3633.22 3416.6,-3628.89"/>
<text text-anchor="middle" x="3512.5" y="-3670.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep4_tp1 -->
<g id="node741" class="node">
<title>expert2_dp3_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3758.5,-3622.98 3523.5,-3622.98 3523.5,-3570.98 3758.5,-3570.98 3758.5,-3622.98"/>
<text text-anchor="middle" x="3641" y="-3610.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3641" y="-3599.98" font-family="Times,serif" font-size="10.00">GPU 201</text>
<text text-anchor="middle" x="3641" y="-3588.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3641" y="-3577.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep4_tp1&#45;&gt;expert2_dp3_ep4_tp1 -->
<g id="edge851" class="edge">
<title>moe_gate_dp3_ep4_tp1&#45;&gt;expert2_dp3_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3557.31,-3699.61C3575.91,-3677.03 3597.21,-3651.15 3613.67,-3631.17"/>
<polygon fill="black" stroke="black" points="3616.53,-3633.21 3620.18,-3623.26 3611.12,-3628.76 3616.53,-3633.21"/>
<text text-anchor="middle" x="3638.5" y="-3670.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep4_tp1 -->
<g id="node742" class="node">
<title>expert_agg_dp3_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3744.33,-3507.98 3366.79,-3507.98 3269.67,-3403.98 3647.21,-3403.98 3744.33,-3507.98"/>
<text text-anchor="middle" x="3507" y="-3469.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3507" y="-3458.98" font-family="Times,serif" font-size="10.00">GPU 201</text>
<text text-anchor="middle" x="3507" y="-3447.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3507" y="-3436.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep4_tp1&#45;&gt;expert_agg_dp3_ep4_tp1 -->
<g id="edge852" class="edge">
<title>expert1_dp3_ep4_tp1&#45;&gt;expert_agg_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M3409.55,-3570.81C3422.74,-3555.41 3440.19,-3535.02 3456.68,-3515.76"/>
<polygon fill="black" stroke="black" points="3459.34,-3518.04 3463.18,-3508.17 3454.02,-3513.49 3459.34,-3518.04"/>
</g>
<!-- expert2_dp3_ep4_tp1&#45;&gt;expert_agg_dp3_ep4_tp1 -->
<g id="edge853" class="edge">
<title>expert2_dp3_ep4_tp1&#45;&gt;expert_agg_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M3616.73,-3570.81C3601.82,-3555.34 3582.06,-3534.84 3563.42,-3515.51"/>
<polygon fill="black" stroke="black" points="3565.8,-3512.94 3556.34,-3508.17 3560.76,-3517.79 3565.8,-3512.94"/>
</g>
<!-- ln2_dp3_ep4_tp1 -->
<g id="node743" class="node">
<title>ln2_dp3_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3621.5,-3340.98 3392.5,-3340.98 3392.5,-3288.98 3621.5,-3288.98 3621.5,-3340.98"/>
<text text-anchor="middle" x="3507" y="-3328.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3507" y="-3317.98" font-family="Times,serif" font-size="10.00">GPU 201</text>
<text text-anchor="middle" x="3507" y="-3306.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3507" y="-3295.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep4_tp1&#45;&gt;ln2_dp3_ep4_tp1 -->
<g id="edge854" class="edge">
<title>expert_agg_dp3_ep4_tp1&#45;&gt;ln2_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M3507,-3403.62C3507,-3386.28 3507,-3367.31 3507,-3351.48"/>
<polygon fill="black" stroke="black" points="3510.5,-3351.07 3507,-3341.07 3503.5,-3351.07 3510.5,-3351.07"/>
</g>
<!-- ln1_dp3_ep5_tp1 -->
<g id="node751" class="node">
<title>ln1_dp3_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3621.5,-3204.98 3392.5,-3204.98 3392.5,-3152.98 3621.5,-3152.98 3621.5,-3204.98"/>
<text text-anchor="middle" x="3507" y="-3192.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3507" y="-3181.98" font-family="Times,serif" font-size="10.00">GPU 203</text>
<text text-anchor="middle" x="3507" y="-3170.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3507" y="-3159.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep4_tp1&#45;&gt;ln1_dp3_ep5_tp1 -->
<g id="edge855" class="edge">
<title>ln2_dp3_ep4_tp1&#45;&gt;ln1_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M3507,-3288.78C3507,-3268 3507,-3238.3 3507,-3215.18"/>
<polygon fill="black" stroke="black" points="3510.5,-3215.07 3507,-3205.07 3503.5,-3215.07 3510.5,-3215.07"/>
</g>
<!-- mha_dp3_ep5_tp0 -->
<g id="node745" class="node">
<title>mha_dp3_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3114.5,-3094.98 2885.5,-3094.98 2885.5,-3042.98 3114.5,-3042.98 3114.5,-3094.98"/>
<text text-anchor="middle" x="3000" y="-3082.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3000" y="-3071.98" font-family="Times,serif" font-size="10.00">GPU 202</text>
<text text-anchor="middle" x="3000" y="-3060.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3000" y="-3049.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep5_tp0&#45;&gt;mha_dp3_ep5_tp0 -->
<g id="edge856" class="edge">
<title>ln1_dp3_ep5_tp0&#45;&gt;mha_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M3000,-3152.93C3000,-3138.86 3000,-3121.06 3000,-3105.56"/>
<polygon fill="black" stroke="black" points="3003.5,-3105.27 3000,-3095.27 2996.5,-3105.27 3003.5,-3105.27"/>
</g>
<!-- moe_gate_dp3_ep5_tp0 -->
<g id="node746" class="node">
<title>moe_gate_dp3_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3244.85,-3005.98 2855.35,-3005.98 2755.15,-2901.98 3144.65,-2901.98 3244.85,-3005.98"/>
<text text-anchor="middle" x="3000" y="-2967.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3000" y="-2956.98" font-family="Times,serif" font-size="10.00">GPU 202</text>
<text text-anchor="middle" x="3000" y="-2945.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3000" y="-2934.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep5_tp0&#45;&gt;moe_gate_dp3_ep5_tp0 -->
<g id="edge857" class="edge">
<title>mha_dp3_ep5_tp0&#45;&gt;moe_gate_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M3000,-3042.9C3000,-3034.98 3000,-3025.84 3000,-3016.52"/>
<polygon fill="black" stroke="black" points="3003.5,-3016.38 3000,-3006.38 2996.5,-3016.38 3003.5,-3016.38"/>
</g>
<!-- expert1_dp3_ep5_tp0 -->
<g id="node747" class="node">
<title>expert1_dp3_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2991.5,-2824.98 2756.5,-2824.98 2756.5,-2772.98 2991.5,-2772.98 2991.5,-2824.98"/>
<text text-anchor="middle" x="2874" y="-2812.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2874" y="-2801.98" font-family="Times,serif" font-size="10.00">GPU 202</text>
<text text-anchor="middle" x="2874" y="-2790.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2874" y="-2779.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep5_tp0&#45;&gt;expert1_dp3_ep5_tp0 -->
<g id="edge858" class="edge">
<title>moe_gate_dp3_ep5_tp0&#45;&gt;expert1_dp3_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2957.69,-2901.61C2939.09,-2879.03 2917.79,-2853.15 2901.33,-2833.17"/>
<polygon fill="black" stroke="black" points="2903.88,-2830.76 2894.82,-2825.26 2898.47,-2835.21 2903.88,-2830.76"/>
<text text-anchor="middle" x="2997.5" y="-2872.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep5_tp0 -->
<g id="node748" class="node">
<title>expert2_dp3_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3244.5,-2824.98 3009.5,-2824.98 3009.5,-2772.98 3244.5,-2772.98 3244.5,-2824.98"/>
<text text-anchor="middle" x="3127" y="-2812.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3127" y="-2801.98" font-family="Times,serif" font-size="10.00">GPU 202</text>
<text text-anchor="middle" x="3127" y="-2790.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3127" y="-2779.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep5_tp0&#45;&gt;expert2_dp3_ep5_tp0 -->
<g id="edge859" class="edge">
<title>moe_gate_dp3_ep5_tp0&#45;&gt;expert2_dp3_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3043.97,-2901.87C3049.06,-2895.86 3054.16,-2889.8 3059,-2883.98 3072.9,-2867.28 3088.14,-2848.5 3100.66,-2832.94"/>
<polygon fill="black" stroke="black" points="3103.41,-2835.11 3106.94,-2825.12 3097.95,-2830.72 3103.41,-2835.11"/>
<text text-anchor="middle" x="3127.5" y="-2872.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep5_tp0 -->
<g id="node749" class="node">
<title>expert_agg_dp3_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3229.33,-2709.98 2851.79,-2709.98 2754.67,-2605.98 3132.21,-2605.98 3229.33,-2709.98"/>
<text text-anchor="middle" x="2992" y="-2671.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2992" y="-2660.98" font-family="Times,serif" font-size="10.00">GPU 202</text>
<text text-anchor="middle" x="2992" y="-2649.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2992" y="-2638.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep5_tp0&#45;&gt;expert_agg_dp3_ep5_tp0 -->
<g id="edge860" class="edge">
<title>expert1_dp3_ep5_tp0&#45;&gt;expert_agg_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M2895.37,-2772.81C2908.39,-2757.48 2925.6,-2737.2 2941.88,-2718.02"/>
<polygon fill="black" stroke="black" points="2944.75,-2720.05 2948.55,-2710.17 2939.41,-2715.52 2944.75,-2720.05"/>
</g>
<!-- expert2_dp3_ep5_tp0&#45;&gt;expert_agg_dp3_ep5_tp0 -->
<g id="edge861" class="edge">
<title>expert2_dp3_ep5_tp0&#45;&gt;expert_agg_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M3102.55,-2772.81C3087.53,-2757.34 3067.62,-2736.84 3048.84,-2717.51"/>
<polygon fill="black" stroke="black" points="3051.19,-2714.9 3041.71,-2710.17 3046.17,-2719.78 3051.19,-2714.9"/>
</g>
<!-- ln2_dp3_ep5_tp0 -->
<g id="node750" class="node">
<title>ln2_dp3_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3106.5,-2542.98 2877.5,-2542.98 2877.5,-2490.98 3106.5,-2490.98 3106.5,-2542.98"/>
<text text-anchor="middle" x="2992" y="-2530.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2992" y="-2519.98" font-family="Times,serif" font-size="10.00">GPU 202</text>
<text text-anchor="middle" x="2992" y="-2508.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2992" y="-2497.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep5_tp0&#45;&gt;ln2_dp3_ep5_tp0 -->
<g id="edge862" class="edge">
<title>expert_agg_dp3_ep5_tp0&#45;&gt;ln2_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M2992,-2605.62C2992,-2588.28 2992,-2569.31 2992,-2553.48"/>
<polygon fill="black" stroke="black" points="2995.5,-2553.07 2992,-2543.07 2988.5,-2553.07 2995.5,-2553.07"/>
</g>
<!-- ln1_dp3_ep6_tp0 -->
<g id="node758" class="node">
<title>ln1_dp3_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3106.5,-2406.98 2877.5,-2406.98 2877.5,-2354.98 3106.5,-2354.98 3106.5,-2406.98"/>
<text text-anchor="middle" x="2992" y="-2394.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2992" y="-2383.98" font-family="Times,serif" font-size="10.00">GPU 204</text>
<text text-anchor="middle" x="2992" y="-2372.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2992" y="-2361.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep5_tp0&#45;&gt;ln1_dp3_ep6_tp0 -->
<g id="edge863" class="edge">
<title>ln2_dp3_ep5_tp0&#45;&gt;ln1_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M2992,-2490.78C2992,-2470 2992,-2440.3 2992,-2417.18"/>
<polygon fill="black" stroke="black" points="2995.5,-2417.07 2992,-2407.07 2988.5,-2417.07 2995.5,-2417.07"/>
</g>
<!-- mha_dp3_ep5_tp1 -->
<g id="node752" class="node">
<title>mha_dp3_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3621.5,-3094.98 3392.5,-3094.98 3392.5,-3042.98 3621.5,-3042.98 3621.5,-3094.98"/>
<text text-anchor="middle" x="3507" y="-3082.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3507" y="-3071.98" font-family="Times,serif" font-size="10.00">GPU 203</text>
<text text-anchor="middle" x="3507" y="-3060.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3507" y="-3049.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep5_tp1&#45;&gt;mha_dp3_ep5_tp1 -->
<g id="edge864" class="edge">
<title>ln1_dp3_ep5_tp1&#45;&gt;mha_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M3507,-3152.93C3507,-3138.86 3507,-3121.06 3507,-3105.56"/>
<polygon fill="black" stroke="black" points="3510.5,-3105.27 3507,-3095.27 3503.5,-3105.27 3510.5,-3105.27"/>
</g>
<!-- moe_gate_dp3_ep5_tp1 -->
<g id="node753" class="node">
<title>moe_gate_dp3_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3751.85,-3005.98 3362.35,-3005.98 3262.15,-2901.98 3651.65,-2901.98 3751.85,-3005.98"/>
<text text-anchor="middle" x="3507" y="-2967.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3507" y="-2956.98" font-family="Times,serif" font-size="10.00">GPU 203</text>
<text text-anchor="middle" x="3507" y="-2945.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3507" y="-2934.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep5_tp1&#45;&gt;moe_gate_dp3_ep5_tp1 -->
<g id="edge865" class="edge">
<title>mha_dp3_ep5_tp1&#45;&gt;moe_gate_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M3507,-3042.9C3507,-3034.98 3507,-3025.84 3507,-3016.52"/>
<polygon fill="black" stroke="black" points="3510.5,-3016.38 3507,-3006.38 3503.5,-3016.38 3510.5,-3016.38"/>
</g>
<!-- expert1_dp3_ep5_tp1 -->
<g id="node754" class="node">
<title>expert1_dp3_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3497.5,-2824.98 3262.5,-2824.98 3262.5,-2772.98 3497.5,-2772.98 3497.5,-2824.98"/>
<text text-anchor="middle" x="3380" y="-2812.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3380" y="-2801.98" font-family="Times,serif" font-size="10.00">GPU 203</text>
<text text-anchor="middle" x="3380" y="-2790.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3380" y="-2779.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep5_tp1&#45;&gt;expert1_dp3_ep5_tp1 -->
<g id="edge866" class="edge">
<title>moe_gate_dp3_ep5_tp1&#45;&gt;expert1_dp3_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3462.2,-2901.95C3457.03,-2895.92 3451.88,-2889.84 3447,-2883.98 3433.3,-2867.54 3418.42,-2848.96 3406.17,-2833.46"/>
<polygon fill="black" stroke="black" points="3408.6,-2830.89 3399.66,-2825.2 3403.1,-2835.22 3408.6,-2830.89"/>
<text text-anchor="middle" x="3504.5" y="-2872.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep5_tp1 -->
<g id="node755" class="node">
<title>expert2_dp3_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3750.5,-2824.98 3515.5,-2824.98 3515.5,-2772.98 3750.5,-2772.98 3750.5,-2824.98"/>
<text text-anchor="middle" x="3633" y="-2812.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3633" y="-2801.98" font-family="Times,serif" font-size="10.00">GPU 203</text>
<text text-anchor="middle" x="3633" y="-2790.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3633" y="-2779.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep5_tp1&#45;&gt;expert2_dp3_ep5_tp1 -->
<g id="edge867" class="edge">
<title>moe_gate_dp3_ep5_tp1&#45;&gt;expert2_dp3_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3549.31,-2901.61C3567.91,-2879.03 3589.21,-2853.15 3605.67,-2833.17"/>
<polygon fill="black" stroke="black" points="3608.53,-2835.21 3612.18,-2825.26 3603.12,-2830.76 3608.53,-2835.21"/>
<text text-anchor="middle" x="3630.5" y="-2872.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep5_tp1 -->
<g id="node756" class="node">
<title>expert_agg_dp3_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3736.33,-2709.98 3358.79,-2709.98 3261.67,-2605.98 3639.21,-2605.98 3736.33,-2709.98"/>
<text text-anchor="middle" x="3499" y="-2671.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3499" y="-2660.98" font-family="Times,serif" font-size="10.00">GPU 203</text>
<text text-anchor="middle" x="3499" y="-2649.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3499" y="-2638.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep5_tp1&#45;&gt;expert_agg_dp3_ep5_tp1 -->
<g id="edge868" class="edge">
<title>expert1_dp3_ep5_tp1&#45;&gt;expert_agg_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M3401.55,-2772.81C3414.74,-2757.41 3432.19,-2737.02 3448.68,-2717.76"/>
<polygon fill="black" stroke="black" points="3451.34,-2720.04 3455.18,-2710.17 3446.02,-2715.49 3451.34,-2720.04"/>
</g>
<!-- expert2_dp3_ep5_tp1&#45;&gt;expert_agg_dp3_ep5_tp1 -->
<g id="edge869" class="edge">
<title>expert2_dp3_ep5_tp1&#45;&gt;expert_agg_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M3608.73,-2772.81C3593.82,-2757.34 3574.06,-2736.84 3555.42,-2717.51"/>
<polygon fill="black" stroke="black" points="3557.8,-2714.94 3548.34,-2710.17 3552.76,-2719.79 3557.8,-2714.94"/>
</g>
<!-- ln2_dp3_ep5_tp1 -->
<g id="node757" class="node">
<title>ln2_dp3_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3613.5,-2542.98 3384.5,-2542.98 3384.5,-2490.98 3613.5,-2490.98 3613.5,-2542.98"/>
<text text-anchor="middle" x="3499" y="-2530.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3499" y="-2519.98" font-family="Times,serif" font-size="10.00">GPU 203</text>
<text text-anchor="middle" x="3499" y="-2508.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3499" y="-2497.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep5_tp1&#45;&gt;ln2_dp3_ep5_tp1 -->
<g id="edge870" class="edge">
<title>expert_agg_dp3_ep5_tp1&#45;&gt;ln2_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M3499,-2605.62C3499,-2588.28 3499,-2569.31 3499,-2553.48"/>
<polygon fill="black" stroke="black" points="3502.5,-2553.07 3499,-2543.07 3495.5,-2553.07 3502.5,-2553.07"/>
</g>
<!-- ln1_dp3_ep6_tp1 -->
<g id="node765" class="node">
<title>ln1_dp3_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3613.5,-2406.98 3384.5,-2406.98 3384.5,-2354.98 3613.5,-2354.98 3613.5,-2406.98"/>
<text text-anchor="middle" x="3499" y="-2394.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3499" y="-2383.98" font-family="Times,serif" font-size="10.00">GPU 205</text>
<text text-anchor="middle" x="3499" y="-2372.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3499" y="-2361.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep5_tp1&#45;&gt;ln1_dp3_ep6_tp1 -->
<g id="edge871" class="edge">
<title>ln2_dp3_ep5_tp1&#45;&gt;ln1_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M3499,-2490.78C3499,-2470 3499,-2440.3 3499,-2417.18"/>
<polygon fill="black" stroke="black" points="3502.5,-2417.07 3499,-2407.07 3495.5,-2417.07 3502.5,-2417.07"/>
</g>
<!-- mha_dp3_ep6_tp0 -->
<g id="node759" class="node">
<title>mha_dp3_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3106.5,-2296.98 2877.5,-2296.98 2877.5,-2244.98 3106.5,-2244.98 3106.5,-2296.98"/>
<text text-anchor="middle" x="2992" y="-2284.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2992" y="-2273.98" font-family="Times,serif" font-size="10.00">GPU 204</text>
<text text-anchor="middle" x="2992" y="-2262.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2992" y="-2251.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep6_tp0&#45;&gt;mha_dp3_ep6_tp0 -->
<g id="edge872" class="edge">
<title>ln1_dp3_ep6_tp0&#45;&gt;mha_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M2992,-2354.93C2992,-2340.86 2992,-2323.06 2992,-2307.56"/>
<polygon fill="black" stroke="black" points="2995.5,-2307.27 2992,-2297.27 2988.5,-2307.27 2995.5,-2307.27"/>
</g>
<!-- moe_gate_dp3_ep6_tp0 -->
<g id="node760" class="node">
<title>moe_gate_dp3_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3236.85,-2207.98 2847.35,-2207.98 2747.15,-2103.98 3136.65,-2103.98 3236.85,-2207.98"/>
<text text-anchor="middle" x="2992" y="-2169.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2992" y="-2158.98" font-family="Times,serif" font-size="10.00">GPU 204</text>
<text text-anchor="middle" x="2992" y="-2147.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2992" y="-2136.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep6_tp0&#45;&gt;moe_gate_dp3_ep6_tp0 -->
<g id="edge873" class="edge">
<title>mha_dp3_ep6_tp0&#45;&gt;moe_gate_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M2992,-2244.9C2992,-2236.98 2992,-2227.84 2992,-2218.52"/>
<polygon fill="black" stroke="black" points="2995.5,-2218.38 2992,-2208.38 2988.5,-2218.38 2995.5,-2218.38"/>
</g>
<!-- expert1_dp3_ep6_tp0 -->
<g id="node761" class="node">
<title>expert1_dp3_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2983.5,-2026.98 2748.5,-2026.98 2748.5,-1974.98 2983.5,-1974.98 2983.5,-2026.98"/>
<text text-anchor="middle" x="2866" y="-2014.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2866" y="-2003.98" font-family="Times,serif" font-size="10.00">GPU 204</text>
<text text-anchor="middle" x="2866" y="-1992.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2866" y="-1981.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep6_tp0&#45;&gt;expert1_dp3_ep6_tp0 -->
<g id="edge874" class="edge">
<title>moe_gate_dp3_ep6_tp0&#45;&gt;expert1_dp3_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2949.69,-2103.61C2931.09,-2081.03 2909.79,-2055.15 2893.33,-2035.17"/>
<polygon fill="black" stroke="black" points="2895.88,-2032.76 2886.82,-2027.26 2890.47,-2037.21 2895.88,-2032.76"/>
<text text-anchor="middle" x="2989.5" y="-2074.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep6_tp0 -->
<g id="node762" class="node">
<title>expert2_dp3_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3236.5,-2026.98 3001.5,-2026.98 3001.5,-1974.98 3236.5,-1974.98 3236.5,-2026.98"/>
<text text-anchor="middle" x="3119" y="-2014.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3119" y="-2003.98" font-family="Times,serif" font-size="10.00">GPU 204</text>
<text text-anchor="middle" x="3119" y="-1992.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3119" y="-1981.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep6_tp0&#45;&gt;expert2_dp3_ep6_tp0 -->
<g id="edge875" class="edge">
<title>moe_gate_dp3_ep6_tp0&#45;&gt;expert2_dp3_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3035.97,-2103.87C3041.06,-2097.86 3046.16,-2091.8 3051,-2085.98 3064.9,-2069.28 3080.14,-2050.5 3092.66,-2034.94"/>
<polygon fill="black" stroke="black" points="3095.41,-2037.11 3098.94,-2027.12 3089.95,-2032.72 3095.41,-2037.11"/>
<text text-anchor="middle" x="3119.5" y="-2074.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep6_tp0 -->
<g id="node763" class="node">
<title>expert_agg_dp3_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3221.33,-1911.98 2843.79,-1911.98 2746.67,-1807.98 3124.21,-1807.98 3221.33,-1911.98"/>
<text text-anchor="middle" x="2984" y="-1873.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2984" y="-1862.98" font-family="Times,serif" font-size="10.00">GPU 204</text>
<text text-anchor="middle" x="2984" y="-1851.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2984" y="-1840.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep6_tp0&#45;&gt;expert_agg_dp3_ep6_tp0 -->
<g id="edge876" class="edge">
<title>expert1_dp3_ep6_tp0&#45;&gt;expert_agg_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M2887.37,-1974.81C2900.39,-1959.48 2917.6,-1939.2 2933.88,-1920.02"/>
<polygon fill="black" stroke="black" points="2936.75,-1922.05 2940.55,-1912.17 2931.41,-1917.52 2936.75,-1922.05"/>
</g>
<!-- expert2_dp3_ep6_tp0&#45;&gt;expert_agg_dp3_ep6_tp0 -->
<g id="edge877" class="edge">
<title>expert2_dp3_ep6_tp0&#45;&gt;expert_agg_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M3094.55,-1974.81C3079.53,-1959.34 3059.62,-1938.84 3040.84,-1919.51"/>
<polygon fill="black" stroke="black" points="3043.19,-1916.9 3033.71,-1912.17 3038.17,-1921.78 3043.19,-1916.9"/>
</g>
<!-- ln2_dp3_ep6_tp0 -->
<g id="node764" class="node">
<title>ln2_dp3_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3098.5,-1744.98 2869.5,-1744.98 2869.5,-1692.98 3098.5,-1692.98 3098.5,-1744.98"/>
<text text-anchor="middle" x="2984" y="-1732.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2984" y="-1721.98" font-family="Times,serif" font-size="10.00">GPU 204</text>
<text text-anchor="middle" x="2984" y="-1710.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2984" y="-1699.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep6_tp0&#45;&gt;ln2_dp3_ep6_tp0 -->
<g id="edge878" class="edge">
<title>expert_agg_dp3_ep6_tp0&#45;&gt;ln2_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M2984,-1807.62C2984,-1790.28 2984,-1771.31 2984,-1755.48"/>
<polygon fill="black" stroke="black" points="2987.5,-1755.07 2984,-1745.07 2980.5,-1755.07 2987.5,-1755.07"/>
</g>
<!-- ln1_dp3_ep7_tp0 -->
<g id="node772" class="node">
<title>ln1_dp3_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3098.5,-1608.98 2869.5,-1608.98 2869.5,-1556.98 3098.5,-1556.98 3098.5,-1608.98"/>
<text text-anchor="middle" x="2984" y="-1596.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2984" y="-1585.98" font-family="Times,serif" font-size="10.00">GPU 206</text>
<text text-anchor="middle" x="2984" y="-1574.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2984" y="-1563.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep6_tp0&#45;&gt;ln1_dp3_ep7_tp0 -->
<g id="edge879" class="edge">
<title>ln2_dp3_ep6_tp0&#45;&gt;ln1_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2984,-1692.78C2984,-1672 2984,-1642.3 2984,-1619.18"/>
<polygon fill="black" stroke="black" points="2987.5,-1619.07 2984,-1609.07 2980.5,-1619.07 2987.5,-1619.07"/>
</g>
<!-- mha_dp3_ep6_tp1 -->
<g id="node766" class="node">
<title>mha_dp3_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3613.5,-2296.98 3384.5,-2296.98 3384.5,-2244.98 3613.5,-2244.98 3613.5,-2296.98"/>
<text text-anchor="middle" x="3499" y="-2284.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3499" y="-2273.98" font-family="Times,serif" font-size="10.00">GPU 205</text>
<text text-anchor="middle" x="3499" y="-2262.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3499" y="-2251.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep6_tp1&#45;&gt;mha_dp3_ep6_tp1 -->
<g id="edge880" class="edge">
<title>ln1_dp3_ep6_tp1&#45;&gt;mha_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M3499,-2354.93C3499,-2340.86 3499,-2323.06 3499,-2307.56"/>
<polygon fill="black" stroke="black" points="3502.5,-2307.27 3499,-2297.27 3495.5,-2307.27 3502.5,-2307.27"/>
</g>
<!-- moe_gate_dp3_ep6_tp1 -->
<g id="node767" class="node">
<title>moe_gate_dp3_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3743.85,-2207.98 3354.35,-2207.98 3254.15,-2103.98 3643.65,-2103.98 3743.85,-2207.98"/>
<text text-anchor="middle" x="3499" y="-2169.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3499" y="-2158.98" font-family="Times,serif" font-size="10.00">GPU 205</text>
<text text-anchor="middle" x="3499" y="-2147.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3499" y="-2136.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep6_tp1&#45;&gt;moe_gate_dp3_ep6_tp1 -->
<g id="edge881" class="edge">
<title>mha_dp3_ep6_tp1&#45;&gt;moe_gate_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M3499,-2244.9C3499,-2236.98 3499,-2227.84 3499,-2218.52"/>
<polygon fill="black" stroke="black" points="3502.5,-2218.38 3499,-2208.38 3495.5,-2218.38 3502.5,-2218.38"/>
</g>
<!-- expert1_dp3_ep6_tp1 -->
<g id="node768" class="node">
<title>expert1_dp3_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3490.5,-2026.98 3255.5,-2026.98 3255.5,-1974.98 3490.5,-1974.98 3490.5,-2026.98"/>
<text text-anchor="middle" x="3373" y="-2014.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3373" y="-2003.98" font-family="Times,serif" font-size="10.00">GPU 205</text>
<text text-anchor="middle" x="3373" y="-1992.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3373" y="-1981.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep6_tp1&#45;&gt;expert1_dp3_ep6_tp1 -->
<g id="edge882" class="edge">
<title>moe_gate_dp3_ep6_tp1&#45;&gt;expert1_dp3_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3456.69,-2103.61C3438.09,-2081.03 3416.79,-2055.15 3400.33,-2035.17"/>
<polygon fill="black" stroke="black" points="3402.88,-2032.76 3393.82,-2027.26 3397.47,-2037.21 3402.88,-2032.76"/>
<text text-anchor="middle" x="3496.5" y="-2074.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep6_tp1 -->
<g id="node769" class="node">
<title>expert2_dp3_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3743.5,-2026.98 3508.5,-2026.98 3508.5,-1974.98 3743.5,-1974.98 3743.5,-2026.98"/>
<text text-anchor="middle" x="3626" y="-2014.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3626" y="-2003.98" font-family="Times,serif" font-size="10.00">GPU 205</text>
<text text-anchor="middle" x="3626" y="-1992.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3626" y="-1981.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep6_tp1&#45;&gt;expert2_dp3_ep6_tp1 -->
<g id="edge883" class="edge">
<title>moe_gate_dp3_ep6_tp1&#45;&gt;expert2_dp3_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3542.97,-2103.87C3548.06,-2097.86 3553.16,-2091.8 3558,-2085.98 3571.9,-2069.28 3587.14,-2050.5 3599.66,-2034.94"/>
<polygon fill="black" stroke="black" points="3602.41,-2037.11 3605.94,-2027.12 3596.95,-2032.72 3602.41,-2037.11"/>
<text text-anchor="middle" x="3626.5" y="-2074.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep6_tp1 -->
<g id="node770" class="node">
<title>expert_agg_dp3_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3728.33,-1911.98 3350.79,-1911.98 3253.67,-1807.98 3631.21,-1807.98 3728.33,-1911.98"/>
<text text-anchor="middle" x="3491" y="-1873.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3491" y="-1862.98" font-family="Times,serif" font-size="10.00">GPU 205</text>
<text text-anchor="middle" x="3491" y="-1851.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3491" y="-1840.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep6_tp1&#45;&gt;expert_agg_dp3_ep6_tp1 -->
<g id="edge884" class="edge">
<title>expert1_dp3_ep6_tp1&#45;&gt;expert_agg_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M3394.37,-1974.81C3407.39,-1959.48 3424.6,-1939.2 3440.88,-1920.02"/>
<polygon fill="black" stroke="black" points="3443.75,-1922.05 3447.55,-1912.17 3438.41,-1917.52 3443.75,-1922.05"/>
</g>
<!-- expert2_dp3_ep6_tp1&#45;&gt;expert_agg_dp3_ep6_tp1 -->
<g id="edge885" class="edge">
<title>expert2_dp3_ep6_tp1&#45;&gt;expert_agg_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M3601.55,-1974.81C3586.53,-1959.34 3566.62,-1938.84 3547.84,-1919.51"/>
<polygon fill="black" stroke="black" points="3550.19,-1916.9 3540.71,-1912.17 3545.17,-1921.78 3550.19,-1916.9"/>
</g>
<!-- ln2_dp3_ep6_tp1 -->
<g id="node771" class="node">
<title>ln2_dp3_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3605.5,-1744.98 3376.5,-1744.98 3376.5,-1692.98 3605.5,-1692.98 3605.5,-1744.98"/>
<text text-anchor="middle" x="3491" y="-1732.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3491" y="-1721.98" font-family="Times,serif" font-size="10.00">GPU 205</text>
<text text-anchor="middle" x="3491" y="-1710.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3491" y="-1699.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep6_tp1&#45;&gt;ln2_dp3_ep6_tp1 -->
<g id="edge886" class="edge">
<title>expert_agg_dp3_ep6_tp1&#45;&gt;ln2_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M3491,-1807.62C3491,-1790.28 3491,-1771.31 3491,-1755.48"/>
<polygon fill="black" stroke="black" points="3494.5,-1755.07 3491,-1745.07 3487.5,-1755.07 3494.5,-1755.07"/>
</g>
<!-- ln1_dp3_ep7_tp1 -->
<g id="node779" class="node">
<title>ln1_dp3_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3605.5,-1608.98 3376.5,-1608.98 3376.5,-1556.98 3605.5,-1556.98 3605.5,-1608.98"/>
<text text-anchor="middle" x="3491" y="-1596.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="3491" y="-1585.98" font-family="Times,serif" font-size="10.00">GPU 207</text>
<text text-anchor="middle" x="3491" y="-1574.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3491" y="-1563.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln2_dp3_ep6_tp1&#45;&gt;ln1_dp3_ep7_tp1 -->
<g id="edge887" class="edge">
<title>ln2_dp3_ep6_tp1&#45;&gt;ln1_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M3491,-1692.78C3491,-1672 3491,-1642.3 3491,-1619.18"/>
<polygon fill="black" stroke="black" points="3494.5,-1619.07 3491,-1609.07 3487.5,-1619.07 3494.5,-1619.07"/>
</g>
<!-- mha_dp3_ep7_tp0 -->
<g id="node773" class="node">
<title>mha_dp3_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3098.5,-1498.98 2869.5,-1498.98 2869.5,-1446.98 3098.5,-1446.98 3098.5,-1498.98"/>
<text text-anchor="middle" x="2984" y="-1486.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2984" y="-1475.98" font-family="Times,serif" font-size="10.00">GPU 206</text>
<text text-anchor="middle" x="2984" y="-1464.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2984" y="-1453.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep7_tp0&#45;&gt;mha_dp3_ep7_tp0 -->
<g id="edge888" class="edge">
<title>ln1_dp3_ep7_tp0&#45;&gt;mha_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2984,-1556.93C2984,-1542.86 2984,-1525.06 2984,-1509.56"/>
<polygon fill="black" stroke="black" points="2987.5,-1509.27 2984,-1499.27 2980.5,-1509.27 2987.5,-1509.27"/>
</g>
<!-- moe_gate_dp3_ep7_tp0 -->
<g id="node774" class="node">
<title>moe_gate_dp3_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3228.85,-1409.98 2839.35,-1409.98 2739.15,-1305.98 3128.65,-1305.98 3228.85,-1409.98"/>
<text text-anchor="middle" x="2984" y="-1371.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2984" y="-1360.98" font-family="Times,serif" font-size="10.00">GPU 206</text>
<text text-anchor="middle" x="2984" y="-1349.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2984" y="-1338.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep7_tp0&#45;&gt;moe_gate_dp3_ep7_tp0 -->
<g id="edge889" class="edge">
<title>mha_dp3_ep7_tp0&#45;&gt;moe_gate_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2984,-1446.9C2984,-1438.98 2984,-1429.84 2984,-1420.52"/>
<polygon fill="black" stroke="black" points="2987.5,-1420.38 2984,-1410.38 2980.5,-1420.38 2987.5,-1420.38"/>
</g>
<!-- expert1_dp3_ep7_tp0 -->
<g id="node775" class="node">
<title>expert1_dp3_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2975.5,-1228.98 2740.5,-1228.98 2740.5,-1176.98 2975.5,-1176.98 2975.5,-1228.98"/>
<text text-anchor="middle" x="2858" y="-1216.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2858" y="-1205.98" font-family="Times,serif" font-size="10.00">GPU 206</text>
<text text-anchor="middle" x="2858" y="-1194.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2858" y="-1183.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep7_tp0&#45;&gt;expert1_dp3_ep7_tp0 -->
<g id="edge890" class="edge">
<title>moe_gate_dp3_ep7_tp0&#45;&gt;expert1_dp3_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2941.69,-1305.61C2923.09,-1283.03 2901.79,-1257.15 2885.33,-1237.17"/>
<polygon fill="black" stroke="black" points="2887.88,-1234.76 2878.82,-1229.26 2882.47,-1239.21 2887.88,-1234.76"/>
<text text-anchor="middle" x="2981.5" y="-1276.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep7_tp0 -->
<g id="node776" class="node">
<title>expert2_dp3_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3228.5,-1228.98 2993.5,-1228.98 2993.5,-1176.98 3228.5,-1176.98 3228.5,-1228.98"/>
<text text-anchor="middle" x="3111" y="-1216.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3111" y="-1205.98" font-family="Times,serif" font-size="10.00">GPU 206</text>
<text text-anchor="middle" x="3111" y="-1194.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3111" y="-1183.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep7_tp0&#45;&gt;expert2_dp3_ep7_tp0 -->
<g id="edge891" class="edge">
<title>moe_gate_dp3_ep7_tp0&#45;&gt;expert2_dp3_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3027.97,-1305.87C3033.06,-1299.86 3038.16,-1293.8 3043,-1287.98 3056.9,-1271.28 3072.14,-1252.5 3084.66,-1236.94"/>
<polygon fill="black" stroke="black" points="3087.41,-1239.11 3090.94,-1229.12 3081.95,-1234.72 3087.41,-1239.11"/>
<text text-anchor="middle" x="3111.5" y="-1276.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep7_tp0 -->
<g id="node777" class="node">
<title>expert_agg_dp3_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="3213.33,-1113.98 2835.79,-1113.98 2738.67,-1009.98 3116.21,-1009.98 3213.33,-1113.98"/>
<text text-anchor="middle" x="2976" y="-1075.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2976" y="-1064.98" font-family="Times,serif" font-size="10.00">GPU 206</text>
<text text-anchor="middle" x="2976" y="-1053.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2976" y="-1042.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep7_tp0&#45;&gt;expert_agg_dp3_ep7_tp0 -->
<g id="edge892" class="edge">
<title>expert1_dp3_ep7_tp0&#45;&gt;expert_agg_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2879.37,-1176.81C2892.39,-1161.48 2909.6,-1141.2 2925.88,-1122.02"/>
<polygon fill="black" stroke="black" points="2928.75,-1124.05 2932.55,-1114.17 2923.41,-1119.52 2928.75,-1124.05"/>
</g>
<!-- expert2_dp3_ep7_tp0&#45;&gt;expert_agg_dp3_ep7_tp0 -->
<g id="edge893" class="edge">
<title>expert2_dp3_ep7_tp0&#45;&gt;expert_agg_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M3086.55,-1176.81C3071.53,-1161.34 3051.62,-1140.84 3032.84,-1121.51"/>
<polygon fill="black" stroke="black" points="3035.19,-1118.9 3025.71,-1114.17 3030.17,-1123.78 3035.19,-1118.9"/>
</g>
<!-- ln2_dp3_ep7_tp0 -->
<g id="node778" class="node">
<title>ln2_dp3_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="3076.5,-946.98 2847.5,-946.98 2847.5,-894.98 3076.5,-894.98 3076.5,-946.98"/>
<text text-anchor="middle" x="2962" y="-934.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2962" y="-923.98" font-family="Times,serif" font-size="10.00">GPU 206</text>
<text text-anchor="middle" x="2962" y="-912.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2962" y="-901.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep7_tp0&#45;&gt;ln2_dp3_ep7_tp0 -->
<g id="edge894" class="edge">
<title>expert_agg_dp3_ep7_tp0&#45;&gt;ln2_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2970.83,-1009.62C2969.06,-992.11 2967.13,-972.95 2965.53,-957.02"/>
<polygon fill="black" stroke="black" points="2969.01,-956.67 2964.53,-947.07 2962.05,-957.37 2969.01,-956.67"/>
</g>
<!-- comm_pipeline_dp3_ep7_tp0 -->
<g id="node1089" class="node">
<title>comm_pipeline_dp3_ep7_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="2946" cy="-802.99" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="2946" y="-811.49" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="2946" y="-800.49" font-family="Times,serif" font-size="10.00">GPU 206â†’222</text>
<text text-anchor="middle" x="2946" y="-789.49" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- ln2_dp3_ep7_tp0&#45;&gt;comm_pipeline_dp3_ep7_tp0 -->
<g id="edge895" class="edge">
<title>ln2_dp3_ep7_tp0&#45;&gt;comm_pipeline_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2958.53,-894.81C2956.41,-879.48 2953.67,-859.57 2951.28,-842.3"/>
<polygon fill="black" stroke="black" points="2954.69,-841.38 2949.86,-831.96 2947.76,-842.34 2954.69,-841.38"/>
</g>
<!-- mha_dp3_ep7_tp1 -->
<g id="node780" class="node">
<title>mha_dp3_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3605.5,-1498.98 3376.5,-1498.98 3376.5,-1446.98 3605.5,-1446.98 3605.5,-1498.98"/>
<text text-anchor="middle" x="3491" y="-1486.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="3491" y="-1475.98" font-family="Times,serif" font-size="10.00">GPU 207</text>
<text text-anchor="middle" x="3491" y="-1464.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3491" y="-1453.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- ln1_dp3_ep7_tp1&#45;&gt;mha_dp3_ep7_tp1 -->
<g id="edge897" class="edge">
<title>ln1_dp3_ep7_tp1&#45;&gt;mha_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M3491,-1556.93C3491,-1542.86 3491,-1525.06 3491,-1509.56"/>
<polygon fill="black" stroke="black" points="3494.5,-1509.27 3491,-1499.27 3487.5,-1509.27 3494.5,-1509.27"/>
</g>
<!-- moe_gate_dp3_ep7_tp1 -->
<g id="node781" class="node">
<title>moe_gate_dp3_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3735.85,-1409.98 3346.35,-1409.98 3246.15,-1305.98 3635.65,-1305.98 3735.85,-1409.98"/>
<text text-anchor="middle" x="3491" y="-1371.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="3491" y="-1360.98" font-family="Times,serif" font-size="10.00">GPU 207</text>
<text text-anchor="middle" x="3491" y="-1349.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3491" y="-1338.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- mha_dp3_ep7_tp1&#45;&gt;moe_gate_dp3_ep7_tp1 -->
<g id="edge898" class="edge">
<title>mha_dp3_ep7_tp1&#45;&gt;moe_gate_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M3491,-1446.9C3491,-1438.98 3491,-1429.84 3491,-1420.52"/>
<polygon fill="black" stroke="black" points="3494.5,-1420.38 3491,-1410.38 3487.5,-1420.38 3494.5,-1420.38"/>
</g>
<!-- expert1_dp3_ep7_tp1 -->
<g id="node782" class="node">
<title>expert1_dp3_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3481.5,-1228.98 3246.5,-1228.98 3246.5,-1176.98 3481.5,-1176.98 3481.5,-1228.98"/>
<text text-anchor="middle" x="3364" y="-1216.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="3364" y="-1205.98" font-family="Times,serif" font-size="10.00">GPU 207</text>
<text text-anchor="middle" x="3364" y="-1194.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3364" y="-1183.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep7_tp1&#45;&gt;expert1_dp3_ep7_tp1 -->
<g id="edge899" class="edge">
<title>moe_gate_dp3_ep7_tp1&#45;&gt;expert1_dp3_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3446.2,-1305.95C3441.03,-1299.92 3435.88,-1293.84 3431,-1287.98 3417.3,-1271.54 3402.42,-1252.96 3390.17,-1237.46"/>
<polygon fill="black" stroke="black" points="3392.6,-1234.89 3383.66,-1229.2 3387.1,-1239.22 3392.6,-1234.89"/>
<text text-anchor="middle" x="3488.5" y="-1276.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert2_dp3_ep7_tp1 -->
<g id="node783" class="node">
<title>expert2_dp3_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3734.5,-1228.98 3499.5,-1228.98 3499.5,-1176.98 3734.5,-1176.98 3734.5,-1228.98"/>
<text text-anchor="middle" x="3617" y="-1216.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3617" y="-1205.98" font-family="Times,serif" font-size="10.00">GPU 207</text>
<text text-anchor="middle" x="3617" y="-1194.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3617" y="-1183.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- moe_gate_dp3_ep7_tp1&#45;&gt;expert2_dp3_ep7_tp1 -->
<g id="edge900" class="edge">
<title>moe_gate_dp3_ep7_tp1&#45;&gt;expert2_dp3_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3533.31,-1305.61C3551.91,-1283.03 3573.21,-1257.15 3589.67,-1237.17"/>
<polygon fill="black" stroke="black" points="3592.53,-1239.21 3596.18,-1229.26 3587.12,-1234.76 3592.53,-1239.21"/>
<text text-anchor="middle" x="3614.5" y="-1276.78" font-family="Times,serif" font-size="14.00">expert selection</text>
</g>
<!-- expert_agg_dp3_ep7_tp1 -->
<g id="node784" class="node">
<title>expert_agg_dp3_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3706.33,-1113.98 3328.79,-1113.98 3231.67,-1009.98 3609.21,-1009.98 3706.33,-1113.98"/>
<text text-anchor="middle" x="3469" y="-1075.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="3469" y="-1064.98" font-family="Times,serif" font-size="10.00">GPU 207</text>
<text text-anchor="middle" x="3469" y="-1053.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="3469" y="-1042.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert1_dp3_ep7_tp1&#45;&gt;expert_agg_dp3_ep7_tp1 -->
<g id="edge901" class="edge">
<title>expert1_dp3_ep7_tp1&#45;&gt;expert_agg_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M3383.01,-1176.81C3394.55,-1161.55 3409.78,-1141.38 3424.21,-1122.27"/>
<polygon fill="black" stroke="black" points="3427.1,-1124.25 3430.34,-1114.17 3421.52,-1120.03 3427.1,-1124.25"/>
</g>
<!-- expert2_dp3_ep7_tp1&#45;&gt;expert_agg_dp3_ep7_tp1 -->
<g id="edge902" class="edge">
<title>expert2_dp3_ep7_tp1&#45;&gt;expert_agg_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M3590.2,-1176.81C3573.65,-1161.27 3551.71,-1140.66 3531.04,-1121.25"/>
<polygon fill="black" stroke="black" points="3533.18,-1118.46 3523.5,-1114.17 3528.39,-1123.56 3533.18,-1118.46"/>
</g>
<!-- ln2_dp3_ep7_tp1 -->
<g id="node785" class="node">
<title>ln2_dp3_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3451.5,-946.98 3222.5,-946.98 3222.5,-894.98 3451.5,-894.98 3451.5,-946.98"/>
<text text-anchor="middle" x="3337" y="-934.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="3337" y="-923.98" font-family="Times,serif" font-size="10.00">GPU 207</text>
<text text-anchor="middle" x="3337" y="-912.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3337" y="-901.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- expert_agg_dp3_ep7_tp1&#45;&gt;ln2_dp3_ep7_tp1 -->
<g id="edge903" class="edge">
<title>expert_agg_dp3_ep7_tp1&#45;&gt;ln2_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M3420.22,-1009.62C3402.65,-991.11 3383.32,-970.75 3367.71,-954.32"/>
<polygon fill="black" stroke="black" points="3370.25,-951.91 3360.83,-947.07 3365.17,-956.73 3370.25,-951.91"/>
</g>
<!-- comm_pipeline_dp3_ep7_tp1 -->
<g id="node1090" class="node">
<title>comm_pipeline_dp3_ep7_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="3165" cy="-802.99" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="3165" y="-811.49" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="3165" y="-800.49" font-family="Times,serif" font-size="10.00">GPU 207â†’223</text>
<text text-anchor="middle" x="3165" y="-789.49" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- ln2_dp3_ep7_tp1&#45;&gt;comm_pipeline_dp3_ep7_tp1 -->
<g id="edge904" class="edge">
<title>ln2_dp3_ep7_tp1&#45;&gt;comm_pipeline_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M3299.68,-894.81C3273.44,-877.12 3238.2,-853.35 3210.34,-834.57"/>
<polygon fill="black" stroke="black" points="3212.2,-831.6 3201.95,-828.91 3208.29,-837.4 3212.2,-831.6"/>
</g>
<!-- stage2_mha_dp3_ep0_tp0 -->
<g id="node787" class="node">
<title>stage2_mha_dp3_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2107.5,-6171.98 1878.5,-6171.98 1878.5,-6119.98 2107.5,-6119.98 2107.5,-6171.98"/>
<text text-anchor="middle" x="1993" y="-6159.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1993" y="-6148.98" font-family="Times,serif" font-size="10.00">GPU 208</text>
<text text-anchor="middle" x="1993" y="-6137.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1993" y="-6126.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep0_tp0&#45;&gt;stage2_mha_dp3_ep0_tp0 -->
<g id="edge906" class="edge">
<title>stage2_ln1_dp3_ep0_tp0&#45;&gt;stage2_mha_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M1993,-6234.9C1993,-6219.4 1993,-6199.26 1993,-6182.17"/>
<polygon fill="black" stroke="black" points="1996.5,-6181.99 1993,-6171.99 1989.5,-6181.99 1996.5,-6181.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep0_tp0 -->
<g id="node788" class="node">
<title>stage2_moe_gate_dp3_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2237.85,-6042.98 1848.35,-6042.98 1748.15,-5938.98 2137.65,-5938.98 2237.85,-6042.98"/>
<text text-anchor="middle" x="1993" y="-6004.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1993" y="-5993.98" font-family="Times,serif" font-size="10.00">GPU 208</text>
<text text-anchor="middle" x="1993" y="-5982.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1993" y="-5971.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep0_tp0&#45;&gt;stage2_moe_gate_dp3_ep0_tp0 -->
<g id="edge907" class="edge">
<title>stage2_mha_dp3_ep0_tp0&#45;&gt;stage2_moe_gate_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M1993,-6119.72C1993,-6101.6 1993,-6076.4 1993,-6053.16"/>
<polygon fill="black" stroke="black" points="1996.5,-6053 1993,-6043 1989.5,-6053 1996.5,-6053"/>
</g>
<!-- stage2_expert1_dp3_ep0_tp0 -->
<g id="node789" class="node">
<title>stage2_expert1_dp3_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1984.5,-5875.98 1749.5,-5875.98 1749.5,-5823.98 1984.5,-5823.98 1984.5,-5875.98"/>
<text text-anchor="middle" x="1867" y="-5863.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1867" y="-5852.98" font-family="Times,serif" font-size="10.00">GPU 208</text>
<text text-anchor="middle" x="1867" y="-5841.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1867" y="-5830.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep0_tp0&#45;&gt;stage2_expert1_dp3_ep0_tp0 -->
<g id="edge908" class="edge">
<title>stage2_moe_gate_dp3_ep0_tp0&#45;&gt;stage2_expert1_dp3_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1946.44,-5938.62C1929.81,-5920.28 1911.54,-5900.12 1896.72,-5883.77"/>
<polygon fill="black" stroke="black" points="1899.05,-5881.13 1889.74,-5876.07 1893.87,-5885.83 1899.05,-5881.13"/>
</g>
<!-- stage2_expert2_dp3_ep0_tp0 -->
<g id="node790" class="node">
<title>stage2_expert2_dp3_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2237.5,-5875.98 2002.5,-5875.98 2002.5,-5823.98 2237.5,-5823.98 2237.5,-5875.98"/>
<text text-anchor="middle" x="2120" y="-5863.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2120" y="-5852.98" font-family="Times,serif" font-size="10.00">GPU 208</text>
<text text-anchor="middle" x="2120" y="-5841.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2120" y="-5830.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep0_tp0&#45;&gt;stage2_expert2_dp3_ep0_tp0 -->
<g id="edge909" class="edge">
<title>stage2_moe_gate_dp3_ep0_tp0&#45;&gt;stage2_expert2_dp3_ep0_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2039.93,-5938.62C2056.69,-5920.28 2075.1,-5900.12 2090.04,-5883.77"/>
<polygon fill="black" stroke="black" points="2092.92,-5885.82 2097.08,-5876.07 2087.75,-5881.09 2092.92,-5885.82"/>
</g>
<!-- stage2_expert_agg_dp3_ep0_tp0 -->
<g id="node791" class="node">
<title>stage2_expert_agg_dp3_ep0_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2232.33,-5760.98 1854.79,-5760.98 1757.67,-5656.98 2135.21,-5656.98 2232.33,-5760.98"/>
<text text-anchor="middle" x="1995" y="-5722.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1995" y="-5711.98" font-family="Times,serif" font-size="10.00">GPU 208</text>
<text text-anchor="middle" x="1995" y="-5700.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1995" y="-5689.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep0_tp0&#45;&gt;stage2_expert_agg_dp3_ep0_tp0 -->
<g id="edge910" class="edge">
<title>stage2_expert1_dp3_ep0_tp0&#45;&gt;stage2_expert_agg_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M1890.18,-5823.81C1904.36,-5808.41 1923.14,-5788.02 1940.87,-5768.76"/>
<polygon fill="black" stroke="black" points="1943.67,-5770.89 1947.87,-5761.17 1938.52,-5766.15 1943.67,-5770.89"/>
</g>
<!-- stage2_expert2_dp3_ep0_tp0&#45;&gt;stage2_expert_agg_dp3_ep0_tp0 -->
<g id="edge911" class="edge">
<title>stage2_expert2_dp3_ep0_tp0&#45;&gt;stage2_expert_agg_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M2097.36,-5823.81C2083.51,-5808.41 2065.18,-5788.02 2047.86,-5768.76"/>
<polygon fill="black" stroke="black" points="2050.32,-5766.26 2041.03,-5761.17 2045.11,-5770.94 2050.32,-5766.26"/>
</g>
<!-- stage2_ln2_dp3_ep0_tp0 -->
<g id="node792" class="node">
<title>stage2_ln2_dp3_ep0_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2109.5,-5598.98 1880.5,-5598.98 1880.5,-5546.98 2109.5,-5546.98 2109.5,-5598.98"/>
<text text-anchor="middle" x="1995" y="-5586.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1995" y="-5575.98" font-family="Times,serif" font-size="10.00">GPU 208</text>
<text text-anchor="middle" x="1995" y="-5564.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1995" y="-5553.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep0_tp0&#45;&gt;stage2_ln2_dp3_ep0_tp0 -->
<g id="edge912" class="edge">
<title>stage2_expert_agg_dp3_ep0_tp0&#45;&gt;stage2_ln2_dp3_ep0_tp0</title>
<path fill="none" stroke="black" d="M1995,-5656.94C1995,-5640.99 1995,-5623.76 1995,-5609.16"/>
<polygon fill="black" stroke="black" points="1998.5,-5609.04 1995,-5599.04 1991.5,-5609.04 1998.5,-5609.04"/>
</g>
<!-- stage2_ln1_dp3_ep1_tp0 -->
<g id="node800" class="node">
<title>stage2_ln1_dp3_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2109.5,-5488.98 1880.5,-5488.98 1880.5,-5436.98 2109.5,-5436.98 2109.5,-5488.98"/>
<text text-anchor="middle" x="1995" y="-5476.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1995" y="-5465.98" font-family="Times,serif" font-size="10.00">GPU 210</text>
<text text-anchor="middle" x="1995" y="-5454.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1995" y="-5443.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep0_tp0&#45;&gt;stage2_ln1_dp3_ep1_tp0 -->
<g id="edge913" class="edge">
<title>stage2_ln2_dp3_ep0_tp0&#45;&gt;stage2_ln1_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M1995,-5546.93C1995,-5532.86 1995,-5515.06 1995,-5499.56"/>
<polygon fill="black" stroke="black" points="1998.5,-5499.27 1995,-5489.27 1991.5,-5499.27 1998.5,-5499.27"/>
</g>
<!-- stage2_mha_dp3_ep0_tp1 -->
<g id="node794" class="node">
<title>stage2_mha_dp3_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2614.5,-6171.98 2385.5,-6171.98 2385.5,-6119.98 2614.5,-6119.98 2614.5,-6171.98"/>
<text text-anchor="middle" x="2500" y="-6159.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2500" y="-6148.98" font-family="Times,serif" font-size="10.00">GPU 209</text>
<text text-anchor="middle" x="2500" y="-6137.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2500" y="-6126.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep0_tp1&#45;&gt;stage2_mha_dp3_ep0_tp1 -->
<g id="edge914" class="edge">
<title>stage2_ln1_dp3_ep0_tp1&#45;&gt;stage2_mha_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M2500,-6234.9C2500,-6219.4 2500,-6199.26 2500,-6182.17"/>
<polygon fill="black" stroke="black" points="2503.5,-6181.99 2500,-6171.99 2496.5,-6181.99 2503.5,-6181.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep0_tp1 -->
<g id="node795" class="node">
<title>stage2_moe_gate_dp3_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2744.85,-6042.98 2355.35,-6042.98 2255.15,-5938.98 2644.65,-5938.98 2744.85,-6042.98"/>
<text text-anchor="middle" x="2500" y="-6004.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2500" y="-5993.98" font-family="Times,serif" font-size="10.00">GPU 209</text>
<text text-anchor="middle" x="2500" y="-5982.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2500" y="-5971.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep0_tp1&#45;&gt;stage2_moe_gate_dp3_ep0_tp1 -->
<g id="edge915" class="edge">
<title>stage2_mha_dp3_ep0_tp1&#45;&gt;stage2_moe_gate_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M2500,-6119.72C2500,-6101.6 2500,-6076.4 2500,-6053.16"/>
<polygon fill="black" stroke="black" points="2503.5,-6053 2500,-6043 2496.5,-6053 2503.5,-6053"/>
</g>
<!-- stage2_expert1_dp3_ep0_tp1 -->
<g id="node796" class="node">
<title>stage2_expert1_dp3_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2490.5,-5875.98 2255.5,-5875.98 2255.5,-5823.98 2490.5,-5823.98 2490.5,-5875.98"/>
<text text-anchor="middle" x="2373" y="-5863.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2373" y="-5852.98" font-family="Times,serif" font-size="10.00">GPU 209</text>
<text text-anchor="middle" x="2373" y="-5841.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2373" y="-5830.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep0_tp1&#45;&gt;stage2_expert1_dp3_ep0_tp1 -->
<g id="edge916" class="edge">
<title>stage2_moe_gate_dp3_ep0_tp1&#45;&gt;stage2_expert1_dp3_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2453.07,-5938.62C2436.31,-5920.28 2417.9,-5900.12 2402.96,-5883.77"/>
<polygon fill="black" stroke="black" points="2405.25,-5881.09 2395.92,-5876.07 2400.08,-5885.82 2405.25,-5881.09"/>
</g>
<!-- stage2_expert2_dp3_ep0_tp1 -->
<g id="node797" class="node">
<title>stage2_expert2_dp3_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2743.5,-5875.98 2508.5,-5875.98 2508.5,-5823.98 2743.5,-5823.98 2743.5,-5875.98"/>
<text text-anchor="middle" x="2626" y="-5863.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2626" y="-5852.98" font-family="Times,serif" font-size="10.00">GPU 209</text>
<text text-anchor="middle" x="2626" y="-5841.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2626" y="-5830.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep0_tp1&#45;&gt;stage2_expert2_dp3_ep0_tp1 -->
<g id="edge917" class="edge">
<title>stage2_moe_gate_dp3_ep0_tp1&#45;&gt;stage2_expert2_dp3_ep0_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2546.56,-5938.62C2563.19,-5920.28 2581.46,-5900.12 2596.28,-5883.77"/>
<polygon fill="black" stroke="black" points="2599.13,-5885.83 2603.26,-5876.07 2593.95,-5881.13 2599.13,-5885.83"/>
</g>
<!-- stage2_expert_agg_dp3_ep0_tp1 -->
<g id="node798" class="node">
<title>stage2_expert_agg_dp3_ep0_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2739.33,-5760.98 2361.79,-5760.98 2264.67,-5656.98 2642.21,-5656.98 2739.33,-5760.98"/>
<text text-anchor="middle" x="2502" y="-5722.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2502" y="-5711.98" font-family="Times,serif" font-size="10.00">GPU 209</text>
<text text-anchor="middle" x="2502" y="-5700.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2502" y="-5689.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep0_tp1&#45;&gt;stage2_expert_agg_dp3_ep0_tp1 -->
<g id="edge918" class="edge">
<title>stage2_expert1_dp3_ep0_tp1&#45;&gt;stage2_expert_agg_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M2396.36,-5823.81C2410.72,-5808.34 2429.74,-5787.84 2447.69,-5768.51"/>
<polygon fill="black" stroke="black" points="2450.26,-5770.88 2454.5,-5761.17 2445.13,-5766.11 2450.26,-5770.88"/>
</g>
<!-- stage2_expert2_dp3_ep0_tp1&#45;&gt;stage2_expert_agg_dp3_ep0_tp1 -->
<g id="edge919" class="edge">
<title>stage2_expert2_dp3_ep0_tp1&#45;&gt;stage2_expert_agg_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M2603.54,-5823.81C2589.8,-5808.41 2571.62,-5788.02 2554.44,-5768.76"/>
<polygon fill="black" stroke="black" points="2556.93,-5766.3 2547.66,-5761.17 2551.7,-5770.96 2556.93,-5766.3"/>
</g>
<!-- stage2_ln2_dp3_ep0_tp1 -->
<g id="node799" class="node">
<title>stage2_ln2_dp3_ep0_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2616.5,-5598.98 2387.5,-5598.98 2387.5,-5546.98 2616.5,-5546.98 2616.5,-5598.98"/>
<text text-anchor="middle" x="2502" y="-5586.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2502" y="-5575.98" font-family="Times,serif" font-size="10.00">GPU 209</text>
<text text-anchor="middle" x="2502" y="-5564.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2502" y="-5553.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep0_tp1&#45;&gt;stage2_ln2_dp3_ep0_tp1 -->
<g id="edge920" class="edge">
<title>stage2_expert_agg_dp3_ep0_tp1&#45;&gt;stage2_ln2_dp3_ep0_tp1</title>
<path fill="none" stroke="black" d="M2502,-5656.94C2502,-5640.99 2502,-5623.76 2502,-5609.16"/>
<polygon fill="black" stroke="black" points="2505.5,-5609.04 2502,-5599.04 2498.5,-5609.04 2505.5,-5609.04"/>
</g>
<!-- stage2_ln1_dp3_ep1_tp1 -->
<g id="node807" class="node">
<title>stage2_ln1_dp3_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2616.5,-5488.98 2387.5,-5488.98 2387.5,-5436.98 2616.5,-5436.98 2616.5,-5488.98"/>
<text text-anchor="middle" x="2502" y="-5476.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2502" y="-5465.98" font-family="Times,serif" font-size="10.00">GPU 211</text>
<text text-anchor="middle" x="2502" y="-5454.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2502" y="-5443.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep0_tp1&#45;&gt;stage2_ln1_dp3_ep1_tp1 -->
<g id="edge921" class="edge">
<title>stage2_ln2_dp3_ep0_tp1&#45;&gt;stage2_ln1_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M2502,-5546.93C2502,-5532.86 2502,-5515.06 2502,-5499.56"/>
<polygon fill="black" stroke="black" points="2505.5,-5499.27 2502,-5489.27 2498.5,-5499.27 2505.5,-5499.27"/>
</g>
<!-- stage2_mha_dp3_ep1_tp0 -->
<g id="node801" class="node">
<title>stage2_mha_dp3_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2109.5,-5373.98 1880.5,-5373.98 1880.5,-5321.98 2109.5,-5321.98 2109.5,-5373.98"/>
<text text-anchor="middle" x="1995" y="-5361.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1995" y="-5350.98" font-family="Times,serif" font-size="10.00">GPU 210</text>
<text text-anchor="middle" x="1995" y="-5339.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1995" y="-5328.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep1_tp0&#45;&gt;stage2_mha_dp3_ep1_tp0 -->
<g id="edge922" class="edge">
<title>stage2_ln1_dp3_ep1_tp0&#45;&gt;stage2_mha_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M1995,-5436.9C1995,-5421.4 1995,-5401.26 1995,-5384.17"/>
<polygon fill="black" stroke="black" points="1998.5,-5383.99 1995,-5373.99 1991.5,-5383.99 1998.5,-5383.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep1_tp0 -->
<g id="node802" class="node">
<title>stage2_moe_gate_dp3_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2239.85,-5244.98 1850.35,-5244.98 1750.15,-5140.98 2139.65,-5140.98 2239.85,-5244.98"/>
<text text-anchor="middle" x="1995" y="-5206.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1995" y="-5195.98" font-family="Times,serif" font-size="10.00">GPU 210</text>
<text text-anchor="middle" x="1995" y="-5184.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1995" y="-5173.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep1_tp0&#45;&gt;stage2_moe_gate_dp3_ep1_tp0 -->
<g id="edge923" class="edge">
<title>stage2_mha_dp3_ep1_tp0&#45;&gt;stage2_moe_gate_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M1995,-5321.72C1995,-5303.6 1995,-5278.4 1995,-5255.16"/>
<polygon fill="black" stroke="black" points="1998.5,-5255 1995,-5245 1991.5,-5255 1998.5,-5255"/>
</g>
<!-- stage2_expert1_dp3_ep1_tp0 -->
<g id="node803" class="node">
<title>stage2_expert1_dp3_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1986.5,-5077.98 1751.5,-5077.98 1751.5,-5025.98 1986.5,-5025.98 1986.5,-5077.98"/>
<text text-anchor="middle" x="1869" y="-5065.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1869" y="-5054.98" font-family="Times,serif" font-size="10.00">GPU 210</text>
<text text-anchor="middle" x="1869" y="-5043.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1869" y="-5032.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep1_tp0&#45;&gt;stage2_expert1_dp3_ep1_tp0 -->
<g id="edge924" class="edge">
<title>stage2_moe_gate_dp3_ep1_tp0&#45;&gt;stage2_expert1_dp3_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1948.44,-5140.62C1931.81,-5122.28 1913.54,-5102.12 1898.72,-5085.77"/>
<polygon fill="black" stroke="black" points="1901.05,-5083.13 1891.74,-5078.07 1895.87,-5087.83 1901.05,-5083.13"/>
</g>
<!-- stage2_expert2_dp3_ep1_tp0 -->
<g id="node804" class="node">
<title>stage2_expert2_dp3_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2239.5,-5077.98 2004.5,-5077.98 2004.5,-5025.98 2239.5,-5025.98 2239.5,-5077.98"/>
<text text-anchor="middle" x="2122" y="-5065.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2122" y="-5054.98" font-family="Times,serif" font-size="10.00">GPU 210</text>
<text text-anchor="middle" x="2122" y="-5043.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2122" y="-5032.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep1_tp0&#45;&gt;stage2_expert2_dp3_ep1_tp0 -->
<g id="edge925" class="edge">
<title>stage2_moe_gate_dp3_ep1_tp0&#45;&gt;stage2_expert2_dp3_ep1_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2041.93,-5140.62C2058.69,-5122.28 2077.1,-5102.12 2092.04,-5085.77"/>
<polygon fill="black" stroke="black" points="2094.92,-5087.82 2099.08,-5078.07 2089.75,-5083.09 2094.92,-5087.82"/>
</g>
<!-- stage2_expert_agg_dp3_ep1_tp0 -->
<g id="node805" class="node">
<title>stage2_expert_agg_dp3_ep1_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2224.33,-4962.98 1846.79,-4962.98 1749.67,-4858.98 2127.21,-4858.98 2224.33,-4962.98"/>
<text text-anchor="middle" x="1987" y="-4924.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1987" y="-4913.98" font-family="Times,serif" font-size="10.00">GPU 210</text>
<text text-anchor="middle" x="1987" y="-4902.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1987" y="-4891.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep1_tp0&#45;&gt;stage2_expert_agg_dp3_ep1_tp0 -->
<g id="edge926" class="edge">
<title>stage2_expert1_dp3_ep1_tp0&#45;&gt;stage2_expert_agg_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M1890.37,-5025.81C1903.39,-5010.48 1920.6,-4990.2 1936.88,-4971.02"/>
<polygon fill="black" stroke="black" points="1939.75,-4973.05 1943.55,-4963.17 1934.41,-4968.52 1939.75,-4973.05"/>
</g>
<!-- stage2_expert2_dp3_ep1_tp0&#45;&gt;stage2_expert_agg_dp3_ep1_tp0 -->
<g id="edge927" class="edge">
<title>stage2_expert2_dp3_ep1_tp0&#45;&gt;stage2_expert_agg_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M2097.55,-5025.81C2082.53,-5010.34 2062.62,-4989.84 2043.84,-4970.51"/>
<polygon fill="black" stroke="black" points="2046.19,-4967.9 2036.71,-4963.17 2041.17,-4972.78 2046.19,-4967.9"/>
</g>
<!-- stage2_ln2_dp3_ep1_tp0 -->
<g id="node806" class="node">
<title>stage2_ln2_dp3_ep1_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2101.5,-4800.98 1872.5,-4800.98 1872.5,-4748.98 2101.5,-4748.98 2101.5,-4800.98"/>
<text text-anchor="middle" x="1987" y="-4788.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1987" y="-4777.98" font-family="Times,serif" font-size="10.00">GPU 210</text>
<text text-anchor="middle" x="1987" y="-4766.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1987" y="-4755.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep1_tp0&#45;&gt;stage2_ln2_dp3_ep1_tp0 -->
<g id="edge928" class="edge">
<title>stage2_expert_agg_dp3_ep1_tp0&#45;&gt;stage2_ln2_dp3_ep1_tp0</title>
<path fill="none" stroke="black" d="M1987,-4858.94C1987,-4842.99 1987,-4825.76 1987,-4811.16"/>
<polygon fill="black" stroke="black" points="1990.5,-4811.04 1987,-4801.04 1983.5,-4811.04 1990.5,-4811.04"/>
</g>
<!-- stage2_ln1_dp3_ep2_tp0 -->
<g id="node814" class="node">
<title>stage2_ln1_dp3_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2101.5,-4690.98 1872.5,-4690.98 1872.5,-4638.98 2101.5,-4638.98 2101.5,-4690.98"/>
<text text-anchor="middle" x="1987" y="-4678.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1987" y="-4667.98" font-family="Times,serif" font-size="10.00">GPU 212</text>
<text text-anchor="middle" x="1987" y="-4656.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1987" y="-4645.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep1_tp0&#45;&gt;stage2_ln1_dp3_ep2_tp0 -->
<g id="edge929" class="edge">
<title>stage2_ln2_dp3_ep1_tp0&#45;&gt;stage2_ln1_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M1987,-4748.93C1987,-4734.86 1987,-4717.06 1987,-4701.56"/>
<polygon fill="black" stroke="black" points="1990.5,-4701.27 1987,-4691.27 1983.5,-4701.27 1990.5,-4701.27"/>
</g>
<!-- stage2_mha_dp3_ep1_tp1 -->
<g id="node808" class="node">
<title>stage2_mha_dp3_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2616.5,-5373.98 2387.5,-5373.98 2387.5,-5321.98 2616.5,-5321.98 2616.5,-5373.98"/>
<text text-anchor="middle" x="2502" y="-5361.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2502" y="-5350.98" font-family="Times,serif" font-size="10.00">GPU 211</text>
<text text-anchor="middle" x="2502" y="-5339.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2502" y="-5328.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep1_tp1&#45;&gt;stage2_mha_dp3_ep1_tp1 -->
<g id="edge930" class="edge">
<title>stage2_ln1_dp3_ep1_tp1&#45;&gt;stage2_mha_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M2502,-5436.9C2502,-5421.4 2502,-5401.26 2502,-5384.17"/>
<polygon fill="black" stroke="black" points="2505.5,-5383.99 2502,-5373.99 2498.5,-5383.99 2505.5,-5383.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep1_tp1 -->
<g id="node809" class="node">
<title>stage2_moe_gate_dp3_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2746.85,-5244.98 2357.35,-5244.98 2257.15,-5140.98 2646.65,-5140.98 2746.85,-5244.98"/>
<text text-anchor="middle" x="2502" y="-5206.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2502" y="-5195.98" font-family="Times,serif" font-size="10.00">GPU 211</text>
<text text-anchor="middle" x="2502" y="-5184.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2502" y="-5173.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep1_tp1&#45;&gt;stage2_moe_gate_dp3_ep1_tp1 -->
<g id="edge931" class="edge">
<title>stage2_mha_dp3_ep1_tp1&#45;&gt;stage2_moe_gate_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M2502,-5321.72C2502,-5303.6 2502,-5278.4 2502,-5255.16"/>
<polygon fill="black" stroke="black" points="2505.5,-5255 2502,-5245 2498.5,-5255 2505.5,-5255"/>
</g>
<!-- stage2_expert1_dp3_ep1_tp1 -->
<g id="node810" class="node">
<title>stage2_expert1_dp3_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2493.5,-5077.98 2258.5,-5077.98 2258.5,-5025.98 2493.5,-5025.98 2493.5,-5077.98"/>
<text text-anchor="middle" x="2376" y="-5065.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2376" y="-5054.98" font-family="Times,serif" font-size="10.00">GPU 211</text>
<text text-anchor="middle" x="2376" y="-5043.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2376" y="-5032.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep1_tp1&#45;&gt;stage2_expert1_dp3_ep1_tp1 -->
<g id="edge932" class="edge">
<title>stage2_moe_gate_dp3_ep1_tp1&#45;&gt;stage2_expert1_dp3_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2455.44,-5140.62C2438.81,-5122.28 2420.54,-5102.12 2405.72,-5085.77"/>
<polygon fill="black" stroke="black" points="2408.05,-5083.13 2398.74,-5078.07 2402.87,-5087.83 2408.05,-5083.13"/>
</g>
<!-- stage2_expert2_dp3_ep1_tp1 -->
<g id="node811" class="node">
<title>stage2_expert2_dp3_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2746.5,-5077.98 2511.5,-5077.98 2511.5,-5025.98 2746.5,-5025.98 2746.5,-5077.98"/>
<text text-anchor="middle" x="2629" y="-5065.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2629" y="-5054.98" font-family="Times,serif" font-size="10.00">GPU 211</text>
<text text-anchor="middle" x="2629" y="-5043.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2629" y="-5032.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep1_tp1&#45;&gt;stage2_expert2_dp3_ep1_tp1 -->
<g id="edge933" class="edge">
<title>stage2_moe_gate_dp3_ep1_tp1&#45;&gt;stage2_expert2_dp3_ep1_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2548.93,-5140.62C2565.69,-5122.28 2584.1,-5102.12 2599.04,-5085.77"/>
<polygon fill="black" stroke="black" points="2601.92,-5087.82 2606.08,-5078.07 2596.75,-5083.09 2601.92,-5087.82"/>
</g>
<!-- stage2_expert_agg_dp3_ep1_tp1 -->
<g id="node812" class="node">
<title>stage2_expert_agg_dp3_ep1_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2731.33,-4962.98 2353.79,-4962.98 2256.67,-4858.98 2634.21,-4858.98 2731.33,-4962.98"/>
<text text-anchor="middle" x="2494" y="-4924.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2494" y="-4913.98" font-family="Times,serif" font-size="10.00">GPU 211</text>
<text text-anchor="middle" x="2494" y="-4902.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2494" y="-4891.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep1_tp1&#45;&gt;stage2_expert_agg_dp3_ep1_tp1 -->
<g id="edge934" class="edge">
<title>stage2_expert1_dp3_ep1_tp1&#45;&gt;stage2_expert_agg_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M2397.37,-5025.81C2410.39,-5010.48 2427.6,-4990.2 2443.88,-4971.02"/>
<polygon fill="black" stroke="black" points="2446.75,-4973.05 2450.55,-4963.17 2441.41,-4968.52 2446.75,-4973.05"/>
</g>
<!-- stage2_expert2_dp3_ep1_tp1&#45;&gt;stage2_expert_agg_dp3_ep1_tp1 -->
<g id="edge935" class="edge">
<title>stage2_expert2_dp3_ep1_tp1&#45;&gt;stage2_expert_agg_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M2604.55,-5025.81C2589.53,-5010.34 2569.62,-4989.84 2550.84,-4970.51"/>
<polygon fill="black" stroke="black" points="2553.19,-4967.9 2543.71,-4963.17 2548.17,-4972.78 2553.19,-4967.9"/>
</g>
<!-- stage2_ln2_dp3_ep1_tp1 -->
<g id="node813" class="node">
<title>stage2_ln2_dp3_ep1_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2608.5,-4800.98 2379.5,-4800.98 2379.5,-4748.98 2608.5,-4748.98 2608.5,-4800.98"/>
<text text-anchor="middle" x="2494" y="-4788.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2494" y="-4777.98" font-family="Times,serif" font-size="10.00">GPU 211</text>
<text text-anchor="middle" x="2494" y="-4766.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2494" y="-4755.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep1_tp1&#45;&gt;stage2_ln2_dp3_ep1_tp1 -->
<g id="edge936" class="edge">
<title>stage2_expert_agg_dp3_ep1_tp1&#45;&gt;stage2_ln2_dp3_ep1_tp1</title>
<path fill="none" stroke="black" d="M2494,-4858.94C2494,-4842.99 2494,-4825.76 2494,-4811.16"/>
<polygon fill="black" stroke="black" points="2497.5,-4811.04 2494,-4801.04 2490.5,-4811.04 2497.5,-4811.04"/>
</g>
<!-- stage2_ln1_dp3_ep2_tp1 -->
<g id="node821" class="node">
<title>stage2_ln1_dp3_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2608.5,-4690.98 2379.5,-4690.98 2379.5,-4638.98 2608.5,-4638.98 2608.5,-4690.98"/>
<text text-anchor="middle" x="2494" y="-4678.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2494" y="-4667.98" font-family="Times,serif" font-size="10.00">GPU 213</text>
<text text-anchor="middle" x="2494" y="-4656.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2494" y="-4645.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep1_tp1&#45;&gt;stage2_ln1_dp3_ep2_tp1 -->
<g id="edge937" class="edge">
<title>stage2_ln2_dp3_ep1_tp1&#45;&gt;stage2_ln1_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M2494,-4748.93C2494,-4734.86 2494,-4717.06 2494,-4701.56"/>
<polygon fill="black" stroke="black" points="2497.5,-4701.27 2494,-4691.27 2490.5,-4701.27 2497.5,-4701.27"/>
</g>
<!-- stage2_mha_dp3_ep2_tp0 -->
<g id="node815" class="node">
<title>stage2_mha_dp3_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2101.5,-4575.98 1872.5,-4575.98 1872.5,-4523.98 2101.5,-4523.98 2101.5,-4575.98"/>
<text text-anchor="middle" x="1987" y="-4563.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1987" y="-4552.98" font-family="Times,serif" font-size="10.00">GPU 212</text>
<text text-anchor="middle" x="1987" y="-4541.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1987" y="-4530.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep2_tp0&#45;&gt;stage2_mha_dp3_ep2_tp0 -->
<g id="edge938" class="edge">
<title>stage2_ln1_dp3_ep2_tp0&#45;&gt;stage2_mha_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M1987,-4638.9C1987,-4623.4 1987,-4603.26 1987,-4586.17"/>
<polygon fill="black" stroke="black" points="1990.5,-4585.99 1987,-4575.99 1983.5,-4585.99 1990.5,-4585.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep2_tp0 -->
<g id="node816" class="node">
<title>stage2_moe_gate_dp3_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2231.85,-4446.98 1842.35,-4446.98 1742.15,-4342.98 2131.65,-4342.98 2231.85,-4446.98"/>
<text text-anchor="middle" x="1987" y="-4408.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1987" y="-4397.98" font-family="Times,serif" font-size="10.00">GPU 212</text>
<text text-anchor="middle" x="1987" y="-4386.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1987" y="-4375.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep2_tp0&#45;&gt;stage2_moe_gate_dp3_ep2_tp0 -->
<g id="edge939" class="edge">
<title>stage2_mha_dp3_ep2_tp0&#45;&gt;stage2_moe_gate_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M1987,-4523.72C1987,-4505.6 1987,-4480.4 1987,-4457.16"/>
<polygon fill="black" stroke="black" points="1990.5,-4457 1987,-4447 1983.5,-4457 1990.5,-4457"/>
</g>
<!-- stage2_expert1_dp3_ep2_tp0 -->
<g id="node817" class="node">
<title>stage2_expert1_dp3_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1978.5,-4279.98 1743.5,-4279.98 1743.5,-4227.98 1978.5,-4227.98 1978.5,-4279.98"/>
<text text-anchor="middle" x="1861" y="-4267.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1861" y="-4256.98" font-family="Times,serif" font-size="10.00">GPU 212</text>
<text text-anchor="middle" x="1861" y="-4245.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1861" y="-4234.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep2_tp0&#45;&gt;stage2_expert1_dp3_ep2_tp0 -->
<g id="edge940" class="edge">
<title>stage2_moe_gate_dp3_ep2_tp0&#45;&gt;stage2_expert1_dp3_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1940.44,-4342.62C1923.81,-4324.28 1905.54,-4304.12 1890.72,-4287.77"/>
<polygon fill="black" stroke="black" points="1893.05,-4285.13 1883.74,-4280.07 1887.87,-4289.83 1893.05,-4285.13"/>
</g>
<!-- stage2_expert2_dp3_ep2_tp0 -->
<g id="node818" class="node">
<title>stage2_expert2_dp3_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2231.5,-4279.98 1996.5,-4279.98 1996.5,-4227.98 2231.5,-4227.98 2231.5,-4279.98"/>
<text text-anchor="middle" x="2114" y="-4267.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2114" y="-4256.98" font-family="Times,serif" font-size="10.00">GPU 212</text>
<text text-anchor="middle" x="2114" y="-4245.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2114" y="-4234.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep2_tp0&#45;&gt;stage2_expert2_dp3_ep2_tp0 -->
<g id="edge941" class="edge">
<title>stage2_moe_gate_dp3_ep2_tp0&#45;&gt;stage2_expert2_dp3_ep2_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2033.93,-4342.62C2050.69,-4324.28 2069.1,-4304.12 2084.04,-4287.77"/>
<polygon fill="black" stroke="black" points="2086.92,-4289.82 2091.08,-4280.07 2081.75,-4285.09 2086.92,-4289.82"/>
</g>
<!-- stage2_expert_agg_dp3_ep2_tp0 -->
<g id="node819" class="node">
<title>stage2_expert_agg_dp3_ep2_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2216.33,-4164.98 1838.79,-4164.98 1741.67,-4060.98 2119.21,-4060.98 2216.33,-4164.98"/>
<text text-anchor="middle" x="1979" y="-4126.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1979" y="-4115.98" font-family="Times,serif" font-size="10.00">GPU 212</text>
<text text-anchor="middle" x="1979" y="-4104.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1979" y="-4093.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep2_tp0&#45;&gt;stage2_expert_agg_dp3_ep2_tp0 -->
<g id="edge942" class="edge">
<title>stage2_expert1_dp3_ep2_tp0&#45;&gt;stage2_expert_agg_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M1882.37,-4227.81C1895.39,-4212.48 1912.6,-4192.2 1928.88,-4173.02"/>
<polygon fill="black" stroke="black" points="1931.75,-4175.05 1935.55,-4165.17 1926.41,-4170.52 1931.75,-4175.05"/>
</g>
<!-- stage2_expert2_dp3_ep2_tp0&#45;&gt;stage2_expert_agg_dp3_ep2_tp0 -->
<g id="edge943" class="edge">
<title>stage2_expert2_dp3_ep2_tp0&#45;&gt;stage2_expert_agg_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M2089.55,-4227.81C2074.53,-4212.34 2054.62,-4191.84 2035.84,-4172.51"/>
<polygon fill="black" stroke="black" points="2038.19,-4169.9 2028.71,-4165.17 2033.17,-4174.78 2038.19,-4169.9"/>
</g>
<!-- stage2_ln2_dp3_ep2_tp0 -->
<g id="node820" class="node">
<title>stage2_ln2_dp3_ep2_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2093.5,-4002.98 1864.5,-4002.98 1864.5,-3950.98 2093.5,-3950.98 2093.5,-4002.98"/>
<text text-anchor="middle" x="1979" y="-3990.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1979" y="-3979.98" font-family="Times,serif" font-size="10.00">GPU 212</text>
<text text-anchor="middle" x="1979" y="-3968.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1979" y="-3957.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep2_tp0&#45;&gt;stage2_ln2_dp3_ep2_tp0 -->
<g id="edge944" class="edge">
<title>stage2_expert_agg_dp3_ep2_tp0&#45;&gt;stage2_ln2_dp3_ep2_tp0</title>
<path fill="none" stroke="black" d="M1979,-4060.94C1979,-4044.99 1979,-4027.76 1979,-4013.16"/>
<polygon fill="black" stroke="black" points="1982.5,-4013.04 1979,-4003.04 1975.5,-4013.04 1982.5,-4013.04"/>
</g>
<!-- stage2_ln1_dp3_ep3_tp0 -->
<g id="node828" class="node">
<title>stage2_ln1_dp3_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2093.5,-3892.98 1864.5,-3892.98 1864.5,-3840.98 2093.5,-3840.98 2093.5,-3892.98"/>
<text text-anchor="middle" x="1979" y="-3880.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1979" y="-3869.98" font-family="Times,serif" font-size="10.00">GPU 214</text>
<text text-anchor="middle" x="1979" y="-3858.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1979" y="-3847.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep2_tp0&#45;&gt;stage2_ln1_dp3_ep3_tp0 -->
<g id="edge945" class="edge">
<title>stage2_ln2_dp3_ep2_tp0&#45;&gt;stage2_ln1_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M1979,-3950.93C1979,-3936.86 1979,-3919.06 1979,-3903.56"/>
<polygon fill="black" stroke="black" points="1982.5,-3903.27 1979,-3893.27 1975.5,-3903.27 1982.5,-3903.27"/>
</g>
<!-- stage2_mha_dp3_ep2_tp1 -->
<g id="node822" class="node">
<title>stage2_mha_dp3_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2608.5,-4575.98 2379.5,-4575.98 2379.5,-4523.98 2608.5,-4523.98 2608.5,-4575.98"/>
<text text-anchor="middle" x="2494" y="-4563.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2494" y="-4552.98" font-family="Times,serif" font-size="10.00">GPU 213</text>
<text text-anchor="middle" x="2494" y="-4541.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2494" y="-4530.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep2_tp1&#45;&gt;stage2_mha_dp3_ep2_tp1 -->
<g id="edge946" class="edge">
<title>stage2_ln1_dp3_ep2_tp1&#45;&gt;stage2_mha_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M2494,-4638.9C2494,-4623.4 2494,-4603.26 2494,-4586.17"/>
<polygon fill="black" stroke="black" points="2497.5,-4585.99 2494,-4575.99 2490.5,-4585.99 2497.5,-4585.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep2_tp1 -->
<g id="node823" class="node">
<title>stage2_moe_gate_dp3_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2738.85,-4446.98 2349.35,-4446.98 2249.15,-4342.98 2638.65,-4342.98 2738.85,-4446.98"/>
<text text-anchor="middle" x="2494" y="-4408.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2494" y="-4397.98" font-family="Times,serif" font-size="10.00">GPU 213</text>
<text text-anchor="middle" x="2494" y="-4386.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2494" y="-4375.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep2_tp1&#45;&gt;stage2_moe_gate_dp3_ep2_tp1 -->
<g id="edge947" class="edge">
<title>stage2_mha_dp3_ep2_tp1&#45;&gt;stage2_moe_gate_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M2494,-4523.72C2494,-4505.6 2494,-4480.4 2494,-4457.16"/>
<polygon fill="black" stroke="black" points="2497.5,-4457 2494,-4447 2490.5,-4457 2497.5,-4457"/>
</g>
<!-- stage2_expert1_dp3_ep2_tp1 -->
<g id="node824" class="node">
<title>stage2_expert1_dp3_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2484.5,-4279.98 2249.5,-4279.98 2249.5,-4227.98 2484.5,-4227.98 2484.5,-4279.98"/>
<text text-anchor="middle" x="2367" y="-4267.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2367" y="-4256.98" font-family="Times,serif" font-size="10.00">GPU 213</text>
<text text-anchor="middle" x="2367" y="-4245.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2367" y="-4234.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep2_tp1&#45;&gt;stage2_expert1_dp3_ep2_tp1 -->
<g id="edge948" class="edge">
<title>stage2_moe_gate_dp3_ep2_tp1&#45;&gt;stage2_expert1_dp3_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2447.07,-4342.62C2430.31,-4324.28 2411.9,-4304.12 2396.96,-4287.77"/>
<polygon fill="black" stroke="black" points="2399.25,-4285.09 2389.92,-4280.07 2394.08,-4289.82 2399.25,-4285.09"/>
</g>
<!-- stage2_expert2_dp3_ep2_tp1 -->
<g id="node825" class="node">
<title>stage2_expert2_dp3_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2737.5,-4279.98 2502.5,-4279.98 2502.5,-4227.98 2737.5,-4227.98 2737.5,-4279.98"/>
<text text-anchor="middle" x="2620" y="-4267.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2620" y="-4256.98" font-family="Times,serif" font-size="10.00">GPU 213</text>
<text text-anchor="middle" x="2620" y="-4245.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2620" y="-4234.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep2_tp1&#45;&gt;stage2_expert2_dp3_ep2_tp1 -->
<g id="edge949" class="edge">
<title>stage2_moe_gate_dp3_ep2_tp1&#45;&gt;stage2_expert2_dp3_ep2_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2540.56,-4342.62C2557.19,-4324.28 2575.46,-4304.12 2590.28,-4287.77"/>
<polygon fill="black" stroke="black" points="2593.13,-4289.83 2597.26,-4280.07 2587.95,-4285.13 2593.13,-4289.83"/>
</g>
<!-- stage2_expert_agg_dp3_ep2_tp1 -->
<g id="node826" class="node">
<title>stage2_expert_agg_dp3_ep2_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2723.33,-4164.98 2345.79,-4164.98 2248.67,-4060.98 2626.21,-4060.98 2723.33,-4164.98"/>
<text text-anchor="middle" x="2486" y="-4126.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2486" y="-4115.98" font-family="Times,serif" font-size="10.00">GPU 213</text>
<text text-anchor="middle" x="2486" y="-4104.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2486" y="-4093.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep2_tp1&#45;&gt;stage2_expert_agg_dp3_ep2_tp1 -->
<g id="edge950" class="edge">
<title>stage2_expert1_dp3_ep2_tp1&#45;&gt;stage2_expert_agg_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M2388.55,-4227.81C2401.74,-4212.41 2419.19,-4192.02 2435.68,-4172.76"/>
<polygon fill="black" stroke="black" points="2438.34,-4175.04 2442.18,-4165.17 2433.02,-4170.49 2438.34,-4175.04"/>
</g>
<!-- stage2_expert2_dp3_ep2_tp1&#45;&gt;stage2_expert_agg_dp3_ep2_tp1 -->
<g id="edge951" class="edge">
<title>stage2_expert2_dp3_ep2_tp1&#45;&gt;stage2_expert_agg_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M2595.73,-4227.81C2580.82,-4212.34 2561.06,-4191.84 2542.42,-4172.51"/>
<polygon fill="black" stroke="black" points="2544.8,-4169.94 2535.34,-4165.17 2539.76,-4174.79 2544.8,-4169.94"/>
</g>
<!-- stage2_ln2_dp3_ep2_tp1 -->
<g id="node827" class="node">
<title>stage2_ln2_dp3_ep2_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2600.5,-4002.98 2371.5,-4002.98 2371.5,-3950.98 2600.5,-3950.98 2600.5,-4002.98"/>
<text text-anchor="middle" x="2486" y="-3990.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2486" y="-3979.98" font-family="Times,serif" font-size="10.00">GPU 213</text>
<text text-anchor="middle" x="2486" y="-3968.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2486" y="-3957.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep2_tp1&#45;&gt;stage2_ln2_dp3_ep2_tp1 -->
<g id="edge952" class="edge">
<title>stage2_expert_agg_dp3_ep2_tp1&#45;&gt;stage2_ln2_dp3_ep2_tp1</title>
<path fill="none" stroke="black" d="M2486,-4060.94C2486,-4044.99 2486,-4027.76 2486,-4013.16"/>
<polygon fill="black" stroke="black" points="2489.5,-4013.04 2486,-4003.04 2482.5,-4013.04 2489.5,-4013.04"/>
</g>
<!-- stage2_ln1_dp3_ep3_tp1 -->
<g id="node835" class="node">
<title>stage2_ln1_dp3_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2600.5,-3892.98 2371.5,-3892.98 2371.5,-3840.98 2600.5,-3840.98 2600.5,-3892.98"/>
<text text-anchor="middle" x="2486" y="-3880.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2486" y="-3869.98" font-family="Times,serif" font-size="10.00">GPU 215</text>
<text text-anchor="middle" x="2486" y="-3858.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2486" y="-3847.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep2_tp1&#45;&gt;stage2_ln1_dp3_ep3_tp1 -->
<g id="edge953" class="edge">
<title>stage2_ln2_dp3_ep2_tp1&#45;&gt;stage2_ln1_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M2486,-3950.93C2486,-3936.86 2486,-3919.06 2486,-3903.56"/>
<polygon fill="black" stroke="black" points="2489.5,-3903.27 2486,-3893.27 2482.5,-3903.27 2489.5,-3903.27"/>
</g>
<!-- stage2_mha_dp3_ep3_tp0 -->
<g id="node829" class="node">
<title>stage2_mha_dp3_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2093.5,-3777.98 1864.5,-3777.98 1864.5,-3725.98 2093.5,-3725.98 2093.5,-3777.98"/>
<text text-anchor="middle" x="1979" y="-3765.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1979" y="-3754.98" font-family="Times,serif" font-size="10.00">GPU 214</text>
<text text-anchor="middle" x="1979" y="-3743.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1979" y="-3732.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep3_tp0&#45;&gt;stage2_mha_dp3_ep3_tp0 -->
<g id="edge954" class="edge">
<title>stage2_ln1_dp3_ep3_tp0&#45;&gt;stage2_mha_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M1979,-3840.9C1979,-3825.4 1979,-3805.26 1979,-3788.17"/>
<polygon fill="black" stroke="black" points="1982.5,-3787.99 1979,-3777.99 1975.5,-3787.99 1982.5,-3787.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep3_tp0 -->
<g id="node830" class="node">
<title>stage2_moe_gate_dp3_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2223.85,-3648.98 1834.35,-3648.98 1734.15,-3544.98 2123.65,-3544.98 2223.85,-3648.98"/>
<text text-anchor="middle" x="1979" y="-3610.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1979" y="-3599.98" font-family="Times,serif" font-size="10.00">GPU 214</text>
<text text-anchor="middle" x="1979" y="-3588.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1979" y="-3577.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep3_tp0&#45;&gt;stage2_moe_gate_dp3_ep3_tp0 -->
<g id="edge955" class="edge">
<title>stage2_mha_dp3_ep3_tp0&#45;&gt;stage2_moe_gate_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M1979,-3725.72C1979,-3707.6 1979,-3682.4 1979,-3659.16"/>
<polygon fill="black" stroke="black" points="1982.5,-3659 1979,-3649 1975.5,-3659 1982.5,-3659"/>
</g>
<!-- stage2_expert1_dp3_ep3_tp0 -->
<g id="node831" class="node">
<title>stage2_expert1_dp3_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1970.5,-3481.98 1735.5,-3481.98 1735.5,-3429.98 1970.5,-3429.98 1970.5,-3481.98"/>
<text text-anchor="middle" x="1853" y="-3469.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1853" y="-3458.98" font-family="Times,serif" font-size="10.00">GPU 214</text>
<text text-anchor="middle" x="1853" y="-3447.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1853" y="-3436.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep3_tp0&#45;&gt;stage2_expert1_dp3_ep3_tp0 -->
<g id="edge956" class="edge">
<title>stage2_moe_gate_dp3_ep3_tp0&#45;&gt;stage2_expert1_dp3_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1932.44,-3544.62C1915.81,-3526.28 1897.54,-3506.12 1882.72,-3489.77"/>
<polygon fill="black" stroke="black" points="1885.05,-3487.13 1875.74,-3482.07 1879.87,-3491.83 1885.05,-3487.13"/>
</g>
<!-- stage2_expert2_dp3_ep3_tp0 -->
<g id="node832" class="node">
<title>stage2_expert2_dp3_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2223.5,-3481.98 1988.5,-3481.98 1988.5,-3429.98 2223.5,-3429.98 2223.5,-3481.98"/>
<text text-anchor="middle" x="2106" y="-3469.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2106" y="-3458.98" font-family="Times,serif" font-size="10.00">GPU 214</text>
<text text-anchor="middle" x="2106" y="-3447.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2106" y="-3436.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep3_tp0&#45;&gt;stage2_expert2_dp3_ep3_tp0 -->
<g id="edge957" class="edge">
<title>stage2_moe_gate_dp3_ep3_tp0&#45;&gt;stage2_expert2_dp3_ep3_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2025.93,-3544.62C2042.69,-3526.28 2061.1,-3506.12 2076.04,-3489.77"/>
<polygon fill="black" stroke="black" points="2078.92,-3491.82 2083.08,-3482.07 2073.75,-3487.09 2078.92,-3491.82"/>
</g>
<!-- stage2_expert_agg_dp3_ep3_tp0 -->
<g id="node833" class="node">
<title>stage2_expert_agg_dp3_ep3_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2208.33,-3366.98 1830.79,-3366.98 1733.67,-3262.98 2111.21,-3262.98 2208.33,-3366.98"/>
<text text-anchor="middle" x="1971" y="-3328.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1971" y="-3317.98" font-family="Times,serif" font-size="10.00">GPU 214</text>
<text text-anchor="middle" x="1971" y="-3306.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1971" y="-3295.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep3_tp0&#45;&gt;stage2_expert_agg_dp3_ep3_tp0 -->
<g id="edge958" class="edge">
<title>stage2_expert1_dp3_ep3_tp0&#45;&gt;stage2_expert_agg_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M1874.37,-3429.81C1887.39,-3414.48 1904.6,-3394.2 1920.88,-3375.02"/>
<polygon fill="black" stroke="black" points="1923.75,-3377.05 1927.55,-3367.17 1918.41,-3372.52 1923.75,-3377.05"/>
</g>
<!-- stage2_expert2_dp3_ep3_tp0&#45;&gt;stage2_expert_agg_dp3_ep3_tp0 -->
<g id="edge959" class="edge">
<title>stage2_expert2_dp3_ep3_tp0&#45;&gt;stage2_expert_agg_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M2081.55,-3429.81C2066.53,-3414.34 2046.62,-3393.84 2027.84,-3374.51"/>
<polygon fill="black" stroke="black" points="2030.19,-3371.9 2020.71,-3367.17 2025.17,-3376.78 2030.19,-3371.9"/>
</g>
<!-- stage2_ln2_dp3_ep3_tp0 -->
<g id="node834" class="node">
<title>stage2_ln2_dp3_ep3_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2085.5,-3204.98 1856.5,-3204.98 1856.5,-3152.98 2085.5,-3152.98 2085.5,-3204.98"/>
<text text-anchor="middle" x="1971" y="-3192.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1971" y="-3181.98" font-family="Times,serif" font-size="10.00">GPU 214</text>
<text text-anchor="middle" x="1971" y="-3170.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1971" y="-3159.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep3_tp0&#45;&gt;stage2_ln2_dp3_ep3_tp0 -->
<g id="edge960" class="edge">
<title>stage2_expert_agg_dp3_ep3_tp0&#45;&gt;stage2_ln2_dp3_ep3_tp0</title>
<path fill="none" stroke="black" d="M1971,-3262.94C1971,-3246.99 1971,-3229.76 1971,-3215.16"/>
<polygon fill="black" stroke="black" points="1974.5,-3215.04 1971,-3205.04 1967.5,-3215.04 1974.5,-3215.04"/>
</g>
<!-- stage2_ln1_dp3_ep4_tp0 -->
<g id="node842" class="node">
<title>stage2_ln1_dp3_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2085.5,-3094.98 1856.5,-3094.98 1856.5,-3042.98 2085.5,-3042.98 2085.5,-3094.98"/>
<text text-anchor="middle" x="1971" y="-3082.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1971" y="-3071.98" font-family="Times,serif" font-size="10.00">GPU 216</text>
<text text-anchor="middle" x="1971" y="-3060.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1971" y="-3049.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep3_tp0&#45;&gt;stage2_ln1_dp3_ep4_tp0 -->
<g id="edge961" class="edge">
<title>stage2_ln2_dp3_ep3_tp0&#45;&gt;stage2_ln1_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M1971,-3152.93C1971,-3138.86 1971,-3121.06 1971,-3105.56"/>
<polygon fill="black" stroke="black" points="1974.5,-3105.27 1971,-3095.27 1967.5,-3105.27 1974.5,-3105.27"/>
</g>
<!-- stage2_mha_dp3_ep3_tp1 -->
<g id="node836" class="node">
<title>stage2_mha_dp3_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2600.5,-3777.98 2371.5,-3777.98 2371.5,-3725.98 2600.5,-3725.98 2600.5,-3777.98"/>
<text text-anchor="middle" x="2486" y="-3765.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2486" y="-3754.98" font-family="Times,serif" font-size="10.00">GPU 215</text>
<text text-anchor="middle" x="2486" y="-3743.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2486" y="-3732.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep3_tp1&#45;&gt;stage2_mha_dp3_ep3_tp1 -->
<g id="edge962" class="edge">
<title>stage2_ln1_dp3_ep3_tp1&#45;&gt;stage2_mha_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M2486,-3840.9C2486,-3825.4 2486,-3805.26 2486,-3788.17"/>
<polygon fill="black" stroke="black" points="2489.5,-3787.99 2486,-3777.99 2482.5,-3787.99 2489.5,-3787.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep3_tp1 -->
<g id="node837" class="node">
<title>stage2_moe_gate_dp3_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2730.85,-3648.98 2341.35,-3648.98 2241.15,-3544.98 2630.65,-3544.98 2730.85,-3648.98"/>
<text text-anchor="middle" x="2486" y="-3610.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2486" y="-3599.98" font-family="Times,serif" font-size="10.00">GPU 215</text>
<text text-anchor="middle" x="2486" y="-3588.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2486" y="-3577.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep3_tp1&#45;&gt;stage2_moe_gate_dp3_ep3_tp1 -->
<g id="edge963" class="edge">
<title>stage2_mha_dp3_ep3_tp1&#45;&gt;stage2_moe_gate_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M2486,-3725.72C2486,-3707.6 2486,-3682.4 2486,-3659.16"/>
<polygon fill="black" stroke="black" points="2489.5,-3659 2486,-3649 2482.5,-3659 2489.5,-3659"/>
</g>
<!-- stage2_expert1_dp3_ep3_tp1 -->
<g id="node838" class="node">
<title>stage2_expert1_dp3_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2476.5,-3481.98 2241.5,-3481.98 2241.5,-3429.98 2476.5,-3429.98 2476.5,-3481.98"/>
<text text-anchor="middle" x="2359" y="-3469.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2359" y="-3458.98" font-family="Times,serif" font-size="10.00">GPU 215</text>
<text text-anchor="middle" x="2359" y="-3447.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2359" y="-3436.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep3_tp1&#45;&gt;stage2_expert1_dp3_ep3_tp1 -->
<g id="edge964" class="edge">
<title>stage2_moe_gate_dp3_ep3_tp1&#45;&gt;stage2_expert1_dp3_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2439.07,-3544.62C2422.31,-3526.28 2403.9,-3506.12 2388.96,-3489.77"/>
<polygon fill="black" stroke="black" points="2391.25,-3487.09 2381.92,-3482.07 2386.08,-3491.82 2391.25,-3487.09"/>
</g>
<!-- stage2_expert2_dp3_ep3_tp1 -->
<g id="node839" class="node">
<title>stage2_expert2_dp3_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2729.5,-3481.98 2494.5,-3481.98 2494.5,-3429.98 2729.5,-3429.98 2729.5,-3481.98"/>
<text text-anchor="middle" x="2612" y="-3469.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2612" y="-3458.98" font-family="Times,serif" font-size="10.00">GPU 215</text>
<text text-anchor="middle" x="2612" y="-3447.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2612" y="-3436.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep3_tp1&#45;&gt;stage2_expert2_dp3_ep3_tp1 -->
<g id="edge965" class="edge">
<title>stage2_moe_gate_dp3_ep3_tp1&#45;&gt;stage2_expert2_dp3_ep3_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2532.56,-3544.62C2549.19,-3526.28 2567.46,-3506.12 2582.28,-3489.77"/>
<polygon fill="black" stroke="black" points="2585.13,-3491.83 2589.26,-3482.07 2579.95,-3487.13 2585.13,-3491.83"/>
</g>
<!-- stage2_expert_agg_dp3_ep3_tp1 -->
<g id="node840" class="node">
<title>stage2_expert_agg_dp3_ep3_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2715.33,-3366.98 2337.79,-3366.98 2240.67,-3262.98 2618.21,-3262.98 2715.33,-3366.98"/>
<text text-anchor="middle" x="2478" y="-3328.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2478" y="-3317.98" font-family="Times,serif" font-size="10.00">GPU 215</text>
<text text-anchor="middle" x="2478" y="-3306.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2478" y="-3295.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep3_tp1&#45;&gt;stage2_expert_agg_dp3_ep3_tp1 -->
<g id="edge966" class="edge">
<title>stage2_expert1_dp3_ep3_tp1&#45;&gt;stage2_expert_agg_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M2380.55,-3429.81C2393.74,-3414.41 2411.19,-3394.02 2427.68,-3374.76"/>
<polygon fill="black" stroke="black" points="2430.34,-3377.04 2434.18,-3367.17 2425.02,-3372.49 2430.34,-3377.04"/>
</g>
<!-- stage2_expert2_dp3_ep3_tp1&#45;&gt;stage2_expert_agg_dp3_ep3_tp1 -->
<g id="edge967" class="edge">
<title>stage2_expert2_dp3_ep3_tp1&#45;&gt;stage2_expert_agg_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M2587.73,-3429.81C2572.82,-3414.34 2553.06,-3393.84 2534.42,-3374.51"/>
<polygon fill="black" stroke="black" points="2536.8,-3371.94 2527.34,-3367.17 2531.76,-3376.79 2536.8,-3371.94"/>
</g>
<!-- stage2_ln2_dp3_ep3_tp1 -->
<g id="node841" class="node">
<title>stage2_ln2_dp3_ep3_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2592.5,-3204.98 2363.5,-3204.98 2363.5,-3152.98 2592.5,-3152.98 2592.5,-3204.98"/>
<text text-anchor="middle" x="2478" y="-3192.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2478" y="-3181.98" font-family="Times,serif" font-size="10.00">GPU 215</text>
<text text-anchor="middle" x="2478" y="-3170.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2478" y="-3159.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep3_tp1&#45;&gt;stage2_ln2_dp3_ep3_tp1 -->
<g id="edge968" class="edge">
<title>stage2_expert_agg_dp3_ep3_tp1&#45;&gt;stage2_ln2_dp3_ep3_tp1</title>
<path fill="none" stroke="black" d="M2478,-3262.94C2478,-3246.99 2478,-3229.76 2478,-3215.16"/>
<polygon fill="black" stroke="black" points="2481.5,-3215.04 2478,-3205.04 2474.5,-3215.04 2481.5,-3215.04"/>
</g>
<!-- stage2_ln1_dp3_ep4_tp1 -->
<g id="node849" class="node">
<title>stage2_ln1_dp3_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2592.5,-3094.98 2363.5,-3094.98 2363.5,-3042.98 2592.5,-3042.98 2592.5,-3094.98"/>
<text text-anchor="middle" x="2478" y="-3082.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2478" y="-3071.98" font-family="Times,serif" font-size="10.00">GPU 217</text>
<text text-anchor="middle" x="2478" y="-3060.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2478" y="-3049.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep3_tp1&#45;&gt;stage2_ln1_dp3_ep4_tp1 -->
<g id="edge969" class="edge">
<title>stage2_ln2_dp3_ep3_tp1&#45;&gt;stage2_ln1_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M2478,-3152.93C2478,-3138.86 2478,-3121.06 2478,-3105.56"/>
<polygon fill="black" stroke="black" points="2481.5,-3105.27 2478,-3095.27 2474.5,-3105.27 2481.5,-3105.27"/>
</g>
<!-- stage2_mha_dp3_ep4_tp0 -->
<g id="node843" class="node">
<title>stage2_mha_dp3_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2085.5,-2979.98 1856.5,-2979.98 1856.5,-2927.98 2085.5,-2927.98 2085.5,-2979.98"/>
<text text-anchor="middle" x="1971" y="-2967.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1971" y="-2956.98" font-family="Times,serif" font-size="10.00">GPU 216</text>
<text text-anchor="middle" x="1971" y="-2945.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1971" y="-2934.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep4_tp0&#45;&gt;stage2_mha_dp3_ep4_tp0 -->
<g id="edge970" class="edge">
<title>stage2_ln1_dp3_ep4_tp0&#45;&gt;stage2_mha_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M1971,-3042.9C1971,-3027.4 1971,-3007.26 1971,-2990.17"/>
<polygon fill="black" stroke="black" points="1974.5,-2989.99 1971,-2979.99 1967.5,-2989.99 1974.5,-2989.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep4_tp0 -->
<g id="node844" class="node">
<title>stage2_moe_gate_dp3_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2215.85,-2850.98 1826.35,-2850.98 1726.15,-2746.98 2115.65,-2746.98 2215.85,-2850.98"/>
<text text-anchor="middle" x="1971" y="-2812.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1971" y="-2801.98" font-family="Times,serif" font-size="10.00">GPU 216</text>
<text text-anchor="middle" x="1971" y="-2790.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1971" y="-2779.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep4_tp0&#45;&gt;stage2_moe_gate_dp3_ep4_tp0 -->
<g id="edge971" class="edge">
<title>stage2_mha_dp3_ep4_tp0&#45;&gt;stage2_moe_gate_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M1971,-2927.72C1971,-2909.6 1971,-2884.4 1971,-2861.16"/>
<polygon fill="black" stroke="black" points="1974.5,-2861 1971,-2851 1967.5,-2861 1974.5,-2861"/>
</g>
<!-- stage2_expert1_dp3_ep4_tp0 -->
<g id="node845" class="node">
<title>stage2_expert1_dp3_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1962.5,-2683.98 1727.5,-2683.98 1727.5,-2631.98 1962.5,-2631.98 1962.5,-2683.98"/>
<text text-anchor="middle" x="1845" y="-2671.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1845" y="-2660.98" font-family="Times,serif" font-size="10.00">GPU 216</text>
<text text-anchor="middle" x="1845" y="-2649.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1845" y="-2638.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep4_tp0&#45;&gt;stage2_expert1_dp3_ep4_tp0 -->
<g id="edge972" class="edge">
<title>stage2_moe_gate_dp3_ep4_tp0&#45;&gt;stage2_expert1_dp3_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1924.44,-2746.62C1907.81,-2728.28 1889.54,-2708.12 1874.72,-2691.77"/>
<polygon fill="black" stroke="black" points="1877.05,-2689.13 1867.74,-2684.07 1871.87,-2693.83 1877.05,-2689.13"/>
</g>
<!-- stage2_expert2_dp3_ep4_tp0 -->
<g id="node846" class="node">
<title>stage2_expert2_dp3_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2215.5,-2683.98 1980.5,-2683.98 1980.5,-2631.98 2215.5,-2631.98 2215.5,-2683.98"/>
<text text-anchor="middle" x="2098" y="-2671.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2098" y="-2660.98" font-family="Times,serif" font-size="10.00">GPU 216</text>
<text text-anchor="middle" x="2098" y="-2649.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2098" y="-2638.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep4_tp0&#45;&gt;stage2_expert2_dp3_ep4_tp0 -->
<g id="edge973" class="edge">
<title>stage2_moe_gate_dp3_ep4_tp0&#45;&gt;stage2_expert2_dp3_ep4_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2017.93,-2746.62C2034.69,-2728.28 2053.1,-2708.12 2068.04,-2691.77"/>
<polygon fill="black" stroke="black" points="2070.92,-2693.82 2075.08,-2684.07 2065.75,-2689.09 2070.92,-2693.82"/>
</g>
<!-- stage2_expert_agg_dp3_ep4_tp0 -->
<g id="node847" class="node">
<title>stage2_expert_agg_dp3_ep4_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2200.33,-2568.98 1822.79,-2568.98 1725.67,-2464.98 2103.21,-2464.98 2200.33,-2568.98"/>
<text text-anchor="middle" x="1963" y="-2530.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1963" y="-2519.98" font-family="Times,serif" font-size="10.00">GPU 216</text>
<text text-anchor="middle" x="1963" y="-2508.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1963" y="-2497.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep4_tp0&#45;&gt;stage2_expert_agg_dp3_ep4_tp0 -->
<g id="edge974" class="edge">
<title>stage2_expert1_dp3_ep4_tp0&#45;&gt;stage2_expert_agg_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M1866.37,-2631.81C1879.39,-2616.48 1896.6,-2596.2 1912.88,-2577.02"/>
<polygon fill="black" stroke="black" points="1915.75,-2579.05 1919.55,-2569.17 1910.41,-2574.52 1915.75,-2579.05"/>
</g>
<!-- stage2_expert2_dp3_ep4_tp0&#45;&gt;stage2_expert_agg_dp3_ep4_tp0 -->
<g id="edge975" class="edge">
<title>stage2_expert2_dp3_ep4_tp0&#45;&gt;stage2_expert_agg_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M2073.55,-2631.81C2058.53,-2616.34 2038.62,-2595.84 2019.84,-2576.51"/>
<polygon fill="black" stroke="black" points="2022.19,-2573.9 2012.71,-2569.17 2017.17,-2578.78 2022.19,-2573.9"/>
</g>
<!-- stage2_ln2_dp3_ep4_tp0 -->
<g id="node848" class="node">
<title>stage2_ln2_dp3_ep4_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2077.5,-2406.98 1848.5,-2406.98 1848.5,-2354.98 2077.5,-2354.98 2077.5,-2406.98"/>
<text text-anchor="middle" x="1963" y="-2394.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1963" y="-2383.98" font-family="Times,serif" font-size="10.00">GPU 216</text>
<text text-anchor="middle" x="1963" y="-2372.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1963" y="-2361.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep4_tp0&#45;&gt;stage2_ln2_dp3_ep4_tp0 -->
<g id="edge976" class="edge">
<title>stage2_expert_agg_dp3_ep4_tp0&#45;&gt;stage2_ln2_dp3_ep4_tp0</title>
<path fill="none" stroke="black" d="M1963,-2464.94C1963,-2448.99 1963,-2431.76 1963,-2417.16"/>
<polygon fill="black" stroke="black" points="1966.5,-2417.04 1963,-2407.04 1959.5,-2417.04 1966.5,-2417.04"/>
</g>
<!-- stage2_ln1_dp3_ep5_tp0 -->
<g id="node856" class="node">
<title>stage2_ln1_dp3_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2077.5,-2296.98 1848.5,-2296.98 1848.5,-2244.98 2077.5,-2244.98 2077.5,-2296.98"/>
<text text-anchor="middle" x="1963" y="-2284.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1963" y="-2273.98" font-family="Times,serif" font-size="10.00">GPU 218</text>
<text text-anchor="middle" x="1963" y="-2262.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1963" y="-2251.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep4_tp0&#45;&gt;stage2_ln1_dp3_ep5_tp0 -->
<g id="edge977" class="edge">
<title>stage2_ln2_dp3_ep4_tp0&#45;&gt;stage2_ln1_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M1963,-2354.93C1963,-2340.86 1963,-2323.06 1963,-2307.56"/>
<polygon fill="black" stroke="black" points="1966.5,-2307.27 1963,-2297.27 1959.5,-2307.27 1966.5,-2307.27"/>
</g>
<!-- stage2_mha_dp3_ep4_tp1 -->
<g id="node850" class="node">
<title>stage2_mha_dp3_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2592.5,-2979.98 2363.5,-2979.98 2363.5,-2927.98 2592.5,-2927.98 2592.5,-2979.98"/>
<text text-anchor="middle" x="2478" y="-2967.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2478" y="-2956.98" font-family="Times,serif" font-size="10.00">GPU 217</text>
<text text-anchor="middle" x="2478" y="-2945.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2478" y="-2934.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep4_tp1&#45;&gt;stage2_mha_dp3_ep4_tp1 -->
<g id="edge978" class="edge">
<title>stage2_ln1_dp3_ep4_tp1&#45;&gt;stage2_mha_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M2478,-3042.9C2478,-3027.4 2478,-3007.26 2478,-2990.17"/>
<polygon fill="black" stroke="black" points="2481.5,-2989.99 2478,-2979.99 2474.5,-2989.99 2481.5,-2989.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep4_tp1 -->
<g id="node851" class="node">
<title>stage2_moe_gate_dp3_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2722.85,-2850.98 2333.35,-2850.98 2233.15,-2746.98 2622.65,-2746.98 2722.85,-2850.98"/>
<text text-anchor="middle" x="2478" y="-2812.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2478" y="-2801.98" font-family="Times,serif" font-size="10.00">GPU 217</text>
<text text-anchor="middle" x="2478" y="-2790.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2478" y="-2779.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep4_tp1&#45;&gt;stage2_moe_gate_dp3_ep4_tp1 -->
<g id="edge979" class="edge">
<title>stage2_mha_dp3_ep4_tp1&#45;&gt;stage2_moe_gate_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M2478,-2927.72C2478,-2909.6 2478,-2884.4 2478,-2861.16"/>
<polygon fill="black" stroke="black" points="2481.5,-2861 2478,-2851 2474.5,-2861 2481.5,-2861"/>
</g>
<!-- stage2_expert1_dp3_ep4_tp1 -->
<g id="node852" class="node">
<title>stage2_expert1_dp3_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2468.5,-2683.98 2233.5,-2683.98 2233.5,-2631.98 2468.5,-2631.98 2468.5,-2683.98"/>
<text text-anchor="middle" x="2351" y="-2671.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2351" y="-2660.98" font-family="Times,serif" font-size="10.00">GPU 217</text>
<text text-anchor="middle" x="2351" y="-2649.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2351" y="-2638.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep4_tp1&#45;&gt;stage2_expert1_dp3_ep4_tp1 -->
<g id="edge980" class="edge">
<title>stage2_moe_gate_dp3_ep4_tp1&#45;&gt;stage2_expert1_dp3_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2431.07,-2746.62C2414.31,-2728.28 2395.9,-2708.12 2380.96,-2691.77"/>
<polygon fill="black" stroke="black" points="2383.25,-2689.09 2373.92,-2684.07 2378.08,-2693.82 2383.25,-2689.09"/>
</g>
<!-- stage2_expert2_dp3_ep4_tp1 -->
<g id="node853" class="node">
<title>stage2_expert2_dp3_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2721.5,-2683.98 2486.5,-2683.98 2486.5,-2631.98 2721.5,-2631.98 2721.5,-2683.98"/>
<text text-anchor="middle" x="2604" y="-2671.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2604" y="-2660.98" font-family="Times,serif" font-size="10.00">GPU 217</text>
<text text-anchor="middle" x="2604" y="-2649.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2604" y="-2638.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep4_tp1&#45;&gt;stage2_expert2_dp3_ep4_tp1 -->
<g id="edge981" class="edge">
<title>stage2_moe_gate_dp3_ep4_tp1&#45;&gt;stage2_expert2_dp3_ep4_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2524.56,-2746.62C2541.19,-2728.28 2559.46,-2708.12 2574.28,-2691.77"/>
<polygon fill="black" stroke="black" points="2577.13,-2693.83 2581.26,-2684.07 2571.95,-2689.13 2577.13,-2693.83"/>
</g>
<!-- stage2_expert_agg_dp3_ep4_tp1 -->
<g id="node854" class="node">
<title>stage2_expert_agg_dp3_ep4_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2707.33,-2568.98 2329.79,-2568.98 2232.67,-2464.98 2610.21,-2464.98 2707.33,-2568.98"/>
<text text-anchor="middle" x="2470" y="-2530.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2470" y="-2519.98" font-family="Times,serif" font-size="10.00">GPU 217</text>
<text text-anchor="middle" x="2470" y="-2508.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2470" y="-2497.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep4_tp1&#45;&gt;stage2_expert_agg_dp3_ep4_tp1 -->
<g id="edge982" class="edge">
<title>stage2_expert1_dp3_ep4_tp1&#45;&gt;stage2_expert_agg_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M2372.55,-2631.81C2385.74,-2616.41 2403.19,-2596.02 2419.68,-2576.76"/>
<polygon fill="black" stroke="black" points="2422.34,-2579.04 2426.18,-2569.17 2417.02,-2574.49 2422.34,-2579.04"/>
</g>
<!-- stage2_expert2_dp3_ep4_tp1&#45;&gt;stage2_expert_agg_dp3_ep4_tp1 -->
<g id="edge983" class="edge">
<title>stage2_expert2_dp3_ep4_tp1&#45;&gt;stage2_expert_agg_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M2579.73,-2631.81C2564.82,-2616.34 2545.06,-2595.84 2526.42,-2576.51"/>
<polygon fill="black" stroke="black" points="2528.8,-2573.94 2519.34,-2569.17 2523.76,-2578.79 2528.8,-2573.94"/>
</g>
<!-- stage2_ln2_dp3_ep4_tp1 -->
<g id="node855" class="node">
<title>stage2_ln2_dp3_ep4_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2584.5,-2406.98 2355.5,-2406.98 2355.5,-2354.98 2584.5,-2354.98 2584.5,-2406.98"/>
<text text-anchor="middle" x="2470" y="-2394.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2470" y="-2383.98" font-family="Times,serif" font-size="10.00">GPU 217</text>
<text text-anchor="middle" x="2470" y="-2372.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2470" y="-2361.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep4_tp1&#45;&gt;stage2_ln2_dp3_ep4_tp1 -->
<g id="edge984" class="edge">
<title>stage2_expert_agg_dp3_ep4_tp1&#45;&gt;stage2_ln2_dp3_ep4_tp1</title>
<path fill="none" stroke="black" d="M2470,-2464.94C2470,-2448.99 2470,-2431.76 2470,-2417.16"/>
<polygon fill="black" stroke="black" points="2473.5,-2417.04 2470,-2407.04 2466.5,-2417.04 2473.5,-2417.04"/>
</g>
<!-- stage2_ln1_dp3_ep5_tp1 -->
<g id="node863" class="node">
<title>stage2_ln1_dp3_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2584.5,-2296.98 2355.5,-2296.98 2355.5,-2244.98 2584.5,-2244.98 2584.5,-2296.98"/>
<text text-anchor="middle" x="2470" y="-2284.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2470" y="-2273.98" font-family="Times,serif" font-size="10.00">GPU 219</text>
<text text-anchor="middle" x="2470" y="-2262.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2470" y="-2251.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep4_tp1&#45;&gt;stage2_ln1_dp3_ep5_tp1 -->
<g id="edge985" class="edge">
<title>stage2_ln2_dp3_ep4_tp1&#45;&gt;stage2_ln1_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M2470,-2354.93C2470,-2340.86 2470,-2323.06 2470,-2307.56"/>
<polygon fill="black" stroke="black" points="2473.5,-2307.27 2470,-2297.27 2466.5,-2307.27 2473.5,-2307.27"/>
</g>
<!-- stage2_mha_dp3_ep5_tp0 -->
<g id="node857" class="node">
<title>stage2_mha_dp3_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2077.5,-2181.98 1848.5,-2181.98 1848.5,-2129.98 2077.5,-2129.98 2077.5,-2181.98"/>
<text text-anchor="middle" x="1963" y="-2169.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1963" y="-2158.98" font-family="Times,serif" font-size="10.00">GPU 218</text>
<text text-anchor="middle" x="1963" y="-2147.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1963" y="-2136.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep5_tp0&#45;&gt;stage2_mha_dp3_ep5_tp0 -->
<g id="edge986" class="edge">
<title>stage2_ln1_dp3_ep5_tp0&#45;&gt;stage2_mha_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M1963,-2244.9C1963,-2229.4 1963,-2209.26 1963,-2192.17"/>
<polygon fill="black" stroke="black" points="1966.5,-2191.99 1963,-2181.99 1959.5,-2191.99 1966.5,-2191.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep5_tp0 -->
<g id="node858" class="node">
<title>stage2_moe_gate_dp3_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2207.85,-2052.98 1818.35,-2052.98 1718.15,-1948.98 2107.65,-1948.98 2207.85,-2052.98"/>
<text text-anchor="middle" x="1963" y="-2014.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1963" y="-2003.98" font-family="Times,serif" font-size="10.00">GPU 218</text>
<text text-anchor="middle" x="1963" y="-1992.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1963" y="-1981.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep5_tp0&#45;&gt;stage2_moe_gate_dp3_ep5_tp0 -->
<g id="edge987" class="edge">
<title>stage2_mha_dp3_ep5_tp0&#45;&gt;stage2_moe_gate_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M1963,-2129.72C1963,-2111.6 1963,-2086.4 1963,-2063.16"/>
<polygon fill="black" stroke="black" points="1966.5,-2063 1963,-2053 1959.5,-2063 1966.5,-2063"/>
</g>
<!-- stage2_expert1_dp3_ep5_tp0 -->
<g id="node859" class="node">
<title>stage2_expert1_dp3_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1954.5,-1885.98 1719.5,-1885.98 1719.5,-1833.98 1954.5,-1833.98 1954.5,-1885.98"/>
<text text-anchor="middle" x="1837" y="-1873.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1837" y="-1862.98" font-family="Times,serif" font-size="10.00">GPU 218</text>
<text text-anchor="middle" x="1837" y="-1851.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1837" y="-1840.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep5_tp0&#45;&gt;stage2_expert1_dp3_ep5_tp0 -->
<g id="edge988" class="edge">
<title>stage2_moe_gate_dp3_ep5_tp0&#45;&gt;stage2_expert1_dp3_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1916.44,-1948.62C1899.81,-1930.28 1881.54,-1910.12 1866.72,-1893.77"/>
<polygon fill="black" stroke="black" points="1869.05,-1891.13 1859.74,-1886.07 1863.87,-1895.83 1869.05,-1891.13"/>
</g>
<!-- stage2_expert2_dp3_ep5_tp0 -->
<g id="node860" class="node">
<title>stage2_expert2_dp3_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2207.5,-1885.98 1972.5,-1885.98 1972.5,-1833.98 2207.5,-1833.98 2207.5,-1885.98"/>
<text text-anchor="middle" x="2090" y="-1873.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2090" y="-1862.98" font-family="Times,serif" font-size="10.00">GPU 218</text>
<text text-anchor="middle" x="2090" y="-1851.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2090" y="-1840.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep5_tp0&#45;&gt;stage2_expert2_dp3_ep5_tp0 -->
<g id="edge989" class="edge">
<title>stage2_moe_gate_dp3_ep5_tp0&#45;&gt;stage2_expert2_dp3_ep5_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2009.93,-1948.62C2026.69,-1930.28 2045.1,-1910.12 2060.04,-1893.77"/>
<polygon fill="black" stroke="black" points="2062.92,-1895.82 2067.08,-1886.07 2057.75,-1891.09 2062.92,-1895.82"/>
</g>
<!-- stage2_expert_agg_dp3_ep5_tp0 -->
<g id="node861" class="node">
<title>stage2_expert_agg_dp3_ep5_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2200.33,-1770.98 1822.79,-1770.98 1725.67,-1666.98 2103.21,-1666.98 2200.33,-1770.98"/>
<text text-anchor="middle" x="1963" y="-1732.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1963" y="-1721.98" font-family="Times,serif" font-size="10.00">GPU 218</text>
<text text-anchor="middle" x="1963" y="-1710.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1963" y="-1699.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep5_tp0&#45;&gt;stage2_expert_agg_dp3_ep5_tp0 -->
<g id="edge990" class="edge">
<title>stage2_expert1_dp3_ep5_tp0&#45;&gt;stage2_expert_agg_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M1859.82,-1833.81C1873.78,-1818.41 1892.26,-1798.02 1909.72,-1778.76"/>
<polygon fill="black" stroke="black" points="1912.48,-1780.92 1916.6,-1771.17 1907.3,-1776.22 1912.48,-1780.92"/>
</g>
<!-- stage2_expert2_dp3_ep5_tp0&#45;&gt;stage2_expert_agg_dp3_ep5_tp0 -->
<g id="edge991" class="edge">
<title>stage2_expert2_dp3_ep5_tp0&#45;&gt;stage2_expert_agg_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M2067,-1833.81C2052.93,-1818.41 2034.3,-1798.02 2016.7,-1778.76"/>
<polygon fill="black" stroke="black" points="2019.09,-1776.19 2009.76,-1771.17 2013.93,-1780.91 2019.09,-1776.19"/>
</g>
<!-- stage2_ln2_dp3_ep5_tp0 -->
<g id="node862" class="node">
<title>stage2_ln2_dp3_ep5_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2077.5,-1608.98 1848.5,-1608.98 1848.5,-1556.98 2077.5,-1556.98 2077.5,-1608.98"/>
<text text-anchor="middle" x="1963" y="-1596.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1963" y="-1585.98" font-family="Times,serif" font-size="10.00">GPU 218</text>
<text text-anchor="middle" x="1963" y="-1574.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1963" y="-1563.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep5_tp0&#45;&gt;stage2_ln2_dp3_ep5_tp0 -->
<g id="edge992" class="edge">
<title>stage2_expert_agg_dp3_ep5_tp0&#45;&gt;stage2_ln2_dp3_ep5_tp0</title>
<path fill="none" stroke="black" d="M1963,-1666.94C1963,-1650.99 1963,-1633.76 1963,-1619.16"/>
<polygon fill="black" stroke="black" points="1966.5,-1619.04 1963,-1609.04 1959.5,-1619.04 1966.5,-1619.04"/>
</g>
<!-- stage2_ln1_dp3_ep6_tp0 -->
<g id="node870" class="node">
<title>stage2_ln1_dp3_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2077.5,-1498.98 1848.5,-1498.98 1848.5,-1446.98 2077.5,-1446.98 2077.5,-1498.98"/>
<text text-anchor="middle" x="1963" y="-1486.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1963" y="-1475.98" font-family="Times,serif" font-size="10.00">GPU 220</text>
<text text-anchor="middle" x="1963" y="-1464.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1963" y="-1453.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep5_tp0&#45;&gt;stage2_ln1_dp3_ep6_tp0 -->
<g id="edge993" class="edge">
<title>stage2_ln2_dp3_ep5_tp0&#45;&gt;stage2_ln1_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M1963,-1556.93C1963,-1542.86 1963,-1525.06 1963,-1509.56"/>
<polygon fill="black" stroke="black" points="1966.5,-1509.27 1963,-1499.27 1959.5,-1509.27 1966.5,-1509.27"/>
</g>
<!-- stage2_mha_dp3_ep5_tp1 -->
<g id="node864" class="node">
<title>stage2_mha_dp3_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2584.5,-2181.98 2355.5,-2181.98 2355.5,-2129.98 2584.5,-2129.98 2584.5,-2181.98"/>
<text text-anchor="middle" x="2470" y="-2169.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2470" y="-2158.98" font-family="Times,serif" font-size="10.00">GPU 219</text>
<text text-anchor="middle" x="2470" y="-2147.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2470" y="-2136.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep5_tp1&#45;&gt;stage2_mha_dp3_ep5_tp1 -->
<g id="edge994" class="edge">
<title>stage2_ln1_dp3_ep5_tp1&#45;&gt;stage2_mha_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M2470,-2244.9C2470,-2229.4 2470,-2209.26 2470,-2192.17"/>
<polygon fill="black" stroke="black" points="2473.5,-2191.99 2470,-2181.99 2466.5,-2191.99 2473.5,-2191.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep5_tp1 -->
<g id="node865" class="node">
<title>stage2_moe_gate_dp3_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2714.85,-2052.98 2325.35,-2052.98 2225.15,-1948.98 2614.65,-1948.98 2714.85,-2052.98"/>
<text text-anchor="middle" x="2470" y="-2014.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2470" y="-2003.98" font-family="Times,serif" font-size="10.00">GPU 219</text>
<text text-anchor="middle" x="2470" y="-1992.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2470" y="-1981.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep5_tp1&#45;&gt;stage2_moe_gate_dp3_ep5_tp1 -->
<g id="edge995" class="edge">
<title>stage2_mha_dp3_ep5_tp1&#45;&gt;stage2_moe_gate_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M2470,-2129.72C2470,-2111.6 2470,-2086.4 2470,-2063.16"/>
<polygon fill="black" stroke="black" points="2473.5,-2063 2470,-2053 2466.5,-2063 2473.5,-2063"/>
</g>
<!-- stage2_expert1_dp3_ep5_tp1 -->
<g id="node866" class="node">
<title>stage2_expert1_dp3_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2460.5,-1885.98 2225.5,-1885.98 2225.5,-1833.98 2460.5,-1833.98 2460.5,-1885.98"/>
<text text-anchor="middle" x="2343" y="-1873.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2343" y="-1862.98" font-family="Times,serif" font-size="10.00">GPU 219</text>
<text text-anchor="middle" x="2343" y="-1851.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2343" y="-1840.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep5_tp1&#45;&gt;stage2_expert1_dp3_ep5_tp1 -->
<g id="edge996" class="edge">
<title>stage2_moe_gate_dp3_ep5_tp1&#45;&gt;stage2_expert1_dp3_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2423.07,-1948.62C2406.31,-1930.28 2387.9,-1910.12 2372.96,-1893.77"/>
<polygon fill="black" stroke="black" points="2375.25,-1891.09 2365.92,-1886.07 2370.08,-1895.82 2375.25,-1891.09"/>
</g>
<!-- stage2_expert2_dp3_ep5_tp1 -->
<g id="node867" class="node">
<title>stage2_expert2_dp3_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2713.5,-1885.98 2478.5,-1885.98 2478.5,-1833.98 2713.5,-1833.98 2713.5,-1885.98"/>
<text text-anchor="middle" x="2596" y="-1873.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2596" y="-1862.98" font-family="Times,serif" font-size="10.00">GPU 219</text>
<text text-anchor="middle" x="2596" y="-1851.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2596" y="-1840.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep5_tp1&#45;&gt;stage2_expert2_dp3_ep5_tp1 -->
<g id="edge997" class="edge">
<title>stage2_moe_gate_dp3_ep5_tp1&#45;&gt;stage2_expert2_dp3_ep5_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2516.56,-1948.62C2533.19,-1930.28 2551.46,-1910.12 2566.28,-1893.77"/>
<polygon fill="black" stroke="black" points="2569.13,-1895.83 2573.26,-1886.07 2563.95,-1891.13 2569.13,-1895.83"/>
</g>
<!-- stage2_expert_agg_dp3_ep5_tp1 -->
<g id="node868" class="node">
<title>stage2_expert_agg_dp3_ep5_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2707.33,-1770.98 2329.79,-1770.98 2232.67,-1666.98 2610.21,-1666.98 2707.33,-1770.98"/>
<text text-anchor="middle" x="2470" y="-1732.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2470" y="-1721.98" font-family="Times,serif" font-size="10.00">GPU 219</text>
<text text-anchor="middle" x="2470" y="-1710.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2470" y="-1699.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep5_tp1&#45;&gt;stage2_expert_agg_dp3_ep5_tp1 -->
<g id="edge998" class="edge">
<title>stage2_expert1_dp3_ep5_tp1&#45;&gt;stage2_expert_agg_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M2366,-1833.81C2380.07,-1818.41 2398.7,-1798.02 2416.3,-1778.76"/>
<polygon fill="black" stroke="black" points="2419.07,-1780.91 2423.24,-1771.17 2413.91,-1776.19 2419.07,-1780.91"/>
</g>
<!-- stage2_expert2_dp3_ep5_tp1&#45;&gt;stage2_expert_agg_dp3_ep5_tp1 -->
<g id="edge999" class="edge">
<title>stage2_expert2_dp3_ep5_tp1&#45;&gt;stage2_expert_agg_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M2573.18,-1833.81C2559.22,-1818.41 2540.74,-1798.02 2523.28,-1778.76"/>
<polygon fill="black" stroke="black" points="2525.7,-1776.22 2516.4,-1771.17 2520.52,-1780.92 2525.7,-1776.22"/>
</g>
<!-- stage2_ln2_dp3_ep5_tp1 -->
<g id="node869" class="node">
<title>stage2_ln2_dp3_ep5_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2584.5,-1608.98 2355.5,-1608.98 2355.5,-1556.98 2584.5,-1556.98 2584.5,-1608.98"/>
<text text-anchor="middle" x="2470" y="-1596.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2470" y="-1585.98" font-family="Times,serif" font-size="10.00">GPU 219</text>
<text text-anchor="middle" x="2470" y="-1574.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2470" y="-1563.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep5_tp1&#45;&gt;stage2_ln2_dp3_ep5_tp1 -->
<g id="edge1000" class="edge">
<title>stage2_expert_agg_dp3_ep5_tp1&#45;&gt;stage2_ln2_dp3_ep5_tp1</title>
<path fill="none" stroke="black" d="M2470,-1666.94C2470,-1650.99 2470,-1633.76 2470,-1619.16"/>
<polygon fill="black" stroke="black" points="2473.5,-1619.04 2470,-1609.04 2466.5,-1619.04 2473.5,-1619.04"/>
</g>
<!-- stage2_ln1_dp3_ep6_tp1 -->
<g id="node877" class="node">
<title>stage2_ln1_dp3_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2584.5,-1498.98 2355.5,-1498.98 2355.5,-1446.98 2584.5,-1446.98 2584.5,-1498.98"/>
<text text-anchor="middle" x="2470" y="-1486.98" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2470" y="-1475.98" font-family="Times,serif" font-size="10.00">GPU 221</text>
<text text-anchor="middle" x="2470" y="-1464.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2470" y="-1453.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep5_tp1&#45;&gt;stage2_ln1_dp3_ep6_tp1 -->
<g id="edge1001" class="edge">
<title>stage2_ln2_dp3_ep5_tp1&#45;&gt;stage2_ln1_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M2470,-1556.93C2470,-1542.86 2470,-1525.06 2470,-1509.56"/>
<polygon fill="black" stroke="black" points="2473.5,-1509.27 2470,-1499.27 2466.5,-1509.27 2473.5,-1509.27"/>
</g>
<!-- stage2_mha_dp3_ep6_tp0 -->
<g id="node871" class="node">
<title>stage2_mha_dp3_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2077.5,-1383.98 1848.5,-1383.98 1848.5,-1331.98 2077.5,-1331.98 2077.5,-1383.98"/>
<text text-anchor="middle" x="1963" y="-1371.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="1963" y="-1360.98" font-family="Times,serif" font-size="10.00">GPU 220</text>
<text text-anchor="middle" x="1963" y="-1349.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1963" y="-1338.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep6_tp0&#45;&gt;stage2_mha_dp3_ep6_tp0 -->
<g id="edge1002" class="edge">
<title>stage2_ln1_dp3_ep6_tp0&#45;&gt;stage2_mha_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M1963,-1446.9C1963,-1431.4 1963,-1411.26 1963,-1394.17"/>
<polygon fill="black" stroke="black" points="1966.5,-1393.99 1963,-1383.99 1959.5,-1393.99 1966.5,-1393.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep6_tp0 -->
<g id="node872" class="node">
<title>stage2_moe_gate_dp3_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2207.85,-1254.98 1818.35,-1254.98 1718.15,-1150.98 2107.65,-1150.98 2207.85,-1254.98"/>
<text text-anchor="middle" x="1963" y="-1216.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="1963" y="-1205.98" font-family="Times,serif" font-size="10.00">GPU 220</text>
<text text-anchor="middle" x="1963" y="-1194.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1963" y="-1183.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep6_tp0&#45;&gt;stage2_moe_gate_dp3_ep6_tp0 -->
<g id="edge1003" class="edge">
<title>stage2_mha_dp3_ep6_tp0&#45;&gt;stage2_moe_gate_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M1963,-1331.72C1963,-1313.6 1963,-1288.4 1963,-1265.16"/>
<polygon fill="black" stroke="black" points="1966.5,-1265 1963,-1255 1959.5,-1265 1966.5,-1265"/>
</g>
<!-- stage2_expert1_dp3_ep6_tp0 -->
<g id="node873" class="node">
<title>stage2_expert1_dp3_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="1954.5,-1087.98 1719.5,-1087.98 1719.5,-1035.98 1954.5,-1035.98 1954.5,-1087.98"/>
<text text-anchor="middle" x="1837" y="-1075.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="1837" y="-1064.98" font-family="Times,serif" font-size="10.00">GPU 220</text>
<text text-anchor="middle" x="1837" y="-1053.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="1837" y="-1042.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep6_tp0&#45;&gt;stage2_expert1_dp3_ep6_tp0 -->
<g id="edge1004" class="edge">
<title>stage2_moe_gate_dp3_ep6_tp0&#45;&gt;stage2_expert1_dp3_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1916.44,-1150.62C1899.81,-1132.28 1881.54,-1112.12 1866.72,-1095.77"/>
<polygon fill="black" stroke="black" points="1869.05,-1093.13 1859.74,-1088.07 1863.87,-1097.83 1869.05,-1093.13"/>
</g>
<!-- stage2_expert2_dp3_ep6_tp0 -->
<g id="node874" class="node">
<title>stage2_expert2_dp3_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2207.5,-1087.98 1972.5,-1087.98 1972.5,-1035.98 2207.5,-1035.98 2207.5,-1087.98"/>
<text text-anchor="middle" x="2090" y="-1075.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2090" y="-1064.98" font-family="Times,serif" font-size="10.00">GPU 220</text>
<text text-anchor="middle" x="2090" y="-1053.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2090" y="-1042.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep6_tp0&#45;&gt;stage2_expert2_dp3_ep6_tp0 -->
<g id="edge1005" class="edge">
<title>stage2_moe_gate_dp3_ep6_tp0&#45;&gt;stage2_expert2_dp3_ep6_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2009.93,-1150.62C2026.69,-1132.28 2045.1,-1112.12 2060.04,-1095.77"/>
<polygon fill="black" stroke="black" points="2062.92,-1097.82 2067.08,-1088.07 2057.75,-1093.09 2062.92,-1097.82"/>
</g>
<!-- stage2_expert_agg_dp3_ep6_tp0 -->
<g id="node875" class="node">
<title>stage2_expert_agg_dp3_ep6_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2222.33,-972.98 1844.79,-972.98 1747.67,-868.98 2125.21,-868.98 2222.33,-972.98"/>
<text text-anchor="middle" x="1985" y="-934.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1985" y="-923.98" font-family="Times,serif" font-size="10.00">GPU 220</text>
<text text-anchor="middle" x="1985" y="-912.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="1985" y="-901.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep6_tp0&#45;&gt;stage2_expert_agg_dp3_ep6_tp0 -->
<g id="edge1006" class="edge">
<title>stage2_expert1_dp3_ep6_tp0&#45;&gt;stage2_expert_agg_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M1863.8,-1035.81C1880.35,-1020.27 1902.29,-999.66 1922.96,-980.25"/>
<polygon fill="black" stroke="black" points="1925.61,-982.56 1930.5,-973.17 1920.82,-977.46 1925.61,-982.56"/>
</g>
<!-- stage2_expert2_dp3_ep6_tp0&#45;&gt;stage2_expert_agg_dp3_ep6_tp0 -->
<g id="edge1007" class="edge">
<title>stage2_expert2_dp3_ep6_tp0&#45;&gt;stage2_expert_agg_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M2070.99,-1035.81C2059.45,-1020.55 2044.22,-1000.38 2029.79,-981.27"/>
<polygon fill="black" stroke="black" points="2032.48,-979.03 2023.66,-973.17 2026.9,-983.25 2032.48,-979.03"/>
</g>
<!-- stage2_ln2_dp3_ep6_tp0 -->
<g id="node876" class="node">
<title>stage2_ln2_dp3_ep6_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2317.5,-828.99 2088.5,-828.99 2088.5,-776.99 2317.5,-776.99 2317.5,-828.99"/>
<text text-anchor="middle" x="2203" y="-816.99" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2203" y="-805.99" font-family="Times,serif" font-size="10.00">GPU 220</text>
<text text-anchor="middle" x="2203" y="-794.99" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2203" y="-783.99" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep6_tp0&#45;&gt;stage2_ln2_dp3_ep6_tp0 -->
<g id="edge1008" class="edge">
<title>stage2_expert_agg_dp3_ep6_tp0&#45;&gt;stage2_ln2_dp3_ep6_tp0</title>
<path fill="none" stroke="black" d="M2080.94,-868.94C2103.42,-856.97 2126.66,-844.61 2146.75,-833.92"/>
<polygon fill="black" stroke="black" points="2148.56,-836.92 2155.74,-829.13 2145.27,-830.74 2148.56,-836.92"/>
</g>
<!-- stage2_ln1_dp3_ep7_tp0 -->
<g id="node884" class="node">
<title>stage2_ln1_dp3_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2600.5,-716 2371.5,-716 2371.5,-664 2600.5,-664 2600.5,-716"/>
<text text-anchor="middle" x="2486" y="-704" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2486" y="-693" font-family="Times,serif" font-size="10.00">GPU 222</text>
<text text-anchor="middle" x="2486" y="-682" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2486" y="-671" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep6_tp0&#45;&gt;stage2_ln1_dp3_ep7_tp0 -->
<g id="edge1009" class="edge">
<title>stage2_ln2_dp3_ep6_tp0&#45;&gt;stage2_ln1_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2266.86,-776.94C2310.09,-759.99 2367.31,-737.55 2412.44,-719.85"/>
<polygon fill="black" stroke="black" points="2413.85,-723.06 2421.88,-716.15 2411.29,-716.54 2413.85,-723.06"/>
</g>
<!-- stage2_mha_dp3_ep6_tp1 -->
<g id="node878" class="node">
<title>stage2_mha_dp3_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2584.5,-1383.98 2355.5,-1383.98 2355.5,-1331.98 2584.5,-1331.98 2584.5,-1383.98"/>
<text text-anchor="middle" x="2470" y="-1371.98" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2470" y="-1360.98" font-family="Times,serif" font-size="10.00">GPU 221</text>
<text text-anchor="middle" x="2470" y="-1349.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2470" y="-1338.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep6_tp1&#45;&gt;stage2_mha_dp3_ep6_tp1 -->
<g id="edge1010" class="edge">
<title>stage2_ln1_dp3_ep6_tp1&#45;&gt;stage2_mha_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M2470,-1446.9C2470,-1431.4 2470,-1411.26 2470,-1394.17"/>
<polygon fill="black" stroke="black" points="2473.5,-1393.99 2470,-1383.99 2466.5,-1393.99 2473.5,-1393.99"/>
</g>
<!-- stage2_moe_gate_dp3_ep6_tp1 -->
<g id="node879" class="node">
<title>stage2_moe_gate_dp3_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2714.85,-1254.98 2325.35,-1254.98 2225.15,-1150.98 2614.65,-1150.98 2714.85,-1254.98"/>
<text text-anchor="middle" x="2470" y="-1216.98" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2470" y="-1205.98" font-family="Times,serif" font-size="10.00">GPU 221</text>
<text text-anchor="middle" x="2470" y="-1194.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2470" y="-1183.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep6_tp1&#45;&gt;stage2_moe_gate_dp3_ep6_tp1 -->
<g id="edge1011" class="edge">
<title>stage2_mha_dp3_ep6_tp1&#45;&gt;stage2_moe_gate_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M2470,-1331.72C2470,-1313.6 2470,-1288.4 2470,-1265.16"/>
<polygon fill="black" stroke="black" points="2473.5,-1265 2470,-1255 2466.5,-1265 2473.5,-1265"/>
</g>
<!-- stage2_expert1_dp3_ep6_tp1 -->
<g id="node880" class="node">
<title>stage2_expert1_dp3_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2460.5,-1087.98 2225.5,-1087.98 2225.5,-1035.98 2460.5,-1035.98 2460.5,-1087.98"/>
<text text-anchor="middle" x="2343" y="-1075.98" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2343" y="-1064.98" font-family="Times,serif" font-size="10.00">GPU 221</text>
<text text-anchor="middle" x="2343" y="-1053.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2343" y="-1042.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep6_tp1&#45;&gt;stage2_expert1_dp3_ep6_tp1 -->
<g id="edge1012" class="edge">
<title>stage2_moe_gate_dp3_ep6_tp1&#45;&gt;stage2_expert1_dp3_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2423.07,-1150.62C2406.31,-1132.28 2387.9,-1112.12 2372.96,-1095.77"/>
<polygon fill="black" stroke="black" points="2375.25,-1093.09 2365.92,-1088.07 2370.08,-1097.82 2375.25,-1093.09"/>
</g>
<!-- stage2_expert2_dp3_ep6_tp1 -->
<g id="node881" class="node">
<title>stage2_expert2_dp3_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2713.5,-1087.98 2478.5,-1087.98 2478.5,-1035.98 2713.5,-1035.98 2713.5,-1087.98"/>
<text text-anchor="middle" x="2596" y="-1075.98" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2596" y="-1064.98" font-family="Times,serif" font-size="10.00">GPU 221</text>
<text text-anchor="middle" x="2596" y="-1053.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2596" y="-1042.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep6_tp1&#45;&gt;stage2_expert2_dp3_ep6_tp1 -->
<g id="edge1013" class="edge">
<title>stage2_moe_gate_dp3_ep6_tp1&#45;&gt;stage2_expert2_dp3_ep6_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2516.56,-1150.62C2533.19,-1132.28 2551.46,-1112.12 2566.28,-1095.77"/>
<polygon fill="black" stroke="black" points="2569.13,-1097.83 2573.26,-1088.07 2563.95,-1093.13 2569.13,-1097.83"/>
</g>
<!-- stage2_expert_agg_dp3_ep6_tp1 -->
<g id="node882" class="node">
<title>stage2_expert_agg_dp3_ep6_tp1</title>
<polygon fill="lightyellow" stroke="black" points="2715.33,-972.98 2337.79,-972.98 2240.67,-868.98 2618.21,-868.98 2715.33,-972.98"/>
<text text-anchor="middle" x="2478" y="-934.98" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2478" y="-923.98" font-family="Times,serif" font-size="10.00">GPU 221</text>
<text text-anchor="middle" x="2478" y="-912.98" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2478" y="-901.98" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep6_tp1&#45;&gt;stage2_expert_agg_dp3_ep6_tp1 -->
<g id="edge1014" class="edge">
<title>stage2_expert1_dp3_ep6_tp1&#45;&gt;stage2_expert_agg_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M2367.45,-1035.81C2382.47,-1020.34 2402.38,-999.84 2421.16,-980.51"/>
<polygon fill="black" stroke="black" points="2423.83,-982.78 2428.29,-973.17 2418.81,-977.9 2423.83,-982.78"/>
</g>
<!-- stage2_expert2_dp3_ep6_tp1&#45;&gt;stage2_expert_agg_dp3_ep6_tp1 -->
<g id="edge1015" class="edge">
<title>stage2_expert2_dp3_ep6_tp1&#45;&gt;stage2_expert_agg_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M2574.63,-1035.81C2561.61,-1020.48 2544.4,-1000.2 2528.12,-981.02"/>
<polygon fill="black" stroke="black" points="2530.59,-978.52 2521.45,-973.17 2525.25,-983.05 2530.59,-978.52"/>
</g>
<!-- stage2_ln2_dp3_ep6_tp1 -->
<g id="node883" class="node">
<title>stage2_ln2_dp3_ep6_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2635.5,-828.99 2406.5,-828.99 2406.5,-776.99 2635.5,-776.99 2635.5,-828.99"/>
<text text-anchor="middle" x="2521" y="-816.99" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2521" y="-805.99" font-family="Times,serif" font-size="10.00">GPU 221</text>
<text text-anchor="middle" x="2521" y="-794.99" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2521" y="-783.99" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep6_tp1&#45;&gt;stage2_ln2_dp3_ep6_tp1 -->
<g id="edge1016" class="edge">
<title>stage2_expert_agg_dp3_ep6_tp1&#45;&gt;stage2_ln2_dp3_ep6_tp1</title>
<path fill="none" stroke="black" d="M2496.99,-868.77C2500.76,-858.59 2504.64,-848.13 2508.15,-838.66"/>
<polygon fill="black" stroke="black" points="2511.46,-839.8 2511.65,-829.21 2504.89,-837.37 2511.46,-839.8"/>
</g>
<!-- stage2_ln1_dp3_ep7_tp1 -->
<g id="node891" class="node">
<title>stage2_ln1_dp3_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3107.5,-716 2878.5,-716 2878.5,-664 3107.5,-664 3107.5,-716"/>
<text text-anchor="middle" x="2993" y="-704" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="2993" y="-693" font-family="Times,serif" font-size="10.00">GPU 223</text>
<text text-anchor="middle" x="2993" y="-682" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2993" y="-671" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln2_dp3_ep6_tp1&#45;&gt;stage2_ln1_dp3_ep7_tp1 -->
<g id="edge1017" class="edge">
<title>stage2_ln2_dp3_ep6_tp1&#45;&gt;stage2_ln1_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M2627.51,-776.94C2701.55,-759.54 2800.2,-736.34 2876.35,-718.43"/>
<polygon fill="black" stroke="black" points="2877.53,-721.75 2886.47,-716.05 2875.93,-714.93 2877.53,-721.75"/>
</g>
<!-- stage2_mha_dp3_ep7_tp0 -->
<g id="node885" class="node">
<title>stage2_mha_dp3_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2600.5,-627 2371.5,-627 2371.5,-575 2600.5,-575 2600.5,-627"/>
<text text-anchor="middle" x="2486" y="-615" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2486" y="-604" font-family="Times,serif" font-size="10.00">GPU 222</text>
<text text-anchor="middle" x="2486" y="-593" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2486" y="-582" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep7_tp0&#45;&gt;stage2_mha_dp3_ep7_tp0 -->
<g id="edge1018" class="edge">
<title>stage2_ln1_dp3_ep7_tp0&#45;&gt;stage2_mha_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2486,-663.84C2486,-655.54 2486,-646.15 2486,-637.25"/>
<polygon fill="black" stroke="black" points="2489.5,-637.11 2486,-627.11 2482.5,-637.11 2489.5,-637.11"/>
</g>
<!-- stage2_moe_gate_dp3_ep7_tp0 -->
<g id="node886" class="node">
<title>stage2_moe_gate_dp3_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2730.85,-538 2341.35,-538 2241.15,-434 2630.65,-434 2730.85,-538"/>
<text text-anchor="middle" x="2486" y="-500" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2486" y="-489" font-family="Times,serif" font-size="10.00">GPU 222</text>
<text text-anchor="middle" x="2486" y="-478" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2486" y="-467" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep7_tp0&#45;&gt;stage2_moe_gate_dp3_ep7_tp0 -->
<g id="edge1019" class="edge">
<title>stage2_mha_dp3_ep7_tp0&#45;&gt;stage2_moe_gate_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2486,-574.92C2486,-567 2486,-557.86 2486,-548.54"/>
<polygon fill="black" stroke="black" points="2489.5,-548.4 2486,-538.4 2482.5,-548.4 2489.5,-548.4"/>
</g>
<!-- stage2_expert1_dp3_ep7_tp0 -->
<g id="node887" class="node">
<title>stage2_expert1_dp3_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2477.5,-397 2242.5,-397 2242.5,-345 2477.5,-345 2477.5,-397"/>
<text text-anchor="middle" x="2360" y="-385" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2360" y="-374" font-family="Times,serif" font-size="10.00">GPU 222</text>
<text text-anchor="middle" x="2360" y="-363" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2360" y="-352" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep7_tp0&#45;&gt;stage2_expert1_dp3_ep7_tp0 -->
<g id="edge1020" class="edge">
<title>stage2_moe_gate_dp3_ep7_tp0&#45;&gt;stage2_expert1_dp3_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2428.9,-433.79C2417.59,-423.65 2406.02,-413.27 2395.67,-403.99"/>
<polygon fill="black" stroke="black" points="2397.8,-401.2 2388.02,-397.13 2393.13,-406.41 2397.8,-401.2"/>
</g>
<!-- stage2_expert2_dp3_ep7_tp0 -->
<g id="node888" class="node">
<title>stage2_expert2_dp3_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2730.5,-397 2495.5,-397 2495.5,-345 2730.5,-345 2730.5,-397"/>
<text text-anchor="middle" x="2613" y="-385" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="2613" y="-374" font-family="Times,serif" font-size="10.00">GPU 222</text>
<text text-anchor="middle" x="2613" y="-363" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2613" y="-352" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep7_tp0&#45;&gt;stage2_expert2_dp3_ep7_tp0 -->
<g id="edge1021" class="edge">
<title>stage2_moe_gate_dp3_ep7_tp0&#45;&gt;stage2_expert2_dp3_ep7_tp0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2543.55,-433.79C2554.96,-423.65 2566.61,-413.27 2577.04,-403.99"/>
<polygon fill="black" stroke="black" points="2579.61,-406.39 2584.76,-397.13 2574.96,-401.16 2579.61,-406.39"/>
</g>
<!-- stage2_expert_agg_dp3_ep7_tp0 -->
<g id="node889" class="node">
<title>stage2_expert_agg_dp3_ep7_tp0</title>
<polygon fill="lightyellow" stroke="black" points="2730.33,-308 2352.79,-308 2255.67,-204 2633.21,-204 2730.33,-308"/>
<text text-anchor="middle" x="2493" y="-270" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2493" y="-259" font-family="Times,serif" font-size="10.00">GPU 222</text>
<text text-anchor="middle" x="2493" y="-248" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2493" y="-237" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep7_tp0&#45;&gt;stage2_expert_agg_dp3_ep7_tp0 -->
<g id="edge1022" class="edge">
<title>stage2_expert1_dp3_ep7_tp0&#45;&gt;stage2_expert_agg_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2389.52,-344.92C2400.1,-335.93 2412.52,-325.38 2425,-314.77"/>
<polygon fill="black" stroke="black" points="2427.42,-317.31 2432.77,-308.17 2422.88,-311.98 2427.42,-317.31"/>
</g>
<!-- stage2_expert2_dp3_ep7_tp0&#45;&gt;stage2_expert_agg_dp3_ep7_tp0 -->
<g id="edge1023" class="edge">
<title>stage2_expert2_dp3_ep7_tp0&#45;&gt;stage2_expert_agg_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2586.37,-344.92C2576.97,-336.07 2565.96,-325.7 2554.87,-315.26"/>
<polygon fill="black" stroke="black" points="2557.26,-312.71 2547.58,-308.4 2552.47,-317.8 2557.26,-312.71"/>
</g>
<!-- stage2_ln2_dp3_ep7_tp0 -->
<g id="node890" class="node">
<title>stage2_ln2_dp3_ep7_tp0</title>
<polygon fill="lightgreen" stroke="black" points="2745.5,-167 2516.5,-167 2516.5,-115 2745.5,-115 2745.5,-167"/>
<text text-anchor="middle" x="2631" y="-155" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2631" y="-144" font-family="Times,serif" font-size="10.00">GPU 222</text>
<text text-anchor="middle" x="2631" y="-133" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2631" y="-122" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep7_tp0&#45;&gt;stage2_ln2_dp3_ep7_tp0 -->
<g id="edge1024" class="edge">
<title>stage2_expert_agg_dp3_ep7_tp0&#45;&gt;stage2_ln2_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2555.54,-203.79C2568.05,-193.55 2580.85,-183.07 2592.26,-173.72"/>
<polygon fill="black" stroke="black" points="2594.79,-176.17 2600.31,-167.13 2590.35,-170.76 2594.79,-176.17"/>
</g>
<!-- output -->
<g id="node898" class="node">
<title>output</title>
<polygon fill="lightgreen" stroke="black" points="2912.5,-57 2655.5,-57 2655.5,-16 2912.5,-16 2912.5,-57"/>
<text text-anchor="middle" x="2784" y="-45" font-family="Times,serif" font-size="10.00">Output Projection</text>
<text text-anchor="middle" x="2784" y="-34" font-family="Times,serif" font-size="10.00">Input: [batch=128, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2784" y="-23" font-family="Times,serif" font-size="10.00">Output: [batch=128, seq=10240, vocab=50000]</text>
</g>
<!-- stage2_ln2_dp3_ep7_tp0&#45;&gt;output -->
<g id="edge1025" class="edge">
<title>stage2_ln2_dp3_ep7_tp0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2668.43,-114.93C2692.07,-99.09 2722.51,-78.7 2746.21,-62.82"/>
<polygon fill="black" stroke="black" points="2748.26,-65.66 2754.62,-57.19 2744.36,-59.84 2748.26,-65.66"/>
</g>
<!-- stage2_mha_dp3_ep7_tp1 -->
<g id="node892" class="node">
<title>stage2_mha_dp3_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3107.5,-627 2878.5,-627 2878.5,-575 3107.5,-575 3107.5,-627"/>
<text text-anchor="middle" x="2993" y="-615" font-family="Times,serif" font-size="10.00">MHA (16 heads)</text>
<text text-anchor="middle" x="2993" y="-604" font-family="Times,serif" font-size="10.00">GPU 223</text>
<text text-anchor="middle" x="2993" y="-593" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2993" y="-582" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_ln1_dp3_ep7_tp1&#45;&gt;stage2_mha_dp3_ep7_tp1 -->
<g id="edge1026" class="edge">
<title>stage2_ln1_dp3_ep7_tp1&#45;&gt;stage2_mha_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M2993,-663.84C2993,-655.54 2993,-646.15 2993,-637.25"/>
<polygon fill="black" stroke="black" points="2996.5,-637.11 2993,-627.11 2989.5,-637.11 2996.5,-637.11"/>
</g>
<!-- stage2_moe_gate_dp3_ep7_tp1 -->
<g id="node893" class="node">
<title>stage2_moe_gate_dp3_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3237.85,-538 2848.35,-538 2748.15,-434 3137.65,-434 3237.85,-538"/>
<text text-anchor="middle" x="2993" y="-500" font-family="Times,serif" font-size="10.00">MOE Gate</text>
<text text-anchor="middle" x="2993" y="-489" font-family="Times,serif" font-size="10.00">GPU 223</text>
<text text-anchor="middle" x="2993" y="-478" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2993" y="-467" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, experts=2]</text>
</g>
<!-- stage2_mha_dp3_ep7_tp1&#45;&gt;stage2_moe_gate_dp3_ep7_tp1 -->
<g id="edge1027" class="edge">
<title>stage2_mha_dp3_ep7_tp1&#45;&gt;stage2_moe_gate_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M2993,-574.92C2993,-567 2993,-557.86 2993,-548.54"/>
<polygon fill="black" stroke="black" points="2996.5,-548.4 2993,-538.4 2989.5,-548.4 2996.5,-548.4"/>
</g>
<!-- stage2_expert1_dp3_ep7_tp1 -->
<g id="node894" class="node">
<title>stage2_expert1_dp3_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="2983.5,-397 2748.5,-397 2748.5,-345 2983.5,-345 2983.5,-397"/>
<text text-anchor="middle" x="2866" y="-385" font-family="Times,serif" font-size="10.00">Expert 1 (FC)</text>
<text text-anchor="middle" x="2866" y="-374" font-family="Times,serif" font-size="10.00">GPU 223</text>
<text text-anchor="middle" x="2866" y="-363" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2866" y="-352" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep7_tp1&#45;&gt;stage2_expert1_dp3_ep7_tp1 -->
<g id="edge1028" class="edge">
<title>stage2_moe_gate_dp3_ep7_tp1&#45;&gt;stage2_expert1_dp3_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2935.45,-433.79C2924.04,-423.65 2912.39,-413.27 2901.96,-403.99"/>
<polygon fill="black" stroke="black" points="2904.04,-401.16 2894.24,-397.13 2899.39,-406.39 2904.04,-401.16"/>
</g>
<!-- stage2_expert2_dp3_ep7_tp1 -->
<g id="node895" class="node">
<title>stage2_expert2_dp3_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3236.5,-397 3001.5,-397 3001.5,-345 3236.5,-345 3236.5,-397"/>
<text text-anchor="middle" x="3119" y="-385" font-family="Times,serif" font-size="10.00">Expert 2 (FC)</text>
<text text-anchor="middle" x="3119" y="-374" font-family="Times,serif" font-size="10.00">GPU 223</text>
<text text-anchor="middle" x="3119" y="-363" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="3119" y="-352" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=1024]</text>
</g>
<!-- stage2_moe_gate_dp3_ep7_tp1&#45;&gt;stage2_expert2_dp3_ep7_tp1 -->
<g id="edge1029" class="edge">
<title>stage2_moe_gate_dp3_ep7_tp1&#45;&gt;stage2_expert2_dp3_ep7_tp1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3050.1,-433.79C3061.41,-423.65 3072.98,-413.27 3083.33,-403.99"/>
<polygon fill="black" stroke="black" points="3085.87,-406.41 3090.98,-397.13 3081.2,-401.2 3085.87,-406.41"/>
</g>
<!-- stage2_expert_agg_dp3_ep7_tp1 -->
<g id="node896" class="node">
<title>stage2_expert_agg_dp3_ep7_tp1</title>
<polygon fill="lightyellow" stroke="black" points="3223.33,-308 2845.79,-308 2748.67,-204 3126.21,-204 3223.33,-308"/>
<text text-anchor="middle" x="2986" y="-270" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2986" y="-259" font-family="Times,serif" font-size="10.00">GPU 223</text>
<text text-anchor="middle" x="2986" y="-248" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=1024]</text>
<text text-anchor="middle" x="2986" y="-237" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert1_dp3_ep7_tp1&#45;&gt;stage2_expert_agg_dp3_ep7_tp1 -->
<g id="edge1030" class="edge">
<title>stage2_expert1_dp3_ep7_tp1&#45;&gt;stage2_expert_agg_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M2892.63,-344.92C2902.03,-336.07 2913.04,-325.7 2924.13,-315.26"/>
<polygon fill="black" stroke="black" points="2926.53,-317.8 2931.42,-308.4 2921.74,-312.71 2926.53,-317.8"/>
</g>
<!-- stage2_expert2_dp3_ep7_tp1&#45;&gt;stage2_expert_agg_dp3_ep7_tp1 -->
<g id="edge1031" class="edge">
<title>stage2_expert2_dp3_ep7_tp1&#45;&gt;stage2_expert_agg_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M3089.48,-344.92C3078.9,-335.93 3066.48,-325.38 3054,-314.77"/>
<polygon fill="black" stroke="black" points="3056.12,-311.98 3046.23,-308.17 3051.58,-317.31 3056.12,-311.98"/>
</g>
<!-- stage2_ln2_dp3_ep7_tp1 -->
<g id="node897" class="node">
<title>stage2_ln2_dp3_ep7_tp1</title>
<polygon fill="lightgreen" stroke="black" points="3053.5,-167 2824.5,-167 2824.5,-115 3053.5,-115 3053.5,-167"/>
<text text-anchor="middle" x="2939" y="-155" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="2939" y="-144" font-family="Times,serif" font-size="10.00">GPU 223</text>
<text text-anchor="middle" x="2939" y="-133" font-family="Times,serif" font-size="10.00">Input: [batch=32, seq=10240, dim=512]</text>
<text text-anchor="middle" x="2939" y="-122" font-family="Times,serif" font-size="10.00">Output: [batch=32, seq=10240, dim=512]</text>
</g>
<!-- stage2_expert_agg_dp3_ep7_tp1&#45;&gt;stage2_ln2_dp3_ep7_tp1 -->
<g id="edge1032" class="edge">
<title>stage2_expert_agg_dp3_ep7_tp1&#45;&gt;stage2_ln2_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M2964.7,-203.79C2960.85,-194.54 2956.93,-185.1 2953.34,-176.47"/>
<polygon fill="black" stroke="black" points="2956.52,-175.02 2949.45,-167.13 2950.06,-177.71 2956.52,-175.02"/>
</g>
<!-- stage2_ln2_dp3_ep7_tp1&#45;&gt;output -->
<g id="edge1033" class="edge">
<title>stage2_ln2_dp3_ep7_tp1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2901.08,-114.93C2877.14,-99.09 2846.3,-78.7 2822.28,-62.82"/>
<polygon fill="black" stroke="black" points="2824.04,-59.78 2813.77,-57.19 2820.18,-65.62 2824.04,-59.78"/>
</g>
<!-- comm_gate_dp0_ep0_tp0 -->
<g id="node899" class="node">
<title>comm_gate_dp0_ep0_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="554" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="554" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="554" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="554" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep0_tp0 -->
<g id="node900" class="node">
<title>comm_expert_dp0_ep0_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="790" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="790" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="790" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="790" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep0_tp1 -->
<g id="node901" class="node">
<title>comm_gate_dp0_ep0_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1026" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="1026" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="1026" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1026" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep0_tp1 -->
<g id="node902" class="node">
<title>comm_expert_dp0_ep0_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="1262" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="1262" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="1262" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1262" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep1_tp0 -->
<g id="node903" class="node">
<title>comm_gate_dp0_ep1_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1498" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="1498" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="1498" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="1498" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep1_tp0 -->
<g id="node904" class="node">
<title>comm_expert_dp0_ep1_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="1734" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="1734" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="1734" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="1734" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep1_tp1 -->
<g id="node905" class="node">
<title>comm_gate_dp0_ep1_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1970" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="1970" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="1970" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1970" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep1_tp1 -->
<g id="node906" class="node">
<title>comm_expert_dp0_ep1_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="2206" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="2206" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="2206" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="2206" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep2_tp0 -->
<g id="node907" class="node">
<title>comm_gate_dp0_ep2_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2442" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="2442" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="2442" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="2442" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep2_tp0 -->
<g id="node908" class="node">
<title>comm_expert_dp0_ep2_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="2678" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="2678" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="2678" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="2678" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep2_tp1 -->
<g id="node909" class="node">
<title>comm_gate_dp0_ep2_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2914" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="2914" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="2914" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="2914" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep2_tp1 -->
<g id="node910" class="node">
<title>comm_expert_dp0_ep2_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="3150" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="3150" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="3150" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="3150" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep3_tp0 -->
<g id="node911" class="node">
<title>comm_gate_dp0_ep3_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="3386" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="3386" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="3386" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="3386" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep3_tp0 -->
<g id="node912" class="node">
<title>comm_expert_dp0_ep3_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="3622" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="3622" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="3622" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="3622" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep3_tp1 -->
<g id="node913" class="node">
<title>comm_gate_dp0_ep3_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="3858" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="3858" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="3858" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="3858" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep3_tp1 -->
<g id="node914" class="node">
<title>comm_expert_dp0_ep3_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="4094" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="4094" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="4094" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="4094" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep4_tp0 -->
<g id="node915" class="node">
<title>comm_gate_dp0_ep4_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="4330" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="4330" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="4330" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 8</text>
<text text-anchor="middle" x="4330" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep4_tp0 -->
<g id="node916" class="node">
<title>comm_expert_dp0_ep4_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="4566" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="4566" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="4566" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 8</text>
<text text-anchor="middle" x="4566" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep4_tp1 -->
<g id="node917" class="node">
<title>comm_gate_dp0_ep4_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="4802" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="4802" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="4802" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 9</text>
<text text-anchor="middle" x="4802" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep4_tp1 -->
<g id="node918" class="node">
<title>comm_expert_dp0_ep4_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="5038" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="5038" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="5038" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 9</text>
<text text-anchor="middle" x="5038" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep5_tp0 -->
<g id="node919" class="node">
<title>comm_gate_dp0_ep5_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="5274" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="5274" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="5274" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 10</text>
<text text-anchor="middle" x="5274" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep5_tp0 -->
<g id="node920" class="node">
<title>comm_expert_dp0_ep5_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="5510" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="5510" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="5510" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 10</text>
<text text-anchor="middle" x="5510" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep5_tp1 -->
<g id="node921" class="node">
<title>comm_gate_dp0_ep5_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="5746" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="5746" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="5746" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 11</text>
<text text-anchor="middle" x="5746" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep5_tp1 -->
<g id="node922" class="node">
<title>comm_expert_dp0_ep5_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="5982" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="5982" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="5982" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 11</text>
<text text-anchor="middle" x="5982" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep6_tp0 -->
<g id="node923" class="node">
<title>comm_gate_dp0_ep6_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="6218" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="6218" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="6218" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 12</text>
<text text-anchor="middle" x="6218" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep6_tp0 -->
<g id="node924" class="node">
<title>comm_expert_dp0_ep6_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="6454" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="6454" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="6454" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 12</text>
<text text-anchor="middle" x="6454" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep6_tp1 -->
<g id="node925" class="node">
<title>comm_gate_dp0_ep6_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="6690" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="6690" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="6690" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 13</text>
<text text-anchor="middle" x="6690" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep6_tp1 -->
<g id="node926" class="node">
<title>comm_expert_dp0_ep6_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="6926" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="6926" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="6926" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 13</text>
<text text-anchor="middle" x="6926" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep7_tp0 -->
<g id="node927" class="node">
<title>comm_gate_dp0_ep7_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="7162" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="7162" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="7162" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 14</text>
<text text-anchor="middle" x="7162" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep7_tp0 -->
<g id="node928" class="node">
<title>comm_expert_dp0_ep7_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="7398" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="7398" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="7398" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 14</text>
<text text-anchor="middle" x="7398" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp0_ep7_tp1 -->
<g id="node929" class="node">
<title>comm_gate_dp0_ep7_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="7634" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="7634" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="7634" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 15</text>
<text text-anchor="middle" x="7634" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp0_ep7_tp1 -->
<g id="node930" class="node">
<title>comm_expert_dp0_ep7_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="7870" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="7870" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="7870" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 15</text>
<text text-anchor="middle" x="7870" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep0_tp0 -->
<g id="node931" class="node">
<title>comm_gate_dp1_ep0_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="8106" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="8106" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="8106" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 64</text>
<text text-anchor="middle" x="8106" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep0_tp0 -->
<g id="node932" class="node">
<title>comm_expert_dp1_ep0_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="8342" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="8342" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="8342" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 64</text>
<text text-anchor="middle" x="8342" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep0_tp1 -->
<g id="node933" class="node">
<title>comm_gate_dp1_ep0_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="8578" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="8578" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="8578" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 65</text>
<text text-anchor="middle" x="8578" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep0_tp1 -->
<g id="node934" class="node">
<title>comm_expert_dp1_ep0_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="8814" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="8814" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="8814" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 65</text>
<text text-anchor="middle" x="8814" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep1_tp0 -->
<g id="node935" class="node">
<title>comm_gate_dp1_ep1_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="9050" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="9050" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="9050" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 66</text>
<text text-anchor="middle" x="9050" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep1_tp0 -->
<g id="node936" class="node">
<title>comm_expert_dp1_ep1_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="9286" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="9286" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="9286" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 66</text>
<text text-anchor="middle" x="9286" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep1_tp1 -->
<g id="node937" class="node">
<title>comm_gate_dp1_ep1_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="9522" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="9522" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="9522" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 67</text>
<text text-anchor="middle" x="9522" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep1_tp1 -->
<g id="node938" class="node">
<title>comm_expert_dp1_ep1_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="9758" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="9758" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="9758" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 67</text>
<text text-anchor="middle" x="9758" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep2_tp0 -->
<g id="node939" class="node">
<title>comm_gate_dp1_ep2_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="9994" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="9994" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="9994" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 68</text>
<text text-anchor="middle" x="9994" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep2_tp0 -->
<g id="node940" class="node">
<title>comm_expert_dp1_ep2_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="10230" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="10230" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="10230" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 68</text>
<text text-anchor="middle" x="10230" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep2_tp1 -->
<g id="node941" class="node">
<title>comm_gate_dp1_ep2_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="10466" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="10466" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="10466" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 69</text>
<text text-anchor="middle" x="10466" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep2_tp1 -->
<g id="node942" class="node">
<title>comm_expert_dp1_ep2_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="10702" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="10702" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="10702" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 69</text>
<text text-anchor="middle" x="10702" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep3_tp0 -->
<g id="node943" class="node">
<title>comm_gate_dp1_ep3_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="10938" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="10938" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="10938" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 70</text>
<text text-anchor="middle" x="10938" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep3_tp0 -->
<g id="node944" class="node">
<title>comm_expert_dp1_ep3_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="11174" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="11174" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="11174" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 70</text>
<text text-anchor="middle" x="11174" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep3_tp1 -->
<g id="node945" class="node">
<title>comm_gate_dp1_ep3_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="11410" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="11410" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="11410" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 71</text>
<text text-anchor="middle" x="11410" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep3_tp1 -->
<g id="node946" class="node">
<title>comm_expert_dp1_ep3_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="11646" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="11646" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="11646" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 71</text>
<text text-anchor="middle" x="11646" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep4_tp0 -->
<g id="node947" class="node">
<title>comm_gate_dp1_ep4_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="11882" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="11882" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="11882" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 72</text>
<text text-anchor="middle" x="11882" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep4_tp0 -->
<g id="node948" class="node">
<title>comm_expert_dp1_ep4_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="12118" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="12118" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="12118" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 72</text>
<text text-anchor="middle" x="12118" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep4_tp1 -->
<g id="node949" class="node">
<title>comm_gate_dp1_ep4_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="12354" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="12354" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="12354" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 73</text>
<text text-anchor="middle" x="12354" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep4_tp1 -->
<g id="node950" class="node">
<title>comm_expert_dp1_ep4_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="12590" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="12590" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="12590" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 73</text>
<text text-anchor="middle" x="12590" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep5_tp0 -->
<g id="node951" class="node">
<title>comm_gate_dp1_ep5_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="12826" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="12826" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="12826" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 74</text>
<text text-anchor="middle" x="12826" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep5_tp0 -->
<g id="node952" class="node">
<title>comm_expert_dp1_ep5_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="13062" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="13062" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="13062" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 74</text>
<text text-anchor="middle" x="13062" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep5_tp1 -->
<g id="node953" class="node">
<title>comm_gate_dp1_ep5_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="13298" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="13298" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="13298" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 75</text>
<text text-anchor="middle" x="13298" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep5_tp1 -->
<g id="node954" class="node">
<title>comm_expert_dp1_ep5_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="13534" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="13534" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="13534" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 75</text>
<text text-anchor="middle" x="13534" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep6_tp0 -->
<g id="node955" class="node">
<title>comm_gate_dp1_ep6_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="13770" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="13770" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="13770" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 76</text>
<text text-anchor="middle" x="13770" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep6_tp0 -->
<g id="node956" class="node">
<title>comm_expert_dp1_ep6_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="14006" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="14006" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="14006" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 76</text>
<text text-anchor="middle" x="14006" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep6_tp1 -->
<g id="node957" class="node">
<title>comm_gate_dp1_ep6_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="14242" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="14242" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="14242" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 77</text>
<text text-anchor="middle" x="14242" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep6_tp1 -->
<g id="node958" class="node">
<title>comm_expert_dp1_ep6_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="14478" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="14478" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="14478" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 77</text>
<text text-anchor="middle" x="14478" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep7_tp0 -->
<g id="node959" class="node">
<title>comm_gate_dp1_ep7_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="14714" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="14714" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="14714" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 78</text>
<text text-anchor="middle" x="14714" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep7_tp0 -->
<g id="node960" class="node">
<title>comm_expert_dp1_ep7_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="14950" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="14950" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="14950" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 78</text>
<text text-anchor="middle" x="14950" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp1_ep7_tp1 -->
<g id="node961" class="node">
<title>comm_gate_dp1_ep7_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="15186" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="15186" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="15186" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 79</text>
<text text-anchor="middle" x="15186" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp1_ep7_tp1 -->
<g id="node962" class="node">
<title>comm_expert_dp1_ep7_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="15422" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="15422" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="15422" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 79</text>
<text text-anchor="middle" x="15422" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep0_tp0 -->
<g id="node963" class="node">
<title>comm_gate_dp2_ep0_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="15658" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="15658" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="15658" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 128</text>
<text text-anchor="middle" x="15658" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep0_tp0 -->
<g id="node964" class="node">
<title>comm_expert_dp2_ep0_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="15894" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="15894" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="15894" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 128</text>
<text text-anchor="middle" x="15894" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep0_tp1 -->
<g id="node965" class="node">
<title>comm_gate_dp2_ep0_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="16130" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="16130" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="16130" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 129</text>
<text text-anchor="middle" x="16130" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep0_tp1 -->
<g id="node966" class="node">
<title>comm_expert_dp2_ep0_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="16366" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="16366" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="16366" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 129</text>
<text text-anchor="middle" x="16366" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep1_tp0 -->
<g id="node967" class="node">
<title>comm_gate_dp2_ep1_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="16602" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="16602" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="16602" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 130</text>
<text text-anchor="middle" x="16602" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep1_tp0 -->
<g id="node968" class="node">
<title>comm_expert_dp2_ep1_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="16838" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="16838" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="16838" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 130</text>
<text text-anchor="middle" x="16838" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep1_tp1 -->
<g id="node969" class="node">
<title>comm_gate_dp2_ep1_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="17074" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="17074" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="17074" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 131</text>
<text text-anchor="middle" x="17074" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep1_tp1 -->
<g id="node970" class="node">
<title>comm_expert_dp2_ep1_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="17310" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="17310" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="17310" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 131</text>
<text text-anchor="middle" x="17310" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep2_tp0 -->
<g id="node971" class="node">
<title>comm_gate_dp2_ep2_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="17546" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="17546" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="17546" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 132</text>
<text text-anchor="middle" x="17546" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep2_tp0 -->
<g id="node972" class="node">
<title>comm_expert_dp2_ep2_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="17782" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="17782" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="17782" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 132</text>
<text text-anchor="middle" x="17782" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep2_tp1 -->
<g id="node973" class="node">
<title>comm_gate_dp2_ep2_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="18018" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="18018" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="18018" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 133</text>
<text text-anchor="middle" x="18018" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep2_tp1 -->
<g id="node974" class="node">
<title>comm_expert_dp2_ep2_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="18254" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="18254" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="18254" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 133</text>
<text text-anchor="middle" x="18254" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep3_tp0 -->
<g id="node975" class="node">
<title>comm_gate_dp2_ep3_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="18490" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="18490" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="18490" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 134</text>
<text text-anchor="middle" x="18490" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep3_tp0 -->
<g id="node976" class="node">
<title>comm_expert_dp2_ep3_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="18726" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="18726" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="18726" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 134</text>
<text text-anchor="middle" x="18726" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep3_tp1 -->
<g id="node977" class="node">
<title>comm_gate_dp2_ep3_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="18962" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="18962" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="18962" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 135</text>
<text text-anchor="middle" x="18962" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep3_tp1 -->
<g id="node978" class="node">
<title>comm_expert_dp2_ep3_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="19198" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="19198" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="19198" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 135</text>
<text text-anchor="middle" x="19198" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep4_tp0 -->
<g id="node979" class="node">
<title>comm_gate_dp2_ep4_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="19434" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="19434" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="19434" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 136</text>
<text text-anchor="middle" x="19434" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep4_tp0 -->
<g id="node980" class="node">
<title>comm_expert_dp2_ep4_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="19670" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="19670" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="19670" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 136</text>
<text text-anchor="middle" x="19670" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep4_tp1 -->
<g id="node981" class="node">
<title>comm_gate_dp2_ep4_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="19906" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="19906" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="19906" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 137</text>
<text text-anchor="middle" x="19906" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep4_tp1 -->
<g id="node982" class="node">
<title>comm_expert_dp2_ep4_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="20142" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="20142" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="20142" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 137</text>
<text text-anchor="middle" x="20142" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep5_tp0 -->
<g id="node983" class="node">
<title>comm_gate_dp2_ep5_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="20378" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="20378" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="20378" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 138</text>
<text text-anchor="middle" x="20378" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep5_tp0 -->
<g id="node984" class="node">
<title>comm_expert_dp2_ep5_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="20614" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="20614" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="20614" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 138</text>
<text text-anchor="middle" x="20614" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep5_tp1 -->
<g id="node985" class="node">
<title>comm_gate_dp2_ep5_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="20850" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="20850" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="20850" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 139</text>
<text text-anchor="middle" x="20850" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep5_tp1 -->
<g id="node986" class="node">
<title>comm_expert_dp2_ep5_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="21086" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="21086" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="21086" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 139</text>
<text text-anchor="middle" x="21086" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep6_tp0 -->
<g id="node987" class="node">
<title>comm_gate_dp2_ep6_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="21322" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="21322" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="21322" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 140</text>
<text text-anchor="middle" x="21322" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep6_tp0 -->
<g id="node988" class="node">
<title>comm_expert_dp2_ep6_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="21558" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="21558" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="21558" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 140</text>
<text text-anchor="middle" x="21558" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep6_tp1 -->
<g id="node989" class="node">
<title>comm_gate_dp2_ep6_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="21794" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="21794" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="21794" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 141</text>
<text text-anchor="middle" x="21794" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep6_tp1 -->
<g id="node990" class="node">
<title>comm_expert_dp2_ep6_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="22030" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="22030" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="22030" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 141</text>
<text text-anchor="middle" x="22030" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep7_tp0 -->
<g id="node991" class="node">
<title>comm_gate_dp2_ep7_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="22266" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="22266" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="22266" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 142</text>
<text text-anchor="middle" x="22266" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep7_tp0 -->
<g id="node992" class="node">
<title>comm_expert_dp2_ep7_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="22502" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="22502" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="22502" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 142</text>
<text text-anchor="middle" x="22502" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp2_ep7_tp1 -->
<g id="node993" class="node">
<title>comm_gate_dp2_ep7_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="22738" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="22738" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="22738" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 143</text>
<text text-anchor="middle" x="22738" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp2_ep7_tp1 -->
<g id="node994" class="node">
<title>comm_expert_dp2_ep7_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="22974" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="22974" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="22974" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 143</text>
<text text-anchor="middle" x="22974" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep0_tp0 -->
<g id="node995" class="node">
<title>comm_gate_dp3_ep0_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="23210" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="23210" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="23210" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 192</text>
<text text-anchor="middle" x="23210" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep0_tp0 -->
<g id="node996" class="node">
<title>comm_expert_dp3_ep0_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="23446" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="23446" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="23446" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 192</text>
<text text-anchor="middle" x="23446" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep0_tp1 -->
<g id="node997" class="node">
<title>comm_gate_dp3_ep0_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="23682" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="23682" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="23682" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 193</text>
<text text-anchor="middle" x="23682" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep0_tp1 -->
<g id="node998" class="node">
<title>comm_expert_dp3_ep0_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="23918" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="23918" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="23918" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 193</text>
<text text-anchor="middle" x="23918" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep1_tp0 -->
<g id="node999" class="node">
<title>comm_gate_dp3_ep1_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="24154" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="24154" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="24154" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 194</text>
<text text-anchor="middle" x="24154" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep1_tp0 -->
<g id="node1000" class="node">
<title>comm_expert_dp3_ep1_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="24390" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="24390" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="24390" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 194</text>
<text text-anchor="middle" x="24390" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep1_tp1 -->
<g id="node1001" class="node">
<title>comm_gate_dp3_ep1_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="24626" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="24626" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="24626" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 195</text>
<text text-anchor="middle" x="24626" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep1_tp1 -->
<g id="node1002" class="node">
<title>comm_expert_dp3_ep1_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="24862" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="24862" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="24862" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 195</text>
<text text-anchor="middle" x="24862" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep2_tp0 -->
<g id="node1003" class="node">
<title>comm_gate_dp3_ep2_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="25098" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="25098" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="25098" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 196</text>
<text text-anchor="middle" x="25098" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep2_tp0 -->
<g id="node1004" class="node">
<title>comm_expert_dp3_ep2_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="25334" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="25334" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="25334" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 196</text>
<text text-anchor="middle" x="25334" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep2_tp1 -->
<g id="node1005" class="node">
<title>comm_gate_dp3_ep2_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="25570" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="25570" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="25570" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 197</text>
<text text-anchor="middle" x="25570" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep2_tp1 -->
<g id="node1006" class="node">
<title>comm_expert_dp3_ep2_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="25806" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="25806" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="25806" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 197</text>
<text text-anchor="middle" x="25806" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep3_tp0 -->
<g id="node1007" class="node">
<title>comm_gate_dp3_ep3_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="26042" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="26042" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="26042" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 198</text>
<text text-anchor="middle" x="26042" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep3_tp0 -->
<g id="node1008" class="node">
<title>comm_expert_dp3_ep3_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="26278" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="26278" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="26278" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 198</text>
<text text-anchor="middle" x="26278" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep3_tp1 -->
<g id="node1009" class="node">
<title>comm_gate_dp3_ep3_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="26514" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="26514" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="26514" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 199</text>
<text text-anchor="middle" x="26514" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep3_tp1 -->
<g id="node1010" class="node">
<title>comm_expert_dp3_ep3_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="26750" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="26750" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="26750" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 199</text>
<text text-anchor="middle" x="26750" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep4_tp0 -->
<g id="node1011" class="node">
<title>comm_gate_dp3_ep4_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="26986" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="26986" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="26986" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 200</text>
<text text-anchor="middle" x="26986" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep4_tp0 -->
<g id="node1012" class="node">
<title>comm_expert_dp3_ep4_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="27222" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="27222" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="27222" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 200</text>
<text text-anchor="middle" x="27222" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep4_tp1 -->
<g id="node1013" class="node">
<title>comm_gate_dp3_ep4_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="27458" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="27458" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="27458" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 201</text>
<text text-anchor="middle" x="27458" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep4_tp1 -->
<g id="node1014" class="node">
<title>comm_expert_dp3_ep4_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="27694" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="27694" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="27694" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 201</text>
<text text-anchor="middle" x="27694" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep5_tp0 -->
<g id="node1015" class="node">
<title>comm_gate_dp3_ep5_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="27930" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="27930" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="27930" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 202</text>
<text text-anchor="middle" x="27930" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep5_tp0 -->
<g id="node1016" class="node">
<title>comm_expert_dp3_ep5_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="28166" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="28166" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="28166" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 202</text>
<text text-anchor="middle" x="28166" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep5_tp1 -->
<g id="node1017" class="node">
<title>comm_gate_dp3_ep5_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="28402" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="28402" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="28402" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 203</text>
<text text-anchor="middle" x="28402" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep5_tp1 -->
<g id="node1018" class="node">
<title>comm_expert_dp3_ep5_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="28638" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="28638" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="28638" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 203</text>
<text text-anchor="middle" x="28638" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep6_tp0 -->
<g id="node1019" class="node">
<title>comm_gate_dp3_ep6_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="28874" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="28874" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="28874" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 204</text>
<text text-anchor="middle" x="28874" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep6_tp0 -->
<g id="node1020" class="node">
<title>comm_expert_dp3_ep6_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="29110" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="29110" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="29110" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 204</text>
<text text-anchor="middle" x="29110" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep6_tp1 -->
<g id="node1021" class="node">
<title>comm_gate_dp3_ep6_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="29346" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="29346" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="29346" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 205</text>
<text text-anchor="middle" x="29346" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep6_tp1 -->
<g id="node1022" class="node">
<title>comm_expert_dp3_ep6_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="29582" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="29582" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="29582" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 205</text>
<text text-anchor="middle" x="29582" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep7_tp0 -->
<g id="node1023" class="node">
<title>comm_gate_dp3_ep7_tp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="29818" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="29818" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="29818" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 206</text>
<text text-anchor="middle" x="29818" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep7_tp0 -->
<g id="node1024" class="node">
<title>comm_expert_dp3_ep7_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="30054" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="30054" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="30054" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 206</text>
<text text-anchor="middle" x="30054" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_gate_dp3_ep7_tp1 -->
<g id="node1025" class="node">
<title>comm_gate_dp3_ep7_tp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="30290" cy="-26331.95" rx="101.65" ry="28.98"/>
<text text-anchor="middle" x="30290" y="-26340.45" font-family="Times,serif" font-size="10.00">Gate Communication</text>
<text text-anchor="middle" x="30290" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 207</text>
<text text-anchor="middle" x="30290" y="-26318.45" font-family="Times,serif" font-size="10.00">Expert Selection Routing</text>
</g>
<!-- comm_expert_dp3_ep7_tp1 -->
<g id="node1026" class="node">
<title>comm_expert_dp3_ep7_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="30526" cy="-26331.95" rx="115.93" ry="28.98"/>
<text text-anchor="middle" x="30526" y="-26340.45" font-family="Times,serif" font-size="10.00">Expert Output Comm</text>
<text text-anchor="middle" x="30526" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 207</text>
<text text-anchor="middle" x="30526" y="-26318.45" font-family="Times,serif" font-size="10.00">Aggregation Communication</text>
</g>
<!-- comm_pipeline_dp0_ep0_tp0 -->
<g id="node1027" class="node">
<title>comm_pipeline_dp0_ep0_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="30742" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="30742" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="30742" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 0â†’16</text>
<text text-anchor="middle" x="30742" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep0_tp1 -->
<g id="node1028" class="node">
<title>comm_pipeline_dp0_ep0_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="30924" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="30924" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="30924" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 1â†’17</text>
<text text-anchor="middle" x="30924" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep1_tp0 -->
<g id="node1029" class="node">
<title>comm_pipeline_dp0_ep1_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="31106" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="31106" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="31106" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 2â†’18</text>
<text text-anchor="middle" x="31106" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep1_tp1 -->
<g id="node1030" class="node">
<title>comm_pipeline_dp0_ep1_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="31288" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="31288" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="31288" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 3â†’19</text>
<text text-anchor="middle" x="31288" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep2_tp0 -->
<g id="node1031" class="node">
<title>comm_pipeline_dp0_ep2_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="31470" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="31470" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="31470" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 4â†’20</text>
<text text-anchor="middle" x="31470" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep2_tp1 -->
<g id="node1032" class="node">
<title>comm_pipeline_dp0_ep2_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="31652" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="31652" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="31652" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 5â†’21</text>
<text text-anchor="middle" x="31652" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep3_tp0 -->
<g id="node1033" class="node">
<title>comm_pipeline_dp0_ep3_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="31834" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="31834" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="31834" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 6â†’22</text>
<text text-anchor="middle" x="31834" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep3_tp1 -->
<g id="node1034" class="node">
<title>comm_pipeline_dp0_ep3_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="32016" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="32016" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="32016" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 7â†’23</text>
<text text-anchor="middle" x="32016" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep4_tp0 -->
<g id="node1035" class="node">
<title>comm_pipeline_dp0_ep4_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="32198" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="32198" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="32198" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 8â†’24</text>
<text text-anchor="middle" x="32198" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep4_tp1 -->
<g id="node1036" class="node">
<title>comm_pipeline_dp0_ep4_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="32380" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="32380" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="32380" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 9â†’25</text>
<text text-anchor="middle" x="32380" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep5_tp0 -->
<g id="node1037" class="node">
<title>comm_pipeline_dp0_ep5_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="32562" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="32562" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="32562" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 10â†’26</text>
<text text-anchor="middle" x="32562" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep5_tp1 -->
<g id="node1038" class="node">
<title>comm_pipeline_dp0_ep5_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="32744" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="32744" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="32744" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 11â†’27</text>
<text text-anchor="middle" x="32744" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep6_tp0 -->
<g id="node1039" class="node">
<title>comm_pipeline_dp0_ep6_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="32926" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="32926" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="32926" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 12â†’28</text>
<text text-anchor="middle" x="32926" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep6_tp1 -->
<g id="node1040" class="node">
<title>comm_pipeline_dp0_ep6_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="33108" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="33108" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="33108" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 13â†’29</text>
<text text-anchor="middle" x="33108" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp0_ep7_tp0&#45;&gt;stage2_ln1_dp0_ep7_tp0 -->
<g id="edge122" class="edge">
<title>comm_pipeline_dp0_ep7_tp0&#45;&gt;stage2_ln1_dp0_ep7_tp0</title>
<path fill="none" stroke="black" d="M752.73,-19930.53C781.31,-19924.68 814.72,-19917.91 845,-19911.96 941.44,-19893.01 1050.75,-19872.35 1132.53,-19857.06"/>
<polygon fill="black" stroke="black" points="1133.18,-19860.5 1142.37,-19855.22 1131.9,-19853.62 1133.18,-19860.5"/>
</g>
<!-- comm_pipeline_dp0_ep7_tp1&#45;&gt;stage2_ln1_dp0_ep7_tp1 -->
<g id="edge131" class="edge">
<title>comm_pipeline_dp0_ep7_tp1&#45;&gt;stage2_ln1_dp0_ep7_tp1</title>
<path fill="none" stroke="black" d="M987.01,-19923.14C999.25,-19918.72 1012.42,-19914.62 1025,-19911.96 1180.09,-19879.16 1223.32,-19906.33 1381,-19889.97 1467.52,-19880.98 1564.46,-19866.77 1639.17,-19854.91"/>
<polygon fill="black" stroke="black" points="1639.77,-19858.36 1649.09,-19853.33 1638.66,-19851.44 1639.77,-19858.36"/>
</g>
<!-- comm_pipeline_dp1_ep0_tp0 -->
<g id="node1043" class="node">
<title>comm_pipeline_dp1_ep0_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="33290" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="33290" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="33290" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 64â†’80</text>
<text text-anchor="middle" x="33290" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep0_tp1 -->
<g id="node1044" class="node">
<title>comm_pipeline_dp1_ep0_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="33472" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="33472" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="33472" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 65â†’81</text>
<text text-anchor="middle" x="33472" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep1_tp0 -->
<g id="node1045" class="node">
<title>comm_pipeline_dp1_ep1_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="33654" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="33654" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="33654" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 66â†’82</text>
<text text-anchor="middle" x="33654" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep1_tp1 -->
<g id="node1046" class="node">
<title>comm_pipeline_dp1_ep1_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="33836" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="33836" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="33836" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 67â†’83</text>
<text text-anchor="middle" x="33836" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep2_tp0 -->
<g id="node1047" class="node">
<title>comm_pipeline_dp1_ep2_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="34018" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="34018" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="34018" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 68â†’84</text>
<text text-anchor="middle" x="34018" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep2_tp1 -->
<g id="node1048" class="node">
<title>comm_pipeline_dp1_ep2_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="34200" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="34200" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="34200" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 69â†’85</text>
<text text-anchor="middle" x="34200" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep3_tp0 -->
<g id="node1049" class="node">
<title>comm_pipeline_dp1_ep3_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="34382" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="34382" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="34382" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 70â†’86</text>
<text text-anchor="middle" x="34382" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep3_tp1 -->
<g id="node1050" class="node">
<title>comm_pipeline_dp1_ep3_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="34564" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="34564" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="34564" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 71â†’87</text>
<text text-anchor="middle" x="34564" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep4_tp0 -->
<g id="node1051" class="node">
<title>comm_pipeline_dp1_ep4_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="34746" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="34746" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="34746" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 72â†’88</text>
<text text-anchor="middle" x="34746" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep4_tp1 -->
<g id="node1052" class="node">
<title>comm_pipeline_dp1_ep4_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="34928" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="34928" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="34928" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 73â†’89</text>
<text text-anchor="middle" x="34928" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep5_tp0 -->
<g id="node1053" class="node">
<title>comm_pipeline_dp1_ep5_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="35110" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="35110" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="35110" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 74â†’90</text>
<text text-anchor="middle" x="35110" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep5_tp1 -->
<g id="node1054" class="node">
<title>comm_pipeline_dp1_ep5_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="35292" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="35292" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="35292" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 75â†’91</text>
<text text-anchor="middle" x="35292" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep6_tp0 -->
<g id="node1055" class="node">
<title>comm_pipeline_dp1_ep6_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="35474" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="35474" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="35474" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 76â†’92</text>
<text text-anchor="middle" x="35474" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep6_tp1 -->
<g id="node1056" class="node">
<title>comm_pipeline_dp1_ep6_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="35656" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="35656" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="35656" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 77â†’93</text>
<text text-anchor="middle" x="35656" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp1_ep7_tp0&#45;&gt;stage2_ln1_dp1_ep7_tp0 -->
<g id="edge380" class="edge">
<title>comm_pipeline_dp1_ep7_tp0&#45;&gt;stage2_ln1_dp1_ep7_tp0</title>
<path fill="none" stroke="black" d="M2057.03,-13538.43C2041.82,-13533.67 2025.38,-13528.84 2010,-13524.97 1915.94,-13501.28 1808.1,-13480.95 1726.92,-13467"/>
<polygon fill="black" stroke="black" points="1727.1,-13463.48 1716.65,-13465.24 1725.92,-13470.38 1727.1,-13463.48"/>
</g>
<!-- comm_pipeline_dp1_ep7_tp1&#45;&gt;stage2_ln1_dp1_ep7_tp1 -->
<g id="edge389" class="edge">
<title>comm_pipeline_dp1_ep7_tp1&#45;&gt;stage2_ln1_dp1_ep7_tp1</title>
<path fill="none" stroke="black" d="M2264.52,-13534.16C2234.71,-13517.45 2194.62,-13494.97 2162.61,-13477.03"/>
<polygon fill="black" stroke="black" points="2164.25,-13473.93 2153.81,-13472.09 2160.82,-13480.04 2164.25,-13473.93"/>
</g>
<!-- comm_pipeline_dp2_ep0_tp0 -->
<g id="node1059" class="node">
<title>comm_pipeline_dp2_ep0_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="35838" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="35838" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="35838" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 128â†’144</text>
<text text-anchor="middle" x="35838" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep0_tp1 -->
<g id="node1060" class="node">
<title>comm_pipeline_dp2_ep0_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="36020" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="36020" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="36020" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 129â†’145</text>
<text text-anchor="middle" x="36020" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep1_tp0 -->
<g id="node1061" class="node">
<title>comm_pipeline_dp2_ep1_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="36202" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="36202" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="36202" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 130â†’146</text>
<text text-anchor="middle" x="36202" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep1_tp1 -->
<g id="node1062" class="node">
<title>comm_pipeline_dp2_ep1_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="36384" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="36384" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="36384" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 131â†’147</text>
<text text-anchor="middle" x="36384" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep2_tp0 -->
<g id="node1063" class="node">
<title>comm_pipeline_dp2_ep2_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="36566" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="36566" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="36566" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 132â†’148</text>
<text text-anchor="middle" x="36566" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep2_tp1 -->
<g id="node1064" class="node">
<title>comm_pipeline_dp2_ep2_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="36748" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="36748" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="36748" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 133â†’149</text>
<text text-anchor="middle" x="36748" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep3_tp0 -->
<g id="node1065" class="node">
<title>comm_pipeline_dp2_ep3_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="36930" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="36930" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="36930" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 134â†’150</text>
<text text-anchor="middle" x="36930" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep3_tp1 -->
<g id="node1066" class="node">
<title>comm_pipeline_dp2_ep3_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="37112" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="37112" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="37112" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 135â†’151</text>
<text text-anchor="middle" x="37112" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep4_tp0 -->
<g id="node1067" class="node">
<title>comm_pipeline_dp2_ep4_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="37294" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="37294" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="37294" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 136â†’152</text>
<text text-anchor="middle" x="37294" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep4_tp1 -->
<g id="node1068" class="node">
<title>comm_pipeline_dp2_ep4_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="37476" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="37476" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="37476" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 137â†’153</text>
<text text-anchor="middle" x="37476" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep5_tp0 -->
<g id="node1069" class="node">
<title>comm_pipeline_dp2_ep5_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="37658" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="37658" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="37658" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 138â†’154</text>
<text text-anchor="middle" x="37658" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep5_tp1 -->
<g id="node1070" class="node">
<title>comm_pipeline_dp2_ep5_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="37840" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="37840" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="37840" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 139â†’155</text>
<text text-anchor="middle" x="37840" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep6_tp0 -->
<g id="node1071" class="node">
<title>comm_pipeline_dp2_ep6_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="38022" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="38022" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="38022" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 140â†’156</text>
<text text-anchor="middle" x="38022" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep6_tp1 -->
<g id="node1072" class="node">
<title>comm_pipeline_dp2_ep6_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="38204" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="38204" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="38204" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 141â†’157</text>
<text text-anchor="middle" x="38204" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp2_ep7_tp0&#45;&gt;stage2_ln1_dp2_ep7_tp0 -->
<g id="edge638" class="edge">
<title>comm_pipeline_dp2_ep7_tp0&#45;&gt;stage2_ln1_dp2_ep7_tp0</title>
<path fill="none" stroke="black" d="M2430.44,-7151.55C2415.09,-7146.78 2398.5,-7141.93 2383,-7137.97 2295.11,-7115.57 2194.74,-7095.63 2117.83,-7081.51"/>
<polygon fill="black" stroke="black" points="2118.09,-7078 2107.62,-7079.65 2116.83,-7084.89 2118.09,-7078"/>
</g>
<!-- comm_pipeline_dp2_ep7_tp1&#45;&gt;stage2_ln1_dp2_ep7_tp1 -->
<g id="edge647" class="edge">
<title>comm_pipeline_dp2_ep7_tp1&#45;&gt;stage2_ln1_dp2_ep7_tp1</title>
<path fill="none" stroke="black" d="M2642.06,-7146.62C2614.94,-7130.08 2578.87,-7108.08 2549.87,-7090.39"/>
<polygon fill="black" stroke="black" points="2551.47,-7087.27 2541.11,-7085.05 2547.82,-7093.25 2551.47,-7087.27"/>
</g>
<!-- comm_pipeline_dp3_ep0_tp0 -->
<g id="node1075" class="node">
<title>comm_pipeline_dp3_ep0_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="38386" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="38386" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="38386" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 192â†’208</text>
<text text-anchor="middle" x="38386" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep0_tp1 -->
<g id="node1076" class="node">
<title>comm_pipeline_dp3_ep0_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="38568" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="38568" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="38568" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 193â†’209</text>
<text text-anchor="middle" x="38568" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep1_tp0 -->
<g id="node1077" class="node">
<title>comm_pipeline_dp3_ep1_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="38750" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="38750" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="38750" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 194â†’210</text>
<text text-anchor="middle" x="38750" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep1_tp1 -->
<g id="node1078" class="node">
<title>comm_pipeline_dp3_ep1_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="38932" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="38932" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="38932" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 195â†’211</text>
<text text-anchor="middle" x="38932" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep2_tp0 -->
<g id="node1079" class="node">
<title>comm_pipeline_dp3_ep2_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="39114" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="39114" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="39114" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 196â†’212</text>
<text text-anchor="middle" x="39114" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep2_tp1 -->
<g id="node1080" class="node">
<title>comm_pipeline_dp3_ep2_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="39296" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="39296" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="39296" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 197â†’213</text>
<text text-anchor="middle" x="39296" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep3_tp0 -->
<g id="node1081" class="node">
<title>comm_pipeline_dp3_ep3_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="39478" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="39478" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="39478" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 198â†’214</text>
<text text-anchor="middle" x="39478" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep3_tp1 -->
<g id="node1082" class="node">
<title>comm_pipeline_dp3_ep3_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="39660" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="39660" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="39660" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 199â†’215</text>
<text text-anchor="middle" x="39660" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep4_tp0 -->
<g id="node1083" class="node">
<title>comm_pipeline_dp3_ep4_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="39842" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="39842" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="39842" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 200â†’216</text>
<text text-anchor="middle" x="39842" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep4_tp1 -->
<g id="node1084" class="node">
<title>comm_pipeline_dp3_ep4_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="40024" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="40024" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="40024" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 201â†’217</text>
<text text-anchor="middle" x="40024" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep5_tp0 -->
<g id="node1085" class="node">
<title>comm_pipeline_dp3_ep5_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="40206" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="40206" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="40206" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 202â†’218</text>
<text text-anchor="middle" x="40206" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep5_tp1 -->
<g id="node1086" class="node">
<title>comm_pipeline_dp3_ep5_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="40388" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="40388" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="40388" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 203â†’219</text>
<text text-anchor="middle" x="40388" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep6_tp0 -->
<g id="node1087" class="node">
<title>comm_pipeline_dp3_ep6_tp0</title>
<ellipse fill="lightblue" stroke="black" cx="40570" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="40570" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="40570" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 204â†’220</text>
<text text-anchor="middle" x="40570" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep6_tp1 -->
<g id="node1088" class="node">
<title>comm_pipeline_dp3_ep6_tp1</title>
<ellipse fill="lightblue" stroke="black" cx="40752" cy="-26331.95" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="40752" y="-26340.45" font-family="Times,serif" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="40752" y="-26329.45" font-family="Times,serif" font-size="10.00">GPU 205â†’221</text>
<text text-anchor="middle" x="40752" y="-26318.45" font-family="Times,serif" font-size="10.00">Stage 1â†’2 Transfer</text>
</g>
<!-- comm_pipeline_dp3_ep7_tp0&#45;&gt;stage2_ln1_dp3_ep7_tp0 -->
<g id="edge896" class="edge">
<title>comm_pipeline_dp3_ep7_tp0&#45;&gt;stage2_ln1_dp3_ep7_tp0</title>
<path fill="none" stroke="black" d="M2879.11,-785.85C2805.98,-768.21 2687.51,-739.62 2599.72,-718.44"/>
<polygon fill="black" stroke="black" points="2600.52,-715.03 2589.98,-716.09 2598.88,-721.84 2600.52,-715.03"/>
</g>
<!-- comm_pipeline_dp3_ep7_tp1&#45;&gt;stage2_ln1_dp3_ep7_tp1 -->
<g id="edge905" class="edge">
<title>comm_pipeline_dp3_ep7_tp1&#45;&gt;stage2_ln1_dp3_ep7_tp1</title>
<path fill="none" stroke="black" d="M3126.4,-777.08C3100.93,-760.65 3067.39,-739 3040.31,-721.53"/>
<polygon fill="black" stroke="black" points="3042.07,-718.5 3031.77,-716.02 3038.27,-724.38 3042.07,-718.5"/>
</g>
</g>
</svg>
