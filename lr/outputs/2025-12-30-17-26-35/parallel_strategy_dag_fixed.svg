<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Qwen3&#45;235B Parallel Strategy Deployment DAG &#45; Corrected -->
<!-- Title: %3 Pages: 1 -->
<svg width="4644pt" height="12000pt"
 viewBox="0.00 0.00 1114.64 2880.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(2.18 2.18) rotate(0) translate(4 5507.24)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-5507.24 2129,-5507.24 2129,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="none" stroke="black" d="M20,-4190.09C20,-4190.09 2099,-4190.09 2099,-4190.09 2105,-4190.09 2111,-4196.09 2111,-4202.09 2111,-4202.09 2111,-5442.24 2111,-5442.24 2111,-5448.24 2105,-5454.24 2099,-5454.24 2099,-5454.24 20,-5454.24 20,-5454.24 14,-5454.24 8,-5448.24 8,-5442.24 8,-5442.24 8,-4202.09 8,-4202.09 8,-4196.09 14,-4190.09 20,-4190.09"/>
<text text-anchor="middle" x="1059.5" y="-5439.04" font-family="Times,serif" font-size="14.00">Pipeline Stage 0: Layers 0&#45;23</text>
<text text-anchor="middle" x="1059.5" y="-5424.04" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;31</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage1</title>
<path fill="none" stroke="black" d="M25,-2816.39C25,-2816.39 2104,-2816.39 2104,-2816.39 2110,-2816.39 2116,-2822.39 2116,-2828.39 2116,-2828.39 2116,-4068.55 2116,-4068.55 2116,-4074.55 2110,-4080.55 2104,-4080.55 2104,-4080.55 25,-4080.55 25,-4080.55 19,-4080.55 13,-4074.55 13,-4068.55 13,-4068.55 13,-2828.39 13,-2828.39 13,-2822.39 19,-2816.39 25,-2816.39"/>
<text text-anchor="middle" x="1064.5" y="-4065.35" font-family="Times,serif" font-size="14.00">Pipeline Stage 1: Layers 24&#45;47</text>
<text text-anchor="middle" x="1064.5" y="-4050.35" font-family="Times,serif" font-size="14.00">GPUs: 32&#45;63</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_stage2</title>
<path fill="none" stroke="black" d="M25,-1442.7C25,-1442.7 2104,-1442.7 2104,-1442.7 2110,-1442.7 2116,-1448.7 2116,-1454.7 2116,-1454.7 2116,-2694.85 2116,-2694.85 2116,-2700.85 2110,-2706.85 2104,-2706.85 2104,-2706.85 25,-2706.85 25,-2706.85 19,-2706.85 13,-2700.85 13,-2694.85 13,-2694.85 13,-1454.7 13,-1454.7 13,-1448.7 19,-1442.7 25,-1442.7"/>
<text text-anchor="middle" x="1064.5" y="-2691.65" font-family="Times,serif" font-size="14.00">Pipeline Stage 2: Layers 48&#45;71</text>
<text text-anchor="middle" x="1064.5" y="-2676.65" font-family="Times,serif" font-size="14.00">GPUs: 64&#45;95</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage3</title>
<path fill="none" stroke="black" d="M26,-69C26,-69 2105,-69 2105,-69 2111,-69 2117,-75 2117,-81 2117,-81 2117,-1321.16 2117,-1321.16 2117,-1327.16 2111,-1333.16 2105,-1333.16 2105,-1333.16 26,-1333.16 26,-1333.16 20,-1333.16 14,-1327.16 14,-1321.16 14,-1321.16 14,-81 14,-81 14,-75 20,-69 26,-69"/>
<text text-anchor="middle" x="1065.5" y="-1317.96" font-family="Times,serif" font-size="14.00">Pipeline Stage 3: Layers 72&#45;93</text>
<text text-anchor="middle" x="1065.5" y="-1302.96" font-family="Times,serif" font-size="14.00">GPUs: 96&#45;127</text>
</g>
<!-- embed_0 -->
<g id="node1" class="node">
<title>embed_0</title>
<polygon fill="lightblue" stroke="black" points="1186.5,-5408.24 931.5,-5408.24 931.5,-5356.24 1186.5,-5356.24 1186.5,-5408.24"/>
<text text-anchor="middle" x="1059" y="-5396.24" font-family="Arial" font-size="10.00">Token Embedding</text>
<text text-anchor="middle" x="1059" y="-5385.24" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1059" y="-5374.24" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1059" y="-5363.24" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- gate_0 -->
<g id="node2" class="node">
<title>gate_0</title>
<polygon fill="lightyellow" stroke="black" points="1316.23,-5320.24 907.03,-5320.24 801.77,-5216.24 1210.97,-5216.24 1316.23,-5320.24"/>
<text text-anchor="middle" x="1059" y="-5282.24" font-family="Arial" font-size="10.00">Gate Selection</text>
<text text-anchor="middle" x="1059" y="-5271.24" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1059" y="-5260.24" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1059" y="-5249.24" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, experts=32]</text>
</g>
<!-- embed_0&#45;&gt;gate_0 -->
<g id="edge2" class="edge">
<title>embed_0&#45;&gt;gate_0</title>
<path fill="none" stroke="black" d="M1059,-5356.11C1059,-5348.42 1059,-5339.61 1059,-5330.61"/>
<polygon fill="black" stroke="black" points="1062.5,-5330.42 1059,-5320.42 1055.5,-5330.42 1062.5,-5330.42"/>
</g>
<!-- route_0 -->
<g id="node3" class="node">
<title>route_0</title>
<ellipse fill="lightgreen" stroke="black" cx="1059" cy="-5143.47" rx="171.65" ry="36.54"/>
<text text-anchor="middle" x="1059" y="-5157.47" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="1059" y="-5146.47" font-family="Arial" font-size="10.00">GPU: 0&#45;31</text>
<text text-anchor="middle" x="1059" y="-5135.47" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, experts=32]</text>
<text text-anchor="middle" x="1059" y="-5124.47" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, experts=1]</text>
</g>
<!-- gate_0&#45;&gt;route_0 -->
<g id="edge3" class="edge">
<title>gate_0&#45;&gt;route_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1059,-5215.89C1059,-5207.48 1059,-5198.81 1059,-5190.54"/>
<polygon fill="black" stroke="black" points="1062.5,-5190.33 1059,-5180.33 1055.5,-5190.33 1062.5,-5190.33"/>
</g>
<!-- expert_0 -->
<g id="node4" class="node">
<title>expert_0</title>
<polygon fill="lightblue" stroke="black" points="261.5,-5070.7 16.5,-5070.7 16.5,-5018.7 261.5,-5018.7 261.5,-5070.7"/>
<text text-anchor="middle" x="139" y="-5058.7" font-family="Arial" font-size="10.00">Expert 0 Computation</text>
<text text-anchor="middle" x="139" y="-5047.7" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="139" y="-5036.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="139" y="-5025.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_0&#45;&gt;expert_0 -->
<g id="edge4" class="edge">
<title>route_0&#45;&gt;expert_0</title>
<path fill="none" stroke="black" d="M895.1,-5132.17C737.76,-5121.2 493.32,-5101.37 271.74,-5070.75"/>
<polygon fill="black" stroke="black" points="271.93,-5067.24 261.54,-5069.33 270.97,-5074.17 271.93,-5067.24"/>
</g>
<!-- expert_1 -->
<g id="node5" class="node">
<title>expert_1</title>
<polygon fill="lightblue" stroke="black" points="524.5,-5070.7 279.5,-5070.7 279.5,-5018.7 524.5,-5018.7 524.5,-5070.7"/>
<text text-anchor="middle" x="402" y="-5058.7" font-family="Arial" font-size="10.00">Expert 1 Computation</text>
<text text-anchor="middle" x="402" y="-5047.7" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="402" y="-5036.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="402" y="-5025.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_0&#45;&gt;expert_1 -->
<g id="edge5" class="edge">
<title>route_0&#45;&gt;expert_1</title>
<path fill="none" stroke="black" d="M911.89,-5124.41C809.04,-5111.3 668.3,-5092.38 534.6,-5070.77"/>
<polygon fill="black" stroke="black" points="535,-5067.29 524.57,-5069.14 533.88,-5074.2 535,-5067.29"/>
</g>
<!-- expert_2 -->
<g id="node6" class="node">
<title>expert_2</title>
<polygon fill="lightblue" stroke="black" points="787.5,-5070.7 542.5,-5070.7 542.5,-5018.7 787.5,-5018.7 787.5,-5070.7"/>
<text text-anchor="middle" x="665" y="-5058.7" font-family="Arial" font-size="10.00">Expert 2 Computation</text>
<text text-anchor="middle" x="665" y="-5047.7" font-family="Arial" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="665" y="-5036.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="665" y="-5025.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_0&#45;&gt;expert_2 -->
<g id="edge6" class="edge">
<title>route_0&#45;&gt;expert_2</title>
<path fill="none" stroke="black" d="M948.2,-5115.26C894.63,-5102.1 830.47,-5086.35 776.78,-5073.16"/>
<polygon fill="black" stroke="black" points="777.42,-5069.71 766.88,-5070.73 775.75,-5076.51 777.42,-5069.71"/>
</g>
<!-- expert_3 -->
<g id="node7" class="node">
<title>expert_3</title>
<polygon fill="lightblue" stroke="black" points="1050.5,-5070.7 805.5,-5070.7 805.5,-5018.7 1050.5,-5018.7 1050.5,-5070.7"/>
<text text-anchor="middle" x="928" y="-5058.7" font-family="Arial" font-size="10.00">Expert 3 Computation</text>
<text text-anchor="middle" x="928" y="-5047.7" font-family="Arial" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="928" y="-5036.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="928" y="-5025.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_0&#45;&gt;expert_3 -->
<g id="edge7" class="edge">
<title>route_0&#45;&gt;expert_3</title>
<path fill="none" stroke="black" d="M1012.08,-5107.81C998.34,-5097.66 983.41,-5086.63 969.99,-5076.72"/>
<polygon fill="black" stroke="black" points="971.99,-5073.84 961.86,-5070.72 967.83,-5079.47 971.99,-5073.84"/>
</g>
<!-- expert_4 -->
<g id="node8" class="node">
<title>expert_4</title>
<polygon fill="lightblue" stroke="black" points="1313.5,-5070.7 1068.5,-5070.7 1068.5,-5018.7 1313.5,-5018.7 1313.5,-5070.7"/>
<text text-anchor="middle" x="1191" y="-5058.7" font-family="Arial" font-size="10.00">Expert 4 Computation</text>
<text text-anchor="middle" x="1191" y="-5047.7" font-family="Arial" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="1191" y="-5036.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1191" y="-5025.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_0&#45;&gt;expert_4 -->
<g id="edge8" class="edge">
<title>route_0&#45;&gt;expert_4</title>
<path fill="none" stroke="black" d="M1105.91,-5108.08C1119.78,-5097.92 1134.88,-5086.85 1148.46,-5076.89"/>
<polygon fill="black" stroke="black" points="1150.69,-5079.59 1156.69,-5070.86 1146.55,-5073.95 1150.69,-5079.59"/>
</g>
<!-- expert_5 -->
<g id="node9" class="node">
<title>expert_5</title>
<polygon fill="lightblue" stroke="black" points="1576.5,-5070.7 1331.5,-5070.7 1331.5,-5018.7 1576.5,-5018.7 1576.5,-5070.7"/>
<text text-anchor="middle" x="1454" y="-5058.7" font-family="Arial" font-size="10.00">Expert 5 Computation</text>
<text text-anchor="middle" x="1454" y="-5047.7" font-family="Arial" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="1454" y="-5036.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1454" y="-5025.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_0&#45;&gt;expert_5 -->
<g id="edge9" class="edge">
<title>route_0&#45;&gt;expert_5</title>
<path fill="none" stroke="black" d="M1169.82,-5115.32C1223.53,-5102.17 1287.91,-5086.39 1341.8,-5073.19"/>
<polygon fill="black" stroke="black" points="1342.85,-5076.54 1351.73,-5070.76 1341.19,-5069.74 1342.85,-5076.54"/>
</g>
<!-- expert_6 -->
<g id="node10" class="node">
<title>expert_6</title>
<polygon fill="lightblue" stroke="black" points="1839.5,-5070.7 1594.5,-5070.7 1594.5,-5018.7 1839.5,-5018.7 1839.5,-5070.7"/>
<text text-anchor="middle" x="1717" y="-5058.7" font-family="Arial" font-size="10.00">Expert 6 Computation</text>
<text text-anchor="middle" x="1717" y="-5047.7" font-family="Arial" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="1717" y="-5036.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1717" y="-5025.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_0&#45;&gt;expert_6 -->
<g id="edge10" class="edge">
<title>route_0&#45;&gt;expert_6</title>
<path fill="none" stroke="black" d="M1206.4,-5124.53C1309.66,-5111.46 1451.09,-5092.54 1584.32,-5070.95"/>
<polygon fill="black" stroke="black" points="1585,-5074.38 1594.31,-5069.32 1583.88,-5067.48 1585,-5074.38"/>
</g>
<!-- expert_7 -->
<g id="node11" class="node">
<title>expert_7</title>
<polygon fill="lightblue" stroke="black" points="2102.5,-5070.7 1857.5,-5070.7 1857.5,-5018.7 2102.5,-5018.7 2102.5,-5070.7"/>
<text text-anchor="middle" x="1980" y="-5058.7" font-family="Arial" font-size="10.00">Expert 7 Computation</text>
<text text-anchor="middle" x="1980" y="-5047.7" font-family="Arial" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="1980" y="-5036.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1980" y="-5025.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_0&#45;&gt;expert_7 -->
<g id="edge11" class="edge">
<title>route_0&#45;&gt;expert_7</title>
<path fill="none" stroke="black" d="M1222.94,-5132.28C1380.67,-5121.39 1625.96,-5101.59 1847.15,-5070.91"/>
<polygon fill="black" stroke="black" points="1847.92,-5074.34 1857.34,-5069.49 1846.95,-5067.41 1847.92,-5074.34"/>
</g>
<!-- qkv_proj_0 -->
<g id="node12" class="node">
<title>qkv_proj_0</title>
<polygon fill="lightblue" stroke="black" points="1169,-4982.7 899,-4982.7 899,-4930.7 1169,-4930.7 1169,-4982.7"/>
<text text-anchor="middle" x="1034" y="-4970.7" font-family="Arial" font-size="10.00">QKV Projection (TP=8)</text>
<text text-anchor="middle" x="1034" y="-4959.7" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1034" y="-4948.7" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1034" y="-4937.7" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, heads=8, d_k=64]</text>
</g>
<!-- expert_0&#45;&gt;qkv_proj_0 -->
<g id="edge12" class="edge">
<title>expert_0&#45;&gt;qkv_proj_0</title>
<path fill="none" stroke="black" d="M261.54,-5020.03C264.72,-5019.57 267.88,-5019.12 271,-5018.7 485.1,-4989.96 734.94,-4973.12 888.81,-4964.66"/>
<polygon fill="black" stroke="black" points="889.01,-4968.16 898.81,-4964.12 888.63,-4961.17 889.01,-4968.16"/>
</g>
<!-- agg_0 -->
<g id="node19" class="node">
<title>agg_0</title>
<polygon fill="lightyellow" stroke="black" points="1298.24,-4302.09 877.89,-4302.09 769.76,-4198.09 1190.11,-4198.09 1298.24,-4302.09"/>
<text text-anchor="middle" x="1034" y="-4264.09" font-family="Arial" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1034" y="-4253.09" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1034" y="-4242.09" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1034" y="-4231.09" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- expert_0&#45;&gt;agg_0 -->
<g id="edge26" class="edge">
<title>expert_0&#45;&gt;agg_0</title>
<path fill="none" stroke="black" d="M225.39,-5018.59C296.96,-4991.85 387,-4941.75 387,-4858.93 387,-4858.93 387,-4858.93 387,-4472.63 387,-4375.55 651.01,-4312.09 841.74,-4278.92"/>
<polygon fill="black" stroke="black" points="842.36,-4282.37 851.62,-4277.22 841.17,-4275.47 842.36,-4282.37"/>
</g>
<!-- expert_1&#45;&gt;qkv_proj_0 -->
<g id="edge13" class="edge">
<title>expert_1&#45;&gt;qkv_proj_0</title>
<path fill="none" stroke="black" d="M524.56,-5020.21C527.74,-5019.69 530.89,-5019.19 534,-5018.7 653.05,-5000.19 788.77,-4983.94 888.74,-4972.87"/>
<polygon fill="black" stroke="black" points="889.36,-4976.33 898.91,-4971.75 888.59,-4969.37 889.36,-4976.33"/>
</g>
<!-- expert_1&#45;&gt;agg_0 -->
<g id="edge27" class="edge">
<title>expert_1&#45;&gt;agg_0</title>
<path fill="none" stroke="black" d="M456.34,-5018.67C511.55,-4989.06 589,-4934.13 589,-4858.93 589,-4858.93 589,-4858.93 589,-4472.63 589,-4354.16 716.94,-4299.04 835.62,-4273.4"/>
<polygon fill="black" stroke="black" points="836.53,-4276.78 845.6,-4271.31 835.1,-4269.93 836.53,-4276.78"/>
</g>
<!-- expert_2&#45;&gt;qkv_proj_0 -->
<g id="edge14" class="edge">
<title>expert_2&#45;&gt;qkv_proj_0</title>
<path fill="none" stroke="black" d="M772.72,-5018.6C817.9,-5008.07 870.56,-4995.8 916.72,-4985.04"/>
<polygon fill="black" stroke="black" points="917.52,-4988.45 926.46,-4982.77 915.93,-4981.63 917.52,-4988.45"/>
</g>
<!-- expert_2&#45;&gt;agg_0 -->
<g id="edge28" class="edge">
<title>expert_2&#45;&gt;agg_0</title>
<path fill="none" stroke="black" d="M679.91,-5018.68C699.1,-4984.04 730,-4918.95 730,-4858.93 730,-4858.93 730,-4858.93 730,-4472.63 730,-4402.83 757.64,-4383.07 811,-4338.09 827.05,-4324.56 845.44,-4312.98 864.63,-4303.12"/>
<polygon fill="black" stroke="black" points="866.41,-4306.14 873.8,-4298.55 863.29,-4299.87 866.41,-4306.14"/>
</g>
<!-- expert_3&#45;&gt;qkv_proj_0 -->
<g id="edge15" class="edge">
<title>expert_3&#45;&gt;qkv_proj_0</title>
<path fill="none" stroke="black" d="M958.94,-5018.6C970.17,-5009.49 982.99,-4999.09 994.83,-4989.48"/>
<polygon fill="black" stroke="black" points="997.27,-4992.01 1002.83,-4982.99 992.86,-4986.57 997.27,-4992.01"/>
</g>
<!-- expert_3&#45;&gt;agg_0 -->
<g id="edge29" class="edge">
<title>expert_3&#45;&gt;agg_0</title>
<path fill="none" stroke="black" d="M900.31,-5018.5C867.15,-4985.39 816,-4923.83 816,-4858.93 816,-4858.93 816,-4858.93 816,-4472.63 816,-4411.46 806.74,-4385.81 845,-4338.09 854.09,-4326.75 864.99,-4316.83 876.9,-4308.16"/>
<polygon fill="black" stroke="black" points="879.06,-4310.92 885.3,-4302.36 875.08,-4305.16 879.06,-4310.92"/>
</g>
<!-- expert_4&#45;&gt;qkv_proj_0 -->
<g id="edge16" class="edge">
<title>expert_4&#45;&gt;qkv_proj_0</title>
<path fill="none" stroke="black" d="M1145.17,-5018.6C1127.51,-5008.93 1107.17,-4997.78 1088.76,-4987.7"/>
<polygon fill="black" stroke="black" points="1090.34,-4984.58 1079.89,-4982.84 1086.98,-4990.71 1090.34,-4984.58"/>
</g>
<!-- expert_4&#45;&gt;agg_0 -->
<g id="edge30" class="edge">
<title>expert_4&#45;&gt;agg_0</title>
<path fill="none" stroke="black" d="M1204.99,-5018.56C1223,-4983.8 1252,-4918.56 1252,-4858.93 1252,-4858.93 1252,-4858.93 1252,-4472.63 1252,-4411.46 1261.26,-4385.81 1223,-4338.09 1213.91,-4326.75 1203.01,-4316.83 1191.1,-4308.16"/>
<polygon fill="black" stroke="black" points="1192.92,-4305.16 1182.7,-4302.36 1188.94,-4310.92 1192.92,-4305.16"/>
</g>
<!-- expert_5&#45;&gt;qkv_proj_0 -->
<g id="edge17" class="edge">
<title>expert_5&#45;&gt;qkv_proj_0</title>
<path fill="none" stroke="black" d="M1331.67,-5018.66C1279.69,-5008.01 1218.98,-4995.58 1165.99,-4984.73"/>
<polygon fill="black" stroke="black" points="1166.69,-4981.3 1156.19,-4982.72 1165.29,-4988.16 1166.69,-4981.3"/>
</g>
<!-- expert_5&#45;&gt;agg_0 -->
<g id="edge31" class="edge">
<title>expert_5&#45;&gt;agg_0</title>
<path fill="none" stroke="black" d="M1440.01,-5018.56C1422,-4983.8 1393,-4918.56 1393,-4858.93 1393,-4858.93 1393,-4858.93 1393,-4472.63 1393,-4391.78 1326.25,-4339.46 1250.31,-4306.11"/>
<polygon fill="black" stroke="black" points="1251.58,-4302.84 1241.01,-4302.13 1248.83,-4309.28 1251.58,-4302.84"/>
</g>
<!-- expert_6&#45;&gt;qkv_proj_0 -->
<g id="edge18" class="edge">
<title>expert_6&#45;&gt;qkv_proj_0</title>
<path fill="none" stroke="black" d="M1594.32,-5019.99C1591.53,-5019.55 1588.75,-5019.12 1586,-5018.7 1448.45,-4998.01 1290.62,-4981.27 1179.05,-4970.59"/>
<polygon fill="black" stroke="black" points="1179.37,-4967.11 1169.08,-4969.65 1178.7,-4974.08 1179.37,-4967.11"/>
</g>
<!-- expert_6&#45;&gt;agg_0 -->
<g id="edge32" class="edge">
<title>expert_6&#45;&gt;agg_0</title>
<path fill="none" stroke="black" d="M1676.27,-5018.51C1631.24,-4987.17 1565,-4929.13 1565,-4858.93 1565,-4858.93 1565,-4858.93 1565,-4472.63 1565,-4403.6 1410.25,-4344.54 1267.83,-4304.8"/>
<polygon fill="black" stroke="black" points="1268.61,-4301.38 1258.04,-4302.09 1266.74,-4308.13 1268.61,-4301.38"/>
</g>
<!-- expert_7&#45;&gt;qkv_proj_0 -->
<g id="edge19" class="edge">
<title>expert_7&#45;&gt;qkv_proj_0</title>
<path fill="none" stroke="black" d="M1857.34,-5019.86C1854.54,-5019.45 1851.75,-5019.07 1849,-5018.7 1615.81,-4987.83 1342.87,-4971.36 1179.44,-4963.59"/>
<polygon fill="black" stroke="black" points="1179.48,-4960.09 1169.32,-4963.11 1179.15,-4967.08 1179.48,-4960.09"/>
</g>
<!-- expert_7&#45;&gt;agg_0 -->
<g id="edge33" class="edge">
<title>expert_7&#45;&gt;agg_0</title>
<path fill="none" stroke="black" d="M1958.2,-5018.42C1931.28,-4984.51 1889,-4921.33 1889,-4858.93 1889,-4858.93 1889,-4858.93 1889,-4472.63 1889,-4344.24 1523.19,-4289.02 1270.12,-4266.19"/>
<polygon fill="black" stroke="black" points="1270.31,-4262.69 1260.04,-4265.29 1269.69,-4269.66 1270.31,-4262.69"/>
</g>
<!-- qkv_comm_0 -->
<g id="node13" class="node">
<title>qkv_comm_0</title>
<ellipse fill="lightgreen" stroke="black" cx="1034" cy="-4857.93" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1034" y="-4871.93" font-family="Arial" font-size="10.00">QKV AllGather (TP)</text>
<text text-anchor="middle" x="1034" y="-4860.93" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1034" y="-4849.93" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, heads=8, d_k=64]</text>
<text text-anchor="middle" x="1034" y="-4838.93" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
</g>
<!-- qkv_proj_0&#45;&gt;qkv_comm_0 -->
<g id="edge20" class="edge">
<title>qkv_proj_0&#45;&gt;qkv_comm_0</title>
<path fill="none" stroke="black" d="M1034,-4930.53C1034,-4922.72 1034,-4913.86 1034,-4905.09"/>
<polygon fill="black" stroke="black" points="1037.5,-4904.91 1034,-4894.91 1030.5,-4904.91 1037.5,-4904.91"/>
</g>
<!-- attn_scores_0 -->
<g id="node14" class="node">
<title>attn_scores_0</title>
<polygon fill="lightblue" stroke="black" points="1168,-4785.16 900,-4785.16 900,-4733.16 1168,-4733.16 1168,-4785.16"/>
<text text-anchor="middle" x="1034" y="-4773.16" font-family="Arial" font-size="10.00">Attention Score Computation (SP=2)</text>
<text text-anchor="middle" x="1034" y="-4762.16" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1034" y="-4751.16" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1034" y="-4740.16" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, seq_len=1024]</text>
</g>
<!-- qkv_comm_0&#45;&gt;attn_scores_0 -->
<g id="edge21" class="edge">
<title>qkv_comm_0&#45;&gt;attn_scores_0</title>
<path fill="none" stroke="black" d="M1034,-4820.9C1034,-4812.59 1034,-4803.76 1034,-4795.47"/>
<polygon fill="black" stroke="black" points="1037.5,-4795.36 1034,-4785.36 1030.5,-4795.36 1037.5,-4795.36"/>
</g>
<!-- attn_apply_0 -->
<g id="node15" class="node">
<title>attn_apply_0</title>
<polygon fill="lightblue" stroke="black" points="1171.5,-4697.16 896.5,-4697.16 896.5,-4645.16 1171.5,-4645.16 1171.5,-4697.16"/>
<text text-anchor="middle" x="1034" y="-4685.16" font-family="Arial" font-size="10.00">Attention Weight Application (SP=2)</text>
<text text-anchor="middle" x="1034" y="-4674.16" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1034" y="-4663.16" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, seq_len=1024]</text>
<text text-anchor="middle" x="1034" y="-4652.16" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
</g>
<!-- attn_scores_0&#45;&gt;attn_apply_0 -->
<g id="edge22" class="edge">
<title>attn_scores_0&#45;&gt;attn_apply_0</title>
<path fill="none" stroke="black" d="M1034,-4732.83C1034,-4724.87 1034,-4715.93 1034,-4707.41"/>
<polygon fill="black" stroke="black" points="1037.5,-4707.32 1034,-4697.32 1030.5,-4707.32 1037.5,-4707.32"/>
</g>
<!-- attn_sp_comm_0 -->
<g id="node16" class="node">
<title>attn_sp_comm_0</title>
<ellipse fill="lightgreen" stroke="black" cx="1034" cy="-4572.4" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1034" y="-4586.4" font-family="Arial" font-size="10.00">Attention SP AllReduce</text>
<text text-anchor="middle" x="1034" y="-4575.4" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1034" y="-4564.4" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1034" y="-4553.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
</g>
<!-- attn_apply_0&#45;&gt;attn_sp_comm_0 -->
<g id="edge23" class="edge">
<title>attn_apply_0&#45;&gt;attn_sp_comm_0</title>
<path fill="none" stroke="black" d="M1034,-4644.99C1034,-4637.18 1034,-4628.32 1034,-4619.55"/>
<polygon fill="black" stroke="black" points="1037.5,-4619.37 1034,-4609.37 1030.5,-4619.37 1037.5,-4619.37"/>
</g>
<!-- out_proj_0 -->
<g id="node17" class="node">
<title>out_proj_0</title>
<polygon fill="lightblue" stroke="black" points="1170.5,-4499.63 897.5,-4499.63 897.5,-4447.63 1170.5,-4447.63 1170.5,-4499.63"/>
<text text-anchor="middle" x="1034" y="-4487.63" font-family="Arial" font-size="10.00">Output Projection (TP=8)</text>
<text text-anchor="middle" x="1034" y="-4476.63" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1034" y="-4465.63" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1034" y="-4454.63" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- attn_sp_comm_0&#45;&gt;out_proj_0 -->
<g id="edge24" class="edge">
<title>attn_sp_comm_0&#45;&gt;out_proj_0</title>
<path fill="none" stroke="black" d="M1034,-4535.36C1034,-4527.05 1034,-4518.22 1034,-4509.93"/>
<polygon fill="black" stroke="black" points="1037.5,-4509.82 1034,-4499.82 1030.5,-4509.82 1037.5,-4509.82"/>
</g>
<!-- out_proj_comm_0 -->
<g id="node18" class="node">
<title>out_proj_comm_0</title>
<ellipse fill="lightgreen" stroke="black" cx="1034" cy="-4374.86" rx="180.12" ry="36.54"/>
<text text-anchor="middle" x="1034" y="-4388.86" font-family="Arial" font-size="10.00">Output AllReduce (TP)</text>
<text text-anchor="middle" x="1034" y="-4377.86" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
<text text-anchor="middle" x="1034" y="-4366.86" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1034" y="-4355.86" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- out_proj_0&#45;&gt;out_proj_comm_0 -->
<g id="edge25" class="edge">
<title>out_proj_0&#45;&gt;out_proj_comm_0</title>
<path fill="none" stroke="black" d="M1034,-4447.45C1034,-4439.64 1034,-4430.78 1034,-4422.01"/>
<polygon fill="black" stroke="black" points="1037.5,-4421.83 1034,-4411.83 1030.5,-4421.83 1037.5,-4421.83"/>
</g>
<!-- out_proj_comm_0&#45;&gt;agg_0 -->
<g id="edge34" class="edge">
<title>out_proj_comm_0&#45;&gt;agg_0</title>
<path fill="none" stroke="black" d="M1034,-4338.02C1034,-4329.98 1034,-4321.23 1034,-4312.48"/>
<polygon fill="black" stroke="black" points="1037.5,-4312.25 1034,-4302.25 1030.5,-4312.25 1037.5,-4312.25"/>
</g>
<!-- pipe_comm_0_1 -->
<g id="node79" class="node">
<title>pipe_comm_0_1</title>
<ellipse fill="lightgreen" stroke="black" cx="1034" cy="-4125.32" rx="180.12" ry="36.54"/>
<text text-anchor="middle" x="1034" y="-4139.32" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="1034" y="-4128.32" font-family="Arial" font-size="10.00">GPU: 31&#45;&gt;32</text>
<text text-anchor="middle" x="1034" y="-4117.32" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1034" y="-4106.32" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- agg_0&#45;&gt;pipe_comm_0_1 -->
<g id="edge35" class="edge">
<title>agg_0&#45;&gt;pipe_comm_0_1</title>
<path fill="none" stroke="black" d="M1034,-4197.73C1034,-4189.32 1034,-4180.66 1034,-4172.39"/>
<polygon fill="black" stroke="black" points="1037.5,-4172.17 1034,-4162.17 1030.5,-4172.17 1037.5,-4172.17"/>
</g>
<!-- embed_1 -->
<g id="node20" class="node">
<title>embed_1</title>
<polygon fill="lightblue" stroke="black" points="1161.5,-4034.55 906.5,-4034.55 906.5,-3982.55 1161.5,-3982.55 1161.5,-4034.55"/>
<text text-anchor="middle" x="1034" y="-4022.55" font-family="Arial" font-size="10.00">Token Embedding</text>
<text text-anchor="middle" x="1034" y="-4011.55" font-family="Arial" font-size="10.00">GPU: 32&#45;39</text>
<text text-anchor="middle" x="1034" y="-4000.55" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1034" y="-3989.55" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- gate_1 -->
<g id="node21" class="node">
<title>gate_1</title>
<polygon fill="lightyellow" stroke="black" points="1291.23,-3946.55 882.03,-3946.55 776.77,-3842.55 1185.97,-3842.55 1291.23,-3946.55"/>
<text text-anchor="middle" x="1034" y="-3908.55" font-family="Arial" font-size="10.00">Gate Selection</text>
<text text-anchor="middle" x="1034" y="-3897.55" font-family="Arial" font-size="10.00">GPU: 32&#45;39</text>
<text text-anchor="middle" x="1034" y="-3886.55" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1034" y="-3875.55" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, experts=32]</text>
</g>
<!-- embed_1&#45;&gt;gate_1 -->
<g id="edge37" class="edge">
<title>embed_1&#45;&gt;gate_1</title>
<path fill="none" stroke="black" d="M1034,-3982.41C1034,-3974.73 1034,-3965.91 1034,-3956.92"/>
<polygon fill="black" stroke="black" points="1037.5,-3956.73 1034,-3946.73 1030.5,-3956.73 1037.5,-3956.73"/>
</g>
<!-- route_1 -->
<g id="node22" class="node">
<title>route_1</title>
<ellipse fill="lightgreen" stroke="black" cx="1034" cy="-3769.78" rx="171.65" ry="36.54"/>
<text text-anchor="middle" x="1034" y="-3783.78" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="1034" y="-3772.78" font-family="Arial" font-size="10.00">GPU: 32&#45;63</text>
<text text-anchor="middle" x="1034" y="-3761.78" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, experts=32]</text>
<text text-anchor="middle" x="1034" y="-3750.78" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, experts=1]</text>
</g>
<!-- gate_1&#45;&gt;route_1 -->
<g id="edge38" class="edge">
<title>gate_1&#45;&gt;route_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1034,-3842.19C1034,-3833.79 1034,-3825.12 1034,-3816.85"/>
<polygon fill="black" stroke="black" points="1037.5,-3816.63 1034,-3806.63 1030.5,-3816.63 1037.5,-3816.63"/>
</g>
<!-- expert_32 -->
<g id="node23" class="node">
<title>expert_32</title>
<polygon fill="lightblue" stroke="black" points="266.5,-3697.01 21.5,-3697.01 21.5,-3645.01 266.5,-3645.01 266.5,-3697.01"/>
<text text-anchor="middle" x="144" y="-3685.01" font-family="Arial" font-size="10.00">Expert 32 Computation</text>
<text text-anchor="middle" x="144" y="-3674.01" font-family="Arial" font-size="10.00">GPU: 32</text>
<text text-anchor="middle" x="144" y="-3663.01" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="144" y="-3652.01" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_1&#45;&gt;expert_32 -->
<g id="edge39" class="edge">
<title>route_1&#45;&gt;expert_32</title>
<path fill="none" stroke="black" d="M871.21,-3757.75C719.76,-3746.48 487.72,-3726.6 276.58,-3697.03"/>
<polygon fill="black" stroke="black" points="276.94,-3693.55 266.55,-3695.62 275.96,-3700.48 276.94,-3693.55"/>
</g>
<!-- expert_33 -->
<g id="node24" class="node">
<title>expert_33</title>
<polygon fill="lightblue" stroke="black" points="529.5,-3697.01 284.5,-3697.01 284.5,-3645.01 529.5,-3645.01 529.5,-3697.01"/>
<text text-anchor="middle" x="407" y="-3685.01" font-family="Arial" font-size="10.00">Expert 33 Computation</text>
<text text-anchor="middle" x="407" y="-3674.01" font-family="Arial" font-size="10.00">GPU: 33</text>
<text text-anchor="middle" x="407" y="-3663.01" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="407" y="-3652.01" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_1&#45;&gt;expert_33 -->
<g id="edge40" class="edge">
<title>route_1&#45;&gt;expert_33</title>
<path fill="none" stroke="black" d="M890.24,-3749.61C793.92,-3736.36 664.04,-3717.74 539.67,-3697.09"/>
<polygon fill="black" stroke="black" points="540.02,-3693.6 529.58,-3695.41 538.87,-3700.51 540.02,-3693.6"/>
</g>
<!-- expert_34 -->
<g id="node25" class="node">
<title>expert_34</title>
<polygon fill="lightblue" stroke="black" points="792.5,-3697.01 547.5,-3697.01 547.5,-3645.01 792.5,-3645.01 792.5,-3697.01"/>
<text text-anchor="middle" x="670" y="-3685.01" font-family="Arial" font-size="10.00">Expert 34 Computation</text>
<text text-anchor="middle" x="670" y="-3674.01" font-family="Arial" font-size="10.00">GPU: 34</text>
<text text-anchor="middle" x="670" y="-3663.01" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="670" y="-3652.01" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_1&#45;&gt;expert_34 -->
<g id="edge41" class="edge">
<title>route_1&#45;&gt;expert_34</title>
<path fill="none" stroke="black" d="M928.23,-3740.66C879.72,-3727.76 822.4,-3712.52 774.1,-3699.68"/>
<polygon fill="black" stroke="black" points="774.82,-3696.25 764.25,-3697.07 773.02,-3703.02 774.82,-3696.25"/>
</g>
<!-- expert_35 -->
<g id="node26" class="node">
<title>expert_35</title>
<polygon fill="lightblue" stroke="black" points="1055.5,-3697.01 810.5,-3697.01 810.5,-3645.01 1055.5,-3645.01 1055.5,-3697.01"/>
<text text-anchor="middle" x="933" y="-3685.01" font-family="Arial" font-size="10.00">Expert 35 Computation</text>
<text text-anchor="middle" x="933" y="-3674.01" font-family="Arial" font-size="10.00">GPU: 35</text>
<text text-anchor="middle" x="933" y="-3663.01" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="933" y="-3652.01" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_1&#45;&gt;expert_35 -->
<g id="edge42" class="edge">
<title>route_1&#45;&gt;expert_35</title>
<path fill="none" stroke="black" d="M997.54,-3733.84C987.45,-3724.18 976.55,-3713.74 966.64,-3704.24"/>
<polygon fill="black" stroke="black" points="968.91,-3701.57 959.27,-3697.18 964.07,-3706.63 968.91,-3701.57"/>
</g>
<!-- expert_36 -->
<g id="node27" class="node">
<title>expert_36</title>
<polygon fill="lightblue" stroke="black" points="1318.5,-3697.01 1073.5,-3697.01 1073.5,-3645.01 1318.5,-3645.01 1318.5,-3697.01"/>
<text text-anchor="middle" x="1196" y="-3685.01" font-family="Arial" font-size="10.00">Expert 36 Computation</text>
<text text-anchor="middle" x="1196" y="-3674.01" font-family="Arial" font-size="10.00">GPU: 36</text>
<text text-anchor="middle" x="1196" y="-3663.01" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1196" y="-3652.01" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_1&#45;&gt;expert_36 -->
<g id="edge43" class="edge">
<title>route_1&#45;&gt;expert_36</title>
<path fill="none" stroke="black" d="M1090.66,-3734.93C1108.38,-3724.35 1127.8,-3712.75 1145.1,-3702.42"/>
<polygon fill="black" stroke="black" points="1147.14,-3705.27 1153.93,-3697.14 1143.55,-3699.26 1147.14,-3705.27"/>
</g>
<!-- expert_37 -->
<g id="node28" class="node">
<title>expert_37</title>
<polygon fill="lightblue" stroke="black" points="1581.5,-3697.01 1336.5,-3697.01 1336.5,-3645.01 1581.5,-3645.01 1581.5,-3697.01"/>
<text text-anchor="middle" x="1459" y="-3685.01" font-family="Arial" font-size="10.00">Expert 37 Computation</text>
<text text-anchor="middle" x="1459" y="-3674.01" font-family="Arial" font-size="10.00">GPU: 37</text>
<text text-anchor="middle" x="1459" y="-3663.01" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1459" y="-3652.01" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_1&#45;&gt;expert_37 -->
<g id="edge44" class="edge">
<title>route_1&#45;&gt;expert_37</title>
<path fill="none" stroke="black" d="M1149.57,-3742.46C1208.36,-3729.08 1279.75,-3712.82 1339.14,-3699.3"/>
<polygon fill="black" stroke="black" points="1339.97,-3702.7 1348.94,-3697.07 1338.42,-3695.87 1339.97,-3702.7"/>
</g>
<!-- expert_38 -->
<g id="node29" class="node">
<title>expert_38</title>
<polygon fill="lightblue" stroke="black" points="1844.5,-3697.01 1599.5,-3697.01 1599.5,-3645.01 1844.5,-3645.01 1844.5,-3697.01"/>
<text text-anchor="middle" x="1722" y="-3685.01" font-family="Arial" font-size="10.00">Expert 38 Computation</text>
<text text-anchor="middle" x="1722" y="-3674.01" font-family="Arial" font-size="10.00">GPU: 38</text>
<text text-anchor="middle" x="1722" y="-3663.01" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1722" y="-3652.01" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_1&#45;&gt;expert_38 -->
<g id="edge45" class="edge">
<title>route_1&#45;&gt;expert_38</title>
<path fill="none" stroke="black" d="M1184.47,-3751.89C1294.12,-3738.98 1446.46,-3719.84 1589.06,-3697.28"/>
<polygon fill="black" stroke="black" points="1589.99,-3700.68 1599.31,-3695.65 1588.89,-3693.77 1589.99,-3700.68"/>
</g>
<!-- expert_39 -->
<g id="node30" class="node">
<title>expert_39</title>
<polygon fill="lightblue" stroke="black" points="2107.5,-3697.01 1862.5,-3697.01 1862.5,-3645.01 2107.5,-3645.01 2107.5,-3697.01"/>
<text text-anchor="middle" x="1985" y="-3685.01" font-family="Arial" font-size="10.00">Expert 39 Computation</text>
<text text-anchor="middle" x="1985" y="-3674.01" font-family="Arial" font-size="10.00">GPU: 39</text>
<text text-anchor="middle" x="1985" y="-3663.01" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1985" y="-3652.01" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_1&#45;&gt;expert_39 -->
<g id="edge46" class="edge">
<title>route_1&#45;&gt;expert_39</title>
<path fill="none" stroke="black" d="M1198.69,-3759.28C1362.3,-3748.71 1620.44,-3728.97 1852.36,-3697.18"/>
<polygon fill="black" stroke="black" points="1852.91,-3700.64 1862.34,-3695.81 1851.95,-3693.71 1852.91,-3700.64"/>
</g>
<!-- qkv_proj_1 -->
<g id="node31" class="node">
<title>qkv_proj_1</title>
<polygon fill="lightblue" stroke="black" points="1174,-3609.01 904,-3609.01 904,-3557.01 1174,-3557.01 1174,-3609.01"/>
<text text-anchor="middle" x="1039" y="-3597.01" font-family="Arial" font-size="10.00">QKV Projection (TP=8)</text>
<text text-anchor="middle" x="1039" y="-3586.01" font-family="Arial" font-size="10.00">GPU: 32&#45;39</text>
<text text-anchor="middle" x="1039" y="-3575.01" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1039" y="-3564.01" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, heads=8, d_k=64]</text>
</g>
<!-- expert_32&#45;&gt;qkv_proj_1 -->
<g id="edge47" class="edge">
<title>expert_32&#45;&gt;qkv_proj_1</title>
<path fill="none" stroke="black" d="M266.54,-3646.34C269.72,-3645.87 272.88,-3645.43 276,-3645.01 490.1,-3616.26 739.94,-3599.43 893.81,-3590.97"/>
<polygon fill="black" stroke="black" points="894.01,-3594.46 903.81,-3590.42 893.63,-3587.47 894.01,-3594.46"/>
</g>
<!-- agg_1 -->
<g id="node38" class="node">
<title>agg_1</title>
<polygon fill="lightyellow" stroke="black" points="1303.24,-2928.39 882.89,-2928.39 774.76,-2824.39 1195.11,-2824.39 1303.24,-2928.39"/>
<text text-anchor="middle" x="1039" y="-2890.39" font-family="Arial" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1039" y="-2879.39" font-family="Arial" font-size="10.00">GPU: 32&#45;39</text>
<text text-anchor="middle" x="1039" y="-2868.39" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1039" y="-2857.39" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- expert_32&#45;&gt;agg_1 -->
<g id="edge61" class="edge">
<title>expert_32&#45;&gt;agg_1</title>
<path fill="none" stroke="black" d="M227.97,-3644.88C298.55,-3617.96 388,-3567.6 388,-3485.24 388,-3485.24 388,-3485.24 388,-3098.93 388,-3001.17 654.45,-2937.82 846.42,-2904.87"/>
<polygon fill="black" stroke="black" points="847.09,-2908.3 856.36,-2903.17 845.92,-2901.4 847.09,-2908.3"/>
</g>
<!-- expert_33&#45;&gt;qkv_proj_1 -->
<g id="edge48" class="edge">
<title>expert_33&#45;&gt;qkv_proj_1</title>
<path fill="none" stroke="black" d="M529.56,-3646.51C532.74,-3645.99 535.89,-3645.49 539,-3645.01 658.05,-3626.49 793.77,-3610.24 893.74,-3599.18"/>
<polygon fill="black" stroke="black" points="894.36,-3602.63 903.91,-3598.05 893.59,-3595.67 894.36,-3602.63"/>
</g>
<!-- expert_33&#45;&gt;agg_1 -->
<g id="edge62" class="edge">
<title>expert_33&#45;&gt;agg_1</title>
<path fill="none" stroke="black" d="M459.93,-3644.8C513.98,-3614.96 590,-3559.73 590,-3485.24 590,-3485.24 590,-3485.24 590,-3098.93 590,-2979.3 719.78,-2924.27 839.79,-2898.95"/>
<polygon fill="black" stroke="black" points="840.79,-2902.32 849.88,-2896.89 839.39,-2895.46 840.79,-2902.32"/>
</g>
<!-- expert_34&#45;&gt;qkv_proj_1 -->
<g id="edge49" class="edge">
<title>expert_34&#45;&gt;qkv_proj_1</title>
<path fill="none" stroke="black" d="M777.72,-3644.9C822.9,-3634.37 875.56,-3622.1 921.72,-3611.34"/>
<polygon fill="black" stroke="black" points="922.52,-3614.75 931.46,-3609.07 920.93,-3607.93 922.52,-3614.75"/>
</g>
<!-- expert_34&#45;&gt;agg_1 -->
<g id="edge63" class="edge">
<title>expert_34&#45;&gt;agg_1</title>
<path fill="none" stroke="black" d="M692.99,-3644.93C721.4,-3611.25 766,-3548.32 766,-3485.24 766,-3485.24 766,-3485.24 766,-3098.93 766,-3035.14 771.26,-3009.86 816,-2964.39 830.72,-2949.43 848.31,-2936.99 867.07,-2926.65"/>
<polygon fill="black" stroke="black" points="868.85,-2929.66 876.06,-2921.9 865.58,-2923.48 868.85,-2929.66"/>
</g>
<!-- expert_35&#45;&gt;qkv_proj_1 -->
<g id="edge50" class="edge">
<title>expert_35&#45;&gt;qkv_proj_1</title>
<path fill="none" stroke="black" d="M963.94,-3644.9C975.17,-3635.8 987.99,-3625.39 999.83,-3615.79"/>
<polygon fill="black" stroke="black" points="1002.27,-3618.31 1007.83,-3609.29 997.86,-3612.88 1002.27,-3618.31"/>
</g>
<!-- expert_35&#45;&gt;agg_1 -->
<g id="edge64" class="edge">
<title>expert_35&#45;&gt;agg_1</title>
<path fill="none" stroke="black" d="M905.31,-3644.8C872.15,-3611.7 821,-3550.13 821,-3485.24 821,-3485.24 821,-3485.24 821,-3098.93 821,-3037.76 811.74,-3012.11 850,-2964.39 859.09,-2953.06 869.99,-2943.14 881.9,-2934.47"/>
<polygon fill="black" stroke="black" points="884.06,-2937.23 890.3,-2928.66 880.08,-2931.47 884.06,-2937.23"/>
</g>
<!-- expert_36&#45;&gt;qkv_proj_1 -->
<g id="edge51" class="edge">
<title>expert_36&#45;&gt;qkv_proj_1</title>
<path fill="none" stroke="black" d="M1150.17,-3644.9C1132.51,-3635.23 1112.17,-3624.09 1093.76,-3614"/>
<polygon fill="black" stroke="black" points="1095.34,-3610.88 1084.89,-3609.15 1091.98,-3617.02 1095.34,-3610.88"/>
</g>
<!-- expert_36&#45;&gt;agg_1 -->
<g id="edge65" class="edge">
<title>expert_36&#45;&gt;agg_1</title>
<path fill="none" stroke="black" d="M1209.99,-3644.87C1228,-3610.1 1257,-3544.86 1257,-3485.24 1257,-3485.24 1257,-3485.24 1257,-3098.93 1257,-3037.76 1266.26,-3012.11 1228,-2964.39 1218.91,-2953.06 1208.01,-2943.14 1196.1,-2934.47"/>
<polygon fill="black" stroke="black" points="1197.92,-2931.47 1187.7,-2928.66 1193.94,-2937.23 1197.92,-2931.47"/>
</g>
<!-- expert_37&#45;&gt;qkv_proj_1 -->
<g id="edge52" class="edge">
<title>expert_37&#45;&gt;qkv_proj_1</title>
<path fill="none" stroke="black" d="M1336.67,-3644.96C1284.69,-3634.32 1223.98,-3621.89 1170.99,-3611.04"/>
<polygon fill="black" stroke="black" points="1171.69,-3607.61 1161.19,-3609.03 1170.29,-3614.46 1171.69,-3607.61"/>
</g>
<!-- expert_37&#45;&gt;agg_1 -->
<g id="edge66" class="edge">
<title>expert_37&#45;&gt;agg_1</title>
<path fill="none" stroke="black" d="M1445.01,-3644.87C1427,-3610.1 1398,-3544.86 1398,-3485.24 1398,-3485.24 1398,-3485.24 1398,-3098.93 1398,-3018.08 1331.25,-2965.77 1255.31,-2932.41"/>
<polygon fill="black" stroke="black" points="1256.58,-2929.15 1246.01,-2928.43 1253.83,-2935.58 1256.58,-2929.15"/>
</g>
<!-- expert_38&#45;&gt;qkv_proj_1 -->
<g id="edge53" class="edge">
<title>expert_38&#45;&gt;qkv_proj_1</title>
<path fill="none" stroke="black" d="M1599.32,-3646.29C1596.53,-3645.85 1593.75,-3645.42 1591,-3645.01 1453.45,-3624.32 1295.62,-3607.57 1184.05,-3596.9"/>
<polygon fill="black" stroke="black" points="1184.37,-3593.41 1174.08,-3595.95 1183.7,-3600.38 1184.37,-3593.41"/>
</g>
<!-- expert_38&#45;&gt;agg_1 -->
<g id="edge67" class="edge">
<title>expert_38&#45;&gt;agg_1</title>
<path fill="none" stroke="black" d="M1708.01,-3644.87C1690,-3610.1 1661,-3544.86 1661,-3485.24 1661,-3485.24 1661,-3485.24 1661,-3098.93 1661,-3018.53 1474.24,-2959.72 1305.39,-2922.99"/>
<polygon fill="black" stroke="black" points="1306.1,-2919.56 1295.58,-2920.87 1304.62,-2926.4 1306.1,-2919.56"/>
</g>
<!-- expert_39&#45;&gt;qkv_proj_1 -->
<g id="edge54" class="edge">
<title>expert_39&#45;&gt;qkv_proj_1</title>
<path fill="none" stroke="black" d="M1862.34,-3646.16C1859.54,-3645.76 1856.75,-3645.37 1854,-3645.01 1620.81,-3614.13 1347.87,-3597.67 1184.44,-3589.89"/>
<polygon fill="black" stroke="black" points="1184.48,-3586.39 1174.32,-3589.42 1184.15,-3593.38 1184.48,-3586.39"/>
</g>
<!-- expert_39&#45;&gt;agg_1 -->
<g id="edge68" class="edge">
<title>expert_39&#45;&gt;agg_1</title>
<path fill="none" stroke="black" d="M1971.01,-3644.87C1953,-3610.1 1924,-3544.86 1924,-3485.24 1924,-3485.24 1924,-3485.24 1924,-3098.93 1924,-2964.54 1535.14,-2910.98 1272.95,-2890.13"/>
<polygon fill="black" stroke="black" points="1273.14,-2886.63 1262.89,-2889.34 1272.59,-2893.61 1273.14,-2886.63"/>
</g>
<!-- qkv_comm_1 -->
<g id="node32" class="node">
<title>qkv_comm_1</title>
<ellipse fill="lightgreen" stroke="black" cx="1039" cy="-3484.24" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-3498.24" font-family="Arial" font-size="10.00">QKV AllGather (TP)</text>
<text text-anchor="middle" x="1039" y="-3487.24" font-family="Arial" font-size="10.00">GPU: 32&#45;39</text>
<text text-anchor="middle" x="1039" y="-3476.24" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, heads=8, d_k=64]</text>
<text text-anchor="middle" x="1039" y="-3465.24" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
</g>
<!-- qkv_proj_1&#45;&gt;qkv_comm_1 -->
<g id="edge55" class="edge">
<title>qkv_proj_1&#45;&gt;qkv_comm_1</title>
<path fill="none" stroke="black" d="M1039,-3556.84C1039,-3549.03 1039,-3540.16 1039,-3531.39"/>
<polygon fill="black" stroke="black" points="1042.5,-3531.22 1039,-3521.22 1035.5,-3531.22 1042.5,-3531.22"/>
</g>
<!-- attn_scores_1 -->
<g id="node33" class="node">
<title>attn_scores_1</title>
<polygon fill="lightblue" stroke="black" points="1173,-3411.47 905,-3411.47 905,-3359.47 1173,-3359.47 1173,-3411.47"/>
<text text-anchor="middle" x="1039" y="-3399.47" font-family="Arial" font-size="10.00">Attention Score Computation (SP=2)</text>
<text text-anchor="middle" x="1039" y="-3388.47" font-family="Arial" font-size="10.00">GPU: 32&#45;39</text>
<text text-anchor="middle" x="1039" y="-3377.47" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1039" y="-3366.47" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, seq_len=1024]</text>
</g>
<!-- qkv_comm_1&#45;&gt;attn_scores_1 -->
<g id="edge56" class="edge">
<title>qkv_comm_1&#45;&gt;attn_scores_1</title>
<path fill="none" stroke="black" d="M1039,-3447.21C1039,-3438.89 1039,-3430.06 1039,-3421.78"/>
<polygon fill="black" stroke="black" points="1042.5,-3421.67 1039,-3411.67 1035.5,-3421.67 1042.5,-3421.67"/>
</g>
<!-- attn_apply_1 -->
<g id="node34" class="node">
<title>attn_apply_1</title>
<polygon fill="lightblue" stroke="black" points="1176.5,-3323.47 901.5,-3323.47 901.5,-3271.47 1176.5,-3271.47 1176.5,-3323.47"/>
<text text-anchor="middle" x="1039" y="-3311.47" font-family="Arial" font-size="10.00">Attention Weight Application (SP=2)</text>
<text text-anchor="middle" x="1039" y="-3300.47" font-family="Arial" font-size="10.00">GPU: 32&#45;39</text>
<text text-anchor="middle" x="1039" y="-3289.47" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, seq_len=1024]</text>
<text text-anchor="middle" x="1039" y="-3278.47" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
</g>
<!-- attn_scores_1&#45;&gt;attn_apply_1 -->
<g id="edge57" class="edge">
<title>attn_scores_1&#45;&gt;attn_apply_1</title>
<path fill="none" stroke="black" d="M1039,-3359.13C1039,-3351.17 1039,-3342.23 1039,-3333.71"/>
<polygon fill="black" stroke="black" points="1042.5,-3333.63 1039,-3323.63 1035.5,-3333.63 1042.5,-3333.63"/>
</g>
<!-- attn_sp_comm_1 -->
<g id="node35" class="node">
<title>attn_sp_comm_1</title>
<ellipse fill="lightgreen" stroke="black" cx="1039" cy="-3198.7" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-3212.7" font-family="Arial" font-size="10.00">Attention SP AllReduce</text>
<text text-anchor="middle" x="1039" y="-3201.7" font-family="Arial" font-size="10.00">GPU: 32&#45;39</text>
<text text-anchor="middle" x="1039" y="-3190.7" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1039" y="-3179.7" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
</g>
<!-- attn_apply_1&#45;&gt;attn_sp_comm_1 -->
<g id="edge58" class="edge">
<title>attn_apply_1&#45;&gt;attn_sp_comm_1</title>
<path fill="none" stroke="black" d="M1039,-3271.3C1039,-3263.49 1039,-3254.62 1039,-3245.85"/>
<polygon fill="black" stroke="black" points="1042.5,-3245.68 1039,-3235.68 1035.5,-3245.68 1042.5,-3245.68"/>
</g>
<!-- out_proj_1 -->
<g id="node36" class="node">
<title>out_proj_1</title>
<polygon fill="lightblue" stroke="black" points="1175.5,-3125.93 902.5,-3125.93 902.5,-3073.93 1175.5,-3073.93 1175.5,-3125.93"/>
<text text-anchor="middle" x="1039" y="-3113.93" font-family="Arial" font-size="10.00">Output Projection (TP=8)</text>
<text text-anchor="middle" x="1039" y="-3102.93" font-family="Arial" font-size="10.00">GPU: 32&#45;39</text>
<text text-anchor="middle" x="1039" y="-3091.93" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1039" y="-3080.93" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- attn_sp_comm_1&#45;&gt;out_proj_1 -->
<g id="edge59" class="edge">
<title>attn_sp_comm_1&#45;&gt;out_proj_1</title>
<path fill="none" stroke="black" d="M1039,-3161.67C1039,-3153.35 1039,-3144.52 1039,-3136.24"/>
<polygon fill="black" stroke="black" points="1042.5,-3136.13 1039,-3126.13 1035.5,-3136.13 1042.5,-3136.13"/>
</g>
<!-- out_proj_comm_1 -->
<g id="node37" class="node">
<title>out_proj_comm_1</title>
<ellipse fill="lightgreen" stroke="black" cx="1039" cy="-3001.16" rx="180.12" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-3015.16" font-family="Arial" font-size="10.00">Output AllReduce (TP)</text>
<text text-anchor="middle" x="1039" y="-3004.16" font-family="Arial" font-size="10.00">GPU: 32&#45;39</text>
<text text-anchor="middle" x="1039" y="-2993.16" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1039" y="-2982.16" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- out_proj_1&#45;&gt;out_proj_comm_1 -->
<g id="edge60" class="edge">
<title>out_proj_1&#45;&gt;out_proj_comm_1</title>
<path fill="none" stroke="black" d="M1039,-3073.76C1039,-3065.95 1039,-3057.08 1039,-3048.32"/>
<polygon fill="black" stroke="black" points="1042.5,-3048.14 1039,-3038.14 1035.5,-3048.14 1042.5,-3048.14"/>
</g>
<!-- out_proj_comm_1&#45;&gt;agg_1 -->
<g id="edge69" class="edge">
<title>out_proj_comm_1&#45;&gt;agg_1</title>
<path fill="none" stroke="black" d="M1039,-2964.32C1039,-2956.28 1039,-2947.53 1039,-2938.79"/>
<polygon fill="black" stroke="black" points="1042.5,-2938.56 1039,-2928.56 1035.5,-2938.56 1042.5,-2938.56"/>
</g>
<!-- pipe_comm_1_2 -->
<g id="node80" class="node">
<title>pipe_comm_1_2</title>
<ellipse fill="lightgreen" stroke="black" cx="1039" cy="-2751.62" rx="180.12" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-2765.62" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="1039" y="-2754.62" font-family="Arial" font-size="10.00">GPU: 63&#45;&gt;64</text>
<text text-anchor="middle" x="1039" y="-2743.62" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1039" y="-2732.62" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- agg_1&#45;&gt;pipe_comm_1_2 -->
<g id="edge70" class="edge">
<title>agg_1&#45;&gt;pipe_comm_1_2</title>
<path fill="none" stroke="black" d="M1039,-2824.04C1039,-2815.63 1039,-2806.96 1039,-2798.69"/>
<polygon fill="black" stroke="black" points="1042.5,-2798.48 1039,-2788.48 1035.5,-2798.48 1042.5,-2798.48"/>
</g>
<!-- embed_2 -->
<g id="node39" class="node">
<title>embed_2</title>
<polygon fill="lightblue" stroke="black" points="1166.5,-2660.85 911.5,-2660.85 911.5,-2608.85 1166.5,-2608.85 1166.5,-2660.85"/>
<text text-anchor="middle" x="1039" y="-2648.85" font-family="Arial" font-size="10.00">Token Embedding</text>
<text text-anchor="middle" x="1039" y="-2637.85" font-family="Arial" font-size="10.00">GPU: 64&#45;71</text>
<text text-anchor="middle" x="1039" y="-2626.85" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1039" y="-2615.85" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- gate_2 -->
<g id="node40" class="node">
<title>gate_2</title>
<polygon fill="lightyellow" stroke="black" points="1296.23,-2572.85 887.03,-2572.85 781.77,-2468.85 1190.97,-2468.85 1296.23,-2572.85"/>
<text text-anchor="middle" x="1039" y="-2534.85" font-family="Arial" font-size="10.00">Gate Selection</text>
<text text-anchor="middle" x="1039" y="-2523.85" font-family="Arial" font-size="10.00">GPU: 64&#45;71</text>
<text text-anchor="middle" x="1039" y="-2512.85" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1039" y="-2501.85" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, experts=32]</text>
</g>
<!-- embed_2&#45;&gt;gate_2 -->
<g id="edge72" class="edge">
<title>embed_2&#45;&gt;gate_2</title>
<path fill="none" stroke="black" d="M1039,-2608.72C1039,-2601.03 1039,-2592.22 1039,-2583.22"/>
<polygon fill="black" stroke="black" points="1042.5,-2583.03 1039,-2573.03 1035.5,-2583.03 1042.5,-2583.03"/>
</g>
<!-- route_2 -->
<g id="node41" class="node">
<title>route_2</title>
<ellipse fill="lightgreen" stroke="black" cx="1039" cy="-2396.08" rx="171.65" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-2410.08" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="1039" y="-2399.08" font-family="Arial" font-size="10.00">GPU: 64&#45;95</text>
<text text-anchor="middle" x="1039" y="-2388.08" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, experts=32]</text>
<text text-anchor="middle" x="1039" y="-2377.08" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, experts=1]</text>
</g>
<!-- gate_2&#45;&gt;route_2 -->
<g id="edge73" class="edge">
<title>gate_2&#45;&gt;route_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1039,-2468.5C1039,-2460.09 1039,-2451.42 1039,-2443.15"/>
<polygon fill="black" stroke="black" points="1042.5,-2442.94 1039,-2432.94 1035.5,-2442.94 1042.5,-2442.94"/>
</g>
<!-- expert_64 -->
<g id="node42" class="node">
<title>expert_64</title>
<polygon fill="lightblue" stroke="black" points="266.5,-2323.31 21.5,-2323.31 21.5,-2271.31 266.5,-2271.31 266.5,-2323.31"/>
<text text-anchor="middle" x="144" y="-2311.31" font-family="Arial" font-size="10.00">Expert 64 Computation</text>
<text text-anchor="middle" x="144" y="-2300.31" font-family="Arial" font-size="10.00">GPU: 64</text>
<text text-anchor="middle" x="144" y="-2289.31" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="144" y="-2278.31" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_2&#45;&gt;expert_64 -->
<g id="edge74" class="edge">
<title>route_2&#45;&gt;expert_64</title>
<path fill="none" stroke="black" d="M876.25,-2384.2C723.84,-2372.98 489.63,-2353.1 276.67,-2323.35"/>
<polygon fill="black" stroke="black" points="276.93,-2319.85 266.54,-2321.92 275.96,-2326.78 276.93,-2319.85"/>
</g>
<!-- expert_65 -->
<g id="node43" class="node">
<title>expert_65</title>
<polygon fill="lightblue" stroke="black" points="529.5,-2323.31 284.5,-2323.31 284.5,-2271.31 529.5,-2271.31 529.5,-2323.31"/>
<text text-anchor="middle" x="407" y="-2311.31" font-family="Arial" font-size="10.00">Expert 65 Computation</text>
<text text-anchor="middle" x="407" y="-2300.31" font-family="Arial" font-size="10.00">GPU: 65</text>
<text text-anchor="middle" x="407" y="-2289.31" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="407" y="-2278.31" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_2&#45;&gt;expert_65 -->
<g id="edge75" class="edge">
<title>route_2&#45;&gt;expert_65</title>
<path fill="none" stroke="black" d="M894.6,-2376.09C797.23,-2362.87 665.64,-2344.21 539.79,-2323.41"/>
<polygon fill="black" stroke="black" points="540.01,-2319.9 529.58,-2321.72 538.87,-2326.81 540.01,-2319.9"/>
</g>
<!-- expert_66 -->
<g id="node44" class="node">
<title>expert_66</title>
<polygon fill="lightblue" stroke="black" points="792.5,-2323.31 547.5,-2323.31 547.5,-2271.31 792.5,-2271.31 792.5,-2323.31"/>
<text text-anchor="middle" x="670" y="-2311.31" font-family="Arial" font-size="10.00">Expert 66 Computation</text>
<text text-anchor="middle" x="670" y="-2300.31" font-family="Arial" font-size="10.00">GPU: 66</text>
<text text-anchor="middle" x="670" y="-2289.31" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="670" y="-2278.31" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_2&#45;&gt;expert_66 -->
<g id="edge76" class="edge">
<title>route_2&#45;&gt;expert_66</title>
<path fill="none" stroke="black" d="M932.27,-2367.09C882.88,-2354.14 824.39,-2338.8 775.2,-2325.9"/>
<polygon fill="black" stroke="black" points="776.05,-2322.51 765.49,-2323.35 774.27,-2329.28 776.05,-2322.51"/>
</g>
<!-- expert_67 -->
<g id="node45" class="node">
<title>expert_67</title>
<polygon fill="lightblue" stroke="black" points="1055.5,-2323.31 810.5,-2323.31 810.5,-2271.31 1055.5,-2271.31 1055.5,-2323.31"/>
<text text-anchor="middle" x="933" y="-2311.31" font-family="Arial" font-size="10.00">Expert 67 Computation</text>
<text text-anchor="middle" x="933" y="-2300.31" font-family="Arial" font-size="10.00">GPU: 67</text>
<text text-anchor="middle" x="933" y="-2289.31" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="933" y="-2278.31" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_2&#45;&gt;expert_67 -->
<g id="edge77" class="edge">
<title>route_2&#45;&gt;expert_67</title>
<path fill="none" stroke="black" d="M1000.73,-2360.15C990.04,-2350.39 978.48,-2339.84 968,-2330.26"/>
<polygon fill="black" stroke="black" points="970.32,-2327.64 960.57,-2323.49 965.6,-2332.81 970.32,-2327.64"/>
</g>
<!-- expert_68 -->
<g id="node46" class="node">
<title>expert_68</title>
<polygon fill="lightblue" stroke="black" points="1318.5,-2323.31 1073.5,-2323.31 1073.5,-2271.31 1318.5,-2271.31 1318.5,-2323.31"/>
<text text-anchor="middle" x="1196" y="-2311.31" font-family="Arial" font-size="10.00">Expert 68 Computation</text>
<text text-anchor="middle" x="1196" y="-2300.31" font-family="Arial" font-size="10.00">GPU: 68</text>
<text text-anchor="middle" x="1196" y="-2289.31" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1196" y="-2278.31" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_2&#45;&gt;expert_68 -->
<g id="edge78" class="edge">
<title>route_2&#45;&gt;expert_68</title>
<path fill="none" stroke="black" d="M1093.91,-2361.24C1111.08,-2350.66 1129.91,-2339.05 1146.67,-2328.72"/>
<polygon fill="black" stroke="black" points="1148.55,-2331.67 1155.22,-2323.45 1144.87,-2325.71 1148.55,-2331.67"/>
</g>
<!-- expert_69 -->
<g id="node47" class="node">
<title>expert_69</title>
<polygon fill="lightblue" stroke="black" points="1581.5,-2323.31 1336.5,-2323.31 1336.5,-2271.31 1581.5,-2271.31 1581.5,-2323.31"/>
<text text-anchor="middle" x="1459" y="-2311.31" font-family="Arial" font-size="10.00">Expert 69 Computation</text>
<text text-anchor="middle" x="1459" y="-2300.31" font-family="Arial" font-size="10.00">GPU: 69</text>
<text text-anchor="middle" x="1459" y="-2289.31" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1459" y="-2278.31" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_2&#45;&gt;expert_69 -->
<g id="edge79" class="edge">
<title>route_2&#45;&gt;expert_69</title>
<path fill="none" stroke="black" d="M1153.77,-2368.64C1211.63,-2355.31 1281.72,-2339.16 1340.14,-2325.7"/>
<polygon fill="black" stroke="black" points="1341.2,-2329.05 1350.16,-2323.39 1339.63,-2322.23 1341.2,-2329.05"/>
</g>
<!-- expert_70 -->
<g id="node48" class="node">
<title>expert_70</title>
<polygon fill="lightblue" stroke="black" points="1844.5,-2323.31 1599.5,-2323.31 1599.5,-2271.31 1844.5,-2271.31 1844.5,-2323.31"/>
<text text-anchor="middle" x="1722" y="-2311.31" font-family="Arial" font-size="10.00">Expert 70 Computation</text>
<text text-anchor="middle" x="1722" y="-2300.31" font-family="Arial" font-size="10.00">GPU: 70</text>
<text text-anchor="middle" x="1722" y="-2289.31" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1722" y="-2278.31" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_2&#45;&gt;expert_70 -->
<g id="edge80" class="edge">
<title>route_2&#45;&gt;expert_70</title>
<path fill="none" stroke="black" d="M1189,-2378.02C1297.6,-2365.08 1448.13,-2345.97 1589.18,-2323.57"/>
<polygon fill="black" stroke="black" points="1589.99,-2326.99 1599.31,-2321.95 1588.89,-2320.07 1589.99,-2326.99"/>
</g>
<!-- expert_71 -->
<g id="node49" class="node">
<title>expert_71</title>
<polygon fill="lightblue" stroke="black" points="2107.5,-2323.31 1862.5,-2323.31 1862.5,-2271.31 2107.5,-2271.31 2107.5,-2323.31"/>
<text text-anchor="middle" x="1985" y="-2311.31" font-family="Arial" font-size="10.00">Expert 71 Computation</text>
<text text-anchor="middle" x="1985" y="-2300.31" font-family="Arial" font-size="10.00">GPU: 71</text>
<text text-anchor="middle" x="1985" y="-2289.31" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1985" y="-2278.31" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_2&#45;&gt;expert_71 -->
<g id="edge81" class="edge">
<title>route_2&#45;&gt;expert_71</title>
<path fill="none" stroke="black" d="M1203.84,-2385.46C1366.45,-2374.83 1622.16,-2355.09 1852.1,-2323.53"/>
<polygon fill="black" stroke="black" points="1852.91,-2326.95 1862.34,-2322.11 1851.95,-2320.01 1852.91,-2326.95"/>
</g>
<!-- qkv_proj_2 -->
<g id="node50" class="node">
<title>qkv_proj_2</title>
<polygon fill="lightblue" stroke="black" points="1174,-2235.31 904,-2235.31 904,-2183.31 1174,-2183.31 1174,-2235.31"/>
<text text-anchor="middle" x="1039" y="-2223.31" font-family="Arial" font-size="10.00">QKV Projection (TP=8)</text>
<text text-anchor="middle" x="1039" y="-2212.31" font-family="Arial" font-size="10.00">GPU: 64&#45;71</text>
<text text-anchor="middle" x="1039" y="-2201.31" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1039" y="-2190.31" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, heads=8, d_k=64]</text>
</g>
<!-- expert_64&#45;&gt;qkv_proj_2 -->
<g id="edge82" class="edge">
<title>expert_64&#45;&gt;qkv_proj_2</title>
<path fill="none" stroke="black" d="M266.54,-2272.64C269.72,-2272.18 272.88,-2271.73 276,-2271.31 490.1,-2242.56 739.94,-2225.73 893.81,-2217.27"/>
<polygon fill="black" stroke="black" points="894.01,-2220.77 903.81,-2216.73 893.63,-2213.78 894.01,-2220.77"/>
</g>
<!-- agg_2 -->
<g id="node57" class="node">
<title>agg_2</title>
<polygon fill="lightyellow" stroke="black" points="1303.24,-1554.7 882.89,-1554.7 774.76,-1450.7 1195.11,-1450.7 1303.24,-1554.7"/>
<text text-anchor="middle" x="1039" y="-1516.7" font-family="Arial" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1039" y="-1505.7" font-family="Arial" font-size="10.00">GPU: 64&#45;71</text>
<text text-anchor="middle" x="1039" y="-1494.7" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1039" y="-1483.7" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- expert_64&#45;&gt;agg_2 -->
<g id="edge96" class="edge">
<title>expert_64&#45;&gt;agg_2</title>
<path fill="none" stroke="black" d="M230.39,-2271.2C301.96,-2244.46 392,-2194.36 392,-2111.54 392,-2111.54 392,-2111.54 392,-1725.23 392,-1628.16 656.01,-1564.7 846.74,-1531.53"/>
<polygon fill="black" stroke="black" points="847.36,-1534.97 856.62,-1529.83 846.17,-1528.08 847.36,-1534.97"/>
</g>
<!-- expert_65&#45;&gt;qkv_proj_2 -->
<g id="edge83" class="edge">
<title>expert_65&#45;&gt;qkv_proj_2</title>
<path fill="none" stroke="black" d="M529.56,-2272.82C532.74,-2272.3 535.89,-2271.8 539,-2271.31 658.05,-2252.8 793.77,-2236.54 893.74,-2225.48"/>
<polygon fill="black" stroke="black" points="894.36,-2228.93 903.91,-2224.36 893.59,-2221.98 894.36,-2228.93"/>
</g>
<!-- expert_65&#45;&gt;agg_2 -->
<g id="edge97" class="edge">
<title>expert_65&#45;&gt;agg_2</title>
<path fill="none" stroke="black" d="M461.34,-2271.28C516.55,-2241.67 594,-2186.73 594,-2111.54 594,-2111.54 594,-2111.54 594,-1725.23 594,-1606.77 721.94,-1551.65 840.62,-1526.01"/>
<polygon fill="black" stroke="black" points="841.53,-1529.39 850.6,-1523.92 840.1,-1522.54 841.53,-1529.39"/>
</g>
<!-- expert_66&#45;&gt;qkv_proj_2 -->
<g id="edge84" class="edge">
<title>expert_66&#45;&gt;qkv_proj_2</title>
<path fill="none" stroke="black" d="M777.72,-2271.21C822.9,-2260.68 875.56,-2248.4 921.72,-2237.65"/>
<polygon fill="black" stroke="black" points="922.52,-2241.05 931.46,-2235.38 920.93,-2234.24 922.52,-2241.05"/>
</g>
<!-- expert_66&#45;&gt;agg_2 -->
<g id="edge98" class="edge">
<title>expert_66&#45;&gt;agg_2</title>
<path fill="none" stroke="black" d="M684.91,-2271.29C704.1,-2236.65 735,-2171.56 735,-2111.54 735,-2111.54 735,-2111.54 735,-1725.23 735,-1655.44 762.64,-1635.68 816,-1590.7 832.05,-1577.17 850.44,-1565.59 869.63,-1555.72"/>
<polygon fill="black" stroke="black" points="871.41,-1558.75 878.8,-1551.16 868.29,-1552.48 871.41,-1558.75"/>
</g>
<!-- expert_67&#45;&gt;qkv_proj_2 -->
<g id="edge85" class="edge">
<title>expert_67&#45;&gt;qkv_proj_2</title>
<path fill="none" stroke="black" d="M963.94,-2271.21C975.17,-2262.1 987.99,-2251.7 999.83,-2242.09"/>
<polygon fill="black" stroke="black" points="1002.27,-2244.62 1007.83,-2235.6 997.86,-2239.18 1002.27,-2244.62"/>
</g>
<!-- expert_67&#45;&gt;agg_2 -->
<g id="edge99" class="edge">
<title>expert_67&#45;&gt;agg_2</title>
<path fill="none" stroke="black" d="M905.31,-2271.1C872.15,-2238 821,-2176.44 821,-2111.54 821,-2111.54 821,-2111.54 821,-1725.23 821,-1664.07 811.74,-1638.42 850,-1590.7 859.09,-1579.36 869.99,-1569.44 881.9,-1560.77"/>
<polygon fill="black" stroke="black" points="884.06,-1563.53 890.3,-1554.97 880.08,-1557.77 884.06,-1563.53"/>
</g>
<!-- expert_68&#45;&gt;qkv_proj_2 -->
<g id="edge86" class="edge">
<title>expert_68&#45;&gt;qkv_proj_2</title>
<path fill="none" stroke="black" d="M1150.17,-2271.21C1132.51,-2261.54 1112.17,-2250.39 1093.76,-2240.31"/>
<polygon fill="black" stroke="black" points="1095.34,-2237.18 1084.89,-2235.45 1091.98,-2243.32 1095.34,-2237.18"/>
</g>
<!-- expert_68&#45;&gt;agg_2 -->
<g id="edge100" class="edge">
<title>expert_68&#45;&gt;agg_2</title>
<path fill="none" stroke="black" d="M1209.99,-2271.17C1228,-2236.4 1257,-2171.17 1257,-2111.54 1257,-2111.54 1257,-2111.54 1257,-1725.23 1257,-1664.07 1266.26,-1638.42 1228,-1590.7 1218.91,-1579.36 1208.01,-1569.44 1196.1,-1560.77"/>
<polygon fill="black" stroke="black" points="1197.92,-1557.77 1187.7,-1554.97 1193.94,-1563.53 1197.92,-1557.77"/>
</g>
<!-- expert_69&#45;&gt;qkv_proj_2 -->
<g id="edge87" class="edge">
<title>expert_69&#45;&gt;qkv_proj_2</title>
<path fill="none" stroke="black" d="M1336.67,-2271.26C1284.69,-2260.62 1223.98,-2248.19 1170.99,-2237.34"/>
<polygon fill="black" stroke="black" points="1171.69,-2233.91 1161.19,-2235.33 1170.29,-2240.77 1171.69,-2233.91"/>
</g>
<!-- expert_69&#45;&gt;agg_2 -->
<g id="edge101" class="edge">
<title>expert_69&#45;&gt;agg_2</title>
<path fill="none" stroke="black" d="M1445.01,-2271.17C1427,-2236.4 1398,-2171.17 1398,-2111.54 1398,-2111.54 1398,-2111.54 1398,-1725.23 1398,-1644.39 1331.25,-1592.07 1255.31,-1558.71"/>
<polygon fill="black" stroke="black" points="1256.58,-1555.45 1246.01,-1554.74 1253.83,-1561.89 1256.58,-1555.45"/>
</g>
<!-- expert_70&#45;&gt;qkv_proj_2 -->
<g id="edge88" class="edge">
<title>expert_70&#45;&gt;qkv_proj_2</title>
<path fill="none" stroke="black" d="M1599.32,-2272.6C1596.53,-2272.16 1593.75,-2271.73 1591,-2271.31 1453.45,-2250.62 1295.62,-2233.88 1184.05,-2223.2"/>
<polygon fill="black" stroke="black" points="1184.37,-2219.72 1174.08,-2222.25 1183.7,-2226.69 1184.37,-2219.72"/>
</g>
<!-- expert_70&#45;&gt;agg_2 -->
<g id="edge102" class="edge">
<title>expert_70&#45;&gt;agg_2</title>
<path fill="none" stroke="black" d="M1708.01,-2271.17C1690,-2236.4 1661,-2171.17 1661,-2111.54 1661,-2111.54 1661,-2111.54 1661,-1725.23 1661,-1644.83 1474.24,-1586.03 1305.39,-1549.29"/>
<polygon fill="black" stroke="black" points="1306.1,-1545.86 1295.58,-1547.18 1304.62,-1552.7 1306.1,-1545.86"/>
</g>
<!-- expert_71&#45;&gt;qkv_proj_2 -->
<g id="edge89" class="edge">
<title>expert_71&#45;&gt;qkv_proj_2</title>
<path fill="none" stroke="black" d="M1862.34,-2272.47C1859.54,-2272.06 1856.75,-2271.68 1854,-2271.31 1620.81,-2240.44 1347.87,-2223.97 1184.44,-2216.2"/>
<polygon fill="black" stroke="black" points="1184.48,-2212.7 1174.32,-2215.72 1184.15,-2219.69 1184.48,-2212.7"/>
</g>
<!-- expert_71&#45;&gt;agg_2 -->
<g id="edge103" class="edge">
<title>expert_71&#45;&gt;agg_2</title>
<path fill="none" stroke="black" d="M1971.01,-2271.17C1953,-2236.4 1924,-2171.17 1924,-2111.54 1924,-2111.54 1924,-2111.54 1924,-1725.23 1924,-1590.85 1535.14,-1537.28 1272.95,-1516.43"/>
<polygon fill="black" stroke="black" points="1273.14,-1512.94 1262.89,-1515.65 1272.59,-1519.92 1273.14,-1512.94"/>
</g>
<!-- qkv_comm_2 -->
<g id="node51" class="node">
<title>qkv_comm_2</title>
<ellipse fill="lightgreen" stroke="black" cx="1039" cy="-2110.54" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-2124.54" font-family="Arial" font-size="10.00">QKV AllGather (TP)</text>
<text text-anchor="middle" x="1039" y="-2113.54" font-family="Arial" font-size="10.00">GPU: 64&#45;71</text>
<text text-anchor="middle" x="1039" y="-2102.54" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, heads=8, d_k=64]</text>
<text text-anchor="middle" x="1039" y="-2091.54" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
</g>
<!-- qkv_proj_2&#45;&gt;qkv_comm_2 -->
<g id="edge90" class="edge">
<title>qkv_proj_2&#45;&gt;qkv_comm_2</title>
<path fill="none" stroke="black" d="M1039,-2183.14C1039,-2175.33 1039,-2166.47 1039,-2157.7"/>
<polygon fill="black" stroke="black" points="1042.5,-2157.52 1039,-2147.52 1035.5,-2157.52 1042.5,-2157.52"/>
</g>
<!-- attn_scores_2 -->
<g id="node52" class="node">
<title>attn_scores_2</title>
<polygon fill="lightblue" stroke="black" points="1173,-2037.77 905,-2037.77 905,-1985.77 1173,-1985.77 1173,-2037.77"/>
<text text-anchor="middle" x="1039" y="-2025.77" font-family="Arial" font-size="10.00">Attention Score Computation (SP=2)</text>
<text text-anchor="middle" x="1039" y="-2014.77" font-family="Arial" font-size="10.00">GPU: 64&#45;71</text>
<text text-anchor="middle" x="1039" y="-2003.77" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1039" y="-1992.77" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, seq_len=1024]</text>
</g>
<!-- qkv_comm_2&#45;&gt;attn_scores_2 -->
<g id="edge91" class="edge">
<title>qkv_comm_2&#45;&gt;attn_scores_2</title>
<path fill="none" stroke="black" d="M1039,-2073.51C1039,-2065.2 1039,-2056.36 1039,-2048.08"/>
<polygon fill="black" stroke="black" points="1042.5,-2047.97 1039,-2037.97 1035.5,-2047.97 1042.5,-2047.97"/>
</g>
<!-- attn_apply_2 -->
<g id="node53" class="node">
<title>attn_apply_2</title>
<polygon fill="lightblue" stroke="black" points="1176.5,-1949.77 901.5,-1949.77 901.5,-1897.77 1176.5,-1897.77 1176.5,-1949.77"/>
<text text-anchor="middle" x="1039" y="-1937.77" font-family="Arial" font-size="10.00">Attention Weight Application (SP=2)</text>
<text text-anchor="middle" x="1039" y="-1926.77" font-family="Arial" font-size="10.00">GPU: 64&#45;71</text>
<text text-anchor="middle" x="1039" y="-1915.77" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, seq_len=1024]</text>
<text text-anchor="middle" x="1039" y="-1904.77" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
</g>
<!-- attn_scores_2&#45;&gt;attn_apply_2 -->
<g id="edge92" class="edge">
<title>attn_scores_2&#45;&gt;attn_apply_2</title>
<path fill="none" stroke="black" d="M1039,-1985.44C1039,-1977.48 1039,-1968.54 1039,-1960.02"/>
<polygon fill="black" stroke="black" points="1042.5,-1959.93 1039,-1949.93 1035.5,-1959.93 1042.5,-1959.93"/>
</g>
<!-- attn_sp_comm_2 -->
<g id="node54" class="node">
<title>attn_sp_comm_2</title>
<ellipse fill="lightgreen" stroke="black" cx="1039" cy="-1825" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-1839" font-family="Arial" font-size="10.00">Attention SP AllReduce</text>
<text text-anchor="middle" x="1039" y="-1828" font-family="Arial" font-size="10.00">GPU: 64&#45;71</text>
<text text-anchor="middle" x="1039" y="-1817" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1039" y="-1806" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
</g>
<!-- attn_apply_2&#45;&gt;attn_sp_comm_2 -->
<g id="edge93" class="edge">
<title>attn_apply_2&#45;&gt;attn_sp_comm_2</title>
<path fill="none" stroke="black" d="M1039,-1897.6C1039,-1889.79 1039,-1880.93 1039,-1872.16"/>
<polygon fill="black" stroke="black" points="1042.5,-1871.98 1039,-1861.98 1035.5,-1871.98 1042.5,-1871.98"/>
</g>
<!-- out_proj_2 -->
<g id="node55" class="node">
<title>out_proj_2</title>
<polygon fill="lightblue" stroke="black" points="1175.5,-1752.23 902.5,-1752.23 902.5,-1700.23 1175.5,-1700.23 1175.5,-1752.23"/>
<text text-anchor="middle" x="1039" y="-1740.23" font-family="Arial" font-size="10.00">Output Projection (TP=8)</text>
<text text-anchor="middle" x="1039" y="-1729.23" font-family="Arial" font-size="10.00">GPU: 64&#45;71</text>
<text text-anchor="middle" x="1039" y="-1718.23" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1039" y="-1707.23" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- attn_sp_comm_2&#45;&gt;out_proj_2 -->
<g id="edge94" class="edge">
<title>attn_sp_comm_2&#45;&gt;out_proj_2</title>
<path fill="none" stroke="black" d="M1039,-1787.97C1039,-1779.66 1039,-1770.82 1039,-1762.54"/>
<polygon fill="black" stroke="black" points="1042.5,-1762.43 1039,-1752.43 1035.5,-1762.43 1042.5,-1762.43"/>
</g>
<!-- out_proj_comm_2 -->
<g id="node56" class="node">
<title>out_proj_comm_2</title>
<ellipse fill="lightgreen" stroke="black" cx="1039" cy="-1627.47" rx="180.12" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-1641.47" font-family="Arial" font-size="10.00">Output AllReduce (TP)</text>
<text text-anchor="middle" x="1039" y="-1630.47" font-family="Arial" font-size="10.00">GPU: 64&#45;71</text>
<text text-anchor="middle" x="1039" y="-1619.47" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1039" y="-1608.47" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- out_proj_2&#45;&gt;out_proj_comm_2 -->
<g id="edge95" class="edge">
<title>out_proj_2&#45;&gt;out_proj_comm_2</title>
<path fill="none" stroke="black" d="M1039,-1700.06C1039,-1692.25 1039,-1683.39 1039,-1674.62"/>
<polygon fill="black" stroke="black" points="1042.5,-1674.44 1039,-1664.44 1035.5,-1674.44 1042.5,-1674.44"/>
</g>
<!-- out_proj_comm_2&#45;&gt;agg_2 -->
<g id="edge104" class="edge">
<title>out_proj_comm_2&#45;&gt;agg_2</title>
<path fill="none" stroke="black" d="M1039,-1590.63C1039,-1582.59 1039,-1573.84 1039,-1565.09"/>
<polygon fill="black" stroke="black" points="1042.5,-1564.86 1039,-1554.86 1035.5,-1564.86 1042.5,-1564.86"/>
</g>
<!-- pipe_comm_2_3 -->
<g id="node81" class="node">
<title>pipe_comm_2_3</title>
<ellipse fill="lightgreen" stroke="black" cx="1039" cy="-1377.93" rx="180.12" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-1391.93" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="1039" y="-1380.93" font-family="Arial" font-size="10.00">GPU: 95&#45;&gt;96</text>
<text text-anchor="middle" x="1039" y="-1369.93" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1039" y="-1358.93" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- agg_2&#45;&gt;pipe_comm_2_3 -->
<g id="edge105" class="edge">
<title>agg_2&#45;&gt;pipe_comm_2_3</title>
<path fill="none" stroke="black" d="M1039,-1450.34C1039,-1441.93 1039,-1433.27 1039,-1425"/>
<polygon fill="black" stroke="black" points="1042.5,-1424.78 1039,-1414.78 1035.5,-1424.78 1042.5,-1424.78"/>
</g>
<!-- embed_3 -->
<g id="node58" class="node">
<title>embed_3</title>
<polygon fill="lightblue" stroke="black" points="1166.5,-1287.16 911.5,-1287.16 911.5,-1235.16 1166.5,-1235.16 1166.5,-1287.16"/>
<text text-anchor="middle" x="1039" y="-1275.16" font-family="Arial" font-size="10.00">Token Embedding</text>
<text text-anchor="middle" x="1039" y="-1264.16" font-family="Arial" font-size="10.00">GPU: 96&#45;103</text>
<text text-anchor="middle" x="1039" y="-1253.16" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1039" y="-1242.16" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- gate_3 -->
<g id="node59" class="node">
<title>gate_3</title>
<polygon fill="lightyellow" stroke="black" points="1296.23,-1199.16 887.03,-1199.16 781.77,-1095.16 1190.97,-1095.16 1296.23,-1199.16"/>
<text text-anchor="middle" x="1039" y="-1161.16" font-family="Arial" font-size="10.00">Gate Selection</text>
<text text-anchor="middle" x="1039" y="-1150.16" font-family="Arial" font-size="10.00">GPU: 96&#45;103</text>
<text text-anchor="middle" x="1039" y="-1139.16" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1039" y="-1128.16" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, experts=32]</text>
</g>
<!-- embed_3&#45;&gt;gate_3 -->
<g id="edge107" class="edge">
<title>embed_3&#45;&gt;gate_3</title>
<path fill="none" stroke="black" d="M1039,-1235.02C1039,-1227.34 1039,-1218.52 1039,-1209.52"/>
<polygon fill="black" stroke="black" points="1042.5,-1209.33 1039,-1199.33 1035.5,-1209.33 1042.5,-1209.33"/>
</g>
<!-- route_3 -->
<g id="node60" class="node">
<title>route_3</title>
<ellipse fill="lightgreen" stroke="black" cx="1039" cy="-1022.39" rx="171.65" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-1036.39" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="1039" y="-1025.39" font-family="Arial" font-size="10.00">GPU: 96&#45;127</text>
<text text-anchor="middle" x="1039" y="-1014.39" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, experts=32]</text>
<text text-anchor="middle" x="1039" y="-1003.39" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, experts=1]</text>
</g>
<!-- gate_3&#45;&gt;route_3 -->
<g id="edge108" class="edge">
<title>gate_3&#45;&gt;route_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1039,-1094.8C1039,-1086.39 1039,-1077.73 1039,-1069.46"/>
<polygon fill="black" stroke="black" points="1042.5,-1069.24 1039,-1059.24 1035.5,-1069.24 1042.5,-1069.24"/>
</g>
<!-- expert_96 -->
<g id="node61" class="node">
<title>expert_96</title>
<polygon fill="lightblue" stroke="black" points="267.5,-949.62 22.5,-949.62 22.5,-897.62 267.5,-897.62 267.5,-949.62"/>
<text text-anchor="middle" x="145" y="-937.62" font-family="Arial" font-size="10.00">Expert 96 Computation</text>
<text text-anchor="middle" x="145" y="-926.62" font-family="Arial" font-size="10.00">GPU: 96</text>
<text text-anchor="middle" x="145" y="-915.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="145" y="-904.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_3&#45;&gt;expert_96 -->
<g id="edge109" class="edge">
<title>route_3&#45;&gt;expert_96</title>
<path fill="none" stroke="black" d="M876.09,-1010.46C723.87,-999.23 490.18,-979.36 277.65,-949.65"/>
<polygon fill="black" stroke="black" points="277.94,-946.16 267.54,-948.23 276.96,-953.09 277.94,-946.16"/>
</g>
<!-- expert_97 -->
<g id="node62" class="node">
<title>expert_97</title>
<polygon fill="lightblue" stroke="black" points="530.5,-949.62 285.5,-949.62 285.5,-897.62 530.5,-897.62 530.5,-949.62"/>
<text text-anchor="middle" x="408" y="-937.62" font-family="Arial" font-size="10.00">Expert 97 Computation</text>
<text text-anchor="middle" x="408" y="-926.62" font-family="Arial" font-size="10.00">GPU: 97</text>
<text text-anchor="middle" x="408" y="-915.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="408" y="-904.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_3&#45;&gt;expert_97 -->
<g id="edge110" class="edge">
<title>route_3&#45;&gt;expert_97</title>
<path fill="none" stroke="black" d="M894.62,-1002.34C797.47,-989.12 666.27,-970.47 540.76,-949.71"/>
<polygon fill="black" stroke="black" points="541.01,-946.21 530.58,-948.02 539.87,-953.11 541.01,-946.21"/>
</g>
<!-- expert_98 -->
<g id="node63" class="node">
<title>expert_98</title>
<polygon fill="lightblue" stroke="black" points="793.5,-949.62 548.5,-949.62 548.5,-897.62 793.5,-897.62 793.5,-949.62"/>
<text text-anchor="middle" x="671" y="-937.62" font-family="Arial" font-size="10.00">Expert 98 Computation</text>
<text text-anchor="middle" x="671" y="-926.62" font-family="Arial" font-size="10.00">GPU: 98</text>
<text text-anchor="middle" x="671" y="-915.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="671" y="-904.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_3&#45;&gt;expert_98 -->
<g id="edge111" class="edge">
<title>route_3&#45;&gt;expert_98</title>
<path fill="none" stroke="black" d="M932.56,-993.4C883.3,-980.45 824.97,-965.11 775.91,-952.2"/>
<polygon fill="black" stroke="black" points="776.79,-948.82 766.23,-949.66 775.01,-955.59 776.79,-948.82"/>
</g>
<!-- expert_99 -->
<g id="node64" class="node">
<title>expert_99</title>
<polygon fill="lightblue" stroke="black" points="1056.5,-949.62 811.5,-949.62 811.5,-897.62 1056.5,-897.62 1056.5,-949.62"/>
<text text-anchor="middle" x="934" y="-937.62" font-family="Arial" font-size="10.00">Expert 99 Computation</text>
<text text-anchor="middle" x="934" y="-926.62" font-family="Arial" font-size="10.00">GPU: 99</text>
<text text-anchor="middle" x="934" y="-915.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="934" y="-904.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_3&#45;&gt;expert_99 -->
<g id="edge112" class="edge">
<title>route_3&#45;&gt;expert_99</title>
<path fill="none" stroke="black" d="M1001.09,-986.45C990.61,-976.79 979.28,-966.35 968.97,-956.84"/>
<polygon fill="black" stroke="black" points="971.04,-953.99 961.31,-949.79 966.29,-959.14 971.04,-953.99"/>
</g>
<!-- expert_100 -->
<g id="node65" class="node">
<title>expert_100</title>
<polygon fill="lightblue" stroke="black" points="1319.5,-949.62 1074.5,-949.62 1074.5,-897.62 1319.5,-897.62 1319.5,-949.62"/>
<text text-anchor="middle" x="1197" y="-937.62" font-family="Arial" font-size="10.00">Expert 100 Computation</text>
<text text-anchor="middle" x="1197" y="-926.62" font-family="Arial" font-size="10.00">GPU: 100</text>
<text text-anchor="middle" x="1197" y="-915.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1197" y="-904.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_3&#45;&gt;expert_100 -->
<g id="edge113" class="edge">
<title>route_3&#45;&gt;expert_100</title>
<path fill="none" stroke="black" d="M1094.26,-987.54C1111.54,-976.96 1130.49,-965.35 1147.35,-955.02"/>
<polygon fill="black" stroke="black" points="1149.26,-957.96 1155.96,-949.75 1145.61,-951.99 1149.26,-957.96"/>
</g>
<!-- expert_101 -->
<g id="node66" class="node">
<title>expert_101</title>
<polygon fill="lightblue" stroke="black" points="1582.5,-949.62 1337.5,-949.62 1337.5,-897.62 1582.5,-897.62 1582.5,-949.62"/>
<text text-anchor="middle" x="1460" y="-937.62" font-family="Arial" font-size="10.00">Expert 101 Computation</text>
<text text-anchor="middle" x="1460" y="-926.62" font-family="Arial" font-size="10.00">GPU: 101</text>
<text text-anchor="middle" x="1460" y="-915.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1460" y="-904.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_3&#45;&gt;expert_101 -->
<g id="edge114" class="edge">
<title>route_3&#45;&gt;expert_101</title>
<path fill="none" stroke="black" d="M1153.76,-995.01C1211.88,-981.65 1282.36,-965.45 1341.06,-951.96"/>
<polygon fill="black" stroke="black" points="1342.16,-955.3 1351.12,-949.64 1340.59,-948.47 1342.16,-955.3"/>
</g>
<!-- expert_102 -->
<g id="node67" class="node">
<title>expert_102</title>
<polygon fill="lightblue" stroke="black" points="1845.5,-949.62 1600.5,-949.62 1600.5,-897.62 1845.5,-897.62 1845.5,-949.62"/>
<text text-anchor="middle" x="1723" y="-937.62" font-family="Arial" font-size="10.00">Expert 102 Computation</text>
<text text-anchor="middle" x="1723" y="-926.62" font-family="Arial" font-size="10.00">GPU: 102</text>
<text text-anchor="middle" x="1723" y="-915.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1723" y="-904.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_3&#45;&gt;expert_102 -->
<g id="edge115" class="edge">
<title>route_3&#45;&gt;expert_102</title>
<path fill="none" stroke="black" d="M1188.97,-1004.37C1297.8,-991.44 1448.75,-972.32 1590.15,-949.88"/>
<polygon fill="black" stroke="black" points="1590.99,-953.29 1600.31,-948.26 1589.89,-946.38 1590.99,-953.29"/>
</g>
<!-- expert_103 -->
<g id="node68" class="node">
<title>expert_103</title>
<polygon fill="lightblue" stroke="black" points="2108.5,-949.62 1863.5,-949.62 1863.5,-897.62 2108.5,-897.62 2108.5,-949.62"/>
<text text-anchor="middle" x="1986" y="-937.62" font-family="Arial" font-size="10.00">Expert 103 Computation</text>
<text text-anchor="middle" x="1986" y="-926.62" font-family="Arial" font-size="10.00">GPU: 103</text>
<text text-anchor="middle" x="1986" y="-915.62" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1986" y="-904.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- route_3&#45;&gt;expert_103 -->
<g id="edge116" class="edge">
<title>route_3&#45;&gt;expert_103</title>
<path fill="none" stroke="black" d="M1203.66,-1011.8C1366.52,-1001.18 1622.94,-981.42 1853.42,-949.79"/>
<polygon fill="black" stroke="black" points="1853.91,-953.25 1863.34,-948.41 1852.95,-946.32 1853.91,-953.25"/>
</g>
<!-- qkv_proj_3 -->
<g id="node69" class="node">
<title>qkv_proj_3</title>
<polygon fill="lightblue" stroke="black" points="1175,-861.62 905,-861.62 905,-809.62 1175,-809.62 1175,-861.62"/>
<text text-anchor="middle" x="1040" y="-849.62" font-family="Arial" font-size="10.00">QKV Projection (TP=8)</text>
<text text-anchor="middle" x="1040" y="-838.62" font-family="Arial" font-size="10.00">GPU: 96&#45;103</text>
<text text-anchor="middle" x="1040" y="-827.62" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1040" y="-816.62" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, heads=8, d_k=64]</text>
</g>
<!-- expert_96&#45;&gt;qkv_proj_3 -->
<g id="edge117" class="edge">
<title>expert_96&#45;&gt;qkv_proj_3</title>
<path fill="none" stroke="black" d="M267.54,-898.95C270.72,-898.48 273.88,-898.04 277,-897.62 491.1,-868.87 740.94,-852.03 894.81,-843.58"/>
<polygon fill="black" stroke="black" points="895.01,-847.07 904.81,-843.03 894.63,-840.08 895.01,-847.07"/>
</g>
<!-- agg_3 -->
<g id="node76" class="node">
<title>agg_3</title>
<polygon fill="lightyellow" stroke="black" points="1304.24,-181 883.89,-181 775.76,-77 1196.11,-77 1304.24,-181"/>
<text text-anchor="middle" x="1040" y="-143" font-family="Arial" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="1040" y="-132" font-family="Arial" font-size="10.00">GPU: 96&#45;103</text>
<text text-anchor="middle" x="1040" y="-121" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1040" y="-110" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- expert_96&#45;&gt;agg_3 -->
<g id="edge131" class="edge">
<title>expert_96&#45;&gt;agg_3</title>
<path fill="none" stroke="black" d="M212.73,-897.51C275.75,-869.25 360,-816.72 360,-737.85 360,-737.85 360,-737.85 360,-351.54 360,-248.82 644.05,-186.34 844.98,-154.99"/>
<polygon fill="black" stroke="black" points="845.74,-158.41 855.09,-153.43 844.67,-151.49 845.74,-158.41"/>
</g>
<!-- expert_97&#45;&gt;qkv_proj_3 -->
<g id="edge118" class="edge">
<title>expert_97&#45;&gt;qkv_proj_3</title>
<path fill="none" stroke="black" d="M530.56,-899.12C533.74,-898.6 536.89,-898.1 540,-897.62 659.05,-879.1 794.77,-862.85 894.74,-851.79"/>
<polygon fill="black" stroke="black" points="895.36,-855.24 904.91,-850.66 894.59,-848.28 895.36,-855.24"/>
</g>
<!-- expert_97&#45;&gt;agg_3 -->
<g id="edge132" class="edge">
<title>expert_97&#45;&gt;agg_3</title>
<path fill="none" stroke="black" d="M462.34,-897.59C517.55,-867.98 595,-813.04 595,-737.85 595,-737.85 595,-737.85 595,-351.54 595,-233.08 722.94,-177.96 841.62,-152.31"/>
<polygon fill="black" stroke="black" points="842.53,-155.7 851.6,-150.22 841.1,-148.85 842.53,-155.7"/>
</g>
<!-- expert_98&#45;&gt;qkv_proj_3 -->
<g id="edge119" class="edge">
<title>expert_98&#45;&gt;qkv_proj_3</title>
<path fill="none" stroke="black" d="M778.72,-897.51C823.9,-886.98 876.56,-874.71 922.72,-863.95"/>
<polygon fill="black" stroke="black" points="923.52,-867.36 932.46,-861.68 921.93,-860.54 923.52,-867.36"/>
</g>
<!-- expert_98&#45;&gt;agg_3 -->
<g id="edge133" class="edge">
<title>expert_98&#45;&gt;agg_3</title>
<path fill="none" stroke="black" d="M685.91,-897.59C705.1,-862.95 736,-797.87 736,-737.85 736,-737.85 736,-737.85 736,-351.54 736,-281.74 763.64,-261.99 817,-217 833.05,-203.47 851.44,-191.9 870.63,-182.03"/>
<polygon fill="black" stroke="black" points="872.41,-185.06 879.8,-177.47 869.29,-178.79 872.41,-185.06"/>
</g>
<!-- expert_99&#45;&gt;qkv_proj_3 -->
<g id="edge120" class="edge">
<title>expert_99&#45;&gt;qkv_proj_3</title>
<path fill="none" stroke="black" d="M964.94,-897.51C976.17,-888.41 988.99,-878 1000.83,-868.4"/>
<polygon fill="black" stroke="black" points="1003.27,-870.92 1008.83,-861.9 998.86,-865.49 1003.27,-870.92"/>
</g>
<!-- expert_99&#45;&gt;agg_3 -->
<g id="edge134" class="edge">
<title>expert_99&#45;&gt;agg_3</title>
<path fill="none" stroke="black" d="M906.31,-897.41C873.15,-864.31 822,-802.74 822,-737.85 822,-737.85 822,-737.85 822,-351.54 822,-290.37 812.74,-264.72 851,-217 860.09,-205.67 870.99,-195.75 882.9,-187.07"/>
<polygon fill="black" stroke="black" points="885.06,-189.83 891.3,-181.27 881.08,-184.08 885.06,-189.83"/>
</g>
<!-- expert_100&#45;&gt;qkv_proj_3 -->
<g id="edge121" class="edge">
<title>expert_100&#45;&gt;qkv_proj_3</title>
<path fill="none" stroke="black" d="M1151.17,-897.51C1133.51,-887.84 1113.17,-876.7 1094.76,-866.61"/>
<polygon fill="black" stroke="black" points="1096.34,-863.49 1085.89,-861.75 1092.98,-869.63 1096.34,-863.49"/>
</g>
<!-- expert_100&#45;&gt;agg_3 -->
<g id="edge135" class="edge">
<title>expert_100&#45;&gt;agg_3</title>
<path fill="none" stroke="black" d="M1210.99,-897.48C1229,-862.71 1258,-797.47 1258,-737.85 1258,-737.85 1258,-737.85 1258,-351.54 1258,-290.37 1267.26,-264.72 1229,-217 1219.91,-205.67 1209.01,-195.75 1197.1,-187.07"/>
<polygon fill="black" stroke="black" points="1198.92,-184.08 1188.7,-181.27 1194.94,-189.83 1198.92,-184.08"/>
</g>
<!-- expert_101&#45;&gt;qkv_proj_3 -->
<g id="edge122" class="edge">
<title>expert_101&#45;&gt;qkv_proj_3</title>
<path fill="none" stroke="black" d="M1337.67,-897.57C1285.69,-886.93 1224.98,-874.49 1171.99,-863.64"/>
<polygon fill="black" stroke="black" points="1172.69,-860.22 1162.19,-861.64 1171.29,-867.07 1172.69,-860.22"/>
</g>
<!-- expert_101&#45;&gt;agg_3 -->
<g id="edge136" class="edge">
<title>expert_101&#45;&gt;agg_3</title>
<path fill="none" stroke="black" d="M1446.01,-897.48C1428,-862.71 1399,-797.47 1399,-737.85 1399,-737.85 1399,-737.85 1399,-351.54 1399,-270.69 1332.25,-218.38 1256.31,-185.02"/>
<polygon fill="black" stroke="black" points="1257.58,-181.75 1247.01,-181.04 1254.83,-188.19 1257.58,-181.75"/>
</g>
<!-- expert_102&#45;&gt;qkv_proj_3 -->
<g id="edge123" class="edge">
<title>expert_102&#45;&gt;qkv_proj_3</title>
<path fill="none" stroke="black" d="M1600.32,-898.9C1597.53,-898.46 1594.75,-898.03 1592,-897.62 1454.45,-876.92 1296.62,-860.18 1185.05,-849.51"/>
<polygon fill="black" stroke="black" points="1185.37,-846.02 1175.08,-848.56 1184.7,-852.99 1185.37,-846.02"/>
</g>
<!-- expert_102&#45;&gt;agg_3 -->
<g id="edge137" class="edge">
<title>expert_102&#45;&gt;agg_3</title>
<path fill="none" stroke="black" d="M1670.85,-897.61C1617.07,-867.76 1541,-812.37 1541,-737.85 1541,-737.85 1541,-737.85 1541,-351.54 1541,-225.48 1406.69,-170.57 1277.16,-146.92"/>
<polygon fill="black" stroke="black" points="1277.5,-143.43 1267.05,-145.14 1276.29,-150.32 1277.5,-143.43"/>
</g>
<!-- expert_103&#45;&gt;qkv_proj_3 -->
<g id="edge124" class="edge">
<title>expert_103&#45;&gt;qkv_proj_3</title>
<path fill="none" stroke="black" d="M1863.34,-898.77C1860.54,-898.37 1857.75,-897.98 1855,-897.62 1621.81,-866.74 1348.87,-850.27 1185.44,-842.5"/>
<polygon fill="black" stroke="black" points="1185.48,-839 1175.32,-842.03 1185.15,-845.99 1185.48,-839"/>
</g>
<!-- expert_103&#45;&gt;agg_3 -->
<g id="edge138" class="edge">
<title>expert_103&#45;&gt;agg_3</title>
<path fill="none" stroke="black" d="M1972.01,-897.48C1954,-862.71 1925,-797.47 1925,-737.85 1925,-737.85 1925,-737.85 1925,-351.54 1925,-217.15 1536.14,-163.58 1273.95,-142.74"/>
<polygon fill="black" stroke="black" points="1274.14,-139.24 1263.89,-141.95 1273.59,-146.22 1274.14,-139.24"/>
</g>
<!-- qkv_comm_3 -->
<g id="node70" class="node">
<title>qkv_comm_3</title>
<ellipse fill="lightgreen" stroke="black" cx="1040" cy="-736.85" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1040" y="-750.85" font-family="Arial" font-size="10.00">QKV AllGather (TP)</text>
<text text-anchor="middle" x="1040" y="-739.85" font-family="Arial" font-size="10.00">GPU: 96&#45;103</text>
<text text-anchor="middle" x="1040" y="-728.85" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, heads=8, d_k=64]</text>
<text text-anchor="middle" x="1040" y="-717.85" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
</g>
<!-- qkv_proj_3&#45;&gt;qkv_comm_3 -->
<g id="edge125" class="edge">
<title>qkv_proj_3&#45;&gt;qkv_comm_3</title>
<path fill="none" stroke="black" d="M1040,-809.44C1040,-801.64 1040,-792.77 1040,-784"/>
<polygon fill="black" stroke="black" points="1043.5,-783.82 1040,-773.82 1036.5,-783.82 1043.5,-783.82"/>
</g>
<!-- attn_scores_3 -->
<g id="node71" class="node">
<title>attn_scores_3</title>
<polygon fill="lightblue" stroke="black" points="1174,-664.08 906,-664.08 906,-612.08 1174,-612.08 1174,-664.08"/>
<text text-anchor="middle" x="1040" y="-652.08" font-family="Arial" font-size="10.00">Attention Score Computation (SP=2)</text>
<text text-anchor="middle" x="1040" y="-641.08" font-family="Arial" font-size="10.00">GPU: 96&#45;103</text>
<text text-anchor="middle" x="1040" y="-630.08" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1040" y="-619.08" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, seq_len=1024]</text>
</g>
<!-- qkv_comm_3&#45;&gt;attn_scores_3 -->
<g id="edge126" class="edge">
<title>qkv_comm_3&#45;&gt;attn_scores_3</title>
<path fill="none" stroke="black" d="M1040,-699.81C1040,-691.5 1040,-682.67 1040,-674.39"/>
<polygon fill="black" stroke="black" points="1043.5,-674.27 1040,-664.27 1036.5,-674.27 1043.5,-674.27"/>
</g>
<!-- attn_apply_3 -->
<g id="node72" class="node">
<title>attn_apply_3</title>
<polygon fill="lightblue" stroke="black" points="1177.5,-576.08 902.5,-576.08 902.5,-524.08 1177.5,-524.08 1177.5,-576.08"/>
<text text-anchor="middle" x="1040" y="-564.08" font-family="Arial" font-size="10.00">Attention Weight Application (SP=2)</text>
<text text-anchor="middle" x="1040" y="-553.08" font-family="Arial" font-size="10.00">GPU: 96&#45;103</text>
<text text-anchor="middle" x="1040" y="-542.08" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, seq_len=1024]</text>
<text text-anchor="middle" x="1040" y="-531.08" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
</g>
<!-- attn_scores_3&#45;&gt;attn_apply_3 -->
<g id="edge127" class="edge">
<title>attn_scores_3&#45;&gt;attn_apply_3</title>
<path fill="none" stroke="black" d="M1040,-611.74C1040,-603.78 1040,-594.84 1040,-586.32"/>
<polygon fill="black" stroke="black" points="1043.5,-586.23 1040,-576.23 1036.5,-586.23 1043.5,-586.23"/>
</g>
<!-- attn_sp_comm_3 -->
<g id="node73" class="node">
<title>attn_sp_comm_3</title>
<ellipse fill="lightgreen" stroke="black" cx="1040" cy="-451.31" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1040" y="-465.31" font-family="Arial" font-size="10.00">Attention SP AllReduce</text>
<text text-anchor="middle" x="1040" y="-454.31" font-family="Arial" font-size="10.00">GPU: 96&#45;103</text>
<text text-anchor="middle" x="1040" y="-443.31" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1040" y="-432.31" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
</g>
<!-- attn_apply_3&#45;&gt;attn_sp_comm_3 -->
<g id="edge128" class="edge">
<title>attn_apply_3&#45;&gt;attn_sp_comm_3</title>
<path fill="none" stroke="black" d="M1040,-523.91C1040,-516.1 1040,-507.23 1040,-498.46"/>
<polygon fill="black" stroke="black" points="1043.5,-498.29 1040,-488.29 1036.5,-498.29 1043.5,-498.29"/>
</g>
<!-- out_proj_3 -->
<g id="node74" class="node">
<title>out_proj_3</title>
<polygon fill="lightblue" stroke="black" points="1176.5,-378.54 903.5,-378.54 903.5,-326.54 1176.5,-326.54 1176.5,-378.54"/>
<text text-anchor="middle" x="1040" y="-366.54" font-family="Arial" font-size="10.00">Output Projection (TP=8)</text>
<text text-anchor="middle" x="1040" y="-355.54" font-family="Arial" font-size="10.00">GPU: 96&#45;103</text>
<text text-anchor="middle" x="1040" y="-344.54" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, heads=64, d_k=64]</text>
<text text-anchor="middle" x="1040" y="-333.54" font-family="Arial" font-size="10.00">Output: [batch_size=16, seq_len=2048, hidden=512]</text>
</g>
<!-- attn_sp_comm_3&#45;&gt;out_proj_3 -->
<g id="edge129" class="edge">
<title>attn_sp_comm_3&#45;&gt;out_proj_3</title>
<path fill="none" stroke="black" d="M1040,-414.28C1040,-405.96 1040,-397.13 1040,-388.85"/>
<polygon fill="black" stroke="black" points="1043.5,-388.74 1040,-378.74 1036.5,-388.74 1043.5,-388.74"/>
</g>
<!-- out_proj_comm_3 -->
<g id="node75" class="node">
<title>out_proj_comm_3</title>
<ellipse fill="lightgreen" stroke="black" cx="1040" cy="-253.77" rx="180.12" ry="36.54"/>
<text text-anchor="middle" x="1040" y="-267.77" font-family="Arial" font-size="10.00">Output AllReduce (TP)</text>
<text text-anchor="middle" x="1040" y="-256.77" font-family="Arial" font-size="10.00">GPU: 96&#45;103</text>
<text text-anchor="middle" x="1040" y="-245.77" font-family="Arial" font-size="10.00">Input: [batch_size=16, seq_len=2048, hidden=512]</text>
<text text-anchor="middle" x="1040" y="-234.77" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- out_proj_3&#45;&gt;out_proj_comm_3 -->
<g id="edge130" class="edge">
<title>out_proj_3&#45;&gt;out_proj_comm_3</title>
<path fill="none" stroke="black" d="M1040,-326.37C1040,-318.56 1040,-309.69 1040,-300.92"/>
<polygon fill="black" stroke="black" points="1043.5,-300.75 1040,-290.75 1036.5,-300.75 1043.5,-300.75"/>
</g>
<!-- out_proj_comm_3&#45;&gt;agg_3 -->
<g id="edge139" class="edge">
<title>out_proj_comm_3&#45;&gt;agg_3</title>
<path fill="none" stroke="black" d="M1040,-216.93C1040,-208.89 1040,-200.14 1040,-191.39"/>
<polygon fill="black" stroke="black" points="1043.5,-191.17 1040,-181.17 1036.5,-191.17 1043.5,-191.17"/>
</g>
<!-- output -->
<g id="node78" class="node">
<title>output</title>
<polygon fill="lightgray" stroke="black" points="1183.5,-41 896.5,-41 896.5,0 1183.5,0 1183.5,-41"/>
<text text-anchor="middle" x="1040" y="-29" font-family="Arial" font-size="10.00">Output</text>
<text text-anchor="middle" x="1040" y="-18" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1040" y="-7" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, vocab_size=128000]</text>
</g>
<!-- agg_3&#45;&gt;output -->
<g id="edge140" class="edge">
<title>agg_3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1040,-76.93C1040,-68.2 1040,-59.39 1040,-51.44"/>
<polygon fill="black" stroke="black" points="1043.5,-51.22 1040,-41.22 1036.5,-51.22 1043.5,-51.22"/>
</g>
<!-- input -->
<g id="node77" class="node">
<title>input</title>
<polygon fill="lightgray" stroke="black" points="1186.5,-5503.24 931.5,-5503.24 931.5,-5462.24 1186.5,-5462.24 1186.5,-5503.24"/>
<text text-anchor="middle" x="1059" y="-5491.24" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="1059" y="-5480.24" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=2048, hidden=4096]</text>
<text text-anchor="middle" x="1059" y="-5469.24" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=2048, hidden=4096]</text>
</g>
<!-- input&#45;&gt;embed_0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;embed_0</title>
<path fill="none" stroke="black" d="M1059,-5461.81C1059,-5449.42 1059,-5433.13 1059,-5418.59"/>
<polygon fill="black" stroke="black" points="1062.5,-5418.41 1059,-5408.41 1055.5,-5418.41 1062.5,-5418.41"/>
</g>
<!-- pipe_comm_0_1&#45;&gt;embed_1 -->
<g id="edge36" class="edge">
<title>pipe_comm_0_1&#45;&gt;embed_1</title>
<path fill="none" stroke="black" d="M1034,-4088.32C1034,-4074.49 1034,-4058.72 1034,-4044.95"/>
<polygon fill="black" stroke="black" points="1037.5,-4044.87 1034,-4034.87 1030.5,-4044.87 1037.5,-4044.87"/>
</g>
<!-- pipe_comm_1_2&#45;&gt;embed_2 -->
<g id="edge71" class="edge">
<title>pipe_comm_1_2&#45;&gt;embed_2</title>
<path fill="none" stroke="black" d="M1039,-2714.62C1039,-2700.79 1039,-2685.03 1039,-2671.26"/>
<polygon fill="black" stroke="black" points="1042.5,-2671.18 1039,-2661.18 1035.5,-2671.18 1042.5,-2671.18"/>
</g>
<!-- pipe_comm_2_3&#45;&gt;embed_3 -->
<g id="edge106" class="edge">
<title>pipe_comm_2_3&#45;&gt;embed_3</title>
<path fill="none" stroke="black" d="M1039,-1340.93C1039,-1327.1 1039,-1311.33 1039,-1297.56"/>
<polygon fill="black" stroke="black" points="1042.5,-1297.48 1039,-1287.48 1035.5,-1297.48 1042.5,-1297.48"/>
</g>
</g>
</svg>
