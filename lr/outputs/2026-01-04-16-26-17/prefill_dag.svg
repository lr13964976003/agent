<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1440pt" height="1135pt"
 viewBox="0.00 0.00 1440.00 1135.27" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.41 0.41) rotate(0) translate(4 2775.83)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2775.83 3522,-2775.83 3522,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="none" stroke="black" d="M2648,-1823.67C2648,-1823.67 3498,-1823.67 3498,-1823.67 3504,-1823.67 3510,-1829.67 3510,-1835.67 3510,-1835.67 3510,-2636.67 3510,-2636.67 3510,-2642.67 3504,-2648.67 3498,-2648.67 3498,-2648.67 2648,-2648.67 2648,-2648.67 2642,-2648.67 2636,-2642.67 2636,-2636.67 2636,-2636.67 2636,-1835.67 2636,-1835.67 2636,-1829.67 2642,-1823.67 2648,-1823.67"/>
<text text-anchor="middle" x="3073" y="-2633.47" font-family="Times,serif" font-size="14.00">Stage 0: Layers 0&#45;23</text>
<text text-anchor="middle" x="3073" y="-2618.47" font-family="Times,serif" font-size="14.00">GPUs 0&#45;8</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage1</title>
<path fill="none" stroke="black" d="M1772,-1257.5C1772,-1257.5 3498,-1257.5 3498,-1257.5 3504,-1257.5 3510,-1263.5 3510,-1269.5 3510,-1269.5 3510,-1659.5 3510,-1659.5 3510,-1665.5 3504,-1671.5 3498,-1671.5 3498,-1671.5 1772,-1671.5 1772,-1671.5 1766,-1671.5 1760,-1665.5 1760,-1659.5 1760,-1659.5 1760,-1269.5 1760,-1269.5 1760,-1263.5 1766,-1257.5 1772,-1257.5"/>
<text text-anchor="middle" x="2635" y="-1656.3" font-family="Times,serif" font-size="14.00">Stage 1: Layers 24&#45;47</text>
<text text-anchor="middle" x="2635" y="-1641.3" font-family="Times,serif" font-size="14.00">GPUs 9&#45;17</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_stage2</title>
<path fill="none" stroke="black" d="M896,-691.33C896,-691.33 2622,-691.33 2622,-691.33 2628,-691.33 2634,-697.33 2634,-703.33 2634,-703.33 2634,-1093.33 2634,-1093.33 2634,-1099.33 2628,-1105.33 2622,-1105.33 2622,-1105.33 896,-1105.33 896,-1105.33 890,-1105.33 884,-1099.33 884,-1093.33 884,-1093.33 884,-703.33 884,-703.33 884,-697.33 890,-691.33 896,-691.33"/>
<text text-anchor="middle" x="1759" y="-1090.13" font-family="Times,serif" font-size="14.00">Stage 2: Layers 48&#45;71</text>
<text text-anchor="middle" x="1759" y="-1075.13" font-family="Times,serif" font-size="14.00">GPUs 18&#45;26</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage3</title>
<path fill="none" stroke="black" d="M20,-125.17C20,-125.17 1746,-125.17 1746,-125.17 1752,-125.17 1758,-131.17 1758,-137.17 1758,-137.17 1758,-527.17 1758,-527.17 1758,-533.17 1752,-539.17 1746,-539.17 1746,-539.17 20,-539.17 20,-539.17 14,-539.17 8,-533.17 8,-527.17 8,-527.17 8,-137.17 8,-137.17 8,-131.17 14,-125.17 20,-125.17"/>
<text text-anchor="middle" x="883" y="-523.97" font-family="Times,serif" font-size="14.00">Stage 3: Layers 72&#45;93</text>
<text text-anchor="middle" x="883" y="-508.97" font-family="Times,serif" font-size="14.00">GPUs 27&#45;34</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgray" stroke="black" cx="3073" cy="-2723.75" rx="301.46" ry="48.17"/>
<text text-anchor="middle" x="3073" y="-2742.55" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="3073" y="-2727.55" font-family="Times,serif" font-size="14.00">GPU: 0&#45;34</text>
<text text-anchor="middle" x="3073" y="-2712.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-2697.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage0_layer0_attn -->
<g id="node2" class="node">
<title>stage0_layer0_attn</title>
<polygon fill="lightblue" stroke="black" points="3286,-2602.67 2860,-2602.67 2860,-2534.67 3286,-2534.67 3286,-2602.67"/>
<text text-anchor="middle" x="3073" y="-2587.47" font-family="Times,serif" font-size="14.00">Layer 0 Attention</text>
<text text-anchor="middle" x="3073" y="-2572.47" font-family="Times,serif" font-size="14.00">GPU: 0&#45;8</text>
<text text-anchor="middle" x="3073" y="-2557.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-2542.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- input&#45;&gt;stage0_layer0_attn -->
<g id="edge1" class="edge">
<title>input&#45;&gt;stage0_layer0_attn</title>
<path fill="none" stroke="black" d="M3073,-2675.57C3073,-2655.61 3073,-2632.52 3073,-2613"/>
<polygon fill="black" stroke="black" points="3076.5,-2612.86 3073,-2602.86 3069.5,-2612.86 3076.5,-2612.86"/>
</g>
<!-- stage0_layer0_gate -->
<g id="node3" class="node">
<title>stage0_layer0_gate</title>
<polygon fill="orange" stroke="black" points="3502.43,-2497.67 2819.3,-2497.67 2643.57,-2361.67 3326.7,-2361.67 3502.43,-2497.67"/>
<text text-anchor="middle" x="3073" y="-2448.47" font-family="Times,serif" font-size="14.00">Gate Selection (Top&#45;8)</text>
<text text-anchor="middle" x="3073" y="-2433.47" font-family="Times,serif" font-size="14.00">GPU: 0&#45;8</text>
<text text-anchor="middle" x="3073" y="-2418.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-2403.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, top_k=8]</text>
</g>
<!-- stage0_layer0_attn&#45;&gt;stage0_layer0_gate -->
<g id="edge2" class="edge">
<title>stage0_layer0_attn&#45;&gt;stage0_layer0_gate</title>
<path fill="none" stroke="black" d="M3073,-2534.5C3073,-2526.36 3073,-2517.3 3073,-2508.02"/>
<polygon fill="black" stroke="black" points="3076.5,-2507.9 3073,-2497.9 3069.5,-2507.9 3076.5,-2507.9"/>
</g>
<!-- stage0_layer0_moe -->
<g id="node4" class="node">
<title>stage0_layer0_moe</title>
<polygon fill="lightblue" stroke="black" points="3286,-2310.67 2860,-2310.67 2860,-2242.67 3286,-2242.67 3286,-2310.67"/>
<text text-anchor="middle" x="3073" y="-2295.47" font-family="Times,serif" font-size="14.00">Layer 0 MoE (128 experts)</text>
<text text-anchor="middle" x="3073" y="-2280.47" font-family="Times,serif" font-size="14.00">GPU: 0&#45;8</text>
<text text-anchor="middle" x="3073" y="-2265.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-2250.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_moe -->
<g id="edge3" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3073,-2361.56C3073,-2347.77 3073,-2333.61 3073,-2320.94"/>
<polygon fill="black" stroke="black" points="3076.5,-2320.69 3073,-2310.69 3069.5,-2320.69 3076.5,-2320.69"/>
<text text-anchor="middle" x="3152.5" y="-2332.47" font-family="Times,serif" font-size="14.00">Top&#45;8 expert selection</text>
</g>
<!-- stage0_layer23_attn -->
<g id="node5" class="node">
<title>stage0_layer23_attn</title>
<polygon fill="lightblue" stroke="black" points="3286,-2191.67 2860,-2191.67 2860,-2123.67 3286,-2123.67 3286,-2191.67"/>
<text text-anchor="middle" x="3073" y="-2176.47" font-family="Times,serif" font-size="14.00">Layer 23 Attention</text>
<text text-anchor="middle" x="3073" y="-2161.47" font-family="Times,serif" font-size="14.00">GPU: 0&#45;8</text>
<text text-anchor="middle" x="3073" y="-2146.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-2131.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage0_layer0_moe&#45;&gt;stage0_layer23_attn -->
<g id="edge4" class="edge">
<title>stage0_layer0_moe&#45;&gt;stage0_layer23_attn</title>
<path fill="none" stroke="black" d="M3073,-2242.45C3073,-2229.98 3073,-2215.6 3073,-2202.32"/>
<polygon fill="black" stroke="black" points="3076.5,-2201.96 3073,-2191.96 3069.5,-2201.96 3076.5,-2201.96"/>
<text text-anchor="middle" x="3115.5" y="-2213.47" font-family="Times,serif" font-size="14.00">Layers 1&#45;22</text>
</g>
<!-- stage0_layer23_gate -->
<g id="node6" class="node">
<title>stage0_layer23_gate</title>
<polygon fill="orange" stroke="black" points="3502.43,-2086.67 2819.3,-2086.67 2643.57,-1950.67 3326.7,-1950.67 3502.43,-2086.67"/>
<text text-anchor="middle" x="3073" y="-2037.47" font-family="Times,serif" font-size="14.00">Gate Selection (Top&#45;8)</text>
<text text-anchor="middle" x="3073" y="-2022.47" font-family="Times,serif" font-size="14.00">GPU: 0&#45;8</text>
<text text-anchor="middle" x="3073" y="-2007.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-1992.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, top_k=8]</text>
</g>
<!-- stage0_layer23_attn&#45;&gt;stage0_layer23_gate -->
<g id="edge5" class="edge">
<title>stage0_layer23_attn&#45;&gt;stage0_layer23_gate</title>
<path fill="none" stroke="black" d="M3073,-2123.5C3073,-2115.36 3073,-2106.3 3073,-2097.02"/>
<polygon fill="black" stroke="black" points="3076.5,-2096.9 3073,-2086.9 3069.5,-2096.9 3076.5,-2096.9"/>
</g>
<!-- stage0_layer23_moe -->
<g id="node7" class="node">
<title>stage0_layer23_moe</title>
<polygon fill="lightblue" stroke="black" points="3286,-1899.67 2860,-1899.67 2860,-1831.67 3286,-1831.67 3286,-1899.67"/>
<text text-anchor="middle" x="3073" y="-1884.47" font-family="Times,serif" font-size="14.00">Layer 23 MoE (128 experts)</text>
<text text-anchor="middle" x="3073" y="-1869.47" font-family="Times,serif" font-size="14.00">GPU: 0&#45;8</text>
<text text-anchor="middle" x="3073" y="-1854.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-1839.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage0_layer23_gate&#45;&gt;stage0_layer23_moe -->
<g id="edge6" class="edge">
<title>stage0_layer23_gate&#45;&gt;stage0_layer23_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3073,-1950.56C3073,-1936.77 3073,-1922.61 3073,-1909.94"/>
<polygon fill="black" stroke="black" points="3076.5,-1909.69 3073,-1899.69 3069.5,-1909.69 3076.5,-1909.69"/>
<text text-anchor="middle" x="3152.5" y="-1921.47" font-family="Times,serif" font-size="14.00">Top&#45;8 expert selection</text>
</g>
<!-- comm_0_1 -->
<g id="node27" class="node">
<title>comm_0_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="3073" cy="-1746.58" rx="301.46" ry="48.17"/>
<text text-anchor="middle" x="3073" y="-1765.38" font-family="Times,serif" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="3073" y="-1750.38" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;8 → 9&#45;17</text>
<text text-anchor="middle" x="3073" y="-1735.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-1720.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage0_layer23_moe&#45;&gt;comm_0_1 -->
<g id="edge7" class="edge">
<title>stage0_layer23_moe&#45;&gt;comm_0_1</title>
<path fill="none" stroke="black" d="M3073,-1831.43C3073,-1823.18 3073,-1814.09 3073,-1805.04"/>
<polygon fill="black" stroke="black" points="3076.5,-1804.89 3073,-1794.89 3069.5,-1804.89 3076.5,-1804.89"/>
</g>
<!-- stage1_layer24_attn -->
<g id="node8" class="node">
<title>stage1_layer24_attn</title>
<polygon fill="lightgreen" stroke="black" points="3286,-1625.5 2860,-1625.5 2860,-1557.5 3286,-1557.5 3286,-1625.5"/>
<text text-anchor="middle" x="3073" y="-1610.3" font-family="Times,serif" font-size="14.00">Layer 24 Attention</text>
<text text-anchor="middle" x="3073" y="-1595.3" font-family="Times,serif" font-size="14.00">GPU: 9&#45;17</text>
<text text-anchor="middle" x="3073" y="-1580.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-1565.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage1_layer24_gate -->
<g id="node9" class="node">
<title>stage1_layer24_gate</title>
<polygon fill="orange" stroke="black" points="3502.43,-1520.5 2819.3,-1520.5 2643.57,-1384.5 3326.7,-1384.5 3502.43,-1520.5"/>
<text text-anchor="middle" x="3073" y="-1471.3" font-family="Times,serif" font-size="14.00">Gate Selection (Top&#45;8)</text>
<text text-anchor="middle" x="3073" y="-1456.3" font-family="Times,serif" font-size="14.00">GPU: 9&#45;17</text>
<text text-anchor="middle" x="3073" y="-1441.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-1426.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, top_k=8]</text>
</g>
<!-- stage1_layer24_attn&#45;&gt;stage1_layer24_gate -->
<g id="edge9" class="edge">
<title>stage1_layer24_attn&#45;&gt;stage1_layer24_gate</title>
<path fill="none" stroke="black" d="M3073,-1557.34C3073,-1549.19 3073,-1540.13 3073,-1530.86"/>
<polygon fill="black" stroke="black" points="3076.5,-1530.73 3073,-1520.73 3069.5,-1530.73 3076.5,-1530.73"/>
</g>
<!-- stage1_layer24_moe -->
<g id="node10" class="node">
<title>stage1_layer24_moe</title>
<polygon fill="lightgreen" stroke="black" points="3286,-1333.5 2860,-1333.5 2860,-1265.5 3286,-1265.5 3286,-1333.5"/>
<text text-anchor="middle" x="3073" y="-1318.3" font-family="Times,serif" font-size="14.00">Layer 24 MoE (128 experts)</text>
<text text-anchor="middle" x="3073" y="-1303.3" font-family="Times,serif" font-size="14.00">GPU: 9&#45;17</text>
<text text-anchor="middle" x="3073" y="-1288.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="3073" y="-1273.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage1_layer24_gate&#45;&gt;stage1_layer24_moe -->
<g id="edge10" class="edge">
<title>stage1_layer24_gate&#45;&gt;stage1_layer24_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3073,-1384.39C3073,-1370.61 3073,-1356.44 3073,-1343.77"/>
<polygon fill="black" stroke="black" points="3076.5,-1343.52 3073,-1333.52 3069.5,-1343.52 3076.5,-1343.52"/>
<text text-anchor="middle" x="3152.5" y="-1355.3" font-family="Times,serif" font-size="14.00">Top&#45;8 expert selection</text>
</g>
<!-- stage1_layer47_attn -->
<g id="node11" class="node">
<title>stage1_layer47_attn</title>
<polygon fill="lightgreen" stroke="black" points="2410,-1625.5 1984,-1625.5 1984,-1557.5 2410,-1557.5 2410,-1625.5"/>
<text text-anchor="middle" x="2197" y="-1610.3" font-family="Times,serif" font-size="14.00">Layer 47 Attention</text>
<text text-anchor="middle" x="2197" y="-1595.3" font-family="Times,serif" font-size="14.00">GPU: 9&#45;17</text>
<text text-anchor="middle" x="2197" y="-1580.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="2197" y="-1565.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage1_layer47_gate -->
<g id="node12" class="node">
<title>stage1_layer47_gate</title>
<polygon fill="orange" stroke="black" points="2626.43,-1520.5 1943.3,-1520.5 1767.57,-1384.5 2450.7,-1384.5 2626.43,-1520.5"/>
<text text-anchor="middle" x="2197" y="-1471.3" font-family="Times,serif" font-size="14.00">Gate Selection (Top&#45;8)</text>
<text text-anchor="middle" x="2197" y="-1456.3" font-family="Times,serif" font-size="14.00">GPU: 9&#45;17</text>
<text text-anchor="middle" x="2197" y="-1441.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="2197" y="-1426.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, top_k=8]</text>
</g>
<!-- stage1_layer47_attn&#45;&gt;stage1_layer47_gate -->
<g id="edge11" class="edge">
<title>stage1_layer47_attn&#45;&gt;stage1_layer47_gate</title>
<path fill="none" stroke="black" d="M2197,-1557.34C2197,-1549.19 2197,-1540.13 2197,-1530.86"/>
<polygon fill="black" stroke="black" points="2200.5,-1530.73 2197,-1520.73 2193.5,-1530.73 2200.5,-1530.73"/>
</g>
<!-- stage1_layer47_moe -->
<g id="node13" class="node">
<title>stage1_layer47_moe</title>
<polygon fill="lightgreen" stroke="black" points="2410,-1333.5 1984,-1333.5 1984,-1265.5 2410,-1265.5 2410,-1333.5"/>
<text text-anchor="middle" x="2197" y="-1318.3" font-family="Times,serif" font-size="14.00">Layer 47 MoE (128 experts)</text>
<text text-anchor="middle" x="2197" y="-1303.3" font-family="Times,serif" font-size="14.00">GPU: 9&#45;17</text>
<text text-anchor="middle" x="2197" y="-1288.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="2197" y="-1273.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage1_layer47_gate&#45;&gt;stage1_layer47_moe -->
<g id="edge12" class="edge">
<title>stage1_layer47_gate&#45;&gt;stage1_layer47_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2197,-1384.39C2197,-1370.61 2197,-1356.44 2197,-1343.77"/>
<polygon fill="black" stroke="black" points="2200.5,-1343.52 2197,-1333.52 2193.5,-1343.52 2200.5,-1343.52"/>
<text text-anchor="middle" x="2276.5" y="-1355.3" font-family="Times,serif" font-size="14.00">Top&#45;8 expert selection</text>
</g>
<!-- comm_1_2 -->
<g id="node28" class="node">
<title>comm_1_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2197" cy="-1180.42" rx="301.46" ry="48.17"/>
<text text-anchor="middle" x="2197" y="-1199.22" font-family="Times,serif" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="2197" y="-1184.22" font-family="Times,serif" font-size="14.00">GPUs: 9&#45;17 → 18&#45;26</text>
<text text-anchor="middle" x="2197" y="-1169.22" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="2197" y="-1154.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage1_layer47_moe&#45;&gt;comm_1_2 -->
<g id="edge13" class="edge">
<title>stage1_layer47_moe&#45;&gt;comm_1_2</title>
<path fill="none" stroke="black" d="M2197,-1265.26C2197,-1257.01 2197,-1247.93 2197,-1238.88"/>
<polygon fill="black" stroke="black" points="2200.5,-1238.72 2197,-1228.72 2193.5,-1238.72 2200.5,-1238.72"/>
</g>
<!-- stage2_layer48_attn -->
<g id="node14" class="node">
<title>stage2_layer48_attn</title>
<polygon fill="lightyellow" stroke="black" points="2410,-1059.33 1984,-1059.33 1984,-991.33 2410,-991.33 2410,-1059.33"/>
<text text-anchor="middle" x="2197" y="-1044.13" font-family="Times,serif" font-size="14.00">Layer 48 Attention</text>
<text text-anchor="middle" x="2197" y="-1029.13" font-family="Times,serif" font-size="14.00">GPU: 18&#45;26</text>
<text text-anchor="middle" x="2197" y="-1014.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="2197" y="-999.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage2_layer48_gate -->
<g id="node15" class="node">
<title>stage2_layer48_gate</title>
<polygon fill="orange" stroke="black" points="2626.43,-954.33 1943.3,-954.33 1767.57,-818.33 2450.7,-818.33 2626.43,-954.33"/>
<text text-anchor="middle" x="2197" y="-905.13" font-family="Times,serif" font-size="14.00">Gate Selection (Top&#45;8)</text>
<text text-anchor="middle" x="2197" y="-890.13" font-family="Times,serif" font-size="14.00">GPU: 18&#45;26</text>
<text text-anchor="middle" x="2197" y="-875.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="2197" y="-860.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, top_k=8]</text>
</g>
<!-- stage2_layer48_attn&#45;&gt;stage2_layer48_gate -->
<g id="edge15" class="edge">
<title>stage2_layer48_attn&#45;&gt;stage2_layer48_gate</title>
<path fill="none" stroke="black" d="M2197,-991.17C2197,-983.03 2197,-973.97 2197,-964.69"/>
<polygon fill="black" stroke="black" points="2200.5,-964.57 2197,-954.57 2193.5,-964.57 2200.5,-964.57"/>
</g>
<!-- stage2_layer48_moe -->
<g id="node16" class="node">
<title>stage2_layer48_moe</title>
<polygon fill="lightyellow" stroke="black" points="2410,-767.33 1984,-767.33 1984,-699.33 2410,-699.33 2410,-767.33"/>
<text text-anchor="middle" x="2197" y="-752.13" font-family="Times,serif" font-size="14.00">Layer 48 MoE (128 experts)</text>
<text text-anchor="middle" x="2197" y="-737.13" font-family="Times,serif" font-size="14.00">GPU: 18&#45;26</text>
<text text-anchor="middle" x="2197" y="-722.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="2197" y="-707.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage2_layer48_gate&#45;&gt;stage2_layer48_moe -->
<g id="edge16" class="edge">
<title>stage2_layer48_gate&#45;&gt;stage2_layer48_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2197,-818.22C2197,-804.44 2197,-790.28 2197,-777.61"/>
<polygon fill="black" stroke="black" points="2200.5,-777.35 2197,-767.35 2193.5,-777.35 2200.5,-777.35"/>
<text text-anchor="middle" x="2276.5" y="-789.13" font-family="Times,serif" font-size="14.00">Top&#45;8 expert selection</text>
</g>
<!-- stage2_layer71_attn -->
<g id="node17" class="node">
<title>stage2_layer71_attn</title>
<polygon fill="lightyellow" stroke="black" points="1534,-1059.33 1108,-1059.33 1108,-991.33 1534,-991.33 1534,-1059.33"/>
<text text-anchor="middle" x="1321" y="-1044.13" font-family="Times,serif" font-size="14.00">Layer 71 Attention</text>
<text text-anchor="middle" x="1321" y="-1029.13" font-family="Times,serif" font-size="14.00">GPU: 18&#45;26</text>
<text text-anchor="middle" x="1321" y="-1014.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="1321" y="-999.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage2_layer71_gate -->
<g id="node18" class="node">
<title>stage2_layer71_gate</title>
<polygon fill="orange" stroke="black" points="1750.43,-954.33 1067.3,-954.33 891.57,-818.33 1574.7,-818.33 1750.43,-954.33"/>
<text text-anchor="middle" x="1321" y="-905.13" font-family="Times,serif" font-size="14.00">Gate Selection (Top&#45;8)</text>
<text text-anchor="middle" x="1321" y="-890.13" font-family="Times,serif" font-size="14.00">GPU: 18&#45;26</text>
<text text-anchor="middle" x="1321" y="-875.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="1321" y="-860.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, top_k=8]</text>
</g>
<!-- stage2_layer71_attn&#45;&gt;stage2_layer71_gate -->
<g id="edge17" class="edge">
<title>stage2_layer71_attn&#45;&gt;stage2_layer71_gate</title>
<path fill="none" stroke="black" d="M1321,-991.17C1321,-983.03 1321,-973.97 1321,-964.69"/>
<polygon fill="black" stroke="black" points="1324.5,-964.57 1321,-954.57 1317.5,-964.57 1324.5,-964.57"/>
</g>
<!-- stage2_layer71_moe -->
<g id="node19" class="node">
<title>stage2_layer71_moe</title>
<polygon fill="lightyellow" stroke="black" points="1534,-767.33 1108,-767.33 1108,-699.33 1534,-699.33 1534,-767.33"/>
<text text-anchor="middle" x="1321" y="-752.13" font-family="Times,serif" font-size="14.00">Layer 71 MoE (128 experts)</text>
<text text-anchor="middle" x="1321" y="-737.13" font-family="Times,serif" font-size="14.00">GPU: 18&#45;26</text>
<text text-anchor="middle" x="1321" y="-722.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="1321" y="-707.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage2_layer71_gate&#45;&gt;stage2_layer71_moe -->
<g id="edge18" class="edge">
<title>stage2_layer71_gate&#45;&gt;stage2_layer71_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1321,-818.22C1321,-804.44 1321,-790.28 1321,-777.61"/>
<polygon fill="black" stroke="black" points="1324.5,-777.35 1321,-767.35 1317.5,-777.35 1324.5,-777.35"/>
<text text-anchor="middle" x="1400.5" y="-789.13" font-family="Times,serif" font-size="14.00">Top&#45;8 expert selection</text>
</g>
<!-- comm_2_3 -->
<g id="node29" class="node">
<title>comm_2_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1321" cy="-614.25" rx="301.46" ry="48.17"/>
<text text-anchor="middle" x="1321" y="-633.05" font-family="Times,serif" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="1321" y="-618.05" font-family="Times,serif" font-size="14.00">GPUs: 18&#45;26 → 27&#45;34</text>
<text text-anchor="middle" x="1321" y="-603.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="1321" y="-588.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage2_layer71_moe&#45;&gt;comm_2_3 -->
<g id="edge19" class="edge">
<title>stage2_layer71_moe&#45;&gt;comm_2_3</title>
<path fill="none" stroke="black" d="M1321,-699.09C1321,-690.84 1321,-681.76 1321,-672.71"/>
<polygon fill="black" stroke="black" points="1324.5,-672.56 1321,-662.56 1317.5,-672.56 1324.5,-672.56"/>
</g>
<!-- stage3_layer72_attn -->
<g id="node20" class="node">
<title>stage3_layer72_attn</title>
<polygon fill="lightcoral" stroke="black" points="1534,-493.17 1108,-493.17 1108,-425.17 1534,-425.17 1534,-493.17"/>
<text text-anchor="middle" x="1321" y="-477.97" font-family="Times,serif" font-size="14.00">Layer 72 Attention</text>
<text text-anchor="middle" x="1321" y="-462.97" font-family="Times,serif" font-size="14.00">GPU: 27&#45;34</text>
<text text-anchor="middle" x="1321" y="-447.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="1321" y="-432.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage3_layer72_gate -->
<g id="node21" class="node">
<title>stage3_layer72_gate</title>
<polygon fill="orange" stroke="black" points="1750.43,-388.17 1067.3,-388.17 891.57,-252.17 1574.7,-252.17 1750.43,-388.17"/>
<text text-anchor="middle" x="1321" y="-338.97" font-family="Times,serif" font-size="14.00">Gate Selection (Top&#45;8)</text>
<text text-anchor="middle" x="1321" y="-323.97" font-family="Times,serif" font-size="14.00">GPU: 27&#45;34</text>
<text text-anchor="middle" x="1321" y="-308.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="1321" y="-293.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, top_k=8]</text>
</g>
<!-- stage3_layer72_attn&#45;&gt;stage3_layer72_gate -->
<g id="edge21" class="edge">
<title>stage3_layer72_attn&#45;&gt;stage3_layer72_gate</title>
<path fill="none" stroke="black" d="M1321,-425C1321,-416.86 1321,-407.8 1321,-398.52"/>
<polygon fill="black" stroke="black" points="1324.5,-398.4 1321,-388.4 1317.5,-398.4 1324.5,-398.4"/>
</g>
<!-- stage3_layer72_moe -->
<g id="node22" class="node">
<title>stage3_layer72_moe</title>
<polygon fill="lightcoral" stroke="black" points="1534,-201.17 1108,-201.17 1108,-133.17 1534,-133.17 1534,-201.17"/>
<text text-anchor="middle" x="1321" y="-185.97" font-family="Times,serif" font-size="14.00">Layer 72 MoE (128 experts)</text>
<text text-anchor="middle" x="1321" y="-170.97" font-family="Times,serif" font-size="14.00">GPU: 27&#45;34</text>
<text text-anchor="middle" x="1321" y="-155.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="1321" y="-140.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage3_layer72_gate&#45;&gt;stage3_layer72_moe -->
<g id="edge22" class="edge">
<title>stage3_layer72_gate&#45;&gt;stage3_layer72_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1321,-252.06C1321,-238.27 1321,-224.11 1321,-211.44"/>
<polygon fill="black" stroke="black" points="1324.5,-211.19 1321,-201.19 1317.5,-211.19 1324.5,-211.19"/>
<text text-anchor="middle" x="1400.5" y="-222.97" font-family="Times,serif" font-size="14.00">Top&#45;8 expert selection</text>
</g>
<!-- stage3_layer93_attn -->
<g id="node23" class="node">
<title>stage3_layer93_attn</title>
<polygon fill="lightcoral" stroke="black" points="658,-493.17 232,-493.17 232,-425.17 658,-425.17 658,-493.17"/>
<text text-anchor="middle" x="445" y="-477.97" font-family="Times,serif" font-size="14.00">Layer 93 Attention</text>
<text text-anchor="middle" x="445" y="-462.97" font-family="Times,serif" font-size="14.00">GPU: 27&#45;34</text>
<text text-anchor="middle" x="445" y="-447.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="445" y="-432.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage3_layer93_gate -->
<g id="node24" class="node">
<title>stage3_layer93_gate</title>
<polygon fill="orange" stroke="black" points="874.43,-388.17 191.3,-388.17 15.57,-252.17 698.7,-252.17 874.43,-388.17"/>
<text text-anchor="middle" x="445" y="-338.97" font-family="Times,serif" font-size="14.00">Gate Selection (Top&#45;8)</text>
<text text-anchor="middle" x="445" y="-323.97" font-family="Times,serif" font-size="14.00">GPU: 27&#45;34</text>
<text text-anchor="middle" x="445" y="-308.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="445" y="-293.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, top_k=8]</text>
</g>
<!-- stage3_layer93_attn&#45;&gt;stage3_layer93_gate -->
<g id="edge23" class="edge">
<title>stage3_layer93_attn&#45;&gt;stage3_layer93_gate</title>
<path fill="none" stroke="black" d="M445,-425C445,-416.86 445,-407.8 445,-398.52"/>
<polygon fill="black" stroke="black" points="448.5,-398.4 445,-388.4 441.5,-398.4 448.5,-398.4"/>
</g>
<!-- stage3_layer93_moe -->
<g id="node25" class="node">
<title>stage3_layer93_moe</title>
<polygon fill="lightcoral" stroke="black" points="658,-201.17 232,-201.17 232,-133.17 658,-133.17 658,-201.17"/>
<text text-anchor="middle" x="445" y="-185.97" font-family="Times,serif" font-size="14.00">Layer 93 MoE (128 experts)</text>
<text text-anchor="middle" x="445" y="-170.97" font-family="Times,serif" font-size="14.00">GPU: 27&#45;34</text>
<text text-anchor="middle" x="445" y="-155.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="445" y="-140.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, d_model=4096]</text>
</g>
<!-- stage3_layer93_gate&#45;&gt;stage3_layer93_moe -->
<g id="edge24" class="edge">
<title>stage3_layer93_gate&#45;&gt;stage3_layer93_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M445,-252.06C445,-238.27 445,-224.11 445,-211.44"/>
<polygon fill="black" stroke="black" points="448.5,-211.19 445,-201.19 441.5,-211.19 448.5,-211.19"/>
<text text-anchor="middle" x="524.5" y="-222.97" font-family="Times,serif" font-size="14.00">Top&#45;8 expert selection</text>
</g>
<!-- output -->
<g id="node26" class="node">
<title>output</title>
<ellipse fill="lightgray" stroke="black" cx="445" cy="-48.08" rx="325.95" ry="48.17"/>
<text text-anchor="middle" x="445" y="-66.88" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="445" y="-51.88" font-family="Times,serif" font-size="14.00">GPU: 27&#45;34</text>
<text text-anchor="middle" x="445" y="-36.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=2048, d_model=4096]</text>
<text text-anchor="middle" x="445" y="-21.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=2048, vocab_size=151936]</text>
</g>
<!-- stage3_layer93_moe&#45;&gt;output -->
<g id="edge25" class="edge">
<title>stage3_layer93_moe&#45;&gt;output</title>
<path fill="none" stroke="black" d="M445,-132.93C445,-124.68 445,-115.59 445,-106.54"/>
<polygon fill="black" stroke="black" points="448.5,-106.39 445,-96.39 441.5,-106.39 448.5,-106.39"/>
</g>
<!-- comm_0_1&#45;&gt;stage1_layer24_attn -->
<g id="edge8" class="edge">
<title>comm_0_1&#45;&gt;stage1_layer24_attn</title>
<path fill="none" stroke="black" d="M3073,-1698.4C3073,-1678.45 3073,-1655.35 3073,-1635.83"/>
<polygon fill="black" stroke="black" points="3076.5,-1635.69 3073,-1625.69 3069.5,-1635.69 3076.5,-1635.69"/>
</g>
<!-- comm_1_2&#45;&gt;stage2_layer48_attn -->
<g id="edge14" class="edge">
<title>comm_1_2&#45;&gt;stage2_layer48_attn</title>
<path fill="none" stroke="black" d="M2197,-1132.24C2197,-1112.28 2197,-1089.18 2197,-1069.66"/>
<polygon fill="black" stroke="black" points="2200.5,-1069.52 2197,-1059.52 2193.5,-1069.52 2200.5,-1069.52"/>
</g>
<!-- comm_2_3&#45;&gt;stage3_layer72_attn -->
<g id="edge20" class="edge">
<title>comm_2_3&#45;&gt;stage3_layer72_attn</title>
<path fill="none" stroke="black" d="M1321,-566.07C1321,-546.11 1321,-523.02 1321,-503.5"/>
<polygon fill="black" stroke="black" points="1324.5,-503.36 1321,-493.36 1317.5,-503.36 1324.5,-503.36"/>
</g>
</g>
</svg>
