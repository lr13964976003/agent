<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="942pt" height="3834pt"
 viewBox="0.00 0.00 942.00 3833.83" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 3829.83)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-3829.83 938,-3829.83 938,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="none" stroke="black" d="M260,-3725.83C260,-3725.83 674,-3725.83 674,-3725.83 680,-3725.83 686,-3731.83 686,-3737.83 686,-3737.83 686,-3805.83 686,-3805.83 686,-3811.83 680,-3817.83 674,-3817.83 674,-3817.83 260,-3817.83 260,-3817.83 254,-3817.83 248,-3811.83 248,-3805.83 248,-3805.83 248,-3737.83 248,-3737.83 248,-3731.83 254,-3725.83 260,-3725.83"/>
<text text-anchor="middle" x="467" y="-3802.63" font-family="Times,serif" font-size="14.00">Input Layer</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage1</title>
<path fill="none" stroke="black" d="M20,-1617.5C20,-1617.5 914,-1617.5 914,-1617.5 920,-1617.5 926,-1623.5 926,-1629.5 926,-1629.5 926,-3666.83 926,-3666.83 926,-3672.83 920,-3678.83 914,-3678.83 914,-3678.83 20,-3678.83 20,-3678.83 14,-3678.83 8,-3672.83 8,-3666.83 8,-3666.83 8,-1629.5 8,-1629.5 8,-1623.5 14,-1617.5 20,-1617.5"/>
<text text-anchor="middle" x="467" y="-3663.63" font-family="Times,serif" font-size="14.00">Pipeline Stage 1: Layers 0&#45;7 (GPUs 0&#45;127)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_stage2</title>
<path fill="none" stroke="black" d="M156,-147C156,-147 778,-147 778,-147 784,-147 790,-153 790,-159 790,-159 790,-1376.33 790,-1376.33 790,-1382.33 784,-1388.33 778,-1388.33 778,-1388.33 156,-1388.33 156,-1388.33 150,-1388.33 144,-1382.33 144,-1376.33 144,-1376.33 144,-159 144,-159 144,-153 150,-147 156,-147"/>
<text text-anchor="middle" x="467" y="-1373.13" font-family="Times,serif" font-size="14.00">Pipeline Stage 2: Layers 8&#45;15 (GPUs 128&#45;255)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_output</title>
<path fill="none" stroke="black" d="M266,-8C266,-8 668,-8 668,-8 674,-8 680,-14 680,-20 680,-20 680,-88 680,-88 680,-94 674,-100 668,-100 668,-100 266,-100 266,-100 260,-100 254,-94 254,-88 254,-88 254,-20 254,-20 254,-14 260,-8 266,-8"/>
<text text-anchor="middle" x="467" y="-84.8" font-family="Times,serif" font-size="14.00">Output Layer</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<path fill="white" stroke="black" d="M666,-3786.83C666,-3786.83 268,-3786.83 268,-3786.83 262,-3786.83 256,-3780.83 256,-3774.83 256,-3774.83 256,-3745.83 256,-3745.83 256,-3739.83 262,-3733.83 268,-3733.83 268,-3733.83 666,-3733.83 666,-3733.83 672,-3733.83 678,-3739.83 678,-3745.83 678,-3745.83 678,-3774.83 678,-3774.83 678,-3780.83 672,-3786.83 666,-3786.83"/>
<text text-anchor="middle" x="467" y="-3771.63" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="467" y="-3756.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-3741.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- layernorm0 -->
<g id="node2" class="node">
<title>layernorm0</title>
<polygon fill="lightgreen" stroke="black" points="678,-3647.83 256,-3647.83 256,-3579.83 678,-3579.83 678,-3647.83"/>
<text text-anchor="middle" x="467" y="-3632.63" font-family="Times,serif" font-size="14.00">LayerNorm (Layer 0)</text>
<text text-anchor="middle" x="467" y="-3617.63" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127</text>
<text text-anchor="middle" x="467" y="-3602.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-3587.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- input&#45;&gt;layernorm0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layernorm0</title>
<path fill="none" stroke="black" d="M467,-3733.8C467,-3733.8 467,-3657.91 467,-3657.91"/>
<polygon fill="black" stroke="black" points="470.5,-3657.91 467,-3647.91 463.5,-3657.91 470.5,-3657.91"/>
</g>
<!-- qkv_proj -->
<g id="node3" class="node">
<title>qkv_proj</title>
<polygon fill="lightgreen" stroke="black" points="685,-3493.83 249,-3493.83 249,-3425.83 685,-3425.83 685,-3493.83"/>
<text text-anchor="middle" x="467" y="-3478.63" font-family="Times,serif" font-size="14.00">QKV Projection TP=4</text>
<text text-anchor="middle" x="467" y="-3463.63" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127 (TP groups)</text>
<text text-anchor="middle" x="467" y="-3448.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-3433.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=4, d_k=32]</text>
</g>
<!-- layernorm0&#45;&gt;qkv_proj -->
<g id="edge2" class="edge">
<title>layernorm0&#45;&gt;qkv_proj</title>
<path fill="none" stroke="black" d="M467,-3579.66C467,-3579.66 467,-3503.91 467,-3503.91"/>
<polygon fill="black" stroke="black" points="470.5,-3503.91 467,-3493.91 463.5,-3503.91 470.5,-3503.91"/>
</g>
<!-- qkv_allreduce -->
<g id="node4" class="node">
<title>qkv_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="467" cy="-3291.75" rx="314.83" ry="48.17"/>
<text text-anchor="middle" x="467" y="-3310.55" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce QKV</text>
<text text-anchor="middle" x="467" y="-3295.55" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127 (TP groups)</text>
<text text-anchor="middle" x="467" y="-3280.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=4, d_k=32]</text>
<text text-anchor="middle" x="467" y="-3265.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=16, d_k=32]</text>
</g>
<!-- qkv_proj&#45;&gt;qkv_allreduce -->
<g id="edge3" class="edge">
<title>qkv_proj&#45;&gt;qkv_allreduce</title>
<path fill="none" stroke="black" d="M467,-3425.82C467,-3425.82 467,-3350.05 467,-3350.05"/>
<polygon fill="black" stroke="black" points="470.5,-3350.05 467,-3340.05 463.5,-3350.05 470.5,-3350.05"/>
</g>
<!-- attention -->
<g id="node5" class="node">
<title>attention</title>
<polygon fill="lightgreen" stroke="black" points="689.5,-3157.67 244.5,-3157.67 244.5,-3089.67 689.5,-3089.67 689.5,-3157.67"/>
<text text-anchor="middle" x="467" y="-3142.47" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="467" y="-3127.47" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127</text>
<text text-anchor="middle" x="467" y="-3112.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=16, d_k=32]</text>
<text text-anchor="middle" x="467" y="-3097.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=16, d_k=32]</text>
</g>
<!-- qkv_allreduce&#45;&gt;attention -->
<g id="edge4" class="edge">
<title>qkv_allreduce&#45;&gt;attention</title>
<path fill="none" stroke="black" d="M467,-3243.58C467,-3243.58 467,-3167.7 467,-3167.7"/>
<polygon fill="black" stroke="black" points="470.5,-3167.7 467,-3157.7 463.5,-3167.7 470.5,-3167.7"/>
</g>
<!-- attn_out -->
<g id="node6" class="node">
<title>attn_out</title>
<polygon fill="lightgreen" stroke="black" points="683.5,-3003.67 250.5,-3003.67 250.5,-2935.67 683.5,-2935.67 683.5,-3003.67"/>
<text text-anchor="middle" x="467" y="-2988.47" font-family="Times,serif" font-size="14.00">Attention Output Projection TP=4</text>
<text text-anchor="middle" x="467" y="-2973.47" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127 (TP groups)</text>
<text text-anchor="middle" x="467" y="-2958.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=16, d_k=32]</text>
<text text-anchor="middle" x="467" y="-2943.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=128]</text>
</g>
<!-- attention&#45;&gt;attn_out -->
<g id="edge5" class="edge">
<title>attention&#45;&gt;attn_out</title>
<path fill="none" stroke="black" d="M467,-3089.49C467,-3089.49 467,-3013.75 467,-3013.75"/>
<polygon fill="black" stroke="black" points="470.5,-3013.75 467,-3003.75 463.5,-3013.75 470.5,-3013.75"/>
</g>
<!-- attn_allreduce -->
<g id="node7" class="node">
<title>attn_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="467" cy="-2801.58" rx="298.3" ry="48.17"/>
<text text-anchor="middle" x="467" y="-2820.38" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce Attention</text>
<text text-anchor="middle" x="467" y="-2805.38" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127 (TP groups)</text>
<text text-anchor="middle" x="467" y="-2790.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=128]</text>
<text text-anchor="middle" x="467" y="-2775.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- attn_out&#45;&gt;attn_allreduce -->
<g id="edge6" class="edge">
<title>attn_out&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M467,-2935.65C467,-2935.65 467,-2859.88 467,-2859.88"/>
<polygon fill="black" stroke="black" points="470.5,-2859.88 467,-2849.88 463.5,-2859.88 470.5,-2859.88"/>
</g>
<!-- residual1 -->
<g id="node8" class="node">
<title>residual1</title>
<polygon fill="lightgreen" stroke="black" points="678,-2667.5 256,-2667.5 256,-2599.5 678,-2599.5 678,-2667.5"/>
<text text-anchor="middle" x="467" y="-2652.3" font-family="Times,serif" font-size="14.00">Residual Connection</text>
<text text-anchor="middle" x="467" y="-2637.3" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127</text>
<text text-anchor="middle" x="467" y="-2622.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-2607.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- attn_allreduce&#45;&gt;residual1 -->
<g id="edge7" class="edge">
<title>attn_allreduce&#45;&gt;residual1</title>
<path fill="none" stroke="black" d="M467,-2753.42C467,-2753.42 467,-2677.53 467,-2677.53"/>
<polygon fill="black" stroke="black" points="470.5,-2677.53 467,-2667.53 463.5,-2677.53 470.5,-2677.53"/>
</g>
<!-- moe_gate -->
<g id="node9" class="node">
<title>moe_gate</title>
<polygon fill="lightyellow" stroke="black" points="914.75,-2513.5 202.48,-2513.5 19.25,-2377.5 731.52,-2377.5 914.75,-2513.5"/>
<text text-anchor="middle" x="467" y="-2464.3" font-family="Times,serif" font-size="14.00">MoE Gate (Expert Selection)</text>
<text text-anchor="middle" x="467" y="-2449.3" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127</text>
<text text-anchor="middle" x="467" y="-2434.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-2419.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, num_experts=16]</text>
</g>
<!-- residual1&#45;&gt;moe_gate -->
<g id="edge8" class="edge">
<title>residual1&#45;&gt;moe_gate</title>
<path fill="none" stroke="black" d="M467,-2599.45C467,-2599.45 467,-2523.56 467,-2523.56"/>
<polygon fill="black" stroke="black" points="470.5,-2523.56 467,-2513.56 463.5,-2523.56 470.5,-2523.56"/>
</g>
<!-- expert_route -->
<g id="node10" class="node">
<title>expert_route</title>
<polygon fill="lightyellow" stroke="black" points="892.14,-2291.5 215.84,-2291.5 41.86,-2155.5 718.16,-2155.5 892.14,-2291.5"/>
<text text-anchor="middle" x="467" y="-2242.3" font-family="Times,serif" font-size="14.00">Expert Routing EP=8</text>
<text text-anchor="middle" x="467" y="-2227.3" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127</text>
<text text-anchor="middle" x="467" y="-2212.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-2197.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, experts=2]</text>
</g>
<!-- moe_gate&#45;&gt;expert_route -->
<g id="edge9" class="edge">
<title>moe_gate&#45;&gt;expert_route</title>
<path fill="none" stroke="black" d="M467,-2377.38C467,-2377.38 467,-2301.87 467,-2301.87"/>
<polygon fill="black" stroke="black" points="470.5,-2301.87 467,-2291.87 463.5,-2301.87 470.5,-2301.87"/>
</g>
<!-- expert_0 -->
<g id="node11" class="node">
<title>expert_0</title>
<polygon fill="lightgreen" stroke="black" points="438,-2069.5 16,-2069.5 16,-2001.5 438,-2001.5 438,-2069.5"/>
<text text-anchor="middle" x="227" y="-2054.3" font-family="Times,serif" font-size="14.00">Expert 0 Computation</text>
<text text-anchor="middle" x="227" y="-2039.3" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127 (2 experts per GPU)</text>
<text text-anchor="middle" x="227" y="-2024.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="227" y="-2009.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- expert_route&#45;&gt;expert_0 -->
<g id="edge10" class="edge">
<title>expert_route&#45;&gt;expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M239.97,-2155.36C239.97,-2155.36 239.97,-2079.68 239.97,-2079.68"/>
<polygon fill="black" stroke="black" points="243.47,-2079.68 239.97,-2069.68 236.47,-2079.68 243.47,-2079.68"/>
</g>
<!-- expert_1 -->
<g id="node12" class="node">
<title>expert_1</title>
<polygon fill="lightgreen" stroke="black" points="918,-2069.5 496,-2069.5 496,-2001.5 918,-2001.5 918,-2069.5"/>
<text text-anchor="middle" x="707" y="-2054.3" font-family="Times,serif" font-size="14.00">Expert 1 Computation</text>
<text text-anchor="middle" x="707" y="-2039.3" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127 (2 experts per GPU)</text>
<text text-anchor="middle" x="707" y="-2024.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="707" y="-2009.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- expert_route&#45;&gt;expert_1 -->
<g id="edge11" class="edge">
<title>expert_route&#45;&gt;expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M694.03,-2155.36C694.03,-2155.36 694.03,-2079.68 694.03,-2079.68"/>
<polygon fill="black" stroke="black" points="697.53,-2079.68 694.03,-2069.68 690.53,-2079.68 697.53,-2079.68"/>
</g>
<!-- expert_combine -->
<g id="node13" class="node">
<title>expert_combine</title>
<polygon fill="lightyellow" stroke="black" points="904.52,-1915.5 208.52,-1915.5 29.48,-1779.5 725.48,-1779.5 904.52,-1915.5"/>
<text text-anchor="middle" x="467" y="-1866.3" font-family="Times,serif" font-size="14.00">Expert Combination EP=8</text>
<text text-anchor="middle" x="467" y="-1851.3" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127</text>
<text text-anchor="middle" x="467" y="-1836.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, experts=2]</text>
<text text-anchor="middle" x="467" y="-1821.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- expert_0&#45;&gt;expert_combine -->
<g id="edge12" class="edge">
<title>expert_0&#45;&gt;expert_combine</title>
<path fill="none" stroke="black" d="M233.75,-2001.45C233.75,-2001.45 233.75,-1925.56 233.75,-1925.56"/>
<polygon fill="black" stroke="black" points="237.25,-1925.56 233.75,-1915.56 230.25,-1925.56 237.25,-1925.56"/>
</g>
<!-- expert_1&#45;&gt;expert_combine -->
<g id="edge13" class="edge">
<title>expert_1&#45;&gt;expert_combine</title>
<path fill="none" stroke="black" d="M700.25,-2001.45C700.25,-2001.45 700.25,-1925.56 700.25,-1925.56"/>
<polygon fill="black" stroke="black" points="703.76,-1925.56 700.25,-1915.56 696.76,-1925.56 703.76,-1925.56"/>
</g>
<!-- moe_residual -->
<g id="node14" class="node">
<title>moe_residual</title>
<polygon fill="lightgreen" stroke="black" points="678,-1693.5 256,-1693.5 256,-1625.5 678,-1625.5 678,-1693.5"/>
<text text-anchor="middle" x="467" y="-1678.3" font-family="Times,serif" font-size="14.00">MoE Residual Connection</text>
<text text-anchor="middle" x="467" y="-1663.3" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127</text>
<text text-anchor="middle" x="467" y="-1648.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-1633.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- expert_combine&#45;&gt;moe_residual -->
<g id="edge14" class="edge">
<title>expert_combine&#45;&gt;moe_residual</title>
<path fill="none" stroke="black" d="M467,-1779.36C467,-1779.36 467,-1703.68 467,-1703.68"/>
<polygon fill="black" stroke="black" points="470.5,-1703.68 467,-1693.68 463.5,-1703.68 470.5,-1703.68"/>
</g>
<!-- stage1_to_stage2 -->
<g id="node15" class="node">
<title>stage1_to_stage2</title>
<ellipse fill="lightblue" stroke="black" cx="467" cy="-1491.42" rx="298.3" ry="48.17"/>
<text text-anchor="middle" x="467" y="-1510.22" font-family="Times,serif" font-size="14.00">Pipeline Communication PP=2</text>
<text text-anchor="middle" x="467" y="-1495.22" font-family="Times,serif" font-size="14.00">GPU: 0&#45;127 â†’ 128&#45;255</text>
<text text-anchor="middle" x="467" y="-1480.22" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-1465.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- moe_residual&#45;&gt;stage1_to_stage2 -->
<g id="edge15" class="edge">
<title>moe_residual&#45;&gt;stage1_to_stage2</title>
<path fill="none" stroke="black" d="M467,-1625.49C467,-1625.49 467,-1549.71 467,-1549.71"/>
<polygon fill="black" stroke="black" points="470.5,-1549.71 467,-1539.71 463.5,-1549.71 470.5,-1549.71"/>
</g>
<!-- layernorm8 -->
<g id="node16" class="node">
<title>layernorm8</title>
<polygon fill="lightgreen" stroke="black" points="678,-1357.33 256,-1357.33 256,-1289.33 678,-1289.33 678,-1357.33"/>
<text text-anchor="middle" x="467" y="-1342.13" font-family="Times,serif" font-size="14.00">LayerNorm (Layer 8)</text>
<text text-anchor="middle" x="467" y="-1327.13" font-family="Times,serif" font-size="14.00">GPU: 128&#45;255</text>
<text text-anchor="middle" x="467" y="-1312.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-1297.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- stage1_to_stage2&#45;&gt;layernorm8 -->
<g id="edge16" class="edge">
<title>stage1_to_stage2&#45;&gt;layernorm8</title>
<path fill="none" stroke="black" d="M467,-1443.25C467,-1443.25 467,-1367.37 467,-1367.37"/>
<polygon fill="black" stroke="black" points="470.5,-1367.37 467,-1357.37 463.5,-1367.37 470.5,-1367.37"/>
</g>
<!-- qkv_proj2 -->
<g id="node17" class="node">
<title>qkv_proj2</title>
<polygon fill="lightgreen" stroke="black" points="685,-1203.33 249,-1203.33 249,-1135.33 685,-1135.33 685,-1203.33"/>
<text text-anchor="middle" x="467" y="-1188.13" font-family="Times,serif" font-size="14.00">QKV Projection TP=4</text>
<text text-anchor="middle" x="467" y="-1173.13" font-family="Times,serif" font-size="14.00">GPU: 128&#45;255 (TP groups)</text>
<text text-anchor="middle" x="467" y="-1158.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-1143.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=4, d_k=32]</text>
</g>
<!-- layernorm8&#45;&gt;qkv_proj2 -->
<g id="edge17" class="edge">
<title>layernorm8&#45;&gt;qkv_proj2</title>
<path fill="none" stroke="black" d="M467,-1289.16C467,-1289.16 467,-1213.42 467,-1213.42"/>
<polygon fill="black" stroke="black" points="470.5,-1213.42 467,-1203.42 463.5,-1213.42 470.5,-1213.42"/>
</g>
<!-- qkv_allreduce2 -->
<g id="node18" class="node">
<title>qkv_allreduce2</title>
<ellipse fill="lightblue" stroke="black" cx="467" cy="-1001.25" rx="314.83" ry="48.17"/>
<text text-anchor="middle" x="467" y="-1020.05" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce QKV</text>
<text text-anchor="middle" x="467" y="-1005.05" font-family="Times,serif" font-size="14.00">GPU: 128&#45;255 (TP groups)</text>
<text text-anchor="middle" x="467" y="-990.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=4, d_k=32]</text>
<text text-anchor="middle" x="467" y="-975.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=16, d_k=32]</text>
</g>
<!-- qkv_proj2&#45;&gt;qkv_allreduce2 -->
<g id="edge18" class="edge">
<title>qkv_proj2&#45;&gt;qkv_allreduce2</title>
<path fill="none" stroke="black" d="M467,-1135.32C467,-1135.32 467,-1059.55 467,-1059.55"/>
<polygon fill="black" stroke="black" points="470.5,-1059.55 467,-1049.55 463.5,-1059.55 470.5,-1059.55"/>
</g>
<!-- attention2 -->
<g id="node19" class="node">
<title>attention2</title>
<polygon fill="lightgreen" stroke="black" points="689.5,-867.17 244.5,-867.17 244.5,-799.17 689.5,-799.17 689.5,-867.17"/>
<text text-anchor="middle" x="467" y="-851.97" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="467" y="-836.97" font-family="Times,serif" font-size="14.00">GPU: 128&#45;255</text>
<text text-anchor="middle" x="467" y="-821.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=16, d_k=32]</text>
<text text-anchor="middle" x="467" y="-806.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=16, d_k=32]</text>
</g>
<!-- qkv_allreduce2&#45;&gt;attention2 -->
<g id="edge19" class="edge">
<title>qkv_allreduce2&#45;&gt;attention2</title>
<path fill="none" stroke="black" d="M467,-953.08C467,-953.08 467,-877.2 467,-877.2"/>
<polygon fill="black" stroke="black" points="470.5,-877.2 467,-867.2 463.5,-877.2 470.5,-877.2"/>
</g>
<!-- attn_out2 -->
<g id="node20" class="node">
<title>attn_out2</title>
<polygon fill="lightgreen" stroke="black" points="683.5,-713.17 250.5,-713.17 250.5,-645.17 683.5,-645.17 683.5,-713.17"/>
<text text-anchor="middle" x="467" y="-697.97" font-family="Times,serif" font-size="14.00">Attention Output Projection TP=4</text>
<text text-anchor="middle" x="467" y="-682.97" font-family="Times,serif" font-size="14.00">GPU: 128&#45;255 (TP groups)</text>
<text text-anchor="middle" x="467" y="-667.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=16, d_k=32]</text>
<text text-anchor="middle" x="467" y="-652.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=128]</text>
</g>
<!-- attention2&#45;&gt;attn_out2 -->
<g id="edge20" class="edge">
<title>attention2&#45;&gt;attn_out2</title>
<path fill="none" stroke="black" d="M467,-798.99C467,-798.99 467,-723.25 467,-723.25"/>
<polygon fill="black" stroke="black" points="470.5,-723.25 467,-713.25 463.5,-723.25 470.5,-723.25"/>
</g>
<!-- attn_allreduce2 -->
<g id="node21" class="node">
<title>attn_allreduce2</title>
<ellipse fill="lightblue" stroke="black" cx="467" cy="-511.08" rx="298.3" ry="48.17"/>
<text text-anchor="middle" x="467" y="-529.88" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce Attention</text>
<text text-anchor="middle" x="467" y="-514.88" font-family="Times,serif" font-size="14.00">GPU: 128&#45;255 (TP groups)</text>
<text text-anchor="middle" x="467" y="-499.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=128]</text>
<text text-anchor="middle" x="467" y="-484.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- attn_out2&#45;&gt;attn_allreduce2 -->
<g id="edge21" class="edge">
<title>attn_out2&#45;&gt;attn_allreduce2</title>
<path fill="none" stroke="black" d="M467,-645.15C467,-645.15 467,-569.38 467,-569.38"/>
<polygon fill="black" stroke="black" points="470.5,-569.38 467,-559.38 463.5,-569.38 470.5,-569.38"/>
</g>
<!-- residual2 -->
<g id="node22" class="node">
<title>residual2</title>
<polygon fill="lightgreen" stroke="black" points="678,-377 256,-377 256,-309 678,-309 678,-377"/>
<text text-anchor="middle" x="467" y="-361.8" font-family="Times,serif" font-size="14.00">Residual Connection</text>
<text text-anchor="middle" x="467" y="-346.8" font-family="Times,serif" font-size="14.00">GPU: 128&#45;255</text>
<text text-anchor="middle" x="467" y="-331.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-316.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- attn_allreduce2&#45;&gt;residual2 -->
<g id="edge22" class="edge">
<title>attn_allreduce2&#45;&gt;residual2</title>
<path fill="none" stroke="black" d="M467,-462.92C467,-462.92 467,-387.03 467,-387.03"/>
<polygon fill="black" stroke="black" points="470.5,-387.03 467,-377.03 463.5,-387.03 470.5,-387.03"/>
</g>
<!-- final_layernorm -->
<g id="node23" class="node">
<title>final_layernorm</title>
<polygon fill="lightgreen" stroke="black" points="678,-223 256,-223 256,-155 678,-155 678,-223"/>
<text text-anchor="middle" x="467" y="-207.8" font-family="Times,serif" font-size="14.00">Final LayerNorm</text>
<text text-anchor="middle" x="467" y="-192.8" font-family="Times,serif" font-size="14.00">GPU: 128&#45;255</text>
<text text-anchor="middle" x="467" y="-177.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-162.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, token_dim=512]</text>
</g>
<!-- residual2&#45;&gt;final_layernorm -->
<g id="edge23" class="edge">
<title>residual2&#45;&gt;final_layernorm</title>
<path fill="none" stroke="black" d="M467,-308.82C467,-308.82 467,-233.08 467,-233.08"/>
<polygon fill="black" stroke="black" points="470.5,-233.08 467,-223.08 463.5,-233.08 470.5,-233.08"/>
</g>
<!-- output -->
<g id="node24" class="node">
<title>output</title>
<path fill="white" stroke="black" d="M660,-69C660,-69 274,-69 274,-69 268,-69 262,-63 262,-57 262,-57 262,-28 262,-28 262,-22 268,-16 274,-16 274,-16 660,-16 660,-16 666,-16 672,-22 672,-28 672,-28 672,-57 672,-57 672,-63 666,-69 660,-69"/>
<text text-anchor="middle" x="467" y="-53.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="467" y="-38.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, token_dim=512]</text>
<text text-anchor="middle" x="467" y="-23.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, vocab_size=V]</text>
</g>
<!-- final_layernorm&#45;&gt;output -->
<g id="edge24" class="edge">
<title>final_layernorm&#45;&gt;output</title>
<path fill="none" stroke="black" d="M467,-154.65C467,-154.65 467,-79.32 467,-79.32"/>
<polygon fill="black" stroke="black" points="470.5,-79.32 467,-69.32 463.5,-79.32 470.5,-79.32"/>
</g>
</g>
</svg>
