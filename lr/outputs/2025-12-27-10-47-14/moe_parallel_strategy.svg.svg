<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1440pt" height="1700pt"
 viewBox="0.00 0.00 1440.00 1700.19" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.63 0.63) rotate(0) translate(4 2704.49)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2704.49 2290,-2704.49 2290,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_pipeline_0</title>
<path fill="lightgray" stroke="black" d="M20,-111.54C20,-111.54 2266,-111.54 2266,-111.54 2272,-111.54 2278,-117.54 2278,-123.54 2278,-123.54 2278,-2587.95 2278,-2587.95 2278,-2593.95 2272,-2599.95 2266,-2599.95 2266,-2599.95 20,-2599.95 20,-2599.95 14,-2599.95 8,-2593.95 8,-2587.95 8,-2587.95 8,-123.54 8,-123.54 8,-117.54 14,-111.54 20,-111.54"/>
<text text-anchor="middle" x="1143" y="-2586.35" font-family="Arial Bold" font-size="12.00">Pipeline Stage 0 (Layers 0&#45;3)</text>
<text text-anchor="middle" x="1143" y="-2573.35" font-family="Arial Bold" font-size="12.00">GPUs 0&#45;31</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="1149" cy="-2663.72" rx="188.18" ry="36.54"/>
<text text-anchor="middle" x="1149" y="-2677.72" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="1149" y="-2666.72" font-family="Arial" font-size="10.00">GPU Input</text>
<text text-anchor="middle" x="1149" y="-2655.72" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1149" y="-2644.72" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- mha_layer_0 -->
<g id="node2" class="node">
<title>mha_layer_0</title>
<polygon fill="lightgreen" stroke="black" points="1283,-2557.95 1015,-2557.95 1015,-2505.95 1283,-2505.95 1283,-2557.95"/>
<text text-anchor="middle" x="1149" y="-2545.95" font-family="Arial" font-size="10.00">MHA Layer 0</text>
<text text-anchor="middle" x="1149" y="-2534.95" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1149" y="-2523.95" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1149" y="-2512.95" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- input&#45;&gt;mha_layer_0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;mha_layer_0</title>
<path fill="none" stroke="black" d="M1149,-2626.92C1149,-2608.6 1149,-2586.4 1149,-2568.17"/>
<polygon fill="black" stroke="black" points="1152.5,-2567.95 1149,-2557.95 1145.5,-2567.95 1152.5,-2567.95"/>
</g>
<!-- gate_layer_0 -->
<g id="node3" class="node">
<title>gate_layer_0</title>
<polygon fill="lightyellow" stroke="black" points="1425.63,-2468.95 985.58,-2468.95 872.37,-2364.95 1312.42,-2364.95 1425.63,-2468.95"/>
<text text-anchor="middle" x="1149" y="-2430.95" font-family="Arial" font-size="10.00">Gate Layer 0</text>
<text text-anchor="middle" x="1149" y="-2419.95" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1149" y="-2408.95" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1149" y="-2397.95" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, num_experts=16]</text>
</g>
<!-- mha_layer_0&#45;&gt;gate_layer_0 -->
<g id="edge2" class="edge">
<title>mha_layer_0&#45;&gt;gate_layer_0</title>
<path fill="none" stroke="black" d="M1149,-2505.87C1149,-2497.95 1149,-2488.81 1149,-2479.49"/>
<polygon fill="black" stroke="black" points="1152.5,-2479.35 1149,-2469.35 1145.5,-2479.35 1152.5,-2479.35"/>
</g>
<!-- route_comm_layer_0_expert_0_tp_0 -->
<g id="node4" class="node">
<title>route_comm_layer_0_expert_0_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="469" cy="-2306.74" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="469" y="-2309.74" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="469" y="-2298.74" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 0</text>
</g>
<!-- gate_layer_0&#45;&gt;route_comm_layer_0_expert_0_tp_0 -->
<g id="edge3" class="edge">
<title>gate_layer_0&#45;&gt;route_comm_layer_0_expert_0_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M883.36,-2375.15C789.66,-2360.55 683.6,-2343.79 587,-2327.95 572.42,-2325.56 556.83,-2322.94 541.93,-2320.4"/>
<polygon fill="black" stroke="black" points="542.19,-2316.89 531.74,-2318.66 541.01,-2323.79 542.19,-2316.89"/>
</g>
<!-- route_comm_layer_0_expert_0_tp_1 -->
<g id="node6" class="node">
<title>route_comm_layer_0_expert_0_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="672" cy="-2306.74" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="672" y="-2309.74" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="672" y="-2298.74" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 1</text>
</g>
<!-- gate_layer_0&#45;&gt;route_comm_layer_0_expert_0_tp_1 -->
<g id="edge5" class="edge">
<title>gate_layer_0&#45;&gt;route_comm_layer_0_expert_0_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M924.12,-2364.93C856.58,-2349.61 787.59,-2333.96 738.89,-2322.91"/>
<polygon fill="black" stroke="black" points="739.64,-2319.49 729.12,-2320.69 738.09,-2326.32 739.64,-2319.49"/>
</g>
<!-- route_comm_layer_0_expert_1_tp_0 -->
<g id="node9" class="node">
<title>route_comm_layer_0_expert_1_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="858" cy="-2306.74" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="858" y="-2309.74" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="858" y="-2298.74" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 2</text>
</g>
<!-- gate_layer_0&#45;&gt;route_comm_layer_0_expert_1_tp_0 -->
<g id="edge9" class="edge">
<title>gate_layer_0&#45;&gt;route_comm_layer_0_expert_1_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1011.6,-2364.85C976.05,-2351.64 939.86,-2338.18 911.55,-2327.65"/>
<polygon fill="black" stroke="black" points="912.47,-2324.26 901.87,-2324.05 910.03,-2330.82 912.47,-2324.26"/>
</g>
<!-- route_comm_layer_0_expert_1_tp_1 -->
<g id="node11" class="node">
<title>route_comm_layer_0_expert_1_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1035" cy="-2306.74" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="1035" y="-2309.74" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1035" y="-2298.74" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 3</text>
</g>
<!-- gate_layer_0&#45;&gt;route_comm_layer_0_expert_1_tp_1 -->
<g id="edge11" class="edge">
<title>gate_layer_0&#45;&gt;route_comm_layer_0_expert_1_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1095,-2364.7C1083.92,-2354.18 1072.69,-2343.52 1062.99,-2334.31"/>
<polygon fill="black" stroke="black" points="1065.23,-2331.61 1055.57,-2327.26 1060.41,-2336.68 1065.23,-2331.61"/>
</g>
<!-- route_comm_layer_0_expert_8_tp_0 -->
<g id="node14" class="node">
<title>route_comm_layer_0_expert_8_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="1264" cy="-2306.74" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1264" y="-2309.74" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1264" y="-2298.74" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 16</text>
</g>
<!-- gate_layer_0&#45;&gt;route_comm_layer_0_expert_8_tp_0 -->
<g id="edge15" class="edge">
<title>gate_layer_0&#45;&gt;route_comm_layer_0_expert_8_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1203.47,-2364.7C1214.65,-2354.18 1225.98,-2343.52 1235.76,-2334.31"/>
<polygon fill="black" stroke="black" points="1238.37,-2336.66 1243.25,-2327.26 1233.57,-2331.57 1238.37,-2336.66"/>
</g>
<!-- route_comm_layer_0_expert_8_tp_1 -->
<g id="node16" class="node">
<title>route_comm_layer_0_expert_8_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1490" cy="-2306.74" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1490" y="-2309.74" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1490" y="-2298.74" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 17</text>
</g>
<!-- gate_layer_0&#45;&gt;route_comm_layer_0_expert_8_tp_1 -->
<g id="edge17" class="edge">
<title>gate_layer_0&#45;&gt;route_comm_layer_0_expert_8_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1310.01,-2364.85C1353.18,-2351.16 1397.15,-2337.2 1430.83,-2326.51"/>
<polygon fill="black" stroke="black" points="1432.02,-2329.81 1440.49,-2323.45 1429.9,-2323.14 1432.02,-2329.81"/>
</g>
<!-- route_comm_layer_0_expert_15_tp_0 -->
<g id="node19" class="node">
<title>route_comm_layer_0_expert_15_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="1692" cy="-2306.74" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1692" y="-2309.74" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1692" y="-2298.74" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 30</text>
</g>
<!-- gate_layer_0&#45;&gt;route_comm_layer_0_expert_15_tp_0 -->
<g id="edge21" class="edge">
<title>gate_layer_0&#45;&gt;route_comm_layer_0_expert_15_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1329.06,-2380.07C1428.27,-2360.29 1545.94,-2336.85 1619.8,-2322.13"/>
<polygon fill="black" stroke="black" points="1620.8,-2325.5 1629.92,-2320.11 1619.43,-2318.63 1620.8,-2325.5"/>
</g>
<!-- route_comm_layer_0_expert_15_tp_1 -->
<g id="node21" class="node">
<title>route_comm_layer_0_expert_15_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1882" cy="-2306.74" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1882" y="-2309.74" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1882" y="-2298.74" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 31</text>
</g>
<!-- gate_layer_0&#45;&gt;route_comm_layer_0_expert_15_tp_1 -->
<g id="edge23" class="edge">
<title>gate_layer_0&#45;&gt;route_comm_layer_0_expert_15_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1342.03,-2392.08C1467.41,-2375.84 1634.23,-2352.83 1781,-2327.95 1790.72,-2326.3 1800.94,-2324.43 1810.98,-2322.5"/>
<polygon fill="black" stroke="black" points="1811.81,-2325.9 1820.95,-2320.56 1810.47,-2319.03 1811.81,-2325.9"/>
</g>
<!-- expert_layer_0_expert_0_tp_0 -->
<g id="node5" class="node">
<title>expert_layer_0_expert_0_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="282,-2248.52 16,-2248.52 16,-2196.52 282,-2196.52 282,-2248.52"/>
<text text-anchor="middle" x="149" y="-2236.52" font-family="Arial" font-size="10.00">Expert 0 TP0</text>
<text text-anchor="middle" x="149" y="-2225.52" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="149" y="-2214.52" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="149" y="-2203.52" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_0_expert_0_tp_0&#45;&gt;expert_layer_0_expert_0_tp_0 -->
<g id="edge4" class="edge">
<title>route_comm_layer_0_expert_0_tp_0&#45;&gt;expert_layer_0_expert_0_tp_0</title>
<path fill="none" stroke="black" d="M414.72,-2291.79C371.41,-2280.66 309.39,-2264.73 256.16,-2251.06"/>
<polygon fill="black" stroke="black" points="256.89,-2247.63 246.33,-2248.53 255.15,-2254.41 256.89,-2247.63"/>
</g>
<!-- tp_comm_layer_0_expert_0 -->
<g id="node8" class="node">
<title>tp_comm_layer_0_expert_0</title>
<ellipse fill="lightblue" stroke="black" cx="433" cy="-2138.31" rx="69.09" ry="21.43"/>
<text text-anchor="middle" x="433" y="-2141.31" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="433" y="-2130.31" font-family="Arial" font-size="10.00">GPU 0 &lt;&#45;&gt; GPU 1</text>
</g>
<!-- expert_layer_0_expert_0_tp_0&#45;&gt;tp_comm_layer_0_expert_0 -->
<g id="edge7" class="edge">
<title>expert_layer_0_expert_0_tp_0&#45;&gt;tp_comm_layer_0_expert_0</title>
<path fill="none" stroke="black" d="M235.37,-2196.52C280.44,-2183.47 334.41,-2167.85 374.55,-2156.23"/>
<polygon fill="black" stroke="black" points="375.55,-2159.59 384.18,-2153.44 373.6,-2152.86 375.55,-2159.59"/>
</g>
<!-- expert_layer_0_expert_0_tp_1 -->
<g id="node7" class="node">
<title>expert_layer_0_expert_0_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="566,-2248.52 300,-2248.52 300,-2196.52 566,-2196.52 566,-2248.52"/>
<text text-anchor="middle" x="433" y="-2236.52" font-family="Arial" font-size="10.00">Expert 0 TP1</text>
<text text-anchor="middle" x="433" y="-2225.52" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="433" y="-2214.52" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="433" y="-2203.52" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_0_expert_0_tp_1&#45;&gt;expert_layer_0_expert_0_tp_1 -->
<g id="edge6" class="edge">
<title>route_comm_layer_0_expert_0_tp_1&#45;&gt;expert_layer_0_expert_0_tp_1</title>
<path fill="none" stroke="black" d="M625.92,-2289.89C594.66,-2279.13 552.47,-2264.62 515.51,-2251.91"/>
<polygon fill="black" stroke="black" points="516.34,-2248.49 505.74,-2248.55 514.06,-2255.11 516.34,-2248.49"/>
</g>
<!-- expert_layer_0_expert_0_tp_1&#45;&gt;tp_comm_layer_0_expert_0 -->
<g id="edge8" class="edge">
<title>expert_layer_0_expert_0_tp_1&#45;&gt;tp_comm_layer_0_expert_0</title>
<path fill="none" stroke="black" d="M433,-2196.41C433,-2188.02 433,-2178.57 433,-2169.81"/>
<polygon fill="black" stroke="black" points="436.5,-2169.59 433,-2159.59 429.5,-2169.59 436.5,-2169.59"/>
</g>
<!-- agg_layer_0 -->
<g id="node24" class="node">
<title>agg_layer_0</title>
<polygon fill="lightyellow" stroke="black" points="1386.27,-2080.1 830.66,-2080.1 687.73,-1976.1 1243.34,-1976.1 1386.27,-2080.1"/>
<text text-anchor="middle" x="1037" y="-2042.1" font-family="Arial" font-size="10.00">Expert Aggregation Layer 0</text>
<text text-anchor="middle" x="1037" y="-2031.1" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1037" y="-2020.1" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, num_experts=16, hidden_dim=512]</text>
<text text-anchor="middle" x="1037" y="-2009.1" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- tp_comm_layer_0_expert_0&#45;&gt;agg_layer_0 -->
<g id="edge27" class="edge">
<title>tp_comm_layer_0_expert_0&#45;&gt;agg_layer_0</title>
<path fill="none" stroke="black" d="M491.46,-2126.84C563.81,-2113.87 691.38,-2091.02 804.97,-2070.67"/>
<polygon fill="black" stroke="black" points="805.64,-2074.1 814.86,-2068.9 804.4,-2067.21 805.64,-2074.1"/>
</g>
<!-- expert_layer_0_expert_1_tp_0 -->
<g id="node10" class="node">
<title>expert_layer_0_expert_1_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="850,-2248.52 584,-2248.52 584,-2196.52 850,-2196.52 850,-2248.52"/>
<text text-anchor="middle" x="717" y="-2236.52" font-family="Arial" font-size="10.00">Expert 1 TP0</text>
<text text-anchor="middle" x="717" y="-2225.52" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="717" y="-2214.52" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="717" y="-2203.52" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_0_expert_1_tp_0&#45;&gt;expert_layer_0_expert_1_tp_0 -->
<g id="edge10" class="edge">
<title>route_comm_layer_0_expert_1_tp_0&#45;&gt;expert_layer_0_expert_1_tp_0</title>
<path fill="none" stroke="black" d="M826.36,-2287.29C809.39,-2277.39 788.05,-2264.95 768.74,-2253.69"/>
<polygon fill="black" stroke="black" points="770.43,-2250.63 760.03,-2248.62 766.91,-2256.68 770.43,-2250.63"/>
</g>
<!-- tp_comm_layer_0_expert_1 -->
<g id="node13" class="node">
<title>tp_comm_layer_0_expert_1</title>
<ellipse fill="lightblue" stroke="black" cx="1001" cy="-2138.31" rx="69.09" ry="21.43"/>
<text text-anchor="middle" x="1001" y="-2141.31" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1001" y="-2130.31" font-family="Arial" font-size="10.00">GPU 2 &lt;&#45;&gt; GPU 3</text>
</g>
<!-- expert_layer_0_expert_1_tp_0&#45;&gt;tp_comm_layer_0_expert_1 -->
<g id="edge13" class="edge">
<title>expert_layer_0_expert_1_tp_0&#45;&gt;tp_comm_layer_0_expert_1</title>
<path fill="none" stroke="black" d="M803.37,-2196.52C848.44,-2183.47 902.41,-2167.85 942.55,-2156.23"/>
<polygon fill="black" stroke="black" points="943.55,-2159.59 952.18,-2153.44 941.6,-2152.86 943.55,-2159.59"/>
</g>
<!-- expert_layer_0_expert_1_tp_1 -->
<g id="node12" class="node">
<title>expert_layer_0_expert_1_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="1134,-2248.52 868,-2248.52 868,-2196.52 1134,-2196.52 1134,-2248.52"/>
<text text-anchor="middle" x="1001" y="-2236.52" font-family="Arial" font-size="10.00">Expert 1 TP1</text>
<text text-anchor="middle" x="1001" y="-2225.52" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1001" y="-2214.52" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1001" y="-2203.52" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_0_expert_1_tp_1&#45;&gt;expert_layer_0_expert_1_tp_1 -->
<g id="edge12" class="edge">
<title>route_comm_layer_0_expert_1_tp_1&#45;&gt;expert_layer_0_expert_1_tp_1</title>
<path fill="none" stroke="black" d="M1026.6,-2285.41C1023.18,-2277.16 1019.14,-2267.38 1015.28,-2258.06"/>
<polygon fill="black" stroke="black" points="1018.43,-2256.51 1011.37,-2248.61 1011.96,-2259.19 1018.43,-2256.51"/>
</g>
<!-- expert_layer_0_expert_1_tp_1&#45;&gt;tp_comm_layer_0_expert_1 -->
<g id="edge14" class="edge">
<title>expert_layer_0_expert_1_tp_1&#45;&gt;tp_comm_layer_0_expert_1</title>
<path fill="none" stroke="black" d="M1001,-2196.41C1001,-2188.02 1001,-2178.57 1001,-2169.81"/>
<polygon fill="black" stroke="black" points="1004.5,-2169.59 1001,-2159.59 997.5,-2169.59 1004.5,-2169.59"/>
</g>
<!-- tp_comm_layer_0_expert_1&#45;&gt;agg_layer_0 -->
<g id="edge28" class="edge">
<title>tp_comm_layer_0_expert_1&#45;&gt;agg_layer_0</title>
<path fill="none" stroke="black" d="M1007.77,-2116.96C1010.37,-2109.15 1013.48,-2099.78 1016.7,-2090.12"/>
<polygon fill="black" stroke="black" points="1020.1,-2090.99 1019.93,-2080.4 1013.46,-2088.78 1020.1,-2090.99"/>
</g>
<!-- expert_layer_0_expert_8_tp_0 -->
<g id="node15" class="node">
<title>expert_layer_0_expert_8_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="1418,-2248.52 1152,-2248.52 1152,-2196.52 1418,-2196.52 1418,-2248.52"/>
<text text-anchor="middle" x="1285" y="-2236.52" font-family="Arial" font-size="10.00">Expert 8 TP0</text>
<text text-anchor="middle" x="1285" y="-2225.52" font-family="Arial" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1285" y="-2214.52" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1285" y="-2203.52" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_0_expert_8_tp_0&#45;&gt;expert_layer_0_expert_8_tp_0 -->
<g id="edge16" class="edge">
<title>route_comm_layer_0_expert_8_tp_0&#45;&gt;expert_layer_0_expert_8_tp_0</title>
<path fill="none" stroke="black" d="M1269.19,-2285.41C1271.28,-2277.24 1273.75,-2267.59 1276.1,-2258.36"/>
<polygon fill="black" stroke="black" points="1279.51,-2259.16 1278.59,-2248.61 1272.73,-2257.43 1279.51,-2259.16"/>
</g>
<!-- tp_comm_layer_0_expert_8 -->
<g id="node18" class="node">
<title>tp_comm_layer_0_expert_8</title>
<ellipse fill="lightblue" stroke="black" cx="1285" cy="-2138.31" rx="76.24" ry="21.43"/>
<text text-anchor="middle" x="1285" y="-2141.31" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1285" y="-2130.31" font-family="Arial" font-size="10.00">GPU 16 &lt;&#45;&gt; GPU 17</text>
</g>
<!-- expert_layer_0_expert_8_tp_0&#45;&gt;tp_comm_layer_0_expert_8 -->
<g id="edge19" class="edge">
<title>expert_layer_0_expert_8_tp_0&#45;&gt;tp_comm_layer_0_expert_8</title>
<path fill="none" stroke="black" d="M1285,-2196.41C1285,-2188.02 1285,-2178.57 1285,-2169.81"/>
<polygon fill="black" stroke="black" points="1288.5,-2169.59 1285,-2159.59 1281.5,-2169.59 1288.5,-2169.59"/>
</g>
<!-- expert_layer_0_expert_8_tp_1 -->
<g id="node17" class="node">
<title>expert_layer_0_expert_8_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="1702,-2248.52 1436,-2248.52 1436,-2196.52 1702,-2196.52 1702,-2248.52"/>
<text text-anchor="middle" x="1569" y="-2236.52" font-family="Arial" font-size="10.00">Expert 8 TP1</text>
<text text-anchor="middle" x="1569" y="-2225.52" font-family="Arial" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1569" y="-2214.52" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1569" y="-2203.52" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_0_expert_8_tp_1&#45;&gt;expert_layer_0_expert_8_tp_1 -->
<g id="edge18" class="edge">
<title>route_comm_layer_0_expert_8_tp_1&#45;&gt;expert_layer_0_expert_8_tp_1</title>
<path fill="none" stroke="black" d="M1509.12,-2285.84C1517.8,-2276.81 1528.27,-2265.91 1538.02,-2255.76"/>
<polygon fill="black" stroke="black" points="1540.55,-2258.18 1544.96,-2248.55 1535.5,-2253.33 1540.55,-2258.18"/>
</g>
<!-- expert_layer_0_expert_8_tp_1&#45;&gt;tp_comm_layer_0_expert_8 -->
<g id="edge20" class="edge">
<title>expert_layer_0_expert_8_tp_1&#45;&gt;tp_comm_layer_0_expert_8</title>
<path fill="none" stroke="black" d="M1482.63,-2196.52C1438.55,-2183.76 1385.98,-2168.54 1346.14,-2157.01"/>
<polygon fill="black" stroke="black" points="1346.88,-2153.58 1336.3,-2154.16 1344.93,-2160.3 1346.88,-2153.58"/>
</g>
<!-- tp_comm_layer_0_expert_8&#45;&gt;agg_layer_0 -->
<g id="edge29" class="edge">
<title>tp_comm_layer_0_expert_8&#45;&gt;agg_layer_0</title>
<path fill="none" stroke="black" d="M1245.43,-2120.04C1222.87,-2110.2 1193.22,-2097.26 1163.38,-2084.24"/>
<polygon fill="black" stroke="black" points="1164.69,-2081 1154.12,-2080.2 1161.89,-2087.41 1164.69,-2081"/>
</g>
<!-- expert_layer_0_expert_15_tp_0 -->
<g id="node20" class="node">
<title>expert_layer_0_expert_15_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="1986,-2248.52 1720,-2248.52 1720,-2196.52 1986,-2196.52 1986,-2248.52"/>
<text text-anchor="middle" x="1853" y="-2236.52" font-family="Arial" font-size="10.00">Expert 15 TP0</text>
<text text-anchor="middle" x="1853" y="-2225.52" font-family="Arial" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1853" y="-2214.52" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1853" y="-2203.52" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_0_expert_15_tp_0&#45;&gt;expert_layer_0_expert_15_tp_0 -->
<g id="edge22" class="edge">
<title>route_comm_layer_0_expert_15_tp_0&#45;&gt;expert_layer_0_expert_15_tp_0</title>
<path fill="none" stroke="black" d="M1727.33,-2287.7C1747.1,-2277.6 1772.24,-2264.76 1794.84,-2253.22"/>
<polygon fill="black" stroke="black" points="1796.7,-2256.2 1804.01,-2248.54 1793.51,-2249.97 1796.7,-2256.2"/>
</g>
<!-- tp_comm_layer_0_expert_15 -->
<g id="node23" class="node">
<title>tp_comm_layer_0_expert_15</title>
<ellipse fill="lightblue" stroke="black" cx="1853" cy="-2138.31" rx="76.24" ry="21.43"/>
<text text-anchor="middle" x="1853" y="-2141.31" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1853" y="-2130.31" font-family="Arial" font-size="10.00">GPU 30 &lt;&#45;&gt; GPU 31</text>
</g>
<!-- expert_layer_0_expert_15_tp_0&#45;&gt;tp_comm_layer_0_expert_15 -->
<g id="edge25" class="edge">
<title>expert_layer_0_expert_15_tp_0&#45;&gt;tp_comm_layer_0_expert_15</title>
<path fill="none" stroke="black" d="M1853,-2196.41C1853,-2188.02 1853,-2178.57 1853,-2169.81"/>
<polygon fill="black" stroke="black" points="1856.5,-2169.59 1853,-2159.59 1849.5,-2169.59 1856.5,-2169.59"/>
</g>
<!-- expert_layer_0_expert_15_tp_1 -->
<g id="node22" class="node">
<title>expert_layer_0_expert_15_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="2270,-2248.52 2004,-2248.52 2004,-2196.52 2270,-2196.52 2270,-2248.52"/>
<text text-anchor="middle" x="2137" y="-2236.52" font-family="Arial" font-size="10.00">Expert 15 TP1</text>
<text text-anchor="middle" x="2137" y="-2225.52" font-family="Arial" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="2137" y="-2214.52" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="2137" y="-2203.52" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_0_expert_15_tp_1&#45;&gt;expert_layer_0_expert_15_tp_1 -->
<g id="edge24" class="edge">
<title>route_comm_layer_0_expert_15_tp_1&#45;&gt;expert_layer_0_expert_15_tp_1</title>
<path fill="none" stroke="black" d="M1931.17,-2289.89C1964.73,-2279.07 2010.11,-2264.44 2049.72,-2251.66"/>
<polygon fill="black" stroke="black" points="2050.94,-2254.95 2059.39,-2248.55 2048.8,-2248.28 2050.94,-2254.95"/>
</g>
<!-- expert_layer_0_expert_15_tp_1&#45;&gt;tp_comm_layer_0_expert_15 -->
<g id="edge26" class="edge">
<title>expert_layer_0_expert_15_tp_1&#45;&gt;tp_comm_layer_0_expert_15</title>
<path fill="none" stroke="black" d="M2050.63,-2196.52C2006.55,-2183.76 1953.98,-2168.54 1914.14,-2157.01"/>
<polygon fill="black" stroke="black" points="1914.88,-2153.58 1904.3,-2154.16 1912.93,-2160.3 1914.88,-2153.58"/>
</g>
<!-- tp_comm_layer_0_expert_15&#45;&gt;agg_layer_0 -->
<g id="edge30" class="edge">
<title>tp_comm_layer_0_expert_15&#45;&gt;agg_layer_0</title>
<path fill="none" stroke="black" d="M1785.53,-2128.36C1697.81,-2116.73 1538.12,-2095.55 1388.7,-2075.74"/>
<polygon fill="black" stroke="black" points="1388.79,-2072.22 1378.42,-2074.37 1387.87,-2079.16 1388.79,-2072.22"/>
</g>
<!-- mha_layer_1 -->
<g id="node25" class="node">
<title>mha_layer_1</title>
<polygon fill="lightgreen" stroke="black" points="1171,-1939.1 903,-1939.1 903,-1887.1 1171,-1887.1 1171,-1939.1"/>
<text text-anchor="middle" x="1037" y="-1927.1" font-family="Arial" font-size="10.00">MHA Layer 1</text>
<text text-anchor="middle" x="1037" y="-1916.1" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1037" y="-1905.1" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1037" y="-1894.1" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- agg_layer_0&#45;&gt;mha_layer_1 -->
<g id="edge31" class="edge">
<title>agg_layer_0&#45;&gt;mha_layer_1</title>
<path fill="none" stroke="black" d="M1037,-1975.89C1037,-1966.94 1037,-1957.81 1037,-1949.41"/>
<polygon fill="black" stroke="black" points="1040.5,-1949.23 1037,-1939.23 1033.5,-1949.23 1040.5,-1949.23"/>
</g>
<!-- gate_layer_1 -->
<g id="node26" class="node">
<title>gate_layer_1</title>
<polygon fill="lightyellow" stroke="black" points="1313.63,-1850.1 873.58,-1850.1 760.37,-1746.1 1200.42,-1746.1 1313.63,-1850.1"/>
<text text-anchor="middle" x="1037" y="-1812.1" font-family="Arial" font-size="10.00">Gate Layer 1</text>
<text text-anchor="middle" x="1037" y="-1801.1" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1037" y="-1790.1" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1037" y="-1779.1" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, num_experts=16]</text>
</g>
<!-- mha_layer_1&#45;&gt;gate_layer_1 -->
<g id="edge32" class="edge">
<title>mha_layer_1&#45;&gt;gate_layer_1</title>
<path fill="none" stroke="black" d="M1037,-1887.02C1037,-1879.09 1037,-1869.96 1037,-1860.64"/>
<polygon fill="black" stroke="black" points="1040.5,-1860.5 1037,-1850.5 1033.5,-1860.5 1040.5,-1860.5"/>
</g>
<!-- route_comm_layer_1_expert_0_tp_0 -->
<g id="node27" class="node">
<title>route_comm_layer_1_expert_0_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="206" cy="-1687.88" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="206" y="-1690.88" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="206" y="-1679.88" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 0</text>
</g>
<!-- gate_layer_1&#45;&gt;route_comm_layer_1_expert_0_tp_0 -->
<g id="edge33" class="edge">
<title>gate_layer_1&#45;&gt;route_comm_layer_1_expert_0_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M779.19,-1763.53C608.43,-1741.29 395.95,-1713.62 283.77,-1699.01"/>
<polygon fill="black" stroke="black" points="283.93,-1695.5 273.57,-1697.68 283.03,-1702.44 283.93,-1695.5"/>
</g>
<!-- route_comm_layer_1_expert_0_tp_1 -->
<g id="node29" class="node">
<title>route_comm_layer_1_expert_0_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="553" cy="-1687.88" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="553" y="-1690.88" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="553" y="-1679.88" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 1</text>
</g>
<!-- gate_layer_1&#45;&gt;route_comm_layer_1_expert_0_tp_1 -->
<g id="edge35" class="edge">
<title>gate_layer_1&#45;&gt;route_comm_layer_1_expert_0_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M808.82,-1746.08C740.06,-1730.71 669.82,-1715 620.37,-1703.95"/>
<polygon fill="black" stroke="black" points="620.98,-1700.5 610.46,-1701.73 619.45,-1707.33 620.98,-1700.5"/>
</g>
<!-- route_comm_layer_1_expert_1_tp_0 -->
<g id="node32" class="node">
<title>route_comm_layer_1_expert_1_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="811" cy="-1687.88" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="811" y="-1690.88" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="811" y="-1679.88" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 2</text>
</g>
<!-- gate_layer_1&#45;&gt;route_comm_layer_1_expert_1_tp_0 -->
<g id="edge39" class="edge">
<title>gate_layer_1&#45;&gt;route_comm_layer_1_expert_1_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M930.29,-1746C904.5,-1733.65 878.28,-1721.1 857.01,-1710.92"/>
<polygon fill="black" stroke="black" points="858.44,-1707.72 847.91,-1706.56 855.42,-1714.03 858.44,-1707.72"/>
</g>
<!-- route_comm_layer_1_expert_1_tp_1 -->
<g id="node34" class="node">
<title>route_comm_layer_1_expert_1_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1025" cy="-1687.88" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="1025" y="-1690.88" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1025" y="-1679.88" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 3</text>
</g>
<!-- gate_layer_1&#45;&gt;route_comm_layer_1_expert_1_tp_1 -->
<g id="edge41" class="edge">
<title>gate_layer_1&#45;&gt;route_comm_layer_1_expert_1_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1031.32,-1745.84C1030.3,-1736.7 1029.28,-1727.45 1028.36,-1719.14"/>
<polygon fill="black" stroke="black" points="1031.83,-1718.75 1027.25,-1709.19 1024.88,-1719.52 1031.83,-1718.75"/>
</g>
<!-- route_comm_layer_1_expert_8_tp_0 -->
<g id="node37" class="node">
<title>route_comm_layer_1_expert_8_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="1248" cy="-1687.88" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1248" y="-1690.88" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1248" y="-1679.88" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 16</text>
</g>
<!-- gate_layer_1&#45;&gt;route_comm_layer_1_expert_8_tp_0 -->
<g id="edge45" class="edge">
<title>gate_layer_1&#45;&gt;route_comm_layer_1_expert_8_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1136.63,-1746C1160.21,-1733.91 1184.19,-1721.61 1203.82,-1711.54"/>
<polygon fill="black" stroke="black" points="1205.5,-1714.61 1212.8,-1706.94 1202.31,-1708.39 1205.5,-1714.61"/>
</g>
<!-- route_comm_layer_1_expert_8_tp_1 -->
<g id="node39" class="node">
<title>route_comm_layer_1_expert_8_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1471" cy="-1687.88" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1471" y="-1690.88" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1471" y="-1679.88" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 17</text>
</g>
<!-- gate_layer_1&#45;&gt;route_comm_layer_1_expert_8_tp_1 -->
<g id="edge47" class="edge">
<title>gate_layer_1&#45;&gt;route_comm_layer_1_expert_8_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1209.46,-1754.1C1278.01,-1737 1352.76,-1718.37 1404.72,-1705.41"/>
<polygon fill="black" stroke="black" points="1405.62,-1708.79 1414.48,-1702.98 1403.93,-1702 1405.62,-1708.79"/>
</g>
<!-- route_comm_layer_1_expert_15_tp_0 -->
<g id="node42" class="node">
<title>route_comm_layer_1_expert_15_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="1671" cy="-1687.88" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1671" y="-1690.88" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1671" y="-1679.88" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 30</text>
</g>
<!-- gate_layer_1&#45;&gt;route_comm_layer_1_expert_15_tp_0 -->
<g id="edge51" class="edge">
<title>gate_layer_1&#45;&gt;route_comm_layer_1_expert_15_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1222.88,-1766.45C1322.85,-1749.8 1448.22,-1728.68 1560,-1709.1 1572.03,-1706.99 1584.78,-1704.71 1597.19,-1702.47"/>
<polygon fill="black" stroke="black" points="1597.83,-1705.91 1607.05,-1700.68 1596.58,-1699.02 1597.83,-1705.91"/>
</g>
<!-- route_comm_layer_1_expert_15_tp_1 -->
<g id="node44" class="node">
<title>route_comm_layer_1_expert_15_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1860" cy="-1687.88" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1860" y="-1690.88" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1860" y="-1679.88" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 31</text>
</g>
<!-- gate_layer_1&#45;&gt;route_comm_layer_1_expert_15_tp_1 -->
<g id="edge53" class="edge">
<title>gate_layer_1&#45;&gt;route_comm_layer_1_expert_15_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1234.75,-1777.25C1380.4,-1761.61 1583.06,-1737.7 1760,-1709.1 1769.64,-1707.54 1779.76,-1705.71 1789.72,-1703.81"/>
<polygon fill="black" stroke="black" points="1790.44,-1707.24 1799.59,-1701.89 1789.11,-1700.36 1790.44,-1707.24"/>
</g>
<!-- expert_layer_1_expert_0_tp_0 -->
<g id="node28" class="node">
<title>expert_layer_1_expert_0_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="282,-1629.67 16,-1629.67 16,-1577.67 282,-1577.67 282,-1629.67"/>
<text text-anchor="middle" x="149" y="-1617.67" font-family="Arial" font-size="10.00">Expert 0 TP0</text>
<text text-anchor="middle" x="149" y="-1606.67" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="149" y="-1595.67" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="149" y="-1584.67" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_1_expert_0_tp_0&#45;&gt;expert_layer_1_expert_0_tp_0 -->
<g id="edge34" class="edge">
<title>route_comm_layer_1_expert_0_tp_0&#45;&gt;expert_layer_1_expert_0_tp_0</title>
<path fill="none" stroke="black" d="M192.2,-1666.98C186.19,-1658.31 178.97,-1647.9 172.17,-1638.1"/>
<polygon fill="black" stroke="black" points="174.92,-1635.92 166.35,-1629.69 169.17,-1639.91 174.92,-1635.92"/>
</g>
<!-- tp_comm_layer_1_expert_0 -->
<g id="node31" class="node">
<title>tp_comm_layer_1_expert_0</title>
<ellipse fill="lightblue" stroke="black" cx="433" cy="-1519.46" rx="69.09" ry="21.43"/>
<text text-anchor="middle" x="433" y="-1522.46" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="433" y="-1511.46" font-family="Arial" font-size="10.00">GPU 0 &lt;&#45;&gt; GPU 1</text>
</g>
<!-- expert_layer_1_expert_0_tp_0&#45;&gt;tp_comm_layer_1_expert_0 -->
<g id="edge37" class="edge">
<title>expert_layer_1_expert_0_tp_0&#45;&gt;tp_comm_layer_1_expert_0</title>
<path fill="none" stroke="black" d="M235.37,-1577.67C280.44,-1564.62 334.41,-1549 374.55,-1537.38"/>
<polygon fill="black" stroke="black" points="375.55,-1540.73 384.18,-1534.59 373.6,-1534.01 375.55,-1540.73"/>
</g>
<!-- expert_layer_1_expert_0_tp_1 -->
<g id="node30" class="node">
<title>expert_layer_1_expert_0_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="566,-1629.67 300,-1629.67 300,-1577.67 566,-1577.67 566,-1629.67"/>
<text text-anchor="middle" x="433" y="-1617.67" font-family="Arial" font-size="10.00">Expert 0 TP1</text>
<text text-anchor="middle" x="433" y="-1606.67" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="433" y="-1595.67" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="433" y="-1584.67" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_1_expert_0_tp_1&#45;&gt;expert_layer_1_expert_0_tp_1 -->
<g id="edge36" class="edge">
<title>route_comm_layer_1_expert_0_tp_1&#45;&gt;expert_layer_1_expert_0_tp_1</title>
<path fill="none" stroke="black" d="M525.47,-1668.02C511.46,-1658.42 494.06,-1646.51 478.16,-1635.61"/>
<polygon fill="black" stroke="black" points="479.73,-1632.44 469.5,-1629.68 475.77,-1638.22 479.73,-1632.44"/>
</g>
<!-- expert_layer_1_expert_0_tp_1&#45;&gt;tp_comm_layer_1_expert_0 -->
<g id="edge38" class="edge">
<title>expert_layer_1_expert_0_tp_1&#45;&gt;tp_comm_layer_1_expert_0</title>
<path fill="none" stroke="black" d="M433,-1577.56C433,-1569.16 433,-1559.72 433,-1550.96"/>
<polygon fill="black" stroke="black" points="436.5,-1550.74 433,-1540.74 429.5,-1550.74 436.5,-1550.74"/>
</g>
<!-- agg_layer_1 -->
<g id="node47" class="node">
<title>agg_layer_1</title>
<polygon fill="lightyellow" stroke="black" points="1423.27,-1461.24 867.66,-1461.24 724.73,-1357.24 1280.34,-1357.24 1423.27,-1461.24"/>
<text text-anchor="middle" x="1074" y="-1423.24" font-family="Arial" font-size="10.00">Expert Aggregation Layer 1</text>
<text text-anchor="middle" x="1074" y="-1412.24" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1074" y="-1401.24" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, num_experts=16, hidden_dim=512]</text>
<text text-anchor="middle" x="1074" y="-1390.24" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- tp_comm_layer_1_expert_0&#45;&gt;agg_layer_1 -->
<g id="edge57" class="edge">
<title>tp_comm_layer_1_expert_0&#45;&gt;agg_layer_1</title>
<path fill="none" stroke="black" d="M492.44,-1508.42C571.16,-1495.13 714.6,-1470.92 839.32,-1449.86"/>
<polygon fill="black" stroke="black" points="840.13,-1453.28 849.41,-1448.16 838.97,-1446.37 840.13,-1453.28"/>
</g>
<!-- expert_layer_1_expert_1_tp_0 -->
<g id="node33" class="node">
<title>expert_layer_1_expert_1_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="850,-1629.67 584,-1629.67 584,-1577.67 850,-1577.67 850,-1629.67"/>
<text text-anchor="middle" x="717" y="-1617.67" font-family="Arial" font-size="10.00">Expert 1 TP0</text>
<text text-anchor="middle" x="717" y="-1606.67" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="717" y="-1595.67" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="717" y="-1584.67" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_1_expert_1_tp_0&#45;&gt;expert_layer_1_expert_1_tp_0 -->
<g id="edge40" class="edge">
<title>route_comm_layer_1_expert_1_tp_0&#45;&gt;expert_layer_1_expert_1_tp_0</title>
<path fill="none" stroke="black" d="M788.72,-1667.4C778.21,-1658.21 765.4,-1647 753.52,-1636.61"/>
<polygon fill="black" stroke="black" points="755.72,-1633.88 745.89,-1629.94 751.11,-1639.15 755.72,-1633.88"/>
</g>
<!-- tp_comm_layer_1_expert_1 -->
<g id="node36" class="node">
<title>tp_comm_layer_1_expert_1</title>
<ellipse fill="lightblue" stroke="black" cx="1001" cy="-1519.46" rx="69.09" ry="21.43"/>
<text text-anchor="middle" x="1001" y="-1522.46" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1001" y="-1511.46" font-family="Arial" font-size="10.00">GPU 2 &lt;&#45;&gt; GPU 3</text>
</g>
<!-- expert_layer_1_expert_1_tp_0&#45;&gt;tp_comm_layer_1_expert_1 -->
<g id="edge43" class="edge">
<title>expert_layer_1_expert_1_tp_0&#45;&gt;tp_comm_layer_1_expert_1</title>
<path fill="none" stroke="black" d="M803.37,-1577.67C848.44,-1564.62 902.41,-1549 942.55,-1537.38"/>
<polygon fill="black" stroke="black" points="943.55,-1540.73 952.18,-1534.59 941.6,-1534.01 943.55,-1540.73"/>
</g>
<!-- expert_layer_1_expert_1_tp_1 -->
<g id="node35" class="node">
<title>expert_layer_1_expert_1_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="1134,-1629.67 868,-1629.67 868,-1577.67 1134,-1577.67 1134,-1629.67"/>
<text text-anchor="middle" x="1001" y="-1617.67" font-family="Arial" font-size="10.00">Expert 1 TP1</text>
<text text-anchor="middle" x="1001" y="-1606.67" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1001" y="-1595.67" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1001" y="-1584.67" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_1_expert_1_tp_1&#45;&gt;expert_layer_1_expert_1_tp_1 -->
<g id="edge42" class="edge">
<title>route_comm_layer_1_expert_1_tp_1&#45;&gt;expert_layer_1_expert_1_tp_1</title>
<path fill="none" stroke="black" d="M1019.07,-1666.56C1016.68,-1658.39 1013.86,-1648.73 1011.17,-1639.51"/>
<polygon fill="black" stroke="black" points="1014.48,-1638.37 1008.32,-1629.75 1007.77,-1640.33 1014.48,-1638.37"/>
</g>
<!-- expert_layer_1_expert_1_tp_1&#45;&gt;tp_comm_layer_1_expert_1 -->
<g id="edge44" class="edge">
<title>expert_layer_1_expert_1_tp_1&#45;&gt;tp_comm_layer_1_expert_1</title>
<path fill="none" stroke="black" d="M1001,-1577.56C1001,-1569.16 1001,-1559.72 1001,-1550.96"/>
<polygon fill="black" stroke="black" points="1004.5,-1550.74 1001,-1540.74 997.5,-1550.74 1004.5,-1550.74"/>
</g>
<!-- tp_comm_layer_1_expert_1&#45;&gt;agg_layer_1 -->
<g id="edge58" class="edge">
<title>tp_comm_layer_1_expert_1&#45;&gt;agg_layer_1</title>
<path fill="none" stroke="black" d="M1014.39,-1498.61C1019.98,-1490.33 1026.79,-1480.23 1033.79,-1469.86"/>
<polygon fill="black" stroke="black" points="1036.73,-1471.76 1039.42,-1461.51 1030.92,-1467.84 1036.73,-1471.76"/>
</g>
<!-- expert_layer_1_expert_8_tp_0 -->
<g id="node38" class="node">
<title>expert_layer_1_expert_8_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="1418,-1629.67 1152,-1629.67 1152,-1577.67 1418,-1577.67 1418,-1629.67"/>
<text text-anchor="middle" x="1285" y="-1617.67" font-family="Arial" font-size="10.00">Expert 8 TP0</text>
<text text-anchor="middle" x="1285" y="-1606.67" font-family="Arial" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1285" y="-1595.67" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1285" y="-1584.67" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_1_expert_8_tp_0&#45;&gt;expert_layer_1_expert_8_tp_0 -->
<g id="edge46" class="edge">
<title>route_comm_layer_1_expert_8_tp_0&#45;&gt;expert_layer_1_expert_8_tp_0</title>
<path fill="none" stroke="black" d="M1257.15,-1666.56C1260.9,-1658.22 1265.36,-1648.32 1269.59,-1638.92"/>
<polygon fill="black" stroke="black" points="1272.8,-1640.31 1273.71,-1629.75 1266.42,-1637.44 1272.8,-1640.31"/>
</g>
<!-- tp_comm_layer_1_expert_8 -->
<g id="node41" class="node">
<title>tp_comm_layer_1_expert_8</title>
<ellipse fill="lightblue" stroke="black" cx="1285" cy="-1519.46" rx="76.24" ry="21.43"/>
<text text-anchor="middle" x="1285" y="-1522.46" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1285" y="-1511.46" font-family="Arial" font-size="10.00">GPU 16 &lt;&#45;&gt; GPU 17</text>
</g>
<!-- expert_layer_1_expert_8_tp_0&#45;&gt;tp_comm_layer_1_expert_8 -->
<g id="edge49" class="edge">
<title>expert_layer_1_expert_8_tp_0&#45;&gt;tp_comm_layer_1_expert_8</title>
<path fill="none" stroke="black" d="M1285,-1577.56C1285,-1569.16 1285,-1559.72 1285,-1550.96"/>
<polygon fill="black" stroke="black" points="1288.5,-1550.74 1285,-1540.74 1281.5,-1550.74 1288.5,-1550.74"/>
</g>
<!-- expert_layer_1_expert_8_tp_1 -->
<g id="node40" class="node">
<title>expert_layer_1_expert_8_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="1702,-1629.67 1436,-1629.67 1436,-1577.67 1702,-1577.67 1702,-1629.67"/>
<text text-anchor="middle" x="1569" y="-1617.67" font-family="Arial" font-size="10.00">Expert 8 TP1</text>
<text text-anchor="middle" x="1569" y="-1606.67" font-family="Arial" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1569" y="-1595.67" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1569" y="-1584.67" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_1_expert_8_tp_1&#45;&gt;expert_layer_1_expert_8_tp_1 -->
<g id="edge48" class="edge">
<title>route_comm_layer_1_expert_8_tp_1&#45;&gt;expert_layer_1_expert_8_tp_1</title>
<path fill="none" stroke="black" d="M1494.22,-1667.4C1505.18,-1658.21 1518.54,-1647 1530.93,-1636.61"/>
<polygon fill="black" stroke="black" points="1533.47,-1639.04 1538.88,-1629.94 1528.97,-1633.68 1533.47,-1639.04"/>
</g>
<!-- expert_layer_1_expert_8_tp_1&#45;&gt;tp_comm_layer_1_expert_8 -->
<g id="edge50" class="edge">
<title>expert_layer_1_expert_8_tp_1&#45;&gt;tp_comm_layer_1_expert_8</title>
<path fill="none" stroke="black" d="M1482.63,-1577.67C1438.55,-1564.91 1385.98,-1549.69 1346.14,-1538.16"/>
<polygon fill="black" stroke="black" points="1346.88,-1534.73 1336.3,-1535.31 1344.93,-1541.45 1346.88,-1534.73"/>
</g>
<!-- tp_comm_layer_1_expert_8&#45;&gt;agg_layer_1 -->
<g id="edge59" class="edge">
<title>tp_comm_layer_1_expert_8&#45;&gt;agg_layer_1</title>
<path fill="none" stroke="black" d="M1249.68,-1500.35C1230.98,-1490.75 1206.89,-1478.4 1182.58,-1465.93"/>
<polygon fill="black" stroke="black" points="1184.12,-1462.79 1173.63,-1461.34 1180.93,-1469.02 1184.12,-1462.79"/>
</g>
<!-- expert_layer_1_expert_15_tp_0 -->
<g id="node43" class="node">
<title>expert_layer_1_expert_15_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="1986,-1629.67 1720,-1629.67 1720,-1577.67 1986,-1577.67 1986,-1629.67"/>
<text text-anchor="middle" x="1853" y="-1617.67" font-family="Arial" font-size="10.00">Expert 15 TP0</text>
<text text-anchor="middle" x="1853" y="-1606.67" font-family="Arial" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1853" y="-1595.67" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1853" y="-1584.67" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_1_expert_15_tp_0&#45;&gt;expert_layer_1_expert_15_tp_0 -->
<g id="edge52" class="edge">
<title>route_comm_layer_1_expert_15_tp_0&#45;&gt;expert_layer_1_expert_15_tp_0</title>
<path fill="none" stroke="black" d="M1710.04,-1669.25C1732.74,-1658.99 1761.93,-1645.81 1788,-1634.03"/>
<polygon fill="black" stroke="black" points="1789.78,-1637.07 1797.45,-1629.77 1786.89,-1630.69 1789.78,-1637.07"/>
</g>
<!-- tp_comm_layer_1_expert_15 -->
<g id="node46" class="node">
<title>tp_comm_layer_1_expert_15</title>
<ellipse fill="lightblue" stroke="black" cx="1853" cy="-1519.46" rx="76.24" ry="21.43"/>
<text text-anchor="middle" x="1853" y="-1522.46" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1853" y="-1511.46" font-family="Arial" font-size="10.00">GPU 30 &lt;&#45;&gt; GPU 31</text>
</g>
<!-- expert_layer_1_expert_15_tp_0&#45;&gt;tp_comm_layer_1_expert_15 -->
<g id="edge55" class="edge">
<title>expert_layer_1_expert_15_tp_0&#45;&gt;tp_comm_layer_1_expert_15</title>
<path fill="none" stroke="black" d="M1853,-1577.56C1853,-1569.16 1853,-1559.72 1853,-1550.96"/>
<polygon fill="black" stroke="black" points="1856.5,-1550.74 1853,-1540.74 1849.5,-1550.74 1856.5,-1550.74"/>
</g>
<!-- expert_layer_1_expert_15_tp_1 -->
<g id="node45" class="node">
<title>expert_layer_1_expert_15_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="2270,-1629.67 2004,-1629.67 2004,-1577.67 2270,-1577.67 2270,-1629.67"/>
<text text-anchor="middle" x="2137" y="-1617.67" font-family="Arial" font-size="10.00">Expert 15 TP1</text>
<text text-anchor="middle" x="2137" y="-1606.67" font-family="Arial" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="2137" y="-1595.67" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="2137" y="-1584.67" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_1_expert_15_tp_1&#45;&gt;expert_layer_1_expert_15_tp_1 -->
<g id="edge54" class="edge">
<title>route_comm_layer_1_expert_15_tp_1&#45;&gt;expert_layer_1_expert_15_tp_1</title>
<path fill="none" stroke="black" d="M1911.45,-1671.61C1948.25,-1660.69 1998.84,-1645.68 2042.78,-1632.63"/>
<polygon fill="black" stroke="black" points="2044.04,-1635.91 2052.63,-1629.71 2042.05,-1629.2 2044.04,-1635.91"/>
</g>
<!-- expert_layer_1_expert_15_tp_1&#45;&gt;tp_comm_layer_1_expert_15 -->
<g id="edge56" class="edge">
<title>expert_layer_1_expert_15_tp_1&#45;&gt;tp_comm_layer_1_expert_15</title>
<path fill="none" stroke="black" d="M2050.63,-1577.67C2006.55,-1564.91 1953.98,-1549.69 1914.14,-1538.16"/>
<polygon fill="black" stroke="black" points="1914.88,-1534.73 1904.3,-1535.31 1912.93,-1541.45 1914.88,-1534.73"/>
</g>
<!-- tp_comm_layer_1_expert_15&#45;&gt;agg_layer_1 -->
<g id="edge60" class="edge">
<title>tp_comm_layer_1_expert_15&#45;&gt;agg_layer_1</title>
<path fill="none" stroke="black" d="M1785.91,-1509.14C1705.53,-1497.97 1564.71,-1478.41 1429.42,-1459.62"/>
<polygon fill="black" stroke="black" points="1429.66,-1456.12 1419.27,-1458.21 1428.69,-1463.05 1429.66,-1456.12"/>
</g>
<!-- mha_layer_2 -->
<g id="node48" class="node">
<title>mha_layer_2</title>
<polygon fill="lightgreen" stroke="black" points="1208,-1320.24 940,-1320.24 940,-1268.24 1208,-1268.24 1208,-1320.24"/>
<text text-anchor="middle" x="1074" y="-1308.24" font-family="Arial" font-size="10.00">MHA Layer 2</text>
<text text-anchor="middle" x="1074" y="-1297.24" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1074" y="-1286.24" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1074" y="-1275.24" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- agg_layer_1&#45;&gt;mha_layer_2 -->
<g id="edge61" class="edge">
<title>agg_layer_1&#45;&gt;mha_layer_2</title>
<path fill="none" stroke="black" d="M1074,-1357.03C1074,-1348.08 1074,-1338.95 1074,-1330.56"/>
<polygon fill="black" stroke="black" points="1077.5,-1330.38 1074,-1320.38 1070.5,-1330.38 1077.5,-1330.38"/>
</g>
<!-- gate_layer_2 -->
<g id="node49" class="node">
<title>gate_layer_2</title>
<polygon fill="lightyellow" stroke="black" points="1350.63,-1231.24 910.58,-1231.24 797.37,-1127.24 1237.42,-1127.24 1350.63,-1231.24"/>
<text text-anchor="middle" x="1074" y="-1193.24" font-family="Arial" font-size="10.00">Gate Layer 2</text>
<text text-anchor="middle" x="1074" y="-1182.24" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1074" y="-1171.24" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1074" y="-1160.24" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, num_experts=16]</text>
</g>
<!-- mha_layer_2&#45;&gt;gate_layer_2 -->
<g id="edge62" class="edge">
<title>mha_layer_2&#45;&gt;gate_layer_2</title>
<path fill="none" stroke="black" d="M1074,-1268.17C1074,-1260.24 1074,-1251.1 1074,-1241.78"/>
<polygon fill="black" stroke="black" points="1077.5,-1241.65 1074,-1231.65 1070.5,-1241.65 1077.5,-1241.65"/>
</g>
<!-- route_comm_layer_2_expert_0_tp_0 -->
<g id="node50" class="node">
<title>route_comm_layer_2_expert_0_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="289" cy="-1069.03" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="289" y="-1072.03" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="289" y="-1061.03" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 0</text>
</g>
<!-- gate_layer_2&#45;&gt;route_comm_layer_2_expert_0_tp_0 -->
<g id="edge63" class="edge">
<title>gate_layer_2&#45;&gt;route_comm_layer_2_expert_0_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M817.15,-1145.68C694.93,-1129.76 546.8,-1109.83 414,-1090.24 397.43,-1087.8 379.65,-1085.02 362.85,-1082.32"/>
<polygon fill="black" stroke="black" points="362.97,-1078.8 352.54,-1080.66 361.85,-1085.71 362.97,-1078.8"/>
</g>
<!-- route_comm_layer_2_expert_0_tp_1 -->
<g id="node52" class="node">
<title>route_comm_layer_2_expert_0_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="499" cy="-1069.03" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="499" y="-1072.03" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="499" y="-1061.03" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 1</text>
</g>
<!-- gate_layer_2&#45;&gt;route_comm_layer_2_expert_0_tp_1 -->
<g id="edge65" class="edge">
<title>gate_layer_2&#45;&gt;route_comm_layer_2_expert_0_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M802.92,-1127.23C717.08,-1111.07 629.29,-1094.55 570.27,-1083.44"/>
<polygon fill="black" stroke="black" points="570.8,-1079.98 560.33,-1081.57 569.51,-1086.86 570.8,-1079.98"/>
</g>
<!-- route_comm_layer_2_expert_1_tp_0 -->
<g id="node55" class="node">
<title>route_comm_layer_2_expert_1_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="812" cy="-1069.03" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="812" y="-1072.03" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="812" y="-1061.03" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 2</text>
</g>
<!-- gate_layer_2&#45;&gt;route_comm_layer_2_expert_1_tp_0 -->
<g id="edge69" class="edge">
<title>gate_layer_2&#45;&gt;route_comm_layer_2_expert_1_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M950.29,-1127.15C919.16,-1114.29 887.47,-1101.2 862.3,-1090.81"/>
<polygon fill="black" stroke="black" points="863.56,-1087.54 852.99,-1086.96 860.89,-1094.01 863.56,-1087.54"/>
</g>
<!-- route_comm_layer_2_expert_1_tp_1 -->
<g id="node57" class="node">
<title>route_comm_layer_2_expert_1_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1053" cy="-1069.03" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="1053" y="-1072.03" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1053" y="-1061.03" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 3</text>
</g>
<!-- gate_layer_2&#45;&gt;route_comm_layer_2_expert_1_tp_1 -->
<g id="edge71" class="edge">
<title>gate_layer_2&#45;&gt;route_comm_layer_2_expert_1_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1064.05,-1126.99C1062.28,-1117.85 1060.48,-1108.6 1058.87,-1100.29"/>
<polygon fill="black" stroke="black" points="1062.28,-1099.49 1056.94,-1090.34 1055.41,-1100.82 1062.28,-1099.49"/>
</g>
<!-- route_comm_layer_2_expert_8_tp_0 -->
<g id="node60" class="node">
<title>route_comm_layer_2_expert_8_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="1253" cy="-1069.03" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1253" y="-1072.03" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1253" y="-1061.03" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 16</text>
</g>
<!-- gate_layer_2&#45;&gt;route_comm_layer_2_expert_8_tp_0 -->
<g id="edge75" class="edge">
<title>gate_layer_2&#45;&gt;route_comm_layer_2_expert_8_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.52,-1127.15C1177.61,-1115.61 1197.01,-1103.88 1213.22,-1094.08"/>
<polygon fill="black" stroke="black" points="1215.13,-1097.02 1221.88,-1088.85 1211.51,-1091.02 1215.13,-1097.02"/>
</g>
<!-- route_comm_layer_2_expert_8_tp_1 -->
<g id="node62" class="node">
<title>route_comm_layer_2_expert_8_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1497" cy="-1069.03" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1497" y="-1072.03" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1497" y="-1061.03" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 17</text>
</g>
<!-- gate_layer_2&#45;&gt;route_comm_layer_2_expert_8_tp_1 -->
<g id="edge77" class="edge">
<title>gate_layer_2&#45;&gt;route_comm_layer_2_expert_8_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1245.44,-1134.39C1310.79,-1117.67 1381.43,-1099.6 1431.17,-1086.87"/>
<polygon fill="black" stroke="black" points="1432.32,-1090.19 1441.14,-1084.32 1430.59,-1083.41 1432.32,-1090.19"/>
</g>
<!-- route_comm_layer_2_expert_15_tp_0 -->
<g id="node65" class="node">
<title>route_comm_layer_2_expert_15_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="1761" cy="-1069.03" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1761" y="-1072.03" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1761" y="-1061.03" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 30</text>
</g>
<!-- gate_layer_2&#45;&gt;route_comm_layer_2_expert_15_tp_0 -->
<g id="edge81" class="edge">
<title>gate_layer_2&#45;&gt;route_comm_layer_2_expert_15_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1261.27,-1148.75C1400.08,-1126.88 1582.13,-1098.21 1683.78,-1082.19"/>
<polygon fill="black" stroke="black" points="1684.33,-1085.65 1693.67,-1080.64 1683.24,-1078.74 1684.33,-1085.65"/>
</g>
<!-- route_comm_layer_2_expert_15_tp_1 -->
<g id="node67" class="node">
<title>route_comm_layer_2_expert_15_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="2035" cy="-1069.03" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="2035" y="-1072.03" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="2035" y="-1061.03" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 31</text>
</g>
<!-- gate_layer_2&#45;&gt;route_comm_layer_2_expert_15_tp_1 -->
<g id="edge83" class="edge">
<title>gate_layer_2&#45;&gt;route_comm_layer_2_expert_15_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1269.05,-1156.28C1478.75,-1132.67 1802.21,-1096.24 1952.73,-1079.3"/>
<polygon fill="black" stroke="black" points="1953.28,-1082.76 1962.82,-1078.16 1952.5,-1075.8 1953.28,-1082.76"/>
</g>
<!-- expert_layer_2_expert_0_tp_0 -->
<g id="node51" class="node">
<title>expert_layer_2_expert_0_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="282,-1010.82 16,-1010.82 16,-958.82 282,-958.82 282,-1010.82"/>
<text text-anchor="middle" x="149" y="-998.82" font-family="Arial" font-size="10.00">Expert 0 TP0</text>
<text text-anchor="middle" x="149" y="-987.82" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="149" y="-976.82" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="149" y="-965.82" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_2_expert_0_tp_0&#45;&gt;expert_layer_2_expert_0_tp_0 -->
<g id="edge64" class="edge">
<title>route_comm_layer_2_expert_0_tp_0&#45;&gt;expert_layer_2_expert_0_tp_0</title>
<path fill="none" stroke="black" d="M257.58,-1049.58C240.73,-1039.69 219.55,-1027.25 200.37,-1015.99"/>
<polygon fill="black" stroke="black" points="202.12,-1012.96 191.73,-1010.91 198.58,-1018.99 202.12,-1012.96"/>
</g>
<!-- tp_comm_layer_2_expert_0 -->
<g id="node54" class="node">
<title>tp_comm_layer_2_expert_0</title>
<ellipse fill="lightblue" stroke="black" cx="433" cy="-900.61" rx="69.09" ry="21.43"/>
<text text-anchor="middle" x="433" y="-903.61" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="433" y="-892.61" font-family="Arial" font-size="10.00">GPU 0 &lt;&#45;&gt; GPU 1</text>
</g>
<!-- expert_layer_2_expert_0_tp_0&#45;&gt;tp_comm_layer_2_expert_0 -->
<g id="edge67" class="edge">
<title>expert_layer_2_expert_0_tp_0&#45;&gt;tp_comm_layer_2_expert_0</title>
<path fill="none" stroke="black" d="M235.37,-958.82C280.44,-945.77 334.41,-930.15 374.55,-918.53"/>
<polygon fill="black" stroke="black" points="375.55,-921.88 384.18,-915.74 373.6,-915.16 375.55,-921.88"/>
</g>
<!-- expert_layer_2_expert_0_tp_1 -->
<g id="node53" class="node">
<title>expert_layer_2_expert_0_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="566,-1010.82 300,-1010.82 300,-958.82 566,-958.82 566,-1010.82"/>
<text text-anchor="middle" x="433" y="-998.82" font-family="Arial" font-size="10.00">Expert 0 TP1</text>
<text text-anchor="middle" x="433" y="-987.82" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="433" y="-976.82" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="433" y="-965.82" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_2_expert_0_tp_1&#45;&gt;expert_layer_2_expert_0_tp_1 -->
<g id="edge66" class="edge">
<title>route_comm_layer_2_expert_0_tp_1&#45;&gt;expert_layer_2_expert_0_tp_1</title>
<path fill="none" stroke="black" d="M483.02,-1048.13C475.92,-1039.28 467.37,-1028.63 459.36,-1018.65"/>
<polygon fill="black" stroke="black" points="462.08,-1016.45 453.09,-1010.84 456.62,-1020.83 462.08,-1016.45"/>
</g>
<!-- expert_layer_2_expert_0_tp_1&#45;&gt;tp_comm_layer_2_expert_0 -->
<g id="edge68" class="edge">
<title>expert_layer_2_expert_0_tp_1&#45;&gt;tp_comm_layer_2_expert_0</title>
<path fill="none" stroke="black" d="M433,-958.7C433,-950.31 433,-940.87 433,-932.11"/>
<polygon fill="black" stroke="black" points="436.5,-931.88 433,-921.88 429.5,-931.88 436.5,-931.88"/>
</g>
<!-- agg_layer_2 -->
<g id="node70" class="node">
<title>agg_layer_2</title>
<polygon fill="lightyellow" stroke="black" points="1371.27,-842.39 815.66,-842.39 672.73,-738.39 1228.34,-738.39 1371.27,-842.39"/>
<text text-anchor="middle" x="1022" y="-804.39" font-family="Arial" font-size="10.00">Expert Aggregation Layer 2</text>
<text text-anchor="middle" x="1022" y="-793.39" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1022" y="-782.39" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, num_experts=16, hidden_dim=512]</text>
<text text-anchor="middle" x="1022" y="-771.39" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- tp_comm_layer_2_expert_0&#45;&gt;agg_layer_2 -->
<g id="edge87" class="edge">
<title>tp_comm_layer_2_expert_0&#45;&gt;agg_layer_2</title>
<path fill="none" stroke="black" d="M491.09,-888.93C560.88,-876.11 682.25,-853.81 791.33,-833.77"/>
<polygon fill="black" stroke="black" points="791.97,-837.21 801.18,-831.96 790.71,-830.33 791.97,-837.21"/>
</g>
<!-- expert_layer_2_expert_1_tp_0 -->
<g id="node56" class="node">
<title>expert_layer_2_expert_1_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="850,-1010.82 584,-1010.82 584,-958.82 850,-958.82 850,-1010.82"/>
<text text-anchor="middle" x="717" y="-998.82" font-family="Arial" font-size="10.00">Expert 1 TP0</text>
<text text-anchor="middle" x="717" y="-987.82" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="717" y="-976.82" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="717" y="-965.82" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_2_expert_1_tp_0&#45;&gt;expert_layer_2_expert_1_tp_0 -->
<g id="edge70" class="edge">
<title>route_comm_layer_2_expert_1_tp_0&#45;&gt;expert_layer_2_expert_1_tp_0</title>
<path fill="none" stroke="black" d="M789.49,-1048.55C778.86,-1039.36 765.91,-1028.15 753.91,-1017.76"/>
<polygon fill="black" stroke="black" points="756.05,-1014.98 746.19,-1011.08 751.46,-1020.27 756.05,-1014.98"/>
</g>
<!-- tp_comm_layer_2_expert_1 -->
<g id="node59" class="node">
<title>tp_comm_layer_2_expert_1</title>
<ellipse fill="lightblue" stroke="black" cx="1001" cy="-900.61" rx="69.09" ry="21.43"/>
<text text-anchor="middle" x="1001" y="-903.61" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1001" y="-892.61" font-family="Arial" font-size="10.00">GPU 2 &lt;&#45;&gt; GPU 3</text>
</g>
<!-- expert_layer_2_expert_1_tp_0&#45;&gt;tp_comm_layer_2_expert_1 -->
<g id="edge73" class="edge">
<title>expert_layer_2_expert_1_tp_0&#45;&gt;tp_comm_layer_2_expert_1</title>
<path fill="none" stroke="black" d="M803.37,-958.82C848.44,-945.77 902.41,-930.15 942.55,-918.53"/>
<polygon fill="black" stroke="black" points="943.55,-921.88 952.18,-915.74 941.6,-915.16 943.55,-921.88"/>
</g>
<!-- expert_layer_2_expert_1_tp_1 -->
<g id="node58" class="node">
<title>expert_layer_2_expert_1_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="1134,-1010.82 868,-1010.82 868,-958.82 1134,-958.82 1134,-1010.82"/>
<text text-anchor="middle" x="1001" y="-998.82" font-family="Arial" font-size="10.00">Expert 1 TP1</text>
<text text-anchor="middle" x="1001" y="-987.82" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1001" y="-976.82" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1001" y="-965.82" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_2_expert_1_tp_1&#45;&gt;expert_layer_2_expert_1_tp_1 -->
<g id="edge72" class="edge">
<title>route_comm_layer_2_expert_1_tp_1&#45;&gt;expert_layer_2_expert_1_tp_1</title>
<path fill="none" stroke="black" d="M1040.15,-1047.71C1034.76,-1039.19 1028.35,-1029.06 1022.29,-1019.48"/>
<polygon fill="black" stroke="black" points="1025.17,-1017.48 1016.87,-1010.9 1019.25,-1021.22 1025.17,-1017.48"/>
</g>
<!-- expert_layer_2_expert_1_tp_1&#45;&gt;tp_comm_layer_2_expert_1 -->
<g id="edge74" class="edge">
<title>expert_layer_2_expert_1_tp_1&#45;&gt;tp_comm_layer_2_expert_1</title>
<path fill="none" stroke="black" d="M1001,-958.7C1001,-950.31 1001,-940.87 1001,-932.11"/>
<polygon fill="black" stroke="black" points="1004.5,-931.88 1001,-921.88 997.5,-931.88 1004.5,-931.88"/>
</g>
<!-- tp_comm_layer_2_expert_1&#45;&gt;agg_layer_2 -->
<g id="edge88" class="edge">
<title>tp_comm_layer_2_expert_1&#45;&gt;agg_layer_2</title>
<path fill="none" stroke="black" d="M1004.95,-879.25C1006.45,-871.53 1008.24,-862.27 1010.1,-852.71"/>
<polygon fill="black" stroke="black" points="1013.58,-853.18 1012.04,-842.69 1006.7,-851.84 1013.58,-853.18"/>
</g>
<!-- expert_layer_2_expert_8_tp_0 -->
<g id="node61" class="node">
<title>expert_layer_2_expert_8_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="1418,-1010.82 1152,-1010.82 1152,-958.82 1418,-958.82 1418,-1010.82"/>
<text text-anchor="middle" x="1285" y="-998.82" font-family="Arial" font-size="10.00">Expert 8 TP0</text>
<text text-anchor="middle" x="1285" y="-987.82" font-family="Arial" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1285" y="-976.82" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1285" y="-965.82" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_2_expert_8_tp_0&#45;&gt;expert_layer_2_expert_8_tp_0 -->
<g id="edge76" class="edge">
<title>route_comm_layer_2_expert_8_tp_0&#45;&gt;expert_layer_2_expert_8_tp_0</title>
<path fill="none" stroke="black" d="M1260.91,-1047.71C1264.12,-1039.45 1267.93,-1029.67 1271.56,-1020.36"/>
<polygon fill="black" stroke="black" points="1274.87,-1021.49 1275.24,-1010.9 1268.35,-1018.95 1274.87,-1021.49"/>
</g>
<!-- tp_comm_layer_2_expert_8 -->
<g id="node64" class="node">
<title>tp_comm_layer_2_expert_8</title>
<ellipse fill="lightblue" stroke="black" cx="1285" cy="-900.61" rx="76.24" ry="21.43"/>
<text text-anchor="middle" x="1285" y="-903.61" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1285" y="-892.61" font-family="Arial" font-size="10.00">GPU 16 &lt;&#45;&gt; GPU 17</text>
</g>
<!-- expert_layer_2_expert_8_tp_0&#45;&gt;tp_comm_layer_2_expert_8 -->
<g id="edge79" class="edge">
<title>expert_layer_2_expert_8_tp_0&#45;&gt;tp_comm_layer_2_expert_8</title>
<path fill="none" stroke="black" d="M1285,-958.7C1285,-950.31 1285,-940.87 1285,-932.11"/>
<polygon fill="black" stroke="black" points="1288.5,-931.88 1285,-921.88 1281.5,-931.88 1288.5,-931.88"/>
</g>
<!-- expert_layer_2_expert_8_tp_1 -->
<g id="node63" class="node">
<title>expert_layer_2_expert_8_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="1702,-1010.82 1436,-1010.82 1436,-958.82 1702,-958.82 1702,-1010.82"/>
<text text-anchor="middle" x="1569" y="-998.82" font-family="Arial" font-size="10.00">Expert 8 TP1</text>
<text text-anchor="middle" x="1569" y="-987.82" font-family="Arial" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1569" y="-976.82" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1569" y="-965.82" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_2_expert_8_tp_1&#45;&gt;expert_layer_2_expert_8_tp_1 -->
<g id="edge78" class="edge">
<title>route_comm_layer_2_expert_8_tp_1&#45;&gt;expert_layer_2_expert_8_tp_1</title>
<path fill="none" stroke="black" d="M1514.43,-1048.13C1522.18,-1039.28 1531.51,-1028.63 1540.25,-1018.65"/>
<polygon fill="black" stroke="black" points="1543.13,-1020.67 1547.09,-1010.84 1537.86,-1016.06 1543.13,-1020.67"/>
</g>
<!-- expert_layer_2_expert_8_tp_1&#45;&gt;tp_comm_layer_2_expert_8 -->
<g id="edge80" class="edge">
<title>expert_layer_2_expert_8_tp_1&#45;&gt;tp_comm_layer_2_expert_8</title>
<path fill="none" stroke="black" d="M1482.63,-958.82C1438.55,-946.06 1385.98,-930.84 1346.14,-919.3"/>
<polygon fill="black" stroke="black" points="1346.88,-915.87 1336.3,-916.46 1344.93,-922.6 1346.88,-915.87"/>
</g>
<!-- tp_comm_layer_2_expert_8&#45;&gt;agg_layer_2 -->
<g id="edge89" class="edge">
<title>tp_comm_layer_2_expert_8&#45;&gt;agg_layer_2</title>
<path fill="none" stroke="black" d="M1243.91,-882.7C1219.78,-872.77 1187.78,-859.6 1155.61,-846.37"/>
<polygon fill="black" stroke="black" points="1156.67,-843.02 1146.09,-842.45 1154,-849.49 1156.67,-843.02"/>
</g>
<!-- expert_layer_2_expert_15_tp_0 -->
<g id="node66" class="node">
<title>expert_layer_2_expert_15_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="1986,-1010.82 1720,-1010.82 1720,-958.82 1986,-958.82 1986,-1010.82"/>
<text text-anchor="middle" x="1853" y="-998.82" font-family="Arial" font-size="10.00">Expert 15 TP0</text>
<text text-anchor="middle" x="1853" y="-987.82" font-family="Arial" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1853" y="-976.82" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1853" y="-965.82" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_2_expert_15_tp_0&#45;&gt;expert_layer_2_expert_15_tp_0 -->
<g id="edge82" class="edge">
<title>route_comm_layer_2_expert_15_tp_0&#45;&gt;expert_layer_2_expert_15_tp_0</title>
<path fill="none" stroke="black" d="M1782.8,-1048.55C1793.09,-1039.36 1805.63,-1028.15 1817.26,-1017.76"/>
<polygon fill="black" stroke="black" points="1819.6,-1020.36 1824.73,-1011.08 1814.94,-1015.14 1819.6,-1020.36"/>
</g>
<!-- tp_comm_layer_2_expert_15 -->
<g id="node69" class="node">
<title>tp_comm_layer_2_expert_15</title>
<ellipse fill="lightblue" stroke="black" cx="1853" cy="-900.61" rx="76.24" ry="21.43"/>
<text text-anchor="middle" x="1853" y="-903.61" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1853" y="-892.61" font-family="Arial" font-size="10.00">GPU 30 &lt;&#45;&gt; GPU 31</text>
</g>
<!-- expert_layer_2_expert_15_tp_0&#45;&gt;tp_comm_layer_2_expert_15 -->
<g id="edge85" class="edge">
<title>expert_layer_2_expert_15_tp_0&#45;&gt;tp_comm_layer_2_expert_15</title>
<path fill="none" stroke="black" d="M1853,-958.7C1853,-950.31 1853,-940.87 1853,-932.11"/>
<polygon fill="black" stroke="black" points="1856.5,-931.88 1853,-921.88 1849.5,-931.88 1856.5,-931.88"/>
</g>
<!-- expert_layer_2_expert_15_tp_1 -->
<g id="node68" class="node">
<title>expert_layer_2_expert_15_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="2270,-1010.82 2004,-1010.82 2004,-958.82 2270,-958.82 2270,-1010.82"/>
<text text-anchor="middle" x="2137" y="-998.82" font-family="Arial" font-size="10.00">Expert 15 TP1</text>
<text text-anchor="middle" x="2137" y="-987.82" font-family="Arial" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="2137" y="-976.82" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="2137" y="-965.82" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_2_expert_15_tp_1&#45;&gt;expert_layer_2_expert_15_tp_1 -->
<g id="edge84" class="edge">
<title>route_comm_layer_2_expert_15_tp_1&#45;&gt;expert_layer_2_expert_15_tp_1</title>
<path fill="none" stroke="black" d="M2058.91,-1048.76C2070.52,-1039.4 2084.76,-1027.92 2097.89,-1017.34"/>
<polygon fill="black" stroke="black" points="2100.3,-1019.9 2105.89,-1010.9 2095.9,-1014.45 2100.3,-1019.9"/>
</g>
<!-- expert_layer_2_expert_15_tp_1&#45;&gt;tp_comm_layer_2_expert_15 -->
<g id="edge86" class="edge">
<title>expert_layer_2_expert_15_tp_1&#45;&gt;tp_comm_layer_2_expert_15</title>
<path fill="none" stroke="black" d="M2050.63,-958.82C2006.55,-946.06 1953.98,-930.84 1914.14,-919.3"/>
<polygon fill="black" stroke="black" points="1914.88,-915.87 1904.3,-916.46 1912.93,-922.6 1914.88,-915.87"/>
</g>
<!-- tp_comm_layer_2_expert_15&#45;&gt;agg_layer_2 -->
<g id="edge90" class="edge">
<title>tp_comm_layer_2_expert_15&#45;&gt;agg_layer_2</title>
<path fill="none" stroke="black" d="M1785,-890.75C1694.34,-878.94 1527.31,-857.19 1372.6,-837.05"/>
<polygon fill="black" stroke="black" points="1372.79,-833.54 1362.43,-835.72 1371.89,-840.48 1372.79,-833.54"/>
</g>
<!-- mha_layer_3 -->
<g id="node71" class="node">
<title>mha_layer_3</title>
<polygon fill="lightgreen" stroke="black" points="1156,-701.39 888,-701.39 888,-649.39 1156,-649.39 1156,-701.39"/>
<text text-anchor="middle" x="1022" y="-689.39" font-family="Arial" font-size="10.00">MHA Layer 3</text>
<text text-anchor="middle" x="1022" y="-678.39" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1022" y="-667.39" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1022" y="-656.39" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- agg_layer_2&#45;&gt;mha_layer_3 -->
<g id="edge91" class="edge">
<title>agg_layer_2&#45;&gt;mha_layer_3</title>
<path fill="none" stroke="black" d="M1022,-738.18C1022,-729.23 1022,-720.1 1022,-711.7"/>
<polygon fill="black" stroke="black" points="1025.5,-711.52 1022,-701.52 1018.5,-711.52 1025.5,-711.52"/>
</g>
<!-- gate_layer_3 -->
<g id="node72" class="node">
<title>gate_layer_3</title>
<polygon fill="lightyellow" stroke="black" points="1298.63,-612.39 858.58,-612.39 745.37,-508.39 1185.42,-508.39 1298.63,-612.39"/>
<text text-anchor="middle" x="1022" y="-574.39" font-family="Arial" font-size="10.00">Gate Layer 3</text>
<text text-anchor="middle" x="1022" y="-563.39" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1022" y="-552.39" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1022" y="-541.39" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, num_experts=16]</text>
</g>
<!-- mha_layer_3&#45;&gt;gate_layer_3 -->
<g id="edge92" class="edge">
<title>mha_layer_3&#45;&gt;gate_layer_3</title>
<path fill="none" stroke="black" d="M1022,-649.31C1022,-641.39 1022,-632.25 1022,-622.93"/>
<polygon fill="black" stroke="black" points="1025.5,-622.79 1022,-612.79 1018.5,-622.79 1025.5,-622.79"/>
</g>
<!-- route_comm_layer_3_expert_0_tp_0 -->
<g id="node73" class="node">
<title>route_comm_layer_3_expert_0_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="293" cy="-450.18" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="293" y="-453.18" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="293" y="-442.18" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 0</text>
</g>
<!-- gate_layer_3&#45;&gt;route_comm_layer_3_expert_0_tp_0 -->
<g id="edge93" class="edge">
<title>gate_layer_3&#45;&gt;route_comm_layer_3_expert_0_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M758.04,-520.21C619.57,-499.65 460.09,-475.98 368.46,-462.38"/>
<polygon fill="black" stroke="black" points="368.85,-458.9 358.45,-460.89 367.82,-465.82 368.85,-458.9"/>
</g>
<!-- route_comm_layer_3_expert_0_tp_1 -->
<g id="node75" class="node">
<title>route_comm_layer_3_expert_0_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="577" cy="-450.18" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="577" y="-453.18" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="577" y="-442.18" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 1</text>
</g>
<!-- gate_layer_3&#45;&gt;route_comm_layer_3_expert_0_tp_1 -->
<g id="edge95" class="edge">
<title>gate_layer_3&#45;&gt;route_comm_layer_3_expert_0_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M812.21,-508.37C750.64,-493.4 687.78,-478.12 642.55,-467.12"/>
<polygon fill="black" stroke="black" points="643.14,-463.66 632.6,-464.7 641.49,-470.46 643.14,-463.66"/>
</g>
<!-- route_comm_layer_3_expert_1_tp_0 -->
<g id="node78" class="node">
<title>route_comm_layer_3_expert_1_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="803" cy="-450.18" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="803" y="-453.18" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="803" y="-442.18" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 2</text>
</g>
<!-- gate_layer_3&#45;&gt;route_comm_layer_3_expert_1_tp_0 -->
<g id="edge99" class="edge">
<title>gate_layer_3&#45;&gt;route_comm_layer_3_expert_1_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M918.59,-508.3C893.81,-496.05 868.62,-483.6 848.1,-473.46"/>
<polygon fill="black" stroke="black" points="849.54,-470.27 839.02,-468.98 846.44,-476.55 849.54,-470.27"/>
</g>
<!-- route_comm_layer_3_expert_1_tp_1 -->
<g id="node80" class="node">
<title>route_comm_layer_3_expert_1_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1022" cy="-450.18" rx="75.82" ry="21.43"/>
<text text-anchor="middle" x="1022" y="-453.18" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1022" y="-442.18" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 3</text>
</g>
<!-- gate_layer_3&#45;&gt;route_comm_layer_3_expert_1_tp_1 -->
<g id="edge101" class="edge">
<title>gate_layer_3&#45;&gt;route_comm_layer_3_expert_1_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1022,-508.14C1022,-499.1 1022,-489.95 1022,-481.71"/>
<polygon fill="black" stroke="black" points="1025.5,-481.49 1022,-471.49 1018.5,-481.49 1025.5,-481.49"/>
</g>
<!-- route_comm_layer_3_expert_8_tp_0 -->
<g id="node83" class="node">
<title>route_comm_layer_3_expert_8_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="1251" cy="-450.18" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1251" y="-453.18" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1251" y="-442.18" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 16</text>
</g>
<!-- gate_layer_3&#45;&gt;route_comm_layer_3_expert_8_tp_0 -->
<g id="edge105" class="edge">
<title>gate_layer_3&#45;&gt;route_comm_layer_3_expert_8_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1130.13,-508.3C1156.16,-496 1182.62,-483.49 1204.13,-473.33"/>
<polygon fill="black" stroke="black" points="1205.79,-476.42 1213.33,-468.98 1202.8,-470.09 1205.79,-476.42"/>
</g>
<!-- route_comm_layer_3_expert_8_tp_1 -->
<g id="node85" class="node">
<title>route_comm_layer_3_expert_8_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1477" cy="-450.18" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1477" y="-453.18" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1477" y="-442.18" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 17</text>
</g>
<!-- gate_layer_3&#45;&gt;route_comm_layer_3_expert_8_tp_1 -->
<g id="edge107" class="edge">
<title>gate_layer_3&#45;&gt;route_comm_layer_3_expert_8_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1195.96,-518.02C1270.51,-500.29 1353.19,-480.62 1409.46,-467.24"/>
<polygon fill="black" stroke="black" points="1410.38,-470.62 1419.3,-464.9 1408.76,-463.81 1410.38,-470.62"/>
</g>
<!-- route_comm_layer_3_expert_15_tp_0 -->
<g id="node88" class="node">
<title>route_comm_layer_3_expert_15_tp_0</title>
<ellipse fill="lightblue" stroke="black" cx="1679" cy="-450.18" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1679" y="-453.18" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1679" y="-442.18" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 30</text>
</g>
<!-- gate_layer_3&#45;&gt;route_comm_layer_3_expert_15_tp_0 -->
<g id="edge111" class="edge">
<title>gate_layer_3&#45;&gt;route_comm_layer_3_expert_15_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1209.07,-529.92C1314.05,-513.18 1447.4,-491.59 1566,-471.39 1578.48,-469.27 1591.72,-466.95 1604.58,-464.67"/>
<polygon fill="black" stroke="black" points="1605.56,-468.05 1614.79,-462.86 1604.33,-461.16 1605.56,-468.05"/>
</g>
<!-- route_comm_layer_3_expert_15_tp_1 -->
<g id="node90" class="node">
<title>route_comm_layer_3_expert_15_tp_1</title>
<ellipse fill="lightblue" stroke="black" cx="1869" cy="-450.18" rx="79.81" ry="21.43"/>
<text text-anchor="middle" x="1869" y="-453.18" font-family="Arial" font-size="10.00">Route Comm</text>
<text text-anchor="middle" x="1869" y="-442.18" font-family="Arial" font-size="10.00">GPU Gate &#45;&gt; GPU 31</text>
</g>
<!-- gate_layer_3&#45;&gt;route_comm_layer_3_expert_15_tp_1 -->
<g id="edge113" class="edge">
<title>gate_layer_3&#45;&gt;route_comm_layer_3_expert_15_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1220.5,-540.35C1371.15,-524.84 1583.17,-500.74 1768,-471.39 1777.87,-469.82 1788.24,-467.98 1798.43,-466.05"/>
<polygon fill="black" stroke="black" points="1799.37,-469.43 1808.52,-464.1 1798.04,-462.56 1799.37,-469.43"/>
</g>
<!-- expert_layer_3_expert_0_tp_0 -->
<g id="node74" class="node">
<title>expert_layer_3_expert_0_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="282,-391.97 16,-391.97 16,-339.97 282,-339.97 282,-391.97"/>
<text text-anchor="middle" x="149" y="-379.97" font-family="Arial" font-size="10.00">Expert 0 TP0</text>
<text text-anchor="middle" x="149" y="-368.97" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="149" y="-357.97" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="149" y="-346.97" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_3_expert_0_tp_0&#45;&gt;expert_layer_3_expert_0_tp_0 -->
<g id="edge94" class="edge">
<title>route_comm_layer_3_expert_0_tp_0&#45;&gt;expert_layer_3_expert_0_tp_0</title>
<path fill="none" stroke="black" d="M261.04,-430.93C243.57,-420.96 221.5,-408.36 201.57,-396.98"/>
<polygon fill="black" stroke="black" points="203.3,-393.94 192.88,-392.02 199.83,-400.02 203.3,-393.94"/>
</g>
<!-- tp_comm_layer_3_expert_0 -->
<g id="node77" class="node">
<title>tp_comm_layer_3_expert_0</title>
<ellipse fill="lightblue" stroke="black" cx="433" cy="-281.75" rx="69.09" ry="21.43"/>
<text text-anchor="middle" x="433" y="-284.75" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="433" y="-273.75" font-family="Arial" font-size="10.00">GPU 0 &lt;&#45;&gt; GPU 1</text>
</g>
<!-- expert_layer_3_expert_0_tp_0&#45;&gt;tp_comm_layer_3_expert_0 -->
<g id="edge97" class="edge">
<title>expert_layer_3_expert_0_tp_0&#45;&gt;tp_comm_layer_3_expert_0</title>
<path fill="none" stroke="black" d="M235.37,-339.96C280.44,-326.91 334.41,-311.29 374.55,-299.67"/>
<polygon fill="black" stroke="black" points="375.55,-303.03 384.18,-296.88 373.6,-296.3 375.55,-303.03"/>
</g>
<!-- expert_layer_3_expert_0_tp_1 -->
<g id="node76" class="node">
<title>expert_layer_3_expert_0_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="566,-391.97 300,-391.97 300,-339.97 566,-339.97 566,-391.97"/>
<text text-anchor="middle" x="433" y="-379.97" font-family="Arial" font-size="10.00">Expert 0 TP1</text>
<text text-anchor="middle" x="433" y="-368.97" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="433" y="-357.97" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="433" y="-346.97" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_3_expert_0_tp_1&#45;&gt;expert_layer_3_expert_0_tp_1 -->
<g id="edge96" class="edge">
<title>route_comm_layer_3_expert_0_tp_1&#45;&gt;expert_layer_3_expert_0_tp_1</title>
<path fill="none" stroke="black" d="M545.04,-430.93C527.57,-420.96 505.5,-408.36 485.57,-396.98"/>
<polygon fill="black" stroke="black" points="487.3,-393.94 476.88,-392.02 483.83,-400.02 487.3,-393.94"/>
</g>
<!-- expert_layer_3_expert_0_tp_1&#45;&gt;tp_comm_layer_3_expert_0 -->
<g id="edge98" class="edge">
<title>expert_layer_3_expert_0_tp_1&#45;&gt;tp_comm_layer_3_expert_0</title>
<path fill="none" stroke="black" d="M433,-339.85C433,-331.46 433,-322.01 433,-313.26"/>
<polygon fill="black" stroke="black" points="436.5,-313.03 433,-303.03 429.5,-313.03 436.5,-313.03"/>
</g>
<!-- agg_layer_3 -->
<g id="node93" class="node">
<title>agg_layer_3</title>
<polygon fill="lightyellow" stroke="black" points="1492.27,-223.54 936.66,-223.54 793.73,-119.54 1349.34,-119.54 1492.27,-223.54"/>
<text text-anchor="middle" x="1143" y="-185.54" font-family="Arial" font-size="10.00">Expert Aggregation Layer 3</text>
<text text-anchor="middle" x="1143" y="-174.54" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1143" y="-163.54" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, num_experts=16, hidden_dim=512]</text>
<text text-anchor="middle" x="1143" y="-152.54" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- tp_comm_layer_3_expert_0&#45;&gt;agg_layer_3 -->
<g id="edge117" class="edge">
<title>tp_comm_layer_3_expert_0&#45;&gt;agg_layer_3</title>
<path fill="none" stroke="black" d="M493.84,-271.48C584.21,-257.71 758.88,-231.08 904.29,-208.92"/>
<polygon fill="black" stroke="black" points="904.9,-212.37 914.26,-207.4 903.85,-205.45 904.9,-212.37"/>
</g>
<!-- expert_layer_3_expert_1_tp_0 -->
<g id="node79" class="node">
<title>expert_layer_3_expert_1_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="850,-391.97 584,-391.97 584,-339.97 850,-339.97 850,-391.97"/>
<text text-anchor="middle" x="717" y="-379.97" font-family="Arial" font-size="10.00">Expert 1 TP0</text>
<text text-anchor="middle" x="717" y="-368.97" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="717" y="-357.97" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="717" y="-346.97" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_3_expert_1_tp_0&#45;&gt;expert_layer_3_expert_1_tp_0 -->
<g id="edge100" class="edge">
<title>route_comm_layer_3_expert_1_tp_0&#45;&gt;expert_layer_3_expert_1_tp_0</title>
<path fill="none" stroke="black" d="M782.62,-429.7C773.09,-420.59 761.5,-409.51 750.72,-399.2"/>
<polygon fill="black" stroke="black" points="753.07,-396.61 743.43,-392.23 748.24,-401.67 753.07,-396.61"/>
</g>
<!-- tp_comm_layer_3_expert_1 -->
<g id="node82" class="node">
<title>tp_comm_layer_3_expert_1</title>
<ellipse fill="lightblue" stroke="black" cx="1001" cy="-281.75" rx="69.09" ry="21.43"/>
<text text-anchor="middle" x="1001" y="-284.75" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1001" y="-273.75" font-family="Arial" font-size="10.00">GPU 2 &lt;&#45;&gt; GPU 3</text>
</g>
<!-- expert_layer_3_expert_1_tp_0&#45;&gt;tp_comm_layer_3_expert_1 -->
<g id="edge103" class="edge">
<title>expert_layer_3_expert_1_tp_0&#45;&gt;tp_comm_layer_3_expert_1</title>
<path fill="none" stroke="black" d="M803.37,-339.96C848.44,-326.91 902.41,-311.29 942.55,-299.67"/>
<polygon fill="black" stroke="black" points="943.55,-303.03 952.18,-296.88 941.6,-296.3 943.55,-303.03"/>
</g>
<!-- expert_layer_3_expert_1_tp_1 -->
<g id="node81" class="node">
<title>expert_layer_3_expert_1_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="1134,-391.97 868,-391.97 868,-339.97 1134,-339.97 1134,-391.97"/>
<text text-anchor="middle" x="1001" y="-379.97" font-family="Arial" font-size="10.00">Expert 1 TP1</text>
<text text-anchor="middle" x="1001" y="-368.97" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1001" y="-357.97" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1001" y="-346.97" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_3_expert_1_tp_1&#45;&gt;expert_layer_3_expert_1_tp_1 -->
<g id="edge102" class="edge">
<title>route_comm_layer_3_expert_1_tp_1&#45;&gt;expert_layer_3_expert_1_tp_1</title>
<path fill="none" stroke="black" d="M1016.81,-428.86C1014.72,-420.69 1012.25,-411.03 1009.9,-401.8"/>
<polygon fill="black" stroke="black" points="1013.27,-400.87 1007.41,-392.05 1006.49,-402.6 1013.27,-400.87"/>
</g>
<!-- expert_layer_3_expert_1_tp_1&#45;&gt;tp_comm_layer_3_expert_1 -->
<g id="edge104" class="edge">
<title>expert_layer_3_expert_1_tp_1&#45;&gt;tp_comm_layer_3_expert_1</title>
<path fill="none" stroke="black" d="M1001,-339.85C1001,-331.46 1001,-322.01 1001,-313.26"/>
<polygon fill="black" stroke="black" points="1004.5,-313.03 1001,-303.03 997.5,-313.03 1004.5,-313.03"/>
</g>
<!-- tp_comm_layer_3_expert_1&#45;&gt;agg_layer_3 -->
<g id="edge118" class="edge">
<title>tp_comm_layer_3_expert_1&#45;&gt;agg_layer_3</title>
<path fill="none" stroke="black" d="M1025.73,-261.9C1037.64,-252.83 1052.63,-241.41 1067.87,-229.79"/>
<polygon fill="black" stroke="black" points="1070.01,-232.56 1075.85,-223.71 1065.77,-226.99 1070.01,-232.56"/>
</g>
<!-- expert_layer_3_expert_8_tp_0 -->
<g id="node84" class="node">
<title>expert_layer_3_expert_8_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="1418,-391.97 1152,-391.97 1152,-339.97 1418,-339.97 1418,-391.97"/>
<text text-anchor="middle" x="1285" y="-379.97" font-family="Arial" font-size="10.00">Expert 8 TP0</text>
<text text-anchor="middle" x="1285" y="-368.97" font-family="Arial" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1285" y="-357.97" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1285" y="-346.97" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_3_expert_8_tp_0&#45;&gt;expert_layer_3_expert_8_tp_0 -->
<g id="edge106" class="edge">
<title>route_comm_layer_3_expert_8_tp_0&#45;&gt;expert_layer_3_expert_8_tp_0</title>
<path fill="none" stroke="black" d="M1259.4,-428.86C1262.82,-420.6 1266.86,-410.82 1270.72,-401.51"/>
<polygon fill="black" stroke="black" points="1274.04,-402.63 1274.63,-392.05 1267.57,-399.95 1274.04,-402.63"/>
</g>
<!-- tp_comm_layer_3_expert_8 -->
<g id="node87" class="node">
<title>tp_comm_layer_3_expert_8</title>
<ellipse fill="lightblue" stroke="black" cx="1285" cy="-281.75" rx="76.24" ry="21.43"/>
<text text-anchor="middle" x="1285" y="-284.75" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1285" y="-273.75" font-family="Arial" font-size="10.00">GPU 16 &lt;&#45;&gt; GPU 17</text>
</g>
<!-- expert_layer_3_expert_8_tp_0&#45;&gt;tp_comm_layer_3_expert_8 -->
<g id="edge109" class="edge">
<title>expert_layer_3_expert_8_tp_0&#45;&gt;tp_comm_layer_3_expert_8</title>
<path fill="none" stroke="black" d="M1285,-339.85C1285,-331.46 1285,-322.01 1285,-313.26"/>
<polygon fill="black" stroke="black" points="1288.5,-313.03 1285,-303.03 1281.5,-313.03 1288.5,-313.03"/>
</g>
<!-- expert_layer_3_expert_8_tp_1 -->
<g id="node86" class="node">
<title>expert_layer_3_expert_8_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="1702,-391.97 1436,-391.97 1436,-339.97 1702,-339.97 1702,-391.97"/>
<text text-anchor="middle" x="1569" y="-379.97" font-family="Arial" font-size="10.00">Expert 8 TP1</text>
<text text-anchor="middle" x="1569" y="-368.97" font-family="Arial" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="1569" y="-357.97" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1569" y="-346.97" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_3_expert_8_tp_1&#45;&gt;expert_layer_3_expert_8_tp_1 -->
<g id="edge108" class="edge">
<title>route_comm_layer_3_expert_8_tp_1&#45;&gt;expert_layer_3_expert_8_tp_1</title>
<path fill="none" stroke="black" d="M1498.8,-429.7C1509.09,-420.5 1521.63,-409.29 1533.26,-398.91"/>
<polygon fill="black" stroke="black" points="1535.6,-401.5 1540.73,-392.23 1530.94,-396.28 1535.6,-401.5"/>
</g>
<!-- expert_layer_3_expert_8_tp_1&#45;&gt;tp_comm_layer_3_expert_8 -->
<g id="edge110" class="edge">
<title>expert_layer_3_expert_8_tp_1&#45;&gt;tp_comm_layer_3_expert_8</title>
<path fill="none" stroke="black" d="M1482.63,-339.96C1438.55,-327.2 1385.98,-311.98 1346.14,-300.45"/>
<polygon fill="black" stroke="black" points="1346.88,-297.02 1336.3,-297.6 1344.93,-303.75 1346.88,-297.02"/>
</g>
<!-- tp_comm_layer_3_expert_8&#45;&gt;agg_layer_3 -->
<g id="edge119" class="edge">
<title>tp_comm_layer_3_expert_8&#45;&gt;agg_layer_3</title>
<path fill="none" stroke="black" d="M1259.94,-261.66C1248.18,-252.7 1233.48,-241.49 1218.51,-230.08"/>
<polygon fill="black" stroke="black" points="1220.26,-227.02 1210.19,-223.74 1216.02,-232.58 1220.26,-227.02"/>
</g>
<!-- expert_layer_3_expert_15_tp_0 -->
<g id="node89" class="node">
<title>expert_layer_3_expert_15_tp_0</title>
<polygon fill="lightgreen" stroke="black" points="1986,-391.97 1720,-391.97 1720,-339.97 1986,-339.97 1986,-391.97"/>
<text text-anchor="middle" x="1853" y="-379.97" font-family="Arial" font-size="10.00">Expert 15 TP0</text>
<text text-anchor="middle" x="1853" y="-368.97" font-family="Arial" font-size="10.00">GPU 30</text>
<text text-anchor="middle" x="1853" y="-357.97" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1853" y="-346.97" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_3_expert_15_tp_0&#45;&gt;expert_layer_3_expert_15_tp_0 -->
<g id="edge112" class="edge">
<title>route_comm_layer_3_expert_15_tp_0&#45;&gt;expert_layer_3_expert_15_tp_0</title>
<path fill="none" stroke="black" d="M1716.76,-431.34C1738.29,-421.16 1765.83,-408.15 1790.51,-396.49"/>
<polygon fill="black" stroke="black" points="1792.26,-399.54 1799.81,-392.1 1789.27,-393.21 1792.26,-399.54"/>
</g>
<!-- tp_comm_layer_3_expert_15 -->
<g id="node92" class="node">
<title>tp_comm_layer_3_expert_15</title>
<ellipse fill="lightblue" stroke="black" cx="1853" cy="-281.75" rx="76.24" ry="21.43"/>
<text text-anchor="middle" x="1853" y="-284.75" font-family="Arial" font-size="10.00">TP AllReduce</text>
<text text-anchor="middle" x="1853" y="-273.75" font-family="Arial" font-size="10.00">GPU 30 &lt;&#45;&gt; GPU 31</text>
</g>
<!-- expert_layer_3_expert_15_tp_0&#45;&gt;tp_comm_layer_3_expert_15 -->
<g id="edge115" class="edge">
<title>expert_layer_3_expert_15_tp_0&#45;&gt;tp_comm_layer_3_expert_15</title>
<path fill="none" stroke="black" d="M1853,-339.85C1853,-331.46 1853,-322.01 1853,-313.26"/>
<polygon fill="black" stroke="black" points="1856.5,-313.03 1853,-303.03 1849.5,-313.03 1856.5,-313.03"/>
</g>
<!-- expert_layer_3_expert_15_tp_1 -->
<g id="node91" class="node">
<title>expert_layer_3_expert_15_tp_1</title>
<polygon fill="lightgreen" stroke="black" points="2270,-391.97 2004,-391.97 2004,-339.97 2270,-339.97 2270,-391.97"/>
<text text-anchor="middle" x="2137" y="-379.97" font-family="Arial" font-size="10.00">Expert 15 TP1</text>
<text text-anchor="middle" x="2137" y="-368.97" font-family="Arial" font-size="10.00">GPU 31</text>
<text text-anchor="middle" x="2137" y="-357.97" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="2137" y="-346.97" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
</g>
<!-- route_comm_layer_3_expert_15_tp_1&#45;&gt;expert_layer_3_expert_15_tp_1 -->
<g id="edge114" class="edge">
<title>route_comm_layer_3_expert_15_tp_1&#45;&gt;expert_layer_3_expert_15_tp_1</title>
<path fill="none" stroke="black" d="M1919.41,-433.72C1954.93,-422.82 2003.49,-407.92 2045.73,-394.96"/>
<polygon fill="black" stroke="black" points="2046.94,-398.25 2055.48,-391.97 2044.89,-391.56 2046.94,-398.25"/>
</g>
<!-- expert_layer_3_expert_15_tp_1&#45;&gt;tp_comm_layer_3_expert_15 -->
<g id="edge116" class="edge">
<title>expert_layer_3_expert_15_tp_1&#45;&gt;tp_comm_layer_3_expert_15</title>
<path fill="none" stroke="black" d="M2050.63,-339.96C2006.55,-327.2 1953.98,-311.98 1914.14,-300.45"/>
<polygon fill="black" stroke="black" points="1914.88,-297.02 1904.3,-297.6 1912.93,-303.75 1914.88,-297.02"/>
</g>
<!-- tp_comm_layer_3_expert_15&#45;&gt;agg_layer_3 -->
<g id="edge120" class="edge">
<title>tp_comm_layer_3_expert_15&#45;&gt;agg_layer_3</title>
<path fill="none" stroke="black" d="M1787.48,-270.77C1717.84,-260.15 1602.23,-242.53 1488,-225.12"/>
<polygon fill="black" stroke="black" points="1488.43,-221.65 1478.02,-223.6 1487.38,-228.57 1488.43,-221.65"/>
</g>
<!-- pp_comm_stage0_to_stage1 -->
<g id="node94" class="node">
<title>pp_comm_stage0_to_stage1</title>
<ellipse fill="lightblue" stroke="black" cx="994" cy="-36.77" rx="96.33" ry="21.43"/>
<text text-anchor="middle" x="994" y="-39.77" font-family="Arial" font-size="10.00">PP Comm Stage0&#45;&gt;Stage1</text>
<text text-anchor="middle" x="994" y="-28.77" font-family="Arial" font-size="10.00">GPU 0 &#45;&gt; GPU 32</text>
</g>
<!-- agg_layer_3&#45;&gt;pp_comm_stage0_to_stage1 -->
<g id="edge121" class="edge">
<title>agg_layer_3&#45;&gt;pp_comm_stage0_to_stage1</title>
<path fill="none" stroke="black" d="M1085.39,-119.21C1064.37,-100.48 1041.46,-80.06 1023.83,-64.35"/>
<polygon fill="black" stroke="black" points="1025.93,-61.53 1016.13,-57.49 1021.27,-66.76 1025.93,-61.53"/>
</g>
<!-- output -->
<g id="node95" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="1291" cy="-36.77" rx="182.37" ry="36.54"/>
<text text-anchor="middle" x="1291" y="-50.77" font-family="Arial" font-size="10.00">Output</text>
<text text-anchor="middle" x="1291" y="-39.77" font-family="Arial" font-size="10.00">GPU Output</text>
<text text-anchor="middle" x="1291" y="-28.77" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=1024, hidden_dim=512]</text>
<text text-anchor="middle" x="1291" y="-17.77" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=1024, vocab_size=?]</text>
</g>
<!-- agg_layer_3&#45;&gt;output -->
<g id="edge122" class="edge">
<title>agg_layer_3&#45;&gt;output</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1200.22,-119.21C1214.77,-106.15 1230.23,-92.28 1244.2,-79.76"/>
<polygon fill="black" stroke="black" points="1246.68,-82.23 1251.78,-72.95 1242,-77.02 1246.68,-82.23"/>
<text text-anchor="middle" x="1260" y="-94.34" font-family="Arial" font-size="9.00">after all stages</text>
</g>
</g>
</svg>
