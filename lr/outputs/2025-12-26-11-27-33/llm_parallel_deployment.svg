<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: LLM_Parallel_Deployment Pages: 1 -->
<svg width="2658pt" height="8846pt"
 viewBox="0.00 0.00 2658.00 8845.59" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 8841.59)">
<title>LLM_Parallel_Deployment</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-8841.59 2654,-8841.59 2654,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="white" stroke="blue" d="M20,-6824.58C20,-6824.58 2558,-6824.58 2558,-6824.58 2564,-6824.58 2570,-6830.58 2570,-6836.58 2570,-6836.58 2570,-8817.59 2570,-8817.59 2570,-8823.59 2564,-8829.59 2558,-8829.59 2558,-8829.59 20,-8829.59 20,-8829.59 14,-8829.59 8,-8823.59 8,-8817.59 8,-8817.59 8,-6836.58 8,-6836.58 8,-6830.58 14,-6824.58 20,-6824.58"/>
<text text-anchor="middle" x="1289" y="-8814.39" font-family="Times,serif" font-size="14.00">Pipeline Stage 0: Layers 0&#45;3</text>
<text text-anchor="middle" x="1289" y="-8799.39" font-family="Times,serif" font-size="14.00">GPUs 0&#45;15 (DP Group 0)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage1</title>
<path fill="white" stroke="blue" d="M720,-4816.55C720,-4816.55 1202,-4816.55 1202,-4816.55 1208,-4816.55 1214,-4822.55 1214,-4828.55 1214,-4828.55 1214,-6768.58 1214,-6768.58 1214,-6774.58 1208,-6780.58 1202,-6780.58 1202,-6780.58 720,-6780.58 720,-6780.58 714,-6780.58 708,-6774.58 708,-6768.58 708,-6768.58 708,-4828.55 708,-4828.55 708,-4822.55 714,-4816.55 720,-4816.55"/>
<text text-anchor="middle" x="961" y="-6765.38" font-family="Times,serif" font-size="14.00">Pipeline Stage 1: Layers 4&#45;7</text>
<text text-anchor="middle" x="961" y="-6750.38" font-family="Times,serif" font-size="14.00">GPUs 16&#45;31 (DP Group 1)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_stage2</title>
<path fill="white" stroke="blue" d="M770,-2808.53C770,-2808.53 1252,-2808.53 1252,-2808.53 1258,-2808.53 1264,-2814.53 1264,-2820.53 1264,-2820.53 1264,-4760.55 1264,-4760.55 1264,-4766.55 1258,-4772.55 1252,-4772.55 1252,-4772.55 770,-4772.55 770,-4772.55 764,-4772.55 758,-4766.55 758,-4760.55 758,-4760.55 758,-2820.53 758,-2820.53 758,-2814.53 764,-2808.53 770,-2808.53"/>
<text text-anchor="middle" x="1011" y="-4757.35" font-family="Times,serif" font-size="14.00">Pipeline Stage 2: Layers 8&#45;11</text>
<text text-anchor="middle" x="1011" y="-4742.35" font-family="Times,serif" font-size="14.00">GPUs 32&#45;47 (DP Group 2)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage3</title>
<path fill="white" stroke="blue" d="M849,-482.5C849,-482.5 1331,-482.5 1331,-482.5 1337,-482.5 1343,-488.5 1343,-494.5 1343,-494.5 1343,-2752.53 1343,-2752.53 1343,-2758.53 1337,-2764.53 1331,-2764.53 1331,-2764.53 849,-2764.53 849,-2764.53 843,-2764.53 837,-2758.53 837,-2752.53 837,-2752.53 837,-494.5 837,-494.5 837,-488.5 843,-482.5 849,-482.5"/>
<text text-anchor="middle" x="1090" y="-2749.33" font-family="Times,serif" font-size="14.00">Pipeline Stage 3: Layers 12&#45;15</text>
<text text-anchor="middle" x="1090" y="-2734.33" font-family="Times,serif" font-size="14.00">GPUs 48&#45;63 (DP Group 3)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightcoral" stroke="black" cx="1919" cy="-30.87" rx="166.76" ry="26.76"/>
<ellipse fill="none" stroke="black" cx="1919" cy="-30.87" rx="170.75" ry="30.74"/>
<text text-anchor="middle" x="1919" y="-38.67" font-family="Arial" font-size="9.00">Global Input</text>
<text text-anchor="middle" x="1919" y="-28.67" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1919" y="-18.67" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_norm -->
<g id="node2" class="node">
<title>layer0_norm</title>
<polygon fill="lightyellow" stroke="black" points="1564.85,-8783.59 1175.35,-8783.59 1075.15,-8687.59 1464.65,-8687.59 1564.85,-8783.59"/>
<text text-anchor="middle" x="1320" y="-8748.39" font-family="Arial" font-size="9.00">Layer 0 RMSNorm</text>
<text text-anchor="middle" x="1320" y="-8738.39" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="1320" y="-8728.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1320" y="-8718.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- input&#45;&gt;layer0_norm -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layer0_norm</title>
<path fill="none" stroke="black" d="M2085.33,-38.15C2301.04,-50.93 2650,-89.42 2650,-204.75 2650,-8577.59 2650,-8577.59 2650,-8577.59 2650,-8689.92 1892.19,-8722.12 1520.62,-8731.17"/>
<polygon fill="black" stroke="black" points="1520.47,-8727.67 1510.56,-8731.41 1520.64,-8734.67 1520.47,-8727.67"/>
</g>
<!-- layer0_q_proj_gpu0 -->
<g id="node3" class="node">
<title>layer0_q_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="366,-8600.59 136,-8600.59 136,-8552.59 366,-8552.59 366,-8600.59"/>
<text text-anchor="middle" x="251" y="-8589.39" font-family="Arial" font-size="9.00">Layer 0 Q Projection (TP 0/4)</text>
<text text-anchor="middle" x="251" y="-8579.39" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="251" y="-8569.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="251" y="-8559.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_q_proj_gpu0 -->
<g id="edge2" class="edge">
<title>layer0_norm&#45;&gt;layer0_q_proj_gpu0</title>
<path fill="none" stroke="black" d="M1090.67,-8702.74C969.67,-8685.78 818.74,-8664.39 684,-8644.59 555.45,-8625.71 523.37,-8620.62 395,-8600.59 388.84,-8599.63 382.54,-8598.65 376.18,-8597.64"/>
<polygon fill="black" stroke="black" points="376.56,-8594.16 366.13,-8596.06 375.47,-8601.08 376.56,-8594.16"/>
</g>
<!-- layer0_q_proj_gpu1 -->
<g id="node4" class="node">
<title>layer0_q_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="1290,-8600.59 1060,-8600.59 1060,-8552.59 1290,-8552.59 1290,-8600.59"/>
<text text-anchor="middle" x="1175" y="-8589.39" font-family="Arial" font-size="9.00">Layer 0 Q Projection (TP 1/4)</text>
<text text-anchor="middle" x="1175" y="-8579.39" font-family="Arial" font-size="9.00">GPU 1</text>
<text text-anchor="middle" x="1175" y="-8569.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1175" y="-8559.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_q_proj_gpu1 -->
<g id="edge3" class="edge">
<title>layer0_norm&#45;&gt;layer0_q_proj_gpu1</title>
<path fill="none" stroke="black" d="M1276.5,-8687.49C1252.77,-8661.8 1224.07,-8630.73 1203.26,-8608.19"/>
<polygon fill="black" stroke="black" points="1205.6,-8605.57 1196.25,-8600.6 1200.46,-8610.32 1205.6,-8605.57"/>
</g>
<!-- layer0_q_proj_gpu2 -->
<g id="node5" class="node">
<title>layer0_q_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="2214,-8600.59 1984,-8600.59 1984,-8552.59 2214,-8552.59 2214,-8600.59"/>
<text text-anchor="middle" x="2099" y="-8589.39" font-family="Arial" font-size="9.00">Layer 0 Q Projection (TP 2/4)</text>
<text text-anchor="middle" x="2099" y="-8579.39" font-family="Arial" font-size="9.00">GPU 2</text>
<text text-anchor="middle" x="2099" y="-8569.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="2099" y="-8559.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_q_proj_gpu2 -->
<g id="edge4" class="edge">
<title>layer0_norm&#45;&gt;layer0_q_proj_gpu2</title>
<path fill="none" stroke="black" d="M1499.55,-8720.72C1624.69,-8708.1 1794.61,-8685.06 1940,-8644.59 1975.54,-8634.7 2013.69,-8618.82 2043.71,-8605"/>
<polygon fill="black" stroke="black" points="2045.57,-8607.99 2053.16,-8600.6 2042.61,-8601.65 2045.57,-8607.99"/>
</g>
<!-- layer0_q_proj_gpu3 -->
<g id="node6" class="node">
<title>layer0_q_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1578,-8600.59 1348,-8600.59 1348,-8552.59 1578,-8552.59 1578,-8600.59"/>
<text text-anchor="middle" x="1463" y="-8589.39" font-family="Arial" font-size="9.00">Layer 0 Q Projection (TP 3/4)</text>
<text text-anchor="middle" x="1463" y="-8579.39" font-family="Arial" font-size="9.00">GPU 3</text>
<text text-anchor="middle" x="1463" y="-8569.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1463" y="-8559.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_q_proj_gpu3 -->
<g id="edge5" class="edge">
<title>layer0_norm&#45;&gt;layer0_q_proj_gpu3</title>
<path fill="none" stroke="black" d="M1362.9,-8687.49C1386.31,-8661.8 1414.6,-8630.73 1435.13,-8608.19"/>
<polygon fill="black" stroke="black" points="1437.9,-8610.35 1442.05,-8600.6 1432.72,-8605.64 1437.9,-8610.35"/>
</g>
<!-- layer0_k_proj_gpu0 -->
<g id="node7" class="node">
<title>layer0_k_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="654,-8600.59 424,-8600.59 424,-8552.59 654,-8552.59 654,-8600.59"/>
<text text-anchor="middle" x="539" y="-8589.39" font-family="Arial" font-size="9.00">Layer 0 K Projection (TP 0/4)</text>
<text text-anchor="middle" x="539" y="-8579.39" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="539" y="-8569.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="539" y="-8559.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_k_proj_gpu0 -->
<g id="edge6" class="edge">
<title>layer0_norm&#45;&gt;layer0_k_proj_gpu0</title>
<path fill="none" stroke="black" d="M1105.98,-8717.23C984.72,-8704.03 831.11,-8681.61 698,-8644.59 662.45,-8634.71 624.31,-8618.83 594.29,-8605.01"/>
<polygon fill="black" stroke="black" points="595.38,-8601.65 584.84,-8600.6 592.43,-8608 595.38,-8601.65"/>
</g>
<!-- layer0_k_proj_gpu1 -->
<g id="node8" class="node">
<title>layer0_k_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="1002,-8600.59 772,-8600.59 772,-8552.59 1002,-8552.59 1002,-8600.59"/>
<text text-anchor="middle" x="887" y="-8589.39" font-family="Arial" font-size="9.00">Layer 0 K Projection (TP 1/4)</text>
<text text-anchor="middle" x="887" y="-8579.39" font-family="Arial" font-size="9.00">GPU 1</text>
<text text-anchor="middle" x="887" y="-8569.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="887" y="-8559.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_k_proj_gpu1 -->
<g id="edge7" class="edge">
<title>layer0_norm&#45;&gt;layer0_k_proj_gpu1</title>
<path fill="none" stroke="black" d="M1190.09,-8687.49C1114.74,-8660.17 1022.64,-8626.78 959.87,-8604.02"/>
<polygon fill="black" stroke="black" points="961.04,-8600.72 950.45,-8600.6 958.66,-8607.3 961.04,-8600.72"/>
</g>
<!-- layer0_k_proj_gpu2 -->
<g id="node9" class="node">
<title>layer0_k_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="2502,-8600.59 2272,-8600.59 2272,-8552.59 2502,-8552.59 2502,-8600.59"/>
<text text-anchor="middle" x="2387" y="-8589.39" font-family="Arial" font-size="9.00">Layer 0 K Projection (TP 2/4)</text>
<text text-anchor="middle" x="2387" y="-8579.39" font-family="Arial" font-size="9.00">GPU 2</text>
<text text-anchor="middle" x="2387" y="-8569.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="2387" y="-8559.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_k_proj_gpu2 -->
<g id="edge8" class="edge">
<title>layer0_norm&#45;&gt;layer0_k_proj_gpu2</title>
<path fill="none" stroke="black" d="M1489.53,-8711.07C1617.48,-8693.2 1797.34,-8667.81 1955,-8644.59 2083.1,-8625.73 2115.07,-8620.58 2243,-8600.59 2249.16,-8599.63 2255.46,-8598.64 2261.82,-8597.64"/>
<polygon fill="black" stroke="black" points="2262.53,-8601.07 2271.86,-8596.06 2261.44,-8594.16 2262.53,-8601.07"/>
</g>
<!-- layer0_k_proj_gpu3 -->
<g id="node10" class="node">
<title>layer0_k_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1866,-8600.59 1636,-8600.59 1636,-8552.59 1866,-8552.59 1866,-8600.59"/>
<text text-anchor="middle" x="1751" y="-8589.39" font-family="Arial" font-size="9.00">Layer 0 K Projection (TP 3/4)</text>
<text text-anchor="middle" x="1751" y="-8579.39" font-family="Arial" font-size="9.00">GPU 3</text>
<text text-anchor="middle" x="1751" y="-8569.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1751" y="-8559.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_k_proj_gpu3 -->
<g id="edge9" class="edge">
<title>layer0_norm&#45;&gt;layer0_k_proj_gpu3</title>
<path fill="none" stroke="black" d="M1449.31,-8687.49C1524.16,-8660.23 1615.61,-8626.91 1678.08,-8604.16"/>
<polygon fill="black" stroke="black" points="1679.65,-8607.31 1687.85,-8600.6 1677.25,-8600.73 1679.65,-8607.31"/>
</g>
<!-- layer0_v_proj_gpu0 -->
<g id="node11" class="node">
<title>layer0_v_proj_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="355,-8327.59 125,-8327.59 125,-8279.59 355,-8279.59 355,-8327.59"/>
<text text-anchor="middle" x="240" y="-8316.39" font-family="Arial" font-size="9.00">Layer 0 V Projection (TP 0/4)</text>
<text text-anchor="middle" x="240" y="-8306.39" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="240" y="-8296.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="240" y="-8286.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_v_proj_gpu0 -->
<g id="edge10" class="edge">
<title>layer0_norm&#45;&gt;layer0_v_proj_gpu0</title>
<path fill="none" stroke="black" d="M1115.9,-8726.64C787.8,-8711.74 172.97,-8674.26 107,-8600.59 34.37,-8519.5 147.16,-8392.18 206.84,-8334.62"/>
<polygon fill="black" stroke="black" points="209.36,-8337.06 214.19,-8327.63 204.53,-8331.99 209.36,-8337.06"/>
</g>
<!-- layer0_v_proj_gpu1 -->
<g id="node12" class="node">
<title>layer0_v_proj_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="837,-8509.59 607,-8509.59 607,-8461.59 837,-8461.59 837,-8509.59"/>
<text text-anchor="middle" x="722" y="-8498.39" font-family="Arial" font-size="9.00">Layer 0 V Projection (TP 1/4)</text>
<text text-anchor="middle" x="722" y="-8488.39" font-family="Arial" font-size="9.00">GPU 1</text>
<text text-anchor="middle" x="722" y="-8478.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="722" y="-8468.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_v_proj_gpu1 -->
<g id="edge11" class="edge">
<title>layer0_norm&#45;&gt;layer0_v_proj_gpu1</title>
<path fill="none" stroke="black" d="M1096.48,-8708.14C955.85,-8686.84 792.01,-8651.91 743,-8600.59 722.81,-8579.46 718.77,-8545.6 719.06,-8520.27"/>
<polygon fill="black" stroke="black" points="722.56,-8520.11 719.41,-8510 715.57,-8519.87 722.56,-8520.11"/>
</g>
<!-- layer0_v_proj_gpu2 -->
<g id="node13" class="node">
<title>layer0_v_proj_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="2490,-8327.59 2260,-8327.59 2260,-8279.59 2490,-8279.59 2490,-8327.59"/>
<text text-anchor="middle" x="2375" y="-8316.39" font-family="Arial" font-size="9.00">Layer 0 V Projection (TP 2/4)</text>
<text text-anchor="middle" x="2375" y="-8306.39" font-family="Arial" font-size="9.00">GPU 2</text>
<text text-anchor="middle" x="2375" y="-8296.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="2375" y="-8286.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_v_proj_gpu2 -->
<g id="edge12" class="edge">
<title>layer0_norm&#45;&gt;layer0_v_proj_gpu2</title>
<path fill="none" stroke="black" d="M1506.29,-8727.41C1828.95,-8713.03 2463.95,-8675.47 2531,-8600.59 2605.85,-8517.01 2478.95,-8391.05 2412.13,-8334.25"/>
<polygon fill="black" stroke="black" points="2414.2,-8331.42 2404.29,-8327.67 2409.7,-8336.78 2414.2,-8331.42"/>
</g>
<!-- layer0_v_proj_gpu3 -->
<g id="node14" class="node">
<title>layer0_v_proj_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1943,-8509.59 1713,-8509.59 1713,-8461.59 1943,-8461.59 1943,-8509.59"/>
<text text-anchor="middle" x="1828" y="-8498.39" font-family="Arial" font-size="9.00">Layer 0 V Projection (TP 3/4)</text>
<text text-anchor="middle" x="1828" y="-8488.39" font-family="Arial" font-size="9.00">GPU 3</text>
<text text-anchor="middle" x="1828" y="-8478.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1828" y="-8468.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_v_proj_gpu3 -->
<g id="edge13" class="edge">
<title>layer0_norm&#45;&gt;layer0_v_proj_gpu3</title>
<path fill="none" stroke="black" d="M1495.91,-8717.4C1646.21,-8698.64 1845.73,-8662.66 1895,-8600.59 1916.04,-8574.08 1890.62,-8540.29 1865.28,-8516.4"/>
<polygon fill="black" stroke="black" points="1867.58,-8513.76 1857.82,-8509.64 1862.87,-8518.95 1867.58,-8513.76"/>
</g>
<!-- layer0_residual -->
<g id="node43" class="node">
<title>layer0_residual</title>
<polygon fill="lightyellow" stroke="black" points="1162.85,-6928.58 773.35,-6928.58 673.15,-6832.58 1062.65,-6832.58 1162.85,-6928.58"/>
<text text-anchor="middle" x="918" y="-6893.38" font-family="Arial" font-size="9.00">Layer 0 Residual + Dropout</text>
<text text-anchor="middle" x="918" y="-6883.38" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="918" y="-6873.38" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="918" y="-6863.38" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_norm&#45;&gt;layer0_residual -->
<g id="edge61" class="edge">
<title>layer0_norm&#45;&gt;layer0_residual</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M1109.71,-8730.39C741.09,-8720.18 17,-8686.3 17,-8577.59 17,-8577.59 17,-8577.59 17,-7062.58 17,-6919.38 459.97,-6888.01 724.71,-6882.05"/>
<polygon fill="black" stroke="black" points="1109.88,-8733.89 1119.97,-8730.67 1110.07,-8726.89 1109.88,-8733.89"/>
</g>
<!-- layer0_attn_scores_gpu0 -->
<g id="node15" class="node">
<title>layer0_attn_scores_gpu0</title>
<polygon fill="lightcyan" stroke="black" points="649.5,-8418.59 374.5,-8418.59 374.5,-8370.59 649.5,-8370.59 649.5,-8418.59"/>
<text text-anchor="middle" x="512" y="-8407.39" font-family="Arial" font-size="9.00">Layer 0 Attention Scores (TP 0/4)</text>
<text text-anchor="middle" x="512" y="-8397.39" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="512" y="-8387.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, d_k=32]</text>
<text text-anchor="middle" x="512" y="-8377.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
</g>
<!-- layer0_q_proj_gpu0&#45;&gt;layer0_attn_scores_gpu0 -->
<g id="edge14" class="edge">
<title>layer0_q_proj_gpu0&#45;&gt;layer0_attn_scores_gpu0</title>
<path fill="none" stroke="black" d="M284.59,-8552.43C332.06,-8519.69 418.73,-8459.92 470.27,-8424.37"/>
<polygon fill="black" stroke="black" points="472.3,-8427.23 478.54,-8418.67 468.32,-8421.47 472.3,-8427.23"/>
</g>
<!-- layer0_attn_scores_gpu1 -->
<g id="node16" class="node">
<title>layer0_attn_scores_gpu1</title>
<polygon fill="lightcyan" stroke="black" points="1079.5,-8418.59 804.5,-8418.59 804.5,-8370.59 1079.5,-8370.59 1079.5,-8418.59"/>
<text text-anchor="middle" x="942" y="-8407.39" font-family="Arial" font-size="9.00">Layer 0 Attention Scores (TP 1/4)</text>
<text text-anchor="middle" x="942" y="-8397.39" font-family="Arial" font-size="9.00">GPU 1</text>
<text text-anchor="middle" x="942" y="-8387.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, d_k=32]</text>
<text text-anchor="middle" x="942" y="-8377.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
</g>
<!-- layer0_q_proj_gpu1&#45;&gt;layer0_attn_scores_gpu1 -->
<g id="edge15" class="edge">
<title>layer0_q_proj_gpu1&#45;&gt;layer0_attn_scores_gpu1</title>
<path fill="none" stroke="black" d="M1145.02,-8552.43C1102.81,-8519.83 1025.9,-8460.41 979.82,-8424.81"/>
<polygon fill="black" stroke="black" points="981.92,-8422.01 971.87,-8418.67 977.64,-8427.55 981.92,-8422.01"/>
</g>
<!-- layer0_attn_scores_gpu2 -->
<g id="node17" class="node">
<title>layer0_attn_scores_gpu2</title>
<polygon fill="lightcyan" stroke="black" points="2261.5,-8418.59 1986.5,-8418.59 1986.5,-8370.59 2261.5,-8370.59 2261.5,-8418.59"/>
<text text-anchor="middle" x="2124" y="-8407.39" font-family="Arial" font-size="9.00">Layer 0 Attention Scores (TP 2/4)</text>
<text text-anchor="middle" x="2124" y="-8397.39" font-family="Arial" font-size="9.00">GPU 2</text>
<text text-anchor="middle" x="2124" y="-8387.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, d_k=32]</text>
<text text-anchor="middle" x="2124" y="-8377.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
</g>
<!-- layer0_q_proj_gpu2&#45;&gt;layer0_attn_scores_gpu2 -->
<g id="edge16" class="edge">
<title>layer0_q_proj_gpu2&#45;&gt;layer0_attn_scores_gpu2</title>
<path fill="none" stroke="black" d="M2102.22,-8552.43C2106.59,-8520.97 2114.42,-8464.56 2119.41,-8428.66"/>
<polygon fill="black" stroke="black" points="2122.89,-8429.06 2120.8,-8418.67 2115.95,-8428.09 2122.89,-8429.06"/>
</g>
<!-- layer0_attn_scores_gpu3 -->
<g id="node18" class="node">
<title>layer0_attn_scores_gpu3</title>
<polygon fill="lightcyan" stroke="black" points="1663.5,-8418.59 1388.5,-8418.59 1388.5,-8370.59 1663.5,-8370.59 1663.5,-8418.59"/>
<text text-anchor="middle" x="1526" y="-8407.39" font-family="Arial" font-size="9.00">Layer 0 Attention Scores (TP 3/4)</text>
<text text-anchor="middle" x="1526" y="-8397.39" font-family="Arial" font-size="9.00">GPU 3</text>
<text text-anchor="middle" x="1526" y="-8387.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, d_k=32]</text>
<text text-anchor="middle" x="1526" y="-8377.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
</g>
<!-- layer0_q_proj_gpu3&#45;&gt;layer0_attn_scores_gpu3 -->
<g id="edge17" class="edge">
<title>layer0_q_proj_gpu3&#45;&gt;layer0_attn_scores_gpu3</title>
<path fill="none" stroke="black" d="M1471.11,-8552.43C1482.16,-8520.84 1502.03,-8464.08 1514.59,-8428.2"/>
<polygon fill="black" stroke="black" points="1517.92,-8429.26 1517.92,-8418.67 1511.32,-8426.95 1517.92,-8429.26"/>
</g>
<!-- layer0_k_proj_gpu0&#45;&gt;layer0_attn_scores_gpu0 -->
<g id="edge18" class="edge">
<title>layer0_k_proj_gpu0&#45;&gt;layer0_attn_scores_gpu0</title>
<path fill="none" stroke="black" d="M535.53,-8552.43C530.81,-8520.97 522.34,-8464.56 516.96,-8428.66"/>
<polygon fill="black" stroke="black" points="520.41,-8428.04 515.46,-8418.67 513.48,-8429.08 520.41,-8428.04"/>
</g>
<!-- layer0_k_proj_gpu1&#45;&gt;layer0_attn_scores_gpu1 -->
<g id="edge19" class="edge">
<title>layer0_k_proj_gpu1&#45;&gt;layer0_attn_scores_gpu1</title>
<path fill="none" stroke="black" d="M894.08,-8552.43C903.69,-8520.97 920.93,-8464.56 931.9,-8428.66"/>
<polygon fill="black" stroke="black" points="935.37,-8429.26 934.95,-8418.67 928.68,-8427.21 935.37,-8429.26"/>
</g>
<!-- layer0_k_proj_gpu2&#45;&gt;layer0_attn_scores_gpu2 -->
<g id="edge20" class="edge">
<title>layer0_k_proj_gpu2&#45;&gt;layer0_attn_scores_gpu2</title>
<path fill="none" stroke="black" d="M2353.16,-8552.43C2305.32,-8519.69 2217.98,-8459.92 2166.05,-8424.37"/>
<polygon fill="black" stroke="black" points="2167.94,-8421.43 2157.71,-8418.67 2163.99,-8427.21 2167.94,-8421.43"/>
</g>
<!-- layer0_k_proj_gpu3&#45;&gt;layer0_attn_scores_gpu3 -->
<g id="edge21" class="edge">
<title>layer0_k_proj_gpu3&#45;&gt;layer0_attn_scores_gpu3</title>
<path fill="none" stroke="black" d="M1722.05,-8552.43C1681.37,-8519.89 1607.33,-8460.66 1562.8,-8425.03"/>
<polygon fill="black" stroke="black" points="1564.84,-8422.18 1554.84,-8418.67 1560.47,-8427.65 1564.84,-8422.18"/>
</g>
<!-- layer0_attn_out_gpu0 -->
<g id="node23" class="node">
<title>layer0_attn_out_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="634.5,-8101.59 389.5,-8101.59 389.5,-8053.59 634.5,-8053.59 634.5,-8101.59"/>
<text text-anchor="middle" x="512" y="-8090.39" font-family="Arial" font-size="9.00">Layer 0 Attention Output (TP 0/4)</text>
<text text-anchor="middle" x="512" y="-8080.39" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="512" y="-8070.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, d_k=32]</text>
<text text-anchor="middle" x="512" y="-8060.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_v_proj_gpu0&#45;&gt;layer0_attn_out_gpu0 -->
<g id="edge22" class="edge">
<title>layer0_v_proj_gpu0&#45;&gt;layer0_attn_out_gpu0</title>
<path fill="none" stroke="black" d="M258.87,-8279.23C279.03,-8255.04 312.61,-8216.92 346,-8188.59 382.67,-8157.49 428.48,-8127.72 462.69,-8107.01"/>
<polygon fill="black" stroke="black" points="464.8,-8109.83 471.57,-8101.68 461.19,-8103.83 464.8,-8109.83"/>
</g>
<!-- layer0_attn_out_gpu1 -->
<g id="node24" class="node">
<title>layer0_attn_out_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="1064.5,-8101.59 819.5,-8101.59 819.5,-8053.59 1064.5,-8053.59 1064.5,-8101.59"/>
<text text-anchor="middle" x="942" y="-8090.39" font-family="Arial" font-size="9.00">Layer 0 Attention Output (TP 1/4)</text>
<text text-anchor="middle" x="942" y="-8080.39" font-family="Arial" font-size="9.00">GPU 1</text>
<text text-anchor="middle" x="942" y="-8070.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, d_k=32]</text>
<text text-anchor="middle" x="942" y="-8060.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_v_proj_gpu1&#45;&gt;layer0_attn_out_gpu1 -->
<g id="edge23" class="edge">
<title>layer0_v_proj_gpu1&#45;&gt;layer0_attn_out_gpu1</title>
<path fill="none" stroke="black" d="M720.38,-8461.22C717.87,-8408.07 718.34,-8276.03 776,-8188.59 800.11,-8152.03 841.01,-8124.72 876.17,-8106.46"/>
<polygon fill="black" stroke="black" points="878.1,-8109.41 885.45,-8101.78 874.94,-8103.16 878.1,-8109.41"/>
</g>
<!-- layer0_attn_out_gpu2 -->
<g id="node25" class="node">
<title>layer0_attn_out_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="2246.5,-8101.59 2001.5,-8101.59 2001.5,-8053.59 2246.5,-8053.59 2246.5,-8101.59"/>
<text text-anchor="middle" x="2124" y="-8090.39" font-family="Arial" font-size="9.00">Layer 0 Attention Output (TP 2/4)</text>
<text text-anchor="middle" x="2124" y="-8080.39" font-family="Arial" font-size="9.00">GPU 2</text>
<text text-anchor="middle" x="2124" y="-8070.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, d_k=32]</text>
<text text-anchor="middle" x="2124" y="-8060.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_v_proj_gpu2&#45;&gt;layer0_attn_out_gpu2 -->
<g id="edge24" class="edge">
<title>layer0_v_proj_gpu2&#45;&gt;layer0_attn_out_gpu2</title>
<path fill="none" stroke="black" d="M2361.31,-8279.31C2346.18,-8254.85 2320.07,-8216.18 2291,-8188.59 2256.67,-8156.02 2211.55,-8126.95 2176.86,-8106.88"/>
<polygon fill="black" stroke="black" points="2178.25,-8103.64 2167.83,-8101.72 2174.77,-8109.72 2178.25,-8103.64"/>
</g>
<!-- layer0_attn_out_gpu3 -->
<g id="node26" class="node">
<title>layer0_attn_out_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1648.5,-8101.59 1403.5,-8101.59 1403.5,-8053.59 1648.5,-8053.59 1648.5,-8101.59"/>
<text text-anchor="middle" x="1526" y="-8090.39" font-family="Arial" font-size="9.00">Layer 0 Attention Output (TP 3/4)</text>
<text text-anchor="middle" x="1526" y="-8080.39" font-family="Arial" font-size="9.00">GPU 3</text>
<text text-anchor="middle" x="1526" y="-8070.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, d_k=32]</text>
<text text-anchor="middle" x="1526" y="-8060.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=256]</text>
</g>
<!-- layer0_v_proj_gpu3&#45;&gt;layer0_attn_out_gpu3 -->
<g id="edge25" class="edge">
<title>layer0_v_proj_gpu3&#45;&gt;layer0_attn_out_gpu3</title>
<path fill="none" stroke="black" d="M1822.21,-8461.42C1807.95,-8408.12 1766.84,-8274.83 1693,-8188.59 1663.26,-8153.86 1619.9,-8125.74 1584.82,-8106.63"/>
<polygon fill="black" stroke="black" points="1586.1,-8103.35 1575.63,-8101.73 1582.81,-8109.53 1586.1,-8103.35"/>
</g>
<!-- layer0_attn_softmax_gpu0 -->
<g id="node19" class="node">
<title>layer0_attn_softmax_gpu0</title>
<polygon fill="lightcyan" stroke="black" points="649.5,-8236.59 374.5,-8236.59 374.5,-8188.59 649.5,-8188.59 649.5,-8236.59"/>
<text text-anchor="middle" x="512" y="-8225.39" font-family="Arial" font-size="9.00">Layer 0 Attention Softmax (TP 0/4)</text>
<text text-anchor="middle" x="512" y="-8215.39" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="512" y="-8205.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
<text text-anchor="middle" x="512" y="-8195.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
</g>
<!-- layer0_attn_scores_gpu0&#45;&gt;layer0_attn_softmax_gpu0 -->
<g id="edge26" class="edge">
<title>layer0_attn_scores_gpu0&#45;&gt;layer0_attn_softmax_gpu0</title>
<path fill="none" stroke="black" d="M512,-8370.43C512,-8339.11 512,-8283.04 512,-8247.12"/>
<polygon fill="black" stroke="black" points="515.5,-8246.67 512,-8236.67 508.5,-8246.67 515.5,-8246.67"/>
</g>
<!-- layer0_attn_softmax_gpu1 -->
<g id="node20" class="node">
<title>layer0_attn_softmax_gpu1</title>
<polygon fill="lightcyan" stroke="black" points="1079.5,-8236.59 804.5,-8236.59 804.5,-8188.59 1079.5,-8188.59 1079.5,-8236.59"/>
<text text-anchor="middle" x="942" y="-8225.39" font-family="Arial" font-size="9.00">Layer 0 Attention Softmax (TP 1/4)</text>
<text text-anchor="middle" x="942" y="-8215.39" font-family="Arial" font-size="9.00">GPU 1</text>
<text text-anchor="middle" x="942" y="-8205.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
<text text-anchor="middle" x="942" y="-8195.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
</g>
<!-- layer0_attn_scores_gpu1&#45;&gt;layer0_attn_softmax_gpu1 -->
<g id="edge27" class="edge">
<title>layer0_attn_scores_gpu1&#45;&gt;layer0_attn_softmax_gpu1</title>
<path fill="none" stroke="black" d="M942,-8370.43C942,-8339.11 942,-8283.04 942,-8247.12"/>
<polygon fill="black" stroke="black" points="945.5,-8246.67 942,-8236.67 938.5,-8246.67 945.5,-8246.67"/>
</g>
<!-- layer0_attn_softmax_gpu2 -->
<g id="node21" class="node">
<title>layer0_attn_softmax_gpu2</title>
<polygon fill="lightcyan" stroke="black" points="2261.5,-8236.59 1986.5,-8236.59 1986.5,-8188.59 2261.5,-8188.59 2261.5,-8236.59"/>
<text text-anchor="middle" x="2124" y="-8225.39" font-family="Arial" font-size="9.00">Layer 0 Attention Softmax (TP 2/4)</text>
<text text-anchor="middle" x="2124" y="-8215.39" font-family="Arial" font-size="9.00">GPU 2</text>
<text text-anchor="middle" x="2124" y="-8205.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
<text text-anchor="middle" x="2124" y="-8195.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
</g>
<!-- layer0_attn_scores_gpu2&#45;&gt;layer0_attn_softmax_gpu2 -->
<g id="edge28" class="edge">
<title>layer0_attn_scores_gpu2&#45;&gt;layer0_attn_softmax_gpu2</title>
<path fill="none" stroke="black" d="M2124,-8370.43C2124,-8339.11 2124,-8283.04 2124,-8247.12"/>
<polygon fill="black" stroke="black" points="2127.5,-8246.67 2124,-8236.67 2120.5,-8246.67 2127.5,-8246.67"/>
</g>
<!-- layer0_attn_softmax_gpu3 -->
<g id="node22" class="node">
<title>layer0_attn_softmax_gpu3</title>
<polygon fill="lightcyan" stroke="black" points="1663.5,-8236.59 1388.5,-8236.59 1388.5,-8188.59 1663.5,-8188.59 1663.5,-8236.59"/>
<text text-anchor="middle" x="1526" y="-8225.39" font-family="Arial" font-size="9.00">Layer 0 Attention Softmax (TP 3/4)</text>
<text text-anchor="middle" x="1526" y="-8215.39" font-family="Arial" font-size="9.00">GPU 3</text>
<text text-anchor="middle" x="1526" y="-8205.39" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
<text text-anchor="middle" x="1526" y="-8195.39" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, heads=4, seq_len=512]</text>
</g>
<!-- layer0_attn_scores_gpu3&#45;&gt;layer0_attn_softmax_gpu3 -->
<g id="edge29" class="edge">
<title>layer0_attn_scores_gpu3&#45;&gt;layer0_attn_softmax_gpu3</title>
<path fill="none" stroke="black" d="M1526,-8370.43C1526,-8339.11 1526,-8283.04 1526,-8247.12"/>
<polygon fill="black" stroke="black" points="1529.5,-8246.67 1526,-8236.67 1522.5,-8246.67 1529.5,-8246.67"/>
</g>
<!-- layer0_attn_softmax_gpu0&#45;&gt;layer0_attn_out_gpu0 -->
<g id="edge30" class="edge">
<title>layer0_attn_softmax_gpu0&#45;&gt;layer0_attn_out_gpu0</title>
<path fill="none" stroke="black" d="M512,-8188.43C512,-8167.29 512,-8135.82 512,-8111.97"/>
<polygon fill="black" stroke="black" points="515.5,-8111.94 512,-8101.94 508.5,-8111.94 515.5,-8111.94"/>
</g>
<!-- layer0_attn_softmax_gpu1&#45;&gt;layer0_attn_out_gpu1 -->
<g id="edge31" class="edge">
<title>layer0_attn_softmax_gpu1&#45;&gt;layer0_attn_out_gpu1</title>
<path fill="none" stroke="black" d="M942,-8188.43C942,-8167.29 942,-8135.82 942,-8111.97"/>
<polygon fill="black" stroke="black" points="945.5,-8111.94 942,-8101.94 938.5,-8111.94 945.5,-8111.94"/>
</g>
<!-- layer0_attn_softmax_gpu2&#45;&gt;layer0_attn_out_gpu2 -->
<g id="edge32" class="edge">
<title>layer0_attn_softmax_gpu2&#45;&gt;layer0_attn_out_gpu2</title>
<path fill="none" stroke="black" d="M2124,-8188.43C2124,-8167.29 2124,-8135.82 2124,-8111.97"/>
<polygon fill="black" stroke="black" points="2127.5,-8111.94 2124,-8101.94 2120.5,-8111.94 2127.5,-8111.94"/>
</g>
<!-- layer0_attn_softmax_gpu3&#45;&gt;layer0_attn_out_gpu3 -->
<g id="edge33" class="edge">
<title>layer0_attn_softmax_gpu3&#45;&gt;layer0_attn_out_gpu3</title>
<path fill="none" stroke="black" d="M1526,-8188.43C1526,-8167.29 1526,-8135.82 1526,-8111.97"/>
<polygon fill="black" stroke="black" points="1529.5,-8111.94 1526,-8101.94 1522.5,-8111.94 1529.5,-8111.94"/>
</g>
<!-- layer0_attn_allreduce -->
<g id="node27" class="node">
<title>layer0_attn_allreduce</title>
<ellipse fill="yellow" stroke="black" cx="1192" cy="-7928.65" rx="166.76" ry="33.89"/>
<ellipse fill="none" stroke="black" cx="1192" cy="-7928.65" rx="170.75" ry="37.88"/>
<text text-anchor="middle" x="1192" y="-7941.45" font-family="Arial" font-size="9.00">Attention All&#45;Reduce (TP)</text>
<text text-anchor="middle" x="1192" y="-7931.45" font-family="Arial" font-size="9.00">GPUs 0&#45;3</text>
<text text-anchor="middle" x="1192" y="-7921.45" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=256]</text>
<text text-anchor="middle" x="1192" y="-7911.45" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_attn_out_gpu0&#45;&gt;layer0_attn_allreduce -->
<g id="edge34" class="edge">
<title>layer0_attn_out_gpu0&#45;&gt;layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M618.62,-8053.55C738.47,-8027.66 933.09,-7985.6 1061.82,-7957.78"/>
<polygon fill="black" stroke="black" points="1062.71,-7961.17 1071.74,-7955.64 1061.23,-7954.33 1062.71,-7961.17"/>
</g>
<!-- layer0_attn_out_gpu1&#45;&gt;layer0_attn_allreduce -->
<g id="edge35" class="edge">
<title>layer0_attn_out_gpu1&#45;&gt;layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M981.34,-8053.47C1019.58,-8031 1078.42,-7996.41 1124.21,-7969.5"/>
<polygon fill="black" stroke="black" points="1126.04,-7972.48 1132.89,-7964.4 1122.49,-7966.45 1126.04,-7972.48"/>
</g>
<!-- layer0_attn_out_gpu2&#45;&gt;layer0_attn_allreduce -->
<g id="edge36" class="edge">
<title>layer0_attn_out_gpu2&#45;&gt;layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M2001.2,-8057.23C1830.59,-8030.34 1522.27,-7981.73 1339.44,-7952.9"/>
<polygon fill="black" stroke="black" points="1339.9,-7949.43 1329.48,-7951.33 1338.81,-7956.34 1339.9,-7949.43"/>
</g>
<!-- layer0_attn_out_gpu3&#45;&gt;layer0_attn_allreduce -->
<g id="edge37" class="edge">
<title>layer0_attn_out_gpu3&#45;&gt;layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M1473.45,-8053.47C1420.67,-8030.26 1338.53,-7994.12 1276.58,-7966.86"/>
<polygon fill="black" stroke="black" points="1277.76,-7963.56 1267.2,-7962.74 1274.95,-7969.97 1277.76,-7963.56"/>
</g>
<!-- layer0_moe_router -->
<g id="node28" class="node">
<title>layer0_moe_router</title>
<polygon fill="orange" stroke="black" points="1279.33,-7803.71 901.79,-7803.71 804.67,-7707.71 1182.21,-7707.71 1279.33,-7803.71"/>
<text text-anchor="middle" x="1042" y="-7768.51" font-family="Arial" font-size="9.00">Layer 0 MoE Router</text>
<text text-anchor="middle" x="1042" y="-7758.51" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="1042" y="-7748.51" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1042" y="-7738.51" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, experts=2]</text>
</g>
<!-- layer0_attn_allreduce&#45;&gt;layer0_moe_router -->
<g id="edge38" class="edge">
<title>layer0_attn_allreduce&#45;&gt;layer0_moe_router</title>
<path fill="none" stroke="black" d="M1159.82,-7890.98C1139.45,-7867.77 1112.74,-7837.33 1089.9,-7811.3"/>
<polygon fill="black" stroke="black" points="1092.49,-7808.95 1083.26,-7803.74 1087.23,-7813.56 1092.49,-7808.95"/>
</g>
<!-- layer0_gate -->
<g id="node29" class="node">
<title>layer0_gate</title>
<polygon fill="pink" stroke="black" points="1503,-7453.82 1274.19,-7395.7 1503,-7337.59 1731.81,-7395.7 1503,-7453.82"/>
<polygon fill="none" stroke="black" points="1503,-7457.96 1257.92,-7395.7 1503,-7333.45 1748.08,-7395.7 1503,-7457.96"/>
<text text-anchor="middle" x="1503" y="-7413.5" font-family="Arial" font-size="9.00">Gate Selection</text>
<text text-anchor="middle" x="1503" y="-7403.5" font-family="Arial" font-size="9.00">Layer 0</text>
<text text-anchor="middle" x="1503" y="-7393.5" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="1503" y="-7383.5" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1503" y="-7373.5" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, experts=2]</text>
</g>
<!-- layer0_attn_allreduce&#45;&gt;layer0_gate -->
<g id="edge39" class="edge">
<title>layer0_attn_allreduce&#45;&gt;layer0_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1272.25,-7895.02C1371.01,-7849.93 1534.06,-7758.25 1603,-7620.71 1630.91,-7565.04 1594.31,-7499.89 1557.79,-7454.24"/>
<polygon fill="black" stroke="black" points="1560.28,-7451.75 1551.23,-7446.24 1554.86,-7456.19 1560.28,-7451.75"/>
</g>
<!-- layer0_expert_send_gpu0 -->
<g id="node34" class="node">
<title>layer0_expert_send_gpu0</title>
<ellipse fill="lightgreen" stroke="black" cx="1042" cy="-7582.77" rx="154.29" ry="33.89"/>
<ellipse fill="none" stroke="black" cx="1042" cy="-7582.77" rx="158.3" ry="37.88"/>
<text text-anchor="middle" x="1042" y="-7595.57" font-family="Arial" font-size="9.00">Expert Send (All&#45;to&#45;all)</text>
<text text-anchor="middle" x="1042" y="-7585.57" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="1042" y="-7575.57" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="1042" y="-7565.57" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_moe_router&#45;&gt;layer0_expert_send_gpu0 -->
<g id="edge44" class="edge">
<title>layer0_moe_router&#45;&gt;layer0_expert_send_gpu0</title>
<path fill="none" stroke="black" d="M1042,-7707.55C1042,-7683.7 1042,-7654.84 1042,-7630.99"/>
<polygon fill="black" stroke="black" points="1045.5,-7630.76 1042,-7620.76 1038.5,-7630.76 1045.5,-7630.76"/>
</g>
<!-- layer0_expert_send_gpu1 -->
<g id="node35" class="node">
<title>layer0_expert_send_gpu1</title>
<ellipse fill="lightgreen" stroke="black" cx="1416" cy="-7582.77" rx="154.29" ry="33.89"/>
<ellipse fill="none" stroke="black" cx="1416" cy="-7582.77" rx="158.3" ry="37.88"/>
<text text-anchor="middle" x="1416" y="-7595.57" font-family="Arial" font-size="9.00">Expert Send (All&#45;to&#45;all)</text>
<text text-anchor="middle" x="1416" y="-7585.57" font-family="Arial" font-size="9.00">GPU 1</text>
<text text-anchor="middle" x="1416" y="-7575.57" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="1416" y="-7565.57" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_moe_router&#45;&gt;layer0_expert_send_gpu1 -->
<g id="edge45" class="edge">
<title>layer0_moe_router&#45;&gt;layer0_expert_send_gpu1</title>
<path fill="none" stroke="black" d="M1145.19,-7707.55C1204.99,-7680.22 1279.22,-7646.29 1334.83,-7620.87"/>
<polygon fill="black" stroke="black" points="1336.3,-7624.05 1343.94,-7616.71 1333.39,-7617.68 1336.3,-7624.05"/>
</g>
<!-- layer0_expert_send_gpu2 -->
<g id="node36" class="node">
<title>layer0_expert_send_gpu2</title>
<ellipse fill="lightgreen" stroke="black" cx="668" cy="-7582.77" rx="154.29" ry="33.89"/>
<ellipse fill="none" stroke="black" cx="668" cy="-7582.77" rx="158.3" ry="37.88"/>
<text text-anchor="middle" x="668" y="-7595.57" font-family="Arial" font-size="9.00">Expert Send (All&#45;to&#45;all)</text>
<text text-anchor="middle" x="668" y="-7585.57" font-family="Arial" font-size="9.00">GPU 2</text>
<text text-anchor="middle" x="668" y="-7575.57" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="668" y="-7565.57" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_moe_router&#45;&gt;layer0_expert_send_gpu2 -->
<g id="edge46" class="edge">
<title>layer0_moe_router&#45;&gt;layer0_expert_send_gpu2</title>
<path fill="none" stroke="black" d="M938.81,-7707.55C879.01,-7680.22 804.78,-7646.29 749.17,-7620.87"/>
<polygon fill="black" stroke="black" points="750.61,-7617.68 740.06,-7616.71 747.7,-7624.05 750.61,-7617.68"/>
</g>
<!-- layer0_expert_send_gpu3 -->
<g id="node37" class="node">
<title>layer0_expert_send_gpu3</title>
<ellipse fill="lightgreen" stroke="black" cx="294" cy="-7582.77" rx="154.29" ry="33.89"/>
<ellipse fill="none" stroke="black" cx="294" cy="-7582.77" rx="158.3" ry="37.88"/>
<text text-anchor="middle" x="294" y="-7595.57" font-family="Arial" font-size="9.00">Expert Send (All&#45;to&#45;all)</text>
<text text-anchor="middle" x="294" y="-7585.57" font-family="Arial" font-size="9.00">GPU 3</text>
<text text-anchor="middle" x="294" y="-7575.57" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="294" y="-7565.57" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_moe_router&#45;&gt;layer0_expert_send_gpu3 -->
<g id="edge47" class="edge">
<title>layer0_moe_router&#45;&gt;layer0_expert_send_gpu3</title>
<path fill="none" stroke="black" d="M836.12,-7707.66C701.44,-7676.88 530.03,-7637.71 416.4,-7611.74"/>
<polygon fill="black" stroke="black" points="417.15,-7608.32 406.62,-7609.51 415.59,-7615.15 417.15,-7608.32"/>
</g>
<!-- layer0_experts_gpu0 -->
<g id="node30" class="node">
<title>layer0_experts_gpu0</title>
<polygon fill="lightblue" stroke="black" points="1327,-7246.58 1091,-7246.58 1091,-7198.58 1327,-7198.58 1327,-7246.58"/>
<text text-anchor="middle" x="1209" y="-7235.38" font-family="Arial" font-size="9.00">Layer 0 Experts (4/16)</text>
<text text-anchor="middle" x="1209" y="-7225.38" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="1209" y="-7215.38" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="1209" y="-7205.38" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_experts_gpu0 -->
<g id="edge40" class="edge">
<title>layer0_gate&#45;&gt;layer0_experts_gpu0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1429.57,-7351.96C1375.72,-7320.62 1304.13,-7278.95 1257.33,-7251.71"/>
<polygon fill="black" stroke="black" points="1259,-7248.63 1248.6,-7246.63 1255.48,-7254.68 1259,-7248.63"/>
</g>
<!-- layer0_experts_gpu1 -->
<g id="node31" class="node">
<title>layer0_experts_gpu1</title>
<polygon fill="lightblue" stroke="black" points="1621,-7246.58 1385,-7246.58 1385,-7198.58 1621,-7198.58 1621,-7246.58"/>
<text text-anchor="middle" x="1503" y="-7235.38" font-family="Arial" font-size="9.00">Layer 0 Experts (4/16)</text>
<text text-anchor="middle" x="1503" y="-7225.38" font-family="Arial" font-size="9.00">GPU 1</text>
<text text-anchor="middle" x="1503" y="-7215.38" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="1503" y="-7205.38" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_experts_gpu1 -->
<g id="edge41" class="edge">
<title>layer0_gate&#45;&gt;layer0_experts_gpu1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1503,-7333.41C1503,-7307.53 1503,-7278.42 1503,-7256.68"/>
<polygon fill="black" stroke="black" points="1506.5,-7256.64 1503,-7246.64 1499.5,-7256.64 1506.5,-7256.64"/>
</g>
<!-- layer0_experts_gpu2 -->
<g id="node32" class="node">
<title>layer0_experts_gpu2</title>
<polygon fill="lightblue" stroke="black" points="1033,-7246.58 797,-7246.58 797,-7198.58 1033,-7198.58 1033,-7246.58"/>
<text text-anchor="middle" x="915" y="-7235.38" font-family="Arial" font-size="9.00">Layer 0 Experts (4/16)</text>
<text text-anchor="middle" x="915" y="-7225.38" font-family="Arial" font-size="9.00">GPU 2</text>
<text text-anchor="middle" x="915" y="-7215.38" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="915" y="-7205.38" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_experts_gpu2 -->
<g id="edge42" class="edge">
<title>layer0_gate&#45;&gt;layer0_experts_gpu2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1390.32,-7361.91C1277.9,-7329.19 1107.45,-7279.59 1004.13,-7249.52"/>
<polygon fill="black" stroke="black" points="1004.92,-7246.1 994.34,-7246.67 1002.97,-7252.82 1004.92,-7246.1"/>
</g>
<!-- layer0_experts_gpu3 -->
<g id="node33" class="node">
<title>layer0_experts_gpu3</title>
<polygon fill="lightblue" stroke="black" points="739,-7246.58 503,-7246.58 503,-7198.58 739,-7198.58 739,-7246.58"/>
<text text-anchor="middle" x="621" y="-7235.38" font-family="Arial" font-size="9.00">Layer 0 Experts (4/16)</text>
<text text-anchor="middle" x="621" y="-7225.38" font-family="Arial" font-size="9.00">GPU 3</text>
<text text-anchor="middle" x="621" y="-7215.38" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="621" y="-7205.38" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_experts_gpu3 -->
<g id="edge43" class="edge">
<title>layer0_gate&#45;&gt;layer0_experts_gpu3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1376.71,-7365.41C1330.34,-7354.95 1277.37,-7343.34 1229,-7333.58 1063.79,-7300.22 872.35,-7266.37 749.11,-7245.2"/>
<polygon fill="black" stroke="black" points="749.7,-7241.75 739.25,-7243.51 748.51,-7248.65 749.7,-7241.75"/>
</g>
<!-- layer0_moe_agg -->
<g id="node42" class="node">
<title>layer0_moe_agg</title>
<polygon fill="orange" stroke="black" points="1162.85,-7111.58 773.35,-7111.58 673.15,-7015.58 1062.65,-7015.58 1162.85,-7111.58"/>
<text text-anchor="middle" x="918" y="-7076.38" font-family="Arial" font-size="9.00">Layer 0 MoE Aggregate</text>
<text text-anchor="middle" x="918" y="-7066.38" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="918" y="-7056.38" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="918" y="-7046.38" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_experts_gpu0&#45;&gt;layer0_moe_agg -->
<g id="edge56" class="edge">
<title>layer0_experts_gpu0&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M1166.06,-7198.41C1126.23,-7176.92 1065.54,-7144.18 1014.16,-7116.46"/>
<polygon fill="black" stroke="black" points="1015.81,-7113.37 1005.34,-7111.7 1012.48,-7119.53 1015.81,-7113.37"/>
</g>
<!-- layer0_experts_gpu1&#45;&gt;layer0_moe_agg -->
<g id="edge57" class="edge">
<title>layer0_experts_gpu1&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M1417,-7198.5C1334.76,-7176.43 1208.09,-7142.43 1102.96,-7114.22"/>
<polygon fill="black" stroke="black" points="1103.74,-7110.8 1093.18,-7111.59 1101.93,-7117.56 1103.74,-7110.8"/>
</g>
<!-- layer0_experts_gpu2&#45;&gt;layer0_moe_agg -->
<g id="edge58" class="edge">
<title>layer0_experts_gpu2&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M915.44,-7198.41C915.83,-7178.38 916.4,-7148.57 916.9,-7122.17"/>
<polygon fill="black" stroke="black" points="920.4,-7121.93 917.1,-7111.86 913.41,-7121.79 920.4,-7121.93"/>
</g>
<!-- layer0_experts_gpu3&#45;&gt;layer0_moe_agg -->
<g id="edge59" class="edge">
<title>layer0_experts_gpu3&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M664.82,-7198.41C705.47,-7176.92 767.42,-7144.18 819.86,-7116.46"/>
<polygon fill="black" stroke="black" points="821.65,-7119.47 828.86,-7111.7 818.38,-7113.28 821.65,-7119.47"/>
</g>
<!-- layer0_expert_recv_gpu0 -->
<g id="node38" class="node">
<title>layer0_expert_recv_gpu0</title>
<ellipse fill="lightgreen" stroke="black" cx="1042" cy="-7395.7" rx="154.29" ry="33.89"/>
<ellipse fill="none" stroke="black" cx="1042" cy="-7395.7" rx="158.3" ry="37.88"/>
<text text-anchor="middle" x="1042" y="-7408.5" font-family="Arial" font-size="9.00">Expert Receive (All&#45;to&#45;all)</text>
<text text-anchor="middle" x="1042" y="-7398.5" font-family="Arial" font-size="9.00">GPU 0</text>
<text text-anchor="middle" x="1042" y="-7388.5" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="1042" y="-7378.5" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_expert_send_gpu0&#45;&gt;layer0_expert_recv_gpu0 -->
<g id="edge48" class="edge">
<title>layer0_expert_send_gpu0&#45;&gt;layer0_expert_recv_gpu0</title>
<path fill="none" stroke="black" d="M1042,-7544.77C1042,-7515.77 1042,-7475.22 1042,-7443.89"/>
<polygon fill="black" stroke="black" points="1045.5,-7443.65 1042,-7433.65 1038.5,-7443.65 1045.5,-7443.65"/>
</g>
<!-- layer0_expert_recv_gpu1 -->
<g id="node39" class="node">
<title>layer0_expert_recv_gpu1</title>
<ellipse fill="lightgreen" stroke="black" cx="1964" cy="-7395.7" rx="154.29" ry="33.89"/>
<ellipse fill="none" stroke="black" cx="1964" cy="-7395.7" rx="158.3" ry="37.88"/>
<text text-anchor="middle" x="1964" y="-7408.5" font-family="Arial" font-size="9.00">Expert Receive (All&#45;to&#45;all)</text>
<text text-anchor="middle" x="1964" y="-7398.5" font-family="Arial" font-size="9.00">GPU 1</text>
<text text-anchor="middle" x="1964" y="-7388.5" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="1964" y="-7378.5" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_expert_send_gpu1&#45;&gt;layer0_expert_recv_gpu1 -->
<g id="edge49" class="edge">
<title>layer0_expert_send_gpu1&#45;&gt;layer0_expert_recv_gpu1</title>
<path fill="none" stroke="black" d="M1505.88,-7551.42C1604.42,-7518.14 1762.1,-7464.89 1864.35,-7430.36"/>
<polygon fill="black" stroke="black" points="1865.72,-7433.59 1874.07,-7427.07 1863.48,-7426.96 1865.72,-7433.59"/>
</g>
<!-- layer0_expert_recv_gpu2 -->
<g id="node40" class="node">
<title>layer0_expert_recv_gpu2</title>
<ellipse fill="lightgreen" stroke="black" cx="668" cy="-7395.7" rx="154.29" ry="33.89"/>
<ellipse fill="none" stroke="black" cx="668" cy="-7395.7" rx="158.3" ry="37.88"/>
<text text-anchor="middle" x="668" y="-7408.5" font-family="Arial" font-size="9.00">Expert Receive (All&#45;to&#45;all)</text>
<text text-anchor="middle" x="668" y="-7398.5" font-family="Arial" font-size="9.00">GPU 2</text>
<text text-anchor="middle" x="668" y="-7388.5" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="668" y="-7378.5" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_expert_send_gpu2&#45;&gt;layer0_expert_recv_gpu2 -->
<g id="edge50" class="edge">
<title>layer0_expert_send_gpu2&#45;&gt;layer0_expert_recv_gpu2</title>
<path fill="none" stroke="black" d="M668,-7544.77C668,-7515.77 668,-7475.22 668,-7443.89"/>
<polygon fill="black" stroke="black" points="671.5,-7443.65 668,-7433.65 664.5,-7443.65 671.5,-7443.65"/>
</g>
<!-- layer0_expert_recv_gpu3 -->
<g id="node41" class="node">
<title>layer0_expert_recv_gpu3</title>
<ellipse fill="lightgreen" stroke="black" cx="294" cy="-7395.7" rx="154.29" ry="33.89"/>
<ellipse fill="none" stroke="black" cx="294" cy="-7395.7" rx="158.3" ry="37.88"/>
<text text-anchor="middle" x="294" y="-7408.5" font-family="Arial" font-size="9.00">Expert Receive (All&#45;to&#45;all)</text>
<text text-anchor="middle" x="294" y="-7398.5" font-family="Arial" font-size="9.00">GPU 3</text>
<text text-anchor="middle" x="294" y="-7388.5" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="294" y="-7378.5" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_expert_send_gpu3&#45;&gt;layer0_expert_recv_gpu3 -->
<g id="edge51" class="edge">
<title>layer0_expert_send_gpu3&#45;&gt;layer0_expert_recv_gpu3</title>
<path fill="none" stroke="black" d="M294,-7544.77C294,-7515.77 294,-7475.22 294,-7443.89"/>
<polygon fill="black" stroke="black" points="297.5,-7443.65 294,-7433.65 290.5,-7443.65 297.5,-7443.65"/>
</g>
<!-- layer0_expert_recv_gpu0&#45;&gt;layer0_experts_gpu0 -->
<g id="edge52" class="edge">
<title>layer0_expert_recv_gpu0&#45;&gt;layer0_experts_gpu0</title>
<path fill="none" stroke="black" d="M1077.42,-7358.41C1107.65,-7327.43 1150.64,-7283.38 1179.16,-7254.16"/>
<polygon fill="black" stroke="black" points="1181.95,-7256.3 1186.43,-7246.7 1176.95,-7251.41 1181.95,-7256.3"/>
</g>
<!-- layer0_expert_recv_gpu1&#45;&gt;layer0_experts_gpu1 -->
<g id="edge53" class="edge">
<title>layer0_expert_recv_gpu1&#45;&gt;layer0_experts_gpu1</title>
<path fill="none" stroke="black" d="M1879.98,-7363.52C1792.55,-7331.06 1657.1,-7280.78 1574.59,-7250.15"/>
<polygon fill="black" stroke="black" points="1575.63,-7246.81 1565.04,-7246.61 1573.2,-7253.37 1575.63,-7246.81"/>
</g>
<!-- layer0_expert_recv_gpu2&#45;&gt;layer0_experts_gpu2 -->
<g id="edge54" class="edge">
<title>layer0_expert_recv_gpu2&#45;&gt;layer0_experts_gpu2</title>
<path fill="none" stroke="black" d="M718.58,-7359.66C764.13,-7328.1 830.31,-7282.25 873.01,-7252.67"/>
<polygon fill="black" stroke="black" points="875.26,-7255.37 881.48,-7246.8 871.27,-7249.62 875.26,-7255.37"/>
</g>
<!-- layer0_expert_recv_gpu3&#45;&gt;layer0_experts_gpu3 -->
<g id="edge55" class="edge">
<title>layer0_expert_recv_gpu3&#45;&gt;layer0_experts_gpu3</title>
<path fill="none" stroke="black" d="M358.6,-7360.9C419.91,-7328.81 510.93,-7281.18 568.07,-7251.28"/>
<polygon fill="black" stroke="black" points="569.7,-7254.38 576.93,-7246.64 566.45,-7248.17 569.7,-7254.38"/>
</g>
<!-- layer0_moe_agg&#45;&gt;layer0_residual -->
<g id="edge60" class="edge">
<title>layer0_moe_agg&#45;&gt;layer0_residual</title>
<path fill="none" stroke="black" d="M918,-7015.49C918,-6992.12 918,-6963.69 918,-6939.04"/>
<polygon fill="black" stroke="black" points="921.5,-6938.74 918,-6928.74 914.5,-6938.74 921.5,-6938.74"/>
</g>
<!-- pipe_comm_0_1 -->
<g id="node44" class="node">
<title>pipe_comm_0_1</title>
<ellipse fill="red" stroke="black" cx="926" cy="-6685.57" rx="166.76" ry="41.02"/>
<ellipse fill="none" stroke="black" cx="926" cy="-6685.57" rx="170.76" ry="45.02"/>
<ellipse fill="none" stroke="black" cx="926" cy="-6685.57" rx="174.75" ry="49.02"/>
<text text-anchor="middle" x="926" y="-6703.37" font-family="Arial" font-size="9.00">Pipeline Communication</text>
<text text-anchor="middle" x="926" y="-6693.37" font-family="Arial" font-size="9.00">Stage 0  Stage 1</text>
<text text-anchor="middle" x="926" y="-6683.37" font-family="Arial" font-size="9.00">GPUs 0&#45;15  GPUs 16&#45;31</text>
<text text-anchor="middle" x="926" y="-6673.37" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="926" y="-6663.37" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_residual&#45;&gt;pipe_comm_0_1 -->
<g id="edge62" class="edge">
<title>layer0_residual&#45;&gt;pipe_comm_0_1</title>
<path fill="none" stroke="black" d="M919.96,-6832.36C921.05,-6805.92 922.43,-6772.74 923.59,-6744.71"/>
<polygon fill="black" stroke="black" points="927.09,-6744.77 924.01,-6734.64 920.1,-6744.48 927.09,-6744.77"/>
</g>
<!-- layer4_attn -->
<g id="node45" class="node">
<title>layer4_attn</title>
<polygon fill="lightgreen" stroke="black" points="1062,-6549.55 826,-6549.55 826,-6501.55 1062,-6501.55 1062,-6549.55"/>
<text text-anchor="middle" x="944" y="-6538.35" font-family="Arial" font-size="9.00">Layer 4 Attention (TP across GPUs 16&#45;19)</text>
<text text-anchor="middle" x="944" y="-6528.35" font-family="Arial" font-size="9.00">GPUs 16&#45;19</text>
<text text-anchor="middle" x="944" y="-6518.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="944" y="-6508.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- pipe_comm_0_1&#45;&gt;layer4_attn -->
<g id="edge63" class="edge">
<title>pipe_comm_0_1&#45;&gt;layer4_attn</title>
<path fill="none" stroke="black" d="M931.5,-6636.3C934.32,-6611.54 937.68,-6582.01 940.21,-6559.82"/>
<polygon fill="black" stroke="black" points="943.69,-6560.21 941.34,-6549.88 936.73,-6559.42 943.69,-6560.21"/>
</g>
<!-- layer4_moe -->
<g id="node46" class="node">
<title>layer4_moe</title>
<polygon fill="lightblue" stroke="black" points="1073,-6414.55 837,-6414.55 837,-6366.55 1073,-6366.55 1073,-6414.55"/>
<text text-anchor="middle" x="955" y="-6403.35" font-family="Arial" font-size="9.00">Layer 4 MoE (EP across GPUs 16&#45;19)</text>
<text text-anchor="middle" x="955" y="-6393.35" font-family="Arial" font-size="9.00">GPUs 16&#45;19</text>
<text text-anchor="middle" x="955" y="-6383.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="955" y="-6373.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer4_attn&#45;&gt;layer4_moe -->
<g id="edge64" class="edge">
<title>layer4_attn&#45;&gt;layer4_moe</title>
<path fill="none" stroke="black" d="M945.92,-6501.39C947.66,-6480.25 950.27,-6448.77 952.24,-6424.93"/>
<polygon fill="black" stroke="black" points="955.73,-6425.16 953.07,-6414.9 948.76,-6424.58 955.73,-6425.16"/>
</g>
<!-- layer4_residual -->
<g id="node47" class="node">
<title>layer4_residual</title>
<polygon fill="lightyellow" stroke="black" points="1205.85,-6279.55 816.35,-6279.55 716.15,-6183.55 1105.65,-6183.55 1205.85,-6279.55"/>
<text text-anchor="middle" x="961" y="-6244.35" font-family="Arial" font-size="9.00">Layer 4 Residual</text>
<text text-anchor="middle" x="961" y="-6234.35" font-family="Arial" font-size="9.00">GPU 16</text>
<text text-anchor="middle" x="961" y="-6224.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="961" y="-6214.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer4_moe&#45;&gt;layer4_residual -->
<g id="edge65" class="edge">
<title>layer4_moe&#45;&gt;layer4_residual</title>
<path fill="none" stroke="black" d="M955.89,-6366.39C956.65,-6346.36 957.79,-6316.55 958.8,-6290.14"/>
<polygon fill="black" stroke="black" points="962.31,-6289.96 959.19,-6279.84 955.31,-6289.7 962.31,-6289.96"/>
</g>
<!-- layer5_attn -->
<g id="node48" class="node">
<title>layer5_attn</title>
<polygon fill="lightgreen" stroke="black" points="1079,-6096.55 843,-6096.55 843,-6048.55 1079,-6048.55 1079,-6096.55"/>
<text text-anchor="middle" x="961" y="-6085.35" font-family="Arial" font-size="9.00">Layer 5 Attention (TP across GPUs 20&#45;23)</text>
<text text-anchor="middle" x="961" y="-6075.35" font-family="Arial" font-size="9.00">GPUs 20&#45;23</text>
<text text-anchor="middle" x="961" y="-6065.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="961" y="-6055.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer4_residual&#45;&gt;layer5_attn -->
<g id="edge66" class="edge">
<title>layer4_residual&#45;&gt;layer5_attn</title>
<path fill="none" stroke="black" d="M961,-6183.45C961,-6158.76 961,-6129.12 961,-6106.85"/>
<polygon fill="black" stroke="black" points="964.5,-6106.56 961,-6096.56 957.5,-6106.56 964.5,-6106.56"/>
</g>
<!-- layer5_moe -->
<g id="node49" class="node">
<title>layer5_moe</title>
<polygon fill="lightblue" stroke="black" points="1079,-5961.55 843,-5961.55 843,-5913.55 1079,-5913.55 1079,-5961.55"/>
<text text-anchor="middle" x="961" y="-5950.35" font-family="Arial" font-size="9.00">Layer 5 MoE (EP across GPUs 20&#45;23)</text>
<text text-anchor="middle" x="961" y="-5940.35" font-family="Arial" font-size="9.00">GPUs 20&#45;23</text>
<text text-anchor="middle" x="961" y="-5930.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="961" y="-5920.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer5_attn&#45;&gt;layer5_moe -->
<g id="edge67" class="edge">
<title>layer5_attn&#45;&gt;layer5_moe</title>
<path fill="none" stroke="black" d="M961,-6048.39C961,-6027.25 961,-5995.77 961,-5971.93"/>
<polygon fill="black" stroke="black" points="964.5,-5971.9 961,-5961.9 957.5,-5971.9 964.5,-5971.9"/>
</g>
<!-- layer5_residual -->
<g id="node50" class="node">
<title>layer5_residual</title>
<polygon fill="lightyellow" stroke="black" points="1205.85,-5826.55 816.35,-5826.55 716.15,-5730.55 1105.65,-5730.55 1205.85,-5826.55"/>
<text text-anchor="middle" x="961" y="-5791.35" font-family="Arial" font-size="9.00">Layer 5 Residual</text>
<text text-anchor="middle" x="961" y="-5781.35" font-family="Arial" font-size="9.00">GPU 20</text>
<text text-anchor="middle" x="961" y="-5771.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="961" y="-5761.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer5_moe&#45;&gt;layer5_residual -->
<g id="edge68" class="edge">
<title>layer5_moe&#45;&gt;layer5_residual</title>
<path fill="none" stroke="black" d="M961,-5913.39C961,-5893.36 961,-5863.55 961,-5837.14"/>
<polygon fill="black" stroke="black" points="964.5,-5836.84 961,-5826.84 957.5,-5836.84 964.5,-5836.84"/>
</g>
<!-- layer6_attn -->
<g id="node51" class="node">
<title>layer6_attn</title>
<polygon fill="lightgreen" stroke="black" points="1079,-5643.55 843,-5643.55 843,-5595.55 1079,-5595.55 1079,-5643.55"/>
<text text-anchor="middle" x="961" y="-5632.35" font-family="Arial" font-size="9.00">Layer 6 Attention (TP across GPUs 24&#45;27)</text>
<text text-anchor="middle" x="961" y="-5622.35" font-family="Arial" font-size="9.00">GPUs 24&#45;27</text>
<text text-anchor="middle" x="961" y="-5612.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="961" y="-5602.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer5_residual&#45;&gt;layer6_attn -->
<g id="edge69" class="edge">
<title>layer5_residual&#45;&gt;layer6_attn</title>
<path fill="none" stroke="black" d="M961,-5730.45C961,-5705.76 961,-5676.12 961,-5653.85"/>
<polygon fill="black" stroke="black" points="964.5,-5653.56 961,-5643.56 957.5,-5653.56 964.5,-5653.56"/>
</g>
<!-- layer6_moe -->
<g id="node52" class="node">
<title>layer6_moe</title>
<polygon fill="lightblue" stroke="black" points="1079,-5508.55 843,-5508.55 843,-5460.55 1079,-5460.55 1079,-5508.55"/>
<text text-anchor="middle" x="961" y="-5497.35" font-family="Arial" font-size="9.00">Layer 6 MoE (EP across GPUs 24&#45;27)</text>
<text text-anchor="middle" x="961" y="-5487.35" font-family="Arial" font-size="9.00">GPUs 24&#45;27</text>
<text text-anchor="middle" x="961" y="-5477.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="961" y="-5467.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer6_attn&#45;&gt;layer6_moe -->
<g id="edge70" class="edge">
<title>layer6_attn&#45;&gt;layer6_moe</title>
<path fill="none" stroke="black" d="M961,-5595.39C961,-5574.25 961,-5542.77 961,-5518.93"/>
<polygon fill="black" stroke="black" points="964.5,-5518.9 961,-5508.9 957.5,-5518.9 964.5,-5518.9"/>
</g>
<!-- layer6_residual -->
<g id="node53" class="node">
<title>layer6_residual</title>
<polygon fill="lightyellow" stroke="black" points="1205.85,-5373.55 816.35,-5373.55 716.15,-5277.55 1105.65,-5277.55 1205.85,-5373.55"/>
<text text-anchor="middle" x="961" y="-5338.35" font-family="Arial" font-size="9.00">Layer 6 Residual</text>
<text text-anchor="middle" x="961" y="-5328.35" font-family="Arial" font-size="9.00">GPU 24</text>
<text text-anchor="middle" x="961" y="-5318.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="961" y="-5308.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer6_moe&#45;&gt;layer6_residual -->
<g id="edge71" class="edge">
<title>layer6_moe&#45;&gt;layer6_residual</title>
<path fill="none" stroke="black" d="M961,-5460.39C961,-5440.36 961,-5410.55 961,-5384.14"/>
<polygon fill="black" stroke="black" points="964.5,-5383.84 961,-5373.84 957.5,-5383.84 964.5,-5383.84"/>
</g>
<!-- layer7_attn -->
<g id="node54" class="node">
<title>layer7_attn</title>
<polygon fill="lightgreen" stroke="black" points="1079,-5190.55 843,-5190.55 843,-5142.55 1079,-5142.55 1079,-5190.55"/>
<text text-anchor="middle" x="961" y="-5179.35" font-family="Arial" font-size="9.00">Layer 7 Attention (TP across GPUs 28&#45;31)</text>
<text text-anchor="middle" x="961" y="-5169.35" font-family="Arial" font-size="9.00">GPUs 28&#45;31</text>
<text text-anchor="middle" x="961" y="-5159.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="961" y="-5149.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer6_residual&#45;&gt;layer7_attn -->
<g id="edge72" class="edge">
<title>layer6_residual&#45;&gt;layer7_attn</title>
<path fill="none" stroke="black" d="M961,-5277.45C961,-5252.76 961,-5223.12 961,-5200.85"/>
<polygon fill="black" stroke="black" points="964.5,-5200.56 961,-5190.56 957.5,-5200.56 964.5,-5200.56"/>
</g>
<!-- layer7_moe -->
<g id="node55" class="node">
<title>layer7_moe</title>
<polygon fill="lightblue" stroke="black" points="1079,-5055.55 843,-5055.55 843,-5007.55 1079,-5007.55 1079,-5055.55"/>
<text text-anchor="middle" x="961" y="-5044.35" font-family="Arial" font-size="9.00">Layer 7 MoE (EP across GPUs 28&#45;31)</text>
<text text-anchor="middle" x="961" y="-5034.35" font-family="Arial" font-size="9.00">GPUs 28&#45;31</text>
<text text-anchor="middle" x="961" y="-5024.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="961" y="-5014.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer7_attn&#45;&gt;layer7_moe -->
<g id="edge73" class="edge">
<title>layer7_attn&#45;&gt;layer7_moe</title>
<path fill="none" stroke="black" d="M961,-5142.39C961,-5121.25 961,-5089.77 961,-5065.93"/>
<polygon fill="black" stroke="black" points="964.5,-5065.9 961,-5055.9 957.5,-5065.9 964.5,-5065.9"/>
</g>
<!-- layer7_residual -->
<g id="node56" class="node">
<title>layer7_residual</title>
<polygon fill="lightyellow" stroke="black" points="1205.85,-4920.55 816.35,-4920.55 716.15,-4824.55 1105.65,-4824.55 1205.85,-4920.55"/>
<text text-anchor="middle" x="961" y="-4885.35" font-family="Arial" font-size="9.00">Layer 7 Residual</text>
<text text-anchor="middle" x="961" y="-4875.35" font-family="Arial" font-size="9.00">GPU 28</text>
<text text-anchor="middle" x="961" y="-4865.35" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="961" y="-4855.35" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer7_moe&#45;&gt;layer7_residual -->
<g id="edge74" class="edge">
<title>layer7_moe&#45;&gt;layer7_residual</title>
<path fill="none" stroke="black" d="M961,-5007.39C961,-4987.36 961,-4957.55 961,-4931.14"/>
<polygon fill="black" stroke="black" points="964.5,-4930.84 961,-4920.84 957.5,-4930.84 964.5,-4930.84"/>
</g>
<!-- pipe_comm_1_2 -->
<g id="node57" class="node">
<title>pipe_comm_1_2</title>
<ellipse fill="red" stroke="black" cx="976" cy="-4677.54" rx="166.76" ry="41.02"/>
<ellipse fill="none" stroke="black" cx="976" cy="-4677.54" rx="170.76" ry="45.02"/>
<ellipse fill="none" stroke="black" cx="976" cy="-4677.54" rx="174.75" ry="49.02"/>
<text text-anchor="middle" x="976" y="-4695.34" font-family="Arial" font-size="9.00">Pipeline Communication</text>
<text text-anchor="middle" x="976" y="-4685.34" font-family="Arial" font-size="9.00">Stage 1  Stage 2</text>
<text text-anchor="middle" x="976" y="-4675.34" font-family="Arial" font-size="9.00">GPUs 16&#45;31  GPUs 32&#45;47</text>
<text text-anchor="middle" x="976" y="-4665.34" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="976" y="-4655.34" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer7_residual&#45;&gt;pipe_comm_1_2 -->
<g id="edge75" class="edge">
<title>layer7_residual&#45;&gt;pipe_comm_1_2</title>
<path fill="none" stroke="black" d="M964.67,-4824.34C966.72,-4797.9 969.3,-4764.71 971.48,-4736.68"/>
<polygon fill="black" stroke="black" points="974.98,-4736.85 972.26,-4726.61 968,-4736.31 974.98,-4736.85"/>
</g>
<!-- layer8_attn -->
<g id="node58" class="node">
<title>layer8_attn</title>
<polygon fill="lightgreen" stroke="black" points="1112,-4541.53 876,-4541.53 876,-4493.53 1112,-4493.53 1112,-4541.53"/>
<text text-anchor="middle" x="994" y="-4530.33" font-family="Arial" font-size="9.00">Layer 8 Attention (TP across GPUs 32&#45;35)</text>
<text text-anchor="middle" x="994" y="-4520.33" font-family="Arial" font-size="9.00">GPUs 32&#45;35</text>
<text text-anchor="middle" x="994" y="-4510.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="994" y="-4500.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- pipe_comm_1_2&#45;&gt;layer8_attn -->
<g id="edge76" class="edge">
<title>pipe_comm_1_2&#45;&gt;layer8_attn</title>
<path fill="none" stroke="black" d="M981.5,-4628.27C984.32,-4603.52 987.68,-4573.98 990.21,-4551.8"/>
<polygon fill="black" stroke="black" points="993.69,-4552.19 991.34,-4541.85 986.73,-4551.39 993.69,-4552.19"/>
</g>
<!-- layer8_moe -->
<g id="node59" class="node">
<title>layer8_moe</title>
<polygon fill="lightblue" stroke="black" points="1123,-4406.53 887,-4406.53 887,-4358.53 1123,-4358.53 1123,-4406.53"/>
<text text-anchor="middle" x="1005" y="-4395.33" font-family="Arial" font-size="9.00">Layer 8 MoE (EP across GPUs 32&#45;35)</text>
<text text-anchor="middle" x="1005" y="-4385.33" font-family="Arial" font-size="9.00">GPUs 32&#45;35</text>
<text text-anchor="middle" x="1005" y="-4375.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1005" y="-4365.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer8_attn&#45;&gt;layer8_moe -->
<g id="edge77" class="edge">
<title>layer8_attn&#45;&gt;layer8_moe</title>
<path fill="none" stroke="black" d="M995.92,-4493.36C997.66,-4472.23 1000.27,-4440.75 1002.24,-4416.9"/>
<polygon fill="black" stroke="black" points="1005.73,-4417.13 1003.07,-4406.88 998.76,-4416.55 1005.73,-4417.13"/>
</g>
<!-- layer8_residual -->
<g id="node60" class="node">
<title>layer8_residual</title>
<polygon fill="lightyellow" stroke="black" points="1255.85,-4271.53 866.35,-4271.53 766.15,-4175.53 1155.65,-4175.53 1255.85,-4271.53"/>
<text text-anchor="middle" x="1011" y="-4236.33" font-family="Arial" font-size="9.00">Layer 8 Residual</text>
<text text-anchor="middle" x="1011" y="-4226.33" font-family="Arial" font-size="9.00">GPU 32</text>
<text text-anchor="middle" x="1011" y="-4216.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1011" y="-4206.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer8_moe&#45;&gt;layer8_residual -->
<g id="edge78" class="edge">
<title>layer8_moe&#45;&gt;layer8_residual</title>
<path fill="none" stroke="black" d="M1005.89,-4358.36C1006.65,-4338.33 1007.79,-4308.52 1008.8,-4282.12"/>
<polygon fill="black" stroke="black" points="1012.31,-4281.94 1009.19,-4271.81 1005.31,-4281.67 1012.31,-4281.94"/>
</g>
<!-- layer9_attn -->
<g id="node61" class="node">
<title>layer9_attn</title>
<polygon fill="lightgreen" stroke="black" points="1129,-4088.53 893,-4088.53 893,-4040.53 1129,-4040.53 1129,-4088.53"/>
<text text-anchor="middle" x="1011" y="-4077.33" font-family="Arial" font-size="9.00">Layer 9 Attention (TP across GPUs 36&#45;39)</text>
<text text-anchor="middle" x="1011" y="-4067.33" font-family="Arial" font-size="9.00">GPUs 36&#45;39</text>
<text text-anchor="middle" x="1011" y="-4057.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1011" y="-4047.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer8_residual&#45;&gt;layer9_attn -->
<g id="edge79" class="edge">
<title>layer8_residual&#45;&gt;layer9_attn</title>
<path fill="none" stroke="black" d="M1011,-4175.42C1011,-4150.74 1011,-4121.1 1011,-4098.82"/>
<polygon fill="black" stroke="black" points="1014.5,-4098.53 1011,-4088.53 1007.5,-4098.53 1014.5,-4098.53"/>
</g>
<!-- layer9_moe -->
<g id="node62" class="node">
<title>layer9_moe</title>
<polygon fill="lightblue" stroke="black" points="1129,-3953.53 893,-3953.53 893,-3905.53 1129,-3905.53 1129,-3953.53"/>
<text text-anchor="middle" x="1011" y="-3942.33" font-family="Arial" font-size="9.00">Layer 9 MoE (EP across GPUs 36&#45;39)</text>
<text text-anchor="middle" x="1011" y="-3932.33" font-family="Arial" font-size="9.00">GPUs 36&#45;39</text>
<text text-anchor="middle" x="1011" y="-3922.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1011" y="-3912.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer9_attn&#45;&gt;layer9_moe -->
<g id="edge80" class="edge">
<title>layer9_attn&#45;&gt;layer9_moe</title>
<path fill="none" stroke="black" d="M1011,-4040.36C1011,-4019.23 1011,-3987.75 1011,-3963.9"/>
<polygon fill="black" stroke="black" points="1014.5,-3963.88 1011,-3953.88 1007.5,-3963.88 1014.5,-3963.88"/>
</g>
<!-- layer9_residual -->
<g id="node63" class="node">
<title>layer9_residual</title>
<polygon fill="lightyellow" stroke="black" points="1255.85,-3818.53 866.35,-3818.53 766.15,-3722.53 1155.65,-3722.53 1255.85,-3818.53"/>
<text text-anchor="middle" x="1011" y="-3783.33" font-family="Arial" font-size="9.00">Layer 9 Residual</text>
<text text-anchor="middle" x="1011" y="-3773.33" font-family="Arial" font-size="9.00">GPU 36</text>
<text text-anchor="middle" x="1011" y="-3763.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1011" y="-3753.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer9_moe&#45;&gt;layer9_residual -->
<g id="edge81" class="edge">
<title>layer9_moe&#45;&gt;layer9_residual</title>
<path fill="none" stroke="black" d="M1011,-3905.36C1011,-3885.33 1011,-3855.52 1011,-3829.12"/>
<polygon fill="black" stroke="black" points="1014.5,-3828.81 1011,-3818.81 1007.5,-3828.81 1014.5,-3828.81"/>
</g>
<!-- layer10_attn -->
<g id="node64" class="node">
<title>layer10_attn</title>
<polygon fill="lightgreen" stroke="black" points="1129,-3635.53 893,-3635.53 893,-3587.53 1129,-3587.53 1129,-3635.53"/>
<text text-anchor="middle" x="1011" y="-3624.33" font-family="Arial" font-size="9.00">Layer 10 Attention (TP across GPUs 40&#45;43)</text>
<text text-anchor="middle" x="1011" y="-3614.33" font-family="Arial" font-size="9.00">GPUs 40&#45;43</text>
<text text-anchor="middle" x="1011" y="-3604.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1011" y="-3594.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer9_residual&#45;&gt;layer10_attn -->
<g id="edge82" class="edge">
<title>layer9_residual&#45;&gt;layer10_attn</title>
<path fill="none" stroke="black" d="M1011,-3722.42C1011,-3697.74 1011,-3668.1 1011,-3645.82"/>
<polygon fill="black" stroke="black" points="1014.5,-3645.53 1011,-3635.53 1007.5,-3645.53 1014.5,-3645.53"/>
</g>
<!-- layer10_moe -->
<g id="node65" class="node">
<title>layer10_moe</title>
<polygon fill="lightblue" stroke="black" points="1129,-3500.53 893,-3500.53 893,-3452.53 1129,-3452.53 1129,-3500.53"/>
<text text-anchor="middle" x="1011" y="-3489.33" font-family="Arial" font-size="9.00">Layer 10 MoE (EP across GPUs 40&#45;43)</text>
<text text-anchor="middle" x="1011" y="-3479.33" font-family="Arial" font-size="9.00">GPUs 40&#45;43</text>
<text text-anchor="middle" x="1011" y="-3469.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1011" y="-3459.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer10_attn&#45;&gt;layer10_moe -->
<g id="edge83" class="edge">
<title>layer10_attn&#45;&gt;layer10_moe</title>
<path fill="none" stroke="black" d="M1011,-3587.36C1011,-3566.23 1011,-3534.75 1011,-3510.9"/>
<polygon fill="black" stroke="black" points="1014.5,-3510.88 1011,-3500.88 1007.5,-3510.88 1014.5,-3510.88"/>
</g>
<!-- layer10_residual -->
<g id="node66" class="node">
<title>layer10_residual</title>
<polygon fill="lightyellow" stroke="black" points="1255.85,-3365.53 866.35,-3365.53 766.15,-3269.53 1155.65,-3269.53 1255.85,-3365.53"/>
<text text-anchor="middle" x="1011" y="-3330.33" font-family="Arial" font-size="9.00">Layer 10 Residual</text>
<text text-anchor="middle" x="1011" y="-3320.33" font-family="Arial" font-size="9.00">GPU 40</text>
<text text-anchor="middle" x="1011" y="-3310.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1011" y="-3300.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer10_moe&#45;&gt;layer10_residual -->
<g id="edge84" class="edge">
<title>layer10_moe&#45;&gt;layer10_residual</title>
<path fill="none" stroke="black" d="M1011,-3452.36C1011,-3432.33 1011,-3402.52 1011,-3376.12"/>
<polygon fill="black" stroke="black" points="1014.5,-3375.81 1011,-3365.81 1007.5,-3375.81 1014.5,-3375.81"/>
</g>
<!-- layer11_attn -->
<g id="node67" class="node">
<title>layer11_attn</title>
<polygon fill="lightgreen" stroke="black" points="1129,-3182.53 893,-3182.53 893,-3134.53 1129,-3134.53 1129,-3182.53"/>
<text text-anchor="middle" x="1011" y="-3171.33" font-family="Arial" font-size="9.00">Layer 11 Attention (TP across GPUs 44&#45;47)</text>
<text text-anchor="middle" x="1011" y="-3161.33" font-family="Arial" font-size="9.00">GPUs 44&#45;47</text>
<text text-anchor="middle" x="1011" y="-3151.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1011" y="-3141.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer10_residual&#45;&gt;layer11_attn -->
<g id="edge85" class="edge">
<title>layer10_residual&#45;&gt;layer11_attn</title>
<path fill="none" stroke="black" d="M1011,-3269.42C1011,-3244.74 1011,-3215.1 1011,-3192.82"/>
<polygon fill="black" stroke="black" points="1014.5,-3192.53 1011,-3182.53 1007.5,-3192.53 1014.5,-3192.53"/>
</g>
<!-- layer11_moe -->
<g id="node68" class="node">
<title>layer11_moe</title>
<polygon fill="lightblue" stroke="black" points="1129,-3047.53 893,-3047.53 893,-2999.53 1129,-2999.53 1129,-3047.53"/>
<text text-anchor="middle" x="1011" y="-3036.33" font-family="Arial" font-size="9.00">Layer 11 MoE (EP across GPUs 44&#45;47)</text>
<text text-anchor="middle" x="1011" y="-3026.33" font-family="Arial" font-size="9.00">GPUs 44&#45;47</text>
<text text-anchor="middle" x="1011" y="-3016.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1011" y="-3006.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer11_attn&#45;&gt;layer11_moe -->
<g id="edge86" class="edge">
<title>layer11_attn&#45;&gt;layer11_moe</title>
<path fill="none" stroke="black" d="M1011,-3134.36C1011,-3113.23 1011,-3081.75 1011,-3057.9"/>
<polygon fill="black" stroke="black" points="1014.5,-3057.88 1011,-3047.88 1007.5,-3057.88 1014.5,-3057.88"/>
</g>
<!-- layer11_residual -->
<g id="node69" class="node">
<title>layer11_residual</title>
<polygon fill="lightyellow" stroke="black" points="1255.85,-2912.53 866.35,-2912.53 766.15,-2816.53 1155.65,-2816.53 1255.85,-2912.53"/>
<text text-anchor="middle" x="1011" y="-2877.33" font-family="Arial" font-size="9.00">Layer 11 Residual</text>
<text text-anchor="middle" x="1011" y="-2867.33" font-family="Arial" font-size="9.00">GPU 44</text>
<text text-anchor="middle" x="1011" y="-2857.33" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1011" y="-2847.33" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer11_moe&#45;&gt;layer11_residual -->
<g id="edge87" class="edge">
<title>layer11_moe&#45;&gt;layer11_residual</title>
<path fill="none" stroke="black" d="M1011,-2999.36C1011,-2979.33 1011,-2949.52 1011,-2923.12"/>
<polygon fill="black" stroke="black" points="1014.5,-2922.81 1011,-2912.81 1007.5,-2922.81 1014.5,-2922.81"/>
</g>
<!-- pipe_comm_2_3 -->
<g id="node70" class="node">
<title>pipe_comm_2_3</title>
<ellipse fill="red" stroke="black" cx="1041" cy="-2669.52" rx="181.04" ry="41.02"/>
<ellipse fill="none" stroke="black" cx="1041" cy="-2669.52" rx="185.04" ry="45.02"/>
<ellipse fill="none" stroke="black" cx="1041" cy="-2669.52" rx="189.04" ry="49.02"/>
<text text-anchor="middle" x="1041" y="-2687.32" font-family="Arial" font-size="9.00">Pipeline Communication</text>
<text text-anchor="middle" x="1041" y="-2677.32" font-family="Arial" font-size="9.00">Stage 2  Stage 3</text>
<text text-anchor="middle" x="1041" y="-2667.32" font-family="Arial" font-size="9.00">GPUs 32&#45;47  GPUs 48&#45;63</text>
<text text-anchor="middle" x="1041" y="-2657.32" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1041" y="-2647.32" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024</text>
</g>
<!-- layer11_residual&#45;&gt;pipe_comm_2_3 -->
<g id="edge88" class="edge">
<title>layer11_residual&#45;&gt;pipe_comm_2_3</title>
<path fill="none" stroke="black" d="M1018.34,-2816.31C1022.45,-2789.87 1027.61,-2756.69 1031.96,-2728.66"/>
<polygon fill="black" stroke="black" points="1035.45,-2729.01 1033.53,-2718.59 1028.53,-2727.93 1035.45,-2729.01"/>
</g>
<!-- layer12_attn -->
<g id="node71" class="node">
<title>layer12_attn</title>
<polygon fill="lightgreen" stroke="black" points="1188,-2533.5 952,-2533.5 952,-2485.5 1188,-2485.5 1188,-2533.5"/>
<text text-anchor="middle" x="1070" y="-2522.3" font-family="Arial" font-size="9.00">Layer 12 Attention (TP across GPUs 48&#45;51)</text>
<text text-anchor="middle" x="1070" y="-2512.3" font-family="Arial" font-size="9.00">GPUs 48&#45;51</text>
<text text-anchor="middle" x="1070" y="-2502.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1070" y="-2492.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- pipe_comm_2_3&#45;&gt;layer12_attn -->
<g id="edge89" class="edge">
<title>pipe_comm_2_3&#45;&gt;layer12_attn</title>
<path fill="none" stroke="black" d="M1049.86,-2620.25C1054.4,-2595.49 1059.82,-2565.96 1063.89,-2543.77"/>
<polygon fill="black" stroke="black" points="1067.36,-2544.3 1065.72,-2533.83 1060.47,-2543.03 1067.36,-2544.3"/>
</g>
<!-- layer12_moe -->
<g id="node72" class="node">
<title>layer12_moe</title>
<polygon fill="lightblue" stroke="black" points="1204,-2398.5 968,-2398.5 968,-2350.5 1204,-2350.5 1204,-2398.5"/>
<text text-anchor="middle" x="1086" y="-2387.3" font-family="Arial" font-size="9.00">Layer 12 MoE (EP across GPUs 48&#45;51)</text>
<text text-anchor="middle" x="1086" y="-2377.3" font-family="Arial" font-size="9.00">GPUs 48&#45;51</text>
<text text-anchor="middle" x="1086" y="-2367.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1086" y="-2357.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer12_attn&#45;&gt;layer12_moe -->
<g id="edge90" class="edge">
<title>layer12_attn&#45;&gt;layer12_moe</title>
<path fill="none" stroke="black" d="M1072.79,-2485.34C1075.33,-2464.2 1079.12,-2432.72 1081.99,-2408.88"/>
<polygon fill="black" stroke="black" points="1085.47,-2409.2 1083.19,-2398.85 1078.52,-2408.36 1085.47,-2409.2"/>
</g>
<!-- layer12_residual -->
<g id="node73" class="node">
<title>layer12_residual</title>
<polygon fill="lightyellow" stroke="black" points="1334.85,-2263.5 945.35,-2263.5 845.15,-2167.5 1234.65,-2167.5 1334.85,-2263.5"/>
<text text-anchor="middle" x="1090" y="-2228.3" font-family="Arial" font-size="9.00">Layer 12 Residual</text>
<text text-anchor="middle" x="1090" y="-2218.3" font-family="Arial" font-size="9.00">GPU 48</text>
<text text-anchor="middle" x="1090" y="-2208.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-2198.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer12_moe&#45;&gt;layer12_residual -->
<g id="edge91" class="edge">
<title>layer12_moe&#45;&gt;layer12_residual</title>
<path fill="none" stroke="black" d="M1086.59,-2350.34C1087.1,-2330.31 1087.86,-2300.5 1088.53,-2274.09"/>
<polygon fill="black" stroke="black" points="1092.04,-2273.88 1088.8,-2263.79 1085.04,-2273.7 1092.04,-2273.88"/>
</g>
<!-- layer13_attn -->
<g id="node74" class="node">
<title>layer13_attn</title>
<polygon fill="lightgreen" stroke="black" points="1208,-2080.5 972,-2080.5 972,-2032.5 1208,-2032.5 1208,-2080.5"/>
<text text-anchor="middle" x="1090" y="-2069.3" font-family="Arial" font-size="9.00">Layer 13 Attention (TP across GPUs 52&#45;55)</text>
<text text-anchor="middle" x="1090" y="-2059.3" font-family="Arial" font-size="9.00">GPUs 52&#45;55</text>
<text text-anchor="middle" x="1090" y="-2049.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-2039.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer12_residual&#45;&gt;layer13_attn -->
<g id="edge92" class="edge">
<title>layer12_residual&#45;&gt;layer13_attn</title>
<path fill="none" stroke="black" d="M1090,-2167.4C1090,-2142.72 1090,-2113.07 1090,-2090.8"/>
<polygon fill="black" stroke="black" points="1093.5,-2090.51 1090,-2080.51 1086.5,-2090.51 1093.5,-2090.51"/>
</g>
<!-- layer13_moe -->
<g id="node75" class="node">
<title>layer13_moe</title>
<polygon fill="lightblue" stroke="black" points="1208,-1945.5 972,-1945.5 972,-1897.5 1208,-1897.5 1208,-1945.5"/>
<text text-anchor="middle" x="1090" y="-1934.3" font-family="Arial" font-size="9.00">Layer 13 MoE (EP across GPUs 52&#45;55)</text>
<text text-anchor="middle" x="1090" y="-1924.3" font-family="Arial" font-size="9.00">GPUs 52&#45;55</text>
<text text-anchor="middle" x="1090" y="-1914.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-1904.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer13_attn&#45;&gt;layer13_moe -->
<g id="edge93" class="edge">
<title>layer13_attn&#45;&gt;layer13_moe</title>
<path fill="none" stroke="black" d="M1090,-2032.34C1090,-2011.2 1090,-1979.72 1090,-1955.88"/>
<polygon fill="black" stroke="black" points="1093.5,-1955.85 1090,-1945.85 1086.5,-1955.85 1093.5,-1955.85"/>
</g>
<!-- layer13_residual -->
<g id="node76" class="node">
<title>layer13_residual</title>
<polygon fill="lightyellow" stroke="black" points="1334.85,-1810.5 945.35,-1810.5 845.15,-1714.5 1234.65,-1714.5 1334.85,-1810.5"/>
<text text-anchor="middle" x="1090" y="-1775.3" font-family="Arial" font-size="9.00">Layer 13 Residual</text>
<text text-anchor="middle" x="1090" y="-1765.3" font-family="Arial" font-size="9.00">GPU 52</text>
<text text-anchor="middle" x="1090" y="-1755.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-1745.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer13_moe&#45;&gt;layer13_residual -->
<g id="edge94" class="edge">
<title>layer13_moe&#45;&gt;layer13_residual</title>
<path fill="none" stroke="black" d="M1090,-1897.34C1090,-1877.31 1090,-1847.5 1090,-1821.09"/>
<polygon fill="black" stroke="black" points="1093.5,-1820.79 1090,-1810.79 1086.5,-1820.79 1093.5,-1820.79"/>
</g>
<!-- layer14_attn -->
<g id="node77" class="node">
<title>layer14_attn</title>
<polygon fill="lightgreen" stroke="black" points="1208,-1627.5 972,-1627.5 972,-1579.5 1208,-1579.5 1208,-1627.5"/>
<text text-anchor="middle" x="1090" y="-1616.3" font-family="Arial" font-size="9.00">Layer 14 Attention (TP across GPUs 56&#45;59)</text>
<text text-anchor="middle" x="1090" y="-1606.3" font-family="Arial" font-size="9.00">GPUs 56&#45;59</text>
<text text-anchor="middle" x="1090" y="-1596.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-1586.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer13_residual&#45;&gt;layer14_attn -->
<g id="edge95" class="edge">
<title>layer13_residual&#45;&gt;layer14_attn</title>
<path fill="none" stroke="black" d="M1090,-1714.4C1090,-1689.72 1090,-1660.07 1090,-1637.8"/>
<polygon fill="black" stroke="black" points="1093.5,-1637.51 1090,-1627.51 1086.5,-1637.51 1093.5,-1637.51"/>
</g>
<!-- layer14_moe -->
<g id="node78" class="node">
<title>layer14_moe</title>
<polygon fill="lightblue" stroke="black" points="1208,-1492.5 972,-1492.5 972,-1444.5 1208,-1444.5 1208,-1492.5"/>
<text text-anchor="middle" x="1090" y="-1481.3" font-family="Arial" font-size="9.00">Layer 14 MoE (EP across GPUs 56&#45;59)</text>
<text text-anchor="middle" x="1090" y="-1471.3" font-family="Arial" font-size="9.00">GPUs 56&#45;59</text>
<text text-anchor="middle" x="1090" y="-1461.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-1451.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer14_attn&#45;&gt;layer14_moe -->
<g id="edge96" class="edge">
<title>layer14_attn&#45;&gt;layer14_moe</title>
<path fill="none" stroke="black" d="M1090,-1579.34C1090,-1558.2 1090,-1526.72 1090,-1502.88"/>
<polygon fill="black" stroke="black" points="1093.5,-1502.85 1090,-1492.85 1086.5,-1502.85 1093.5,-1502.85"/>
</g>
<!-- layer14_residual -->
<g id="node79" class="node">
<title>layer14_residual</title>
<polygon fill="lightyellow" stroke="black" points="1334.85,-1357.5 945.35,-1357.5 845.15,-1261.5 1234.65,-1261.5 1334.85,-1357.5"/>
<text text-anchor="middle" x="1090" y="-1322.3" font-family="Arial" font-size="9.00">Layer 14 Residual</text>
<text text-anchor="middle" x="1090" y="-1312.3" font-family="Arial" font-size="9.00">GPU 56</text>
<text text-anchor="middle" x="1090" y="-1302.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-1292.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer14_moe&#45;&gt;layer14_residual -->
<g id="edge97" class="edge">
<title>layer14_moe&#45;&gt;layer14_residual</title>
<path fill="none" stroke="black" d="M1090,-1444.34C1090,-1424.31 1090,-1394.5 1090,-1368.09"/>
<polygon fill="black" stroke="black" points="1093.5,-1367.79 1090,-1357.79 1086.5,-1367.79 1093.5,-1367.79"/>
</g>
<!-- layer15_attn -->
<g id="node80" class="node">
<title>layer15_attn</title>
<polygon fill="lightgreen" stroke="black" points="1208,-1174.5 972,-1174.5 972,-1126.5 1208,-1126.5 1208,-1174.5"/>
<text text-anchor="middle" x="1090" y="-1163.3" font-family="Arial" font-size="9.00">Layer 15 Attention (TP across GPUs 60&#45;63)</text>
<text text-anchor="middle" x="1090" y="-1153.3" font-family="Arial" font-size="9.00">GPUs 60&#45;63</text>
<text text-anchor="middle" x="1090" y="-1143.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-1133.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer14_residual&#45;&gt;layer15_attn -->
<g id="edge98" class="edge">
<title>layer14_residual&#45;&gt;layer15_attn</title>
<path fill="none" stroke="black" d="M1090,-1261.4C1090,-1236.72 1090,-1207.07 1090,-1184.8"/>
<polygon fill="black" stroke="black" points="1093.5,-1184.51 1090,-1174.51 1086.5,-1184.51 1093.5,-1184.51"/>
</g>
<!-- layer15_moe -->
<g id="node81" class="node">
<title>layer15_moe</title>
<polygon fill="lightblue" stroke="black" points="1208,-1039.5 972,-1039.5 972,-991.5 1208,-991.5 1208,-1039.5"/>
<text text-anchor="middle" x="1090" y="-1028.3" font-family="Arial" font-size="9.00">Layer 15 MoE (EP across GPUs 60&#45;63)</text>
<text text-anchor="middle" x="1090" y="-1018.3" font-family="Arial" font-size="9.00">GPUs 60&#45;63</text>
<text text-anchor="middle" x="1090" y="-1008.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-998.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer15_attn&#45;&gt;layer15_moe -->
<g id="edge99" class="edge">
<title>layer15_attn&#45;&gt;layer15_moe</title>
<path fill="none" stroke="black" d="M1090,-1126.34C1090,-1105.2 1090,-1073.72 1090,-1049.88"/>
<polygon fill="black" stroke="black" points="1093.5,-1049.85 1090,-1039.85 1086.5,-1049.85 1093.5,-1049.85"/>
</g>
<!-- layer15_residual -->
<g id="node82" class="node">
<title>layer15_residual</title>
<polygon fill="lightyellow" stroke="black" points="1334.85,-904.5 945.35,-904.5 845.15,-808.5 1234.65,-808.5 1334.85,-904.5"/>
<text text-anchor="middle" x="1090" y="-869.3" font-family="Arial" font-size="9.00">Layer 15 Residual</text>
<text text-anchor="middle" x="1090" y="-859.3" font-family="Arial" font-size="9.00">GPU 60</text>
<text text-anchor="middle" x="1090" y="-849.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-839.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer15_moe&#45;&gt;layer15_residual -->
<g id="edge100" class="edge">
<title>layer15_moe&#45;&gt;layer15_residual</title>
<path fill="none" stroke="black" d="M1090,-991.34C1090,-971.31 1090,-941.5 1090,-915.09"/>
<polygon fill="black" stroke="black" points="1093.5,-914.79 1090,-904.79 1086.5,-914.79 1093.5,-914.79"/>
</g>
<!-- final_norm -->
<g id="node83" class="node">
<title>final_norm</title>
<polygon fill="lightyellow" stroke="black" points="1334.85,-721.5 945.35,-721.5 845.15,-625.5 1234.65,-625.5 1334.85,-721.5"/>
<text text-anchor="middle" x="1090" y="-686.3" font-family="Arial" font-size="9.00">Final RMSNorm</text>
<text text-anchor="middle" x="1090" y="-676.3" font-family="Arial" font-size="9.00">GPU 60</text>
<text text-anchor="middle" x="1090" y="-666.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1090" y="-656.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer15_residual&#45;&gt;final_norm -->
<g id="edge101" class="edge">
<title>layer15_residual&#45;&gt;final_norm</title>
<path fill="none" stroke="black" d="M1090,-808.42C1090,-785.05 1090,-756.62 1090,-731.97"/>
<polygon fill="black" stroke="black" points="1093.5,-731.67 1090,-721.67 1086.5,-731.67 1093.5,-731.67"/>
</g>
<!-- output_proj -->
<g id="node84" class="node">
<title>output_proj</title>
<polygon fill="lightgreen" stroke="black" points="1280.5,-538.5 1021.5,-538.5 1021.5,-490.5 1280.5,-490.5 1280.5,-538.5"/>
<text text-anchor="middle" x="1151" y="-527.3" font-family="Arial" font-size="9.00">Output Projection</text>
<text text-anchor="middle" x="1151" y="-517.3" font-family="Arial" font-size="9.00">GPU 60</text>
<text text-anchor="middle" x="1151" y="-507.3" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1151" y="-497.3" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, vocab_size=50257]</text>
</g>
<!-- final_norm&#45;&gt;output_proj -->
<g id="edge102" class="edge">
<title>final_norm&#45;&gt;output_proj</title>
<path fill="none" stroke="black" d="M1108.3,-625.4C1118.02,-600.38 1129.72,-570.26 1138.42,-547.89"/>
<polygon fill="black" stroke="black" points="1141.7,-549.1 1142.06,-538.51 1135.18,-546.56 1141.7,-549.1"/>
</g>
<!-- final_output -->
<g id="node89" class="node">
<title>final_output</title>
<ellipse fill="lightcoral" stroke="black" cx="1511" cy="-372.63" rx="183.28" ry="26.76"/>
<ellipse fill="none" stroke="black" cx="1511" cy="-372.63" rx="187.28" ry="30.74"/>
<text text-anchor="middle" x="1511" y="-380.43" font-family="Arial" font-size="9.00">Final Output</text>
<text text-anchor="middle" x="1511" y="-370.43" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, vocab_size=50257]</text>
<text text-anchor="middle" x="1511" y="-360.43" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, vocab_size=50257]</text>
</g>
<!-- output_proj&#45;&gt;final_output -->
<g id="edge103" class="edge">
<title>output_proj&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M1210.45,-490.41C1270.5,-467.08 1363.69,-430.87 1430.37,-404.96"/>
<polygon fill="black" stroke="black" points="1431.96,-408.1 1440.01,-401.21 1429.42,-401.57 1431.96,-408.1"/>
</g>
<!-- dp_allreduce_group0 -->
<g id="node85" class="node">
<title>dp_allreduce_group0</title>
<ellipse fill="purple" stroke="black" cx="1919" cy="-205.75" rx="166.76" ry="41.02"/>
<ellipse fill="none" stroke="black" cx="1919" cy="-205.75" rx="170.76" ry="45.02"/>
<ellipse fill="none" stroke="black" cx="1919" cy="-205.75" rx="174.75" ry="49.02"/>
<text text-anchor="middle" x="1919" y="-223.55" font-family="Arial" font-size="9.00">Data Parallel All&#45;Reduce</text>
<text text-anchor="middle" x="1919" y="-213.55" font-family="Arial" font-size="9.00">DP Group 0</text>
<text text-anchor="middle" x="1919" y="-203.55" font-family="Arial" font-size="9.00">GPUs 0,4,8,12</text>
<text text-anchor="middle" x="1919" y="-193.55" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1919" y="-183.55" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- dp_allreduce_group0&#45;&gt;input -->
<g id="edge108" class="edge">
<title>dp_allreduce_group0&#45;&gt;input</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1919,-156.59C1919,-130.02 1919,-97.39 1919,-72.17"/>
<polygon fill="black" stroke="black" points="1922.5,-71.86 1919,-61.86 1915.5,-71.86 1922.5,-71.86"/>
<text text-anchor="middle" x="1943.5" y="-107.34" font-family="Arial" font-size="8.00">Next Iteration</text>
</g>
<!-- dp_allreduce_group1 -->
<g id="node86" class="node">
<title>dp_allreduce_group1</title>
<ellipse fill="purple" stroke="black" cx="2327" cy="-205.75" rx="166.76" ry="41.02"/>
<ellipse fill="none" stroke="black" cx="2327" cy="-205.75" rx="170.76" ry="45.02"/>
<ellipse fill="none" stroke="black" cx="2327" cy="-205.75" rx="174.75" ry="49.02"/>
<text text-anchor="middle" x="2327" y="-223.55" font-family="Arial" font-size="9.00">Data Parallel All&#45;Reduce</text>
<text text-anchor="middle" x="2327" y="-213.55" font-family="Arial" font-size="9.00">DP Group 1</text>
<text text-anchor="middle" x="2327" y="-203.55" font-family="Arial" font-size="9.00">GPUs 16,20,24,28</text>
<text text-anchor="middle" x="2327" y="-193.55" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="2327" y="-183.55" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- dp_allreduce_group1&#45;&gt;input -->
<g id="edge109" class="edge">
<title>dp_allreduce_group1&#45;&gt;input</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2232.11,-164.55C2159.37,-133.72 2060.4,-91.79 1993.35,-63.37"/>
<polygon fill="black" stroke="black" points="1994.67,-60.13 1984.1,-59.46 1991.94,-66.58 1994.67,-60.13"/>
<text text-anchor="middle" x="2134.5" y="-107.34" font-family="Arial" font-size="8.00">Next Iteration</text>
</g>
<!-- dp_allreduce_group2 -->
<g id="node87" class="node">
<title>dp_allreduce_group2</title>
<ellipse fill="purple" stroke="black" cx="1103" cy="-205.75" rx="166.76" ry="41.02"/>
<ellipse fill="none" stroke="black" cx="1103" cy="-205.75" rx="170.76" ry="45.02"/>
<ellipse fill="none" stroke="black" cx="1103" cy="-205.75" rx="174.75" ry="49.02"/>
<text text-anchor="middle" x="1103" y="-223.55" font-family="Arial" font-size="9.00">Data Parallel All&#45;Reduce</text>
<text text-anchor="middle" x="1103" y="-213.55" font-family="Arial" font-size="9.00">DP Group 2</text>
<text text-anchor="middle" x="1103" y="-203.55" font-family="Arial" font-size="9.00">GPUs 32,36,40,44</text>
<text text-anchor="middle" x="1103" y="-193.55" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1103" y="-183.55" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- dp_allreduce_group2&#45;&gt;input -->
<g id="edge110" class="edge">
<title>dp_allreduce_group2&#45;&gt;input</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1234.28,-173.25C1258.44,-167.62 1283.46,-161.91 1307,-156.74 1475.86,-119.65 1671.76,-80.33 1795.53,-55.94"/>
<polygon fill="black" stroke="black" points="1796.29,-59.35 1805.43,-53.99 1794.94,-52.49 1796.29,-59.35"/>
<text text-anchor="middle" x="1566.5" y="-107.34" font-family="Arial" font-size="8.00">Next Iteration</text>
</g>
<!-- dp_allreduce_group3 -->
<g id="node88" class="node">
<title>dp_allreduce_group3</title>
<ellipse fill="purple" stroke="black" cx="1511" cy="-205.75" rx="166.76" ry="41.02"/>
<ellipse fill="none" stroke="black" cx="1511" cy="-205.75" rx="170.76" ry="45.02"/>
<ellipse fill="none" stroke="black" cx="1511" cy="-205.75" rx="174.75" ry="49.02"/>
<text text-anchor="middle" x="1511" y="-223.55" font-family="Arial" font-size="9.00">Data Parallel All&#45;Reduce</text>
<text text-anchor="middle" x="1511" y="-213.55" font-family="Arial" font-size="9.00">DP Group 3</text>
<text text-anchor="middle" x="1511" y="-203.55" font-family="Arial" font-size="9.00">GPUs 48,52,56,60</text>
<text text-anchor="middle" x="1511" y="-193.55" font-family="Arial" font-size="9.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1511" y="-183.55" font-family="Arial" font-size="9.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- dp_allreduce_group3&#45;&gt;input -->
<g id="edge111" class="edge">
<title>dp_allreduce_group3&#45;&gt;input</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1605.89,-164.55C1678.63,-133.72 1777.6,-91.79 1844.65,-63.37"/>
<polygon fill="black" stroke="black" points="1846.06,-66.58 1853.9,-59.46 1843.33,-60.13 1846.06,-66.58"/>
<text text-anchor="middle" x="1763.5" y="-107.34" font-family="Arial" font-size="8.00">Next Iteration</text>
</g>
<!-- final_output&#45;&gt;dp_allreduce_group0 -->
<g id="edge104" class="edge">
<title>final_output&#45;&gt;dp_allreduce_group0</title>
<path fill="none" stroke="black" d="M1579.75,-343.85C1643.13,-318.24 1738.2,-279.82 1811.59,-250.16"/>
<polygon fill="black" stroke="black" points="1812.92,-253.4 1820.88,-246.4 1810.3,-246.91 1812.92,-253.4"/>
</g>
<!-- final_output&#45;&gt;dp_allreduce_group1 -->
<g id="edge105" class="edge">
<title>final_output&#45;&gt;dp_allreduce_group1</title>
<path fill="none" stroke="black" d="M1635.27,-349.5C1759.13,-327.06 1954.65,-290.63 2123,-254.76 2143.51,-250.4 2165.12,-245.56 2186.3,-240.69"/>
<polygon fill="black" stroke="black" points="2187.36,-244.04 2196.32,-238.38 2185.79,-237.22 2187.36,-244.04"/>
</g>
<!-- final_output&#45;&gt;dp_allreduce_group2 -->
<g id="edge106" class="edge">
<title>final_output&#45;&gt;dp_allreduce_group2</title>
<path fill="none" stroke="black" d="M1442.25,-343.85C1378.87,-318.24 1283.8,-279.82 1210.41,-250.16"/>
<polygon fill="black" stroke="black" points="1211.7,-246.91 1201.12,-246.4 1209.08,-253.4 1211.7,-246.91"/>
</g>
<!-- final_output&#45;&gt;dp_allreduce_group3 -->
<g id="edge107" class="edge">
<title>final_output&#45;&gt;dp_allreduce_group3</title>
<path fill="none" stroke="black" d="M1511,-341.39C1511,-320.05 1511,-290.79 1511,-264.99"/>
<polygon fill="black" stroke="black" points="1514.5,-264.93 1511,-254.93 1507.5,-264.93 1514.5,-264.93"/>
</g>
</g>
</svg>
