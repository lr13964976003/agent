<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="2305pt" height="3226pt"
 viewBox="0.00 0.00 2304.78 3226.15" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 3222.15)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-3222.15 2300.78,-3222.15 2300.78,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="lightgray" stroke="black" d="M713,-1714.36C713,-1714.36 2249,-1714.36 2249,-1714.36 2255,-1714.36 2261,-1720.36 2261,-1726.36 2261,-1726.36 2261,-3198.15 2261,-3198.15 2261,-3204.15 2255,-3210.15 2249,-3210.15 2249,-3210.15 713,-3210.15 713,-3210.15 707,-3210.15 701,-3204.15 701,-3198.15 701,-3198.15 701,-1726.36 701,-1726.36 701,-1720.36 707,-1714.36 713,-1714.36"/>
<text text-anchor="middle" x="1481" y="-3194.95" font-family="Times,serif" font-size="14.00">Pipeline Stage 0 (Layers 0&#45;3)</text>
<text text-anchor="middle" x="1481" y="-3179.95" font-family="Times,serif" font-size="14.00">GPUs 0&#45;15</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage1</title>
<path fill="lightgray" stroke="black" d="M20,-1285.27C20,-1285.27 1654,-1285.27 1654,-1285.27 1660,-1285.27 1666,-1291.27 1666,-1297.27 1666,-1297.27 1666,-1612.36 1666,-1612.36 1666,-1618.36 1660,-1624.36 1654,-1624.36 1654,-1624.36 20,-1624.36 20,-1624.36 14,-1624.36 8,-1618.36 8,-1612.36 8,-1612.36 8,-1297.27 8,-1297.27 8,-1291.27 14,-1285.27 20,-1285.27"/>
<text text-anchor="middle" x="837" y="-1609.16" font-family="Times,serif" font-size="14.00">Pipeline Stage 1 (Layers 4&#45;7)</text>
<text text-anchor="middle" x="837" y="-1594.16" font-family="Times,serif" font-size="14.00">GPUs 16&#45;31</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_stage2</title>
<path fill="lightgray" stroke="black" d="M1308,-856.17C1308,-856.17 1654,-856.17 1654,-856.17 1660,-856.17 1666,-862.17 1666,-868.17 1666,-868.17 1666,-1183.27 1666,-1183.27 1666,-1189.27 1660,-1195.27 1654,-1195.27 1654,-1195.27 1308,-1195.27 1308,-1195.27 1302,-1195.27 1296,-1189.27 1296,-1183.27 1296,-1183.27 1296,-868.17 1296,-868.17 1296,-862.17 1302,-856.17 1308,-856.17"/>
<text text-anchor="middle" x="1481" y="-1180.07" font-family="Times,serif" font-size="14.00">Pipeline Stage 2 (Layers 8&#45;11)</text>
<text text-anchor="middle" x="1481" y="-1165.07" font-family="Times,serif" font-size="14.00">GPUs 32&#45;47</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage3</title>
<path fill="lightgray" stroke="black" d="M1291,-225.1C1291,-225.1 1671,-225.1 1671,-225.1 1677,-225.1 1683,-231.1 1683,-237.1 1683,-237.1 1683,-754.17 1683,-754.17 1683,-760.17 1677,-766.17 1671,-766.17 1671,-766.17 1291,-766.17 1291,-766.17 1285,-766.17 1279,-760.17 1279,-754.17 1279,-754.17 1279,-237.1 1279,-237.1 1279,-231.1 1285,-225.1 1291,-225.1"/>
<text text-anchor="middle" x="1481" y="-750.97" font-family="Times,serif" font-size="14.00">Pipeline Stage 3 (Layers 12&#45;15)</text>
<text text-anchor="middle" x="1481" y="-735.97" font-family="Times,serif" font-size="14.00">GPUs 48&#45;63</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightcoral" stroke="black" cx="1480" cy="-3135.16" rx="194.41" ry="28.98"/>
<text text-anchor="middle" x="1480" y="-3143.66" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="1480" y="-3132.66" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1480" y="-3121.66" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
</g>
<!-- layer0_attn_gpu0 -->
<g id="node2" class="node">
<title>layer0_attn_gpu0</title>
<polygon fill="lightblue" stroke="black" points="1617.5,-2962.17 1342.5,-2962.17 1342.5,-2910.17 1617.5,-2910.17 1617.5,-2962.17"/>
<text text-anchor="middle" x="1480" y="-2950.17" font-family="Arial" font-size="10.00">Layer 0 Attention</text>
<text text-anchor="middle" x="1480" y="-2939.17" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1480" y="-2928.17" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1480" y="-2917.17" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
</g>
<!-- input&#45;&gt;layer0_attn_gpu0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layer0_attn_gpu0</title>
<path fill="none" stroke="black" d="M1480,-3105.94C1480,-3070.74 1480,-3010.55 1480,-2972.37"/>
<polygon fill="black" stroke="black" points="1483.5,-2972.22 1480,-2962.22 1476.5,-2972.22 1483.5,-2972.22"/>
</g>
<!-- layer0_moe_route_gpu0 -->
<g id="node3" class="node">
<title>layer0_moe_route_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="1730.79,-2766.17 1331.84,-2766.17 1229.21,-2662.17 1628.16,-2662.17 1730.79,-2766.17"/>
<text text-anchor="middle" x="1480" y="-2728.17" font-family="Arial" font-size="10.00">Layer 0 MoE Router</text>
<text text-anchor="middle" x="1480" y="-2717.17" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1480" y="-2706.17" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1480" y="-2695.17" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, experts=2]</text>
</g>
<!-- layer0_attn_gpu0&#45;&gt;layer0_moe_route_gpu0 -->
<g id="edge2" class="edge">
<title>layer0_attn_gpu0&#45;&gt;layer0_moe_route_gpu0</title>
<path fill="none" stroke="black" d="M1480,-2909.93C1480,-2877.58 1480,-2820.4 1480,-2776.34"/>
<polygon fill="black" stroke="black" points="1483.5,-2776.3 1480,-2766.3 1476.5,-2776.3 1483.5,-2776.3"/>
</g>
<!-- gate_layer0 -->
<g id="node4" class="node">
<title>gate_layer0</title>
<polygon fill="pink" stroke="black" points="1480,-2514.16 1238.12,-2451.04 1480,-2387.91 1721.88,-2451.04 1480,-2514.16"/>
<polygon fill="none" stroke="black" points="1480,-2518.3 1222.25,-2451.04 1480,-2383.77 1737.75,-2451.04 1480,-2518.3"/>
<text text-anchor="middle" x="1480" y="-2470.54" font-family="Arial" font-size="10.00">Gate Selection</text>
<text text-anchor="middle" x="1480" y="-2459.54" font-family="Arial" font-size="10.00">Layer 0</text>
<text text-anchor="middle" x="1480" y="-2448.54" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1480" y="-2437.54" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1480" y="-2426.54" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, experts=2]</text>
</g>
<!-- layer0_moe_route_gpu0&#45;&gt;gate_layer0 -->
<g id="edge3" class="edge">
<title>layer0_moe_route_gpu0&#45;&gt;gate_layer0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1480,-2661.89C1480,-2623.94 1480,-2571.6 1480,-2528.69"/>
<polygon fill="black" stroke="black" points="1483.5,-2528.56 1480,-2518.56 1476.5,-2528.56 1483.5,-2528.56"/>
</g>
<!-- layer0_experts_gpu0 -->
<g id="node5" class="node">
<title>layer0_experts_gpu0</title>
<polygon fill="lightblue" stroke="black" points="1041,-2239.9 791,-2239.9 791,-2187.9 1041,-2187.9 1041,-2239.9"/>
<text text-anchor="middle" x="916" y="-2227.9" font-family="Arial" font-size="10.00">Layer 0 Experts (4/16)</text>
<text text-anchor="middle" x="916" y="-2216.9" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="916" y="-2205.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="916" y="-2194.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- gate_layer0&#45;&gt;layer0_experts_gpu0 -->
<g id="edge4" class="edge">
<title>gate_layer0&#45;&gt;layer0_experts_gpu0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1382.08,-2409.21C1268.86,-2362.01 1085.33,-2285.5 985.71,-2243.97"/>
<polygon fill="black" stroke="black" points="986.92,-2240.68 976.34,-2240.06 984.22,-2247.14 986.92,-2240.68"/>
</g>
<!-- layer0_experts_gpu1 -->
<g id="node6" class="node">
<title>layer0_experts_gpu1</title>
<polygon fill="lightblue" stroke="black" points="1424,-2239.9 1174,-2239.9 1174,-2187.9 1424,-2187.9 1424,-2239.9"/>
<text text-anchor="middle" x="1299" y="-2227.9" font-family="Arial" font-size="10.00">Layer 0 Experts (4/16)</text>
<text text-anchor="middle" x="1299" y="-2216.9" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1299" y="-2205.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="1299" y="-2194.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- gate_layer0&#45;&gt;layer0_experts_gpu1 -->
<g id="edge5" class="edge">
<title>gate_layer0&#45;&gt;layer0_experts_gpu1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1437.33,-2394.61C1402.35,-2349.17 1354,-2286.35 1324.7,-2248.28"/>
<polygon fill="black" stroke="black" points="1327.26,-2245.88 1318.39,-2240.09 1321.72,-2250.15 1327.26,-2245.88"/>
</g>
<!-- layer0_experts_gpu2 -->
<g id="node7" class="node">
<title>layer0_experts_gpu2</title>
<polygon fill="lightblue" stroke="black" points="1787,-2239.9 1537,-2239.9 1537,-2187.9 1787,-2187.9 1787,-2239.9"/>
<text text-anchor="middle" x="1662" y="-2227.9" font-family="Arial" font-size="10.00">Layer 0 Experts (4/16)</text>
<text text-anchor="middle" x="1662" y="-2216.9" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="1662" y="-2205.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="1662" y="-2194.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- gate_layer0&#45;&gt;layer0_experts_gpu2 -->
<g id="edge6" class="edge">
<title>gate_layer0&#45;&gt;layer0_experts_gpu2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1522.9,-2394.61C1558.07,-2349.17 1606.7,-2286.35 1636.16,-2248.28"/>
<polygon fill="black" stroke="black" points="1639.15,-2250.14 1642.5,-2240.09 1633.62,-2245.86 1639.15,-2250.14"/>
</g>
<!-- layer0_experts_gpu3 -->
<g id="node8" class="node">
<title>layer0_experts_gpu3</title>
<polygon fill="lightblue" stroke="black" points="2170,-2239.9 1920,-2239.9 1920,-2187.9 2170,-2187.9 2170,-2239.9"/>
<text text-anchor="middle" x="2045" y="-2227.9" font-family="Arial" font-size="10.00">Layer 0 Experts (4/16)</text>
<text text-anchor="middle" x="2045" y="-2216.9" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="2045" y="-2205.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="2045" y="-2194.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- gate_layer0&#45;&gt;layer0_experts_gpu3 -->
<g id="edge7" class="edge">
<title>gate_layer0&#45;&gt;layer0_experts_gpu3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1578.09,-2409.21C1691.51,-2362.01 1875.37,-2285.5 1975.16,-2243.97"/>
<polygon fill="black" stroke="black" points="1976.67,-2247.13 1984.55,-2240.06 1973.98,-2240.67 1976.67,-2247.13"/>
</g>
<!-- layer0_expert_comm_gpu0 -->
<g id="node9" class="node">
<title>layer0_expert_comm_gpu0</title>
<ellipse fill="lightgreen" stroke="black" cx="875" cy="-2007.13" rx="166.34" ry="36.54"/>
<text text-anchor="middle" x="875" y="-2021.13" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;all</text>
<text text-anchor="middle" x="875" y="-2010.13" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="875" y="-1999.13" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="875" y="-1988.13" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_experts_gpu0&#45;&gt;layer0_expert_comm_gpu0 -->
<g id="edge8" class="edge">
<title>layer0_experts_gpu0&#45;&gt;layer0_expert_comm_gpu0</title>
<path fill="none" stroke="black" d="M910.97,-2187.79C904.32,-2154.55 892.45,-2095.3 884.18,-2053.97"/>
<polygon fill="black" stroke="black" points="887.6,-2053.26 882.21,-2044.14 880.74,-2054.63 887.6,-2053.26"/>
</g>
<!-- layer0_expert_comm_gpu1 -->
<g id="node10" class="node">
<title>layer0_expert_comm_gpu1</title>
<ellipse fill="lightgreen" stroke="black" cx="1279" cy="-2007.13" rx="166.34" ry="36.54"/>
<text text-anchor="middle" x="1279" y="-2021.13" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;all</text>
<text text-anchor="middle" x="1279" y="-2010.13" font-family="Arial" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1279" y="-1999.13" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="1279" y="-1988.13" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_experts_gpu1&#45;&gt;layer0_expert_comm_gpu1 -->
<g id="edge10" class="edge">
<title>layer0_experts_gpu1&#45;&gt;layer0_expert_comm_gpu1</title>
<path fill="none" stroke="black" d="M1296.55,-2187.79C1293.31,-2154.62 1287.54,-2095.55 1283.5,-2054.24"/>
<polygon fill="black" stroke="black" points="1286.97,-2053.75 1282.52,-2044.14 1280.01,-2054.43 1286.97,-2053.75"/>
</g>
<!-- layer0_expert_comm_gpu2 -->
<g id="node11" class="node">
<title>layer0_expert_comm_gpu2</title>
<ellipse fill="lightgreen" stroke="black" cx="1683" cy="-2007.13" rx="166.34" ry="36.54"/>
<text text-anchor="middle" x="1683" y="-2021.13" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;all</text>
<text text-anchor="middle" x="1683" y="-2010.13" font-family="Arial" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="1683" y="-1999.13" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="1683" y="-1988.13" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_experts_gpu2&#45;&gt;layer0_expert_comm_gpu2 -->
<g id="edge12" class="edge">
<title>layer0_experts_gpu2&#45;&gt;layer0_expert_comm_gpu2</title>
<path fill="none" stroke="black" d="M1664.58,-2187.79C1667.98,-2154.62 1674.03,-2095.55 1678.27,-2054.24"/>
<polygon fill="black" stroke="black" points="1681.77,-2054.44 1679.31,-2044.14 1674.81,-2053.73 1681.77,-2054.44"/>
</g>
<!-- layer0_expert_comm_gpu3 -->
<g id="node12" class="node">
<title>layer0_expert_comm_gpu3</title>
<ellipse fill="lightgreen" stroke="black" cx="2087" cy="-2007.13" rx="166.34" ry="36.54"/>
<text text-anchor="middle" x="2087" y="-2021.13" font-family="Arial" font-size="10.00">Expert All&#45;to&#45;all</text>
<text text-anchor="middle" x="2087" y="-2010.13" font-family="Arial" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="2087" y="-1999.13" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, tokens=?]</text>
<text text-anchor="middle" x="2087" y="-1988.13" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, tokens=?]</text>
</g>
<!-- layer0_experts_gpu3&#45;&gt;layer0_expert_comm_gpu3 -->
<g id="edge14" class="edge">
<title>layer0_experts_gpu3&#45;&gt;layer0_expert_comm_gpu3</title>
<path fill="none" stroke="black" d="M2050.15,-2187.79C2056.97,-2154.55 2069.12,-2095.3 2077.6,-2053.97"/>
<polygon fill="black" stroke="black" points="2081.03,-2054.64 2079.62,-2044.14 2074.18,-2053.23 2081.03,-2054.64"/>
</g>
<!-- layer0_moe_agg_gpu0 -->
<g id="node13" class="node">
<title>layer0_moe_agg_gpu0</title>
<polygon fill="lightyellow" stroke="black" points="1740.38,-1826.36 1327.77,-1826.36 1221.62,-1722.36 1634.23,-1722.36 1740.38,-1826.36"/>
<text text-anchor="middle" x="1481" y="-1788.36" font-family="Arial" font-size="10.00">Layer 0 MoE Aggregate</text>
<text text-anchor="middle" x="1481" y="-1777.36" font-family="Arial" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1481" y="-1766.36" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1481" y="-1755.36" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_expert_comm_gpu0&#45;&gt;layer0_moe_agg_gpu0 -->
<g id="edge9" class="edge">
<title>layer0_expert_comm_gpu0&#45;&gt;layer0_moe_agg_gpu0</title>
<path fill="none" stroke="black" d="M956.73,-1975.01C1054.16,-1937.91 1218.71,-1875.25 1337.51,-1830.01"/>
<polygon fill="black" stroke="black" points="1338.95,-1833.2 1347.05,-1826.37 1336.46,-1826.66 1338.95,-1833.2"/>
</g>
<!-- layer0_expert_comm_gpu1&#45;&gt;layer0_moe_agg_gpu0 -->
<g id="edge11" class="edge">
<title>layer0_expert_comm_gpu1&#45;&gt;layer0_moe_agg_gpu0</title>
<path fill="none" stroke="black" d="M1309.9,-1970.83C1341.7,-1934.51 1391.79,-1877.28 1429.58,-1834.11"/>
<polygon fill="black" stroke="black" points="1432.29,-1836.33 1436.24,-1826.5 1427.02,-1831.72 1432.29,-1836.33"/>
</g>
<!-- layer0_expert_comm_gpu2&#45;&gt;layer0_moe_agg_gpu0 -->
<g id="edge13" class="edge">
<title>layer0_expert_comm_gpu2&#45;&gt;layer0_moe_agg_gpu0</title>
<path fill="none" stroke="black" d="M1652.1,-1970.83C1620.3,-1934.51 1570.21,-1877.28 1532.42,-1834.11"/>
<polygon fill="black" stroke="black" points="1534.98,-1831.72 1525.76,-1826.5 1529.71,-1836.33 1534.98,-1831.72"/>
</g>
<!-- layer0_expert_comm_gpu3&#45;&gt;layer0_moe_agg_gpu0 -->
<g id="edge15" class="edge">
<title>layer0_expert_comm_gpu3&#45;&gt;layer0_moe_agg_gpu0</title>
<path fill="none" stroke="black" d="M2005.27,-1975.01C1907.84,-1937.91 1743.29,-1875.25 1624.49,-1830.01"/>
<polygon fill="black" stroke="black" points="1625.54,-1826.66 1614.95,-1826.37 1623.05,-1833.2 1625.54,-1826.66"/>
</g>
<!-- pipe_comm_0_1 -->
<g id="node14" class="node">
<title>pipe_comm_0_1</title>
<ellipse fill="lightgreen" stroke="black" cx="1481" cy="-1533.82" rx="176.55" ry="44.6"/>
<text text-anchor="middle" x="1481" y="-1553.32" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="1481" y="-1542.32" font-family="Arial" font-size="10.00">Stage 0 to 1</text>
<text text-anchor="middle" x="1481" y="-1531.32" font-family="Arial" font-size="10.00">GPUs 0&#45;15 to GPUs 16&#45;31</text>
<text text-anchor="middle" x="1481" y="-1520.32" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1481" y="-1509.32" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer0_moe_agg_gpu0&#45;&gt;pipe_comm_0_1 -->
<g id="edge16" class="edge">
<title>layer0_moe_agg_gpu0&#45;&gt;pipe_comm_0_1</title>
<path fill="none" stroke="black" d="M1481,-1722.19C1481,-1682.9 1481,-1628.78 1481,-1588.8"/>
<polygon fill="black" stroke="black" points="1484.5,-1588.7 1481,-1578.7 1477.5,-1588.7 1484.5,-1588.7"/>
</g>
<!-- layer4_attn_gpu16 -->
<g id="node15" class="node">
<title>layer4_attn_gpu16</title>
<polygon fill="lightblue" stroke="black" points="1618.5,-1345.27 1343.5,-1345.27 1343.5,-1293.27 1618.5,-1293.27 1618.5,-1345.27"/>
<text text-anchor="middle" x="1481" y="-1333.27" font-family="Arial" font-size="10.00">Layer 4 Attention</text>
<text text-anchor="middle" x="1481" y="-1322.27" font-family="Arial" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1481" y="-1311.27" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1481" y="-1300.27" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
</g>
<!-- pipe_comm_0_1&#45;&gt;layer4_attn_gpu16 -->
<g id="edge17" class="edge">
<title>pipe_comm_0_1&#45;&gt;layer4_attn_gpu16</title>
<path fill="none" stroke="black" d="M1481,-1489.03C1481,-1449.55 1481,-1392.21 1481,-1355.58"/>
<polygon fill="black" stroke="black" points="1484.5,-1355.38 1481,-1345.38 1477.5,-1355.38 1484.5,-1355.38"/>
</g>
<!-- pipe_comm_1_2 -->
<g id="node20" class="node">
<title>pipe_comm_1_2</title>
<ellipse fill="lightgreen" stroke="black" cx="1481" cy="-1104.72" rx="176.55" ry="44.6"/>
<text text-anchor="middle" x="1481" y="-1124.22" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="1481" y="-1113.22" font-family="Arial" font-size="10.00">Stage 1 to 2</text>
<text text-anchor="middle" x="1481" y="-1102.22" font-family="Arial" font-size="10.00">GPUs 16&#45;31 to GPUs 32&#45;47</text>
<text text-anchor="middle" x="1481" y="-1091.22" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1481" y="-1080.22" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer4_attn_gpu16&#45;&gt;pipe_comm_1_2 -->
<g id="edge18" class="edge">
<title>layer4_attn_gpu16&#45;&gt;pipe_comm_1_2</title>
<path fill="none" stroke="black" d="M1481,-1293.05C1481,-1260.34 1481,-1202.4 1481,-1159.6"/>
<polygon fill="black" stroke="black" points="1484.5,-1159.34 1481,-1149.34 1477.5,-1159.34 1484.5,-1159.34"/>
</g>
<!-- layer4_experts_gpu16 -->
<g id="node16" class="node">
<title>layer4_experts_gpu16</title>
<polygon fill="lightblue" stroke="black" points="1232,-1559.82 982,-1559.82 982,-1507.82 1232,-1507.82 1232,-1559.82"/>
<text text-anchor="middle" x="1107" y="-1547.82" font-family="Arial" font-size="10.00">Layer 4 Experts (4/16)</text>
<text text-anchor="middle" x="1107" y="-1536.82" font-family="Arial" font-size="10.00">GPU 16</text>
<text text-anchor="middle" x="1107" y="-1525.82" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="1107" y="-1514.82" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer4_experts_gpu17 -->
<g id="node17" class="node">
<title>layer4_experts_gpu17</title>
<polygon fill="lightblue" stroke="black" points="910,-1559.82 660,-1559.82 660,-1507.82 910,-1507.82 910,-1559.82"/>
<text text-anchor="middle" x="785" y="-1547.82" font-family="Arial" font-size="10.00">Layer 4 Experts (4/16)</text>
<text text-anchor="middle" x="785" y="-1536.82" font-family="Arial" font-size="10.00">GPU 17</text>
<text text-anchor="middle" x="785" y="-1525.82" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="785" y="-1514.82" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer4_experts_gpu18 -->
<g id="node18" class="node">
<title>layer4_experts_gpu18</title>
<polygon fill="lightblue" stroke="black" points="588,-1559.82 338,-1559.82 338,-1507.82 588,-1507.82 588,-1559.82"/>
<text text-anchor="middle" x="463" y="-1547.82" font-family="Arial" font-size="10.00">Layer 4 Experts (4/16)</text>
<text text-anchor="middle" x="463" y="-1536.82" font-family="Arial" font-size="10.00">GPU 18</text>
<text text-anchor="middle" x="463" y="-1525.82" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="463" y="-1514.82" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer4_experts_gpu19 -->
<g id="node19" class="node">
<title>layer4_experts_gpu19</title>
<polygon fill="lightblue" stroke="black" points="266,-1559.82 16,-1559.82 16,-1507.82 266,-1507.82 266,-1559.82"/>
<text text-anchor="middle" x="141" y="-1547.82" font-family="Arial" font-size="10.00">Layer 4 Experts (4/16)</text>
<text text-anchor="middle" x="141" y="-1536.82" font-family="Arial" font-size="10.00">GPU 19</text>
<text text-anchor="middle" x="141" y="-1525.82" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, experts=2]</text>
<text text-anchor="middle" x="141" y="-1514.82" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer8_attn_gpu32 -->
<g id="node21" class="node">
<title>layer8_attn_gpu32</title>
<polygon fill="lightblue" stroke="black" points="1618.5,-916.17 1343.5,-916.17 1343.5,-864.17 1618.5,-864.17 1618.5,-916.17"/>
<text text-anchor="middle" x="1481" y="-904.17" font-family="Arial" font-size="10.00">Layer 8 Attention</text>
<text text-anchor="middle" x="1481" y="-893.17" font-family="Arial" font-size="10.00">GPU 32</text>
<text text-anchor="middle" x="1481" y="-882.17" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1481" y="-871.17" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
</g>
<!-- pipe_comm_1_2&#45;&gt;layer8_attn_gpu32 -->
<g id="edge19" class="edge">
<title>pipe_comm_1_2&#45;&gt;layer8_attn_gpu32</title>
<path fill="none" stroke="black" d="M1481,-1059.94C1481,-1020.45 1481,-963.11 1481,-926.49"/>
<polygon fill="black" stroke="black" points="1484.5,-926.28 1481,-916.28 1477.5,-926.28 1484.5,-926.28"/>
</g>
<!-- pipe_comm_2_3 -->
<g id="node22" class="node">
<title>pipe_comm_2_3</title>
<ellipse fill="lightgreen" stroke="black" cx="1481" cy="-675.63" rx="176.55" ry="44.6"/>
<text text-anchor="middle" x="1481" y="-695.13" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="1481" y="-684.13" font-family="Arial" font-size="10.00">Stage 2 to 3</text>
<text text-anchor="middle" x="1481" y="-673.13" font-family="Arial" font-size="10.00">GPUs 32&#45;47 to GPUs 48&#45;63</text>
<text text-anchor="middle" x="1481" y="-662.13" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1481" y="-651.13" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- layer8_attn_gpu32&#45;&gt;pipe_comm_2_3 -->
<g id="edge20" class="edge">
<title>layer8_attn_gpu32&#45;&gt;pipe_comm_2_3</title>
<path fill="none" stroke="black" d="M1481,-863.96C1481,-831.25 1481,-773.31 1481,-730.5"/>
<polygon fill="black" stroke="black" points="1484.5,-730.24 1481,-720.24 1477.5,-730.24 1484.5,-730.24"/>
</g>
<!-- layer12_attn_gpu48 -->
<g id="node23" class="node">
<title>layer12_attn_gpu48</title>
<polygon fill="lightblue" stroke="black" points="1618.5,-487.08 1343.5,-487.08 1343.5,-435.08 1618.5,-435.08 1618.5,-487.08"/>
<text text-anchor="middle" x="1481" y="-475.08" font-family="Arial" font-size="10.00">Layer 12 Attention</text>
<text text-anchor="middle" x="1481" y="-464.08" font-family="Arial" font-size="10.00">GPU 48</text>
<text text-anchor="middle" x="1481" y="-453.08" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1481" y="-442.08" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
</g>
<!-- pipe_comm_2_3&#45;&gt;layer12_attn_gpu48 -->
<g id="edge21" class="edge">
<title>pipe_comm_2_3&#45;&gt;layer12_attn_gpu48</title>
<path fill="none" stroke="black" d="M1481,-630.84C1481,-591.36 1481,-534.02 1481,-497.39"/>
<polygon fill="black" stroke="black" points="1484.5,-497.19 1481,-487.19 1477.5,-497.19 1484.5,-497.19"/>
</g>
<!-- output -->
<g id="node24" class="node">
<title>output</title>
<ellipse fill="lightcoral" stroke="black" cx="1481" cy="-262.09" rx="194.41" ry="28.98"/>
<text text-anchor="middle" x="1481" y="-270.59" font-family="Arial" font-size="10.00">Output</text>
<text text-anchor="middle" x="1481" y="-259.59" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1481" y="-248.59" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, heads=16, d_k=32]</text>
</g>
<!-- layer12_attn_gpu48&#45;&gt;output -->
<g id="edge22" class="edge">
<title>layer12_attn_gpu48&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1481,-434.73C1481,-400.86 1481,-340.57 1481,-301.22"/>
<polygon fill="black" stroke="black" points="1484.5,-301.2 1481,-291.2 1477.5,-301.2 1484.5,-301.2"/>
</g>
<!-- dp_comm_group0 -->
<g id="node25" class="node">
<title>dp_comm_group0</title>
<ellipse fill="lightgreen" stroke="black" cx="842" cy="-44.55" rx="176.55" ry="44.6"/>
<text text-anchor="middle" x="842" y="-64.05" font-family="Arial" font-size="10.00">Data Parallel All&#45;Reduce</text>
<text text-anchor="middle" x="842" y="-53.05" font-family="Arial" font-size="10.00">DP Group 0</text>
<text text-anchor="middle" x="842" y="-42.05" font-family="Arial" font-size="10.00">GPUs 0&#45;15</text>
<text text-anchor="middle" x="842" y="-31.05" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="842" y="-20.05" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- output&#45;&gt;dp_comm_group0 -->
<g id="edge23" class="edge">
<title>output&#45;&gt;dp_comm_group0</title>
<path fill="none" stroke="black" d="M1404.87,-235.41C1293.49,-197.84 1085.3,-127.62 955.72,-83.91"/>
<polygon fill="black" stroke="black" points="956.74,-80.56 946.14,-80.68 954.5,-87.19 956.74,-80.56"/>
</g>
<!-- dp_comm_group1 -->
<g id="node26" class="node">
<title>dp_comm_group1</title>
<ellipse fill="lightgreen" stroke="black" cx="1268" cy="-44.55" rx="176.55" ry="44.6"/>
<text text-anchor="middle" x="1268" y="-64.05" font-family="Arial" font-size="10.00">Data Parallel All&#45;Reduce</text>
<text text-anchor="middle" x="1268" y="-53.05" font-family="Arial" font-size="10.00">DP Group 1</text>
<text text-anchor="middle" x="1268" y="-42.05" font-family="Arial" font-size="10.00">GPUs 16&#45;31</text>
<text text-anchor="middle" x="1268" y="-31.05" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1268" y="-20.05" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- output&#45;&gt;dp_comm_group1 -->
<g id="edge24" class="edge">
<title>output&#45;&gt;dp_comm_group1</title>
<path fill="none" stroke="black" d="M1453.59,-233.35C1419.18,-198.53 1359.52,-138.16 1317.14,-95.27"/>
<polygon fill="black" stroke="black" points="1319.49,-92.67 1309.97,-88.01 1314.51,-97.59 1319.49,-92.67"/>
</g>
<!-- dp_comm_group2 -->
<g id="node27" class="node">
<title>dp_comm_group2</title>
<ellipse fill="lightgreen" stroke="black" cx="1694" cy="-44.55" rx="176.55" ry="44.6"/>
<text text-anchor="middle" x="1694" y="-64.05" font-family="Arial" font-size="10.00">Data Parallel All&#45;Reduce</text>
<text text-anchor="middle" x="1694" y="-53.05" font-family="Arial" font-size="10.00">DP Group 2</text>
<text text-anchor="middle" x="1694" y="-42.05" font-family="Arial" font-size="10.00">GPUs 32&#45;47</text>
<text text-anchor="middle" x="1694" y="-31.05" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="1694" y="-20.05" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- output&#45;&gt;dp_comm_group2 -->
<g id="edge25" class="edge">
<title>output&#45;&gt;dp_comm_group2</title>
<path fill="none" stroke="black" d="M1508.41,-233.35C1542.82,-198.53 1602.48,-138.16 1644.86,-95.27"/>
<polygon fill="black" stroke="black" points="1647.49,-97.59 1652.03,-88.01 1642.51,-92.67 1647.49,-97.59"/>
</g>
<!-- dp_comm_group3 -->
<g id="node28" class="node">
<title>dp_comm_group3</title>
<ellipse fill="lightgreen" stroke="black" cx="2120" cy="-44.55" rx="176.55" ry="44.6"/>
<text text-anchor="middle" x="2120" y="-64.05" font-family="Arial" font-size="10.00">Data Parallel All&#45;Reduce</text>
<text text-anchor="middle" x="2120" y="-53.05" font-family="Arial" font-size="10.00">DP Group 3</text>
<text text-anchor="middle" x="2120" y="-42.05" font-family="Arial" font-size="10.00">GPUs 48&#45;63</text>
<text text-anchor="middle" x="2120" y="-31.05" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=512, hidden=1024]</text>
<text text-anchor="middle" x="2120" y="-20.05" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=512, hidden=1024]</text>
</g>
<!-- output&#45;&gt;dp_comm_group3 -->
<g id="edge26" class="edge">
<title>output&#45;&gt;dp_comm_group3</title>
<path fill="none" stroke="black" d="M1557.13,-235.41C1668.51,-197.84 1876.7,-127.62 2006.28,-83.91"/>
<polygon fill="black" stroke="black" points="2007.5,-87.19 2015.86,-80.68 2005.26,-80.56 2007.5,-87.19"/>
</g>
</g>
</svg>
