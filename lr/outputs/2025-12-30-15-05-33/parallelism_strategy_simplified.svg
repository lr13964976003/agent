<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="9000pt" height="1804pt"
 viewBox="0.00 0.00 2160.00 432.95" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(2.56 2.56) rotate(0) translate(4 699.62)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-699.62 3506.44,-699.62 3506.44,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_dp_0</title>
<polygon fill="none" stroke="black" points="174.44,-77.08 174.44,-687.62 582.44,-687.62 582.44,-77.08 174.44,-77.08"/>
<text text-anchor="middle" x="378.44" y="-672.42" font-family="Times,serif" font-size="14.00">DP Group 0</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_dp_1</title>
<polygon fill="none" stroke="black" points="590.44,-77.08 590.44,-687.62 998.44,-687.62 998.44,-77.08 590.44,-77.08"/>
<text text-anchor="middle" x="794.44" y="-672.42" font-family="Times,serif" font-size="14.00">DP Group 1</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_dp_2</title>
<polygon fill="none" stroke="black" points="1006.44,-77.08 1006.44,-687.62 1414.44,-687.62 1414.44,-77.08 1006.44,-77.08"/>
<text text-anchor="middle" x="1210.44" y="-672.42" font-family="Times,serif" font-size="14.00">DP Group 2</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_dp_3</title>
<polygon fill="none" stroke="black" points="1422.44,-77.08 1422.44,-687.62 1830.44,-687.62 1830.44,-77.08 1422.44,-77.08"/>
<text text-anchor="middle" x="1626.44" y="-672.42" font-family="Times,serif" font-size="14.00">DP Group 3</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_dp_4</title>
<polygon fill="none" stroke="black" points="1838.44,-77.08 1838.44,-687.62 2246.44,-687.62 2246.44,-77.08 1838.44,-77.08"/>
<text text-anchor="middle" x="2042.44" y="-672.42" font-family="Times,serif" font-size="14.00">DP Group 4</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_dp_5</title>
<polygon fill="none" stroke="black" points="2254.44,-77.08 2254.44,-687.62 2662.44,-687.62 2662.44,-77.08 2254.44,-77.08"/>
<text text-anchor="middle" x="2458.44" y="-672.42" font-family="Times,serif" font-size="14.00">DP Group 5</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_dp_6</title>
<polygon fill="none" stroke="black" points="2670.44,-77.08 2670.44,-687.62 3078.44,-687.62 3078.44,-77.08 2670.44,-77.08"/>
<text text-anchor="middle" x="2874.44" y="-672.42" font-family="Times,serif" font-size="14.00">DP Group 6</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_dp_7</title>
<polygon fill="none" stroke="black" points="3086.44,-77.08 3086.44,-687.62 3494.44,-687.62 3494.44,-77.08 3086.44,-77.08"/>
<text text-anchor="middle" x="3290.44" y="-672.42" font-family="Times,serif" font-size="14.00">DP Group 7</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="83.44" cy="-633.12" rx="83.38" ry="24.08"/>
<text text-anchor="middle" x="83.44" y="-636.52" font-family="Arial" font-size="12.00">Input Batch</text>
<text text-anchor="middle" x="83.44" y="-623.52" font-family="Arial" font-size="12.00">[128, seq_len, 512]</text>
</g>
<!-- GPU_Cluster_PP1_DP0 -->
<g id="node2" class="node">
<title>GPU_Cluster_PP1_DP0</title>
<polygon fill="lightgreen" stroke="black" points="569.44,-656.62 421.44,-656.62 421.44,-609.62 569.44,-609.62 569.44,-656.62"/>
<text text-anchor="middle" x="495.44" y="-643.02" font-family="Arial" font-size="12.00">PP Stage 1</text>
<text text-anchor="middle" x="495.44" y="-630.02" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="495.44" y="-617.02" font-family="Arial" font-size="12.00">Layers 1&#45;8</text>
</g>
<!-- TP_Comm_PP1_DP0 -->
<g id="node4" class="node">
<title>TP_Comm_PP1_DP0</title>
<ellipse fill="lightyellow" stroke="black" cx="495.44" cy="-525.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="495.44" y="-534.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="495.44" y="-521.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="495.44" y="-508.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP1_DP0&#45;&gt;TP_Comm_PP1_DP0 -->
<g id="edge1" class="edge">
<title>GPU_Cluster_PP1_DP0&#45;&gt;TP_Comm_PP1_DP0</title>
<path fill="none" stroke="black" d="M495.44,-609.38C495.44,-597.54 495.44,-582.69 495.44,-568.81"/>
<polygon fill="black" stroke="black" points="498.94,-568.45 495.44,-558.45 491.94,-568.45 498.94,-568.45"/>
</g>
<!-- EP_Cluster_PP1_DP0 -->
<g id="node3" class="node">
<title>EP_Cluster_PP1_DP0</title>
<polygon fill="lightgreen" stroke="black" points="565.44,-441.08 413.44,-441.08 413.44,-394.08 565.44,-394.08 565.44,-441.08"/>
<text text-anchor="middle" x="489.44" y="-427.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="489.44" y="-414.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="489.44" y="-401.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- GPU_Cluster_PP2_DP0 -->
<g id="node6" class="node">
<title>GPU_Cluster_PP2_DP0</title>
<polygon fill="lightgreen" stroke="black" points="566.44,-347.08 418.44,-347.08 418.44,-300.08 566.44,-300.08 566.44,-347.08"/>
<text text-anchor="middle" x="492.44" y="-333.48" font-family="Arial" font-size="12.00">PP Stage 2</text>
<text text-anchor="middle" x="492.44" y="-320.48" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="492.44" y="-307.48" font-family="Arial" font-size="12.00">Layers 9&#45;16</text>
</g>
<!-- EP_Cluster_PP1_DP0&#45;&gt;GPU_Cluster_PP2_DP0 -->
<g id="edge7" class="edge">
<title>EP_Cluster_PP1_DP0&#45;&gt;GPU_Cluster_PP2_DP0</title>
<path fill="none" stroke="black" stroke-width="2" d="M490.18,-393.84C490.54,-382.89 490.97,-369.56 491.36,-357.53"/>
<polygon fill="black" stroke="black" stroke-width="2" points="494.87,-357.49 491.7,-347.38 487.87,-357.26 494.87,-357.49"/>
<text text-anchor="middle" x="532.94" y="-368.08" font-family="Arial" font-size="10.00">PP Communication</text>
</g>
<!-- TP_Comm_PP1_DP0&#45;&gt;EP_Cluster_PP1_DP0 -->
<g id="edge2" class="edge">
<title>TP_Comm_PP1_DP0&#45;&gt;EP_Cluster_PP1_DP0</title>
<path fill="none" stroke="black" d="M493.61,-491.86C492.88,-479.07 492.04,-464.39 491.31,-451.53"/>
<polygon fill="black" stroke="black" points="494.79,-451.04 490.73,-441.25 487.8,-451.43 494.79,-451.04"/>
</g>
<!-- Gate_PP1_DP0 -->
<g id="node5" class="node">
<title>Gate_PP1_DP0</title>
<polygon fill="lightcoral" stroke="black" points="398.08,-572.08 226.84,-572.08 182.79,-478.08 354.03,-478.08 398.08,-572.08"/>
<text text-anchor="middle" x="290.44" y="-534.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="290.44" y="-521.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="290.44" y="-508.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP1_DP0&#45;&gt;EP_Cluster_PP1_DP0 -->
<g id="edge3" class="edge">
<title>Gate_PP1_DP0&#45;&gt;EP_Cluster_PP1_DP0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M358.64,-487.92C384.58,-474.17 413.68,-458.75 437.84,-445.94"/>
<polygon fill="black" stroke="black" points="439.64,-448.95 446.83,-441.17 436.36,-442.76 439.64,-448.95"/>
</g>
<!-- TP_Comm_PP2_DP0 -->
<g id="node8" class="node">
<title>TP_Comm_PP2_DP0</title>
<ellipse fill="lightyellow" stroke="black" cx="495.44" cy="-216.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="495.44" y="-225.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="495.44" y="-212.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="495.44" y="-199.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP2_DP0&#45;&gt;TP_Comm_PP2_DP0 -->
<g id="edge4" class="edge">
<title>GPU_Cluster_PP2_DP0&#45;&gt;TP_Comm_PP2_DP0</title>
<path fill="none" stroke="black" d="M493.08,-299.95C493.41,-288.28 493.83,-273.64 494.22,-259.93"/>
<polygon fill="black" stroke="black" points="497.73,-259.78 494.51,-249.69 490.73,-259.59 497.73,-259.78"/>
</g>
<!-- EP_Cluster_PP2_DP0 -->
<g id="node7" class="node">
<title>EP_Cluster_PP2_DP0</title>
<polygon fill="lightgreen" stroke="black" points="571.44,-132.08 419.44,-132.08 419.44,-85.08 571.44,-85.08 571.44,-132.08"/>
<text text-anchor="middle" x="495.44" y="-118.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="495.44" y="-105.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="495.44" y="-92.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- output -->
<g id="node66" class="node">
<title>output</title>
<ellipse fill="lightpink" stroke="black" cx="1848.44" cy="-24.04" rx="83.38" ry="24.08"/>
<text text-anchor="middle" x="1848.44" y="-27.44" font-family="Arial" font-size="12.00">Output Batch</text>
<text text-anchor="middle" x="1848.44" y="-14.44" font-family="Arial" font-size="12.00">[128, seq_len, 512]</text>
</g>
<!-- EP_Cluster_PP2_DP0&#45;&gt;output -->
<g id="edge57" class="edge">
<title>EP_Cluster_PP2_DP0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M555.02,-84.96C565.36,-81.8 576.12,-78.99 586.44,-77.08 810.44,-35.79 1501.96,-27.24 1754.7,-25.49"/>
<polygon fill="black" stroke="black" points="1754.98,-28.99 1764.96,-25.42 1754.93,-21.99 1754.98,-28.99"/>
</g>
<!-- TP_Comm_PP2_DP0&#45;&gt;EP_Cluster_PP2_DP0 -->
<g id="edge5" class="edge">
<title>TP_Comm_PP2_DP0&#45;&gt;EP_Cluster_PP2_DP0</title>
<path fill="none" stroke="black" d="M495.44,-182.57C495.44,-169.8 495.44,-155.16 495.44,-142.37"/>
<polygon fill="black" stroke="black" points="498.94,-142.13 495.44,-132.13 491.94,-142.13 498.94,-142.13"/>
</g>
<!-- Gate_PP2_DP0 -->
<g id="node9" class="node">
<title>Gate_PP2_DP0</title>
<polygon fill="lightcoral" stroke="black" points="398.08,-263.08 226.84,-263.08 182.79,-169.08 354.03,-169.08 398.08,-263.08"/>
<text text-anchor="middle" x="290.44" y="-225.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="290.44" y="-212.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="290.44" y="-199.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP2_DP0&#45;&gt;EP_Cluster_PP2_DP0 -->
<g id="edge6" class="edge">
<title>Gate_PP2_DP0&#45;&gt;EP_Cluster_PP2_DP0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M359.27,-179.66C386.41,-165.69 417.1,-149.9 442.46,-136.85"/>
<polygon fill="black" stroke="black" points="444.26,-139.86 451.55,-132.17 441.05,-133.64 444.26,-139.86"/>
</g>
<!-- GPU_Cluster_PP1_DP1 -->
<g id="node10" class="node">
<title>GPU_Cluster_PP1_DP1</title>
<polygon fill="lightgreen" stroke="black" points="985.44,-656.62 837.44,-656.62 837.44,-609.62 985.44,-609.62 985.44,-656.62"/>
<text text-anchor="middle" x="911.44" y="-643.02" font-family="Arial" font-size="12.00">PP Stage 1</text>
<text text-anchor="middle" x="911.44" y="-630.02" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="911.44" y="-617.02" font-family="Arial" font-size="12.00">Layers 1&#45;8</text>
</g>
<!-- TP_Comm_PP1_DP1 -->
<g id="node12" class="node">
<title>TP_Comm_PP1_DP1</title>
<ellipse fill="lightyellow" stroke="black" cx="911.44" cy="-525.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="911.44" y="-534.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="911.44" y="-521.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="911.44" y="-508.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP1_DP1&#45;&gt;TP_Comm_PP1_DP1 -->
<g id="edge8" class="edge">
<title>GPU_Cluster_PP1_DP1&#45;&gt;TP_Comm_PP1_DP1</title>
<path fill="none" stroke="black" d="M911.44,-609.38C911.44,-597.54 911.44,-582.69 911.44,-568.81"/>
<polygon fill="black" stroke="black" points="914.94,-568.45 911.44,-558.45 907.94,-568.45 914.94,-568.45"/>
</g>
<!-- EP_Cluster_PP1_DP1 -->
<g id="node11" class="node">
<title>EP_Cluster_PP1_DP1</title>
<polygon fill="lightgreen" stroke="black" points="981.44,-441.08 829.44,-441.08 829.44,-394.08 981.44,-394.08 981.44,-441.08"/>
<text text-anchor="middle" x="905.44" y="-427.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="905.44" y="-414.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="905.44" y="-401.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- GPU_Cluster_PP2_DP1 -->
<g id="node14" class="node">
<title>GPU_Cluster_PP2_DP1</title>
<polygon fill="lightgreen" stroke="black" points="982.44,-347.08 834.44,-347.08 834.44,-300.08 982.44,-300.08 982.44,-347.08"/>
<text text-anchor="middle" x="908.44" y="-333.48" font-family="Arial" font-size="12.00">PP Stage 2</text>
<text text-anchor="middle" x="908.44" y="-320.48" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="908.44" y="-307.48" font-family="Arial" font-size="12.00">Layers 9&#45;16</text>
</g>
<!-- EP_Cluster_PP1_DP1&#45;&gt;GPU_Cluster_PP2_DP1 -->
<g id="edge14" class="edge">
<title>EP_Cluster_PP1_DP1&#45;&gt;GPU_Cluster_PP2_DP1</title>
<path fill="none" stroke="black" stroke-width="2" d="M906.18,-393.84C906.54,-382.89 906.97,-369.56 907.36,-357.53"/>
<polygon fill="black" stroke="black" stroke-width="2" points="910.87,-357.49 907.7,-347.38 903.87,-357.26 910.87,-357.49"/>
<text text-anchor="middle" x="948.94" y="-368.08" font-family="Arial" font-size="10.00">PP Communication</text>
</g>
<!-- TP_Comm_PP1_DP1&#45;&gt;EP_Cluster_PP1_DP1 -->
<g id="edge9" class="edge">
<title>TP_Comm_PP1_DP1&#45;&gt;EP_Cluster_PP1_DP1</title>
<path fill="none" stroke="black" d="M909.61,-491.86C908.88,-479.07 908.04,-464.39 907.31,-451.53"/>
<polygon fill="black" stroke="black" points="910.79,-451.04 906.73,-441.25 903.8,-451.43 910.79,-451.04"/>
</g>
<!-- Gate_PP1_DP1 -->
<g id="node13" class="node">
<title>Gate_PP1_DP1</title>
<polygon fill="lightcoral" stroke="black" points="814.08,-572.08 642.84,-572.08 598.79,-478.08 770.03,-478.08 814.08,-572.08"/>
<text text-anchor="middle" x="706.44" y="-534.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="706.44" y="-521.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="706.44" y="-508.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP1_DP1&#45;&gt;EP_Cluster_PP1_DP1 -->
<g id="edge10" class="edge">
<title>Gate_PP1_DP1&#45;&gt;EP_Cluster_PP1_DP1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M774.64,-487.92C800.58,-474.17 829.68,-458.75 853.84,-445.94"/>
<polygon fill="black" stroke="black" points="855.64,-448.95 862.83,-441.17 852.36,-442.76 855.64,-448.95"/>
</g>
<!-- TP_Comm_PP2_DP1 -->
<g id="node16" class="node">
<title>TP_Comm_PP2_DP1</title>
<ellipse fill="lightyellow" stroke="black" cx="911.44" cy="-216.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="911.44" y="-225.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="911.44" y="-212.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="911.44" y="-199.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP2_DP1&#45;&gt;TP_Comm_PP2_DP1 -->
<g id="edge11" class="edge">
<title>GPU_Cluster_PP2_DP1&#45;&gt;TP_Comm_PP2_DP1</title>
<path fill="none" stroke="black" d="M909.08,-299.95C909.41,-288.28 909.83,-273.64 910.22,-259.93"/>
<polygon fill="black" stroke="black" points="913.73,-259.78 910.51,-249.69 906.73,-259.59 913.73,-259.78"/>
</g>
<!-- EP_Cluster_PP2_DP1 -->
<g id="node15" class="node">
<title>EP_Cluster_PP2_DP1</title>
<polygon fill="lightgreen" stroke="black" points="987.44,-132.08 835.44,-132.08 835.44,-85.08 987.44,-85.08 987.44,-132.08"/>
<text text-anchor="middle" x="911.44" y="-118.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="911.44" y="-105.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="911.44" y="-92.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- EP_Cluster_PP2_DP1&#45;&gt;output -->
<g id="edge58" class="edge">
<title>EP_Cluster_PP2_DP1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M971.54,-84.99C981.73,-81.87 992.3,-79.06 1002.44,-77.08 1144.35,-49.43 1566.89,-33.57 1755.6,-27.69"/>
<polygon fill="black" stroke="black" points="1755.89,-31.18 1765.78,-27.37 1755.68,-24.18 1755.89,-31.18"/>
</g>
<!-- TP_Comm_PP2_DP1&#45;&gt;EP_Cluster_PP2_DP1 -->
<g id="edge12" class="edge">
<title>TP_Comm_PP2_DP1&#45;&gt;EP_Cluster_PP2_DP1</title>
<path fill="none" stroke="black" d="M911.44,-182.57C911.44,-169.8 911.44,-155.16 911.44,-142.37"/>
<polygon fill="black" stroke="black" points="914.94,-142.13 911.44,-132.13 907.94,-142.13 914.94,-142.13"/>
</g>
<!-- Gate_PP2_DP1 -->
<g id="node17" class="node">
<title>Gate_PP2_DP1</title>
<polygon fill="lightcoral" stroke="black" points="814.08,-263.08 642.84,-263.08 598.79,-169.08 770.03,-169.08 814.08,-263.08"/>
<text text-anchor="middle" x="706.44" y="-225.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="706.44" y="-212.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="706.44" y="-199.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP2_DP1&#45;&gt;EP_Cluster_PP2_DP1 -->
<g id="edge13" class="edge">
<title>Gate_PP2_DP1&#45;&gt;EP_Cluster_PP2_DP1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M775.27,-179.66C802.41,-165.69 833.1,-149.9 858.46,-136.85"/>
<polygon fill="black" stroke="black" points="860.26,-139.86 867.55,-132.17 857.05,-133.64 860.26,-139.86"/>
</g>
<!-- GPU_Cluster_PP1_DP2 -->
<g id="node18" class="node">
<title>GPU_Cluster_PP1_DP2</title>
<polygon fill="lightgreen" stroke="black" points="1401.44,-656.62 1253.44,-656.62 1253.44,-609.62 1401.44,-609.62 1401.44,-656.62"/>
<text text-anchor="middle" x="1327.44" y="-643.02" font-family="Arial" font-size="12.00">PP Stage 1</text>
<text text-anchor="middle" x="1327.44" y="-630.02" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="1327.44" y="-617.02" font-family="Arial" font-size="12.00">Layers 1&#45;8</text>
</g>
<!-- TP_Comm_PP1_DP2 -->
<g id="node20" class="node">
<title>TP_Comm_PP1_DP2</title>
<ellipse fill="lightyellow" stroke="black" cx="1327.44" cy="-525.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="1327.44" y="-534.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="1327.44" y="-521.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="1327.44" y="-508.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP1_DP2&#45;&gt;TP_Comm_PP1_DP2 -->
<g id="edge15" class="edge">
<title>GPU_Cluster_PP1_DP2&#45;&gt;TP_Comm_PP1_DP2</title>
<path fill="none" stroke="black" d="M1327.44,-609.38C1327.44,-597.54 1327.44,-582.69 1327.44,-568.81"/>
<polygon fill="black" stroke="black" points="1330.94,-568.45 1327.44,-558.45 1323.94,-568.45 1330.94,-568.45"/>
</g>
<!-- EP_Cluster_PP1_DP2 -->
<g id="node19" class="node">
<title>EP_Cluster_PP1_DP2</title>
<polygon fill="lightgreen" stroke="black" points="1397.44,-441.08 1245.44,-441.08 1245.44,-394.08 1397.44,-394.08 1397.44,-441.08"/>
<text text-anchor="middle" x="1321.44" y="-427.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="1321.44" y="-414.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="1321.44" y="-401.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- GPU_Cluster_PP2_DP2 -->
<g id="node22" class="node">
<title>GPU_Cluster_PP2_DP2</title>
<polygon fill="lightgreen" stroke="black" points="1398.44,-347.08 1250.44,-347.08 1250.44,-300.08 1398.44,-300.08 1398.44,-347.08"/>
<text text-anchor="middle" x="1324.44" y="-333.48" font-family="Arial" font-size="12.00">PP Stage 2</text>
<text text-anchor="middle" x="1324.44" y="-320.48" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="1324.44" y="-307.48" font-family="Arial" font-size="12.00">Layers 9&#45;16</text>
</g>
<!-- EP_Cluster_PP1_DP2&#45;&gt;GPU_Cluster_PP2_DP2 -->
<g id="edge21" class="edge">
<title>EP_Cluster_PP1_DP2&#45;&gt;GPU_Cluster_PP2_DP2</title>
<path fill="none" stroke="black" stroke-width="2" d="M1322.18,-393.84C1322.54,-382.89 1322.97,-369.56 1323.36,-357.53"/>
<polygon fill="black" stroke="black" stroke-width="2" points="1326.87,-357.49 1323.7,-347.38 1319.87,-357.26 1326.87,-357.49"/>
<text text-anchor="middle" x="1364.94" y="-368.08" font-family="Arial" font-size="10.00">PP Communication</text>
</g>
<!-- TP_Comm_PP1_DP2&#45;&gt;EP_Cluster_PP1_DP2 -->
<g id="edge16" class="edge">
<title>TP_Comm_PP1_DP2&#45;&gt;EP_Cluster_PP1_DP2</title>
<path fill="none" stroke="black" d="M1325.61,-491.86C1324.88,-479.07 1324.04,-464.39 1323.31,-451.53"/>
<polygon fill="black" stroke="black" points="1326.79,-451.04 1322.73,-441.25 1319.8,-451.43 1326.79,-451.04"/>
</g>
<!-- Gate_PP1_DP2 -->
<g id="node21" class="node">
<title>Gate_PP1_DP2</title>
<polygon fill="lightcoral" stroke="black" points="1230.08,-572.08 1058.84,-572.08 1014.79,-478.08 1186.03,-478.08 1230.08,-572.08"/>
<text text-anchor="middle" x="1122.44" y="-534.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="1122.44" y="-521.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="1122.44" y="-508.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP1_DP2&#45;&gt;EP_Cluster_PP1_DP2 -->
<g id="edge17" class="edge">
<title>Gate_PP1_DP2&#45;&gt;EP_Cluster_PP1_DP2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1190.64,-487.92C1216.58,-474.17 1245.68,-458.75 1269.84,-445.94"/>
<polygon fill="black" stroke="black" points="1271.64,-448.95 1278.83,-441.17 1268.36,-442.76 1271.64,-448.95"/>
</g>
<!-- TP_Comm_PP2_DP2 -->
<g id="node24" class="node">
<title>TP_Comm_PP2_DP2</title>
<ellipse fill="lightyellow" stroke="black" cx="1327.44" cy="-216.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="1327.44" y="-225.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="1327.44" y="-212.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="1327.44" y="-199.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP2_DP2&#45;&gt;TP_Comm_PP2_DP2 -->
<g id="edge18" class="edge">
<title>GPU_Cluster_PP2_DP2&#45;&gt;TP_Comm_PP2_DP2</title>
<path fill="none" stroke="black" d="M1325.08,-299.95C1325.41,-288.28 1325.83,-273.64 1326.22,-259.93"/>
<polygon fill="black" stroke="black" points="1329.73,-259.78 1326.51,-249.69 1322.73,-259.59 1329.73,-259.78"/>
</g>
<!-- EP_Cluster_PP2_DP2 -->
<g id="node23" class="node">
<title>EP_Cluster_PP2_DP2</title>
<polygon fill="lightgreen" stroke="black" points="1403.44,-132.08 1251.44,-132.08 1251.44,-85.08 1403.44,-85.08 1403.44,-132.08"/>
<text text-anchor="middle" x="1327.44" y="-118.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="1327.44" y="-105.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="1327.44" y="-92.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- EP_Cluster_PP2_DP2&#45;&gt;output -->
<g id="edge59" class="edge">
<title>EP_Cluster_PP2_DP2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1389.13,-85.04C1398.85,-82.03 1408.85,-79.25 1418.44,-77.08 1533.63,-51.09 1669.3,-37.41 1756.98,-30.71"/>
<polygon fill="black" stroke="black" points="1757.45,-34.18 1767.16,-29.95 1756.93,-27.2 1757.45,-34.18"/>
</g>
<!-- TP_Comm_PP2_DP2&#45;&gt;EP_Cluster_PP2_DP2 -->
<g id="edge19" class="edge">
<title>TP_Comm_PP2_DP2&#45;&gt;EP_Cluster_PP2_DP2</title>
<path fill="none" stroke="black" d="M1327.44,-182.57C1327.44,-169.8 1327.44,-155.16 1327.44,-142.37"/>
<polygon fill="black" stroke="black" points="1330.94,-142.13 1327.44,-132.13 1323.94,-142.13 1330.94,-142.13"/>
</g>
<!-- Gate_PP2_DP2 -->
<g id="node25" class="node">
<title>Gate_PP2_DP2</title>
<polygon fill="lightcoral" stroke="black" points="1230.08,-263.08 1058.84,-263.08 1014.79,-169.08 1186.03,-169.08 1230.08,-263.08"/>
<text text-anchor="middle" x="1122.44" y="-225.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="1122.44" y="-212.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="1122.44" y="-199.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP2_DP2&#45;&gt;EP_Cluster_PP2_DP2 -->
<g id="edge20" class="edge">
<title>Gate_PP2_DP2&#45;&gt;EP_Cluster_PP2_DP2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1191.27,-179.66C1218.41,-165.69 1249.1,-149.9 1274.46,-136.85"/>
<polygon fill="black" stroke="black" points="1276.26,-139.86 1283.55,-132.17 1273.05,-133.64 1276.26,-139.86"/>
</g>
<!-- GPU_Cluster_PP1_DP3 -->
<g id="node26" class="node">
<title>GPU_Cluster_PP1_DP3</title>
<polygon fill="lightgreen" stroke="black" points="1817.44,-656.62 1669.44,-656.62 1669.44,-609.62 1817.44,-609.62 1817.44,-656.62"/>
<text text-anchor="middle" x="1743.44" y="-643.02" font-family="Arial" font-size="12.00">PP Stage 1</text>
<text text-anchor="middle" x="1743.44" y="-630.02" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="1743.44" y="-617.02" font-family="Arial" font-size="12.00">Layers 1&#45;8</text>
</g>
<!-- TP_Comm_PP1_DP3 -->
<g id="node28" class="node">
<title>TP_Comm_PP1_DP3</title>
<ellipse fill="lightyellow" stroke="black" cx="1743.44" cy="-525.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="1743.44" y="-534.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="1743.44" y="-521.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="1743.44" y="-508.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP1_DP3&#45;&gt;TP_Comm_PP1_DP3 -->
<g id="edge22" class="edge">
<title>GPU_Cluster_PP1_DP3&#45;&gt;TP_Comm_PP1_DP3</title>
<path fill="none" stroke="black" d="M1743.44,-609.38C1743.44,-597.54 1743.44,-582.69 1743.44,-568.81"/>
<polygon fill="black" stroke="black" points="1746.94,-568.45 1743.44,-558.45 1739.94,-568.45 1746.94,-568.45"/>
</g>
<!-- EP_Cluster_PP1_DP3 -->
<g id="node27" class="node">
<title>EP_Cluster_PP1_DP3</title>
<polygon fill="lightgreen" stroke="black" points="1813.44,-441.08 1661.44,-441.08 1661.44,-394.08 1813.44,-394.08 1813.44,-441.08"/>
<text text-anchor="middle" x="1737.44" y="-427.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="1737.44" y="-414.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="1737.44" y="-401.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- GPU_Cluster_PP2_DP3 -->
<g id="node30" class="node">
<title>GPU_Cluster_PP2_DP3</title>
<polygon fill="lightgreen" stroke="black" points="1814.44,-347.08 1666.44,-347.08 1666.44,-300.08 1814.44,-300.08 1814.44,-347.08"/>
<text text-anchor="middle" x="1740.44" y="-333.48" font-family="Arial" font-size="12.00">PP Stage 2</text>
<text text-anchor="middle" x="1740.44" y="-320.48" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="1740.44" y="-307.48" font-family="Arial" font-size="12.00">Layers 9&#45;16</text>
</g>
<!-- EP_Cluster_PP1_DP3&#45;&gt;GPU_Cluster_PP2_DP3 -->
<g id="edge28" class="edge">
<title>EP_Cluster_PP1_DP3&#45;&gt;GPU_Cluster_PP2_DP3</title>
<path fill="none" stroke="black" stroke-width="2" d="M1738.18,-393.84C1738.54,-382.89 1738.97,-369.56 1739.36,-357.53"/>
<polygon fill="black" stroke="black" stroke-width="2" points="1742.87,-357.49 1739.7,-347.38 1735.87,-357.26 1742.87,-357.49"/>
<text text-anchor="middle" x="1780.94" y="-368.08" font-family="Arial" font-size="10.00">PP Communication</text>
</g>
<!-- TP_Comm_PP1_DP3&#45;&gt;EP_Cluster_PP1_DP3 -->
<g id="edge23" class="edge">
<title>TP_Comm_PP1_DP3&#45;&gt;EP_Cluster_PP1_DP3</title>
<path fill="none" stroke="black" d="M1741.61,-491.86C1740.88,-479.07 1740.04,-464.39 1739.31,-451.53"/>
<polygon fill="black" stroke="black" points="1742.79,-451.04 1738.73,-441.25 1735.8,-451.43 1742.79,-451.04"/>
</g>
<!-- Gate_PP1_DP3 -->
<g id="node29" class="node">
<title>Gate_PP1_DP3</title>
<polygon fill="lightcoral" stroke="black" points="1646.08,-572.08 1474.84,-572.08 1430.79,-478.08 1602.03,-478.08 1646.08,-572.08"/>
<text text-anchor="middle" x="1538.44" y="-534.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="1538.44" y="-521.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="1538.44" y="-508.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP1_DP3&#45;&gt;EP_Cluster_PP1_DP3 -->
<g id="edge24" class="edge">
<title>Gate_PP1_DP3&#45;&gt;EP_Cluster_PP1_DP3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1606.64,-487.92C1632.58,-474.17 1661.68,-458.75 1685.84,-445.94"/>
<polygon fill="black" stroke="black" points="1687.64,-448.95 1694.83,-441.17 1684.36,-442.76 1687.64,-448.95"/>
</g>
<!-- TP_Comm_PP2_DP3 -->
<g id="node32" class="node">
<title>TP_Comm_PP2_DP3</title>
<ellipse fill="lightyellow" stroke="black" cx="1743.44" cy="-216.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="1743.44" y="-225.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="1743.44" y="-212.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="1743.44" y="-199.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP2_DP3&#45;&gt;TP_Comm_PP2_DP3 -->
<g id="edge25" class="edge">
<title>GPU_Cluster_PP2_DP3&#45;&gt;TP_Comm_PP2_DP3</title>
<path fill="none" stroke="black" d="M1741.08,-299.95C1741.41,-288.28 1741.83,-273.64 1742.22,-259.93"/>
<polygon fill="black" stroke="black" points="1745.73,-259.78 1742.51,-249.69 1738.73,-259.59 1745.73,-259.78"/>
</g>
<!-- EP_Cluster_PP2_DP3 -->
<g id="node31" class="node">
<title>EP_Cluster_PP2_DP3</title>
<polygon fill="lightgreen" stroke="black" points="1819.44,-132.08 1667.44,-132.08 1667.44,-85.08 1819.44,-85.08 1819.44,-132.08"/>
<text text-anchor="middle" x="1743.44" y="-118.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="1743.44" y="-105.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="1743.44" y="-92.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- EP_Cluster_PP2_DP3&#45;&gt;output -->
<g id="edge60" class="edge">
<title>EP_Cluster_PP2_DP3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1772.13,-85.03C1784.6,-75.23 1799.34,-63.63 1812.53,-53.27"/>
<polygon fill="black" stroke="black" points="1814.81,-55.93 1820.51,-47 1810.48,-50.43 1814.81,-55.93"/>
</g>
<!-- TP_Comm_PP2_DP3&#45;&gt;EP_Cluster_PP2_DP3 -->
<g id="edge26" class="edge">
<title>TP_Comm_PP2_DP3&#45;&gt;EP_Cluster_PP2_DP3</title>
<path fill="none" stroke="black" d="M1743.44,-182.57C1743.44,-169.8 1743.44,-155.16 1743.44,-142.37"/>
<polygon fill="black" stroke="black" points="1746.94,-142.13 1743.44,-132.13 1739.94,-142.13 1746.94,-142.13"/>
</g>
<!-- Gate_PP2_DP3 -->
<g id="node33" class="node">
<title>Gate_PP2_DP3</title>
<polygon fill="lightcoral" stroke="black" points="1646.08,-263.08 1474.84,-263.08 1430.79,-169.08 1602.03,-169.08 1646.08,-263.08"/>
<text text-anchor="middle" x="1538.44" y="-225.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="1538.44" y="-212.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="1538.44" y="-199.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP2_DP3&#45;&gt;EP_Cluster_PP2_DP3 -->
<g id="edge27" class="edge">
<title>Gate_PP2_DP3&#45;&gt;EP_Cluster_PP2_DP3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1607.27,-179.66C1634.41,-165.69 1665.1,-149.9 1690.46,-136.85"/>
<polygon fill="black" stroke="black" points="1692.26,-139.86 1699.55,-132.17 1689.05,-133.64 1692.26,-139.86"/>
</g>
<!-- GPU_Cluster_PP1_DP4 -->
<g id="node34" class="node">
<title>GPU_Cluster_PP1_DP4</title>
<polygon fill="lightgreen" stroke="black" points="2233.44,-656.62 2085.44,-656.62 2085.44,-609.62 2233.44,-609.62 2233.44,-656.62"/>
<text text-anchor="middle" x="2159.44" y="-643.02" font-family="Arial" font-size="12.00">PP Stage 1</text>
<text text-anchor="middle" x="2159.44" y="-630.02" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="2159.44" y="-617.02" font-family="Arial" font-size="12.00">Layers 1&#45;8</text>
</g>
<!-- TP_Comm_PP1_DP4 -->
<g id="node36" class="node">
<title>TP_Comm_PP1_DP4</title>
<ellipse fill="lightyellow" stroke="black" cx="2159.44" cy="-525.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="2159.44" y="-534.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="2159.44" y="-521.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="2159.44" y="-508.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP1_DP4&#45;&gt;TP_Comm_PP1_DP4 -->
<g id="edge29" class="edge">
<title>GPU_Cluster_PP1_DP4&#45;&gt;TP_Comm_PP1_DP4</title>
<path fill="none" stroke="black" d="M2159.44,-609.38C2159.44,-597.54 2159.44,-582.69 2159.44,-568.81"/>
<polygon fill="black" stroke="black" points="2162.94,-568.45 2159.44,-558.45 2155.94,-568.45 2162.94,-568.45"/>
</g>
<!-- EP_Cluster_PP1_DP4 -->
<g id="node35" class="node">
<title>EP_Cluster_PP1_DP4</title>
<polygon fill="lightgreen" stroke="black" points="2229.44,-441.08 2077.44,-441.08 2077.44,-394.08 2229.44,-394.08 2229.44,-441.08"/>
<text text-anchor="middle" x="2153.44" y="-427.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="2153.44" y="-414.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="2153.44" y="-401.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- GPU_Cluster_PP2_DP4 -->
<g id="node38" class="node">
<title>GPU_Cluster_PP2_DP4</title>
<polygon fill="lightgreen" stroke="black" points="2230.44,-347.08 2082.44,-347.08 2082.44,-300.08 2230.44,-300.08 2230.44,-347.08"/>
<text text-anchor="middle" x="2156.44" y="-333.48" font-family="Arial" font-size="12.00">PP Stage 2</text>
<text text-anchor="middle" x="2156.44" y="-320.48" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="2156.44" y="-307.48" font-family="Arial" font-size="12.00">Layers 9&#45;16</text>
</g>
<!-- EP_Cluster_PP1_DP4&#45;&gt;GPU_Cluster_PP2_DP4 -->
<g id="edge35" class="edge">
<title>EP_Cluster_PP1_DP4&#45;&gt;GPU_Cluster_PP2_DP4</title>
<path fill="none" stroke="black" stroke-width="2" d="M2154.18,-393.84C2154.54,-382.89 2154.97,-369.56 2155.36,-357.53"/>
<polygon fill="black" stroke="black" stroke-width="2" points="2158.87,-357.49 2155.7,-347.38 2151.87,-357.26 2158.87,-357.49"/>
<text text-anchor="middle" x="2196.94" y="-368.08" font-family="Arial" font-size="10.00">PP Communication</text>
</g>
<!-- TP_Comm_PP1_DP4&#45;&gt;EP_Cluster_PP1_DP4 -->
<g id="edge30" class="edge">
<title>TP_Comm_PP1_DP4&#45;&gt;EP_Cluster_PP1_DP4</title>
<path fill="none" stroke="black" d="M2157.61,-491.86C2156.88,-479.07 2156.04,-464.39 2155.31,-451.53"/>
<polygon fill="black" stroke="black" points="2158.79,-451.04 2154.73,-441.25 2151.8,-451.43 2158.79,-451.04"/>
</g>
<!-- Gate_PP1_DP4 -->
<g id="node37" class="node">
<title>Gate_PP1_DP4</title>
<polygon fill="lightcoral" stroke="black" points="2062.08,-572.08 1890.84,-572.08 1846.79,-478.08 2018.03,-478.08 2062.08,-572.08"/>
<text text-anchor="middle" x="1954.44" y="-534.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="1954.44" y="-521.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="1954.44" y="-508.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP1_DP4&#45;&gt;EP_Cluster_PP1_DP4 -->
<g id="edge31" class="edge">
<title>Gate_PP1_DP4&#45;&gt;EP_Cluster_PP1_DP4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2022.64,-487.92C2048.58,-474.17 2077.68,-458.75 2101.84,-445.94"/>
<polygon fill="black" stroke="black" points="2103.64,-448.95 2110.83,-441.17 2100.36,-442.76 2103.64,-448.95"/>
</g>
<!-- TP_Comm_PP2_DP4 -->
<g id="node40" class="node">
<title>TP_Comm_PP2_DP4</title>
<ellipse fill="lightyellow" stroke="black" cx="2159.44" cy="-216.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="2159.44" y="-225.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="2159.44" y="-212.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="2159.44" y="-199.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP2_DP4&#45;&gt;TP_Comm_PP2_DP4 -->
<g id="edge32" class="edge">
<title>GPU_Cluster_PP2_DP4&#45;&gt;TP_Comm_PP2_DP4</title>
<path fill="none" stroke="black" d="M2157.08,-299.95C2157.41,-288.28 2157.83,-273.64 2158.22,-259.93"/>
<polygon fill="black" stroke="black" points="2161.73,-259.78 2158.51,-249.69 2154.73,-259.59 2161.73,-259.78"/>
</g>
<!-- EP_Cluster_PP2_DP4 -->
<g id="node39" class="node">
<title>EP_Cluster_PP2_DP4</title>
<polygon fill="lightgreen" stroke="black" points="2030.44,-132.08 1878.44,-132.08 1878.44,-85.08 2030.44,-85.08 2030.44,-132.08"/>
<text text-anchor="middle" x="1954.44" y="-118.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="1954.44" y="-105.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="1954.44" y="-92.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- EP_Cluster_PP2_DP4&#45;&gt;output -->
<g id="edge61" class="edge">
<title>EP_Cluster_PP2_DP4&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1925.47,-85.03C1912.78,-75.15 1897.76,-63.45 1884.37,-53.02"/>
<polygon fill="black" stroke="black" points="1886.31,-50.1 1876.27,-46.71 1882.01,-55.62 1886.31,-50.1"/>
</g>
<!-- TP_Comm_PP2_DP4&#45;&gt;EP_Cluster_PP2_DP4 -->
<g id="edge33" class="edge">
<title>TP_Comm_PP2_DP4&#45;&gt;EP_Cluster_PP2_DP4</title>
<path fill="none" stroke="black" d="M2111.07,-189.68C2098.21,-182.95 2084.31,-175.72 2071.44,-169.08 2050.8,-158.44 2028.06,-146.85 2008.15,-136.74"/>
<polygon fill="black" stroke="black" points="2009.72,-133.61 1999.22,-132.21 2006.56,-139.86 2009.72,-133.61"/>
</g>
<!-- Gate_PP2_DP4 -->
<g id="node41" class="node">
<title>Gate_PP2_DP4</title>
<polygon fill="lightcoral" stroke="black" points="2062.08,-263.08 1890.84,-263.08 1846.79,-169.08 2018.03,-169.08 2062.08,-263.08"/>
<text text-anchor="middle" x="1954.44" y="-225.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="1954.44" y="-212.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="1954.44" y="-199.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP2_DP4&#45;&gt;EP_Cluster_PP2_DP4 -->
<g id="edge34" class="edge">
<title>Gate_PP2_DP4&#45;&gt;EP_Cluster_PP2_DP4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1954.44,-168.81C1954.44,-159.86 1954.44,-150.65 1954.44,-142.24"/>
<polygon fill="black" stroke="black" points="1957.94,-142.1 1954.44,-132.1 1950.94,-142.1 1957.94,-142.1"/>
</g>
<!-- GPU_Cluster_PP1_DP5 -->
<g id="node42" class="node">
<title>GPU_Cluster_PP1_DP5</title>
<polygon fill="lightgreen" stroke="black" points="2649.44,-656.62 2501.44,-656.62 2501.44,-609.62 2649.44,-609.62 2649.44,-656.62"/>
<text text-anchor="middle" x="2575.44" y="-643.02" font-family="Arial" font-size="12.00">PP Stage 1</text>
<text text-anchor="middle" x="2575.44" y="-630.02" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="2575.44" y="-617.02" font-family="Arial" font-size="12.00">Layers 1&#45;8</text>
</g>
<!-- TP_Comm_PP1_DP5 -->
<g id="node44" class="node">
<title>TP_Comm_PP1_DP5</title>
<ellipse fill="lightyellow" stroke="black" cx="2575.44" cy="-525.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="2575.44" y="-534.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="2575.44" y="-521.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="2575.44" y="-508.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP1_DP5&#45;&gt;TP_Comm_PP1_DP5 -->
<g id="edge36" class="edge">
<title>GPU_Cluster_PP1_DP5&#45;&gt;TP_Comm_PP1_DP5</title>
<path fill="none" stroke="black" d="M2575.44,-609.38C2575.44,-597.54 2575.44,-582.69 2575.44,-568.81"/>
<polygon fill="black" stroke="black" points="2578.94,-568.45 2575.44,-558.45 2571.94,-568.45 2578.94,-568.45"/>
</g>
<!-- EP_Cluster_PP1_DP5 -->
<g id="node43" class="node">
<title>EP_Cluster_PP1_DP5</title>
<polygon fill="lightgreen" stroke="black" points="2645.44,-441.08 2493.44,-441.08 2493.44,-394.08 2645.44,-394.08 2645.44,-441.08"/>
<text text-anchor="middle" x="2569.44" y="-427.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="2569.44" y="-414.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="2569.44" y="-401.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- GPU_Cluster_PP2_DP5 -->
<g id="node46" class="node">
<title>GPU_Cluster_PP2_DP5</title>
<polygon fill="lightgreen" stroke="black" points="2646.44,-347.08 2498.44,-347.08 2498.44,-300.08 2646.44,-300.08 2646.44,-347.08"/>
<text text-anchor="middle" x="2572.44" y="-333.48" font-family="Arial" font-size="12.00">PP Stage 2</text>
<text text-anchor="middle" x="2572.44" y="-320.48" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="2572.44" y="-307.48" font-family="Arial" font-size="12.00">Layers 9&#45;16</text>
</g>
<!-- EP_Cluster_PP1_DP5&#45;&gt;GPU_Cluster_PP2_DP5 -->
<g id="edge42" class="edge">
<title>EP_Cluster_PP1_DP5&#45;&gt;GPU_Cluster_PP2_DP5</title>
<path fill="none" stroke="black" stroke-width="2" d="M2570.18,-393.84C2570.54,-382.89 2570.97,-369.56 2571.36,-357.53"/>
<polygon fill="black" stroke="black" stroke-width="2" points="2574.87,-357.49 2571.7,-347.38 2567.87,-357.26 2574.87,-357.49"/>
<text text-anchor="middle" x="2612.94" y="-368.08" font-family="Arial" font-size="10.00">PP Communication</text>
</g>
<!-- TP_Comm_PP1_DP5&#45;&gt;EP_Cluster_PP1_DP5 -->
<g id="edge37" class="edge">
<title>TP_Comm_PP1_DP5&#45;&gt;EP_Cluster_PP1_DP5</title>
<path fill="none" stroke="black" d="M2573.61,-491.86C2572.88,-479.07 2572.04,-464.39 2571.31,-451.53"/>
<polygon fill="black" stroke="black" points="2574.79,-451.04 2570.73,-441.25 2567.8,-451.43 2574.79,-451.04"/>
</g>
<!-- Gate_PP1_DP5 -->
<g id="node45" class="node">
<title>Gate_PP1_DP5</title>
<polygon fill="lightcoral" stroke="black" points="2478.08,-572.08 2306.84,-572.08 2262.79,-478.08 2434.03,-478.08 2478.08,-572.08"/>
<text text-anchor="middle" x="2370.44" y="-534.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="2370.44" y="-521.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="2370.44" y="-508.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP1_DP5&#45;&gt;EP_Cluster_PP1_DP5 -->
<g id="edge38" class="edge">
<title>Gate_PP1_DP5&#45;&gt;EP_Cluster_PP1_DP5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2438.64,-487.92C2464.58,-474.17 2493.68,-458.75 2517.84,-445.94"/>
<polygon fill="black" stroke="black" points="2519.64,-448.95 2526.83,-441.17 2516.36,-442.76 2519.64,-448.95"/>
</g>
<!-- TP_Comm_PP2_DP5 -->
<g id="node48" class="node">
<title>TP_Comm_PP2_DP5</title>
<ellipse fill="lightyellow" stroke="black" cx="2575.44" cy="-216.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="2575.44" y="-225.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="2575.44" y="-212.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="2575.44" y="-199.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP2_DP5&#45;&gt;TP_Comm_PP2_DP5 -->
<g id="edge39" class="edge">
<title>GPU_Cluster_PP2_DP5&#45;&gt;TP_Comm_PP2_DP5</title>
<path fill="none" stroke="black" d="M2573.08,-299.95C2573.41,-288.28 2573.83,-273.64 2574.22,-259.93"/>
<polygon fill="black" stroke="black" points="2577.73,-259.78 2574.51,-249.69 2570.73,-259.59 2577.73,-259.78"/>
</g>
<!-- EP_Cluster_PP2_DP5 -->
<g id="node47" class="node">
<title>EP_Cluster_PP2_DP5</title>
<polygon fill="lightgreen" stroke="black" points="2446.44,-132.08 2294.44,-132.08 2294.44,-85.08 2446.44,-85.08 2446.44,-132.08"/>
<text text-anchor="middle" x="2370.44" y="-118.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="2370.44" y="-105.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="2370.44" y="-92.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- EP_Cluster_PP2_DP5&#45;&gt;output -->
<g id="edge62" class="edge">
<title>EP_Cluster_PP2_DP5&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2294.25,-86.76C2279.77,-83.21 2264.69,-79.81 2250.44,-77.08 2143.44,-56.64 2018.86,-41.89 1937.08,-33.42"/>
<polygon fill="black" stroke="black" points="1937.38,-29.94 1927.07,-32.4 1936.67,-36.9 1937.38,-29.94"/>
</g>
<!-- TP_Comm_PP2_DP5&#45;&gt;EP_Cluster_PP2_DP5 -->
<g id="edge40" class="edge">
<title>TP_Comm_PP2_DP5&#45;&gt;EP_Cluster_PP2_DP5</title>
<path fill="none" stroke="black" d="M2527.07,-189.68C2514.21,-182.95 2500.31,-175.72 2487.44,-169.08 2466.8,-158.44 2444.06,-146.85 2424.15,-136.74"/>
<polygon fill="black" stroke="black" points="2425.72,-133.61 2415.22,-132.21 2422.56,-139.86 2425.72,-133.61"/>
</g>
<!-- Gate_PP2_DP5 -->
<g id="node49" class="node">
<title>Gate_PP2_DP5</title>
<polygon fill="lightcoral" stroke="black" points="2478.08,-263.08 2306.84,-263.08 2262.79,-169.08 2434.03,-169.08 2478.08,-263.08"/>
<text text-anchor="middle" x="2370.44" y="-225.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="2370.44" y="-212.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="2370.44" y="-199.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP2_DP5&#45;&gt;EP_Cluster_PP2_DP5 -->
<g id="edge41" class="edge">
<title>Gate_PP2_DP5&#45;&gt;EP_Cluster_PP2_DP5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2370.44,-168.81C2370.44,-159.86 2370.44,-150.65 2370.44,-142.24"/>
<polygon fill="black" stroke="black" points="2373.94,-142.1 2370.44,-132.1 2366.94,-142.1 2373.94,-142.1"/>
</g>
<!-- GPU_Cluster_PP1_DP6 -->
<g id="node50" class="node">
<title>GPU_Cluster_PP1_DP6</title>
<polygon fill="lightgreen" stroke="black" points="3065.44,-656.62 2917.44,-656.62 2917.44,-609.62 3065.44,-609.62 3065.44,-656.62"/>
<text text-anchor="middle" x="2991.44" y="-643.02" font-family="Arial" font-size="12.00">PP Stage 1</text>
<text text-anchor="middle" x="2991.44" y="-630.02" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="2991.44" y="-617.02" font-family="Arial" font-size="12.00">Layers 1&#45;8</text>
</g>
<!-- TP_Comm_PP1_DP6 -->
<g id="node52" class="node">
<title>TP_Comm_PP1_DP6</title>
<ellipse fill="lightyellow" stroke="black" cx="2991.44" cy="-525.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="2991.44" y="-534.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="2991.44" y="-521.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="2991.44" y="-508.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP1_DP6&#45;&gt;TP_Comm_PP1_DP6 -->
<g id="edge43" class="edge">
<title>GPU_Cluster_PP1_DP6&#45;&gt;TP_Comm_PP1_DP6</title>
<path fill="none" stroke="black" d="M2991.44,-609.38C2991.44,-597.54 2991.44,-582.69 2991.44,-568.81"/>
<polygon fill="black" stroke="black" points="2994.94,-568.45 2991.44,-558.45 2987.94,-568.45 2994.94,-568.45"/>
</g>
<!-- EP_Cluster_PP1_DP6 -->
<g id="node51" class="node">
<title>EP_Cluster_PP1_DP6</title>
<polygon fill="lightgreen" stroke="black" points="3061.44,-441.08 2909.44,-441.08 2909.44,-394.08 3061.44,-394.08 3061.44,-441.08"/>
<text text-anchor="middle" x="2985.44" y="-427.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="2985.44" y="-414.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="2985.44" y="-401.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- GPU_Cluster_PP2_DP6 -->
<g id="node54" class="node">
<title>GPU_Cluster_PP2_DP6</title>
<polygon fill="lightgreen" stroke="black" points="3062.44,-347.08 2914.44,-347.08 2914.44,-300.08 3062.44,-300.08 3062.44,-347.08"/>
<text text-anchor="middle" x="2988.44" y="-333.48" font-family="Arial" font-size="12.00">PP Stage 2</text>
<text text-anchor="middle" x="2988.44" y="-320.48" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="2988.44" y="-307.48" font-family="Arial" font-size="12.00">Layers 9&#45;16</text>
</g>
<!-- EP_Cluster_PP1_DP6&#45;&gt;GPU_Cluster_PP2_DP6 -->
<g id="edge49" class="edge">
<title>EP_Cluster_PP1_DP6&#45;&gt;GPU_Cluster_PP2_DP6</title>
<path fill="none" stroke="black" stroke-width="2" d="M2986.18,-393.84C2986.54,-382.89 2986.97,-369.56 2987.36,-357.53"/>
<polygon fill="black" stroke="black" stroke-width="2" points="2990.87,-357.49 2987.7,-347.38 2983.87,-357.26 2990.87,-357.49"/>
<text text-anchor="middle" x="3028.94" y="-368.08" font-family="Arial" font-size="10.00">PP Communication</text>
</g>
<!-- TP_Comm_PP1_DP6&#45;&gt;EP_Cluster_PP1_DP6 -->
<g id="edge44" class="edge">
<title>TP_Comm_PP1_DP6&#45;&gt;EP_Cluster_PP1_DP6</title>
<path fill="none" stroke="black" d="M2989.61,-491.86C2988.88,-479.07 2988.04,-464.39 2987.31,-451.53"/>
<polygon fill="black" stroke="black" points="2990.79,-451.04 2986.73,-441.25 2983.8,-451.43 2990.79,-451.04"/>
</g>
<!-- Gate_PP1_DP6 -->
<g id="node53" class="node">
<title>Gate_PP1_DP6</title>
<polygon fill="lightcoral" stroke="black" points="2894.08,-572.08 2722.84,-572.08 2678.79,-478.08 2850.03,-478.08 2894.08,-572.08"/>
<text text-anchor="middle" x="2786.44" y="-534.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="2786.44" y="-521.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="2786.44" y="-508.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP1_DP6&#45;&gt;EP_Cluster_PP1_DP6 -->
<g id="edge45" class="edge">
<title>Gate_PP1_DP6&#45;&gt;EP_Cluster_PP1_DP6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2854.64,-487.92C2880.58,-474.17 2909.68,-458.75 2933.84,-445.94"/>
<polygon fill="black" stroke="black" points="2935.64,-448.95 2942.83,-441.17 2932.36,-442.76 2935.64,-448.95"/>
</g>
<!-- TP_Comm_PP2_DP6 -->
<g id="node56" class="node">
<title>TP_Comm_PP2_DP6</title>
<ellipse fill="lightyellow" stroke="black" cx="2991.44" cy="-216.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="2991.44" y="-225.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="2991.44" y="-212.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="2991.44" y="-199.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP2_DP6&#45;&gt;TP_Comm_PP2_DP6 -->
<g id="edge46" class="edge">
<title>GPU_Cluster_PP2_DP6&#45;&gt;TP_Comm_PP2_DP6</title>
<path fill="none" stroke="black" d="M2989.08,-299.95C2989.41,-288.28 2989.83,-273.64 2990.22,-259.93"/>
<polygon fill="black" stroke="black" points="2993.73,-259.78 2990.51,-249.69 2986.73,-259.59 2993.73,-259.78"/>
</g>
<!-- EP_Cluster_PP2_DP6 -->
<g id="node55" class="node">
<title>EP_Cluster_PP2_DP6</title>
<polygon fill="lightgreen" stroke="black" points="2862.44,-132.08 2710.44,-132.08 2710.44,-85.08 2862.44,-85.08 2862.44,-132.08"/>
<text text-anchor="middle" x="2786.44" y="-118.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="2786.44" y="-105.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="2786.44" y="-92.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- EP_Cluster_PP2_DP6&#45;&gt;output -->
<g id="edge63" class="edge">
<title>EP_Cluster_PP2_DP6&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2710.38,-86C2695.89,-82.53 2680.77,-79.34 2666.44,-77.08 2406.39,-36.13 2095.01,-27.19 1942.29,-25.38"/>
<polygon fill="black" stroke="black" points="1942.06,-21.88 1932.02,-25.27 1941.98,-28.88 1942.06,-21.88"/>
</g>
<!-- TP_Comm_PP2_DP6&#45;&gt;EP_Cluster_PP2_DP6 -->
<g id="edge47" class="edge">
<title>TP_Comm_PP2_DP6&#45;&gt;EP_Cluster_PP2_DP6</title>
<path fill="none" stroke="black" d="M2943.07,-189.68C2930.21,-182.95 2916.31,-175.72 2903.44,-169.08 2882.8,-158.44 2860.06,-146.85 2840.15,-136.74"/>
<polygon fill="black" stroke="black" points="2841.72,-133.61 2831.22,-132.21 2838.56,-139.86 2841.72,-133.61"/>
</g>
<!-- Gate_PP2_DP6 -->
<g id="node57" class="node">
<title>Gate_PP2_DP6</title>
<polygon fill="lightcoral" stroke="black" points="2894.08,-263.08 2722.84,-263.08 2678.79,-169.08 2850.03,-169.08 2894.08,-263.08"/>
<text text-anchor="middle" x="2786.44" y="-225.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="2786.44" y="-212.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="2786.44" y="-199.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP2_DP6&#45;&gt;EP_Cluster_PP2_DP6 -->
<g id="edge48" class="edge">
<title>Gate_PP2_DP6&#45;&gt;EP_Cluster_PP2_DP6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2786.44,-168.81C2786.44,-159.86 2786.44,-150.65 2786.44,-142.24"/>
<polygon fill="black" stroke="black" points="2789.94,-142.1 2786.44,-132.1 2782.94,-142.1 2789.94,-142.1"/>
</g>
<!-- GPU_Cluster_PP1_DP7 -->
<g id="node58" class="node">
<title>GPU_Cluster_PP1_DP7</title>
<polygon fill="lightgreen" stroke="black" points="3481.44,-656.62 3333.44,-656.62 3333.44,-609.62 3481.44,-609.62 3481.44,-656.62"/>
<text text-anchor="middle" x="3407.44" y="-643.02" font-family="Arial" font-size="12.00">PP Stage 1</text>
<text text-anchor="middle" x="3407.44" y="-630.02" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="3407.44" y="-617.02" font-family="Arial" font-size="12.00">Layers 1&#45;8</text>
</g>
<!-- TP_Comm_PP1_DP7 -->
<g id="node60" class="node">
<title>TP_Comm_PP1_DP7</title>
<ellipse fill="lightyellow" stroke="black" cx="3407.44" cy="-525.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="3407.44" y="-534.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="3407.44" y="-521.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="3407.44" y="-508.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP1_DP7&#45;&gt;TP_Comm_PP1_DP7 -->
<g id="edge50" class="edge">
<title>GPU_Cluster_PP1_DP7&#45;&gt;TP_Comm_PP1_DP7</title>
<path fill="none" stroke="black" d="M3407.44,-609.38C3407.44,-597.54 3407.44,-582.69 3407.44,-568.81"/>
<polygon fill="black" stroke="black" points="3410.94,-568.45 3407.44,-558.45 3403.94,-568.45 3410.94,-568.45"/>
</g>
<!-- EP_Cluster_PP1_DP7 -->
<g id="node59" class="node">
<title>EP_Cluster_PP1_DP7</title>
<polygon fill="lightgreen" stroke="black" points="3477.44,-441.08 3325.44,-441.08 3325.44,-394.08 3477.44,-394.08 3477.44,-441.08"/>
<text text-anchor="middle" x="3401.44" y="-427.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="3401.44" y="-414.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="3401.44" y="-401.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- GPU_Cluster_PP2_DP7 -->
<g id="node62" class="node">
<title>GPU_Cluster_PP2_DP7</title>
<polygon fill="lightgreen" stroke="black" points="3478.44,-347.08 3330.44,-347.08 3330.44,-300.08 3478.44,-300.08 3478.44,-347.08"/>
<text text-anchor="middle" x="3404.44" y="-333.48" font-family="Arial" font-size="12.00">PP Stage 2</text>
<text text-anchor="middle" x="3404.44" y="-320.48" font-family="Arial" font-size="12.00">16 EP × 4 TP = 64 GPUs</text>
<text text-anchor="middle" x="3404.44" y="-307.48" font-family="Arial" font-size="12.00">Layers 9&#45;16</text>
</g>
<!-- EP_Cluster_PP1_DP7&#45;&gt;GPU_Cluster_PP2_DP7 -->
<g id="edge56" class="edge">
<title>EP_Cluster_PP1_DP7&#45;&gt;GPU_Cluster_PP2_DP7</title>
<path fill="none" stroke="black" stroke-width="2" d="M3402.18,-393.84C3402.54,-382.89 3402.97,-369.56 3403.36,-357.53"/>
<polygon fill="black" stroke="black" stroke-width="2" points="3406.87,-357.49 3403.7,-347.38 3399.87,-357.26 3406.87,-357.49"/>
<text text-anchor="middle" x="3444.94" y="-368.08" font-family="Arial" font-size="10.00">PP Communication</text>
</g>
<!-- TP_Comm_PP1_DP7&#45;&gt;EP_Cluster_PP1_DP7 -->
<g id="edge51" class="edge">
<title>TP_Comm_PP1_DP7&#45;&gt;EP_Cluster_PP1_DP7</title>
<path fill="none" stroke="black" d="M3405.61,-491.86C3404.88,-479.07 3404.04,-464.39 3403.31,-451.53"/>
<polygon fill="black" stroke="black" points="3406.79,-451.04 3402.73,-441.25 3399.8,-451.43 3406.79,-451.04"/>
</g>
<!-- Gate_PP1_DP7 -->
<g id="node61" class="node">
<title>Gate_PP1_DP7</title>
<polygon fill="lightcoral" stroke="black" points="3310.08,-572.08 3138.84,-572.08 3094.79,-478.08 3266.03,-478.08 3310.08,-572.08"/>
<text text-anchor="middle" x="3202.44" y="-534.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="3202.44" y="-521.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="3202.44" y="-508.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP1_DP7&#45;&gt;EP_Cluster_PP1_DP7 -->
<g id="edge52" class="edge">
<title>Gate_PP1_DP7&#45;&gt;EP_Cluster_PP1_DP7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3270.64,-487.92C3296.58,-474.17 3325.68,-458.75 3349.84,-445.94"/>
<polygon fill="black" stroke="black" points="3351.64,-448.95 3358.83,-441.17 3348.36,-442.76 3351.64,-448.95"/>
</g>
<!-- TP_Comm_PP2_DP7 -->
<g id="node64" class="node">
<title>TP_Comm_PP2_DP7</title>
<ellipse fill="lightyellow" stroke="black" cx="3407.44" cy="-216.08" rx="79.39" ry="33.47"/>
<text text-anchor="middle" x="3407.44" y="-225.98" font-family="Arial" font-size="12.00">Tensor Parallel</text>
<text text-anchor="middle" x="3407.44" y="-212.98" font-family="Arial" font-size="12.00">4&#45;way All&#45;Reduce</text>
<text text-anchor="middle" x="3407.44" y="-199.98" font-family="Arial" font-size="12.00">Attention Heads</text>
</g>
<!-- GPU_Cluster_PP2_DP7&#45;&gt;TP_Comm_PP2_DP7 -->
<g id="edge53" class="edge">
<title>GPU_Cluster_PP2_DP7&#45;&gt;TP_Comm_PP2_DP7</title>
<path fill="none" stroke="black" d="M3405.08,-299.95C3405.41,-288.28 3405.83,-273.64 3406.22,-259.93"/>
<polygon fill="black" stroke="black" points="3409.73,-259.78 3406.51,-249.69 3402.73,-259.59 3409.73,-259.78"/>
</g>
<!-- EP_Cluster_PP2_DP7 -->
<g id="node63" class="node">
<title>EP_Cluster_PP2_DP7</title>
<polygon fill="lightgreen" stroke="black" points="3278.44,-132.08 3126.44,-132.08 3126.44,-85.08 3278.44,-85.08 3278.44,-132.08"/>
<text text-anchor="middle" x="3202.44" y="-118.48" font-family="Arial" font-size="12.00">Expert Parallel</text>
<text text-anchor="middle" x="3202.44" y="-105.48" font-family="Arial" font-size="12.00">16 Experts × 1 GPU each</text>
<text text-anchor="middle" x="3202.44" y="-92.48" font-family="Arial" font-size="12.00">MOE Computation</text>
</g>
<!-- EP_Cluster_PP2_DP7&#45;&gt;output -->
<g id="edge64" class="edge">
<title>EP_Cluster_PP2_DP7&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3126.42,-85.75C3111.92,-82.3 3096.79,-79.19 3082.44,-77.08 2862.59,-44.86 2189.92,-30.7 1941.72,-26.48"/>
<polygon fill="black" stroke="black" points="1941.7,-22.98 1931.64,-26.31 1941.58,-29.98 1941.7,-22.98"/>
</g>
<!-- TP_Comm_PP2_DP7&#45;&gt;EP_Cluster_PP2_DP7 -->
<g id="edge54" class="edge">
<title>TP_Comm_PP2_DP7&#45;&gt;EP_Cluster_PP2_DP7</title>
<path fill="none" stroke="black" d="M3359.07,-189.68C3346.21,-182.95 3332.31,-175.72 3319.44,-169.08 3298.8,-158.44 3276.06,-146.85 3256.15,-136.74"/>
<polygon fill="black" stroke="black" points="3257.72,-133.61 3247.22,-132.21 3254.56,-139.86 3257.72,-133.61"/>
</g>
<!-- Gate_PP2_DP7 -->
<g id="node65" class="node">
<title>Gate_PP2_DP7</title>
<polygon fill="lightcoral" stroke="black" points="3310.08,-263.08 3138.84,-263.08 3094.79,-169.08 3266.03,-169.08 3310.08,-263.08"/>
<text text-anchor="middle" x="3202.44" y="-225.98" font-family="Arial" font-size="12.00">MOE Gate</text>
<text text-anchor="middle" x="3202.44" y="-212.98" font-family="Arial" font-size="12.00">Expert Selection</text>
<text text-anchor="middle" x="3202.44" y="-199.98" font-family="Arial" font-size="12.00">Top&#45;2 Routing</text>
</g>
<!-- Gate_PP2_DP7&#45;&gt;EP_Cluster_PP2_DP7 -->
<g id="edge55" class="edge">
<title>Gate_PP2_DP7&#45;&gt;EP_Cluster_PP2_DP7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3202.44,-168.81C3202.44,-159.86 3202.44,-150.65 3202.44,-142.24"/>
<polygon fill="black" stroke="black" points="3205.94,-142.1 3202.44,-132.1 3198.94,-142.1 3205.94,-142.1"/>
</g>
</g>
</svg>
