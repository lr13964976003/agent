// Parallel Strategy Deployment DAG
digraph {
	dpi=300 rankdir=TB size="100,100"
	node [fontname=Arial fontsize=10]
	node [fillcolor=lightblue shape=ellipse style=filled]
	node [fillcolor=lightgreen shape=rectangle style=filled]
	node [fillcolor=lightyellow shape=parallelogram style=filled]
	subgraph cluster_input {
		fillcolor=lightgray label="Input Layer" style=filled
		input [label="Input\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=32]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_stage_0 {
		fillcolor=lightcyan label="Pipeline Stage 0 (Layer 0)" style=filled
		mha_0 [label="MHA Layer 0\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_0 [label="Gate Layer 0\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_0_0 [label="Expert 0 Layer 0\nGPU: 0\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_1 [label="Expert 1 Layer 0\nGPU: 1\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_2 [label="Expert 2 Layer 0\nGPU: 2\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_3 [label="Expert 3 Layer 0\nGPU: 3\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_4 [label="Expert 4 Layer 0\nGPU: 4\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_5 [label="Expert 5 Layer 0\nGPU: 5\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_6 [label="Expert 6 Layer 0\nGPU: 6\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_7 [label="Expert 7 Layer 0\nGPU: 7\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_8 [label="Expert 8 Layer 0\nGPU: 8\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_9 [label="Expert 9 Layer 0\nGPU: 9\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_10 [label="Expert 10 Layer 0\nGPU: 10\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_11 [label="Expert 11 Layer 0\nGPU: 11\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_12 [label="Expert 12 Layer 0\nGPU: 12\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_13 [label="Expert 13 Layer 0\nGPU: 13\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_14 [label="Expert 14 Layer 0\nGPU: 14\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_0_15 [label="Expert 15 Layer 0\nGPU: 15\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_0_0 [label="Route to Expert 0\nGPU: 0\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_1 [label="Route to Expert 1\nGPU: 1\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_2 [label="Route to Expert 2\nGPU: 2\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_3 [label="Route to Expert 3\nGPU: 3\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_4 [label="Route to Expert 4\nGPU: 4\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_5 [label="Route to Expert 5\nGPU: 5\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_6 [label="Route to Expert 6\nGPU: 6\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_7 [label="Route to Expert 7\nGPU: 7\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_8 [label="Route to Expert 8\nGPU: 8\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_9 [label="Route to Expert 9\nGPU: 9\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_10 [label="Route to Expert 10\nGPU: 10\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_11 [label="Route to Expert 11\nGPU: 11\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_12 [label="Route to Expert 12\nGPU: 12\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_13 [label="Route to Expert 13\nGPU: 13\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_14 [label="Route to Expert 14\nGPU: 14\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_0_15 [label="Route to Expert 15\nGPU: 15\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_0 [label="Aggregate Experts Layer 0\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_1 {
		fillcolor=lightcyan label="Pipeline Stage 1 (Layer 1)" style=filled
		mha_1 [label="MHA Layer 1\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_1 [label="Gate Layer 1\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_1_0 [label="Expert 0 Layer 1\nGPU: 16\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_1 [label="Expert 1 Layer 1\nGPU: 17\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_2 [label="Expert 2 Layer 1\nGPU: 18\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_3 [label="Expert 3 Layer 1\nGPU: 19\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_4 [label="Expert 4 Layer 1\nGPU: 20\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_5 [label="Expert 5 Layer 1\nGPU: 21\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_6 [label="Expert 6 Layer 1\nGPU: 22\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_7 [label="Expert 7 Layer 1\nGPU: 23\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_8 [label="Expert 8 Layer 1\nGPU: 24\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_9 [label="Expert 9 Layer 1\nGPU: 25\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_10 [label="Expert 10 Layer 1\nGPU: 26\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_11 [label="Expert 11 Layer 1\nGPU: 27\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_12 [label="Expert 12 Layer 1\nGPU: 28\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_13 [label="Expert 13 Layer 1\nGPU: 29\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_14 [label="Expert 14 Layer 1\nGPU: 30\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_1_15 [label="Expert 15 Layer 1\nGPU: 31\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_1_0 [label="Route to Expert 0\nGPU: 16\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_1 [label="Route to Expert 1\nGPU: 17\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_2 [label="Route to Expert 2\nGPU: 18\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_3 [label="Route to Expert 3\nGPU: 19\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_4 [label="Route to Expert 4\nGPU: 20\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_5 [label="Route to Expert 5\nGPU: 21\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_6 [label="Route to Expert 6\nGPU: 22\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_7 [label="Route to Expert 7\nGPU: 23\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_8 [label="Route to Expert 8\nGPU: 24\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_9 [label="Route to Expert 9\nGPU: 25\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_10 [label="Route to Expert 10\nGPU: 26\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_11 [label="Route to Expert 11\nGPU: 27\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_12 [label="Route to Expert 12\nGPU: 28\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_13 [label="Route to Expert 13\nGPU: 29\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_14 [label="Route to Expert 14\nGPU: 30\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_1_15 [label="Route to Expert 15\nGPU: 31\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_1 [label="Aggregate Experts Layer 1\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_2 {
		fillcolor=lightcyan label="Pipeline Stage 2 (Layer 2)" style=filled
		mha_2 [label="MHA Layer 2\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_2 [label="Gate Layer 2\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_2_0 [label="Expert 0 Layer 2\nGPU: 32\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_1 [label="Expert 1 Layer 2\nGPU: 33\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_2 [label="Expert 2 Layer 2\nGPU: 34\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_3 [label="Expert 3 Layer 2\nGPU: 35\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_4 [label="Expert 4 Layer 2\nGPU: 36\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_5 [label="Expert 5 Layer 2\nGPU: 37\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_6 [label="Expert 6 Layer 2\nGPU: 38\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_7 [label="Expert 7 Layer 2\nGPU: 39\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_8 [label="Expert 8 Layer 2\nGPU: 40\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_9 [label="Expert 9 Layer 2\nGPU: 41\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_10 [label="Expert 10 Layer 2\nGPU: 42\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_11 [label="Expert 11 Layer 2\nGPU: 43\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_12 [label="Expert 12 Layer 2\nGPU: 44\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_13 [label="Expert 13 Layer 2\nGPU: 45\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_14 [label="Expert 14 Layer 2\nGPU: 46\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_2_15 [label="Expert 15 Layer 2\nGPU: 47\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_2_0 [label="Route to Expert 0\nGPU: 32\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_1 [label="Route to Expert 1\nGPU: 33\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_2 [label="Route to Expert 2\nGPU: 34\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_3 [label="Route to Expert 3\nGPU: 35\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_4 [label="Route to Expert 4\nGPU: 36\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_5 [label="Route to Expert 5\nGPU: 37\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_6 [label="Route to Expert 6\nGPU: 38\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_7 [label="Route to Expert 7\nGPU: 39\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_8 [label="Route to Expert 8\nGPU: 40\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_9 [label="Route to Expert 9\nGPU: 41\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_10 [label="Route to Expert 10\nGPU: 42\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_11 [label="Route to Expert 11\nGPU: 43\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_12 [label="Route to Expert 12\nGPU: 44\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_13 [label="Route to Expert 13\nGPU: 45\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_14 [label="Route to Expert 14\nGPU: 46\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_2_15 [label="Route to Expert 15\nGPU: 47\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_2 [label="Aggregate Experts Layer 2\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_3 {
		fillcolor=lightcyan label="Pipeline Stage 3 (Layer 3)" style=filled
		mha_3 [label="MHA Layer 3\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_3 [label="Gate Layer 3\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_3_0 [label="Expert 0 Layer 3\nGPU: 48\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_1 [label="Expert 1 Layer 3\nGPU: 49\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_2 [label="Expert 2 Layer 3\nGPU: 50\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_3 [label="Expert 3 Layer 3\nGPU: 51\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_4 [label="Expert 4 Layer 3\nGPU: 52\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_5 [label="Expert 5 Layer 3\nGPU: 53\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_6 [label="Expert 6 Layer 3\nGPU: 54\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_7 [label="Expert 7 Layer 3\nGPU: 55\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_8 [label="Expert 8 Layer 3\nGPU: 56\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_9 [label="Expert 9 Layer 3\nGPU: 57\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_10 [label="Expert 10 Layer 3\nGPU: 58\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_11 [label="Expert 11 Layer 3\nGPU: 59\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_12 [label="Expert 12 Layer 3\nGPU: 60\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_13 [label="Expert 13 Layer 3\nGPU: 61\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_14 [label="Expert 14 Layer 3\nGPU: 62\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_3_15 [label="Expert 15 Layer 3\nGPU: 63\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_3_0 [label="Route to Expert 0\nGPU: 48\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_1 [label="Route to Expert 1\nGPU: 49\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_2 [label="Route to Expert 2\nGPU: 50\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_3 [label="Route to Expert 3\nGPU: 51\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_4 [label="Route to Expert 4\nGPU: 52\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_5 [label="Route to Expert 5\nGPU: 53\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_6 [label="Route to Expert 6\nGPU: 54\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_7 [label="Route to Expert 7\nGPU: 55\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_8 [label="Route to Expert 8\nGPU: 56\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_9 [label="Route to Expert 9\nGPU: 57\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_10 [label="Route to Expert 10\nGPU: 58\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_11 [label="Route to Expert 11\nGPU: 59\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_12 [label="Route to Expert 12\nGPU: 60\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_13 [label="Route to Expert 13\nGPU: 61\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_14 [label="Route to Expert 14\nGPU: 62\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_3_15 [label="Route to Expert 15\nGPU: 63\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_3 [label="Aggregate Experts Layer 3\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_4 {
		fillcolor=lightcyan label="Pipeline Stage 4 (Layer 4)" style=filled
		mha_4 [label="MHA Layer 4\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_4 [label="Gate Layer 4\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_4_0 [label="Expert 0 Layer 4\nGPU: 64\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_1 [label="Expert 1 Layer 4\nGPU: 65\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_2 [label="Expert 2 Layer 4\nGPU: 66\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_3 [label="Expert 3 Layer 4\nGPU: 67\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_4 [label="Expert 4 Layer 4\nGPU: 68\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_5 [label="Expert 5 Layer 4\nGPU: 69\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_6 [label="Expert 6 Layer 4\nGPU: 70\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_7 [label="Expert 7 Layer 4\nGPU: 71\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_8 [label="Expert 8 Layer 4\nGPU: 72\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_9 [label="Expert 9 Layer 4\nGPU: 73\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_10 [label="Expert 10 Layer 4\nGPU: 74\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_11 [label="Expert 11 Layer 4\nGPU: 75\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_12 [label="Expert 12 Layer 4\nGPU: 76\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_13 [label="Expert 13 Layer 4\nGPU: 77\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_14 [label="Expert 14 Layer 4\nGPU: 78\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_4_15 [label="Expert 15 Layer 4\nGPU: 79\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_4_0 [label="Route to Expert 0\nGPU: 64\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_1 [label="Route to Expert 1\nGPU: 65\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_2 [label="Route to Expert 2\nGPU: 66\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_3 [label="Route to Expert 3\nGPU: 67\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_4 [label="Route to Expert 4\nGPU: 68\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_5 [label="Route to Expert 5\nGPU: 69\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_6 [label="Route to Expert 6\nGPU: 70\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_7 [label="Route to Expert 7\nGPU: 71\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_8 [label="Route to Expert 8\nGPU: 72\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_9 [label="Route to Expert 9\nGPU: 73\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_10 [label="Route to Expert 10\nGPU: 74\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_11 [label="Route to Expert 11\nGPU: 75\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_12 [label="Route to Expert 12\nGPU: 76\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_13 [label="Route to Expert 13\nGPU: 77\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_14 [label="Route to Expert 14\nGPU: 78\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_4_15 [label="Route to Expert 15\nGPU: 79\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_4 [label="Aggregate Experts Layer 4\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_5 {
		fillcolor=lightcyan label="Pipeline Stage 5 (Layer 5)" style=filled
		mha_5 [label="MHA Layer 5\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_5 [label="Gate Layer 5\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_5_0 [label="Expert 0 Layer 5\nGPU: 80\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_1 [label="Expert 1 Layer 5\nGPU: 81\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_2 [label="Expert 2 Layer 5\nGPU: 82\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_3 [label="Expert 3 Layer 5\nGPU: 83\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_4 [label="Expert 4 Layer 5\nGPU: 84\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_5 [label="Expert 5 Layer 5\nGPU: 85\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_6 [label="Expert 6 Layer 5\nGPU: 86\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_7 [label="Expert 7 Layer 5\nGPU: 87\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_8 [label="Expert 8 Layer 5\nGPU: 88\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_9 [label="Expert 9 Layer 5\nGPU: 89\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_10 [label="Expert 10 Layer 5\nGPU: 90\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_11 [label="Expert 11 Layer 5\nGPU: 91\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_12 [label="Expert 12 Layer 5\nGPU: 92\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_13 [label="Expert 13 Layer 5\nGPU: 93\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_14 [label="Expert 14 Layer 5\nGPU: 94\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_5_15 [label="Expert 15 Layer 5\nGPU: 95\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_5_0 [label="Route to Expert 0\nGPU: 80\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_1 [label="Route to Expert 1\nGPU: 81\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_2 [label="Route to Expert 2\nGPU: 82\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_3 [label="Route to Expert 3\nGPU: 83\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_4 [label="Route to Expert 4\nGPU: 84\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_5 [label="Route to Expert 5\nGPU: 85\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_6 [label="Route to Expert 6\nGPU: 86\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_7 [label="Route to Expert 7\nGPU: 87\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_8 [label="Route to Expert 8\nGPU: 88\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_9 [label="Route to Expert 9\nGPU: 89\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_10 [label="Route to Expert 10\nGPU: 90\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_11 [label="Route to Expert 11\nGPU: 91\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_12 [label="Route to Expert 12\nGPU: 92\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_13 [label="Route to Expert 13\nGPU: 93\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_14 [label="Route to Expert 14\nGPU: 94\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_5_15 [label="Route to Expert 15\nGPU: 95\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_5 [label="Aggregate Experts Layer 5\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_6 {
		fillcolor=lightcyan label="Pipeline Stage 6 (Layer 6)" style=filled
		mha_6 [label="MHA Layer 6\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_6 [label="Gate Layer 6\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_6_0 [label="Expert 0 Layer 6\nGPU: 96\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_1 [label="Expert 1 Layer 6\nGPU: 97\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_2 [label="Expert 2 Layer 6\nGPU: 98\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_3 [label="Expert 3 Layer 6\nGPU: 99\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_4 [label="Expert 4 Layer 6\nGPU: 100\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_5 [label="Expert 5 Layer 6\nGPU: 101\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_6 [label="Expert 6 Layer 6\nGPU: 102\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_7 [label="Expert 7 Layer 6\nGPU: 103\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_8 [label="Expert 8 Layer 6\nGPU: 104\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_9 [label="Expert 9 Layer 6\nGPU: 105\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_10 [label="Expert 10 Layer 6\nGPU: 106\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_11 [label="Expert 11 Layer 6\nGPU: 107\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_12 [label="Expert 12 Layer 6\nGPU: 108\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_13 [label="Expert 13 Layer 6\nGPU: 109\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_14 [label="Expert 14 Layer 6\nGPU: 110\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_6_15 [label="Expert 15 Layer 6\nGPU: 111\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_6_0 [label="Route to Expert 0\nGPU: 96\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_1 [label="Route to Expert 1\nGPU: 97\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_2 [label="Route to Expert 2\nGPU: 98\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_3 [label="Route to Expert 3\nGPU: 99\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_4 [label="Route to Expert 4\nGPU: 100\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_5 [label="Route to Expert 5\nGPU: 101\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_6 [label="Route to Expert 6\nGPU: 102\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_7 [label="Route to Expert 7\nGPU: 103\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_8 [label="Route to Expert 8\nGPU: 104\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_9 [label="Route to Expert 9\nGPU: 105\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_10 [label="Route to Expert 10\nGPU: 106\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_11 [label="Route to Expert 11\nGPU: 107\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_12 [label="Route to Expert 12\nGPU: 108\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_13 [label="Route to Expert 13\nGPU: 109\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_14 [label="Route to Expert 14\nGPU: 110\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_6_15 [label="Route to Expert 15\nGPU: 111\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_6 [label="Aggregate Experts Layer 6\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_7 {
		fillcolor=lightcyan label="Pipeline Stage 7 (Layer 7)" style=filled
		mha_7 [label="MHA Layer 7\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_7 [label="Gate Layer 7\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_7_0 [label="Expert 0 Layer 7\nGPU: 112\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_1 [label="Expert 1 Layer 7\nGPU: 113\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_2 [label="Expert 2 Layer 7\nGPU: 114\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_3 [label="Expert 3 Layer 7\nGPU: 115\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_4 [label="Expert 4 Layer 7\nGPU: 116\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_5 [label="Expert 5 Layer 7\nGPU: 117\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_6 [label="Expert 6 Layer 7\nGPU: 118\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_7 [label="Expert 7 Layer 7\nGPU: 119\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_8 [label="Expert 8 Layer 7\nGPU: 120\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_9 [label="Expert 9 Layer 7\nGPU: 121\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_10 [label="Expert 10 Layer 7\nGPU: 122\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_11 [label="Expert 11 Layer 7\nGPU: 123\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_12 [label="Expert 12 Layer 7\nGPU: 124\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_13 [label="Expert 13 Layer 7\nGPU: 125\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_14 [label="Expert 14 Layer 7\nGPU: 126\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_7_15 [label="Expert 15 Layer 7\nGPU: 127\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_7_0 [label="Route to Expert 0\nGPU: 112\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_1 [label="Route to Expert 1\nGPU: 113\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_2 [label="Route to Expert 2\nGPU: 114\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_3 [label="Route to Expert 3\nGPU: 115\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_4 [label="Route to Expert 4\nGPU: 116\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_5 [label="Route to Expert 5\nGPU: 117\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_6 [label="Route to Expert 6\nGPU: 118\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_7 [label="Route to Expert 7\nGPU: 119\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_8 [label="Route to Expert 8\nGPU: 120\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_9 [label="Route to Expert 9\nGPU: 121\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_10 [label="Route to Expert 10\nGPU: 122\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_11 [label="Route to Expert 11\nGPU: 123\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_12 [label="Route to Expert 12\nGPU: 124\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_13 [label="Route to Expert 13\nGPU: 125\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_14 [label="Route to Expert 14\nGPU: 126\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_7_15 [label="Route to Expert 15\nGPU: 127\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_7 [label="Aggregate Experts Layer 7\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_8 {
		fillcolor=lightcyan label="Pipeline Stage 8 (Layer 8)" style=filled
		mha_8 [label="MHA Layer 8\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_8 [label="Gate Layer 8\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_8_0 [label="Expert 0 Layer 8\nGPU: 128\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_1 [label="Expert 1 Layer 8\nGPU: 129\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_2 [label="Expert 2 Layer 8\nGPU: 130\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_3 [label="Expert 3 Layer 8\nGPU: 131\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_4 [label="Expert 4 Layer 8\nGPU: 132\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_5 [label="Expert 5 Layer 8\nGPU: 133\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_6 [label="Expert 6 Layer 8\nGPU: 134\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_7 [label="Expert 7 Layer 8\nGPU: 135\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_8 [label="Expert 8 Layer 8\nGPU: 136\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_9 [label="Expert 9 Layer 8\nGPU: 137\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_10 [label="Expert 10 Layer 8\nGPU: 138\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_11 [label="Expert 11 Layer 8\nGPU: 139\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_12 [label="Expert 12 Layer 8\nGPU: 140\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_13 [label="Expert 13 Layer 8\nGPU: 141\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_14 [label="Expert 14 Layer 8\nGPU: 142\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_8_15 [label="Expert 15 Layer 8\nGPU: 143\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_8_0 [label="Route to Expert 0\nGPU: 128\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_1 [label="Route to Expert 1\nGPU: 129\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_2 [label="Route to Expert 2\nGPU: 130\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_3 [label="Route to Expert 3\nGPU: 131\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_4 [label="Route to Expert 4\nGPU: 132\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_5 [label="Route to Expert 5\nGPU: 133\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_6 [label="Route to Expert 6\nGPU: 134\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_7 [label="Route to Expert 7\nGPU: 135\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_8 [label="Route to Expert 8\nGPU: 136\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_9 [label="Route to Expert 9\nGPU: 137\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_10 [label="Route to Expert 10\nGPU: 138\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_11 [label="Route to Expert 11\nGPU: 139\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_12 [label="Route to Expert 12\nGPU: 140\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_13 [label="Route to Expert 13\nGPU: 141\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_14 [label="Route to Expert 14\nGPU: 142\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_8_15 [label="Route to Expert 15\nGPU: 143\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_8 [label="Aggregate Experts Layer 8\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_9 {
		fillcolor=lightcyan label="Pipeline Stage 9 (Layer 9)" style=filled
		mha_9 [label="MHA Layer 9\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_9 [label="Gate Layer 9\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_9_0 [label="Expert 0 Layer 9\nGPU: 144\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_1 [label="Expert 1 Layer 9\nGPU: 145\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_2 [label="Expert 2 Layer 9\nGPU: 146\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_3 [label="Expert 3 Layer 9\nGPU: 147\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_4 [label="Expert 4 Layer 9\nGPU: 148\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_5 [label="Expert 5 Layer 9\nGPU: 149\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_6 [label="Expert 6 Layer 9\nGPU: 150\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_7 [label="Expert 7 Layer 9\nGPU: 151\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_8 [label="Expert 8 Layer 9\nGPU: 152\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_9 [label="Expert 9 Layer 9\nGPU: 153\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_10 [label="Expert 10 Layer 9\nGPU: 154\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_11 [label="Expert 11 Layer 9\nGPU: 155\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_12 [label="Expert 12 Layer 9\nGPU: 156\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_13 [label="Expert 13 Layer 9\nGPU: 157\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_14 [label="Expert 14 Layer 9\nGPU: 158\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_9_15 [label="Expert 15 Layer 9\nGPU: 159\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_9_0 [label="Route to Expert 0\nGPU: 144\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_1 [label="Route to Expert 1\nGPU: 145\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_2 [label="Route to Expert 2\nGPU: 146\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_3 [label="Route to Expert 3\nGPU: 147\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_4 [label="Route to Expert 4\nGPU: 148\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_5 [label="Route to Expert 5\nGPU: 149\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_6 [label="Route to Expert 6\nGPU: 150\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_7 [label="Route to Expert 7\nGPU: 151\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_8 [label="Route to Expert 8\nGPU: 152\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_9 [label="Route to Expert 9\nGPU: 153\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_10 [label="Route to Expert 10\nGPU: 154\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_11 [label="Route to Expert 11\nGPU: 155\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_12 [label="Route to Expert 12\nGPU: 156\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_13 [label="Route to Expert 13\nGPU: 157\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_14 [label="Route to Expert 14\nGPU: 158\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_9_15 [label="Route to Expert 15\nGPU: 159\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_9 [label="Aggregate Experts Layer 9\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_10 {
		fillcolor=lightcyan label="Pipeline Stage 10 (Layer 10)" style=filled
		mha_10 [label="MHA Layer 10\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_10 [label="Gate Layer 10\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_10_0 [label="Expert 0 Layer 10\nGPU: 160\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_1 [label="Expert 1 Layer 10\nGPU: 161\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_2 [label="Expert 2 Layer 10\nGPU: 162\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_3 [label="Expert 3 Layer 10\nGPU: 163\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_4 [label="Expert 4 Layer 10\nGPU: 164\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_5 [label="Expert 5 Layer 10\nGPU: 165\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_6 [label="Expert 6 Layer 10\nGPU: 166\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_7 [label="Expert 7 Layer 10\nGPU: 167\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_8 [label="Expert 8 Layer 10\nGPU: 168\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_9 [label="Expert 9 Layer 10\nGPU: 169\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_10 [label="Expert 10 Layer 10\nGPU: 170\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_11 [label="Expert 11 Layer 10\nGPU: 171\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_12 [label="Expert 12 Layer 10\nGPU: 172\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_13 [label="Expert 13 Layer 10\nGPU: 173\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_14 [label="Expert 14 Layer 10\nGPU: 174\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_10_15 [label="Expert 15 Layer 10\nGPU: 175\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_10_0 [label="Route to Expert 0\nGPU: 160\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_1 [label="Route to Expert 1\nGPU: 161\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_2 [label="Route to Expert 2\nGPU: 162\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_3 [label="Route to Expert 3\nGPU: 163\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_4 [label="Route to Expert 4\nGPU: 164\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_5 [label="Route to Expert 5\nGPU: 165\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_6 [label="Route to Expert 6\nGPU: 166\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_7 [label="Route to Expert 7\nGPU: 167\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_8 [label="Route to Expert 8\nGPU: 168\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_9 [label="Route to Expert 9\nGPU: 169\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_10 [label="Route to Expert 10\nGPU: 170\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_11 [label="Route to Expert 11\nGPU: 171\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_12 [label="Route to Expert 12\nGPU: 172\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_13 [label="Route to Expert 13\nGPU: 173\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_14 [label="Route to Expert 14\nGPU: 174\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_10_15 [label="Route to Expert 15\nGPU: 175\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_10 [label="Aggregate Experts Layer 10\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_11 {
		fillcolor=lightcyan label="Pipeline Stage 11 (Layer 11)" style=filled
		mha_11 [label="MHA Layer 11\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_11 [label="Gate Layer 11\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_11_0 [label="Expert 0 Layer 11\nGPU: 176\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_1 [label="Expert 1 Layer 11\nGPU: 177\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_2 [label="Expert 2 Layer 11\nGPU: 178\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_3 [label="Expert 3 Layer 11\nGPU: 179\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_4 [label="Expert 4 Layer 11\nGPU: 180\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_5 [label="Expert 5 Layer 11\nGPU: 181\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_6 [label="Expert 6 Layer 11\nGPU: 182\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_7 [label="Expert 7 Layer 11\nGPU: 183\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_8 [label="Expert 8 Layer 11\nGPU: 184\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_9 [label="Expert 9 Layer 11\nGPU: 185\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_10 [label="Expert 10 Layer 11\nGPU: 186\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_11 [label="Expert 11 Layer 11\nGPU: 187\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_12 [label="Expert 12 Layer 11\nGPU: 188\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_13 [label="Expert 13 Layer 11\nGPU: 189\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_14 [label="Expert 14 Layer 11\nGPU: 190\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_11_15 [label="Expert 15 Layer 11\nGPU: 191\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_11_0 [label="Route to Expert 0\nGPU: 176\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_1 [label="Route to Expert 1\nGPU: 177\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_2 [label="Route to Expert 2\nGPU: 178\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_3 [label="Route to Expert 3\nGPU: 179\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_4 [label="Route to Expert 4\nGPU: 180\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_5 [label="Route to Expert 5\nGPU: 181\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_6 [label="Route to Expert 6\nGPU: 182\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_7 [label="Route to Expert 7\nGPU: 183\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_8 [label="Route to Expert 8\nGPU: 184\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_9 [label="Route to Expert 9\nGPU: 185\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_10 [label="Route to Expert 10\nGPU: 186\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_11 [label="Route to Expert 11\nGPU: 187\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_12 [label="Route to Expert 12\nGPU: 188\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_13 [label="Route to Expert 13\nGPU: 189\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_14 [label="Route to Expert 14\nGPU: 190\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_11_15 [label="Route to Expert 15\nGPU: 191\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_11 [label="Aggregate Experts Layer 11\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_12 {
		fillcolor=lightcyan label="Pipeline Stage 12 (Layer 12)" style=filled
		mha_12 [label="MHA Layer 12\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_12 [label="Gate Layer 12\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_12_0 [label="Expert 0 Layer 12\nGPU: 192\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_1 [label="Expert 1 Layer 12\nGPU: 193\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_2 [label="Expert 2 Layer 12\nGPU: 194\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_3 [label="Expert 3 Layer 12\nGPU: 195\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_4 [label="Expert 4 Layer 12\nGPU: 196\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_5 [label="Expert 5 Layer 12\nGPU: 197\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_6 [label="Expert 6 Layer 12\nGPU: 198\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_7 [label="Expert 7 Layer 12\nGPU: 199\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_8 [label="Expert 8 Layer 12\nGPU: 200\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_9 [label="Expert 9 Layer 12\nGPU: 201\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_10 [label="Expert 10 Layer 12\nGPU: 202\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_11 [label="Expert 11 Layer 12\nGPU: 203\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_12 [label="Expert 12 Layer 12\nGPU: 204\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_13 [label="Expert 13 Layer 12\nGPU: 205\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_14 [label="Expert 14 Layer 12\nGPU: 206\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_12_15 [label="Expert 15 Layer 12\nGPU: 207\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_12_0 [label="Route to Expert 0\nGPU: 192\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_1 [label="Route to Expert 1\nGPU: 193\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_2 [label="Route to Expert 2\nGPU: 194\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_3 [label="Route to Expert 3\nGPU: 195\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_4 [label="Route to Expert 4\nGPU: 196\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_5 [label="Route to Expert 5\nGPU: 197\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_6 [label="Route to Expert 6\nGPU: 198\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_7 [label="Route to Expert 7\nGPU: 199\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_8 [label="Route to Expert 8\nGPU: 200\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_9 [label="Route to Expert 9\nGPU: 201\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_10 [label="Route to Expert 10\nGPU: 202\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_11 [label="Route to Expert 11\nGPU: 203\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_12 [label="Route to Expert 12\nGPU: 204\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_13 [label="Route to Expert 13\nGPU: 205\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_14 [label="Route to Expert 14\nGPU: 206\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_12_15 [label="Route to Expert 15\nGPU: 207\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_12 [label="Aggregate Experts Layer 12\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_13 {
		fillcolor=lightcyan label="Pipeline Stage 13 (Layer 13)" style=filled
		mha_13 [label="MHA Layer 13\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_13 [label="Gate Layer 13\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_13_0 [label="Expert 0 Layer 13\nGPU: 208\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_1 [label="Expert 1 Layer 13\nGPU: 209\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_2 [label="Expert 2 Layer 13\nGPU: 210\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_3 [label="Expert 3 Layer 13\nGPU: 211\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_4 [label="Expert 4 Layer 13\nGPU: 212\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_5 [label="Expert 5 Layer 13\nGPU: 213\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_6 [label="Expert 6 Layer 13\nGPU: 214\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_7 [label="Expert 7 Layer 13\nGPU: 215\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_8 [label="Expert 8 Layer 13\nGPU: 216\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_9 [label="Expert 9 Layer 13\nGPU: 217\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_10 [label="Expert 10 Layer 13\nGPU: 218\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_11 [label="Expert 11 Layer 13\nGPU: 219\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_12 [label="Expert 12 Layer 13\nGPU: 220\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_13 [label="Expert 13 Layer 13\nGPU: 221\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_14 [label="Expert 14 Layer 13\nGPU: 222\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_13_15 [label="Expert 15 Layer 13\nGPU: 223\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_13_0 [label="Route to Expert 0\nGPU: 208\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_1 [label="Route to Expert 1\nGPU: 209\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_2 [label="Route to Expert 2\nGPU: 210\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_3 [label="Route to Expert 3\nGPU: 211\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_4 [label="Route to Expert 4\nGPU: 212\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_5 [label="Route to Expert 5\nGPU: 213\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_6 [label="Route to Expert 6\nGPU: 214\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_7 [label="Route to Expert 7\nGPU: 215\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_8 [label="Route to Expert 8\nGPU: 216\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_9 [label="Route to Expert 9\nGPU: 217\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_10 [label="Route to Expert 10\nGPU: 218\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_11 [label="Route to Expert 11\nGPU: 219\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_12 [label="Route to Expert 12\nGPU: 220\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_13 [label="Route to Expert 13\nGPU: 221\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_14 [label="Route to Expert 14\nGPU: 222\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_13_15 [label="Route to Expert 15\nGPU: 223\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_13 [label="Aggregate Experts Layer 13\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_14 {
		fillcolor=lightcyan label="Pipeline Stage 14 (Layer 14)" style=filled
		mha_14 [label="MHA Layer 14\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_14 [label="Gate Layer 14\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_14_0 [label="Expert 0 Layer 14\nGPU: 224\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_1 [label="Expert 1 Layer 14\nGPU: 225\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_2 [label="Expert 2 Layer 14\nGPU: 226\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_3 [label="Expert 3 Layer 14\nGPU: 227\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_4 [label="Expert 4 Layer 14\nGPU: 228\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_5 [label="Expert 5 Layer 14\nGPU: 229\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_6 [label="Expert 6 Layer 14\nGPU: 230\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_7 [label="Expert 7 Layer 14\nGPU: 231\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_8 [label="Expert 8 Layer 14\nGPU: 232\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_9 [label="Expert 9 Layer 14\nGPU: 233\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_10 [label="Expert 10 Layer 14\nGPU: 234\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_11 [label="Expert 11 Layer 14\nGPU: 235\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_12 [label="Expert 12 Layer 14\nGPU: 236\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_13 [label="Expert 13 Layer 14\nGPU: 237\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_14 [label="Expert 14 Layer 14\nGPU: 238\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_14_15 [label="Expert 15 Layer 14\nGPU: 239\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_14_0 [label="Route to Expert 0\nGPU: 224\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_1 [label="Route to Expert 1\nGPU: 225\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_2 [label="Route to Expert 2\nGPU: 226\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_3 [label="Route to Expert 3\nGPU: 227\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_4 [label="Route to Expert 4\nGPU: 228\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_5 [label="Route to Expert 5\nGPU: 229\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_6 [label="Route to Expert 6\nGPU: 230\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_7 [label="Route to Expert 7\nGPU: 231\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_8 [label="Route to Expert 8\nGPU: 232\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_9 [label="Route to Expert 9\nGPU: 233\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_10 [label="Route to Expert 10\nGPU: 234\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_11 [label="Route to Expert 11\nGPU: 235\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_12 [label="Route to Expert 12\nGPU: 236\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_13 [label="Route to Expert 13\nGPU: 237\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_14 [label="Route to Expert 14\nGPU: 238\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_14_15 [label="Route to Expert 15\nGPU: 239\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_14 [label="Aggregate Experts Layer 14\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_stage_15 {
		fillcolor=lightcyan label="Pipeline Stage 15 (Layer 15)" style=filled
		mha_15 [label="MHA Layer 15\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=32]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		gate_15 [label="Gate Layer 15\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, top_k=2, experts=16]" fillcolor=lightyellow shape=parallelogram]
		expert_15_0 [label="Expert 0 Layer 15\nGPU: 240\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_1 [label="Expert 1 Layer 15\nGPU: 241\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_2 [label="Expert 2 Layer 15\nGPU: 242\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_3 [label="Expert 3 Layer 15\nGPU: 243\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_4 [label="Expert 4 Layer 15\nGPU: 244\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_5 [label="Expert 5 Layer 15\nGPU: 245\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_6 [label="Expert 6 Layer 15\nGPU: 246\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_7 [label="Expert 7 Layer 15\nGPU: 247\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_8 [label="Expert 8 Layer 15\nGPU: 248\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_9 [label="Expert 9 Layer 15\nGPU: 249\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_10 [label="Expert 10 Layer 15\nGPU: 250\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_11 [label="Expert 11 Layer 15\nGPU: 251\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_12 [label="Expert 12 Layer 15\nGPU: 252\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_13 [label="Expert 13 Layer 15\nGPU: 253\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_14 [label="Expert 14 Layer 15\nGPU: 254\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		expert_15_15 [label="Expert 15 Layer 15\nGPU: 255\nInput: [batch_size=?, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=?, seq_len=?, heads=16, d_k=512]" fillcolor=lightgreen shape=rectangle]
		comm_15_0 [label="Route to Expert 0\nGPU: 240\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_1 [label="Route to Expert 1\nGPU: 241\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_2 [label="Route to Expert 2\nGPU: 242\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_3 [label="Route to Expert 3\nGPU: 243\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_4 [label="Route to Expert 4\nGPU: 244\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_5 [label="Route to Expert 5\nGPU: 245\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_6 [label="Route to Expert 6\nGPU: 246\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_7 [label="Route to Expert 7\nGPU: 247\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_8 [label="Route to Expert 8\nGPU: 248\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_9 [label="Route to Expert 9\nGPU: 249\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_10 [label="Route to Expert 10\nGPU: 250\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_11 [label="Route to Expert 11\nGPU: 251\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_12 [label="Route to Expert 12\nGPU: 252\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_13 [label="Route to Expert 13\nGPU: 253\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_14 [label="Route to Expert 14\nGPU: 254\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		comm_15_15 [label="Route to Expert 15\nGPU: 255\nInput: [batch_size=?, seq_len=?, top_k=2]\nOutput: [batch_size=?, seq_len=?, tokens_selected=?]" fillcolor=lightblue shape=ellipse]
		agg_15 [label="Aggregate Experts Layer 15\nGPU: All GPUs\nInput: [batch_size=128, seq_len=?, experts=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, heads=16, d_k=512]" fillcolor=lightyellow shape=parallelogram]
	}
	subgraph cluster_output {
		fillcolor=lightgray label="Output Layer" style=filled
		output [label="Output\nInput: [batch_size=128, seq_len=?, heads=16, d_k=512]\nOutput: [batch_size=128, seq_len=?, vocab_size=?]" fillcolor=lightgreen shape=rectangle]
	}
	input -> mha_0
	mha_0 -> gate_0
	gate_0 -> comm_0_0 [color=red style=dashed]
	gate_0 -> comm_0_1 [color=red style=dashed]
	gate_0 -> comm_0_2 [color=red style=dashed]
	gate_0 -> comm_0_3 [color=red style=dashed]
	gate_0 -> comm_0_4 [color=red style=dashed]
	gate_0 -> comm_0_5 [color=red style=dashed]
	gate_0 -> comm_0_6 [color=red style=dashed]
	gate_0 -> comm_0_7 [color=red style=dashed]
	gate_0 -> comm_0_8 [color=red style=dashed]
	gate_0 -> comm_0_9 [color=red style=dashed]
	gate_0 -> comm_0_10 [color=red style=dashed]
	gate_0 -> comm_0_11 [color=red style=dashed]
	gate_0 -> comm_0_12 [color=red style=dashed]
	gate_0 -> comm_0_13 [color=red style=dashed]
	gate_0 -> comm_0_14 [color=red style=dashed]
	gate_0 -> comm_0_15 [color=red style=dashed]
	comm_0_0 -> expert_0_0
	comm_0_1 -> expert_0_1
	comm_0_2 -> expert_0_2
	comm_0_3 -> expert_0_3
	comm_0_4 -> expert_0_4
	comm_0_5 -> expert_0_5
	comm_0_6 -> expert_0_6
	comm_0_7 -> expert_0_7
	comm_0_8 -> expert_0_8
	comm_0_9 -> expert_0_9
	comm_0_10 -> expert_0_10
	comm_0_11 -> expert_0_11
	comm_0_12 -> expert_0_12
	comm_0_13 -> expert_0_13
	comm_0_14 -> expert_0_14
	comm_0_15 -> expert_0_15
	expert_0_0 -> agg_0
	expert_0_1 -> agg_0
	expert_0_2 -> agg_0
	expert_0_3 -> agg_0
	expert_0_4 -> agg_0
	expert_0_5 -> agg_0
	expert_0_6 -> agg_0
	expert_0_7 -> agg_0
	expert_0_8 -> agg_0
	expert_0_9 -> agg_0
	expert_0_10 -> agg_0
	expert_0_11 -> agg_0
	expert_0_12 -> agg_0
	expert_0_13 -> agg_0
	expert_0_14 -> agg_0
	expert_0_15 -> agg_0
	mha_1 -> gate_1
	gate_1 -> comm_1_0 [color=red style=dashed]
	gate_1 -> comm_1_1 [color=red style=dashed]
	gate_1 -> comm_1_2 [color=red style=dashed]
	gate_1 -> comm_1_3 [color=red style=dashed]
	gate_1 -> comm_1_4 [color=red style=dashed]
	gate_1 -> comm_1_5 [color=red style=dashed]
	gate_1 -> comm_1_6 [color=red style=dashed]
	gate_1 -> comm_1_7 [color=red style=dashed]
	gate_1 -> comm_1_8 [color=red style=dashed]
	gate_1 -> comm_1_9 [color=red style=dashed]
	gate_1 -> comm_1_10 [color=red style=dashed]
	gate_1 -> comm_1_11 [color=red style=dashed]
	gate_1 -> comm_1_12 [color=red style=dashed]
	gate_1 -> comm_1_13 [color=red style=dashed]
	gate_1 -> comm_1_14 [color=red style=dashed]
	gate_1 -> comm_1_15 [color=red style=dashed]
	comm_1_0 -> expert_1_0
	comm_1_1 -> expert_1_1
	comm_1_2 -> expert_1_2
	comm_1_3 -> expert_1_3
	comm_1_4 -> expert_1_4
	comm_1_5 -> expert_1_5
	comm_1_6 -> expert_1_6
	comm_1_7 -> expert_1_7
	comm_1_8 -> expert_1_8
	comm_1_9 -> expert_1_9
	comm_1_10 -> expert_1_10
	comm_1_11 -> expert_1_11
	comm_1_12 -> expert_1_12
	comm_1_13 -> expert_1_13
	comm_1_14 -> expert_1_14
	comm_1_15 -> expert_1_15
	expert_1_0 -> agg_1
	expert_1_1 -> agg_1
	expert_1_2 -> agg_1
	expert_1_3 -> agg_1
	expert_1_4 -> agg_1
	expert_1_5 -> agg_1
	expert_1_6 -> agg_1
	expert_1_7 -> agg_1
	expert_1_8 -> agg_1
	expert_1_9 -> agg_1
	expert_1_10 -> agg_1
	expert_1_11 -> agg_1
	expert_1_12 -> agg_1
	expert_1_13 -> agg_1
	expert_1_14 -> agg_1
	expert_1_15 -> agg_1
	mha_2 -> gate_2
	gate_2 -> comm_2_0 [color=red style=dashed]
	gate_2 -> comm_2_1 [color=red style=dashed]
	gate_2 -> comm_2_2 [color=red style=dashed]
	gate_2 -> comm_2_3 [color=red style=dashed]
	gate_2 -> comm_2_4 [color=red style=dashed]
	gate_2 -> comm_2_5 [color=red style=dashed]
	gate_2 -> comm_2_6 [color=red style=dashed]
	gate_2 -> comm_2_7 [color=red style=dashed]
	gate_2 -> comm_2_8 [color=red style=dashed]
	gate_2 -> comm_2_9 [color=red style=dashed]
	gate_2 -> comm_2_10 [color=red style=dashed]
	gate_2 -> comm_2_11 [color=red style=dashed]
	gate_2 -> comm_2_12 [color=red style=dashed]
	gate_2 -> comm_2_13 [color=red style=dashed]
	gate_2 -> comm_2_14 [color=red style=dashed]
	gate_2 -> comm_2_15 [color=red style=dashed]
	comm_2_0 -> expert_2_0
	comm_2_1 -> expert_2_1
	comm_2_2 -> expert_2_2
	comm_2_3 -> expert_2_3
	comm_2_4 -> expert_2_4
	comm_2_5 -> expert_2_5
	comm_2_6 -> expert_2_6
	comm_2_7 -> expert_2_7
	comm_2_8 -> expert_2_8
	comm_2_9 -> expert_2_9
	comm_2_10 -> expert_2_10
	comm_2_11 -> expert_2_11
	comm_2_12 -> expert_2_12
	comm_2_13 -> expert_2_13
	comm_2_14 -> expert_2_14
	comm_2_15 -> expert_2_15
	expert_2_0 -> agg_2
	expert_2_1 -> agg_2
	expert_2_2 -> agg_2
	expert_2_3 -> agg_2
	expert_2_4 -> agg_2
	expert_2_5 -> agg_2
	expert_2_6 -> agg_2
	expert_2_7 -> agg_2
	expert_2_8 -> agg_2
	expert_2_9 -> agg_2
	expert_2_10 -> agg_2
	expert_2_11 -> agg_2
	expert_2_12 -> agg_2
	expert_2_13 -> agg_2
	expert_2_14 -> agg_2
	expert_2_15 -> agg_2
	mha_3 -> gate_3
	gate_3 -> comm_3_0 [color=red style=dashed]
	gate_3 -> comm_3_1 [color=red style=dashed]
	gate_3 -> comm_3_2 [color=red style=dashed]
	gate_3 -> comm_3_3 [color=red style=dashed]
	gate_3 -> comm_3_4 [color=red style=dashed]
	gate_3 -> comm_3_5 [color=red style=dashed]
	gate_3 -> comm_3_6 [color=red style=dashed]
	gate_3 -> comm_3_7 [color=red style=dashed]
	gate_3 -> comm_3_8 [color=red style=dashed]
	gate_3 -> comm_3_9 [color=red style=dashed]
	gate_3 -> comm_3_10 [color=red style=dashed]
	gate_3 -> comm_3_11 [color=red style=dashed]
	gate_3 -> comm_3_12 [color=red style=dashed]
	gate_3 -> comm_3_13 [color=red style=dashed]
	gate_3 -> comm_3_14 [color=red style=dashed]
	gate_3 -> comm_3_15 [color=red style=dashed]
	comm_3_0 -> expert_3_0
	comm_3_1 -> expert_3_1
	comm_3_2 -> expert_3_2
	comm_3_3 -> expert_3_3
	comm_3_4 -> expert_3_4
	comm_3_5 -> expert_3_5
	comm_3_6 -> expert_3_6
	comm_3_7 -> expert_3_7
	comm_3_8 -> expert_3_8
	comm_3_9 -> expert_3_9
	comm_3_10 -> expert_3_10
	comm_3_11 -> expert_3_11
	comm_3_12 -> expert_3_12
	comm_3_13 -> expert_3_13
	comm_3_14 -> expert_3_14
	comm_3_15 -> expert_3_15
	expert_3_0 -> agg_3
	expert_3_1 -> agg_3
	expert_3_2 -> agg_3
	expert_3_3 -> agg_3
	expert_3_4 -> agg_3
	expert_3_5 -> agg_3
	expert_3_6 -> agg_3
	expert_3_7 -> agg_3
	expert_3_8 -> agg_3
	expert_3_9 -> agg_3
	expert_3_10 -> agg_3
	expert_3_11 -> agg_3
	expert_3_12 -> agg_3
	expert_3_13 -> agg_3
	expert_3_14 -> agg_3
	expert_3_15 -> agg_3
	mha_4 -> gate_4
	gate_4 -> comm_4_0 [color=red style=dashed]
	gate_4 -> comm_4_1 [color=red style=dashed]
	gate_4 -> comm_4_2 [color=red style=dashed]
	gate_4 -> comm_4_3 [color=red style=dashed]
	gate_4 -> comm_4_4 [color=red style=dashed]
	gate_4 -> comm_4_5 [color=red style=dashed]
	gate_4 -> comm_4_6 [color=red style=dashed]
	gate_4 -> comm_4_7 [color=red style=dashed]
	gate_4 -> comm_4_8 [color=red style=dashed]
	gate_4 -> comm_4_9 [color=red style=dashed]
	gate_4 -> comm_4_10 [color=red style=dashed]
	gate_4 -> comm_4_11 [color=red style=dashed]
	gate_4 -> comm_4_12 [color=red style=dashed]
	gate_4 -> comm_4_13 [color=red style=dashed]
	gate_4 -> comm_4_14 [color=red style=dashed]
	gate_4 -> comm_4_15 [color=red style=dashed]
	comm_4_0 -> expert_4_0
	comm_4_1 -> expert_4_1
	comm_4_2 -> expert_4_2
	comm_4_3 -> expert_4_3
	comm_4_4 -> expert_4_4
	comm_4_5 -> expert_4_5
	comm_4_6 -> expert_4_6
	comm_4_7 -> expert_4_7
	comm_4_8 -> expert_4_8
	comm_4_9 -> expert_4_9
	comm_4_10 -> expert_4_10
	comm_4_11 -> expert_4_11
	comm_4_12 -> expert_4_12
	comm_4_13 -> expert_4_13
	comm_4_14 -> expert_4_14
	comm_4_15 -> expert_4_15
	expert_4_0 -> agg_4
	expert_4_1 -> agg_4
	expert_4_2 -> agg_4
	expert_4_3 -> agg_4
	expert_4_4 -> agg_4
	expert_4_5 -> agg_4
	expert_4_6 -> agg_4
	expert_4_7 -> agg_4
	expert_4_8 -> agg_4
	expert_4_9 -> agg_4
	expert_4_10 -> agg_4
	expert_4_11 -> agg_4
	expert_4_12 -> agg_4
	expert_4_13 -> agg_4
	expert_4_14 -> agg_4
	expert_4_15 -> agg_4
	mha_5 -> gate_5
	gate_5 -> comm_5_0 [color=red style=dashed]
	gate_5 -> comm_5_1 [color=red style=dashed]
	gate_5 -> comm_5_2 [color=red style=dashed]
	gate_5 -> comm_5_3 [color=red style=dashed]
	gate_5 -> comm_5_4 [color=red style=dashed]
	gate_5 -> comm_5_5 [color=red style=dashed]
	gate_5 -> comm_5_6 [color=red style=dashed]
	gate_5 -> comm_5_7 [color=red style=dashed]
	gate_5 -> comm_5_8 [color=red style=dashed]
	gate_5 -> comm_5_9 [color=red style=dashed]
	gate_5 -> comm_5_10 [color=red style=dashed]
	gate_5 -> comm_5_11 [color=red style=dashed]
	gate_5 -> comm_5_12 [color=red style=dashed]
	gate_5 -> comm_5_13 [color=red style=dashed]
	gate_5 -> comm_5_14 [color=red style=dashed]
	gate_5 -> comm_5_15 [color=red style=dashed]
	comm_5_0 -> expert_5_0
	comm_5_1 -> expert_5_1
	comm_5_2 -> expert_5_2
	comm_5_3 -> expert_5_3
	comm_5_4 -> expert_5_4
	comm_5_5 -> expert_5_5
	comm_5_6 -> expert_5_6
	comm_5_7 -> expert_5_7
	comm_5_8 -> expert_5_8
	comm_5_9 -> expert_5_9
	comm_5_10 -> expert_5_10
	comm_5_11 -> expert_5_11
	comm_5_12 -> expert_5_12
	comm_5_13 -> expert_5_13
	comm_5_14 -> expert_5_14
	comm_5_15 -> expert_5_15
	expert_5_0 -> agg_5
	expert_5_1 -> agg_5
	expert_5_2 -> agg_5
	expert_5_3 -> agg_5
	expert_5_4 -> agg_5
	expert_5_5 -> agg_5
	expert_5_6 -> agg_5
	expert_5_7 -> agg_5
	expert_5_8 -> agg_5
	expert_5_9 -> agg_5
	expert_5_10 -> agg_5
	expert_5_11 -> agg_5
	expert_5_12 -> agg_5
	expert_5_13 -> agg_5
	expert_5_14 -> agg_5
	expert_5_15 -> agg_5
	mha_6 -> gate_6
	gate_6 -> comm_6_0 [color=red style=dashed]
	gate_6 -> comm_6_1 [color=red style=dashed]
	gate_6 -> comm_6_2 [color=red style=dashed]
	gate_6 -> comm_6_3 [color=red style=dashed]
	gate_6 -> comm_6_4 [color=red style=dashed]
	gate_6 -> comm_6_5 [color=red style=dashed]
	gate_6 -> comm_6_6 [color=red style=dashed]
	gate_6 -> comm_6_7 [color=red style=dashed]
	gate_6 -> comm_6_8 [color=red style=dashed]
	gate_6 -> comm_6_9 [color=red style=dashed]
	gate_6 -> comm_6_10 [color=red style=dashed]
	gate_6 -> comm_6_11 [color=red style=dashed]
	gate_6 -> comm_6_12 [color=red style=dashed]
	gate_6 -> comm_6_13 [color=red style=dashed]
	gate_6 -> comm_6_14 [color=red style=dashed]
	gate_6 -> comm_6_15 [color=red style=dashed]
	comm_6_0 -> expert_6_0
	comm_6_1 -> expert_6_1
	comm_6_2 -> expert_6_2
	comm_6_3 -> expert_6_3
	comm_6_4 -> expert_6_4
	comm_6_5 -> expert_6_5
	comm_6_6 -> expert_6_6
	comm_6_7 -> expert_6_7
	comm_6_8 -> expert_6_8
	comm_6_9 -> expert_6_9
	comm_6_10 -> expert_6_10
	comm_6_11 -> expert_6_11
	comm_6_12 -> expert_6_12
	comm_6_13 -> expert_6_13
	comm_6_14 -> expert_6_14
	comm_6_15 -> expert_6_15
	expert_6_0 -> agg_6
	expert_6_1 -> agg_6
	expert_6_2 -> agg_6
	expert_6_3 -> agg_6
	expert_6_4 -> agg_6
	expert_6_5 -> agg_6
	expert_6_6 -> agg_6
	expert_6_7 -> agg_6
	expert_6_8 -> agg_6
	expert_6_9 -> agg_6
	expert_6_10 -> agg_6
	expert_6_11 -> agg_6
	expert_6_12 -> agg_6
	expert_6_13 -> agg_6
	expert_6_14 -> agg_6
	expert_6_15 -> agg_6
	mha_7 -> gate_7
	gate_7 -> comm_7_0 [color=red style=dashed]
	gate_7 -> comm_7_1 [color=red style=dashed]
	gate_7 -> comm_7_2 [color=red style=dashed]
	gate_7 -> comm_7_3 [color=red style=dashed]
	gate_7 -> comm_7_4 [color=red style=dashed]
	gate_7 -> comm_7_5 [color=red style=dashed]
	gate_7 -> comm_7_6 [color=red style=dashed]
	gate_7 -> comm_7_7 [color=red style=dashed]
	gate_7 -> comm_7_8 [color=red style=dashed]
	gate_7 -> comm_7_9 [color=red style=dashed]
	gate_7 -> comm_7_10 [color=red style=dashed]
	gate_7 -> comm_7_11 [color=red style=dashed]
	gate_7 -> comm_7_12 [color=red style=dashed]
	gate_7 -> comm_7_13 [color=red style=dashed]
	gate_7 -> comm_7_14 [color=red style=dashed]
	gate_7 -> comm_7_15 [color=red style=dashed]
	comm_7_0 -> expert_7_0
	comm_7_1 -> expert_7_1
	comm_7_2 -> expert_7_2
	comm_7_3 -> expert_7_3
	comm_7_4 -> expert_7_4
	comm_7_5 -> expert_7_5
	comm_7_6 -> expert_7_6
	comm_7_7 -> expert_7_7
	comm_7_8 -> expert_7_8
	comm_7_9 -> expert_7_9
	comm_7_10 -> expert_7_10
	comm_7_11 -> expert_7_11
	comm_7_12 -> expert_7_12
	comm_7_13 -> expert_7_13
	comm_7_14 -> expert_7_14
	comm_7_15 -> expert_7_15
	expert_7_0 -> agg_7
	expert_7_1 -> agg_7
	expert_7_2 -> agg_7
	expert_7_3 -> agg_7
	expert_7_4 -> agg_7
	expert_7_5 -> agg_7
	expert_7_6 -> agg_7
	expert_7_7 -> agg_7
	expert_7_8 -> agg_7
	expert_7_9 -> agg_7
	expert_7_10 -> agg_7
	expert_7_11 -> agg_7
	expert_7_12 -> agg_7
	expert_7_13 -> agg_7
	expert_7_14 -> agg_7
	expert_7_15 -> agg_7
	mha_8 -> gate_8
	gate_8 -> comm_8_0 [color=red style=dashed]
	gate_8 -> comm_8_1 [color=red style=dashed]
	gate_8 -> comm_8_2 [color=red style=dashed]
	gate_8 -> comm_8_3 [color=red style=dashed]
	gate_8 -> comm_8_4 [color=red style=dashed]
	gate_8 -> comm_8_5 [color=red style=dashed]
	gate_8 -> comm_8_6 [color=red style=dashed]
	gate_8 -> comm_8_7 [color=red style=dashed]
	gate_8 -> comm_8_8 [color=red style=dashed]
	gate_8 -> comm_8_9 [color=red style=dashed]
	gate_8 -> comm_8_10 [color=red style=dashed]
	gate_8 -> comm_8_11 [color=red style=dashed]
	gate_8 -> comm_8_12 [color=red style=dashed]
	gate_8 -> comm_8_13 [color=red style=dashed]
	gate_8 -> comm_8_14 [color=red style=dashed]
	gate_8 -> comm_8_15 [color=red style=dashed]
	comm_8_0 -> expert_8_0
	comm_8_1 -> expert_8_1
	comm_8_2 -> expert_8_2
	comm_8_3 -> expert_8_3
	comm_8_4 -> expert_8_4
	comm_8_5 -> expert_8_5
	comm_8_6 -> expert_8_6
	comm_8_7 -> expert_8_7
	comm_8_8 -> expert_8_8
	comm_8_9 -> expert_8_9
	comm_8_10 -> expert_8_10
	comm_8_11 -> expert_8_11
	comm_8_12 -> expert_8_12
	comm_8_13 -> expert_8_13
	comm_8_14 -> expert_8_14
	comm_8_15 -> expert_8_15
	expert_8_0 -> agg_8
	expert_8_1 -> agg_8
	expert_8_2 -> agg_8
	expert_8_3 -> agg_8
	expert_8_4 -> agg_8
	expert_8_5 -> agg_8
	expert_8_6 -> agg_8
	expert_8_7 -> agg_8
	expert_8_8 -> agg_8
	expert_8_9 -> agg_8
	expert_8_10 -> agg_8
	expert_8_11 -> agg_8
	expert_8_12 -> agg_8
	expert_8_13 -> agg_8
	expert_8_14 -> agg_8
	expert_8_15 -> agg_8
	mha_9 -> gate_9
	gate_9 -> comm_9_0 [color=red style=dashed]
	gate_9 -> comm_9_1 [color=red style=dashed]
	gate_9 -> comm_9_2 [color=red style=dashed]
	gate_9 -> comm_9_3 [color=red style=dashed]
	gate_9 -> comm_9_4 [color=red style=dashed]
	gate_9 -> comm_9_5 [color=red style=dashed]
	gate_9 -> comm_9_6 [color=red style=dashed]
	gate_9 -> comm_9_7 [color=red style=dashed]
	gate_9 -> comm_9_8 [color=red style=dashed]
	gate_9 -> comm_9_9 [color=red style=dashed]
	gate_9 -> comm_9_10 [color=red style=dashed]
	gate_9 -> comm_9_11 [color=red style=dashed]
	gate_9 -> comm_9_12 [color=red style=dashed]
	gate_9 -> comm_9_13 [color=red style=dashed]
	gate_9 -> comm_9_14 [color=red style=dashed]
	gate_9 -> comm_9_15 [color=red style=dashed]
	comm_9_0 -> expert_9_0
	comm_9_1 -> expert_9_1
	comm_9_2 -> expert_9_2
	comm_9_3 -> expert_9_3
	comm_9_4 -> expert_9_4
	comm_9_5 -> expert_9_5
	comm_9_6 -> expert_9_6
	comm_9_7 -> expert_9_7
	comm_9_8 -> expert_9_8
	comm_9_9 -> expert_9_9
	comm_9_10 -> expert_9_10
	comm_9_11 -> expert_9_11
	comm_9_12 -> expert_9_12
	comm_9_13 -> expert_9_13
	comm_9_14 -> expert_9_14
	comm_9_15 -> expert_9_15
	expert_9_0 -> agg_9
	expert_9_1 -> agg_9
	expert_9_2 -> agg_9
	expert_9_3 -> agg_9
	expert_9_4 -> agg_9
	expert_9_5 -> agg_9
	expert_9_6 -> agg_9
	expert_9_7 -> agg_9
	expert_9_8 -> agg_9
	expert_9_9 -> agg_9
	expert_9_10 -> agg_9
	expert_9_11 -> agg_9
	expert_9_12 -> agg_9
	expert_9_13 -> agg_9
	expert_9_14 -> agg_9
	expert_9_15 -> agg_9
	mha_10 -> gate_10
	gate_10 -> comm_10_0 [color=red style=dashed]
	gate_10 -> comm_10_1 [color=red style=dashed]
	gate_10 -> comm_10_2 [color=red style=dashed]
	gate_10 -> comm_10_3 [color=red style=dashed]
	gate_10 -> comm_10_4 [color=red style=dashed]
	gate_10 -> comm_10_5 [color=red style=dashed]
	gate_10 -> comm_10_6 [color=red style=dashed]
	gate_10 -> comm_10_7 [color=red style=dashed]
	gate_10 -> comm_10_8 [color=red style=dashed]
	gate_10 -> comm_10_9 [color=red style=dashed]
	gate_10 -> comm_10_10 [color=red style=dashed]
	gate_10 -> comm_10_11 [color=red style=dashed]
	gate_10 -> comm_10_12 [color=red style=dashed]
	gate_10 -> comm_10_13 [color=red style=dashed]
	gate_10 -> comm_10_14 [color=red style=dashed]
	gate_10 -> comm_10_15 [color=red style=dashed]
	comm_10_0 -> expert_10_0
	comm_10_1 -> expert_10_1
	comm_10_2 -> expert_10_2
	comm_10_3 -> expert_10_3
	comm_10_4 -> expert_10_4
	comm_10_5 -> expert_10_5
	comm_10_6 -> expert_10_6
	comm_10_7 -> expert_10_7
	comm_10_8 -> expert_10_8
	comm_10_9 -> expert_10_9
	comm_10_10 -> expert_10_10
	comm_10_11 -> expert_10_11
	comm_10_12 -> expert_10_12
	comm_10_13 -> expert_10_13
	comm_10_14 -> expert_10_14
	comm_10_15 -> expert_10_15
	expert_10_0 -> agg_10
	expert_10_1 -> agg_10
	expert_10_2 -> agg_10
	expert_10_3 -> agg_10
	expert_10_4 -> agg_10
	expert_10_5 -> agg_10
	expert_10_6 -> agg_10
	expert_10_7 -> agg_10
	expert_10_8 -> agg_10
	expert_10_9 -> agg_10
	expert_10_10 -> agg_10
	expert_10_11 -> agg_10
	expert_10_12 -> agg_10
	expert_10_13 -> agg_10
	expert_10_14 -> agg_10
	expert_10_15 -> agg_10
	mha_11 -> gate_11
	gate_11 -> comm_11_0 [color=red style=dashed]
	gate_11 -> comm_11_1 [color=red style=dashed]
	gate_11 -> comm_11_2 [color=red style=dashed]
	gate_11 -> comm_11_3 [color=red style=dashed]
	gate_11 -> comm_11_4 [color=red style=dashed]
	gate_11 -> comm_11_5 [color=red style=dashed]
	gate_11 -> comm_11_6 [color=red style=dashed]
	gate_11 -> comm_11_7 [color=red style=dashed]
	gate_11 -> comm_11_8 [color=red style=dashed]
	gate_11 -> comm_11_9 [color=red style=dashed]
	gate_11 -> comm_11_10 [color=red style=dashed]
	gate_11 -> comm_11_11 [color=red style=dashed]
	gate_11 -> comm_11_12 [color=red style=dashed]
	gate_11 -> comm_11_13 [color=red style=dashed]
	gate_11 -> comm_11_14 [color=red style=dashed]
	gate_11 -> comm_11_15 [color=red style=dashed]
	comm_11_0 -> expert_11_0
	comm_11_1 -> expert_11_1
	comm_11_2 -> expert_11_2
	comm_11_3 -> expert_11_3
	comm_11_4 -> expert_11_4
	comm_11_5 -> expert_11_5
	comm_11_6 -> expert_11_6
	comm_11_7 -> expert_11_7
	comm_11_8 -> expert_11_8
	comm_11_9 -> expert_11_9
	comm_11_10 -> expert_11_10
	comm_11_11 -> expert_11_11
	comm_11_12 -> expert_11_12
	comm_11_13 -> expert_11_13
	comm_11_14 -> expert_11_14
	comm_11_15 -> expert_11_15
	expert_11_0 -> agg_11
	expert_11_1 -> agg_11
	expert_11_2 -> agg_11
	expert_11_3 -> agg_11
	expert_11_4 -> agg_11
	expert_11_5 -> agg_11
	expert_11_6 -> agg_11
	expert_11_7 -> agg_11
	expert_11_8 -> agg_11
	expert_11_9 -> agg_11
	expert_11_10 -> agg_11
	expert_11_11 -> agg_11
	expert_11_12 -> agg_11
	expert_11_13 -> agg_11
	expert_11_14 -> agg_11
	expert_11_15 -> agg_11
	mha_12 -> gate_12
	gate_12 -> comm_12_0 [color=red style=dashed]
	gate_12 -> comm_12_1 [color=red style=dashed]
	gate_12 -> comm_12_2 [color=red style=dashed]
	gate_12 -> comm_12_3 [color=red style=dashed]
	gate_12 -> comm_12_4 [color=red style=dashed]
	gate_12 -> comm_12_5 [color=red style=dashed]
	gate_12 -> comm_12_6 [color=red style=dashed]
	gate_12 -> comm_12_7 [color=red style=dashed]
	gate_12 -> comm_12_8 [color=red style=dashed]
	gate_12 -> comm_12_9 [color=red style=dashed]
	gate_12 -> comm_12_10 [color=red style=dashed]
	gate_12 -> comm_12_11 [color=red style=dashed]
	gate_12 -> comm_12_12 [color=red style=dashed]
	gate_12 -> comm_12_13 [color=red style=dashed]
	gate_12 -> comm_12_14 [color=red style=dashed]
	gate_12 -> comm_12_15 [color=red style=dashed]
	comm_12_0 -> expert_12_0
	comm_12_1 -> expert_12_1
	comm_12_2 -> expert_12_2
	comm_12_3 -> expert_12_3
	comm_12_4 -> expert_12_4
	comm_12_5 -> expert_12_5
	comm_12_6 -> expert_12_6
	comm_12_7 -> expert_12_7
	comm_12_8 -> expert_12_8
	comm_12_9 -> expert_12_9
	comm_12_10 -> expert_12_10
	comm_12_11 -> expert_12_11
	comm_12_12 -> expert_12_12
	comm_12_13 -> expert_12_13
	comm_12_14 -> expert_12_14
	comm_12_15 -> expert_12_15
	expert_12_0 -> agg_12
	expert_12_1 -> agg_12
	expert_12_2 -> agg_12
	expert_12_3 -> agg_12
	expert_12_4 -> agg_12
	expert_12_5 -> agg_12
	expert_12_6 -> agg_12
	expert_12_7 -> agg_12
	expert_12_8 -> agg_12
	expert_12_9 -> agg_12
	expert_12_10 -> agg_12
	expert_12_11 -> agg_12
	expert_12_12 -> agg_12
	expert_12_13 -> agg_12
	expert_12_14 -> agg_12
	expert_12_15 -> agg_12
	mha_13 -> gate_13
	gate_13 -> comm_13_0 [color=red style=dashed]
	gate_13 -> comm_13_1 [color=red style=dashed]
	gate_13 -> comm_13_2 [color=red style=dashed]
	gate_13 -> comm_13_3 [color=red style=dashed]
	gate_13 -> comm_13_4 [color=red style=dashed]
	gate_13 -> comm_13_5 [color=red style=dashed]
	gate_13 -> comm_13_6 [color=red style=dashed]
	gate_13 -> comm_13_7 [color=red style=dashed]
	gate_13 -> comm_13_8 [color=red style=dashed]
	gate_13 -> comm_13_9 [color=red style=dashed]
	gate_13 -> comm_13_10 [color=red style=dashed]
	gate_13 -> comm_13_11 [color=red style=dashed]
	gate_13 -> comm_13_12 [color=red style=dashed]
	gate_13 -> comm_13_13 [color=red style=dashed]
	gate_13 -> comm_13_14 [color=red style=dashed]
	gate_13 -> comm_13_15 [color=red style=dashed]
	comm_13_0 -> expert_13_0
	comm_13_1 -> expert_13_1
	comm_13_2 -> expert_13_2
	comm_13_3 -> expert_13_3
	comm_13_4 -> expert_13_4
	comm_13_5 -> expert_13_5
	comm_13_6 -> expert_13_6
	comm_13_7 -> expert_13_7
	comm_13_8 -> expert_13_8
	comm_13_9 -> expert_13_9
	comm_13_10 -> expert_13_10
	comm_13_11 -> expert_13_11
	comm_13_12 -> expert_13_12
	comm_13_13 -> expert_13_13
	comm_13_14 -> expert_13_14
	comm_13_15 -> expert_13_15
	expert_13_0 -> agg_13
	expert_13_1 -> agg_13
	expert_13_2 -> agg_13
	expert_13_3 -> agg_13
	expert_13_4 -> agg_13
	expert_13_5 -> agg_13
	expert_13_6 -> agg_13
	expert_13_7 -> agg_13
	expert_13_8 -> agg_13
	expert_13_9 -> agg_13
	expert_13_10 -> agg_13
	expert_13_11 -> agg_13
	expert_13_12 -> agg_13
	expert_13_13 -> agg_13
	expert_13_14 -> agg_13
	expert_13_15 -> agg_13
	mha_14 -> gate_14
	gate_14 -> comm_14_0 [color=red style=dashed]
	gate_14 -> comm_14_1 [color=red style=dashed]
	gate_14 -> comm_14_2 [color=red style=dashed]
	gate_14 -> comm_14_3 [color=red style=dashed]
	gate_14 -> comm_14_4 [color=red style=dashed]
	gate_14 -> comm_14_5 [color=red style=dashed]
	gate_14 -> comm_14_6 [color=red style=dashed]
	gate_14 -> comm_14_7 [color=red style=dashed]
	gate_14 -> comm_14_8 [color=red style=dashed]
	gate_14 -> comm_14_9 [color=red style=dashed]
	gate_14 -> comm_14_10 [color=red style=dashed]
	gate_14 -> comm_14_11 [color=red style=dashed]
	gate_14 -> comm_14_12 [color=red style=dashed]
	gate_14 -> comm_14_13 [color=red style=dashed]
	gate_14 -> comm_14_14 [color=red style=dashed]
	gate_14 -> comm_14_15 [color=red style=dashed]
	comm_14_0 -> expert_14_0
	comm_14_1 -> expert_14_1
	comm_14_2 -> expert_14_2
	comm_14_3 -> expert_14_3
	comm_14_4 -> expert_14_4
	comm_14_5 -> expert_14_5
	comm_14_6 -> expert_14_6
	comm_14_7 -> expert_14_7
	comm_14_8 -> expert_14_8
	comm_14_9 -> expert_14_9
	comm_14_10 -> expert_14_10
	comm_14_11 -> expert_14_11
	comm_14_12 -> expert_14_12
	comm_14_13 -> expert_14_13
	comm_14_14 -> expert_14_14
	comm_14_15 -> expert_14_15
	expert_14_0 -> agg_14
	expert_14_1 -> agg_14
	expert_14_2 -> agg_14
	expert_14_3 -> agg_14
	expert_14_4 -> agg_14
	expert_14_5 -> agg_14
	expert_14_6 -> agg_14
	expert_14_7 -> agg_14
	expert_14_8 -> agg_14
	expert_14_9 -> agg_14
	expert_14_10 -> agg_14
	expert_14_11 -> agg_14
	expert_14_12 -> agg_14
	expert_14_13 -> agg_14
	expert_14_14 -> agg_14
	expert_14_15 -> agg_14
	mha_15 -> gate_15
	gate_15 -> comm_15_0 [color=red style=dashed]
	gate_15 -> comm_15_1 [color=red style=dashed]
	gate_15 -> comm_15_2 [color=red style=dashed]
	gate_15 -> comm_15_3 [color=red style=dashed]
	gate_15 -> comm_15_4 [color=red style=dashed]
	gate_15 -> comm_15_5 [color=red style=dashed]
	gate_15 -> comm_15_6 [color=red style=dashed]
	gate_15 -> comm_15_7 [color=red style=dashed]
	gate_15 -> comm_15_8 [color=red style=dashed]
	gate_15 -> comm_15_9 [color=red style=dashed]
	gate_15 -> comm_15_10 [color=red style=dashed]
	gate_15 -> comm_15_11 [color=red style=dashed]
	gate_15 -> comm_15_12 [color=red style=dashed]
	gate_15 -> comm_15_13 [color=red style=dashed]
	gate_15 -> comm_15_14 [color=red style=dashed]
	gate_15 -> comm_15_15 [color=red style=dashed]
	comm_15_0 -> expert_15_0
	comm_15_1 -> expert_15_1
	comm_15_2 -> expert_15_2
	comm_15_3 -> expert_15_3
	comm_15_4 -> expert_15_4
	comm_15_5 -> expert_15_5
	comm_15_6 -> expert_15_6
	comm_15_7 -> expert_15_7
	comm_15_8 -> expert_15_8
	comm_15_9 -> expert_15_9
	comm_15_10 -> expert_15_10
	comm_15_11 -> expert_15_11
	comm_15_12 -> expert_15_12
	comm_15_13 -> expert_15_13
	comm_15_14 -> expert_15_14
	comm_15_15 -> expert_15_15
	expert_15_0 -> agg_15
	expert_15_1 -> agg_15
	expert_15_2 -> agg_15
	expert_15_3 -> agg_15
	expert_15_4 -> agg_15
	expert_15_5 -> agg_15
	expert_15_6 -> agg_15
	expert_15_7 -> agg_15
	expert_15_8 -> agg_15
	expert_15_9 -> agg_15
	expert_15_10 -> agg_15
	expert_15_11 -> agg_15
	expert_15_12 -> agg_15
	expert_15_13 -> agg_15
	expert_15_14 -> agg_15
	expert_15_15 -> agg_15
	agg_0 -> mha_1 [color=blue penwidth=2]
	agg_1 -> mha_2 [color=blue penwidth=2]
	agg_2 -> mha_3 [color=blue penwidth=2]
	agg_3 -> mha_4 [color=blue penwidth=2]
	agg_4 -> mha_5 [color=blue penwidth=2]
	agg_5 -> mha_6 [color=blue penwidth=2]
	agg_6 -> mha_7 [color=blue penwidth=2]
	agg_7 -> mha_8 [color=blue penwidth=2]
	agg_8 -> mha_9 [color=blue penwidth=2]
	agg_9 -> mha_10 [color=blue penwidth=2]
	agg_10 -> mha_11 [color=blue penwidth=2]
	agg_11 -> mha_12 [color=blue penwidth=2]
	agg_12 -> mha_13 [color=blue penwidth=2]
	agg_13 -> mha_14 [color=blue penwidth=2]
	agg_14 -> mha_15 [color=blue penwidth=2]
	agg_15 -> output
}
