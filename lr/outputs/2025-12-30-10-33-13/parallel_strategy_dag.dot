// LLM Parallel Strategy DAG
digraph {
	dpi=300 rankdir=TB size="30,40"
	node [fontname=Arial fontsize=10]
	edge [fontname=Arial fontsize=9]
	node [fillcolor=lightblue shape=ellipse style=filled]
	node [fillcolor=lightgreen shape=rectangle style=filled]
	node [fillcolor=lightyellow shape=parallelogram style=filled]
	input [label="Input\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
	input -> input_dp0_pp1 [constraint=false style=dashed]
	dp0_pp1_layer1_attn_tp0 -> dp0_pp1_layer1_attn_allreduce
	dp0_pp1_layer1_attn_tp1 -> dp0_pp1_layer1_attn_allreduce
	dp0_pp1_layer1_attn_tp2 -> dp0_pp1_layer1_attn_allreduce
	dp0_pp1_layer1_attn_tp3 -> dp0_pp1_layer1_attn_allreduce
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert0 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert1 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert2 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert3 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert4 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert5 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert6 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert7 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert8 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert9 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert10 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert11 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert12 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert13 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert14 [style=dashed]
	dp0_pp1_layer1_router -> dp0_pp1_layer1_expert15 [style=dashed]
	dp0_pp1_layer1_expert0 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert1 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert2 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert3 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert4 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert5 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert6 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert7 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert8 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert9 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert10 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert11 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert12 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert13 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert14 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_expert15 -> dp0_pp1_layer1_expert_agg
	dp0_pp1_layer1_attn_allreduce -> dp0_pp1_layer1_router [constraint=false]
	dp0_pp1_layer1_expert_agg -> dp0_pp1_layer2_attn_tp0 [constraint=false]
	dp0_pp1_layer2_attn_tp0 -> dp0_pp1_layer2_attn_allreduce
	dp0_pp1_layer2_attn_tp1 -> dp0_pp1_layer2_attn_allreduce
	dp0_pp1_layer2_attn_tp2 -> dp0_pp1_layer2_attn_allreduce
	dp0_pp1_layer2_attn_tp3 -> dp0_pp1_layer2_attn_allreduce
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert0 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert1 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert2 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert3 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert4 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert5 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert6 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert7 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert8 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert9 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert10 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert11 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert12 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert13 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert14 [style=dashed]
	dp0_pp1_layer2_router -> dp0_pp1_layer2_expert15 [style=dashed]
	dp0_pp1_layer2_expert0 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert1 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert2 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert3 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert4 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert5 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert6 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert7 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert8 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert9 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert10 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert11 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert12 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert13 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert14 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_expert15 -> dp0_pp1_layer2_expert_agg
	dp0_pp1_layer2_attn_allreduce -> dp0_pp1_layer2_router [constraint=false]
	dp0_pp1_layer2_expert_agg -> dp0_pp1_layer3_attn_tp0 [constraint=false]
	dp0_pp1_layer3_attn_tp0 -> dp0_pp1_layer3_attn_allreduce
	dp0_pp1_layer3_attn_tp1 -> dp0_pp1_layer3_attn_allreduce
	dp0_pp1_layer3_attn_tp2 -> dp0_pp1_layer3_attn_allreduce
	dp0_pp1_layer3_attn_tp3 -> dp0_pp1_layer3_attn_allreduce
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert0 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert1 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert2 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert3 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert4 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert5 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert6 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert7 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert8 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert9 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert10 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert11 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert12 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert13 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert14 [style=dashed]
	dp0_pp1_layer3_router -> dp0_pp1_layer3_expert15 [style=dashed]
	dp0_pp1_layer3_expert0 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert1 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert2 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert3 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert4 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert5 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert6 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert7 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert8 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert9 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert10 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert11 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert12 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert13 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert14 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_expert15 -> dp0_pp1_layer3_expert_agg
	dp0_pp1_layer3_attn_allreduce -> dp0_pp1_layer3_router [constraint=false]
	dp0_pp1_layer3_expert_agg -> dp0_pp1_layer4_attn_tp0 [constraint=false]
	dp0_pp1_layer4_attn_tp0 -> dp0_pp1_layer4_attn_allreduce
	dp0_pp1_layer4_attn_tp1 -> dp0_pp1_layer4_attn_allreduce
	dp0_pp1_layer4_attn_tp2 -> dp0_pp1_layer4_attn_allreduce
	dp0_pp1_layer4_attn_tp3 -> dp0_pp1_layer4_attn_allreduce
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert0 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert1 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert2 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert3 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert4 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert5 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert6 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert7 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert8 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert9 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert10 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert11 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert12 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert13 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert14 [style=dashed]
	dp0_pp1_layer4_router -> dp0_pp1_layer4_expert15 [style=dashed]
	dp0_pp1_layer4_expert0 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert1 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert2 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert3 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert4 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert5 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert6 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert7 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert8 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert9 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert10 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert11 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert12 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert13 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert14 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_expert15 -> dp0_pp1_layer4_expert_agg
	dp0_pp1_layer4_attn_allreduce -> dp0_pp1_layer4_router [constraint=false]
	dp0_pp1_layer4_expert_agg -> dp0_pp1_layer5_attn_tp0 [constraint=false]
	dp0_pp1_layer5_attn_tp0 -> dp0_pp1_layer5_attn_allreduce
	dp0_pp1_layer5_attn_tp1 -> dp0_pp1_layer5_attn_allreduce
	dp0_pp1_layer5_attn_tp2 -> dp0_pp1_layer5_attn_allreduce
	dp0_pp1_layer5_attn_tp3 -> dp0_pp1_layer5_attn_allreduce
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert0 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert1 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert2 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert3 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert4 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert5 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert6 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert7 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert8 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert9 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert10 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert11 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert12 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert13 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert14 [style=dashed]
	dp0_pp1_layer5_router -> dp0_pp1_layer5_expert15 [style=dashed]
	dp0_pp1_layer5_expert0 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert1 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert2 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert3 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert4 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert5 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert6 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert7 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert8 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert9 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert10 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert11 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert12 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert13 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert14 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_expert15 -> dp0_pp1_layer5_expert_agg
	dp0_pp1_layer5_attn_allreduce -> dp0_pp1_layer5_router [constraint=false]
	dp0_pp1_layer5_expert_agg -> dp0_pp1_layer6_attn_tp0 [constraint=false]
	dp0_pp1_layer6_attn_tp0 -> dp0_pp1_layer6_attn_allreduce
	dp0_pp1_layer6_attn_tp1 -> dp0_pp1_layer6_attn_allreduce
	dp0_pp1_layer6_attn_tp2 -> dp0_pp1_layer6_attn_allreduce
	dp0_pp1_layer6_attn_tp3 -> dp0_pp1_layer6_attn_allreduce
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert0 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert1 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert2 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert3 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert4 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert5 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert6 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert7 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert8 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert9 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert10 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert11 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert12 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert13 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert14 [style=dashed]
	dp0_pp1_layer6_router -> dp0_pp1_layer6_expert15 [style=dashed]
	dp0_pp1_layer6_expert0 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert1 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert2 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert3 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert4 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert5 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert6 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert7 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert8 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert9 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert10 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert11 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert12 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert13 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert14 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_expert15 -> dp0_pp1_layer6_expert_agg
	dp0_pp1_layer6_attn_allreduce -> dp0_pp1_layer6_router [constraint=false]
	dp0_pp1_layer6_expert_agg -> dp0_pp1_layer7_attn_tp0 [constraint=false]
	dp0_pp1_layer7_attn_tp0 -> dp0_pp1_layer7_attn_allreduce
	dp0_pp1_layer7_attn_tp1 -> dp0_pp1_layer7_attn_allreduce
	dp0_pp1_layer7_attn_tp2 -> dp0_pp1_layer7_attn_allreduce
	dp0_pp1_layer7_attn_tp3 -> dp0_pp1_layer7_attn_allreduce
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert0 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert1 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert2 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert3 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert4 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert5 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert6 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert7 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert8 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert9 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert10 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert11 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert12 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert13 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert14 [style=dashed]
	dp0_pp1_layer7_router -> dp0_pp1_layer7_expert15 [style=dashed]
	dp0_pp1_layer7_expert0 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert1 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert2 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert3 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert4 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert5 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert6 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert7 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert8 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert9 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert10 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert11 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert12 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert13 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert14 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_expert15 -> dp0_pp1_layer7_expert_agg
	dp0_pp1_layer7_attn_allreduce -> dp0_pp1_layer7_router [constraint=false]
	dp0_pp1_layer7_expert_agg -> dp0_pp1_layer8_attn_tp0 [constraint=false]
	dp0_pp1_layer8_attn_tp0 -> dp0_pp1_layer8_attn_allreduce
	dp0_pp1_layer8_attn_tp1 -> dp0_pp1_layer8_attn_allreduce
	dp0_pp1_layer8_attn_tp2 -> dp0_pp1_layer8_attn_allreduce
	dp0_pp1_layer8_attn_tp3 -> dp0_pp1_layer8_attn_allreduce
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert0 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert1 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert2 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert3 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert4 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert5 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert6 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert7 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert8 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert9 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert10 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert11 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert12 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert13 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert14 [style=dashed]
	dp0_pp1_layer8_router -> dp0_pp1_layer8_expert15 [style=dashed]
	dp0_pp1_layer8_expert0 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert1 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert2 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert3 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert4 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert5 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert6 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert7 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert8 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert9 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert10 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert11 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert12 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert13 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert14 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_expert15 -> dp0_pp1_layer8_expert_agg
	dp0_pp1_layer8_attn_allreduce -> dp0_pp1_layer8_router [constraint=false]
	dp0_pp2_layer9_attn_tp0 -> dp0_pp2_layer9_attn_allreduce
	dp0_pp2_layer9_attn_tp1 -> dp0_pp2_layer9_attn_allreduce
	dp0_pp2_layer9_attn_tp2 -> dp0_pp2_layer9_attn_allreduce
	dp0_pp2_layer9_attn_tp3 -> dp0_pp2_layer9_attn_allreduce
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert0 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert1 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert2 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert3 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert4 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert5 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert6 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert7 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert8 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert9 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert10 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert11 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert12 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert13 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert14 [style=dashed]
	dp0_pp2_layer9_router -> dp0_pp2_layer9_expert15 [style=dashed]
	dp0_pp2_layer9_expert0 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert1 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert2 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert3 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert4 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert5 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert6 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert7 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert8 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert9 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert10 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert11 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert12 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert13 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert14 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_expert15 -> dp0_pp2_layer9_expert_agg
	dp0_pp2_layer9_attn_allreduce -> dp0_pp2_layer9_router [constraint=false]
	dp0_pp2_layer9_expert_agg -> dp0_pp2_layer10_attn_tp0 [constraint=false]
	dp0_pp2_layer10_attn_tp0 -> dp0_pp2_layer10_attn_allreduce
	dp0_pp2_layer10_attn_tp1 -> dp0_pp2_layer10_attn_allreduce
	dp0_pp2_layer10_attn_tp2 -> dp0_pp2_layer10_attn_allreduce
	dp0_pp2_layer10_attn_tp3 -> dp0_pp2_layer10_attn_allreduce
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert0 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert1 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert2 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert3 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert4 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert5 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert6 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert7 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert8 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert9 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert10 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert11 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert12 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert13 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert14 [style=dashed]
	dp0_pp2_layer10_router -> dp0_pp2_layer10_expert15 [style=dashed]
	dp0_pp2_layer10_expert0 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert1 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert2 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert3 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert4 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert5 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert6 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert7 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert8 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert9 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert10 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert11 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert12 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert13 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert14 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_expert15 -> dp0_pp2_layer10_expert_agg
	dp0_pp2_layer10_attn_allreduce -> dp0_pp2_layer10_router [constraint=false]
	dp0_pp2_layer10_expert_agg -> dp0_pp2_layer11_attn_tp0 [constraint=false]
	dp0_pp2_layer11_attn_tp0 -> dp0_pp2_layer11_attn_allreduce
	dp0_pp2_layer11_attn_tp1 -> dp0_pp2_layer11_attn_allreduce
	dp0_pp2_layer11_attn_tp2 -> dp0_pp2_layer11_attn_allreduce
	dp0_pp2_layer11_attn_tp3 -> dp0_pp2_layer11_attn_allreduce
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert0 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert1 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert2 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert3 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert4 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert5 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert6 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert7 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert8 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert9 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert10 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert11 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert12 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert13 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert14 [style=dashed]
	dp0_pp2_layer11_router -> dp0_pp2_layer11_expert15 [style=dashed]
	dp0_pp2_layer11_expert0 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert1 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert2 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert3 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert4 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert5 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert6 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert7 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert8 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert9 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert10 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert11 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert12 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert13 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert14 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_expert15 -> dp0_pp2_layer11_expert_agg
	dp0_pp2_layer11_attn_allreduce -> dp0_pp2_layer11_router [constraint=false]
	dp0_pp2_layer11_expert_agg -> dp0_pp2_layer12_attn_tp0 [constraint=false]
	dp0_pp2_layer12_attn_tp0 -> dp0_pp2_layer12_attn_allreduce
	dp0_pp2_layer12_attn_tp1 -> dp0_pp2_layer12_attn_allreduce
	dp0_pp2_layer12_attn_tp2 -> dp0_pp2_layer12_attn_allreduce
	dp0_pp2_layer12_attn_tp3 -> dp0_pp2_layer12_attn_allreduce
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert0 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert1 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert2 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert3 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert4 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert5 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert6 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert7 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert8 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert9 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert10 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert11 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert12 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert13 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert14 [style=dashed]
	dp0_pp2_layer12_router -> dp0_pp2_layer12_expert15 [style=dashed]
	dp0_pp2_layer12_expert0 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert1 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert2 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert3 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert4 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert5 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert6 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert7 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert8 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert9 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert10 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert11 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert12 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert13 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert14 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_expert15 -> dp0_pp2_layer12_expert_agg
	dp0_pp2_layer12_attn_allreduce -> dp0_pp2_layer12_router [constraint=false]
	dp0_pp2_layer12_expert_agg -> dp0_pp2_layer13_attn_tp0 [constraint=false]
	dp0_pp2_layer13_attn_tp0 -> dp0_pp2_layer13_attn_allreduce
	dp0_pp2_layer13_attn_tp1 -> dp0_pp2_layer13_attn_allreduce
	dp0_pp2_layer13_attn_tp2 -> dp0_pp2_layer13_attn_allreduce
	dp0_pp2_layer13_attn_tp3 -> dp0_pp2_layer13_attn_allreduce
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert0 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert1 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert2 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert3 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert4 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert5 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert6 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert7 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert8 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert9 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert10 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert11 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert12 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert13 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert14 [style=dashed]
	dp0_pp2_layer13_router -> dp0_pp2_layer13_expert15 [style=dashed]
	dp0_pp2_layer13_expert0 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert1 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert2 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert3 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert4 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert5 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert6 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert7 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert8 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert9 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert10 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert11 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert12 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert13 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert14 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_expert15 -> dp0_pp2_layer13_expert_agg
	dp0_pp2_layer13_attn_allreduce -> dp0_pp2_layer13_router [constraint=false]
	dp0_pp2_layer13_expert_agg -> dp0_pp2_layer14_attn_tp0 [constraint=false]
	dp0_pp2_layer14_attn_tp0 -> dp0_pp2_layer14_attn_allreduce
	dp0_pp2_layer14_attn_tp1 -> dp0_pp2_layer14_attn_allreduce
	dp0_pp2_layer14_attn_tp2 -> dp0_pp2_layer14_attn_allreduce
	dp0_pp2_layer14_attn_tp3 -> dp0_pp2_layer14_attn_allreduce
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert0 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert1 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert2 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert3 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert4 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert5 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert6 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert7 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert8 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert9 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert10 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert11 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert12 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert13 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert14 [style=dashed]
	dp0_pp2_layer14_router -> dp0_pp2_layer14_expert15 [style=dashed]
	dp0_pp2_layer14_expert0 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert1 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert2 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert3 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert4 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert5 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert6 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert7 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert8 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert9 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert10 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert11 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert12 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert13 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert14 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_expert15 -> dp0_pp2_layer14_expert_agg
	dp0_pp2_layer14_attn_allreduce -> dp0_pp2_layer14_router [constraint=false]
	dp0_pp2_layer14_expert_agg -> dp0_pp2_layer15_attn_tp0 [constraint=false]
	dp0_pp2_layer15_attn_tp0 -> dp0_pp2_layer15_attn_allreduce
	dp0_pp2_layer15_attn_tp1 -> dp0_pp2_layer15_attn_allreduce
	dp0_pp2_layer15_attn_tp2 -> dp0_pp2_layer15_attn_allreduce
	dp0_pp2_layer15_attn_tp3 -> dp0_pp2_layer15_attn_allreduce
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert0 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert1 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert2 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert3 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert4 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert5 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert6 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert7 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert8 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert9 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert10 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert11 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert12 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert13 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert14 [style=dashed]
	dp0_pp2_layer15_router -> dp0_pp2_layer15_expert15 [style=dashed]
	dp0_pp2_layer15_expert0 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert1 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert2 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert3 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert4 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert5 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert6 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert7 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert8 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert9 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert10 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert11 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert12 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert13 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert14 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_expert15 -> dp0_pp2_layer15_expert_agg
	dp0_pp2_layer15_attn_allreduce -> dp0_pp2_layer15_router [constraint=false]
	dp0_pp2_layer15_expert_agg -> dp0_pp2_layer16_attn_tp0 [constraint=false]
	dp0_pp2_layer16_attn_tp0 -> dp0_pp2_layer16_attn_allreduce
	dp0_pp2_layer16_attn_tp1 -> dp0_pp2_layer16_attn_allreduce
	dp0_pp2_layer16_attn_tp2 -> dp0_pp2_layer16_attn_allreduce
	dp0_pp2_layer16_attn_tp3 -> dp0_pp2_layer16_attn_allreduce
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert0 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert1 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert2 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert3 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert4 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert5 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert6 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert7 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert8 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert9 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert10 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert11 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert12 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert13 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert14 [style=dashed]
	dp0_pp2_layer16_router -> dp0_pp2_layer16_expert15 [style=dashed]
	dp0_pp2_layer16_expert0 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert1 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert2 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert3 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert4 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert5 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert6 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert7 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert8 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert9 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert10 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert11 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert12 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert13 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert14 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_expert15 -> dp0_pp2_layer16_expert_agg
	dp0_pp2_layer16_attn_allreduce -> dp0_pp2_layer16_router [constraint=false]
	subgraph cluster_dp_0 {
		bgcolor=lightgray label="DP Replica 0 (GPUs 0-31)" style=rounded
		subgraph cluster_pp1_dp0 {
			bgcolor=lightcyan label="PP Stage 1: Layers 1-8 (GPUs 0-15)" style=rounded
			subgraph cluster_dp0_pp1_layer1_attn {
				bgcolor=lightpink label="Layer 1 Attention (TP=4)" style=rounded
				dp0_pp1_layer1_attn_tp0 [label="Attention TP0\nGPU 0\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_attn_tp1 [label="Attention TP1\nGPU 1\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_attn_tp2 [label="Attention TP2\nGPU 2\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_attn_tp3 [label="Attention TP3\nGPU 3\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_attn_allreduce [label="AllReduce Attention\nGPUs 0-3\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp1_layer1_moe {
				bgcolor=lightyellow label="Layer 1 MoE (EP=16)" style=rounded
				dp0_pp1_layer1_router [label="Router\nGPU 0\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp1_layer1_expert0 [label="Expert 0\nGPU 0\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert1 [label="Expert 1\nGPU 1\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert2 [label="Expert 2\nGPU 2\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert3 [label="Expert 3\nGPU 3\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert4 [label="Expert 4\nGPU 4\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert5 [label="Expert 5\nGPU 5\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert6 [label="Expert 6\nGPU 6\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert7 [label="Expert 7\nGPU 7\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert8 [label="Expert 8\nGPU 8\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert9 [label="Expert 9\nGPU 9\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert10 [label="Expert 10\nGPU 10\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert11 [label="Expert 11\nGPU 11\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert12 [label="Expert 12\nGPU 12\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert13 [label="Expert 13\nGPU 13\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert14 [label="Expert 14\nGPU 14\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert15 [label="Expert 15\nGPU 15\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer1_expert_agg [label="Expert Aggregation\nGPUs 0-15\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp1_layer2_attn {
				bgcolor=lightpink label="Layer 2 Attention (TP=4)" style=rounded
				dp0_pp1_layer2_attn_tp0 [label="Attention TP0\nGPU 0\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_attn_tp1 [label="Attention TP1\nGPU 1\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_attn_tp2 [label="Attention TP2\nGPU 2\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_attn_tp3 [label="Attention TP3\nGPU 3\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_attn_allreduce [label="AllReduce Attention\nGPUs 0-3\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp1_layer2_moe {
				bgcolor=lightyellow label="Layer 2 MoE (EP=16)" style=rounded
				dp0_pp1_layer2_router [label="Router\nGPU 0\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp1_layer2_expert0 [label="Expert 0\nGPU 0\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert1 [label="Expert 1\nGPU 1\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert2 [label="Expert 2\nGPU 2\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert3 [label="Expert 3\nGPU 3\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert4 [label="Expert 4\nGPU 4\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert5 [label="Expert 5\nGPU 5\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert6 [label="Expert 6\nGPU 6\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert7 [label="Expert 7\nGPU 7\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert8 [label="Expert 8\nGPU 8\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert9 [label="Expert 9\nGPU 9\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert10 [label="Expert 10\nGPU 10\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert11 [label="Expert 11\nGPU 11\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert12 [label="Expert 12\nGPU 12\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert13 [label="Expert 13\nGPU 13\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert14 [label="Expert 14\nGPU 14\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert15 [label="Expert 15\nGPU 15\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer2_expert_agg [label="Expert Aggregation\nGPUs 0-15\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp1_layer3_attn {
				bgcolor=lightpink label="Layer 3 Attention (TP=4)" style=rounded
				dp0_pp1_layer3_attn_tp0 [label="Attention TP0\nGPU 0\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_attn_tp1 [label="Attention TP1\nGPU 1\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_attn_tp2 [label="Attention TP2\nGPU 2\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_attn_tp3 [label="Attention TP3\nGPU 3\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_attn_allreduce [label="AllReduce Attention\nGPUs 0-3\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp1_layer3_moe {
				bgcolor=lightyellow label="Layer 3 MoE (EP=16)" style=rounded
				dp0_pp1_layer3_router [label="Router\nGPU 0\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp1_layer3_expert0 [label="Expert 0\nGPU 0\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert1 [label="Expert 1\nGPU 1\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert2 [label="Expert 2\nGPU 2\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert3 [label="Expert 3\nGPU 3\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert4 [label="Expert 4\nGPU 4\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert5 [label="Expert 5\nGPU 5\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert6 [label="Expert 6\nGPU 6\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert7 [label="Expert 7\nGPU 7\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert8 [label="Expert 8\nGPU 8\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert9 [label="Expert 9\nGPU 9\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert10 [label="Expert 10\nGPU 10\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert11 [label="Expert 11\nGPU 11\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert12 [label="Expert 12\nGPU 12\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert13 [label="Expert 13\nGPU 13\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert14 [label="Expert 14\nGPU 14\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert15 [label="Expert 15\nGPU 15\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer3_expert_agg [label="Expert Aggregation\nGPUs 0-15\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp1_layer4_attn {
				bgcolor=lightpink label="Layer 4 Attention (TP=4)" style=rounded
				dp0_pp1_layer4_attn_tp0 [label="Attention TP0\nGPU 0\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_attn_tp1 [label="Attention TP1\nGPU 1\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_attn_tp2 [label="Attention TP2\nGPU 2\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_attn_tp3 [label="Attention TP3\nGPU 3\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_attn_allreduce [label="AllReduce Attention\nGPUs 0-3\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp1_layer4_moe {
				bgcolor=lightyellow label="Layer 4 MoE (EP=16)" style=rounded
				dp0_pp1_layer4_router [label="Router\nGPU 0\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp1_layer4_expert0 [label="Expert 0\nGPU 0\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert1 [label="Expert 1\nGPU 1\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert2 [label="Expert 2\nGPU 2\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert3 [label="Expert 3\nGPU 3\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert4 [label="Expert 4\nGPU 4\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert5 [label="Expert 5\nGPU 5\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert6 [label="Expert 6\nGPU 6\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert7 [label="Expert 7\nGPU 7\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert8 [label="Expert 8\nGPU 8\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert9 [label="Expert 9\nGPU 9\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert10 [label="Expert 10\nGPU 10\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert11 [label="Expert 11\nGPU 11\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert12 [label="Expert 12\nGPU 12\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert13 [label="Expert 13\nGPU 13\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert14 [label="Expert 14\nGPU 14\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert15 [label="Expert 15\nGPU 15\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer4_expert_agg [label="Expert Aggregation\nGPUs 0-15\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp1_layer5_attn {
				bgcolor=lightpink label="Layer 5 Attention (TP=4)" style=rounded
				dp0_pp1_layer5_attn_tp0 [label="Attention TP0\nGPU 0\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_attn_tp1 [label="Attention TP1\nGPU 1\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_attn_tp2 [label="Attention TP2\nGPU 2\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_attn_tp3 [label="Attention TP3\nGPU 3\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_attn_allreduce [label="AllReduce Attention\nGPUs 0-3\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp1_layer5_moe {
				bgcolor=lightyellow label="Layer 5 MoE (EP=16)" style=rounded
				dp0_pp1_layer5_router [label="Router\nGPU 0\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp1_layer5_expert0 [label="Expert 0\nGPU 0\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert1 [label="Expert 1\nGPU 1\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert2 [label="Expert 2\nGPU 2\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert3 [label="Expert 3\nGPU 3\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert4 [label="Expert 4\nGPU 4\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert5 [label="Expert 5\nGPU 5\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert6 [label="Expert 6\nGPU 6\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert7 [label="Expert 7\nGPU 7\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert8 [label="Expert 8\nGPU 8\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert9 [label="Expert 9\nGPU 9\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert10 [label="Expert 10\nGPU 10\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert11 [label="Expert 11\nGPU 11\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert12 [label="Expert 12\nGPU 12\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert13 [label="Expert 13\nGPU 13\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert14 [label="Expert 14\nGPU 14\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert15 [label="Expert 15\nGPU 15\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer5_expert_agg [label="Expert Aggregation\nGPUs 0-15\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp1_layer6_attn {
				bgcolor=lightpink label="Layer 6 Attention (TP=4)" style=rounded
				dp0_pp1_layer6_attn_tp0 [label="Attention TP0\nGPU 0\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_attn_tp1 [label="Attention TP1\nGPU 1\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_attn_tp2 [label="Attention TP2\nGPU 2\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_attn_tp3 [label="Attention TP3\nGPU 3\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_attn_allreduce [label="AllReduce Attention\nGPUs 0-3\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp1_layer6_moe {
				bgcolor=lightyellow label="Layer 6 MoE (EP=16)" style=rounded
				dp0_pp1_layer6_router [label="Router\nGPU 0\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp1_layer6_expert0 [label="Expert 0\nGPU 0\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert1 [label="Expert 1\nGPU 1\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert2 [label="Expert 2\nGPU 2\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert3 [label="Expert 3\nGPU 3\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert4 [label="Expert 4\nGPU 4\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert5 [label="Expert 5\nGPU 5\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert6 [label="Expert 6\nGPU 6\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert7 [label="Expert 7\nGPU 7\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert8 [label="Expert 8\nGPU 8\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert9 [label="Expert 9\nGPU 9\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert10 [label="Expert 10\nGPU 10\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert11 [label="Expert 11\nGPU 11\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert12 [label="Expert 12\nGPU 12\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert13 [label="Expert 13\nGPU 13\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert14 [label="Expert 14\nGPU 14\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert15 [label="Expert 15\nGPU 15\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer6_expert_agg [label="Expert Aggregation\nGPUs 0-15\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp1_layer7_attn {
				bgcolor=lightpink label="Layer 7 Attention (TP=4)" style=rounded
				dp0_pp1_layer7_attn_tp0 [label="Attention TP0\nGPU 0\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_attn_tp1 [label="Attention TP1\nGPU 1\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_attn_tp2 [label="Attention TP2\nGPU 2\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_attn_tp3 [label="Attention TP3\nGPU 3\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_attn_allreduce [label="AllReduce Attention\nGPUs 0-3\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp1_layer7_moe {
				bgcolor=lightyellow label="Layer 7 MoE (EP=16)" style=rounded
				dp0_pp1_layer7_router [label="Router\nGPU 0\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp1_layer7_expert0 [label="Expert 0\nGPU 0\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert1 [label="Expert 1\nGPU 1\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert2 [label="Expert 2\nGPU 2\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert3 [label="Expert 3\nGPU 3\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert4 [label="Expert 4\nGPU 4\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert5 [label="Expert 5\nGPU 5\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert6 [label="Expert 6\nGPU 6\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert7 [label="Expert 7\nGPU 7\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert8 [label="Expert 8\nGPU 8\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert9 [label="Expert 9\nGPU 9\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert10 [label="Expert 10\nGPU 10\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert11 [label="Expert 11\nGPU 11\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert12 [label="Expert 12\nGPU 12\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert13 [label="Expert 13\nGPU 13\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert14 [label="Expert 14\nGPU 14\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert15 [label="Expert 15\nGPU 15\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer7_expert_agg [label="Expert Aggregation\nGPUs 0-15\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp1_layer8_attn {
				bgcolor=lightpink label="Layer 8 Attention (TP=4)" style=rounded
				dp0_pp1_layer8_attn_tp0 [label="Attention TP0\nGPU 0\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_attn_tp1 [label="Attention TP1\nGPU 1\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_attn_tp2 [label="Attention TP2\nGPU 2\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_attn_tp3 [label="Attention TP3\nGPU 3\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_attn_allreduce [label="AllReduce Attention\nGPUs 0-3\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp1_layer8_moe {
				bgcolor=lightyellow label="Layer 8 MoE (EP=16)" style=rounded
				dp0_pp1_layer8_router [label="Router\nGPU 0\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp1_layer8_expert0 [label="Expert 0\nGPU 0\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert1 [label="Expert 1\nGPU 1\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert2 [label="Expert 2\nGPU 2\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert3 [label="Expert 3\nGPU 3\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert4 [label="Expert 4\nGPU 4\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert5 [label="Expert 5\nGPU 5\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert6 [label="Expert 6\nGPU 6\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert7 [label="Expert 7\nGPU 7\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert8 [label="Expert 8\nGPU 8\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert9 [label="Expert 9\nGPU 9\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert10 [label="Expert 10\nGPU 10\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert11 [label="Expert 11\nGPU 11\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert12 [label="Expert 12\nGPU 12\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert13 [label="Expert 13\nGPU 13\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert14 [label="Expert 14\nGPU 14\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert15 [label="Expert 15\nGPU 15\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp1_layer8_expert_agg [label="Expert Aggregation\nGPUs 0-15\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
		}
		subgraph cluster_pp2_dp0 {
			bgcolor=lightcyan label="PP Stage 2: Layers 9-16 (GPUs 16-31)" style=rounded
			subgraph cluster_dp0_pp2_layer9_attn {
				bgcolor=lightpink label="Layer 9 Attention (TP=4)" style=rounded
				dp0_pp2_layer9_attn_tp0 [label="Attention TP0\nGPU 16\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_attn_tp1 [label="Attention TP1\nGPU 17\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_attn_tp2 [label="Attention TP2\nGPU 18\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_attn_tp3 [label="Attention TP3\nGPU 19\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_attn_allreduce [label="AllReduce Attention\nGPUs 16-19\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp2_layer9_moe {
				bgcolor=lightyellow label="Layer 9 MoE (EP=16)" style=rounded
				dp0_pp2_layer9_router [label="Router\nGPU 16\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp2_layer9_expert0 [label="Expert 0\nGPU 16\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert1 [label="Expert 1\nGPU 17\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert2 [label="Expert 2\nGPU 18\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert3 [label="Expert 3\nGPU 19\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert4 [label="Expert 4\nGPU 20\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert5 [label="Expert 5\nGPU 21\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert6 [label="Expert 6\nGPU 22\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert7 [label="Expert 7\nGPU 23\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert8 [label="Expert 8\nGPU 24\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert9 [label="Expert 9\nGPU 25\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert10 [label="Expert 10\nGPU 26\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert11 [label="Expert 11\nGPU 27\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert12 [label="Expert 12\nGPU 28\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert13 [label="Expert 13\nGPU 29\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert14 [label="Expert 14\nGPU 30\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert15 [label="Expert 15\nGPU 31\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer9_expert_agg [label="Expert Aggregation\nGPUs 16-31\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp2_layer10_attn {
				bgcolor=lightpink label="Layer 10 Attention (TP=4)" style=rounded
				dp0_pp2_layer10_attn_tp0 [label="Attention TP0\nGPU 16\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_attn_tp1 [label="Attention TP1\nGPU 17\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_attn_tp2 [label="Attention TP2\nGPU 18\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_attn_tp3 [label="Attention TP3\nGPU 19\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_attn_allreduce [label="AllReduce Attention\nGPUs 16-19\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp2_layer10_moe {
				bgcolor=lightyellow label="Layer 10 MoE (EP=16)" style=rounded
				dp0_pp2_layer10_router [label="Router\nGPU 16\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp2_layer10_expert0 [label="Expert 0\nGPU 16\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert1 [label="Expert 1\nGPU 17\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert2 [label="Expert 2\nGPU 18\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert3 [label="Expert 3\nGPU 19\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert4 [label="Expert 4\nGPU 20\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert5 [label="Expert 5\nGPU 21\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert6 [label="Expert 6\nGPU 22\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert7 [label="Expert 7\nGPU 23\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert8 [label="Expert 8\nGPU 24\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert9 [label="Expert 9\nGPU 25\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert10 [label="Expert 10\nGPU 26\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert11 [label="Expert 11\nGPU 27\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert12 [label="Expert 12\nGPU 28\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert13 [label="Expert 13\nGPU 29\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert14 [label="Expert 14\nGPU 30\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert15 [label="Expert 15\nGPU 31\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer10_expert_agg [label="Expert Aggregation\nGPUs 16-31\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp2_layer11_attn {
				bgcolor=lightpink label="Layer 11 Attention (TP=4)" style=rounded
				dp0_pp2_layer11_attn_tp0 [label="Attention TP0\nGPU 16\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_attn_tp1 [label="Attention TP1\nGPU 17\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_attn_tp2 [label="Attention TP2\nGPU 18\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_attn_tp3 [label="Attention TP3\nGPU 19\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_attn_allreduce [label="AllReduce Attention\nGPUs 16-19\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp2_layer11_moe {
				bgcolor=lightyellow label="Layer 11 MoE (EP=16)" style=rounded
				dp0_pp2_layer11_router [label="Router\nGPU 16\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp2_layer11_expert0 [label="Expert 0\nGPU 16\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert1 [label="Expert 1\nGPU 17\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert2 [label="Expert 2\nGPU 18\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert3 [label="Expert 3\nGPU 19\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert4 [label="Expert 4\nGPU 20\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert5 [label="Expert 5\nGPU 21\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert6 [label="Expert 6\nGPU 22\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert7 [label="Expert 7\nGPU 23\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert8 [label="Expert 8\nGPU 24\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert9 [label="Expert 9\nGPU 25\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert10 [label="Expert 10\nGPU 26\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert11 [label="Expert 11\nGPU 27\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert12 [label="Expert 12\nGPU 28\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert13 [label="Expert 13\nGPU 29\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert14 [label="Expert 14\nGPU 30\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert15 [label="Expert 15\nGPU 31\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer11_expert_agg [label="Expert Aggregation\nGPUs 16-31\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp2_layer12_attn {
				bgcolor=lightpink label="Layer 12 Attention (TP=4)" style=rounded
				dp0_pp2_layer12_attn_tp0 [label="Attention TP0\nGPU 16\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_attn_tp1 [label="Attention TP1\nGPU 17\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_attn_tp2 [label="Attention TP2\nGPU 18\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_attn_tp3 [label="Attention TP3\nGPU 19\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_attn_allreduce [label="AllReduce Attention\nGPUs 16-19\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp2_layer12_moe {
				bgcolor=lightyellow label="Layer 12 MoE (EP=16)" style=rounded
				dp0_pp2_layer12_router [label="Router\nGPU 16\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp2_layer12_expert0 [label="Expert 0\nGPU 16\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert1 [label="Expert 1\nGPU 17\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert2 [label="Expert 2\nGPU 18\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert3 [label="Expert 3\nGPU 19\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert4 [label="Expert 4\nGPU 20\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert5 [label="Expert 5\nGPU 21\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert6 [label="Expert 6\nGPU 22\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert7 [label="Expert 7\nGPU 23\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert8 [label="Expert 8\nGPU 24\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert9 [label="Expert 9\nGPU 25\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert10 [label="Expert 10\nGPU 26\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert11 [label="Expert 11\nGPU 27\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert12 [label="Expert 12\nGPU 28\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert13 [label="Expert 13\nGPU 29\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert14 [label="Expert 14\nGPU 30\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert15 [label="Expert 15\nGPU 31\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer12_expert_agg [label="Expert Aggregation\nGPUs 16-31\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp2_layer13_attn {
				bgcolor=lightpink label="Layer 13 Attention (TP=4)" style=rounded
				dp0_pp2_layer13_attn_tp0 [label="Attention TP0\nGPU 16\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_attn_tp1 [label="Attention TP1\nGPU 17\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_attn_tp2 [label="Attention TP2\nGPU 18\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_attn_tp3 [label="Attention TP3\nGPU 19\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_attn_allreduce [label="AllReduce Attention\nGPUs 16-19\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp2_layer13_moe {
				bgcolor=lightyellow label="Layer 13 MoE (EP=16)" style=rounded
				dp0_pp2_layer13_router [label="Router\nGPU 16\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp2_layer13_expert0 [label="Expert 0\nGPU 16\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert1 [label="Expert 1\nGPU 17\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert2 [label="Expert 2\nGPU 18\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert3 [label="Expert 3\nGPU 19\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert4 [label="Expert 4\nGPU 20\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert5 [label="Expert 5\nGPU 21\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert6 [label="Expert 6\nGPU 22\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert7 [label="Expert 7\nGPU 23\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert8 [label="Expert 8\nGPU 24\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert9 [label="Expert 9\nGPU 25\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert10 [label="Expert 10\nGPU 26\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert11 [label="Expert 11\nGPU 27\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert12 [label="Expert 12\nGPU 28\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert13 [label="Expert 13\nGPU 29\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert14 [label="Expert 14\nGPU 30\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert15 [label="Expert 15\nGPU 31\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer13_expert_agg [label="Expert Aggregation\nGPUs 16-31\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp2_layer14_attn {
				bgcolor=lightpink label="Layer 14 Attention (TP=4)" style=rounded
				dp0_pp2_layer14_attn_tp0 [label="Attention TP0\nGPU 16\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_attn_tp1 [label="Attention TP1\nGPU 17\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_attn_tp2 [label="Attention TP2\nGPU 18\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_attn_tp3 [label="Attention TP3\nGPU 19\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_attn_allreduce [label="AllReduce Attention\nGPUs 16-19\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp2_layer14_moe {
				bgcolor=lightyellow label="Layer 14 MoE (EP=16)" style=rounded
				dp0_pp2_layer14_router [label="Router\nGPU 16\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp2_layer14_expert0 [label="Expert 0\nGPU 16\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert1 [label="Expert 1\nGPU 17\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert2 [label="Expert 2\nGPU 18\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert3 [label="Expert 3\nGPU 19\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert4 [label="Expert 4\nGPU 20\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert5 [label="Expert 5\nGPU 21\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert6 [label="Expert 6\nGPU 22\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert7 [label="Expert 7\nGPU 23\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert8 [label="Expert 8\nGPU 24\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert9 [label="Expert 9\nGPU 25\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert10 [label="Expert 10\nGPU 26\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert11 [label="Expert 11\nGPU 27\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert12 [label="Expert 12\nGPU 28\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert13 [label="Expert 13\nGPU 29\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert14 [label="Expert 14\nGPU 30\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert15 [label="Expert 15\nGPU 31\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer14_expert_agg [label="Expert Aggregation\nGPUs 16-31\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp2_layer15_attn {
				bgcolor=lightpink label="Layer 15 Attention (TP=4)" style=rounded
				dp0_pp2_layer15_attn_tp0 [label="Attention TP0\nGPU 16\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_attn_tp1 [label="Attention TP1\nGPU 17\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_attn_tp2 [label="Attention TP2\nGPU 18\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_attn_tp3 [label="Attention TP3\nGPU 19\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_attn_allreduce [label="AllReduce Attention\nGPUs 16-19\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp2_layer15_moe {
				bgcolor=lightyellow label="Layer 15 MoE (EP=16)" style=rounded
				dp0_pp2_layer15_router [label="Router\nGPU 16\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp2_layer15_expert0 [label="Expert 0\nGPU 16\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert1 [label="Expert 1\nGPU 17\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert2 [label="Expert 2\nGPU 18\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert3 [label="Expert 3\nGPU 19\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert4 [label="Expert 4\nGPU 20\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert5 [label="Expert 5\nGPU 21\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert6 [label="Expert 6\nGPU 22\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert7 [label="Expert 7\nGPU 23\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert8 [label="Expert 8\nGPU 24\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert9 [label="Expert 9\nGPU 25\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert10 [label="Expert 10\nGPU 26\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert11 [label="Expert 11\nGPU 27\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert12 [label="Expert 12\nGPU 28\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert13 [label="Expert 13\nGPU 29\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert14 [label="Expert 14\nGPU 30\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert15 [label="Expert 15\nGPU 31\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer15_expert_agg [label="Expert Aggregation\nGPUs 16-31\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp0_pp2_layer16_attn {
				bgcolor=lightpink label="Layer 16 Attention (TP=4)" style=rounded
				dp0_pp2_layer16_attn_tp0 [label="Attention TP0\nGPU 16\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_attn_tp1 [label="Attention TP1\nGPU 17\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_attn_tp2 [label="Attention TP2\nGPU 18\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_attn_tp3 [label="Attention TP3\nGPU 19\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_attn_allreduce [label="AllReduce Attention\nGPUs 16-19\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp0_pp2_layer16_moe {
				bgcolor=lightyellow label="Layer 16 MoE (EP=16)" style=rounded
				dp0_pp2_layer16_router [label="Router\nGPU 16\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp0_pp2_layer16_expert0 [label="Expert 0\nGPU 16\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert1 [label="Expert 1\nGPU 17\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert2 [label="Expert 2\nGPU 18\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert3 [label="Expert 3\nGPU 19\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert4 [label="Expert 4\nGPU 20\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert5 [label="Expert 5\nGPU 21\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert6 [label="Expert 6\nGPU 22\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert7 [label="Expert 7\nGPU 23\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert8 [label="Expert 8\nGPU 24\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert9 [label="Expert 9\nGPU 25\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert10 [label="Expert 10\nGPU 26\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert11 [label="Expert 11\nGPU 27\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert12 [label="Expert 12\nGPU 28\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert13 [label="Expert 13\nGPU 29\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert14 [label="Expert 14\nGPU 30\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert15 [label="Expert 15\nGPU 31\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp0_pp2_layer16_expert_agg [label="Expert Aggregation\nGPUs 16-31\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
		}
	}
	dp1_pp1_layer1_attn_tp0 -> dp1_pp1_layer1_attn_allreduce
	dp1_pp1_layer1_attn_tp1 -> dp1_pp1_layer1_attn_allreduce
	dp1_pp1_layer1_attn_tp2 -> dp1_pp1_layer1_attn_allreduce
	dp1_pp1_layer1_attn_tp3 -> dp1_pp1_layer1_attn_allreduce
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert0 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert1 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert2 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert3 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert4 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert5 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert6 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert7 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert8 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert9 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert10 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert11 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert12 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert13 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert14 [style=dashed]
	dp1_pp1_layer1_router -> dp1_pp1_layer1_expert15 [style=dashed]
	dp1_pp1_layer1_expert0 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert1 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert2 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert3 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert4 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert5 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert6 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert7 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert8 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert9 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert10 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert11 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert12 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert13 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert14 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_expert15 -> dp1_pp1_layer1_expert_agg
	dp1_pp1_layer1_attn_allreduce -> dp1_pp1_layer1_router [constraint=false]
	dp1_pp1_layer1_expert_agg -> dp1_pp1_layer2_attn_tp0 [constraint=false]
	dp1_pp1_layer2_attn_tp0 -> dp1_pp1_layer2_attn_allreduce
	dp1_pp1_layer2_attn_tp1 -> dp1_pp1_layer2_attn_allreduce
	dp1_pp1_layer2_attn_tp2 -> dp1_pp1_layer2_attn_allreduce
	dp1_pp1_layer2_attn_tp3 -> dp1_pp1_layer2_attn_allreduce
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert0 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert1 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert2 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert3 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert4 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert5 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert6 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert7 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert8 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert9 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert10 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert11 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert12 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert13 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert14 [style=dashed]
	dp1_pp1_layer2_router -> dp1_pp1_layer2_expert15 [style=dashed]
	dp1_pp1_layer2_expert0 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert1 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert2 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert3 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert4 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert5 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert6 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert7 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert8 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert9 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert10 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert11 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert12 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert13 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert14 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_expert15 -> dp1_pp1_layer2_expert_agg
	dp1_pp1_layer2_attn_allreduce -> dp1_pp1_layer2_router [constraint=false]
	dp1_pp1_layer2_expert_agg -> dp1_pp1_layer3_attn_tp0 [constraint=false]
	dp1_pp1_layer3_attn_tp0 -> dp1_pp1_layer3_attn_allreduce
	dp1_pp1_layer3_attn_tp1 -> dp1_pp1_layer3_attn_allreduce
	dp1_pp1_layer3_attn_tp2 -> dp1_pp1_layer3_attn_allreduce
	dp1_pp1_layer3_attn_tp3 -> dp1_pp1_layer3_attn_allreduce
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert0 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert1 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert2 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert3 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert4 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert5 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert6 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert7 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert8 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert9 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert10 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert11 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert12 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert13 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert14 [style=dashed]
	dp1_pp1_layer3_router -> dp1_pp1_layer3_expert15 [style=dashed]
	dp1_pp1_layer3_expert0 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert1 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert2 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert3 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert4 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert5 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert6 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert7 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert8 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert9 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert10 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert11 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert12 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert13 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert14 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_expert15 -> dp1_pp1_layer3_expert_agg
	dp1_pp1_layer3_attn_allreduce -> dp1_pp1_layer3_router [constraint=false]
	dp1_pp1_layer3_expert_agg -> dp1_pp1_layer4_attn_tp0 [constraint=false]
	dp1_pp1_layer4_attn_tp0 -> dp1_pp1_layer4_attn_allreduce
	dp1_pp1_layer4_attn_tp1 -> dp1_pp1_layer4_attn_allreduce
	dp1_pp1_layer4_attn_tp2 -> dp1_pp1_layer4_attn_allreduce
	dp1_pp1_layer4_attn_tp3 -> dp1_pp1_layer4_attn_allreduce
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert0 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert1 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert2 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert3 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert4 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert5 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert6 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert7 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert8 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert9 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert10 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert11 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert12 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert13 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert14 [style=dashed]
	dp1_pp1_layer4_router -> dp1_pp1_layer4_expert15 [style=dashed]
	dp1_pp1_layer4_expert0 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert1 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert2 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert3 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert4 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert5 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert6 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert7 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert8 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert9 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert10 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert11 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert12 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert13 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert14 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_expert15 -> dp1_pp1_layer4_expert_agg
	dp1_pp1_layer4_attn_allreduce -> dp1_pp1_layer4_router [constraint=false]
	dp1_pp1_layer4_expert_agg -> dp1_pp1_layer5_attn_tp0 [constraint=false]
	dp1_pp1_layer5_attn_tp0 -> dp1_pp1_layer5_attn_allreduce
	dp1_pp1_layer5_attn_tp1 -> dp1_pp1_layer5_attn_allreduce
	dp1_pp1_layer5_attn_tp2 -> dp1_pp1_layer5_attn_allreduce
	dp1_pp1_layer5_attn_tp3 -> dp1_pp1_layer5_attn_allreduce
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert0 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert1 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert2 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert3 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert4 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert5 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert6 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert7 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert8 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert9 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert10 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert11 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert12 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert13 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert14 [style=dashed]
	dp1_pp1_layer5_router -> dp1_pp1_layer5_expert15 [style=dashed]
	dp1_pp1_layer5_expert0 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert1 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert2 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert3 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert4 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert5 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert6 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert7 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert8 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert9 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert10 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert11 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert12 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert13 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert14 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_expert15 -> dp1_pp1_layer5_expert_agg
	dp1_pp1_layer5_attn_allreduce -> dp1_pp1_layer5_router [constraint=false]
	dp1_pp1_layer5_expert_agg -> dp1_pp1_layer6_attn_tp0 [constraint=false]
	dp1_pp1_layer6_attn_tp0 -> dp1_pp1_layer6_attn_allreduce
	dp1_pp1_layer6_attn_tp1 -> dp1_pp1_layer6_attn_allreduce
	dp1_pp1_layer6_attn_tp2 -> dp1_pp1_layer6_attn_allreduce
	dp1_pp1_layer6_attn_tp3 -> dp1_pp1_layer6_attn_allreduce
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert0 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert1 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert2 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert3 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert4 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert5 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert6 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert7 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert8 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert9 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert10 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert11 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert12 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert13 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert14 [style=dashed]
	dp1_pp1_layer6_router -> dp1_pp1_layer6_expert15 [style=dashed]
	dp1_pp1_layer6_expert0 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert1 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert2 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert3 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert4 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert5 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert6 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert7 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert8 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert9 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert10 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert11 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert12 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert13 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert14 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_expert15 -> dp1_pp1_layer6_expert_agg
	dp1_pp1_layer6_attn_allreduce -> dp1_pp1_layer6_router [constraint=false]
	dp1_pp1_layer6_expert_agg -> dp1_pp1_layer7_attn_tp0 [constraint=false]
	dp1_pp1_layer7_attn_tp0 -> dp1_pp1_layer7_attn_allreduce
	dp1_pp1_layer7_attn_tp1 -> dp1_pp1_layer7_attn_allreduce
	dp1_pp1_layer7_attn_tp2 -> dp1_pp1_layer7_attn_allreduce
	dp1_pp1_layer7_attn_tp3 -> dp1_pp1_layer7_attn_allreduce
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert0 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert1 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert2 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert3 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert4 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert5 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert6 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert7 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert8 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert9 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert10 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert11 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert12 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert13 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert14 [style=dashed]
	dp1_pp1_layer7_router -> dp1_pp1_layer7_expert15 [style=dashed]
	dp1_pp1_layer7_expert0 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert1 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert2 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert3 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert4 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert5 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert6 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert7 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert8 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert9 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert10 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert11 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert12 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert13 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert14 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_expert15 -> dp1_pp1_layer7_expert_agg
	dp1_pp1_layer7_attn_allreduce -> dp1_pp1_layer7_router [constraint=false]
	dp1_pp1_layer7_expert_agg -> dp1_pp1_layer8_attn_tp0 [constraint=false]
	dp1_pp1_layer8_attn_tp0 -> dp1_pp1_layer8_attn_allreduce
	dp1_pp1_layer8_attn_tp1 -> dp1_pp1_layer8_attn_allreduce
	dp1_pp1_layer8_attn_tp2 -> dp1_pp1_layer8_attn_allreduce
	dp1_pp1_layer8_attn_tp3 -> dp1_pp1_layer8_attn_allreduce
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert0 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert1 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert2 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert3 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert4 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert5 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert6 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert7 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert8 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert9 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert10 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert11 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert12 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert13 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert14 [style=dashed]
	dp1_pp1_layer8_router -> dp1_pp1_layer8_expert15 [style=dashed]
	dp1_pp1_layer8_expert0 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert1 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert2 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert3 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert4 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert5 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert6 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert7 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert8 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert9 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert10 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert11 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert12 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert13 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert14 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_expert15 -> dp1_pp1_layer8_expert_agg
	dp1_pp1_layer8_attn_allreduce -> dp1_pp1_layer8_router [constraint=false]
	dp1_pp2_layer9_attn_tp0 -> dp1_pp2_layer9_attn_allreduce
	dp1_pp2_layer9_attn_tp1 -> dp1_pp2_layer9_attn_allreduce
	dp1_pp2_layer9_attn_tp2 -> dp1_pp2_layer9_attn_allreduce
	dp1_pp2_layer9_attn_tp3 -> dp1_pp2_layer9_attn_allreduce
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert0 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert1 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert2 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert3 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert4 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert5 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert6 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert7 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert8 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert9 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert10 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert11 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert12 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert13 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert14 [style=dashed]
	dp1_pp2_layer9_router -> dp1_pp2_layer9_expert15 [style=dashed]
	dp1_pp2_layer9_expert0 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert1 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert2 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert3 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert4 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert5 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert6 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert7 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert8 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert9 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert10 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert11 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert12 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert13 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert14 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_expert15 -> dp1_pp2_layer9_expert_agg
	dp1_pp2_layer9_attn_allreduce -> dp1_pp2_layer9_router [constraint=false]
	dp1_pp2_layer9_expert_agg -> dp1_pp2_layer10_attn_tp0 [constraint=false]
	dp1_pp2_layer10_attn_tp0 -> dp1_pp2_layer10_attn_allreduce
	dp1_pp2_layer10_attn_tp1 -> dp1_pp2_layer10_attn_allreduce
	dp1_pp2_layer10_attn_tp2 -> dp1_pp2_layer10_attn_allreduce
	dp1_pp2_layer10_attn_tp3 -> dp1_pp2_layer10_attn_allreduce
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert0 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert1 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert2 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert3 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert4 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert5 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert6 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert7 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert8 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert9 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert10 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert11 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert12 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert13 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert14 [style=dashed]
	dp1_pp2_layer10_router -> dp1_pp2_layer10_expert15 [style=dashed]
	dp1_pp2_layer10_expert0 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert1 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert2 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert3 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert4 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert5 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert6 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert7 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert8 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert9 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert10 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert11 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert12 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert13 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert14 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_expert15 -> dp1_pp2_layer10_expert_agg
	dp1_pp2_layer10_attn_allreduce -> dp1_pp2_layer10_router [constraint=false]
	dp1_pp2_layer10_expert_agg -> dp1_pp2_layer11_attn_tp0 [constraint=false]
	dp1_pp2_layer11_attn_tp0 -> dp1_pp2_layer11_attn_allreduce
	dp1_pp2_layer11_attn_tp1 -> dp1_pp2_layer11_attn_allreduce
	dp1_pp2_layer11_attn_tp2 -> dp1_pp2_layer11_attn_allreduce
	dp1_pp2_layer11_attn_tp3 -> dp1_pp2_layer11_attn_allreduce
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert0 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert1 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert2 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert3 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert4 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert5 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert6 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert7 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert8 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert9 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert10 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert11 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert12 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert13 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert14 [style=dashed]
	dp1_pp2_layer11_router -> dp1_pp2_layer11_expert15 [style=dashed]
	dp1_pp2_layer11_expert0 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert1 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert2 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert3 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert4 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert5 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert6 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert7 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert8 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert9 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert10 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert11 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert12 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert13 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert14 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_expert15 -> dp1_pp2_layer11_expert_agg
	dp1_pp2_layer11_attn_allreduce -> dp1_pp2_layer11_router [constraint=false]
	dp1_pp2_layer11_expert_agg -> dp1_pp2_layer12_attn_tp0 [constraint=false]
	dp1_pp2_layer12_attn_tp0 -> dp1_pp2_layer12_attn_allreduce
	dp1_pp2_layer12_attn_tp1 -> dp1_pp2_layer12_attn_allreduce
	dp1_pp2_layer12_attn_tp2 -> dp1_pp2_layer12_attn_allreduce
	dp1_pp2_layer12_attn_tp3 -> dp1_pp2_layer12_attn_allreduce
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert0 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert1 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert2 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert3 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert4 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert5 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert6 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert7 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert8 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert9 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert10 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert11 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert12 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert13 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert14 [style=dashed]
	dp1_pp2_layer12_router -> dp1_pp2_layer12_expert15 [style=dashed]
	dp1_pp2_layer12_expert0 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert1 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert2 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert3 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert4 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert5 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert6 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert7 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert8 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert9 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert10 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert11 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert12 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert13 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert14 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_expert15 -> dp1_pp2_layer12_expert_agg
	dp1_pp2_layer12_attn_allreduce -> dp1_pp2_layer12_router [constraint=false]
	dp1_pp2_layer12_expert_agg -> dp1_pp2_layer13_attn_tp0 [constraint=false]
	dp1_pp2_layer13_attn_tp0 -> dp1_pp2_layer13_attn_allreduce
	dp1_pp2_layer13_attn_tp1 -> dp1_pp2_layer13_attn_allreduce
	dp1_pp2_layer13_attn_tp2 -> dp1_pp2_layer13_attn_allreduce
	dp1_pp2_layer13_attn_tp3 -> dp1_pp2_layer13_attn_allreduce
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert0 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert1 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert2 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert3 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert4 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert5 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert6 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert7 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert8 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert9 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert10 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert11 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert12 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert13 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert14 [style=dashed]
	dp1_pp2_layer13_router -> dp1_pp2_layer13_expert15 [style=dashed]
	dp1_pp2_layer13_expert0 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert1 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert2 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert3 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert4 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert5 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert6 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert7 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert8 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert9 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert10 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert11 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert12 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert13 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert14 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_expert15 -> dp1_pp2_layer13_expert_agg
	dp1_pp2_layer13_attn_allreduce -> dp1_pp2_layer13_router [constraint=false]
	dp1_pp2_layer13_expert_agg -> dp1_pp2_layer14_attn_tp0 [constraint=false]
	dp1_pp2_layer14_attn_tp0 -> dp1_pp2_layer14_attn_allreduce
	dp1_pp2_layer14_attn_tp1 -> dp1_pp2_layer14_attn_allreduce
	dp1_pp2_layer14_attn_tp2 -> dp1_pp2_layer14_attn_allreduce
	dp1_pp2_layer14_attn_tp3 -> dp1_pp2_layer14_attn_allreduce
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert0 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert1 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert2 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert3 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert4 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert5 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert6 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert7 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert8 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert9 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert10 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert11 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert12 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert13 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert14 [style=dashed]
	dp1_pp2_layer14_router -> dp1_pp2_layer14_expert15 [style=dashed]
	dp1_pp2_layer14_expert0 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert1 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert2 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert3 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert4 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert5 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert6 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert7 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert8 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert9 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert10 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert11 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert12 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert13 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert14 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_expert15 -> dp1_pp2_layer14_expert_agg
	dp1_pp2_layer14_attn_allreduce -> dp1_pp2_layer14_router [constraint=false]
	dp1_pp2_layer14_expert_agg -> dp1_pp2_layer15_attn_tp0 [constraint=false]
	dp1_pp2_layer15_attn_tp0 -> dp1_pp2_layer15_attn_allreduce
	dp1_pp2_layer15_attn_tp1 -> dp1_pp2_layer15_attn_allreduce
	dp1_pp2_layer15_attn_tp2 -> dp1_pp2_layer15_attn_allreduce
	dp1_pp2_layer15_attn_tp3 -> dp1_pp2_layer15_attn_allreduce
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert0 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert1 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert2 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert3 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert4 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert5 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert6 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert7 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert8 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert9 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert10 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert11 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert12 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert13 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert14 [style=dashed]
	dp1_pp2_layer15_router -> dp1_pp2_layer15_expert15 [style=dashed]
	dp1_pp2_layer15_expert0 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert1 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert2 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert3 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert4 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert5 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert6 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert7 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert8 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert9 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert10 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert11 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert12 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert13 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert14 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_expert15 -> dp1_pp2_layer15_expert_agg
	dp1_pp2_layer15_attn_allreduce -> dp1_pp2_layer15_router [constraint=false]
	dp1_pp2_layer15_expert_agg -> dp1_pp2_layer16_attn_tp0 [constraint=false]
	dp1_pp2_layer16_attn_tp0 -> dp1_pp2_layer16_attn_allreduce
	dp1_pp2_layer16_attn_tp1 -> dp1_pp2_layer16_attn_allreduce
	dp1_pp2_layer16_attn_tp2 -> dp1_pp2_layer16_attn_allreduce
	dp1_pp2_layer16_attn_tp3 -> dp1_pp2_layer16_attn_allreduce
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert0 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert1 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert2 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert3 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert4 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert5 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert6 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert7 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert8 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert9 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert10 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert11 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert12 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert13 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert14 [style=dashed]
	dp1_pp2_layer16_router -> dp1_pp2_layer16_expert15 [style=dashed]
	dp1_pp2_layer16_expert0 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert1 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert2 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert3 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert4 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert5 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert6 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert7 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert8 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert9 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert10 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert11 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert12 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert13 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert14 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_expert15 -> dp1_pp2_layer16_expert_agg
	dp1_pp2_layer16_attn_allreduce -> dp1_pp2_layer16_router [constraint=false]
	subgraph cluster_dp_1 {
		bgcolor=lightgray label="DP Replica 1 (GPUs 32-63)" style=rounded
		subgraph cluster_pp1_dp1 {
			bgcolor=lightcyan label="PP Stage 1: Layers 1-8 (GPUs 32-47)" style=rounded
			subgraph cluster_dp1_pp1_layer1_attn {
				bgcolor=lightpink label="Layer 1 Attention (TP=4)" style=rounded
				dp1_pp1_layer1_attn_tp0 [label="Attention TP0\nGPU 32\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_attn_tp1 [label="Attention TP1\nGPU 33\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_attn_tp2 [label="Attention TP2\nGPU 34\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_attn_tp3 [label="Attention TP3\nGPU 35\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_attn_allreduce [label="AllReduce Attention\nGPUs 32-35\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp1_layer1_moe {
				bgcolor=lightyellow label="Layer 1 MoE (EP=16)" style=rounded
				dp1_pp1_layer1_router [label="Router\nGPU 32\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp1_layer1_expert0 [label="Expert 0\nGPU 32\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert1 [label="Expert 1\nGPU 33\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert2 [label="Expert 2\nGPU 34\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert3 [label="Expert 3\nGPU 35\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert4 [label="Expert 4\nGPU 36\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert5 [label="Expert 5\nGPU 37\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert6 [label="Expert 6\nGPU 38\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert7 [label="Expert 7\nGPU 39\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert8 [label="Expert 8\nGPU 40\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert9 [label="Expert 9\nGPU 41\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert10 [label="Expert 10\nGPU 42\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert11 [label="Expert 11\nGPU 43\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert12 [label="Expert 12\nGPU 44\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert13 [label="Expert 13\nGPU 45\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert14 [label="Expert 14\nGPU 46\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert15 [label="Expert 15\nGPU 47\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer1_expert_agg [label="Expert Aggregation\nGPUs 32-47\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp1_layer2_attn {
				bgcolor=lightpink label="Layer 2 Attention (TP=4)" style=rounded
				dp1_pp1_layer2_attn_tp0 [label="Attention TP0\nGPU 32\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_attn_tp1 [label="Attention TP1\nGPU 33\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_attn_tp2 [label="Attention TP2\nGPU 34\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_attn_tp3 [label="Attention TP3\nGPU 35\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_attn_allreduce [label="AllReduce Attention\nGPUs 32-35\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp1_layer2_moe {
				bgcolor=lightyellow label="Layer 2 MoE (EP=16)" style=rounded
				dp1_pp1_layer2_router [label="Router\nGPU 32\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp1_layer2_expert0 [label="Expert 0\nGPU 32\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert1 [label="Expert 1\nGPU 33\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert2 [label="Expert 2\nGPU 34\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert3 [label="Expert 3\nGPU 35\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert4 [label="Expert 4\nGPU 36\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert5 [label="Expert 5\nGPU 37\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert6 [label="Expert 6\nGPU 38\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert7 [label="Expert 7\nGPU 39\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert8 [label="Expert 8\nGPU 40\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert9 [label="Expert 9\nGPU 41\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert10 [label="Expert 10\nGPU 42\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert11 [label="Expert 11\nGPU 43\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert12 [label="Expert 12\nGPU 44\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert13 [label="Expert 13\nGPU 45\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert14 [label="Expert 14\nGPU 46\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert15 [label="Expert 15\nGPU 47\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer2_expert_agg [label="Expert Aggregation\nGPUs 32-47\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp1_layer3_attn {
				bgcolor=lightpink label="Layer 3 Attention (TP=4)" style=rounded
				dp1_pp1_layer3_attn_tp0 [label="Attention TP0\nGPU 32\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_attn_tp1 [label="Attention TP1\nGPU 33\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_attn_tp2 [label="Attention TP2\nGPU 34\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_attn_tp3 [label="Attention TP3\nGPU 35\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_attn_allreduce [label="AllReduce Attention\nGPUs 32-35\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp1_layer3_moe {
				bgcolor=lightyellow label="Layer 3 MoE (EP=16)" style=rounded
				dp1_pp1_layer3_router [label="Router\nGPU 32\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp1_layer3_expert0 [label="Expert 0\nGPU 32\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert1 [label="Expert 1\nGPU 33\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert2 [label="Expert 2\nGPU 34\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert3 [label="Expert 3\nGPU 35\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert4 [label="Expert 4\nGPU 36\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert5 [label="Expert 5\nGPU 37\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert6 [label="Expert 6\nGPU 38\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert7 [label="Expert 7\nGPU 39\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert8 [label="Expert 8\nGPU 40\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert9 [label="Expert 9\nGPU 41\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert10 [label="Expert 10\nGPU 42\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert11 [label="Expert 11\nGPU 43\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert12 [label="Expert 12\nGPU 44\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert13 [label="Expert 13\nGPU 45\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert14 [label="Expert 14\nGPU 46\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert15 [label="Expert 15\nGPU 47\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer3_expert_agg [label="Expert Aggregation\nGPUs 32-47\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp1_layer4_attn {
				bgcolor=lightpink label="Layer 4 Attention (TP=4)" style=rounded
				dp1_pp1_layer4_attn_tp0 [label="Attention TP0\nGPU 32\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_attn_tp1 [label="Attention TP1\nGPU 33\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_attn_tp2 [label="Attention TP2\nGPU 34\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_attn_tp3 [label="Attention TP3\nGPU 35\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_attn_allreduce [label="AllReduce Attention\nGPUs 32-35\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp1_layer4_moe {
				bgcolor=lightyellow label="Layer 4 MoE (EP=16)" style=rounded
				dp1_pp1_layer4_router [label="Router\nGPU 32\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp1_layer4_expert0 [label="Expert 0\nGPU 32\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert1 [label="Expert 1\nGPU 33\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert2 [label="Expert 2\nGPU 34\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert3 [label="Expert 3\nGPU 35\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert4 [label="Expert 4\nGPU 36\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert5 [label="Expert 5\nGPU 37\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert6 [label="Expert 6\nGPU 38\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert7 [label="Expert 7\nGPU 39\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert8 [label="Expert 8\nGPU 40\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert9 [label="Expert 9\nGPU 41\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert10 [label="Expert 10\nGPU 42\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert11 [label="Expert 11\nGPU 43\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert12 [label="Expert 12\nGPU 44\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert13 [label="Expert 13\nGPU 45\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert14 [label="Expert 14\nGPU 46\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert15 [label="Expert 15\nGPU 47\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer4_expert_agg [label="Expert Aggregation\nGPUs 32-47\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp1_layer5_attn {
				bgcolor=lightpink label="Layer 5 Attention (TP=4)" style=rounded
				dp1_pp1_layer5_attn_tp0 [label="Attention TP0\nGPU 32\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_attn_tp1 [label="Attention TP1\nGPU 33\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_attn_tp2 [label="Attention TP2\nGPU 34\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_attn_tp3 [label="Attention TP3\nGPU 35\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_attn_allreduce [label="AllReduce Attention\nGPUs 32-35\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp1_layer5_moe {
				bgcolor=lightyellow label="Layer 5 MoE (EP=16)" style=rounded
				dp1_pp1_layer5_router [label="Router\nGPU 32\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp1_layer5_expert0 [label="Expert 0\nGPU 32\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert1 [label="Expert 1\nGPU 33\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert2 [label="Expert 2\nGPU 34\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert3 [label="Expert 3\nGPU 35\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert4 [label="Expert 4\nGPU 36\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert5 [label="Expert 5\nGPU 37\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert6 [label="Expert 6\nGPU 38\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert7 [label="Expert 7\nGPU 39\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert8 [label="Expert 8\nGPU 40\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert9 [label="Expert 9\nGPU 41\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert10 [label="Expert 10\nGPU 42\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert11 [label="Expert 11\nGPU 43\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert12 [label="Expert 12\nGPU 44\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert13 [label="Expert 13\nGPU 45\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert14 [label="Expert 14\nGPU 46\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert15 [label="Expert 15\nGPU 47\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer5_expert_agg [label="Expert Aggregation\nGPUs 32-47\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp1_layer6_attn {
				bgcolor=lightpink label="Layer 6 Attention (TP=4)" style=rounded
				dp1_pp1_layer6_attn_tp0 [label="Attention TP0\nGPU 32\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_attn_tp1 [label="Attention TP1\nGPU 33\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_attn_tp2 [label="Attention TP2\nGPU 34\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_attn_tp3 [label="Attention TP3\nGPU 35\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_attn_allreduce [label="AllReduce Attention\nGPUs 32-35\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp1_layer6_moe {
				bgcolor=lightyellow label="Layer 6 MoE (EP=16)" style=rounded
				dp1_pp1_layer6_router [label="Router\nGPU 32\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp1_layer6_expert0 [label="Expert 0\nGPU 32\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert1 [label="Expert 1\nGPU 33\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert2 [label="Expert 2\nGPU 34\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert3 [label="Expert 3\nGPU 35\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert4 [label="Expert 4\nGPU 36\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert5 [label="Expert 5\nGPU 37\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert6 [label="Expert 6\nGPU 38\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert7 [label="Expert 7\nGPU 39\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert8 [label="Expert 8\nGPU 40\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert9 [label="Expert 9\nGPU 41\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert10 [label="Expert 10\nGPU 42\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert11 [label="Expert 11\nGPU 43\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert12 [label="Expert 12\nGPU 44\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert13 [label="Expert 13\nGPU 45\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert14 [label="Expert 14\nGPU 46\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert15 [label="Expert 15\nGPU 47\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer6_expert_agg [label="Expert Aggregation\nGPUs 32-47\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp1_layer7_attn {
				bgcolor=lightpink label="Layer 7 Attention (TP=4)" style=rounded
				dp1_pp1_layer7_attn_tp0 [label="Attention TP0\nGPU 32\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_attn_tp1 [label="Attention TP1\nGPU 33\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_attn_tp2 [label="Attention TP2\nGPU 34\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_attn_tp3 [label="Attention TP3\nGPU 35\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_attn_allreduce [label="AllReduce Attention\nGPUs 32-35\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp1_layer7_moe {
				bgcolor=lightyellow label="Layer 7 MoE (EP=16)" style=rounded
				dp1_pp1_layer7_router [label="Router\nGPU 32\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp1_layer7_expert0 [label="Expert 0\nGPU 32\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert1 [label="Expert 1\nGPU 33\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert2 [label="Expert 2\nGPU 34\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert3 [label="Expert 3\nGPU 35\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert4 [label="Expert 4\nGPU 36\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert5 [label="Expert 5\nGPU 37\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert6 [label="Expert 6\nGPU 38\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert7 [label="Expert 7\nGPU 39\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert8 [label="Expert 8\nGPU 40\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert9 [label="Expert 9\nGPU 41\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert10 [label="Expert 10\nGPU 42\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert11 [label="Expert 11\nGPU 43\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert12 [label="Expert 12\nGPU 44\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert13 [label="Expert 13\nGPU 45\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert14 [label="Expert 14\nGPU 46\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert15 [label="Expert 15\nGPU 47\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer7_expert_agg [label="Expert Aggregation\nGPUs 32-47\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp1_layer8_attn {
				bgcolor=lightpink label="Layer 8 Attention (TP=4)" style=rounded
				dp1_pp1_layer8_attn_tp0 [label="Attention TP0\nGPU 32\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_attn_tp1 [label="Attention TP1\nGPU 33\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_attn_tp2 [label="Attention TP2\nGPU 34\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_attn_tp3 [label="Attention TP3\nGPU 35\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_attn_allreduce [label="AllReduce Attention\nGPUs 32-35\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp1_layer8_moe {
				bgcolor=lightyellow label="Layer 8 MoE (EP=16)" style=rounded
				dp1_pp1_layer8_router [label="Router\nGPU 32\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp1_layer8_expert0 [label="Expert 0\nGPU 32\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert1 [label="Expert 1\nGPU 33\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert2 [label="Expert 2\nGPU 34\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert3 [label="Expert 3\nGPU 35\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert4 [label="Expert 4\nGPU 36\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert5 [label="Expert 5\nGPU 37\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert6 [label="Expert 6\nGPU 38\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert7 [label="Expert 7\nGPU 39\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert8 [label="Expert 8\nGPU 40\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert9 [label="Expert 9\nGPU 41\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert10 [label="Expert 10\nGPU 42\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert11 [label="Expert 11\nGPU 43\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert12 [label="Expert 12\nGPU 44\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert13 [label="Expert 13\nGPU 45\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert14 [label="Expert 14\nGPU 46\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert15 [label="Expert 15\nGPU 47\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp1_layer8_expert_agg [label="Expert Aggregation\nGPUs 32-47\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
		}
		subgraph cluster_pp2_dp1 {
			bgcolor=lightcyan label="PP Stage 2: Layers 9-16 (GPUs 48-63)" style=rounded
			subgraph cluster_dp1_pp2_layer9_attn {
				bgcolor=lightpink label="Layer 9 Attention (TP=4)" style=rounded
				dp1_pp2_layer9_attn_tp0 [label="Attention TP0\nGPU 48\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_attn_tp1 [label="Attention TP1\nGPU 49\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_attn_tp2 [label="Attention TP2\nGPU 50\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_attn_tp3 [label="Attention TP3\nGPU 51\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_attn_allreduce [label="AllReduce Attention\nGPUs 48-51\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp2_layer9_moe {
				bgcolor=lightyellow label="Layer 9 MoE (EP=16)" style=rounded
				dp1_pp2_layer9_router [label="Router\nGPU 48\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp2_layer9_expert0 [label="Expert 0\nGPU 48\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert1 [label="Expert 1\nGPU 49\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert2 [label="Expert 2\nGPU 50\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert3 [label="Expert 3\nGPU 51\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert4 [label="Expert 4\nGPU 52\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert5 [label="Expert 5\nGPU 53\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert6 [label="Expert 6\nGPU 54\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert7 [label="Expert 7\nGPU 55\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert8 [label="Expert 8\nGPU 56\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert9 [label="Expert 9\nGPU 57\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert10 [label="Expert 10\nGPU 58\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert11 [label="Expert 11\nGPU 59\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert12 [label="Expert 12\nGPU 60\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert13 [label="Expert 13\nGPU 61\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert14 [label="Expert 14\nGPU 62\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert15 [label="Expert 15\nGPU 63\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer9_expert_agg [label="Expert Aggregation\nGPUs 48-63\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp2_layer10_attn {
				bgcolor=lightpink label="Layer 10 Attention (TP=4)" style=rounded
				dp1_pp2_layer10_attn_tp0 [label="Attention TP0\nGPU 48\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_attn_tp1 [label="Attention TP1\nGPU 49\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_attn_tp2 [label="Attention TP2\nGPU 50\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_attn_tp3 [label="Attention TP3\nGPU 51\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_attn_allreduce [label="AllReduce Attention\nGPUs 48-51\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp2_layer10_moe {
				bgcolor=lightyellow label="Layer 10 MoE (EP=16)" style=rounded
				dp1_pp2_layer10_router [label="Router\nGPU 48\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp2_layer10_expert0 [label="Expert 0\nGPU 48\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert1 [label="Expert 1\nGPU 49\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert2 [label="Expert 2\nGPU 50\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert3 [label="Expert 3\nGPU 51\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert4 [label="Expert 4\nGPU 52\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert5 [label="Expert 5\nGPU 53\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert6 [label="Expert 6\nGPU 54\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert7 [label="Expert 7\nGPU 55\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert8 [label="Expert 8\nGPU 56\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert9 [label="Expert 9\nGPU 57\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert10 [label="Expert 10\nGPU 58\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert11 [label="Expert 11\nGPU 59\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert12 [label="Expert 12\nGPU 60\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert13 [label="Expert 13\nGPU 61\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert14 [label="Expert 14\nGPU 62\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert15 [label="Expert 15\nGPU 63\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer10_expert_agg [label="Expert Aggregation\nGPUs 48-63\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp2_layer11_attn {
				bgcolor=lightpink label="Layer 11 Attention (TP=4)" style=rounded
				dp1_pp2_layer11_attn_tp0 [label="Attention TP0\nGPU 48\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_attn_tp1 [label="Attention TP1\nGPU 49\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_attn_tp2 [label="Attention TP2\nGPU 50\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_attn_tp3 [label="Attention TP3\nGPU 51\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_attn_allreduce [label="AllReduce Attention\nGPUs 48-51\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp2_layer11_moe {
				bgcolor=lightyellow label="Layer 11 MoE (EP=16)" style=rounded
				dp1_pp2_layer11_router [label="Router\nGPU 48\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp2_layer11_expert0 [label="Expert 0\nGPU 48\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert1 [label="Expert 1\nGPU 49\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert2 [label="Expert 2\nGPU 50\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert3 [label="Expert 3\nGPU 51\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert4 [label="Expert 4\nGPU 52\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert5 [label="Expert 5\nGPU 53\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert6 [label="Expert 6\nGPU 54\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert7 [label="Expert 7\nGPU 55\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert8 [label="Expert 8\nGPU 56\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert9 [label="Expert 9\nGPU 57\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert10 [label="Expert 10\nGPU 58\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert11 [label="Expert 11\nGPU 59\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert12 [label="Expert 12\nGPU 60\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert13 [label="Expert 13\nGPU 61\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert14 [label="Expert 14\nGPU 62\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert15 [label="Expert 15\nGPU 63\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer11_expert_agg [label="Expert Aggregation\nGPUs 48-63\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp2_layer12_attn {
				bgcolor=lightpink label="Layer 12 Attention (TP=4)" style=rounded
				dp1_pp2_layer12_attn_tp0 [label="Attention TP0\nGPU 48\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_attn_tp1 [label="Attention TP1\nGPU 49\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_attn_tp2 [label="Attention TP2\nGPU 50\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_attn_tp3 [label="Attention TP3\nGPU 51\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_attn_allreduce [label="AllReduce Attention\nGPUs 48-51\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp2_layer12_moe {
				bgcolor=lightyellow label="Layer 12 MoE (EP=16)" style=rounded
				dp1_pp2_layer12_router [label="Router\nGPU 48\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp2_layer12_expert0 [label="Expert 0\nGPU 48\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert1 [label="Expert 1\nGPU 49\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert2 [label="Expert 2\nGPU 50\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert3 [label="Expert 3\nGPU 51\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert4 [label="Expert 4\nGPU 52\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert5 [label="Expert 5\nGPU 53\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert6 [label="Expert 6\nGPU 54\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert7 [label="Expert 7\nGPU 55\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert8 [label="Expert 8\nGPU 56\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert9 [label="Expert 9\nGPU 57\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert10 [label="Expert 10\nGPU 58\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert11 [label="Expert 11\nGPU 59\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert12 [label="Expert 12\nGPU 60\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert13 [label="Expert 13\nGPU 61\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert14 [label="Expert 14\nGPU 62\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert15 [label="Expert 15\nGPU 63\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer12_expert_agg [label="Expert Aggregation\nGPUs 48-63\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp2_layer13_attn {
				bgcolor=lightpink label="Layer 13 Attention (TP=4)" style=rounded
				dp1_pp2_layer13_attn_tp0 [label="Attention TP0\nGPU 48\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_attn_tp1 [label="Attention TP1\nGPU 49\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_attn_tp2 [label="Attention TP2\nGPU 50\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_attn_tp3 [label="Attention TP3\nGPU 51\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_attn_allreduce [label="AllReduce Attention\nGPUs 48-51\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp2_layer13_moe {
				bgcolor=lightyellow label="Layer 13 MoE (EP=16)" style=rounded
				dp1_pp2_layer13_router [label="Router\nGPU 48\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp2_layer13_expert0 [label="Expert 0\nGPU 48\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert1 [label="Expert 1\nGPU 49\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert2 [label="Expert 2\nGPU 50\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert3 [label="Expert 3\nGPU 51\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert4 [label="Expert 4\nGPU 52\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert5 [label="Expert 5\nGPU 53\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert6 [label="Expert 6\nGPU 54\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert7 [label="Expert 7\nGPU 55\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert8 [label="Expert 8\nGPU 56\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert9 [label="Expert 9\nGPU 57\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert10 [label="Expert 10\nGPU 58\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert11 [label="Expert 11\nGPU 59\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert12 [label="Expert 12\nGPU 60\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert13 [label="Expert 13\nGPU 61\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert14 [label="Expert 14\nGPU 62\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert15 [label="Expert 15\nGPU 63\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer13_expert_agg [label="Expert Aggregation\nGPUs 48-63\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp2_layer14_attn {
				bgcolor=lightpink label="Layer 14 Attention (TP=4)" style=rounded
				dp1_pp2_layer14_attn_tp0 [label="Attention TP0\nGPU 48\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_attn_tp1 [label="Attention TP1\nGPU 49\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_attn_tp2 [label="Attention TP2\nGPU 50\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_attn_tp3 [label="Attention TP3\nGPU 51\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_attn_allreduce [label="AllReduce Attention\nGPUs 48-51\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp2_layer14_moe {
				bgcolor=lightyellow label="Layer 14 MoE (EP=16)" style=rounded
				dp1_pp2_layer14_router [label="Router\nGPU 48\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp2_layer14_expert0 [label="Expert 0\nGPU 48\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert1 [label="Expert 1\nGPU 49\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert2 [label="Expert 2\nGPU 50\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert3 [label="Expert 3\nGPU 51\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert4 [label="Expert 4\nGPU 52\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert5 [label="Expert 5\nGPU 53\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert6 [label="Expert 6\nGPU 54\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert7 [label="Expert 7\nGPU 55\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert8 [label="Expert 8\nGPU 56\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert9 [label="Expert 9\nGPU 57\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert10 [label="Expert 10\nGPU 58\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert11 [label="Expert 11\nGPU 59\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert12 [label="Expert 12\nGPU 60\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert13 [label="Expert 13\nGPU 61\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert14 [label="Expert 14\nGPU 62\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert15 [label="Expert 15\nGPU 63\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer14_expert_agg [label="Expert Aggregation\nGPUs 48-63\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp2_layer15_attn {
				bgcolor=lightpink label="Layer 15 Attention (TP=4)" style=rounded
				dp1_pp2_layer15_attn_tp0 [label="Attention TP0\nGPU 48\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_attn_tp1 [label="Attention TP1\nGPU 49\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_attn_tp2 [label="Attention TP2\nGPU 50\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_attn_tp3 [label="Attention TP3\nGPU 51\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_attn_allreduce [label="AllReduce Attention\nGPUs 48-51\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp2_layer15_moe {
				bgcolor=lightyellow label="Layer 15 MoE (EP=16)" style=rounded
				dp1_pp2_layer15_router [label="Router\nGPU 48\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp2_layer15_expert0 [label="Expert 0\nGPU 48\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert1 [label="Expert 1\nGPU 49\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert2 [label="Expert 2\nGPU 50\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert3 [label="Expert 3\nGPU 51\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert4 [label="Expert 4\nGPU 52\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert5 [label="Expert 5\nGPU 53\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert6 [label="Expert 6\nGPU 54\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert7 [label="Expert 7\nGPU 55\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert8 [label="Expert 8\nGPU 56\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert9 [label="Expert 9\nGPU 57\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert10 [label="Expert 10\nGPU 58\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert11 [label="Expert 11\nGPU 59\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert12 [label="Expert 12\nGPU 60\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert13 [label="Expert 13\nGPU 61\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert14 [label="Expert 14\nGPU 62\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert15 [label="Expert 15\nGPU 63\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer15_expert_agg [label="Expert Aggregation\nGPUs 48-63\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp1_pp2_layer16_attn {
				bgcolor=lightpink label="Layer 16 Attention (TP=4)" style=rounded
				dp1_pp2_layer16_attn_tp0 [label="Attention TP0\nGPU 48\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_attn_tp1 [label="Attention TP1\nGPU 49\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_attn_tp2 [label="Attention TP2\nGPU 50\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_attn_tp3 [label="Attention TP3\nGPU 51\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_attn_allreduce [label="AllReduce Attention\nGPUs 48-51\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp1_pp2_layer16_moe {
				bgcolor=lightyellow label="Layer 16 MoE (EP=16)" style=rounded
				dp1_pp2_layer16_router [label="Router\nGPU 48\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp1_pp2_layer16_expert0 [label="Expert 0\nGPU 48\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert1 [label="Expert 1\nGPU 49\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert2 [label="Expert 2\nGPU 50\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert3 [label="Expert 3\nGPU 51\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert4 [label="Expert 4\nGPU 52\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert5 [label="Expert 5\nGPU 53\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert6 [label="Expert 6\nGPU 54\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert7 [label="Expert 7\nGPU 55\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert8 [label="Expert 8\nGPU 56\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert9 [label="Expert 9\nGPU 57\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert10 [label="Expert 10\nGPU 58\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert11 [label="Expert 11\nGPU 59\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert12 [label="Expert 12\nGPU 60\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert13 [label="Expert 13\nGPU 61\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert14 [label="Expert 14\nGPU 62\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert15 [label="Expert 15\nGPU 63\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp1_pp2_layer16_expert_agg [label="Expert Aggregation\nGPUs 48-63\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
		}
	}
	dp2_pp1_layer1_attn_tp0 -> dp2_pp1_layer1_attn_allreduce
	dp2_pp1_layer1_attn_tp1 -> dp2_pp1_layer1_attn_allreduce
	dp2_pp1_layer1_attn_tp2 -> dp2_pp1_layer1_attn_allreduce
	dp2_pp1_layer1_attn_tp3 -> dp2_pp1_layer1_attn_allreduce
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert0 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert1 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert2 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert3 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert4 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert5 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert6 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert7 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert8 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert9 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert10 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert11 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert12 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert13 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert14 [style=dashed]
	dp2_pp1_layer1_router -> dp2_pp1_layer1_expert15 [style=dashed]
	dp2_pp1_layer1_expert0 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert1 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert2 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert3 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert4 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert5 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert6 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert7 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert8 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert9 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert10 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert11 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert12 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert13 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert14 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_expert15 -> dp2_pp1_layer1_expert_agg
	dp2_pp1_layer1_attn_allreduce -> dp2_pp1_layer1_router [constraint=false]
	dp2_pp1_layer1_expert_agg -> dp2_pp1_layer2_attn_tp0 [constraint=false]
	dp2_pp1_layer2_attn_tp0 -> dp2_pp1_layer2_attn_allreduce
	dp2_pp1_layer2_attn_tp1 -> dp2_pp1_layer2_attn_allreduce
	dp2_pp1_layer2_attn_tp2 -> dp2_pp1_layer2_attn_allreduce
	dp2_pp1_layer2_attn_tp3 -> dp2_pp1_layer2_attn_allreduce
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert0 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert1 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert2 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert3 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert4 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert5 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert6 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert7 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert8 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert9 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert10 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert11 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert12 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert13 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert14 [style=dashed]
	dp2_pp1_layer2_router -> dp2_pp1_layer2_expert15 [style=dashed]
	dp2_pp1_layer2_expert0 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert1 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert2 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert3 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert4 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert5 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert6 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert7 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert8 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert9 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert10 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert11 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert12 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert13 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert14 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_expert15 -> dp2_pp1_layer2_expert_agg
	dp2_pp1_layer2_attn_allreduce -> dp2_pp1_layer2_router [constraint=false]
	dp2_pp1_layer2_expert_agg -> dp2_pp1_layer3_attn_tp0 [constraint=false]
	dp2_pp1_layer3_attn_tp0 -> dp2_pp1_layer3_attn_allreduce
	dp2_pp1_layer3_attn_tp1 -> dp2_pp1_layer3_attn_allreduce
	dp2_pp1_layer3_attn_tp2 -> dp2_pp1_layer3_attn_allreduce
	dp2_pp1_layer3_attn_tp3 -> dp2_pp1_layer3_attn_allreduce
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert0 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert1 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert2 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert3 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert4 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert5 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert6 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert7 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert8 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert9 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert10 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert11 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert12 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert13 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert14 [style=dashed]
	dp2_pp1_layer3_router -> dp2_pp1_layer3_expert15 [style=dashed]
	dp2_pp1_layer3_expert0 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert1 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert2 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert3 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert4 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert5 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert6 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert7 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert8 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert9 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert10 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert11 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert12 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert13 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert14 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_expert15 -> dp2_pp1_layer3_expert_agg
	dp2_pp1_layer3_attn_allreduce -> dp2_pp1_layer3_router [constraint=false]
	dp2_pp1_layer3_expert_agg -> dp2_pp1_layer4_attn_tp0 [constraint=false]
	dp2_pp1_layer4_attn_tp0 -> dp2_pp1_layer4_attn_allreduce
	dp2_pp1_layer4_attn_tp1 -> dp2_pp1_layer4_attn_allreduce
	dp2_pp1_layer4_attn_tp2 -> dp2_pp1_layer4_attn_allreduce
	dp2_pp1_layer4_attn_tp3 -> dp2_pp1_layer4_attn_allreduce
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert0 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert1 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert2 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert3 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert4 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert5 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert6 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert7 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert8 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert9 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert10 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert11 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert12 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert13 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert14 [style=dashed]
	dp2_pp1_layer4_router -> dp2_pp1_layer4_expert15 [style=dashed]
	dp2_pp1_layer4_expert0 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert1 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert2 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert3 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert4 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert5 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert6 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert7 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert8 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert9 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert10 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert11 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert12 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert13 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert14 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_expert15 -> dp2_pp1_layer4_expert_agg
	dp2_pp1_layer4_attn_allreduce -> dp2_pp1_layer4_router [constraint=false]
	dp2_pp1_layer4_expert_agg -> dp2_pp1_layer5_attn_tp0 [constraint=false]
	dp2_pp1_layer5_attn_tp0 -> dp2_pp1_layer5_attn_allreduce
	dp2_pp1_layer5_attn_tp1 -> dp2_pp1_layer5_attn_allreduce
	dp2_pp1_layer5_attn_tp2 -> dp2_pp1_layer5_attn_allreduce
	dp2_pp1_layer5_attn_tp3 -> dp2_pp1_layer5_attn_allreduce
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert0 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert1 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert2 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert3 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert4 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert5 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert6 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert7 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert8 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert9 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert10 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert11 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert12 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert13 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert14 [style=dashed]
	dp2_pp1_layer5_router -> dp2_pp1_layer5_expert15 [style=dashed]
	dp2_pp1_layer5_expert0 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert1 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert2 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert3 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert4 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert5 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert6 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert7 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert8 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert9 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert10 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert11 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert12 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert13 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert14 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_expert15 -> dp2_pp1_layer5_expert_agg
	dp2_pp1_layer5_attn_allreduce -> dp2_pp1_layer5_router [constraint=false]
	dp2_pp1_layer5_expert_agg -> dp2_pp1_layer6_attn_tp0 [constraint=false]
	dp2_pp1_layer6_attn_tp0 -> dp2_pp1_layer6_attn_allreduce
	dp2_pp1_layer6_attn_tp1 -> dp2_pp1_layer6_attn_allreduce
	dp2_pp1_layer6_attn_tp2 -> dp2_pp1_layer6_attn_allreduce
	dp2_pp1_layer6_attn_tp3 -> dp2_pp1_layer6_attn_allreduce
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert0 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert1 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert2 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert3 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert4 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert5 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert6 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert7 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert8 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert9 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert10 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert11 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert12 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert13 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert14 [style=dashed]
	dp2_pp1_layer6_router -> dp2_pp1_layer6_expert15 [style=dashed]
	dp2_pp1_layer6_expert0 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert1 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert2 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert3 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert4 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert5 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert6 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert7 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert8 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert9 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert10 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert11 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert12 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert13 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert14 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_expert15 -> dp2_pp1_layer6_expert_agg
	dp2_pp1_layer6_attn_allreduce -> dp2_pp1_layer6_router [constraint=false]
	dp2_pp1_layer6_expert_agg -> dp2_pp1_layer7_attn_tp0 [constraint=false]
	dp2_pp1_layer7_attn_tp0 -> dp2_pp1_layer7_attn_allreduce
	dp2_pp1_layer7_attn_tp1 -> dp2_pp1_layer7_attn_allreduce
	dp2_pp1_layer7_attn_tp2 -> dp2_pp1_layer7_attn_allreduce
	dp2_pp1_layer7_attn_tp3 -> dp2_pp1_layer7_attn_allreduce
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert0 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert1 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert2 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert3 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert4 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert5 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert6 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert7 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert8 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert9 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert10 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert11 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert12 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert13 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert14 [style=dashed]
	dp2_pp1_layer7_router -> dp2_pp1_layer7_expert15 [style=dashed]
	dp2_pp1_layer7_expert0 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert1 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert2 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert3 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert4 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert5 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert6 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert7 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert8 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert9 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert10 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert11 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert12 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert13 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert14 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_expert15 -> dp2_pp1_layer7_expert_agg
	dp2_pp1_layer7_attn_allreduce -> dp2_pp1_layer7_router [constraint=false]
	dp2_pp1_layer7_expert_agg -> dp2_pp1_layer8_attn_tp0 [constraint=false]
	dp2_pp1_layer8_attn_tp0 -> dp2_pp1_layer8_attn_allreduce
	dp2_pp1_layer8_attn_tp1 -> dp2_pp1_layer8_attn_allreduce
	dp2_pp1_layer8_attn_tp2 -> dp2_pp1_layer8_attn_allreduce
	dp2_pp1_layer8_attn_tp3 -> dp2_pp1_layer8_attn_allreduce
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert0 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert1 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert2 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert3 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert4 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert5 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert6 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert7 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert8 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert9 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert10 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert11 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert12 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert13 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert14 [style=dashed]
	dp2_pp1_layer8_router -> dp2_pp1_layer8_expert15 [style=dashed]
	dp2_pp1_layer8_expert0 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert1 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert2 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert3 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert4 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert5 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert6 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert7 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert8 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert9 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert10 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert11 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert12 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert13 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert14 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_expert15 -> dp2_pp1_layer8_expert_agg
	dp2_pp1_layer8_attn_allreduce -> dp2_pp1_layer8_router [constraint=false]
	dp2_pp2_layer9_attn_tp0 -> dp2_pp2_layer9_attn_allreduce
	dp2_pp2_layer9_attn_tp1 -> dp2_pp2_layer9_attn_allreduce
	dp2_pp2_layer9_attn_tp2 -> dp2_pp2_layer9_attn_allreduce
	dp2_pp2_layer9_attn_tp3 -> dp2_pp2_layer9_attn_allreduce
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert0 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert1 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert2 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert3 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert4 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert5 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert6 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert7 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert8 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert9 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert10 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert11 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert12 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert13 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert14 [style=dashed]
	dp2_pp2_layer9_router -> dp2_pp2_layer9_expert15 [style=dashed]
	dp2_pp2_layer9_expert0 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert1 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert2 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert3 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert4 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert5 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert6 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert7 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert8 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert9 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert10 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert11 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert12 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert13 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert14 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_expert15 -> dp2_pp2_layer9_expert_agg
	dp2_pp2_layer9_attn_allreduce -> dp2_pp2_layer9_router [constraint=false]
	dp2_pp2_layer9_expert_agg -> dp2_pp2_layer10_attn_tp0 [constraint=false]
	dp2_pp2_layer10_attn_tp0 -> dp2_pp2_layer10_attn_allreduce
	dp2_pp2_layer10_attn_tp1 -> dp2_pp2_layer10_attn_allreduce
	dp2_pp2_layer10_attn_tp2 -> dp2_pp2_layer10_attn_allreduce
	dp2_pp2_layer10_attn_tp3 -> dp2_pp2_layer10_attn_allreduce
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert0 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert1 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert2 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert3 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert4 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert5 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert6 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert7 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert8 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert9 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert10 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert11 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert12 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert13 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert14 [style=dashed]
	dp2_pp2_layer10_router -> dp2_pp2_layer10_expert15 [style=dashed]
	dp2_pp2_layer10_expert0 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert1 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert2 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert3 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert4 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert5 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert6 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert7 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert8 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert9 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert10 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert11 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert12 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert13 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert14 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_expert15 -> dp2_pp2_layer10_expert_agg
	dp2_pp2_layer10_attn_allreduce -> dp2_pp2_layer10_router [constraint=false]
	dp2_pp2_layer10_expert_agg -> dp2_pp2_layer11_attn_tp0 [constraint=false]
	dp2_pp2_layer11_attn_tp0 -> dp2_pp2_layer11_attn_allreduce
	dp2_pp2_layer11_attn_tp1 -> dp2_pp2_layer11_attn_allreduce
	dp2_pp2_layer11_attn_tp2 -> dp2_pp2_layer11_attn_allreduce
	dp2_pp2_layer11_attn_tp3 -> dp2_pp2_layer11_attn_allreduce
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert0 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert1 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert2 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert3 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert4 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert5 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert6 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert7 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert8 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert9 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert10 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert11 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert12 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert13 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert14 [style=dashed]
	dp2_pp2_layer11_router -> dp2_pp2_layer11_expert15 [style=dashed]
	dp2_pp2_layer11_expert0 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert1 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert2 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert3 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert4 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert5 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert6 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert7 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert8 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert9 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert10 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert11 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert12 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert13 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert14 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_expert15 -> dp2_pp2_layer11_expert_agg
	dp2_pp2_layer11_attn_allreduce -> dp2_pp2_layer11_router [constraint=false]
	dp2_pp2_layer11_expert_agg -> dp2_pp2_layer12_attn_tp0 [constraint=false]
	dp2_pp2_layer12_attn_tp0 -> dp2_pp2_layer12_attn_allreduce
	dp2_pp2_layer12_attn_tp1 -> dp2_pp2_layer12_attn_allreduce
	dp2_pp2_layer12_attn_tp2 -> dp2_pp2_layer12_attn_allreduce
	dp2_pp2_layer12_attn_tp3 -> dp2_pp2_layer12_attn_allreduce
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert0 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert1 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert2 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert3 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert4 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert5 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert6 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert7 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert8 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert9 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert10 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert11 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert12 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert13 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert14 [style=dashed]
	dp2_pp2_layer12_router -> dp2_pp2_layer12_expert15 [style=dashed]
	dp2_pp2_layer12_expert0 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert1 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert2 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert3 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert4 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert5 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert6 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert7 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert8 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert9 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert10 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert11 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert12 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert13 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert14 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_expert15 -> dp2_pp2_layer12_expert_agg
	dp2_pp2_layer12_attn_allreduce -> dp2_pp2_layer12_router [constraint=false]
	dp2_pp2_layer12_expert_agg -> dp2_pp2_layer13_attn_tp0 [constraint=false]
	dp2_pp2_layer13_attn_tp0 -> dp2_pp2_layer13_attn_allreduce
	dp2_pp2_layer13_attn_tp1 -> dp2_pp2_layer13_attn_allreduce
	dp2_pp2_layer13_attn_tp2 -> dp2_pp2_layer13_attn_allreduce
	dp2_pp2_layer13_attn_tp3 -> dp2_pp2_layer13_attn_allreduce
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert0 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert1 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert2 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert3 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert4 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert5 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert6 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert7 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert8 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert9 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert10 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert11 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert12 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert13 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert14 [style=dashed]
	dp2_pp2_layer13_router -> dp2_pp2_layer13_expert15 [style=dashed]
	dp2_pp2_layer13_expert0 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert1 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert2 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert3 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert4 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert5 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert6 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert7 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert8 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert9 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert10 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert11 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert12 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert13 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert14 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_expert15 -> dp2_pp2_layer13_expert_agg
	dp2_pp2_layer13_attn_allreduce -> dp2_pp2_layer13_router [constraint=false]
	dp2_pp2_layer13_expert_agg -> dp2_pp2_layer14_attn_tp0 [constraint=false]
	dp2_pp2_layer14_attn_tp0 -> dp2_pp2_layer14_attn_allreduce
	dp2_pp2_layer14_attn_tp1 -> dp2_pp2_layer14_attn_allreduce
	dp2_pp2_layer14_attn_tp2 -> dp2_pp2_layer14_attn_allreduce
	dp2_pp2_layer14_attn_tp3 -> dp2_pp2_layer14_attn_allreduce
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert0 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert1 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert2 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert3 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert4 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert5 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert6 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert7 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert8 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert9 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert10 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert11 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert12 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert13 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert14 [style=dashed]
	dp2_pp2_layer14_router -> dp2_pp2_layer14_expert15 [style=dashed]
	dp2_pp2_layer14_expert0 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert1 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert2 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert3 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert4 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert5 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert6 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert7 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert8 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert9 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert10 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert11 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert12 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert13 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert14 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_expert15 -> dp2_pp2_layer14_expert_agg
	dp2_pp2_layer14_attn_allreduce -> dp2_pp2_layer14_router [constraint=false]
	dp2_pp2_layer14_expert_agg -> dp2_pp2_layer15_attn_tp0 [constraint=false]
	dp2_pp2_layer15_attn_tp0 -> dp2_pp2_layer15_attn_allreduce
	dp2_pp2_layer15_attn_tp1 -> dp2_pp2_layer15_attn_allreduce
	dp2_pp2_layer15_attn_tp2 -> dp2_pp2_layer15_attn_allreduce
	dp2_pp2_layer15_attn_tp3 -> dp2_pp2_layer15_attn_allreduce
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert0 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert1 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert2 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert3 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert4 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert5 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert6 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert7 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert8 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert9 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert10 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert11 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert12 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert13 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert14 [style=dashed]
	dp2_pp2_layer15_router -> dp2_pp2_layer15_expert15 [style=dashed]
	dp2_pp2_layer15_expert0 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert1 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert2 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert3 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert4 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert5 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert6 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert7 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert8 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert9 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert10 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert11 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert12 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert13 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert14 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_expert15 -> dp2_pp2_layer15_expert_agg
	dp2_pp2_layer15_attn_allreduce -> dp2_pp2_layer15_router [constraint=false]
	dp2_pp2_layer15_expert_agg -> dp2_pp2_layer16_attn_tp0 [constraint=false]
	dp2_pp2_layer16_attn_tp0 -> dp2_pp2_layer16_attn_allreduce
	dp2_pp2_layer16_attn_tp1 -> dp2_pp2_layer16_attn_allreduce
	dp2_pp2_layer16_attn_tp2 -> dp2_pp2_layer16_attn_allreduce
	dp2_pp2_layer16_attn_tp3 -> dp2_pp2_layer16_attn_allreduce
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert0 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert1 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert2 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert3 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert4 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert5 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert6 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert7 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert8 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert9 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert10 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert11 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert12 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert13 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert14 [style=dashed]
	dp2_pp2_layer16_router -> dp2_pp2_layer16_expert15 [style=dashed]
	dp2_pp2_layer16_expert0 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert1 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert2 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert3 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert4 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert5 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert6 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert7 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert8 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert9 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert10 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert11 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert12 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert13 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert14 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_expert15 -> dp2_pp2_layer16_expert_agg
	dp2_pp2_layer16_attn_allreduce -> dp2_pp2_layer16_router [constraint=false]
	subgraph cluster_dp_2 {
		bgcolor=lightgray label="DP Replica 2 (GPUs 64-95)" style=rounded
		subgraph cluster_pp1_dp2 {
			bgcolor=lightcyan label="PP Stage 1: Layers 1-8 (GPUs 64-79)" style=rounded
			subgraph cluster_dp2_pp1_layer1_attn {
				bgcolor=lightpink label="Layer 1 Attention (TP=4)" style=rounded
				dp2_pp1_layer1_attn_tp0 [label="Attention TP0\nGPU 64\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_attn_tp1 [label="Attention TP1\nGPU 65\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_attn_tp2 [label="Attention TP2\nGPU 66\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_attn_tp3 [label="Attention TP3\nGPU 67\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_attn_allreduce [label="AllReduce Attention\nGPUs 64-67\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp1_layer1_moe {
				bgcolor=lightyellow label="Layer 1 MoE (EP=16)" style=rounded
				dp2_pp1_layer1_router [label="Router\nGPU 64\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp1_layer1_expert0 [label="Expert 0\nGPU 64\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert1 [label="Expert 1\nGPU 65\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert2 [label="Expert 2\nGPU 66\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert3 [label="Expert 3\nGPU 67\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert4 [label="Expert 4\nGPU 68\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert5 [label="Expert 5\nGPU 69\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert6 [label="Expert 6\nGPU 70\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert7 [label="Expert 7\nGPU 71\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert8 [label="Expert 8\nGPU 72\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert9 [label="Expert 9\nGPU 73\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert10 [label="Expert 10\nGPU 74\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert11 [label="Expert 11\nGPU 75\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert12 [label="Expert 12\nGPU 76\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert13 [label="Expert 13\nGPU 77\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert14 [label="Expert 14\nGPU 78\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert15 [label="Expert 15\nGPU 79\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer1_expert_agg [label="Expert Aggregation\nGPUs 64-79\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp1_layer2_attn {
				bgcolor=lightpink label="Layer 2 Attention (TP=4)" style=rounded
				dp2_pp1_layer2_attn_tp0 [label="Attention TP0\nGPU 64\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_attn_tp1 [label="Attention TP1\nGPU 65\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_attn_tp2 [label="Attention TP2\nGPU 66\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_attn_tp3 [label="Attention TP3\nGPU 67\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_attn_allreduce [label="AllReduce Attention\nGPUs 64-67\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp1_layer2_moe {
				bgcolor=lightyellow label="Layer 2 MoE (EP=16)" style=rounded
				dp2_pp1_layer2_router [label="Router\nGPU 64\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp1_layer2_expert0 [label="Expert 0\nGPU 64\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert1 [label="Expert 1\nGPU 65\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert2 [label="Expert 2\nGPU 66\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert3 [label="Expert 3\nGPU 67\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert4 [label="Expert 4\nGPU 68\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert5 [label="Expert 5\nGPU 69\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert6 [label="Expert 6\nGPU 70\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert7 [label="Expert 7\nGPU 71\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert8 [label="Expert 8\nGPU 72\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert9 [label="Expert 9\nGPU 73\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert10 [label="Expert 10\nGPU 74\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert11 [label="Expert 11\nGPU 75\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert12 [label="Expert 12\nGPU 76\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert13 [label="Expert 13\nGPU 77\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert14 [label="Expert 14\nGPU 78\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert15 [label="Expert 15\nGPU 79\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer2_expert_agg [label="Expert Aggregation\nGPUs 64-79\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp1_layer3_attn {
				bgcolor=lightpink label="Layer 3 Attention (TP=4)" style=rounded
				dp2_pp1_layer3_attn_tp0 [label="Attention TP0\nGPU 64\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_attn_tp1 [label="Attention TP1\nGPU 65\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_attn_tp2 [label="Attention TP2\nGPU 66\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_attn_tp3 [label="Attention TP3\nGPU 67\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_attn_allreduce [label="AllReduce Attention\nGPUs 64-67\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp1_layer3_moe {
				bgcolor=lightyellow label="Layer 3 MoE (EP=16)" style=rounded
				dp2_pp1_layer3_router [label="Router\nGPU 64\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp1_layer3_expert0 [label="Expert 0\nGPU 64\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert1 [label="Expert 1\nGPU 65\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert2 [label="Expert 2\nGPU 66\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert3 [label="Expert 3\nGPU 67\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert4 [label="Expert 4\nGPU 68\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert5 [label="Expert 5\nGPU 69\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert6 [label="Expert 6\nGPU 70\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert7 [label="Expert 7\nGPU 71\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert8 [label="Expert 8\nGPU 72\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert9 [label="Expert 9\nGPU 73\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert10 [label="Expert 10\nGPU 74\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert11 [label="Expert 11\nGPU 75\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert12 [label="Expert 12\nGPU 76\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert13 [label="Expert 13\nGPU 77\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert14 [label="Expert 14\nGPU 78\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert15 [label="Expert 15\nGPU 79\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer3_expert_agg [label="Expert Aggregation\nGPUs 64-79\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp1_layer4_attn {
				bgcolor=lightpink label="Layer 4 Attention (TP=4)" style=rounded
				dp2_pp1_layer4_attn_tp0 [label="Attention TP0\nGPU 64\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_attn_tp1 [label="Attention TP1\nGPU 65\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_attn_tp2 [label="Attention TP2\nGPU 66\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_attn_tp3 [label="Attention TP3\nGPU 67\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_attn_allreduce [label="AllReduce Attention\nGPUs 64-67\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp1_layer4_moe {
				bgcolor=lightyellow label="Layer 4 MoE (EP=16)" style=rounded
				dp2_pp1_layer4_router [label="Router\nGPU 64\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp1_layer4_expert0 [label="Expert 0\nGPU 64\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert1 [label="Expert 1\nGPU 65\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert2 [label="Expert 2\nGPU 66\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert3 [label="Expert 3\nGPU 67\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert4 [label="Expert 4\nGPU 68\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert5 [label="Expert 5\nGPU 69\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert6 [label="Expert 6\nGPU 70\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert7 [label="Expert 7\nGPU 71\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert8 [label="Expert 8\nGPU 72\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert9 [label="Expert 9\nGPU 73\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert10 [label="Expert 10\nGPU 74\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert11 [label="Expert 11\nGPU 75\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert12 [label="Expert 12\nGPU 76\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert13 [label="Expert 13\nGPU 77\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert14 [label="Expert 14\nGPU 78\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert15 [label="Expert 15\nGPU 79\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer4_expert_agg [label="Expert Aggregation\nGPUs 64-79\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp1_layer5_attn {
				bgcolor=lightpink label="Layer 5 Attention (TP=4)" style=rounded
				dp2_pp1_layer5_attn_tp0 [label="Attention TP0\nGPU 64\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_attn_tp1 [label="Attention TP1\nGPU 65\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_attn_tp2 [label="Attention TP2\nGPU 66\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_attn_tp3 [label="Attention TP3\nGPU 67\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_attn_allreduce [label="AllReduce Attention\nGPUs 64-67\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp1_layer5_moe {
				bgcolor=lightyellow label="Layer 5 MoE (EP=16)" style=rounded
				dp2_pp1_layer5_router [label="Router\nGPU 64\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp1_layer5_expert0 [label="Expert 0\nGPU 64\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert1 [label="Expert 1\nGPU 65\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert2 [label="Expert 2\nGPU 66\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert3 [label="Expert 3\nGPU 67\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert4 [label="Expert 4\nGPU 68\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert5 [label="Expert 5\nGPU 69\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert6 [label="Expert 6\nGPU 70\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert7 [label="Expert 7\nGPU 71\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert8 [label="Expert 8\nGPU 72\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert9 [label="Expert 9\nGPU 73\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert10 [label="Expert 10\nGPU 74\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert11 [label="Expert 11\nGPU 75\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert12 [label="Expert 12\nGPU 76\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert13 [label="Expert 13\nGPU 77\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert14 [label="Expert 14\nGPU 78\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert15 [label="Expert 15\nGPU 79\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer5_expert_agg [label="Expert Aggregation\nGPUs 64-79\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp1_layer6_attn {
				bgcolor=lightpink label="Layer 6 Attention (TP=4)" style=rounded
				dp2_pp1_layer6_attn_tp0 [label="Attention TP0\nGPU 64\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_attn_tp1 [label="Attention TP1\nGPU 65\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_attn_tp2 [label="Attention TP2\nGPU 66\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_attn_tp3 [label="Attention TP3\nGPU 67\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_attn_allreduce [label="AllReduce Attention\nGPUs 64-67\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp1_layer6_moe {
				bgcolor=lightyellow label="Layer 6 MoE (EP=16)" style=rounded
				dp2_pp1_layer6_router [label="Router\nGPU 64\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp1_layer6_expert0 [label="Expert 0\nGPU 64\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert1 [label="Expert 1\nGPU 65\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert2 [label="Expert 2\nGPU 66\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert3 [label="Expert 3\nGPU 67\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert4 [label="Expert 4\nGPU 68\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert5 [label="Expert 5\nGPU 69\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert6 [label="Expert 6\nGPU 70\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert7 [label="Expert 7\nGPU 71\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert8 [label="Expert 8\nGPU 72\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert9 [label="Expert 9\nGPU 73\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert10 [label="Expert 10\nGPU 74\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert11 [label="Expert 11\nGPU 75\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert12 [label="Expert 12\nGPU 76\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert13 [label="Expert 13\nGPU 77\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert14 [label="Expert 14\nGPU 78\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert15 [label="Expert 15\nGPU 79\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer6_expert_agg [label="Expert Aggregation\nGPUs 64-79\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp1_layer7_attn {
				bgcolor=lightpink label="Layer 7 Attention (TP=4)" style=rounded
				dp2_pp1_layer7_attn_tp0 [label="Attention TP0\nGPU 64\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_attn_tp1 [label="Attention TP1\nGPU 65\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_attn_tp2 [label="Attention TP2\nGPU 66\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_attn_tp3 [label="Attention TP3\nGPU 67\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_attn_allreduce [label="AllReduce Attention\nGPUs 64-67\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp1_layer7_moe {
				bgcolor=lightyellow label="Layer 7 MoE (EP=16)" style=rounded
				dp2_pp1_layer7_router [label="Router\nGPU 64\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp1_layer7_expert0 [label="Expert 0\nGPU 64\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert1 [label="Expert 1\nGPU 65\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert2 [label="Expert 2\nGPU 66\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert3 [label="Expert 3\nGPU 67\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert4 [label="Expert 4\nGPU 68\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert5 [label="Expert 5\nGPU 69\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert6 [label="Expert 6\nGPU 70\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert7 [label="Expert 7\nGPU 71\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert8 [label="Expert 8\nGPU 72\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert9 [label="Expert 9\nGPU 73\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert10 [label="Expert 10\nGPU 74\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert11 [label="Expert 11\nGPU 75\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert12 [label="Expert 12\nGPU 76\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert13 [label="Expert 13\nGPU 77\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert14 [label="Expert 14\nGPU 78\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert15 [label="Expert 15\nGPU 79\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer7_expert_agg [label="Expert Aggregation\nGPUs 64-79\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp1_layer8_attn {
				bgcolor=lightpink label="Layer 8 Attention (TP=4)" style=rounded
				dp2_pp1_layer8_attn_tp0 [label="Attention TP0\nGPU 64\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_attn_tp1 [label="Attention TP1\nGPU 65\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_attn_tp2 [label="Attention TP2\nGPU 66\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_attn_tp3 [label="Attention TP3\nGPU 67\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_attn_allreduce [label="AllReduce Attention\nGPUs 64-67\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp1_layer8_moe {
				bgcolor=lightyellow label="Layer 8 MoE (EP=16)" style=rounded
				dp2_pp1_layer8_router [label="Router\nGPU 64\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp1_layer8_expert0 [label="Expert 0\nGPU 64\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert1 [label="Expert 1\nGPU 65\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert2 [label="Expert 2\nGPU 66\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert3 [label="Expert 3\nGPU 67\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert4 [label="Expert 4\nGPU 68\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert5 [label="Expert 5\nGPU 69\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert6 [label="Expert 6\nGPU 70\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert7 [label="Expert 7\nGPU 71\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert8 [label="Expert 8\nGPU 72\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert9 [label="Expert 9\nGPU 73\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert10 [label="Expert 10\nGPU 74\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert11 [label="Expert 11\nGPU 75\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert12 [label="Expert 12\nGPU 76\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert13 [label="Expert 13\nGPU 77\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert14 [label="Expert 14\nGPU 78\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert15 [label="Expert 15\nGPU 79\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp1_layer8_expert_agg [label="Expert Aggregation\nGPUs 64-79\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
		}
		subgraph cluster_pp2_dp2 {
			bgcolor=lightcyan label="PP Stage 2: Layers 9-16 (GPUs 80-95)" style=rounded
			subgraph cluster_dp2_pp2_layer9_attn {
				bgcolor=lightpink label="Layer 9 Attention (TP=4)" style=rounded
				dp2_pp2_layer9_attn_tp0 [label="Attention TP0\nGPU 80\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_attn_tp1 [label="Attention TP1\nGPU 81\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_attn_tp2 [label="Attention TP2\nGPU 82\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_attn_tp3 [label="Attention TP3\nGPU 83\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_attn_allreduce [label="AllReduce Attention\nGPUs 80-83\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp2_layer9_moe {
				bgcolor=lightyellow label="Layer 9 MoE (EP=16)" style=rounded
				dp2_pp2_layer9_router [label="Router\nGPU 80\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp2_layer9_expert0 [label="Expert 0\nGPU 80\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert1 [label="Expert 1\nGPU 81\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert2 [label="Expert 2\nGPU 82\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert3 [label="Expert 3\nGPU 83\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert4 [label="Expert 4\nGPU 84\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert5 [label="Expert 5\nGPU 85\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert6 [label="Expert 6\nGPU 86\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert7 [label="Expert 7\nGPU 87\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert8 [label="Expert 8\nGPU 88\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert9 [label="Expert 9\nGPU 89\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert10 [label="Expert 10\nGPU 90\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert11 [label="Expert 11\nGPU 91\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert12 [label="Expert 12\nGPU 92\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert13 [label="Expert 13\nGPU 93\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert14 [label="Expert 14\nGPU 94\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert15 [label="Expert 15\nGPU 95\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer9_expert_agg [label="Expert Aggregation\nGPUs 80-95\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp2_layer10_attn {
				bgcolor=lightpink label="Layer 10 Attention (TP=4)" style=rounded
				dp2_pp2_layer10_attn_tp0 [label="Attention TP0\nGPU 80\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_attn_tp1 [label="Attention TP1\nGPU 81\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_attn_tp2 [label="Attention TP2\nGPU 82\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_attn_tp3 [label="Attention TP3\nGPU 83\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_attn_allreduce [label="AllReduce Attention\nGPUs 80-83\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp2_layer10_moe {
				bgcolor=lightyellow label="Layer 10 MoE (EP=16)" style=rounded
				dp2_pp2_layer10_router [label="Router\nGPU 80\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp2_layer10_expert0 [label="Expert 0\nGPU 80\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert1 [label="Expert 1\nGPU 81\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert2 [label="Expert 2\nGPU 82\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert3 [label="Expert 3\nGPU 83\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert4 [label="Expert 4\nGPU 84\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert5 [label="Expert 5\nGPU 85\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert6 [label="Expert 6\nGPU 86\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert7 [label="Expert 7\nGPU 87\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert8 [label="Expert 8\nGPU 88\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert9 [label="Expert 9\nGPU 89\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert10 [label="Expert 10\nGPU 90\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert11 [label="Expert 11\nGPU 91\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert12 [label="Expert 12\nGPU 92\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert13 [label="Expert 13\nGPU 93\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert14 [label="Expert 14\nGPU 94\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert15 [label="Expert 15\nGPU 95\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer10_expert_agg [label="Expert Aggregation\nGPUs 80-95\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp2_layer11_attn {
				bgcolor=lightpink label="Layer 11 Attention (TP=4)" style=rounded
				dp2_pp2_layer11_attn_tp0 [label="Attention TP0\nGPU 80\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_attn_tp1 [label="Attention TP1\nGPU 81\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_attn_tp2 [label="Attention TP2\nGPU 82\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_attn_tp3 [label="Attention TP3\nGPU 83\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_attn_allreduce [label="AllReduce Attention\nGPUs 80-83\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp2_layer11_moe {
				bgcolor=lightyellow label="Layer 11 MoE (EP=16)" style=rounded
				dp2_pp2_layer11_router [label="Router\nGPU 80\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp2_layer11_expert0 [label="Expert 0\nGPU 80\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert1 [label="Expert 1\nGPU 81\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert2 [label="Expert 2\nGPU 82\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert3 [label="Expert 3\nGPU 83\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert4 [label="Expert 4\nGPU 84\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert5 [label="Expert 5\nGPU 85\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert6 [label="Expert 6\nGPU 86\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert7 [label="Expert 7\nGPU 87\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert8 [label="Expert 8\nGPU 88\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert9 [label="Expert 9\nGPU 89\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert10 [label="Expert 10\nGPU 90\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert11 [label="Expert 11\nGPU 91\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert12 [label="Expert 12\nGPU 92\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert13 [label="Expert 13\nGPU 93\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert14 [label="Expert 14\nGPU 94\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert15 [label="Expert 15\nGPU 95\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer11_expert_agg [label="Expert Aggregation\nGPUs 80-95\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp2_layer12_attn {
				bgcolor=lightpink label="Layer 12 Attention (TP=4)" style=rounded
				dp2_pp2_layer12_attn_tp0 [label="Attention TP0\nGPU 80\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_attn_tp1 [label="Attention TP1\nGPU 81\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_attn_tp2 [label="Attention TP2\nGPU 82\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_attn_tp3 [label="Attention TP3\nGPU 83\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_attn_allreduce [label="AllReduce Attention\nGPUs 80-83\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp2_layer12_moe {
				bgcolor=lightyellow label="Layer 12 MoE (EP=16)" style=rounded
				dp2_pp2_layer12_router [label="Router\nGPU 80\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp2_layer12_expert0 [label="Expert 0\nGPU 80\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert1 [label="Expert 1\nGPU 81\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert2 [label="Expert 2\nGPU 82\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert3 [label="Expert 3\nGPU 83\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert4 [label="Expert 4\nGPU 84\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert5 [label="Expert 5\nGPU 85\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert6 [label="Expert 6\nGPU 86\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert7 [label="Expert 7\nGPU 87\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert8 [label="Expert 8\nGPU 88\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert9 [label="Expert 9\nGPU 89\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert10 [label="Expert 10\nGPU 90\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert11 [label="Expert 11\nGPU 91\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert12 [label="Expert 12\nGPU 92\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert13 [label="Expert 13\nGPU 93\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert14 [label="Expert 14\nGPU 94\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert15 [label="Expert 15\nGPU 95\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer12_expert_agg [label="Expert Aggregation\nGPUs 80-95\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp2_layer13_attn {
				bgcolor=lightpink label="Layer 13 Attention (TP=4)" style=rounded
				dp2_pp2_layer13_attn_tp0 [label="Attention TP0\nGPU 80\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_attn_tp1 [label="Attention TP1\nGPU 81\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_attn_tp2 [label="Attention TP2\nGPU 82\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_attn_tp3 [label="Attention TP3\nGPU 83\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_attn_allreduce [label="AllReduce Attention\nGPUs 80-83\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp2_layer13_moe {
				bgcolor=lightyellow label="Layer 13 MoE (EP=16)" style=rounded
				dp2_pp2_layer13_router [label="Router\nGPU 80\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp2_layer13_expert0 [label="Expert 0\nGPU 80\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert1 [label="Expert 1\nGPU 81\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert2 [label="Expert 2\nGPU 82\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert3 [label="Expert 3\nGPU 83\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert4 [label="Expert 4\nGPU 84\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert5 [label="Expert 5\nGPU 85\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert6 [label="Expert 6\nGPU 86\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert7 [label="Expert 7\nGPU 87\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert8 [label="Expert 8\nGPU 88\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert9 [label="Expert 9\nGPU 89\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert10 [label="Expert 10\nGPU 90\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert11 [label="Expert 11\nGPU 91\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert12 [label="Expert 12\nGPU 92\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert13 [label="Expert 13\nGPU 93\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert14 [label="Expert 14\nGPU 94\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert15 [label="Expert 15\nGPU 95\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer13_expert_agg [label="Expert Aggregation\nGPUs 80-95\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp2_layer14_attn {
				bgcolor=lightpink label="Layer 14 Attention (TP=4)" style=rounded
				dp2_pp2_layer14_attn_tp0 [label="Attention TP0\nGPU 80\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_attn_tp1 [label="Attention TP1\nGPU 81\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_attn_tp2 [label="Attention TP2\nGPU 82\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_attn_tp3 [label="Attention TP3\nGPU 83\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_attn_allreduce [label="AllReduce Attention\nGPUs 80-83\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp2_layer14_moe {
				bgcolor=lightyellow label="Layer 14 MoE (EP=16)" style=rounded
				dp2_pp2_layer14_router [label="Router\nGPU 80\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp2_layer14_expert0 [label="Expert 0\nGPU 80\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert1 [label="Expert 1\nGPU 81\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert2 [label="Expert 2\nGPU 82\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert3 [label="Expert 3\nGPU 83\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert4 [label="Expert 4\nGPU 84\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert5 [label="Expert 5\nGPU 85\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert6 [label="Expert 6\nGPU 86\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert7 [label="Expert 7\nGPU 87\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert8 [label="Expert 8\nGPU 88\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert9 [label="Expert 9\nGPU 89\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert10 [label="Expert 10\nGPU 90\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert11 [label="Expert 11\nGPU 91\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert12 [label="Expert 12\nGPU 92\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert13 [label="Expert 13\nGPU 93\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert14 [label="Expert 14\nGPU 94\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert15 [label="Expert 15\nGPU 95\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer14_expert_agg [label="Expert Aggregation\nGPUs 80-95\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp2_layer15_attn {
				bgcolor=lightpink label="Layer 15 Attention (TP=4)" style=rounded
				dp2_pp2_layer15_attn_tp0 [label="Attention TP0\nGPU 80\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_attn_tp1 [label="Attention TP1\nGPU 81\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_attn_tp2 [label="Attention TP2\nGPU 82\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_attn_tp3 [label="Attention TP3\nGPU 83\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_attn_allreduce [label="AllReduce Attention\nGPUs 80-83\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp2_layer15_moe {
				bgcolor=lightyellow label="Layer 15 MoE (EP=16)" style=rounded
				dp2_pp2_layer15_router [label="Router\nGPU 80\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp2_layer15_expert0 [label="Expert 0\nGPU 80\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert1 [label="Expert 1\nGPU 81\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert2 [label="Expert 2\nGPU 82\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert3 [label="Expert 3\nGPU 83\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert4 [label="Expert 4\nGPU 84\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert5 [label="Expert 5\nGPU 85\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert6 [label="Expert 6\nGPU 86\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert7 [label="Expert 7\nGPU 87\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert8 [label="Expert 8\nGPU 88\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert9 [label="Expert 9\nGPU 89\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert10 [label="Expert 10\nGPU 90\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert11 [label="Expert 11\nGPU 91\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert12 [label="Expert 12\nGPU 92\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert13 [label="Expert 13\nGPU 93\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert14 [label="Expert 14\nGPU 94\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert15 [label="Expert 15\nGPU 95\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer15_expert_agg [label="Expert Aggregation\nGPUs 80-95\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp2_pp2_layer16_attn {
				bgcolor=lightpink label="Layer 16 Attention (TP=4)" style=rounded
				dp2_pp2_layer16_attn_tp0 [label="Attention TP0\nGPU 80\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_attn_tp1 [label="Attention TP1\nGPU 81\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_attn_tp2 [label="Attention TP2\nGPU 82\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_attn_tp3 [label="Attention TP3\nGPU 83\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_attn_allreduce [label="AllReduce Attention\nGPUs 80-83\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp2_pp2_layer16_moe {
				bgcolor=lightyellow label="Layer 16 MoE (EP=16)" style=rounded
				dp2_pp2_layer16_router [label="Router\nGPU 80\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp2_pp2_layer16_expert0 [label="Expert 0\nGPU 80\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert1 [label="Expert 1\nGPU 81\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert2 [label="Expert 2\nGPU 82\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert3 [label="Expert 3\nGPU 83\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert4 [label="Expert 4\nGPU 84\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert5 [label="Expert 5\nGPU 85\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert6 [label="Expert 6\nGPU 86\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert7 [label="Expert 7\nGPU 87\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert8 [label="Expert 8\nGPU 88\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert9 [label="Expert 9\nGPU 89\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert10 [label="Expert 10\nGPU 90\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert11 [label="Expert 11\nGPU 91\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert12 [label="Expert 12\nGPU 92\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert13 [label="Expert 13\nGPU 93\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert14 [label="Expert 14\nGPU 94\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert15 [label="Expert 15\nGPU 95\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp2_pp2_layer16_expert_agg [label="Expert Aggregation\nGPUs 80-95\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
		}
	}
	dp3_pp1_layer1_attn_tp0 -> dp3_pp1_layer1_attn_allreduce
	dp3_pp1_layer1_attn_tp1 -> dp3_pp1_layer1_attn_allreduce
	dp3_pp1_layer1_attn_tp2 -> dp3_pp1_layer1_attn_allreduce
	dp3_pp1_layer1_attn_tp3 -> dp3_pp1_layer1_attn_allreduce
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert0 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert1 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert2 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert3 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert4 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert5 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert6 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert7 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert8 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert9 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert10 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert11 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert12 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert13 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert14 [style=dashed]
	dp3_pp1_layer1_router -> dp3_pp1_layer1_expert15 [style=dashed]
	dp3_pp1_layer1_expert0 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert1 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert2 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert3 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert4 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert5 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert6 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert7 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert8 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert9 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert10 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert11 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert12 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert13 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert14 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_expert15 -> dp3_pp1_layer1_expert_agg
	dp3_pp1_layer1_attn_allreduce -> dp3_pp1_layer1_router [constraint=false]
	dp3_pp1_layer1_expert_agg -> dp3_pp1_layer2_attn_tp0 [constraint=false]
	dp3_pp1_layer2_attn_tp0 -> dp3_pp1_layer2_attn_allreduce
	dp3_pp1_layer2_attn_tp1 -> dp3_pp1_layer2_attn_allreduce
	dp3_pp1_layer2_attn_tp2 -> dp3_pp1_layer2_attn_allreduce
	dp3_pp1_layer2_attn_tp3 -> dp3_pp1_layer2_attn_allreduce
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert0 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert1 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert2 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert3 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert4 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert5 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert6 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert7 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert8 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert9 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert10 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert11 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert12 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert13 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert14 [style=dashed]
	dp3_pp1_layer2_router -> dp3_pp1_layer2_expert15 [style=dashed]
	dp3_pp1_layer2_expert0 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert1 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert2 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert3 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert4 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert5 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert6 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert7 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert8 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert9 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert10 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert11 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert12 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert13 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert14 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_expert15 -> dp3_pp1_layer2_expert_agg
	dp3_pp1_layer2_attn_allreduce -> dp3_pp1_layer2_router [constraint=false]
	dp3_pp1_layer2_expert_agg -> dp3_pp1_layer3_attn_tp0 [constraint=false]
	dp3_pp1_layer3_attn_tp0 -> dp3_pp1_layer3_attn_allreduce
	dp3_pp1_layer3_attn_tp1 -> dp3_pp1_layer3_attn_allreduce
	dp3_pp1_layer3_attn_tp2 -> dp3_pp1_layer3_attn_allreduce
	dp3_pp1_layer3_attn_tp3 -> dp3_pp1_layer3_attn_allreduce
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert0 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert1 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert2 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert3 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert4 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert5 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert6 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert7 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert8 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert9 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert10 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert11 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert12 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert13 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert14 [style=dashed]
	dp3_pp1_layer3_router -> dp3_pp1_layer3_expert15 [style=dashed]
	dp3_pp1_layer3_expert0 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert1 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert2 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert3 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert4 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert5 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert6 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert7 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert8 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert9 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert10 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert11 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert12 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert13 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert14 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_expert15 -> dp3_pp1_layer3_expert_agg
	dp3_pp1_layer3_attn_allreduce -> dp3_pp1_layer3_router [constraint=false]
	dp3_pp1_layer3_expert_agg -> dp3_pp1_layer4_attn_tp0 [constraint=false]
	dp3_pp1_layer4_attn_tp0 -> dp3_pp1_layer4_attn_allreduce
	dp3_pp1_layer4_attn_tp1 -> dp3_pp1_layer4_attn_allreduce
	dp3_pp1_layer4_attn_tp2 -> dp3_pp1_layer4_attn_allreduce
	dp3_pp1_layer4_attn_tp3 -> dp3_pp1_layer4_attn_allreduce
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert0 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert1 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert2 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert3 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert4 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert5 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert6 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert7 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert8 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert9 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert10 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert11 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert12 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert13 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert14 [style=dashed]
	dp3_pp1_layer4_router -> dp3_pp1_layer4_expert15 [style=dashed]
	dp3_pp1_layer4_expert0 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert1 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert2 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert3 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert4 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert5 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert6 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert7 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert8 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert9 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert10 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert11 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert12 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert13 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert14 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_expert15 -> dp3_pp1_layer4_expert_agg
	dp3_pp1_layer4_attn_allreduce -> dp3_pp1_layer4_router [constraint=false]
	dp3_pp1_layer4_expert_agg -> dp3_pp1_layer5_attn_tp0 [constraint=false]
	dp3_pp1_layer5_attn_tp0 -> dp3_pp1_layer5_attn_allreduce
	dp3_pp1_layer5_attn_tp1 -> dp3_pp1_layer5_attn_allreduce
	dp3_pp1_layer5_attn_tp2 -> dp3_pp1_layer5_attn_allreduce
	dp3_pp1_layer5_attn_tp3 -> dp3_pp1_layer5_attn_allreduce
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert0 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert1 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert2 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert3 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert4 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert5 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert6 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert7 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert8 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert9 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert10 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert11 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert12 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert13 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert14 [style=dashed]
	dp3_pp1_layer5_router -> dp3_pp1_layer5_expert15 [style=dashed]
	dp3_pp1_layer5_expert0 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert1 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert2 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert3 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert4 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert5 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert6 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert7 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert8 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert9 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert10 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert11 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert12 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert13 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert14 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_expert15 -> dp3_pp1_layer5_expert_agg
	dp3_pp1_layer5_attn_allreduce -> dp3_pp1_layer5_router [constraint=false]
	dp3_pp1_layer5_expert_agg -> dp3_pp1_layer6_attn_tp0 [constraint=false]
	dp3_pp1_layer6_attn_tp0 -> dp3_pp1_layer6_attn_allreduce
	dp3_pp1_layer6_attn_tp1 -> dp3_pp1_layer6_attn_allreduce
	dp3_pp1_layer6_attn_tp2 -> dp3_pp1_layer6_attn_allreduce
	dp3_pp1_layer6_attn_tp3 -> dp3_pp1_layer6_attn_allreduce
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert0 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert1 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert2 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert3 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert4 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert5 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert6 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert7 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert8 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert9 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert10 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert11 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert12 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert13 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert14 [style=dashed]
	dp3_pp1_layer6_router -> dp3_pp1_layer6_expert15 [style=dashed]
	dp3_pp1_layer6_expert0 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert1 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert2 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert3 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert4 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert5 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert6 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert7 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert8 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert9 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert10 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert11 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert12 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert13 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert14 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_expert15 -> dp3_pp1_layer6_expert_agg
	dp3_pp1_layer6_attn_allreduce -> dp3_pp1_layer6_router [constraint=false]
	dp3_pp1_layer6_expert_agg -> dp3_pp1_layer7_attn_tp0 [constraint=false]
	dp3_pp1_layer7_attn_tp0 -> dp3_pp1_layer7_attn_allreduce
	dp3_pp1_layer7_attn_tp1 -> dp3_pp1_layer7_attn_allreduce
	dp3_pp1_layer7_attn_tp2 -> dp3_pp1_layer7_attn_allreduce
	dp3_pp1_layer7_attn_tp3 -> dp3_pp1_layer7_attn_allreduce
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert0 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert1 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert2 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert3 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert4 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert5 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert6 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert7 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert8 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert9 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert10 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert11 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert12 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert13 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert14 [style=dashed]
	dp3_pp1_layer7_router -> dp3_pp1_layer7_expert15 [style=dashed]
	dp3_pp1_layer7_expert0 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert1 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert2 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert3 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert4 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert5 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert6 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert7 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert8 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert9 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert10 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert11 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert12 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert13 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert14 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_expert15 -> dp3_pp1_layer7_expert_agg
	dp3_pp1_layer7_attn_allreduce -> dp3_pp1_layer7_router [constraint=false]
	dp3_pp1_layer7_expert_agg -> dp3_pp1_layer8_attn_tp0 [constraint=false]
	dp3_pp1_layer8_attn_tp0 -> dp3_pp1_layer8_attn_allreduce
	dp3_pp1_layer8_attn_tp1 -> dp3_pp1_layer8_attn_allreduce
	dp3_pp1_layer8_attn_tp2 -> dp3_pp1_layer8_attn_allreduce
	dp3_pp1_layer8_attn_tp3 -> dp3_pp1_layer8_attn_allreduce
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert0 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert1 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert2 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert3 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert4 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert5 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert6 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert7 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert8 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert9 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert10 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert11 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert12 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert13 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert14 [style=dashed]
	dp3_pp1_layer8_router -> dp3_pp1_layer8_expert15 [style=dashed]
	dp3_pp1_layer8_expert0 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert1 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert2 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert3 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert4 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert5 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert6 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert7 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert8 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert9 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert10 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert11 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert12 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert13 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert14 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_expert15 -> dp3_pp1_layer8_expert_agg
	dp3_pp1_layer8_attn_allreduce -> dp3_pp1_layer8_router [constraint=false]
	dp3_pp2_layer9_attn_tp0 -> dp3_pp2_layer9_attn_allreduce
	dp3_pp2_layer9_attn_tp1 -> dp3_pp2_layer9_attn_allreduce
	dp3_pp2_layer9_attn_tp2 -> dp3_pp2_layer9_attn_allreduce
	dp3_pp2_layer9_attn_tp3 -> dp3_pp2_layer9_attn_allreduce
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert0 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert1 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert2 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert3 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert4 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert5 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert6 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert7 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert8 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert9 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert10 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert11 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert12 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert13 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert14 [style=dashed]
	dp3_pp2_layer9_router -> dp3_pp2_layer9_expert15 [style=dashed]
	dp3_pp2_layer9_expert0 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert1 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert2 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert3 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert4 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert5 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert6 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert7 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert8 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert9 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert10 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert11 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert12 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert13 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert14 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_expert15 -> dp3_pp2_layer9_expert_agg
	dp3_pp2_layer9_attn_allreduce -> dp3_pp2_layer9_router [constraint=false]
	dp3_pp2_layer9_expert_agg -> dp3_pp2_layer10_attn_tp0 [constraint=false]
	dp3_pp2_layer10_attn_tp0 -> dp3_pp2_layer10_attn_allreduce
	dp3_pp2_layer10_attn_tp1 -> dp3_pp2_layer10_attn_allreduce
	dp3_pp2_layer10_attn_tp2 -> dp3_pp2_layer10_attn_allreduce
	dp3_pp2_layer10_attn_tp3 -> dp3_pp2_layer10_attn_allreduce
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert0 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert1 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert2 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert3 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert4 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert5 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert6 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert7 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert8 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert9 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert10 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert11 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert12 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert13 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert14 [style=dashed]
	dp3_pp2_layer10_router -> dp3_pp2_layer10_expert15 [style=dashed]
	dp3_pp2_layer10_expert0 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert1 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert2 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert3 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert4 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert5 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert6 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert7 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert8 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert9 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert10 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert11 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert12 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert13 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert14 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_expert15 -> dp3_pp2_layer10_expert_agg
	dp3_pp2_layer10_attn_allreduce -> dp3_pp2_layer10_router [constraint=false]
	dp3_pp2_layer10_expert_agg -> dp3_pp2_layer11_attn_tp0 [constraint=false]
	dp3_pp2_layer11_attn_tp0 -> dp3_pp2_layer11_attn_allreduce
	dp3_pp2_layer11_attn_tp1 -> dp3_pp2_layer11_attn_allreduce
	dp3_pp2_layer11_attn_tp2 -> dp3_pp2_layer11_attn_allreduce
	dp3_pp2_layer11_attn_tp3 -> dp3_pp2_layer11_attn_allreduce
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert0 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert1 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert2 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert3 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert4 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert5 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert6 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert7 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert8 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert9 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert10 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert11 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert12 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert13 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert14 [style=dashed]
	dp3_pp2_layer11_router -> dp3_pp2_layer11_expert15 [style=dashed]
	dp3_pp2_layer11_expert0 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert1 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert2 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert3 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert4 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert5 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert6 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert7 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert8 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert9 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert10 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert11 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert12 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert13 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert14 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_expert15 -> dp3_pp2_layer11_expert_agg
	dp3_pp2_layer11_attn_allreduce -> dp3_pp2_layer11_router [constraint=false]
	dp3_pp2_layer11_expert_agg -> dp3_pp2_layer12_attn_tp0 [constraint=false]
	dp3_pp2_layer12_attn_tp0 -> dp3_pp2_layer12_attn_allreduce
	dp3_pp2_layer12_attn_tp1 -> dp3_pp2_layer12_attn_allreduce
	dp3_pp2_layer12_attn_tp2 -> dp3_pp2_layer12_attn_allreduce
	dp3_pp2_layer12_attn_tp3 -> dp3_pp2_layer12_attn_allreduce
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert0 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert1 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert2 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert3 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert4 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert5 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert6 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert7 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert8 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert9 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert10 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert11 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert12 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert13 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert14 [style=dashed]
	dp3_pp2_layer12_router -> dp3_pp2_layer12_expert15 [style=dashed]
	dp3_pp2_layer12_expert0 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert1 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert2 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert3 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert4 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert5 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert6 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert7 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert8 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert9 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert10 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert11 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert12 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert13 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert14 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_expert15 -> dp3_pp2_layer12_expert_agg
	dp3_pp2_layer12_attn_allreduce -> dp3_pp2_layer12_router [constraint=false]
	dp3_pp2_layer12_expert_agg -> dp3_pp2_layer13_attn_tp0 [constraint=false]
	dp3_pp2_layer13_attn_tp0 -> dp3_pp2_layer13_attn_allreduce
	dp3_pp2_layer13_attn_tp1 -> dp3_pp2_layer13_attn_allreduce
	dp3_pp2_layer13_attn_tp2 -> dp3_pp2_layer13_attn_allreduce
	dp3_pp2_layer13_attn_tp3 -> dp3_pp2_layer13_attn_allreduce
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert0 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert1 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert2 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert3 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert4 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert5 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert6 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert7 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert8 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert9 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert10 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert11 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert12 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert13 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert14 [style=dashed]
	dp3_pp2_layer13_router -> dp3_pp2_layer13_expert15 [style=dashed]
	dp3_pp2_layer13_expert0 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert1 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert2 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert3 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert4 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert5 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert6 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert7 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert8 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert9 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert10 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert11 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert12 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert13 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert14 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_expert15 -> dp3_pp2_layer13_expert_agg
	dp3_pp2_layer13_attn_allreduce -> dp3_pp2_layer13_router [constraint=false]
	dp3_pp2_layer13_expert_agg -> dp3_pp2_layer14_attn_tp0 [constraint=false]
	dp3_pp2_layer14_attn_tp0 -> dp3_pp2_layer14_attn_allreduce
	dp3_pp2_layer14_attn_tp1 -> dp3_pp2_layer14_attn_allreduce
	dp3_pp2_layer14_attn_tp2 -> dp3_pp2_layer14_attn_allreduce
	dp3_pp2_layer14_attn_tp3 -> dp3_pp2_layer14_attn_allreduce
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert0 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert1 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert2 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert3 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert4 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert5 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert6 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert7 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert8 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert9 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert10 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert11 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert12 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert13 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert14 [style=dashed]
	dp3_pp2_layer14_router -> dp3_pp2_layer14_expert15 [style=dashed]
	dp3_pp2_layer14_expert0 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert1 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert2 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert3 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert4 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert5 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert6 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert7 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert8 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert9 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert10 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert11 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert12 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert13 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert14 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_expert15 -> dp3_pp2_layer14_expert_agg
	dp3_pp2_layer14_attn_allreduce -> dp3_pp2_layer14_router [constraint=false]
	dp3_pp2_layer14_expert_agg -> dp3_pp2_layer15_attn_tp0 [constraint=false]
	dp3_pp2_layer15_attn_tp0 -> dp3_pp2_layer15_attn_allreduce
	dp3_pp2_layer15_attn_tp1 -> dp3_pp2_layer15_attn_allreduce
	dp3_pp2_layer15_attn_tp2 -> dp3_pp2_layer15_attn_allreduce
	dp3_pp2_layer15_attn_tp3 -> dp3_pp2_layer15_attn_allreduce
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert0 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert1 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert2 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert3 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert4 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert5 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert6 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert7 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert8 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert9 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert10 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert11 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert12 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert13 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert14 [style=dashed]
	dp3_pp2_layer15_router -> dp3_pp2_layer15_expert15 [style=dashed]
	dp3_pp2_layer15_expert0 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert1 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert2 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert3 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert4 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert5 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert6 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert7 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert8 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert9 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert10 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert11 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert12 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert13 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert14 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_expert15 -> dp3_pp2_layer15_expert_agg
	dp3_pp2_layer15_attn_allreduce -> dp3_pp2_layer15_router [constraint=false]
	dp3_pp2_layer15_expert_agg -> dp3_pp2_layer16_attn_tp0 [constraint=false]
	dp3_pp2_layer16_attn_tp0 -> dp3_pp2_layer16_attn_allreduce
	dp3_pp2_layer16_attn_tp1 -> dp3_pp2_layer16_attn_allreduce
	dp3_pp2_layer16_attn_tp2 -> dp3_pp2_layer16_attn_allreduce
	dp3_pp2_layer16_attn_tp3 -> dp3_pp2_layer16_attn_allreduce
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert0 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert1 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert2 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert3 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert4 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert5 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert6 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert7 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert8 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert9 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert10 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert11 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert12 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert13 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert14 [style=dashed]
	dp3_pp2_layer16_router -> dp3_pp2_layer16_expert15 [style=dashed]
	dp3_pp2_layer16_expert0 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert1 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert2 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert3 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert4 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert5 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert6 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert7 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert8 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert9 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert10 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert11 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert12 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert13 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert14 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_expert15 -> dp3_pp2_layer16_expert_agg
	dp3_pp2_layer16_attn_allreduce -> dp3_pp2_layer16_router [constraint=false]
	subgraph cluster_dp_3 {
		bgcolor=lightgray label="DP Replica 3 (GPUs 96-127)" style=rounded
		subgraph cluster_pp1_dp3 {
			bgcolor=lightcyan label="PP Stage 1: Layers 1-8 (GPUs 96-111)" style=rounded
			subgraph cluster_dp3_pp1_layer1_attn {
				bgcolor=lightpink label="Layer 1 Attention (TP=4)" style=rounded
				dp3_pp1_layer1_attn_tp0 [label="Attention TP0\nGPU 96\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_attn_tp1 [label="Attention TP1\nGPU 97\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_attn_tp2 [label="Attention TP2\nGPU 98\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_attn_tp3 [label="Attention TP3\nGPU 99\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_attn_allreduce [label="AllReduce Attention\nGPUs 96-99\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp1_layer1_moe {
				bgcolor=lightyellow label="Layer 1 MoE (EP=16)" style=rounded
				dp3_pp1_layer1_router [label="Router\nGPU 96\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp1_layer1_expert0 [label="Expert 0\nGPU 96\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert1 [label="Expert 1\nGPU 97\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert2 [label="Expert 2\nGPU 98\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert3 [label="Expert 3\nGPU 99\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert4 [label="Expert 4\nGPU 100\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert5 [label="Expert 5\nGPU 101\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert6 [label="Expert 6\nGPU 102\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert7 [label="Expert 7\nGPU 103\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert8 [label="Expert 8\nGPU 104\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert9 [label="Expert 9\nGPU 105\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert10 [label="Expert 10\nGPU 106\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert11 [label="Expert 11\nGPU 107\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert12 [label="Expert 12\nGPU 108\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert13 [label="Expert 13\nGPU 109\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert14 [label="Expert 14\nGPU 110\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert15 [label="Expert 15\nGPU 111\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer1_expert_agg [label="Expert Aggregation\nGPUs 96-111\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp1_layer2_attn {
				bgcolor=lightpink label="Layer 2 Attention (TP=4)" style=rounded
				dp3_pp1_layer2_attn_tp0 [label="Attention TP0\nGPU 96\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_attn_tp1 [label="Attention TP1\nGPU 97\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_attn_tp2 [label="Attention TP2\nGPU 98\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_attn_tp3 [label="Attention TP3\nGPU 99\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_attn_allreduce [label="AllReduce Attention\nGPUs 96-99\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp1_layer2_moe {
				bgcolor=lightyellow label="Layer 2 MoE (EP=16)" style=rounded
				dp3_pp1_layer2_router [label="Router\nGPU 96\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp1_layer2_expert0 [label="Expert 0\nGPU 96\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert1 [label="Expert 1\nGPU 97\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert2 [label="Expert 2\nGPU 98\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert3 [label="Expert 3\nGPU 99\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert4 [label="Expert 4\nGPU 100\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert5 [label="Expert 5\nGPU 101\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert6 [label="Expert 6\nGPU 102\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert7 [label="Expert 7\nGPU 103\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert8 [label="Expert 8\nGPU 104\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert9 [label="Expert 9\nGPU 105\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert10 [label="Expert 10\nGPU 106\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert11 [label="Expert 11\nGPU 107\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert12 [label="Expert 12\nGPU 108\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert13 [label="Expert 13\nGPU 109\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert14 [label="Expert 14\nGPU 110\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert15 [label="Expert 15\nGPU 111\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer2_expert_agg [label="Expert Aggregation\nGPUs 96-111\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp1_layer3_attn {
				bgcolor=lightpink label="Layer 3 Attention (TP=4)" style=rounded
				dp3_pp1_layer3_attn_tp0 [label="Attention TP0\nGPU 96\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_attn_tp1 [label="Attention TP1\nGPU 97\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_attn_tp2 [label="Attention TP2\nGPU 98\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_attn_tp3 [label="Attention TP3\nGPU 99\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_attn_allreduce [label="AllReduce Attention\nGPUs 96-99\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp1_layer3_moe {
				bgcolor=lightyellow label="Layer 3 MoE (EP=16)" style=rounded
				dp3_pp1_layer3_router [label="Router\nGPU 96\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp1_layer3_expert0 [label="Expert 0\nGPU 96\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert1 [label="Expert 1\nGPU 97\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert2 [label="Expert 2\nGPU 98\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert3 [label="Expert 3\nGPU 99\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert4 [label="Expert 4\nGPU 100\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert5 [label="Expert 5\nGPU 101\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert6 [label="Expert 6\nGPU 102\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert7 [label="Expert 7\nGPU 103\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert8 [label="Expert 8\nGPU 104\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert9 [label="Expert 9\nGPU 105\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert10 [label="Expert 10\nGPU 106\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert11 [label="Expert 11\nGPU 107\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert12 [label="Expert 12\nGPU 108\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert13 [label="Expert 13\nGPU 109\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert14 [label="Expert 14\nGPU 110\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert15 [label="Expert 15\nGPU 111\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer3_expert_agg [label="Expert Aggregation\nGPUs 96-111\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp1_layer4_attn {
				bgcolor=lightpink label="Layer 4 Attention (TP=4)" style=rounded
				dp3_pp1_layer4_attn_tp0 [label="Attention TP0\nGPU 96\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_attn_tp1 [label="Attention TP1\nGPU 97\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_attn_tp2 [label="Attention TP2\nGPU 98\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_attn_tp3 [label="Attention TP3\nGPU 99\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_attn_allreduce [label="AllReduce Attention\nGPUs 96-99\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp1_layer4_moe {
				bgcolor=lightyellow label="Layer 4 MoE (EP=16)" style=rounded
				dp3_pp1_layer4_router [label="Router\nGPU 96\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp1_layer4_expert0 [label="Expert 0\nGPU 96\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert1 [label="Expert 1\nGPU 97\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert2 [label="Expert 2\nGPU 98\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert3 [label="Expert 3\nGPU 99\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert4 [label="Expert 4\nGPU 100\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert5 [label="Expert 5\nGPU 101\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert6 [label="Expert 6\nGPU 102\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert7 [label="Expert 7\nGPU 103\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert8 [label="Expert 8\nGPU 104\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert9 [label="Expert 9\nGPU 105\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert10 [label="Expert 10\nGPU 106\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert11 [label="Expert 11\nGPU 107\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert12 [label="Expert 12\nGPU 108\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert13 [label="Expert 13\nGPU 109\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert14 [label="Expert 14\nGPU 110\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert15 [label="Expert 15\nGPU 111\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer4_expert_agg [label="Expert Aggregation\nGPUs 96-111\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp1_layer5_attn {
				bgcolor=lightpink label="Layer 5 Attention (TP=4)" style=rounded
				dp3_pp1_layer5_attn_tp0 [label="Attention TP0\nGPU 96\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_attn_tp1 [label="Attention TP1\nGPU 97\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_attn_tp2 [label="Attention TP2\nGPU 98\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_attn_tp3 [label="Attention TP3\nGPU 99\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_attn_allreduce [label="AllReduce Attention\nGPUs 96-99\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp1_layer5_moe {
				bgcolor=lightyellow label="Layer 5 MoE (EP=16)" style=rounded
				dp3_pp1_layer5_router [label="Router\nGPU 96\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp1_layer5_expert0 [label="Expert 0\nGPU 96\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert1 [label="Expert 1\nGPU 97\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert2 [label="Expert 2\nGPU 98\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert3 [label="Expert 3\nGPU 99\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert4 [label="Expert 4\nGPU 100\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert5 [label="Expert 5\nGPU 101\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert6 [label="Expert 6\nGPU 102\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert7 [label="Expert 7\nGPU 103\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert8 [label="Expert 8\nGPU 104\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert9 [label="Expert 9\nGPU 105\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert10 [label="Expert 10\nGPU 106\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert11 [label="Expert 11\nGPU 107\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert12 [label="Expert 12\nGPU 108\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert13 [label="Expert 13\nGPU 109\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert14 [label="Expert 14\nGPU 110\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert15 [label="Expert 15\nGPU 111\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer5_expert_agg [label="Expert Aggregation\nGPUs 96-111\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp1_layer6_attn {
				bgcolor=lightpink label="Layer 6 Attention (TP=4)" style=rounded
				dp3_pp1_layer6_attn_tp0 [label="Attention TP0\nGPU 96\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_attn_tp1 [label="Attention TP1\nGPU 97\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_attn_tp2 [label="Attention TP2\nGPU 98\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_attn_tp3 [label="Attention TP3\nGPU 99\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_attn_allreduce [label="AllReduce Attention\nGPUs 96-99\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp1_layer6_moe {
				bgcolor=lightyellow label="Layer 6 MoE (EP=16)" style=rounded
				dp3_pp1_layer6_router [label="Router\nGPU 96\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp1_layer6_expert0 [label="Expert 0\nGPU 96\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert1 [label="Expert 1\nGPU 97\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert2 [label="Expert 2\nGPU 98\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert3 [label="Expert 3\nGPU 99\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert4 [label="Expert 4\nGPU 100\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert5 [label="Expert 5\nGPU 101\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert6 [label="Expert 6\nGPU 102\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert7 [label="Expert 7\nGPU 103\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert8 [label="Expert 8\nGPU 104\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert9 [label="Expert 9\nGPU 105\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert10 [label="Expert 10\nGPU 106\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert11 [label="Expert 11\nGPU 107\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert12 [label="Expert 12\nGPU 108\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert13 [label="Expert 13\nGPU 109\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert14 [label="Expert 14\nGPU 110\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert15 [label="Expert 15\nGPU 111\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer6_expert_agg [label="Expert Aggregation\nGPUs 96-111\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp1_layer7_attn {
				bgcolor=lightpink label="Layer 7 Attention (TP=4)" style=rounded
				dp3_pp1_layer7_attn_tp0 [label="Attention TP0\nGPU 96\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_attn_tp1 [label="Attention TP1\nGPU 97\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_attn_tp2 [label="Attention TP2\nGPU 98\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_attn_tp3 [label="Attention TP3\nGPU 99\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_attn_allreduce [label="AllReduce Attention\nGPUs 96-99\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp1_layer7_moe {
				bgcolor=lightyellow label="Layer 7 MoE (EP=16)" style=rounded
				dp3_pp1_layer7_router [label="Router\nGPU 96\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp1_layer7_expert0 [label="Expert 0\nGPU 96\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert1 [label="Expert 1\nGPU 97\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert2 [label="Expert 2\nGPU 98\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert3 [label="Expert 3\nGPU 99\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert4 [label="Expert 4\nGPU 100\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert5 [label="Expert 5\nGPU 101\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert6 [label="Expert 6\nGPU 102\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert7 [label="Expert 7\nGPU 103\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert8 [label="Expert 8\nGPU 104\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert9 [label="Expert 9\nGPU 105\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert10 [label="Expert 10\nGPU 106\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert11 [label="Expert 11\nGPU 107\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert12 [label="Expert 12\nGPU 108\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert13 [label="Expert 13\nGPU 109\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert14 [label="Expert 14\nGPU 110\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert15 [label="Expert 15\nGPU 111\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer7_expert_agg [label="Expert Aggregation\nGPUs 96-111\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp1_layer8_attn {
				bgcolor=lightpink label="Layer 8 Attention (TP=4)" style=rounded
				dp3_pp1_layer8_attn_tp0 [label="Attention TP0\nGPU 96\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_attn_tp1 [label="Attention TP1\nGPU 97\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_attn_tp2 [label="Attention TP2\nGPU 98\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_attn_tp3 [label="Attention TP3\nGPU 99\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_attn_allreduce [label="AllReduce Attention\nGPUs 96-99\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp1_layer8_moe {
				bgcolor=lightyellow label="Layer 8 MoE (EP=16)" style=rounded
				dp3_pp1_layer8_router [label="Router\nGPU 96\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp1_layer8_expert0 [label="Expert 0\nGPU 96\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert1 [label="Expert 1\nGPU 97\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert2 [label="Expert 2\nGPU 98\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert3 [label="Expert 3\nGPU 99\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert4 [label="Expert 4\nGPU 100\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert5 [label="Expert 5\nGPU 101\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert6 [label="Expert 6\nGPU 102\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert7 [label="Expert 7\nGPU 103\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert8 [label="Expert 8\nGPU 104\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert9 [label="Expert 9\nGPU 105\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert10 [label="Expert 10\nGPU 106\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert11 [label="Expert 11\nGPU 107\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert12 [label="Expert 12\nGPU 108\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert13 [label="Expert 13\nGPU 109\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert14 [label="Expert 14\nGPU 110\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert15 [label="Expert 15\nGPU 111\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp1_layer8_expert_agg [label="Expert Aggregation\nGPUs 96-111\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
		}
		subgraph cluster_pp2_dp3 {
			bgcolor=lightcyan label="PP Stage 2: Layers 9-16 (GPUs 112-127)" style=rounded
			subgraph cluster_dp3_pp2_layer9_attn {
				bgcolor=lightpink label="Layer 9 Attention (TP=4)" style=rounded
				dp3_pp2_layer9_attn_tp0 [label="Attention TP0\nGPU 112\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_attn_tp1 [label="Attention TP1\nGPU 113\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_attn_tp2 [label="Attention TP2\nGPU 114\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_attn_tp3 [label="Attention TP3\nGPU 115\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_attn_allreduce [label="AllReduce Attention\nGPUs 112-115\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp2_layer9_moe {
				bgcolor=lightyellow label="Layer 9 MoE (EP=16)" style=rounded
				dp3_pp2_layer9_router [label="Router\nGPU 112\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp2_layer9_expert0 [label="Expert 0\nGPU 112\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert1 [label="Expert 1\nGPU 113\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert2 [label="Expert 2\nGPU 114\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert3 [label="Expert 3\nGPU 115\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert4 [label="Expert 4\nGPU 116\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert5 [label="Expert 5\nGPU 117\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert6 [label="Expert 6\nGPU 118\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert7 [label="Expert 7\nGPU 119\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert8 [label="Expert 8\nGPU 120\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert9 [label="Expert 9\nGPU 121\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert10 [label="Expert 10\nGPU 122\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert11 [label="Expert 11\nGPU 123\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert12 [label="Expert 12\nGPU 124\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert13 [label="Expert 13\nGPU 125\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert14 [label="Expert 14\nGPU 126\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert15 [label="Expert 15\nGPU 127\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer9_expert_agg [label="Expert Aggregation\nGPUs 112-127\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp2_layer10_attn {
				bgcolor=lightpink label="Layer 10 Attention (TP=4)" style=rounded
				dp3_pp2_layer10_attn_tp0 [label="Attention TP0\nGPU 112\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_attn_tp1 [label="Attention TP1\nGPU 113\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_attn_tp2 [label="Attention TP2\nGPU 114\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_attn_tp3 [label="Attention TP3\nGPU 115\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_attn_allreduce [label="AllReduce Attention\nGPUs 112-115\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp2_layer10_moe {
				bgcolor=lightyellow label="Layer 10 MoE (EP=16)" style=rounded
				dp3_pp2_layer10_router [label="Router\nGPU 112\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp2_layer10_expert0 [label="Expert 0\nGPU 112\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert1 [label="Expert 1\nGPU 113\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert2 [label="Expert 2\nGPU 114\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert3 [label="Expert 3\nGPU 115\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert4 [label="Expert 4\nGPU 116\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert5 [label="Expert 5\nGPU 117\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert6 [label="Expert 6\nGPU 118\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert7 [label="Expert 7\nGPU 119\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert8 [label="Expert 8\nGPU 120\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert9 [label="Expert 9\nGPU 121\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert10 [label="Expert 10\nGPU 122\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert11 [label="Expert 11\nGPU 123\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert12 [label="Expert 12\nGPU 124\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert13 [label="Expert 13\nGPU 125\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert14 [label="Expert 14\nGPU 126\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert15 [label="Expert 15\nGPU 127\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer10_expert_agg [label="Expert Aggregation\nGPUs 112-127\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp2_layer11_attn {
				bgcolor=lightpink label="Layer 11 Attention (TP=4)" style=rounded
				dp3_pp2_layer11_attn_tp0 [label="Attention TP0\nGPU 112\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_attn_tp1 [label="Attention TP1\nGPU 113\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_attn_tp2 [label="Attention TP2\nGPU 114\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_attn_tp3 [label="Attention TP3\nGPU 115\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_attn_allreduce [label="AllReduce Attention\nGPUs 112-115\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp2_layer11_moe {
				bgcolor=lightyellow label="Layer 11 MoE (EP=16)" style=rounded
				dp3_pp2_layer11_router [label="Router\nGPU 112\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp2_layer11_expert0 [label="Expert 0\nGPU 112\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert1 [label="Expert 1\nGPU 113\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert2 [label="Expert 2\nGPU 114\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert3 [label="Expert 3\nGPU 115\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert4 [label="Expert 4\nGPU 116\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert5 [label="Expert 5\nGPU 117\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert6 [label="Expert 6\nGPU 118\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert7 [label="Expert 7\nGPU 119\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert8 [label="Expert 8\nGPU 120\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert9 [label="Expert 9\nGPU 121\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert10 [label="Expert 10\nGPU 122\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert11 [label="Expert 11\nGPU 123\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert12 [label="Expert 12\nGPU 124\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert13 [label="Expert 13\nGPU 125\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert14 [label="Expert 14\nGPU 126\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert15 [label="Expert 15\nGPU 127\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer11_expert_agg [label="Expert Aggregation\nGPUs 112-127\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp2_layer12_attn {
				bgcolor=lightpink label="Layer 12 Attention (TP=4)" style=rounded
				dp3_pp2_layer12_attn_tp0 [label="Attention TP0\nGPU 112\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_attn_tp1 [label="Attention TP1\nGPU 113\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_attn_tp2 [label="Attention TP2\nGPU 114\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_attn_tp3 [label="Attention TP3\nGPU 115\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_attn_allreduce [label="AllReduce Attention\nGPUs 112-115\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp2_layer12_moe {
				bgcolor=lightyellow label="Layer 12 MoE (EP=16)" style=rounded
				dp3_pp2_layer12_router [label="Router\nGPU 112\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp2_layer12_expert0 [label="Expert 0\nGPU 112\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert1 [label="Expert 1\nGPU 113\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert2 [label="Expert 2\nGPU 114\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert3 [label="Expert 3\nGPU 115\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert4 [label="Expert 4\nGPU 116\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert5 [label="Expert 5\nGPU 117\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert6 [label="Expert 6\nGPU 118\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert7 [label="Expert 7\nGPU 119\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert8 [label="Expert 8\nGPU 120\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert9 [label="Expert 9\nGPU 121\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert10 [label="Expert 10\nGPU 122\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert11 [label="Expert 11\nGPU 123\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert12 [label="Expert 12\nGPU 124\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert13 [label="Expert 13\nGPU 125\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert14 [label="Expert 14\nGPU 126\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert15 [label="Expert 15\nGPU 127\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer12_expert_agg [label="Expert Aggregation\nGPUs 112-127\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp2_layer13_attn {
				bgcolor=lightpink label="Layer 13 Attention (TP=4)" style=rounded
				dp3_pp2_layer13_attn_tp0 [label="Attention TP0\nGPU 112\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_attn_tp1 [label="Attention TP1\nGPU 113\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_attn_tp2 [label="Attention TP2\nGPU 114\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_attn_tp3 [label="Attention TP3\nGPU 115\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_attn_allreduce [label="AllReduce Attention\nGPUs 112-115\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp2_layer13_moe {
				bgcolor=lightyellow label="Layer 13 MoE (EP=16)" style=rounded
				dp3_pp2_layer13_router [label="Router\nGPU 112\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp2_layer13_expert0 [label="Expert 0\nGPU 112\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert1 [label="Expert 1\nGPU 113\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert2 [label="Expert 2\nGPU 114\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert3 [label="Expert 3\nGPU 115\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert4 [label="Expert 4\nGPU 116\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert5 [label="Expert 5\nGPU 117\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert6 [label="Expert 6\nGPU 118\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert7 [label="Expert 7\nGPU 119\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert8 [label="Expert 8\nGPU 120\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert9 [label="Expert 9\nGPU 121\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert10 [label="Expert 10\nGPU 122\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert11 [label="Expert 11\nGPU 123\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert12 [label="Expert 12\nGPU 124\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert13 [label="Expert 13\nGPU 125\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert14 [label="Expert 14\nGPU 126\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert15 [label="Expert 15\nGPU 127\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer13_expert_agg [label="Expert Aggregation\nGPUs 112-127\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp2_layer14_attn {
				bgcolor=lightpink label="Layer 14 Attention (TP=4)" style=rounded
				dp3_pp2_layer14_attn_tp0 [label="Attention TP0\nGPU 112\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_attn_tp1 [label="Attention TP1\nGPU 113\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_attn_tp2 [label="Attention TP2\nGPU 114\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_attn_tp3 [label="Attention TP3\nGPU 115\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_attn_allreduce [label="AllReduce Attention\nGPUs 112-115\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp2_layer14_moe {
				bgcolor=lightyellow label="Layer 14 MoE (EP=16)" style=rounded
				dp3_pp2_layer14_router [label="Router\nGPU 112\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp2_layer14_expert0 [label="Expert 0\nGPU 112\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert1 [label="Expert 1\nGPU 113\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert2 [label="Expert 2\nGPU 114\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert3 [label="Expert 3\nGPU 115\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert4 [label="Expert 4\nGPU 116\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert5 [label="Expert 5\nGPU 117\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert6 [label="Expert 6\nGPU 118\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert7 [label="Expert 7\nGPU 119\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert8 [label="Expert 8\nGPU 120\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert9 [label="Expert 9\nGPU 121\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert10 [label="Expert 10\nGPU 122\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert11 [label="Expert 11\nGPU 123\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert12 [label="Expert 12\nGPU 124\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert13 [label="Expert 13\nGPU 125\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert14 [label="Expert 14\nGPU 126\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert15 [label="Expert 15\nGPU 127\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer14_expert_agg [label="Expert Aggregation\nGPUs 112-127\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp2_layer15_attn {
				bgcolor=lightpink label="Layer 15 Attention (TP=4)" style=rounded
				dp3_pp2_layer15_attn_tp0 [label="Attention TP0\nGPU 112\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_attn_tp1 [label="Attention TP1\nGPU 113\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_attn_tp2 [label="Attention TP2\nGPU 114\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_attn_tp3 [label="Attention TP3\nGPU 115\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_attn_allreduce [label="AllReduce Attention\nGPUs 112-115\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp2_layer15_moe {
				bgcolor=lightyellow label="Layer 15 MoE (EP=16)" style=rounded
				dp3_pp2_layer15_router [label="Router\nGPU 112\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp2_layer15_expert0 [label="Expert 0\nGPU 112\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert1 [label="Expert 1\nGPU 113\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert2 [label="Expert 2\nGPU 114\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert3 [label="Expert 3\nGPU 115\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert4 [label="Expert 4\nGPU 116\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert5 [label="Expert 5\nGPU 117\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert6 [label="Expert 6\nGPU 118\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert7 [label="Expert 7\nGPU 119\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert8 [label="Expert 8\nGPU 120\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert9 [label="Expert 9\nGPU 121\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert10 [label="Expert 10\nGPU 122\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert11 [label="Expert 11\nGPU 123\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert12 [label="Expert 12\nGPU 124\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert13 [label="Expert 13\nGPU 125\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert14 [label="Expert 14\nGPU 126\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert15 [label="Expert 15\nGPU 127\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer15_expert_agg [label="Expert Aggregation\nGPUs 112-127\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
			subgraph cluster_dp3_pp2_layer16_attn {
				bgcolor=lightpink label="Layer 16 Attention (TP=4)" style=rounded
				dp3_pp2_layer16_attn_tp0 [label="Attention TP0\nGPU 112\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_attn_tp1 [label="Attention TP1\nGPU 113\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_attn_tp2 [label="Attention TP2\nGPU 114\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_attn_tp3 [label="Attention TP3\nGPU 115\nInput: [batch_size=1, seq_len=1024, heads=4, d_k=32]\nOutput: [batch_size=1, seq_len=1024, heads=4, d_k=32]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_attn_allreduce [label="AllReduce Attention\nGPUs 112-115\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
			}
			subgraph cluster_dp3_pp2_layer16_moe {
				bgcolor=lightyellow label="Layer 16 MoE (EP=16)" style=rounded
				dp3_pp2_layer16_router [label="Router\nGPU 112\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
				dp3_pp2_layer16_expert0 [label="Expert 0\nGPU 112\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert1 [label="Expert 1\nGPU 113\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert2 [label="Expert 2\nGPU 114\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert3 [label="Expert 3\nGPU 115\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert4 [label="Expert 4\nGPU 116\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert5 [label="Expert 5\nGPU 117\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert6 [label="Expert 6\nGPU 118\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert7 [label="Expert 7\nGPU 119\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert8 [label="Expert 8\nGPU 120\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert9 [label="Expert 9\nGPU 121\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert10 [label="Expert 10\nGPU 122\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert11 [label="Expert 11\nGPU 123\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert12 [label="Expert 12\nGPU 124\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert13 [label="Expert 13\nGPU 125\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert14 [label="Expert 14\nGPU 126\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert15 [label="Expert 15\nGPU 127\nInput: [batch_size=?, seq_len=?, hidden=512]\nOutput: [batch_size=?, seq_len=?, hidden=512]" fillcolor=lightgreen shape=rectangle]
				dp3_pp2_layer16_expert_agg [label="Expert Aggregation\nGPUs 112-127\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightyellow shape=parallelogram]
			}
		}
	}
	dp0_pp1_to_pp2 [label="PP Stage Transition\nGPU 15  GPU 16\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
	dp0_pp1_layer8_expert_agg -> dp0_pp1_to_pp2
	dp0_pp1_to_pp2 -> dp0_pp2_layer9_attn_tp0
	dp1_pp1_to_pp2 [label="PP Stage Transition\nGPU 47  GPU 48\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
	dp1_pp1_layer8_expert_agg -> dp1_pp1_to_pp2
	dp1_pp1_to_pp2 -> dp1_pp2_layer9_attn_tp0
	dp2_pp1_to_pp2 [label="PP Stage Transition\nGPU 79  GPU 80\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
	dp2_pp1_layer8_expert_agg -> dp2_pp1_to_pp2
	dp2_pp1_to_pp2 -> dp2_pp2_layer9_attn_tp0
	dp3_pp1_to_pp2 [label="PP Stage Transition\nGPU 111  GPU 112\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
	dp3_pp1_layer8_expert_agg -> dp3_pp1_to_pp2
	dp3_pp1_to_pp2 -> dp3_pp2_layer9_attn_tp0
	output_dp0 [label="Output DP0\nGPU 31\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
	dp0_pp2_layer16_expert_agg -> output_dp0
	output_dp1 [label="Output DP1\nGPU 63\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
	dp1_pp2_layer16_expert_agg -> output_dp1
	output_dp2 [label="Output DP2\nGPU 95\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
	dp2_pp2_layer16_expert_agg -> output_dp2
	output_dp3 [label="Output DP3\nGPU 127\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
	dp3_pp2_layer16_expert_agg -> output_dp3
	final_output [label="Final Output\nInput: [batch_size=4, seq_len=1024, hidden=512]\nOutput: [batch_size=4, seq_len=1024, hidden=512]" fillcolor=lightblue shape=ellipse]
	output_dp0 -> final_output [style=dashed]
	output_dp1 -> final_output [style=dashed]
	output_dp2 -> final_output [style=dashed]
	output_dp3 -> final_output [style=dashed]
}
